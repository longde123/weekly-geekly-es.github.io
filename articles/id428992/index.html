<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå≤ üßö üêÅ Bypass kunci secara selektif pada router dengan firmware Padavan dan Keenetic OS üïî ‚ùî üåç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sejumlah besar instruksi telah diterbitkan dengan berbagai opsi untuk melewati pemblokiran sumber daya Internet. Tapi topiknya tidak kehilangan releva...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bypass kunci secara selektif pada router dengan firmware Padavan dan Keenetic OS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428992/"> Sejumlah besar instruksi telah diterbitkan dengan berbagai opsi untuk melewati pemblokiran sumber daya Internet.  Tapi topiknya tidak kehilangan relevansi.  Bahkan lebih sering, inisiatif terdengar di tingkat legislatif untuk memblokir artikel tentang metode untuk memotong kunci.  Dan ada desas-desus bahwa Roskomnadzor akan menerima paket uang pembayar pajak untuk kunci yang "lebih baik".  Pengguna yang berpengalaman tidak akan mempelajari sesuatu yang baru atau berguna dari artikel tersebut.  Tetapi yang lain akan menerima instruksi langkah demi langkah yang siap pakai untuk pintas kunci selektif yang sederhana dan efektif pada router populer dengan Padavan dan firmware Keenetic. <br><br><img src="https://habrastorage.org/webt/is/kb/td/iskbtdxuaisqiyg3r4tsrjhj6aw.jpeg"><br><a name="habracut"></a><br><h1>  Isi </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pendahuluan</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagaimana Anda bisa melewati kunci setelah konfigurasi?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Prinsip kerja</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mengkonfigurasi Router Padavan</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Mengkonfigurasi Router dengan OS Keenetic</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Metode dasar untuk mendiagnosis kesalahan setelah konfigurasi</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bypass tambahan untuk memfilter kueri DNS oleh penyedia</a> </li></ul><br><a name="con1"></a><h1>  Pendahuluan </h1><br>  Saya menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">opsi pintas kunci</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Zolg</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">selama</a> sekitar dua tahun.  Banyak instruksi pada jaringan didasarkan padanya.  Milik saya termasuk. <br><br>  Semuanya baik, tetapi "yang terbaik selalu menjadi musuh yang baik."  Pertama, beberapa program baru menjadi terlalu "pintar" dan akan menyelesaikan domain menggunakan metode mereka sendiri, melewati server DNS router.  Ini tidak memungkinkan dnsmasq pada router untuk menambahkan alamat ke set ipset untuk membuka kunci dan mengarah ke hasil logis - sumber daya tetap terkunci.  Di Android 9, dukungan asli untuk DNS-over-TLS, mis.  metode mem-bypass kunci ini berhenti berfungsi (jika perangkat lain belum mengakses dnsmasq sebelumnya).  Kedua, memperbarui seluruh daftar domain dari antizapret mengarah ke hasil yang tidak dapat diprediksi setiap saat.  Daftar ini mungkin termasuk domain yang tidak benar-benar diblokir, dan yang operasinya penting melalui saluran utama.  Anda harus selalu waspada dan mengedit file yang dihasilkan dengan tangan Anda.  Ketiga, saya bosan "menyeret" daftar besar domain dengan puluhan ribu kasino dan sejenisnya, yang sama sekali tidak diperlukan.  Seiring waktu, saya menyadari bahwa saya hanya membutuhkan daftar kecil sumber daya yang diblokir. <br><br>  Jadi selama setahun saya telah menggunakan metode membuka kunci yang sedikit dimodifikasi, yang saya sepenuhnya puas dengan: <br><br><ul><li>  Kesederhanaan dan kemudahan kontrol (setelah konfigurasi). </li><li>  Kontrol penuh atas sumber daya apa yang Anda butuhkan untuk membuka kunci. </li><li>  Persyaratan minimum untuk sumber daya prosesor dan RAM router. </li><li>  Cakupan nuansa yang luas saat melewati kunci. </li></ul><br>  Penting untuk dicatat bahwa opsi saya tidak dimaksudkan untuk kasus ketika Anda perlu membuka ratusan dan ribuan domain.  Karena ketika router mulai, setiap domain dari daftar yang diberikan diselesaikan.  Semakin banyak domain dalam daftar, semakin lama inisialisasi banyak ipset untuk dibuka. <br><br>  Dasar untuk mem-bypass kunci adalah sama - jaringan Tor.  Penggunaannya disebabkan oleh dua faktor sederhana - gratis, dan kemungkinan Tor akan diblokir di Rusia mendekati nol, tidak seperti layanan VPN apa pun.  Tor adalah dasar dari perdagangan narkoba di Rusia dari tengah ke bawah.  Locking Tor akan mengarah pada pencarian alat-alat baru untuk pasar dan penurunan anonimitas, yang akan mensyaratkan keberhasilan aktivasi pekerjaan lembaga penegak hukum setempat.  Pada akhirnya, ini, seperti virus, akan mulai berdampak negatif pada tautan atas.  Mengingat berita luar biasa terbaru tentang hubungan pejabat senior pemerintah dengan perdagangan narkoba global ke Rusia, pemblokiran Tor di Rusia hanyalah hal yang tabu, meskipun sepele.  Baik Roskomnadzor, tidak peduli berapa miliar yang dialokasikan untuk departemen ini, tidak ada pengadilan tunggal di Rusia yang memiliki izin "dari atas" untuk memblokir Tor.  Dan itu bahkan tidak mengejutkan siapa pun atau menakut-nakuti siapa pun, meskipun Rusia hanya tenggelam dalam narkoba (setiap anak sekolah tahu apa yang akan dilakukan, dan setelah 30 menit itu sebenarnya mungkin di kota mana pun dengan populasi 10 ribu orang untuk secara bebas mendapatkan obat apa pun secara praktis dalam jumlah berapapun - suatu kebenaran kehidupan yang jahat).  Dalam mode saat ini, probabilitas memblokir jaringan Tor lebih rendah daripada kemungkinan memblokir situs museum Hermitage. <br><br>  Instruksi yang diberikan mudah untuk diadaptasi untuk router dengan OpenWrt.  Juga, perubahan kecil membuatnya mudah untuk mengganti Tor dengan OpenVPN. <br><br><a name="con11"></a><h1>  Bagaimana Anda bisa melewati kunci setelah konfigurasi? </h1><br>  Semuanya sangat sederhana.  Anda memiliki file /opt/etc/unblock.txt - daftar sederhana untuk membuka kunci.  Anda dapat membuka kunci domain, alamat IP, rentang alamat atau CIDR.  Satu baris - satu elemen.  Baris kosong diizinkan, dan Anda dapat menggunakan karakter # di awal baris untuk diabaikan. <br><br><div class="spoiler">  <b class="spoiler_title">Ini adalah contoh file pribadi saya</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br>  Setelah mengedit file ini, Anda cukup menjalankan perintah untuk menerapkan konfigurasi baru: <br><br><pre> <code class="bash hljs">unblock_update.sh</code> </pre> <br>  Semua sumber daya dari unblock.txt dibuka tanpa harus me-restart router. <br><br><a name="con12"></a><h1>  Prinsip kerja </h1><br><ul><li>  Inisialisasi router membuat seperangkat alamat IP ipset kosong yang disebut unblock. </li><li>  Aturan untuk mengarahkan ulang semua paket dengan tujuan dari pemblokiran ke layanan Tor ditambahkan ke firewall. </li><li>  Layanan Tor dimulai dalam mode proxy transparan. </li><li>  Script khusus unblock_ipset.sh diluncurkan, yang menyelesaikan semua domain dari unblock.txt dan menambahkan alamat IP mereka ke set blokir.  Alamat IP, rentang, dan CIDR dari file ini juga ditambahkan ke blokir. </li><li>  Dnsmasq diluncurkan dengan file konfigurasi tambahan, unblock.dnsmasq, yang menunjukkan penambahan alamat IP domain dari unblock.txt ke blokir yang ditetapkan saat menyelesaikan. </li><li>  cron menjalankan unblock_ipset.sh dengan frekuensi tertentu untuk mengkompensasi sebagian kemungkinan kasus dengan nuansa. </li><li>  Jika perlu, semua domain dari unblock.txt (dan hanya mereka) menyelesaikan melalui dnscrypt-proxy jika penyedia menyaring DNS. </li></ul><br><a name="con2"></a><h1>  Mengkonfigurasi Router Padavan </h1><br>  Anda harus memiliki router dengan firmware Padavan yang diinstal dan manajer paket Entware yang sudah dikonfigurasi.  Pada Windows, Anda dapat menggunakan klien <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Putty</a> untuk terhubung ke router melalui SSH. <br><br>  Pastikan Anda menggunakan Entware, bukan legware Entware-ng.  Lihat isi folder / opt / var / opkg-daftar.  Akan ada file entware atau entware-ng.  Dalam kasus kedua, Anda perlu memperbarui firmware Padavan dari router Anda ke versi terbaru dan menginstal ulang manajer paket Entware.  Hanya kemudian melanjutkan dengan petunjuk langkah demi langkah. <br><br>  Seperti yang diperlihatkan oleh ulasan, terutama mereka yang memiliki Entware yang dikonfigurasikan secara tidak benar pada awalnya (mis., Skrip dari init.d tidak dimuat) dalam memori internal router.  Jika Anda memiliki Xiaomi Mi Router 3 atau 3G, dan Anda tidak yakin Entware berfungsi dengan benar di memori internal Anda (mulai otomatis), maka atur semuanya lagi.  Ambil PROMETHEUS.  Memperbarui skrip (1).  Perbarui kode sumber (2).  Kumpulkan dan flash firmware terbaru (4).  Reset pengaturan firmware (NVRAM dan penyimpanan file) - Lanjutan&gt; Administrasi&gt; Pengaturan.  Konfigurasikan akses Internet pada router dan aktifkan SSH.  Lakukan di PROMETHEUS Firmware&gt; Format RWFS.  Pilih Tingkat Lanjut&gt; Administrasi&gt; Pengaturan&gt; Tingkatkan sistem file di bagian R / W&gt; UBIFS.  Nyalakan ulang router.  Semua skrip startup Entware saat ini dari memori internal akan didaftarkan secara otomatis, dan semuanya akan berfungsi seperti jam. <br><br>  Untuk pengujian, saya menggunakan Xiaomi Mi Router 3G yang populer (Entware dipasang di memori internal) dengan firmware terbaru - 32a93db.  Semuanya akan bekerja bahkan pada bayi legendaris WT3020 AD / F / H sebesar $ 10. <br><br><img src="https://habrastorage.org/webt/th/kf/2k/thkf2kvtt2rhtnbxvmx0qri7dsk.jpeg"><br><br><h3>  1. Menginstal perangkat lunak yang diperlukan pada router </h3><br><pre> <code class="bash hljs">opkg update opkg install mc tor tor-geoip <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dig cron</code> </pre> <br>  <b>mc</b> - manajer file Midnight Commander.  Ini diperlukan hanya karena editor mcedit yang mudah digunakan.  Jika Anda terbiasa menggunakan editor teks lain, maka mc tidak dapat diinstal. <br>  <b>layanan tor</b> - Tor. <br>  <b>tor-geoip</b> - basis data geo-IP untuk Tor. <br>  <b>bind-dig</b> - klien DNS (analog dengan nslookup dan host). <br>  <b>cron</b> - task scheduler. <br><cut></cut><br><h3>  2. Inisialisasi ipset, buat beberapa alamat IP unblock (start_script.sh) </h3><br>  Hubungkan modul yang diperlukan dan buat satu set alamat kosong dengan nama <b>buka blokir</b> saat router boot.  Untuk melakukan ini, buka file <b>/etc/storage/start_script.sh</b> di editor: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/start_script.sh</code> </pre> <br>  Tambahkan di akhir: <br><br><pre> <code class="bash hljs">modprobe ip_set modprobe ip_set_hash_ip modprobe ip_set_hash_net modprobe ip_set_bitmap_ip modprobe ip_set_list_set modprobe xt_set ipset create unblock <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>:net</code> </pre> <br>  Untuk menempel dari buffer, gunakan Shift + Insert, simpan - F2, keluar - F10. <br><br><img src="https://habrastorage.org/webt/tr/zp/cq/trzpcqqnadbonhsb0x3ebe7ltpo.png"><br><br>  Jika diinginkan, Anda dapat mengedit file start_script.sh melalui antarmuka web router - "Advanced"&gt; "Personalisasi"&gt; "Scripts"&gt; "Run sebelum menginisialisasi router."  Setelah mengedit, klik "Terapkan." <br><br><img src="https://habrastorage.org/webt/yr/aa/8q/yraa8qgcfwu-vesrp3wvvne2vui.png"><br><br><h3>  3. Pengaturan Tor </h3><br>  Hapus konten file konfigurasi Tor: <br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/tor/torrc</code> </pre> <br>  Buka file konfigurasi Tor: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/tor/torrc</code> </pre> <br>  Rekatkan (Shift + Sisipkan) isinya: <br><br><pre> <code class="bash hljs">User admin PidFile /opt/var/run/tor.pid ExcludeExitNodes {RU},{UA},{AM},{KG},{BY} StrictNodes 1 TransPort 192.168.0.1:9141 ExitRelay 0 ExitPolicy reject *:* ExitPolicy reject6 *:* GeoIPFile /opt/share/tor/geoip GeoIPv6File /opt/share/tor/geoip6 DataDirectory /opt/var/lib/tor</code> </pre> <br>  Jika perlu, ganti <b>192.168.0.1</b> dengan alamat internal router Anda (LAN).  Deskripsi konfigurasi singkat: <br><br><ul><li>  Kecualikan simpul keluaran: Rusia, Ukraina, Armenia Kirgistan, Belarus. </li><li>  Gantung proxy transparan ke alamat 192.168.0.1, port 9141. </li><li>  Tolak menjadi titik keluar. </li></ul><br><h3>  4. Daftar domain (dan tidak hanya) untuk memotong kunci (buka blokir.txt) </h3><br>  unblock.txt adalah daftar sederhana untuk membuka kunci.  Anda dapat membuka kunci domain, alamat IP, jangkauan atau CIDR.  Satu baris - satu elemen.  Baris kosong (termasuk spasi dan tab) diabaikan.  Anda dapat menggunakan karakter # di awal baris untuk mengabaikannya. <br><br>  Buat file <b>/opt/etc/unblock.txt</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/unblock.txt</code> </pre> <br>  Setiap baris dapat berisi nama domain, alamat IP, rentang, atau CIDR.  Anda dapat menggunakan karakter # untuk mengomentari baris. <br><br><div class="spoiler">  <b class="spoiler_title">Ini adalah contoh file pribadi saya</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br><h3>  5. Sebuah skrip untuk mengisi satu set blokir alamat IP dari daftar domain tertentu (unblock_ipset.sh) </h3><br>  Buat skrip <b>/opt/bin/unblock_ipset.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br>  Rekatkan (Shift + Sisipkan) isinya: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Berikan hak eksekusi: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_ipset.sh</code> </pre> <br>  Skripnya cukup sederhana, itulah esensi dari kerjanya ... Kami sedang menunggu resolusi domain google.com berfungsi (jika ini tidak dilakukan, banyak pemblokiran tidak akan terisi ketika router melakukan booting, karena router akan masih dalam proses inisialisasi).  Kami membaca baris di file unblock.txt.  Baca baris secara otomatis menghapus spasi dan tab di awal dan akhir.  Lewati garis kosong.  Lewati garis yang dimulai dengan karakter #.  Kami sedang mencari di baris CIDR.  Jika CIDR ditemukan, lalu tambahkan untuk membuka blokir.  Kami mencari rentang dalam string.  Jika ditemukan, tambahkan itu untuk membuka blokir.  Kami mencari alamat IP dalam string.  Jika IP ditemukan, tambahkan itu untuk membuka blokir.  Mari kita selesaikan suatu garis melalui penggalian.  Semua alamat IP dari hasil ditambahkan untuk membuka blokir. <br><br><h3>  6. Sebuah skrip untuk menghasilkan file konfigurasi dnsmasq tambahan dari daftar domain yang diberikan (unblock_dnsmasq.sh) </h3><br>  Buat skrip <b>/opt/bin/unblock_dnsmasq.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  Rekatkan (Shift + Sisipkan) isinya: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Berikan hak eksekusi: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  Skripnya cukup sederhana, itulah esensi dari kerjanya ... Kami secara berurutan membaca baris-baris dari /opt/etc/unblock.txt.  Baca baris secara otomatis menghapus spasi dan tab di awal dan akhir.  Lewati garis kosong.  Lewati garis yang dimulai dengan #.  Kami melewatkan baris yang berisi alamat IP (IP, range, CIDR), mis.  kami hanya tertarik pada string dengan nama domain.  Dalam file /opt/etc/unblock.dnsmasq kita menambahkan baris dari bentuk "ipset = / domain_name / unblock".  Ini berarti bahwa setelah menentukan alamat IP dari domain tertentu, mereka akan secara otomatis ditambahkan ke set blokir. <br><br>  Pastikan untuk menjalankan skrip untuk menghasilkan file unblock.dnsmasq: <br><br><pre> <code class="bash hljs">unblock_dnsmasq.sh</code> </pre> <br>  Verifikasi bahwa file unblock.dnsmasq dibuat: <br><br><pre> <code class="bash hljs">cat /opt/etc/unblock.dnsmasq</code> </pre> <br><h3>  7. Skrip untuk pembaruan paksa sistem secara manual setelah mengedit daftar domain (unblock_update.sh) </h3><br>  Buat skrip <b>/opt/bin/unblock_update.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_update.sh</code> </pre> <br>  Rekatkan (Shift + Sisipkan) isinya: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ipset flush unblock /opt/bin/unblock_dnsmasq.sh restart_dhcpd sleep 3 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre> <br>  Berikan hak eksekusi: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_update.sh</code> </pre> <br><h3>  8. Script untuk secara otomatis mengisi satu set pemblokiran saat mem-boot router (S99unblock) </h3><br>  Buat skrip <b>/opt/etc/init.d/S99unblock</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/init.d/S99unblock</code> </pre> <br>  Rekatkan (Shift + Sisipkan) isinya: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre><br>  Berikan hak eksekusi: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/init.d/S99unblock</code> </pre> <br><h3>  9. Meneruskan paket dengan tujuan dari buka blokir ke Tor (post_iptables_script.sh) </h3><br>  Buka file <b>/etc/storage/post_iptables_script.sh</b> di editor: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/post_iptables_script.sh</code> </pre> <br>  Tambahkan di akhir: <br><br><pre> <code class="bash hljs">iptables -t nat -A PREROUTING -i br0 -p tcp -m <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> --match-set unblock dst -j REDIRECT --to-port 9141</code> </pre> <br><img src="https://habrastorage.org/webt/af/u2/dl/afu2dld3v0nrhtjwfekvo6i-wsi.png"><br><br>  Jika mau, Anda dapat mengedit file post_iptables_script.sh melalui antarmuka web router - "Advanced"&gt; "Personalisasi"&gt; "Scripts"&gt; "Jalankan setelah memulai kembali aturan firewall".  Setelah mengedit, klik "Terapkan." <br><br><img src="https://habrastorage.org/webt/pv/be/ot/pvbeotspo0xhzrukgp3dgvu5aws.png"><br><br>  Anda dapat menambahkan (ini opsional) ke file yang sama untuk mengarahkan ulang semua permintaan ke port eksternal 53 ke diri Anda sendiri.  Ini diperlukan agar klien di jaringan lokal tidak menggunakan layanan DNS pihak ketiga.  Permintaan akan melalui server DNS biasa. <br><br><pre> <code class="bash hljs">iptables -t nat -I PREROUTING -i br0 -p udp --dport 53 -j DNAT --to 192.168.0.1 iptables -t nat -I PREROUTING -i br0 -p tcp --dport 53 -j DNAT --to 192.168.0.1</code> </pre> <br>  Jika perlu, ganti <b>192.168.0.1</b> dengan alamat internal router Anda (LAN). <br><br><h3>  10. Menghubungkan file konfigurasi tambahan ke dnsmasq </h3><br>  Kita perlu menghubungkan file unblock.dnsmasq yang dibuat ke dnsmasq.  Untuk melakukan ini, buka file <b>/etc/storage/dnsmasq/dnsmasq.conf</b> di editor: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/dnsmasq/dnsmasq.conf</code> </pre> <br>  Tambahkan di akhir: <br><br><pre> <code class="bash hljs">conf-file=/opt/etc/unblock.dnsmasq</code> </pre> <br>  Jika Anda mau (ini opsional), Anda dapat menambahkan server tambahan untuk resolusi dan keandalan: <br><br><pre> <code class="bash hljs">server=8.8.8.8</code> </pre> <br>  Jika mau, Anda dapat mengedit file dnsmasq.conf melalui antarmuka web router - "Advanced"&gt; "LAN"&gt; "DHCP server"&gt; "File konfigurasi pengguna dnsmasq.conf".  Setelah mengedit, klik "Terapkan." <br><br><img src="https://habrastorage.org/webt/x0/ar/4c/x0ar4cm6v9pgsluqabh74qck-s0.png"><br><br><h3>  11. Menambahkan tugas ke cron untuk memperbarui konten set blokir secara berkala </h3><br>  Ini adalah asuransi tambahan jika program / perangkat menggunakan metode penyelesaiannya sendiri dan alamat IP domain telah berubah.  Yang perlu Anda lakukan adalah menjalankan skrip unblock_ipset.sh pada frekuensi yang diinginkan.  Misalnya, kami akan meluncurkan setiap hari jam 6 pagi. <br><br>  Ganti nama root dengan admin di file konfigurasi cron: <br><br><pre> <code class="bash hljs">sed -i <span class="hljs-string"><span class="hljs-string">'s/root/admin/g'</span></span> /opt/etc/crontab</code> </pre> <br>  Buka file <b>/ opt / etc / crontab</b> di editor: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/crontab</code> </pre> <br>  Tambahkan di akhir: <br><br><pre> <code class="bash hljs">00 06 * * * admin /opt/bin/unblock_ipset.sh</code> </pre> <br>  Jika mau, Anda dapat mengomentari semua tugas templat lainnya.  Seperti inilah tampilan file crontab Anda: <br><br><img src="https://habrastorage.org/webt/hf/lb/fc/hflbfcv04lpvzlrjmehoc3l51ts.png"><br><br><h3>  12. Memulai ulang router </h3><br>  Jalankan perintah: <br><br><pre> <code class="bash hljs">reboot</code> </pre> <br>  Setelah reboot, buka situs web check.torproject.org di browser Anda (harus ditambahkan ke unblock.txt).  Jika Anda melakukan semuanya dengan benar, maka Anda akan melihat tulisan ‚ÄúSelamat.  Browser ini dikonfigurasi untuk menggunakan Tor. ": <br><br><img src="https://habrastorage.org/webt/wa/19/dz/wa19dzxbu8qtldwrvkeijfqna7q.png"><br><br><br><a name="con3"></a><h1>  Mengkonfigurasi Router dengan OS Keenetic </h1><br>  Anda harus memiliki router Keenetic / Zyxel dengan Entware Package Manager (OPKG) yang sudah dikonfigurasi.  Misalnya, berikut adalah daftar beberapa router yang mendukung Entware: Keenetic II, Keenetic III, Extra, Extra II, Giga II, Giga III, Omni, Omni II, Viva, Ultra, Ultra II, Omni (KN-1410), Extra (KN -1710), Giga (KN-1010), Ultra (KN-1810), Viva (KN-1910), DSL (KN-2010), Duo (KN-2110).  Petunjuk untuk mengonfigurasi Entware dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> (hingga 10 poin). <br><br>  Jika sebelumnya (dengan firmware di bawah 2.07) Anda telah menambahkan dukungan Entware, maka pastikan Anda <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menggunakan Entware-ng yang ketinggalan zaman</a> . <br><br>  Pastikan untuk mengaktifkan "Modul Kernel Netfilter Subsistem" - Pengaturan Umum&gt; Ubah Komponen.  Jika tidak ada dalam daftar yang tersedia, maka cobalah untuk menginstal komponen protokol IPv6 terlebih dahulu.  Jika setelah ini tidak muncul, maka coba tanpanya, tetapi sangat mungkin bahwa Anda tidak akan dapat membuka kunci berdasarkan jangkauan dan CIDR (karena tidak akan ada dukungan untuk hash: set net). <br><br><img src="https://habrastorage.org/webt/vv/dh/hi/vvdhhirhcktuefrgbxh3fkx5i0i.png"><br><br>  Untuk tes, saya menggunakan Keenetic Ultra (KN-1810) dengan firmware terbaru - 2.14.C.0.0-4. <br><br>  <u>Catatan penting.</u>  <u>Anda harus menonaktifkan server DNS biasa di sistem, kami akan menggunakan dnsmasq sebagai gantinya.</u>  <u>Anda akan kehilangan kemampuan untuk menetapkan layanan DNS (Yandex.DNS / SkyDNS / DNS AdGuard) secara individual untuk klien, tetapi Anda dapat menggunakannya secara global melalui pengaturan dnsmasq jika perlu.</u> <br><br><h3>  1. Menginstal perangkat lunak yang diperlukan pada router </h3><br><pre> <code class="bash hljs">opkg update opkg install mc tor tor-geoip <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dig cron dnsmasq-full ipset iptables</code> </pre> <br>  <b>mc</b> - manajer file Midnight Commander.  Ini diperlukan hanya karena editor mcedit yang mudah digunakan.  Jika Anda terbiasa menggunakan editor teks lain, maka mc tidak dapat diinstal. <br>  <b>layanan tor</b> - Tor. <br>  <b>tor-geoip</b> - basis data geo-IP untuk Tor. <br>  <b>bind-dig</b> - klien DNS (analog dengan nslookup dan host). <br>  <b>cron</b> - task scheduler. <br>  <b>dnsmasq-full</b> - server DNS. <br>  <b>ipset dan iptables</b> adalah <b>ipset dan</b> utilitas konsol <b>iptables</b> (mungkin sudah ada di sistem dan tidak diperlukan, saya menambahkannya untuk keamanan). <br><br><h3>  2. Inisialisasi ipset, buat beberapa alamat IP unblock (100-ipset.sh) </h3><br>  Periksa apakah sistem router Anda mendukung banyak hash: net (ternyata, tidak semua router Keenetic memilikinya): <br><br><pre> <code class="bash hljs">ipset create <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>:net</code> </pre> <br>  Jika tim tidak memberikan kesalahan atau pesan, maka ada dukungan, dan cukup ikuti instruksi lebih lanjut.  Jika tidak (ada kesalahan) dalam skrip berikut, Anda harus mengganti <b>hash: net</b> dengan <b>hash: ip</b> .  Dalam hal ini, Anda kehilangan kemampuan untuk membuka kunci rentang dan CIDR. <br><br>  Buat satu set alamat kosong yang disebut <b>blokir</b> saat router melakukan booting.  Untuk melakukan ini, buat file <b>/opt/etc/ndm/fs.d/100-ipset.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/ndm/fs.d/100-ipset.sh</code> </pre> <br>  Rekatkan (Shift + Sisipkan) isinya: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 ipset create unblock hash:net -exist exit 0</span></span></code> </pre> <br>  Untuk menempel dari buffer, gunakan Shift + Insert, simpan - F2, keluar - F10. <br><br>  Berikan hak eksekusi: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/ndm/fs.d/100-ipset.sh</code> </pre> <br><h3>  3. Pengaturan Tor </h3><br>  Hapus konten file konfigurasi Tor: <br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/tor/torrc</code> </pre> <br>  Buka file konfigurasi Tor: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/tor/torrc</code> </pre> <br>  Rekatkan (Shift + Sisipkan) isinya: <br><br><pre> <code class="bash hljs">User root PidFile /opt/var/run/tor.pid ExcludeExitNodes {RU},{UA},{AM},{KG},{BY} StrictNodes 1 TransPort 192.168.0.1:9141 ExitRelay 0 ExitPolicy reject *:* ExitPolicy reject6 *:* GeoIPFile /opt/share/tor/geoip GeoIPv6File /opt/share/tor/geoip6 DataDirectory /opt/var/lib/tor</code> </pre> <br>  Jika perlu, ganti <b>192.168.0.1</b> dengan alamat internal router Anda (LAN).  Deskripsi konfigurasi singkat: <br><br><ul><li>  Kecualikan simpul keluaran: Rusia, Ukraina, Armenia Kirgistan, Belarus. </li><li>  Gantung proxy transparan ke alamat 192.168.0.1, port 9141. </li><li>  Tolak menjadi titik keluar. </li></ul><br><h3>  4. Daftar domain (dan tidak hanya) untuk memotong kunci (buka blokir.txt) </h3><br>  unblock.txt adalah daftar sederhana untuk membuka kunci.  Anda dapat membuka kunci domain, alamat IP, jangkauan atau CIDR.  Satu baris - satu elemen.  Baris kosong (termasuk spasi dan tab) diabaikan.  Anda dapat menggunakan karakter # di awal baris untuk mengabaikannya. <br><br>  Buat file <b>/opt/etc/unblock.txt</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/unblock.txt</code> </pre> <br>  Setiap baris dapat berisi nama domain, alamat IP, rentang, atau CIDR.  Anda dapat menggunakan karakter # untuk mengomentari baris. <br><br><div class="spoiler">  <b class="spoiler_title">Ini adalah contoh file pribadi saya</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br><h3>  5. Sebuah skrip untuk mengisi satu set blokir alamat IP dari daftar domain tertentu (unblock_ipset.sh) </h3><br>  Buat skrip <b>/opt/bin/unblock_ipset.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br>  Rekatkan (Shift + Sisipkan) isinya: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Berikan hak eksekusi: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_ipset.sh</code> </pre> <br>  Skripnya cukup sederhana, itulah esensi dari kerjanya ... Kami sedang menunggu resolusi domain google.com bekerja (jika ini tidak dilakukan, banyak pemblokiran tidak akan terisi ketika router melakukan booting, karena router akan masih dalam proses inisialisasi).  Kami membaca baris di file unblock.txt.  Baca baris secara otomatis menghapus spasi dan tab di awal dan akhir.  Lewati garis kosong.  Lewati garis yang dimulai dengan karakter #.  Kami sedang mencari di baris CIDR.  Jika CIDR ditemukan, lalu tambahkan untuk membuka blokir.  Kami mencari rentang dalam string.  Jika ditemukan, tambahkan itu untuk membuka blokir.  Kami sedang mencari alamat IP dalam string.  Jika IP ditemukan, tambahkan itu untuk membuka blokir.  Mari kita selesaikan suatu garis melalui penggalian.  Semua alamat IP dari hasil ditambahkan untuk membuka blokir. <br><br><h3>  6. Sebuah skrip untuk menghasilkan file konfigurasi dnsmasq tambahan dari daftar domain yang diberikan (unblock_dnsmasq.sh) </h3><br>  Buat skrip <b>/opt/bin/unblock_dnsmasq.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  Rekatkan (Shift + Sisipkan) isinya: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Berikan hak eksekusi: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  Skripnya cukup sederhana.  Kami secara berurutan membaca baris-baris dari /opt/etc/unblock.txt.  Baca baris secara otomatis menghapus spasi dan tab di awal dan akhir.  Lewati garis kosong.  Lewati garis yang dimulai dengan #.  Lewati baris yang berisi alamat IP (IP atau CIDR), mis.  kami hanya tertarik dengan string dengan nama domain.  Dalam file /opt/etc/unblock.dnsmasq kita menambahkan baris dari bentuk "ipset = / domain_name / unblock".  Ini berarti bahwa setelah menentukan alamat IP dari domain tertentu, mereka akan secara otomatis ditambahkan ke set blokir. <br><br>  Pastikan untuk menjalankan skrip untuk menghasilkan file unblock.dnsmasq: <br><br><pre> <code class="bash hljs">unblock_dnsmasq.sh</code> </pre> <br>  Verifikasi bahwa file unblock.dnsmasq dibuat: <br><br><pre> <code class="bash hljs">cat /opt/etc/unblock.dnsmasq</code> </pre> <br><h3>  7. Skrip untuk pembaruan paksa sistem secara manual setelah mengedit daftar domain (unblock_update.sh) </h3><br>  Buat skrip <b>/opt/bin/unblock_update.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_update.sh</code> </pre> <br>  Rekatkan (Shift + Sisipkan) isinya: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ipset flush unblock /opt/bin/unblock_dnsmasq.sh /opt/etc/init.d/S56dnsmasq restart /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre> <br>  Berikan hak eksekusi: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_update.sh</code> </pre> <br><h3>  8. Script untuk secara otomatis mengisi seperangkat blokir saat mem-boot router (S99unblock) </h3><br>  Buat skrip <b>/opt/etc/init.d/S99unblock</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/init.d/S99unblock</code> </pre> <br>  Rekatkan (Shift + Sisipkan) isinya: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre><br>  Berikan hak eksekusi: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/init.d/S99unblock</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9. Meneruskan paket dengan tujuan dari buka blokir ke Tor (100-redirect.sh) </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk melakukan ini, buat file </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/etc/ndm/netfilter.d/100-redirect.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/ndm/netfilter.d/100-redirect.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rekatkan (Shift + Sisipkan) isinya: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$type" == "ip6tables" ] &amp;&amp; exit 0 if [ -z "$(iptables-save 2&gt;/dev/null | grep unblock)" ]; then ipset create unblock hash:net -exist iptables -w -t nat -A PREROUTING -i br0 -p tcp -m set --match-set unblock dst -j REDIRECT --to-port 9141 fi exit 0</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda menggunakan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash: ip</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di langkah 2 </font><font style="vertical-align: inherit;">dan bukan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash: net</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lalu ganti hash: net dengan hash: ip. Bahkan, kami juga menduplikasi fungsi membuat satu set pemblokiran dari 2 langkah. Ini diperlukan untuk keamanan, jika skrip dari fs.d belum mulai berjalan, dan skrip netfilter.d sudah berjalan. Tidak apa-apa jika membuka blokir sudah dibuat sebelumnya, perintah itu hanya akan diabaikan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda dapat menambahkan (ini opsional) ke file yang sama untuk mengarahkan ulang semua permintaan ke port eksternal 53 ke diri Anda sendiri. Ini diperlukan agar klien di jaringan lokal tidak menggunakan layanan DNS pihak ketiga. Permintaan akan melalui server DNS biasa. Sebelum pintu keluar terakhir, tambahkan:</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(iptables-save 2&gt;/dev/null | grep "udp \-\-dport 53 \-j DNAT")</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> iptables -w -t nat -I PREROUTING -i br0 -p udp --dport 53 -j DNAT --to 192.168.0.1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(iptables-save 2&gt;/dev/null | grep "tcp \-\-dport 53 \-j DNAT")</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> iptables -w -t nat -I PREROUTING -i br0 -p tcp --dport 53 -j DNAT --to 192.168.0.1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika perlu, ganti </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan alamat internal router Anda (LAN). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berikan hak eksekusi:</font></font><br><br><pre> <code class="bash hljs">chmod +x /opt/etc/ndm/netfilter.d/100-redirect.sh</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10. Mengkonfigurasi dnsmasq dan melampirkan file konfigurasi tambahan ke dnsmasq </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hapus konten file konfigurasi dnsmasq: </font></font><br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/dnsmasq.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Buka file konfigurasi dnsmasq: </font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/dnsmasq.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rekatkan (Shift + Sisipkan) isinya: </font></font><br><br><pre> <code class="bash hljs">user=nobody bogus-priv no-negcache clear-on-reload <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dynamic listen-address=192.168.0.1 listen-address=127.0.0.1 min-port=4096 cache-size=1536 expand-hosts <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-async conf-file=/opt/etc/unblock.dnsmasq server=8.8.8.8</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika perlu, ganti </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan alamat internal router Anda (LAN).</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11. Menambahkan tugas ke cron untuk memperbarui konten set blokir secara berkala </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini adalah asuransi tambahan jika program / perangkat menggunakan metode penyelesaiannya sendiri dan alamat IP domain telah berubah. </font><font style="vertical-align: inherit;">Yang perlu Anda lakukan adalah menjalankan skrip unblock_ipset.sh pada frekuensi yang diinginkan. </font><font style="vertical-align: inherit;">Misalnya, kami akan meluncurkan setiap hari jam 6 pagi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buka file </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ opt / etc / crontab</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di editor </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/crontab</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tambahkan di akhir: </font></font><br><br><pre> <code class="bash hljs">00 06 * * * root /opt/bin/unblock_ipset.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika mau, Anda dapat mengomentari semua tugas templat lainnya. </font><font style="vertical-align: inherit;">Seperti inilah tampilan file crontab Anda:</font></font><br><br><img src="https://habrastorage.org/webt/le/y5/sl/ley5slcvjfvs-9odj9air9qdd8s.png"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 12. Menonaktifkan server DNS biasa dan me-reboot router </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sambungkan ke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Keenetic Router CLI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (port 23 untuk Telnet dan 22 untuk SSH jika komponen "SSH Server" ditambahkan ke sistem). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jalankan perintah:</font></font><br><br><pre> <code class="bash hljs">opkg dns-override system configuration save system reboot</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server DNS yang dibangun ke dalam firmware akan dimatikan, dan dnsmasq dari Entware akan digunakan sebagai gantinya. </font><font style="vertical-align: inherit;">Router, saat boot, memeriksa apakah folder opt sudah terpasang (apakah ada USB flash drive / drive dengan Entware). </font><font style="vertical-align: inherit;">Jika ada, maka server DNS biasa tidak digunakan. </font><font style="vertical-align: inherit;">Jika tidak, gunakan.</font></font> Yaitu<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menghapus flash drive dan me-reboot router, semuanya akan bekerja untuk Anda, seperti sebelumnya (sebelum menyiapkan). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setelah reboot, buka situs web check.torproject.org di browser Anda (harus ditambahkan ke unblock.txt). </font><font style="vertical-align: inherit;">Jika Anda melakukan semuanya dengan benar, maka Anda akan melihat tulisan ‚ÄúSelamat. </font><font style="vertical-align: inherit;">Browser ini dikonfigurasi untuk menggunakan Tor. ":</font></font><br><br><img src="https://habrastorage.org/webt/wa/19/dz/wa19dzxbu8qtldwrvkeijfqna7q.png"><br><br><br><a name="con31"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Metode dasar untuk mendiagnosis kesalahan setelah konfigurasi </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika pemeriksaan dengan situs check.torproject.org (harus ditambahkan ke unblock.txt) lewat, tetapi rintisan dari penyedia terus membuka sumber daya lain (atau tidak terbuka), kemungkinan besar penyedia akan mengganggu lalu lintas DNS, mengganti jawaban - Anda Anda perlu melakukan bypass tambahan untuk memfilter kueri DNS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika setelah konfigurasi, sesuatu tidak berfungsi sebagaimana mestinya, gunakan perintah sederhana untuk menentukan langkah masalahnya. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tampilkan konten dari pemblokiran yang ditetapkan:</font></font><br><br><pre> <code class="bash hljs">ipset list unblock</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika sistem melaporkan bahwa tidak ada set seperti itu, maka kesalahan ada di langkah 2 atau Anda tidak mengaktifkan modul Netfilter dalam sistem (dalam kasus Keenetic). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika set ternyata kosong, skrip unblock_ipset.sh tidak berfungsi, yang pada gilirannya harus dimulai oleh skrip mulai S99unblock. Jalankan skrip unblock_ipset.sh ini secara manual. Jika set sudah penuh, maka kesalahannya ada pada langkah 8. Jika skrip tidak dapat dieksekusi (kemungkinan besar, menunggu resolusi google.com), maka kesalahan ada di sisi server DNS, mungkin pada langkah 10 atau 6. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Periksa untuk pengalihan iptables :</font></font><br><br><pre> <code class="bash hljs">iptables-save 2&gt;/dev/null | grep unblock</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika tidak ada di sana, maka kesalahannya ada pada langkah 9. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika sama sekali semua situs sedang down, mis. </font><font style="vertical-align: inherit;">DNS tidak berfungsi, kesalahan ada di suatu tempat di tahap 6 atau 10. Mungkin, di tahap 9. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika semua situs dari unblock.txt tidak berfungsi (batas waktu terlampaui), tetapi semua yang lain berfungsi, maka masalahnya ada di sisi Tor, kesalahan pada tahap 3.</font></font><br><br><br><a name="con4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bypass tambahan untuk memfilter kueri DNS oleh penyedia </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika penyedia mengganggu lalu lintas DNS dengan mengganti respons untuk sumber daya yang diblokir, ini sangat mudah untuk dilakukan. </font><font style="vertical-align: inherit;">Untuk ini kita akan menggunakan dnscrypt-proxy. </font><font style="vertical-align: inherit;">Jika ingin dan mengalami, Anda dapat dengan mudah mengganti dnscrypt dengan stubby (DNS over TLS). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt hanya akan digunakan untuk domain yang terdaftar di unblock.txt. </font><font style="vertical-align: inherit;">Semua pertanyaan lain akan melalui server DNS biasa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika Anda yakin bahwa penyedia Anda tidak memfilter kueri DNS, maka Anda tidak perlu melakukan konfigurasi tambahan ini. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda seharusnya sudah mengkonfigurasi pintasan kunci yang dijelaskan di atas. </font><font style="vertical-align: inherit;">Pengaturan berikut identik untuk Padavan dan Keenetic OS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instal perangkat lunak tambahan di router:</font></font><br><br><pre> <code class="bash hljs">opkg update opkg install dnscrypt-proxy2</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Buka file konfigurasi dnscrypt-proxy: </font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/dnscrypt-proxy.toml</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Temukan listen_addresses, fallback_resolver, parameter cache dan ubahlah: </font></font><br><br><pre> <code class="bash hljs">listen_addresses = [<span class="hljs-string"><span class="hljs-string">'127.0.0.1:9153'</span></span>] fallback_resolver = <span class="hljs-string"><span class="hljs-string">'77.88.8.8:1253'</span></span> cache = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">77.88.8.8:1253 adalah alamat server DNS Yandex dengan port non-standar. </font><font style="vertical-align: inherit;">Ini adalah cadangan jika dnscrypt-proxy memiliki masalah. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jalankan dnscrypt-proxy:</font></font><br><br><pre> <code class="bash hljs">/opt/etc/init.d/S09dnscrypt-proxy2 start</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pastikan dnscrypt-proxy berfungsi (Anda harus melihat daftar alamat IP sebagai tanggapan): </font></font><br><br><pre> <code class="bash hljs">dig +short google.com @localhost -p 9153</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buka skrip </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/bin/unblock_ipset.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di editor </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ganti konten dengan: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost -p 9153) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost -p 9153 | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami membuat perubahan kecil - saat ini penggalian untuk menyelesaikan tidak menggunakan server DNS biasa, tetapi dnscrypt-proxy dengan port 9153. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buka skrip </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/bin/unblock_dnsmasq.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di editor </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ganti konten dengan: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq echo "server=/$line/127.0.0.1#9153" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami membuat perubahan kecil - sekarang ketika membuat file unblock.dnsmasq, baris tambahan seperti "server = / domain_name / 127.0.0.1 # 9153" ditambahkan. </font><font style="vertical-align: inherit;">Ini berarti bahwa menyelesaikan domain dari daftar akan terjadi melalui dnscrypt-proxy. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jalankan unblock_update.sh:</font></font><br><br><pre> <code class="bash hljs">unblock_update.sh</code> </pre> <br>  Selesai<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semua pengaturan yang rumit ada di belakang. </font><font style="vertical-align: inherit;">Sekarang Anda hanya akan mengedit daftar unblock.txt jika perlu, menambah atau menghapus domain atau alamat IP untuk membuka kunci darinya, dan mengaktifkan perubahan yang dibuat dengan perintah unblock_update.sh. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PEMBARUAN 04/01/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Sering datang pesan pribadi pada artikel dengan pertanyaan-pertanyaan khas. </font><font style="vertical-align: inherit;">Saya akan menjawab di sini yang paling umum. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara menyediakan situs zona domain .onion? </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di torrc tambahkan:</font></font><br><pre> <code class="bash hljs">VirtualAddrNetwork 10.254.0.0/16 DNSPort 127.0.0.1:9053 AutomapHostsOnResolve 1</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Untuk mengakses semua domain zona bawang, tambahkan ke dnsmasq.conf: </font></font><br><pre> <code class="bash hljs">server=/onion/127.0.0.1<span class="hljs-comment"><span class="hljs-comment">#9053 ipset=/onion/unblock</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jika Anda tidak ingin membuka akses ke semua domain dari zona bawang merah, tetapi hanya untuk yang spesifik, maka tambahkan entri berikut di dnsmasq.conf: </font></font><br><pre> <code class="bash hljs">server=/rutorc6mqdinc4cz.onion/127.0.0.1<span class="hljs-comment"><span class="hljs-comment">#9053 ipset=/rutorc6mqdinc4cz.onion/unblock server=/nnmclub5toro7u65.onion/127.0.0.1#9053 ipset=/nnmclub5toro7u65.onion/unblock server=/flibustahezeous3.onion/127.0.0.1#9053 ipset=/flibustahezeous3.onion/unblock</span></span></code> </pre> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana cara memotong kunci untuk klien dari server VPN yang berjalan pada router? </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di torrc, ganti baris dengan TransPort dengan:</font></font><br><pre> <code class="bash hljs">TransPort 0.0.0.0:9141</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tambahkan pengalihan tambahan dengan antarmuka yang diperlukan (INTERFACE - antarmuka jaringan VPN): </font></font><br><pre> <code class="bash hljs">iptables -t nat -A PREROUTING -i  -p tcp -m <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> --match-set unblock dst -j REDIRECT --to-port 9141</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id428992/">https://habr.com/ru/post/id428992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id428982/index.html">Cara menulis D pada ARM</a></li>
<li><a href="../id428984/index.html">Julia dan potret fase sistem dinamis</a></li>
<li><a href="../id428986/index.html">ThinkJava Conference # 8 di Kharkov</a></li>
<li><a href="../id428988/index.html">Tips Alam - Cloudy Night Light</a></li>
<li><a href="../id428990/index.html">Contoh Konfigurasi UIViewControllers Menggunakan RouteComposer</a></li>
<li><a href="../id428994/index.html">Jaringan di Android menggunakan Corutin dan Retrofit</a></li>
<li><a href="../id428996/index.html">Klub Santa Claus anonim 2018-2019 di Habrahabr</a></li>
<li><a href="../id428998/index.html">Cara menggunakan fitur Profiler eksperimental baru di Bereaksi</a></li>
<li><a href="../id429000/index.html">Mengapa Bill Gates menciptakan toilet sebesar $ 233 miliar</a></li>
<li><a href="../id429006/index.html">Cina: ‚Äútoko perakitan dunia‚Äù tidak sesederhana kelihatannya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>