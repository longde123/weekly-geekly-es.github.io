<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∑ üå©Ô∏è üëéüèª Experiencia usando redux sin reductores üéπ üçø üéÖüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Me gustar√≠a compartir mi experiencia de usar redux en una aplicaci√≥n empresarial. Hablando sobre software corporativo como parte del art√≠culo, me cent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Experiencia usando redux sin reductores</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424613/"><img src="https://habrastorage.org/webt/nn/at/cx/nnatcxzguqw8cg7b1nx315f3c8y.jpeg"><br><br>  Me gustar√≠a compartir mi experiencia de usar redux en una aplicaci√≥n empresarial.  Hablando sobre software corporativo como parte del art√≠culo, me centro en las siguientes caracter√≠sticas: <br><br><ul><li>  En primer lugar, este es el volumen de la funcionalidad.  Estos son sistemas que se han desarrollado durante muchos a√±os, que contin√∫an construyendo nuevos m√≥dulos o complicando lo que ya existe all√≠ indefinidamente. </li><li>  En segundo lugar, a menudo, si consideramos no una pantalla de presentaci√≥n, sino el lugar de trabajo de alguien, entonces se puede montar una gran cantidad de componentes adjuntos en una p√°gina. </li><li>  En tercer lugar, la complejidad de la l√≥gica empresarial.  Si queremos obtener una aplicaci√≥n receptiva y agradable de usar, el cliente tendr√° que hacer una parte importante de la l√≥gica. </li></ul><br>  Los primeros dos puntos imponen restricciones en el margen de productividad.  M√°s sobre esto m√°s tarde.  Y ahora, le propongo discutir los problemas que encuentra al usar el cl√°sico flujo de trabajo redux, desarrollando algo m√°s complicado que la lista TODO. <br><a name="habracut"></a><br><h3>  Redux cl√°sico </h3><br>  Por ejemplo, considere la siguiente aplicaci√≥n: <br><br><img src="https://image.ibb.co/ej3Pwp/1.png" alt="imagen"><br><br>  El usuario maneja una rima: obtiene una evaluaci√≥n de su talento.  El control con la introducci√≥n del verso se controla y se vuelve a calcular la evaluaci√≥n para cada cambio.  Tambi√©n hay un bot√≥n por el cual se restablece el texto con el resultado, y se muestra un mensaje al usuario que puede comenzar desde el principio.  C√≥digo fuente en este <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hilo</a> . <br><br>  Organizaci√≥n del c√≥digo: <br><br><img src="https://image.ibb.co/dyXv2U/2.png" alt="imagen"><br><br>  Hay dos m√≥dulos  M√°s precisamente, un m√≥dulo directamente es PoemScoring.  Y la ra√≠z de la aplicaci√≥n con funciones comunes para todo el sistema es la aplicaci√≥n.  All√≠ tenemos informaci√≥n sobre el usuario, mostrando mensajes al usuario.  Cada m√≥dulo tiene sus propios reductores, acciones, controles, etc. A medida que la aplicaci√≥n crece, los nuevos m√≥dulos se multiplican. <br><br>  Una cascada de reductores, utilizando redux-inmutable, forma el siguiente estado totalmente inmutable: <br><br><img src="https://image.ibb.co/nFrYp9/3.png" alt="imagen"><br><br>  C√≥mo funciona <br><br>  1. Despacho de control creador de acci√≥n: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> at <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../constants/actionTypes'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getstate</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: at.POEM_TYPE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: text }); }; }</code> </pre> <br>  Las constantes de los tipos de acci√≥n se mueven a un archivo separado.  En primer lugar, estamos muy a salvo de errores tipogr√°ficos.  En segundo lugar, intellisense estar√° disponible para nosotros. <br><br>  2. Luego se trata del reductor. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logic <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../logic/poem'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemScoringReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = Immutable.Map(</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> at.POEM_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> logic.onType(state, action.payload); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre> <br>  El procesamiento l√≥gico se mueve a una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">funci√≥n de caso</a> separada.  De lo contrario, el c√≥digo reductor se volver√° r√°pidamente ilegible. <br><br>  3. La l√≥gica de procesar clics utilizando an√°lisis l√©xico e inteligencia artificial: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { onType(state, text) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state .set(<span class="hljs-string"><span class="hljs-string">'poemText'</span></span>, text) .set(<span class="hljs-string"><span class="hljs-string">'score'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.calcScore(text)); }, calcScore(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(text.length / <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">5</span></span> : score; } };</code> </pre> <br>  En el caso del bot√≥n "Nuevo poema", tenemos el siguiente creador de acci√≥n: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newPoem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getstate</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: at.POEM_TYPE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }); dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: appAt.SHOW_MESSAGE, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: <span class="hljs-string"><span class="hljs-string">'You can begin a new poem now!'</span></span> }); }; }</code> </pre> <br>  Primero, env√≠e la misma acci√≥n que restablece nuestro texto y puntaje.  Luego, env√≠e la acci√≥n, que ser√° capturada por otro reductor y mostrar√° un mensaje al usuario. <br>  Todo es hermoso  Creemos problemas para nosotros mismos: <br><br><h3>  Los problemas: </h3><br>  Hemos publicado nuestra solicitud.  Pero nuestros usuarios, al ver que se les pidi√≥ que escribieran poes√≠a, naturalmente comenzaron a publicar su trabajo, lo cual es incompatible con los est√°ndares corporativos del lenguaje po√©tico.  En otras palabras, necesitamos moderar las palabras obscenas. <br><br>  Lo que haremos: <br><br><ul><li>  en el texto de entrada, es necesario reemplazar todas las palabras inculturas con <b>* censurado *</b> </li><li>  Adem√°s, si el usuario ha conducido una palabra sucia, debe advertirle con un mensaje de que est√° haciendo mal. </li></ul><br>  Bueno  Solo necesitamos analizar el texto, adem√°s de calcular el puntaje, reemplazar las malas palabras.  No hay problema  Y tambi√©n, para informar al usuario, necesita una lista de lo que hemos eliminado.  El c√≥digo fuente est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  Rehacemos la funci√≥n de l√≥gica para que, adem√°s del nuevo estado, devuelva la informaci√≥n necesaria para el mensaje al usuario (palabras reemplazadas): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { onType(state, text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { reductedText, censoredWords } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redactText(text); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newState = state .set(<span class="hljs-string"><span class="hljs-string">'poemText'</span></span>, reductedText) .set(<span class="hljs-string"><span class="hljs-string">'score'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.calcScore(reductedText)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { newState, censoredWords }; }, calcScore(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(text.length / <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ? <span class="hljs-number"><span class="hljs-number">5</span></span> : score; }, redactText(text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = { <span class="hljs-attr"><span class="hljs-attr">reductedText</span></span>:text }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> censoredWords = []; obscenseWords.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">badWord</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.reductedText.indexOf(badWord) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.reductedText = result.reductedText.replace(badWord, <span class="hljs-string"><span class="hljs-string">'*censored*'</span></span>); censoredWords.push(badWord); } }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (censoredWords.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { result.censoredWords = censoredWords.join(<span class="hljs-string"><span class="hljs-string">' ,'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } };</code> </pre> <br>  Apliquemos ahora.  Pero como?  En el reductor, ya no tiene sentido llamarlo, ya que pondremos el texto y la evaluaci√≥n en el estado, pero ¬øqu√© debemos hacer con el mensaje?  Para enviar un mensaje, en cualquier caso, tendremos que enviar la acci√≥n correspondiente.  Entonces, estamos finalizando action-creator. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> globalState = getState(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> scoringStateOld = globalState.get(<span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        const { newState, censoredWords } = logic.onType(scoringStateOld, text); dispatch({ //        type: at.POEM_TYPE, payload: newState }); if (censoredWords) { //    ,    const userName = globalState.getIn(['app', 'account', 'name']); const message = `${userName}, avoid of using word ${censoredWords}, please!`; dispatch({ type: appAt.SHOW_MESSAGE, payload: message }); } }; }</span></span></code> </pre> <br>  Tambi√©n es necesario modificar el reductor, porque ya no llama a la funci√≥n l√≥gica: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> at.POEM_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.payload; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state;</code> </pre> <br>  Que paso: <br><br><img src="https://image.ibb.co/nkmzU9/4.png" alt="imagen"><br><br>  <b>Y ahora, la pregunta es.</b>  ¬øPor qu√© necesitamos un reductor que, en su mayor parte, simplemente devolver√° la carga √∫til en lugar de un nuevo estado?  Cuando aparezcan otras acciones que procesen la l√≥gica en la acci√≥n, ¬øser√° necesario registrar un nuevo tipo de acci√≥n?  ¬øO tal vez cree un SET_STATE com√∫n?  Probablemente no, porque entonces, el inspector ser√° un desastre.  Entonces, ¬øproduciremos el mismo tipo de caso? <br><br>  La esencia del problema es la siguiente.  Si el procesamiento de la l√≥gica implica trabajar con una pieza de estado, de la cual son responsables varios reductores, entonces debe escribir todo tipo de perversiones.  Por ejemplo, los resultados intermedios de las funciones de caso, que luego deben dispersarse entre diferentes reductores mediante varias acciones. <br><br>  Una situaci√≥n similar, si la funci√≥n de caso necesita m√°s informaci√≥n que la que est√° en su reductor, debe llamar a la acci√≥n, donde hay acceso al estado global, seguido de enviar el nuevo estado como carga √∫til.  Un reductor tendr√° que dividirse en cualquier caso, si hay mucha l√≥gica en el m√≥dulo.  Y esto crea grandes inconvenientes. <br><br>  Veamos la situaci√≥n por un lado.  En nuestra acci√≥n, obtenemos una parte del estado de lo global.  Esto es necesario para <i>mutarlo</i> ( <i>globalState.get ('poemScoring');</i> ).  Resulta que ya sabemos en acci√≥n con qu√© estado est√° trabajando el trabajo.  Tenemos un nuevo estado.  Sabemos d√≥nde ponerlo.  Pero en lugar de ponerlo en uno global, lo ejecutamos con alg√∫n tipo de texto constante en toda la cascada de reductores para que pase por cada caja de interruptor y lo sustituya solo una vez.  Yo de la realizaci√≥n de esto, arrugas.  Entiendo que esto se hace para facilitar el desarrollo y reducir la conectividad.  Pero en nuestro caso, ya no tiene un papel. <br><br>  <b>Ahora, enumerar√© todos los puntos que no me gustan en la implementaci√≥n actual, si tiene que ampliarse en profundidad por un tiempo ilimitado</b> : <br><br><ol><li>  Inconvenientes importantes cuando se trabaja con un estado fuera del reductor. </li><li>  El problema de la separaci√≥n del c√≥digo.  Cada vez que enviamos una acci√≥n, pasa por cada reductor, pasa por cada caso.  Es conveniente no molestarse cuando tiene una aplicaci√≥n peque√±a.  Pero, si tiene un monstruo que se construy√≥ durante varios a√±os con docenas de reductores y cientos de casos, entonces empiezo a pensar en la viabilidad de este enfoque.  Quiz√°s, incluso con miles de casos, esto no tendr√° un impacto significativo en el rendimiento.  Pero, entendiendo que al imprimir texto, cada impresi√≥n causar√° un pasaje a trav√©s de cientos de casos, no puedo dejarlo como est√°.  Cualquiera, el retraso m√°s peque√±o, multiplicado por el infinito, tiende al infinito.  En otras palabras, si no piensa en esas cosas, tarde o temprano, surgir√°n problemas. <br><br>  Cuales son las opciones? <br><br>  <b>a.</b>  Aplicaciones aisladas con sus propios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proveedores</a> .  En cada m√≥dulo (sub-aplicaci√≥n), deber√° duplicar las partes generales del estado (cuenta, mensajes, etc.). <br><br>  <b>b.</b>  Utilice <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reductores asincr√≥nicos</a> conectables.  Esto no es recomendado por el propio Dan. <br><br>  <b>c.</b>  Use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">filtros de acci√≥n</a> en reductores.  Es decir, cada env√≠o debe ir acompa√±ado de informaci√≥n sobre a qu√© m√≥dulo se est√° enviando.  Y en los reductores ra√≠z de los m√≥dulos, escriba las condiciones apropiadas.  Lo he intentado  No hubo tal cantidad de errores involuntarios ni antes ni despu√©s.  Hay una confusi√≥n constante sobre d√≥nde va la acci√≥n. </li><li>  Cada vez que se env√≠a una acci√≥n, no solo hay una ejecuci√≥n para cada reductor, sino tambi√©n la recopilaci√≥n del estado inverso.  No importa si el estado ha cambiado en el reductor, se reemplazar√° en combineReducers. </li><li>  Cada env√≠o obliga a mapStateToProps a procesarse para cada componente adjunto que se monta en la p√°gina.  Si dividimos los reductores, tenemos que dividir los despachos.  ¬øEs cr√≠tico que tengamos un bot√≥n que sobrescriba el texto y muestre el mensaje con diferentes despachos?  Probablemente no.  Pero tengo experiencia en optimizaci√≥n, al reducir la cantidad de despachos de 15 a 3 permitieron aumentar significativamente la capacidad de respuesta del sistema, con la misma cantidad de l√≥gica comercial procesada.  S√© que hay bibliotecas que pueden combinar varios despachos en un lote, pero esta es una lucha con la investigaci√≥n usando muletas. </li><li>  Al aplastar despachos, a veces es muy dif√≠cil ver lo que est√° sucediendo.  No hay un solo lugar, todo est√° disperso en diferentes archivos.  Es necesario buscar d√≥nde se implementa el procesamiento buscando constantes en todos los c√≥digos fuente. </li><li>  En el c√≥digo anterior, los componentes y las acciones acceden directamente al estado global: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> userName = globalState.getIn([<span class="hljs-string"><span class="hljs-string">'app'</span></span>, <span class="hljs-string"><span class="hljs-string">'account'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>]); ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = state.getIn([<span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span>, <span class="hljs-string"><span class="hljs-string">'poemText'</span></span>]);</code> </pre> <br>  Esto no es bueno por varias razones: <br><br>  <b>a.</b>  Los m√≥dulos deber√≠an estar aislados idealmente.  No necesitan saber en qu√© parte del estado viven. <br><br>  <b>b.</b>  Mencionar los mismos caminos en diferentes lugares a menudo est√° lleno no solo de errores / errores tipogr√°ficos, sino que tambi√©n hace que la refactorizaci√≥n sea extremadamente dif√≠cil en caso de cambiar la configuraci√≥n del estado global o cambiar la forma en que se almacena. <br></li><li>  Cada vez m√°s, mientras escrib√≠a una nueva acci√≥n, tuve la impresi√≥n de que estaba escribiendo c√≥digo por el bien del c√≥digo.  Supongamos que queremos agregar una casilla de verificaci√≥n a la p√°gina y reflejar su estado booleano en la historia.  Si queremos una organizaci√≥n uniforme de acci√≥n / reductores, entonces tenemos que: <br><br>  - Registro constante de tipo acci√≥n <br>  - Escribe un cr√°ter de acci√≥n <br>  - En el control, imp√≥rtalo y reg√≠stralo en mapDispatchToProps <br>  - Registrarse en PropTypes <br>  - Cree un handleCheckBoxClick en el control y especif√≠quelo en la casilla de verificaci√≥n <br>  - Agregue un interruptor en el reductor con una llamada de funci√≥n de caso <br>  - Escribir una funci√≥n de caso en la l√≥gica <br><br>  Por el bien de un cheque de boxeo! </li><li>  El estado que se genera con combineReducers es est√°tico.  No importa si ya ingres√≥ al m√≥dulo B o no, esta pieza estar√° en la historia.  Vac√≠o, pero lo estar√°.  No es conveniente utilizar el inspector cuando hay muchos nodos vac√≠os no utilizados en el steet. </li></ol><br><h3>  C√≥mo intentamos resolver algunos de los problemas descritos anteriormente </h3><br>  Entonces, obtuvimos reductores est√∫pidos, y en los cr√°teres de acci√≥n / l√≥gica escribimos pedazos de c√≥digo para trabajar con estructuras inmutables profundamente incrustadas.  Para deshacerme de esto, utilizo el mecanismo de selectores jer√°rquicos, que permiten no solo acceder al estado deseado, sino tambi√©n reemplazarlo (conveniente setIn).  Publiqu√© esto en el paquete <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">inmutable-selectors</a> . <br><br>  <b>Veamos nuestro ejemplo de c√≥mo funciona</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio</a> ): <br>  En el m√≥dulo poemScoring, describimos el objeto de selecci√≥n.  Describimos aquellos campos del estado al que queremos tener acceso directo de lectura / escritura.  Se permite cualquier anidaci√≥n y par√°metros para acceder a los elementos de las colecciones.  No es necesario describir todos los campos posibles en nuestro art√≠culo. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> extendSelectors <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable-selectors'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> selectors = { <span class="hljs-attr"><span class="hljs-attr">poemText</span></span>:{}, <span class="hljs-attr"><span class="hljs-attr">score</span></span>:{} }; extendSelectors(selectors, [ <span class="hljs-string"><span class="hljs-string">'poemScoring'</span></span> ]); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> selectors;</code> </pre> <br>  Adem√°s, el m√©todo extendSelectors convierte cada campo de nuestro objeto en una funci√≥n de selector.  El segundo par√°metro indica la ruta a la parte del estado que controla el selector.  No creamos un nuevo objeto, sino que cambiamos el actual.  Esto nos da una bonificaci√≥n en forma de inteligencia de trabajo: <br><br><img src="https://image.ibb.co/iYdDp9/5.png" alt="imagen"><br><br>  ¬øCu√°l es nuestro objeto? Un selector despu√©s de su expansi√≥n: <br><br><img src="https://image.ibb.co/iAGcGp/5_5.png" alt="imagen"><br><br>  La funci√≥n <i>selectors.poemText (estado)</i> simplemente ejecuta <i>state.getIn (['poemScoring', 'poemText'])</i> . <br><br>  Funci√≥n <i>root (estado)</i> : obtiene 'poemScoring'. <br><br>  Cada selector tiene su propia funci√≥n de <i>reemplazo (globalState, newPart)</i> , que a trav√©s de setIn devuelve un nuevo estado global con la parte correspondiente reemplazada. <br><br>  Adem√°s, se agrega un objeto <i>plano</i> al que se duplican todas las teclas selectoras √∫nicas.  Es decir, si usamos un estado profundo de la forma <br><br><pre> <code class="javascript hljs">selectors = { <span class="hljs-attr"><span class="hljs-attr">dive</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">in</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">to</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">the</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">deep</span></span>:{} } } } }}</code> </pre> <br>  Puede profundizar como <i>selectors.dive.in.to.the.deep (estado)</i> o como <i>selectors.flat.deep (estado)</i> . <br><br>  Adelante  Necesitamos actualizar la adquisici√≥n de datos en los controles: <br><br>  Poema: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, ownprops</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">text</span></span>:selectors.poemText(state) || <span class="hljs-string"><span class="hljs-string">''</span></span> }; }</code> </pre> <br><br>  Puntuaci√≥n: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, ownprops</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> score = selectors.score(state); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { score }; }</code> </pre> <br>  A continuaci√≥n, cambie el reductor de ra√≠z: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> initialState <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./initialState'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setStateReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.setState) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.setState; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; <span class="hljs-comment"><span class="hljs-comment">// return combinedReducers(state, action); // } } export default setStateReducer;</span></span></code> </pre> <br>  Si lo desea, podemos combinarlo con combineReducers. <br><br>  Cr√°ter de acci√≥n, por ejemplo, poemTextChange: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poemTextChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) </span></span>{ dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'Poem typing'</span></span>, <span class="hljs-attr"><span class="hljs-attr">setState</span></span>: logic.onType(getState(), text), <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: text }); }; }</code> </pre> <br>  Ya no podemos usar constantes de tipo acci√≥n, porque el tipo ahora se usa solo para visualizaci√≥n en el inspector.  Nosotros en el proyecto escribimos descripciones de texto completo de la acci√≥n en ruso.  Tambi√©n puede deshacerse de la carga √∫til, pero trato de guardarla para que en el inspector, si es necesario, entiendo con qu√© par√°metros se llam√≥ la acci√≥n. <br><br>  Y, de hecho, la l√≥gica misma: <br><br><pre> <code class="javascript hljs"> onType(gState, text) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { reductedText, censoredWords } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redactText(text); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> poemState = selectors.root(gState) || Immutable.Map(); <span class="hljs-comment"><span class="hljs-comment">//     const newPoemState = poemState //  .set('poemText', reductedText) .set('score', this.calcScore(reductedText)); let newGState = selectors.root.replace(gState, newPoemState); //    if (censoredWords) { //  ,    const userName = appSelectors.flat.userName(gState); const messageText = `${userName}, avoid of using word ${censoredWords}, please!`; newGState = message.showMessage(newGState, messageText); } return newGState; },</span></span></code> </pre> <br>  Al mismo tiempo, <i>message.showMessage se</i> importa desde la l√≥gica del m√≥dulo vecino, que describe sus selectores: <br><br><pre> <code class="javascript hljs"> showMessage(gState, text) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> selectors.message.text.replace(gState, text); }.</code> </pre> <br>  Lo que resulta: <br><br><img src="https://image.ibb.co/hviDp9/6.png" alt="imagen"><br><br>  Tenga en cuenta que tuvimos un env√≠o, los datos en dos m√≥dulos cambiaron. <br>  Todo esto nos permiti√≥ deshacernos de los reductores y las constantes de acci√≥n, as√≠ como resolver o sortear la mayor√≠a de los cuellos de botella descritos anteriormente. <br><br><h4>  ¬øDe qu√© otra manera se puede aplicar esto? </h4><br>  Este enfoque es conveniente de usar cuando es necesario asegurarse de que sus controles o m√≥dulos proporcionen trabajo con diferentes partes del estado.  Digamos que un poema no es suficiente para nosotros.  Queremos que el usuario pueda componer poemas en dos pesta√±as diferentes en diferentes disciplinas (infantil, rom√°ntica).  En este caso, no podemos importar los selectores en la l√≥gica / controles, sino especificarlos como un par√°metro en el control externo: <br><br><pre> <code class="javascript hljs"> &lt;Poem selectors = {selectors.hildPoem}/&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Poem</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">selectors</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{selectors.romanticPoem}/</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Y, adem√°s, pase este par√°metro a los cr√°teres de acci√≥n.  Esto es suficiente para hacer una combinaci√≥n compleja de componentes y l√≥gica completamente cerrada, lo que facilita su reutilizaci√≥n. <br><br>  <b>Limitaciones cuando se usan selectores inmutables:</b> <br><br>  No funcionar√° usar la clave en el estado "nombre", porque para la funci√≥n principal se intentar√° anular la propiedad reservada. <br><br><h3>  Cual es el resultado </h3><br>  Como resultado, se obtuvo un enfoque bastante flexible, se eliminaron las relaciones impl√≠citas de c√≥digo mediante constantes de texto, se redujo la sobrecarga mientras se manten√≠a la conveniencia del desarrollo.  Tambi√©n hay un inspector redux en pleno funcionamiento con la posibilidad de viajar en el tiempo.  No deseo volver a los reductores est√°ndar. <br><br>  En general, eso es todo.  Gracias por su tiempo  ¬°Quiz√°s alguien est√© interesado en probarlo! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es424613/">https://habr.com/ru/post/es424613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es424603/index.html">El libro "¬øPor qu√© nos equivocamos? Trampas de pensamiento en acci√≥n ". Extractos Parte 1</a></li>
<li><a href="../es424605/index.html">Fondos de Zuckerberg: colaboraci√≥n + tecnolog√≠a + ciencia abierta</a></li>
<li><a href="../es424607/index.html">El ascenso de Helidon</a></li>
<li><a href="../es424609/index.html">C√≥mo extender Kubernetes</a></li>
<li><a href="../es424611/index.html">C√≥mo crear un empleado de un profesional independiente</a></li>
<li><a href="../es424615/index.html">Salida de funci√≥n de curva para limitar sin problemas par√°metros, se√±ales y no solo en Wolfram Mathematica</a></li>
<li><a href="../es424621/index.html">Superh√©roes no cinematogr√°ficos. ¬øQui√©n y c√≥mo protege el sitio de construcci√≥n del Centro Lakhta de los incendios?</a></li>
<li><a href="../es424623/index.html">Procesemos el sonido en Go</a></li>
<li><a href="../es424625/index.html">Fuga del c√≥digo fuente de Aeroflot Web Services</a></li>
<li><a href="../es424627/index.html">Alteraci√≥n de cajas registradoras. Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>