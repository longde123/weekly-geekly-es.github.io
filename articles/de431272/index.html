<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍⚖️ 🌋 👨🏼‍💻 Die optimale Temperatur im Haus oder wie man einen Thermostat drahtlos im Hinterzimmer installiert 🥕 🙍🏾 🤱🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Für viele ist es kein Geheimnis, dass Geräte wie wöchentliche Thermostate dazu beitragen, eine optimale Raumtemperatur in einem Haus zu gewährleisten ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die optimale Temperatur im Haus oder wie man einen Thermostat drahtlos im Hinterzimmer installiert</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431272/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ad/gn/6s/adgn6si6fr0kfmywagyjs1h9_nq.png"></div><br>  Für viele ist es kein Geheimnis, dass Geräte wie wöchentliche Thermostate dazu beitragen, eine optimale Raumtemperatur in einem Haus zu gewährleisten und Energie für die Heizung zu sparen.  Für den korrekten Betrieb des Geräts wird es normalerweise in den am weitesten entfernten Raum gestellt, in dem die niedrigste Temperatur herrscht.  Die meisten Thermostate erfordern jedoch eine Kabelverbindung zum Kessel zur Steuerung, und es ist bei weitem nicht immer möglich, diese Kabel zu verlegen.  Eine Lösung für dieses Problem wird in diesem Artikel erläutert.  Jeder, der nach einer Katze fragen möchte ... <br><a name="habracut"></a><br>  Ich musste mich einer ähnlichen Aufgabe stellen.  Der Bau meines Hauses ist ziemlich langwierig und der Thermostat wurde korrekt installiert. Ich musste mehr als 50 m Kabel durch die Räume ziehen, wobei die Reparaturen bereits durchgeführt wurden. Die Alternative lag auf der Fassade, aber ich habe sie sofort verworfen.  Außerdem war es problematisch, ein Kabel von der Straße zum Kessel zu bringen, und ich wollte den Blick auf die Fassade nicht mit einem anderen Draht verderben, ohne dass es genug Extra gab.  Der Kessel selbst wurde in der Küche installiert und es war eine schlechte Idee, den Thermostat neben dem Wasserhahn zu platzieren.  Infolgedessen kam ich zu dem Schluss, dass der Thermostat noch in den hinteren Raum bewegt werden muss und das Signal über die Luft übertragen werden sollte.  Der Prozess der Entwicklung meines nächsten Handwerks begann wie üblich mit der Erklärung des Problems.  Also fangen wir an ... <br><br><h3>  TK </h3><br>  Definieren Sie die Anforderungen an das Gerät, um das Problem zu lösen. <br><ul><li>  Das Design der Geräte sollte klein sein und in einem ästhetischen Gehäuse in Weiß oder Schwarz platziert werden. </li><li>  Das Empfänger- und Sendemodul muss mit einem Paar AA-Batterien betrieben werden. </li><li>  Die Lebensdauer der Module aus einem Batteriesatz sollte mindestens ein Jahr betragen. </li><li>  Der Anschluss an Thermostat und Gaskessel muss über Standardschnittstellen erfolgen, ohne dass Konstruktionsänderungen vorgenommen werden müssen. </li><li>  Geräte müssen auf einer erschwinglichen Hardwarebasis von lokalen Lieferanten zusammengebaut werden. </li></ul><br><br><h3>  Hardware </h3><br>  Wenn wir uns für die grundlegenden Anforderungen entschieden haben, fahren wir mit dem Design fort.  Beginnen wir mit der Hardware. <br>  Basierend auf den technischen Spezifikationen sind die grundlegenden Anforderungen an die Elementbasis: die Fähigkeit, im Spannungsbereich von 1,8 bis 3 Volt zu arbeiten.  Sowie die Möglichkeit, in den Ruhemodus zu wechseln oder die Peripherie auszuschalten, wenn sie nicht benötigt wird.  Ich beschloss, meinen Auswahlpfad mit der Auswahl eines Transceivers zu beginnen.  Ich habe die einfachsten Lösungen in Form der Module MX-FS-03V und MX-05V in Betracht gezogen. Der Preis ist sicherlich sehr attraktiv, aber die Qualität der Bewertungen ist schrecklich und die Kommunikationsreichweite nicht so hoch.  Und in meinem Fall war es notwendig, ein Signal durch 4 Wände zu senden.  Außerdem beabsichtigte er ursprünglich, eine Bestätigung des Versands vorzunehmen, sodass die Verbindung in beide Richtungen benötigt wurde, was zwei Sätze erfordern würde.  LoRa-Module und verschiedene Module der HC-Serie wurden ebenfalls berücksichtigt.  Das Sortiment war noch auf das beschränkt, was vor Ort verkauft wird.  Nachdem ich alle verfügbaren Optionen geprüft hatte, entschied ich mich für fertige SI4432-Module.  In Bezug auf das Preis-Leistungs-Verhältnis waren sie meiner Meinung nach die besten. <br>  Dieses Modul verfügt über umfangreiche technische Funktionen und ist bei korrekt ausgewählten Einstellungen auch sehr wirtschaftlich.  Die Möglichkeit, die Ausgangsleistung zu steuern, ist ebenfalls sehr nützlich, da  Sie können die beste auswählen und so den Batterieverbrauch senken.  Hier ist eine Tabelle mit Spezifikationen aus der Dokumentation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yl/fz/ty/ylfztyrtiksrge8ealkwocx2kca.png"></div><br>  Lassen Sie uns die Indikatoren des Energieverbrauchs in verschiedenen Modi aus der Tabelle genauer betrachten.  Wir werden diese Daten später benötigen, um die Akkulaufzeit der Geräte zu berechnen. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/eb/ur/jbeburjt5z686syc-ihxve3-u-c.png"></div><br>  In unserem Fall ist es bereits akzeptabel, den Ruhemodus zu verwenden, ganz zu schweigen von der vollständigen Abschaltung durch die Abschaltfunktion. <br>  Ursprünglich sollte ich ATMega 8 als Zentralprozessor verwenden, aber nachdem ich die Dokumentation genauer studiert hatte, stellte ich fest, dass sie nicht in meinen Versorgungsspannungsbereich fiel.  Aus diesem Grund habe ich mich für ATMega 328P entschieden  Sie hat alle meine Anforderungen erfüllt.  Mit Blick auf die Zukunft werde ich sagen, dass die Tatsache, dass ich einen fertigen Bootloader für sie gefunden habe, aber dazu später mehr, auch zu ihren Gunsten gespielt hat. <br>  Betrachten Sie den Controller im Hinblick auf Stromverbrauch und Kerntaktung genauer. <br>  Lassen Sie uns zuerst das Timing behandeln.  Weil  Wir haben einen Arbeitsspannungsbereich von bis zu 3 Volt, dann ist auch die Auswahl eines Quarzresonators begrenzt, und die folgende Grafik sagt uns darüber <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7o/1d/pj/7o1dpjppnnpuc67ozj9baher7gw.png"></div><br>  Wie wir bei 8 MHz sehen, können wir keinen stabilen Betrieb erzielen, daher werden wir Quarz bei 4 MHz verwenden. <br>  Betrachten wir nun den Stromverbrauch in verschiedenen Betriebsarten.  Hier ist eine Tabelle aus der Dokumentation, die die Stromverbrauchseigenschaften beschreibt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/py/1y/pj/py1ypjle8u-jprje_ciw1iosjou.png"></div><br>  Wenn Sie also den Controller in den Power-Down-Modus versetzen, sinkt der Verbrauch des Mikrocontrollers selbst natürlich mit bestimmten Vorbehalten auf 44 uA. <br>  Zusätzlich zu den bereits ausgewählten Elementen fügen wir eine rote LED mit einem Arbeitsstrom von 1 mA hinzu. <br>  Damit sind die gemeinsamen Komponenten für Empfänger und Sender vervollständigt. <br>  Berücksichtigen Sie die zusätzlichen Komponenten für den Empfänger. <br>  Am Ausgang eines herkömmlichen Raumthermostats befindet sich ein Relaiskontakt mit guter Schaltfähigkeit (250 V 5 A), sodass es keine Rolle spielt, was er steuert. Daher sollte unser Empfänger gemäß den Bestimmungen den gleichen Relaisausgang haben.  Aber wie kann ein geringer Stromverbrauch des Relais im Ein-Modus sichergestellt werden, da die Spule selbst des kleinsten Relais mehrere zehn Milliampere verbraucht und der Werksthermostat mindestens 2 Heizperioden lang ohne Übertreibung mit einem Satz normaler Batterien arbeitet?  Ich habe ein paar Tage über diese Aufgabe nachgedacht, und plötzlich, während der Reparatur eines der Geräte, die mir dämmerten, steht nur noch ein bistabiles Relais.  Und warum während der Reparatur, aber weil sie in dem zu reparierenden Gerät verwendet werden.  Dieser Relaistyp kann seinen Zustand unendlich lange ohne Energieverbrauch beibehalten.  Damit das Relais seinen Zustand ändert, reicht es aus, bei zwei Wicklungsrelais einen Impuls an die erforderliche Spule anzulegen oder bei einem Relais mit einer Wicklung einen Impuls in umgekehrter Polarität.  Daher haben wir uns für den Relaistyp entschieden, aber was tun mit einem bestimmten Modell?  Nachdem ich ein wenig im Internet gesucht hatte, kam ich zu dem Schluss, dass es ein Problem für mich sein würde, ein Niederspannungsrelais zu bekommen. Ich musste mich mit meinem 24-V-Relais Takamisawa ALD24W-K befassen.  Diese Lösung warf jedoch ein neues Problem auf - woher kommen 24 V? <br>  Die Antwort wurde schnell gefunden, vielleicht ist sie nicht die richtigste, aber immer noch.  Ich habe beschlossen, einen Aufwärtswandler zu installieren und die Spannung auf 20 V zu erhöhen. Dies reicht für eine zuverlässige Relaisumschaltung völlig aus.  Der Konverter stammt von einem ziemlich verbreiteten Modul, das auf MT3608 basiert.  Dies ist eine funktionierende Lösung, die ich mehr als einmal getestet habe, einschließlich des Designs eines elektrischen Schraubendrehers (darüber können Sie hier auf Habré lesen).  Über den EN-Ausgang können Sie den Betrieb des Konverters steuern, wodurch der Stromverbrauch erheblich reduziert wird.  Eigentlich sind hier die Daten aus der Dokumentation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ag/jm/gy/agjmgyo9j9iowc2a2cqnlyzivbi.png"></div><br>  Nachdem ich alle erhaltenen Informationen zusammengetragen hatte, zeichnete ich Diagramme beider Geräte: <br>  Sender <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wm/sj/rr/wmsjrre0rwczx3qnq7jzqeum7co.png"></div><br>  Empfänger <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sp/fr/mf/spfrmflw92ubxja9893shieqpwy.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wx/0v/on/wx0vonbxdcyls8xmnb0p763le2a.png"></div><br>  Nachdem wir mit der Hardware des Projekts fertig sind, gehen wir zu den Algorithmen und ihrer Software-Implementierung über. <br><br><h3>  Algorithmus </h3><br>  Beginnen wir mit der Entwicklung eines gemeinsamen Arbeitskonzepts und Algorithmus für unsere Geräte.  Die folgende Abbildung zeigt ein allgemeines Sequenzdiagramm für alle am Prozess beteiligten Geräte. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_n/rg/8d/_nrg8dd4kqpt8tm19zqqgt2hgko.png"></div><br>  Wie Sie sehen, ist der Algorithmus nicht kompliziert, ich werde eine narrative Präsentation machen (nun, ich bin zu faul, um ein Flussdiagramm zu zeichnen, entschuldigen Sie mich).  Beginnen wir mit dem Sender als  es ist aus Sicht des Algorithmus das einfachste.  Der Sender-Mikrocontroller führt die folgende Sequenz aus: <br>  - Überprüft den Ladezustand der Batterien. Wenn die Ladung niedrig ist, wird die Entladung durch die eingebaute LED angezeigt. <br>  - Fragt den Eingabestatus ab. <br>  - Überträgt diesen Zustand über Funk. <br>  - Versetzt den Sender in den Schlafmodus und schläft 1 Minute lang ein. <br>  - Der Zyklus wiederholt sich von Anfang an. <br><br>  Mit dem Empfänger sind die Dinge etwas komplizierter.  Der Mikrocontroller arbeitet nach folgendem Algorithmus: <br>  - Überprüft den Ladezustand der Batterien. Wenn die Ladung niedrig ist, wird die Entladung durch die eingebaute LED angezeigt. <br>  - Wir warten auf das Paket vom Sender. Wenn das Signal innerhalb von 2 Minuten nicht empfangen wurde, schlafen wir 59 Sekunden lang ein. Danach beginnt der Zyklus von vorne. <br>  - Wenn ein Paket ankommt, erhalten wir einen neuen Relay-Status. <br>  - Wenn der neue Zustand des Relais vom zuvor gespeicherten abweicht, schalten Sie den Aufwärtswandler ein und schalten Sie das Relais in den gewünschten Zustand. <br>  - 59 Sekunden lang einschlafen <br>  - Wiederholen Sie zuerst den Zyklus <br>  Wenn Sie den Empfänger zum ersten Mal einschalten, wartet er auf ein Signal vom Sender. Sobald er es empfängt, ändert sich der Status des Relais und er schläft 1 Sekunde weniger ein als der Sender.  Infolgedessen ist der Empfänger zum Zeitpunkt eines neuen Sendens bereits in Betrieb und wartet auf ein neues Senden, d.h.  Es ist, als würde es von einem Sender synchronisiert.  Dadurch konnte der Energieverbrauch gut eingespart werden.  Wenn das Signal vom Sender nicht empfangen wird, warten wir maximal 2 Minuten. Ein solches Intervall wird gewählt, um sicherzustellen, dass das Signal unabhängig von der Zeit, zu der der Sender eingeschaltet wird, abgefangen wird.  Es ist jedoch äußerst unwirtschaftlich und dient ausschließlich zur Synchronisierung von Geräten. <br><br><h3>  Lebenszeit </h3><br>  Wenn mit dem Algorithmus klar wurde, versuchen wir, die Batterielebensdauer zu berechnen. <br>  Wenden wir uns ein wenig der Theorie zu, die erforderlich ist, um genaue Zahlen bei der Berechnung der Betriebszeit von Sensoren aus einem Satz Batterien zu erhalten. <br>  Zuerst schauen wir uns an, wann und für welche Energie verbraucht wird. <br>  Betrachten Sie den Sendevorgang genauer. <br>  Um den Status des Relais zu übertragen, müssen wir ein Paket bilden und es in der Luft senden.  Im Allgemeinen ist die Struktur eines solchen Pakets wie folgt: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mm/lc/rs/mmlcrsv4rdwkusd31uc1riy2mli.png"></div><br>  Ich habe die Standard-Senderparameter verwendet, d.h.  FSK, kein Manchester, Rb = 2,4 kbs, Fd = 36 kHz.  Die im Paket übertragene Datenmenge beträgt 3 Bytes.  Die Präambel hat eine Größe von 40 Bit aus der Tabelle: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q_/0n/dx/q_0ndxy2vopxc8r3ejrdw_mrap8.png"></div><br>  Um nicht in den Dschungel der Modulkonfiguration und des Bibliotheksbetriebs einzutauchen, akzeptieren wir die verbleibenden Parameter als maximal zulässig.  Als Ergebnis erhalten wir die Gesamtpaketgröße von 5 Bytes + 4 Bytes + 4 Bytes + 1 Bytes + 3 Bytes + 2 Bytes = 19 Bytes, d.h.  152 Bit.  Bei einer Geschwindigkeit von 2400 Bit / s beträgt die Übertragungszeit ungefähr 64 ms. <br>  Wir wenden uns der Tabelle des Energieverbrauchs des Moduls am Anfang des Artikels zu und nehmen daraus den Wert des Stroms während der Übertragung mit einer Ausgangsleistung von 13 dBm.  Somit verbraucht das Modul beim Senden von Daten 30 mA. <br>  Im Empfangsmodus verbraucht das Modul basierend auf derselben Tabelle statisch 18,5 mA. <br>  Ich konnte das Modul immer noch nicht in den Shutdown-Modus übersetzen, aus irgendeinem Grund konnte ich es nicht aus dem Koma entfernen. Daher beschränkte ich mich auf den Ruhemodus, in dem das Modul 1 uA verbraucht. <br>  Während ich das Paket empfange und sende, schalte ich die rote LED, die über einen 1 kΩ-Widerstand angeschlossen ist, auf 3,3 Volt ein. Sie verbraucht ungefähr 1 mA. <br>  Der Mikrocontroller im Wake-Modus verbraucht 2,4 mA und im Sleep-Modus bei eingeschaltetem WDT - 44 uA.  Daten aus der obigen Tabelle erhalten. <br>  Der Empfänger hat auch einen parasitären Stromverlust, wenn der Thermostat über einen Pull-up-Widerstand gegen Masse geschlossen wird (siehe Senderdiagramm), sodass 3,3 V / 10 kOhm = 33 uA durch ihn fließen.  Es schien mir eine große Menge zu sein, also habe ich in der Schaltung den Widerstandswert auf 100 kOhm geändert, aber im Eisen ist es immer noch mit 10 kOhm zusammengebaut, also werden wir es so nehmen, wie es ist. <br>  Der Empfänger hat mehr Verbraucher.  Erstens ist es ein 20-Volt-Aufwärtswandler.  Im Schlafmodus verbraucht es 1 uA.  Im Leerlauf beträgt der Verbrauch 2,2 mA, im Programm warte ich auf 100 ms, um den Wandler zu starten.  Die Relaisspule wirkt für uns als Last, ihre Charakteristik ist unten angegeben: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hy/tg/h6/hytgh6qhze5izs8qrkojy7mmcig.png"></div><br>  Somit stellt sich heraus, dass die Spule, wenn sie mit 20 Volt betrieben wird, 20 V / 1920 Ohm = 11 mA verbraucht.  Nun wenden wir uns dem Diagramm der Abhängigkeit des Wirkungsgrads vom Stromverbrauch durch die Last zu, um den Gesamtverbrauch des Wandlers mit einer angeschlossenen Relaisspule zu bewerten. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zd/wo/b8/zdwob8xv2awfkss3igwqsta8bfw.png"></div><br>  Wie Sie sehen können, spiegelt das Diagramm bei einem solchen Verbrauch nicht die Effizienz wider, sondern nimmt an, dass es sich auch linear nach unten bewegt, und im schlimmsten Fall beträgt die Effizienz ungefähr 85%.  Infolgedessen beträgt die Stromaufnahme 11 mA / 0,85 = 13 mA.  Es ist zu beachten, dass der Spitzenstrom beim Start des Wandlers tatsächlich mindestens 1A beträgt und die Betriebs- und Startvorgänge komplex sind. Ich bin nicht die Person, die sie korrekt angeben kann, daher werde ich sie vermissen und den Vorgang ein wenig vereinfachen. <br>  Die vom Schaltrelais erzeugte Impulszeit beträgt 20 ms. <br>  Nachdem wir herausgefunden haben, wer wie viel Energie verbraucht, berechnen wir die theoretische Lebensdauer von AA-Batterien.  Betrachten Sie auch hier den Empfänger und den Sender getrennt. <br>  Beginnen wir wie immer mit dem Sender.  Nehmen wir als Grundlage den oben angegebenen Arbeitsalgorithmus.  Die Weckzeit des Controllers ist etwas länger als die Übertragungszeit. Unter Berücksichtigung der Kosten für das Einrichten des Moduls, das Abrufen des Eingangs und das Messen der Batteriespannung beträgt die ms 70 ms. Anschließend wird der Controller für eine Minute in den Ruhemodus versetzt.  Somit verbraucht die Steuerung in einem Betriebszyklus 0,07 s * (30 mA Sender + 1 mA LED + 2,4 mA MK) + 60 s * (44 uA MK + 1 uA Sender + 33 uA Eingangswiderstand) = 2,338 mA * s + 4,68 mA * s = 7,018 mA * s.  Wenn wir den erhaltenen Wert durch 60,07 s teilen, erhalten wir den durchschnittlichen Stromwert für eine Sekunde - 0,117 mA.  Die durchschnittliche Kapazität einer AA-Batterie beträgt 2800 mA * h (bei Reihenschaltung erhöht sich die Gesamtkapazität der Batterien nicht, wenn plötzlich jemand nichts davon weiß) - dies sind 2800 * 3600 = 10080000 mA * s.  Infolgedessen beträgt die theoretische Betriebszeit des Senders mit einem Batteriesatz 10080000 mA * s / 0,117 mA / 3600 s / 24 h = 997 Tage. <br><br>  Nun zum Empfänger.  Wir werden auch den oben beschriebenen Betriebsalgorithmus zugrunde legen, aber mit einer Einschränkung haben wir sowohl den Empfänger als auch den Sender fast gleichzeitig eingeschaltet und daher den Empfänger sofort mit dem Sender synchronisiert. <br>  Die maximale Weckzeit des Controllers ist die Summe der Paketwartezeit (der Empfang wird ebenfalls eingegeben, da der Interrupt durch das Modul erst generiert wird, nachdem das Paket vollständig empfangen wurde), das Entfernen aus dem Modul, Starten des Konverters und Einstellen eines neuen Relaisstatus Batteriespannung.  Nachdem wir alle Daten zusammengefasst haben, erhalten wir - 1,126 s, dann wird der Controller für 59 Sekunden in den Ruhemodus versetzt.  Aber seitdem  Da der Arbeitszyklus komplizierter ist als beim Empfänger, besteht die Berechnung aus mehr Zuständen.  Für einen Betriebszyklus verbraucht die Steuerung 1,006 s * (18,5 mA Empfänger + 2,4 mA MK) + 0,1 * (0,1 s * (18,5 mA Empfänger + 1 mA LED + 2,4 mA MK + 2,2 mA Wandler an XX) + 0,02 s * (18,5) mA-Empfänger + 1 mA LED + 2,4 mA MK + 13 mA Wandler)) + 59 s * (44 uA MK + 1 uA Empfänger + 1 uA Wandler) = 21,0254 mA + 0,1 * (2,41 mA + 0,698 mA) + 2,714 mA = 24.0502 mA * s.  Der Koeffizient 0,1 spiegelt die Tatsache wider, dass wir in nur einem von 10 Zyklen das Relais schalten.  Wenn wir den erhaltenen Wert durch 60,126 s teilen, erhalten wir den durchschnittlichen Stromwert für eine Sekunde - 0,4 mA.  Wir werden die Akkulaufzeit berechnen.  Infolgedessen beträgt die theoretische Betriebszeit des Empfängers mit einem Batteriesatz 10080000 mA * s / 0,4 mA / 3600 s / 24 h = 291 Tage, vorausgesetzt, wir ändern den Zustand des Relais alle 10 Minuten. <br>  Es ist offensichtlich, dass bei diesen Berechnungen aufgrund der chemischen Eigenschaften des Batteriegeräts nicht immer alle Zeiten für mehr als zwei Jahre realisiert werden.  AA-Batterien können bei konstanter Stromversorgung des Geräts auch bei vernachlässigbarem Strom nicht länger als zwei Jahre arbeiten, obwohl die Kapazität ausreichen sollte.  Aber alles, was weniger als zwei Jahre alt ist, wird bereits zu einer Kapazitätsbeschränkung.  Leider stimmen die Ergebnisse der Berechnung für die Lebensdauer des Empfängers nicht vollständig mit den technischen Spezifikationen überein, aber in dieser Situation habe ich mir ein Zugeständnis gemacht. <br><br><h3>  Code-Implementierung </h3><br>  Ehrlich gesagt bin ich skeptisch gegenüber Arduino und seinen ähnlichen IDEs.  Ich begann zu verstehen, wie man Mikrocontroller in C programmiert, und die Arbeit mit Registern ist für mich verständlicher und vorhersehbarer als verschleierte Aufrufe von Funktionen auf hoher Ebene.  Obwohl ich im Allgemeinen die Plattform selbst und einige kleine Projekte studiert habe, mache ich es immer noch.  Diesmal herrschte also auch Faulheit über mich.  Ich wurde durch die Verfügbarkeit einer vorgefertigten Bibliothek für SI4432-Module für Arduino bestochen und wollte nicht wirklich Zeit damit verschwenden, sie auf CVAVR zu portieren.  Und der Rest des Codes ist extrem einfach.  Nachdem sie mehrere Abende damit verbracht hatten, die Bibliotheken für die Arbeit mit dem Modul sowie den Ruhemodus des Mikrocontrollers zu studieren, waren die ersten Versionen der Empfänger- und Senderskizzen recht schnell fertig.  Als nächstes war es notwendig, die Hardware zusammenzubauen und die Entwicklung bereits mit echter Hardware fortzusetzen. <br><br><h3>  Es lebt ... </h3><br>  Der EasyEDA-Onlinedienst entwickelte ein Projekt mit einer Schaltung und Leiterplatten.  Ich habe mich nicht um doppelseitige Bretter gekümmert, also habe ich Jumper auf die Rückseite gelegt. <br>  Hier ist ein Foto der fertigen Senderplatinen ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ka/fp/t3/kafpt3ylwzfbat7rt-dsiv_lgjc.jpeg"></div><br>  ... und der Empfänger. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7c/j3/g3/7cj3g3e6jzdczljdenhmmxaet4w.jpeg"></div><br>  Für Batterien kaufte ich Halter und auch Koffer.  Ehrlich gesagt wollte ich es in Weiß, aber wir hatten keines auf Lager, also musste ich es in Schwarz sammeln. <br>  Die Montage der Platinen erfolgte zunächst ohne Module, weil  Sie müssen den ersten Bootloader-Programmierer des Controllers ausfüllen.  Und da das Modul 3,3 Volt und der Programmierer 5 Volt hat und denselben Bus verwendet, ist es besser, das Modul nach der Firmware zu löten.  Überprüfte die Stromversorgung, programmierte den Bootloader.  Da sich keine Lötmaske auf der Platine befindet, habe ich ein Stück Kapton unter die Module geklebt.  Löte die Module und begann mit dem Debuggen der Firmware.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sofort auf einen Rechen in Form von Modulgefrieren getreten, stellte sich heraus, dass alles trivial einfach war. Der von mir verwendete 3-Volt-Stabilisator lieferte nicht den erforderlichen Strom. Nachdem der LBP an den Empfänger und die Batterien an den Sender angeschlossen wurden, funktionierte alles stabil. Zusätzlich habe ich einen Elektrolytkondensator in der Nähe des Wandlers am Stromkreis installiert, um ihn normal zu starten. Ich musste nur die verbleibende Logik hinzufügen, die oben beschrieben wurde. Bei den Standardantennen erwies sich die Verbindung als sehr stabil. Strukturell passen Empfänger und Sender vollständig in das gekaufte Gehäuse. Die Platinen wurden mit Schrauben an der Unterseite des Gehäuses an den Standard-Racks befestigt, und ich befestigte die Batteriehalter an doppelseitigem Klebeband oben. Das Gehäuse ist ziemlich fest verschlossen, deshalb habe ich es nicht zusätzlich mit Schrauben befestigt,und es ist bequemer, die Batterien zu wechseln. Als Ergebnis mehrerer weiterer Nächte, die ich mit Verfeinerung und Tests verbracht habe, habe ich ein fertiges Ergebnis erhalten.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wn/ft/om/wnftomqo54bb4zb_6feqwizz_qs.jpeg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qu/1g/oc/qu1goc6rx0xjwghyqirlkc2qdn0.jpeg"></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bootloader </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein paar Worte sollten auf Kosten des Bootloaders separat gesagt werden. </font><font style="vertical-align: inherit;">Für Arduino gibt es keine Standardlader für 4-MHz-Quarz, sie müssen separat zusammengebaut werden. Ich hatte jedoch das Glück, dass ich auf der Suche nach Informationen vor Beginn des Entwurfs auf einen Artikel einer Person stieß, eine Wetterstation mit denselben Modulen herstellte und dieselben Probleme hatte. </font><font style="vertical-align: inherit;">Ich werde am Ende einen Link zum Artikel hinterlassen. </font><font style="vertical-align: inherit;">Übrigens empfehle ich zu lesen, die Person hat auch hart gearbeitet. </font><font style="vertical-align: inherit;">Infolgedessen hatte er bereits einen vorgefertigten Bootloader in seinem Repository, und da er gemeinfrei war, habe ich ihn verwendet.</font></font><br><br><h3>  Fazit </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach mehr als einem Abend wurde eine vollständig funktionierende Struktur mit den erforderlichen Eigenschaften gebaut. </font><font style="vertical-align: inherit;">Jetzt arbeitet das Gerät seit mehr als 3 Wochen, bisher gab es keine Beschwerden über seinen Betrieb, aber die Zeit wird zeigen, wie wahr meine Berechnungen waren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Für diejenigen, die sagen, dass es möglich war, ein Relais auf 3 Volt zu stellen und nicht mit dem Konverter herumzuspielen, werde ich antworten, dass ich ihnen vollkommen zustimme. </font><font style="vertical-align: inherit;">Aber für diejenigen, die sich entscheiden, das Design zu wiederholen, gibt es die Möglichkeit, ihre Lösung zu wählen. </font><font style="vertical-align: inherit;">Am Ende sollte der Ingenieur die fertigen Konstruktionen erstellen und nicht nur kopieren ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vielen Dank an alle, die diesen Artikel bis zum Ende gemeistert haben, ich hoffe, es war interessant. </font><font style="vertical-align: inherit;">Für alle Ihre Fragen, Vorschläge und Kommentare bitte kommentieren.</font></font><br><br><h3>  Referenzen: </h3><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wetterstation Artikel</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub-Repository</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schemata und Bretter. </font><font style="vertical-align: inherit;">Empfänger</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schemata und Bretter. </font><font style="vertical-align: inherit;">Sender</font></font></a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de431272/">https://habr.com/ru/post/de431272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de431260/index.html">So funktioniert es: Die Arbeit eines Analystenteams am Beispiel der Entwicklung eines digitalen Dienstes</a></li>
<li><a href="../de431262/index.html">MIT-Kurs "Computer Systems Security". Vorlesung 19: „Anonyme Netzwerke“, Teil 1 (Vorlesung des Erstellers des Tor-Netzwerks)</a></li>
<li><a href="../de431264/index.html">MIT-Kurs "Computer Systems Security". Vorlesung 19: „Anonyme Netzwerke“, Teil 2 (Vorlesung des Erstellers des Tor-Netzwerks)</a></li>
<li><a href="../de431266/index.html">MIT-Kurs "Computer Systems Security". Vorlesung 19: „Anonyme Netzwerke“, Teil 3 (Vorlesung des Erstellers des Tor-Netzwerks)</a></li>
<li><a href="../de431270/index.html">Wie man Apple 1 zusammenbaut und ein Spiel dafür schreibt</a></li>
<li><a href="../de431274/index.html">Weihnachtsmann für sich: Wie kann ein Anwendungsentwickler während der Ferienzeit maximal verdienen?</a></li>
<li><a href="../de431276/index.html">Warum Intel-Prozessoren mehr verbrauchen als erwartet: Kühlkörperanforderungen und Turbomodus</a></li>
<li><a href="../de431278/index.html">Sie könnten in einem Robomobil geschaukelt sein - aber es gibt eine Lösung für dieses Problem</a></li>
<li><a href="../de431280/index.html">Nachtsichtgerät: Wie Pixel-Telefone im Dunkeln sehen</a></li>
<li><a href="../de431282/index.html">Langsame Software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>