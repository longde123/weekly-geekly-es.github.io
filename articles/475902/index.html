<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçΩÔ∏è üõå üßíüèø Workflow Core: un motor de procesos de negocio para .Net Core üé¨ üîû ü§™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! 


 Decidimos apoyar el tema de la migraci√≥n del proyecto utilizando Windows Workflow Foundation a .Net Core , que fue iniciado por cole...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Workflow Core: un motor de procesos de negocio para .Net Core</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avanpost/blog/475902/"><p><img src="https://habrastorage.org/webt/hp/ll/of/hpllof4hjsvcpfxbkl_q-epwfew.jpeg" alt="imagen"></p><br><p>  Hola a todos! </p><br><p>  Decidimos apoyar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tema de la migraci√≥n del proyecto utilizando Windows Workflow Foundation a .Net Core</a> , que fue iniciado por colegas de DIRECTUM, porque enfrentamos un problema similar hace un par de a√±os y seguimos nuestro propio camino. </p><a name="habracut"></a><br><h2>  Empecemos con la historia. </h2><br><p>  Nuestro producto estrella, Avanpost IDM, es un sistema de gesti√≥n de acceso de empleados y ciclo de vida de la cuenta.  √âl sabe c√≥mo administrar el acceso de forma autom√°tica seg√∫n el modelo a seguir y de acuerdo con las solicitudes.  En los albores de la formaci√≥n del producto, ten√≠amos un sistema de autoservicio bastante simple con un flujo de trabajo simple paso a paso, para el cual el motor no era necesario en principio. </p><br><p><img src="https://habrastorage.org/webt/hl/uo/c1/hluoc1imf_ejbdyzynpumdefmaa.png" alt="imagen"></p><br><p>  Sin embargo, cuando nos enfrentamos con grandes clientes, nos dimos cuenta de que se requer√≠a una herramienta mucho m√°s flexible, ya que sus requisitos para los procesos de coordinaci√≥n de los derechos de acceso buscaban las reglas de un flujo de trabajo bueno y pesado.  Despu√©s de analizar los requisitos, decidimos desarrollar nuestro propio editor de procesos en formato BPMN, adecuado para nuestras necesidades.  Hablaremos sobre el desarrollo del editor usando React.js + SVG un poco m√°s tarde, y hoy discutiremos el tema del backend: el <strong>motor de flujo de trabajo</strong> o el motor de procesos de negocios. </p><br><h2>  Requisitos </h2><br><p>  Al comienzo del desarrollo del sistema, ten√≠amos los siguientes requisitos para el motor: </p><br><ul><li>  Soporte para diagramas de proceso, un formato comprensible, la capacidad de transmitir desde nuestro formato al formato del motor. </li><li>  Proceso de almacenamiento de estado </li><li>  Soporte de versiones de proceso </li><li>  Soporte para ejecuci√≥n paralela (ramas) del proceso </li><li>  Una licencia adecuada para usar la soluci√≥n en un producto comercial replicado </li><li>  Soporte para escalado horizontal </li></ul><br><p>  Despu√©s de analizar el mercado (para 2014), nos decidimos por una soluci√≥n pr√°cticamente no alternativa para .Net: Windows Workflow Foundation. </p><br><h2>  Windows Workflow Foundation (WWF) </h2><br><p>  WWF es la tecnolog√≠a de Microsoft para definir, ejecutar y administrar flujos de trabajo. </p><br><p>  La base de su l√≥gica es un conjunto de contenedores para acciones (actividades) y la capacidad de construir procesos secuenciales a partir de estos contenedores.  El contenedor puede ser ordinario, un cierto paso en el proceso donde se realiza la actividad.  Puede ser un administrador, que contiene la l√≥gica de ramificaci√≥n. </p><br><p>  Puede dibujar un proceso directamente en Visual Studio.  El diagrama de proceso de negocio compilado se almacena en Haml, lo cual es muy conveniente: se describe el formato y es posible crear un dise√±ador de proceso autoescrito.  Esto es por un lado.  Por otro lado, Xaml no es el formato m√°s conveniente para almacenar una descripci√≥n: el esquema compilado para un proceso m√°s o menos real resulta enorme, sobre todo debido a la redundancia.  Es muy dif√≠cil de entender, pero tendr√°s que entenderlo. </p><br><p>  Pero si, tarde o temprano, uno puede comprender el zen con los esquemas y aprender a leerlos, entonces la falta de transparencia del motor se suma a la molestia que ya tienen los usuarios durante el funcionamiento del sistema.  Cuando el error proviene de las entra√±as de Wf, no siempre es posible averiguar al 100% cu√°l fue exactamente la raz√≥n del fallo.  La fuente cerrada y la relativa monstruosidad no ayudan al caso.  A menudo, las correcciones de errores se debieron a s√≠ntomas. </p><br><p> Para ser justos, vale la pena aclarar aqu√≠ que los problemas descritos anteriormente, en su mayor parte, nos han afectado debido a la fuerte personalizaci√≥n sobre Wf.  Uno de los lectores dir√° con seguridad que nosotros mismos creamos un mont√≥n de problemas y luego los resolvimos heroicamente.  Era necesario hacer un motor hecho a s√≠ mismo desde el principio.  En general, tendr√°n raz√≥n. </p><br><p>  En resumen, la soluci√≥n funcion√≥ de manera estable y entr√≥ en producci√≥n con √©xito.  Pero la transici√≥n de nuestros productos a .Net Core nos oblig√≥ a abandonar WWF y buscar otro motor de procesos comerciales, porque  A partir de mayo de 2019, Windows Workflow Foundation no se ha migrado a .Net Core.  Como est√°bamos buscando un nuevo motor, el tema de un art√≠culo separado, pero al final nos decidimos por Workflow Core. </p><br><h2>  N√∫cleo de flujo de trabajo </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Workflow Core</a> es un motor de proceso empresarial gratuito.  Est√° desarrollado bajo la licencia MIT, es decir, se puede usar de forma segura en el desarrollo comercial. </p><br><p>  Una persona la realiza activamente, varias m√°s realizan peri√≥dicamente una solicitud de extracci√≥n.  Hay puertos para otros idiomas (Java, Python y varios m√°s). </p><br><p>  El motor est√° posicionado como ligero.  De hecho, este es solo un host para la ejecuci√≥n secuencial de acciones agrupadas por cualquier regla de negocios. </p><br><p>  El proyecto tiene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n wiki</a> .  Desafortunadamente, no describe todas las caracter√≠sticas del motor.  Sin embargo, ser√° descarado requerir documentaci√≥n completa: el proyecto de c√≥digo abierto es respaldado por un entusiasta.  Por lo tanto, el Wiki ser√° suficiente para comenzar. </p><br><p>  Fuera de la caja hay soporte para almacenar el estado del proceso en almacenamiento externo (almacenamiento de persistencia).  Los proveedores son est√°ndar para: </p><br><ul><li>  Mongodb </li><li>  Servidor SQL </li><li>  PostgreSQL </li><li>  Sqlite </li><li>  Amazon DynamoDB </li></ul><br><p>  Escribir a su proveedor no es un problema.  Tomamos las fuentes de cualquier est√°ndar y lo hacemos como un ejemplo. </p><br><p>  Se admite el escalado horizontal, es decir, puede ejecutar el motor en varios nodos a la vez, mientras tiene un punto de almacenamiento de estados de proceso (un almacenamiento de persistencia).  En este caso, la colocaci√≥n de la cola de tareas interna del motor debe estar en el almacenamiento general (rabbitMQ, como opci√≥n).  Para excluir la ejecuci√≥n de una tarea por varios nodos, se proporciona un administrador de bloqueos al mismo tiempo.  Por analog√≠a con los proveedores de almacenamiento externo, hay implementaciones est√°ndar: </p><br><ul><li>  Arrendamientos de almacenamiento de Azure </li><li>  Redis </li><li>  AWS DynamoDB </li><li>  SQLServer (en la fuente hay, pero no se dice nada en la documentaci√≥n) </li></ul><br><p>  Conocer algo nuevo es m√°s f√°cil comenzar con un ejemplo.  Entonces hag√°moslo.  Describir√© la construcci√≥n de un proceso simple desde el principio, junto con una explicaci√≥n.  Un ejemplo puede parecer imposiblemente simple.  Estoy de acuerdo, es simple.  Lo m√°s para empezar. </p><br><p>  Vamos </p><br><h4>  Paso </h4><br><p>  Un paso es un paso en el proceso en el que se realizan las acciones.  Todo el proceso se construye a partir de una secuencia de pasos.  Un paso puede realizar muchas acciones, puede repetirse, por ejemplo, para alg√∫n evento desde el exterior.  Hay un conjunto de pasos dotados de la l√≥gica "lista para usar": </p><br><ul><li>  Esperar </li><li>  Si </li><li>  Mientras que </li><li>  Foreach </li><li>  Retraso </li><li>  Paralelo </li><li>  Horario </li><li>  Recurrir </li></ul><br><p>  Por supuesto, en algunas primitivas integradas no puede soportar el proceso.  Necesitamos pasos que completen las tareas comerciales.  Por lo tanto, por ahora, d√©jelos a un lado y tome medidas con nuestra propia l√≥gica.  Para hacer esto, debe heredar de la abstracci√≥n <strong>StepBody</strong> . </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">StepBody</span></span> : <span class="hljs-title"><span class="hljs-title">IStepBody</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> ExecutionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStepExecutionContext context</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><p>  El m√©todo <strong>Run</strong> se ejecuta cuando el proceso ingresa en un paso.  Es necesario colocar la l√≥gica necesaria en √©l. </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">StepBody</span></span> : <span class="hljs-title"><span class="hljs-title">IStepBody</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> ExecutionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStepExecutionContext context</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><p>  Los pasos admiten la inyecci√≥n de dependencia.  Para hacer esto, es suficiente registrarlos en el mismo contenedor que las dependencias necesarias. </p><br><p>  Obviamente, el proceso necesita su propio contexto, un lugar donde se pueden agregar resultados intermedios de ejecuci√≥n.  Wf core tiene su propio contexto para la ejecuci√≥n de un proceso que almacena informaci√≥n sobre su estado actual.  Puede acceder a ella utilizando la variable de <strong>contexto</strong> desde el m√©todo <strong>Run</strong> ().  Adem√°s del incorporado, podemos usar nuestro contexto. </p><br><p>  Analizaremos las formas de describir y registrar el proceso con m√°s detalle a continuaci√≥n, por ahora, simplemente definimos una determinada clase: el contexto. </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ProcessContext</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Number1 {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Number2 {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> StepResult {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessContext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Number1 = <span class="hljs-number"><span class="hljs-number">1</span></span>; Number2 = <span class="hljs-number"><span class="hljs-number">2</span></span>; } }</code> </pre> <br><p>  En las variables <strong>N√∫mero</strong> , escribimos n√∫meros;  en la variable <strong>StepResult</strong> : el resultado del paso. </p><br><p>  Decidimos sobre el contexto.  Puedes escribir tu propio paso: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomStep</span></span> : <span class="hljs-title"><span class="hljs-title">StepBody</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Ilogger _log; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Input1 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Input2 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Action { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Result { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomStep</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Ilogger log</span></span></span><span class="hljs-function">)</span></span> { _log = log; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> ExecutionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStepExecutionContext context</span></span></span><span class="hljs-function">)</span></span> { Result = ‚Äùnone‚Äù; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Action ==‚Äùsum‚Äù) { Result = Number1 + Number2; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Action ==‚Äùdif‚Äù){ Result = Number1 - Number2; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ExecutionResult.Next(); } }</code> </pre> <br><p>  La l√≥gica es extremadamente simple: dos n√∫meros y el nombre de la operaci√≥n llegan a la entrada.  El resultado de la operaci√≥n se escribe en la variable de salida <strong>Resultado</strong> .  Si la operaci√≥n no est√° definida, el resultado ser√° <em>ninguno</em> . </p><br><p>  Decidimos sobre el contexto, hay un paso con la l√≥gica que tambi√©n necesitamos.  Ahora necesitamos registrar nuestro proceso en el motor. </p><br><h4>  Descripci√≥n del proceso.  Registro en el motor. </h4><br><p>  Hay dos formas de describir un proceso.  La primera es la descripci√≥n en el c√≥digo: el c√≥digo duro. </p><br><p>  El proceso se describe a trav√©s de la <strong>interfaz fluida</strong> .  Es necesario heredar de la <strong>interfaz</strong> generalizada <strong>IWorkflow &lt;T&gt;</strong> , donde T es la clase de contexto del modelo.  En nuestro caso, este es un <strong>ProcessContext</strong> . </p><br><p>  Se ve as√≠: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleWorkflow</span></span> : <span class="hljs-title"><span class="hljs-title">IWorkflow</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ProcessContext</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IWorkflowBuilder&lt;ProcessContext&gt; builder</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    } public string Id =&gt; "SomeWorkflow"; public int Version =&gt; 1; }</span></span></code> </pre> <br><p>  La descripci√≥n en s√≠ estar√° dentro del m√©todo <strong>Build</strong> .  Los campos <strong>Id</strong> y <strong>Versi√≥n</strong> tambi√©n son obligatorios.  Wf core admite el control de versiones de procesos: puede registrar n versiones de procesos con el mismo identificador.  Esto es conveniente cuando necesita actualizar un proceso existente y al mismo tiempo dar "vida" a las tareas existentes. </p><br><p>  Describimos un proceso simple: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleWorkflow</span></span> : <span class="hljs-title"><span class="hljs-title">IWorkflow</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ProcessContext</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IWorkflowBuilder&lt;ProcessContext&gt; builder</span></span></span><span class="hljs-function">)</span></span> { builder.StartWith&lt;CustomStep&gt;() .Input(step =&gt; step.Input1, data =&gt; data.Number1) .Input(step =&gt; step.Input2, data =&gt; data.Number2) .Input(step =&gt; step.Action, data =&gt; ‚Äúsum‚Äù) .Output(data =&gt; data.StepResult, step =&gt; step.Result) .EndWorkflow(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; <span class="hljs-string"><span class="hljs-string">"SomeWorkflow"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Version =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br><p>  Si se traduce al lenguaje "humano", resultar√° algo como esto: el proceso comienza con el paso <strong>CustomStep</strong> .  El valor del campo de paso <strong>Entrada1</strong> se toma del campo de contexto <strong>N√∫mero1</strong> , El valor del campo de paso <strong>Entrada2</strong> se toma del campo de contexto <strong>N√∫mero2</strong> , el campo de <strong>acci√≥n</strong> est√° codificado con el valor <strong>"suma"</strong> .  La salida del campo <strong>Resultado se</strong> escribe en el <strong>campo de</strong> contexto <strong>StepResult</strong> .  Completa el proceso. </p><br><p>  De acuerdo, el c√≥digo result√≥ ser muy legible, es muy posible resolverlo, incluso sin un conocimiento especial en C #. </p><br><p>  Agregue un paso m√°s a nuestro proceso, que generar√° el resultado del paso anterior en el registro: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomStep</span></span> : <span class="hljs-title"><span class="hljs-title">StepBody</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Ilogger _log; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> TextToOutput { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomStep</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Ilogger log</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    _log = log; } public override ExecutionResult Run(IStepExecutionContext context) { _log.Debug(TextToOutput); return ExecutionResult.Next(); } }</span></span></code> </pre> <br><p>  Y actualice el proceso: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleWorkflow</span></span> : <span class="hljs-title"><span class="hljs-title">IWorkflow</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ProcessContext</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IWorkflowBuilder&lt;ProcessContext&gt; builder</span></span></span><span class="hljs-function">)</span></span> { builder.StartWith&lt;CustomStep&gt;() .Input(step =&gt; step.Input1, data =&gt; data.Number1) .Input(step =&gt; step.Input2, data =&gt; data.Number2) .Input(step =&gt; step.Action, data =&gt; ‚Äúsum‚Äù) .Output(data =&gt; data.StepResult, step =&gt; step.Result) .Then&lt;OutputStep&gt;.Input(step =&gt; step.TextToOutput, data =&gt; data.StepResult) .EndWorkflow(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; <span class="hljs-string"><span class="hljs-string">"SomeWorkflow"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Version =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><p>  Ahora, despu√©s del paso con la operaci√≥n de suma, sigue el paso de enviar el resultado al registro.  A la entrada, pasamos la variable <strong>Resultado</strong> y contexto en la que se escribi√≥ el resultado de la ejecuci√≥n en el √∫ltimo paso.  Me tomar√© la libertad de afirmar que tal descripci√≥n a trav√©s de un c√≥digo (hardcode) en sistemas reales ser√≠a de poca utilidad.  A menos que sea para algunos procesos de oficina.  Es mucho m√°s interesante poder almacenar el circuito por separado.  Como m√≠nimo, no tenemos que volver a armar el proyecto cada vez que necesitemos cambiar algo en el proceso o agregar uno nuevo.  Wf core proporciona esta caracter√≠stica almacenando el esquema json.  Seguimos ampliando nuestro ejemplo. </p><br><h4>  Descripci√≥n del proceso de Json </h4><br><p>  <i>Adem√°s, no proporcionar√© una descripci√≥n a trav√©s del c√≥digo.</i>  <i>Esto no es particularmente interesante, y solo inflar√° el art√≠culo.</i> </p><br><p>  Wf core admite la descripci√≥n del esquema en json.  En mi opini√≥n, json es m√°s visual que xaml (un buen tema para holivar en los comentarios :)).  La estructura del archivo es bastante simple: </p><br><pre> <code class="plaintext hljs">{ "Id": "SomeWorkflow", "Version": 1, "DataType": "App.ProcessContext, App", "Steps": [ { /*step1*/ }, { /*step2*/ } ] }</code> </pre> <br><p>  El campo <strong>DataType</strong> indica el nombre completo de la clase de contexto y el nombre del ensamblado en el que se describe.  <strong>Steps</strong> almacena una colecci√≥n de todos los pasos del proceso.  Complete el elemento <strong>Pasos</strong> : </p><br><pre> <code class="plaintext hljs">{ "Id": "SomeWorkflow", "Version": 1, "DataType": "App.ProcessContext, App", "Steps": [ { "Id": "Eval", "StepType": "App.CustomStep, App", "NextStepId": "Output", "Inputs": { "Input1": "data.Number1", "Input2": "data.Number2" }, "Outputs": { "StepResult": "step.Result" } }, { "Id": "Output", "StepType": "App.OutputStep, App", "Inputs": { "TextToOutput": "data.StepResult" } } ] }</code> </pre> <br><p>  Echemos un vistazo m√°s de cerca a la estructura de la descripci√≥n del paso a trav√©s de json. </p><br><p>  Los campos <strong>Id</strong> y <strong>NextStepId</strong> almacenan el identificador de este paso y un indicador de qu√© paso puede ser el siguiente.  Adem√°s, el orden de los elementos de la colecci√≥n no es importante. </p><br><p>  <strong>StepType es</strong> similar al campo <strong>DataType</strong> , contiene el nombre completo de la clase de paso (un tipo que hereda de <strong>StepBody</strong> e implementa la l√≥gica del paso) y el nombre del ensamblado.  M√°s interesantes son los objetos <strong>Entradas</strong> y <strong>Salidas</strong> .  Se establecen en forma de mapeo. </p><br><p>  En el caso de las <strong>entradas, el</strong> nombre del elemento json es el nombre del campo de clase de nuestro paso;  El valor del elemento es el nombre del campo en la clase, el contexto del proceso. </p><br><p>  Para las <strong>salidas, por el</strong> contrario, el nombre del elemento json es el nombre del campo en la clase, el contexto del proceso;  El valor del elemento es el nombre del campo de clase de nuestro paso. </p><br><p>  ¬øPor qu√© los campos de contexto se especifican mediante <em>datos. {Field_name}</em> , y en el caso de <strong>Output</strong> , <em>paso. {Field_name}</em> ?  Debido a que wf core el valor del elemento se ejecuta como una expresi√≥n C # ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se</a> usa la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca Dynamic Expressions</a> ).  Esto es algo bastante √∫til, con su ayuda puede establecer cierta l√≥gica comercial directamente dentro del esquema, si, por supuesto, el arquitecto aprueba tal desgracia :). </p><br><p>  Diversificamos el esquema con primitivas est√°ndar.  Agregue un paso <strong>If</strong> condicional y procese un evento externo. </p><br><h5>  Si </h5><br><p>  Primitivo <strong>If</strong> .  Aqu√≠ comienzan las dificultades.  Si est√° acostumbrado a bpmn y dibuja procesos en esta notaci√≥n, encontrar√° una configuraci√≥n f√°cil.  Seg√∫n la documentaci√≥n, el paso se describe de la siguiente manera: </p><br><pre> <code class="plaintext hljs">{ "Id": "IfStep", "StepType": "WorkflowCore.Primitives.If, WorkflowCore", "NextStepId": "nextStep", "Inputs": { "Condition": "&lt;&lt;expression to evaluate&gt;&gt;" }, "Do": [ [ { /*do1*/ }, { /*do2*/ } ] ] }</code> </pre> <br><p>  ¬øNo hay sensaci√≥n de que algo est√° mal aqu√≠?  Yo tengo uno  La entrada de paso se establece en <em>Condici√≥n</em> - expresi√≥n.  A continuaci√≥n, establecemos la lista de pasos dentro de la matriz <strong>Do</strong> (acciones).  Entonces, ¬ød√≥nde est√° la rama <strong>falsa</strong> ?  ¬øPor qu√© no hay una matriz Do para False?  En realidad lo hay.  Se entiende que la rama <strong>False</strong> es simplemente un paso m√°s a lo largo del proceso, es decir, siguiendo el puntero en <strong>NextStepId</strong> .  Al principio, estaba constantemente confundido debido a esto.  De acuerdo, lo solucion√©.  Aunque no.  Si las acciones del proceso en el caso de <em>True</em> deben colocarse dentro de <strong>Do</strong> , esto es lo que ser√° "hermoso" json entonces.  ¬øY si hay estos si est√°n encerrados con una docena?  Todo ir√° de lado.  Tambi√©n dicen que el esquema en xaml es dif√≠cil de leer.  Hay un peque√±o truco.  Simplemente tome el monitor m√°s ancho.  Se mencion√≥ un poco m√°s arriba que el orden de los pasos en la colecci√≥n no importa, la transici√≥n sigue los signos.  Se puede usar.  Agrega un paso m√°s: </p><br><pre> <code class="plaintext hljs">{ "Id": "Jump", "StepType": "App.JumpStep, App", "NextStepId": "" }</code> </pre> <br><p>  ¬øAdivina a qu√© estoy conduciendo?  Es cierto que presentamos un paso de servicio, que en tr√°nsito lleva el proceso a un paso en <strong>NextStepId</strong> . </p><br><p>  Actualiza nuestro esquema: </p><br><pre> <code class="plaintext hljs">{ "Id": "SomeWorkflow", "Version": 1, "DataType": "App.ProcessContext, App", "Steps": [ { "Id": "Eval", "StepType": "App.CustomStep, App", "NextStepId": "MyIfStep", "Inputs": { "Input1": "data.Number1", "Input2": "data.Number2" }, "Outputs": { "StepResult": "step.Result" } }, { "Id": "MyIfStep", "StepType": "WorkflowCore.Primitives.If, WorkflowCore", "NextStepId": "OutputEmptyResult", "Inputs": { "Condition": "!String.IsNullOrEmpty(data.StepResult)" }, "Do": [ [ { "Id": "Jump", "StepType": "App.JumpStep, App", "NextStepId": "Output" } ] ] }, { "Id": "Output", "StepType": "App.OutputStep, App", "Inputs": { "TextToOutput": "data.StepResult" } }, { "Id": "OutputEmptyResult", "StepType": "App.OutputStep, App", "Inputs": { "TextToOutput": "\"Empty result\"" } } ] }</code> </pre> <br><p>  El paso <strong>If</strong> verifica si el resultado del paso <strong>Eval</strong> est√° vac√≠o.  Si no est√° vac√≠o, mostramos el resultado; si est√° vac√≠o, aparece el mensaje " <em>Resultado vac√≠o</em> ".  El paso <strong>Salto</strong> lleva el proceso al paso <strong>Salida</strong> , que est√° fuera de la colecci√≥n <strong>Do.</strong>  Por lo tanto, hemos mantenido la "verticalidad" del esquema.  Adem√°s, de esta manera, uno puede saltar n pasos hacia atr√°s, es decir  para organizar un ciclo.  Hay primitivas incorporadas para bucles en wf core, pero no siempre son convenientes.  En bpmn, por ejemplo, los bucles se organizan a trav√©s de <strong>If</strong> . </p><br><p>  Utilice este enfoque o el est√°ndar, depende de usted.  Para nosotros, una organizaci√≥n as√≠ fue pasos m√°s convenientes. </p><br><h5>  Esperar </h5><br><p>  La primitiva <strong>WaitFor</strong> permite que el mundo exterior influya en el proceso cuando ya se est√° ejecutando.  Por ejemplo, si en la etapa del proceso se requiere la aprobaci√≥n del curso posterior por parte de cualquier usuario.  El proceso permanecer√° en el paso <strong>Esperar</strong> hasta que reciba un evento al que est√© suscrito. </p><br><p>  Estructura primitiva: </p><br><pre> <code class="plaintext hljs">{ "Id": "Wait", "StepType": "WorkflowCore.Primitives.WaitFor, WorkflowCore", "NextStepId": "NextStep", "CancelCondition": "If(cancel==true)", "Inputs": { "EventName": "\"UserAction\"", "EventKey": "\"DoSum\"", "EffectiveDate": "DateTime.Now" } }</code> </pre> <br><p>  Explicar√© los par√°metros un poco. </p><br><p>  <strong>CancelCondition</strong> : una condici√≥n para interrumpir una espera.  Brinda la capacidad de interrumpir la espera de un evento y avanzar en el proceso.  Por ejemplo, si un proceso est√° esperando n eventos diferentes al mismo tiempo (wf core admite la ejecuci√≥n paralela de pasos), no es necesario esperar a que <strong>lleguen</strong> todos, en este caso <strong>CancelCondition</strong> nos ayudar√°.  Agregamos un indicador l√≥gico a las variables de contexto y al recibir el evento establecemos el indicador en <em>verdadero</em> : todos los pasos de <strong>WaitFor</strong> se completan. </p><br><p>  <strong>EventName</strong> y <strong>EventKey</strong> : nombre y clave del evento.  Los campos son necesarios para distinguir eventos, es decir, en un sistema real con una gran cantidad de procesos de trabajo simult√°neos.  para que el motor entienda qu√© evento est√° destinado para qu√© proceso y qu√© paso. </p><br><p>  <strong>EffectiveDate</strong> : un campo opcional que agrega una marca de tiempo de evento.  Puede ser √∫til si necesita publicar un evento "en el futuro".  Para que se publique de inmediato, puede dejar el par√°metro vac√≠o o establecer la hora actual. </p><br><p>  No en todos los casos es conveniente dar un paso separado para procesar las reacciones desde el exterior; m√°s bien, incluso generalmente ser√° redundante.  Se puede evitar un paso adicional al agregar la expectativa de un evento externo y la l√≥gica de su procesamiento al paso habitual.  <strong>Complementamos el</strong> paso <strong>CustomStep</strong> suscribi√©ndonos a un evento externo: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomStep</span></span> : <span class="hljs-title"><span class="hljs-title">StepBody</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Ilogger _log; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> TextToOutput { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomStep</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Ilogger log</span></span></span><span class="hljs-function">)</span></span> { _log = log; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> ExecutionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStepExecutionContext context</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//-  return ExecutionResult.WaitForEvent("eventName", "eventKey", DateTime.Now); } }</span></span></code> </pre> <br><p>  Utilizamos el m√©todo de extensi√≥n est√°ndar <strong>WaitForEvent ()</strong> .  Acepta los par√°metros anteriormente mencionados <strong>EventName</strong> , <strong>EventKey</strong> y <strong>EffectiveDate</strong> .  Despu√©s de completar la l√≥gica de dicho paso, el proceso esperar√° el evento descrito y volver√° a llamar al m√©todo <strong>Run ()</strong> en el momento en que el evento se publique en el bus del motor.  Sin embargo, en la forma actual, no podemos distinguir entre los momentos de la entrada inicial en el paso y la entrada despu√©s del evento.  Pero me gustar√≠a separar de alguna manera la l√≥gica antes-despu√©s en el nivel de paso.  Y la bandera <strong>EventPublished</strong> nos ayudar√° con esto.  Se encuentra dentro del contexto general del proceso, puede obtenerlo as√≠: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ifEvent=context.ExecutionPointer.EventPublished;</code> </pre> <br><p>  Seg√∫n este indicador, puede dividir de forma segura la l√≥gica en antes y despu√©s de un evento externo. </p><br><p>  Una aclaraci√≥n importante: seg√∫n la idea del creador del motor, un paso solo se puede firmar en un evento y reaccionar ante √©l una vez.  Para algunas tareas, esta es una limitaci√≥n muy desagradable.  Incluso tuvimos que "terminar" el motor para escapar de este matiz.  Omitiremos su descripci√≥n en este art√≠culo, de lo contrario el art√≠culo nunca terminar√° :).  Pr√°cticas de uso m√°s complejas y ejemplos de mejoras se cubrir√°n en art√≠culos posteriores. </p><br><h4>  Proceso de registro en el motor.  Publicaci√≥n del evento en el autob√∫s. </h4><br><p>  Entonces, con la implementaci√≥n de la l√≥gica de los pasos y las descripciones del proceso resuelto.  Lo que queda es lo m√°s importante, sin el cual el proceso no funcionar√°: la descripci√≥n debe registrarse. </p><br><p>  Utilizaremos el m√©todo de extensi√≥n <strong>AddWorkflow ()</strong> est√°ndar, que colocar√° sus dependencias en nuestro contenedor IoC. </p><br><p>  Se ve as√≠: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IServiceCollection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWorkflow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IServiceCollection services, Action&lt;WorkflowOptions&gt; setupAction = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span></code> </pre> <br><p>  <strong>IServiceCollection</strong> - interfaz - un contrato para una colecci√≥n de descripciones de servicios.  Vive dentro de DI de Microsoft (puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">leer</a> m√°s sobre esto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> ) </p><br><p>  <strong>WorkflowOptions</strong> : configuraci√≥n b√°sica del motor.  No es necesario configurarlos usted mismo; los valores est√°ndar son bastante aceptables para el primer conocido.  Vamos m√°s lejos </p><br><p>  Si el proceso se describi√≥ en c√≥digo, entonces el registro se realiza as√≠: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> host = _serviceProvider.GetService&lt;IWorkflowHost&gt;(); host.RegisterWorkflow&lt;SomeWorkflow, ProcessContext&gt;();</code> </pre> <br><p>  Si el proceso se describe a trav√©s de json, debe registrarse de la siguiente manera (por supuesto, la descripci√≥n de json debe cargarse previamente desde la ubicaci√≥n de almacenamiento): </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> host = _serviceProvider.GetService&lt;IWorkflowHost&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> definitionLoader = _serviceProvider.GetService&lt;IDefinitionLoader&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> definition = loader.LoadDefinition({*json  *});</code> </pre> <br><p>  Adem√°s, para ambas opciones, el c√≥digo ser√° el mismo: </p><br><pre> <code class="cs hljs">host.Start(); <span class="hljs-comment"><span class="hljs-comment">//      host.StartWorkflow(definitionId, version, context); //      /// host.Stop(); / /    </span></span></code> </pre> <br><p>  El par√°metro <strong>definitionId</strong> es el identificador de proceso.  Lo que est√° escrito en el campo Id del proceso.  En este caso, id = <strong>SomeWorkflow</strong> . </p><br><p>  El par√°metro <strong>versi√≥n</strong> especifica qu√© versi√≥n del proceso ejecutar.  El motor proporciona la capacidad de registrar inmediatamente n versiones de proceso con un identificador.  Esto es conveniente cuando necesita hacer cambios en la descripci√≥n del proceso sin interrumpir las tareas que ya se est√°n ejecutando: se crear√°n nuevas con la nueva versi√≥n, las antiguas vivir√°n en silencio en la anterior. </p><br><p>  El par√°metro de <strong>contexto</strong> es una instancia del contexto del proceso. </p><br><p>  Los <strong>m√©todos host.Start ()</strong> y <strong>host.Stop ()</strong> inician y detienen el proceso de alojamiento.  Si en la aplicaci√≥n el inicio de procesos es una tarea aplicada y se realiza peri√≥dicamente, entonces el hosting deber√≠a detenerse.  Si la aplicaci√≥n se centra principalmente en la implementaci√≥n de varios procesos, entonces el alojamiento no se puede detener. </p><br><p>  Hay un m√©todo para enviar mensajes del mundo exterior al bus del motor, que luego los distribuir√° entre los suscriptores: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PublishEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> eventName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> eventKey, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> eventData, DateTime effectiveDate = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  La descripci√≥n de sus par√°metros fue mayor en el art√≠culo ( <em>ver la parte primitiva WaitFor</em> ). </p><br><h2>  Conclusi√≥n </h2><br><p>  Definitivamente tomamos riesgos cuando decidimos a favor del Workflow Core - proyecto de c√≥digo abierto, que es desarrollado activamente por una persona, e incluso con documentaci√≥n muy pobre.  Y lo m√°s probable es que no encuentre pr√°cticas reales de uso de wf core en sistemas de producci√≥n (excepto el nuestro).  Por supuesto, despu√©s de haber seleccionado una capa separada de abstracciones, nos aseguramos contra un caso de falla y la necesidad de regresar r√°pidamente a WWF, por ejemplo, o una soluci√≥n autoescrita, pero todo sali√≥ bastante bien y la falla no lleg√≥. </p><br><p>  El cambio al motor de c√≥digo abierto Workflow Core resolvi√≥ un cierto n√∫mero de problemas que nos imped√≠an vivir pac√≠ficamente en WWF.  El m√°s importante de ellos es, por supuesto, el soporte .Net Core y la falta de tal, incluso en los planes, WWF. </p><br><p>  El siguiente es el c√≥digo abierto.  Trabajando con WWF y obteniendo varios errores de sus intestinos, la capacidad de al menos leer la fuente ser√≠a muy √∫til.  Sin mencionar cambiar algo en ellos.  Aqu√≠ con Workflow Core, completa libertad (incluyendo licencias - MIT).  Si aparece un error repentinamente desde las entra√±as del motor, simplemente descargue las fuentes de github y busque con calma la causa de su aparici√≥n.  S√≠, solo la capacidad de arrancar el motor en modo de depuraci√≥n con puntos de interrupci√≥n ya facilita enormemente el proceso. </p><br><p>  Por supuesto, al resolver algunos problemas, Workflow Core trajo sus propios problemas nuevos.  Tuvimos que hacer una cantidad significativa de cambios en el n√∫cleo del motor.  Pero  Trabajar en "terminar" por s√≠ mismos cuesta menos en tiempo que desarrollar su propio motor desde cero.  La soluci√≥n final fue bastante aceptable en t√©rminos de velocidad y estabilidad, nos permiti√≥ olvidar los problemas con el motor y centrarnos en el desarrollo del valor comercial del producto. </p><br><p>  <em>PD: Si el tema resulta interesante, habr√° m√°s art√≠culos sobre wf core, con un an√°lisis m√°s profundo del motor y soluciones a problemas empresariales complejos.</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/475902/">https://habr.com/ru/post/475902/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../475888/index.html">Beneficios del reconocimiento facial en la nube</a></li>
<li><a href="../475892/index.html">C√≥mo mejoramos el orden del almuerzo en la oficina (sin acceso al servidor)</a></li>
<li><a href="../475894/index.html">Tres protocolos de paso</a></li>
<li><a href="../475896/index.html">Reactor C desnudo de E / S completo</a></li>
<li><a href="../475900/index.html">Los 6 cursos de Azure m√°s recientes</a></li>
<li><a href="../475904/index.html">5 notas para el nuevo gerente</a></li>
<li><a href="../475908/index.html">Los 10 cursos m√°s populares de Microsoft en ruso</a></li>
<li><a href="../475912/index.html">C√≥mo evaluar y comparar dispositivos de cifrado para redes Ethernet</a></li>
<li><a href="../475916/index.html">Agrega ojos al robot</a></li>
<li><a href="../475920/index.html">No en tiempo de ejecuci√≥n, sino en tiempo de dise√±o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>