<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’¸ ğŸ˜“ ğŸ‘¨â€â¤ï¸â€ğŸ‘¨ åœ¨Goä¸­æ›´å¿«åœ°è‡ªå·±åŠ¨æ‰‹å­—ç¬¦ä¸²è¿æ¥ ğŸ–ï¸ ğŸ¤œğŸ¼ ğŸ¤¸ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æŠŠGoä¸­çš„çŸ­çº¿ç²˜åˆé€Ÿåº¦æé«˜30ï¼…ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¿®æ”¹Goæœ¬èº«ï¼Œæ‰€æœ‰è¿™äº›éƒ½å°†ä½œä¸ºç¬¬ä¸‰æ–¹åº“å®ç° ã€‚ 


 æ ¹æ®å‰Šå‡ï¼Œæ‚¨æ­£åœ¨ç­‰å¾…ï¼š 


- æ¯”è¾ƒ+ ï¼Œ strings.Builderå’Œæœ¬æœºä¸²è”å‡½æ•° 
- è½¬åˆ°å†…éƒ¨è¡Œè¯¦ç»†ä¿¡æ¯ 
- ç›¸å½“å¤šçš„æ±‡ç¼–å™¨ 


 æœ¬æ–‡ä¹Ÿå¯ä»¥ä½œä¸ºè®¨è®ºCL12325...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Goä¸­æ›´å¿«åœ°è‡ªå·±åŠ¨æ‰‹å­—ç¬¦ä¸²è¿æ¥</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417479/"><p><img src="https://habrastorage.org/webt/36/bi/u0/36biu0kvugh_maxmmyhmuvqlrs8.png"></p><br><p> ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æŠŠGoä¸­çš„çŸ­çº¿ç²˜åˆé€Ÿåº¦æé«˜30ï¼…ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¿®æ”¹Goæœ¬èº«ï¼Œæ‰€æœ‰è¿™äº›éƒ½å°†ä½œä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸‰æ–¹åº“å®ç°</a> ã€‚ </p><br><p> æ ¹æ®å‰Šå‡ï¼Œæ‚¨æ­£åœ¨ç­‰å¾…ï¼š </p><br><ul><li>æ¯”è¾ƒ<code>+</code> ï¼Œ <code>strings.Builder</code>å’Œæœ¬æœºä¸²è”å‡½æ•° </li><li> è½¬åˆ°å†…éƒ¨è¡Œè¯¦ç»†ä¿¡æ¯ </li><li> ç›¸å½“å¤šçš„æ±‡ç¼–å™¨ </li></ul><br><p> æœ¬æ–‡ä¹Ÿå¯ä»¥ä½œä¸ºè®¨è®º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CL123256</a>çš„å€Ÿå£<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼šè¿è¡Œæ—¶ï¼Œcmd / compileï¼šä¸“é•¿concatstring2</a> ã€‚ æ¬¢è¿æå‡ºæ”¹è¿›æ­¤æ›´æ”¹åˆ—è¡¨çš„æƒ³æ³•ã€‚ </p><a name="habracut"></a><br><h1 id="srazu-rezultaty"> ç«‹å³ç»“æœ </h1><br><p> ä¸ç¼–è¯‘å™¨çš„<code>go tip</code> ï¼ˆä¸»ç‰ˆï¼‰ç‰ˆæœ¬è¿›è¡Œäº†æ¯”è¾ƒã€‚ æ‚¨å¯ä»¥åœ¨Go 1.5å·¦å³çš„ç‰ˆæœ¬ä¸Šè·å¾—ç±»ä¼¼çš„ç»“æœã€‚ å¯¹<code>concatstrings</code>å‡½æ•°çš„æœ€åä¸€ä¸ªé‡è¦æ›´æ”¹æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CL3120ï¼šcmd / gcï¼šä¸ºå †æ ˆä¸Šæœªè½¬ä¹‰çš„å­—ç¬¦ä¸²åˆ†é…ç¼“å†²åŒº</a> ã€‚ </p><br><pre> <code class="hljs powershell">BenchmarkConcat2Operator<span class="hljs-literal"><span class="hljs-literal">-8</span></span> <span class="hljs-number"><span class="hljs-number">20000000</span></span> <span class="hljs-number"><span class="hljs-number">83.8</span></span> ns/op BenchmarkConcat2Builder<span class="hljs-literal"><span class="hljs-literal">-8</span></span> <span class="hljs-number"><span class="hljs-number">20000000</span></span> <span class="hljs-number"><span class="hljs-number">70.9</span></span> ns/op BenchmarkConcat2<span class="hljs-literal"><span class="hljs-literal">-8</span></span> <span class="hljs-number"><span class="hljs-number">20000000</span></span> <span class="hljs-number"><span class="hljs-number">62.1</span></span> ns/op BenchmarkConcat3Operator<span class="hljs-literal"><span class="hljs-literal">-8</span></span> <span class="hljs-number"><span class="hljs-number">20000000</span></span> <span class="hljs-number"><span class="hljs-number">104</span></span> ns/op BenchmarkConcat3Builder<span class="hljs-literal"><span class="hljs-literal">-8</span></span> <span class="hljs-number"><span class="hljs-number">20000000</span></span> <span class="hljs-number"><span class="hljs-number">89.9</span></span> ns/op BenchmarkConcat3<span class="hljs-literal"><span class="hljs-literal">-8</span></span> <span class="hljs-number"><span class="hljs-number">20000000</span></span> <span class="hljs-number"><span class="hljs-number">82.1</span></span> ns/op</code> </pre> <br><p>  <code>ConcatOperator</code>ä½¿ç”¨<code>+</code> ã€‚ <br>  <code>ConcatBuilder</code>ä½¿ç”¨æ­£ç¡®é¢„åˆ†é…çš„<code>strings.Builder</code> ã€‚ <br>  <code>Concat</code>ä½¿ç”¨äº†æˆ‘ä»¬åœ¨æœ¬æ•…äº‹ä¸­å®ç°çš„åŠŸèƒ½ã€‚ </p><br><p> é€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Benchstat</a>æ¯”è¾ƒï¼š </p><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">old</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>/op <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>/op delta Concat2<span class="hljs-number"><span class="hljs-number">-8</span></span> <span class="hljs-number"><span class="hljs-number">84.2</span></span>ns Â± <span class="hljs-number"><span class="hljs-number">1</span></span>% <span class="hljs-number"><span class="hljs-number">62.7</span></span>ns Â± <span class="hljs-number"><span class="hljs-number">2</span></span>% <span class="hljs-number"><span class="hljs-number">-25.49</span></span>% (p=<span class="hljs-number"><span class="hljs-number">0.000</span></span> n=<span class="hljs-number"><span class="hljs-number">9</span></span>+<span class="hljs-number"><span class="hljs-number">10</span></span>) Concat3<span class="hljs-number"><span class="hljs-number">-8</span></span> <span class="hljs-number"><span class="hljs-number">103</span></span>ns Â± <span class="hljs-number"><span class="hljs-number">3</span></span>% <span class="hljs-number"><span class="hljs-number">83</span></span>ns Â± <span class="hljs-number"><span class="hljs-number">4</span></span>% <span class="hljs-number"><span class="hljs-number">-19.83</span></span>% (p=<span class="hljs-number"><span class="hljs-number">0.000</span></span> n=<span class="hljs-number"><span class="hljs-number">10</span></span>+<span class="hljs-number"><span class="hljs-number">9</span></span>)</code> </pre> <br><p>  <code>GOARCH=AMD64</code>ä¸‹çš„æ±‡ç¼–ç¨‹åºå®ç°ç¨å¿«ä¸€äº›ï¼Œå¹¶å…·æœ‰é™„åŠ çš„ä¼˜åŒ–åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å­˜åœ¨äºå†…ç½®<code>+</code>è¿ç®—ç¬¦ä¸­ï¼Œä½†åœ¨ä»¥ä¸‹å†…å®¹ä¸­æœ‰æ›´å¤šä»‹ç»ï¼š </p><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">old</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>/op <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>/op delta Concat2<span class="hljs-number"><span class="hljs-number">-8</span></span> <span class="hljs-number"><span class="hljs-number">84.2</span></span>ns Â± <span class="hljs-number"><span class="hljs-number">1</span></span>% <span class="hljs-number"><span class="hljs-number">57.1</span></span>ns Â± <span class="hljs-number"><span class="hljs-number">3</span></span>% <span class="hljs-number"><span class="hljs-number">-32.20</span></span>% (p=<span class="hljs-number"><span class="hljs-number">0.000</span></span> n=<span class="hljs-number"><span class="hljs-number">9</span></span>+<span class="hljs-number"><span class="hljs-number">9</span></span>)</code> </pre> <br><p> æˆ‘ä»¬å°†æŠŠæ±‡ç¼–å™¨åŠŸèƒ½è§†ä¸º100ï¼…çš„æ€§èƒ½ï¼ˆç›¸å¯¹äºå…¶ä½™è€ƒè™‘çš„å®ç°ï¼‰ã€‚ </p><br><blockquote> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">README.mdä¸­</a>å¯ä»¥çœ‹åˆ°æ›´é•¿è¡Œçš„ç»“æœã€‚ å­—ç¬¦ä¸²è¶Šé•¿ï¼Œå®ç°ä¹‹é—´çš„å·®å¼‚å°±è¶Šä¸æ˜æ˜¾ã€‚ </blockquote><br><h1 id="naivnaya-konkatenaciya"> å¤©çœŸçš„ä¸²è” </h1><br><p> æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨<code>+</code>è¿ç®—ç¬¦ã€‚ </p><br><p> è¯¥è¯­å¥çš„è¯­ä¹‰å¦‚ä¸‹ï¼šå ç”¨ä¸¤è¡Œå¹¶è¿”å›åŒ…å«ä¸¤è¡Œä¸²è”çš„ç»“æœå­—ç¬¦ä¸²ã€‚ ä¸èƒ½ä¿è¯å°†è¿”å›æ–°è¡Œã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªç©ºå­—ç¬¦ä¸²å’Œå…¶ä»–å­—ç¬¦ä¸²çš„ä¸²è”ï¼Œåˆ™è¿è¡Œæ—¶å¯èƒ½ä¼šè¿”å›ä¸€ä¸ªéç©ºå‚æ•°ï¼Œä»è€Œé¿å…äº†åˆ†é…æ–°å†…å­˜å¹¶åœ¨å…¶ä¸­å¤åˆ¶æ•°æ®çš„éœ€è¦ã€‚ </p><br><p> ä½†æ˜¯ï¼Œä»æœ¬æ–‡å¼€å¤´çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯æœ€æ…¢çš„æ–¹æ³•ã€‚ </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">concat2operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, y </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y }</code> </pre> <br><blockquote> ç»©æ•ˆç­‰çº§ï¼š <strong>67.8ï¼…</strong> ã€‚ </blockquote><br><h1 id="stringsbuilder">  strings.Builder </h1><br><p> ä¸ä¹…å‰ï¼Œä¸€ä¸ªæ–°ç±»å‹è¢«æ·»åŠ åˆ°Go- <a href="">strings.Builderä¸­</a> ã€‚ è¿™æ˜¯<code>bytes.Buffer</code>çš„ç±»ä¼¼ç‰©ï¼Œä½†æ˜¯åœ¨è°ƒç”¨<code>String()</code>æ–¹æ³•æ—¶ï¼Œä¸ä¼šé‡æ–°åˆ†é…å†…å­˜ï¼Œä¹Ÿä¸ä¼šå¤åˆ¶æ•°æ®ã€‚ </p><br><p> ä¸<code>bytes.Buffer</code>ä¸åŒï¼Œbuilderæ²¡æœ‰ä¼˜åŒ–<a href="">å°ç¼“å†²åŒº</a> ï¼Œå› æ­¤æ²¡æœ‰ä¸ºå­—ç¬¦ä¸²é¢„å…ˆåˆ†é…å†…å­˜ã€‚ å¦‚æœä¸ä½¿ç”¨<code>Grow</code>æ–¹æ³•ï¼Œåˆ™æ€§èƒ½å°†æ¯”ä½¿ç”¨<code>bytes.Buffer</code>å·®ã€‚  Go 1.11ä¸­çš„ä¸€äº›å›å½’æ˜¯ç”±æ­¤ç‰¹å®šåŠŸèƒ½å¼•èµ·çš„ï¼ˆè¯·å‚é˜…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CL113235</a> ï¼‰ã€‚ </p><br><p> åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œå‡ºäºå®éªŒçš„çº¯åº¦ï¼Œæˆ‘ä»¬å°†é¿å…è¯¥é”™è¯¯ã€‚ </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">concat2builder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, y </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> builder strings.Builder builder.Grow(<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(x) + <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(y)) <span class="hljs-comment"><span class="hljs-comment">//      builder.WriteString(x) builder.WriteString(y) return builder.String() }</span></span></code> </pre> <br><blockquote> ç»©æ•ˆç­‰çº§ï¼š <strong>80.5ï¼…</strong> ï¼ˆ+12.7ï¼‰ã€‚ </blockquote><br><h1 id="kodogeneraciya-dlya-konkatenacii"> çº§è”ä»£ç ç”Ÿæˆ </h1><br><p> å¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹ç¼–è¯‘å™¨ä¸º<code>+</code>è¿ç®—ç¬¦ç”Ÿæˆçš„ä»£ç ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¯¹<code>concatstring2</code> ï¼Œ <code>concatstring3</code>å‡½æ•°ç­‰çš„è°ƒç”¨ï¼ˆæœ€å¤šåŒ…æ‹¬<code>concatstring5</code> ï¼‰ã€‚ </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">concat2codegen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, y)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y } <span class="hljs-comment"><span class="hljs-comment">// =&gt; CALL runtime.concatstring2(SB) func concat3codegen(x, y, z) string { return x + y + z } // =&gt; CALL runtime.concatstring3(SB)</span></span></code> </pre> <br><p> çœ‹ä¸€ä¸‹<a href="">runtime / string.goæœ¬èº«</a> ï¼š </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">concatstring2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(buf *tmpBuf, a [2]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> concatstrings(buf, a[:]) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">concatstring3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(buf *tmpBuf, a [3]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> concatstrings(buf, a[:]) }</code> </pre> <br><p> å› æ­¤ï¼Œå‰©ä¸‹çš„è¦å­¦ä¹ åŠŸèƒ½<code>concatstrings</code> ã€‚ <br> æ‰°æµæ¿ä¸‹é¢æä¾›äº†å®Œæ•´çš„åˆ—è¡¨ï¼Œä½†è¿™æ˜¯é«˜çº§æè¿°ï¼š </p><br><ol><li>  <code>buf</code>å‚æ•°å¯ä»¥ä¸º<code>nil</code> ã€‚ å¦‚æœè¯¥è¡Œæœªä»å…¶å®šä¹‰ä¸­â€œè½¬ä¹‰â€ï¼Œåˆ™ç”±ç¼–è¯‘å™¨åˆ†é…æ­¤ç¼“å†²åŒºã€‚ å¦‚æœå­—ç¬¦ä¸²çš„å¯¿å‘½æ¯”å¸§é•¿ï¼Œåˆ™æ­¤ç¼“å†²åŒºå°†å§‹ç»ˆ<code>nil</code> ï¼ˆè¿™æ˜¯æœ€å¸¸è§çš„æƒ…å†µï¼‰ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ­¤ç¼“å†²åŒºå¯ç”¨ï¼Œåˆ™å¯ä»¥é¿å…åˆ†é…ï¼Œä»¥é˜²ç»“æœé—¯å…¥ç¼“å†²åŒºï¼ˆå…¶å¤§å°ä¸º32å­—èŠ‚ï¼‰ã€‚ </li><li> å¦‚æœé™¤ä¸€è¡Œä»¥å¤–çš„æ‰€æœ‰è¡Œå‡ä¸ºç©ºï¼Œåˆ™å‡½æ•°å°†è¿”å›æ­¤è¡Œã€‚ ä½†æ˜¯åŒæ—¶ï¼Œåœ¨å †æ ˆä¸Šé€‰æ‹©å¹¶ç¦»å¼€å…¶å¸§çš„è¡Œä¼šç»•è¿‡æ­¤ä¼˜åŒ–ï¼Œå› æ­¤è°ƒç”¨æ–¹ä¸ä¼šæ”¶åˆ°å·²ç»é‡Šæ”¾çš„å†…å­˜ã€‚ </li><li> æ­¤å¤–ï¼Œæ‰€æœ‰è¡Œå‡è¢«å¤åˆ¶åˆ°æ–°å­˜å‚¨å™¨ä¸­ã€‚ </li></ol><br><div class="spoiler">  <b class="spoiler_title">concatstringså‡½æ•°çš„å®Œæ•´åˆ—è¡¨</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// concatstrings implements a Go string concatenation x+y+z+... // The operands are passed in the slice a. // If buf != nil, the compiler has determined that the result does not // escape the calling function, so the string data can be stored in buf // if small enough. func concatstrings(buf *tmpBuf, a []string) string { idx := 0 l := 0 count := 0 for i, x := range a { n := len(x) if n == 0 { continue } if l+n &lt; l { throw("string concatenation too long") } l += n count++ idx = i } if count == 0 { return "" } // If there is just one string and either it is not on the stack // or our result does not escape the calling frame (buf != nil), // then we can return that string directly. if count == 1 &amp;&amp; (buf != nil || !stringDataOnStack(a[idx])) { return a[idx] } s, b := rawstringtmp(buf, l) for _, x := range a { copy(b, x) b = b[len(x):] } return s }</span></span></code> </pre> </div></div><br><p> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åŒæ—¶çœ‹åˆ°å‡ ä¸ªå¯ä»¥é’ˆå¯¹ç‰¹å®šæƒ…å†µè¿›è¡Œä¼˜åŒ–çš„åœ°æ–¹ï¼š </p><br><ul><li>  <code>buf</code>é€šå¸¸æ˜¯ç©ºçš„ã€‚ å½“ç¼–è¯‘å™¨æ— æ³•è¯æ˜è¯¥å­—ç¬¦ä¸²å¯å®‰å…¨æ”¾ç½®åœ¨å †æ ˆä¸­æ—¶ï¼Œä¼ é€’ä¸€ä¸ªé¢å¤–çš„å‚æ•°å¹¶åœ¨å‡½æ•°å†…éƒ¨æ£€æŸ¥<code>nil</code>ä»…ä¼šäº§ç”Ÿå¼€é”€ã€‚ </li><li> å¯¹äº<code>len(a) == 2</code>çš„ç‰¹æ®Šæƒ…å†µ<code>len(a) == 2</code>æˆ‘ä»¬ä¸éœ€è¦å¾ªç¯ï¼Œå› æ­¤å¯ä»¥ç®€åŒ–è®¡ç®—ã€‚ è¿™æ˜¯æœ€å¸¸è§çš„ä¸²è”å½¢å¼ã€‚ </li></ul><br><div class="spoiler">  <b class="spoiler_title">ä¸²è”ç»Ÿè®¡</b> <div class="spoiler_text"><p> å½“æ‰§è¡Œ<code>./make.bash</code> ï¼ˆ <code>./make.bash</code> Goç¼–è¯‘å™¨å’Œstdlibï¼‰æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°445ä¸ªå¸¦æœ‰ä¸¤ä¸ªæ“ä½œæ•°çš„è¿æ¥ï¼š </p><br><ul><li>  398ä¸ªç»“æœæ­£åœ¨æ¶ˆå¤±ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ä¸“ä¸šåŒ–æ˜¯æœ‰æ„ä¹‰çš„ã€‚ </li><li>  47ç»“æœä¸ä¼šç¦»å¼€æ‚¨çš„æ¡†æ¶ã€‚ </li></ul><br><p> æ¥è‡ªä¸¤ä¸ªå‚æ•°çš„æ€»è®¡<strong>89ï¼…çš„</strong>ä¸²è”å¾—åˆ°äº†ä¼˜åŒ–ã€‚ </p><br><p> å¯¹äº<code>go</code>å®ç”¨ç¨‹åºï¼Œæˆ‘ä»¬æœ‰ï¼š </p><br><ul><li>  501å‘¼å«concatstring2 </li><li>  194ä¸ªç”µè¯concatstring3 </li><li>  55ä¸ªç”µè¯concatstring4 </li></ul></div></div><br><h1 id="versiya-dlya-vseh-arhitektur"> é€‚ç”¨äºæ‰€æœ‰æ¶æ„çš„ç‰ˆæœ¬ </h1><br><p> è¦å®ç°ä¸“ä¸šåŒ–ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“Goä¸­çš„è¡Œæ˜¯å¦‚ä½•è¡¨ç¤ºçš„ã€‚ äºŒè¿›åˆ¶å…¼å®¹æ€§å¯¹æˆ‘ä»¬å¾ˆé‡è¦ï¼Œè€Œ<code>unsafe.Pointer</code>å¯ä»¥ç”¨<code>*byte</code>æ›¿æ¢è€Œæ— éœ€ä»»ä½•ç‰ºç‰²ã€‚ </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> stringStruct <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { str *<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> <span class="hljs-built_in"><span class="hljs-built_in">len</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> }</code> </pre> <br><p> æˆ‘ä»¬å¯ä»¥ä»è¿è¡Œæ—¶å¾—å‡ºçš„ç¬¬äºŒä¸ªé‡è¦ç»“è®ºæ˜¯ï¼šè¡Œå¼€å§‹å…¶ç”Ÿå‘½å¯å˜ã€‚ åˆ†é…ä¸€å—ç”±<code>[]byte</code>å¼•ç”¨çš„å†…å­˜ï¼Œå°†æ–°è¡Œçš„å†…å®¹å†™å…¥å…¶ä¸­ï¼Œå¹¶ä¸”ä»…åœ¨ä¸¢å¼ƒ<code>[]byte</code>ä¹‹åï¼Œå¹¶å°†å…¶å¼•ç”¨çš„å†…å­˜å­˜å‚¨åœ¨<code>stringStruct</code> ã€‚ </p><br><p> å¯¹äºé‚£äº›æƒ³äº†è§£æ›´å¤šç»†èŠ‚çš„äººï¼Œå»ºè®®ç ”ç©¶<code>rawstringtmp</code>å’Œ<code>rawstring</code>çš„åŠŸèƒ½ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">runtime.rawstring</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// rawstring allocates storage for a new string. The returned // string and byte slice both refer to the same storage. // The storage is not zeroed. Callers should use // b to set the string contents and then drop b. func rawstring(size int) (s string, b []byte) { p := mallocgc(uintptr(size), nil, false) stringStructOf(&amp;s).str = p stringStructOf(&amp;s).len = size *(*slice)(unsafe.Pointer(&amp;b)) = slice{p, size, size} return }</span></span></code> </pre> </div></div><br><p> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>unsafe</code>è½¯ä»¶åŒ…çš„é˜´æš—é¢æ¥å¤§è‡´æé«˜é€Ÿåº¦ï¼š </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">concat2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, y </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { length := <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(x) + <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(y) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> length == <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> } b := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>, length) <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span>(b, x) <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span>(b[<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(x):], y) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> goString(&amp;b[<span class="hljs-number"><span class="hljs-number">0</span></span>], length) }</code> </pre> <br><p> æˆ‘ä»¬çªå‡ºæ˜¾ç¤º<code>[]byte</code> ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥å½¢æˆæ–°è¡Œçš„å†…å®¹ã€‚ ç„¶åï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡å°†å…¶å¸¦åˆ°é¢„æœŸçš„è¿è¡Œæ—¶è¡¨ç¤ºå½¢å¼æ¥å®Œæˆè¯¥è¡Œã€‚  <code>goString</code>å‡½æ•°è´Ÿè´£ï¼š </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">goString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ptr *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">, length </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { s := stringStruct{str: ptr, <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>: length} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *(*<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)(unsafe.Pointer(&amp;s)) }</code> </pre> <br><blockquote> ç»©æ•ˆè¯„çº§ï¼š <strong>91.9ï¼…</strong> ï¼ˆ+10.9ï¼‰ã€‚ </blockquote><br><h1 id="versiya-dlya-amd64">  AMD64ç‰ˆæœ¬ </h1><br><p> ä¸å¹¸çš„æ˜¯ï¼Œè¯¥å‡½æ•°çš„å…ˆå‰ç‰ˆæœ¬æ²¡æœ‰ä¼˜åŒ–ä¸ç©ºå­—ç¬¦ä¸²çš„è¿æ¥ï¼Œå¹¶ä¸”ç”±äºæ— æ³•ç›´æ¥åˆ†é…å†…å­˜ï¼Œæˆ‘ä»¬è¿˜æ‰§è¡Œäº†è®¸å¤šä¸å¿…è¦çš„è®¡ç®—ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨å­—èŠ‚ç‰‡ã€‚ </p><br><p>  Goæ±‡ç¼–å™¨æœ‰è¶£çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯å®ƒå…è®¸æ‚¨è°ƒç”¨ä¾‹å¦‚ä¸å¯å¯¼å‡ºçš„è¿è¡Œæ—¶å‡½æ•°ã€‚ æˆ‘ä»¬å¯ä»¥ä»æ±‡ç¼–ä»£ç ä¸­è°ƒç”¨<code>runtimeÂ·mallocgc</code> ï¼Œå³ä½¿å®ƒä¸æ˜¯<code>runtime</code>åŒ…çš„ä¸€éƒ¨åˆ†ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨æ­¤å±æ€§ã€‚ </p><br><p> æˆ‘ä»¬è¿˜å¯ä»¥æ£€æŸ¥å †æ ˆå­˜å‚¨å™¨è¡Œçš„æ‰€æœ‰æƒï¼Œè¿™ä½¿å¾—å®‰å…¨åœ°ä¼˜åŒ–ä½œä¸ºç»“æœçš„å‚æ•°ä¹‹ä¸€çš„è¿”å›æ˜¯å®‰å…¨çš„ã€‚ </p><br><p> å‡è®¾ä½¿ç”¨å‚æ•°<code>concat2("", "123")</code>è°ƒç”¨å‡½æ•°ã€‚  <code>x</code>æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œå¦‚æœ<code>y</code>æ²¡æœ‰åˆ†é…åœ¨å †æ ˆä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä½œä¸ºä¸²è”çš„ç»“æœè¿”å›ã€‚ </p><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/; ,  x  y   stringStruct. /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/; CX - y.str. /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/; SI - y.len. maybe_return_y: /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/;      . MOVQ (TLS), AX /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/; *g CMPQ CX, (AX) JL return_y /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/;  y_str &lt; g.stack.lo CMPQ CX, 8(AX) JGE return_y /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/;  y_str &gt;= g.stack.hi JMP concatenate /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/; y  ,    return_y: MOVQ CX, ret+32(FP) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/; stringStruct.len MOVQ SI, ret+40(FP) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/; stringStruct.str RET</span></span></code> </pre> <br><p>  <code>MOVQ (TLS), AX</code> <a href="">* g</a>ç§»è‡³<code>AX</code>å¯„å­˜å™¨ã€‚ ä»¥é›¶åç§»é‡è¯»å–å°†å¾—åˆ°<code>g.stack.lo</code>å­—æ®µï¼Œè€Œ<code>g.stack.hi</code>ä»ç¬¬8ä¸ªå­—èŠ‚å¼€å§‹ï¼ˆå¯¹äº64ä½å¹³å°ï¼‰ã€‚ </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> g <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { stack <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { lo <span class="hljs-keyword"><span class="hljs-keyword">uintptr</span></span> <span class="hljs-comment"><span class="hljs-comment">// 0(AX) hi uintptr // 8(AX) } stackguard0 uintptr // 16(AX) stackguard1 uintptr // 24(AX) // ...   }</span></span></code> </pre> <br><p>  <code>concatenate</code>ä¸»ä½“åˆ†é…å†…å­˜ï¼Œç”¨ä¸¤è¡Œå¡«å……å®ƒï¼Œç„¶åè¿”å›æ–°è¡Œã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æœ‰è¯„è®ºçš„å®Œæ•´æ¸…å•</b> <div class="spoiler_text"><pre> <code class="hljs smalltalk"><span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"textflag.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"funcdata.h"</span></span> <span class="hljs-type"><span class="hljs-type">TEXT</span></span> Â·<span class="hljs-type"><span class="hljs-type">Strings</span></span>(<span class="hljs-type"><span class="hljs-type">SB</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">$4</span></span>8<span class="hljs-number"><span class="hljs-number">-48</span></span> <span class="hljs-type"><span class="hljs-type">NO_LOCAL_POINTERS</span></span> //    . <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> x+<span class="hljs-number"><span class="hljs-number">0</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>), <span class="hljs-type"><span class="hljs-type">DX</span></span> <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> x+<span class="hljs-number"><span class="hljs-number">8</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>), <span class="hljs-type"><span class="hljs-type">DI</span></span> <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> y+<span class="hljs-number"><span class="hljs-number">16</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>), <span class="hljs-type"><span class="hljs-type">CX</span></span> <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> y+<span class="hljs-number"><span class="hljs-number">24</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>), <span class="hljs-type"><span class="hljs-type">SI</span></span> <span class="hljs-type"><span class="hljs-type">TESTQ</span></span> <span class="hljs-type"><span class="hljs-type">DI</span></span>, <span class="hljs-type"><span class="hljs-type">DI</span></span> <span class="hljs-type"><span class="hljs-type">JZ</span></span> maybe_return_y // x -  ,   y <span class="hljs-type"><span class="hljs-type">TESTQ</span></span> <span class="hljs-type"><span class="hljs-type">SI</span></span>, <span class="hljs-type"><span class="hljs-type">SI</span></span> <span class="hljs-type"><span class="hljs-type">JZ</span></span> maybe_return_x // y -  ,   x concatenate: <span class="hljs-type"><span class="hljs-type">LEAQ</span></span> (<span class="hljs-type"><span class="hljs-type">DI</span></span>)(<span class="hljs-type"><span class="hljs-type">SI</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-type"><span class="hljs-type">R8</span></span> // len(x) + len(y) //     . <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">R8</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>) <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-string"><span class="hljs-string">$0</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>) <span class="hljs-type"><span class="hljs-type">MOVB</span></span> <span class="hljs-string"><span class="hljs-string">$0</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>) <span class="hljs-type"><span class="hljs-type">CALL</span></span> runtimeÂ·mallocgc(<span class="hljs-type"><span class="hljs-type">SB</span></span>) <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>), <span class="hljs-type"><span class="hljs-type">AX</span></span> //     <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">AX</span></span>, newstr<span class="hljs-number"><span class="hljs-number">-8</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>) //  x. <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> x+<span class="hljs-number"><span class="hljs-number">0</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>), <span class="hljs-type"><span class="hljs-type">DX</span></span> <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> x+<span class="hljs-number"><span class="hljs-number">8</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>), <span class="hljs-type"><span class="hljs-type">DI</span></span> <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">AX</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>) <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">DX</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>) <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">DI</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>) <span class="hljs-type"><span class="hljs-type">CALL</span></span> runtimeÂ·memmove(<span class="hljs-type"><span class="hljs-type">SB</span></span>) //  y   len(x). <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> x+<span class="hljs-number"><span class="hljs-number">8</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>), <span class="hljs-type"><span class="hljs-type">DI</span></span> <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> y+<span class="hljs-number"><span class="hljs-number">16</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>), <span class="hljs-type"><span class="hljs-type">CX</span></span> <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> y+<span class="hljs-number"><span class="hljs-number">24</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>), <span class="hljs-type"><span class="hljs-type">SI</span></span> <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> newstr<span class="hljs-number"><span class="hljs-number">-8</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>), <span class="hljs-type"><span class="hljs-type">AX</span></span> <span class="hljs-type"><span class="hljs-type">LEAQ</span></span> (<span class="hljs-type"><span class="hljs-type">AX</span></span>)(<span class="hljs-type"><span class="hljs-type">DI</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-type"><span class="hljs-type">BX</span></span> <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">BX</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>) <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">CX</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>) <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">SI</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>) <span class="hljs-type"><span class="hljs-type">CALL</span></span> runtimeÂ·memmove(<span class="hljs-type"><span class="hljs-type">SB</span></span>) //   . <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> newstr<span class="hljs-number"><span class="hljs-number">-8</span></span>(<span class="hljs-type"><span class="hljs-type">SP</span></span>), <span class="hljs-type"><span class="hljs-type">AX</span></span> <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> x+<span class="hljs-number"><span class="hljs-number">8</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>), <span class="hljs-type"><span class="hljs-type">R8</span></span> <span class="hljs-type"><span class="hljs-type">ADDQ</span></span> y+<span class="hljs-number"><span class="hljs-number">24</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>), <span class="hljs-type"><span class="hljs-type">R8</span></span> <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">AX</span></span>, ret+<span class="hljs-number"><span class="hljs-number">32</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>) <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">R8</span></span>, ret+<span class="hljs-number"><span class="hljs-number">40</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>) <span class="hljs-type"><span class="hljs-type">RET</span></span> maybe_return_y: //      . <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> (<span class="hljs-type"><span class="hljs-type">TLS</span></span>), <span class="hljs-type"><span class="hljs-type">AX</span></span> // *g <span class="hljs-type"><span class="hljs-type">CMPQ</span></span> <span class="hljs-type"><span class="hljs-type">CX</span></span>, (<span class="hljs-type"><span class="hljs-type">AX</span></span>) <span class="hljs-type"><span class="hljs-type">JL</span></span> return_y //  y_ptr &lt; stk.lo <span class="hljs-type"><span class="hljs-type">CMPQ</span></span> <span class="hljs-type"><span class="hljs-type">CX</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>(<span class="hljs-type"><span class="hljs-type">AX</span></span>) <span class="hljs-type"><span class="hljs-type">JGE</span></span> return_y //  y_ptr &gt;= stk.hi <span class="hljs-type"><span class="hljs-type">JMP</span></span> concatenate // y  ,    return_y: <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">CX</span></span>, ret+<span class="hljs-number"><span class="hljs-number">32</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>) <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">SI</span></span>, ret+<span class="hljs-number"><span class="hljs-number">40</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>) <span class="hljs-type"><span class="hljs-type">RET</span></span> maybe_return_x: //      . <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> (<span class="hljs-type"><span class="hljs-type">TLS</span></span>), <span class="hljs-type"><span class="hljs-type">AX</span></span> // *g <span class="hljs-type"><span class="hljs-type">CMPQ</span></span> <span class="hljs-type"><span class="hljs-type">DX</span></span>, (<span class="hljs-type"><span class="hljs-type">AX</span></span>) <span class="hljs-type"><span class="hljs-type">JL</span></span> return_x //  x_ptr &lt; stk.lo <span class="hljs-type"><span class="hljs-type">CMPQ</span></span> <span class="hljs-type"><span class="hljs-type">DX</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>(<span class="hljs-type"><span class="hljs-type">AX</span></span>) <span class="hljs-type"><span class="hljs-type">JGE</span></span> return_x //  x_ptr &gt;= stk.hi <span class="hljs-type"><span class="hljs-type">JMP</span></span> concatenate // x  ,    return_x: <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">DX</span></span>, ret+<span class="hljs-number"><span class="hljs-number">32</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>) <span class="hljs-type"><span class="hljs-type">MOVQ</span></span> <span class="hljs-type"><span class="hljs-type">DI</span></span>, ret+<span class="hljs-number"><span class="hljs-number">40</span></span>(<span class="hljs-type"><span class="hljs-type">FP</span></span>) <span class="hljs-type"><span class="hljs-type">RET</span></span></code> </pre> <br><p> å¦‚æœæ‚¨å¯¹è¿™æ®µä»£ç ä¸­çš„<code>NO_LOCAL_POINTERS</code>çš„æ€§è´¨æ„Ÿå…´è¶£ï¼Œå¯ä»¥é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»asmè°ƒç”¨Goå‡½æ•°ï¼ˆâ€œä¸¥é‡é”™è¯¯ï¼šç¼ºå°‘å †æ ˆæ˜ å°„â€ï¼‰</a> ã€‚ </p></div></div><br><blockquote> ç»©æ•ˆç­‰çº§ï¼š <strong>100ï¼…</strong> ï¼ˆ+8.6ï¼‰ã€‚ </blockquote><br><h1 id="v-kachestve-zaklyucheniya"> æ€»ç»“ </h1><br><p> æ‰€æœ‰ä»£ç å‡ä½œä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">concat</a>è½¯ä»¶åŒ…æä¾›ã€‚ </p><br><p> ä¸–ç•Œå·²ç»å‡†å¤‡å¥½è¿›è¡Œå¦‚æ­¤å¿«é€Ÿçš„ä¸²è”äº†å—ï¼Ÿ è°çŸ¥é“ </p><br><p> åœ¨æœ¬æ–‡çš„å¼€å¤´ï¼Œæåˆ°äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CL123256</a> ã€‚ ä»–æœ‰å‡ ç§å‘å±•é“è·¯ï¼š </p><br><ol><li> ç¼–è¯‘å™¨æœªåˆ†é…ä¸´æ—¶ç¼“å†²åŒºçš„æƒ…å†µä¸‹çš„å˜ä½“ä¸“ç”¨åŒ–ã€‚ æ¯ç§æƒ…å†µçš„å¢é•¿éƒ½è¾ƒå°‘ï¼Œä½†æ˜¯å®ƒæ¶µç›–äº†æ›´å¤šçš„ä¸²è”ç±»å‹ï¼Œå¹¶ä¸”å®é™…ä¸Šå¹¶æ²¡æœ‰å¢åŠ ä»£ç çš„å¤§å°ï¼ˆåŒ…æ‹¬æœºå™¨ä»£ç å’ŒGoä»£ç ï¼‰ã€‚ </li><li> é’ˆå¯¹ç‰¹æ®Šæƒ…å†µçš„æ›´å¤šä¸“ä¸šçŸ¥è¯†ã€‚ æ›´é«˜çš„æ”¶ç›Šï¼Œä½†æ˜¯æ›´å¤šçš„æœºå™¨ä»£ç ï¼Œå¯èƒ½ä¼šæŸå®³æŒ‡ä»¤ç¼“å­˜ã€‚ </li><li> é’ˆå¯¹æ¯ç§ç‰¹æ®Šæƒ…å†µå’Œç‰¹æ®Šè®°å¿†çš„å¤§é‡æœºå™¨ä»£ç ï¼Œä»¥glibcä¸­çš„æ–¹å¼è¿›è¡Œã€‚ è¿™é‡Œä¸»è¦æ˜¯æƒå®œä¹‹è®¡ã€‚ </li></ol><br><p> å½“å‰æå‡ºçš„é€‰é¡¹åªä¼šåŠ é€Ÿæœ€å¸¸è§çš„ä¸€å¯¹å­—ç¬¦ä¸²ä¸²è”ï¼ˆarity = 2ï¼‰çš„æƒ…å†µã€‚ </p><br><p> å¦‚æœGoä¸æ¥å—æ­¤æ›´æ”¹ï¼Œåˆ™å¯ä»¥é€šè¿‡ä»¥ç¬¬ä¸‰æ–¹åº“çš„å½¢å¼å®ç°å­—ç¬¦ä¸²æ“ä½œæ¥å®ç°å¯æ¯”çš„åŠ é€Ÿã€‚ ä¸å¤ªæ–¹ä¾¿ï¼Œç¾è§‚å¤§æ–¹ï¼Œä½†å¯ä»¥ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN417479/">https://habr.com/ru/post/zh-CN417479/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt486164/index.html">CoronavÃ­rus 2019-nCoV. Perguntas frequentes sobre proteÃ§Ã£o respiratÃ³ria e desinfecÃ§Ã£o</a></li>
<li><a href="../pt486174/index.html">Tenho rotatividade zero</a></li>
<li><a href="../zh-CN417473/index.html">ä½¿ç”¨DRBD9å’ŒProxmoxçš„å¯ä¿¡å­˜å‚¨ï¼ˆç¬¬1éƒ¨åˆ†ï¼šNFSï¼‰</a></li>
<li><a href="../zh-CN417475/index.html">Glusterfs +çº åˆ ç ï¼šå½“æ‚¨éœ€è¦å¤§é‡ï¼Œä¾¿å®œä¸”å¯é æ—¶</a></li>
<li><a href="../zh-CN417477/index.html">çƒ­æ¡Œ</a></li>
<li><a href="../zh-CN417481/index.html">å…³äºJavaScript ES6ä¸­çš„ç”Ÿæˆå™¨ï¼Œä»¥åŠä¸ºä»€ä¹ˆå¯ä»¥é€‰æ‹©ç ”ç©¶å®ƒä»¬</a></li>
<li><a href="../zh-CN417483/index.html">JSæ¡†æ¶æ¯”è¾ƒï¼šReactï¼ŒVueå’ŒHyperapp</a></li>
<li><a href="../zh-CN417485/index.html">[ä¹¦ç­¾] Linuxç½‘ç»œå·¥å…·çš„ç³»ç»Ÿç®¡ç†å‘˜å¤‡å¿˜å•</a></li>
<li><a href="../zh-CN417487/index.html">ä¿„ç½—æ–¯äº’è”ç½‘å¼€å§‹çš„åœ°æ–¹</a></li>
<li><a href="../zh-CN417489/index.html">ã€Š 2018å¹´ç½—é©¬ä¿±ä¹éƒ¨æŠ¥å‘Šã€‹ç¬¬3.4ç« ï¼šâ€œåˆ†æ•£å¼èƒ½æºâ€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>