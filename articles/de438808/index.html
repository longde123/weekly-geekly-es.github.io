<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üß• üàöÔ∏è üë®‚Äçüîß ModelMapper: Hin- und R√ºckfahrt ‚å®Ô∏è ‚ñ´Ô∏è üñ±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aus bekannten Gr√ºnden kann das Backend keine Daten aus dem Repository zur√ºckgeben. Die bekanntesten - die wesentlichen Abh√§ngigkeiten werden nicht von...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ModelMapper: Hin- und R√ºckfahrt</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438808/"><img src="https://habrastorage.org/webt/pv/af/jp/pvafjpvwzjks_dgn_429dotjm5g.jpeg" alt="Bild"><br><br>  Aus bekannten Gr√ºnden kann das Backend keine Daten aus dem Repository zur√ºckgeben.  Die bekanntesten - die wesentlichen Abh√§ngigkeiten werden nicht von der Basis in der Form genommen, in der die Front sie verstehen kann.  Hier k√∂nnen Sie Schwierigkeiten beim Parsen von Enum hinzuf√ºgen (wenn die Enum-Felder zus√§tzliche Parameter enthalten) und viele andere Schwierigkeiten, die sich aus dem automatischen Typumwandeln ergeben (oder der Unf√§higkeit, sie automatisch umzuwandeln).  Dies impliziert die Notwendigkeit, ein Daten√ºbertragungsobjekt (DTO) zu verwenden, das sowohl f√ºr die R√ºckseite als auch f√ºr die Vorderseite verst√§ndlich ist. <a name="habracut"></a><br>  Das Konvertieren einer Entit√§t in ein DTO kann auf viele verschiedene Arten erfolgen.  Sie k√∂nnen die Bibliothek verwenden und (wenn das Projekt klein ist) Folgendes zusammenstellen: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemMapperImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemMapper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> OrderRepository orderRepository; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ItemMapperImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OrderRepository orderRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.orderRepository = orderRepository; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Item </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ItemDto dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Item( dto.getId(), obtainOrder(dto.getOrderId()), dto.getArticle(), dto.getName(), dto.getDisplayName(), dto.getWeight(), dto.getCost(), dto.getEstimatedCost(), dto.getQuantity(), dto.getBarcode(), dto.getType() ); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ItemDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Item item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ItemDto( item.getId(), obtainOrderId(item), item.getArticle(), item.getName(), item.getDisplayName(), item.getWeight(), item.getCost(), item.getEstimatedCost(), item.getQuantity(), item.getBarcode(), item.getType() ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">obtainOrderId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Item item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.nonNull(item.getOrder()) ? item.getOrder().getId() : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Order </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">obtainOrder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long orderId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.nonNull(orderId) ? orderRepository.findById(orderId).orElse(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre> <br>  Solche selbstgeschriebenen Mapper haben offensichtliche Nachteile: <br><br><ol><li>  Nicht skalieren. </li><li>  Wenn Sie selbst das unbedeutendste Feld hinzuf√ºgen / entfernen, m√ºssen Sie den Mapper bearbeiten. </li></ol><br>  Daher ist die richtige L√∂sung die Verwendung einer Mapper-Bibliothek.  Ich kenne Modelmapper und Mapstruct.  Da ich mit modelmapper gearbeitet habe, werde ich dar√ºber sprechen, aber wenn Sie, mein Leser, mit mapstruct gut vertraut sind und √ºber alle Feinheiten seiner Anwendung Bescheid wissen, schreiben Sie bitte einen Artikel dar√ºber, und ich werde der erste sein, der es mir schreibt (diese Bibliothek ist auch sehr interessant, aber es ist noch keine Zeit, es einzugeben). <br><br>  Also Modelmapper. <br><br>  Ich m√∂chte sofort sagen, dass Sie, wenn Ihnen etwas nicht klar ist, das fertige Projekt mit einem Arbeitstest herunterladen k√∂nnen, einem Link am Ende des Artikels. <br><br>  Der erste Schritt ist nat√ºrlich das Hinzuf√ºgen einer Abh√§ngigkeit.  Ich verwende gradle, aber es ist einfach f√ºr Sie, Ihrem Maven-Projekt eine Abh√§ngigkeit hinzuzuf√ºgen. <br><br><pre> <code class="java hljs">compile group: <span class="hljs-string"><span class="hljs-string">'org.modelmapper'</span></span>, name: <span class="hljs-string"><span class="hljs-string">'modelmapper'</span></span>, version: <span class="hljs-string"><span class="hljs-string">'2.3.2'</span></span></code> </pre> <br>  Dies reicht aus, damit der Mapper funktioniert.  Als n√§chstes m√ºssen wir einen Bin erstellen. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ModelMapper </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">modelMapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ModelMapper mapper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ModelMapper(); mapper.getConfiguration() .setMatchingStrategy(MatchingStrategies.STRICT) .setFieldMatchingEnabled(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setSkipNullEnabled(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setFieldAccessLevel(PRIVATE); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mapper; }</code> </pre> <br>  Normalerweise reicht es aus, einfach einen neuen ModelMapper zur√ºckzugeben, aber es ist nicht √ºberfl√ºssig, den Mapper f√ºr unsere Anforderungen zu konfigurieren.  Ich habe eine strikte √úbereinstimmungsstrategie festgelegt, die Feldzuordnung aktiviert, Nullfelder √ºbersprungen und eine private Zugriffsebene f√ºr die Felder festgelegt. <br><br>  Erstellen Sie als N√§chstes die folgende Entit√§tsstruktur.  Wir werden ein Einhorn haben, dem eine bestimmte Anzahl von Droiden untergeordnet ist, und jeder Droide wird eine bestimmte Anzahl von Cupcakes haben. <br><br><div class="spoiler">  <b class="spoiler_title">Entit√§ten</b> <div class="spoiler_text"><blockquote>  Abstraktes Elternteil: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@MappedSuperclass</span></span> <span class="hljs-meta"><span class="hljs-meta">@Setter</span></span> <span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ Long id; LocalDateTime created; LocalDateTime updated; <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"created"</span></span>, updatable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LocalDateTime </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> created; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"updated"</span></span>, insertable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LocalDateTime </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUpdated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> updated; } <span class="hljs-meta"><span class="hljs-meta">@PrePersist</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ setCreated(LocalDateTime.now()); } <span class="hljs-meta"><span class="hljs-meta">@PreUpdate</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ setUpdated(LocalDateTime.now()); } }</code> </pre> <br><blockquote>  Einhorn: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"unicorns"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Setter</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Unicorn</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Droid&gt; droids; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Color color; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Unicorn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, Color color)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.color = color; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"name"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span>(fetch = FetchType.EAGER, cascade = CascadeType.ALL, mappedBy = <span class="hljs-string"><span class="hljs-string">"unicorn"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Droid&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDroids</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> droids; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"color"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Color </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getColor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color; } }</code> </pre> <br><blockquote>  Droide: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Setter</span></span> <span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"droids"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Droid</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Unicorn unicorn; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Cupcake&gt; cupcakes; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Boolean alive; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Droid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, Unicorn unicorn, Boolean alive)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unicorn = unicorn; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.alive = alive; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Droid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, Boolean alive)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.alive = alive; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"name"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(fetch = FetchType.EAGER) <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"unicorn_id"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Unicorn </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUnicorn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> unicorn; } <span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span>(fetch = FetchType.EAGER, cascade = CascadeType.ALL, mappedBy = <span class="hljs-string"><span class="hljs-string">"droid"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Cupcake&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCupcakes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cupcakes; } <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"alive"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAlive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> alive; } }</code> </pre> <br><blockquote>  Cupcake: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"cupcakes"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Setter</span></span> <span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cupcake</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Filling filling; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Droid droid; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"filling"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Filling </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFilling</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filling; } <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(fetch = FetchType.EAGER) <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"droid_id"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Droid </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDroid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> droid; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cupcake</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Filling filling)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filling = filling; } }</code> </pre> <br></div></div><br>  Wir werden diese Entit√§ten in DTO konvertieren.  Es gibt mindestens zwei Ans√§tze zum Konvertieren von Abh√§ngigkeiten von einer Entit√§t in ein DTO.  Man impliziert, dass nur die ID anstelle der Entit√§t gespeichert wird, aber dann wird jede Entit√§t aus der Abh√§ngigkeit, falls erforderlich, zus√§tzlich die ID abgerufen.  Der zweite Ansatz besteht darin, das DTO abh√§ngig zu halten.  Im ersten Ansatz w√ºrden wir Listendroiden in Listendroiden konvertieren (wir speichern nur IDs in der neuen Liste), und im zweiten Ansatz werden wir in Listendroiden speichern. <br><br><div class="spoiler">  <b class="spoiler_title">DTO</b> <div class="spoiler_text"><blockquote>  Abstraktes Elternteil: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@JsonFormat</span></span>(shape = JsonFormat.Shape.STRING, pattern = <span class="hljs-string"><span class="hljs-string">"yyyy-MM-dd HH:mm:ss.SSS"</span></span>) LocalDateTime created; <span class="hljs-meta"><span class="hljs-meta">@JsonFormat</span></span>(shape = JsonFormat.Shape.STRING, pattern = <span class="hljs-string"><span class="hljs-string">"yyyy-MM-dd HH:mm:ss.SSS"</span></span>) LocalDateTime updated; }</code> </pre> <br><blockquote>  UnicornDto: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornDto</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;DroidDto&gt; droids; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String color; }</code> </pre> <br><blockquote>  DroidDto: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidDto</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;CupcakeDto&gt; cupcakes; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UnicornDto unicorn; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Boolean alive; }</code> </pre> <br><blockquote>  CupcakeDto: </blockquote><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CupcakeDto</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String filling; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DroidDto droid; }</code> </pre> <br></div></div><br>  Um den Mapper an unsere Anforderungen anzupassen, m√ºssen wir unsere eigene Wrapper-Klasse erstellen und die Logik f√ºr die Zuordnung von Sammlungen neu definieren.  Dazu erstellen wir eine Komponentenklasse UnicornMapper, ordnen unseren Mapper dort automatisch zu und definieren die ben√∂tigten Methoden neu. <br><br>  Die einfachste Version der Wrapper-Klasse sieht folgenderma√üen aus: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornMapper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ModelMapper mapper; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Unicorn </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UnicornDto dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.isNull(dto) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : mapper.map(dto, Unicorn.class); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UnicornDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Unicorn entity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.isNull(entity) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : mapper.map(entity, UnicornDto.class); } }</code> </pre> <br>  Jetzt reicht es aus, unseren Mapper automatisch in einen Dienst zu verdrahten und mit den Methoden toDto und toEntity zu ziehen.  Der Mapper wandelt die im Objekt gefundenen Entit√§ten in DTO, DTO - in Entit√§ten um. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> UnicornRepository repository; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> UnicornMapper mapper; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnicornServiceImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UnicornRepository repository, UnicornMapper mapper)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.repository = repository; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mapper = mapper; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UnicornDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UnicornDto dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mapper.toDto(repository.save(mapper.toEntity(dto))); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UnicornDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mapper.toDto(repository.getOne(id)); } }</code> </pre> <br>  Wenn wir jedoch versuchen, etwas auf diese Weise zu konvertieren und dann beispielsweise toString aufrufen, erhalten wir eine StackOverflowException. Hier ist der Grund: UnicornDto enth√§lt die DroidDto-Liste, die UnicornDto enth√§lt, die DroidDto enth√§lt, und so weiter bis zu diesem Moment bis der Stapelspeicher aufgebraucht ist.  Daher verwende ich f√ºr inverse Abh√§ngigkeiten normalerweise nicht UnicornDto Unicorn, sondern Long UnicornId.  Auf diese Weise bleiben wir mit Unicorn in Kontakt, schneiden aber die zyklische Abh√§ngigkeit ab.  Korrigieren wir unsere DTOs so, dass sie anstelle von umgekehrten DTOs die IDs ihrer Abh√§ngigkeiten speichern. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@EqualsAndHashCode</span></span>(callSuper = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidDto</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">//private UnicornDto unicorn; private Long unicornId; ... }</span></span></code> </pre> <br>  usw. <br><br>  Aber jetzt, wenn wir DroidMapper aufrufen, erhalten wir unicornId == null.  Dies liegt daran, dass ModelMapper nicht genau bestimmen kann, was Long ist.  Und st√∂rt ihn einfach nicht.  Und wir m√ºssen die erforderlichen Mapper optimieren, um ihnen das Zuordnen von Entit√§ten in IDs beizubringen. <br><br>  Wir erinnern uns, dass Sie mit jedem Bin nach seiner Initialisierung manuell arbeiten k√∂nnen. <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@PostConstruct</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupMapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mapper.createTypeMap(Droid.class, DroidDto.class) .addMappings(m -&gt; m.skip(DroidDto::setUnicornId)).setPostConverter(toDtoConverter()); mapper.createTypeMap(DroidDto.class, Droid.class) .addMappings(m -&gt; m.skip(Droid::setUnicorn)).setPostConverter(toEntityConverter()); }</code> </pre> <br>  In @PostConstruct legen wir die Regeln fest, in denen wir angeben, welche Felder der Mapper nicht ber√ºhren soll, da wir f√ºr sie die Logik selbst bestimmen.  In unserem Fall ist dies sowohl die Definition von unicornId im DTO als auch die Definition von Unicorn im Wesentlichen (da der Mapper auch nicht wei√ü, was er mit Long unicornId tun soll). <br><br>  TypeMap - Dies ist die Regel, in der wir alle Nuancen der Zuordnung angeben und auch den Konverter festlegen.  Wir haben darauf hingewiesen, dass wir zum Konvertieren von Droid nach DroidDto setUnicornId √ºberspringen und bei der umgekehrten Konvertierung setUnicorn √ºbergeben.  Wir werden alle in den toDtoConverter () -Konverter f√ºr UnicornDto und in toEntityConverter () f√ºr Unicorn konvertieren.  Wir m√ºssen diese Konverter in unserer Komponente beschreiben. <br><br>  Der einfachste Post-Converter sieht folgenderma√üen aus: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-function">Converter&lt;UnicornDto, Unicorn&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntityConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MappingContext::getDestination; }</code> </pre> <br>  Wir m√ºssen seine Funktionalit√§t erweitern: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Converter&lt;UnicornDto, Unicorn&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntityConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context -&gt; { UnicornDto source = context.getSource(); Unicorn destination = context.getDestination(); mapSpecificFields(source, destination); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getDestination(); }; }</code> </pre> <br>  Wir machen dasselbe mit dem inversen Konverter: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Converter&lt;Unicorn, UnicornDto&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDtoConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context -&gt; { Unicorn source = context.getSource(); UnicornDto destination = context.getDestination(); mapSpecificFields(source, destination); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getDestination(); }; }</code> </pre> <br>  Tats√§chlich f√ºgen wir einfach eine zus√§tzliche Methode in jeden Nachkonverter ein, in der wir unsere eigene Logik f√ºr die fehlenden Felder schreiben. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Droid source, DroidDto destination)</span></span></span><span class="hljs-function"> </span></span>{ destination.setUnicornId(Objects.isNull(source) || Objects.isNull(source.getId()) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : source.getUnicorn().getId()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DroidDto source, Droid destination)</span></span></span><span class="hljs-function"> </span></span>{ destination.setUnicorn(unicornRepository.findById(source.getUnicornId()).orElse(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)); }</code> </pre> <br>  Bei der Zuordnung in DTO legen wir die Entit√§ts-ID fest.  Bei der Zuordnung in DTO erhalten wir die Entit√§t anhand der ID aus dem Repository. <br><br>  Und alle. <br><br>  Ich habe das notwendige Minimum gezeigt, um mit Modelmapper zu arbeiten, und den Code nicht besonders √ºberarbeitet.  Wenn Sie, Leser, etwas zu meinem Artikel hinzuf√ºgen m√∂chten, w√ºrde ich mich √ºber konstruktive Kritik freuen. <br><br>  Das Projekt kann hier angesehen werden: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Projekt auf GitHub.</a> <br><br>  Fans von sauberem Code sahen wahrscheinlich bereits die M√∂glichkeit, viele der Codekomponenten in eine Abstraktion zu treiben.  Wenn Sie einer von ihnen sind, schlage ich unter Katze vor. <br><br><div class="spoiler">  <b class="spoiler_title">Erh√∂hen Sie die Abstraktionsebene</b> <div class="spoiler_text">  Zun√§chst definieren wir eine Schnittstelle f√ºr die grundlegenden Methoden der Wrapper-Klasse. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mapper</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">E </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(D dto)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E entity)</span></span></span></span>; }</code> </pre> <br>  Wir erben davon eine abstrakte Klasse. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMapper</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractEntity</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractDto</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mapper</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> ModelMapper mapper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Class&lt;E&gt; entityClass; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Class&lt;D&gt; dtoClass; AbstractMapper(Class&lt;E&gt; entityClass, Class&lt;D&gt; dtoClass) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityClass = entityClass; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dtoClass = dtoClass; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> E </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(D dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.isNull(dto) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : mapper.map(dto, entityClass); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E entity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.isNull(entity) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : mapper.map(entity, dtoClass); } <span class="hljs-function"><span class="hljs-function">Converter&lt;E, D&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toDtoConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context -&gt; { E source = context.getSource(); D destination = context.getDestination(); mapSpecificFields(source, destination); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getDestination(); }; } <span class="hljs-function"><span class="hljs-function">Converter&lt;D, E&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toEntityConverter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context -&gt; { D source = context.getSource(); E destination = context.getDestination(); mapSpecificFields(source, destination); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getDestination(); }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E source, D destination)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(D source, E destination)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br>  Postkonverter und Methoden zum Ausf√ºllen bestimmter Felder k√∂nnen sicher dorthin gesendet werden.  Erstellen Sie au√üerdem zwei Objekte vom Typ Class und einen Konstruktor, um sie zu initialisieren: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Class&lt;E&gt; entityClass; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Class&lt;D&gt; dtoClass; AbstractMapper(Class&lt;E&gt; entityClass, Class&lt;D&gt; dtoClass) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityClass = entityClass; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dtoClass = dtoClass; }</code> </pre> <br>  Jetzt wird die Codemenge in DroidMapper auf Folgendes reduziert: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidMapper</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMapper</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Droid</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidDto</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ModelMapper mapper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> UnicornRepository unicornRepository; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DroidMapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ModelMapper mapper, UnicornRepository unicornRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(Droid.class, DroidDto.class); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mapper = mapper; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unicornRepository = unicornRepository; } <span class="hljs-meta"><span class="hljs-meta">@PostConstruct</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupMapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mapper.createTypeMap(Droid.class, DroidDto.class) .addMappings(m -&gt; m.skip(DroidDto::setUnicornId)).setPostConverter(toDtoConverter()); mapper.createTypeMap(DroidDto.class, Droid.class) .addMappings(m -&gt; m.skip(Droid::setUnicorn)).setPostConverter(toEntityConverter()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Droid source, DroidDto destination)</span></span></span><span class="hljs-function"> </span></span>{ destination.setUnicornId(getId(source)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Droid source)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Objects.isNull(source) || Objects.isNull(source.getId()) ? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> : source.getUnicorn().getId(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapSpecificFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DroidDto source, Droid destination)</span></span></span><span class="hljs-function"> </span></span>{ destination.setUnicorn(unicornRepository.findById(source.getUnicornId()).orElse(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)); } }</code> </pre> <br>  Ein Mapper ohne bestimmte Felder sieht im Allgemeinen einfach aus: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornMapper</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMapper</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Unicorn</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UnicornDto</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnicornMapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(Unicorn.class, UnicornDto.class); } }</code> </pre> <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de438808/">https://habr.com/ru/post/de438808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de438798/index.html">Umgang mit Cyber-Intelligence-Daten: Wir lernen, Indikatoren f√ºr Systemkompromisse zu sammeln und zu identifizieren</a></li>
<li><a href="../de438800/index.html">PHP Pear gehackt und nicht verf√ºgbar</a></li>
<li><a href="../de438802/index.html">Sommerprogramme f√ºr 2019 f√ºr das Unterrichten von Teenagern, die im Ausland programmieren</a></li>
<li><a href="../de438804/index.html">Warten auf alle beim n√§chsten CocoaHeads Meetup</a></li>
<li><a href="../de438806/index.html">Probleme der literarischen √úbersetzung</a></li>
<li><a href="../de438810/index.html">HTTP / 3: von der Wurzel bis zur Spitze</a></li>
<li><a href="../de438812/index.html">HH-Front-End-Codequalit√§t</a></li>
<li><a href="../de438814/index.html">Ein n√ºchterner Blick auf Helm 2: "Das ist es ..."</a></li>
<li><a href="../de438818/index.html">UDB. Was ist das Teil 5. Datenpfad. N√ºtzliche Kleinigkeiten</a></li>
<li><a href="../de438820/index.html">Wissensmanagement: Welche Dokumente werden ben√∂tigt und was muss in ihnen repariert werden?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>