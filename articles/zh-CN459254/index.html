<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚴🏿 🥈 🍱 更好的拉链炸弹 🎬 ☮️ 👺</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文介绍了如何创建一个非递归 zip炸弹 ，该炸弹通过在zip容器内重叠文件来提供高度压缩。 “非递归”表示它不依赖于解压缩程序来解压缩zip存档中附加的文件：只有一轮。 输出大小从输入开始呈平方增加，在zip格式中压缩比达到2800万（10 MB→281 TB）以上。 使用64位扩展可以进一步扩展...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>更好的拉链炸弹</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459254/">本文介绍了如何创建一个<i>非递归</i> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">zip炸弹</a> ，该<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">炸弹</a>通过在zip容器内重叠文件来提供高度压缩。  “非递归”表示它不依赖于解压缩程序来解压缩zip存档中附加的文件：只有一轮。 输出大小从输入开始呈平方增加，在zip格式中压缩比达到2800万（10 MB→281 TB）以上。 使用64位扩展可以进一步扩展。 该设计仅使用最常用的DEFLATE压缩算法，并且与大多数zip解析器兼容。 <br><br><a name="2"></a><ul><li>  <a href="">zbsm.zip</a> 42 kB→5.5 GB <br></li><li>  <a href="">zblg.zip</a> 10 MB→281 TB <br></li><li>  <a href="">zbxl.zip</a> 46 MB→4.5 PB（Zip64，与解析器不兼容） </li></ul><br> 源代码： <br><pre>  git clone https://www.bamsoftware.com/git/zipbomb.git </pre>  <a href="">zipbomb-20190702.zip</a> <br><br> 数据和插图来源： <br><pre>  git克隆https://www.bamsoftware.com/git/zipbomb-paper.git </pre><a name="habracut"></a><br><div class="scrollable-table"><table><thead><tr><td colspan="2"></td><th colspan="2"> 非递归 </th><th colspan="2"> 递归的 </th></tr><tr><td></td><th> 档案大小 </th><th> 未压缩尺寸 </th><th> 比率 </th><th> 未压缩尺寸 </th><th> 比率 </th></tr></thead><tbody><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">奎因·考克斯</a> </th><td>  440 </td><td>  440 </td><td>  1.0 </td><td>  ∞ </td><td>  ∞ </td></tr><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://web.archive.org/web/20160130230432/">奎因·埃林森</a> </th><td>  28,809 </td><td>  42569 </td><td>  1.5 </td><td>  ∞ </td><td>  ∞ </td></tr><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">42.zip</a> </th><td>  42,374 * </td><td>  558432 </td><td>  13.2 </td><td>  450798134334302616 </td><td>  1060亿 </td></tr><tr><th> 这种技术 </th><td>  42,374 </td><td>  5461307620 </td><td>  129000 </td><td>  5461307620 </td><td>  129000 </td></tr><tr><th> 这种技术 </th><td>  9893525 </td><td>  281395456244934 </td><td>  2800万 </td><td>  281395456244934 </td><td>  2800万 </td></tr><tr><th> 这种技术（Zip64） </th><td>  45876952 </td><td>  4507981427706706459 </td><td>  9800万 </td><td>  4507981427706706459 </td><td>  9800万 </td></tr></tbody></table></div><br>  <sub>* 42.zip有两个版本： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://web.archive.org/web/20120222083624/">旧的</a> 42 374字节和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://web.archive.org/web/20120301154142/">较新的</a> 42 428字节。</sub>  <sub>区别在于，新密码在打开包装之前需要输入密码。</sub>  <sub>我们仅与旧版本进行比较。</sub>  <sub>如果需要，这里是文件的副本： <a href="">42.zip</a> 。</sub> <sub><br><br></sub>  <sub>**我想知道并指出42.zip的作者，但找不到它-如果您有任何信息，请告诉我。</sub> <br><br> 拉链炸弹必须克服以下事实：解析器最常支持的DEFLATE压缩算法<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">不能超过</a> 1032：1 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a>压缩率。因此，拉链炸弹通常依靠递归解压缩，方法是将zip文件插入zip文件中以获得额外的比率。每层1032。 但是，该技巧仅适用于以递归方式解压缩的实现，而大多数情况下无效。 如果将所有六个层递归解压缩，则最著名的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">42.zip</a>炸弹可扩展到强大的4.5 PB，但在顶层则只有0.6 MB的小空间。 像<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Cox</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://web.archive.org/web/20160130230432/">Ellingsen的</a>那些一样，Zip quines会发行自己的副本，因此在递归解压缩时会无限期地扩展。 但是，一旦打开包装，它们也是完全安全的。 <br><br> 本文介绍了如何创建一个非递归zip炸弹，该炸弹的压缩率超过DEFLATE限制1032。它通过在zip容器内重叠文件以引用多个文件中的高度压缩数据的“核心”而不进行多次复制而起作用。 拉链炸弹的输出大小从输入大小开始呈平方增长； 即，压缩比随着炸弹尺寸的增加而提高。 设计取决于zip和DEFLATE的功能：无法将其直接传输为其他文件格式或压缩算法。 该炸弹与大多数zip解析器兼容，除了“流”解析器外，该解析器可以一遍分析文件而无需检查zip文件的中央目录。 我们试图平衡两个相互矛盾的目标： <br><br><ul><li> 增加压缩率。 我们将压缩率定义为存档中所有文件大小的总和除以zip文件本身的大小。 它不考虑文件名或其他文件系统元数据，而仅考虑内容。 <br></li><li> 保持兼容性。  Zip是一种复杂的格式，解析器也有所不同，尤其是在边界情况下，以及附加功能。 不要使用仅适用于某些解析器的技术。 我们将注意到在不增加兼容性的情况下提高拉链炸弹效率的一些方法。 </li></ul><br><h1> 压缩文件结构 </h1><br> 压缩文件由文件链接的<i>中央目录</i>组成。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/896/5d8/074/8965d80745e0b95831b8e3f7c68c5386.svg"><br><br> 中央目录位于zip文件的末尾。 这是<i>中央目录头</i>的列表。 每个中央目录头均包含单个文件的元数据，例如文件名和CRC-32校验和，以及指向本地文件头的指针。 中央目录头的长度为46个字节，再加上文件名的长度。 <br><br> 该文件由本地文件的标头和紧随其后的压缩文件数据组成。 本地文件头的长度为30个字节加上文件名的长度。 它包含来自中央目录头的元数据的冗余副本，以及其后压缩和未压缩数据文件的大小。  Zip是容器格式，而不是压缩算法。 使用元数据中指定的算法（通常是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DEFLATE</a> ）压缩每个文件的数据。 <br><br>  zip格式的此描述省略了许多了解zip炸弹所不需要的细节。 有关完整信息，请参见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4.3 APPNOTE.TXT</a>或Florian Buchholz <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">撰写</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PKZip文件结构</a> ，或参见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">源代码</a> 。 <br><br> 大量的冗余和zip格式中的许多歧义为各种恶作剧提供了机会。 拉链炸弹只是冰山一角。 链接以供进一步阅读： <br><br><ul><li>  Ginwael Coldwind撰写的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“一万个安全陷阱：一种ZIP格式”</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">模棱两可的zip解析功能使您可以从linter和people中隐藏Firefox附加文件</a> ：addons.mozilla.org上的我的漏洞 </li></ul><br><h1> 首次发现：文件重叠 </h1><br> 通过压缩重复字节的长字符串，我们可以创建高度压缩数据的<i>核心</i> 。 内核本身的压缩率不能超过1032的DEFLATE限制，因此我们需要一种在许多文件中重用内核的方法，而不必在每个文件中创建单独的副本。 我们可以通过重叠文件来做到这一点：make使得中央目录的许多标题指向以数据为核心的单个文件。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f80/675/a85/f80675a8530b8adfc1d5847eaaf813ca.svg"><br><br> 考虑这个设计如何影响压缩比的示例。 假设在1 MB中解压缩了1000字节的核心。 然后，输出的第一个兆字节“消耗”了1078个字节的输入数据： <br><br><ul><li> 本地文件头的31个字节（包括1个字节的文件名） <br></li><li> 中央目录头的47个字节（包括1个字节的文件名） <br></li><li> 每个内核1000个字节 </li></ul><br> 但是第一个之后的每1 MB输出仅占用47个字节-我们不需要本地文件的另一个头或内核的另一个副本，而仅需要中央目录的另一个头。 因此，虽然来自核心的第一个链接具有1,000,000 / 1,078≈928的压缩率，但每个附加链接将系数移近1,000,000 / 47≈21,277，并且较大的核心会提高上限。 <br><br> 这个想法的问题是缺乏兼容性。 由于中央目录的许多标头指向本地文件的一个标头，因此每个文件的元数据（尤其是文件名）不能相同。 一些解析器<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">对此发誓</a> 。 例如， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Info-ZIP UnZip</a> （Unix上的标准<code>unzip</code>程序）检索文件，但带有警告： <br><br><pre>  $解压缩overlay.zip
  充气：A
 B：与“本地”文件名（A）不匹配，
         继续“中央”文件名版本
  充气：B
 ... </pre><br>  Python <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">zipfile</a>也<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">抛出异常</a> ： <br><br><pre>  $ python3 -m zipfile -e overlay.zip。
追溯（最近一次通话）：
 ...
 __main __。BadZipFile：目录'B'中的文件名与标头b'A'的不同。 </pre><br> 接下来，我们将研究如何重新设计文件名的一致性，同时保留重叠文件的大部分好处。 <br><br><h1> 第二次发现：引用本地文件的标头 </h1><br> 我们需要在重用一个核心的同时，将每个文件的本地文件头分开。 简单地组合所有标头是行不通的，因为zip解析器将在本地文件的标头中找到希望DEFLATE流开始的位置。 但是，只要稍作更改，该想法便会奏效。 我们将使用未压缩块的DEFLATE函数来“引用”本地文件的头，以使它们看起来像是在内核中结束的同一DEFLATE流的一部分。 本地文件的每个标头（第一个文件头除外）将以两种方式解释：作为代码（zip文件结构的一部分）和作为数据（文件内容的一部分）。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1c1/668/e92/1c1668e92501880340aaf1651df25095.svg"><br><br>  DEFLATE流是一系列<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">块</a> ，每个块都可以压缩或不压缩。 我们通常只考虑压缩块，例如，内核是一个很大的压缩块。 但是，也有一些未压缩的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文件</a>以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5字节的标头</a>开头，该<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">标头</a>带有一个length字段，这仅表示：“逐字打印接下来的<i>n</i>个字节”。 解压缩未压缩的块意味着仅删除5字节的标头。 压缩和未压缩的块可以在DEFLATE流中自由混合。 输出是按顺序解包所有块的结果的串联。  “未压缩”的概念仅在DEFLATE级别上起作用。 不管使用哪个块，仍在zip级别将文件数据视为“压缩”。 <br><br> 想象这种设计的最简单方法是从最后一个文件到第一个文件的内部重叠。 我们首先插入一个内核，该内核将构成每个文件的数据文件的结尾。 添加本地LFH <sub><i>N</i></sub>文件的标题和指向该文件的中央CDH <sub><i>N</i></sub>目录的标题。 将LFH <sub><i>N</i></sub>和CDH <sub><i>N中</i></sub>的“压缩大小”元数据字段设置为压缩核心大小。 现在，添加未压缩块的5字节标头（图中绿色），其长度字段等于LFHN <sub><i>。</i></sub> 添加本地LFH文件<sub><i>N</i> -1</sub>的第二个标题和指向该目录的中央目录CDH <sub><i>N</i> -1</sub>的标题。 将“压缩大小”元数据字段设置为压缩内核大小<i>加上</i>未压缩块头大小（5个字节） <i>加上</i> LFH <sub><i>N</i></sub>大小的新头<sub><i>。</i></sub> <br><br> 目前，该zip文件包含两个名称分别为Y和Z的文件。让我们看一下解析器在解析时将看到的内容。 假设压缩的内核大小为1000个字节，而LFH <sub><i>N</i></sub>大小为31个字节。 我们从CDH <sub><i>N</i> -1</sub>开始，并遵循LFH <sub><i>N</i> -1</sub>的符号。 第一个文件的名称为Y，其数据文件的压缩大小为1036字节。 将接下来的103​​6个字节解释为DEFLATE流，我们首先遇到一个未压缩块的5个字节的标头，该标题表示要复制接下来的31个字节。 我们记下接下来的31个字节，即LFH <sub><i>N</i></sub> ，我们将其解压缩并添加到Y文件中。在DEFLATE流中进一步移动，我们找到要解压缩到Y文件中的压缩块（内核）。现在我们到达了压缩数据的末尾并完成了Y文件。 <br><br> 移至下一个文件，我们从CDH <sub><i>N</i></sub>指向LFH <sub><i>N</i></sub>指针，并找到一个名为Z的文件，其压缩大小为1000字节。 将这1000个字节解释为DEFLATE流，我们立即遇到一个压缩块（再次是核心）并将其解压缩为Z文件，现在我们到达了最终文件的末尾并完成了操作。 输出文件Z包含解压缩的内核； 输出文件Y相同，但可选地，前缀为31个字节LFHN <sub><i>。</i></sub> <br><br> 我们通过重复引用过程来完成构建，直到zip归档文件包含所需数量的文件为止。 每个新文件都会添加一个中央目录头，一个本地文件头和一个未压缩的块，以直接引用下一个本地文件头。 压缩文件数据通常是一串未压缩的DEFLATE块（引用的本地文件头），后跟压缩核心。 内核中的每个字节为输出大小贡献约1032 <i>N</i> ，因为每个字节是所有<i>N个</i>文件的一部分。 输出文件的大小也不同：较早的文件比后的文件大，因为它们对本地文件的标头的引用更多。 输出文件的内容没有多大意义，但是没有人说这应该有道理。 <br><br> 这种重叠引用设计比上一节中的完全重叠设计具有更好的兼容性，但是兼容性是通过压缩实现的。 在那里，每个添加的文件仅花费中央目录的标题，在这里它花费中央目录的标题，本地文件的标题以及引用标题的另外5个字节。 <br><br><h1> 最佳化 </h1><br> 收到拉链式炸弹的基本设计后，我们将尝试使其尽可能高效。 我们要回答两个问题： <br><br><ul><li> 给定zip文件大小的最大压缩率是多少？ <br></li><li> 给定zip格式的限制，最大压缩率是多少？ </li></ul><br><h3> 内核压缩 </h3><br> 对我们来说，尽可能地压缩内核是有益的，因为每个未压缩的字节都乘以<i>N。</i> 为此，我们使用了一个称为bulk_deflate的自定义DEFLATE压缩器，专门用于压缩重复字节的字符串。 <br><br> 在循环不断的重复字节流中，所有不错的DEFLATE存档程序都接近1032的压缩率，但我们担心其具体大小。 在我们的存档大小中，bulk_deflate比通用存档器保存的数据更多：比zlib和Info-ZIP多约26 KB，比<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Zopfli</a>多约15 KB，这出于压缩质量的考虑而牺牲了速度。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b4/cac/e5b/8b4cace5b49ef6945fd1d1ddc8fd7310.svg"><br><br> 高压缩比bulk_deflate的价格-缺乏多功能性。 它只能压缩重复字节的行，并且只能压缩一定的长度，即517 + 258 <i>k</i> （整数k≥0）。除了良好的压缩效果外，bulk_deflate还可以快速工作，几乎在同一时间执行工作，而不管输入数据的大小如何，计算实际编写压缩字符串的工作。 <br><br><a name="1"></a><h3> 档案名称 </h3><br> 就我们的目的而言，文件名几乎是无用的。 尽管它们通过成为本地文件的带引号的标头来增加输出大小，但文件名中的字节所占的份额却比内核中的字节要少得多。 我们希望文件名尽可能短，但要有所不同，而又不要忘记兼容性。 <br><br> 花在文件名上的每个字节意味着不花在内核上的两个字节（两个，因为每个文件名出现两次：在中央目录的头和本地文件的头）。 文件名字节平均仅输出（ <i>N</i> +1）/ 4字节输出，而内核中的一个字节计为1032N <i>。</i> 示例： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1，2，3</a> 。 <br><br> 兼容性的首要考虑因素是编码。  zip格式规范指出，如果设置了特定的标志位（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">APPNOTE.TXT，附录D</a> ），则文件名应解释为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CP 437</a>或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">UTF-8</a> 。 这是zip解析器之间不兼容的要点，后者可以使用某些固定或特定于区域设置的编码来解释文件名。 因此，出于兼容性考虑，最好将自己限制为在CP 437和UTF-8中使用相同编码的字符。 即，这些是95个可打印的US-ASCII字符。 <br><br> 我们还受到文件系统命名限制的约束。 某些文件系统不区分大小写，因此'a'和'A'不被认为是不同的名称。 普通文件系统（例如FAT32） <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">禁止使用某些字符</a> ，例如“ *”和“？”。 <br><br> 作为安全但不一定最佳的折衷方案，我们的zip炸弹将使用36个字符的字母的文件名，其中不包括特殊字符和不同大小写的字符： <br><br><pre>  0 1 2 3 4 5 6 7 8 9 ABCDEFGHIJKLMNOPQRSTU VWXYZ </pre><br> 文件名以明显的方式生成，所有位置依次生成，并在循环末尾添加一个位置： <br><br><pre>  “ 0”，“ 1”，“ 2”，...，“ Z”，
 “ 00”，“ 01”，“ 02”，...，“ 0Z”，
 ...
 “ Z0”，“ Z1”，“ Z2”，...，“ ZZ”，
 “ 000”，“ 001”，“ 002”，... </pre><br> 一共有36个1个字符的文件名，362个2个字符的名，依此类推。 四个字节足以容纳1,727,604个不同的文件名。 <br><br> 鉴于档案中的文件名通常具有不同的长度，我该如何更好地对它们进行排序：从最短到最长，反之亦然？ 如果您稍作考虑，最好将最长的名字放在最后。 与从最长到最短的排序相比，此排序向<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">zblg.zip</a>添加了900 MB以上的输出。 但是，这是次要的优化，因为900 MB仅占问题总大小的0,0003％。 <br><br><h3> 核心尺寸 </h3><br> 重叠的报价设计使您可以放置​​压缩的数据核，然后廉价地多次复制它。 对于zip文件<i>X</i>的特定大小，分配存储内核的最佳空间是多少，创建副本的空间是多少？ <br><br> 为了找到最佳平衡，您只需要优化一个变量<i>N</i> ，即zip归档文件中的文件数。 每个<i>N</i>值都需要一定数量的开销，用于中央目录的标题，本地文件的标题，引用块的标题和文件名。 其余空间将被核心占用。 由于<i>N</i>必须是整数，并且您只能在内核大小降至零之前放入一定数量的文件，因此检查<i>N的</i>每个可能值并选择输出最大的值就足够了。 <br><br> 将优化过程应用于42.zip的<i>X</i> = 42,374，可以找到<i>N</i> = 250的最大值。这250个文件需要21,195字节的开销，剩下21,179字节用于内核。 如此大小的内核被解压缩为21,841,249字节（1031.3与1的比率）。  250个解压缩内核的副本以及一些引用的本地文件头给出的总解压缩输出为5,461,307,620字节，压缩比为129,000。 <br><br><ul><li>  <a href="">zbsm.zip</a> 42 kB→5.5 GB </li></ul><pre>  zipbomb --mode = quoted_overlap --num-files = 250 --compressed-size = 21179&gt; zbsm.zip </pre><br> 优化导致内核和文件头之间的空间几乎均匀分布。 这不是巧合。 考虑具有重叠的引文结构的简化模型。 在简化模型中，我们忽略文件名，并且由于引用本地文件的标头而导致输出文件的大小略有增加。 对简化模型的分析将显示内核与文件头之间的最佳分布是近似均匀的，具有最佳分布的输出大小将根据输入的大小成平方增长。 <br><br> 一些常量和变量的定义： <br><br><div class="scrollable-table"><table><tbody><tr><td>  X </td><td></td><td>  zip文件大小（已考虑固定） </td></tr><tr><td>  ñ </td><td></td><td>  zip存档中的文件数（为优化而可变） </td></tr><tr><td>  Cdh </td><td>  = 46 </td><td> 中央目录标头大小（无文件名） </td></tr><tr><td>  h </td><td>  = 30 </td><td> 本地文件头大小（无文件名） </td></tr><tr><td> 问 </td><td>  = 5 </td><td>  DEFLATE块未压缩的大小 </td></tr><tr><td>  ç </td><td>  ≈1032 </td><td> 内核压缩率 </td></tr></tbody></table></div><br> 令<i>H（N）</i>为<i>N个</i>文件的标头的开销量。 请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">图表</a>以了解公式的本质。 <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">H</span><span class="MJXp-mrow" id="MJXp-Span-3"><span class="MJXp-mo" id="MJXp-Span-4" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5">N</span><span class="MJXp-mrow" id="MJXp-Span-6"><span class="MJXp-mo" id="MJXp-Span-7" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9">N</span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mrow" id="MJXp-Span-11"><span class="MJXp-mo" id="MJXp-Span-12" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">H</span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17">L</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19">H</span><span class="MJXp-mrow" id="MJXp-Span-20"><span class="MJXp-mo" id="MJXp-Span-21" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mrow" id="MJXp-Span-23"><span class="MJXp-mo" id="MJXp-Span-24" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25">N</span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-27">1</span><span class="MJXp-mrow" id="MJXp-Span-28"><span class="MJXp-mo" id="MJXp-Span-29" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-30" style="margin-left: 0.267em; margin-right: 0.267em;">⋅</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">Q</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="48.941ex" height="2.419ex" viewBox="0 -780.1 21071.7 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMATHI-48" x="0" y="0"></use><g transform="translate(888,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMATHI-4E" x="1718" y="0"></use><g transform="translate(2606,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMAIN-3D" x="3714" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMATHI-4E" x="4771" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMAIN-22C5" x="5881" y="0"></use><g transform="translate(6382,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMATHI-43" x="7212" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMATHI-44" x="7972" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMATHI-48" x="8801" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMAIN-2B" x="9912" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMATHI-4C" x="10912" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMATHI-46" x="11594" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMATHI-48" x="12343" y="0"></use><g transform="translate(13232,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMAIN-2B" x="14284" y="0"></use><g transform="translate(15285,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMATHI-4E" x="16115" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMAIN-2212" x="17226" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMAIN-31" x="18226" y="0"></use><g transform="translate(18727,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMAIN-22C5" x="19779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/459254/&amp;usg=ALkJrhgH3ljDGdw8nxnQcXsnPDHacDSG-A#MJMATHI-51" x="20280" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> H（N）= N⋅（CDH + LFH）+（N-1）⋅Q </script></p><br> 对于内核，保留<i>X-H（N）个</i>位置。 解压缩后的总大小<i>S <sub>X</sub> （N）</i>等于以比率<i>C</i>解压缩后的<i>N</i>个内核副本的大小（在此简化模型中，我们忽略了所提到的本地文件头的稍微扩展）。 <br><br><p><math> </math> $$显示$$ S_X（N）=（X-H（N））CN \\ =（X-（N⋅（CDH + LFH）+（N-1）⋅Q））CN \\ =-（CDH + LFH + Q）CN ^ 2 +（X + Q）CN $$显示$$ </p><br>  S <sub>X</sub> （N）是N部分的多项式，因此，最大值应为导数S'X（N）等于零的地方。 取导数并找到零会给我们N <sub>OPT</sub> ，即最佳文件数。 <br><br><p><math> </math> $$ display $$ S'X（N_ {OPT}）= −2（CDH + LFH + Q）C N_ {OPT} +（X + Q）C \\ 0 = −2（CDH + LFH + Q）C N_ {OPT} +（X + Q）C \\ N_ {OPT} =（X + Q）/（CDH + LFH + Q）/ 2 $$显示$$ </p><br>  <i>H（N <sub>OPT</sub> ）</i>提供用于放置文件头的最佳空间。 它独立于CDH，LFH和C，并且接近<i>X / 2</i> 。 <br><br><p><math> </math> $$显示$$ H（N_ {OPT}）= N_ {OPT}⋅（CDH + LFH）+（N_ {OPT}-1）⋅Q \\ =（X-Q）/ 2 $$显示$$ </p><br>  S <sub>X</sub> （N <sub>OPT</sub> ）-最佳分布下的总未包装尺寸。 由此可见，输出的大小随输入数据的增加而平方增加。 <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-255"><span class="MJXp-msubsup" id="MJXp-Span-256"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-257" style="margin-right: 0.05em;">S</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-258" style="vertical-align: -0.4em;">X</span></span><span class="MJXp-mrow" id="MJXp-Span-259"><span class="MJXp-mo" id="MJXp-Span-260" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-msubsup" id="MJXp-Span-261"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262" style="margin-right: 0.05em;">N</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-263" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">P</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-266">T</span></span></span><span class="MJXp-mrow" id="MJXp-Span-267"><span class="MJXp-mo" id="MJXp-Span-268" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-269" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-270"><span class="MJXp-mo" id="MJXp-Span-271" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-272">X</span><span class="MJXp-mo" id="MJXp-Span-273" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274">Q</span><span class="MJXp-msubsup" id="MJXp-Span-275"><span class="MJXp-mrow" id="MJXp-Span-276" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-277" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-278" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-279">C</span><span class="MJXp-mrow" id="MJXp-Span-280"><span class="MJXp-mo" id="MJXp-Span-281" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mrow" id="MJXp-Span-282"><span class="MJXp-mo" id="MJXp-Span-283" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-284">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286">H</span><span class="MJXp-mo" id="MJXp-Span-287" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-288">L</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-289">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-290">H</span><span class="MJXp-mo" id="MJXp-Span-291" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-292">Q</span><span class="MJXp-mrow" id="MJXp-Span-293"><span class="MJXp-mo" id="MJXp-Span-294" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mrow" id="MJXp-Span-295"><span class="MJXp-mo" id="MJXp-Span-296" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-297">4</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> S_X（N_ {OPT}）=（X + Q）^ 2C /（CDH + LFH + Q）/ 4 </script></p><br> 增加zip文件的大小，最后我们将遇到zip格式的限制：归档文件最多只能包含2 <sup>16</sup> -1个文件，每个文件的大小不超过2 <sup>32</sup> -1个字节。 更糟糕的是， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">某些实现</a>将最大值作为存在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">64位扩展</a>的指标，因此我们的限制实际上是2 <sup>16</sup> -2和2 <sup>32</sup> -2。 碰巧，我们第一次遇到未压缩文件大小的限制。  zip文件大小为8 319 377字节时，天真优化将为我们提供文件数量47 837，最大文件数量为2 <sup>32</sup> +311字节。 <br><br>  （实际上，一切都有些复杂，因为确切的限制取决于实现。Pythonzipfile <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">忽略</a>文件<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a>数量，Go中的archive / zip <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">允许</a>增加文件的数量，直到它们匹配较低的16位。但是为了通用兼容性，我们必须遵守确定的限制）。 <br><br> 如果我们不能无限增加<i>N</i>或内核大小，我们想在zip格式中找到最大压缩率。 您需要使用最大数量的文件使内核尽可能大。 尽管事实上我们不再能够在内核和文件头之间保持近似均匀的分隔，但是每个添加的文件<i>仍会</i>提高压缩率-就像不能继续增加内核一样快。 实际上，在添加文件时，我们将需要<i>减小</i>内核<i>的</i>大小以释放最大文件大小的空间，该最大大小随添加的每个文件而略有增加。 <br><br> 该计划将导致一个包含2 <sup>16</sup> −2文件和一个内核的zip归档文件，该文件解压缩为2 <sup>32</sup> −2 178 825字节。 文件将在zip存档的开始处变得更大-第一个也是最大的文件将以2 <sup>32</sup> −56字节解压缩。 这与我们可以使用bulk_deflate的粗略输出参数非常接近-编码最后的54个字节将比其大小花费更多（整个zip文件的压缩比为2800万，最后的54个字节将获得最多54⋅10 32⋅ 2 <sup>16-2</sup> ）≈36？5百万个字节，因此这仅在54个字节可以编码为一个字节时有用-我不能用少于2个编码，因此，如果不能将54个字节编码为1个字节，只会降低压缩率）。 该拉链炸弹的输出大小为281,395,456,244,934字节，是理论最大值（2 32-1）×（2 16-1）的99.97％。 只能通过减小输入信号的大小而不是通过增加输出来实现压缩率的任何显着提高。 <br><br><ul><li>  <a href="">zblg.zip</a> 10 MB→281 TB </li></ul><pre>  zipbomb --mode = quoted_overlap --num-files = 65534 --max-uncompressed-size = 4292788525&gt; zblg.zip </pre><br><h1> 高效的CRC-32计算 </h1><br> 中央目录的标头和本地文件的标头中的元数据中，包含未压缩文件数据<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CRC-32的校验和</a> 。 这带来了一个问题，因为每个文件的CRC-32计算量与文件大小成正比，默认情况下该文件的大小非常大（毕竟，这是个拉链炸弹）。 我们希望所做的工作至少与档案的大小成正比。 有两个因素对我们有利：所有文件都有一个公共核心，而未压缩的内核是一串重复的字节。 想象一下CRC-32作为矩阵产品-这将使我们不仅可以快速计算内核的校验和，而且可以重用文件之间的计算。 本节描述的方法是zlib中<a href="">crc32_combine</a>函数的一个小扩展，Mark Adler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此进行</a>了解释。 <br><br> 可以将CRC-32建模为状态机，为每个输入位更新一个32位状态寄存器。 位0和位1的基本更新操作是： <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">uint32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crc32_update_0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint32 state)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Shift out the least significant bit. bit b = state &amp; 1; state = state &gt;&gt; 1; // If the shifted-out bit was 1, XOR with the CRC-32 constant. if (b == 1) state = state ^ 0xedb88320; return state; } uint32 crc32_update_1(uint32 state) { // Do as for a 0 bit, then XOR with the CRC-32 constant. return crc32_update_0(state) ^ 0xedb88320; }</span></span></code> </pre> <br> 如果将状态寄存器表示为32个元素的二进制向量，并使用XOR进行加法和乘法，那么<code>crc32_update_0</code>是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">线性映射</a> ； 即可以将其表示为32 * 32二进制<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">转换矩阵</a>的乘法。 要理解为什么，请注意，将矩阵乘以向量只是在将每一列乘以向量的对应元素之后，简单地将矩阵的列相加。 移位操作<code>state &gt;&gt; 1</code>只是简单地获取状态向量的每个比特<i>i</i> ，然后将其乘以一个除比特<i>i</i> -1以外的其他任何地方都为零的向量（从右到左对比特进行编号）。 相对而言，仅当位<code>b</code>等于1时， <code>state ^ 0xedb88320</code>发生最终的XOR <code>state ^ 0xedb88320</code> 。 这可以表示为b与0xedb88320的第一个乘法，然后与该状态进行XOR运算。 <br><br> 此外， <code>crc32_update_1</code>只是一个<code>crc32_update_0</code>加（XOR）常量。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行</font></font><code>crc32_update_1</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仿射变换</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：矩阵相乘，然后进行映射（即矢量加法）。如果将变换矩阵的大小增加到33×33，并向状态向量添加一个始终为1的元素（此表示称为</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">齐次坐标</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">，我们可以一步一步想象矩阵乘法和映射</font><font style="vertical-align: inherit;">。</font></font><br><br><img src="https://habrastorage.org/webt/sg/ay/or/sgayorbdqetnkmc1y-qm42uywic.png"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转换矩阵为33×33 M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它们分别计算由位0和1引起的CRC-32状态改变。列向量的最高有效位存储在下面：从下至上读取第一列，您会看到多项式常数CRC-32 edb8832016 = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">111</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">111</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 000 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 00000 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 00 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 00000 </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这两个矩阵仅在最后一列中有所不同，该列以同构坐标表示转换向量。在M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0中，</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平移为零，在M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1中</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为edb88320 </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，多项式常数为CRC-32。单元立即如上操作的对角状态</font></font><code>state &gt;&gt; 1</code></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这两种操作</font></font><code>crc32_update_0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>crc32_update_1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过33×33转移矩阵来表示。显示了矩阵M</font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和M</font><sub><font style="vertical-align: inherit;"> 1</font></sub><font style="vertical-align: inherit;">。</font></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">矩阵表示的优点是矩阵可以相乘。</font><font style="vertical-align: inherit;">假设我们希望看到通过处理二进制表示为01100001 </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的ASCII字符'a'引起的状态更改</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们可以想象一个转换矩阵中这8位的CRC-32状态的累积变化：</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-298"><span class="MJXp-msubsup" id="MJXp-Span-299"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-300" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-301" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-302" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-303"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-305" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-306"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-307" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-308" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-309"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-310" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-311" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-312"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-314" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-315"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-317" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-318"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-319" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-320" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-321"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-322" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-323" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-324"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-325" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-326" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-6">M_a = M_0 M_1 M_1 M_0 M_0 M_0 M_0 M_1</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以想象通过乘以M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a的</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多副本来重复“ a”的行状态的变化</font><font style="vertical-align: inherit;">-将矩阵提升为幂。</font><font style="vertical-align: inherit;">我们可以做到这一点很快使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速指数算法</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它可以计算将M </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ñ</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只要登录</font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2个</font></font></sub> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ñ</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">步骤。</font><font style="vertical-align: inherit;">例如，这是一个用于更改9个字符'a'的字符串状态的矩阵：</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-327"><span class="MJXp-mo" id="MJXp-Span-328" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-329"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-331" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-332"><span class="MJXp-mo" id="MJXp-Span-333" style="margin-left: 0em; margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-334" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-335" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-336"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-338" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-339"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-340" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-341" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-342"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-343" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-344" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-345"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-347" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-348"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-350" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-351"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-352" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-353" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-354"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-355" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-356" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-357"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-358" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-359" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span></span><font style="vertical-align: inherit;"><span class="MJXp-msubsup" id="MJXp-Span-360"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">M </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-360"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-362" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">a </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-357"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-358" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">M </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-357"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-359" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">a </font></span></span></font><span class="MJXp-msubsup" id="MJXp-Span-360"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-362" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">a </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">M </font></span></font><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-362" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></span></span><span class="MJXp-mspace" id="MJXp-Span-363" style="width: 0em; height: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-364" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-365" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-366"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-367" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-368" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-369"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-370" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-371" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-372"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-373" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-374" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-375"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-376" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-377" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-378"><span class="MJXp-mo" id="MJXp-Span-379" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-380" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-381"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-382" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-383" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-mspace" id="MJXp-Span-384" style="width: 0em; height: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-385" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-386" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-387" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-388"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-390" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-391"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-392" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-393" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-394"><span class="MJXp-mo" id="MJXp-Span-395" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-396" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-397"><span class="MJXp-mo" id="MJXp-Span-398" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-399" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-400"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-401" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-402" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-mspace" id="MJXp-Span-403" style="width: 0em; height: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-404" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-405" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-406" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-407" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-408"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-409" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-410" style="vertical-align: -0.4em;">a</span></span><span class="MJXp-msubsup" id="MJXp-Span-411"><span class="MJXp-mo" id="MJXp-Span-412" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-413" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-414"><span class="MJXp-mo" id="MJXp-Span-415" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-416" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-417"><span class="MJXp-mo" id="MJXp-Span-418" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-419" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-420"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-421" style="margin-right: 0.05em;">M</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-422" style="vertical-align: -0.4em;">a</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-7">(M_a)^9 = M_a M_a M_a M_a M_a M_a M_a M_a M_a\\ = (M_a M_a M_a M_a)^2 M_a\\ = ((M_a M_a)^2)^2 M_a\\ = (((M_a)^2)^2)^2 M_a</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">矩阵快速乘法算法可用于计算M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（未压缩内核的矩阵），因为该内核是重复字节的字符串。要从矩阵中获取CRC-32校验和，请将矩阵乘以零向量（零向量在统一坐标中，即32个零，然后是单位;这里我们省略了校验和的预处理和后处理以检查一致性的轻微复杂性）。为了计算每个文件的校验和，我们的工作方向相反。我们从初始化</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M：= M </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kernel开始</font></font></sub></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。内核校验和也是最终文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的校验和</font><font style="vertical-align: inherit;">，因此我们乘以</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">零矢量和存储在CDH接收的校验</font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ñ</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和LFH </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ñ</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">数据文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N-1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的相同文件中的数据文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ñ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但具有添加前缀LFH </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ñ</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，我们计算</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-423"><span class="MJXp-msubsup" id="MJXp-Span-424"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-425" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-426" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-427"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L </font></font></span><span class="MJXp-mrow" id="MJXp-Span-428"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-429"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-430"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-431" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-432" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></span></span></span></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，LFH</font><sub><font style="vertical-align: inherit;">N的</font></sub><font style="vertical-align: inherit;">状态变化矩阵</font><font style="vertical-align: inherit;">和更新</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-8">M_{L{FH_N}}</script><font style="vertical-align: inherit;"></font><sub><font style="vertical-align: inherit;"></font></sub><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-433"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-434"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mo" id="MJXp-Span-435" style="margin-left: 0.111em; margin-right: 0.167em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-436"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-437"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-438" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-439" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-440"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L </font></font></span><span class="MJXp-mrow" id="MJXp-Span-441"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-442"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-443"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-444" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-445" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></span></span></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9">M := M M_{L{FH_N}}</script>  。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示从处理</font><font style="vertical-align: inherit;">原子核后面的</font><font style="vertical-align: inherit;">LFH </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">起的累积状态变化</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们计算文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N -1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的校验和</font><font style="vertical-align: inherit;">，再次将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">乘以</font><font style="vertical-align: inherit;">零向量。</font><font style="vertical-align: inherit;">我们通过在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M中</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">累积状态更改矩阵来继续该过程，</font><font style="vertical-align: inherit;">直到处理</font><font style="vertical-align: inherit;">完</font><font style="vertical-align: inherit;">所有文件为止。</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 扩展名：Zip64 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">早些时候，由于zip格式的局限性，我们遇到了扩展问题-无论zip文件的打包方式如何，都无法发行超过281 TB的文件。</font><font style="vertical-align: inherit;">您可以使用</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Zip64</font></a><font style="vertical-align: inherit;">超越这些限制</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，是一种zip格式扩展名，可将某些标头字段的大小增加到64位。对Zip64的支持绝不是通用的，但它是最常用的扩展之一。至于压缩率，Zip64的作用是将中央目录的标头的大小从46个字节增加到58个字节，而本地目录的标头的大小从30个字节增加到50个字节。查看简化模型中的最佳膨胀系数公式，我们可以看到Zip64格式的拉链炸弹仍会二次增长，但由于分母较大而速度较慢-这可以在下图中看到。由于失去兼容性和增长延迟，我们几乎消除了文件大小的所有限制。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设我们需要一个压缩炸弹，可以扩展到4.5 PB，例如42.zip。</font><font style="vertical-align: inherit;">档案应该多大？</font><font style="vertical-align: inherit;">使用二进制搜索，我们发现此类文件的最小大小为46 MB。</font></font><br><br><ul><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zbxl.zip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 46 MB→4.5 PB（Zip64，不太兼容）</font></font></li></ul><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zipbomb --mode = quoted_overlap --num-files = 190023 --compressed-size = 22982788 --zip64&gt; zbxl.zip </font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5 PB-事件地平线望远镜记录的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">黑洞</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">第一张图像</font></a><font style="vertical-align: inherit;">的数据量大致</font><font style="vertical-align: inherit;">相同：机架和数据中心中带有硬盘的机架。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Zip64，考虑最大压缩率几乎没有意思，因为我们可以简单地继续增加zip文件的大小和压缩率，直到压缩的zip文件变得令人望而却步为止。但是，一个有趣的阈值是2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">个字节（18 EB或16 EiB）-因此，大多数文件系统上无法容纳太多数据。二进制搜索找到了最小的拉链炸弹，该炸弹可产生至少相同的输出：它包含1200万个文件和1.5 GB的压缩核心。 zip文件总大小为2.9 GB，并在2 </font><sup><font style="vertical-align: inherit;">64中</font></sup><font style="vertical-align: inherit;">解压缩</font></font><sup><font style="vertical-align: inherit;"></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+11 727 895 877字节，压缩比超过62亿：1。</font><font style="vertical-align: inherit;">我没有上载此文件以供下载，但是您可以使用</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源代码</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自己生成它</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">他的文件大小如此之大，甚至</font><font style="vertical-align: inherit;">在Info-ZIP UnZip 6.0中</font><font style="vertical-align: inherit;">也发现</font><font style="vertical-align: inherit;">了</font><font style="vertical-align: inherit;">一个</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zipbomb --mode = quoted_overlap --num-files = 12056313 --compressed-size = 1482284040 --zip64&gt; zbxxl.zip </font></font></pre><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 扩展名：bzip2 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEFLATE是zip格式中最常见的压缩算法，但这只是许多选项之一。第二种最常见的算法可能是</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bzip2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。尽管不如DEFLATE兼容。从理论上讲，在bzip2中，最大压缩率约为140万比1，这可以使内核更密集地堆积。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bzip2首先对“游程长度编码”进行编码，从而将重复字节的字符串长度减少了51倍。然后，将数据划分为900 KB的块，并分别压缩每个块。从理论上讲，一个块最多可以压缩32个字节。 900 000×51/32 = 1 434375。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">忽略兼容性的损失，bzip2是否能制造出更有效的炸弹？</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的-但仅适用于小文件。问题在于，在bzip2中，没有什么像我们用来引用本地文件头的未压缩的DEFLATE块一样。因此，不可能重叠文件并重用内核-对于每个文件，您都需要编写自己的副本，因此总体压缩率不会比任何单个文件的压缩率都要好。在下图中，我们看到不重叠，bzip2仅对大小约为兆字节的文件优于DEFLATE。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅有希望在bzip2中引用标头的替代方法，这将在下一节中讨论。此外，如果您知道特定的zip解析器支持bzip2 </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果允许使用不匹配的文件名，则可以使用完整的重叠结构，该结构不需要加引号。</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/350/bb1/aa1/350bb1aa131f71762b2ad03d4203ac66.svg"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比较不同拉链炸弹的压缩率。注意对数轴。显示的每个设计都有和没有Zip64。从轴的恒定比率可以看出，没有重叠的结构具有线性增长率。 bzip2图的垂直偏移意味着bzip2的压缩率大约是DEFLATE的压缩率的一千倍。所引用的DEFLATE构建体具有二次方增长率，这是通过倾斜2：1轴来证明的。 Zip64变体的效果稍差，但可容纳超过281 TB。当达到最大文件大小时，带有附加字段引用的bzip2图形从二次变为线性（2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> −2字节），或允许的最大文件数</font></font></font></i> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 扩展：引用其他字段 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们已经使用DEFLATE函数来引用本地文件的标头，并且我们只看到此技巧在bzip2中不起作用。</font><font style="vertical-align: inherit;">但是，还有一种替代性的引用方法，在某种程度上受到更多限制，该方法仅使用zip格式函数并且与压缩算法无关。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本地文件的标头结构的末尾，有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可变长度</font><i><font style="vertical-align: inherit;">的附加字段，</font></i><font style="vertical-align: inherit;">用于存储不适合通常的标头字段的信息（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APPNOTE.TXT，第4.3.7节）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">其他信息可能包括，例如，Unix上的时间戳或uid / gid。</font><font style="vertical-align: inherit;">Zip64信息也存储在其他字段中。</font><font style="vertical-align: inherit;">另一个字段表示为长度值结构；</font><font style="vertical-align: inherit;">如果您增加长度而未添加值，则附加字段将包括zip文件中其后面的内容，即本地文件的下一个标头。</font><font style="vertical-align: inherit;">使用此方法，本地文件的每个标头都可以“引用”以下标头，并将它们包含在其自己的附加字段中。</font><font style="vertical-align: inherit;">与DEFLATE相比，有三个优点：</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 引用一个额外的字段仅需要4个字节，而不是5个字节，从而为内核留出更多空间。 </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 考虑到zip格式的限制，它不会增加文件大小，这意味着内核更大。 </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 它在bzip2中提供了报价。 </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管有这些优点，但通过其他字段进行引用的灵活性较差。这不是一个链，就像在DEFLATE中一样：本地文件的每个标题不仅应包含紧随其后的标题，而且还应包含</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后续标题。当您接近zip文件的开头时，其他字段会增加。由于最大字段长度为2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -1个字节，因此假设名称</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">按预期分配</font></a><font style="vertical-align: inherit;">，最多只能引用1808个本地文件头（或Zip64中为1170）。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在DEFLATE的情况下，您可以使用其他字段来引用本地文件的第一个（最短）标头，然后将其切换为用DEFLATE引用）。另一个问题：为了与附加字段的内部数据结构相对应，有必要为</font><font style="vertical-align: inherit;">引文数据之前的</font><font style="vertical-align: inherit;">类型（</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APPNOTE.TXT，第4.5.2节</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">选择一个16位标记</font><font style="vertical-align: inherit;">。我们想要选择一个类型标记，它将导致解析器忽略引号中的数据，而不是尝试将它们解释为有意义的元数据。 Zip解析器应忽略未知类型的标签，因此我们可以随机选择标签，但存在将来某些标签会违反设计兼容性的风险。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上图说明了在bzip2，c中使用其他字段且不使用Zip64的可能性。在两个图表上都有一个转折点，当增长从二次增长变为线性增长时。如果没有Zip64，则会在未压缩文件达到最大大小的情况下发生这种情况（2 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">−2个字节）; </font><font style="vertical-align: inherit;">那么您只能增加文件数量，而不能增加文件大小。</font><font style="vertical-align: inherit;">当文件数达到1809时，图形完全结束，然后我们用完了额外字段中的空间来引用其他标头。</font><font style="vertical-align: inherit;">使用Zip64，1171个文件出现断裂，之后只能增加文件大小，而不能增加文件数量。</font><font style="vertical-align: inherit;">在DEFLATE的情况下，附加字段会有所帮助，但是差异是如此之小，以至于在视觉上无法察觉。</font><font style="vertical-align: inherit;">它将zbsm.zip的压缩率提高了1.2％；</font><font style="vertical-align: inherit;">zblg.zip降低了0.019％；</font><font style="vertical-align: inherit;">和zbxl.zip缩小0.0025％。</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 讨论区 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在有关此主题的工作中，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pletz和同事</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用文件重叠来创建几乎可以自我复制的zip存档。</font><font style="vertical-align: inherit;">Ginvael Coldwind </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">早些时候建议</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件重叠本身</font><font style="vertical-align: inherit;">（幻灯片47）。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑到兼容性，我们开发了一种带引号重叠的zip炸弹的设计-实现方式方面存在许多差异，其中一些差异显示在下表中。最终的设计与以通常方式工作的zip解析器兼容，即首先检查中央目录并将其用作文件索引。其中，来自</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Nail</font></a><font style="vertical-align: inherit;">的独特zip解析器</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是根据形式语法自动生成的。但是，该设计与“流”解析器不兼容，后者无需首先读取中央目录就可以一开始分析zip文件，从头到尾进行分析。从本质上讲，流解析器不允许文件以任何方式重叠。他们很可能只会提取第一个文件。此外，它们甚至可能会</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引发</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误，如</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">sunzip那样</font></a><font style="vertical-align: inherit;">，后者会解析末尾的中央目录，并检查与其已经看到的本地文件头的一致性。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果希望提取的文件以与本地文件的标头字节不同的特定前缀开头，则可以在以下标头引用的未压缩块之前插入DEFLATE块。并非zip归档文件中的每个文件都应参与炸弹的创建：如有必要，您可以在归档文件中包含普通文件，以便与某些特殊格式相对应（</font></font><code>--template</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此用例</font><font style="vertical-align: inherit;">的源代码中有一个参数</font><font style="vertical-align: inherit;">）。许多格式都使用zip作为容器，例如Java JAR文档，Android APK和LibreOffice。</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聚甲醛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在许多方面类似于zip。它在文件末尾具有一个指向以前对象的交叉引用表，并且它支持通过FlateDecode过滤器压缩对象。我没有尝试过，但是您可以使用重叠引用的想法制作PDF炸弹。也许您甚至不需要在这里努力工作：binaryhax0r </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在博客文章</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">写道</font></a><font style="vertical-align: inherit;">，您只需在一个对象上指定多个FlateDecode层，然后创建PDF炸弹就变得微不足道了。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义本文描述的一类特殊的拉链炸弹很容易：只需找到重叠的文件即可。马克·阿德勒（Mark Adler）撰写了</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">补丁</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for Unzip Info-ZIP，就是这样做的。</font><font style="vertical-align: inherit;">但是，通常，阻止重叠文件并不能防止所有类型的zip炸弹。</font><font style="vertical-align: inherit;">如果您不了解将用于分析文件的解析器内部组件的确切知识，则很难预先预测文件是否为zip bomb。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看标头并对所有文件的“未压缩大小”字段求和是不起作用的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为标头中的值可能与实际的未压缩大小不匹配（在兼容性表中，请参见“允许文件太小”行）。</font><font style="vertical-align: inherit;">对zip炸弹的可靠保护包括在zip解析器运行期间限制时间，内存和磁盘空间。</font><font style="vertical-align: inherit;">仔细解析zip文件，就像处理任何不受信任数据的复杂操作一样。</font></font><br><br><div class="scrollable-table"><table><thead><tr><td></td><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Info-zip </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UnZip 6.0</font></font></a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Python 3.7 <br> zipfile</a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Go 1.12 <br> archive/zip</a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">yauzl 2.10.0 <br> (Node.js)</a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Nail <br> examples/zip</a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android 9.0.0 r1 <br> libziparchive</a> </th><th> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sunzip 0.4</a> <br> (streaming) </th></tr></thead><tbody><tr><th> DEFLATE </th><td>  ✓ </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td></tr><tr><th> Zip64 </th><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">✓</a> </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">✓</a> </td></tr><tr><th> bzip2 </th><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">✓</a> </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">✓</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">✓</a> </td></tr><tr><th>     </th><td>  </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">−</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">−</a> </td><td> <a href="">✓</a> </td></tr><tr><th>   CRC-32 </th><td> <abbr title="显示预期的和实际的CRC"></abbr> </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">−</a> </td><td> <a href=""> </a> </td><td> <a href="">✓</a> </td><td> <a href="">−</a> </td><td> <a href="">✓</a> </td><td> <a href="">−</a> </td></tr><tr><th>      </th><td>  ✓ </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td><td> <a href="">−</a> </td></tr><tr><th>  2 <sup>32</sup> −1  </th><td>  ✓ </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">−</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td></tr><tr><th>  2 <sup>16</sup> −1  </th><td>  ✓ </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">−</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td><td> <a href="">✓</a> </td></tr></tbody><tbody><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">overlap.zip</a> </th><td>  </td><td> − </td><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td> − </td><td> − </td></tr><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">zbsm.zip  zblg.zip</a> </th><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td> − </td></tr><tr><th>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">zbxl.zip</a> </th><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td>  ✓ </td><td> − </td><td> − </td><td> − </td></tr></tbody></table></div><br> <i><font color="gray">    zip-,    ,     zip-.      DEFLATE  Zip64,          ,    CRC     32-  16- .</font></i> <br><br><h1> 致谢 </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">感谢</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mark Adler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Russ Cox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brandon Enright</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marek Maykovsky</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Josh Wolfe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USENIX WOOT 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的审稿人对</font><font style="vertical-align: inherit;">本文草案的评论。</font><font style="vertical-align: inherit;">考兰·麦克纳马拉（Kaolan McNamara）评估了简易炸弹对LibreOffice安全的影响。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本文的版本已为</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USENIX WOOT 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">研讨会准备</font><font style="vertical-align: inherit;">。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源代码</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用。</font><font style="vertical-align: inherit;">在研讨会上演示的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zipbomb-woot19.zip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件中</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您是否找到了投掷其中一颗炸弹的系统？</font><font style="vertical-align: inherit;">炸弹是否可以帮助您发现错误或在错误搜索程序中赚钱？</font><font style="vertical-align: inherit;">让我知道，我会在这里尝试提及。</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> LibreOffice 6.1.5.2 </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将zblg.zip重命名为zblg.odt或zblg.docx之后，LibreOffice会创建并删除一系列大约4 GB的临时文件，以尝试确定文件格式。</font><font style="vertical-align: inherit;">最终，他完成了此操作，并在到达临时文件时将其删除，因此zip炸弹只会导致临时DoS而不会填满磁盘。</font><font style="vertical-align: inherit;">Kaolan McNamara回答了我的错误消息。</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mozilla附加组件服务器2019.06.06 </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我尝试对本地addons-server安装使用zip炸弹，这是addons.mozilla.org软件的一部分。</font><font style="vertical-align: inherit;">该系统可正常处理炸弹，提取文件的时间限制为110秒。</font><font style="vertical-align: inherit;">压缩炸弹会迅速扩展，直到磁盘允许达到此时间限制为止，但是此过程将被终止，最终解压缩的文件将自动清除。</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 解压缩6.0 </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">马克·阿德勒（Mark Adler）为UnZip编写了一个补丁，以检测此类拉链炸弹。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019年7月5日：我注意到</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE-2019-13232已分配给UnZip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我个人认为，UnZip（或任何zip解析器）处理这种zip炸弹的能力/无能必然是一个漏洞，甚至是一个bug。这是不违反规范的自然实现，我可以说什么。本文中的炸弹类型只是一种类型，还有许多其他方法可以使zip解析器困惑。如上所述，如果要保护自己免受资源耗尽攻击的侵害，则不应尝试列出，检测和阻止每一个已知的攻击。相反，有必要建立对时间和其他资源的外部限制，以使解析器无论遇到什么类型的攻击都不会陷入这种情况。尝试检测和拒绝某些设计作为第一遍的优化没有错，但你不能停在那里。除非最终以不受信任的数据隔离和限制操作，否则您的系统可能仍然容易受到攻击。考虑与HTML中的跨站点脚本的类比：正确的保护不是要尝试过滤掉可以解释为代码的特定字节，而是要正确地避免一切。</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 防毒引擎 </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter用户@TVqQAAMAAAAEAAA </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报告</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：“我的测试机上的McAfee防病毒软件刚刚爆炸。” </font><font style="vertical-align: inherit;">我自己尚未对其进行测试，并且没有诸如版本号之类的详细信息。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">塔维斯奥曼迪</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirusTotal为zblg.zip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有许多超时（</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从2019年6月6日的屏幕截图</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：安博士-V3，ClamAV的， DrWeb，残局，F-安全，的GData，K7AntiVirus，K7GW，MaxSecure，迈克菲，迈克菲-GW </font><font style="vertical-align: inherit;">-版本，熊猫，奇虎360，Sophos ML，VBA32。</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zbsm.zip的结果</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019年6月6日的屏幕截图</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）相似，但具有不同的超时引擎集：Baido，Bkav，ClamAV，CMC，DrWeb，Endgame，ESET-NOD32，F-Secure，GData，Kingsoft，McAfee-GW-Edition，NANO-Antivirus和Acronis。</font><font style="vertical-align: inherit;">有趣的是，</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zbxl.zip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">结果</font></a><font style="vertical-align: inherit;">中没有超时（</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019年6月6日的屏幕截图</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">也许某些防病毒软件不支持Zip64？</font><font style="vertical-align: inherit;">几个引擎将文件检测为一种“压缩炸弹”。</font><font style="vertical-align: inherit;">有趣的是，他们是否会继续进行较小的更改，例如更改文件名或向每个文件添加ASCII前缀。</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 最终声明 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在是时候结束Facebook了。</font><font style="vertical-align: inherit;">这对您来说不是一项中立的工作：每天上班时，您在做错事。</font><font style="vertical-align: inherit;">如果您拥有Facebook帐户，请将其删除。</font><font style="vertical-align: inherit;">如果您在Facebook上工作，请下岗。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而且不要忘记必须销毁国家安全局。</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN459254/">https://habr.com/ru/post/zh-CN459254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN459244/index.html">Notes产品经理：应用商店中游戏页面上的用户行为。 下载游戏需要多长时间</a></li>
<li><a href="../zh-CN459246/index.html">为什么网站转换减少？ 60个设计和可用性错误的示例</a></li>
<li><a href="../zh-CN459248/index.html">7月9日至7月14日在莫斯科举行的数字活动</a></li>
<li><a href="../zh-CN459250/index.html">PostgreSQL中的WAL：2.预记录日志</a></li>
<li><a href="../zh-CN459252/index.html">安全周28：入侵智能家居</a></li>
<li><a href="../zh-CN459256/index.html">我们如何针对不同平台优化主题医院</a></li>
<li><a href="../zh-CN459258/index.html">14,000英里未勾</a></li>
<li><a href="../zh-CN459262/index.html">22岁退休</a></li>
<li><a href="../zh-CN459264/index.html">摆脱Tarantool网络。 过滤流量时的节点同步</a></li>
<li><a href="../zh-CN459272/index.html">为React组件编写API，第1部分：不要创建冲突的道具</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>