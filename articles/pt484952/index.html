<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüîß ü§∂üèø üè¨ Substituindo Redux por Observables e React Hooks ü§° üï∫üèø ü••</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O gerenciamento de estado √© uma das tarefas mais importantes resolvidas no desenvolvimento do React. Muitas ferramentas foram criadas para ajudar os d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Substituindo Redux por Observables e React Hooks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484952/"><p><img align="right" src="https://habrastorage.org/webt/fo/2d/t7/fo2dt7_8xrgtb3goulj7cwpxrpg.png">  O gerenciamento de estado √© uma das tarefas mais importantes resolvidas no desenvolvimento do React.  Muitas ferramentas foram criadas para ajudar os desenvolvedores a resolver esse problema.  A ferramenta mais popular √© o Redux, uma pequena biblioteca criada por Dan Abramov para ajudar os desenvolvedores a usar o padr√£o de design do Flux em seus aplicativos.  Neste artigo, examinaremos se realmente precisamos do Redux e veremos como podemos substitu√≠-lo por uma abordagem mais simples, baseada nos ganchos Observable e React. </p><a name="habracut"></a><br><h1 id="zachem-nam-voobsche-nuzhen-redux">  Por que precisamos do Redux? </h1><br><p> O Redux √© t√£o frequentemente associado ao React que muitos desenvolvedores o usam sem pensar no motivo pelo qual precisam do Redux.  O React facilita a sincroniza√ß√£o de um componente e seu estado com <code>setState()</code> / <code>useState()</code> .  Mas tudo se torna mais complicado assim que o estado come√ßa a ser usado por v√°rios componentes ao mesmo tempo.  A solu√ß√£o mais √≥bvia para compartilhar um estado comum entre v√°rios componentes √© mov√™-lo (estado) para seu pai comum.  Por√©m, uma solu√ß√£o "frontal" pode levar rapidamente a dificuldades: se os componentes estiverem longe um do outro na hierarquia de componentes, a atualiza√ß√£o do estado geral exigir√° muita rolagem pelas propriedades dos componentes.  O contexto de rea√ß√£o pode ajudar a reduzir o n√∫mero de derramamentos, mas declarar um novo contexto toda vez que um estado come√ßa a ser usado em conjunto com outro componente exigir√° mais esfor√ßo e poder√° levar a erros. </p><br><p>  O Redux resolve esses problemas introduzindo um objeto <code>Store</code> que cont√©m todo o estado do aplicativo.  Nos componentes que requerem acesso ao estado, este <code>Store</code> √© implementado usando a fun√ß√£o de <code>connect</code> .  Essa fun√ß√£o tamb√©m garante que, quando um estado for alterado, todos os componentes que dependem dele sejam redesenhados.  Por fim, para alterar o estado, os componentes devem enviar a√ß√µes que acionam o redutor para calcular o novo estado alterado. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/b6f/531/9dc/b6f5319dc6eb751b9a18482cb7863f8d.gif"><br><p>  <em>Quando entendi pela primeira vez os conceitos de Redux</em> </p><br><h1 id="chto-ne-tak-s-redux">  O que h√° de errado com o Redux? </h1><br><p>  A primeira vez que li o <a href="https://redux.js.org/basics/basic-tutorial/" rel="nofollow">tutorial</a> oficial do <a href="https://redux.js.org/basics/basic-tutorial/" rel="nofollow">Redux</a> , fiquei mais impressionado com a grande quantidade de c√≥digo que precisei escrever para mudar de estado.  Alterar o estado requer declarar uma nova a√ß√£o, implementar o redutor correspondente e finalmente enviar a a√ß√£o.  O Redux tamb√©m incentiva a <a href="https://redux.js.org/basics/actions/" rel="nofollow">cria√ß√£o de um criador de a√ß√µes</a> para facilitar a cria√ß√£o de uma a√ß√£o sempre que voc√™ a enviar. </p><br><p>  Com todas essas etapas, o Redux complica a compreens√£o, refatora√ß√£o e depura√ß√£o de c√≥digo.  Ao ler o c√≥digo escrito por outra pessoa, geralmente √© dif√≠cil descobrir o que acontece quando a a√ß√£o √© enviada.  Primeiro, teremos que mergulhar no c√≥digo do criador da a√ß√£o para encontrar o tipo de a√ß√£o apropriado e, em seguida, encontrar os redutores que lidam com esse tipo de a√ß√£o.  As coisas podem se tornar ainda mais complicadas se alguns middlewares forem usados, como o redux-saga, que torna o contexto da solu√ß√£o ainda mais impl√≠cito. </p><br><p>  E, finalmente, ao usar o TypeScript, o Redux pode ser decepcionante.  Por design, as a√ß√µes s√£o simplesmente cadeias associadas a par√¢metros adicionais.  Existem maneiras de escrever c√≥digo Redux bem digitado usando o TypeScript, mas pode ser muito entediante e, novamente, pode levar a um aumento na quantidade de c√≥digo que precisamos escrever. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/b0e/9ff/261/b0e9ff26168370d91b5433ad8b1ae4fe.gif"><br><p>  <em>A emo√ß√£o de aprender c√≥digo escrito com Redux</em> </p><br><h1 id="observable-i-hook-prostoy-podhod-k-upravleniyu-sostoyaniem">  Observ√°vel e gancho: uma abordagem simples para gerenciar o estado. </h1><br><h3 id="zamenyaem-store-c-pomoschyu-observable">  Substituir loja por observ√°vel </h3><br><p>  Para resolver o problema do compartilhamento de estado de uma maneira mais simples, primeiro precisamos encontrar uma maneira de notificar os componentes quando outros componentes alteram seu estado geral.  Para fazer isso, vamos criar uma classe <code>Observable</code> que contenha um √∫nico valor e que permita que os componentes se inscrevam nas altera√ß√µes desse valor.  O m√©todo de inscri√ß√£o retornar√° a fun√ß√£o que deve ser chamada para cancelar a assinatura do <code>Observable</code> . </p><br><p>  No TypeScript, implementar essa classe √© bastante simples: </p><br><pre> <code class="javascript hljs">type Listener&lt;T&gt; = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">val: T</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; type Unsubscriber = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Observable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ private _listeners: Listener&lt;T&gt;[]; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private _val: T) {} get(): T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val; } set(val: T) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val !== val) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._val = val; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">l</span></span></span><span class="hljs-function"> =&gt;</span></span> l(val)); } } subscribe(listener: Listener&lt;T&gt;): Unsubscriber { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.push(listener); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._listeners.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">l</span></span></span><span class="hljs-function"> =&gt;</span></span> l !== listener); }; } }</code> </pre> <br><p>  Se voc√™ comparar essa classe com a Redux <code>Store</code> , ver√° que elas s√£o bastante semelhantes: <code>get()</code> corresponde a <code>getState()</code> e <code>subscribe()</code> √© o mesmo.  A principal diferen√ßa √© o m√©todo <code>dispatch()</code> , que foi substitu√≠do pelo m√©todo <code>set()</code> mais simples, que permite alterar o valor contido nele sem ter que confiar no redutor.  Outra diferen√ßa significativa √© que, ao contr√°rio do Redux, usaremos muito <code>Observable</code> vez de um √∫nico <code>Store</code> contendo todo o estado. </p><br><h3 id="zamenyaem-reducer-servisami">  Substituir servi√ßos redutores </h3><br><p>  Agora <code>Observable</code> pode ser usado para armazenar estado geral, mas ainda precisamos mover a l√≥gica contida no redutor.  Para isso, usamos o conceito de servi√ßos.  Servi√ßos s√£o classes que implementam toda a l√≥gica comercial de nossos aplicativos.  Vamos tentar reescrever o redutor <code>Todo</code> do tutorial Redux para o servi√ßo <code>Todo</code> usando o <code>Observable</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observable"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface Todo { readonly text: string; readonly completed: boolean; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> enum VisibilityFilter { SHOW_ALL, SHOW_COMPLETED, SHOW_ACTIVE, } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TodoService</span></span></span><span class="hljs-class"> </span></span>{ readonly todos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observable&lt;Todo[]&gt;<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">readonly</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">visibilityFilter</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Observable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter.SHOW_ALL</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">addTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text: string</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[...</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.todos.get(</span></span></span><span class="hljs-function">), { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">completed</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">false</span></span></span><span class="hljs-function"> }]); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">toggleTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index: number</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.todos.get(</span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">map</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> (todo, i</span></span></span><span class="hljs-function">) =&gt;</span></span> (i === index ? { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: todo.text, <span class="hljs-attr"><span class="hljs-attr">completed</span></span>: !todo.completed } : todo) )); } setVisibilityFilter(filter: VisibilityFilter) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.visibilityFilter.set(filter); } }</code> </pre> <br><p>  Comparando isso com o redutor <code>Todo</code> , podemos observar as seguintes diferen√ßas: </p><br><ul><li>  As a√ß√µes foram substitu√≠das por m√©todos, eliminando a necessidade de declarar um tipo de a√ß√£o, a pr√≥pria a√ß√£o e o criador da a√ß√£o. </li><li>  Voc√™ n√£o precisa mais escrever uma op√ß√£o grande para rotear entre o tipo de a√ß√£o.  O envio din√¢mico de Javascript (ou seja, chamadas de m√©todo) cuida disso. </li><li>  E o mais importante, o servi√ßo cont√©m e altera o estado que gerencia.  Essa √© uma grande diferen√ßa conceitual dos redutores, que s√£o fun√ß√µes puras. </li></ul><br><h2 id="dostup-k-servisam-i-observable-iz-komponentov">  Acesso a servi√ßos e observ√°vel a partir de componentes </h2><br><p>  Agora que substitu√≠mos ‚Äúarmazenamento e redutor do Redux‚Äù por ‚ÄúObservable and services‚Äù, precisamos disponibilizar os servi√ßos de todos os componentes do React.  Existem v√°rias maneiras de fazer isso: poder√≠amos usar a estrutura de IoC, por exemplo, Inversify;  use o contexto React ou use a mesma abordagem que no <code>Store</code> Redux - uma inst√¢ncia global para cada servi√ßo.  Neste artigo, consideraremos a √∫ltima abordagem: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TodoService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./todoService"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> todoService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TodoService();</code> </pre> <br><p>  Agora podemos acessar o estado compartilhado e alter√°-lo de todos os nossos componentes React importando uma inst√¢ncia de <code>todoService</code> .  Mas ainda precisamos encontrar uma maneira de redesenhar nossos componentes quando o estado geral for alterado por outro componente.  Para fazer isso, escreveremos um gancho simples que adiciona uma vari√°vel de estado ao componente, assina o <code>Observable</code> e atualiza a vari√°vel de estado quando o valor do <code>Observable</code> √© alterado: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useEffect, useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observable"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useObservable</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">observable: Observable&lt;T&gt;</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [val, setVal] = useState(observable.get()); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { setVal(observable.get()); <span class="hljs-comment"><span class="hljs-comment">//   @mayorovp return observable.subscribe(setVal); }, [observable]); return val; }</span></span></code> </pre> <br><h1 id="sobiraem-vse-vmeste">  Juntando tudo </h1><br><p>  Nosso kit de ferramentas est√° pronto.  Podemos usar <code>Observable</code> para armazenar o estado geral em servi√ßos e use <code>useObservable</code> para garantir que os componentes estejam sempre sincronizados com esse estado. </p><br><p>  Vamos reescrever o componente TodoList no tutorial do Redux usando o novo gancho: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useObservable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./observableHook"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { todoService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./services"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Todo, VisibilityFilter } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./todoService"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TodoList = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> todos = useObservable(todoService.todos); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = useObservable(todoService.visibilityFilter); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> visibleTodos = getVisibleTodos(todos, filter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div&gt; &lt;ul&gt; {visibleTodos.map((todo, index</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">TodoItem</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{index}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">todo</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{todo}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{index}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ))} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;p&gt; Show: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FilterLink</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">filter</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{VisibilityFilter.SHOW_ALL}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">All</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FilterLink</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>, &lt;FilterLink filter={VisibilityFilter.SHOW_ACTIVE}&gt;Active&lt;<span class="hljs-regexp"><span class="hljs-regexp">/FilterLink&gt;, &lt;FilterLink filter={VisibilityFilter.SHOW_ALL}&gt;Completed&lt;/</span></span>FilterLink&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/div&gt; ); }; const TodoItem = ({ todo: { text, completed }, index }: { todo: Todo; index: number }) =&gt; { return ( &lt;li style={{ textDecoration: completed ? "line-through" : "none", }} onClick={() =&gt; todoService.toggleTodo(index)} &gt; {text} &lt;/</span></span>li&gt; ); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FilterLink = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ filter, children }: { filter: VisibilityFilter; children: React.ReactNode }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> activeFilter = useObservable(todoService.visibilityFilter); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> active = filter === activeFilter; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> active ? <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;span&gt;{children}&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/span&gt; ) : ( &lt;a href="" onClick={() =&gt; todoService.setVisibilityFilter(filter)}&gt; {children} &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">a&gt; </span></span></span><span class="hljs-function">); }; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getVisibleTodos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos: Todo[], filter: VisibilityFilter</span></span></span><span class="hljs-function">): </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Todo</span></span></span><span class="hljs-function">[] { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">switch</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_ALL</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_COMPLETED</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t =&gt; t.completed</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">case</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">VisibilityFilter</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SHOW_ACTIVE</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">todos</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t =&gt; !t.completed</span></span></span><span class="hljs-function">); } }</span></span></code> </pre> <br><p>  Como podemos ver, escrevemos v√°rios componentes que se referem a valores de estado geral ( <code>todos</code> e <code>visibilityFilter</code> ).  Esses valores s√£o simplesmente alterados chamando m√©todos de <code>todoService</code> .  Gra√ßas ao gancho useObservable, que assina as altera√ß√µes de valor, esses componentes s√£o redesenhados automaticamente quando o estado geral √© alterado. </p><br><h1 id="vyvod">  Conclus√£o </h1><br><p>  Se compararmos esse c√≥digo com a abordagem Redux, veremos v√°rias vantagens: </p><br><ul><li>  <strong>Concis√£o: a</strong> √∫nica coisa que precis√°vamos fazer era <code>useObservable</code> os valores de estado no <code>Observable</code> e usar hook <code>useObservable</code> ao acessar esses valores a partir dos componentes.  N√£o h√° necessidade de declarar a√ß√£o, criador de a√ß√£o, escrever ou combinar redutor ou conectar nossos componentes ao reposit√≥rio com os <code>mapDispatchToProps</code> e <code>mapDispatchToProps</code> . </li><li>  <strong>Simplicidade:</strong> agora √© muito mais f√°cil acompanhar a execu√ß√£o do c√≥digo.  Entender o que realmente acontece quando um bot√£o √© pressionado √© apenas uma quest√£o de mudar para a implementa√ß√£o do m√©todo chamado.  A execu√ß√£o passo a passo usando o depurador tamb√©m √© significativamente aprimorada, pois n√£o h√° n√≠vel intermedi√°rio entre nossos componentes e nossos servi√ßos. </li><li>  <strong>Seguran√ßa de</strong> digita√ß√£o pronta para uso <strong>: os</strong> desenvolvedores do TypeScript n√£o precisar√£o de trabalho adicional para digitar o c√≥digo corretamente.  N√£o h√° necessidade de declarar tipos para o estado e para cada a√ß√£o. </li><li>  <strong>Suporte para ass√≠ncrono / espera:</strong> embora isso n√£o tenha sido demonstrado aqui, esta solu√ß√£o funciona muito bem com fun√ß√µes ass√≠ncronas, simplificando bastante a programa√ß√£o ass√≠ncrona.  N√£o h√° necessidade de confiar no middleware, como o redux-thunk, que requer um profundo conhecimento de programa√ß√£o funcional para entender. </li></ul><br><p>  O Redux, √© claro, ainda tem algumas vantagens importantes, especialmente o Redux DevTools, que permite que os desenvolvedores monitorem as altera√ß√µes de estado durante o desenvolvimento e passem no tempo para os estados anteriores do aplicativo, o que pode ser uma √≥tima ferramenta de depura√ß√£o.  Mas, na minha experi√™ncia, raramente usei isso, e o pre√ßo a pagar parece alto demais para um pequeno ganho. </p><br><p>  Em todos os nossos aplicativos React e React Native, usamos com sucesso uma abordagem semelhante √† descrita neste artigo.  De fato, nunca sentimos a necessidade de um sistema de gerenciamento de estado mais complexo do que isso. </p><br><h1 id="primechaniya">  Anota√ß√µes </h1><br><p>  A classe <code>Observable</code> introduzida neste post √© bastante simples.  Ele pode ser substitu√≠do por implementa√ß√µes mais avan√ßadas, como micro-observ√°veis ‚Äã‚Äã(nossa pr√≥pria biblioteca) ou RxJS. </p><br><p>  A solu√ß√£o apresentada aqui √© muito semelhante ao que pode ser alcan√ßado com o MobX.  A principal diferen√ßa √© que o MobX suporta uma profunda mutabilidade do estado dos objetos.  Ele tamb√©m conta com os proxies do ES6 para notificar altera√ß√µes, re-renderizar implicitamente e complicar a depura√ß√£o quando as coisas n√£o funcionam como o esperado.  Al√©m disso, o MobX n√£o funciona bem com fun√ß√µes ass√≠ncronas. </p><br><blockquote>  De um tradutor: esta publica√ß√£o, que pode ser vista como uma introdu√ß√£o ao gerenciamento de estado usando o Observable, √© uma continua√ß√£o do t√≥pico abordado no artigo <a href="https://habr.com/ru/post/483526/">Gerenciando o estado do aplicativo com o RxJS / Immer como uma alternativa simples ao Redux / MobX</a> , que descreve como simplificar o uso dessa abordagem. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484952/">https://habr.com/ru/post/pt484952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484934/index.html">Do desenvolvimento pessoal ao Agile em uma escala XXXL em dois dias na TeamLead Conf</a></li>
<li><a href="../pt484936/index.html">Conhecimento e compet√™ncias da equipe: encontre, veja, bombeie</a></li>
<li><a href="../pt484944/index.html">O que eu estou no ACID ou n√£o nos conv√©m</a></li>
<li><a href="../pt484946/index.html">Modelagem GPR</a></li>
<li><a href="../pt484948/index.html">NEC lan√ßou um cabo submarino com um recorde de 20 pares de fibras √≥pticas</a></li>
<li><a href="../pt484954/index.html">Guia de solu√ß√£o de problemas visuais para Kubernetes</a></li>
<li><a href="../pt484964/index.html">Configurando o balanceamento de carga no InfoWatch Traffic Monitor</a></li>
<li><a href="../pt484966/index.html">Modelo pronto para teste usando o Spring</a></li>
<li><a href="../pt484968/index.html">WPF DataGrid. Lutar por modelo</a></li>
<li><a href="../pt484972/index.html">Lan√ßamento do Wine 5.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>