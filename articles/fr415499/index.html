<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßúüèæ üéè üôãüèΩ Comment arr√™ter d'avoir peur du progr√®s et commencer √† vivre üë®‚Äçüë©‚Äçüëß üèµÔ∏è üåÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, je suis d√©veloppeur Android et je n'ai plus peur de ProGuard ... 


 Habituellement, cet utilitaire est m√©moris√© lorsqu'il est confront√© √† un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment arr√™ter d'avoir peur du progr√®s et commencer √† vivre</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415499/"><p><img src="https://habrastorage.org/webt/ws/uk/rs/wsukrsowhkx1zzbqyocrumhhsmi.png"></p><br><p>  Bonjour, je suis d√©veloppeur Android et je n'ai plus peur de ProGuard ... </p><br><p> Habituellement, cet utilitaire est m√©moris√© lorsqu'il est confront√© √† un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">probl√®me de limite dex dalvik</a> ou √† une exigence pour am√©liorer la s√©curit√© des applications.  Malheureusement, c'est loin d'√™tre la premi√®re fois de configurer correctement Proguard.  J'ai souvent vu combien, apr√®s avoir interrompu un projet, d√©sactiv√© Proguard et activ√© le support Mulditex, et chaque fois j'√©tais un peu triste, car Proguard aide √† la fois √† r√©duire la taille de l'application et √† augmenter ses performances. </p><br><p>  En fin de compte, j'ai d√©cid√© d'√©crire un article dans lequel je peux mettre toutes les informations utiles que j'ai apprises au cours de plusieurs ann√©es de travail avec Proguard et qui pourraient aider les d√©butants et ceux qui savent d√©j√† quelque chose. </p><a name="habracut"></a><br><h2 id="o-chem-eto">  De quoi s'agit-il </h2><br><p>  Proguard est un utilitaire open source pour l'optimisation et l'obscurcissement du code Java.  Cet outil traite le code Java d√©j√† compil√©, il devrait donc fonctionner avec n'importe quel langage JVM.  Plus pr√©cis√©ment, le langage lui-m√™me pour Proguard est indiff√©rent, seul le bytecode est important.  Toutes les manipulations de bytecode proguard peuvent √™tre divis√©es en 3 cat√©gories principales: <strong>r√©duction du code</strong> , <strong>optimisation</strong> et <strong>obscurcissement</strong> . </p><br><h3 id="code-shrinking">  R√©tr√©cissement du code </h3><br><p>  Oui, c'est une entreprise plut√¥t √©trange d'√©crire du code puis de le supprimer, mais c'est la r√©alit√© du d√©veloppement Android.  Bien s√ªr, cela ne concerne pas le code √©crit √† la main (bien que cela se produise), mais des tonnes de cargaisons mortes apport√©es par des biblioth√®ques de toutes sortes.  <strong>La goyave</strong> , <strong>Apache Commons</strong> , <strong>les services Google Play</strong> et d'autres types peuvent gonfler la taille du fichier apk de 500 Ko √† quelques dizaines de m√©gaoctets.  Parfois, cela va si loin qu'un programme ne peut pas compiler en raison du d√©passement de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">limite des m√©thodes Dalvik</a> .  Proguard aidera √† supprimer tout le code inutilis√© et √† r√©duire la taille de l'application √† quelques m√©gaoctets. </p><br><h3 id="optimisation">  Optimisation </h3><br><p>  En plus de supprimer le code inutile, Proguard peut optimiser le code restant.  Son arsenal comprend l'analyse de flux de contr√¥le, l'analyse de flux de donn√©es, l'√©valuation partielle, l'affectation unique statique, la num√©rotation des valeurs globales, l'analyse de la vivacit√©.  Proguard peut effectuer des optimisations de judas, r√©duire le nombre d'allocations de variables, simplifier les r√©cursions de queue et bien plus encore ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki</a> ).  En plus de ces op√©rations g√©n√©rales, Proguard poss√®de des optimisations utiles sp√©cifiquement pour la plate-forme Android, par exemple, en rempla√ßant les classes enum par des entiers, en supprimant les instructions de journalisation. </p><br><h3 id="obfuscation">  Obfuscation </h3><br><p>  Enfin, Proguard peut transformer tout votre code en un d√©sordre illisible en renommant toutes les classes, m√©thodes et champs en ensembles de lettres al√©atoires (en fait pas tout √† fait al√©atoires).  C'est une option tr√®s utile, car n'importe qui peut d√©compiler votre fichier apk, et tout le monde n'a pas la patience de comprendre le code obscurci. </p><br><h2 id="princip-raboty">  Principe de fonctionnement </h2><br><p>  Proguard fonctionne en 3 √©tapes dans l'ordre d√©crit ci-dessus: <strong>r√©duction du code</strong> ‚Üí <strong>optimisation</strong> ‚Üí <strong>obfuscation</strong> .  Chacune des √©tapes est facultative. </p><br><p>  <em>L'√©tape d'optimisation dans le cas du SDK Android est d√©sactiv√©e par d√©faut.</em> </p><br><p>  Pour que Proguard fonctionne, vous devez fournir 3 composants: </p><br><ul><li> Votre code compil√© est une archive avec les fichiers de <code>class</code> de votre programme et toutes les biblioth√®ques que vous utilisez (jar, aar, apk, war, zip, etc.).  Proguard ne modifie que le code d√©j√† compil√© et n'a rien √† voir avec la source. </li><li>  Fichier (s) de configuration - fichier (s) contenant toutes les r√®gles, options et param√®tres avec lesquels vous souhaitez commencer le traitement. </li><li>  Bocaux de biblioth√®que (aar, apks, ...) - classes de la plateforme sur laquelle votre programme s'ex√©cute.  Dans le cas d'Android, c'est <code>android.jar</code> .  Ces archives ne sont n√©cessaires que pour l'analyse correcte de votre code, elles ne seront pas modifi√©es (cela n'a aucun sens, puisque <code>android.jar</code> est "au t√©l√©phone", nous n'y avons pas acc√®s). </li></ul><br><p><img src="https://habrastorage.org/webt/sf/vb/b8/sfvbb8uuvqdacgnjvzmeka3zpa4.png" alt="Image de la pr√©sentation de Jeb Ware, lien √† la fin de l'article"><br>  (Image de la pr√©sentation de Jeb Ware, lien √† la fin de l'article) </p><br><p>  √Ä l'aide des classes de biblioth√®que et de vos fichiers de configuration, Proguard d√©finit tous les points d'entr√©e de votre programme ( <strong>graines</strong> ).  En d'autres termes, il d√©finit les classes et m√©thodes qui peuvent √™tre appel√©es de l'ext√©rieur et qui ne peuvent pas √™tre touch√©es.  Ensuite, en commen√ßant par les <strong>graines</strong> d√©couvertes, Proguard parcourt r√©cursivement tout votre code, signalant ¬´utilis√©¬ª tout ce qu'il peut atteindre.  Tout autre code sera supprim√©.  Vous devez sp√©cifier au moins un point d'entr√©e dans la configuration.  Pour un programme java standard, c'est la fonction <code>main</code> .  Dans Android, il n'y a pas de point d'entr√©e unique dans le programme; au lieu de cela, nous avons des composants standard (activit√©, service, etc.) qui sont cr√©√©s et appel√©s par le syst√®me.  Heureusement, nous n'avons pas besoin de sp√©cifier quoi que ce soit ici, le SDK Android cr√©era la configuration n√©cessaire pour nous. </p><br><h3 id="soputstvuyuschie-fayly">  Fichiers compagnon </h3><br><p>  Apr√®s avoir d√©tect√© tous les points d'entr√©e, Proguard les enregistrera dans le fichier <code>seeds.txt</code> . </p><br><p>  Tout le code que Proguard a trouv√© inutile est √©crit dans le fichier <code>usage.txt</code> .  C'est un nom assez √©trange pour un fichier contenant du code √† distance, il serait plus correct de l'appeler unsage.txt, mais nous avons ce que nous avons, rappelez-vous juste cela. </p><br><p>  √Ä l'√©tape d'obscurcissement, un fichier <code>mapping.txt</code> sera cr√©√© contenant les paires &lt;nom de classe d'origine | m√©thode | champ&gt; -&gt; &lt;nom de classe obscurci | m√©thode | champ&gt;.  Ce fichier est utile lorsque vous devez d√©sobfusquer un programme, par exemple, lire stacktrace.  Le mappage manuel des fichiers n'est pas n√©cessaire; le SDK Android a des utilitaires de <code>retrace</code> et <code>proguardui</code> pour vous aider.  De plus, si vous utilisez Fabric Crashlytics, leur plugin Gradle peut rechercher et charger ce fichier de mani√®re ind√©pendante dans la console, vous n'avez donc pas √† vous en pr√©occuper. </p><br><p>  Dans le cas d'Android, ces fichiers se trouvent g√©n√©ralement dans <code>app/build/output/mapping/&lt;product-flavor-name&gt;/</code> . </p><br><p>  Proguard cr√©e √©galement un fichier <code>dump.txt</code> qui contient tout ce que Proguard a mis dans l'archive finale.  Il ne m'a jamais √©t√© utile, mais peut-√™tre que cela sera utile √† quelqu'un. </p><br><h3 id="kak-dela-obstoyat-v-android">  Comment √ßa se passe sur Android </h3><br><p>  Le plugin Android Gradle peut ex√©cuter Proguard seul.  Il vous suffit d'activer cette option et de sp√©cifier les fichiers de configuration. </p><br><pre> <code class="hljs cs">buildTypes { &lt;...&gt; release { minifyEnabled <span class="hljs-literal"><span class="hljs-literal">true</span></span> proguardFiles <span class="hljs-string"><span class="hljs-string">'proguard-rules.pro'</span></span>, getDefaultProguardFile(<span class="hljs-string"><span class="hljs-string">'proguard-android.txt'</span></span>) } }</code> </pre> <br><p>  <code>minifyEnabled true</code> - activer Proguard au moment de la construction </p><br><p>  <code>proguardFiles</code> - une liste de fichiers de configuration.  Les r√®gles de tous les fichiers de configuration seront ajout√©es √† la liste g√©n√©rale dans l'ordre o√π elles apparaissent. </p><br><p>  <code>proguard-rules.pro</code> est notre fichier de configuration avec des r√®gles sp√©cifiques au projet </p><br><p>  <code>getDefaultProguardFile('proguard-android.txt')</code> - une fonction qui renvoie le fichier de configuration standard pour les applications Android.  Il se trouve dans <code>AndroidSDK/tools/proguard</code> </p><br><p>  En fait, le SDK Android poss√®de deux <code>proguard-android.txt</code> : <code>proguard-android.txt</code> et <code>proguard-android-optimize.txt</code> .  Le premier a l'option <code>-dontoptimize</code> , qui d√©sactive toutes les optimisations.  Si vous souhaitez activer l'optimisation, utilisez la deuxi√®me configuration. </p><br><p>  En plus de ces configurations standard, le SDK Android (aapt) g√©n√®re automatiquement un ensemble de r√®gles pour les ressources: aapt v√©rifie tous les fichiers xml (y compris le manifeste) pour trouver toutes les activit√©s, services, vues, etc.  et g√©n√©rer les r√®gles n√©cessaires pour eux.  Les r√®gles g√©n√©r√©es se trouvent dans <code>app/build/intermediates/proguard-rules/&lt;flavor&gt;/aapt_rules.txt</code> .  Vous n'avez pas besoin de le sp√©cifier vous-m√™me, le plugin Android Gradle ajoutera automatiquement ces r√®gles. </p><br><p><img src="https://habrastorage.org/webt/1r/w4/t6/1rw4t6egtvymigl79hnxc3n8t9a.png" alt="Image de la pr√©sentation de Jeb Ware, lien √† la fin de l'article"><br>  (Image de la pr√©sentation de Jeb Ware, lien √† la fin de l'article) </p><br><h2 id="konfigi">  Configurations </h2><br><p>  La configuration de Proguard est la partie la plus √©l√©mentaire de son utilisation et en m√™me temps la plus difficile.  Une configuration incorrecte peut facilement interrompre la compilation de l'application et de l'application elle-m√™me lors de l'ex√©cution.  Toutes les options de configuration disponibles sont document√©es en d√©tail sur off.  site. </p><br><p>  Parmi toutes les options, je citerais les 3 groupes les plus importants: </p><br><ul><li>  garder les r√®gles - Tous les points d'entr√©e possibles au programme.  R√®gles indiquant √† Proguard quelles classes ou parties de classes ne doivent pas √™tre modifi√©es ou quelles modifications sont valables pour des classes sp√©cifiques. </li><li>  optimisation - indiquez quelles optimisations sont acceptables, combien de cycles d'optimisation doivent √™tre effectu√©s. </li><li>  travailler avec les avertissements, les erreurs et le d√©bogage </li></ul><br><h3 id="keep-rules">  Gardez les r√®gles </h3><br><p>  Il s'agit d'un ensemble d'options con√ßues pour prot√©ger votre code contre le Progressive impitoyable.  Dans sa forme la plus g√©n√©rale, cette r√®gle ressemble √† ceci: </p><br><pre> <code class="hljs powershell"><span class="hljs-literal"><span class="hljs-literal">-keep</span></span> [,<span class="hljs-type"><span class="hljs-type">modifier</span></span>,<span class="hljs-type"><span class="hljs-type">...</span></span>] class_specification</code> </pre> <br><p>  <code>keep</code> est la plus courante de ces options (il y en a d'autres), indiquant √† Proguard de sauvegarder la classe elle-m√™me et tous ses membres: champs et m√©thodes. </p><br><p>  <code>class_specification</code> - un mod√®le pointant vers la (les) classe (s) ou ses parties (membres de la classe).  La vue g√©n√©rale du mod√®le est tr√®s grande, elle peut √™tre visualis√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> .  Vous pouvez le contacter, mais en g√©n√©ral, vous vous souvenez simplement que nous avons la possibilit√© de composer un mod√®le de ces composants: </p><br><ul><li>  s√©lectionner toutes les classes avec un nom sp√©cifique, un package </li><li>  s√©lectionner toutes les classes qui h√©ritent / impl√©mentent certaines classes / interfaces </li><li>  s√©lectionner toutes les classes avec des modificateurs et / ou des annotations sp√©cifiques </li><li>  s√©lectionner toutes les m√©thodes avec un nom, des modificateurs, des arguments et une valeur de retour sp√©cifiques </li><li>  s√©lectionnez tous les champs avec un nom sp√©cifique, des modificateurs, d'un type sp√©cifique. </li><li><p>  il est possible d'utiliser des caract√®res g√©n√©riques </p><br><p>  Encore une fois, ce n'est pas une description stricte du mod√®le, c'est plut√¥t une liste des fonctionnalit√©s que nous avons.  Voici quelques exemples: </p><br></li></ul><br><p> <code>-keep public class com.example.MyActivity</code> <br>  enregistrer la classe <code>com.example.MyActivity</code> </p><br><p> <code>-keep public class * extends android.app.Activity</code> <br>  enregistrer toutes les classes publiques h√©ritant <code>android.app.Activity</code> </p><br><pre> <code class="hljs scala">-keep public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">android</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>); public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>, android.util.<span class="hljs-type"><span class="hljs-type">AttributeSet</span></span>); public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>, android.util.<span class="hljs-type"><span class="hljs-type">AttributeSet</span></span>, int); public void set*(...); }</code> </pre> <br><p>  trouver toutes les classes publiques qui h√©ritent de <code>android.view.View</code> et enregistrer 3 constructeurs avec certains param√®tres en eux + toutes les m√©thodes publiques, avec le modificateur <code>void</code> , tous les arguments et un nom commen√ßant par <code>set</code> .  Toutes les autres parties de la classe peuvent √™tre modifi√©es. </p><br><p> <code>-keep class com.habr.** { *; }</code> <br>  enregistrer toutes les classes et tout leur contenu dans le package <code>com.habr</code> </p><br><p>  <code>modifiers</code> - ajout √† la r√®gle de conservation: </p><br><ul><li>  <code>includedescriptorclasses</code> - en plus de la classe / m√©thode / champ sp√©cifi√©, vous devez enregistrer toutes les classes pr√©sentes dans leurs descripteurs. </li><li>  <code>includecode</code> - le contenu de la m√©thode point√©e par cette r√®gle particuli√®re ne peut pas non plus √™tre touch√©. </li><li>  <code>allowshrinking</code> - les classes point√©es par cette r√®gle ne sont pas des graines et peuvent √™tre supprim√©es, mais seulement si elles ne sont pas utilis√©es dans le programme lui-m√™me.  Cependant, si apr√®s la r√©duction du code, ce code persiste (du fait que quelqu'un l'utilise), il est impossible d'optimiser / de masquer ce code. </li><li>  <code>allowoptimization</code> - les classes r√©f√©renc√©es par cette r√®gle peuvent uniquement √™tre optimis√©es, mais ne peuvent pas √™tre supprim√©es ou masqu√©es. </li><li>  <code>allowobfuscation</code> - les classes point√©es par cette r√®gle peuvent uniquement √™tre obscurcies, mais ne peuvent pas √™tre supprim√©es ou optimis√©es. </li></ul><br><p>  En plus de <code>keep</code> , il y a quelques autres options: </p><br><p>  <code>-keepclassmembers</code> - indique que les membres de la classe doivent √™tre enregistr√©s si la classe elle-m√™me est pr√©serv√©e apr√®s la r√©duction du code. </p><br><p>  <code>-keepclasseswithmembers</code> - indique que vous souhaitez enregistrer les classes dont le contenu rel√®ve du mod√®le sp√©cifi√©.  Par exemple, <code>-keepclasseswithmembers class * { public &lt;init&gt;(android.content.Context); }</code>  <code>-keepclasseswithmembers class * { public &lt;init&gt;(android.content.Context); }</code> - enregistre toutes les classes qui ont un constructeur public avec un argument de type <code>Context</code> . </p><br><p>  <code>-keepnames</code> - abr√©viation de <code>-keep,allowshrinking</code> . </p><br><p>  <code>-keepclassmembernames</code> - raccourci pour <code>-keepclassmembers,allowshrinking</code> . </p><br><p>  <code>keepclasseswithmembernames</code> - abr√©viation de <code>-keepclasseswithmembers,allowshrinking</code> . </p><br><h3 id="optimisation-tuning">  R√©glage d'optimisation </h3><br><p>  L'option la plus importante ici est le drapeau <code>-dontoptimize</code> .  S'il est pr√©sent, aucune optimisation ne sera effectu√©e et toutes les autres options d'optimisation seront ignor√©es. </p><br><p>  Il existe de nombreuses options d'optimisation, mais les suivantes me sont tr√®s utiles: </p><br><p>  <code>-optimizations optimization_filter</code> - r√©pertoriant toutes les fa√ßons dont vous souhaitez utiliser.  Il est pr√©f√©rable d'utiliser l'ensemble sp√©cifi√© dans <code>proguard-android-optimize.txt</code> ou un sous-ensemble de celui-ci.  Une liste de toutes les optimisations peut √™tre trouv√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p>  <code>-optimizationpasses n</code> - nombre de cycles d'optimisation.  Plusieurs cycles peuvent am√©liorer le r√©sultat.  En m√™me temps, Proguard est suffisamment intelligent pour arr√™ter les cycles s'il constate que le r√©sultat ne s'est pas am√©lior√© depuis la derni√®re fois. </p><br><p>  <code>-assumenosideeffects class_specification</code> - indique que cette m√©thode n'a aucun effet secondaire et ne renvoie qu'une valeur.  Proguard supprimera les appels √† cette m√©thode s'il d√©tecte que le r√©sultat qu'il renvoie n'est pas utilis√©.  L'utilisation la plus courante de cette option est peut-√™tre de supprimer tous les journaux de d√©bogage: <code>-assumenosideeffects class android.util.Log { public static int d(...); }</code> <code>-assumenosideeffects class android.util.Log { public static int d(...); }</code> </p><br><p>  <code>-allowaccessmodification</code> - affiche tout ce qui est cach√© :) Une excellente option qui vous permet de vous d√©barrasser d'un tas de m√©thodes d'accessoires artificiels pour les classes imbriqu√©es.  <code>-repackageclasses</code> uniquement en conjonction avec <code>-repackageclasses</code> </p><br><p>  <code>-repackageclasses</code> - <code>-repackageclasses</code> de d√©placer toutes les classes vers un package sp√©cifi√©.  Cela s'applique davantage √† l'obscurcissement, mais en m√™me temps, donne de bons r√©sultats en optimisation. </p><br><h3 id="prochie-poleznye-opcii">  Autres options utiles </h3><br><p>  <code>-dontwarn</code> et <code>-dontnote</code> </p><br><p>  Proguard est tr√®s intelligent et signale toujours des endroits suspects lors de l'analyse de code, parfois ce sont des notes, parfois des avertissements.  Si votre build ne fonctionne pas avec Proguard activ√©, assurez-vous de lire tous les journaux qu'il produit, il √©crira ce qui s'est mal pass√© et, tr√®s probablement, vous indiquera m√™me comment le corriger.  Apr√®s avoir lu tous les messages, vous pouvez soit r√©soudre le probl√®me, soit ignorer le message de l'une de ces options si vous √™tes s√ªr qu'il n'y a pas de probl√®me. </p><br><p>  Par exemple, il arrive que certaines biblioth√®ques java utilisent des classes de plate-forme qui ne sont pas dans android.jar et Proguard vous en avertira.  Si vous √™tes s√ªr que cette biblioth√®que fonctionne correctement dans un environnement Android, vous pouvez d√©sactiver cet avertissement <code>-dontwarn java.lang.management.**</code> </p><br><p>  <code>-whyareyoukeeping class_specification</code> est une option utile qui affichera la raison pour laquelle Proguard a d√©cid√© de ne pas toucher √† cette classe / m√©thode. </p><br><p>  <code>-verbose</code> - imprimer des journaux et des exceptions plus d√©taill√©s </p><br><p>  <code>-printconfiguration</code> - imprime une liste compl√®te des options de tous les fichiers de configuration qui ont √©t√© utilis√©s, y compris les r√®gles des biblioth√®ques et g√©n√©r√©es via aapt. </p><br><p>  <code>-keepattributes SourceFile, LineNumberTable</code> - enregistre les m√©ta-informations (noms de fichiers, num√©rotation des lignes) pour pouvoir d√©boguer le code dans l'EDI et obtenir une trace de pile significative.  Assurez-vous d'ajouter cette option. </p><br><h3 id="praktika">  Pratique </h3><br><p>  Cela se produit g√©n√©ralement: allumez Proguard et cela vous casse tout le projet en donnant une tonne d'erreurs.  Beaucoup √† cette √©tape d√©sactivent Proguard et essaient de ne pas y revenir.  Je vais essayer de vous donner quelques conseils pour faciliter ce processus de transition. </p><br><h4 id="opredelitsya-s-nachalnymi-vhodnymi-tochkami">  D√©cidez des points d'entr√©e de d√©part </h4><br><p>  Si vous √™tes un d√©veloppeur Android, tout est extr√™mement √©l√©mentaire - il suffit de s√©lectionner l'une des deux configurations standard du SDK Android: <code>proguard-android.txt</code> ou <code>proguard-android-optimize.txt</code> , ils s'occuperont de tout ce qui devrait rester intact. </p><br><h4 id="proverit-vse-biblioteki">  V√©rifiez toutes les biblioth√®ques </h4><br><p>  R√©cemment, de plus en plus de biblioth√®ques sont distribu√©es avec des proguard-configs pr√™tes √† l'emploi.  Proguard peut regarder √† l'int√©rieur de l'archive, trouver la configuration de la biblioth√®que et l'ajouter √† d'autres options.  V√©rifiez chaque biblioth√®que que vous utilisez pour une telle configuration. </p><br><p><img src="https://habrastorage.org/webt/rf/dq/vn/rfdqvnztj-zagmqtzwctc73x3-k.png" alt="(contenu d'un fichier aar d'une des biblioth√®ques)"><br>  (contenu d'un fichier aar d'une des biblioth√®ques) </p><br><p>  Si vous utilisez les services Google Play, le plug <code>com.google.gms.google-services</code> in <code>com.google.gms.google-services</code> s√©lectionnera vous-m√™me la configuration dont vous avez besoin. </p><br><p>  Si les auteurs de la biblioth√®que n'emballent pas la config dans l'archive, ils ont peut-√™tre fait attention et √©crit les r√®gles sur leur site web, sur la page du r√©f√©rentiel ou dans le fichier README.  Essayez de trouver vous-m√™me la configuration de la version de la biblioth√®que que vous utilisez. </p><br><p>  Si vous ne trouvez aucune r√®gle pr√™te √† l'emploi, vous devrez lire les journaux et r√©soudre le probl√®me individuellement.  Tr√®s probablement, vous devrez ajouter des r√®gles de conservation pour le code de biblioth√®que cass√©.  Ou ignorez les erreurs si elles n'interf√®rent pas avec le programme. </p><br><h4 id="provesti-inspekciyu-svoego-koda">  Inspectez votre code </h4><br><p>  Vous savez mieux quel code vous pouvez envoyer sous le couteau, mais vous devriez quand m√™me regarder attentivement tous les endroits o√π la r√©flexion est utilis√©e: </p><br><ul><li>  Class.forName (...) (la documentation promet que Proguard est capable de d√©finir un tel code, cependant, il y a eu des cas, cela vaut la peine d'√™tre v√©rifi√©) </li><li>  Mod√®les / classes d'entit√© utilis√©s pour la s√©rialisation, le mappage.  Toutes les classes dont les noms de champs (parfois les classes elles-m√™mes) sont importantes √† conserver (Gson, RealmIO, etc.) </li><li>  appels de biblioth√®que natifs via JNI </li></ul><br><h4 id="testy">  Les tests </h4><br><p>  Si une classe / m√©thode est utilis√©e uniquement dans les tests et nulle part ailleurs, Proguard supprimera ce code.  C'est une situation courante si vous avez TDD :) Pour ce cas, j'ai une configuration s√©par√©e, o√π j'ajoute des classes qui ne sont pas encore int√©gr√©es dans le projet, ne sont utilis√©es nulle part, mais qui doivent √™tre test√©es. </p><br><p>  Dans le plugin Android Gradle, en plus des instructions <code>proguardFiles</code> , il y a toujours <code>testProguardFiles</code> .  Cette instruction est n√©cessaire pour sp√©cifier les configurations qui seront appliqu√©es √† l'application de test g√©n√©r√©e afin de tester votre application lorsque vous ex√©cutez des tests d'instrumentation.  Habituellement, ceci est utilis√© afin d'obtenir la m√™me optimisation / obscurcissement dans les deux fichiers apk afin qu'il n'y ait pas de d√©synchronisation entre eux.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien</a> </p><br><h4 id="apk-analyzer">  Analyseur APK </h4><br><p>  Android Studio a un excellent outil.  Vous pouvez l'ouvrir soit via Find Action -&gt; Analyze APK, soit en ouvrant le fichier apk lui-m√™me dans Android Studio.  Analyzer affiche de nombreuses informations utiles, mais nous nous int√©ressons maintenant au code.  Pour voir ce qui a finalement √©t√© int√©gr√© dans un fichier APK, vous devez s√©lectionner le fichier <code>classes.dex</code> </p><br><p><img src="https://habrastorage.org/webt/go/zz/o_/gozzo_o83s3e1mknkxhqldrzr3g.png"></p><br><p>  Par d√©faut, vous verrez exactement le code r√©sultant qui a pass√© les √©tapes de r√©duction et d'optimisation.  Cependant, vous pouvez cliquer sur le <strong>bouton Charger les mappages de Proguard ...</strong> , ajouter <code>seeds.txt</code> et <code>usage.txt</code> pour voir le code qui a √©t√© supprim√©. </p><br><p><img src="https://habrastorage.org/webt/gy/4a/gk/gy4agkxifirpyy95-exhk1xmguc.png"></p><br><p>  Si, pour une raison quelconque, Proguard a modifi√© le code dont vous avez besoin, recherchez-le dans Analyzer et s√©lectionnez <strong>G√©n√©rer la r√®gle de conservation Proguard</strong> via RMB.  Analyzer g√©n√©rera un choix de plusieurs options pour les r√®gles, de la plus g√©n√©rale √† la plus sp√©cifique, s√©lectionnez <strong>UNE</strong> d'entre elles. </p><br><p><img src="https://habrastorage.org/webt/ny/zc/ob/nyzcobecp45cnrrjgq3unu3_zba.png"></p><br><p><img src="https://habrastorage.org/webt/yq/wg/0m/yqwg0mwllbw9wauhemkvffgk_h8.png"></p><br><h4 id="dlya-avtorov-bibliotek">  Pour les auteurs de biblioth√®que </h4><br><p>  Si vous cr√©ez une biblioth√®que Android, vous pouvez ajouter une configuration proguard pour vos clients comme suit: </p><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">buildTypes</span></span> { <span class="hljs-section"><span class="hljs-section">release</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">consumerProguardFiles</span></span> <span class="hljs-string"><span class="hljs-string">'proguard-rules.pro'</span></span> } }</code> </pre> <br><p>  √Ä mon avis, il vaut mieux ne pas optimiser et obscurcir votre biblioth√®que avec z√®le, mais offrir cette opportunit√© √† vos clients.  Un bon ton est d'ajouter √† la configuration ce que les clients devront encore ajouter s'ils incluent Proguard.  Cependant, si vous souhaitez toujours ajouter de la s√©curit√©, il est √©vident que vous devez prot√©ger l'int√©gralit√© de l'API pulic de votre biblioth√®que de Proguard, y compris les descripteurs et les signatures. </p><br><h3 id="r8-dexguard-i-redex">  R8, DexGuard et Redex </h3><br><p>  R8 est le nouvel outil de Google pour remplacer l'actuel Proguard.  Attendez, n'essayez pas d'oublier tout ce que vous venez de lire dans l'article, traitez-le comme le nouveau Proguard.  Google promet de conserver l'int√©gralit√© de l'API publique, afin que toutes les configurations fonctionnent comme avant.  Le projet est toujours en version b√™ta, mais vous pouvez l'essayer vous-m√™me. </p><br><p>  DexGuard est un utilitaire payant des d√©veloppeurs de Proguard.  Il peut √™tre utilis√© ensemble ou √† la place de Proguard.  On pr√©tend que DexGuard peut faire tout ce que Proguard peut faire, mais en mieux.  Malheureusement, je n'ai pas eu l'occasion de l'essayer, si quelqu'un a de l'exp√©rience, merci de la partager. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Redex</a> est un autre optimiseur dex de Facebook.  Il est rapport√© qu'avec cela, vous pouvez atteindre jusqu'√† 25% d'augmentation de la productivit√© et r√©duire la taille de l'application en appliquant l'outil au code d√©j√† trait√© par Proguard. </p><br><h2 id="vmesto-zaklyucheniya">  Au lieu d'une conclusion </h2><br><p>  N'ayez pas peur d'utiliser Proguard, ne soyez pas paresseux et passez du temps √† vous installer.  Cela r√©duira sa taille, augmentera la vitesse de travail, puis ajoutera la fid√©lit√© de vos utilisateurs.  En m√™me temps, essayez de cr√©er des configurations de Proguard efficaces, n'√©crivez pas de r√®gles de "tapis", sinon un Jake Wharton en col√®re viendra vers vous et vous r√©primandera. </p><br><p><img src="https://habrastorage.org/webt/ma/tf/kz/matfkzxceoougdvn7pfyx4klnho.png"></p><br><h2 id="resursy">  Les ressources </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Site Web de Proguard</a> .  Il existe √©galement des informations sur DexGuard. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Divers exemples de r√®gles</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R8</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Enregistrement d'une pr√©sentation du fonctionnement de Proguard avec DroidCon</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ProGuard efficace conserve les r√®gles pour l'enregistrement de pr√©sentation de petites applications (Google I / O '18)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Instructions pour activer et configurer Proguard pour Android</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Page wiki</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Redex</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr415499/">https://habr.com/ru/post/fr415499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr415485/index.html">Drive Kingston A1000 - une ambulance pour l'ordinateur portable?</a></li>
<li><a href="../fr415487/index.html">Pages de l'histoire d'Intel. Premi√®re puce, Intel 3101</a></li>
<li><a href="../fr415489/index.html">Facebook cl√¥ture un projet de distribution d'Internet au moyen de drones sur l'√©nergie solaire</a></li>
<li><a href="../fr415493/index.html">Un nouveau calcul par la formule de Drake a montr√©: l'humanit√© est seule dans sa galaxie avec une probabilit√© de 53‚Äì99,6%</a></li>
<li><a href="../fr415497/index.html">Moteur collecteur + Digispark = 50 $ de v√©lo √©lectrique</a></li>
<li><a href="../fr415503/index.html">Interface utilisateur NetScaler SD-WAN</a></li>
<li><a href="../fr415505/index.html">Fonctionnement de JS: stockage</a></li>
<li><a href="../fr415509/index.html">Deep learning en programmation: quoi, pourquoi et comment</a></li>
<li><a href="../fr415527/index.html">Conf√©rence DUMP 2018: vid√©o de tous les rapports et pr√©sentations</a></li>
<li><a href="../fr415529/index.html">R√©sum√© des √©v√©nements informatiques de juillet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>