<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíµ ü•û üîû Mockito et comment le faire cuire üà¥ üéÖüèæ üë®üèø‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä propos de l'article 


 Voici un autre guide de Mockito. Dans ce document, d'une part, j'ai essay√© de d√©crire les fonctionnalit√©s de cette biblioth√®...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mockito et comment le faire cuire</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444982/"><h2 id="o-state">  √Ä propos de l'article </h2><br><p>  Voici un autre guide de Mockito.  Dans ce document, d'une part, j'ai essay√© de d√©crire les fonctionnalit√©s de cette biblioth√®que afin qu'un lecteur qui ne la connaissait pas a imm√©diatement la possibilit√© de l'utiliser pleinement, et pas seulement une id√©e g√©n√©rale de celle-ci.  D'un autre c√¥t√©, je voulais le rendre suffisamment compact et structur√© pour que je puisse le lire rapidement dans son int√©gralit√© et y trouver rapidement quelque chose une fois lu, mais oubli√©.  En g√©n√©ral, cet article, qui me serait utile moi-m√™me, lorsque je suis tomb√© sur cette biblioth√®que et que je ne comprenais pas vraiment comment cela fonctionne. </p><br><p>  Je suppose que cela peut √™tre utile pour moi maintenant - parfois j'oublie une partie de cela, et il est plus commode de rappeler le mat√©riel non pas selon la documentation officielle ou les articles d'autres personnes, mais selon mon propre, disons, synopsis.  En m√™me temps, j'ai essay√© de construire le texte de mani√®re √† ce qu'il soit pratique principalement pour explorer Mockito √† partir de z√©ro, et √† certains endroits, j'analyse en d√©tail des choses apparemment √©videntes - qui n'√©taient pas toutes √©videntes pour moi d√®s le d√©but. </p><a name="habracut"></a><br><h2 id="soderzhanie">  Contenu: </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mockito: qu'est-ce que c'est et pourquoi est-il n√©cessaire</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Environnement, versions et animal exp√©rimental</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">moquer et espionner</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gestion des comportements</a> <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©finition des conditions d'appel</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©finition des r√©sultats des appels</a> </li></ol></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Suivi des appels de m√©thode</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mock objets en tant que valeurs de champ et annotations Mockito</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comportement de restauration aux sessions par d√©faut et Mockito</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quoi d'autre?</a> </li></ol><br><h2 id="mockito-chto-eto-takoe-i-zachem-nuzhno">  Mockito: qu'est-ce que c'est et pourquoi est-il n√©cessaire </h2><br><p>  En bref, Mockito est un framework stub. </p><br><p>  Comme vous le savez, lors du test de code (principalement des tests unitaires, mais pas seulement), l'√©l√©ment test√© doit souvent fournir des instances de classes qu'il doit utiliser lors de son fonctionnement.  Cependant, ils ne doivent souvent pas √™tre pleinement fonctionnels - au contraire, ils doivent se comporter de mani√®re strictement d√©finie, de sorte que leur comportement soit simple et compl√®tement pr√©visible.  Ils sont appel√©s talons.  Pour les obtenir, vous pouvez cr√©er des impl√©mentations de test alternatives d'interfaces, h√©riter des classes n√©cessaires avec red√©finition des fonctionnalit√©s, etc., mais tout cela est assez g√™nant, redondant et sem√© d'erreurs.  Une solution plus pratique dans tous les sens est des cadres sp√©cialis√©s pour cr√©er des talons.  L'un d'entre eux (et peut-√™tre le plus c√©l√®bre pour Java) est Mockito. </p><br><p> Mockito vous permet de cr√©er avec une seule ligne de code le soi-disant faux (quelque chose comme la base du talon souhait√©) de n'importe quelle classe.  Pour une telle maquette, imm√©diatement apr√®s sa cr√©ation, un certain comportement par d√©faut est caract√©ristique (toutes les m√©thodes renvoient des valeurs pr√©c√©demment connues - g√©n√©ralement c'est <code>null</code> ou <code>0</code> ).  Vous pouvez red√©finir ce comportement comme vous le souhaitez, le contr√¥ler avec le bon degr√© de d√©tail, etc.  En cons√©quence, la maquette devient un talon avec les propri√©t√©s requises.  Ci-dessous, je vais discuter en d√©tail de la fa√ßon de proc√©der. </p><br><p>  Je note que la simulation peut √©galement √™tre cr√©√©e pour ces classes, dont la nouvelle instance ne peut pas simplement cr√©er, en particulier, des classes avec des constructeurs exclusivement priv√©s tels que les classes singleton et utilitaires, et avec une configuration minimale du cadre et des √©num√©rations. </p><br><h2 id="okruzhenie-versii-i-podopytnoe-zhivotnoe">  Environnement, versions et animal exp√©rimental </h2><br><p>  Lors de la r√©daction de cet article, j'ai utilis√©: </p><br><ul><li>  Mockito: 'org.mockito: mockito-core: 2.24.0' (derni√®re version stable au moment de la r√©daction) </li><li>  TestNG: 'org.testng: testng: 6.14.3' comme cadre de test </li><li>  AssertJ: 'org.assertj: assertj-core: 3.11.1' comme outil de validation </li><li>  Lombok: 'org.projectlombok: lombok: 1.18.6' (juste pour plus de commodit√©) </li><li>  Java 8 </li></ul><br><p>  Pour mes exp√©riences inhumaines, j'ai √©crit cette interface d'un service qui donne acc√®s √† certaines donn√©es. </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;String&gt; dataToSave)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String id)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String id, Supplier&lt;String&gt; calculateIfAbsent)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataListByIds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;String&gt; idList)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataByRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DataSearchRequest request)</span></span></span></span>; }</code> </pre> <br><p>  Et ce code (que ce soit pour des raisons d'ordre) de la classe de demande est pass√© √† la derni√®re des m√©thodes d'interface. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataSearchRequest</span></span></span><span class="hljs-class"> </span></span>{ String id; Date updatedBefore; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length; }</code> </pre> <br><p>  Les unit√©s de donn√©es sont identifi√©es par ID et ont quelques caract√©ristiques suppl√©mentaires, mais directement sous la forme dans laquelle elles sont retourn√©es par le service, ce sont des cha√Ænes et non des objets plus complexes.  Je ne manque rien d'important, et les exemples sont plus simples et plus clairs. </p><br><p>  Je vais le noter tout de suite: dans les exemples ci-dessous, j'appelle directement les m√©thodes red√©finies de mes faux objets pour plus de clart√©, mais avec de vrais tests, l'id√©e n'est pas du tout!  Dans ce test, je ferais syst√©matiquement ce qui suit: </p><br><ul><li>  configur√© la maquette de mon service au besoin; </li><li>  pass√© (tr√®s probablement, par le constructeur) √† une instance d'une autre classe l'utilisant (supposons qu'il contient une sorte de logique m√©tier utilisant les donn√©es fournies par le <code>DataService</code> ), que je testerais en fait; </li><li>  activ√© la fonctionnalit√© de la classe test√©e et contr√¥l√© les r√©sultats; </li><li>  si n√©cessaire, je contr√¥lerais le nombre et l'ordre des appels aux m√©thodes de ma maquette, qui auraient d√ª √™tre appel√©es par la classe test√©e √† la suite de l'action pr√©c√©dente. </li></ul><br><h2 id="mock-i-spy">  moquer et espionner </h2><br><p>  La classe centrale de Mockito, √† travers laquelle il est cens√© acc√©der √† la plupart des fonctionnalit√©s, est, en fait, une classe appel√©e <code>Mockito</code> (il y a aussi la classe <code>BDDMockito</code> qui offre √† peu pr√®s les m√™mes possibilit√©s sous une forme plus adapt√©e au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BDD</a> , mais ici je ne m'y attarderai pas) .  L'acc√®s √† la fonctionnalit√© est impl√©ment√© via ses m√©thodes statiques. </p><br><p>  Pour cr√©er une maquette de la classe <code>DataService</code> , je dois juste faire ce qui suit: </p><br><pre> <code class="java hljs">DataService dataServiceMock = Mockito.mock(DataService.class);</code> </pre> <br><p>  Termin√© - J'ai obtenu une instance de la classe dont j'ai besoin.  Il sera accept√© par n'importe quelle m√©thode ou constructeur qui n√©cessite un param√®tre de ce type (par exemple, le constructeur de la classe que je veux tester).  M√™me si un contr√¥le de d√©pendance l'attend plus tard, il le transmettra: non seulement <code>instanceof DataService</code> renverra <code>true</code> , mais aussi <code>dataServiceMock.getClass()</code> - √† savoir <code>DataService.class</code> .  D'une mani√®re formelle, distinguer par programmation un objet simul√© d'un objet ordinaire se r√©v√®le √™tre une t√¢che plut√¥t difficile, ce qui est logique: apr√®s tout, le premier est destin√© √† √™tre indiscernable du second.  Cependant, Mockito a un outil pour cela - la m√©thode <code>Mockito.mockingDetails</code> .  En lui passant un objet arbitraire, j'obtiens un objet de la classe <code>MockingDetails</code> .  Il contient des informations sur ce que cet objet repr√©sente du point de vue de Mockito: qu'il s'agisse de maquette, d'espion (voir ci-dessous), comment il a √©t√© utilis√©, comment il a √©t√© cr√©√©, etc. </p><br><p>  Il convient de noter en particulier la situation lorsque j'essaie de cr√©er un mock pour la classe finale ou une instance fictive d'√©num√©ration ou de remplacer le comportement de la m√©thode finale.  Dans ce cas, avec le comportement par d√©faut de Mockito, le code ci-dessus refuse de fonctionner, citant pr√©cis√©ment cette circonstance.  Cependant, cela peut √™tre chang√© - il suffit de cr√©er dans le projet (avec le p√©riph√©rique standard de l'arborescence du r√©pertoire du projet) le fichier <code>test/resources/mockito-extensions/org.mockito.plugins.MockMaker</code> et entrez la ligne dedans: </p><br><pre> <code class="plaintext hljs">mock-maker-inline</code> </pre> <br><p>  Apr√®s cela, vous pouvez imiter les classes et √©num√©rations finales de la mani√®re habituelle, ainsi que remplacer les m√©thodes finales. </p><br><p>  La maquette que j'ai eue en action est aussi impropre que possible: pas une seule m√©thode n'aura d'effet sur quoi que ce soit, et la valeur retourn√©e sera <code>null</code> pour les types d'objets et <code>0</code> pour les types primitifs.  Remarque: si la m√©thode retourne une collection, la maquette par d√©faut ne renverra pas les <code>null</code> , mais les instances de collection vides.  Par exemple, pour <code>List</code> cela se r√©v√©lera √™tre une <code>LinkedList</code> vide <code>LinkedList</code> ind√©pendamment de ce que la vraie m√©thode aurait d√ª retourner.  Mais comme les valeurs des tableaux, primitifs ou objet, j'obtiens <code>null</code> .  Le comportement par d√©faut (et pas seulement) peut √™tre modifi√© √† l'aide des fonctionnalit√©s de la classe <code>MockSettings</code> , mais cela est rarement n√©cessaire. </p><br><p>  D'une mani√®re ou d'une autre, dans la plupart des cas, je n'aurai pas besoin du comportement par d√©faut, et dans la section suivante, j'analyserai en d√©tail comment d√©finir ce qui est requis √† la place. </p><br><p>  Cependant, que se passe-t-il si je souhaite utiliser un objet de classe r√©el avec les fonctionnalit√©s disponibles en tant que stub, red√©finissant le fonctionnement d'une partie seulement de ses m√©thodes?  Si nous parlons de tests unitaires, un tel besoin indique g√©n√©ralement (mais pas toujours) que le projet ne convient pas √† la conception et, en principe, ce n'est pas recommand√©.  Cependant, il existe des situations o√π cela, pour une raison quelconque, ne peut √™tre √©vit√©.  Pour ce cas, Mockito a le soi-disant espion, "espions".  Contrairement aux maquettes, ils peuvent √™tre cr√©√©s en fonction de la classe et de l'objet fini: </p><br><pre> <code class="java hljs">DataService dataServiceSpy = Mockito.spy(DataService.class); <span class="hljs-comment"><span class="hljs-comment">// or DataService dataService = new DataService(); dataServiceSpy = Mockito.spy(dataService);</span></span></code> </pre> <br><p>  Lors de la cr√©ation d'un espion bas√© sur une classe, si son type est une interface, un objet maquette normal sera cr√©√©, et si le type est une classe, alors Mockito essaiera de cr√©er une instance en utilisant le constructeur par d√©faut (sans param√®tres).  Et seulement s'il n'y a pas un tel constructeur, une erreur se produira et le test ne fonctionnera pas. </p><br><p>  Le comportement des objets espions par d√©faut est identique au comportement d'une instance de classe r√©guli√®re, mais ils me donnent les m√™mes possibilit√©s que les objets fictifs: ils me permettent de red√©finir leur comportement et de surveiller leur utilisation (voir les sections suivantes).  Un point important: spy n'est pas un wrapper autour de l'instance sur laquelle il a √©t√© cr√©√©!  Par cons√©quent, l'appel de la m√©thode spy n'affectera pas l'√©tat de l'instance d'origine. </p><br><h2 id="upravlenie-povedeniem">  Gestion des comportements </h2><br><p>  Donc, sur la fa√ßon de se moquer ou d'espionner pour faire ce dont j'ai besoin.  De plus, j'√©crirai toujours simplement ¬´simulacre¬ª partout - cela signifiera ¬´simulacre ou espion¬ª, sauf indication contraire expresse. </p><br><p>  En g√©n√©ral, le contr√¥le du comportement d'un objet simul√© se r√©sume √† un concept √©vident: quand une maquette a √©t√© trait√©e de cette mani√®re (c'est-√†-dire qu'une m√©thode avec tel ou tel argument a √©t√© appel√©e), elle devrait r√©pondre de telle ou telle mani√®re.  Ce concept a deux impl√©mentations au sein de la classe Mockito - la principale, recommand√©e par les d√©veloppeurs pour une utilisation dans la mesure du possible, et l'autre, utilis√©e lorsque la principale ne convient pas. </p><br><p>  L'impl√©mentation principale est bas√©e sur la m√©thode <code>Mockito.when</code> .  Cette m√©thode prend comme ¬´param√®tre¬ª un appel √† la m√©thode red√©finie de l'objet maquette (de cette fa√ßon l'action d√©tect√©e est fix√©e) et retourne un objet de type <code>OngoingStubbing</code> , qui permet d'appeler l'une des m√©thodes de la famille <code>Mockito.then...</code> (c'est ainsi que la r√©action √† cet effet est d√©finie).  Dans l'ensemble, dans le cas le plus simple, cela ressemble √† ceci: </p><br><pre> <code class="java hljs">List&lt;String&gt; data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); data.add(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>); Mockito.when(dataService.getAllData()).thenReturn(data);</code> </pre> <br><p>  Apr√®s cette op√©ration, en appelant la m√©thode <code>getAllData()</code> sur l'objet <code>getAllData()</code> , j'obtiens l'objet sp√©cifi√© dans la premi√®re ligne de la liste. </p><br><p>  Ici, l'intuition famili√®re "orient√©e objet" peut donner une sorte de dysfonctionnement, donc cela m√©rite d'√™tre approfondi.  Du point de vue de la syntaxe Java, la valeur transmise √† la m√©thode <code>when</code> tant que param√®tre est, bien s√ªr, la valeur renvoy√©e par la m√©thode substitu√©e.  Pour mock, c'est une valeur vide; pour spy, c'est la valeur retourn√©e par la m√©thode de l'objet r√©el.  Mais gr√¢ce √† l'action magique ¬´sous le capot¬ª de Mockito, la m√©thode <code>when</code> ne fonctionnera normalement (et ne plantera pas lorsqu'elle sera lanc√©e avec une erreur) que si l'appel de la m√©thode mock-object est entre crochets apr√®s <code>when</code> . </p><br><p>  Une id√©ologie similaire fonctionne souvent lors de la d√©finition du comportement d'un mockito dans un Mockito: en appelant une m√©thode (d'un objet <code>Mockito</code> ou d'une classe du <code>Mockito</code> ), j'essaie de ne pas obtenir la valeur retourn√©e par celui-ci, mais en quelque sorte d'influencer l'appel possible de la m√©thode de l'objet <code>Mockito</code> je travaille: sp√©cifier ses limites, fixer le r√©sultat, √©tablir l'observation de ses d√©fis, etc.  Cela semble un peu brumeux, je l'avoue, et √† la premi√®re collision, cela semble √©trange, mais, apr√®s l'avoir compris, vous commencez bient√¥t √† ressentir cette approche comme tout √† fait naturelle dans le contexte du travail avec des talons. </p><br><p>  Une autre impl√©mentation de la liaison de la condition et du r√©sultat de l'appel est les m√©thodes de la famille <code>Mockito.do...</code>  Ces m√©thodes vous permettent de d√©finir le comportement en commen√ßant par le r√©sultat de l'appel et de renvoyer un objet de la classe <code>Stubber</code> , avec lequel vous pouvez d√©j√† d√©finir la condition.  La m√™me liaison que ci-dessus effectu√©e de cette mani√®re ressemble √† ceci: </p><br><pre> <code class="java hljs">List&lt;String&gt; data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); data.add(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>); Mockito.doReturn(data).when(dataService).getData()</code> </pre> <br><p>  Quelle est la diff√©rence, pourquoi la liaison via <code>Mockito.when</code> est consid√©r√©e comme pr√©f√©rable et quand vous devez encore utiliser les m√©thodes de <code>Mockito.do...</code> ?  Remarque: dans la premi√®re impl√©mentation, lors de la d√©finition du comportement de la m√©thode (dans ce cas, <code>getAllData()</code> ), l'appel √† la version qui n'a pas encore √©t√© red√©finie est effectu√© en premier, puis seulement, dans les entrailles de Mockito, un remplacement se produit.  Dans le second cas, un tel appel ne se produit pas - la m√©thode <code>Stubber.when</code> pass√©e directement √† la m√©thode <code>Stubber.when</code> , et un objet du m√™me type, mais de nature diff√©rente, est renvoy√© √† partir de la m√©thode renvoy√©e par cette m√©thode.  Cette diff√©rence d√©termine tout.  La liaison via <code>Mockito.do...</code> ne contr√¥le pas au moment de la compilation quelle m√©thode red√©finissable j'appellerai et si elle est compatible avec le type avec la valeur de retour donn√©e.  Par cons√©quent, g√©n√©ralement <code>Mockito.when</code> pr√©f√©rable - il ne peut y avoir aucune erreur avec cela.  Mais il peut y avoir des cas o√π je veux √©viter d'appeler une m√©thode red√©finie - pour une maquette nouvellement cr√©√©e, un tel appel est tout √† fait acceptable, mais si j'ai d√©j√† red√©fini cette m√©thode ou trait√© avec un espion, cela peut √™tre ind√©sirable, et lever une exception ne permettra pas du tout la red√©finition n√©cessaire .  Et ici, la liaison via <code>Mockito.do...</code> vient √† la <code>Mockito.do...</code> </p><br><p>  Une autre situation o√π vous ne pouvez pas vous passer des m√©thodes <code>Mockito.do...</code> est la <code>Mockito.do...</code> la m√©thode renvoyant <code>void</code> : le param√®tre <code>Mockito.when</code> attente ne peut pas fonctionner avec une telle m√©thode.  <code>Mockito.doReturn</code> , bien s√ªr, sans travail, mais il y a <code>Mockito.doThrow</code> , <code>Mockito.doAnswer</code> et rarement assez <code>Mockito.doNothing</code> . </p><br><p>  Ensuite, je consid√©rerai un peu plus en d√©tail comment d√©finir les conditions et les r√©sultats des appels.  Je ne consid√©rerai que la liaison via <code>Mockito.when</code> - une autre m√©thode est presque compl√®tement similaire dans la manipulation. </p><br><h3 id="zadanie-usloviy-vyzova">  D√©finition des conditions d'appel </h3><br><p>  L'exemple ci-dessus concerne une m√©thode sans param√®tres, et la condition d'appel associ√©e est possible une chose - le fait de l'appel.  D√®s que les param√®tres apparaissent, la situation devient plus compliqu√©e.  Au minimum, pour appeler une m√©thode dont je d√©finis le comportement, je dois lui passer quelque chose.  Mais une autre chose est plus importante: il peut s'av√©rer que je ne veux pas toujours obtenir la r√©action donn√©e, mais seulement lorsque je l'appelle avec des param√®tres qui r√©pondent √† certaines exigences.  <code>DataService</code> a cette m√©thode: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataItemById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// some code... }</span></span></code> </pre> <br><p>  Si je dois d√©finir une r√©ponse √† tout appel √† cette m√©thode, quels que soient les arguments, je dois utiliser la m√©thode <code>Mockito.any</code> : </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataItemById(any())) .thenReturn(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>);</code> </pre> <br><p>  Si je veux que mock ne r√©ponde qu'√† une certaine valeur de l'argument, vous pouvez utiliser cette valeur directement ou les m√©thodes de <code>Mockito.eq</code> (si nous parlons d'√©quivalence) ou <code>Mockito.same</code> (si une comparaison de liens est requise): </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataItemById(<span class="hljs-string"><span class="hljs-string">"idValue"</span></span>)) .thenReturn(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// or Mockito.when(dataService.getDataItemById(Mockito.eq("idValue"))) .thenReturn("dataItem");</span></span></code> </pre> <br><p>  Et si je veux que l'argument r√©ponde √† certaines exigences, il existe un certain nombre de m√©thodes statiques sp√©cialis√©es pratiques de la m√™me classe <code>Mockito</code> (par exemple, les cha√Ænes peuvent √™tre v√©rifi√©es pour le contenu au d√©but ou √† la fin d'une certaine s√©quence de caract√®res, la correspondance de mod√®le, etc.).  Il existe √©galement une m√©thode g√©n√©rale Mockito.argThat (et ses analogues pour les types primitifs) qui accepte l'impl√©mentation de l'interface fonctionnelle ArgumentMatcher: </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataById( Mockito.argThat(arg -&gt; arg == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || arg.length() &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>))) .thenReturn(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>);</code> </pre> <br><p>  Les classes <code>ArgumentMatchers</code> et <code>AdditionalMatchers</code> vous permettent de travailler avec certaines impl√©mentations pr√™tes √† l'emploi de cette interface.  Par exemple, <code>AdditionalMatchers.or</code> et <code>AdditionalMatchers.and</code> vous permettent de combiner d'autres matchers (remarque: les m√©thodes statiques de ces classes ne renvoient pas d'instances de matchers, mais y acc√®dent uniquement!) </p><br><p>  Pour la m√™me m√©thode, vous pouvez d√©finir le comportement plusieurs fois avec des exigences diff√©rentes pour les arguments, et tous les mod√®les de comportement d√©finis de cette mani√®re agiront simultan√©ment.  Bien s√ªr, dans certains cas, ils peuvent se croiser - disons, je demanderai de retourner un r√©sultat lorsque la valeur <code>int</code> du param√®tre est inf√©rieure √† 5 et l'autre lorsque la valeur paire est re√ßue.  Dans ce cas, le comportement sp√©cifi√© ult√©rieurement a priorit√©.  Par cons√©quent, lors de la d√©finition de mod√®les de comportement complexes, vous devez commencer par les exigences les plus faibles (dans la limite - <code>any()</code> ) et ensuite passer √† des exigences plus sp√©cifiques. </p><br><p>  Lorsque vous travaillez avec des m√©thodes avec plusieurs arguments, les exigences sp√©cifi√©es sont combin√©es conform√©ment au ET logique, c'est-√†-dire que pour obtenir le r√©sultat sp√©cifi√©, CHAQUE des arguments doit r√©pondre √† l'exigence indiqu√©e.  Je n'ai pas trouv√© de moyen de d√©finir une mani√®re arbitraire de les combiner, bien qu'il existe peut-√™tre. </p><br><p>  De plus, lors de la sp√©cification du comportement d'une telle m√©thode, on ne peut pas combiner les m√©thodes statiques de <code>Mockito</code> et le transfert direct de valeurs.  Utilisez <code>Mockito.eq</code> ou <code>Mockito.same</code> . </p><br><h3 id="zadanie-rezultatov-vyzova">  D√©finition des r√©sultats des appels </h3><br><p>  Apr√®s l'appel de la m√©thode de l'objet factice, l'objet doit r√©pondre √† l'appel.  Les principales cons√©quences possibles sont le retour du r√©sultat et la lev√©e d'une exception, et c'est pr√©cis√©ment sur ces options que la bo√Æte √† outils Mockito est principalement con√ßue. </p><br><p>  Dans le cas le plus simple d√©j√† montr√© ci-dessus, la r√©ponse √† l'appel est de renvoyer une valeur.  Je vais redonner son code: </p><br><pre> <code class="java hljs">List&lt;String&gt; data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); data.add(<span class="hljs-string"><span class="hljs-string">"dataItem"</span></span>); Mockito.when(dataService.getAllData()).thenReturn(data);</code> </pre> <br><p>  Remarque: vous ne pouvez renvoyer qu'un objet; il n'y a pas de m√©thodes distinctes pour les primitives.  Par cons√©quent, si la m√©thode renvoie une valeur primitive, dans une telle situation, un / boxing se produira.  Dans la plupart des cas, cela n'interf√®re pas, mais si le compilateur pense le contraire, vous devrez en quelque sorte √™tre d'accord avec lui ... ou accepter ses avertissements. </p><br><p>  Lancer des exceptions n'est pas plus difficile: </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"invalidId"</span></span>)) .thenThrow(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException());</code> </pre> <br><p>  Il existe un autre moyen: vous pouvez cr√©er un objet d'exception et le lancer directement, ou vous pouvez fournir √† Mockito uniquement une classe d'exception afin qu'il soit cr√©√© automatiquement: </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"invalidId"</span></span>)) .thenThrow(IllegalArgumentException.class);</code> </pre> <br><p>  Dans les deux cas, la syntaxe vous permet d'utiliser et de v√©rifier les exceptions, cependant, Mockito ne vous permettra pas d'ex√©cuter un tel test si le type d'exception ne correspond pas √† la m√©thode que je souhaite forcer √† lever cette exception. </p><br><p>  Lorsque vous utilisez une classe comme param√®tre, les constructeurs (m√™me sans param√®tres), ainsi que l'initialisation directe des champs, sont ignor√©s - l'objet est cr√©√© en les contournant (apr√®s tout, c'est Mockito!), De sorte que tous les champs de l'exception lev√©e seront <code>null</code> .  Par cons√©quent, si le contenu de l'exception vous int√©resse (par exemple, un champ de <code>type</code> qui a une valeur par d√©faut), vous devrez abandonner cette m√©thode et cr√©er des exceptions manuellement. </p><br><p>  Ces options de r√©action conviennent si, en r√©ponse √† un appel avec des conditions donn√©es, vous devez toujours renvoyer une certaine valeur, toujours la m√™me valeur du r√©sultat ou toujours lever la m√™me exception, et dans la plupart des cas, ces capacit√©s sont tout √† fait suffisantes.  Mais que se passe-t-il si davantage de flexibilit√© est requise?  Supposons que ma m√©thode accepte une collection de valeurs et renvoie une autre collection de valeurs associ√©e √† la premi√®re √† une (par exemple, obtenir une collection d'objets de donn√©es par l'ensemble de leurs ID), et que je souhaite utiliser cet objet simul√© √† plusieurs reprises avec diff√©rents ensembles d'entr√©e dans le test donn√©es, obtenant √† chaque fois le r√©sultat correspondant.  Vous pouvez, bien s√ªr, d√©crire s√©par√©ment la r√©action √† chaque ensemble sp√©cifique de param√®tres, mais il existe une solution plus pratique - la m√©thode <code>Mockito.thenAnswer</code> , alias <code>Mockito.then</code> .  Il accepte une impl√©mentation de l'interface fonctionnelle <code>Answer</code> , dont la seule m√©thode est de recevoir un objet de la classe <code>InvocationOnMock</code> .  √Ä partir de ce dernier, je peux demander les param√®tres de l'appel de m√©thode (un par un ou tous √† la fois sous forme de tableau) et agir avec eux, √† ma guise.  Par exemple, vous pouvez obtenir une valeur qui lui correspond pour chacun des √©l√©ments de ma collection, en former une nouvelle collection et la renvoyer (remarque: le r√©sultat souhait√© est simplement renvoy√©, mais pas √©crit dans un champ de l'objet param√®tre, comme vous pouvez vous y attendre): </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataByIds(Mockito.any())) .thenAnswer(invocation -&gt; invocation .&lt;List&lt;String&gt;&gt;getArgument(<span class="hljs-number"><span class="hljs-number">0</span></span>).stream() .map(id -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (id) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"a"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"dataItemA"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"b"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"dataItemB"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }) .collect(Collectors.toList()));</code> </pre> <br><p>  Id√©ologiquement, cela revient √† √©crire un mod√®le de m√©thode r√©elle: obtenir des param√®tres, traiter, retourner un r√©sultat.          -  ,    - ,      ,     ,    mock-    . </p><br><p>     <code>Answer</code> ,     , ‚Äî , <code>AnswersWithDelay</code> , <code>ReturnsElementsOf</code>  . . </p><br><p>  :  <code>InvocationOnMock</code>   ‚Äî       <code>Object[]</code> ,  generic-. </p><br><p>        ‚Äî <code>thenCallRealMethod</code> .    .     mock-,    spy-.   mock   ,      ,  -   <code>null</code> .  spy   <code>thenCallRealMethod</code>     spy  ;    ,     -      . </p><br><p>        <code>thenAnswer</code> :  <code>InvocationOnMock</code>   <code>callRealMethod()</code> ‚Äî   ,   ""    -  . </p><br><p>    <code>OngoingStubbing</code>    <code>OngoingStubbing</code> ,  ,   ,     .            ,   .  <code>thenReturn</code>  <code>thenThrow</code>   ,  varargs.       . </p><br><pre> <code class="java hljs">Mockito.when(dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"a"</span></span>)) .thenReturn(<span class="hljs-string"><span class="hljs-string">"valueA1"</span></span>, <span class="hljs-string"><span class="hljs-string">"valueA2"</span></span>) .thenThrow(IllegalArgumentException.class);</code> </pre> <br><p>         <code>"valueA1</code> ,  ‚Äî <code>"valueA2</code> ( ),   (  )    <code>IllegalArgumentException</code> . </p><br><h2 id="slezhenie-za-vyzovami-metodov">     </h2><br><p>        :          (mock'    ),     .   ,     :   ,          ,       .      <code>verify</code> . </p><br><p>  ,           ,  : </p><br><pre> <code class="java hljs">Mockito.verify(dataService).getDataById(Mockito.any());</code> </pre> <br><p>      ,            <code>getDataById</code> ,  ,           . ,             Mockito,      <code>when</code> ,   ,  ,         mock-. , ,  ,      <code>when</code>  , ‚Äî      mock',       (. ). </p><br><p>           : </p><br><pre> <code class="plaintext hljs">Mockito.verify(dataService, Mockito.times(1)) .getDataById(Mockito.any());</code> </pre> <br><p>           <code>Mockito.times</code> ;       <code>Mockito.never</code> .    <code>Mockito.atLeast</code> (  <code>Mockito.atLeastOnce</code>   1)  <code>Mockito.atMost</code> ,       ,    <code>Mockito.only</code> , ,         mock-  (. .     ). </p><br><p>  ,         <code>Mockito</code> ,     <code>VerificationAfterDelay</code>  <code>VerificationWithTimeout</code> ,    <code>Mockito.after</code>  <code>Mockito.timeout</code> .  Par exemple: </p><br><pre> <code class="plaintext hljs">Mockito.verify(dataService, Mockito.after(1000).times(1)) .getDataById(Mockito.any());</code> </pre> <br><p>    ,    mock   ,      ,              ,       .        .   <code>after</code>  <code>timeout</code>  ,          ,    ,    ‚Äî   ,     .  ,   <code>timeout</code>         ‚Äî       .   <code>VerificationWithTimeout</code>   <code>never</code>  <code>atMost</code> :         . </p><br><p>  ,             <code>Mockito.any()</code> .          ,   ,     ‚Äî    Mockito       ,    ,     . Mock-     ,        ,   , , : </p><br><pre> <code class="java hljs">dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"a"</span></span>); dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"b"</span></span>); Mockito.verify(dataService, Mockito.times(<span class="hljs-number"><span class="hljs-number">2</span></span>)).getDataById(Mockito.any()); Mockito.verify(dataService, Mockito.times(<span class="hljs-number"><span class="hljs-number">1</span></span>)).getDataById(<span class="hljs-string"><span class="hljs-string">"a"</span></span>); Mockito.verify(dataService, Mockito.never()).getDataById(<span class="hljs-string"><span class="hljs-string">"c"</span></span>); dataService.getDataById(<span class="hljs-string"><span class="hljs-string">"c"</span></span>); Mockito.verify(dataService, Mockito.times(<span class="hljs-number"><span class="hljs-number">1</span></span>)).getDataById(<span class="hljs-string"><span class="hljs-string">"c"</span></span>); Mockito.verifyNoMoreInteractions(dataService);</code> </pre> <br><p>      <code>verifyNoMoreInteractions</code> (  <code>verifyZeroInteractions</code> ) ‚Äî    -  (            <code>verify</code> )    mock- ‚Äî    .  :   varargs,     ,     ,         <strong> </strong> ! </p><br><p>       ,   ,      ,     .   ,    <code>InOrder</code> : </p><br><pre> <code class="java hljs">InOrder inOrder = Mockito.inOrder(dataService);</code> </pre> <br><p>     varargs;     ‚Äî    mock-   ,    <code>InOrder</code>                .     <code>verify</code>    ,   <code>Mockito.verify</code> : </p><br><pre> <code class="java hljs">inOrder.verify(dataService, times(<span class="hljs-number"><span class="hljs-number">2</span></span>)).saveData(any()); inOrder.verify(dataService).getData();</code> </pre> <br><p>       ,         <code>saveData</code> , <strong> </strong>  ‚Äî <code>getData</code> .  ,   <code>InOrder</code>    ,      ‚Äî     . </p><br><p>       ,   ,       ‚Äî , .      -      ,    ,      ‚Äî  ,     ,    .     <code>ArgumentCaptor</code>    <code>capture()</code> .  Par exemple: </p><br><pre> <code class="java hljs">DataSearchRequest request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataSearchRequest(<span class="hljs-string"><span class="hljs-string">"idValue"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date(System.currentTimeMillis()), <span class="hljs-number"><span class="hljs-number">50</span></span>); dataService.getDataByRequest(request); ArgumentCaptor&lt;DataSearchRequest&gt; requestCaptor = ArgumentCaptor.forClass(DataSearchRequest.class); Mockito.verify(dataService, times(<span class="hljs-number"><span class="hljs-number">1</span></span>)).getDataByRequest(requestCaptor.capture()); assertThat(requestCaptor.getAllValues()).hasSize(<span class="hljs-number"><span class="hljs-number">1</span></span>); DataSearchRequest capturedArgument = requestCaptor.getValue(); assertThat(capturedArgument.getId()).isNotNull(); assertThat(capturedArgument.getId()).isEqualTo(<span class="hljs-string"><span class="hljs-string">"idValue"</span></span>); assertThat(capturedArgument.getUpdatedBefore()).isAfterYear(<span class="hljs-number"><span class="hljs-number">1970</span></span>); assertThat(capturedArgument.getLength()).isBetween(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>);</code> </pre> <br><p> <code>ArgumentCaptor</code>       ,      <strong> </strong> ,   <code>ArgumentCaptor</code>  . <code>getValue()</code>    , <code>getAllValues()</code> ‚Äî     .   ,         ,   . </p><br><h2 id="mock-obekty-kak-znacheniya-poley-i-annotacii-mockito"> Mock-      Mockito </h2><br><p>      ,     mock-   ,      ‚Äî     <code>@Mock</code>   -       : </p><br><pre> <code class="java hljs">MockitoAnnotations.initMocks(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre> <br><p> (  ,       mock',       ) </p><br><p>  spy   <code>@Spy</code> ‚Äî     <code>@Mock</code> ‚Ä¶   spy   ,      , ?          ,      ‚Äî  spy     . </p><br><p>   <code>@Captor</code>    <code>ArgumentCaptor</code> ‚Äî   , ,    . </p><br><p>   <code>@InjectMocks</code> .       -  Mockito,          .       mock-   ,   .        ,    .  -     ,     <code>null</code> ,   -     .         (      )  dependency injection. </p><br><h2 id="otkat-povedeniya-k-defoltnomu-i-sessii-mockito">       Mockito </h2><br><p>         ,  :   mock (spy, argument captor...),   ,    , .    ,  mock' ‚Äî    ,    . JUnit           ,      ,    TestNG   ‚Äî       . , ,   mock'    ,     ,   ,         . .  ,  ,  ‚Äî  ,          . </p><br><p>   ,             mock-    .  TestNG     <code>@BeforeMethod</code> ( <code>@AfterMethod</code>  ).           mock'   ,        ,           (    JUnit ‚Äî      <code>@Before</code> ). </p><br><p>   ,     , ‚Äî   <code>Mockito.reset</code>  <code>Mockito.clearInvocations</code> .   varargs,      mock'.      ,    .     :     (,              )  ,   /   mock'    , ‚Äî       .     ,    mock'       . .      , ,             . </p><br><p>       (,  ) ‚Äî     <code>MockitoAnnotations.initMocks(this);</code>  .    ""  ,   Mockito. </p><br><p>    ‚Äî     Mockito.    .     mock- ,          ( mock'      ).          ,      <code>MockitoSession</code> ,           .     TestNG: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Mock</span></span> DataService dataService; MockitoSession session; <span class="hljs-meta"><span class="hljs-meta">@BeforeMethod</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ session = Mockito.mockitoSession() .initMocks(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .startMocking(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// some code using the dataService field } @AfterMethod public void afterMethod() { session.finishMocking(); }</span></span></code> </pre> <br><p>  ,        ‚Äî  ,  "" (,     )  ,   . </p><br><h2 id="chto-eschyo">  ? </h2><br><p>      Mockito:  mock  spy-,        .      ,       .  ,  , : </p><br><ul><li>  Mockito   mock-   <code>MockSettings</code> (      ‚Äî ,   mock'    -  ); </li><li>     mock-,   <code>MockingDetails</code> ; </li><li>   <code>BDDMockito</code>   <code>Mockito</code> ; </li><li>     (    JUnit       Mockito,     ). </li></ul><br><p>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  Mockito</a> .           javadoc'  <code>Mockito</code> . </p><br><p> , ,  . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444982/">https://habr.com/ru/post/fr444982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444972/index.html">Architecture GPU Intel Gen11 et carte graphique discr√®te d'Intel</a></li>
<li><a href="../fr444974/index.html">Cryptographie en Java. Classe MessageDigest</a></li>
<li><a href="../fr444976/index.html">Quester - Plate-forme pour cr√©er et terminer des qu√™tes (Beta)</a></li>
<li><a href="../fr444978/index.html">Les autorit√©s de l'UE ont inflig√© une amende de 1,7 milliard de dollars √† Google pour avoir bloqu√© les publicit√©s de ses concurrents</a></li>
<li><a href="../fr444980/index.html">Analyse d'une erreur critique dans l'algorithme de chiffrement KIB SEARCHINFORM</a></li>
<li><a href="../fr444984/index.html">D'o√π viennent les photos pour tester les syst√®mes de reconnaissance faciale?</a></li>
<li><a href="../fr444986/index.html">IETF approuve ACME - Il s'agit de la norme pour travailler avec des certificats SSL</a></li>
<li><a href="../fr444992/index.html">Erreurs int√©gr√©es au syst√®me: leur r√¥le dans les statistiques</a></li>
<li><a href="../fr444994/index.html">√Ä propos des lecteurs et de leur utilisation sur les ordinateurs modernes</a></li>
<li><a href="../fr444996/index.html">Redis Streams en tant que structure de donn√©es propre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>