<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåº üë™ ‚òùüèæ Navigation multiplateforme: pourquoi NavController a vaincu angular / router dans Ionic 4 üî´ üï∑Ô∏è üñ≤Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! Je m'appelle Nikita Zhigamovsky, programmeur chez KitApp, et je veux parler de mon exp√©rience dans la construction de la navigation da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Navigation multiplateforme: pourquoi NavController a vaincu angular / router dans Ionic 4</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473488/"><img src="https://habrastorage.org/webt/mh/yf/fb/mhyffbqhpfmzktzggykl-34trg8.png"><br><br>  Bonjour √† tous!  Je m'appelle Nikita Zhigamovsky, programmeur chez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">KitApp,</a> et je veux parler de mon exp√©rience dans la construction de la navigation dans Ionic 4: le probl√®me que j'ai rencontr√© et sa solution. <br><br>  Je d√©veloppe des solutions multi-plateformes pour les applications mobiles depuis 2018.  J'avais l'habitude de travailler sur Ionic 3√®me version, mais avec le temps, la fonctionnalit√© √©volue, j'ai d√©cid√© de passer √† une version plus r√©cente, et les moments et bugs ennuyeux du mod√®le pr√©c√©dent dans Ionic 4 <i>semblent avoir</i> d√©j√† √©t√© corrig√©s. <br><a name="habracut"></a><br>  Il semblerait que ce qui pourrait mal tourner.  Enfin, nous avons la fonctionnalit√© d'un routage angulaire normal, et non l'ancien NavController avec toutes ses lacunes.  M√™me sur le site officiel d'Ionic, le guide de routage indique que la navigation par programme dans les pages vaut la peine d'utiliser les m√©thodes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">angulaire</a> / routeur.  Mais il y avait quelque chose qui m'a fait revenir √† l'ancien NavController. <br><br><h4>  L'essence du probl√®me </h4><br>  Un bug int√©ressant a √©t√© remarqu√©.  Supposons que vous ayez un menu lat√©ral, vous l'avez cr√©√© en utilisant le volet de partage d'ions.  Vous avez √©galement des pages distinctes dans le menu et vous souhaitez passer de celles-ci √† d'autres pages qui sont dans le menu.  Naviguez √† l'aide de Router.navigateByUrl ('/ menu / ...').  Ensuite, nous appelons la page de menu A, et la page s√©par√©e du menu - B. Mais il y en a un <b>MAIS!</b> <br><br>  Supposons, √† la page A, qu'une certaine logique soit d√©clench√©e dans l'√©v√©nement ngOnInit.  Vous acc√©dez √† la page B √† l'aide du routeur et remarquez que la page de menu est toujours active - elle n'a pas √©t√© supprim√©e.  Par cons√©quent, si vous revenez √† la page A, l'√©v√©nement ngOnInit ne fonctionnera pas, car l'√©v√©nement ngOnDestroy de cette page n'a pas fonctionn√©.  Il semblerait que tout soit logique.  √Ä de tels moments, ils ont g√©n√©ralement recours √† l'une des m√©thodes du cycle de vie, non pas l'angulaire, mais l'ionique - ionViewWillEnter.  Il se d√©clenche lorsque vous acc√©dez √† la page d√®s qu'elle devient active.  Tout semble aller bien, √ßa va parfaitement, mais il y a un certain nombre de conventions. <br><br>  Aucune des options pour une action ad√©quate sur la page A ne fonctionnera lorsque vous y acc√©dez, si cette transition ne provient pas des pages qui sont dans le menu.  Vous ne pourrez pas suivre la transition vers cette page, car, je le r√©p√®te, elle est toujours ouverte et fonctionne silencieusement sous d'autres pages, par exemple, sous la page B. <br><br>  Quelques exemples illustratifs: <br><br>  ionViewWillEnter fonctionnera si vous avez la structure de page suivante: <br><br>  1) Pages s√©par√©es <br><br>  <i>- page1</i> <i><br></i>  <i>- page2</i> <i><br></i>  <i>- page3</i> <br><br>  Dans cet exemple, lorsque je vais sur chaque page, ionViewWillEnter fonctionnera parfaitement.  (page1 =&gt; page2, page2 =&gt; page3, etc.) <br><br>  2) Menu / onglets <br><br>  <i>- menu</i> <i><br></i>  <i>- menuPage1</i> <i><br></i>  <i>- menuPage2</i> <i><br></i>  <i>- menuPage3</i> <br>  Dans cet exemple, tout ira aussi bien: la m√©thode ionViewWillEnter se d√©clenchera chaque fois que vous vous rendrez sur l'une des pages (menuPage1 =&gt; menuPage2, menuPage1 =&gt; menuPage3, etc.). <br><br>  Mais dans l'exemple ci-dessous, tout est plus compliqu√©: <br><br>  <i>- menu</i> <i><br></i>  <i>- menuPage1</i> <i><br></i>  <i>- menuPage2</i> <i><br></i>  <i>- menuPage3</i> <i><br></i>  <i>- loginPage</i> <i><br></i>  <i>- signupPage</i> <br><br>  C'est l√† que les probl√®mes de routage angulaire standard commencent.  Lors de la navigation √† l'int√©rieur des pages de menu (menuPage1 =&gt; menuPage2 =&gt; menuPage3) - la m√©thode ionViewWillEnter fonctionnera comme d'habitude, de la m√™me mani√®re lors de la navigation entre les pages individuelles (loginPage =&gt; signupPage).  Mais d√®s que nous commen√ßons √† nous d√©placer entre des pages distinctes et des pages de menu (loginPage =&gt; menu / menuPage1 ou menu / menuPage3 =&gt; signupPage), ni la m√©thode ngOnInit ni ionViewWillEnter ne fonctionnent.  ngOnInit ne fonctionnera pas car la page n'a pas √©t√© d√©truite, ce qui est logique.  Mais pourquoi ionViewWillEnter n'a-t-il pas fonctionn√©? <br><br>  Sur la base de la documentation, ionViewWillEnter fonctionne √† l'int√©rieur de piles de routage distinctes (le mot-cl√© ¬´individuel¬ª) ou entre des pages individuelles, ou √† l'int√©rieur de menus / onglets.  Mais pas dans la structure mixte des pages individuelles et des menus / onglets.  √âtrange, mais cela est consid√©r√© comme un comportement normal.  Dans le m√™me temps, ce n'est pas exactement le comportement attendu par les utilisateurs, surtout si l'on consid√®re le nom des hooks du cycle de vie :). <br><br><h4>  Alors, comment r√©soudre ce probl√®me? </h4><br>  Ayant visit√© de nombreux forums, mais n'ayant pas vu de solution normale, et ayant vu des hacks de vie douteux qui ne fonctionnent pas toujours, il devient clair que quelque chose d'autre est n√©cessaire.  Quelque chose qui va changer la fonctionnalit√© de transition entre les pages de tout type. <br><br>  Que faire dans ce cas?  Bien s√ªr, jetez le routeur en enfer et oubliez-le, car il y a toujours notre NavController pr√©c√©demment d√©test√© et maintenant si bon. <br><br>  La principale diff√©rence entre la m√©thode NavController.navigateRoot () est qu'apr√®s √™tre pass√© √† une autre page, la pr√©c√©dente est automatiquement d√©truite!  Et lorsque vous y basculez √† nouveau, la m√©thode ngOnInit et ionViewWillEnter fonctionnent toutes les deux!  En fait - c'est la solution parfaite - sans b√©quilles et fonctions auto-√©crites douteuses. <br><br>  Le plus cool est qu'il fonctionne avec n'importe quelle structure de page: m√™me entre normal, m√™me √† l'int√©rieur du menu, m√™me de type mixte, comme dans le dernier exemple. <br><br>  R√©sumez les aspects positifs: <br><br><ol><li>  NavController supprime la page pr√©c√©dente de la pile, respectivement, lorsque vous y revenez - elle est mise √† jour, les m√©thodes ionViewWillEnter et ngOnInit fonctionnent, et vous pouvez appeler √† nouveau la logique et mettre √† jour les informations sur les pages, par exemple. </li><li>  Oubliez les anciennes m√©thodes push (), setRoot () et pop (), ainsi que la navigation dans les √©l√©ments de classe.  Apr√®s tout, c'est ce qui a cr√©√© beaucoup de probl√®mes.  NavCtrl a maintenant mis √† jour les m√©thodes, qui passent le m√™me chemin que dans les m√©thodes du routeur. </li></ol><br>  Il y a une mise en garde, o√π faire sans "MAIS" :) <br><br>  Si nous ajoutons un gestionnaire d'√©v√©nements au bouton mat√©riel ¬´retour¬ª sur l'andro√Øde et dans ce gestionnaire nous essayons d'aller quelque part en utilisant Router ou navController, alors nous obtenons l'erreur suivante dans la console: ¬´Navigation d√©clench√©e en dehors de la zone angulaire¬ª. <br><br>  Oui, la navigation fonctionnera, la page s'ouvrira, mais rien ne fonctionnera dessus - ni l'initialisation des propri√©t√©s, ni les m√©thodes du cycle de vie.  Malheureusement, la navigation en appuyant sur le bouton de retour est d√©clench√©e en dehors de la zone angulaire et, en fait, ouvre uniquement le mod√®le: sans lier les variables au mod√®le, sans fonctions, crochets, m√©thodes de cycle de vie - sans rien. <br><br>  En fait, la solution est tr√®s simple.  Nous for√ßons simplement explicitement la navigation √† l'int√©rieur de la zone angulaire. <br><br>  <u>Un exemple:</u> <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Component, NgZone } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { NavController } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@ionic/angular'</span></span>; @Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'app-root'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'app.component.html'</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private navCtrl: NavController, private ngZone: NgZone){} <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ngZone.run(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.navCtrl.navigateForward(<span class="hljs-string"><span class="hljs-string">'menu'</span></span>)).then();  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ngZone.run(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.router.navigateByUrl(<span class="hljs-string"><span class="hljs-string">'/menu/my-orders'</span></span>)).then(); }</code> </pre> <br>  Et maintenant, tout fonctionne bien! <br><br>  Il existe de nombreux articles int√©ressants sur ngZone, je vous conseille de les lire.  Bonne chance! <br><br><h4>  Un peu sur les m√©thodes de navController: </h4><br><br><ul><li>  this.navCtrl.setDirection ('root') - d√©finit la page racine de la pile, en supprimant toutes les pr√©c√©dentes. </li><li>  this.navCtrl.navigateRoot ('homePage') - similaire √† navCtrl.setDirection ('root') + router.navigateByUrl ('homePage'), mais avec la suppression obligatoire de la page pr√©c√©dente de la pile (c'est ce dont nous avons besoin). </li><li>  this.navCtrl.navigateForward ('examplePage') - similaire √† router.navigateByUrl ('/ examplePage), mais avec une indication explicite o√π aller + peut supprimer la page pr√©c√©dente de la pile. </li><li>  this.navCtrl.back () - similaire √† location.back (), mais avec animation. </li><li>  this.navCtrl.navigateBack ('backPage') - similaire √† navCtrl.setDirection ('back') + router.navigateByUrl ('backPage'). </li></ul><br>  Supposons que nous soyons maintenant sur le menu / page1, <br><br><img src="https://habrastorage.org/webt/va/kf/cr/vakfcrknhruiqpwwqc5rm4wgyp8.png" alt="image"><br><br>  et nous avons une pile de menus s√©par√©e et, apr√®s √™tre pass√© de menu / page1 √† la page de connexion, nous devons supprimer la page menu / page1 afin qu'apr√®s y √™tre revenu, nous aurons une sorte de logique travaillant sur ngOnInit ou ionViewWillEnter.  Si nous utilisons router.navigateByUrl ('login) pour la transition, apr√®s cela, nous serons sur la page de connexion, mais nous aurons √©galement une page de menu, <br><br><img src="https://habrastorage.org/webt/n6/7t/iu/n67tiuqk8b-jif83jwpjtln0fsq.png"><br><br>  en cons√©quence, apr√®s le passage de la connexion au menu / page1, ni ngOnInit ni ionViewWillEnter ne fonctionneront. <br><br>  Si vous utilisez notre navCtrl.navigateRoot (¬´connexion¬ª) pour naviguer, puis apr√®s avoir ouvert la page de connexion, la page pr√©c√©dente est supprim√©e.  Et les m√©thodes ngOnInit et ionViewWillEnter fonctionneront. <br><br><img src="https://habrastorage.org/webt/lb/st/gl/lbstgl0seo_rh1s-dseb1k2uzva.png"><br><br>  C'est la beaut√© de l'utilisation de navController - le <u>comportement attendu est parfaitement coh√©rent avec le courant</u> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr473488/">https://habr.com/ru/post/fr473488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr473470/index.html">GitLab 12.4 avec une am√©lioration de la demande de fusion et des d√©pendances de l'API d'audit</a></li>
<li><a href="../fr473476/index.html">V√©rification de l'encapsuleur OpenCvSharp sur OpenCV avec PVS-Studio</a></li>
<li><a href="../fr473478/index.html">V√©rification de l'encapsuleur OpenCvSharp pour OpenCV avec PVS-Studio</a></li>
<li><a href="../fr473482/index.html">Les succ√®s de la campagne saoudienne, Halloween-PR et un peu sur les campagnes publicitaires de Japan Airlines</a></li>
<li><a href="../fr473484/index.html">Cours C ++ au centre CS, deuxi√®me partie</a></li>
<li><a href="../fr473490/index.html">Pourquoi les meilleurs physiciens adorent la th√©orie des cordes</a></li>
<li><a href="../fr473500/index.html">Application sur TSD et communication avec 1C: Enterprise 8.3 via HTTP-Service. Partie 1 (Choix d'une m√©thode d'√©change. Description de l'API)</a></li>
<li><a href="../fr473502/index.html">Linux a-t-il tu√© Unix commercial?</a></li>
<li><a href="../fr473510/index.html">Nous √©crivons un programme pour une cam√©ra avec reconnaissance faciale</a></li>
<li><a href="../fr473512/index.html">Nouvelles du monde d'OpenStreetMap n ¬∞ 482 (08/10/2019 - 10/10/2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>