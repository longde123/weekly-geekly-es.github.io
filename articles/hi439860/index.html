<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯУЗ ЁЯСОЁЯП╗ ЁЯСв ZFS рдкрд░ Ubuntu 18.04 рд░реВрдЯ ЁЯПЗЁЯП╝ ЁЯСиЁЯП╜ тЭХ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдкрд┐рдЫрд▓реЗ рд╕рд╛рд▓ рдореБрдЭреЗ Ubuntu 18.04 рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджреЗрд╢ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереАред рд╡реИрд╕реЗ, рдЙрдмрдВрдЯреВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдХреБрдЫ рднреА рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ZFS рдкрд░ Ubuntu 18.04 рд░реВрдЯ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439860/"><p>  рдкрд┐рдЫрд▓реЗ рд╕рд╛рд▓ рдореБрдЭреЗ Ubuntu 18.04 рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджреЗрд╢ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереАред  рд╡реИрд╕реЗ, рдЙрдмрдВрдЯреВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдХреБрдЫ рднреА рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдЕрддрд┐ рд╕реВрдХреНрд╖реНрдо рдЕрдВрддрд░ рд╣реИ: рдореИрдВ рдЖрдзрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ ZFS рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ред  рдПрдХ рддрд░рдл, рдЙрдмрдВрдЯреВ рдХрд░реНрдиреЗрд▓ рд╕реНрддрд░ рдкрд░ ZFS рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрднреА рддрдХ рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдирд┐рд░реНрджреЗрд╢ рд╣реИ, рд╣рд╛рдВ: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://github.com/zfsonlinux/zfs/wiki/Ubuntu-18.04-Root-on-ZFS</a> </p><br><p>  рдЗрд╕ рдореИрдиреБрдЕрд▓ рдореЗрдВ рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рдХреНрд░рдо рдЖрдо рддреМрд░ рдкрд░ рд╕рд╣реА рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХреБрдЫ рдмрд┐рдВрджреБрдУрдВ рдореЗрдВ рд╕рдорд╛рдпреЛрдЬрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рд╕реАрдзрд╛ рдЕрдиреБрд╡рд╛рдж рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдореБрдлреНрдд, рдЦрд╛рддреЗ рдореЗрдВ рд╕реБрдзрд╛рд░, рдЬреЗрдбрдПрдлрдПрд╕ рдФрд░ рдЕрдиреНрдп рдЪреАрдЬреЛрдВ рдХреЗ рд╕рд╛рде рдореЗрд░рд╛ рдЕрдиреБрднрд╡ред  рдореИрдВ рдбрд┐рд╕реНрдХ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдореБрджреНрджреЛрдВ рдкрд░ рднреА рд╡рд┐рдЪрд╛рд░ рдирд╣реАрдВ рдХрд░рддрд╛ рдФрд░ рдПрдордмреАрдЖрд░ рдмреВрдЯрд▓реЛрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВред  рдореЗрд░реЗ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдирд┐рд░реНрджреЗрд╢ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИрдВред</a> </p><br><a name="habracut"></a><br><h2><blockquote>  0. рд╕рд░реНрд╡рд░ рдХреА рддреИрдпрд╛рд░реА </blockquote></h2><br><p> рдкрд╣рд▓реА рдЪреАрдЬ рдЬреЛ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдореЗрдВ рдЧрд╛рдпрдм рд╣реИ рдФрд░ рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рдирд╣реАрдВ рдорд╛рдиреА рдЬрд╛рддреА рд╣реИ рдХрд┐ ZFS рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ RAID рд╕рд░рдгрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдмрд╣реБрдд рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдпрд╣ рд░рд╛рдЗрдЯ рдХреИрд╢ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИ, рдЬреЛ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ: ZFS рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдЬрд░реНрдирд▓ рд╣реИ рдФрд░ рд▓рд┐рдЦрдиреЗ рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд░реЗрдбреА-рдореЗрдб рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ RAID рд╕рд░рдгреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, ZFS рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдХреИрд╢, рд╕реНрдкреЗрдпрд░, рдФрд░ рдЕрдзрд┐рдХ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЦреЛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╕рднреА рдбрд┐рд╕реНрдХ рдХреЛ рдПрдЪрдмреАрдП рдореЛрдб рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдЕрдЧрд░ рдРрд╕рд╛ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ, рддреЛ рдкреНрд░рддреНрдпреЗрдХ рдбрд┐рд╕реНрдХ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ RAID рдмрдирд╛рдПрдВ рдФрд░ рд▓рд┐рдЦреЛ рдХреИрд╢ рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВред </p><br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдиреЗрдЯрд╡рд░реНрдХ рдкреЛрд░реНрдЯ рдХреЗ рдПрдХрддреНрд░реАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдЖрдк рдЙрдиреНрд╣реЗрдВ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдЪрд░рдг рдореЗрдВ рдЕрдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рдЗрд╕реЗ рдЬрдЯрд┐рд▓ рди рдХрд░реЗрдВ (рдореИрдВ рдмрдВрдзрди рдХреЗ рдмрд┐рдирд╛ рд╕рднреА рдЖрдЧреЗ рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХрд░реВрдВрдЧрд╛)ред </p><br><h2>  1. рд╕реНрдерд╛рдкрдирд╛ рд╡рд╛рддрд╛рд╡рд░рдг рддреИрдпрд╛рд░ рдХрд░рдирд╛ </h2><br><h3>  1.1ред  LiveCD </h3><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, ZFS рдкрд░ рд░реВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рддреИрдпрд╛рд░ рдЙрдмрдВрдЯреВ рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд▓рд╛рдЗрд╡рд╕реАрдбреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><p>  рдпрд╣рд╛рдБ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ: <a href="">http://releases.ubuntu.com/18.04/ubuntu-18.04.1-desktop-amd64.iso</a> </p><br><blockquote>  рдЙрд╕реА рд╕рдордп, рдореИрдВрдиреЗ рд╕рд╣рдХрд░реНрдорд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рднрд┐рдиреНрди рдбрд┐рд╕реНрдХ рдЫрд╡рд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдХреНрдпреЛрдВрдХрд┐ рдореИрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЧреНрд░рд╛рдлрд┐рдХрд▓ рд╢реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдЗрд╕рд╕реЗ рдХреБрдЫ рднреА рдЕрдЪреНрдЫрд╛ рдирд╣реАрдВ рд╣реБрдЖред </blockquote><br><p>  рд╣рдо LiveCD рд╕реЗ рдмреВрдЯ рдХрд░рддреЗ рд╣реИрдВ, Ubuntu рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ рдЯрд░реНрдорд┐рдирд▓ рдЦреЛрд▓реЗрдВ (Ctrl + Alt + T)ред </p><br><h3>  1.2ред  рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рдЕрджреНрдпрддрди рдФрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ </h3>  ' <br><pre><code class="bash hljs">sudo apt-add-repository universe sudo apt update</code> </pre> <br><blockquote>  рдпрд╣рд╛рдВ рд╣рдо рдкрд╣рд▓реЗ bummer рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдпрджрд┐ рд╕рд░реНрд╡рд░ рдХреА рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдбреАрдПрдЪрд╕реАрдкреА рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рд╣реИрдВред  рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдЪрд▓реЗрдЧрд╛, рддреЛ рдЪрд▓рд┐рдП рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВред </blockquote><br><p>  рд╣рдо рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ рдФрд░ рд╡рд╣ рдЦреЛрдЬрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╣рдо рдЬреБрдбрд╝реЗрдВрдЧреЗ: </p><br><pre> <code class="bash hljs">sudo ip a</code> </pre> <br><p>  рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ: </p><br><pre> <code class="bash hljs">sudo <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"auto {{ NAME }}"</span></span> &gt;&gt; /etc/network/interfaces sudo <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"iface {{ NAME }} inet static"</span></span> &gt;&gt; /etc/network/interfaces sudo <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" address {{ IP }}"</span></span> &gt;&gt; /etc/network/interfaces sudo <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" netmask {{ NETMASK }}"</span></span> &gt;&gt; /etc/network/interfaces sudo <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" gateway {{ GATEWAY }}"</span></span> &gt;&gt; /etc/network/interfaces sudo service networking restart</code> </pre><br><p>  рдФрд░ DNS рд░рд┐рдЬрд╝реЙрд▓реНрд╡рд░: </p><br><pre> <code class="bash hljs">sudo <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'nameserver 8.8.8.8'</span></span> &gt;&gt; /etc/resolv.conf</code> </pre> <br><p>  рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛: </p><br><pre> <code class="bash hljs">sudo apt update</code> </pre> <br><h3>  1.3ред  SSH рд╕рд░реНрд╡рд░ (рд╡реИрдХрд▓реНрдкрд┐рдХ) </h3><br><p>  рд╕реНрдерд╛рдкрдирд╛ рдореЗрдВ рдЖрд╕рд╛рдиреА рдХреЗ рд▓рд┐рдП, рдЖрдк рдУрдкрдирдПрд╕рдПрд╕рдПрдЪ рд╕рд░реНрд╡рд░ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрд╕рдПрд╕рдПрдЪ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдЧреЗ рдХреЗ рд╕рднреА рдСрдкрд░реЗрд╢рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </p><br><p>  Ubuntu рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░реЗрдВ: </p><br><pre> <code class="bash hljs">passwd</code> </pre> <br><blockquote>  рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ!  рдЕрдиреНрдпрдерд╛, ssh рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╡реЗрд╢ sudo рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдмрд┐рдирд╛ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЖрдк рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред </blockquote><br><p>  рдУрдкрдирдПрд╕рдПрд╕рдПрдЪ рд╕реНрдерд╛рдкрд┐рдд рдФрд░ рдЪрд▓рд╛рдПрдВ: </p><br><pre> <code class="bash hljs">sudo apt install openssh-server sudo service ssh start</code> </pre> <br><p>  рдФрд░ рдХрд╛рд░реНрдп рдХреЗрдВрджреНрд░ рдХреЗ рдЯрд░реНрдорд┐рдирд▓ рдореЗрдВ: </p><br><pre> <code class="bash hljs">ssh ubuntu@{{ ip server }}</code> </pre> <br><h3>  1.4ред  рдЬрдбрд╝ рд╣реЛ рдЧрдП </h3><br><pre> <code class="bash hljs">sudo -s</code> </pre> <br><h3>  1.5ред  рдПрдХ LiveCD рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ ZFS рд╕рдорд░реНрдерди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ </h3><br><pre> <code class="bash hljs">apt install --yes debootstrap gdisk zfs-initramfs</code> </pre> <br><h2>  2. рд╣рд╛рд░реНрдб рдбреНрд░рд╛рдЗрд╡ рдХрд╛ рд╡рд┐рднрд╛рдЬрди рдФрд░ рдкреНрд░рд╛рд░реВрдкрдг </h2><br><h3><blockquote>  2.0ред  рдбрд┐рд╕реНрдХ рдПрд░реЗ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ </blockquote></h3><br><p>  рдореБрдЦреНрдп рдирд┐рд░реНрджреЗрд╢ рдореЗрдВ рдбрд┐рд╕реНрдХ рдПрд░реЗ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд┐рдВрджреБ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИред </p><br><p>  рдЖрдорддреМрд░ рдкрд░, рд╕рд░реНрд╡рд░ рдкрд░ рдбрд┐рд╕реНрдХ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╣реИ: </p><br><ul><li>  2 рдбрд┐рд╕реНрдХ; </li><li>  4 рдбрд┐рд╕реНрдХ; </li><li>  рдХрдИ рдбрд┐рд╕реНрдХ; </li></ul><br><p>  рд╣рдо 1 рдбрд┐рд╕реНрдХ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рдПрдХ рд╡рд┐рд╕рдВрдЧрддрд┐ рд╣реИред </p><br><h4>  2.0.1ред  2 рдбрд┐рд╕реНрдХ </h4><br><p>  рдпрд╣рд╛рдВ рд╕рдм рдХреБрдЫ рд╕рд░рд▓ рд╣реИ, рдПрдХ MIRROR рд╕рд░рдгреА (RAID1)ред  рдпрджрд┐ рдПрдХ рдФрд░ рддреАрд╕рд░рд╛ рдбреНрд░рд╛рдЗрд╡ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ рдПрдХ рдЧрд░реНрдо рд╕реНрдкреЗрдпрд░ (рд╕реНрдкреЗрдпрд░) рдореЗрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдПрдХ рдЖрд░рдПрдбрдЬреЗрдб рд╕рд░рдгреА (RAID5) рдЗрдХрдЯреНрдард╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рд╕рд░реНрд╡рд░ рдореЗрдВ 3 рдбрд┐рд╕реНрдХ рдмрд╣реБрдд рджреБрд░реНрд▓рдн рд╣реИрдВред </p><br><h4>  2.0.2ред  4 рдбрд┐рд╕реНрдХ </h4><br><p>  рдпрджрд┐ рд╕рднреА рдбреНрд░рд╛рдЗрд╡ рд╕рдорд╛рди рд╣реИрдВ, рддреЛ рдХреЗрд╡рд▓ рддреАрди рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ (рдЪреМрдерд╛ RAID0 рдЬрд┐рд╕реЗ рдореИрдВ рдореВрд▓ рд░реВрдк рд╕реЗ рдирд╣реАрдВ рдорд╛рдирддрд╛ рд╣реВрдВ): </p><br><ul><li>  MIRROR + MIRROR RAID10 рдХрд╛ рдПрдХ рдПрдирд╛рд▓реЙрдЧ рд╣реИ, рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рд░реВрдк рд╕реЗ RAID01, рдХреНрдпреЛрдВрдХрд┐ ZFS рдореЗрдВ рдпрд╣ рджрд░реНрдкрдг + рджрд░реНрдкрдг рд╣реИред  рдЙрдкрд▓рдмреНрдз рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рдХрд╛ 50%; </li><li>  RAIDZ, RAID5 рдХрд╛ рдПрдХ рдПрдирд╛рд▓реЙрдЧ рд╣реИред  рдЙрдкрд▓рдмреНрдз рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рдХрд╛ 75%; </li><li>  RAIDZ2 RAID6 рдХрд╛ рдПрдХ рдПрдирд╛рд▓реЙрдЧ рд╣реИред  рдЙрдкрд▓рдмреНрдз рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рдХрд╛ 50%; </li></ul><br><p>  рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ, рдореИрдВ MIRROR + MIRROR рд╕рд░рдгреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ, рдЬрдмрдХрд┐ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ RAIDZ рд╕рд░рдгреА рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд▓рд╛рднрджрд╛рдпрдХ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЕрдзрд┐рдХ рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдмрд╛рд░реАрдХрд┐рдпрд╛рдВ рд╣реИрдВ </p><br><p>  рдЧрд▓рддреА рд╕рд╣рд┐рд╖реНрдгреБрддрд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рд╕рд░рдгрд┐рдпреЛрдВ рдХреЛ рдЗрд╕ рдХреНрд░рдо рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рд╕рд░реНрд╡реЛрддреНрддрдо рд╕реЗ рдмреБрд░реЗ рддрдХ): </p><br><ul><li>  RAIDZ2 - рдбреЗрдЯрд╛ рд╣рд╛рдирд┐ рдХреЗ рдмрд┐рдирд╛ рджреЛ рдбрд┐рд╕реНрдХ рдЦреЛ рд╕рдХрддреЗ рд╣реИрдВ; </li><li>  MIRROR + MIRROR - рдбреЗрдЯрд╛ рдбрд┐рд╕реНрдХ рдХреЗ рдмрд┐рдирд╛ рдПрдХ рдбрд┐рд╕реНрдХ рдЦреЛ рд╕рдХрддреА рд╣реИ, рдФрд░ 66% рд╕рдВрднрд╛рд╡рдирд╛ рдХреЗ рд╕рд╛рде рдПрдХ рджреВрд╕рд░реА рдбрд┐рд╕реНрдХ рдбреЗрдЯрд╛ рд╣рд╛рдирд┐ рдХреЗ рдмрд┐рдирд╛ рдЦреЛ рд╕рдХрддреА рд╣реИ; </li><li>  RAIDZ - рдбреЗрдЯрд╛ рд╣рд╛рдирд┐ рдХреЗ рдмрд┐рдирд╛ рдХреЗрд╡рд▓ рдПрдХ рдбрд┐рд╕реНрдХ рдЦреЛ рд╕рдХрддрд╛ рд╣реИ; </li></ul><br><p>  рдЧрддрд┐ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рд╕рд░рдгрд┐рдпреЛрдВ рдХреЛ рдЗрд╕ рдХреНрд░рдо рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><ul><li>  MIRROR + MIRROR - рд▓реЗрдЦрди рдФрд░ рдкрдврд╝рдиреЗ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рджреЛрдиреЛрдВ; </li><li>  RAIDZ - рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдзреАрдореА рд╣реИ, рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЪреЗрдХрд╕рдо рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ; </li><li>  RAIDZ2 - рд▓рд┐рдЦрдиреЗ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдФрд░ рднреА рдзреАрдорд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдЪреЗрдХрд╕рдореЛрдВ рдХреА рдЧрдгрдирд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ; </li></ul><br><p>  рдПрдХ рдбрд┐рд╕реНрдХ рдХреА рдЧрд┐рд░рд╛рд╡рдЯ рдХреЗ рджреМрд░рд╛рди рд╕рд░рдгреА рдХреА рдЧрддрд┐ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ: </p><br><ul><li>  MIRROR + MIRROR - рдЬрдм рдПрдХ рдбреНрд░рд╛рдЗрд╡ рдмрд╛рд╣рд░ рдЧрд┐рд░рддреА рд╣реИ, рддреЛ рдЕрдирд┐рд╡рд╛рд░реНрдп рд░реВрдк рд╕реЗ рдХреЗрд╡рд▓ рдПрдХ рджрд░реНрдкрдг рд╕реЗ рд╕рдорд╛рдирд╛рдВрддрд░ рд░реАрдбрд┐рдВрдЧ рдЦреЛ рдЬрд╛рддреА рд╣реИ, рджреВрд╕рд░рд╛ рджрд░реНрдкрдг рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рдЧрд┐рд░рд╛рд╡рдЯ рдХреЗ рдмрд┐рдирд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ; </li><li>  RAIDZ2 - рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рдЧрд┐рд░рд╛рд╡рдЯ рдЕрдзрд┐рдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдбреЗрдЯрд╛ + рдмреНрд▓реЙрдХ рдЦреЛрдЬ рдХреЗ 1/4 рдХреЗ рд▓рд┐рдП рдЪреЗрдХрд╕рдо рд╕реЗ рдмреНрд▓реЙрдХ рдХреЗ рдПрдХ рдкрд┐рдЫрдбрд╝реЗ рдЖрд╡рдВрдЯрди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </li><li>  RAIDZ - рдЧрд┐рд░рд╛рд╡рдЯ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рдбреЗрдЯрд╛ + рдмреНрд▓реЙрдХ рдЦреЛрдЬ рдХреЗ 1/3 рдХреЗ рд▓рд┐рдП рдЪреЗрдХрд╕рдо рд╕реЗ рдмреНрд▓реЙрдХ рдХреЗ рдкреБрдирд░реНрдЧрдгрдирд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ; </li></ul><br><p>  рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреА рддреБрд▓рдирд╛ рд╡реНрдпрдХреНрддрд┐рдкрд░рдХ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдордзреНрдпрдо рдЬрдореАрди рдХреЗ рд░реВрдк рдореЗрдВ рдореЗрд░реА рдкрд╕рдВрдж рдХреЛ рдкрд░реНрдпрд╛рдкреНрдд рд░реВрдк рд╕реЗ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред </p><br><p>  рдЙрд╕реА рд╕рдордп, рдЖрдкрдХреЛ рдпрд╣ рд╕рдордЭрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ "рдзреАрдорд╛" рдФрд░ "рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдзреАрдорд╛" рд╕рдордп рдкрд░ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рдмрд╕реЗ рдЦрд░рд╛рдм рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдХреЗрд╡рд▓ 10-20% рд╣реИ, рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдбрд┐рд╕реНрдХ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдк рдЧрддрд┐ рдореЗрдВ рдЧрд┐рд░рд╛рд╡рдЯ рдЖрдПрдВрдЧреЗ рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдзреНрдпрд╛рди рдирд╣реАрдВ рд╣реИред  рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдЧрддрд┐ рдХрд╛рд░рдХ рдХреЛ рдХреЗрд╡рд▓ рддрднреА рдорд╛рдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм рдЖрдкрдХреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛред </p><br><h4>  2.0.2ред  рдХрдИ рдбрд┐рд╕реНрдХ </h4><br><p>  рдореБрдЦреНрдп рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЕрдЧрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХрдИ рдбрд┐рд╕реНрдХ рд╣реИрдВ рдФрд░ рд╣рдо рд╣рд░ рдЪреАрдЬ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╕рд░рдгреА рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдмреВрдЯ рд╕реЗрдХреНрдЯрд░ рдХреЗ рд╕рд╛рде рдкреНрд░рддреНрдпреЗрдХ рдбрд┐рд╕реНрдХ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдпрд╛ рд╣рдорд╛рд░реЗ рдХрд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рдереЛрдбрд╝рд╛ рд╕рд╛ рдлрд┐рдВрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдмрд╣реБ-рдбрд┐рд╕реНрдХ рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдХреЗ рд▓рд┐рдП, рдореИрдВ рдЗрд╕ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЛ рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реВрдВ: </p><br><ul><li>  2 рдПрд╕рдПрд╕рдбреА рдбрд┐рд╕реНрдХ - рд╣рдо рдПрдХ рджрд░реНрдкрдг рдмрдирд╛рддреЗ рд╣реИрдВ рдФрд░ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рд╛рде рдореБрдЦреНрдп рдмреВрдЯ рд╕рд░рдгреА рдФрд░ рджреВрд╕рд░реА рдбрд┐рд╕реНрдХ рд╕рд░рдгреА рдХреЗ рд▓рд┐рдП рдЬреЗрдбрдПрдлрдПрд╕ рдХреИрд╢; </li><li>  рдмрд╛рдХреА рдПрд╕рдПрдЯреАрдП рдпрд╛ рдПрд╕рдПрдПрд╕ рдбрд┐рд╕реНрдХ рдХреЗ рд╕рд╛рде рднрд░рд╛ рд╣реБрдЖ рд╣реИ рдФрд░ рдорд╛рд░реНрдХрдЕрдк рдХреЗ рдмрд┐рдирд╛ рд╣рдо рдПрдХ рдЬреЗрдбрдПрдлрдПрд╕ рдбрд┐рд╕реНрдХ рд╕рд░рдгреА рдЗрдХрдЯреНрдард╛ рдХрд░рддреЗ рд╣реИрдВ; </li></ul><br><p>  рдпрджрд┐ рд╣рдо рдПрдХ рд╕рд░реНрд╡рд╡реНрдпрд╛рдкреА рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ 4-рдбрд┐рд╕реНрдХ рд╕рд░реНрд╡рд░ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ; </p><br><p>  рдпрджрд┐ рдбрд┐рд╕реНрдХ рд╕рднреА рд╕рдорд╛рди рд╣реИрдВ, рдФрд░ рдпрд╣ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕рд░рдгреА рдХреЗ рд▓рд┐рдП рджреЛ рдбрд┐рд╕реНрдХ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдорддрд▓рдм рдирд╣реАрдВ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреНрд░рддреНрдпреЗрдХ 8 рдЯреАрдмреА рдХреЗ 6 рдбрд┐рд╕реНрдХ), рддреЛ рдЖрдк рд╕рд░рдгреА рдХреЗ рдкрд╣рд▓реЗ рд╕рдореВрд╣ рдХреЗ рдмреВрдЯ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдбрд┐рд╕реНрдХ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣реА рд╣реИ, рдпрджрд┐ рдЖрдк рдПрдХ рд╕рд░рдгреА рдмрдирд╛рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ рдЬреИрд╕реЗ: MIRROR + MIRROR + MIRROR рдпрд╛ RAIDZ + RAIDZ, рддреЛ рд╣рдо рдХреЗрд╡рд▓ рдкрд╣рд▓реЗ рд╕рдореВрд╣ рдХреЗ рд▓рд┐рдП рдмреВрдЯ рд╕реЗрдХреНрдЯрд░ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, MIRROR рдФрд░ RAIDZ рдХреЗ рд▓рд┐рдП рднреА рдХреЗрд╡рд▓ рдПрдХ рд╣реА рдбреНрд░рд╛рдЗрд╡ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдФрд░ рдмрд╛рдХреА рдХреЛ рдХрдЪреНрдЪреЗ рд░реВрдк рдореЗрдВ рд╕реНрдерд╛рдирд╛рдкрдиреНрди рдХрд░реЗрдВ, ZFS рдЫреЛрдЯреЗ рддрддреНрд╡ рджреНрд╡рд╛рд░рд╛ рд╣реА рд╕рд░рдгреА рдмрдирд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрджрд┐ рдкрд╣рд▓реА рдбреНрд░рд╛рдЗрд╡ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рдЖрдк рдХреЗрд╡рд▓ рдмреВрдЯ рдбрд┐рд╕реНрдХ рдЦреЛ рджреЗрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред рдРрд╕рд╛ рдХрд░рдиреЗ рд▓рд╛рдпрдХред </p><br><p>  рдпрд╣ рд╕рдордЭрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдЬреЗрдбрдПрдлрдПрд╕ - рд╕реНрдЯреНрд░рд╛рдЗрдк рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ RAID0 рдирд╣реАрдВ рд╣реИ, рдФрд░ рдпрд╣ рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдПрдХ рд╣реА рдбрд┐рд╕реНрдХ рдЖрдХрд╛рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореМрд╕рдо рдХреЗ рдмреВрдЯ рд╕реЗрдХреНрдЯрд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдЫреЛрдЯреА рд╕реА рдЬрдЧрд╣ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рд╕реЗ рдмрд╣реБрдд рдХреБрдЫ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдореБрдЦреНрдп рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ BIOS рдореЗрдВ рд╕рд╣реА рдбрд┐рд╕реНрдХ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рдмреВрдЯ рдХрд░рдирд╛ рд╣реИ ред </p><br><h3>  2.1ред  рд╡рд┐рднрд╛рдЬрди рдФрд░ рдбрд┐рд╕реНрдХ рдХреНрд▓реАрдирдЕрдк </h3><br><p>  Mdadm рдкреИрдХреЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдбрд┐рд╕реНрдХ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="bash hljs">apt install --yes mdadm</code> </pre> <br><p>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреМрди рд╕реЗ рдбрд┐рд╕реНрдХ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ: </p><br><pre> <code class="bash hljs">lsblk</code> </pre> <br><p>  рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╕рд╛рдл рдХрд░реЗрдВ: </p><br><pre> <code class="bash hljs">sgdisk --zap-all /dev/{{ disk name }}</code> </pre> <br><h3>  2.2ред  рдбрд┐рд╕реНрдХ рд▓реЗрдЖрдЙрдЯ </h3><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдмреВрдЯ рд╡рд┐рднрд╛рдЬрди: </p><br><pre> <code class="bash hljs">sgdisk -a1 -n1:34:2047 -t1:EF02 /dev/{{ disk name }}</code> </pre> <br><p>  рдореБрдЦреНрдп рднрд╛рдЧред </p><br><blockquote>  рдпрд╣рд╛рдВ рднрд┐рдиреНрдирддрд╛рдПрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ: рдпрджрд┐ рдЖрдкрдХреЛ рдПрд╕рдПрд╕рдбреА рдбрд┐рд╕реНрдХ рдХрд╛ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╡рд┐рднрд╛рдЬрди рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬреЗрдбрдПрдлрдПрд╕ рдХреИрд╢ рдХреЗ рд▓рд┐рдП рдпрд╛ рдПрдпрд░реЛрд╕реНрдкреЗрд╕ рдХреЗ рд▓рд┐рдП, рддреЛ рдЖрдк рд╕реАрдорд┐рдд рдорд╛рддреНрд░рд╛ рдХрд╛ рдореБрдЦреНрдп рд╡рд┐рднрд╛рдЬрди рдмрдирд╛рддреЗ рд╣реИрдВ: </blockquote><br><pre> <code class="bash hljs">sgdisk -n2:0:+100GB -t2:BF01 /dev/{{ disk name }} sgdisk -n3:0:0 -t2:BF01 /dev/{{ disk name }}</code> </pre><br><p>  рдпрджрд┐ рд╣рдо рд╕рднреА рд╕реНрдерд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдмрд╕ рд╢реЗрд╖ рд╕реНрдерд╛рди рдХреЗ рд▓рд┐рдП рдПрдХ рдЦрдВрдб рдмрдирд╛рдПрдВ: </p><br><pre> <code class="bash hljs">sgdisk -n2:0:0 -t2:BF01 /dev/{{ disk name }}</code> </pre> <br><p>  рдпрд╣ рджреЗрдЦрдирд╛ рди рднреВрд▓реЗрдВ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рд╣реБрдЖ: </p><br><pre> <code class="bash hljs">lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT sda 8:0 0 1.8T 0 disk тФЬтФАsda1 8:1 0 1007K 0 part тФФтФАsda2 8:2 0 1.8T 0 part sdb 8:16 0 1.8T 0 disk тФЬтФАsdb1 8:17 0 1007K 0 part тФФтФАsdb2 8:18 0 1.8T 0 part ...</code> </pre><br><h3>  2.3ред  рдПрдХ ZFS рд╕рд░рдгреА рдмрдирд╛рдирд╛ </h3><br><pre> <code class="bash hljs">zpool create \ -o ashift=12 \ -O atime=off \ -O canmount=off \ -O compression=lz4 \ -O checksum=fletcher4 \ -O normalization=formD \ -m legacy \ -R /mnt \ -f \ tank \ mirror \ /dev/{{ disk a part 2}} \ /dev/{{ disk b part 2}}</code> </pre> <br><blockquote>  рдкрд╣рд▓рд╛ рд░реЗрдХ, рдЬрд┐рд╕ рдкрд░ рдореЗрд░реЗ рдПрдХ рдкрд░рд┐рдЪрд┐рдд рдПрдбрдорд┐рди рдиреЗ рддреБрд░рдВрдд рдХрджрдо рд░рдЦрд╛, рд╡рд╣ рдпрд╣ рд╣реИ рдХрд┐ ZFS рдРрд░реЗ рдмрдирд╛рддреЗ рд╕рдордп, рдбрд┐рд╕реНрдХ рдХреЛ рдирд╣реАрдВ рдмрд▓реНрдХрд┐ рдбрд┐рд╕реНрдХ рдкрд░ рдПрдХ рд╡рд┐рднрд╛рдЬрди рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИ, рдпрджрд┐ рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЗрд╕рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реЛред </blockquote><br><p>  рдЕрдЧрд▓рд╛, рдХреНрд░рдо рдореЗрдВ: </p><br><ul><li>  ashift = 12 - 4K рдореЗрдВ рдмреНрд▓реЙрдХ рдЖрдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдореБрдЭреЗ рдЕрднреА рднреА рд╕рдордЭ рдореЗрдВ рдирд╣реАрдВ рдЖрдпрд╛ рд╣реИ рдХрд┐ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЕрдХреНрд╕рд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдмреНрд▓реЙрдХ рдЖрдХрд╛рд░ 512 рдмрд╛рдЗрдЯреНрд╕ рд╣реЛрддрд╛ рд╣реИ рдЬрдм рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд░реВрдк рд╕реЗ рдРрд╕реЗ рдбрд┐рд╕реНрдХ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ; </li><li>  atime = off - рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЕрджреНрдпрддрди рддрд┐рдерд┐ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВ, рдореИрдВ рд╣рдореЗрд╢рд╛ рдЗрд╕реЗ рдмрдВрдж рдХрд░ рджреЗрддрд╛ рд╣реВрдВ рдХреНрдпреЛрдВрдХрд┐ рдореБрдЭреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреА рдХрднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдФрд░ рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ рдХрд░реНрдиреЗрд▓ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ; </li><li>  canmount = off - рд░реВрдЯ рд╡рд┐рднрд╛рдЬрди рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВ; </li><li>  рд╕рдВрдкреАрдбрд╝рди = lz4 - LZ4 рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХреЗ рд╕рд╛рде рдбреЗрдЯрд╛ рд╕рдВрдкреАрдбрд╝рди рд╕рдХреНрд╖рдо рдХрд░реЗрдВред  рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рди рдХреЗрд╡рд▓ рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рдХреЛ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ, рдмрд▓реНрдХрд┐ I / O рд╕рдВрдЪрд╛рд▓рди рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЗрд╕ рд╕рдВрдкреАрдбрд╝рди рдПрдЧреНрд▓реЛрд░рд┐рдЕрдо рдХреЗ рд▓рд┐рдП, рдмреЗрд╣рдж рдХрдо рд╕реАрдкреАрдпреВ рдЙрдкрдпреЛрдЧ; </li><li>  рдЪреЗрдХрд╕рдо = fletcher4 - рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЪреЗрдХрд╕рдо рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо, рдФрд░ рдЗрд╕рд▓рд┐рдП fletcher4 рдмрд╕ рдлрд┐рд░ рд╕реЗ рдЬрд╛рдВрдЪрдиреЗ рд▓рд╛рдпрдХ рд╣реИ; </li><li>  normalization = formD - рдпреВрдЯреАрдПрдл -8 рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЧреИрд░-рдпреВрдЯреАрдПрдл -8 рдлрд╝рд╛рдЗрд▓ рдирд╛рдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИред  рдпрд╣рд╛рдВ рд╣рд░ рдХреЛрдИ рдЦреБрдж рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрдгрдп рд▓реЗрддрд╛ рд╣реИ, рд╣рдорд╛рд░реЗ рдХрд╛рдо рдореЗрдВ рд╣рдо рд╣рдореЗрд╢рд╛ рдХреЗрд╡рд▓ рдпреВрдЯреАрдПрдл -8 рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ; </li><li>  xattr = sa - рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рддреЗрдЬреА рд╕реЗ рдХрд╛рдо рдХрд░рдирд╛ред  рдореИрдВ рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реВрдВ рдХрд┐ рдЬрдм рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЕрдиреНрдп OpenZFS рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд╕рд╛рде рд╕рдВрдЧрддрддрд╛ рдЕрдХреНрд╖рдо рд╣реЛрддреА рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: FreeBSD)ред  рдФрд░ рд╡рд┐рдВрдбреЛрдЬ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрддрддрд╛ рдФрд░ рдЬрд┐рд╕ рддрд░рд╣ рд╕реЗ, рдореБрдЭреЗ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХреЛ рдЕрдВрддрд┐рдо рдЕрдиреБрднрд╛рдЧ рдкрд░ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ; </li><li>  -m рд╡рд┐рд░рд╛рд╕рдд - рдХрд╣реАрдВ рднреА рдорд╛рдЙрдВрдЯ рдмрд┐рдВрджреБ, рдФрд░ рд░реВрдЯ рд╡рд┐рднрд╛рдЬрди рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ; </li><li>  -R / mnt - рдХрд░реНрдиреЗрд▓ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд╕реНрдерд╛рдпреА рд╡рд┐рднрд╛рдЬрди рдмрдврд╝рддреЗ рдЙрдкрд╕рд░реНрдЧ; </li><li>  -рдл - рдмрд▓ рд╕рд░рдгреА рдирд┐рд░реНрдорд╛рдгред  рдпрджрд┐ ZFS рд╕рд░рдгреА рдкрд╣рд▓реЗ рдбрд┐рд╕реНрдХ рдкрд░ рдПрдХрддреНрд░ рдХреА рдЧрдИ рдереА, рддреЛ рдмрдирд╛рдПрдБ рдХрдорд╛рдВрдб рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, рдЖрдк рдХрднреА рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ, рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдиреЗ рдЧрд▓рддреА рдХреА рд╣реЛ рдФрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдбреЗрдЯрд╛ рдХреЛ рдорд┐рдЯрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реЛрдВ; </li></ul><br><blockquote><p>  рдореИрдВ рдореВрд▓ рд░реВрдк рд╕реЗ рдЯреИрдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рд░реВрдЯ рд╕рд┐рд╕реНрдЯрдо рдбрд┐рд╕реНрдХ рд╕рд░рдгреА рдХреЗ рдирд╛рдо рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реВрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рд╡реЗ рд▓рд┐рдирдХреНрд╕ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд░реИрдВрдк (рд░реВрдЯ рдкреВрд▓) рдирд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдкрд╕рдВрдж рдХрд░рддреЗ рд╣реИрдВред  рдЕрдкрдиреЗ рдЕрднреНрдпрд╛рд╕ рдореЗрдВ, рдореИрдВ рдЖрдорддреМрд░ рдкрд░ рд╕рд░рдгрд┐рдпреЛрдВ рдХреЗ рдЗрд╕ рдирд╛рдордХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ: </p><br><ul><li>  рдЯреИрдВрдХ - рдореБрдЦреНрдп рдкреНрд░рдгрд╛рд▓реА рд╕рд░рдгреА; </li><li>  рд╕реНрдЯреЛрд░ - рдбреЗрдЯрд╛ рднрдВрдбрд╛рд░рдг рдХреЗ рд▓рд┐рдП рдмрдбрд╝реЗ рдбрд┐рд╕реНрдХ рдХреЗ рд╕рд╛рде рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рд░рдгреА; </li><li>  рдХреИрд╢ - рдПрд╕рдПрд╕рдбреА рдбрд┐рд╕реНрдХ рдХрд╛ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рд░рдгреА, рдЕрдЧрд░ рдореБрдЦреНрдп рд╡рд┐рднрд╛рдЬрди рдЙрди рдкрд░ рдирд╣реАрдВ рд╣реИ; </li></ul><br><p>  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдореИрдВ рддреБрд░рдВрдд рдХреБрдЫ рдРрд╕рд╛ рдирд╛рдо рд░рдЦрдиреЗ рдХреА рдкреНрд░рдерд╛ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдВ рдЬреЛ рднреНрд░рдорд┐рдд рди рд╣реЛред </p></blockquote><br><h2>  3. рд╕рд┐рд╕реНрдЯрдо рдЗрдВрд╕реНрдЯрд╛рд▓реЗрд╢рди </h2><br><h3>  3.1ред  рдФрд░ 3.2ред  рд░реВрдЯ рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдмрдирд╛рдирд╛ </h3><br><blockquote>  рдореИрдВрдиреЗ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕рдВрдпреБрдХреНрдд рдкреИрд░рд╛рдЧреНрд░рд╛рдл 3.1ред  рдФрд░ 3.2ред  рдЪреВрдВрдХрд┐ рдореЗрд░рд╛ рдорд╛рдирдирд╛ тАЛтАЛрд╣реИ рдХрд┐ рддреАрд╕рд░реЗ рд╕реНрддрд░ рдкрд░ рд░реВрдЯ рд╡рд┐рднрд╛рдЬрди рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рдмрд┐рд▓реНрдХреБрд▓ рдмреЗрдорд╛рдиреА рд╣реИред  рдпрд╣ рд╕рдЪ рд╣реИ, ZFS рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдХрдИ рд╡рд░реНрд╖реЛрдВ рдХреЗ рд▓рд┐рдП, рдореБрдЭреЗ рд░реВрдЯ рд╡рд┐рднрд╛рдЬрди рдХреЗ рд╕рд╛рде рдХреЛрдИ рд╣реЗрд░рдлреЗрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рдереАред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдРрд╕реЗ рдЪрд┐рддреНрд░ рд╣реИрдВ рдЬрд┐рдирдХреЗ рд╕рд╛рде рдЖрдк рдирд┐рдпрдВрддреНрд░рдг рдмрд┐рдВрджреБ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рдореЗрд░рд╛ рд░реВрдЯ рд╕реЗрдХреНрд╢рди рдЯреИрдВрдХ / рд░реВрдЯ рд╣реИ: </blockquote><br><pre> <code class="bash hljs">zfs create -o mountpoint=/ tank/root</code> </pre> <br><blockquote>  рдЙрд╕реА рд╕рдордп, рдкрд╣рд▓реА рдШрд╛рддрдХ рддреНрд░реБрдЯрд┐ рдореВрд▓ рдирд┐рд░реНрджреЗрд╢ рдореЗрдВ рдкрд╛рдИ рдЬрд╛рддреА рд╣реИ, рдЕрд░реНрдерд╛рддреН рдбрд┐рд╕реНрдХ рд╕рд░рдгреА рдХреЗ рд▓рд┐рдП рдмреВрдЯ рд╡рд┐рднрд╛рдЬрди рдХреА рдХрдореА: </blockquote><br><pre> <code class="bash hljs">zpool <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> bootfs=tank/root tank</code> </pre> <br><h3>  3.3ред  рдЕрддрд┐рд░рд┐рдХреНрдд рд╡рд┐рднрд╛рдЬрди рдмрдирд╛рдПрдБ </h3><br><blockquote><p>  рдмреБрдирд┐рдпрд╛рджреА рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рдЗрд╕ рднрд╛рдЧ рдореЗрдВ рдЖрдк рд╕рдм рдХреБрдЫ рдлреЗрдВрдХ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рднреВрд▓ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЛрдЧ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЗрд╕реЗ рдХреБрдЪрд▓рдиреЗ рдФрд░ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд╕рд╛рде рдкреВрд░рд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕ рд╡рдЬрд╣ рд╕реЗ, рд░рд╛рд╕реНрддреЗ рдореЗрдВ, рдореБрдЭреЗ рдХреБрдЫ рдареАрдХ рдХрд░рдирд╛ рдкрдбрд╝рд╛ред  рд╕рдЪ рд╣реИ, рдЗрд╕рд╕реЗ рдмрд╣реБрдд рдорджрдж рдирд╣реАрдВ рдорд┐рд▓реАред  рдЪреВрдВрдХрд┐ рдмрд╛рдж рдореЗрдВ рд╕рдорд╕реНрдпрд╛рдПрдВ рдлрд┐рд░ рд╕реЗ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИрдВ рдФрд░ рдЕрдВрдд рдореЗрдВ рдпрд╣ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕рдм рдПрдХ рд╣реА рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП, рдкреИрд░рд╛ 4.11 рдореЗрдВред  рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ рд╕рд╣реА рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><p>  / Var / рдЧреЗрдореНрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╕реЗрдХреНрд╢рди рдЕрд▓рдЧ рдХрд░рдирд╛ рдХрд╛рдлреА рдорд╣рд╛рдХрд╛рд╡реНрдп рд▓рдЧрддрд╛ рд╣реИред  рдореБрдЭреЗ рдХреЛрдИ рдЖрдкрддреНрддрд┐ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реИред </p><br><p>  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рд╡рд┐рднрд╛рдЬрди рдХреЗрд╡рд▓ ZFS рдореЗрдВ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдкрджрд╛рдиреБрдХреНрд░рдо рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВ рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреНрд▓рд╛рд╕рд┐рдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг: рдореИрдВ рдПрдХ рдмрд╛рд░ рдПрдХ рд╕рд░реНрд╡рд░ рд╕рдореВрд╣ рдкрд░ 4K ZFS рд╡рд┐рднрд╛рдЬрди рд╕реЗ рдЕрдзрд┐рдХ рдерд╛, рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рдерд╛, рд▓реЗрдХрд┐рди рдЗрди рд╡рд┐рднрд╛рдЬрдиреЛрдВ рдХреЗ рдмрдврд╝рдиреЗ рдХреЗ рдХрд╛рд░рдг рд╕рд░реНрд╡рд░ рд░рд┐рдмреВрдЯ рдХрдИ рдорд┐рдирдЯ рдХреЗ рд▓рд┐рдП рдзреАрдорд╛ рд╣реЛ рдЧрдпрд╛ред </p></blockquote><br><p>  рдПрдХ рд╕рд╛рдл рд╕реНрд▓реЗрдЯ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рд╕реНрдерд┐рд░ рдФрд░ рдЧрддрд┐рд╢реАрд▓ рдлрд╝рд╛рдЗрд▓ рд╡рд┐рднрд╛рдЬрди рд╣реИрдВред </p><br><p>  рд╕реНрдЯреЗрдЯрд┐рдХ рдлрд╛рдЗрд▓ рд╕реЗрдХреНрд╢рди рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдФрд░ рдЙрдирдХреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╡рд╛рд▓реЗ рд╕реЗрдХреНрд╢рди рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рд╡реЗ рдПрдХ рдмрд╛рд░ рднрд░реЗ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдСрдкрд░реЗрд╢рди рдХреЗ рджреМрд░рд╛рди рдирд╣реАрдВ рдмрджрд▓рддреЗ рд╣реИрдВред  рдЙрд╕реА рд╕рдордп, рдкрд╣рд▓реЗ рд╕реНрдереИрддрд┐рдХ рд╡рд┐рднрд╛рдЬрди рдХреЛ рд╕рд┐рд╕реНрдЯрдо рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд┐рднрд╛рдЬрди (/ usr) рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдлрд┐рд▓рд╣рд╛рд▓ рд╡реЗ рд▓рд┐рдирдХреНрд╕ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдорд┐рд╢реНрд░рд┐рдд рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рдЕрд░реНрде рдирд╣реАрдВ рд╣реИ, рдФрд░ рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдбрд╛рдпрдирд╛рдорд┐рдХ рдлрд╝рд╛рдЗрд▓ рдЕрдиреБрднрд╛рдЧреЛрдВ рдореЗрдВ рд╡реЗ рдЕрдиреБрднрд╛рдЧ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВ: </p><br><ul><li>  рдЕрд╕реНрдерд╛рдпреА рдбреЗрдЯрд╛ - eqред: рдЯреИрдореНрдк, рд╕реНрд╡реИрдк; </li><li>  рдХрд╛рд░реНрдп рд▓реЙрдЧ - eqред: Var / log; </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ - eq: рдШрд░; </li><li>  рдбреЗрдЯрд╛ - eqред: var / db рдФрд░ рдХрд┐рддрдирд╛ рднрд╛рдЧреНрдпрд╢рд╛рд▓реА; </li><li>  рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдиреНрдп рдХрд╛рд░реНрдпрдХреНрд░рдо рдкрд░рд┐рдгрд╛рдо; </li></ul><br><p>  рд▓рд┐рдирдХреНрд╕ рдкрд░рд┐рд╡рд╛рд░реЛрдВ рдореЗрдВ, рдЧрддрд┐рд╢реАрд▓ рд╡рд┐рднрд╛рдЬрди рдореЗрдВ / tmp рдФрд░ / var рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдЯреАрдХ рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ / var / lib, рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдФрд░ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рд╕рдм рдХреБрдЫ рдорд┐рд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА ... </p><br><p>  рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдпрд╣ рддрдп рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдбрд┐рд╕реНрдХ рдкрд░ рдпрд╛ tmpfs рдХреЗ рд░реВрдк рдореЗрдВ / tmp рд╡рд┐рднрд╛рдЬрди рдмрдирд╛рдирд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред  рдпрджрд┐ рд╣рдо рдбрд┐рд╕реНрдХ рдкрд░ рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╡рд┐рднрд╛рдЬрди рдмрдирд╛рдПрдБ: </p><br><pre> <code class="bash hljs">zfs create -o mountpoint=legacy tank/tmp</code> </pre> <br><blockquote>  рд╡рд┐рдХрд▓реНрдк com.sun: рдСрдЯреЛ-рд╕реНрдиреИрдкрд╢реЙрдЯ = рдЭреВрдард╛ рд╕реЗрдЯреНрдпреБрдЗрдб = рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ, рдХреЛрдИ рдлрд░реНрдХ рдирд╣реАрдВ рдкрдбрд╝рддрд╛ рдХрд┐ рдореМрд╕рдо рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрдЯрд┐рд▓ рди рдХрд░реЗрдВред  рд▓реЗрдХрд┐рди SWAP рдХреЗ рд╕рд╛рде рд╣рдо рдмрд╛рдж рдореЗрдВ рдЪрд░рдг 7 рдореЗрдВ рдХрд░реЗрдВрдЧреЗред </blockquote><br><p>  рднрд┐рдиреНрди рдЕрдиреБрднрд╛рдЧ рдХреЛ рдЕрд▓рдЧ рд╕реЗ рдЕрд▓рдЧ рдХрд░реЗрдВ: </p><br><pre> <code class="bash hljs">zfs create -o mountpoint=legacy tank/var</code> </pre> <br><p>  рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрднрд╛рдЧ: </p><br><pre> <code class="bash hljs">zfs create -o mountpoint=/home tank/home zfs create -o mountpoint=legacy tank/home/root</code> </pre> <br><blockquote>  рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд┐рднрд╛рдЬрди рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ рд╡реЗ рд╕рдордп-рд╕рдордп рдкрд░ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ рд╕реЗ рднрд░реЗ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдЙрдирдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдирд╛ рдЖрд╕рд╛рди рдмрдирд╛рддреЗ рд╣реИрдВ, рдЙрдирдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ рд╡рд┐рднрд╛рдЬрди рдмрдирд╛рдирд╛ рдмреЗрд╣рддрд░ рд╣реЛрддрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдШрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ (рд╡рд┐рд╢реЗрд╖рдХрд░ рдЬреЛ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рдирд╛ рдкрд╕рдВрдж рдХрд░рддреЗ рд╣реИрдВ)ред  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдкрд░ рдХреЛрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рди рдХреЗрд╡рд▓ рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рдХреЛ рд░реЛрдХрдирд╛ рдорджрдж рдХрд░рддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рд╣рд╕реНрддрдХреНрд╖реЗрдк рднреА рдХрд░рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдРрд╕реЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ рдХреЛ рдХрд╣реАрдВ рднреА рдЫреЛрдбрд╝рдирд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдмрд╛рдж рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рдвреВрдВрдврдирд╛ рдХрд╛рдлреА рдореБрд╢реНрдХрд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдпрд╣ рдЗрд▓рд╛рдЬ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рд╣рд╛рдереЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдФрд░ рд╣рд░рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </blockquote><br><p>  рдорд╛рдЙрдВрдЯ рдкреЙрдЗрдВрдЯ рдЯреИрдВрдХ / рд╣реЛрдо / рд░реВрдЯ рдХреЛ рд╡рд┐рд░рд╛рд╕рдд рдХреЗ рд░реВрдк рдореЗрдВ рд╕реВрдЪреАрдмрджреНрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рди рдХрд┐ рд░реВрдЯ / рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВред  рдпрд╣ рд╕рд╣реА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рдЦрдВрдб рдХреЗ рдмрдврд╝рддреЗ рд╣реБрдП рдЦрдВрдб 4.11 рдореЗрдВ рдХрд┐рдП рдЧрдП рд╣реИрдВ </p><br><p>  рдЕрдм рд╣рдореЗрдВ / mnt рдореЗрдВ рдЕрдкрдиреЗ рдЧрддрд┐рд╢реАрд▓ рд╡рд┐рднрд╛рдЬрди рдХреЛ рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /mnt/ mkdir var tmp root mount -t zfs tank/var /mnt/var/ mount -t zfs tank/tmp /mnt/tmp/ mount -t zfs tank/home/root /mnt/root/</code> </pre> <br><h3>  рей.рек рдХрд░реНрдиреЗрд▓ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ </h3><br><blockquote>  рдореБрдЦреНрдп рдирд┐рд░реНрджреЗрд╢ рдореЗрдВ рдХреБрдЫ рдФрд░ рдЕрдирд╛рд╡рд╢реНрдпрдХ рдЖрджреЗрд╢ рд╣реИрдВ, рд╣рдо рдзреНрдпрд╛рди рдирд╣реАрдВ рджреЗрддреЗ рд╣реИрдВ, рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкреНрд░рдпреЛрдЧреЛрдВ рдХреА рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ: </blockquote><br><pre> <code class="bash hljs">debootstrap bionic /mnt</code> </pre> <br><p>  рдирддреАрдЬрддрди, рдЖрдкрдХреЛ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдорд┐рд▓рдирд╛ рдЪрд╛рд╣рд┐рдП: </p><br><pre> <code class="bash hljs">zfs list NAME USED AVAIL REFER MOUNTPOINT tank 213M 1.76T 96K legacy tank/home 208K 1.76T 96K /mnt/home tank/home/root 112K 1.76T 112K legacy tank/root 147M 1.76T 147M /mnt tank/tmp 96K 1.76T 96K legacy tank/var 64.6M 1.76T 64.6M legacy</code> </pre><br><p>  рдЦрд╛рд▓реА 96K рд╡рд┐рднрд╛рдЬрди рдХрд╛ рдЖрдХрд╛рд░, рдХреНрд░рдорд╢рдГ, рдХреЗрд╡рд▓ рдЯреИрдВрдХ / tmp рдЦрд╛рд▓реА рд░рд╣рд╛, рдФрд░ рд╢реЗрд╖ рдХрд░реНрдиреЗрд▓ рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рджреМрд░рд╛рди рджрд░реНрдЬ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╡рд┐рднрд╛рдЬрди рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдорд╛рдЙрдВрдЯ рдХрд┐рдП рдЧрдП рдереЗред </p><br><h2>  4. рд╕рд┐рд╕реНрдЯрдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди </h2><br><h3>  4.1ред  рд╣реЛрд╕реНрдЯ рдФрд░ рд╣реЛрд╕реНрдЯрдирд╛рдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ </h3><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> HOSTNAME &gt; /mnt/etc/hostname <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> тАЬ127.0.0.1 localhostтАЭ &gt; /mnt/etc/hosts <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> тАЬ127.0.0.1 HOSTNAMEтАЭ &gt;&gt; /mnt/etc/hosts</code> </pre> <br><h3>  4.2ред  рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ </h3><br><blockquote>  рддреЛ рд╣рд╛рдБ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдиреЗрдЯрдкреНрд▓рд╛рди рд╣реИ: </blockquote><br><pre> <code class="bash hljs">nano /mnt/etc/netplan/setup.yaml network: version: 2 renderer: networkd ethernets: eno2: dhcp4: no dhcp6: no addresses: [ {{ IP }}/{{ netmask }}, ] gateway4: {{ gateway IP }} nameservers: addresses: [8.8.8.8]</code> </pre> <br><h3>  4.3ред  рдЙрдкрдпреБрдХреНрдд рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ </h3><br><pre> <code class="bash hljs">nano /mnt/etc/apt/sources.list deb http://archive.ubuntu.com/ubuntu/ bionic main restricted universe deb http://security.ubuntu.com/ubuntu/ bionic-security main restricted universe deb http://archive.ubuntu.com/ubuntu/ bionic-updates main restricted universe</code> </pre> <br><blockquote>  src - рдЬреНрдпрд╛рджрд╛рддрд░ рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ </blockquote><br><h3>  4.4ред  рд╣рдо рд╡рд░реНрдЪреБрдЕрд▓ рдлрд╝рд╛рдЗрд▓ рдЕрдиреБрднрд╛рдЧ LiveCD рдФрд░ "go" рдХреЛ рдирдИ рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ рдорд╛рдЙрдВрдЯ рдХрд░рддреЗ рд╣реИрдВ </h3><br><pre> <code class="bash hljs">mount --rbind /dev /mnt/dev mount --rbind /proc /mnt/proc mount --rbind /sys /mnt/sys chroot /mnt /bin/bash --login</code> </pre><br><blockquote>  рдпрд╣ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ - rbind, рд▓реЗрдХрд┐рди рдирд╣реАрдВ - рдмрд╛рдЗрдВрдб </blockquote><br><p>  рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдирдИ рд╡реНрдпрд╡рд╕реНрдерд╛ рдореЗрдВ рд╣реИрдВ ... </p><br><h3>  4.5ред  рдЖрдзрд╛рд░ рд╡рд╛рддрд╛рд╡рд░рдг рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ </h3><br><pre> <code class="bash hljs">ln -s /proc/self/mounts /etc/mtab chmod 1777 /tmp apt update</code> </pre> <br><p>  рд╕реНрдерд╛рди рдФрд░ рд╕рдордп: </p><br><pre> <code class="bash hljs">dpkg-reconfigure locales * en_US.UTF-8 * ru_RU.UTF-8 dpkg-reconfigure tzdata</code> </pre> <br><p>  рдФрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдВрдкрд╛рджрдХ рдЬреЛ рдкрд╕рдВрдж рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="bash hljs">apt install --yes vim nano</code> </pre> <br><h3>  4.6ред  ZFS рд╕рдорд░реНрдерди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ </h3><br><pre> <code class="bash hljs">apt install --yes --no-install-recommends linux-image-generic apt install --yes zfs-initramfs</code> </pre> <br><h3>  4.8ред  рдмреВрдЯрд▓реЛрдбрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ </h3><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдХрд╣рд╛ рдЧрдпрд╛ рдерд╛, рдореИрдВ рдПрдХ рдкреБрд░рд╛рдиреЗ рдПрдордмреАрдЖрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реВрдВ: </p><br><pre> <code class="bash hljs">apt install --yes grub-pc</code> </pre> <br><blockquote>  рдмреВрдЯрд▓реЛрдбрд░ рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рджреМрд░рд╛рди, рд╣рдорд╛рд░реЗ рд╕рднреА рдбрд┐рд╕реНрдХ рдХрд╛ рдЪрдпрди рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдмреВрдЯ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╣рдЪрд╛рдирд╛ рд╣реИ, рдЬрдмрдХрд┐ рдЗрдВрд╕реНрдЯреЙрд▓рд░ рдкрд╣рд▓реЗ рд╡рд╛рд▓реЗ рдХреЛ рдЫреЛрдбрд╝рдХрд░ рдЕрдиреНрдп рд╕рднреА рдбрд┐рд╕реНрдХ рдкрд░ рд╢рдкрде рд▓реЗрддрд╛ рд╣реИ, рд╣рдо рд╕рд╣рдордд рд╣реИрдВ рдФрд░ рдЪрд░рдг 5 рдХрд░рддреЗ рд╣реИрдВ (рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдмрд╛рдХреА рдХреЛ рдмрд╛рдж рдореЗрдВ рдХреНрдпреЛрдВ рдЫреЛрдбрд╝рд╛ рдЧрдпрд╛): </blockquote><br><h4>  4.8.1ред  (рел.рез) рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдХрд┐ рд░реВрдЯ рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╣реИ: </h4><br><pre> <code class="bash hljs">grub-probe / zfs</code> </pre> <br><h4>  4.8.2ред  (5.2) рдЕрджреНрдпрддрди initrd </h4><br><pre> <code class="bash hljs">update-initramfs -u -k al</code> </pre> <br><h4>  4.8.3ред  (5.3) GRUB рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдПрдВ </h4><br><pre> <code class="bash hljs">vi /etc/default/grub ... GRUB_CMDLINE_LINUX_DEFAULT=<span class="hljs-string"><span class="hljs-string">""</span></span> GRUB_CMDLINE_LINUX=<span class="hljs-string"><span class="hljs-string">"console"</span></span> ...</code> </pre><br><h4>  4.8.4ред  (5.4ред) рдмреВрдЯрд▓реЛрдбрд░ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЛ рдЕрджреНрдпрддрди рдХрд░рдирд╛ </h4><br><pre> <code class="bash hljs">update-grub</code> </pre> <br><h4>  4.8.5ред  (рел.рел) рдкреНрд░рддреНрдпреЗрдХ рдбрд┐рд╕реНрдХ рдкрд░ рдмреВрдЯ рд▓реЛрдбрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ рдЬрд┐рд╕реЗ рдмреВрдЯ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ </h4><br><pre> <code class="bash hljs">grub-install /dev/sda grub-install /dev/sdb ...</code> </pre><br><blockquote>  рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдпреЗ рдХрдорд╛рдВрдб рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░реЗрдВред  рдИрдорд╛рдирджрд╛рд░ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП, рдореБрдЭреЗ рдХрдо рд╕реЗ рдХрдо рдПрдХ рдмрд╛рд░ рд╡рд┐рдкрд░реАрдд рдирд╣реАрдВ рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореБрдЭреЗ рдирд╣реАрдВ рдкрддрд╛ рдХрд┐ рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ, рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рд╣реИ, рддреЛ рд╕рдВрднрд╡рддрдГ рдЖрдкрдиреЗ рдбрд┐рд╕реНрдХ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддреЗ рд╕рдордп рдХреБрдЫ рдЧрд▓рдд рдХрд┐рдпрд╛ (рдзрд╛рд░рд╛ 2.2ред)ред </blockquote><br><h4>  4.8.6ред  (5.6)ред рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдЬреЗрдбрдПрдлрдПрд╕ рдореЙрдбреНрдпреВрд▓ рд╕реНрдерд╛рдкрд┐рдд рд╣реИ </h4><br><pre> <code class="bash hljs">ls /boot/grub/*/zfs.mod /boot/grub/i386-pc/zfs.mod</code> </pre> <br><h3>  4.10ред  рд░реВрдЯ рдкрд╛рд╕рд╡рд░реНрдб (рд╣рд╛рд░реНрдб!) рд╕реЗрдЯ рдХрд░реЗрдВ </h3><br><pre> <code class="bash hljs">passwd</code> </pre> <br><blockquote>  рдФрд░ рд╣рд╛рдВ, рд╣рдо рдЕрднреА рд╕реЗ рдУрдкрдирд╢рд╢ рдбрд╛рд▓рддреЗ рд╣реИрдВ, рдЕрдиреНрдпрдерд╛ рдпрджрд┐ рд╣рдо рджреВрд░ рд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдкреБрдирдГ рдЖрд░рдВрдн рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдПрдХ рдЖрд╢реНрдЪрд░реНрдп рдорд┐рд▓реЗрдЧрд╛ </blockquote><br><pre> <code class="bash hljs">apt install --yes openssh-server</code> </pre> <br><p>  Sshd рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╕рд╣реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордд рднреВрд▓рдирд╛: </p><br><pre> <code class="bash hljs">vi /etc/ssh/sshd_config ... PermitRootLogin yes ... PasswordAuthentication yes ...</code> </pre> <br><h3>  4.11ред  рдорд╛рдЙрдВрдЯ рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдареАрдХ рдХрд░реЗрдВ </h3><br><blockquote>  рдпрд╣рд╛рдВ рд╣рдо рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛ рдЧрдПред  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ ZFS рд╡рд┐рднрд╛рдЬрди рдХреБрдЫ рдбреЗрдореЛрдВ рдХреА рд╢реБрд░реБрдЖрдд рдХреЗ рдмрд╛рдж рдЖрд░реЛрд╣рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ (рд╣рдордиреЗ ZFS_INITRD_ADDITIONAL_DATASETS рдХреЛ / etc / default / zfs рдореЗрдВ рднреА рдмрд╣рд╛рдпрд╛), рдЬреЛ рдмрджрд▓реЗ рдореЗрдВ, рд╕рд┐рд╕реНрдЯрдо рд▓реЙрдЧ рдореЗрдВ рднрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рдЖрдк рдореЗрдВ / var рдкрд░ рдХреБрдЫ рд╕рдВрд░рдЪрдирд╛ рдмрдирд╛рддреЗ рд╣реИрдВред  рдЬрдм ZFS рд╡рд┐рднрд╛рдЬрди рдХреЛ рдорд╛рдЙрдВрдЯ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдЖрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдЖрд░реЛрд╣ рдмрд┐рдВрджреБ рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реИрдВ рдФрд░ рдХреБрдЫ рднреА рдирд╣реАрдВ рдмрджрд▓рддрд╛ рд╣реИ, рдбреЗрдЯрд╛ рдмрд┐рдЦрд░рд╛ рд╣реБрдЖ рд╣реИ, рд╕рдм рдХреБрдЫ рдЦрд░рд╛рдм рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдЖрдкрдХреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ / etc / fstab рдореЗрдВ рдорд╛рдЙрдВрдЯ рдкреЙрдЗрдВрдЯ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдлрд╝реЛрд▓реНрдбрд░ рдПрдХреНрд╕реЗрд╕ рдХрд░рддреЗ рд╕рдордп рд╕рд┐рд╕реНрдЯрдордб рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдЙрди рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ: </blockquote><br><pre> <code class="bash hljs">vi /etc/fstab tank/var /var zfs noatime,nodev 0 0 tank/tmp /tmp zfs noatime,nodev 0 0 tank/home/root /root zfs noatime,nodev 0 0</code> </pre> <br><blockquote>  рд╢реЗрд╖ 6 рдЦрдВрдбреЛрдВ рддрдХ рд╣реИред  рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХрд┐рдпрд╛ </blockquote><br><h2>  6. рдкрд╣рд▓реЗ рд░рд┐рдмреВрдЯ </h2><br><h3>  6.1ред  рд░реВрдЯ рд╡рд┐рднрд╛рдЬрди рдХреА рдПрдХ рддрд╕реНрд╡реАрд░ рд▓реЗ рд▓реЛ </h3><br><pre> <code class="bash hljs">zfs snapshot tank/root@setup</code> </pre> <br><blockquote>  рдЙрд╕рд╕реЗ рдХреЛрдИ рдорддрд▓рдм рдирд╣реАрдВ рд╣реИ, рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ рдореИрдВрдиреЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдореВрд▓ рд╡рд┐рднрд╛рдЬрди рдХреЛ рдХрднреА рдирд╣реАрдВ рд╣рд┐рд▓рд╛рдпрд╛ рд╣реИ рдФрд░ рдЗрд╕ рд╡рд┐рднрд╛рдЬрди рдХреЗ рд╕реНрдиреИрдкрд╢реЙрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреА рдЗрд╕реЗ рдЭреВрда рдмреЛрд▓рдиреЗ рджреЗрдВ, рдпрд╣ рдХрд╛рдо рдореЗрдВ рдЖ рд╕рдХрддрд╛ рд╣реИ </blockquote><br><h3>  6.2ред  рдЪрд┐рд░реЛрдЯ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓реЗрдВ </h3><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br><h3>  6.3ред  LiveCD рд╡рд┐рднрд╛рдЬрди рдХреЛ рдЕрдирдорд╛рдЙрдВрдЯ рдХрд░реЗрдВ рдФрд░ ZFS рд╕рд░рдгреА рдирд┐рд░реНрдпрд╛рдд рдХрд░реЗрдВ </h3><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> mount | grep -v zfs | tac | awk <span class="hljs-string"><span class="hljs-string">'/\/mnt/ {print $3}'</span></span> | xargs -i{} umount -lf {} umount /mnt/root umount /mnt/var umount /mnt/tmp zpool <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> tank</code> </pre> <br><blockquote>  ZFS рдХреИрд╢ рдХреЛ рд╕рд╛рдлрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рд╕реНрдХ рдПрд░реЗ рдПрдХреНрд╕рдкреЛрд░реНрдЯ рдЖрд╡рд╢реНрдпрдХ рд╣реИ </blockquote><br><h3>  6.4 рд░рд┐рдмреВрдЯ </h3><br><blockquote>  рд░рд┐рдмреВрдЯрд┐рдВрдЧ рдХреЛ рд▓рд╛рдЗрд╡рд╕реАрдбреА рдЯрд░реНрдорд┐рдирд▓ рдореЗрдВ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рдЖрдк рдПрдХ ssh рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд░рд┐рдмреВрдЯ рдХрд░рдиреЗ рд╕реЗ рд╕рд░реНрд╡рд░ "рдлреНрд░реАрдЬрд┐рдВрдЧ" рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </blockquote><br><pre> <code class="bash hljs">reboot</code> </pre> <br><blockquote>  рдпрджрд┐, рдлрд┐рд░ рднреА, рдХреБрдЫ рдЧрд▓рдд рд╣реЛ рдЧрдпрд╛ рдФрд░ рд╕рд░реНрд╡рд░ рд░рд┐рдмреВрдЯ рдирд╣реАрдВ рдЧрдпрд╛, рддреЛ рдЖрдк рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рд░рд┐рдмреВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЪреВрдВрдХрд┐ рдЬреЗрдбрдПрдлрдПрд╕ рд╕рд░рдгреА рдирд┐рд░реНрдпрд╛рдд рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдЗрд╕реЗ рдиреБрдХрд╕рд╛рди рдкрд╣реБрдВрдЪрд╛рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИред </blockquote><br><h3>  6.5ред  рд╣рдо рдПрдХ рд░рд┐рдмреВрдЯ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рд░реВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ </h3><br><h3>  6.6ред  рдЕрдкрдирд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддрд╛ рдмрдирд╛рдПрдБ </h3><br><pre> <code class="bash hljs">zfs create tank/home/{{ LOGIN }} useradd -u {{ UID }} -G adm,sudo -d /home/{{ LOGIN }}/ -s /bin/bash {{ LOGIN }} cp -a /etc/skel/.[!.]* /home/{{ LOGIN }} chown -R {{ LOGIN }}:{{ LOGIN }} /home/{{ LOGIN }}</code> </pre> <br><p>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ ssh рдХреБрдВрдЬреА рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЙрд╕рдХреЗ рд▓рд┐рдП рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░реЗрдВ: </p><br><pre> <code class="bash hljs">su - {{ LOGIN }} mkdir .ssh chmod 0700 .ssh vi .ssh/authorized_keys <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> passwd {{ LOGIN }}</code> </pre> <br><blockquote>  OpenSSH рдореЗрдВ рд╣рдо рд░реВрдЯ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдСрдереЗрдВрдЯрд┐рдХреЗрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреЛ рд╣рдЯрд╛рддреЗ рд╣реИрдВ: </blockquote><br><pre> <code class="bash hljs">vi /etc/ssh/sshd_config ... PermitRootLogin no ... PubkeyAuthentication yes ... PasswordAuthentication no ... service ssh restart</code> </pre> <br><h3>  6.7ред  6.8ред  рдЕрдм рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ </h3><br><h2>  7. рд╕реНрд╡реИрдк рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ </h2><br><h3>  7.1ред  ZFS рд╡рд┐рднрд╛рдЬрди рдмрдирд╛рдПрдБ </h3><br><pre> <code class="bash hljs">zfs create \ -V 32G \ -b $(getconf PAGESIZE) \ -o compression=<span class="hljs-built_in"><span class="hljs-built_in">zle</span></span> \ -o logbias=throughput \ -o sync=always \ -o primarycache=metadata \ -o secondarycache=none \ tank/swap</code> </pre> <br><ul><li>  -V 32G - рд╣рдорд╛рд░реЗ SWAP рдХрд╛ рдЖрдХрд╛рд░, рдЖрдк рд╡рд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рд╣реИ; </li><li>  -b $ (getconf PAGESIZE) - рдмреНрд▓реЙрдХ рдЖрдХрд╛рд░ (рдПрд╢рдлреНрдЯ рдХреЗ рд╕рд╛рде 4K = 12); </li><li>  рд╕рдВрдкреАрдбрди = zle - рд╕рдВрдкреАрдбрди рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдЪреБрдиреЗрдВ рдЬреЛ рд╕рдВрд╕рд╛рдзрди рдЦрдкрдд рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдиреНрдпреВрдирддрдо рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдмреНрд▓реЙрдХ рдХрд╛ рдЖрдХрд╛рд░ 4K рд╣реИ, рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╕рдВрдкреАрдбрд╝рди рдЗрдирдкреБрдЯ-рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрдЧрд╛, рд▓реЗрдХрд┐рди рд╢реВрдиреНрдп рдмреНрд▓реЙрдХреЛрдВ рдкрд░ рдмрдЪрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛; </li><li>  logbias = throughput - рддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рд╕рдВрдЪрд╛рд▓рди рдХрд╛ рдЕрдиреБрдХреВрд▓рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмреИрдВрдбрд╡рд┐рдбреНрде рдХреА рд╕реНрдерд╛рдкрдирд╛; </li><li>  рд╕рд┐рдВрдХ = рд╣рдореЗрд╢рд╛ - рд╣рдореЗрд╢рд╛ рд░рд┐рдХреЙрд░реНрдб рдХреЛ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХрд░реЗрдВред  рдпрд╣ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдереЛрдбрд╝рд╛ рдХрдо рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдбреЗрдЯрд╛ рдХреА рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдХреА рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЧрд╛рд░рдВрдЯреА рджреЗрддрд╛ рд╣реИ; </li><li>  рдкреНрд░рд╛рдердорд┐рдХ рдХреИрд╢ = рдореЗрдЯрд╛рдбреЗрдЯрд╛ - рдХреЗрд╡рд▓ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреИрд╢, рдЪреВрдВрдХрд┐ рдПрдХ рд╣реА рдмреНрд▓реЙрдХ рдХреЗ рдХрдИ рд░реАрдбреНрд╕ рд╕реНрд╡реИрдк рд╕реЗ рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ; </li><li>  рджреНрд╡рд┐рддреАрдпрдХ рдХреИрд╢ = рдХреЛрдИ рдирд╣реАрдВ - рдКрдкрд░ рд╡рд░реНрдгрд┐рдд рдХрд╛рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдорд╛рдзреНрдпрдорд┐рдХ рдХреИрд╢ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВ; </li></ul><br><h3>  7.2ред  рд╕реНрд╡реИрдк рд╡рд┐рднрд╛рдЬрди рд╕реЗрдЯ рдХрд░реЗрдВ </h3><br><pre> <code class="bash hljs">mkswap -f /dev/zvol/tank/swap <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> /dev/zvol/tank/swap none swap defaults 0 0 &gt;&gt; /etc/fstab <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> RESUME=none &gt; /etc/initramfs-tools/conf.d/resume</code> </pre><br><h3>  7.3ред  рд╕реНрд╡реИрдк рдЪрд╛рд▓реВ рдХрд░реЗрдВ </h3><br><pre> <code class="bash hljs">swapon -av</code> </pre> <br><blockquote><p>  рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реБрдП, рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреА рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ, рдПрдХ рдмрд┐рдВрджреБ рдХреЛ рдЫреЛрдбрд╝рдХрд░, рдЕрд░реНрдерд╛рддреН: "рдЖрдкрд╛рддрдХрд╛рд▓реАрди рдмреВрдЯ" </p><p>  рдФрд░ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдбрд╛рд▓рдирд╛ рдордд рднреВрд▓рдирд╛ </p></blockquote><br><h2>  рдЖрд░ред рдЗрдорд░рдЬреЗрдВрд╕реА рдмреВрдЯ </h2><br><p>  рд╣рдо рд╕реНрдерд╛рдкрдирд╛ рд╡рд╛рддрд╛рд╡рд░рдг рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ (рдЖрдЗрдЯрдо 1.) </p><br><p>  рддреИрдпрд╛рд░реА рдХреЗ рджреМрд░рд╛рди, ZFS рд╕рд░рдгреА рдЖрдпрд╛рдд рдХреА рдЬрд╛рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ рдЖрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рд╣реА рдорд╛рдЙрдВрдЯ рдмрд┐рдВрджреБ рдХреЗ рд╕рд╛рде: </p><br><pre> <code class="bash hljs">zpool <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> -a zpool import -N -R /mnt tank zfs mount -a</code> </pre> <br><blockquote> , ,      ,        fstab,    : </blockquote><br><pre> <code class="bash hljs">mount -t zfs tank/var /mnt/var/ mount -t zfs tank/tmp /mnt/tmp/ mount -t zfs tank/home/root /mnt/root/</code> </pre> <br><p> ,   ,   chroot   .4.4.,          . 6.3. </p><br><h2> D.   </h2><br><p>   3.3.             .      ,        : ,       /spool,      /data.       ZFS     . </p><br><h2>  рд╕рд╛рд░рд╛рдВрд╢ </h2><br><ul><li>       ZFS  ,     ,     ; </li><li>        ZFS,                 ,     .    ZFS тАФ       ,   ; </li><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">.</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi439860/">https://habr.com/ru/post/hi439860/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi439850/index.html">рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╛рдареАрдп рд╡рд╛рд░реНрддрд╛рд▓рд╛рдкреЛрдВ рдореЗрдВ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рднрд╛рд╡рдирд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛</a></li>
<li><a href="../hi439852/index.html">рд░рд┐рдореЛрдЯ рдХрдВрдЯреНрд░реЛрд▓ рдПрдкреНрд▓реАрдХреЗрд╢рди рд░рд┐рд▓реАрдЬрд╝: рдПрд╕реНрдкрд┐рдпрд╛ 1.1.0</a></li>
<li><a href="../hi439854/index.html">рдПрд╣, рдПрдХ, рдПрдХ рдФрд░ рд╕рдордп: рд╕реАрдЖрд░рдПрдо рдореЗрдВ рдПрдХ рдЧреНрд░рд╛рд╣рдХ рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ рдЙрд╕рдХреЗ рдмрд╛рдж рдЙрд╕рдиреЗ рдЦрд░реАрджрд╛</a></li>
<li><a href="../hi439856/index.html">Yandex! рдЙрдмреЗрд░ рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж</a></li>
<li><a href="../hi439858/index.html">рдкреНрд░реЛрдореЗрдерд┐рдпрд╕ + рдЧреНрд░рд╛рдлрд╛рдирд╛ + рдиреЛрдб рдПрдХреНрд╕рдкреЛрд░реНрдЯрд░ + рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдореЗрдВ рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде Azure рдореЗрдВ рдбреЙрдХрдЯрд░</a></li>
<li><a href="../hi439862/index.html">11 рд╕реЗ 17 рдлрд░рд╡рд░реА рддрдХ рдореЙрд╕реНрдХреЛ рдореЗрдВ рдбрд┐рдЬрд┐рдЯрд▓ рдХрд╛рд░реНрдпрдХреНрд░рдо</a></li>
<li><a href="../hi439864/index.html">рдЬреНрдЮрд╛рди рдкреНрд░рдмрдВрдзрди, рд╣рдордиреЗ рдХреНрдпреЛрдВ рдФрд░ рдХреИрд╕реЗ рдХрд┐рдпрд╛</a></li>
<li><a href="../hi439866/index.html">1C рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рдореИрдиреЗрдЬрдореЗрдВрдЯ 2 (рдИрдЖрд░рдкреА 2.4.6) рдореЗрдВ рдирд╛рдордХрд░рдг рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдбрд┐рдЬрд╛рдЗрди рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрдд</a></li>
<li><a href="../hi439868/index.html">рдлреЗрд╕рдмреБрдХ рдХреЗ рдмрд┐рдирд╛ рдЬреАрд╡рди: рдХрдо рдХрдЯреНрдЯрд░рдкрдВрдереА рд╡рд┐рдЪрд╛рд░реЛрдВ, рдЕрдЪреНрдЫреЗ рдореВрдб, рдкреНрд░рд┐рдпрдЬрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╕рдордпред рдЕрдм рд╡рд┐рдЬреНрдЮрд╛рди рджреНрд╡рд╛рд░рд╛ рд╕рд┐рджреНрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ</a></li>
<li><a href="../hi439870/index.html">рдкреНрд░рдЧрддрд┐ рдХреЗ рдЗрдВрдЬрди рдХреЗ рд░реВрдк рдореЗрдВ рд╡реАрдбрд┐рдпреЛ: рдирд┐рдЧрд░рд╛рдиреА рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХрд╛ рд╡рд┐рдХрд╛рд╕</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>