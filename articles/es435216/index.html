<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üó°Ô∏è üë©‚Äçüöí üï¢ C√≥mo hacer 200 a partir de dos l√≠neas de c√≥digo y por qu√© necesita hacer esto üëáüèº üë©üèº‚Äçüíº üçÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos 


 Yo (nosotros, como empresa) terminamos la plataforma del proveedor, la plataforma es un complemento para WordPress. Estoy familiariza...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo hacer 200 a partir de dos l√≠neas de c√≥digo y por qu√© necesita hacer esto</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435216/"><p>  Hola a todos </p><br><p>  Yo (nosotros, como empresa) terminamos la plataforma del proveedor, la plataforma es un complemento para WordPress.  Estoy familiarizado con el frontend, JS, HTML solo en la medida en que, por lo tanto, las <strong>soluciones anteriores pueden no estar alfabetizadas, pero la esencia del art√≠culo no es eso</strong> . </p><br><p>  La conclusi√≥n es demostrar claramente por qu√© a veces, en lugar de dos l√≠neas de c√≥digo, ser√≠a la decisi√≥n correcta escribir doscientas. </p><br><p>  Desarrolladores principiantes y desarrolladores con experiencia para quienes tal pensamiento parece dudoso, pregunto bajo cat. </p><a name="habracut"></a><br><h2 id="vvedenie">  Introduccion </h2><br><p>  Leer el art√≠culo sin leer los comentarios en el c√≥digo no tiene sentido, porque los comentarios en el c√≥digo no est√°n duplicados en el texto del art√≠culo y el texto del art√≠culo implica que el lector ha le√≠do los comentarios. </p><br><h2 id="zadacha">  Desaf√≠o </h2><br><p>  Fue necesario realizar cambios en JS, realizo los cambios en archivos separados, de modo que lo menos posible "contamine" el c√≥digo fuente del proveedor de la plataforma, por lo que en el futuro ser√° m√°s f√°cil adaptar las actualizaciones de las fuentes de la plataforma. </p><br><p>  En consecuencia, el c√≥digo de la nueva funcionalidad est√° en los nuevos archivos que deben cargarse en la p√°gina. </p><br><p> Tarea: se requiere cargar ciertos archivos al cargar la p√°gina. </p><br><h2 id="pervyy-blin-komom">  El primer panqueque es grumoso </h2><br><pre><code class="xml hljs">+<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"e-cryptex.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> +<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wp-content/themes/tol-child/js/child_realforex.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  (las l√≠neas con "+" son l√≠neas nuevas en el c√≥digo fuente) </p><br><p>  La soluci√≥n se prob√≥ para la p√°gina principal y funcion√≥ all√≠, luego result√≥ que para las p√°ginas con la direcci√≥n example.com/about, la soluci√≥n no funcion√≥, porque el navegador estaba intentando cargar example.com/about/e-cryptex.js y el navegador recibi√≥ un error 404 , porque el archivo realmente estaba en la ra√≠z - example.com/e-cryptex.js. </p><br><h2 id="vtoroy-variant">  Segunda opci√≥n </h2><br><p>  Observ√© c√≥mo los desarrolladores de la plataforma se aferran a la p√°gina: </p><br><pre> <code class="php hljs">wp_register_script(FILE-ID,FILE-PATH); wp_enqueue_script(FILE-ID);</code> </pre> <br><p>  Los archivos se adjuntan utilizando la funcionalidad de WordPress. Bien, hagamos lo mismo: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// : -&lt;script src="e-cryptex.js"&gt;&lt;/script&gt; -&lt;script src="wp-content/themes/tol-child/js/child_realforex.js"&gt;&lt;/script&gt; //  : +</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> +const E_CRYPTEX_JS ='e-cryptex_js'; +wp_register_script(E_CRYPTEX_JS,'/e-cryptex.js',array(),null); +wp_enqueue_script(E_CRYPTEX_JS); +const CHILD_REALFOREX_JS = 'child_realforex_js'; +wp_register_script( + CHILD_REALFOREX_JS, + '/wp-content/themes/tol-child/js/child_realforex.js', + array(E_CRYPTEX_JS), + null); +wp_enqueue_script(CHILD_REALFOREX_JS); +</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><p>  (las l√≠neas con "+" son l√≠neas nuevas en el c√≥digo fuente, las l√≠neas con "-" son l√≠neas eliminadas del c√≥digo fuente). </p><br><p>  Comprobado - obras, aprox. </p><br><p>  Hab√≠a dos l√≠neas: se convirti√≥ en 12, todas dentro del mismo archivo. </p><br><h2 id="refaktoring">  Refactorizaci√≥n </h2><br><p>  Mir√© este c√≥digo y mi sentido de la belleza se rebel√≥: </p><br><ul><li>  una persona que no est√© familiarizada con WordPress no entender√° nada; debe ir al directorio para comprender el prop√≥sito de las funciones wp_register_script () y wp_enqueue_script () </li><li>  obviamente lo mismo se hace dos veces seguidas, los argumentos solo son diferentes: DRY se viola </li></ul><br><p>  Ok, refactor. </p><br><p>  Primero, hacemos una clase (un archivo), y segundo, conectamos y usamos la clase (cambiamos otro archivo). </p><br><h3 id="delaem-klass">  Hacer clase </h3><br><pre> <code class="php hljs">+<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Migesco</span></span></span><span class="hljs-class"> </span></span>{ + + <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SCRIPT = <span class="hljs-string"><span class="hljs-string">'script'</span></span>; + <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SOURCE = <span class="hljs-string"><span class="hljs-string">'source'</span></span>; + <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DEPENDENCY = <span class="hljs-string"><span class="hljs-string">'dependency'</span></span>; + <span class="hljs-comment"><span class="hljs-comment">//   ,      'configuration.js', //     ""   . + static function attachConfigurationJS(){ + $configurationFiles = array( + array(Migesco::SCRIPT =&gt; 'configuration.js', + Migesco::SOURCE=&gt;'/configuration.js')); + Migesco::includeScriptFiles($configurationFiles); + } //              + static function includeScriptFiles($scriptFiles){ + foreach ($scriptFiles as $scriptFile){ + $dependency = array_key_exists(self::DEPENDENCY,$scriptFiles) + ? $scriptFile[self::DEPENDENCY] + : array(); + self::includeScript($scriptFile[self::SCRIPT],$scriptFile[self::SOURCE],$dependency); + } + } //    , //    "",     // (     ) + static function includeScript($id,$source,$dependency){ + wp_register_script($id,$source,$dependency,null); + wp_enqueue_script($id); + } +}</span></span></code> </pre> <br><h3 id="podklyuchaem-i-ispolzuem">  Nos conectamos y usamos </h3><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//: -const E_CRYPTEX_JS ='e-cryptex_js'; -wp_register_script(E_CRYPTEX_JS,'/e-cryptex.js',array(),null); -wp_enqueue_script(E_CRYPTEX_JS); -const CHILD_REALFOREX_JS = 'child_realforex_js'; -wp_register_script( - CHILD_REALFOREX_JS, - '/wp-content/themes/tol-child/js/child_realforex.js', - array(E_CRYPTEX_JS), - null); -wp_enqueue_script(CHILD_REALFOREX_JS); // : //  +require_once(ABSPATH . 'configuration.php'); //  +const ECRYPTEX_JS = 'cryptex'; +const TRADEROOM_SCRIPT_FILES = array( + array(Migesco::SCRIPT =&gt; ECRYPTEX_JS, + Migesco::SOURCE=&gt;'/e-cryptex.js'), + array(Migesco::SCRIPT =&gt; 'child_realforex', + Migesco::SOURCE=&gt;'/wp-content/themes/tol-child/js/child_realforex.js', + Migesco::DEPENDENCY =&gt;ECRYPTEX_JS) +); +Migesco::includeScriptFiles(TRADEROOM_SCRIPT_FILES); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><p>  Hab√≠a 12 l√≠neas de c√≥digos fuente en un archivo, hab√≠a 35, y en dos (m√°s adelante, busque troncos donde m√°s arreglar, para no olvidar nada, no perderse, no perderse). </p><br><h2 id="i-eschyo-raz-refaktring">  Y refactorizando de nuevo </h2><br><p>  Mir√≥ el nuevo c√≥digo: </p><br><ul><li>  algunos m√©todos est√°ticos </li><li>  algunas constantes ... </li></ul><br><p>  se ve torpe!  Recuerdo el siguiente consejo: "si el constructor no tiene argumentos, ¬øse necesita esa clase?" </p><br><p>  Vamos a rehacer, pero una clase normal, con un constructor y m√©todos normales. </p><br><h3 id="klass">  Clase </h3><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// : -class Migesco { - - const SCRIPT = 'script'; - const SOURCE = 'source'; - const DEPENDENCY = 'dependency'; - - static function attachConfigurationJS(){ - $configurationFiles = array( - array(Migesco::SCRIPT =&gt; 'configuration.js', - Migesco::SOURCE=&gt;'/configuration.js')); - Migesco::includeScriptFiles($configurationFiles); - } - static function includeScriptFiles($scriptFiles){ - foreach ($scriptFiles as $scriptFile){ - $dependency = array_key_exists(self::DEPENDENCY,$scriptFiles) - ? $scriptFile[self::DEPENDENCY] - : array(); - self::includeScript($scriptFile[self::SCRIPT],$scriptFile[self::SOURCE],$dependency); - } - } - static function includeScript($id,$source,$dependency){ - wp_register_script($id,$source,$dependency,null); - wp_enqueue_script($id); - } -} //: //      : //   //   //    //       +namespace Migesco; + + //      html- +class Configurator +{ //               + static function attachConfigurationJS() + { + $configurationFiles = array( + (new WebResource('configuration.js'))-&gt;setSource('/configuration.js')); + self::attachFiles($configurationFiles); + } + //      html- + static function attachFiles($resourceList) + { + (new Registrar($resourceList))-&gt;toRegistrate(); + } +} + //      html- +class Registrar +{ //     + public $list = array(); //     private (   ) + /** @var WebResource $resource */ + public $resource = null; + + public function __construct($list) + { + $isArray = is_array($list); + if ($isArray) { + $this-&gt;list = $list; + } + } + //      WordPress + function registerScript() + { + wp_register_script( + $this-&gt;resource-&gt;getName(), + $this-&gt;resource-&gt;getSource(), + $this-&gt;resource-&gt;getDependency(), + null); + } + //     + function enqueueScript() + { + wp_enqueue_script($this-&gt;resource-&gt;getName()); + } + //      + function toRegistrate() + { + $result = false; + foreach ($this-&gt;list as $resource) { + /** @var WebResource $resource */ + $isResource = $resource instanceof WebResource; + if ($isResource) { + $this-&gt;resource = $resource; + $this-&gt;registerScript(); + $this-&gt;enqueueScript(); + + $result = true; + } + } + return $result; + } +} + //     +class WebResource +{ //    + public $source = ''; //   + public $name = ''; //   + public $dependency = array(); + + public function __construct($name) + { + $this-&gt;setName($name); + } + + /** + * @param string $source + * @return WebResource + */ + public function setSource($source) + { + $this-&gt;source = strval($source); + return $this; + } + + /** + * @param string $name + * @return WebResource + */ + public function setName($name) + { + $this-&gt;name = strval($name); + return $this; + } + + /** + * @param array $dependency + * @return WebResource + */ + public function setDependency($dependency) + { + $isArray = is_array($dependency); + if ($isArray) { + $this-&gt;dependency = $dependency; + } + return $this; + } + + /** + * @return string + */ + public function getSource() + { + return $this-&gt;source; + } + + /** + * @return string + */ + public function getName() + { + return $this-&gt;name; + } + + /** + * @return array + */ + public function getDependency() + { + return $this-&gt;dependency; + } +}</span></span></code> </pre> <br><h3 id="ispolzovanie">  Uso </h3><br><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// : -const TRADEROOM_SCRIPT_FILES = array( - array(Migesco::SCRIPT =&gt; ECRYPTEX_JS, - Migesco::SOURCE=&gt;'/e-cryptex.js'), - array(Migesco::SCRIPT =&gt; 'child_realforex', - Migesco::SOURCE=&gt;'/wp-content/themes/tol-child/js/child_realforex.js', - Migesco::DEPENDENCY =&gt;ECRYPTEX_JS) -); -Migesco::includeScriptFiles(TRADEROOM_SCRIPT_FILES); // : +$traderoomScriptFiles = array( + (new Migesco\WebResource(ECRYPTEX_JS)) + -&gt;setSource('/e-cryptex.js'), + (new Migesco\WebResource('child_realforex')) + -&gt;setSource('/wp-content/themes/tol-child/js/child_realforex.js') + -&gt;setDependency(array(ECRYPTEX_JS)) +); +Migesco\Configurator::attachFiles($traderoomScriptFiles); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><p>  Puede volver a realizar la refactorizaci√≥n (la plataforma se ejecuta en PHP 5.6; me encantar√≠a configurar los tipos en todas partes, pero desafortunadamente no puede, puede hacer que la clase Configurador est√°tico sea m√°s humana, por ejemplo, inicializar desde una lista de archivos: recursos web y el m√©todo attachFiles est√°tico), pero lo ideal para un mundo ideal es que vivimos en lo real y hace sus propias correcciones, el tiempo dedicado a la tarea, el trabajo en la tarea se detiene. </p><br><p>  Total: hab√≠a 35 l√≠neas en la fuente en dos archivos, se convirti√≥ en ~ 170, tambi√©n en dos archivos. </p><br><h2 id="chto-my-poluchili-">  Que conseguimos </h2><br><ol><li>  Ahora no tiene que recurrir a la ayuda de WordPress para comprender el prop√≥sito de los par√°metros de "funciones". </li><li>  Ahora tenemos un contenedor para conectar archivos y podemos cambiar sin problemas el algoritmo para conectar archivos: no tendremos que editar todas las llamadas a wp_register_script y wp_enqueue_script </li><li>  Ahora podemos cambiar WordPress a cualquier cosa y solo la clase tendr√° que reescribir <br>  Registrador, no es necesario reemplazar todas las llamadas wp_register_script y wp_enqueue_script y seguir la l√≥gica de WordPress. </li></ol><br><p>  ¬øVali√≥ la pena? </p><br><p>  Cada uno tiene su propio enfoque para apoyar la base del c√≥digo y su propia opini√≥n. </p><br><p>  Mi respuesta es si. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es435216/">https://habr.com/ru/post/es435216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es435206/index.html">Europa aprueba la directiva de derechos de autor: por qu√© las plataformas de transmisi√≥n se oponen</a></li>
<li><a href="../es435208/index.html">Internet de las cosas ... que lloran por una buena UI / UX</a></li>
<li><a href="../es435210/index.html">El trabajo de Xamarin con el SDK C</a></li>
<li><a href="../es435212/index.html">C√≥mo olvidarse de las tarjetas de presentaci√≥n en papel en el nuevo a√±o</a></li>
<li><a href="../es435214/index.html">Lanzamiento de Linux 4.20: lo que ha cambiado en la nueva versi√≥n del kernel</a></li>
<li><a href="../es435220/index.html">Kotlin Native: realiza un seguimiento de los archivos</a></li>
<li><a href="../es435224/index.html">C√≥mo comunicarse en una oficina en ingl√©s: 14 expresiones idiom√°ticas √∫tiles</a></li>
<li><a href="../es435226/index.html">Restaurar datos desde cero</a></li>
<li><a href="../es435228/index.html">Kubernetes cluster por $ 20 por mes</a></li>
<li><a href="../es435234/index.html">M√°s inteligente, m√°s preciso y m√°s preciso: c√≥mo la IA cambia los vuelos al espacio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>