<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî∫ ü•¢ üë§ Ein offenes Projekt eines Elektromotor-Steuermoduls. Softwareentwicklungstechnologie üíò üëµüèª üïò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Schreiben von Firmware f√ºr die Innenr√§ume moderner eingebetteter Elektronik ist praktisch nicht von Grund auf neu zu schreiben. Sie geben einfach ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ein offenes Projekt eines Elektromotor-Steuermoduls. Softwareentwicklungstechnologie</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403525/"><img src="https://habrastorage.org/getpro/geektimes/post_images/f61/dfd/0b2/f61dfd0b289e32b873cb88a6ce541cc5.png"><br>  Das Schreiben von Firmware f√ºr die Innenr√§ume moderner eingebetteter Elektronik ist praktisch nicht von Grund auf neu zu schreiben.  Sie geben einfach keine Zeit daf√ºr.  Daher basiert Software f√ºr eingebettete Systeme auf <br>  fertige Softwareplattformen - Frameworks.  Je weiter das Framework entwickelt ist, desto schneller ist die Entwicklung.  Hier werden wir √ºber das Framework sprechen, das ich speziell f√ºr Motorsteuerungsmodule erstellt habe und das seit einiger Zeit erfolgreich eingesetzt wird. <br><a name="habracut"></a><br><h2>  <b>Die Architektur des Frameworks.</b> <br></h2><br>  Das Framework ist f√ºr die Arbeit auf der offenen Plattform des Universal Motor Control Module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DMC v2.0 ausgelegt</a> . <br><br>  Die logische Architektur des Frameworks kann als Blockdiagramm dargestellt werden (siehe unten).  Im Blockdiagramm wird eine vollst√§ndige Auflistung aller Komponenten des Frameworks weggelassen, da dies die Klarheit beeintr√§chtigen w√ºrde, aber f√ºr eine allgemeine Idee denke ich, dass die Details ausreichen. <br><br> <a href=""><img align="left" width="973" src="https://habrastorage.org/getpro/geektimes/post_images/b68/4a6/a74/b684a6a74fe172cfde9fc7b6dcdd4aec.png"><br clear="left"></a>  <a href=""><em>(Zum Vergr√∂√üern anklicken)</em></a> <br><br>  Das Framework hat keine Versionen, es wird st√§ndig weiterentwickelt, und hier habe ich nur versucht, den aktuellen Status zu korrigieren, der auf GitHub ver√∂ffentlicht ist. <br><br>  Aus Sicht der Softwaremodule enth√§lt das Framework folgende Schl√ºsselteile: <br><br>  - Eine Reihe von Support-Modulen auf Anwendungsebene <br>  - Echtzeitbetriebssystem <b>MQX</b> . <br>  - Middleware: <b>Dateisystem, Befehlsshell, Kommunikationsprotokollstapel</b> usw. <br>  - Ein Low-Level-Board-Support-Paket (BSP), das den <b>Zugriff auf die Peripherieger√§te</b> des BLEZ66V1-Moduls und des Leistungsmoduls umfasst. <br>  - Softwarepaket f√ºr <b>√úberwachung, Debugging und Diagnose</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FreeMaster</a> . <br>  - Debugging-Tools wie <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RTT</a> ,</b> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ITM-</a></b> Tool-Tracing <b>, Logger, VT100-</b> Terminal. <br>  - Modul zum <b>Generieren von</b> Parameterdateien. <br>  - Module generierter Quellcodes basierend auf Algorithmen in <b>Matlab</b> . <br><br><h2>  <b>Warum ist MQX ausgew√§hlt?</b> <br></h2><br>  Das Echtzeitbetriebssystem (RTOS) MQX ist aber seit langem bekannt <br>  erschien vor ein paar Jahren gemeinfrei.  Dieses Betriebssystem wurde von Freescal hochgeladen, bevor NXP sie kaufte.  RTOS hatte urspr√ºnglich eine Lizenz nur f√ºr die Verwendung in Freescale-Mikrocontrollern, jetzt erstreckt sich die Lizenz auch auf NXP-Produkte.  RTOS √ºberlebte die explosive Popularit√§t und durchlief mehrere Upgrades auf Version 4.2. Danach beschloss Freescale, seine nachfolgenden Versionen wieder kommerziell zu machen.  Es stellte sich also heraus, dass es zwei Versionen gab, eine offene und eingefrorene Version namens MQX Classic (auch bekannt als MQX v4.2) und eine geschlossene kommerzielle MQX 5.0. <br><br>  In dem beschriebenen Framework wird der Zweig MQX Classic v4.2 verwendet.  Dies ist eine stabile, gut getestete Version.  Die Lizenz erm√∂glicht es dem Entwickler, den Quellcode von MQX Classic zu √§ndern und in kommerziellen Produkten zu verwenden. Die Ver√∂ffentlichung von MQX Classic in Quellform ist jedoch nicht zul√§ssig.  Dies sollte jedoch kein Problem sein, da MQX Classic zum kostenlosen Download zur Verf√ºgung steht. <br><br>  Die Struktur von RTOS im Allgemeinen sieht folgenderma√üen aus: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/d89/752/c84/d89752c84e3a24d03198b581116e4f47.png"><br><br><h2>  <b>Warum brauche ich RTOS?</b> <br></h2><br>  Eine komplexe Anwendung, bei der insbesondere eine Motorsteuerung erforderlich ist, ist recht komplex und besteht aus vielen asynchronen Aufgaben, von denen jede ihren eigenen Wiederholungszyklus und ihre Aktivierungs- und Stoppereignisse hat.  Wenn wir alle diese Aufgaben in einem Superzyklus ausf√ºhren, sto√üen wir unweigerlich auf das Problem, die Ausf√ºhrung einiger Aufgaben durch andere Aufgaben zu verz√∂gern. <br>  Mit RTOS wie MQX ist es m√∂glich, die gegenseitige Abh√§ngigkeit einzelner Aufgaben auf der Zeitachse zu beseitigen, ohne sie neu zu schreiben oder ihre Quellcodes zu betrachten. <br><br>  Beispielsweise kann unsere Logger-Aufgabe versuchen, eine Nachricht so lange wie gew√ºnscht auf eine SD-Karte zu schreiben, die auf ihre Antwort wartet. Die USB-Aufgabe kann alle eine gro√üe Datenmenge an einen Computer √ºbertragen. Gleichzeitig wird die PID-Aufgabe des Motoralgorithmus streng in einem bestimmten Intervall ausgef√ºhrt und die Geschwindigkeitsmessaufgabe Bei der Drehung wird kein einziges Encoder-Signal√§nderungsereignis √ºbersehen. <br><br>  Ich muss zugeben, dass es einen immer beliebteren Weg gibt, die Komplexit√§t auf einem einzelnen Chip zu beseitigen - die Umstellung auf Multiprocessing. In diesem Fall bietet RTOS jedoch einen guten Service. <br><br><h2>  <b>Die Hauptvorteile von RTOS MQX.</b> <br><br></h2>  - Der Kernel des Systems enth√§lt eine breite Palette an Middleware, darunter ein Dateisystem, einen TCP / IP-Stack, einen USB-Stack, eine Befehlsshell usw.  Alles im Quellcode. <br><br>  - Vorgefertigte BSP-Sets f√ºr verschiedene Karten, sodass Sie keine eigenen peripheren Arbeitsbibliotheken schreiben m√ºssen. <br>  - Detaillierte Dokumentation in PDF-Dateien mit einfacher Navigation. <br>  - Das Vorhandensein eines Plug-Ins f√ºr die eingebettete IDE IAR-Workbench mit sehr detaillierten Informationen zu den internen Strukturen von RTOS ist viel detaillierter als bei anderen bekannten RTOS - uCOS und FreeRTOS. <br>  - Viele RTOS-Anwendungsbeispiele und Testf√§lle. <br><br>  Wenn sie √ºber RTOS sprechen, betonen sie immer ihre F√§higkeit, Aufgaben rechtzeitig zu erledigen, aber quantitative Sch√§tzungen werden f√ºr einige separat ausgew√§hlte Plattformen von Drittanbietern meistens nicht oder nicht angegeben.  Dies reicht eindeutig nicht aus, um eine harte Echtzeitsteuerung mit RTOS zu implementieren.  Und um die Motoren zu steuern, ben√∂tigen Sie genau harte Echtzeit. <br><br>  MQX hat diesbez√ºglich einen wunderbaren Testfall, mit dem Sie eine detaillierte Tabelle der Ausf√ºhrungszeit aller Dienste auf der Plattform erhalten, auf der Sie den Test gestartet haben. <br><br>  Nachfolgend finden Sie eine Tabelle der Ausf√ºhrungszeit von Diensten auf dem Mikrocontroller unseres Motorsteuerungsmoduls, wobei die maximale Optimierung der Codeausf√ºhrungsgeschwindigkeit im Compiler enthalten ist. <br><br><div class="spoiler">  <b class="spoiler_title">RTOS MQX Classic Service-Ausf√ºhrungszeitpunkt</b> <div class="spoiler_text"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/3f4/79a/2e6/3f479a2e65fd274ca81b27321ae31978.png"><br><img src="https://habrastorage.org/getpro/geektimes/post_images/51d/f91/32d/51df9132da3b6d09656d6ee7b2021ebc.png"><br></div></div><br>  Die Tabelle gibt auch eine Vorstellung davon, welche Dienste von RTOS unterst√ºtzt werden und welche Kerneloptionen verf√ºgbar sind.  Das Testprojekt in der IDE IAR ist im ver√∂ffentlichten Framework enthalten. <br><br><h2>  <b>Zusammensetzung des Projektverzeichnisses</b> <br></h2><br>  Das Stammverzeichnis des Frameworks sieht folgenderma√üen aus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/04e/fde/4a0/04efde4a059a9ba99ba39c7d6c275a8e.png"></div><br>  <b>APP_SRC</b> - Ein Verzeichnis, das alle Quellen au√üer denen enth√§lt, die zur MQX-Distribution geh√∂ren. <br>  <b>FreeMaster_apps</b> - Projektdateien zur Ausf√ºhrung in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FreeMaster-</a> Umgebung. <br>  <b>IAR_proj</b> - Arbeitsbereich und Projektdateien f√ºr die eingebettete IAR-Workbench f√ºr ARM v7.70.2.  In dieser Umgebung wird die endg√ºltige Anwendung kompiliert und debuggt. <br>  <b>MQX_SRC</b> ist ein Verzeichnis, das alle mit MQX gelieferten Quellen f√ºr MQX und Middleware enth√§lt.  Da die Lizenz kein Open Source-Publishing aus der MQX-Distribution zul√§sst, befinden sich in diesem Verzeichnis keine ' <b>.s'-</b> und' <b>.s'-</b> Dateien.  Aber diejenigen, die den NXP-Lizenzbedingungen zustimmen, k√∂nnen die fehlenden Dateien erhalten. <br>  <b>ParametersManager</b> - Verzeichnis des Parametermanager-Programms.  Mit diesem Programm werden Listen von Anwendungsparametern erstellt und ' <b>.s'</b> und ' <b>.h'</b> Dateien mit Parameterdeklarationen zum Einbetten in die Anwendung generiert. <br>  <b>TESTS</b> - ein Verzeichnis mit Framework-Testprojekten.  Hier ist das <b>MQX_benchmark-</b> Projekt zum Generieren eines Berichts mit MQX-Timings. <br><br>  Die Dateien <b>MQX_LIBRARY_O0.a</b> und <b>MQX_LIBRARY_O3.a</b> sind die Inhalte des Verzeichnisses <b>MQX_SRC,</b> das mit minimaler bzw. maximaler Optimierung in Bibliotheken kompiliert wurde. <br><br><h2>  <b>Der Inhalt des Verzeichnisses IAR_proj</b> </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/ea2/d23/744/ea2d23744775a8daec5cbddff606db11.png"></div><br>  Die Dateien <b>U3HB_full.eww</b> und <b>U3HB_MQXLib.eww</b> sind die <b>IAR-Arbeitsbereichsdateien</b> . <br>  Solange sich keine Quellen im MQX-Verzeichnis befinden, <b>funktioniert</b> nur die Datei <b>U3HB_MQXLib.eww</b> .  Dieser Arbeitsbereich verwendet kompilierte MQX-Bibliotheken.  Im <b>Arbeitsbereich U3HB_full.eww werden die</b> vollst√§ndigen MQX-Quellen kompiliert.  Das <b>OUT-</b> Verzeichnis dient als Ort, an dem die IAR ihre Arbeitsprodukte platziert, insbesondere Map- und Hex-Dateien. <br><br>  Das <b>Einstellungsverzeichnis</b> wird automatisch von der IAR erstellt.  Es speichert speziell die Debugger-Einstellungen.  Wenn beim Debuggen in der IAR etwas nicht konfiguriert werden kann, lohnt es sich manchmal, dieses Verzeichnis zu l√∂schen. <br><br>  Die Datei <b>INT_FLASH_MK66FX1M0LVQ18.icf</b> ist eine IAR-Linker-Konfigurationsdatei.  Es bestimmt die Adressen von Speicherbereichen, in denen der Linker Code, Daten, Interruptvektoren, Stapel usw. platziert. <br><br><h2>  <b>Der Inhalt des Verzeichnisses MQX_SRC</b> </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/a90/137/f84/a90137f8413885b24fa795dff7397501.png"></div><br>  Arbeitsbereichsdateien <b>MQX_LIBRARY.eww</b> wird zum Erstellen von MQX-Bibliotheken verwendet.  Bis die Dateien ' <b>.s</b> <b>'</b> und ' <b>.s'</b> in den Verzeichnissen abgelegt sind, wird dieses Projekt nicht kompiliert. <br>  <b>config</b> - das Verzeichnis mit den MQX-Konfigurationsdateien.  Die Zusammensetzung der MQX-Dienste und -Treiber ist in der Konfigurationsdatei <b>user_config.h</b> angegeben. <br>  <b>mfs</b> - MQX-Dateisystem, enth√§lt FAT32 und RAM FS <br>  <b>mqx</b> - Der MQX-Kern enth√§lt die folgenden Unterverzeichnisse: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/640/df2/547/640df25474118976fe26e5f2b609924d.png"></div><br>  <b>rtcs</b> - TCP / IP-Stapel.  Es enth√§lt die folgenden Unterverzeichnisse: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/3d4/164/e18/3d4164e187a5d013aab6cf24e159d8d2.png"></div><br>  <b>Shell</b> - Ein Verzeichnis mit Shell-Dateien. <br>  <b>USB</b> - Verzeichnis mit USB Stack Dateien <br><br>  Die Funktionalit√§t jedes MQX-Softwaremoduls ist vom Hersteller gut dokumentiert.  Als Beispiel werde ich Links zu zwei Dokumenten bereitstellen: <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen zur Verwendung des MQX</a> . <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MQX-Referenzhandbuch.</a> <br>  Der Rest muss in der Distribution gesucht werden, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die auf der NXP-Website verf√ºgbar ist</a> . <br><br>  Das Framework selbst befindet sich hier im Repository. <br><br>  Weitere Beschreibungen der Arbeit mit Software und Anwendungsbeispiele finden Sie in den folgenden Artikeln. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de403525/">https://habr.com/ru/post/de403525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de403513/index.html">Wie w√§hle ich einen 3D-Drucker aus?</a></li>
<li><a href="../de403515/index.html">Einige Windows-Systemdateien sind mit Adobe-Metadaten-Junk verstopft</a></li>
<li><a href="../de403517/index.html">Billigeres Verfahren der k√ºnstlichen Photosynthese erfunden</a></li>
<li><a href="../de403521/index.html">Eine kurze Geschichte der physikalischen Theorie der gro√üen Vereinigung</a></li>
<li><a href="../de403523/index.html">Solarbatterie auf dem Balkon, Erfahrung mit</a></li>
<li><a href="../de403531/index.html">Von Kindheit an auf R√§dern: Rasiermesser Elektrofahrrad und Drifter f√ºr Kinder und Jugendliche</a></li>
<li><a href="../de403533/index.html">Pseudowissenschaft Die Fleischindustrie versucht die √ñffentlichkeit von der Unbedenklichkeit ges√§ttigter Fette zu √ºberzeugen</a></li>
<li><a href="../de403535/index.html">Thermonukleares Startup Tokamak</a></li>
<li><a href="../de403537/index.html">Yachten mit Smart Home an Bord. Hergestellt in Russland</a></li>
<li><a href="../de403539/index.html">Wir haben es mit einem Anwalt zu tun: Ist es legal, Torrents herunterzuladen, Spiele bei Brazilian Steam zu kaufen und nicht nur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>