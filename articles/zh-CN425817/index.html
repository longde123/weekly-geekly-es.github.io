<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏖️ 👨🏿‍🤝‍👨🏾 🤽 在您的iOS应用中拖放 👩🏼‍🔧 🤴 🕑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在iOS 11和iOS 12上运行的Drag & Drop机制是一种在单个应用程序内以及不同应用程序之间以图形方式异步复制或移动数据的方法。 尽管这项技术已有30多年的历史了，但实际上它已成为iOS上的“突破性”技术，因为在iOS拖动某些内容时， multitouch允许您与系统的其余部分自由交互并...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>在您的iOS应用中拖放</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425817/"><img src="https://habrastorage.org/webt/gb/xu/dt/gbxudtvrfs8biaj5tlzkpjjjwe4.png"><br><br> 在<code>iOS 11</code>和<code>iOS 12</code>上运行的<code>Drag &amp; Drop</code>机制是一种在单个应用程序内以及不同应用程序之间以图形方式异步复制或移动数据的方法。 尽管这项技术已有30多年的历史了，但实际上它已成为<code>iOS</code>上的“突破性”技术，因为在<code>iOS</code>拖动某些内容时， <code>multitouch</code>允许您与系统的其余部分自由交互并收集数据以从不同的应用程序重置。 <br><a name="habracut"></a><br>  <code>iOS</code>可以一次捕获多个元素。 此外，它们不必处于方便的选择范围内：您可以拿第一个对象，然后转到另一个应用程序并抓取其他东西-所有对象将被收集在手指下的“桩”中。 然后在屏幕上调用通用扩展坞，打开那里的任何应用程序并捕获第三个对象，然后在运行应用程序的情况下进入屏幕，并且在不释放对象的情况下将它们转储到一个打开的程序中。 这样的行动自由在<code>iPad</code>上， <code>iPhone</code>上是可能的， <code>iOS</code> <code>Drag &amp; Drop</code>范围仅限于一个应用程序的框架。 <br><br> 最流行的应用程序（ <code>Safary</code> ， <code>Chrome</code> ， <code>IbisPaint X</code> ， <code>Mail</code> ， <code>Photos</code> ， <code>Files</code>等）已经具有<code>Drag &amp; Drop</code>机制。 除此之外， <code>Apple</code>还为开发人员提供了一个非常简单直观的<code>API</code>用于在您的应用程序中嵌入<code>Drag &amp; Drop</code>机制。  <code>Drag &amp; Drop</code>机制就像手势一样，可以在<b><font color="#0000FF">UIView上</font></b>使用并使用<b><font color="#0000FF">Interactions</font></b>的概念（有点类似于手势），因此您可以<code>Drag &amp; Drop</code>机制简单地视为一个真正强大的手势。 <br><br> 它以及手势都非常容易集成到您的应用程序中。 尤其是在您的应用程序使用<b><font color="#0000FF">UITableView</font></b>表或<b><font color="#0000FF">UICollectionView</font></b>集合的情况下，因为对它们而言<code>API Drag &amp; Drop</code>改进并提升到了更高的抽象水平，即<code>Collection View</code>集合本身可以帮助您使用要拖放的collection元素的<b><font color="#0000FF">indexPath</font></b> <code>Drag</code> 。 她知道您的手指在哪里，并将其解释为您当前“拖动” <code>Drag</code>的集合元素的<b><font color="#0000FF">indexPath</font></b> ，或解释为您“拖放” <b><font color="#0000FF">放置</font></b>元素的collection元素的<b><font color="#0000FF">indexPath</font></b> 。 因此， <code>Collection View</code>集合为您提供了<b><font color="#0000FF">indexPath</font></b> ，但除此之外，它<code>API Drag &amp; Drop</code>常规<b><font color="#0000FF">UIView的</font></b> <code>API Drag &amp; Drop</code>绝对相同。 <br><br>  <code>iOS</code>上的<code>Drag &amp; Drop</code>过程分为四个不同的阶段： <br><br><h2> 升降机 </h2><br>  <b>抬起</b> （抬起）-这是用户执行<b><font color="#FF00FF">长按</font></b>手势时的状态，指示要“拖放”的元素。 此时，所指示元素的非常轻量级的所谓“ <code>lift preview</code> ”形成了，然后用户开始拖动其手指。 <br><br><img src="https://habrastorage.org/webt/t6/sw/tw/t6swtwdee7kasyvqq_od3ipzlxy.png" width="600" height="450"><br><br><h2> 拖动（拖放） </h2><br>  <b>拖动</b> （拖放）-这是用户在屏幕表面上移动对象的时候。 在此阶段，可以修改该对象的“ <code>lift preview</code> ”（绿色“ +”加号或其他符号出现）... <br><br><img src="https://habrastorage.org/webt/07/yo/4x/07yo4x4yua4zelwculog6eng9aw.png" width="600" height="450"><br><br>  ...还允许与系统进行某些交互：您可以单击其他对象并将其添加到当前的“拖放”会话中： <br><br><img src="https://habrastorage.org/webt/yb/bx/wi/ybbxwiqe6-226ipfjmkzmpymkva.png" width="600" height="450"><br><br><h2> 掉落 </h2><br> 用户举起手指时会<b>掉落</b> 。 此时，可能会发生两件事：要么将<code>Drag</code>对象销毁，要么将<code>Drop</code>对象“拖放”到目标位置。 <br><br><img src="https://habrastorage.org/webt/iv/b1/4z/ivb14zogie89jntnkfsxmuubvd0.png" width="600" height="450"><br><br><h2> 资料传输 </h2><br> 如果没有取消“拖放” <b>拖放</b>过程，并且发生了“ <b>拖放</b> ”重置，则将发生<b>数据传输</b> （数据传输），此时“拖放点”从“源”请求数据，并进行异步数据传输。 <br><br> 在本教程中，我们将向您展示如何使用Image Gallery演示应用程序轻松地<code>Drag &amp; Drop</code>机制<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">集成</a>到<code>iOS</code>应用程序中，该应用程序取自<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">斯坦福大学作业课程CS193P</a> 。 <br> 我们将使<code>Collection View</code>能够在外部填充图像，并使用<code>Drag &amp; Drop</code>机制重新组织INSIDE元素。 另外，此机制将用于将<code>Collection View</code>不必要元素转储到“垃圾箱”中，该垃圾箱是常规的<b><font color="#0000FF">UIView</font></b> ，由导航面板上的按钮表示。 我们还可以使用<code>Drag &amp; Drop</code>机制与其他应用程序共享在Gallery中收集的图像，例如<code>Notes</code>或<code>Notes</code>或<code>Mail</code>或照片库（ <code>Photo</code> ）。 <br><br> 但是在着重于“ Image Gallery”演示应用程序中<code>Drag &amp; Drop</code>机制的实现之前，我将非常简要地介绍其主要组件。 <br><br><h1>  “图片库”演示应用程序的功能 </h1><br> 图像库应用程序的用户界面（ <code>UI</code> ）非常简单。 这是插入到<code>Navigation Controller</code> <code>Image Gallery Collection View Controller</code>的“屏幕片段”： <br><br><img src="https://habrastorage.org/webt/rz/gl/o6/rzglo69owhktzl8vcstcosf5rdi.png"><br><br> 该应用程序的中心部分肯定是<code>Image Gallery Collection View Controller</code> ，它由<b><font color="#0000FF">ImageGalleryCollectionViewController</font></b>类支持，并且Image Gallery模型作为变量<b><font color="#0000FF">var imageGallery = ImageGallery（）</font></b> ： <br><br><img src="https://habrastorage.org/webt/na/f2/1r/naf21rpv6pxjnht1bk02mowhgoi.png"><br><br> 该模型由包含图像<b><font color="#0000FF">图像</font></b>数组的<b><font color="#0000FF">struct ImageGallery</font></b>结构表示，其中每个图像由包含图像位置<b><font color="#0000FF">url的URL</font></b> （我们将不存储图像本身）及其宽高比的<b><font color="#0000FF">struct ImageModel</font></b>结构描述。 <br><br><img src="https://habrastorage.org/webt/bp/0b/6_/bp0b6_kh3bgocgc4zlnjrocmk2q.png"><br><br> 我们的<b><font color="#0000FF">ImageGalleryCollectionViewController</font></b>实现了<b><font color="#0000FF">DataSource</font></b>协议： <br><br><img src="https://habrastorage.org/webt/ka/vr/gj/kavrgjqaraoqv4sva-aqhffwvhu.png"><br><br> 单元格集合中的自定义单元格包含一个<b><font color="#0000FF">imageView</font></b>图像<b><font color="#0000FF">：UIImageView！</font></b> 和<b><font color="#0000FF">微调框</font></b>活动指示器<b><font color="#0000FF">：UIActivityIndi​​catorView！</font></b> 并由<b><font color="#0000FF">UICollectionViewCell</font></b>类的自定义<code>subclass</code> <b><font color="#0000FF">ImageCollectionViewCell</font></b>支持： <br><br><img src="https://habrastorage.org/webt/cu/hs/1l/cuhs1ljdvbara4u2_ndq3y_sfxw.png"><br><br>  <b><font color="#0000FF">ImageCollectionViewCell</font></b>类<code>Public API</code>是<b><font color="#0000FF">imageURL</font></b>图像<b><font color="#0000FF">URL</font></b> 。 一旦安装它，我们的<code>UI</code>更新，即，在该<b><font color="#0000FF">imageURL</font></b>上异步选择图像的数据并显示在单元格中。 从网络中检索数据时， <b><font color="#0000FF">微调器</font></b>活动指示器正在工作，表明我们正在检索数据。 <br><br> 我使用带有<b><font color="#0000FF">qos</font></b>服务质量参数的全局队列<b><font color="#0000FF">（qos：.userInitiated）</font></b>来获取给定<code>URL</code>数据，该<code>URL</code>设置为<b><font color="#0000FF">.userInitiated，</font></b>因为我是根据用户的请求选择数据的： <br><br><img src="https://habrastorage.org/webt/0q/aq/2-/0qaq2-uakbn1zou8ilh7pcvysxy.png"><br><br> 每次在闭包中使用自己的变量时（在我们的示例中为<b><font color="#0000FF">imageView</font></b>和<b><font color="#0000FF">imageURL）</font></b> ，编译器都会强制您将<b><font color="#0000FF">self</font></b>置于它们的前面<b><font color="#0000FF">。</font></b> 这样您就会问自己：“是否存在“内存循环链接”？” 这里我们没有明确的“ <code>memory cycle</code> ”，因为<b><font color="#0000FF">自我</font></b>本身没有指向此闭包的指针。 <br><br> 但是，在多线程的情况下，应该记住，由于<b><font color="#0000FF">dequeueReusableCell</font></b>方法， <code>Collection View</code>中的<b><font color="#0000FF">单元</font></b>是可重用的。 每次屏幕上出现一个单元（新的或重复使用的单元）时，都会从网络异步下载图像（此时， <b><font color="#0000FF">旋转器</font></b>活动指示器的“ <b><font color="#0000FF">旋转器</font></b> ”正在旋转）。 <br><br> 下载完成并接收到图像后，将立即更新此收集单元的<code>UI</code> 。 但是，我们不等待图像加载，而是继续滚动浏览集合，标记为我们的集合单元会在不更新<code>UI</code>情况下离开屏幕。 但是，新图像应显示在下方，离开屏幕的同一单元格将被重用，但对于另一张图像，该图像可能会快速加载和更新<code>UI</code> 。 此时，先前在该单元格中开始的图像加载将返回，并且屏幕将更新，这将导致错误的结果。 这是因为我们在不同的线程中运行与网络一起工作的不同事物。 他们在不同的时间回来。 <br><br> 我们如何解决这种情况？ <br> 在我们使用的<b><font color="#0000FF">GCD</font></b>机制的框架内，我们无法取消对离开屏幕的单元格图像的下载，但是当我们从网络获取<b><font color="#0000FF">imageData</font></b>数据时，我们可以检查导致加载此数据的<code>URL</code> <b><font color="#0000FF">url</font></b> ，并将其与用户希望拥有的<code>URL</code>进行比较。此单元格，即<b><font color="#0000FF">imageURL</font></b> 。 如果它们不匹配，那么我们将不会更新<code>UI</code>单元格并等待我们需要的图像数据： <br><br><img src="https://habrastorage.org/webt/01/xl/-v/01xl-vqsde3rlqyus1f7tksacja.png"><br><br> 这行看起来很荒谬的代码<b><font color="#0000FF">url == self.imageURL</font></b>使所有内容在需要非标准想象力的多线程环境中都能正常工作。 事实是，多线程编程中的某些事情以与编写代码不同的顺序发生。 <br><br> 如果无法选择图像数据，则会生成带有错误消息的图像，该错误消息的形式为字符串“ Error”和带有“ frown”的表情符号。  <code>Collection View</code>的空白区域可能会使用户感到困惑： <br><br><img src="https://habrastorage.org/webt/7m/zh/dt/7mzhdt1eo0tedkkrolp6osiidhu.png"><br><br> 我们不希望带有错误消息的图像重复此错误图像的<b><font color="#0000FF">aspectRatio</font></b> ，因为在这种情况下，文本和表情符号将被拉伸或压缩。 我们希望它是中性的-正方形，即它将具有接近1.0的纵横比。 <br><br><img src="https://habrastorage.org/webt/7b/rj/ve/7brjvesx81juxpsgnkevsnvge_u.png"><br><br> 我们必须将此愿望告知我们的<code>Controller</code> ，以便他纠正其<b><font color="#0000FF">imageGallery</font></b>模型中相应<b><font color="#0000FF">indexPath的</font></b> <b><font color="#0000FF">AspectRatio</font></b>纵横比。 这是一个有趣的任务，有很多解决方法，我们将选择最简单的方法-使用<b><font color="#0000FF">可选的</font></b>闭包<b><font color="#0000FF">var closAspectRatio：（（）-&gt; Void）？</font></b>  。 它可以等于<b><font color="#0000FF">nil</font></b> ，如果不需<b><font color="#0000FF">要这样做</font></b> ，则不需要安装它： <br><br><img src="https://habrastorage.org/webt/8v/5q/wy/8v5qwyzl2_-dju1qfotj7i9nem4.png"><br><br> 当调用闭包<b><font color="#0000FF">changeAspectRatio？（）时，</font></b>如果获取错误的数据，则使用<b><font color="#0000FF">Optional</font></b>链。 现在，对接收错误图像时对某种设置感兴趣的任何人都可以将此关闭设置为特定的设置。 这正是我们在<code>Controller</code>中的<b><font color="#0000FF">cellForItemAt</font></b>方法中执行的操作： <br><br><img src="https://habrastorage.org/webt/uv/ee/mi/uveemimakh506que35eaasanjbi.png"><br><br> 详细信息可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这里</a>找到。 <br><br> 要显示具有正确的<b><font color="#0000FF">AspectRatio的</font></b>图像，请<b><font color="#0000FF">使用</font></b> <b><font color="#0000FF">UICollectionViewDelegateFlowLayout</font></b>委托的<b><font color="#0000FF">sizeForItemAt</font></b>方法： <br><br><img src="https://habrastorage.org/webt/ys/v7/nz/ysv7nzh7rus7hnowtqyocbevwai.png"><br><br> 除了<code>Collection View</code>图像<code>Collection View</code> ，在我们的<code>UI</code>我们还在导航面板上放置了一个<code>Bar Button</code> ，并带有一个包含“垃圾箱”作为<b><font color="#0000FF">子视图</font></b>的自定义<b><font color="#0000FF">GarbageView</font></b>图像： <br><br><img src="https://habrastorage.org/webt/1h/eo/uu/1heouudwoicj6qyjrckscada9ug.png"><br><br> 在此图中，为<b><font color="#0000FF">GarbageView</font></b>本身和带有“垃圾箱”图像（实际上是透明背景）的<b><font color="#0000FF">UIButton</font></b>按钮的背景色进行了特殊更改，以便您看到将Gallery图像“转储”到“垃圾箱”中的用户。当“掉落” <b>掉落</b>时，回旋余地远不只是垃圾桶图标。 <br>  <b><font color="#0000FF">GarbageView</font></b>类<b><font color="#0000FF">具有</font></b>两个初始化程序，并且都使用<b><font color="#0000FF">setup（）</font></b>方法： <br><br><img src="https://habrastorage.org/webt/xj/_t/es/xj_tesvqnjlk9yxbxnrvrvc_6w8.png"><br><br> 在<b><font color="#0000FF">setup（）</font></b>方法中，我还将<b><font color="#0000FF">myButton</font></b>作为<b>子视图</b>添加到“垃圾桶”的图像中，该图像取自<code>Bar Button</code>的标准<code>Bar Button</code> ： <br><br><img src="https://habrastorage.org/webt/if/s5/3c/ifs53cvfeaggqwtrlshju1g5qwc.png"><br><br> 我为<b><font color="#0000FF">GarbageView</font></b>设置了透明背景： <br><br><img src="https://habrastorage.org/webt/g_/9y/af/g_9yafe1tu_pz4vx6_wan3tarv0.png"><br><br> 垃圾箱的大小及其位置将在<b><font color="#0000FF">UIView</font></b>类的<b><font color="#0000FF">layoutSubviews（）</font></b>方法中确定，具体取决于给定<b><font color="#0000FF">UIView</font></b>的<b><font color="#0000FF">范围</font></b> ： <br><br><img src="https://habrastorage.org/webt/zf/ll/jb/zflljbnvhfenkfx0o2ge8iy2q2k.png"><br><br> 这是“图库”演示应用程序的初始版本，位于<b><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Github</a></code></b>的<u><code>ImageGallery_beginning</code></u>文件夹中。 如果您运行此版本的“图库”应用程序，您将看到该应用程序处理测试数据的结果，我们随后将删除这些数据并专门在“外部”填写“图库”： <br><br><img src="https://habrastorage.org/webt/w9/jn/y4/w9jny4yxwtmeemq8cqkqhbirvoy.png"><br><br> 在我们的应用程序中实现<code>Drag &amp; Drop</code>机制的计划如下： <br><br><ol><li> 首先，我们将使“ <code>Collection View</code> “拖动” <b><font color="#0000FF">UIImage</font></b>图像<code>Collection View</code>能力，无论是在内部还是外部， </li><li> 然后我们将教我们的“ <code>Collection View</code>图像集合接受从<b><font color="#0000FF">UIImage</font></b>外部或本地进行“拖动” <code>Drag</code> ， </li><li> 我们还将通过垃圾桶按钮教我们的<b><font color="#0000FF">GarbageView</font></b> ，以接受<b><font color="#0000FF">从</font></b>本地“ <code>Collection View</code> <b><font color="#0000FF">夹</font></b> <code>Collection View</code>拖动的<b><font color="#0000FF">UIImage</font></b>图像并将其从“ <code>Collection View</code> <b><font color="#0000FF">夹</font></b> <code>Collection View</code>删除 </li></ol><br><br> 如果转到本教程的最后并完成所有必要的代码更改，您将收到“ Image Gallery”演示应用程序的最终版本，其中已实现了<code>Drag &amp; Drop</code>机制。 它位于<b><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Github</a></code></b>上的<u><code>ImageGallery_finished</code></u>文件夹中。 <br><br>  <code>Collection View</code> <code>Drag &amp; Drop</code>机制的性能由两个新的委托提供。 <br> 第<u>一个委托的</u>方法<u><b><font color="#0000FF">dragDelegate</font></b>被</u>配置为初始化和自定义拖放<code>Drags</code> 。 <br> 第二个委托<b><font color="#0000FF">dropDelegate</font></b>的方法完成<b><font color="#0000FF">Drags</font></b>的拖放，并且基本上在重置<code>Drop</code>以及其他类似内容时提供数据<code>Data transfer</code>和自定义动画设置。 <br><br> 重要的是要注意，这两个协议都是完全独立的。 如果只需要“拖动” <code>Drag</code>或仅“拖放” <code>Drop</code> ，则可以使用一个或另一个协议，但是可以同时使用这两个协议，同时<code>Drag</code> “拖放”和“放置” <code>Drop</code> ，这会打开其他功能<code>Drag &amp; Drop</code>机制可以在“ <code>Collection View</code>对项目进行重新排序。 <br><br><h1> 从<code>Collection View</code> <code>Drag</code>元素 </h1><br> 实施<code>Drag</code>协议非常简单，首先应该将<b><font color="#0000FF">self</font></b>设置为<b><font color="#0000FF">dragDelegate</font></b>委托： <br><br><img src="https://habrastorage.org/webt/mt/jw/dq/mtjwdqjahnvyzwjd0hz9cra47mg.png"><br><br> 而且，当然，在<b><font color="#0000FF">ImageGalleryCollectionViewController</font></b>类的顶部<b><font color="#0000FF">，</font></b>您应该说“是”，我们实现了<b><font color="#0000FF">UICollectionViewDragDelegate</font></b>协议： <br><br><img src="https://habrastorage.org/webt/ie/ue/xv/ieuexvbtxfan-uouzv4cvxpjw20.png"><br><br> 一旦执行此操作，编译器便开始“抱怨”，单击红色圆圈，并询问：“是否要添加<b><font color="#0000FF">UICollectionViewDragDelegate</font></b>协议的必需方法？” <br> 我回答：“我当然要！” 然后单击“ <code>Fix</code>按钮： <br><br><img src="https://habrastorage.org/webt/6d/24/it/6d24itltj_buh2uwe3fbgkh8my8.png"><br><br>  <b><font color="#0000FF">UICollectionViewDragDelegate</font></b>协议唯一需要的方法是<b><font color="#0000FF">itemsForBeginning</font></b>方法，它将告诉<code>Drag</code>系统我们“拖放”。 当用户开始“拖动”（ <code>Dragging</code> ）集合<b><font color="#0000FF">单元</font></b>格中的<b><font color="#0000FF">单元格</font></b>时，将调用<b><font color="#0000FF">itemsForBeginning</font></b>方法。 <br><br> 请注意，在此方法中， <code>Collection View</code>集合添加了<b><font color="#0000FF">indexPath</font></b> 。 这将告诉我们集合中的哪个元素，哪个<b><font color="#0000FF">indexPath</font></b> ，我们将“拖放”。 对于我们来说，这确实非常方便，因为它是负责使用<b><font color="#0000FF">session</font></b>和<b><font color="#0000FF">indexPath</font></b>参数<b><font color="#0000FF">确定</font></b>如何处理<code>Drag</code> 。 <br><br> 如果返回“ <b><font color="#0000FF">draggable</font></b> ”元素的数组<b><font color="#0000FF">[UIDragItems]，</font></b> <code>Drag</code>初始化<code>Drag</code>的“拖动”；如果返回空数组<b><font color="#0000FF">[]</font></b> ， <code>Drag</code>忽略<code>Drag</code>的“拖动”。 <br><br> 我将使用<b><font color="#0000FF">indexPath</font></b>参数创建一个小的<b><font color="#0000FF">私有</font></b> <b><font color="#0000FF">dragItems函数（位于：indexPath）</font></b> 。 它返回我们<b><font color="#0000FF">需要</font></b>的数组<b><font color="#0000FF">[UIDragItem]</font></b> 。 <br><br><img src="https://habrastorage.org/webt/_y/iv/86/_yiv869sqaamn_ytg22fg89iez0.png"><br><br> 拖放式<b><font color="#0000FF">UIDragItem是什么样的</font></b> ？ <br> 他只有一件非常重要的东西叫做<b><font color="#0000FF">itemProvider</font></b> 。  <b><font color="#0000FF">itemProvider</font></b>只是可以提供将被拖动的数据的东西。 <br><br> 您有权问：“对根本没有数据的<b><font color="#0000FF">UIDragItem</font></b>元素进行“拖放”怎么样？” 例如，您要拖动的项目可能没有数据，因为创建此数据是一项昂贵的操作。 这可能是图像<b><font color="#0000FF">图像</font></b>或需要从Internet下载数据的东西。 很棒的事情是<code>Drag &amp; Drop</code>操作是完全异步的。 当您开始拖放<code>Drag</code> ，它实际上是一个非常轻巧的对象（ <code>lift preview</code> ），将其拖动到任何地方，在此“拖动”过程中什么也没有发生。 但是，一旦您将对象“拖放”到某个地方，然后成为<b><font color="#0000FF">itemProvider</font></b> ，它实际上必须为“拖放”和“抛出”的对象提供真实数据，即使它需要一定的时间。 <br><br> 幸运的是，有许多内置的<b><font color="#0000FF">itemProviders</font></b> 。 这些是<code>iOS</code>中已经存在的类，它们是<b><font color="#0000FF">itemPoviders</font></b> ，例如<code>NSString</code> ，它允许您拖放没有字体的文本。 当然，这是一个<b><font color="#0000FF">UIImage</font></b>图像。 您可以选择并拖放<b><font color="#0000FF">UIImages</font></b>图像。  <b><font color="#0000FF">NSURL</font></b>类，这绝对是很棒的。 您可以转到网页，选择<code>URL</code>然后将其“拖放”到所需位置。 这可以是文章的链接，也可以是图像的<code>URL</code> ，就像在我们的演示中一样。 这些是地址簿中的<b><font color="#0000FF">UIColor</font></b> ， <b><font color="#0000FF">MKMapItem</font></b>地图<b><font color="#0000FF">元素</font></b> ， <b><font color="#0000FF">CNContact</font></b>联系人的颜色类，您可以选择并拖动很多东西。 它们都是<b><font color="#0000FF">itemProviders</font></b> 。 <br><br> 我们将“拖放” <b><font color="#0000FF">UIImage</font></b>图像。 它位于带有<b><font color="#0000FF">indexPath</font></b>的“ <code>Collection View</code>单元格中，它可以帮助我选择该单元<b><font color="#0000FF">格</font></b> ，从中获取<code>Outlet</code> <b><font color="#0000FF">imageView</font></b>并获取其<b><font color="#0000FF">图像</font></b> 。 <br><br> 让我们用几行代码来表达这个想法。 <br> 首先，我向<code>Collection View</code>请求有关与此<b><font color="#0000FF">indexPath</font></b>对应的<b><font color="#0000FF">item</font></b>元素的<b><font color="#0000FF">单元格</font></b>的<b><font color="#0000FF">信息</font></b> 。 <br><br><img src="https://habrastorage.org/webt/ho/zi/gp/hozigp41-y0-3cfa525umwojyu4.png"><br><br>  <code>Collection View</code>的<b><font color="#0000FF">cellForItem（位于IndexPath）方法</font></b>仅适用于可见的单元格，但是，在我们的情况下当然可以使用，因为我在屏幕上“拖放”了<code>Drag</code>集合元素，并且它是可见的。 <br><br> 因此，我得到了一个“可拖动”的<b><font color="#0000FF">细胞</font></b> 。 <br> 接下来，我使用<b><font color="#0000FF">as</font></b>运算符<b><font color="#0000FF">？</font></b> 到此单元格，以便它具有我的自定义<code>subclass</code>的TYPE。 如果这可行，那么我将获得一个<code>Outlet</code> <b><font color="#0000FF">imageView</font></b> ，从中获取其图像<b><font color="#0000FF">image</font></b> 。 我只是“捕获”了该<b><font color="#0000FF">indexPath</font></b>的图像。 <br><br> 现在，我有了一个图像<b><font color="#0000FF">图像</font></b> ，我所要做的就是使用结果图像<b><font color="#0000FF">图像</font></b>作为<b><font color="#0000FF">itemProvider</font></b>创建这些<b><font color="#0000FF">UIDragItems</font></b>之一， <b><font color="#0000FF">即为</font></b>我们提供数据的东西。 <br> 我可以使用<b><font color="#0000FF">UIDragItem</font></b>构造函数创建<b><font color="#0000FF">dragItem</font></b> ，该构造函数将<b><font color="#0000FF">itemProvider</font></b>作为参数： <br><br><img src="https://habrastorage.org/webt/to/zb/gt/tozbgtxocfrgoaqofvn9jgf9yeo.png"><br><br> 然后，我们也使用<b><font color="#0000FF">NSItemProvider</font></b>构造函数为图像创建一个<b><font color="#0000FF">itemProvider</font></b> 。  <b><font color="#0000FF">NSItemProvider</font></b>有多个构造<b><font color="#0000FF">函数</font></b> ，但是其中有一个非常<b><font color="#0000FF">不错的</font></b>构造函数<b><font color="#0000FF">-NSItemProvider（对象：NSItemProviderWriting）</font></b> ： <br><br><img src="https://habrastorage.org/webt/ey/21/cq/ey21cq0iq5riml7pfrye4gcnmi8.png"><br><br> 您只需将对象<b><font color="#0000FF">对象提供给</font></b>此<b><font color="#0000FF">NSItemProvider</font></b>构造函数，它就知道如何使<b><font color="#0000FF">itemProvider</font></b>成为对象。 作为这样的<b><font color="#0000FF">对象，</font></b>我给图像提供了从单元<b><font color="#0000FF">格</font></b>接收到的<b><font color="#0000FF">图像</font></b> ，并获得了<b><font color="#0000FF">UIImage的</font></b> <b><font color="#0000FF">itemProvider</font></b> 。 <br> 仅此而已。 我们创建了<b><font color="#0000FF">dragItem</font></b> ，并将其作为具有一个元素的数组返回。 <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但在此之前我回</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我打算做一两件事，即设置变量</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，等于产生的画面</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><img src="https://habrastorage.org/webt/sh/h0/cz/shh0czt4sxjd7ienvsl2slz8yju.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是什么意思？</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本地（即在应用程序内部）</font><font style="vertical-align: inherit;">执行“拖放” </font><font style="vertical-align: inherit;">，则无需</font><font style="vertical-align: inherit;">通过异步数据检索来遍历</font><font style="vertical-align: inherit;">与</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemProvider</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相关联的所有代码</font><font style="vertical-align: inherit;">。您不需要这样做，只需要使用</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使用它即可。这是一种带有局部“拖放”的“短路” </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们编写的代码在拖放时将起作用</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合之外的</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他应用程序，但是如果</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本地</font><font style="vertical-align: inherit;">拖放</font><font style="vertical-align: inherit;">，则可以使用</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。接下来，我返回一个包含</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素的数组</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顺便说一句，如果由于某种原因我无法获得</font><font style="vertical-align: inherit;">该单元</font><b><font color="#0000FF"><font style="vertical-align: inherit;">格</font></font></b><font style="vertical-align: inherit;">的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则返回一个空数组</font><b><font color="#0000FF"><font style="vertical-align: inherit;">[]</font></font></b><font style="vertical-align: inherit;">，这意味着</font><font style="vertical-align: inherit;">取消</font><font style="vertical-align: inherit;">了“拖放” </font><font style="vertical-align: inherit;">操作。</font><font style="vertical-align: inherit;">除了本地对象</font><b><font color="#0000FF"><font style="vertical-align: inherit;">localObject</font></font></b><font style="vertical-align: inherit;">，你能记住的地方背景</font><b><font color="#0000FF"><font style="vertical-align: inherit;">localContext</font></font></b><font style="vertical-align: inherit;">我们的</font><font style="vertical-align: inherit;">会话</font><b><font color="#0000FF"><font style="vertical-align: inherit;">的会话</font></font></b><font style="vertical-align: inherit;">。在我们的例子中，它将是一个collectionView </font><b><font color="#0000FF"><font style="vertical-align: inherit;">集合</font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>Drag</code><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/4b/uk/o3/4buko3fve2swk7wr7d_oy5sflma.png"><br><br><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>Drag</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是对我们有用算账：</font></font><br><br><img src="https://habrastorage.org/webt/o_/gi/tk/o_gitkbwnnbcevnxwcwm6obckwk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有“拖放” </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你可以增加更多项目</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的项目</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个“拖放”，只是做姿态</font></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水龙头</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上他们。因此，您可以</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一次</font><font style="vertical-align: inherit;">拖放</font><font style="vertical-align: inherit;">许多项目。而且，这很容易通过另一个委托</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法UICollectionViewDragDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来实现，该</font><b><font color="#0000FF"><font style="vertical-align: inherit;">方法</font></font></b><font style="vertical-align: inherit;">与</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForestegingning</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法非常相似</font><font style="vertical-align: inherit;">，该方法名为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForAddingTo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForAddingTo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">看起来与</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForeginning</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">完全相同，并返回完全相同的东西，因为它还为我们提供了</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户在“拖放”过程中“轻拍”的内容</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我只需</font><font style="vertical-align: inherit;">要从用户“轻拍”的单元格中</font><font style="vertical-align: inherit;">获取</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后将其返回即可。</font><font style="vertical-align: inherit;">从</font><b><font color="#0000FF"><font style="vertical-align: inherit;">itemsForAddingTo</font></font></b><font style="vertical-align: inherit;">方法</font></font><br><br><img src="https://habrastorage.org/webt/u-/hc/9d/u-hc9dnk3001qhkra-et6oycphi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回一个空数组</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[]</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会导致</font><font style="vertical-align: inherit;">按常规方式解释</font><b><font color="#FF00FF"><font style="vertical-align: inherit;">点击</font></font></b><font style="vertical-align: inherit;">手势</font><font style="vertical-align: inherit;">，即选择此单元</font><b><font color="#0000FF"><font style="vertical-align: inherit;">格cell</font></font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这就是拖放所需要的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们启动该应用程序。</font><font style="vertical-align: inherit;">我选择“ Venice”图像，将其按住一会儿然后开始移动…… </font><font style="vertical-align: inherit;">我们真的可以将此图像拖到应用程序中</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><code>Drag</code><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/p7/ne/9z/p7ne9zdwnirsf2uxjogvflrqwao.png"><br><br><font style="vertical-align: inherit;"></font><code>Photos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为您在“可拖动”图像的左上角看到绿色加号“ +”。</font><font style="vertical-align: inherit;">我可以进行手势</font></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自来水</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从收集另一个图像“Artika”上</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... </font></font><br><br><img src="https://habrastorage.org/webt/cg/sj/om/cgsjomxtwxyzqxg-wxvqxz4huqi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...现在我们可以将两个图像扔到应用</font></font><code>Photos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/bk/xk/ud/bkxkud6ggdorw2d1yayjmatnsf4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于应用程序</font></font><code>Photos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经内置的机制</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，一切正常，它的凉爽。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，将</font><font style="vertical-align: inherit;">Gallery图像</font><font style="vertical-align: inherit;">“拖动” </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和“转储” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到其他应用程序</font><font style="vertical-align: inherit;">对我来说</font><font style="vertical-align: inherit;">是有效的，除了将图像</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为数组</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[UIDragItem]</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交付外，我在我的应用程序中不必做太多</font><b><font color="#0000FF"><font style="vertical-align: inherit;">事情</font></font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是该机制的许多重要功能之一。</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -使其在两个方向上均可轻松实现。 </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font><font style="vertical-align: inherit;">重置</font><font style="vertical-align: inherit;">为收藏</font></font><code>Collection View</code> </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们需要</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为我的收藏集</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">做</font><font style="vertical-align: inherit;">一部分，</font><font style="vertical-align: inherit;">以便我们可以“倾销” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该收藏集内的所有“拖曳”图像。</font><font style="vertical-align: inherit;">“可拖动”图像可以从外部“出现”，也可以直接在此集合内部“出现”。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要做到这一点，我们做的做委托同样的事情</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即让自己，</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自我</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，委托</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dropDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在方法</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的viewDidLoad中</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/5q/wv/mf/5qwvmfjuyh74sfxzwcw7_0gikec.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再一次，我们要攀登到我们班的顶部</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGalleryCollectionViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和验证协议实现</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/wc/ww/7p/wcww7pgfia3xxwe63teews1e9de.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦添加了新协议，编译器便再次开始“抱怨”我们没有实现该协议。我们单击按钮</font></font><code>Fix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该协议所需的方法出现在我们面前。在这种情况下，我们被告知必须执行</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/ll/9t/k4/ll9tk4goht7nfa-gnifnq8iaoto.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须执行此操作，否则将不会发生“重置” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。实际上，我将</font><font style="vertical-align: inherit;">最后</font><font style="vertical-align: inherit;">实现</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">，因为</font></font><code>Apple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于该</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部件</font><font style="vertical-align: inherit;">，还需要实现</font><font style="vertical-align: inherit;">另外两个强烈推荐的</font><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">。这是</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dropSessionDidUpdate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/jd/ce/ve/jdcevehobhr1k7wwvc1iaem-w80.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们实现这两种方法，那么当我们将图像从OUTSIDE拖动到集合中时</font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">我们会得到一个小的绿色加号“ +” </font><font style="vertical-align: inherit;">，此外，它们不会尝试转储我们不了解</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。您要使用的版本的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">用于收集</font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但是该方法</font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看起来与常规</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的相似方法相同</font><font style="vertical-align: inherit;">，那里没有</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们只需要返回</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session.canLoadObjects（ofClass：UIImage.self）</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这意味着我接受这个分类的对象的“重置” PAS在我的收藏</font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/0j/tz/ze/0jtzzen649jj7z58-3tiq_ehrvs.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但这还不足以将</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font><font style="vertical-align: inherit;">“转储” </font><font style="vertical-align: inherit;">到我的收藏中</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果在</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合内部发生图像</font><font style="vertical-align: inherit;">的“转储”，则</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当用户</font><font style="vertical-align: inherit;">使用该机制</font><font style="vertical-align: inherit;">重新组织自己的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目时</font></font></font></b><font style="vertical-align: inherit;"></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，仅一个</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像就</font><b><font color="#0000FF"><font style="vertical-align: inherit;">足够了</font></font></b><font style="vertical-align: inherit;">，并且</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法的实现</font><font style="vertical-align: inherit;">将类似于上面。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，如果“复位” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的图像来自外部的，我们必须处理只有“拖放” </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这表示图像</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个形象，所以我们不打算只保留图像本身</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在模型中。在这种情况下，我会回到</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真正</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的方法</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有当两个条件下进行的一对夫妇</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;&amp; session.canLoadObjects（ofClass：UIImage.self）：session.canLoadObjects（NSURL.self ofClass） </font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/yj/dt/qn/yjdtqnmmxq0olgilbz1ifa5mdt8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我已经离开，以确定我是否涉及“复位”外面或里面。我将使用计算的常量</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isSelf</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行此操作</font><font style="vertical-align: inherit;">，为此，我可以在</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话中</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用诸如</font><font style="vertical-align: inherit;">本地</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localDragSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样的东西</font><font style="vertical-align: inherit;">。该本地</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话又具有本地上下文</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您还记得，我们会在方法中设置此本地上下文</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemsForVeginning</font></font></font></b> <code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委托</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UICollectionViewDragDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/o_/gi/tk/o_gitkbwnnbcevnxwcwm6obckwk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我要去游览当地的情况</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我的收藏，以平等</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的CollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。是的，</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localContext的</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TYPE</font><font style="vertical-align: inherit;">将是</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Any</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我需要</font><font style="vertical-align: inherit;">使用</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> as</font></font></b><font style="vertical-align: inherit;">运算符</font><font style="vertical-align: inherit;">对TYPE</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Any</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行</font><font style="vertical-align: inherit;">强制转换</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">？ UICollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/kc/zk/nt/kczknt6xiau08k5d06xu40akoyu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果本地上下文</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（session.localDragSession？.LocalContext as？UICollectionView）</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于我的collectionView</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则计算出的变量</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> isSelf</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> true</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我的收藏夹中有一个本地“重置”按钮。如果违反了这种相等性，那么我们将在</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外部</font><font style="vertical-align: inherit;">进行“重置” </font><font style="vertical-align: inherit;">。</font><b><font color="#0000FF"><font style="vertical-align: inherit;">canHandle</font></font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">报告我们只能将这种“拖放”处理</font><font style="vertical-align: inherit;">到我们的集合中</font><font style="vertical-align: inherit;">。否则，进一步讲“倾销”是没有意义的</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果我们继续以“复位” </font><font style="vertical-align: inherit;">，它仍然是最多的时刻，用户都会让你的手指离开屏幕会有一个真正的“复位” </font><font style="vertical-align: inherit;">，我们必须报告</font><font style="vertical-align: inherit;">使用该方法</font><b><font color="#0000FF"><font style="vertical-align: inherit;">dropSessionDidUpdate</font></font></b><font style="vertical-align: inherit;">委托</font><b><font color="#0000FF"><font style="vertical-align: inherit;">UICollectionViewDropDelegate</font></font></b><font style="vertical-align: inherit;">我们的报价</font><b><font color="#0000FF"><font style="vertical-align: inherit;">UIDropProposal</font></font></b><font style="vertical-align: inherit;">实现复位</font><font style="vertical-align: inherit;">。</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>Drag</code><font style="vertical-align: inherit;"></font><code>Collection View</code><font style="vertical-align: inherit;"></font><code>Drop</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>Drop</code><font style="vertical-align: inherit;"></font><code>Drop</code><font style="vertical-align: inherit;"></font><code>iOS</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>Drop</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此方法中，我们必须返回一个</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">句子，</font><font style="vertical-align: inherit;">该</font><font style="vertical-align: inherit;">句子</font><font style="vertical-align: inherit;">的</font><b><font color="#0000FF"><font style="vertical-align: inherit;">operation</font></font></b><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">可以具有</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.copy</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.move</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.cancel</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.forbidden值</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这些都是我们在处理常规</font><b><font color="#0000FF"><font style="vertical-align: inherit;">UIView</font></font></b><font style="vertical-align: inherit;">时通常所具有的所有可能性</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但收集</font><font style="vertical-align: inherit;">更进一步，并提供返回专门优惠</font><b><font color="#0000FF"><font style="vertical-align: inherit;">UICollectionViewDropProposal</font></font></b><font style="vertical-align: inherit;">，这是一种</font><font style="vertical-align: inherit;">类</font><b><font color="#0000FF"><font style="vertical-align: inherit;">UIDropProposal</font></font></b><font style="vertical-align: inherit;">，并允许除手术</font><b><font color="#0000FF"><font style="vertical-align: inherit;">操作</font></font></b><font style="vertical-align: inherit;">指定的附加参数</font><b><font color="#0000FF"><font style="vertical-align: inherit;">意图</font></font></b><font style="vertical-align: inherit;">的收集</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">参量</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>Collection View</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>subclass</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>Collection View</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意向</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报告收集</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的，我们是否要放置在现有的细胞内“一次性”细胞</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的细胞</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们要添加一个新的电池</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单元</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .Vidite区别？就集合而言，</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们必须传达我们的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意图</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的例子中，我们总是要添加一个新的单元格，因此您将看到我们的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intent</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数等于</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UICollectionViewDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择第二个构造</font><b><font color="#0000FF"><font style="vertical-align: inherit;">函数</font></font></b><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/ab/vh/-p/abvh-pb04qje37u4jjgveja3lgu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的例子中，我们总是要添加一个新的单元格，并且</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intent</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">将使用值</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .insertAtDestinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为对</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.insertIntoDestinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><img src="https://habrastorage.org/webt/yg/t0/xi/ygt0xirvwaucl9zvuvuxvvil2cu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我再次使用计算出的常数</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> isSelf</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果它是一个</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自我</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重组，那么我将移动</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .move</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，否则将复制</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .copy</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。在这两种情况下，我们都使用</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .insertAtDestinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即插入新的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单元格</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我还没有实现</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">，但让我们看一下集合可以</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用我们提供给它的这小部分信息</font><font style="vertical-align: inherit;">来做</font><font style="vertical-align: inherit;">什么。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我从</font></font><code>Safari</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索引擎中</font><font style="vertical-align: inherit;">拖动图片</font></font><code>Google</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且该图片的顶部会出现一个绿色的“ +”号，表示我们的图片库不仅可以接受和复制此图片</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，还</font><font style="vertical-align: inherit;">可以在图片</font><font style="vertical-align: inherit;">集中提供一个位置</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/ia/gy/gv/iagygvechjnwsm-tfvduwi0pc1o.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我可以在</font></font><code>Safari</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和中</font><font style="vertical-align: inherit;">单击几张图片</font><font style="vertical-align: inherit;">已经有3张“拖曳”的图像：</font></font><br><br><img src="https://habrastorage.org/webt/kd/ca/7s/kdca7sflzfrbbsbtmnk8_zbueqm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，如果我放开手指并“放下” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些图像，它们将不会被放置在我们的Gallery中，而只是返回到以前的位置，因为我们尚未实现</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">。</font></font><br><br><img src="https://habrastorage.org/webt/5v/e4/me/5ve4me_unk6t-azl6fhatljzgxs.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可能会看到该收藏集</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经知道我想要做什么。</font><font style="vertical-align: inherit;">对于该机制而言</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，收集</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绝对是一件绝妙的事情。</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，她为此具有非常强大的功能。通过编写4行代码，我们几乎没有碰过她，而她在“重置”的认识上已经走了很远</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们回到代码并实现</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">。</font></font><br><br><img src="https://habrastorage.org/webt/i0/cc/es/i0ccescpyvub0pclhjyzcbdcu7o.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种方法中，我们将无法使用4行代码，因为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">稍微复杂一点，但不会太多。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当一个“复位” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则该方法</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要更新我们的模型，这是图像的画廊</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组合图像</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们需要更新我们的视觉收集</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的CollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们有两种不同的“重置”方案</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的collectionView </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合中</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有一个“重置” </font><font style="vertical-align: inherit;">，那么我必须</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在一个新位置</font><font style="vertical-align: inherit;">“重置” </font><font style="vertical-align: inherit;">集合元素并将其从旧位置删除，因为在这种情况下，我将移动（</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.move</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）这个集合元素。这是一项琐碎的任务。</font><font style="vertical-align: inherit;">来自另一个应用程序</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的“重置” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则我们必须使用</font><font style="vertical-align: inherit;">“已拖动” </font><b><font color="#0000FF"><font style="vertical-align: inherit;">item</font></font></b><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">itemProvider</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">来选择数据。</font><font style="vertical-align: inherit;">当我们</font><font style="vertical-align: inherit;">在collectionView </font><b><font color="#0000FF"><font style="vertical-align: inherit;">集合中</font></font></b><font style="vertical-align: inherit;">执行“重置” </font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">，该集合为我们提供了一个</font><b><font color="#0000FF"><font style="vertical-align: inherit;">协调器</font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>Drop</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。首先，我们报道了协调</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协调</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “-destination”，“复位” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这就是我们将“复位”。</font></font><br><br><img src="https://habrastorage.org/webt/mp/mt/wk/mpmtwkebx7beyw5ge72gt19xt7k.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为您可以将“废弃”图像拖到集合</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中不在某些现有</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单元格</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之间的位置</font><font style="vertical-align: inherit;">，因此很可能为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果出现这种情况，那么我创建</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与第0个元素</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第0部分</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">称为部分</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><img src="https://habrastorage.org/webt/qd/ei/me/qdeimejhoj1v0pkgml2xtog1jke.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我可以选择其他任何</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但</font><font style="vertical-align: inherit;">默认情况下将使用</font><font style="vertical-align: inherit;">此</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们知道将在哪里执行“重置” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我们必须仔细阅读</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协调器</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供的</font><font style="vertical-align: inherit;">所有“可重置” </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协调器</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此列表中的</font><font style="vertical-align: inherit;">每个</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都有一个</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TYPE </font><font style="vertical-align: inherit;">，可以为我们提供非常有趣的信息。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，如果我可以</font><font style="vertical-align: inherit;">从</font><b><font color="#0000FF"><font style="vertical-align: inherit;">item.sourceIndexPath</font></font></b><font style="vertical-align: inherit;">获取</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么我将确定该“拖放” </font><font style="vertical-align: inherit;">是从自身</font><b><font color="#0000FF"><font style="vertical-align: inherit;">self进行的。</font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>Drag</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且拖动的来源</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等于</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的集合项</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">在这种情况下，</font></font><br><br><img src="https://habrastorage.org/webt/y2/3d/2u/y23d2u0pmf1pnasfw2khu9htji4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我什至不必查看</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来发现此“拖放”是在collectionView </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合内</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成的</font><font style="vertical-align: inherit;">。</font></font>哇！ <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我知道了源</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和“目标” </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b> <code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，任务变得很简单。我需要做的就是更新Model，以便交换源和“目标”，然后更新collectionView </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在该</font><b><font color="#0000FF"><font style="vertical-align: inherit;">集合</font></font></b><font style="vertical-align: inherit;">中，您需要使用</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除集合项，</font><font style="vertical-align: inherit;">并通过</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其添加到集合中</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的本地情况是最简单的，因为在这种情况下，该机制</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不仅适用于同一应用程序，而且适用于同一collectionView </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且我可以使用协调器</font><b><font color="#0000FF"><font style="vertical-align: inherit;">协调</font></font></b><font style="vertical-align: inherit;">器获取所有必要的信息。</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。让我们在最简单的本地案例中实现它：</font></font><br><br><img src="https://habrastorage.org/webt/1m/uu/4r/1muu4rnsxmehwuyybyspei14bvo.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的案例中，我什至不需要</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我在创建</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时就“隐藏”了</font><font style="vertical-align: inherit;">它，现在可以从</font><b><font color="#0000FF"><font style="vertical-align: inherit;">item.localObject</font></font></b><font style="vertical-align: inherit;">形式的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font><font style="vertical-align: inherit;">中的“ </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragated</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font><b><font color="#0000FF"><font style="vertical-align: inherit;">项目</font></font></b><font style="vertical-align: inherit;">中</font><b><font color="#0000FF"><font style="vertical-align: inherit;">借用</font></font></b><font style="vertical-align: inherit;">。当将</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font><font style="vertical-align: inherit;">“转储” </font><font style="vertical-align: inherit;">到同一应用程序中但不是同一collectionView </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的“垃圾箱</font><font style="vertical-align: inherit;">”中时，我们将需要它</font><font style="vertical-align: inherit;">。</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对我来说，两个</font><b><font color="#0000FF"><font style="vertical-align: inherit;">IndexPath就</font></font></b><font style="vertical-align: inherit;">足够了</font><font style="vertical-align: inherit;">：源</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sourceIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和“目的地” </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我先得到信息</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于Image中来自旧位置的图像的</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> imageInfo</font></font></b><font style="vertical-align: inherit;">，将其从那里删除。然后插入阵列</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的我的模型</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的imageinfo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的图像与一个新的索引</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> destinationIndexPath.item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这就是我更新模型的方式：</font></font><br><br><img src="https://habrastorage.org/webt/pk/bk/ny/pkbknyitrog4kq40dcs7sfpxk0g.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我必须更新collectionView</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本身</font><font style="vertical-align: inherit;">。非常重要的一点是，我不想</font><font style="vertical-align: inherit;">在“拖放”过程的中间</font><font style="vertical-align: inherit;">用</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> reloadData（）</font></font></b><font style="vertical-align: inherit;">重载我的collectionView</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合中的</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有数据</font><font style="vertical-align: inherit;">，因为它会重新安装我们图库的整个“世界”，这很糟糕，请不要这样做。相反，我将整理并插入元素</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>Drag</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个</font><b><font color="#0000FF"><font style="vertical-align: inherit;">项</font></font></b><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/1-/xa/jg/1-xajgm6ru3uwhqh53w4tf7tblu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我删除了</font><font style="vertical-align: inherit;">带有</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> sourceIndexPath</font></font></b><font style="vertical-align: inherit;">的collectionView</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">并插入了带有</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> destinationIndexPath</font></font></b><font style="vertical-align: inherit;">的新集合项</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">看起来这段代码很好用，但是实际上，这段代码可以“崩溃”您的应用程序。原因是您对collectionView</font><b><font color="#0000FF"><font style="vertical-align: inherit;">集合</font></font></b><font style="vertical-align: inherit;">进行了无数次更改</font><font style="vertical-align: inherit;">，在这种情况下，更改集合的每个步骤都需要与Model正常同步，在我们的情况下不会发生这种情况，因为我们同时执行两项操作：delete和insert。因此，集合</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> collectionView</font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些时候将与模型处于非同步状态。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是有一种非常不错的解决方法，那就是collectionView </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有一个名为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performBatchUpdates</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的方法</font><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">具有一个闭包（</font></font><code>closure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），并且在此闭包内，我可以放置任意数量的这些</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deleteItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moveItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及我想要的所有东西：</font></font><br><br><img src="https://habrastorage.org/webt/6b/w_/6n/6bw_6nemnuzuv8xowkmmpt4yumw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deleteItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将作为单一操作执行，并且永远不会出现缺少你的模型的同步与集合</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的CollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我们需要做的最后一件事是要求</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协调器</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现“重置”本身并</font><b><font color="#0000FF"><font style="vertical-align: inherit;">为其</font></font></b><font style="vertical-align: inherit;">设置动画</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/7k/qr/1u/7kqr1uatpcgzp8vim6hsf1-o_lo.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦您从屏幕上抬起手指，图像就会移动，所有操作都同时发生：“重置”，图像消失在一个地方，在另一个地方出现。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们尝试将图像库中的测试图像“ Venice”移动到第一行的末尾</font></font><br><br><img src="https://habrastorage.org/webt/gy/k4/ci/gyk4ci8msjogcvzo4hb8iqt2atq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">……并“重置”它：</font></font><br><br><img src="https://habrastorage.org/webt/kb/a0/mv/kba0mvrjzqyf_wf1y8b0j5h27oy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要，将其放置在第一行的末尾。</font></font><br> 万岁！<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一切正常！</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们将不再处理本地情况，即当“重置”元素超出范围时，即来自另一个应用程序。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们在代码</font><font style="vertical-align: inherit;">中针对</font><b><font color="#0000FF"><font style="vertical-align: inherit;">sourceIndexPath</font></font></b><font style="vertical-align: inherit;">编写</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">else</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果没有</font><b><font color="#0000FF"><font style="vertical-align: inherit;">sourceIndexPath</font></font></b><font style="vertical-align: inherit;">，则意味着“ resettable”元素来自OUTSIDE，我们将不得不使用</font><font style="vertical-align: inherit;">resettabletable </font><b><font color="#0000FF"><font style="vertical-align: inherit;">item.dragItem.itemProvider</font></font></b><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">的</font><b><font color="#0000FF"><font style="vertical-align: inherit;">itemProver</font></font></b><font style="vertical-align: inherit;">使用数据传输</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">如果您“拖放” </font><font style="vertical-align: inherit;">OUTSIDE并“拖放” ”</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/wh/-9/gd/wh-9gdfe_e52v_9-wc-mf6o-7co.png"><br><br><font style="vertical-align: inherit;"></font><code>Drag</code><font style="vertical-align: inherit;"></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么此信息是否立即可用？不，您是从“拖曳的”事物中异步选择数据的。但是，如果样本需要10秒钟怎么办？集合现在会做什么</font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">？此外，数据可能无法按照我们要求的顺序到达。要对此进行管理并不容易，</font><font style="vertical-align: inherit;">为此</font></font><code>Apple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提出了</font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一种使用替代品的全新技术</font></font><code>Placeholders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您将一个</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">占位符</font><font style="vertical-align: inherit;">放置在您的集合中</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，该集合</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将为您管理所有这些，因此最终选择数据时，您要做的就是让该占位符</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用其</font><b><font color="#0000FF"><font style="vertical-align: inherit;">placeholderContext</font></font></b><font style="vertical-align: inherit;">上下文。</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并告诉他您已收到信息。然后更新您的Model和上下文</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动地</font><font style="vertical-align: inherit;">将</font><font style="vertical-align: inherit;">其中一个</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单元格</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font><b><font color="#0000FF"><font style="vertical-align: inherit;">占位符</font></font></b><font style="vertical-align: inherit;">交换</font><b><font color="#0000FF"><font style="vertical-align: inherit;">单元</font></font></b><b><font color="#0000FF"><font style="vertical-align: inherit;">格</font></font></b><font style="vertical-align: inherit;">，这与您收到的数据类型相对应。</font><font style="vertical-align: inherit;">我们通过创建一个</font><b><font color="#0000FF"><font style="vertical-align: inherit;">placeholderContext占位符</font></font></b><font style="vertical-align: inherit;">上下文</font><font style="vertical-align: inherit;">来</font><font style="vertical-align: inherit;">执行所有这些操作，该</font><b><font color="#0000FF"><font style="vertical-align: inherit;">占位符</font></font></b><font style="vertical-align: inherit;">上下文</font><font style="vertical-align: inherit;">管理该占位符</font><font style="vertical-align: inherit;">，您可以从协调器</font><b><font color="#0000FF"><font style="vertical-align: inherit;">协调器</font></font></b><font style="vertical-align: inherit;">获得</font><font style="vertical-align: inherit;">该占位符，</font><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">要求您</font><font style="vertical-align: inherit;">将</font><b><font color="#0000FF"><font style="vertical-align: inherit;">item</font></font></b><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">“重置” </font><font style="vertical-align: inherit;">为占位符</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我将在</font><b><font color="#0000FF"><font style="vertical-align: inherit;">placeholderContext占位符</font></font></b><font style="vertical-align: inherit;">上下文中使用初始化程序</font></font><code>Placeholder</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>Placeholder</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>Drop</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>Placeholder</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “抛出” </font><font style="vertical-align: inherit;">到</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropPlaceholder</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/xh/lo/gk/xhlogk8aee_nhrukgwbtq0m8nae.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我要“抛出”的对象</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font><font style="vertical-align: inherit;">循环</font><font style="vertical-align: inherit;">的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font><font style="vertical-align: inherit;">，因为我们可以抛出</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很多</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coordinator.items</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我们一一“扔”他们。所以</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">item.dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是我们“拖放</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”的东西</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。此函数的下一个参数是占位符，我将使用</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UICollectionViewDropPlaceholder</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始值设定项创建它</font><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/hg/yu/jk/hgyujkpqodrfosah0opsrwwc-t0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我需要知道在哪里插入占位符</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以及回收的小区的标识符</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reuseIdentifier</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，很显然，是</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">destinationIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">容纳“拖动”的对象，则在该方法的开始时计算</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDropWith</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在让我们看一下</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reuseIdentifier</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单元</font><b><font color="#0000FF"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;">。你需要决定什么样的细胞类型</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">细胞</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是你的一个占位符</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。协调器</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协调</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">器没有</font><font style="vertical-align: inherit;">用于定位器</font><font style="vertical-align: inherit;">的“预</font><font style="vertical-align: inherit;">打包</font><font style="vertical-align: inherit;">” </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单元格</font></font></font></b><font style="vertical-align: inherit;"></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。必须由您决定这个单元</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。因此，</font><font style="vertical-align: inherit;">从您的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重用单元的</font><b><font color="#0000FF"><font style="vertical-align: inherit;">reuseIdentifiercell</font></font></b><font style="vertical-align: inherit;">的标识符，</font></font><code>storyboard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以便可以将其用作PROTOTYPE。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我将其称为“ DropPlaceholderCell”，但基本上，我可以将其命名为任何名称。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这只是</font><font style="vertical-align: inherit;">我将在我的身上</font><font style="vertical-align: inherit;">用来创建此东西</font><font style="vertical-align: inherit;">的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">String</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font><code>storyboard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回到我们的位置</font></font><code>storyboard</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">为占位符</font><font style="vertical-align: inherit;">创建一个单元</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格</font></font></font></b><font style="vertical-align: inherit;"></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。为此，我们只需要选择一个集合</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并检查它。在第一个字段中，</font></font><code>Items</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我更改</font></font><code>1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><code>2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这立即为我们创建了第二个单元格，它是第一个单元格的精确副本。</font></font><br><br><img src="https://habrastorage.org/webt/df/go/ke/dfgokefx6miugtxs8ee0_jl1zsk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们选择新的单元格</font></font><code>ImageCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将标识符设置为“ </font></font><code>DropPlaceholderCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”，从此处删除所有</font></font><code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素，包括</font></font><code>Image View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为在图像尚未到达时将使用此PROTOTYPE。我们从“对象面板”中添加了一个新的活动指示器，该指示器</font></font><code>Activity Indicator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将旋转，让用户知道我期望一些“重置”数据。同时改变背景颜色</font></font><code>Background</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要明白，从外部图像时，“复位”的作品正是这种电池</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单元</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为原型：</font></font><br><br><img src="https://habrastorage.org/webt/ur/gi/72/urgi728r6j2a1d2z0tf_4k-er1a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了新小区的类型不应该</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageCollectionVewCell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为其中没有图像。我将使该单元格成为普通的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIollectionCiewCellTYPE单元格</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为我们不需要任何</font></font><code>Outlets</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制：</font></font><br><br><img src="https://habrastorage.org/webt/sg/d8/ya/sgd8ya2342bd0lgk9fl172j-8pi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们配置活动指示器</font></font><code>Activity Indicator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使其从一开始就开始动画设置，而我无需在代码中编写任何内容即可启动它。为此，请点击选项</font></font><code>Animating</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：仅</font></font><br><br><img src="https://habrastorage.org/webt/qm/de/hq/qmdehqmwsuzn_dt8fkbjdoclkss.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此而已。因此，我们对该单元进行了所有设置，然后</font></font><code>DropPlaceholderCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回到代码。现在我们</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备好了</font><font style="vertical-align: inherit;">一个好的定位器</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们要做的就是获取数据，当接收到数据时，我们只需要告诉</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关此上下文的信息</font><font style="vertical-align: inherit;">，它将交换占位符</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及带有数据的“本机”单元格，我们将对模型进行更改。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我将“加载”一个对象，该对象将</font><font style="vertical-align: inherit;">使用</font><b><font color="#0000FF"><font style="vertical-align: inherit;">loadObject（ofClass：UIImage.self）方法</font></font></b><font style="vertical-align: inherit;">（单数）</font><font style="vertical-align: inherit;">作为我的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。我使用的代码</font><b><font color="#0000FF"><font style="vertical-align: inherit;">item.dragItem.itemProvider</font></font></b><font style="vertical-align: inherit;">供应商</font><b><font color="#0000FF"><font style="vertical-align: inherit;">itemProvider</font></font></b><font style="vertical-align: inherit;">，这将提供数据元素具有</font><b><font color="#0000FF"><font style="vertical-align: inherit;">项</font></font></b><font style="vertical-align: inherit;">是异步的。显然，如果连接</font><b><font color="#0000FF"><font style="vertical-align: inherit;">iitemProvider</font></font></b><font style="vertical-align: inherit;">，对象“复位” </font><b><font color="#0000FF"><font style="vertical-align: inherit;">的iItem</font></font></b><font style="vertical-align: inherit;">我们得到这个应用程序之外。以下是</font><b><font color="#0000FF"><font style="vertical-align: inherit;">loadObject（ofClass：UIImage.self）方法</font></font></b><font style="vertical-align: inherit;">（单数）：</font><b><font color="#0000FF"><font style="vertical-align: inherit;">不在</font></font></b><font style="vertical-align: inherit;">此特定关闭</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/bv/pl/fj/bvplfjtt-wlffytoqky4jxcbxco.png"><br><br><font style="vertical-align: inherit;"></font><code>main queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。而且，不幸的是，我们不得不切换到</font></font><code>main queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DispatchQueue.main.async {}</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来“捕获”本地</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量中图像的</font><b><font color="#0000FF"><font style="vertical-align: inherit;">长宽比</font></font></b><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们确实引入了两个局部变量</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br><br><img src="https://habrastorage.org/webt/vc/k3/vg/vck3vgqg7grejo8tj2ojbdnfdny.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...，并且在加载图像</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和URL </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">url</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时将“捕获”它们</font><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/jc/ui/yk/jcuiyk3c1zcz4wmkeafkpmkdvqq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果局部变量</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">都不为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将</font><font style="vertical-align: inherit;">使用</font><b><font color="#0000FF"><font style="vertical-align: inherit;">commitInsertion</font></font></b><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">询问</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placeholderontext占位符</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给我们一个机会来改变我们的模型</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagegallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/z6/hm/8w/z6hm8w4jnyrwxgx2g8v9sfnfiuq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个表达式中，我们有</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -它</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入，并改变我们的模型</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagegallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这就是我们所要做的，并且此方法将</font><font style="vertical-align: inherit;">通过调用普通的</font><b><font color="#0000FF"><font style="vertical-align: inherit;">cellForItemAt</font></font></b><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">自动将一个占位符替换为</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单元格</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请注意，</font><b><font color="#0000FF"><font style="vertical-align: inherit;">insertIndexPath</font></font></b><font style="vertical-align: inherit;">与</font><b><font color="#0000FF"><font style="vertical-align: inherit;">destinationIndexPath</font></font></b><font style="vertical-align: inherit;">可能有很大不同</font><font style="vertical-align: inherit;">。</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font>怎么了<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当然，由于数据采样可能要花费10秒，所以这不太可能，但是可能需要10秒。在这段时间内，收藏中</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能发生很多事情。可以添加新的细胞</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的细胞</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，一切都发生得足够快。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始终使用这里</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只有</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">insertionIndexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，更新您的模型。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们如何更新模型？</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将把</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageModel</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入到imageGallery.images数组中</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><b><font color="#0000FF"><font style="vertical-align: inherit;">该数组</font></font></b><font style="vertical-align: inherit;">由</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像的</font><b><font color="#0000FF"><font style="vertical-align: inherit;">长宽比</font></font></b><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">相应</font><b><font color="#0000FF"><font style="vertical-align: inherit;">提供者</font></font></b><font style="vertical-align: inherit;">返回给我们</font><font style="vertical-align: inherit;">的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像URL组成</font><font style="vertical-align: inherit;">。</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将更新我们的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Model </font><font style="vertical-align: inherit;">，而</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commitInsertion</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">将为我们完成其余的工作。您不再需要做任何额外的事情，没有插入，没有删除等等。而且，由于我们处于封闭状态，因此我们需要添加</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自我。</font></font></font></b>  。 <br><br><img src="https://habrastorage.org/webt/rm/ff/nx/rmffnxnhy_1k1ukzub6ni468z6g.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们因为某些原因无法得到长宽比</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的aspectRatio</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IMAGEURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从相应</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的供应商</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可能已经收到错误</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的错误</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而不是</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由供应商</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们必须让他们知道的情况下</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">placeholderContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你需要摧毁这个占位符</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为我们都是一样的，我们不能获取其他数据：</font></font><br><br><img src="https://habrastorage.org/webt/gw/tm/jj/gwtmjjywumpq4o7czavwnrcweay.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要记住的一件事是</font></font><code>URLs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它们来自这样的地方</font></font><code>Google</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；实际上，它们需要进行细微的转换才能“干净”</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为图像。如何解决这个问题可以在此示例应用程序到文件中可以看到</font></font><code>Utilities.swift</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，在接收</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像时，我们使用</font><b><font color="#0000FF"><font style="vertical-align: inherit;">URL</font></font></b><font style="vertical-align: inherit;">类中</font><font style="vertical-align: inherit;">的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageURL</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">这就是您要接受集合中其他内容的全部步骤</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">让我们来看看它的作用。我们同时在多任务模式下启动演示应用程序，</font><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">使用搜索引擎</font><font style="vertical-align: inherit;">。正如</font><font style="vertical-align: inherit;">我们寻找图片中的“黎明»（日出）的主题。在</font><font style="vertical-align: inherit;">已经建立</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/v5/cq/dc/v5cqdcxzqnwybov4eiklwlkt2o8.png"><br><br><font style="vertical-align: inherit;"></font><code>Collection View</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>ImageGallery</code><font style="vertical-align: inherit;"></font><code>Safari</code><font style="vertical-align: inherit;"></font><code>Google</code><font style="vertical-align: inherit;"></font><code>Google</code><font style="vertical-align: inherit;"></font><code>Safari</code><font style="vertical-align: inherit;"></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机制，因此我们可以选择其中一张图像，将其放置很长一段时间，将其稍微移动一下，然后将其拖到我们的图片库中。</font></font><br><br><img src="https://habrastorage.org/webt/au/t9/wk/aut9wky03l29lkgj9g7l1ulifmc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绿色加号“ +”的存在表示我们的应用程序已准备就绪，可以接受第三方图像并将其复制到用户指定位置的集合中。 “重置”图像之后，需要花费一些时间来下载图像，并且此时它可以正常工作</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/ge/e-/n0/gee-n08qnm7zc5ofbgr3e4o8df8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载完成后，“重置”图像将放置在正确的位置，然后</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消失：</font></font><br><br><img src="https://habrastorage.org/webt/m8/rb/nq/m8rbnqvi2x0s3as4w_fzpjpltae.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以继续“重置”图像并将其放置在更多图像的集合：</font></font><br><br><img src="https://habrastorage.org/webt/x8/np/bq/x8npbqpkm9af1_ybkxhw13kjhug.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在“重置”工作之后</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/b2/lq/hb/b2lqhbg6smc2mvvvjp0copbvfmu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果，我们的图像库中充满了新图像：</font></font><br><br><img src="https://habrastorage.org/webt/lf/jl/mq/lfjlmqca5iqv26l0woi-htqldcq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，很显然，我们能够拍照从外面看，我们并不需要测试图像，我们将移除：</font></font><br><br><img src="https://habrastorage.org/webt/bv/0t/az/bv0tazx3cjushm1rkcfalu-m1au.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viewDidLoad中</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就变得很简单：这是我们正在做我们的</font></font><code>Controller</code> <code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委派并添加识别手势</font></font><b><font color="#FF00FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">掐</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中规定每行图像的数量：</font></font><br><br><img src="https://habrastorage.org/webt/ei/fo/1b/eifo1bz0szfk12tuqfseh5fser8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当然我们可以添加缓存图像</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageCache</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/f4/oi/ql/f4oiql_gjnka7racbmkrts7mbja.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将填充</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageCache</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时“复位” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的方法中</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br><br><img src="https://habrastorage.org/webt/xy/hc/bt/xyhcbtodifjiqgd5norskny9cge.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和在用户类“网络”的样品</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageCollectionViewCell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/nk/sl/2s/nksl2sw3dujz-_z7fmp55zixfzi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A中所使用的高速缓存</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageCache</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将播放细胞</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">细胞</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的自定义类的图像画廊</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageCollectionViewCell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/-5/ar/zo/-5arzoeghtoj_ckv-ezxhpu403c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们开始与空集...</font></font><br><br><img src="https://habrastorage.org/webt/rl/bq/vn/rlbqvnpsww27j5xbryp9vlgng1a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...那么“抛”的新形象我们收集...</font></font><br><br><img src="https://habrastorage.org/webt/9j/7o/es/9j7oesf_b-rk-dj-s9ysujlkte0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... prishodit图像加载和</font></font><code>Placeholder</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行...</font></font><br><br><img src="https://habrastorage.org/webt/tg/s7/6t/tgs76tffgkarqkpzhamq97ebvio.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...并在正确的地方的形象出现：</font></font><br><br><img src="https://habrastorage.org/webt/ps/uy/z8/psuyz8apr4zpulpgpl5z-hsegfy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们继续来填补我们的收藏OUTSIDE：</font></font><br><br><img src="https://habrastorage.org/webt/it/ve/_y/itve_yuqqnffh8zyzlpmj_vvske.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prishodit加载图像的</font></font><code>Placeholders</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作品...</font></font><br><br><img src="https://habrastorage.org/webt/li/rx/wd/lirxwd74znfsvgrtjkpg3gfvl8u.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像出现在正确的位置：</font></font><br><br><img src="https://habrastorage.org/webt/uq/j0/as/uqj0asiyqcpqosl8x-3akydb3x0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，我们可以使用图像库做很多事情：外部填充图像，内部重新组织项目，与其他应用程序共享图像下宫</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们只需要教她如何通过“重置”它们来消除不必要的图像</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在右侧导航栏上显示的“垃圾箱”中。</font><font style="vertical-align: inherit;">如“图库演示应用程序的功能”部分所述，“垃圾桶”由</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GabageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类表示，该类</font><font style="vertical-align: inherit;">继承自</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们必须教它接受我们收藏的图像</font></font><code>ollection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图库图像</font><font style="vertical-align: inherit;">重置</font><font style="vertical-align: inherit;">为垃圾桶。</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">立即从该地方-到采石场。我将向</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GabageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加一个</font><font style="vertical-align: inherit;">“交互” </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这将是一个</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropInteraction</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为我试图对</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">某种事物</font><font style="vertical-align: inherit;">进行“重置” </font><font style="vertical-align: inherit;">。我们需要提供的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropInteraction</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个委托</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委托</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我要将自己</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分配</font><font style="vertical-align: inherit;">给该委托</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委托</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/mm/tq/xn/mmtqxnmypbysaik9fjd3r2amrlg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自然地，我们的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GabageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">必须确认我们正在实现</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropInteractionDelegate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议</font><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/nv/xy/vw/nvxyvwya12ggtiznb1byxq5vorm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使其正常工作</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">我们需要做的一切</font><font style="vertical-align: inherit;">，这是为了实现我们已经知道的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">，</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sessionDidUpdate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><img src="https://habrastorage.org/webt/jg/m9/ol/jgm9olzkrnv_fmu0mwesx91dvsq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，与类似的集合方法不同</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们没有任何其他信息以</font><font style="vertical-align: inherit;">转储位置</font><font style="vertical-align: inherit;">的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形式出现</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们实现这些方法。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内的方法</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> canHandle</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将被处理只有“拖放”</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其表示将图像</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。因此，</font><font style="vertical-align: inherit;">仅当</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> session.canLoadObjects（ofClass：UIImage.self）时</font></font></b><font style="vertical-align: inherit;">，我</font><font style="vertical-align: inherit;">才</font><font style="vertical-align: inherit;">返回</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> true</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">在</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> canHandle</font></font></b><font style="vertical-align: inherit;">方法中，</font><font style="vertical-align: inherit;">您实际上只是在说“可拖动”对象不是</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> UIImage</font></font></b><font style="vertical-align: inherit;">图像。</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/if/z7/yo/ifz7yoibzsugla3mj7kat1cylt8.png"><br><br><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么继续“重置” Drop并调用后续方法毫无意义。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果“可拖动”对象是</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font><font style="vertical-align: inherit;">，那么我们将执行</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sessionDidUpdate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">。在此方法中，我们需要做的就是返回</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “重置”商品</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。而且我已经准备好只接受图像的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> TYPE的“拖放式” LOCALLY对象</font><font style="vertical-align: inherit;">，可以将其“拖放” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内的任何位置</font><font style="vertical-align: inherit;">。我的</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将不会与外部转储的图像进行交互。所以我正在使用</font><b><font color="#0000FF"><font style="vertical-align: inherit;">session.localDragSession</font></font></b><font style="vertical-align: inherit;">变量进行解析</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否存在本地“重置” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并且我以</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数的形式返回“重置”语句</font><font style="vertical-align: inherit;">，并且</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">的值为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.copy</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的应用程序中的</font><font style="vertical-align: inherit;">ALWAYS LOCAL“拖放” </font><font style="vertical-align: inherit;">将来自该集合</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果</font><font style="vertical-align: inherit;">在外部发生</font><font style="vertical-align: inherit;">“拖放” </font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和“重置” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么我</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将以UIDropProposal</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数的形式返回“重置”语句</font><font style="vertical-align: inherit;">，其</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">的值为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.fobbiden</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，即“ forbidden”，我们将得到一个“ reset”禁止符号，而不是绿色加号。 。</font></font><br><br><img src="https://habrastorage.org/webt/ii/vd/wy/iivdwy9av6cxwzjkeay9kf87lby.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font><b><font color="#0000FF"><font style="vertical-align: inherit;">UIImage</font></font></b><font style="vertical-align: inherit;">图像</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将模拟将其缩放比例减小到几乎为0，并且当“重置”发生时，我们将从集合中移除此图片</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要创建用户的幻觉“复位，并消失”图像中的“垃圾桶”，我们使用我们的新方法</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">previewForDropping</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它允许你重定向“复位” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在另一个地方，并在同一时间在动画过程中变换了“一次性”的对象：</font></font><br><br><img src="https://habrastorage.org/webt/e7/ej/zb/e7ejzbhlfzjxrkxsjupt9hiewz4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在在此方法中，使用</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDragPreviewTarget</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化程序</font><b><font color="#0000FF"><font style="vertical-align: inherit;">，</font></font></b><font style="vertical-align: inherit;">我们</font><font style="vertical-align: inherit;">为要删除的</font><b><font color="#0000FF"><font style="vertical-align: inherit;">目标</font></font></b><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">获取了一个新的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">并使用</font><b><font color="#0000FF"><font style="vertical-align: inherit;">retargetedPreview</font></font></b><font style="vertical-align: inherit;">方法将其</font><b><font color="#0000FF"><font style="vertical-align: inherit;">重定向</font></font></b></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到一个新的位置，到“垃圾桶”，其比例减小到几乎为零：</font></font><br><br><img src="https://habrastorage.org/webt/bu/zp/av/buzpavo-rn6n2eoeztccvman6r0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果用户抬起手指，就会发生“重置” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我（像</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一样</font><font style="vertical-align: inherit;">）收到了</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息</font><font style="vertical-align: inherit;">。在</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息中</font><b><font color="#0000FF"><font style="vertical-align: inherit;">，</font></font></b><font style="vertical-align: inherit;">我们执行实际的“重置” </font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。老实说，</font><font style="vertical-align: inherit;">由于我们将使它</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变为</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几乎不可见，因此</font><font style="vertical-align: inherit;">转储到</font><b><font color="#0000FF"><font style="vertical-align: inherit;">GarbageView</font></font></b><font style="vertical-align: inherit;">本身上的</font><font style="vertical-align: inherit;">图像不再使我们感兴趣，很可能“重置”完成这一事实实际上</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表明我们已将该图像从集合中删除</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。为了做到这一点，我们必须知道集合本身</font><font style="vertical-align: inherit;">和</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">丢弃其中的图像。我们从哪里可以得到它们？</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于这一过程</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生在一个单一的应用程序，它提供给我们所有的地方：本地</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localDragSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的会话</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，本地环境</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localContext</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是我们的收集</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和本地对象</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以自己做复位图像</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从“画廊”或</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。正因为如此，我们可以将方法得到</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">performDrop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GarbageView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并用它</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据源</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageGalleryCollectionViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和型号</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们</font></font><code>Controller</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以得到的图像阵列</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型[ImageModel]：</font></font><br><br><img src="https://habrastorage.org/webt/3t/tj/kr/3ttjkr1cuyqxh4v3islcmsofjhy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着本地的帮助</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localDragSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们</font></font><code>Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们能够得到所有的“拖”</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GarbageView</font></font></font></b> <code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的元素</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并有可能成为很多，因为我们知道，和它们都是我们</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> collectionView集合的</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font><font style="vertical-align: inherit;">。创建</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dragItems</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的集合</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们对每个“拖”</font></font><code>Drag</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元素</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地对象</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，是谁的图像</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但它是我们内部重组的收集过程中不派上用场</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的CollectionView</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但“复位”图片库“垃圾桶”我们迫切需要在本地设备</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “拖动”对象</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dragItem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，毕竟这一次我们没有</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协调员</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，他如此慷慨地分享有关collectionView</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合中</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生的事情的信息</font><font style="vertical-align: inherit;">。因此，我们希望</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成为</font><font style="vertical-align: inherit;">模型</font><b><font color="#0000FF"><font style="vertical-align: inherit;">图片</font></font></b><font style="vertical-align: inherit;">的images数组中</font><font style="vertical-align: inherit;">的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。制作的方法进行必要的修改</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dragItems（在indexPath：IndexPath）</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ImageGalleryCollectionViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/le/iy/hz/leiyhzxv04brlhk6nlhpakw4bek.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们可以把每一个“pretaskivaemogo”元素</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> localObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是该指数</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPath</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像阵列</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的模型</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> imagegallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并将其发送到数组索引</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的索引</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">删除图像</font><font style="vertical-align: inherit;">的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indexPahes</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">在</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> performBatchUpdates</font></font></b><font style="vertical-align: inherit;">方法中</font></font><br><br><img src="https://habrastorage.org/webt/ci/cf/uo/cicfuo7gxvbmh7ddvjj2maorfog.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解索引</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的数组</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除图像</font><font style="vertical-align: inherit;">的</font><b><font color="#0000FF"><font style="vertical-align: inherit;"> indexPahes</font></font></b><font style="vertical-align: inherit;">的数组</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Google移除型号所有被删除的图片</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并从集合</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/2t/49/i4/2t49i4wwgqlz-vqqpalim8m4h4u.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行应用程序，填补了新的图像画廊：</font></font><br><br><img src="https://habrastorage.org/webt/vj/kb/v5/vjkbv5nwenjhacglkmksbto5jh0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择一个图像对，我们想从我们的库中删除... </font></font><br><br><img src="https://habrastorage.org/webt/cm/-e/t1/cm-et1fd2cp7pext2src2vddkmm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...“扔”他们在图标上的“垃圾桶” ...... </font></font><br><br><img src="https://habrastorage.org/webt/yw/l3/ue/ywl3ue6tusekuyqvpjv3n4pn1xy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们几乎减少到0 ... </font></font><br><br><img src="https://habrastorage.org/webt/14/6r/nd/146rndccir7ou4z5zitpj9gv4ek.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并从集合中消失</font></font><code>Collection View</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，隐藏在“垃圾桶”中：</font></font><br><br><img src="https://habrastorage.org/webt/1x/b_/zw/1xb_zw27xn-2yp7lb7tvlpgm_fc.png"><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 开始之间保存图像。 </font></font></h1><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了在运行之间保存图像库</font><font style="vertical-align: inherit;">，在将模型转换成</font><font style="vertical-align: inherit;">格式</font><font style="vertical-align: inherit;">后</font><font style="vertical-align: inherit;">，我们将使用</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserDefaults</font></font></font></b><font style="vertical-align: inherit;"></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。要做到这一点，我们将增加我们的</font></font><code>Controller</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VAR defailts</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... </font></font><br><br><img src="https://habrastorage.org/webt/wy/cg/vy/wycgvy5krdrmfiugzp9dgykaphe.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...，并在模型</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageModel</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可编码</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/j2/vv/w6/j2vvw62tiuud6eidtx1n9ipeq0w.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，数组</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的数组</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网址</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，和</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">双</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已在执行该协议</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可编码的</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，所以我们没有什么别的事情可做去工作编码和解码的模型</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们如何获得</font><b><font color="#0000FF"><font style="vertical-align: inherit;">ImageGallery</font></font></b><font style="vertical-align: inherit;">的</font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本</font><font style="vertical-align: inherit;">？</font><font style="vertical-align: inherit;">为了创建这个扩展变量</font><b><font color="#0000FF"><font style="vertical-align: inherit;">VAR JSON</font></font></b><font style="vertical-align: inherit;">，它返回尝试将其转换，结果</font><b><font color="#0000FF"><font style="vertical-align: inherit;">自我</font></font></b><font style="vertical-align: inherit;">，通过</font><b><font color="#0000FF"><font style="vertical-align: inherit;">JSONEncoder.encode（）</font></font></b><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">格式：</font><font style="vertical-align: inherit;">这就是全部。</font><font style="vertical-align: inherit;">将</font><b><font color="#0000FF"><font style="vertical-align: inherit;">self</font></font></b><font style="vertical-align: inherit;">转换</font><font style="vertical-align: inherit;">为format </font><font style="vertical-align: inherit;">的结果</font><font style="vertical-align: inherit;">将返回</font><b><font color="#0000FF"><font style="vertical-align: inherit;">Data</font></font></b><font style="vertical-align: inherit;">，或者</font><font style="vertical-align: inherit;">如果此转换失败</font><font style="vertical-align: inherit;">将返回</font><b><font color="#0000FF"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;">，尽管后者永远不会发生，因为此TYPE是100％可</font><b><font color="#0000FF"><font style="vertical-align: inherit;">编码的</font></font></b><font style="vertical-align: inherit;">。使用</font><b><font color="#0000FF"><font style="vertical-align: inherit;">可选的</font></font></b><font style="vertical-align: inherit;">变量</font><b><font color="#0000FF"><font style="vertical-align: inherit;">JSON</font></font></b><font style="vertical-align: inherit;">只是为了对称的原因。</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>JSON</code><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/f6/o3/hz/f6o3hzee-7hryaxadmzf--0jeym.png"><br><br><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>JSON</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们有一种方法可以将</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageGallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模型转换</font><font style="vertical-align: inherit;">为</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式</font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">json</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">是否具有TYPE </font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据？</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserDefaults中</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记住</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在想象一下，以某种方式我们设法获取了</font><b><font color="#0000FF"><font style="vertical-align: inherit;">json</font></font></b></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据</font><font style="vertical-align: inherit;">，我想根据它们重新创建Model，即</font><b><font color="#0000FF"><font style="vertical-align: inherit;">ImageGallery</font></font></b><font style="vertical-align: inherit;">结构的实例</font><font style="vertical-align: inherit;">。为此，为</font><b><font color="#0000FF"><font style="vertical-align: inherit;">ImageGallery</font></font></b><font style="vertical-align: inherit;">编写一个INITIALIZER非常容易</font><font style="vertical-align: inherit;">，其输入参数为</font><b><font color="#0000FF"><font style="vertical-align: inherit;">json</font></font></b><font style="vertical-align: inherit;"> data </font><font style="vertical-align: inherit;">。此初始化程序将是“下降”初始化程序（</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>JSON</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><code>failable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）如果初始化失败，则崩溃并返回</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/g7/0n/l4/g70nl4mxpadtrajaq7y-ec4f6bw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我只是</font><font style="vertical-align: inherit;">使用</font><b><font color="#0000FF"><font style="vertical-align: inherit;">JSONDecoder</font></font></b><font style="vertical-align: inherit;">解码器</font><font style="vertical-align: inherit;">获取</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">newValue</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">，尝试对</font><font style="vertical-align: inherit;">传递给我的初始化程序</font><font style="vertical-align: inherit;">的</font><b><font color="#0000FF"><font style="vertical-align: inherit;">json</font></font></b><font style="vertical-align: inherit;">数据进行解码</font><font style="vertical-align: inherit;">，然后将其分配为</font><b><font color="#0000FF"><font style="vertical-align: inherit;">self</font></font></b><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果成功完成此操作，则将获得一个新的</font><b><font color="#0000FF"><font style="vertical-align: inherit;">ImageGallery</font></font></b><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">，但是如果尝试失败，则将返回</font><b><font color="#0000FF"><font style="vertical-align: inherit;">nil</font></font></b><font style="vertical-align: inherit;">，因为初始化“失败”。</font><font style="vertical-align: inherit;">我必须说，这里我们有更多“失败”（</font><font style="vertical-align: inherit;">）的</font><font style="vertical-align: inherit;">原因</font><font style="vertical-align: inherit;">，因为</font><b><font color="#0000FF"><font style="vertical-align: inherit;">json</font></font></b><font style="vertical-align: inherit;">数据</font><font style="vertical-align: inherit;">很有可能</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><code>fail</code><font style="vertical-align: inherit;"></font><code>JSON</code><font style="vertical-align: inherit;"></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能变坏或变空，所有这些都可能导致</font></font><code>fail</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化程序</font><font style="vertical-align: inherit;">的“掉落”（</font><font style="vertical-align: inherit;">）。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以实现所读取的</font></font><code>JSON</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据和恢复模型</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagegallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">viewWillAppear中</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们</font></font><code>Controller</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... </font></font><br><br><img src="https://habrastorage.org/webt/gw/n2/u-/gwn2u-zkggggk2vuwfi-czhycdq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...以及观察者的条目</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">didSet {}</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">性能</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imagegallery</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/-g/bc/yz/-gbcyzh4t5innabrtcbxdmdh3wq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们来运行应用程序，并填写我们的形象画廊：</font></font><br><br><img src="https://habrastorage.org/webt/le/t5/wr/let5wryw9nwf-ahnij7f_wltztc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们关闭应用程序，然后再次打开它，我们可以看到我们以前的画廊保存在</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserDefaults中的</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font><font style="vertical-align: inherit;">。</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 结论 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本文通过一个非常简单的演示应用程序“ Image Gallery”的示例演示将技术集成</font></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><code>iOS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序中有</font><font style="vertical-align: inherit;">多么容易</font><font style="vertical-align: inherit;">。这样就可以完全编辑图库，从那里的其他应用程序“投掷”新图像，移动现有图像并删除不必要的图像。并将分布在图库中的图像分发到其他应用程序。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当然，我们希望创建许多这样的主题如诗如画的图像集合，并将其直接保存到iPad或iCloud Drive。如果每个此类图库都被解释为永久存储的</font><b><font color="#0000FF"><font style="vertical-align: inherit;">UIDocument，</font></font></b><font style="vertical-align: inherit;">则可以这样做</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这样的解释将使我们能够提升到下一个抽象层次，并创建一个可处理文档的应用程序。</font><font style="vertical-align: inherit;">在这样的应用程序中，</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DocumentBrowserViewController</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组件将显示您的</font><b><font color="#0000FF"><font style="vertical-align: inherit;">文档</font></font></b><font style="vertical-align: inherit;">，与该应用程序非常相似</font></font><code>Files</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这将使您可以</font><font style="vertical-align: inherit;">在自己的</font><font style="vertical-align: inherit;">和上</font><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">“ Image Gallery”类型的</font></font><b><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIDocument</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font><font style="vertical-align: inherit;">，以及选择所需的文档进行查看和编辑。</font><font style="vertical-align: inherit;">但这是下一篇文章的主题。</font><font style="vertical-align: inherit;">PS该机制实现之前</font><font style="vertical-align: inherit;">和之后</font><font style="vertical-align: inherit;">的演示应用程序代码</font><font style="vertical-align: inherit;">都在</font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Github上</font></a></b><font style="vertical-align: inherit;">。</font></font><code>iPad</code><font style="vertical-align: inherit;"></font><code>iCloud Drive</code><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>Drag &amp; Drop</code><font style="vertical-align: inherit;"></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a></b><font style="vertical-align: inherit;"></font><br><br><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN425817/">https://habr.com/ru/post/zh-CN425817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN425807/index.html">“斗争”的系统和方法的复杂性</a></li>
<li><a href="../zh-CN425809/index.html">在此过程中学习编程语言：有关复杂项目的软件开发人员</a></li>
<li><a href="../zh-CN425811/index.html">另一个MacBook Pro显示问题</a></li>
<li><a href="../zh-CN425813/index.html">CICD：无缝部署到分布式集群系统而无需停机</a></li>
<li><a href="../zh-CN425815/index.html">谁不需要SEO，如何选择优化器并测试其工作</a></li>
<li><a href="../zh-CN425819/index.html">GitLab 11.3与Maven存储库和安全环境一起发布</a></li>
<li><a href="../zh-CN425821/index.html">如何在2018年成为React开发者</a></li>
<li><a href="../zh-CN425823/index.html">2018年IPO统计数据：募集了450亿美元，Dropbox筹集的资金少于制药公司和房地产卖方</a></li>
<li><a href="../zh-CN425827/index.html">Google+课程：项目需要确保在线尊重现实生活中用户利益之间的界限</a></li>
<li><a href="../zh-CN425829/index.html">我们与Roskomnadzor的战斗方式以及结果</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>