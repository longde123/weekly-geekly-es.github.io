<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö≤ üîê üë∑üèª Editor de l√≥gica visual para Unity3d. Parte 2 üßù üôä üë®‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introdu√ß√£o 
 Ol√° queridos leitores, no artigo de hoje, gostaria de destacar o tema da arquitetura do kernel do editor de l√≥gica visual do Unity3d ....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Editor de l√≥gica visual para Unity3d. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466187/"><h2>  1. Introdu√ß√£o </h2><br>  Ol√° queridos leitores, no artigo de hoje, gostaria de destacar o tema da arquitetura do kernel do editor de l√≥gica visual do <b>Unity3d</b> .  Esta √© a segunda parte da s√©rie.  Voc√™ pode ler o anterior <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Ent√£o, sobre o que vamos falar?  O editor visual √© baseado no n√∫cleo principal, que permite executar, carregar e armazenar dados l√≥gicos.  Por sua vez, o kernel usa, como mencionado no artigo anterior, <b>ScriptableObject</b> , como uma classe base para trabalhar com componentes l√≥gicos.  Vamos considerar com mais detalhes todos esses aspectos. <br><br>  Artigos da s√©rie: <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Editor de l√≥gica visual para Unity3d.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> <br><a name="habracut"></a><br><h2>  Por que ScriptableObject? </h2><br>  Antes de iniciar o desenvolvimento, pensei por um longo tempo sobre o que construir o sistema.  Na primeira forma - era o <b>MonoBehaviour</b> , mas tive que abandonar essa ideia, pois esses scripts deveriam ficar no <b>GameObject</b> , como componentes.  O pr√≥ximo passo foi a id√©ia de usar sua pr√≥pria classe, que n√£o √© descendente do <b>UnityEngine.Object</b> .  Mas essa op√ß√£o n√£o criou ra√≠zes, embora estivesse funcionando muito bem, mas arrastou-se, escrevendo seu serializador, inspetor, coletor de lixo etc. Como resultado, a √∫nica maneira razo√°vel era usar o <b>ScriptableObject</b> , cujo ciclo de vida √© semelhante ao <b>MonoBehaviour</b> , se a cria√ß√£o ocorre <b>enquanto o</b> aplicativo est√° sendo executado por meio de <b>ScriptableObject.CreateInstance</b> .  Al√©m disso, esse problema foi resolvido automaticamente usando o <b>JsonUtility</b> (embora agora isso n√£o seja mais um problema) e o inspetor do <b>Unity</b> . <br><br><h2>  Arquitetura </h2><br>  Abaixo est√° um diagrama generalizado do que <b>consiste o</b> n√∫cleo <b>uViLEd</b> . <br><br><img src="https://habrastorage.org/webt/xd/o-/kp/xdo-kp-skmrrvbfw0jy33l3r02o.png" alt="imagem"><br><br>  Vamos considerar cada elemento em mais detalhes. <br><br><h3>  Controlador </h3><br>  O controlador √© o elemento principal do kernel, que √© um script <b>MonoBehavior</b> (o √∫nico em todo o sistema).  A classe do controlador √© um singleton e √© acess√≠vel a todos os componentes da l√≥gica.  O que esta classe faz: <br><br><ol><li>  Armazena links de objetos da <b>unidade</b> </li><li>  Inicia a l√≥gica no in√≠cio da cena </li><li>  Representa o acesso a m√©todos para executar l√≥gica de fontes externas </li><li>  Fornece o trabalho de m√©todos <b>Mono</b> em componentes </li></ol><br><div class="spoiler">  <b class="spoiler_title">C√≥digo base da classe do controlador</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> LogicController _instance; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> LogicController Instance { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { _instance = _instance ?? FindObjectOfType&lt;LogicController&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _instance; } } [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SceneLogicData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TextAsset BinaryData =&gt; _data; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; _id; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _id; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextAsset _data; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SceneLogicData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, TextAsset binaryData</span></span></span><span class="hljs-function">)</span></span> { _id = id; _data = binaryData; Name = name; } } [HideInInspector] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;SceneLogicData&gt; SceneLogicList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;SceneLogicData&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _instance = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sceneLogic <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> SceneLogicList) { RunLogicInternal(LogicStorage.Load(sceneLogic.BinaryData)); } } } }</code> </pre> <br></div></div><br>  <b>Nota</b> : cada cena tem seu pr√≥prio controlador e seu pr√≥prio conjunto de l√≥gica. <br>  <b>Nota</b> : mais detalhes sobre o carregamento de dados l√≥gicos e seu lan√ßamento ser√£o discutidos separadamente. <br><br><h3>  Elementos principais do kernel do uViLEd </h3><br><h4>  Componente </h4><br>  Na primeira parte, eu j√° disse que o componente √© um <b>ScriptableObject</b> .  Todos os componentes s√£o descendentes da classe <b>LogicComponent</b> , que por sua vez √© simples. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> MonoBehaviour coroutineHost =&gt; _logicHost; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MonoBehaviour _logicHost; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } } }</code> </pre><br>  Aqui, <b>coroutineHost</b> √© um link para um controlador l√≥gico, que foi introduzido apenas por conveni√™ncia e √© usado, como o nome indica, para trabalhar com corotinas.  O uso dessa abstra√ß√£o √© necess√°rio para separar os componentes de outro c√≥digo presente no projeto do <b>Unity</b> . <br><br><h4>  Vari√°veis </h4><br>  Vari√°veis, conforme mencionado em um artigo anterior, s√£o componentes especializados para armazenar dados, o c√≥digo para elas √© apresentado abaixo. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de implementa√ß√£o vari√°vel</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Variable</span></span> : <span class="hljs-title"><span class="hljs-title">LogicComponent</span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Variable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">Variable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Changed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T newValue</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Changed OnChanged; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Set OnSet; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _value; }<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> changed = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_value == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span> || (_value != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !_value.Equals(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>))) { changed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } _value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (changed) { OnChanged?.Invoke(); } OnSet?.Invoke(_value); } } [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> T _value; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDestroy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(OnSet != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventHandler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> OnSet.GetInvocationList()) { OnSet -= (Set)eventHandler; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(OnChanged != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventHandler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> OnChanged.GetInvocationList()) { OnChanged -= (Changed)eventHandler; } } } } }</code> </pre><br></div></div><br>  Aqui <b>Variable</b> √© uma classe abstrata b√°sica para todas as vari√°veis, √© necess√°rio separ√°-las dos componentes comuns.  A classe principal √© <b>gen√©rica</b> , que armazena os dados em si e fornece eventos para definir o valor e alter√°-lo. <br><br><h4>  Comunica√ß√µes </h4><br>  Quais s√£o as conex√µes, eu disse em um artigo anterior.  Resumidamente, √© uma entidade virtual que permite que os componentes usem os m√©todos uns dos outros e tamb√©m se refira a vari√°veis ‚Äã‚Äãl√≥gicas.  Para o programador, essa conex√£o √© suave e n√£o √© vis√≠vel no c√≥digo.  Todas as comunica√ß√µes s√£o formadas durante o processo de inicializa√ß√£o (leia sobre isso abaixo).  Considere as classes que permitem formar relacionamentos. <br><br><div class="spoiler">  <b class="spoiler_title">Ponto de entrada</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">INPUT_POINT</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action&lt;T&gt; Handler; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">INPUT_POINT</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action Handler; } }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ponto de sa√≠da</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OUTPUT_POINT</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Action&lt;T&gt;&gt; _linkedInputPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Action&lt;T&gt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T param</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _linkedInputPoints) { handler(param); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OUTPUT_POINT</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Action&gt; _linkedInputPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Action&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _linkedInputPoints) { handler(); } } } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Refer√™ncia vari√°vel</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VARIABLE_LINK</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; _variable.Value; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; _variable.Value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt; _variableProperty { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; _variable; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _variable = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; VariableWasSet = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; InitializeEventHandlers(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> VariableWasSet { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt; _variable; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt;.Set _automaticSetHandler; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Variable&lt;T&gt;.Changed _automaticChangedHandler; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSetEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Set handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnSet += handler; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _automaticSetHandler = handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveSetEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Set handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnSet -= handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddChangedEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Changed handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnChanged += handler; }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _automaticChangedHandler = handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveChangedEventHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Variable&lt;T&gt;.Changed handler</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VariableWasSet) { _variable.OnChanged -= handler; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeEventHandlers</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_automaticSetHandler != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _variable.OnSet += _automaticSetHandler; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_automaticChangedHandler != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _variable.OnChanged += _automaticChangedHandler; } } } }</code> </pre><br></div></div><br>  <b>Nota</b> : aqui vale a pena explicar um ponto: manipuladores autom√°ticos para definir eventos e alterar o valor de uma vari√°vel s√£o usados ‚Äã‚Äãsomente quando definidos no m√©todo <b>Constructor</b> , pois, naquele momento, as refer√™ncias √†s vari√°veis ‚Äã‚Äãainda n√£o estavam definidas. <br><br><h3>  Trabalhar com l√≥gica </h3><br><h4>  Armazenamento </h4><br>  No primeiro artigo sobre o editor de l√≥gica visual, foi mencionado que a l√≥gica √© um conjunto de vari√°veis, componentes e os relacionamentos entre eles: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SceneName = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ComponentsStorage Components = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ComponentsStorage(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LinksStorage Links = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinksStorage(); } }</code> </pre><br>  Essa classe √© aparentemente serializ√°vel, mas <b>o</b> <b>JsonUtility</b> <b>do Unity</b> n√£o √© usado para serializa√ß√£o.  Em vez disso, √© usada uma op√ß√£o bin√°ria, cujo resultado √© salvo como um arquivo com a extens√£o de <b>bytes</b> .  Por que isso √© feito?  Em geral, o principal motivo √© a seguran√ßa, ou seja, para a op√ß√£o de carregar l√≥gica de uma fonte externa, √© poss√≠vel criptografar dados e, em geral, desserializar uma matriz de bytes √© mais dif√≠cil que o <b>json</b> aberto. <br><br>  Vamos dar uma <b>olhada nas classes</b> <b>ComponentsStrorage</b> e <b>LinksStorage</b> .  O sistema usa um <b>GUID</b> para identifica√ß√£o global de dados.  Abaixo est√° o c√≥digo da classe, que √© a base para os cont√™ineres de dados. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Identifier</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Identifier</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(Id)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; Id = System.Guid.NewGuid().ToString(); } } }</code> </pre><br>  Agora considere o c√≥digo da classe <b>ComponentsStorage</b> , que, como o nome indica, armazena dados sobre os componentes da l√≥gica: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ComponentsStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ComponentData</span></span> : <span class="hljs-title"><span class="hljs-title">Identifier</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Type = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Assembly = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> JsonData = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;ComponentData&gt; Items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ComponentData&gt;(); } }</code> </pre><br>  A aula √© bem simples.  As seguintes informa√ß√µes s√£o armazenadas para cada componente: <br><br><ol><li>  Identificador exclusivo (sequ√™ncia <b>GUID</b> ) encontrado em <b>Identificador</b> </li><li>  Digite o nome </li><li>  O nome da montagem na qual o tipo de componente est√° localizado </li><li>  Cadeia Json com dados de serializa√ß√£o (resultado de <b>JsonUtility.ToJson</b> ) </li><li>  Sinalizador de atividade (estado) do componente </li></ol><br>  Agora vamos dar uma olhada na classe <b>LinksStorage</b> .  Esta classe armazena informa√ß√µes sobre os relacionamentos entre componentes, bem como sobre refer√™ncias a vari√°veis. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LinksStorage</span></span> { [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LinkData</span></span> : <span class="hljs-title"><span class="hljs-title">Identifier</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsVariable; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsActive = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SourceComponent = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> TargetComponent = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> OutputPoint = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> InputPoint = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> VariableName = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CallOrder = <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;LinkData&gt; Items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;LinkData&gt;(); } }</code> </pre><br>  Em princ√≠pio, tamb√©m n√£o h√° nada complicado nesta classe.  Cada link cont√©m as seguintes informa√ß√µes: <br><br><ol><li>  Sinalizador indicando que este link √© uma refer√™ncia a uma vari√°vel </li><li>  Sinalizador de atividade de link </li><li>  O identificador (sequ√™ncia <b>GUID</b> ) do componente com o ponto de sa√≠da </li><li>  O identificador (string <b>GUID</b> ) do componente do ponto de entrada </li><li>  O nome do ponto de sa√≠da do componente de origem de comunica√ß√£o </li><li>  Nome do ponto de entrada do componente de comunica√ß√£o de destino </li><li>  Nome do campo da classe para definir uma refer√™ncia de vari√°vel </li><li>  Ordem de chamada de comunica√ß√£o </li></ol><br><h4>  Executar a partir do reposit√≥rio </h4><br>  Antes de entrar nos detalhes do c√≥digo, primeiro quero me concentrar na descri√ß√£o da sequ√™ncia de como o controlador inicia a l√≥gica: <br><br><ol><li>  A inicializa√ß√£o √© iniciada no m√©todo Awake do controlador </li><li>  A lista de l√≥gicas de cena carrega e desserializa os dados l√≥gicos de um arquivo bin√°rio ( <b>TextAsset</b> ) </li><li>  Para cada l√≥gica ocorre: <br><ul><li>  Cria√ß√£o de componentes </li><li>  Classificando links por <b>CallOrder</b> </li><li>  Configurando links e refer√™ncias de vari√°veis </li><li>  Classificando <b>m√©todos de</b> componente <b>mono</b> por <b>ExecuteOrder</b> </li></ul><br></li></ol><br>  Vamos considerar mais detalhadamente cada aspecto dessa cadeia. <br><br><div class="spoiler">  <b class="spoiler_title">Serializa√ß√£o e desserializa√ß√£o bin√°rias</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Serialization</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Serialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> binaryFormatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryFormatter(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Directory.Exists(path)) { Directory.CreateDirectory(path); } <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(Path.Combine(path, fileName), FileMode.OpenOrCreate)) { binaryFormatter.Serialize(fs, data); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Deserialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextAsset textAsset</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> binaryFormatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryFormatter(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> memoryStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream(textAsset.bytes)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> binaryFormatter.Deserialize(memoryStream); } } } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Carregando dados l√≥gicos de um ativo de texto (arquivo bin√°rio)</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">uViLEd.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicStorage</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> LogicStorage </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextAsset textAsset</span></span></span><span class="hljs-function">)</span></span> =&gt; Serialization.Deserialize(textAsset) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> LogicStorage; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Lan√ßamento da l√≥gica</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunLogicInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage logicStorage</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, LogicComponent&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Components.Items) { CreateComponent(componentData, instances); } logicStorage.Links.Items.Sort(SortingLinks); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Links.Items) { CreateLink(linkData, instances); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _monoBehaviourMethods.Values) { monoMethods.Sort(SortingMonoMethods); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Cria√ß√£o de componentes</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateComponent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage.ComponentsStorage.ComponentData componentData, IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, LogicComponent&gt; instances, IList&lt;IDisposable&gt; disposableInstance, IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, List&lt;MonoMethodData&gt;&gt; monoMethods</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!componentData.IsActive) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentType = AssemblyHelper.GetAssemblyType(componentData.Assembly, componentData.Type); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentInstance = ScriptableObject.CreateInstance(componentType) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> LogicComponent; JsonUtility.FromJsonOverwrite(componentData.JsonData, componentInstance); componentInstance.name = componentData.InstanceName; componentType.GetFieldRecursive(_LOGIC_HOST_STR).SetValue(componentInstance, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MonoBehaviour); componentInstance.Constructor(); instances.Add(componentData.Id, componentInstance); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(componentInstance <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IDisposable) { disposableInstance.Add((IDisposable)componentInstance); } SearchMonoBehaviourMethod(componentInstance, monoMethods); }</code> </pre><br>  Ent√£o, o que acontece nesta fun√ß√£o: <br><br><ol><li>  O sinalizador de atividade do componente est√° marcado </li><li>  Obtendo o tipo de componente da montagem </li><li>  Uma inst√¢ncia do componente √© criada por tipo </li><li>  Desserializa√ß√£o de par√¢metro de componente de <b>json</b> </li><li>  O link est√° definido na <b>coroutineHost</b> </li><li>  M√©todo <b>construtor</b> chamado </li><li>  Uma c√≥pia tempor√°ria √© salva na inst√¢ncia do componente </li><li>  Se o componente implementa a interface IDisposable, o link para ele √© armazenado na lista correspondente </li><li>  Procurando m√©todos <b>Mono</b> no componente </li></ol><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Criando Links</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateLink</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage.LinksStorage.LinkData linkData, Dictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, LogicComponent&gt; instances</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!linkData.IsActive) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourceComponent = instances.ContainsKey(linkData.SourceComponent) ? instances[linkData.SourceComponent] : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sourceComponent == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> targetComponent = instances.ContainsKey(linkData.TargetComponent) ? instances[linkData.TargetComponent] : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (targetComponent == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (linkData.IsVariable) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variableLinkFieldInfo = sourceComponent.GetType().GetField(linkData.variableName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (variableLinkFieldInfo != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variableLinkFieldValue = variableLinkFieldInfo.GetValue(sourceComponent); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variableLinkVariablePropertyInfo = variableLinkFieldInfo.FieldType.GetProperty(_VARIABLE_PROPERTY_STR, BindingFlags.NonPublic | BindingFlags.Instance); variableLinkVariablePropertyInfo.SetValue(variableLinkFieldValue, targetComponent, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> handlerValue; MethodInfo methodListAdd; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> linkedInputPointsFieldValue; Type outputPointType; <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> outputPoint; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPointParse = sourceComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IOutputPointParse; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointParse = targetComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IInputPointParse; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPointParse != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPoints = outputPointParse.GetOutputPoints(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPoints.ContainsKey(linkData.OutputPoint)) { outputPoint = outputPoints[linkData.OutputPoint]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPoint <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> FieldInfo) { outputPoint = sourceComponent.GetType().GetField(linkData.OutputPoint).GetValue(sourceComponent); } outputPointType = outputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkedInputPointsFieldInfo = outputPointType.GetField(_LINKED_INPUT_POINTS_STR, BindingFlags.NonPublic | BindingFlags.Instance); linkedInputPointsFieldValue = linkedInputPointsFieldInfo.GetValue(outputPoint); methodListAdd = linkedInputPointsFieldInfo.FieldType.GetMethod(_ADD_STR); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPointFieldInfo = sourceComponent.GetType().GetField(linkData.OutputPoint); outputPoint = outputPointFieldInfo.GetValue(sourceComponent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPoint != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { outputPointType = outputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkedInputPointsFieldInfo = outputPointFieldInfo.FieldType.GetField(_LINKED_INPUT_POINTS_STR, BindingFlags.NonPublic | BindingFlags.Instance); linkedInputPointsFieldValue = linkedInputPointsFieldInfo.GetValue(outputPoint); methodListAdd = linkedInputPointsFieldInfo.FieldType.GetMethod(_ADD_STR); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPointParse != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPoints = inputPointParse.GetInputPoints(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPoints.ContainsKey(linkData.InputPoint)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPoint = inputPoints[linkData.InputPoint]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPoint <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> FieldInfo) { inputPoint = targetComponent.GetType().GetField(linkData.InputPoint).GetValue(targetComponent); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointType = inputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointHandlerFieldInfo = inputPointType.GetField(_HANDLER_STR); handlerValue = inputPointHandlerFieldInfo.GetValue(inputPoint); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointFieldInfo = targetComponent.GetType().GetField(linkData.InputPoint); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointFieldValue = inputPointFieldInfo.GetValue(targetComponent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPointFieldValue != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointHandlerFieldInfo = inputPointFieldInfo.FieldType.GetField(_HANDLER_STR); handlerValue = inputPointHandlerFieldInfo.GetValue(inputPointFieldValue); } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handlerParsedAction = GetParsedHandler(handlerValue, outputPoint); methodListAdd.Invoke(linkedInputPointsFieldValue, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { handlerParsedAction }); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetParsedHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> handlerValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outputPoint</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inputPointType = handlerValue.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> outputPointType = outputPoint.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputPointType.IsGenericType) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> paramType = inputPointType.GetGenericArguments()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paramType == <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>) &amp;&amp; outputPointType.IsGenericType) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parsingActionMethod = outputPointType.GetMethod(_PARSING_ACTION_OBJECT_STR, BindingFlags.NonPublic | BindingFlags.Instance); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsingActionMethod.Invoke(outputPoint, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { handlerValue }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handlerValue; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputPointType.IsGenericType) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parsingActionMethod = outputPointType.GetMethod(_PARSING_ACTION_EMPTY_STR, BindingFlags.NonPublic | BindingFlags.Instance); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsingActionMethod.Invoke(outputPoint, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { handlerValue }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handlerValue; } } }</code> </pre> <br>  Criando uma conex√£o, um dos momentos mais intrinsecamente dif√≠ceis de todo o sistema, consideraremos cada est√°gio: <br><br><ol><li>  Verifica o sinalizador de atividade de comunica√ß√£o </li><li>  Na lista tempor√°ria de componentes criados s√£o pesquisados, o componente de origem da conex√£o e o componente de destino </li><li>  Verifica o tipo de conex√£o: <br><ul><li>  Se o tipo de conex√£o for uma refer√™ncia a uma vari√°vel, os valores necess√°rios ser√£o definidos usando reflex√£o </li><li>  Se a conex√£o for normal, a reflex√£o tamb√©m ser√° usada para definir os valores necess√°rios para os m√©todos de pontos de sa√≠da e entrada </li></ul><br></li><li>  Para comunica√ß√µes normais, verifique primeiro se o componente herda as <b>interfaces IInputPointParse</b> e <b>IOutputPointParse</b> . </li><li>  Dependendo dos resultados do par√°grafo anterior, o campo <b>LinkedInputPoints</b> no componente de origem e o m√©todo manipulador no componente de destino s√£o obtidos por meio de reflex√£o. </li><li>  Os manipuladores de m√©todo s√£o <b>obtidos</b> convertendo a chamada de m√©todo ignorando <b>MethodInfo.Invoke</b> em uma chamada simples <code>Action&lt;T&gt;</code> .  No entanto, obter esse link por meio de reflex√£o √© muito complicado, portanto, m√©todos especiais foram <code>OUTPUT_POINT&lt;T&gt;</code> na classe <code>OUTPUT_POINT&lt;T&gt;</code> que permite isso.  Para uma vers√£o n√£o <b>gen√©rica</b> dessa classe, nenhuma a√ß√£o √© necess√°ria. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Action&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParsingActionEmpty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action action</span></span></span><span class="hljs-function">)</span></span> { Action&lt;T&gt; parsedAction = (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) =&gt; action(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsedAction; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Action&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParsingActionObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; action</span></span></span><span class="hljs-function">)</span></span> { Action&lt;T&gt; parsedAction = (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) =&gt; action(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parsedAction; } }</code> </pre> <br>  O primeiro m√©todo √© usado quando o ponto de entrada n√£o aceita nenhum par√¢metro.  O segundo m√©todo, respectivamente, para o ponto de entrada com um par√¢metro <br><br></li><li>  Por meio da reflex√£o, um link para o manipulador de <b>a√ß√£o</b> √© adicionado ao campo <b>LinkedInputPoints</b> (que, como mostrado acima, √© uma lista) </li></ol><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Trabalhando com m√©todos mono</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchMonoBehaviourMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicComponent component, IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, List&lt;MonoMethodData&gt;&gt; monoBehaviourMethods</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type = component.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> methods = type.GetMethods(BindingFlags.Public | BindingFlags.Static | BindingFlags.NonPublic | BindingFlags.Instance); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> method <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> methods) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_monoMethods.Keys.Contains(method.Name)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> priorityAttributes = method.GetCustomAttributes(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ExecuteOrderAttribute), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> priority = (priorityAttributes.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ? ((ExecuteOrderAttribute)priorityAttributes[<span class="hljs-number"><span class="hljs-number">0</span></span>]).Order : <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue; monoBehaviourMethods[method.Name].Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MonoMethodData(method, component, priority, _monoMethods[method.Name])); } } }</code> </pre> <br>  Cada m√©todo √© armazenado no dicion√°rio por meio de um link para uma classe especial atrav√©s da qual a chamada √© feita.  Essa classe converte automaticamente o m√©todo em uma refer√™ncia a <b>Action</b> .  Portanto, h√° uma acelera√ß√£o significativa de chamadas para m√©todos <b>Mono em</b> compara√ß√£o com o <b>MethodInfo.Invoke</b> usual. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MonoMethodData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Order { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action _monoMethodWrapper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; _monoMethodParamWrapper; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MonoMethodData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MethodInfo method, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> target, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> order, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> withParam</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!withParam) { _monoMethodWrapper = (Action)Delegate.CreateDelegate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Action), target, method.Name); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _monoMethodParamWrapper = (Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;)Delegate.CreateDelegate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;), target, method.Name); } Order = order; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt;_monoMethodWrapper(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> param</span></span></span><span class="hljs-function">)</span></span> =&gt; _monoMethodParamWrapper(param); }</code> </pre> <br>  <b>Nota</b> : sobrecarregar o m√©todo <b>Call</b> com o par√¢metro <b>bool</b> √© usado para m√©todos <b>Mono</b> , como <b>ApplicationPause</b> , etc. <br></div></div><br><h4>  L√≥gica de disparo externo </h4><br>  Um lan√ßamento externo da l√≥gica √© um lan√ßamento durante a opera√ß√£o do aplicativo, essa l√≥gica n√£o est√° definida na cena e n√£o h√° link para ela.  Ele pode ser baixado do pacote ou de recursos.  Em geral, come√ßar de fora n√£o √© muito diferente de come√ßar no in√≠cio da cena, com exce√ß√£o de trabalhar com m√©todos <b>Mono</b> . <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de m√©todo para execu√ß√£o de l√≥gica externa (adiada)</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunLogicExternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage logicStorage</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, LogicComponent&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> runMonoMethods = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;MonoMethodData&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethodName <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _monoMethods.Keys) { runMonoMethods.Add(monoMethodName, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;MonoMethodData&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Components.Items) { CreateComponent(componentData, instances, _disposableInstances, runMonoMethods); } logicStorage.Links.Items.Sort(SortingLinks); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Links.Items) { CreateLink(linkData, instances); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> runMonoMethods.Values) { monoMethods.Sort(SortingMonoMethods); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (runMonoMethods.ContainsKey(_START_STR)) { CallMonoBehaviourMethod(_START_STR, runMonoMethods, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethodName <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> runMonoMethods.Keys) { _monoBehaviourMethods[monoMethodName].AddRange(runMonoMethods[monoMethodName]); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _monoBehaviourMethods.Values) { monoMethods.Sort(SortingMonoMethods); } }</code> </pre> <br></div></div><br>  Como voc√™ pode ver, todas as refer√™ncias aos m√©todos <b>Mono</b> s√£o salvas no dicion√°rio local, ap√≥s o qual os m√©todos Start s√£o iniciados e todos os outros m√©todos s√£o adicionados ao dicion√°rio geral. <br><br><h4>  Executando l√≥gica como uma inst√¢ncia </h4><br>  Durante a opera√ß√£o do aplicativo, pode ser necess√°rio executar determinada l√≥gica por um certo tempo ou at√© que ele execute sua tarefa.  As op√ß√µes anteriores de acionamento l√≥gico n√£o podem fazer isso, pois a l√≥gica √© acionada durante toda a vida da cena. <br><br>  Para executar a l√≥gica como uma inst√¢ncia, s√£o salvos links para todas as inst√¢ncias de componentes e similares, que, ap√≥s a conclus√£o do trabalho, podem ser exclu√≠dos, limpando assim a mem√≥ria. <br><br>  C√≥digo da classe do armaz√©m de dados da inst√¢ncia l√≥gica: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InstanceLogicData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IList&lt;LogicComponent&gt; ComponentInstances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;LogicComponent&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;MonoMethodData&gt;&gt; MonoBehaviourMethods = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, List&lt;MonoMethodData&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IList&lt;IDisposable&gt; DisposableInstances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;IDisposable&gt;(); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">O lan√ßamento l√≥gico em si √© semelhante ao lan√ßamento externo descrito anteriormente.</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunLogicInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LogicStorage logicStorage, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = Guid.NewGuid().ToString(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logicInstanceData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InstanceLogicData(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instances = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, LogicComponent&gt;(); _logicInstances.Add(id, logicInstanceData); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Components.Items) { CreateComponent(componentData, instances, logicInstanceData.DisposableInstances, logicInstanceData.MonoBehaviourMethods); } logicStorage.Links.Items.Sort(SortingLinks); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicStorage.Links.Items) { CreateLink(linkData, instances); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> monoMethods <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstanceData.MonoBehaviourMethods.Values) { monoMethods.Sort(SortingMonoMethods); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; }</code> </pre> <br></div></div><br>  Pode-se ver no c√≥digo que, ap√≥s a cria√ß√£o da l√≥gica, os dados sobre ela s√£o armazenados em uma inst√¢ncia de uma classe especializada e, ap√≥s o in√≠cio, um identificador exclusivo para a inst√¢ncia da l√≥gica √© retornado. <br><br><div class="spoiler">  <b class="spoiler_title">Este identificador √© necess√°rio para chamar a fun√ß√£o de parada e limpeza da mem√≥ria.</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StopLogicInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> instanceId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_logicInstances.ContainsKey(instanceId)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logicInstance = _logicInstances[instanceId]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> disposableInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstance.DisposableInstances) { disposableInstance.Dispose(); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> componentInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstance.ComponentInstances) { Destroy(componentInstance); } logicInstance.ComponentInstances.Clear(); logicInstance.DisposableInstances.Clear(); logicInstance.MonoBehaviourMethods.Clear(); _logicInstances.Remove(instanceId); }</code> </pre> <br></div></div><br><h4>  Desligando a cena e limpando a mem√≥ria </h4><br>  Ao criar um <b>ScriptableObject</b> em uma cena em execu√ß√£o via <b>ScriptableObject.CreateInstance</b> , a inst√¢ncia se comporta da mesma forma que <b>MonoBehaviour</b> , ou seja, ao descarregar da cena, o <b>OnDestroy</b> ser√° chamado para cada um e ser√° exclu√≠do da mem√≥ria.  No entanto, como foi dito em um artigo anterior, um componente pode herdar <b>IDisposable</b> , ent√£o eu o limpo no m√©todo <b>OnDisable</b> : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDisable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> disposable <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _disposableInstances) { disposable.Dispose(); } _disposableInstances.Clear(); _monoBehaviourMethods.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logicInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _logicInstances.Values) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> disposableInstance <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> logicInstance.DisposableInstances) { disposableInstance.Dispose(); } logicInstance.DisposableInstances.Clear(); logicInstance.ComponentInstances.Clear(); logicInstance.MonoBehaviourMethods.Clear(); } _logicInstances.Clear(); _instance = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br>  <b>Nota</b> : como voc√™ pode ver, se houver inst√¢ncias l√≥gicas no momento do descarregamento da cena, a limpeza ocorre nelas. <br><br><h3>  Problema e solu√ß√£o com objetos do Unity </h3><br>  Na primeira parte do artigo sobre o editor visual, mencionei o problema de manter links para objetos de cena, o que est√° relacionado √† incapacidade de restaurar dados serializados.  Isso se deve ao fato de o identificador exclusivo dos objetos da cena ser diferente cada vez que a cena √© iniciada.  A solu√ß√£o para esse problema √© a √∫nica op√ß√£o - isso √© transferir o armazenamento de links na cena.  Para esse prop√≥sito, um reposit√≥rio especializado e uma classe de wrapper foram adicionados ao controlador l√≥gico atrav√©s do qual os componentes l√≥gicos recebem refer√™ncias aos objetos do <b>Unity</b> , incluindo recursos, pr√©-fabricados e outros ativos. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo para armazenamento</b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ObjectLinkData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; _id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UnityEngine.Object Obj =&gt; _obj; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _id = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UnityEngine.Object _obj; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ObjectLinkData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, UnityEngine.Object obj</span></span></span><span class="hljs-function">)</span></span> { _id = id; _obj = obj; } } [SerializeField] [HideInInspector] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;ObjectLinkData&gt; _objectLinks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ObjectLinkData&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UnityEngine.<span class="hljs-function"><span class="hljs-function">Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> linkData = _objectLinks.Find(link =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Compare(link.Id, id, StringComparison.Ordinal) == <span class="hljs-number"><span class="hljs-number">0</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> linkData?.Obj; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aqui: </font></font><br><br><ol><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Id</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - identificador exclusivo do ativo ou objeto de cena</font></font></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obj</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - link para objetos de ativos ou cenas</font></font></li></ol><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como voc√™ pode ver no c√≥digo, nada super complicado. </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora considere uma classe de wrapper para objetos do Unity</font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VLObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; _id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UnityEngine.Object Obj { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_obj == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !_objNotFound) { _obj = Core.LogicController.Instance.GetObject(Id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_obj == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _objNotFound = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _obj; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UnityEngine.Object _obj; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _objNotFound; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VLObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VLObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UnityEngine.Object obj</span></span></span><span class="hljs-function">)</span></span> { _obj = obj; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Get&lt;T&gt;() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : UnityEngine.Object { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T; } }</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : o sinalizador </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_objNotFound √©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> necess√°rio para n√£o procurar no reposit√≥rio todas as vezes, se n√£o houver nenhum objeto nele.</font></font><br></div></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Desempenho </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, acho que vale a pena insistir em uma quest√£o como produtividade. </font><font style="vertical-align: inherit;">Se voc√™ observar cuidadosamente todo o c√≥digo acima, poder√° entender que em um aplicativo j√° em execu√ß√£o, o sistema n√£o afeta a velocidade, ou seja, </font><font style="vertical-align: inherit;">tudo funcionar√° como o habitual aplicativo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Comparei a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atualiza√ß√£o do </font></font></b><font style="vertical-align: inherit;"></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MonoBehaviour</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usual </font><font style="vertical-align: inherit;">e do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uViLEd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e n√£o consegui pelo menos nenhuma diferen√ßa que pudesse ser indicada aqui; todos os n√∫meros t√™m paridade de at√© 1000 chamadas por quadro. </font><font style="vertical-align: inherit;">O √∫nico gargalo √© a velocidade de carregamento da cena, mas mesmo aqui n√£o consegui obter n√∫meros significativos, embora entre as plataformas (verifiquei </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) a diferen√ßa √© grande. </font><font style="vertical-align: inherit;">Na l√≥gica de 70 componentes e cerca de 150 conex√µes (incluindo refer√™ncias a vari√°veis), os n√∫meros eram os seguintes:</font></font><br><br><ol><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (MediaTek 8 n√∫cleos muito med√≠ocre) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- No in√≠cio do aplicativo - ~ 750ms </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Executando a cena no aplicativo em execu√ß√£o ~ 250ms</font></font><br></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (iPhone 5s) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- No in√≠cio do aplicativo - ~ 100ms </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Executando a cena no aplicativo em execu√ß√£o ~ 50ms</font></font><br></li></ol><br><h2>  Conclus√£o </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A arquitetura do kernel do sistema </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uViLEd √©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bastante simples e direta, n√£o √© aconselh√°vel us√°-lo indiretamente a partir do editor visual, embora eu n√£o exclua que algumas solu√ß√µes ser√£o √∫teis para algu√©m. </font><font style="vertical-align: inherit;">No entanto, este artigo √© importante para uma compreens√£o geral de como o sistema funciona, cuja √∫ltima parte importante √© o pr√≥prio editor. </font><font style="vertical-align: inherit;">E a √∫ltima parte final da s√©rie, que ser√° a mais movimentada, ser√° dedicada a isso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS: a reda√ß√£o do artigo foi muito longa, pela qual pe√ßo desculpas. </font><font style="vertical-align: inherit;">Inicialmente, planejei liberar todas as partes restantes de uma s√≥ vez, mas o lan√ßamento de novas vers√µes do Unity 3d, bem como choques vitais (agrad√°veis ‚Äã‚Äãe n√£o t√£o), mudaram os planos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Üí </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Editor de l√≥gica visual para Unity3d.</font></font></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt466187/">https://habr.com/ru/post/pt466187/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt466169/index.html">Oferta especial para estudantes trabalhadores da JetBrains</a></li>
<li><a href="../pt466171/index.html">Cinco raz√µes para escolher o JUG.EKB</a></li>
<li><a href="../pt466179/index.html">fform: React & JSONSchema - flexibilidade m√°xima</a></li>
<li><a href="../pt466181/index.html">Python de C (API C)</a></li>
<li><a href="../pt466183/index.html">Algoritmos de processamento inteligente de strings no ClickHouse</a></li>
<li><a href="../pt466191/index.html">A principal coisa sobre a batalha pela neutralidade da rede nos EUA √© a cronologia dos eventos e o estado atual das coisas</a></li>
<li><a href="../pt466193/index.html">Feed autom√°tico personalizado do MailChimp a partir do feed RSS</a></li>
<li><a href="../pt466195/index.html">PVS-Studio 7.04</a></li>
<li><a href="../pt466197/index.html">PVS-Studio 7.04</a></li>
<li><a href="../pt466199/index.html">Bloqueios no PostgreSQL: 4. Bloqueios na mem√≥ria</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>