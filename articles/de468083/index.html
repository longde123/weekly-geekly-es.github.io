<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👀 👩🏿 🧑🏾‍🤝‍🧑🏽 Android Camera2 API aus dem Wasserkocher 🎅 🦗 👩🏿‍🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor nicht allzu langer Zeit war ich mit meinem Roboter beschäftigt und versuchte, ein ANDROID-Smartphone darauf zu setzen. Meine, das heißt seine Aufg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Android Camera2 API aus dem Wasserkocher</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468083/"><img src="https://habrastorage.org/webt/kk/8_/gf/kk8_gf5d1vt1kyxcb_vkbjqwpnk.jpeg"><br><br>  Vor nicht allzu langer Zeit war ich mit meinem Roboter beschäftigt und versuchte, ein ANDROID-Smartphone darauf zu setzen.  Meine, das heißt seine Aufgabe war es, den Wagen evolutionär weiterzuentwickeln.  Damit sie sozusagen die Welt mit seinen Sensoren fühlen, ihn mit ihrem Auge (Kamera) ansehen, mit einem Mikrofon hören und über die Freisprecheinrichtung schwören konnte.  AVR-Ressourcen reichten natürlich nicht aus, und so bewegte sich der Mikrocontroller auf dem Wagen auf eine niedrigere Ebene, irgendwo im Rückenmark, um Motoren und verschiedene unkonditionierte Reflexe zu steuern. <br><br>  Aber eine seltsame Sache, als ich anfing, eine Anwendung für ein Smartphone zu schreiben, begann ein schlechtes IDE ANDROID STUDIO, meinen Code ständig zu streichen und ihn als veraltet zu bezeichnen. <br><br>  Kamera = <s>Kamera.</s>  open (); <br><br>  Besonders, wie Sie sehen können, in den Bereichen, in denen ich versucht habe, mit der Kamera zu arbeiten.  Es war sehr enttäuschend, weil ich im Internet gelesen und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> und sogar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> viele Lektionen über die Arbeit mit Android und Kamera gelernt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habe</a> .  Da draußen war nichts durchgestrichen.  Und es wurde die Kamera-API genannt.  Alles dort war einfach und logisch.  Aber Google hat mich hartnäckig zu einer Art <a href="">Camera2-API getrieben</a> . <br><br>  Ich habe dort nachgesehen und bin einfach in Schwierigkeiten mit der Anzahl der verschiedenen Rückrufe, Builder, Handler und Loopers für jede Zeile des Demo-Codes geraten.  Es war völlig unverständlich, wie man das angehen sollte, wenn man ein gewöhnlicher Amateur und kein Android-Entwickler ist.  Darüber hinaus gibt es heute sogar einige Artikel über die Camera2-API im Netzwerk, obwohl dieses Update wie vor vier Jahren zu sein schien.  Aber alles, was ich fand, war ein Artikel in Hacker im Jahr 2016, ein dreiteiliger Beitrag von ukrainischen Brüdern desselben Jahres, ein doppelter Beitrag über Habré im Jahr 2017 und ein Artikel Understanding Camera2 vom japanischen Megaphon Tomoaki Imai.  Und damit meine ich auch einige strukturierte und formalisierte Informationen und keine Codeausschnitte wie „Sehen, wie ich kann“ und Blätter im Stil „Schauen Sie sich das Code-Pliz an, nichts funktioniert für mich“, die im Internet verstreut sind. <br><br>  Und jetzt, wenn Sie sich immer noch fragen, warum ich meinen Beitrag zu diesem Thema kürzen musste <br>  schon 2019, dann willkommen bei cat. <br><a name="habracut"></a><br>  Eigentlich hat mir der Artikel vom Hacker gefallen, weil er mir zumindest einen Überblick darüber gab, warum zum Teufel das neue Paradigma der Arbeit mit der Kamera eingeführt wurde.  Es wurde auch klar, warum einige neue Methoden benötigt wurden, die nicht in der vorherigen API enthalten waren.  Es war jedoch völlig unmöglich, ein Arbeitsprogramm für diesen Artikel zu schreiben, da die Autoren anscheinend wie echte Hacker nur die Namen der Methoden zitierten. Vielleicht gibt es noch ein paar Zeilen zusätzlichen Codes.  Aber das war mir kategorisch nicht genug. <br><br>  Der Beitrag auf Habré war gut, ich behaupte nicht, und ich habe sogar die ersten Absätze verstanden, aber das war der Punkt, weil der Autor des Beitrags die Kamera mit RxJava2 besiegt hat, was mich automatisch von der Anzahl weiterer Leser ausgeschlossen hat.  Normalerweise würde ich mich mit OOP befassen, aber hier ist eine Art reaktive Programmierung. <br><br>  Der japanische Artikel war noch besser, auch wenn er nicht in seiner Muttersprache schrieb.  Aber ich kenne Kotlin auch nicht, obwohl ich mich natürlich für die einheimischen Entwickler freute und die Kürze seiner Syntax im Gegensatz zu den JAVA-Fadennudeln auf der Google-Entwicklerseite schätzte (mit dieser Seite war mir übrigens auch klar, dass es dort war eindeutig nicht viel). <br><br>  Der letzte Artikel, der mir praktischen Nutzen brachte, war ein dreiteiliger Beitrag aus der brüderlichen Ukraine.  Ich habe dort sogar etwas gestartet und dort etwas gesehen.  Leider war der Autor des Artikels im dritten Teil sehr müde und begann auch, Code in Fragmenten herauszugeben, die nicht zu meinem gesamten Arbeitsleben passten.  Außerdem war der Autor am Ende völlig verärgert, weil er das Bild der falschen Farbpalette bekam, für die er zählte. <br><br><img src="https://habrastorage.org/webt/de/zn/rn/deznrnniikuzh8w4k1fdmxxbikq.jpeg"><br><br>  Angenommen, die Version von Lollipop ist 5.0 und es gibt einen Fehler.  Sie müssen auf Lollipop 5.1 aktualisieren und dann ist alles in Ordnung.  Aber irgendwie noch nicht.  Und auch schädliche Ukrainer, die am JAVA SCRIPT-Artikel befestigt waren, und beim Kopieren des Codes wurde eine wilde Menge Müll in den Programmtext gegossen.  Leute, das kannst du nicht ... Ich musste ein spezielles Plug-In in Firefox installieren. <br><br>  Deshalb musste ich das gefallene Banner aufheben und den Job bis zum Ende beenden, was natürlich eine titanische mentale Anstrengung erforderte.  Und da es irgendwie schade war, nur mit der Erkenntnis zufrieden zu sein, dass ein Arbeitsergebnis erzielt wurde, wollte ich es mit Amateur-Teekannen teilen.  Darüber hinaus ist dies noch lange nicht das Ende der Geschichte.  Ich muss noch lernen, wie man Live-Videos von der Android-Kamera auf den Computer überträgt (der Roboter muss sich entwickeln, das ist das Gesetz der Evolution) und nicht in Stücken, wie ich geblendet habe, sondern reibungslos.  Und es gibt solche Mont-Blanc-Hindernisse in Form von Mediencodecs und anderen Dingen, die nur Weißblech enthalten. <br><br>  Andererseits kann das Ganze zu völliger Enttäuschung führen.  Und nicht, weil sie den Mont Blanc nicht besteigen können. <br><br><div class="spoiler">  <b class="spoiler_title">Und weil Hersteller von Smartphones jetzt völlig neue Ansätze für die Kameraherstellung entwickeln.</b> <div class="spoiler_text">  <i>Vor einem Monat gab es ein Gerücht über Nokia-Smartphones mit fünf Hauptkameras.</i>  <i>Wie soll man damit umgehen?</i>  <i>Ein interessantes und vielversprechendes Gerücht oder eine andere seltsame Sache?</i>  <i>Unabhängig davon, wie einzigartig ein solches Design aussehen mag, wird Nokia sicherlich kein Pionier bei der Einführung einer ungewöhnlichen Anzahl von Objektiven und Sensoren in kompakte Geräte sein können.</i>  <i>Die Light L16-Kamera war bereits 2015 mit 16 Objektiven ausgestattet, und das Unternehmen hat offensichtlich einen neuen Prototyp in Betrieb.</i>  <i>Oben sehen Sie, wie es möglicherweise aussehen könnte.</i> <i><br><br></i>  <i>Nach dem Erscheinen der Dreifachkamera im Huawei P20 Pro klingt der Übergang zu einem Smartphone mit fünf Kameras nicht mehr so ​​komisch wie vor ein paar Jahren.</i>  <i>Die Hauptfrage bleibt jedoch: Worum geht es?</i> <i><br></i>  <i>Was tun mit so vielen Objektiven?</i> <i><br><br></i>  <i>Das erste, was mir in den Sinn kommt, ist die Vielfalt der auf dem modernen Smartphone-Markt verfügbaren Arten von Kamerasensoren und die Möglichkeit, weitere hinzuzufügen.</i>  <i>Warum zwischen Weitwinkel, Tele, Porträt mit Bokeh oder Monochrom wählen, wenn Sie all dies in einem Gerät erhalten können?</i> <i><br><br></i>  <i>Da ein solches Design theoretisch möglich wäre, wäre es ziemlich umständlich, es zu verwenden.</i>  <i>Die Software muss automatisch zwischen den Modi wechseln oder dem Benutzer eine Reihe komplexer Optionen anbieten.</i>  <i>Darüber hinaus wäre die Entwicklung eines solchen Designs für alle zweifelhaften Vorteile einer solchen Lösung sehr teuer.</i>  <i>Jede Kamera würde größtenteils unabhängig voneinander funktionieren, und es war unwahrscheinlich, dass Käufer eine große Anzahl von Modi verwenden würden.</i>  <i>Und es ist nicht klar, wie viel sie bereit wären, für solche Funktionen zu bezahlen.</i>  <i>Kameras mit mehreren Modulen sollten daher mehr tun können, um den Benutzer anzulocken.</i> <i><br><br></i>  <i>Huawei P20 Pro bietet bereits seine Version an, wie mehrere Kameramodule zusammenarbeiten können, um ein interessantes Ergebnis zu erzielen.</i>  <i>Wir sprechen über Technologien von Huawei wie Monochrom und Hybrid Zoom.</i>  <i>Der erste verbessert den Dynamikbereich von Standardframes, indem reguläre RGB-Daten mit einem lichtempfindlichen Schwarzweißsensor kombiniert werden.</i>  <i>Und Hybrid Zoom verspricht noch mehr: Es kombiniert Daten von mehreren Kameras, um die Auflösung des Bildes für einen besseren Zoom zu erhöhen.</i>  <i>Beim P20 Pro 8 MP können Sie mit dem Teleobjektivsensor mit einer Auflösung von 10 MP bei 3- und 5-fachem Zoom aufnehmen.</i> <i><br></i>  <i>Höhere Auflösung - mehr Flexibilität</i> <i><br><br></i>  <i>Die erste Light L16-Kamera funktionierte ähnlich und verwendete Periskopspiegel, um die Kameramodule in ein kompaktes Gehäuse einzubauen.</i>  <i>Die Kamera nahm je nach Zoomstufe Daten von mehreren Modulen mit 28, 70 und 150 mm auf.</i>  <i>Das Ergebnis war eine große 52-MP-Aufnahme aus 10 leicht unterschiedlichen Winkeln bei einer Vergrößerung von bis zu 5x.</i>  <i>Das für Smartphones entwickelte Konzept des neuen Modells funktioniert mit 5-9 Objektiven.</i>  <i>Ein solches Kameramodul kann große 64-Megapixel-Bilder aufnehmen.</i> <i><br><br></i>  <i>Diese Idee der Mehrfachaufnahme bietet auch Vorteile bei Aufnahmen bei schlechten Lichtverhältnissen und in HDR mit mehreren Blendenöffnungen.</i>  <i>Der hochwertige Effekt der Rahmentiefe ist auch durch die gleichzeitige Software-Emulation und die Verwendung mehrerer Brennweiten möglich.</i> <i><br><br></i>  <i>Light L16 brachte Enttäuschung, aber die Idee selbst war vielversprechend.</i>  <i>Und die nächste Generation mit Erfolg könnte sich als lohnenswert erweisen.</i>  <i>Das Unternehmen behauptet, dass Ende des Jahres ein Smartphone angekündigt wird, auf dem die neueste Lösung mit mehreren Objektiven installiert wird.</i> <i><br><br></i>  <i>Dieselbe Idee lässt sich auf die Erfahrung von Nokia bei der Implementierung mehrerer Kameras zurückführen, wenn man bedenkt, dass 2013 in Pelican Imaging investiert wurde.</i>  <i>Im Gegensatz zu Licht ist der Sensor hier viel kleiner.</i>  <i>Trotzdem verspricht die Technologie sehr ähnliche Vorteile, einschließlich der Änderung des Softwarefokus, der Tiefenmessung und der Vergrößerung des endgültigen Bildes.</i>  <i>Leider hat Tessera das Unternehmen im Jahr 2016 gekauft, aber die Idee selbst hat die Nokia-Ingenieure möglicherweise nicht verlassen.</i> <i><br><br></i>  <i>Zeiss, der derzeitige Fotopartner von Nokia, hat ein Patent für umschaltbaren Zoom, aber wir haben noch nichts von ihnen über das Design mit mehreren Objektiven gehört.</i>  <i>Vielleicht sieht der andere Partner von Nokia, FIH Mobile, vielversprechender aus.</i>  <i>Dieses Unternehmen gehört Foxconn, bringt Nokia-Handys auf den Markt und investierte 2015 in Light, um eine Lizenz zur Nutzung der Technologie zu erhalten.</i> <i><br><br></i>  <i>Und wenn Sie der Meinung sind, dass das Nokia-Leck und der Light-Prototyp etwas gemeinsam haben, ist dies kein Zufall.</i>  <i>Verbindet die beiden Foxconn-Unternehmen.</i>  <i>Wird das Nokia-Smartphone das erste sein, das Technologie von Light verwendet?</i> <i><br></i>  <i>Also ist das die Zukunft?</i> <i><br><br></i>  <i>Ultrahohe Auflösung ist kein neues Konzept. 2014 verwendete Oppo Find 7 ein ähnliches Prinzip, und der Hybrid Zoom von Huawei ermöglichte es der Technologie, mit mehreren Kameras zu arbeiten.</i>  <i>In der Vergangenheit bestand das Hauptproblem der Technologie in hohen Leistungsanforderungen, Algorithmusqualität und Stromverbrauch.</i>  <i>Auf der Seite moderner Smartphones stehen jedoch leistungsstärkere Signalverarbeitungsprozessoren, energieeffiziente DSP-Chips und sogar verbesserte Funktionen neuronaler Netze zur Verfügung, was die Bedeutung des Problems allmählich verringert.</i> <i><br><br></i>  <i>Hohe Detailgenauigkeit, optische Zoomfunktionen und ein benutzerdefinierter Bokeh-Effekt stehen ganz oben auf der Liste der Kameraanforderungen für ein modernes Smartphone, und die Multi-Kamera-Technologie kann dazu beitragen.</i>  <i>Anstatt verschiedene Funktionen mit separaten Kameras auszuführen, besteht die Zukunft der mobilen Fotografie darin, mehrere Kameras zu kombinieren, um erweiterte und flexiblere Funktionen bereitzustellen.</i> <i><br><br></i>  <i>Es gibt noch Fragen zur Lichttechnologie, insbesondere zum Kleben von Bildern mit unterschiedlichen Brennweiten.</i>  <i>Wir können nur warten - wir werden sehen, was sich in der zweiten Generation der Technologie zum Besseren wenden wird.</i> <br></div></div><br><img src="https://habrastorage.org/webt/ln/qn/nu/lnqnnu7rqgiqupxpqtveattncmw.jpeg"><br><br>  Es wird nicht einfach sein, eine solche Baugruppe über Kameras mit Griffen im Programm zu konfigurieren.  Vielleicht wird der Kreis geschlossen, und um ein Bild aufzunehmen, müssen wir erneut eine explizite Absicht mit dem Inhalt schreiben, z. B. „Kamera, bitte machen Sie das Bild selbst, wie Sie können, aber wunderschön, und geben Sie es mir in meiner Aktivität zurück“. <br><br>  Aber für den Moment haben wir noch ein wenig.  Deshalb fahren wir sofort fort. <br><br>  <b>Warum brauchte all das Google?</b> <br><br>  Es scheint, dass das Ganze sicheres und korrektes Multithreading ist (und es wird auch möglich, alle Arten von Effekten und Filtern direkt auszuführen).  Wenn Sie in Vanilla JAVA bei Bedarf Mutexe, Synchronisationen und Semaphoren überall kompetent pushen müssen, übernimmt Google hier fast alles.  Sie müssen nur Rückrufe im Programmtext registrieren, die bei Bedarf aufgerufen werden.  Das heißt, Sie senden beispielsweise eine Anfrage zum Einschalten der Kamera: <br><br><pre><code class="java hljs">mCameraManager.openCamera()</code> </pre> <br>  Aber das ist kein Team, das ist eine Bitte.  Sie können nicht sofort mit der Kamera arbeiten.  Erstens braucht sie Zeit, um sich einzuschalten, und zweitens hat der Android so viele wichtige Dinge zu tun, und Ihr Wunsch wird in eine ziemlich große Warteschlange gestellt.  Aber dann müssen wir nicht warten, bis sich die Kamera in einer Schleife im Hauptthread öffnet und die gesamte Anwendung aufhängt (wir erinnern uns immer noch, was im UI-Stream getan werden kann und was nicht).  Daher senden wir unseren Wunsch und öffnen, während wir unserem Geschäft nachgehen, die Ansichten, schreiben „Hallo Welt“, konfigurieren Schaltflächenhandler und dergleichen. <br><br>  In der Zwischenzeit, nach einigen zehn und hundert Millisekunden, erreicht das Betriebssystem endlich die Hände der Kamera und initialisiert sie.  Und sobald die Kamera bereit ist, wird der gleiche Rückruf ausgelöst (es sei denn, Sie haben ihn natürlich im Voraus registriert). <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CameraDevice.StateCallback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpened</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraDevice camera)</span></span></span><span class="hljs-function"> </span></span>{ mCameraDevice = camera; createCameraPreviewSession(); ….. }</code> </pre><br>  Das heißt, die Kamera ist jetzt geöffnet und kann dort etwas tun: Zeigen Sie das Bild von der Kamera in der Ansicht an, leiten Sie es zum Speichern weiter und so weiter. <br><br>  Infolgedessen läuft die gesamte Arbeit mit der Kamera darauf hinaus, alle Arten von Rückrufen zu verschreiben.  In ihrem edlen Wunsch gingen die Entwickler von Google jedoch etwas zu weit und, wie der japanische Genosse richtig bemerkte: <br><blockquote>  Einer der Gründe, warum Camera2 ratlos ist, ist die Anzahl der Rückrufe, die Sie für eine Aufnahme benötigen. </blockquote><br>  Das reicht aber nicht.  Das vollständige Schema der Kamera hat diesen fantastischen Look <br><br><img src="https://habrastorage.org/webt/ko/kb/ju/kokbjuymle88yzzedcutreymxks.jpeg"><br><br>  Glücklicherweise kann es für den Anfang auf ein viel attraktiveres Bild reduziert werden. <br><br><img src="https://habrastorage.org/webt/h4/zh/fs/h4zhfsjakuuzgsnil1sfjo44vla.png"><br><br>  Dort ist zwar alles auf Englisch, aber wie sie sagen, ist es ohne Worte klar.  Für den Anfang haben wir genug von diesem Design.  Wir werden die Kamera öffnen, das Bild auf dem Smartphone-Bildschirm anzeigen, ein Bild aufnehmen und sobald es fertig ist (Rückrufe erneut), wird der Hörer dieses Ereignisses arbeiten und das Bild in eine Datei schreiben. <br><br>  <b>Erste Schritte beim Erstellen von Code</b> <br><br>  Wir werden ein neues Projekt in der Android Studio-IDE erstellen, die Mindestversion von SDK 22 auswählen, um grüne Bilder zu vermeiden, und leere Aktivitäten bestellen (oder noch besser Version 23, da sonst Probleme mit Berechtigungen auftreten können).  Genug für den Anfang.  Auch die Berechtigungen im Manifest müssen noch nicht erfüllt werden. <br><br>  Wir beginnen mit der Erstellung einer Instanz der CameraManager-Klasse.  Dies ist ein Systemdienstmanager, mit dem Sie verfügbare Kameras finden, deren für die Arbeit erforderliche Eigenschaften abrufen und Aufnahmeeinstellungen für Kameras festlegen können. <br><br>  Und wir werden die folgenden Eigenschaften sehen: <br><br>  Kamera-ID (0, 1, 2 ....) <br>  Richtung, in die die Kamera gerichtet ist (vorwärts, rückwärts) <br>  Kameraauflösung <br><br>  Zuerst erhalten wir die Liste der Kameras in Form eines String-Arrays, drucken dann die erforderlichen Merkmale in einer Schleife und schreiben sie in das Protokoll. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.camera; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.annotation.RequiresApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.appcompat.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.ImageFormat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraAccessException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraCharacteristics; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.params.StreamConfigurationMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Size; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String LOG_TAG = <span class="hljs-string"><span class="hljs-string">"myLogs"</span></span>; String[] myCameras = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraManager mCameraManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@RequiresApi</span></span>(api = Build.VERSION_CODES.M) <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      myCameras = new String[mCameraManager.getCameraIdList().length]; //     for (String cameraID : mCameraManager.getCameraIdList()) { Log.i(LOG_TAG, "cameraID: "+cameraID); int id = Integer.parseInt(cameraID); // e   CameraCharacteristics cc = mCameraManager.getCameraCharacteristics(cameraID); //    ,    StreamConfigurationMap configurationMap = cc.get(CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP); //      int Faceing = cc.get(CameraCharacteristics.LENS_FACING); if (Faceing == CameraCharacteristics.LENS_FACING_FRONT) { Log.i(LOG_TAG,"Camera with ID: "+cameraID + " is FRONT CAMERA "); } if (Faceing == CameraCharacteristics.LENS_FACING_BACK) { Log.i(LOG_TAG,"Camera with: ID "+cameraID + " is BACK CAMERA "); } //        jpeg Size[] sizesJPEG = configurationMap.getOutputSizes(ImageFormat.JPEG); if (sizesJPEG != null) { for (Size item:sizesJPEG) { Log.i(LOG_TAG, "w:"+item.getWidth()+" h:"+item.getHeight()); } } else { Log.i(LOG_TAG, "camera don`t support JPEG"); } } } catch(CameraAccessException e){ Log.e(LOG_TAG, e.getMessage()); e.printStackTrace(); } } }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Das Protokoll wird ungefähr so ​​aussehen:</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.489</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: cameraID: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.504</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: Camera with: ID <span class="hljs-number"><span class="hljs-number">0</span></span> is BACK CAMERA <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4000</span></span> h:<span class="hljs-number"><span class="hljs-number">3000</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4000</span></span> h:<span class="hljs-number"><span class="hljs-number">2250</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">3840</span></span> h:<span class="hljs-number"><span class="hljs-number">2160</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2592</span></span> h:<span class="hljs-number"><span class="hljs-number">1944</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2592</span></span> h:<span class="hljs-number"><span class="hljs-number">1940</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2048</span></span> h:<span class="hljs-number"><span class="hljs-number">1536</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1920</span></span> h:<span class="hljs-number"><span class="hljs-number">1080</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1600</span></span> h:<span class="hljs-number"><span class="hljs-number">1200</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1440</span></span> h:<span class="hljs-number"><span class="hljs-number">1080</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1440</span></span> h:<span class="hljs-number"><span class="hljs-number">720</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">960</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">768</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">720</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">400</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">800</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">720</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">640</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">360</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">320</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">352</span></span> h:<span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">320</span></span> h:<span class="hljs-number"><span class="hljs-number">240</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">240</span></span> h:<span class="hljs-number"><span class="hljs-number">320</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.507</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">176</span></span> h:<span class="hljs-number"><span class="hljs-number">144</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.507</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">144</span></span> h:<span class="hljs-number"><span class="hljs-number">176</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.507</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: cameraID: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.514</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: Camera with ID: <span class="hljs-number"><span class="hljs-number">1</span></span> is FRONT CAMERA <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.515</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4224</span></span> h:<span class="hljs-number"><span class="hljs-number">3136</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.515</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4224</span></span> h:<span class="hljs-number"><span class="hljs-number">2376</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4160</span></span> h:<span class="hljs-number"><span class="hljs-number">3120</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4160</span></span> h:<span class="hljs-number"><span class="hljs-number">2340</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4000</span></span> h:<span class="hljs-number"><span class="hljs-number">3000</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4000</span></span> h:<span class="hljs-number"><span class="hljs-number">2250</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">3840</span></span> h:<span class="hljs-number"><span class="hljs-number">2160</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2592</span></span> h:<span class="hljs-number"><span class="hljs-number">1944</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2592</span></span> h:<span class="hljs-number"><span class="hljs-number">1940</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2048</span></span> h:<span class="hljs-number"><span class="hljs-number">1536</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1920</span></span> h:<span class="hljs-number"><span class="hljs-number">1080</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1600</span></span> h:<span class="hljs-number"><span class="hljs-number">1200</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1440</span></span> h:<span class="hljs-number"><span class="hljs-number">1080</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1440</span></span> h:<span class="hljs-number"><span class="hljs-number">720</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">960</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">768</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">720</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">400</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">800</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">720</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">640</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">360</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">320</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">352</span></span> h:<span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">320</span></span> h:<span class="hljs-number"><span class="hljs-number">240</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">240</span></span> h:<span class="hljs-number"><span class="hljs-number">320</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">176</span></span> h:<span class="hljs-number"><span class="hljs-number">144</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">144</span></span> h:<span class="hljs-number"><span class="hljs-number">176</span></span></code> </pre><br></div></div><br>  Wir brauchen diese Informationen im Prinzip nicht wirklich, jede Teekanne weiß bereits von der vorherigen API, dass Kameras Identifikatoren von Null und darüber hinaus haben, dass Sie niemanden mit einer Auflösung von 1920 x 1080 überraschen werden, und noch mehr mit dem JPEG-Format.  Tatsächlich werden diese Daten bereits von einer „erwachsenen“ Anwendung benötigt, die für die Produktion bereit ist und auf deren Grundlage Menüs für den Benutzer ausgewählt werden können, und so weiter.  In unserem einfachsten Fall ist im Allgemeinen alles klar.  Aber da alle Artikel damit beginnen, werden wir beginnen. <br><br>  Nachdem wir sichergestellt haben, dass die vordere Kamera die Identifikationsnummer „1“ und die hintere „0“ hat (aus irgendeinem Grund sind sie im String-Format angegeben) und dass uns die Auflösung von 1920 x 1080 und das Speichern der JPG-Datei zur Verfügung stehen, werden wir den Angriff fortsetzen. <br><br>  <b>Wir erhalten die erforderlichen Berechtigungen</b> <br><br>  Zunächst müssen wir uns um eine Reihe von Berechtigungen kümmern.  Dazu müssen Sie Folgendes in das Manifest schreiben: <br><br><pre> <code class="java hljs"> &lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"android.permission.CAMERA"</span></span> /&gt; &lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"android.permission.WRITE_EXTERNAL_STORAGE"</span></span> /&gt;</code> </pre><br>  Die erste ist für die Kamera verständlich, die zweite dient zum Schreiben von Bildern in eine Datei (und dies ist keine externe Speicherkarte, wie es aus der Bedeutung des Wortes EXTERN hervorgeht, sondern ein ziemlich nativer Smartphone-Speicher). <br><br>  Android kümmert sich aber auch um uns. Ab der Lollipop-Version reichen die im Manifest angegebenen Berechtigungen nicht mehr aus.  Jetzt ist es erforderlich, dass der Benutzer seine Zustimmung zum Öffnen der Kamera und zum Schreiben von Daten in den Speicher genehmigt. <br><br>  Dazu müssen Sie im einfachsten Fall Folgendes hinzufügen: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); ……... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED || (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) ) { requestPermissions(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{Manifest.permission.CAMERA,Manifest.permission.WRITE_EXTERNAL_STORAGE}, <span class="hljs-number"><span class="hljs-number">1</span></span>); } …..</code> </pre><br>  Warum im einfachsten?  Weil es nicht notwendig ist, solche Dinge in einem UI-Stream zu tun.  Erstens hängt der Thread, während der Benutzer mit seinen ungeschickten Fingern auf den Bildschirm stößt, und zweitens kann die Anwendung im Allgemeinen abstürzen, wenn Sie die Kamera weiter initialisiert haben.  In diesem Demo-Fall ist alles in Ordnung, es wird jedoch generell vorgeschrieben, den gewünschten Rückruftyp für diesen Fall zu verwenden: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRequestPermissionsResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> requestCode, String[] permissions, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] grantResults)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (requestCode == MY_REQUEST_CODE_FOR_CAMERA) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (grantResults[<span class="hljs-number"><span class="hljs-number">0</span></span>] == PackageManager.PERMISSION_GRANTED) { startCameraActivity(); <span class="hljs-comment"><span class="hljs-comment">//     (  ) } } }</span></span></code> </pre><br>  Obwohl ich das alles vorher nicht wusste, habe ich die gewünschte Aktivität über AsyncTask gestartet und noch früher einen neuen Thread erstellt, wie in Java. <br><br>  <b>Kamera kochen</b> <br><br>  Der Einfachheit halber werden wir auf Anraten kluger Leute alles, was mit Kameras zu tun hat, in einer separaten Klasse herausnehmen und die CameraService-Klasse erstellen.  Dort platzieren wir die Initialisierung der Kameras und notieren dann alle erforderlichen Rückrufe. <br><br><pre> <code class="java hljs">….. CameraService[] myCameras = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraManager mCameraManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA2 = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); ….. } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CameraService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String mCameraID; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraDevice mCameraDevice = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraCaptureSession mCaptureSession; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CameraService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraManager cameraManager, String cameraID)</span></span></span><span class="hljs-function"> </span></span>{ mCameraManager = cameraManager; mCameraID = cameraID; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isOpen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mCameraDevice == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openCamera</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) { mCameraManager.openCamera(mCameraID,mCameraCallback,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (CameraAccessException e) { Log.i(LOG_TAG,e.getMessage()); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closeCamera</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mCameraDevice != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { mCameraDevice.close(); mCameraDevice = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } }</code> </pre><br>  Erstellen Sie im Hauptthread eine Instanz von mCameraManager und füllen Sie damit das Array der myCameras-Objekte.  In diesem Fall gibt es nur zwei davon - die Front- und die Selfie-Kamera. <br><br><pre> <code class="java hljs"> mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      myCameras = new CameraService[mCameraManager.getCameraIdList().length]; for (String cameraID : mCameraManager.getCameraIdList()) { Log.i(LOG_TAG, "cameraID: "+cameraID); int id = Integer.parseInt(cameraID); //     myCameras[id] = new CameraService(mCameraManager,cameraID); } } catch(CameraAccessException e){ Log.e(LOG_TAG, e.getMessage()); e.printStackTrace(); }</span></span></code> </pre><br>  In der öffentlichen void openCamera () -Methode sehen Sie die folgende Zeile: <br><br><pre> <code class="java hljs"> mCameraManager.openCamera(mCameraID,mCameraCallback,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre><br>  Von hier aus führt der Pfad zum ersten Rückruf des <b>CameraDevice-</b> Kamerastatus <b>.</b>  <b>StateCallback.</b>  Er wird uns mitteilen, ob die Kamera geöffnet oder geschlossen ist oder ob überhaupt nichts vorhanden ist, und einen Fehler melden.  Wir werden es in die Methoden der CameraService-Klasse schreiben. <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CameraDevice.StateCallback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpened</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraDevice camera)</span></span></span><span class="hljs-function"> </span></span>{ mCameraDevice = camera; Log.i(LOG_TAG, <span class="hljs-string"><span class="hljs-string">"Open camera with id:"</span></span>+mCameraDevice.getId()); createCameraPreviewSession(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDisconnected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraDevice camera)</span></span></span><span class="hljs-function"> </span></span>{ mCameraDevice.close(); Log.i(LOG_TAG, <span class="hljs-string"><span class="hljs-string">"disconnect camera with id:"</span></span>+mCameraDevice.getId()); mCameraDevice = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraDevice camera, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> error)</span></span></span><span class="hljs-function"> </span></span>{ Log.i(LOG_TAG, <span class="hljs-string"><span class="hljs-string">"error! camera id:"</span></span>+camera.getId()+<span class="hljs-string"><span class="hljs-string">" error:"</span></span>+error); } };</code> </pre><br>  Wenn die Kamera für den Betrieb verfügbar ist (die Methode public void onOpened (CameraDevice camera) {} hat funktioniert), schreiben wir dort unsere weiteren Aktionen, z. B. indem wir die Methode createCameraPreviewSession () aufrufen.  Es wird uns helfen, das Bild von der Kamera auf die Ansicht zu bringen und weiter damit zu arbeiten. <br><br>  <b>CreateCameraPreviewSession</b> <br><br>  Hier versuchen wir, ein Bild (Datenstrom) auf der mImageView-Textur anzuzeigen, die bereits im Layout definiert ist.  Sie können sogar bestimmen, mit welcher Auflösung in den Pixeln. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCameraPreviewSession</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SurfaceTexture texture = mImageView.getSurfaceTexture(); <span class="hljs-comment"><span class="hljs-comment">// texture.setDefaultBufferSize(1920,1080); Surface surface = new Surface(texture); try { final CaptureRequest.Builder builder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); builder.addTarget(surface); mCameraDevice.createCaptureSession(Arrays.asList(surface), new CameraCaptureSession.StateCallback() { @Override public void onConfigured(CameraCaptureSession session) { mCaptureSession = session; try { mCaptureSession.setRepeatingRequest(builder.build(),null,null); } catch (CameraAccessException e) { e.printStackTrace(); } } @Override public void onConfigureFailed(CameraCaptureSession session) { }}, null ); } catch (CameraAccessException e) { e.printStackTrace(); } }</span></span></code> </pre><br>  Und wenn dieselbe Sitzung fertig ist, wird der oben genannte Rückruf aufgerufen und wir beginnen mit dem Ausdruck der Googloder: „Anzeigen der Kameravorschau“.  Hier können diejenigen, die dies wünschen, die Autofokus- und Blitzeinstellungen anpassen, aber im Moment werden wir mit den Standardeinstellungen auskommen. <br><br>  <b>Erstellen Sie ein Layout</b> <br><br>  Jetzt müssen wir sozusagen die Farben auf der Leinwand skizzieren und ein brillantes Bild im Stil von erstellen <div class="spoiler">  <b class="spoiler_title">"Drei Bildschirmtasten und eine Ansicht."</b> <div class="spoiler_text"><pre> <code class="java hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>?&gt; &lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span> xmlns:app=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span> xmlns:tools=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/tools"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> tools:context=<span class="hljs-string"><span class="hljs-string">".MainActivity"</span></span>&gt; &lt;TextureView android:id=<span class="hljs-string"><span class="hljs-string">"@+id/textureView"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"356dp"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"410dp"</span></span> android:layout_marginTop=<span class="hljs-string"><span class="hljs-string">"32dp"</span></span> app:layout_constraintEnd_toEndOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintHorizontal_bias=<span class="hljs-string"><span class="hljs-string">"0.49"</span></span> app:layout_constraintStart_toStartOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintTop_toTopOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> /&gt; &lt;LinearLayout android:layout_width=<span class="hljs-string"><span class="hljs-string">"292dp"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"145dp"</span></span> android:layout_marginStart=<span class="hljs-string"><span class="hljs-string">"16dp"</span></span> android:orientation=<span class="hljs-string"><span class="hljs-string">"vertical"</span></span> app:layout_constraintBottom_toBottomOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintEnd_toEndOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintStart_toStartOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintTop_toBottomOf=<span class="hljs-string"><span class="hljs-string">"@+id/textureView"</span></span> app:layout_constraintVertical_bias=<span class="hljs-string"><span class="hljs-string">"0.537"</span></span>&gt; &lt;Button android:id=<span class="hljs-string"><span class="hljs-string">"@+id/button4"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"wrap_content"</span></span> android:text=<span class="hljs-string"><span class="hljs-string">" "</span></span> /&gt; &lt;Button android:id=<span class="hljs-string"><span class="hljs-string">"@+id/button5"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"wrap_content"</span></span> android:text=<span class="hljs-string"><span class="hljs-string">" "</span></span> /&gt; &lt;Button android:id=<span class="hljs-string"><span class="hljs-string">"@+id/button6"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"wrap_content"</span></span> android:text=<span class="hljs-string"><span class="hljs-string">" "</span></span> /&gt; &lt;/LinearLayout&gt; &lt;/androidx.constr</code> </pre><br></div></div><br><img src="https://habrastorage.org/webt/lr/nb/31/lrnb31_wiadanevvo9e_o79jfky.png"><br>  Der Prozess ist ziemlich trivial und jeder kann sich hier umdrehen, wie er will.  Aber die Namen der Schaltflächen direkt in das Layout zu schreiben, ist ebenfalls schlecht und in Arbeitsversionen ist dies nicht erforderlich. <br><br>  Dementsprechend erstellen wir in der Aktivität selbst Listener, dh Listener für Schaltflächen und Ansichten. <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera2 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonToMakeShot = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextureView mImageView = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@RequiresApi</span></span>(api = Build.VERSION_CODES.M) <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); ……... mButtonOpenCamera1 = findViewById(R.id.button1); mButtonOpenCamera2 = findViewById(R.id.button2); mButtonToMakeShot =findViewById(R.id.button3); mImageView = findViewById(R.id.textureView); mButtonOpenCamera1.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].closeCamera(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera(); } } }); mButtonOpenCamera2.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].closeCamera(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].openCamera(); } } }); mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    } }); ……..</span></span></code> </pre><br>  Die Tastenbelegung ergibt sich aus den Namen, wir lassen die dritte Taste für das zukünftige Bild. <br><br>  Und wenn Sie jetzt alle Codeteile zusammenbringen, dann <br><br><div class="spoiler">  <b class="spoiler_title">Holen Sie sich Folgendes:</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.camera; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.annotation.RequiresApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.appcompat.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.core.content.ContextCompat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.Manifest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.PackageManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.SurfaceTexture; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraAccessException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraCaptureSession; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraDevice; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CaptureRequest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.Surface; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.TextureView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String LOG_TAG = <span class="hljs-string"><span class="hljs-string">"myLogs"</span></span>; CameraService[] myCameras = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraManager mCameraManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA2 = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera2 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonToMakeShot = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextureView mImageView = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@RequiresApi</span></span>(api = Build.VERSION_CODES.M) <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Log.d(LOG_TAG, <span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED || (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) ) { requestPermissions(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{Manifest.permission.CAMERA,Manifest.permission.WRITE_EXTERNAL_STORAGE},<span class="hljs-number"><span class="hljs-number">1</span></span>); } mButtonOpenCamera1 = findViewById(R.id.button1); mButtonOpenCamera2 = findViewById(R.id.button2); mButtonToMakeShot =findViewById(R.id.button3); mImageView = findViewById(R.id.textureView); mButtonOpenCamera1.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2].isOpen()) {myCameras[CAMERA2].closeCamera();} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera(); } } }); mButtonOpenCamera2.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1].isOpen()) {myCameras[CAMERA1].closeCamera();} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].openCamera(); } } }); mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// if (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].makePhoto(); // if (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].makePhoto(); } }); mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE); try{ //      myCameras = new CameraService[mCameraManager.getCameraIdList().length]; for (String cameraID : mCameraManager.getCameraIdList()) { Log.i(LOG_TAG, "cameraID: "+cameraID); int id = Integer.parseInt(cameraID); //     myCameras[id] = new CameraService(mCameraManager,cameraID); } } catch(CameraAccessException e){ Log.e(LOG_TAG, e.getMessage()); e.printStackTrace(); } } public class CameraService { private String mCameraID; private CameraDevice mCameraDevice = null; private CameraCaptureSession mCaptureSession; public CameraService(CameraManager cameraManager, String cameraID) { mCameraManager = cameraManager; mCameraID = cameraID; } private CameraDevice.StateCallback mCameraCallback = new CameraDevice.StateCallback() { @Override public void onOpened(CameraDevice camera) { mCameraDevice = camera; Log.i(LOG_TAG, "Open camera with id:"+mCameraDevice.getId()); createCameraPreviewSession(); } @Override public void onDisconnected(CameraDevice camera) { mCameraDevice.close(); Log.i(LOG_TAG, "disconnect camera with id:"+mCameraDevice.getId()); mCameraDevice = null; } @Override public void onError(CameraDevice camera, int error) { Log.i(LOG_TAG, "error! camera id:"+camera.getId()+" error:"+error); } }; private void createCameraPreviewSession() { SurfaceTexture texture = mImageView.getSurfaceTexture(); texture.setDefaultBufferSize(1920,1080); Surface surface = new Surface(texture); try { final CaptureRequest.Builder builder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); builder.addTarget(surface); mCameraDevice.createCaptureSession(Arrays.asList(surface), new CameraCaptureSession.StateCallback() { @Override public void onConfigured(CameraCaptureSession session) { mCaptureSession = session; try { mCaptureSession.setRepeatingRequest(builder.build(),null,null); } catch (CameraAccessException e) { e.printStackTrace(); } } @Override public void onConfigureFailed(CameraCaptureSession session) { }}, null ); } catch (CameraAccessException e) { e.printStackTrace(); } } public boolean isOpen() { if (mCameraDevice == null) { return false; } else { return true; } } public void openCamera() { try { if (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) { mCameraManager.openCamera(mCameraID,mCameraCallback,null); } } catch (CameraAccessException e) { Log.i(LOG_TAG,e.getMessage()); } } public void closeCamera() { if (mCameraDevice != null) { mCameraDevice.close(); mCameraDevice = null; } } } @Override public void onPause() { if(myCameras[CAMERA1].isOpen()){myCameras[CAMERA1].closeCamera();} if(myCameras[CAMERA2].isOpen()){myCameras[CAMERA2].closeCamera();} super.onPause(); } }</span></span></code> </pre><br></div></div><br>  Wir laden, starten, arbeiten! <br><br>  Wenn Ihnen dies nicht ausreicht, kann der Aufnahmevorgang im Allgemeinen stark diversifiziert werden.  Unser japanischer Tomoaki zeigt und erklärt wie und bringt ein schönes Diagramm. <br><br><img src="https://habrastorage.org/webt/kq/ac/qv/kqacqvz6ctvbapmm3bzg-f1hcy8.png"><br><br>  Zunächst muss die Kamera fokussieren.  Dies verursacht normalerweise keine Probleme, erfordert jedoch manchmal mehrere Versuche, die auch über einen Rückruf implementiert werden. <br><br><pre> <code class="java hljs">CameraCaptureSession.StateCallback().</code> </pre><br>  Dann wechselt die Kamera in den Vorschau-Modus von PRECAPTURE.  Zu diesem Zeitpunkt berechnet die Kamera die Belichtung, den Weißabgleich und die Blende (ich wusste früher, was es in der Kindheit war, aber jetzt geht dieses Wissen verloren).  Manchmal kann ein Rückruf eine CONTROL_AE_STATE_FLASH_REQUIRED-Anforderung zurückgeben, was bedeutet, dass es schön wäre, den Flash einzuschalten.  Es kann übrigens automatisch eingeschaltet werden - setAutoFlash (mPreviewRequestBuilder). <br><br>  Wenn alle für die Aufnahme erforderlichen Parameter definiert sind, gibt der Rückruf den Status CONTROL_AE_STATE_CONVERGED zurück und signalisiert uns, dass die Kamera bereit ist, ein Bild aufzunehmen. <br><br>  Auf der googloid Seite ist all dies bereits in den Beispielen enthalten, und wenn Sie die Geduld haben, diese Minenfelder und Drahtzäune zu durchbrechen, dann ist Ehre für Sie. <br><br>  <b>Nehmen Sie ein Bild auf und speichern Sie es in einer Datei</b> <br><br>  Genau hier begann ich Probleme zu haben.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nein, nach dem obigen Blockdiagramm (nicht japanisch, sondern das vorherige) ist alles nicht sehr kompliziert. Wir warten darauf, dass die Kamera das Bild aufnimmt. Nach der Verarbeitung mit der CamerCaptureSession-Klasse steht sie als Surface-Objekt zur Verfügung, das wiederum mit der ImageReader-Klasse verarbeitet werden kann. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Wahrheit ist, dass es einige Zeit dauert, ein ImageReader-Objekt erneut zu erstellen. Wir warten auf diese Zeit im nächsten Listener namens OnImageAvailableListener. Und schließlich speichern wir mit Hilfe der Instanz der letzten ImageSaver-Klasse das Bild in einer Datei und natürlich auch asynchron, da ImageSaver hier ausführbar ist.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Problem war, dass ich diesen ImageReader nirgendwo anhängen konnte, da der Rückruf von CameraCaptureSession.StateCallback () bereits damit beschäftigt war, das Video in die Ansicht des Smartphones zu übertragen. </font><font style="vertical-align: inherit;">Und wenn ich eine neue Sitzung gemacht habe, hat Android die Anwendung vorhersehbar verflucht und zum Absturz gebracht. </font><font style="vertical-align: inherit;">Infolgedessen (fragen Sie mich nicht, wie) gelang es mir, das Pferd und das zitternde Reh in einer createCameraPreviewSession () -Methode zu überqueren, mit der das Kamerabild nur in der Ansicht angezeigt wurde. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier ist dieser Code vor:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCameraPreviewSession</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SurfaceTexture texture = mImageView.getSurfaceTexture(); Surface surface = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Surface(texture); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CaptureRequest.Builder builder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); builder.addTarget(surface); mCameraDevice.createCaptureSession(Arrays.asList(surface), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CameraCaptureSession.StateCallback() …….</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und hier ist er hinterher: </font></font><br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ImageReader mImageReader; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCameraPreviewSession</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mImageReader = ImageReader.newInstance(<span class="hljs-number"><span class="hljs-number">1920</span></span>,<span class="hljs-number"><span class="hljs-number">1080</span></span>,ImageFormat.JPEG,<span class="hljs-number"><span class="hljs-number">1</span></span>); mImageReader.setOnImageAvailableListener(mOnImageAvailableListener, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); SurfaceTexture texture = mImageView.getSurfaceTexture(); Surface surface = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Surface(texture); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CaptureRequest.Builder builder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); builder.addTarget(surface); mCameraDevice.createCaptureSession(Arrays.asList(surface, mImageReader.getSurface()), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CameraCaptureSession.StateCallback() ……</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Unterschied ist, abgesehen von der ImageReader-Instanzdefinition oben, fast schwer zu erkennen. </font><font style="vertical-align: inherit;">Gerade zur Oberfläche hinzugefügt, durch Komma getrennt mImageReader.getSurface () und fertig. </font><font style="vertical-align: inherit;">Aber bis Sie dazu kommen ... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Von diesem Moment an machten die Dinge mehr Spaß und Sie konnten die dritte Bildschirmtaste "Take a Picture" verwenden. </font><font style="vertical-align: inherit;">Wenn es gedrückt wird, wird die Methode makePhoto () aufgerufen (na ja, wer hätte das gedacht):</font></font><br><br><pre> <code class="java hljs"> mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].makePhoto(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].makePhoto(); } }); …… <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CameraService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePhoto</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// This is the CaptureRequest.Builder that we use to take a picture. final CaptureRequest.Builder captureBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE); captureBuilder.addTarget(mImageReader.getSurface()); CameraCaptureSession.CaptureCallback CaptureCallback = new CameraCaptureSession.CaptureCallback() { @Override public void onCaptureCompleted(@NonNull CameraCaptureSession session, @NonNull CaptureRequest request, @NonNull TotalCaptureResult result) { } }; mCaptureSession.stopRepeating(); mCaptureSession.abortCaptures(); mCaptureSession.capture(captureBuilder.build(), CaptureCallback, null); } catch (CameraAccessException e) { e.printStackTrace(); } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und unmittelbar danach schreiben wir den OnImageAvailableListener-Listener: </font></font><br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ImageReader.OnImageAvailableListener mOnImageAvailableListener = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImageReader.OnImageAvailableListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onImageAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ImageReader reader)</span></span></span><span class="hljs-function"> </span></span>{ { Toast.makeText(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>,<span class="hljs-string"><span class="hljs-string">"   "</span></span>, Toast.LENGTH_SHORT).show();} } };</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Während er nichts tut, signalisiert er einfach mit einem Toast, dass alles in Ordnung ist. Sie können das Bild in einer Datei speichern. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und dafür brauchen wir die Datei selbst:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CameraService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> File mFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), <span class="hljs-string"><span class="hljs-string">"test1.jpg"</span></span>);;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und auch ein spezielles Objekt der ImageSaver-Klasse, das Daten schnell von einem Bild in einen Bytepuffer und von dort in eine Binärdatei überträgt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Klasse ist statisch und ausführbar. </font><font style="vertical-align: inherit;">Deshalb platzieren wir es in MainActivity selbst:</font></font><br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImageSaver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runnable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> File mFile; ImageSaver(Image image, File file) { mImage = image; mFile = file; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ByteBuffer buffer = mImage.getPlanes()[<span class="hljs-number"><span class="hljs-number">0</span></span>].getBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bytes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[buffer.remaining()]; buffer.get(bytes); FileOutputStream output = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(mFile); output.write(bytes); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { mImage.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> != output) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output.close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { e.printStackTrace(); } } } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und damit es funktioniert, schreiben wir zusätzlich in den OnImageAvailableListener-Listener: </font></font><br><br><pre> <code class="java hljs">mBackgroundHandler.post(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImageSaver(reader.acquireNextImage(), mFile));</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WARTEN! </font><font style="vertical-align: inherit;">OH Scheiße !! </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist mBackgroundHandler noch ??? </font><font style="vertical-align: inherit;">Trotzdem funktionierte es perfekt ohne ihn. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tatsächlich ist die richtige Frage: Wie hat es überhaupt ohne funktioniert? </font><font style="vertical-align: inherit;">Denn wie in den Beispielen von Google dargelegt, bietet BackgroundHandler BackgroundThread, einen Thread, der im Hintergrund arbeitet und tatsächlich für die Kamera verantwortlich ist. </font><font style="vertical-align: inherit;">Und tatsächlich sollten wir uns gleich zu Beginn unserer Aktivität registrieren:</font></font><br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HandlerThread mBackgroundThread; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Handler mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startBackgroundThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mBackgroundThread = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandlerThread(<span class="hljs-string"><span class="hljs-string">"CameraBackground"</span></span>); mBackgroundThread.start(); mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler(mBackgroundThread.getLooper()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopBackgroundThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mBackgroundThread.quitSafely(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { mBackgroundThread.join(); mBackgroundThread = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InterruptedException e) { e.printStackTrace(); } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Darüber hinaus müssen Sie hier auch den Start und Stopp von BackgroundThread hinzufügen: </font></font><br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPause</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPause(); stopBackgroundThread(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onResume(); startBackgroundThread(); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der mBackgroundHandler muss zu allen Rückrufen hinzugefügt werden, für die ein Handler erforderlich ist, und bei denen wir, ohne uns Sorgen zu machen, stattdessen null geschrieben haben. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Interessanteste ist, dass wir diesen Hintergrund-Thread beim Öffnen der Anwendung NICHT starten, da dies aus dem Programmtext leicht ersichtlich ist. </font><font style="vertical-align: inherit;">Das heißt, es beginnt implizit und ohne unsere Hilfe. </font><font style="vertical-align: inherit;">Aber wir müssen es stoppen und in den Modi onPause () und onResume () ausführen. </font><font style="vertical-align: inherit;">Hier entsteht ein Widerspruch. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt wird das Bild erfolgreich in einer Datei gespeichert. </font><font style="vertical-align: inherit;">Dies lässt sich leicht überprüfen, indem Sie die Anwendung ausführen. </font><font style="vertical-align: inherit;">Wie das Sprichwort sagt, ist die Krone der Arbeit vor allem Auszeichnungen. </font></font><br><br><img src="https://habrastorage.org/webt/ax/lu/rq/axlurqxeo1_oba674iz9uos8hp0.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Bild liegt zwar irgendwie auf der Seite, aber dieses Problem zu lösen, ist die Aufgabe zukünftiger Generationen.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vollständige Auflistung des Programms</font></font></b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.camera; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.annotation.NonNull; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.annotation.RequiresApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.appcompat.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.core.content.ContextCompat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.Manifest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.PackageManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.ImageFormat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.SurfaceTexture; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraAccessException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraCaptureSession; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraDevice; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CaptureRequest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.TotalCaptureResult; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.Image; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.ImageReader; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Environment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Handler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.HandlerThread; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.Surface; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.TextureView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Toast; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.FileOutputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.ByteBuffer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String LOG_TAG = <span class="hljs-string"><span class="hljs-string">"myLogs"</span></span>; CameraService[] myCameras = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraManager mCameraManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA2 = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera2 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonToMakeShot = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextureView mImageView = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HandlerThread mBackgroundThread; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Handler mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startBackgroundThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mBackgroundThread = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandlerThread(<span class="hljs-string"><span class="hljs-string">"CameraBackground"</span></span>); mBackgroundThread.start(); mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler(mBackgroundThread.getLooper()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopBackgroundThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mBackgroundThread.quitSafely(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { mBackgroundThread.join(); mBackgroundThread = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InterruptedException e) { e.printStackTrace(); } } <span class="hljs-meta"><span class="hljs-meta">@RequiresApi</span></span>(api = Build.VERSION_CODES.M) <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Log.d(LOG_TAG, <span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED || (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) ) { requestPermissions(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{Manifest.permission.CAMERA,Manifest.permission.WRITE_EXTERNAL_STORAGE},<span class="hljs-number"><span class="hljs-number">1</span></span>); } mButtonOpenCamera1 = findViewById(R.id.button1); mButtonOpenCamera2 = findViewById(R.id.button2); mButtonToMakeShot =findViewById(R.id.button3); mImageView = findViewById(R.id.textureView); mButtonOpenCamera1.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2].isOpen()) {myCameras[CAMERA2].closeCamera();} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera(); } } }); mButtonOpenCamera2.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1].isOpen()) {myCameras[CAMERA1].closeCamera();} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].openCamera(); } } }); mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].makePhoto(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].makePhoto(); } }); mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      myCameras = new CameraService[mCameraManager.getCameraIdList().length]; for (String cameraID : mCameraManager.getCameraIdList()) { Log.i(LOG_TAG, "cameraID: "+cameraID); int id = Integer.parseInt(cameraID); //     myCameras[id] = new CameraService(mCameraManager,cameraID); } } catch(CameraAccessException e){ Log.e(LOG_TAG, e.getMessage()); e.printStackTrace(); } } public class CameraService { private File mFile = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), "test1.jpg");; private String mCameraID; private CameraDevice mCameraDevice = null; private CameraCaptureSession mCaptureSession; private ImageReader mImageReader; public CameraService(CameraManager cameraManager, String cameraID) { mCameraManager = cameraManager; mCameraID = cameraID; } public void makePhoto (){ try { // This is the CaptureRequest.Builder that we use to take a picture. final CaptureRequest.Builder captureBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE); captureBuilder.addTarget(mImageReader.getSurface()); CameraCaptureSession.CaptureCallback CaptureCallback = new CameraCaptureSession.CaptureCallback() { @Override public void onCaptureCompleted(@NonNull CameraCaptureSession session, @NonNull CaptureRequest request, @NonNull TotalCaptureResult result) { } }; mCaptureSession.stopRepeating(); mCaptureSession.abortCaptures(); mCaptureSession.capture(captureBuilder.build(), CaptureCallback, mBackgroundHandler); } catch (CameraAccessException e) { e.printStackTrace(); } } private final ImageReader.OnImageAvailableListener mOnImageAvailableListener = new ImageReader.OnImageAvailableListener() { @Override public void onImageAvailable(ImageReader reader) { mBackgroundHandler.post(new ImageSaver(reader.acquireNextImage(), mFile)); } }; private CameraDevice.StateCallback mCameraCallback = new CameraDevice.StateCallback() { @Override public void onOpened(CameraDevice camera) { mCameraDevice = camera; Log.i(LOG_TAG, "Open camera with id:"+mCameraDevice.getId()); createCameraPreviewSession(); } @Override public void onDisconnected(CameraDevice camera) { mCameraDevice.close(); Log.i(LOG_TAG, "disconnect camera with id:"+mCameraDevice.getId()); mCameraDevice = null; } @Override public void onError(CameraDevice camera, int error) { Log.i(LOG_TAG, "error! camera id:"+camera.getId()+" error:"+error); } }; private void createCameraPreviewSession() { mImageReader = ImageReader.newInstance(1920,1080, ImageFormat.JPEG,1); mImageReader.setOnImageAvailableListener(mOnImageAvailableListener, null); SurfaceTexture texture = mImageView.getSurfaceTexture(); texture.setDefaultBufferSize(1920,1080); Surface surface = new Surface(texture); try { final CaptureRequest.Builder builder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); builder.addTarget(surface); mCameraDevice.createCaptureSession(Arrays.asList(surface,mImageReader.getSurface()), new CameraCaptureSession.StateCallback() { @Override public void onConfigured(CameraCaptureSession session) { mCaptureSession = session; try { mCaptureSession.setRepeatingRequest(builder.build(),null,mBackgroundHandler); } catch (CameraAccessException e) { e.printStackTrace(); } } @Override public void onConfigureFailed(CameraCaptureSession session) { }}, mBackgroundHandler); } catch (CameraAccessException e) { e.printStackTrace(); } } public boolean isOpen() { if (mCameraDevice == null) { return false; } else { return true; } } public void openCamera() { try { if (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) { mCameraManager.openCamera(mCameraID,mCameraCallback,mBackgroundHandler); } } catch (CameraAccessException e) { Log.i(LOG_TAG,e.getMessage()); } } public void closeCamera() { if (mCameraDevice != null) { mCameraDevice.close(); mCameraDevice = null; } } } @Override public void onPause() { if(myCameras[CAMERA1].isOpen()){myCameras[CAMERA1].closeCamera();} if(myCameras[CAMERA2].isOpen()){myCameras[CAMERA2].closeCamera();} stopBackgroundThread(); super.onPause(); } @Override public void onResume() { super.onResume(); startBackgroundThread(); } private static class ImageSaver implements Runnable { /** * The JPEG image */ private final Image mImage; /** * The file we save the image into. */ private final File mFile; ImageSaver(Image image, File file) { mImage = image; mFile = file; } @Override public void run() { ByteBuffer buffer = mImage.getPlanes()[0].getBuffer(); byte[] bytes = new byte[buffer.remaining()]; buffer.get(bytes); FileOutputStream output = null; try { output = new FileOutputStream(mFile); output.write(bytes); } catch (IOException e) { e.printStackTrace(); } finally { mImage.close(); if (null != output) { try { output.close(); } catch (IOException e) { e.printStackTrace(); } } } } } }</span></span></code> </pre><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de468083/">https://habr.com/ru/post/de468083/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de468073/index.html">Andrei Terekhov: "Sie können so viel sagen, wie Sie möchten, dass Amerikaner besser sind, aber unser Auto bricht nie zusammen."</a></li>
<li><a href="../de468075/index.html">Die Verwendung von siamesischen neuronalen Netzen bei der Suche</a></li>
<li><a href="../de468077/index.html">Posit-Tests für Erwachsene. Spektralanalyse</a></li>
<li><a href="../de468079/index.html">Benutzerdefinierte Dimensionen in Google Analytics, die uns mehr als einmal gespeichert haben</a></li>
<li><a href="../de468081/index.html">"Anonyme Daten" oder was in 152-FZ geplant ist</a></li>
<li><a href="../de468085/index.html">Das Buch "Safe DevOps. Effizienter Systembetrieb</a></li>
<li><a href="../de468087/index.html">Bisektionale Teilungsmethode beim Testen</a></li>
<li><a href="../de468089/index.html">Edition-basierte Neudefinition: Ist das in der Produktion möglich?</a></li>
<li><a href="../de468091/index.html">Der Gesetzentwurf zur Schaffung einer einzigen Datenbank mit den Daten der Bürger, die in erster Lesung in der Staatsduma verabschiedet wurden</a></li>
<li><a href="../de468093/index.html">Nitrate in Produkten: Schweizer Läden gegen russische Läden gegen Sommerhäuschen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>