<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÄ üòû üë®üèø‚Äçüíº Wie ich AI beigebracht habe, Tetris f√ºr NES zu spielen. Teil 1: Analyse des Spielcodes üèçÔ∏è üî© ü§öüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel werde ich die t√§uschend einfache Mechanik von Nintendo Tetris untersuchen und im zweiten Teil erkl√§ren, wie ich eine KI erstellt hab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie ich AI beigebracht habe, Tetris f√ºr NES zu spielen. Teil 1: Analyse des Spielcodes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420725/">  In diesem Artikel werde ich die t√§uschend einfache Mechanik von Nintendo Tetris untersuchen und im zweiten Teil erkl√§ren, wie ich eine KI erstellt habe, die diese Mechanik ausnutzt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48f/1a4/9b8/48f1a49b87860e6139e8d298e1fe6188.png"></div><br><h2>  Probieren Sie es selbst aus </h2><br><h3>  √úber das Projekt </h3><br>  F√ºr diejenigen, denen die Ausdauer, Geduld und Zeit fehlt, um Nintendo Tetris zu meistern, habe ich eine KI entwickelt, die alleine spielen kann.  Du kannst endlich Level 30 und noch weiter erreichen.  Sie werden sehen, wie Sie die maximale Anzahl von Punkten erreichen und die endlose Ver√§nderung von Zeilenz√§hlern, Ebenen und Statistiken beobachten k√∂nnen.  Sie erfahren, welche Farben auf Ebenen erscheinen, √ºber die eine Person nicht klettern konnte.  Sehen Sie, wie weit Sie gehen k√∂nnen. <br><a name="habracut"></a><br><h3>  Anforderungen </h3><br>  Zum Ausf√ºhren der KI ben√∂tigen Sie einen universellen NES / Famicom <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FCEUX-Emulator</a> .  K√ºnstliche Intelligenz wurde f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FCEUX 2.2.2 entwickelt</a> , die neueste Version des Emulators zum Zeitpunkt des Schreibens. <br><br>  Sie ben√∂tigen au√üerdem die Nintendo Tetris ROM-Datei (US-Version).  Versuchen Sie es bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google zu</a> suchen. <br><br><h3>  Herunterladen </h3><br>  Entpacken Sie <code>lua/NintendoTetrisAI.lua</code> aus dieser <a href="">Quell-Zip-Datei</a> . <br><br><h3>  Starten </h3><br>  Starten Sie FCEUX.  W√§hlen Sie im Men√º Datei |  ROM √∂ffnen ... W√§hlen Sie im Dialogfeld Datei √∂ffnen die Nintendo Tetris ROM-Datei aus und klicken Sie auf √ñffnen.  Das Spiel beginnt. <br><br>  W√§hlen Sie im Men√º Datei |  Lua |  Neues Lua-Skriptfenster ... Geben Sie im Lua-Skriptfenster den Pfad zu <code>NintendoTetrisAI.lua</code> oder klicken Sie auf die Schaltfl√§che Durchsuchen, um ihn zu finden.  Klicken Sie danach auf Ausf√ºhren. <br><br>  Das Skript auf Lua leitet Sie zum ersten Bildschirm des Men√ºs weiter.  Lassen Sie die Art des Spiels A-Type, und Sie k√∂nnen jede Musik ausw√§hlen.  Auf langsamen Computern kann Musik sehr ruckartig abgespielt werden, dann sollten Sie sie ausschalten.  Dr√ºcken Sie Start (Eingabetaste), um zum n√§chsten Men√ºbildschirm zu gelangen.  Im zweiten Men√º k√∂nnen Sie mit den Pfeiltasten die Startstufe √§ndern.  Klicken Sie auf Start, um das Spiel zu starten.  Und hier wird die KI die Kontrolle √ºbernehmen. <br><br>  Wenn Sie nach Auswahl einer Ebene auf dem zweiten Men√ºbildschirm die Gamepad-Taste A gedr√ºckt halten (Sie k√∂nnen das Tastaturlayout im Men√º Config | Input ... √§ndern) und Start dr√ºcken, ist die Anfangsstufe 10 h√∂her als der ausgew√§hlte Wert.  Das maximale Einstiegsniveau ist neunzehnte. <br><br><h3>  Konfiguration </h3><br>  √ñffnen Sie das Lua-Skript in einem Texteditor, um das Spiel schneller laufen zu lassen.  Suchen Sie am Anfang der Datei die folgende Zeile. <br><br> <code>PLAY_FAST = false</code> <br> <br>  Ersetzen Sie <code>false</code> durch <code>true</code> wie unten gezeigt. <br><br> <code>PLAY_FAST = true</code> <br> <br>  Speichern Sie die Datei.  Klicken Sie dann im Lua-Skriptfenster auf die Schaltfl√§che Neustart. <br><br><h2>  Nintendo Tetris Mechanics </h2><br><h3>  Beschreibung von Tetrimino </h3><br>  Jede Tetrimino-Figur entspricht einem Einzelbuchstaben, der ihrer Form √§hnelt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/975/440/5ed/9754405ed7b3d83a47181edef3de6913.png"></div><br>  Nintendo Tetris-Designer legen die oben gezeigte Tetrimino-Reihenfolge willk√ºrlich fest.  Die Figuren werden in der Ausrichtung angezeigt, in der sie auf dem Bildschirm angezeigt werden, und die Schaltung erzeugt ein nahezu symmetrisches Bild (m√∂glicherweise wird deshalb diese Reihenfolge gew√§hlt).  Der Sequenzindex gibt jedem Tetrimino eine eindeutige numerische ID.  Sequenz- und Typkennungen sind auf Programmierebene wichtig.  Dar√ºber hinaus manifestieren sie sich in der Reihenfolge der im Statistikfeld angezeigten Zahlen (siehe unten). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc2/35d/778/dc235d778c47654e1abbc5896581fd6a.png"></div><br>  Die 19 im Nintendo Tetris Tetrimino verwendeten Ausrichtungen sind in einer Tabelle codiert, die sich bei <code>$8A9C</code> des NES-Konsolenspeichers befindet.  Jede Figur wird als eine Folge von 12 Bytes dargestellt, die in Tripel <code>(Y, tile, X)</code> , die jedes Quadrat in der Figur beschreiben.  Die obigen Hex-Werte von Koordinaten √ºber <code>$7F</code> bezeichnen negative ganze Zahlen ( <code>$FF= ‚àí1</code> und <code>$FE = ‚àí2</code> ). <br><br> <code>; Y0 T0 X0 Y1 T1 X1 Y2 T2 X2 Y3 T3 X3 <br> <br> 8A9C: 00 7B FF 00 7B 00 00 7B 01 FF 7B 00 ; 00: T up <br> 8AA8: FF 7B 00 00 7B 00 00 7B 01 01 7B 00 ; 01: T right <br> 8AB4: 00 7B FF 00 7B 00 00 7B 01 01 7B 00 ; 02: T down (spawn) <br> 8AC0: FF 7B 00 00 7B FF 00 7B 00 01 7B 00 ; 03: T left <br> <br> 8ACC: FF 7D 00 00 7D 00 01 7D FF 01 7D 00 ; 04: J left <br> 8AD8: FF 7D FF 00 7D FF 00 7D 00 00 7D 01 ; 05: J up <br> 8AE4: FF 7D 00 FF 7D 01 00 7D 00 01 7D 00 ; 06: J right <br> 8AF0: 00 7D FF 00 7D 00 00 7D 01 01 7D 01 ; 07: J down (spawn) <br> <br> 8AFC: 00 7C FF 00 7C 00 01 7C 00 01 7C 01 ; 08: Z horizontal (spawn) <br> 8B08: FF 7C 01 00 7C 00 00 7C 01 01 7C 00 ; 09: Z vertical <br> <br> 8B14: 00 7B FF 00 7B 00 01 7B FF 01 7B 00 ; 0A: O (spawn) <br> <br> 8B20: 00 7D 00 00 7D 01 01 7D FF 01 7D 00 ; 0B: S horizontal (spawn) <br> 8B2C: FF 7D 00 00 7D 00 00 7D 01 01 7D 01 ; 0C: S vertical <br> <br> 8B38: FF 7C 00 00 7C 00 01 7C 00 01 7C 01 ; 0D: L right <br> 8B44: 00 7C FF 00 7C 00 00 7C 01 01 7C FF ; 0E: L down (spawn) <br> 8B50: FF 7C FF FF 7C 00 00 7C 00 01 7C 00 ; 0F: L left <br> 8B5C: FF 7C 01 00 7C FF 00 7C 00 00 7C 01 ; 10: L up <br> <br> 8B68: FE 7B 00 FF 7B 00 00 7B 00 01 7B 00 ; 11: I vertical <br> 8B74: 00 7B FE 00 7B FF 00 7B 00 00 7B 01 ; 12: I horizontal (spawn) <br> <br> 8B80: 00 FF 00 00 FF 00 00 FF 00 00 FF 00 ; 13: Unused</code> <br> <br>  Am Ende der Tabelle befindet sich ein nicht verwendeter Datensatz, der m√∂glicherweise die M√∂glichkeit bietet, eine weitere Ausrichtung hinzuzuf√ºgen.  In verschiedenen Teilen des Codes gibt <code>$13</code> an, dass der Orientierungskennung des aktiven Tetriminos kein Wert zugewiesen wurde. <br><br>  Zur Erleichterung des Lesens sind die Koordinaten der Quadrate in Dezimalzahl unten gezeigt. <br><br> <code>-- { { X0, Y0 }, { X1, Y1 }, { X2, Y2 }, { X3, Y3 }, }, <br> <br> { { -1, 0 }, { 0, 0 }, { 1, 0 }, { 0, -1 }, }, -- 00: T up <br> { { 0, -1 }, { 0, 0 }, { 1, 0 }, { 0, 1 }, }, -- 01: T right <br> { { -1, 0 }, { 0, 0 }, { 1, 0 }, { 0, 1 }, }, -- 02: T down (spawn) <br> { { 0, -1 }, { -1, 0 }, { 0, 0 }, { 0, 1 }, }, -- 03: T left <br> <br> { { 0, -1 }, { 0, 0 }, { -1, 1 }, { 0, 1 }, }, -- 04: J left <br> { { -1, -1 }, { -1, 0 }, { 0, 0 }, { 1, 0 }, }, -- 05: J up <br> { { 0, -1 }, { 1, -1 }, { 0, 0 }, { 0, 1 }, }, -- 06: J right <br> { { -1, 0 }, { 0, 0 }, { 1, 0 }, { 1, 1 }, }, -- 07: J down (spawn) <br> <br> { { -1, 0 }, { 0, 0 }, { 0, 1 }, { 1, 1 }, }, -- 08: Z horizontal (spawn) <br> { { 1, -1 }, { 0, 0 }, { 1, 0 }, { 0, 1 }, }, -- 09: Z vertical <br> <br> { { -1, 0 }, { 0, 0 }, { -1, 1 }, { 0, 1 }, }, -- 0A: O (spawn) <br> <br> { { 0, 0 }, { 1, 0 }, { -1, 1 }, { 0, 1 }, }, -- 0B: S horizontal (spawn) <br> { { 0, -1 }, { 0, 0 }, { 1, 0 }, { 1, 1 }, }, -- 0C: S vertical <br> <br> { { 0, -1 }, { 0, 0 }, { 0, 1 }, { 1, 1 }, }, -- 0D: L right <br> { { -1, 0 }, { 0, 0 }, { 1, 0 }, { -1, 1 }, }, -- 0E: L down (spawn) <br> { { -1, -1 }, { 0, -1 }, { 0, 0 }, { 0, 1 }, }, -- 0F: L left <br> { { 1, -1 }, { -1, 0 }, { 0, 0 }, { 1, 0 }, }, -- 10: L up <br> <br> { { 0, -2 }, { 0, -1 }, { 0, 0 }, { 0, 1 }, }, -- 11: I vertical <br> { { -2, 0 }, { -1, 0 }, { 0, 0 }, { 1, 0 }, }, -- 12: I horizontal (spawn)</code> <br> <br>  Alle Orientierungen werden in eine 5 √ó 5-Matrix gelegt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ca/435/322/8ca435322ee85d07cc631640c11a9aee.png"></div><br>  In der obigen Abbildung gibt das wei√üe Quadrat die Mitte der Matrix an, den Bezugspunkt f√ºr die Drehung der Abbildung. <br><br>  Die Orientierungstabelle ist unten grafisch dargestellt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b18/4e0/f0e/b184e0f0ea182222b58d151c09217567.png"></div><br>  Die Orientierungskennung (Tabellenindex) wird in der oberen rechten Ecke jeder Matrix hexadezimal angezeigt.  Die f√ºr dieses Projekt erfundene Mnemonik wird in der oberen linken Ecke angezeigt.  <code>u</code> , <code>r</code> , <code>d</code> , <code>l</code> , <code>h</code> und <code>v</code> sind Abk√ºrzungen f√ºr ‚Äûoben, rechts, unten, links, horizontal und vertikal‚Äú.  Zum Beispiel ist es einfacher, die Ausrichtung von <code>Jd</code> als <code>$07</code> . <br><br>  Matrizen, die die Ausrichtung der Figuren w√§hrend der Erstellung enthalten, sind mit einem wei√üen Rahmen markiert. <br><br>  Tetrimino I, S und Z konnten 4 verschiedene Ausrichtungen erhalten, aber die Sch√∂pfer von Nintendo Tetris beschlossen, sich auf zwei zu beschr√§nken.  Au√üerdem sind <code>Zv</code> und <code>Sv</code> keine idealen Spiegelbilder voneinander.  Beide entstehen durch Drehen gegen den Uhrzeigersinn, was zu einem Ungleichgewicht f√ºhrt. <br><br>  Die Orientierungstabelle enth√§lt auch Kachelwerte f√ºr jedes Quadrat in jeder orientierten Figur.  Bei sorgf√§ltiger Untersuchung wird jedoch deutlich, dass die Werte f√ºr eine Tetrimino-Art immer gleich sind. <br><br><div class="scrollable-table"><table><tbody><tr><th>  T. </th><th>  J. </th><th>  Z. </th><th>  O. </th><th>  S. </th><th>  L. </th><th>  Ich </th></tr><tr><td> <code>7B</code> </td> <td> <code>7D</code> </td> <td> <code>7C</code> </td> <td> <code>7B</code> </td> <td> <code>7D</code> </td> <td> <code>7C</code> </td> <td> <code>7B</code> </td> </tr></tbody></table></div><br>  Die Kachelwerte sind die Indizes der (Pseudofarbtabelle) des unten gezeigten Musters. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e00/97a/713/e0097a713f629afaf73936d3192820e3.png"></div><br>  Die Kacheln <code>$7B</code> , <code>$7C</code> und <code>$7D</code> befinden sich direkt unter "ATIS" aus dem Wort "STATISTICS".  Dies sind die drei Arten von Quadraten, aus denen Tetrimino hergestellt wird. <br><br>  F√ºr Neugierige werde ich sagen, dass Strau√üe und Pinguine am Ende des B-Typ-Modus verwendet werden.  Dieses Thema wird im Abschnitt "Beenden" ausf√ºhrlich behandelt. <br><br>  Unten sehen Sie das Ergebnis der √Ñnderung des ROM nach dem Ersetzen von <code>$7B</code> durch <code>$29</code> .  Das Herz ist die Kachel unter dem P-Symbol in der Mustertabelle f√ºr alle Ausrichtungen T. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5fa/551/215/5fa55121523b443f8f3b6daa2bd46ad8.png"></div><br>  Herzpl√§ttchen bleiben auch nach dem Einrasten der modifizierten Ts auf dem Spielfeld.  Wie unten im Abschnitt ‚ÄûErstellen von Tetrimino‚Äú angegeben, bedeutet dies, dass das Spielfeld die tats√§chlichen Werte der Kachelindizes des gespielten Tetrimino speichert. <br><br>  Spielprogrammierer erm√∂glichten die Verwendung von 4 separaten Kacheln f√ºr jede Figur und nicht nur eines unver√§nderlichen Quadrattyps.  Dies ist eine n√ºtzliche Funktion, mit der Sie das Erscheinungsbild des Spiels √§ndern k√∂nnen.  Die Mustertabelle bietet viel Platz f√ºr neue Kacheln, die jedem Tetrimino ein einzigartiges Aussehen verleihen k√∂nnen. <br><br>  Die Koordinaten der Quadrate sind sehr einfach zu manipulieren.  Beispielsweise wird unten eine modifizierte Version der ersten vier Tripel in der Orientierungstabelle gezeigt. <br><br> <code>8A9C: FE 7B FE FE 7B 02 02 7B FE 02 7B 02 ; 00: T up</code> <br> <br>  Diese √Ñnderung √§hnelt der folgenden: <br><br> <code>{ { -2, -2 }, { 2, -2 }, { -2, 2 }, { 2, 2 }, }, -- 00: T up</code> <br> <br>  Das Ergebnis ist ein gespaltenes Tetrimino. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a6/ab5/86d/3a6ab586d06a57b92208bd612b755109.png"></div><br>  Wenn Sie ein geteiltes Tetrimino bewegen, d√ºrfen seine Quadrate nicht √ºber die Grenzen des Spielfelds hinausgehen und nicht durch zuvor festgelegte Figuren hindurchgehen.  Au√üerdem verbietet das Spiel eine Drehung in dieser Ausrichtung, wenn ein Quadrat au√üerhalb der Grenzen des Spielfelds liegt oder wenn das Quadrat ein bereits liegendes Quadrat √ºberlappt. <br><br>  Das geteilte Tetrimino ist an Ort und Stelle verriegelt, wenn eines seiner Quadrate unterst√ºtzt wird.  Wenn die Figur blockiert ist, h√§ngen die in der Luft h√§ngenden Quadrate weiter. <br><br>  Das Spiel behandelt geteilte Tetriminos wie jede normale Figur.  Dies macht uns verst√§ndlich, dass es keine zus√§tzliche Tabelle gibt, in der die Metadaten der Figuren gespeichert sind.  Zum Beispiel k√∂nnte es einen Tisch geben, der die Gr√∂√üe des Begrenzungsrahmens jeder Ausrichtung speichert, um auf Kollisionen mit dem Umfang des Spielfelds zu pr√ºfen.  Eine solche Tabelle wird jedoch nicht verwendet.  Stattdessen √ºberpr√ºft das Spiel einfach alle vier Felder, bevor die Form bearbeitet wird. <br><br>  Au√üerdem k√∂nnen die Koordinaten der Quadrate beliebige Werte sein.  Sie sind nicht auf das Intervall <code>[‚àí2, 2]</code> .  Werte, die dieses Intervall stark √ºberschreiten, f√ºhren nat√ºrlich zu nicht zutreffenden Zahlen, die nicht auf das Spielfeld passen.  Noch wichtiger ist, dass, wie im Abschnitt ‚ÄûSpielzust√§nde und Rendering-Modi‚Äú angegeben, der Mechanismus zum Reinigen gef√ºllter Linien beim Verriegeln einer Figur nur die Verschiebungen von Zeilen von ‚Äì2 bis 1 vom zentralen Quadrat der Figur abtastet.  Ein Quadrat mit einer <code>y</code> Koordinate au√üerhalb dieses Intervalls wird nicht erkannt. <br><br><h3>  Tetrimino-Rotation </h3><br>  In einer grafischen Darstellung der Orientierungstabelle besteht die Drehung darin, von einer Matrix zu einer der Matrizen links oder rechts zu wechseln und gegebenenfalls die Reihe zu √ºbertragen.  Dieses Konzept ist in einer Tabelle bei <code>$88EE</code> . <br><br> <code>; CCW CW <br> 88EE: 03 01 ; Tl Tr <br> 88F0: 00 02 ; Tu Td <br> 88F2: 01 03 ; Tr Tl <br> 88F4: 02 00 ; Td Tu <br> 88F6: 07 05 ; Jd Ju <br> 88F8: 04 06 ; Jl Jr <br> 88FA: 05 07 ; Ju Jd <br> 88FC: 06 04 ; Jr Jl <br> 88FE: 09 09 ; Zv Zv <br> 8900: 08 08 ; Zh Zh <br> 8902: 0A 0A ; OO <br> 8904: 0C 0C ; Sv Sv <br> 8906: 0B 0B ; Sh Sh <br> 8908: 10 0E ; Lu Ld <br> 890A: 0D 0F ; Lr Ll <br> 890C: 0E 10 ; Ld Lu <br> 890E: 0F 0D ; Ll Lr <br> 8910: 12 12 ; Ih Ih <br> 8912: 11 11 ; Iv Iv</code> <br> <br>  Zur Verdeutlichung verschieben wir jede Spalte aus dieser Tabelle in die Zeile der folgenden Tabelle. <br><div class="scrollable-table"><table><tbody><tr><th></th><th> <code>Tu</code> </th> <th> <code>Tr</code> </th> <th> <code>Td</code> </th> <th> <code>Tl</code> </th> <th> <code>Jl</code> </th> <th> <code>Ju</code> </th> <th> <code>Jr</code> </th> <th> <code>Jd</code> </th> <th> <code>Zh</code> </th> <th> <code>Zv</code> </th> <th> <code>O</code> </th> <th> <code>Sh</code> </th> <th> <code>Sv</code> </th> <th> <code>Lr</code> </th> <th> <code>Ld</code> </th> <th> <code>Ll</code> </th> <th> <code>Lu</code> </th> <th> <code>Iv</code> </th> <th> <code>Ih</code> </th> </tr><tr><th>  Gegen den Uhrzeigersinn </th><td> <code>Tl</code> </td> <td> <code>Tu</code> </td> <td> <code>Tr</code> </td> <td> <code>Td</code> </td> <td> <code>Jd</code> </td> <td> <code>Jl</code> </td> <td> <code>Ju</code> </td> <td> <code>Jr</code> </td> <td> <code>Zv</code> </td> <td> <code>Zh</code> </td> <td> <code>O</code> </td> <td> <code>Sv</code> </td> <td> <code>Sh</code> </td> <td> <code>Lu</code> </td> <td> <code>Lr</code> </td> <td> <code>Ld</code> </td> <td> <code>Ll</code> </td> <td> <code>Ih</code> </td> <td> <code>Iv</code> </td> </tr><tr><th>  Im Uhrzeigersinn </th><td> <code>Tr</code> </td> <td> <code>Td</code> </td> <td> <code>Tl</code> </td> <td> <code>Tu</code> </td> <td> <code>Ju</code> </td> <td> <code>Jr</code> </td> <td> <code>Jd</code> </td> <td> <code>Jl</code> </td> <td> <code>Zv</code> </td> <td> <code>Zh</code> </td> <td> <code>O</code> </td> <td> <code>Sv</code> </td> <td> <code>Sh</code> </td> <td> <code>Ld</code> </td> <td> <code>Ll</code> </td> <td> <code>Lu</code> </td> <td> <code>Lr</code> </td> <td> <code>Ih</code> </td> <td> <code>Iv</code> </td> </tr></tbody></table></div><br>  Die Mnemonik in den √úberschriften oben kann als Sequenzindex oder Verteilungsschl√ºssel interpretiert werden.  Wenn Sie beispielsweise <code>Tu</code> gegen den Uhrzeigersinn drehen, erhalten Sie <code>Tl</code> , und wenn Sie <code>Tu</code> im Uhrzeigersinn drehen, erhalten Sie <code>Tr</code> . <br><br>  Die Rotationstabelle codiert kettengebundene Sequenzen von Orientierungs-IDs;  Daher k√∂nnen wir die Aufzeichnungen so √§ndern, dass die Rotation einen Tetrimino-Typ in einen anderen umwandelt.  Diese Technik kann m√∂glicherweise verwendet werden, um eine nicht verwendete Zeile in der Ausrichtungstabelle zu nutzen. <br><br>  Vor der Rotationstabelle befindet sich ein Code f√ºr den Zugriff darauf. <br><br> <code>88AB: LDA $0042 <br> 88AD: STA $00AE ; originalOrientationID = orientationID; <br> <br> 88AF: CLC <br> 88B0: LDA $0042 <br> 88B2: ASL <br> 88B3: TAX ; index = 2 * orientationID; <br> <br> 88B4: LDA $00B5 <br> 88B6: AND #$80 ; if (not just pressed button A) { <br> 88B8: CMP #$80 ; goto aNotPressed; <br> 88BA: BNE $88CF ; } <br> <br> 88BC: INX <br> 88BD: LDA $88EE,X <br> 88C0: STA $0042 ; orientationID = rotationTable[index + 1]; <br> <br> 88C2: JSR $948B ; if (new orientation not valid) { <br> 88C5: BNE $88E9 ; goto restoreOrientationID; <br> ; } <br> <br> 88C7: LDA #$05 <br> 88C9: STA $06F1 ; play rotation sound effect; <br> 88CC: JMP $88ED ; return; <br> <br> aNotPressed: <br> <br> 88CF: LDA $00B5 <br> 88D1: AND #$40 ; if (not just pressed button B) { <br> 88D3: CMP #$40 ; return; <br> 88D5: BNE $88ED ; } <br> <br> 88D7: LDA $88EE,X <br> 88DA: STA $0042 ; orientationID = rotationTable[index]; <br> <br> 88DC: JSR $948B ; if (new orientation not valid) { <br> 88DF: BNE $88E9 ; goto restoreOrientationID; <br> ; } <br> <br> 88E1: LDA #$05 <br> 88E3: STA $06F1 ; play rotation sound effect; <br> 88E6: JMP $88ED ; return; <br> <br> restoreOrientationID: <br> <br> 88E9: LDA $00AE <br> 88EB: STA $0042 ; orientationID = originalOrientationID; <br> <br> 88ED: RTS ; return;</code> <br> <br>  Bei Drehung gegen den Uhrzeigersinn wird der Index der Drehtabelle durch Verdoppeln der Orientierungs-ID subtrahiert.  Durch Hinzuf√ºgen von 1 erhalten wir den Rotationsindex im Uhrzeigersinn. <br><br>  Die <code>x</code> , <code>y</code> Koordinaten und die Orientierungs-ID des aktuellen Tetriminos werden unter den Adressen <code>$0040</code> , <code>$0041</code> bzw. <code>$0042</code> gespeichert. <br><br>  Der Code verwendet eine tempor√§re Variable, um die Orientierungs-ID zu sichern.  Sp√§ter, nach dem √Ñndern der Ausrichtung, √ºberpr√ºft der Code, ob sich alle vier Quadrate innerhalb der Grenzen des Spielfelds befinden und dass keines von ihnen die bereits liegenden Quadrate √ºberlappt (der Best√§tigungscode befindet sich bei <code>$948B</code> unter dem oben gezeigten Codefragment).  Wenn die neue Ausrichtung nicht korrekt ist, wird die urspr√ºngliche wiederhergestellt, sodass der Spieler die Figur nicht drehen kann. <br><br>  Der NES-Controller z√§hlt mit einem Kreuz und verf√ºgt √ºber acht Tasten, deren Status durch das Adressbit <code>$00B6</code> . <br><br><div class="scrollable-table"><table><tbody><tr><th> <code>7</code> </th> <th> <code>6</code> </th> <th> <code>5</code> </th> <th> <code>4</code> </th> <th> <code>3</code> </th> <th> <code>2</code> </th> <th> <code>1</code> </th> <th> <code>0</code> </th> </tr><tr><td>  A. </td><td>  B. </td><td>  W√§hlen Sie </td><td>  Starten Sie </td><td>  Auf </td><td>  Runter </td><td>  Links </td><td>  Rechts </td></tr></tbody></table></div><br>  Zum Beispiel enth√§lt <code>$00B6</code> den Wert <code>$81</code> w√§hrend der Spieler A und Links h√§lt. <br><br>  Auf der anderen Seite meldet <code>$00B5</code> , wann die Tasten gedr√ºckt wurden.  Die Bits <code>$00B5</code> sind nur w√§hrend einer Iteration der Spielschleife (1 gerenderter Frame) wahr.  Der Code verwendet <code>$00B5</code> um auf das Dr√ºcken von A und B zu reagieren. Jeder von ihnen muss freigegeben werden, bevor er erneut verwendet werden kann. <br><br>  <code>$00B5</code> und <code>$00B6</code> sind Spiegel von <code>$00F5</code> und <code>$00F6</code> .  Der Code in den folgenden Abschnitten verwendet diese Adressen austauschbar. <br><br><h3>  Erstellen Sie Tetrimino </h3><br>  Das Nintendo Tetris-Spielfeld besteht aus einer Matrix mit 22 Zeilen und 10 Spalten, sodass die beiden obersten Zeilen vor dem Player verborgen sind. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e1/0dc/33b/6e10dc33b40eaa5dec35bc6e7bf42c5f.png"></div><br>  Wie im folgenden Code gezeigt, befindet sich eine Tetrimino-Figur beim Erstellen immer in den Koordinaten <code>(5, 0)</code> Spielfelds. <br><br> <code>98BA: LDA #$00 <br> 98BC: STA $00A4 <br> 98BE: STA $0045 <br> 98C0: STA $0041 ; Tetrimino Y = 0 <br> 98C2: LDA #$01 <br> 98C4: STA $0048 <br> 98C6: LDA #$05 <br> 98C8: STA $0040 ; Tetrimino X = 5</code> <br> <br>  Unten ist eine 5 √ó 5-Matrix, die diesem Punkt √ºberlagert ist. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fcf/d3b/d94/fcfd3bd94514779d6e967770a1f216cb.png"></div><br>  Keine der Erstellungsmatrizen hat Quadrate √ºber dem Startpunkt.  Das hei√üt, wenn ein Tetrimino erstellt wird, werden alle vier Felder sofort f√ºr den Spieler sichtbar.  Wenn der Spieler das St√ºck jedoch schnell dreht, bevor es Zeit zum Ablegen hat, wird ein Teil des St√ºcks vor√ºbergehend in den ersten beiden Zeilen des Spielfelds ausgeblendet. <br><br>  Normalerweise denken wir, dass das Spiel endet, wenn der Haufen die Spitze erreicht.  Tats√§chlich ist dies jedoch nicht ganz richtig.  Das Spiel endet, wenn es nicht mehr m√∂glich ist, das n√§chste St√ºck zu erstellen.  Das hei√üt, vor dem Erscheinen der Figur sollten alle vier Zellen des Spielfelds, die den Positionen der Quadrate des erzeugten Tetriminos entsprechen, frei sein.  Die Figur kann so fixiert sein, dass ein Teil ihrer Quadrate in negativ nummerierten Linien erscheint und das Spiel nicht endet.  In Nintendo Tetris sind negative Linien jedoch eine Abstraktion, die sich nur auf aktives Tetrimino bezieht.  Nachdem die Figur blockiert ist (l√ºgt), werden nur Quadrate in Zeilen von Null und mehr in das Feld geschrieben.  Konzeptionell stellt sich heraus, dass negativ nummerierte Zeilen nach dem Blockieren automatisch gel√∂scht werden.  In Wirklichkeit speichert das Spiel diese Daten einfach nicht und schneidet die oberen Teile der Figuren ab. <br><br>  Der sichtbare Bereich des Spielfelds 20 √ó 10 wird zeilenweise bei <code>$0400</code> gespeichert, jedes Byte enth√§lt den Wert der Hintergrundkachel.  Leere Zellen werden durch die <code>$EF</code> Kachel gekennzeichnet, ein durchgehendes schwarzes Quadrat. <br><br>  Beim Erstellen einer Form werden drei Nachschlagetabellen verwendet.  Wenn es eine beliebige Orientierungs-ID gibt, gibt uns die Tabelle bei <code>$9956</code> die Orientierungs-ID beim Erstellen des entsprechenden Tetrimino-Typs. <br><br> <code>9956: 02 02 02 02 ; Td <br> 995A: 07 07 07 07 ; Jd <br> 995E: 08 08 ; Zh <br> 9960: 0A ; O <br> 9961: 0B 0B ; Sh <br> 9963: 0E 0E 0E 0E ; Ld <br> 9967: 12 12 ; Ih</code> <br> <br>  Es ist einfacher, dies in der Tabelle anzuzeigen. <br><br><div class="scrollable-table"><table><tbody><tr><th> <code>Tu</code> </th> <th> <code>Tr</code> </th> <th> <code>Td</code> </th> <th> <code>Tl</code> </th> <th> <code>Jl</code> </th> <th> <code>Ju</code> </th> <th> <code>Jr</code> </th> <th> <code>Jd</code> </th> <th> <code>Zh</code> </th> <th> <code>Zv</code> </th> <th> <code>O</code> </th> <th> <code>Sh</code> </th> <th> <code>Sv</code> </th> <th> <code>Lr</code> </th> <th> <code>Ld</code> </th> <th> <code>Ll</code> </th> <th> <code>Lu</code> </th> <th> <code>Iv</code> </th> <th> <code>Ih</code> </th> </tr><tr><td> <code>Td</code> </td> <td> <code>Td</code> </td> <td> <code>Td</code> </td> <td> <code>Td</code> </td> <td> <code>Jd</code> </td> <td> <code>Jd</code> </td> <td> <code>Jd</code> </td> <td> <code>Jd</code> </td> <td> <code>Zh</code> </td> <td> <code>Zh</code> </td> <td> <code>O</code> </td> <td> <code>Sh</code> </td> <td> <code>Sh</code> </td> <td> <code>Ld</code> </td> <td> <code>Ld</code> </td> <td> <code>Ld</code> </td> <td> <code>Ld</code> </td> <td> <code>Ih</code> </td> <td> <code>Ih</code> </td> </tr></tbody></table></div><br>  Zum Beispiel sind alle Orientierungen von J an <code>Jd</code> . <br><br>  Die Tabelle bei <code>$993B</code> Mrd. <code>$993B</code> enth√§lt den Tetrimino-Typ f√ºr die angegebene Orientierungs-ID. <br><br> <code>993B: 00 00 00 00 ; T <br> 993F: 01 01 01 01 ; J <br> 9943: 02 02 ; Z <br> 9945: 03 ; O <br> 9946: 04 04 ; S <br> 9948: 05 05 05 05 ; L <br> 994C: 06 06 ; I</code> <br> <br>  Der Klarheit halber werde ich alles in tabellarischer Form zeigen. <br><br><div class="scrollable-table"><table><tbody><tr><th> <code>Tu</code> </th> <th> <code>Tr</code> </th> <th> <code>Td</code> </th> <th> <code>Tl</code> </th> <th> <code>Jl</code> </th> <th> <code>Ju</code> </th> <th> <code>Jr</code> </th> <th> <code>Jd</code> </th> <th> <code>Zh</code> </th> <th> <code>Zv</code> </th> <th> <code>O</code> </th> <th> <code>Sh</code> </th> <th> <code>Sv</code> </th> <th> <code>Lr</code> </th> <th> <code>Ld</code> </th> <th> <code>Ll</code> </th> <th> <code>Lu</code> </th> <th> <code>Iv</code> </th> <th> <code>Ih</code> </th> </tr><tr><td> <code>T</code> </td> <td> <code>T</code> </td> <td> <code>T</code> </td> <td> <code>T</code> </td> <td> <code>J</code> </td> <td> <code>J</code> </td> <td> <code>J</code> </td> <td> <code>J</code> </td> <td> <code>Z</code> </td> <td> <code>Z</code> </td> <td> <code>O</code> </td> <td> <code>S</code> </td> <td> <code>S</code> </td> <td> <code>L</code> </td> <td> <code>L</code> </td> <td> <code>L</code> </td> <td> <code>L</code> </td> <td> <code>I</code> </td> <td> <code>I</code> </td> </tr></tbody></table></div><br>  Wir werden uns die dritte Suchtabelle im n√§chsten Abschnitt ansehen. <br><br><h3>  Tetrimino Auswahl </h3><br>  Nintendo Tetris verwendet in seiner Fibonacci-Konfiguration ein 16-Bit-Linear-Feedback-Schieberegister (LFSR) als Pseudozufallszahlengenerator (PRNG).  Der 16-Bit-Wert wird als Big-Endian unter den Adressen <code>$0017</code> - <code>$0018</code> gespeichert.  Eine beliebige Zahl von <code>$8988</code> als <code>$8988</code> verwendet. <br><br> <code>80BC: LDX #$89 <br> 80BE: STX $0017 <br> 80C0: DEX <br> 80C1: STX $0018</code> <br> <br>  Jede nachfolgende Pseudozufallszahl wird wie folgt erzeugt: Der Wert wird als 17-Bit-Zahl wahrgenommen, und das h√∂chstwertige Bit wird durch Ausf√ºhren von XOR f√ºr die Bits 1 und 9 erhalten. Dann wird der Wert nach rechts verschoben, wobei das niedrigstwertige Bit verworfen wird. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3a0/45d/3f2/3a045d3f2d64a94aa272aa15f351ac7a.png"></div><br>  Dieser Prozess findet bei <code>$AB47</code> . <br><br> <code>AB47: LDA $00,X <br> AB49: AND #$02 <br> AB4B: STA $0000 ; extract bit 1 <br> <br> AB4D: LDA $01,X <br> AB4F: AND #$02 ; extract bit 9 <br> <br> AB51: EOR $0000 <br> AB53: CLC <br> AB54: BEQ $AB57 <br> AB56: SEC ; XOR bits 1 and 9 together <br> <br> AB57: ROR $00,X <br> AB59: INX <br> AB5A: DEY ; right shift <br> AB5B: BNE $AB57 ; shifting in the XORed value <br> <br> AB5D: RTS ; return</code> <br> <br>  Interessanterweise k√∂nnen die Parameter des obigen Unterprogramms so eingestellt werden, dass die aufrufende Funktion die Breite des Schieberegisters und die Adresse angeben kann, an der es sich im Speicher befindet.  Es werden jedoch √ºberall dieselben Parameter verwendet, sodass wir davon ausgehen k√∂nnen, dass die Entwickler diesen Code irgendwo ausgeliehen haben. <br><br>  F√ºr diejenigen, die den Algorithmus weiter modifizieren m√∂chten, habe ich ihn in Java geschrieben. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateNextPseudorandomNumber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bit1 = (value &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bit9 = (value &gt;&gt; <span class="hljs-number"><span class="hljs-number">9</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> leftmostBit = bit1 ^ bit9; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (leftmostBit &lt;&lt; <span class="hljs-number"><span class="hljs-number">15</span></span>) | (value &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br>  Und all dieser Code kann in einer Zeile zusammengefasst werden. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateNextPseudorandomNumber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((((value &gt;&gt; <span class="hljs-number"><span class="hljs-number">9</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>) ^ ((value &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>)) &lt;&lt; <span class="hljs-number"><span class="hljs-number">15</span></span>) | (value &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br>  Dieses PRNG erzeugt kontinuierlich und deterministisch 32.767 eindeutige Werte, wobei jeder Zyklus vom urspr√ºnglichen Samen ausgeht.  Dies ist weniger als die H√§lfte der m√∂glichen Zahlen, die in das Register passen, und jeder Wert in diesem Satz kann als Startwert verwendet werden.  Viele der Werte au√üerhalb der Menge bilden eine Kette, die schlie√ülich zu einer Zahl aus der Menge f√ºhrt.  Einige Anfangszahlen f√ºhren jedoch zu einer unendlichen Folge von Nullen. <br><br>  Um die Leistung dieses PRNG grob zu bewerten, habe ich eine grafische Darstellung der Werte erstellt, die basierend auf einem Satz mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RANDOM.ORG erstellt wurden</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/254/477/bef/254477befbd14f540925a6d3169e5179.png"></div><br>  Bei der Erstellung des Bildes wurde PRNG als Pseudozufallszahlengenerator anstelle von 16-Bit-Ganzzahlen verwendet.  Jedes Pixel wird basierend auf dem Wert von Bit 0 gef√§rbt. Das Bild hat eine Gr√∂√üe von 128 √ó 256, dh es deckt die gesamte Sequenz ab. <br><br>  Abgesehen von den kaum wahrnehmbaren Streifen auf der oberen und linken Seite sieht es zuf√§llig aus.  Es erscheinen keine offensichtlichen Muster. <br><br>  Nach dem Start verschiebt der PRNG st√§ndig das Register und arbeitet mindestens einmal pro Frame.  Dies geschieht nicht nur auf dem Begr√º√üungs- und Men√ºbildschirm, sondern auch, wenn das Tetrimino zwischen den Vorg√§ngen zum Erstellen von Formen liegt.  Das hei√üt, die folgende Abbildung h√§ngt von der Anzahl der Frames ab, die der Spieler ben√∂tigt, um die Figur zu platzieren.  Tats√§chlich beruht das Spiel auf der Zuf√§lligkeit der Handlungen der Person, die mit ihm interagiert. <br><br>  W√§hrend der Erstellung der Figur wird der Code unter der Adresse <code>$9907</code> , wodurch der Typ der neuen Figur ausgew√§hlt wird. <br><br> <code>9907: INC $001A ; spawnCount++; <br> <br> 9909: LDA $0017 ; index = high byte of randomValue; <br> <br> 990B: CLC <br> 990C: ADC $001A ; index += spawnCount; <br> <br> 990E: AND #$07 ; index &amp;= 7; <br> <br> 9910: CMP #$07 ; if (index == 7) { <br> 9912: BEQ $991C ; goto invalidIndex; <br> ; } <br> <br> 9914: TAX <br> 9915: LDA $994E,X ; newSpawnID = spawnTable[index]; <br> <br> 9918: CMP $0019 ; if (newSpawnID != spawnID) { <br> 991A: BNE $9938 ; goto useNewSpawnID; <br> ; } <br> <br> invalidIndex: <br> <br> 991C: LDX #$17 <br> 991E: LDY #$02 <br> 9920: JSR $AB47 ; randomValue = generateNextPseudorandomNumber(randomValue); <br> <br> 9923: LDA $0017 ; index = high byte of randomValue; <br> <br> 9925: AND #$07 ; index &amp;= 7; <br> <br> 9927: CLC <br> 9928: ADC $0019 ; index += spawnID; <br> <br> 992A: CMP #$07 <br> 992C: BCC $9934 <br> 992E: SEC <br> 992F: SBC #$07 <br> 9931: JMP $992A ; index %= 7; <br> <br> 9934: TAX <br> 9935: LDA $994E,X ; newSpawnID = spawnTable[index]; <br> <br> useNewSpawnID: <br> <br> 9938: STA $0019 ; spawnID = newSpawnID; <br> <br> 993A: RTS ; return;</code> <br> <br>  Unter der Adresse <code>$001A</code> ein Z√§hler f√ºr die Anzahl der beim Einschalten erstellten Zahlen <code>$001A</code> .  Das Inkrementieren des Z√§hlers wird von der ersten Zeile des Unterprogramms ausgef√ºhrt, und da es sich um einen Einzelbytez√§hler handelt, kehrt er nach jeweils 256 Teilen wieder auf Null zur√ºck.  Da der Z√§hler zwischen den Spielen nicht zur√ºckgesetzt wird, wirkt sich der Verlauf der vorherigen Spiele auf den Figurenauswahlprozess aus.  Dies ist eine andere Art und Weise, wie das Spiel den Spieler als Zufallsquelle verwendet. <br><br>  Die Routine konvertiert das h√∂chstwertige Byte der Pseudozufallszahl ( <code>$0017</code> ) in einen Tetrimino-Typ und verwendet es als Index der Tabelle bei <code>$994E</code> , um den Typ in die <code>$994E</code> Orientierungs-ID zu konvertieren. <br><br> <code>994E: 02 ; Td <br> 994F: 07 ; Jd <br> 9950: 08 ; Zh <br> 9951: 0A ; O <br> 9952: 0B ; Sh <br> 9953: 0E ; Ld <br> 9954: 12 ; Ih</code> <br> <br>  In der ersten Konvertierungsphase wird der Z√§hler der erstellten Zahlen zum oberen Byte hinzugef√ºgt.  Dann wird eine Maske angewendet, um nur die unteren 3 Bits zu speichern.  Wenn das Ergebnis nicht 7 ist, ist dies der richtige Tetrimino-Typ. Wenn es nicht mit der zuvor ausgew√§hlten Zahl √ºbereinstimmt, wird die Zahl als Index in der Tabelle zum Erstellen von Zahlen verwendet.  Andernfalls wird die n√§chste Pseudozufallszahl generiert und die Maske wird angewendet, um die unteren 3 Bits des oberen Bytes zu erhalten, und dann wird die vorherige ID zur Formerstellungsorientierung hinzugef√ºgt.  Schlie√ülich wird eine Modulo-Operation ausgef√ºhrt, um den richtigen Tetrimino-Typ zu erhalten, der als Index in der Formerstellungstabelle verwendet wird. <br><br>  Da der Prozessor die Division mit dem Rest nicht unterst√ºtzt, wird dieser Operator durch wiederholtes Subtrahieren von 7 emuliert, bis das Ergebnis kleiner als 7 wird. Die Division mit dem Rest wird auf die Summe des oberen Bytes mit der angewendeten Maske und auf die ID der vorherigen Formerstellungsorientierung angewendet.  Der Maximalwert dieser Summe ist 25. Das hei√üt, um sie auf den Rest von 4 zu reduzieren, sind nur 3 Iterationen erforderlich. <br><br>  Zu Beginn jedes Spiels wird die ID <code>$0019</code> ( <code>$0019</code> ) mit dem Wert <code>Tu</code> ( <code>$00</code> ) initialisiert.  Dieser Wert kann m√∂glicherweise bei der ersten <code>$9928</code> verwendet werden. <br><br>  Wenn Tetrimino die vorherige Orientierungs-ID zum Erstellen einer Figur anstelle des vorherigen Typs verwendet, f√ºgt er eine Verzerrung hinzu, da die Werte der Orientierungs-ID nicht gleichm√§√üig verteilt sind.  Dies ist in der Tabelle gezeigt: <br><br><div class="scrollable-table"><table><tbody><tr><th>  $ 00 </th><th> <code>$02</code> </th> <th> <code>$07</code> </th> <th> <code>$08</code> </th> <th> <code>$0A</code> </th> <th> <code>$0B</code> </th> <th> <code>$0E</code> </th> <th> <code>$12</code> </th> </tr><tr><th>  0 </th><td>  2 </td><td>  0 </td><td>  1 </td><td>  3 </td><td>  4 </td><td>  0 </td><td>  4 </td></tr><tr><th>  1 </th><td>  3 </td><td>  1 </td><td>  2 </td><td>  4 </td><td>  5 </td><td>  1 </td><td>  5 </td></tr><tr><th>  2 </th><td>  4 </td><td>  2 </td><td>  3 </td><td>  5 </td><td>  6 </td><td>  2 </td><td>  6 </td></tr><tr><th>  3 </th><td>  5 </td><td>  3 </td><td>  4 </td><td>  6 </td><td>  0 </td><td>  3 </td><td>  0 </td></tr><tr><th>  4 </th><td>  6 </td><td>  4 </td><td>  5 </td><td>  0 </td><td>  1 </td><td>  4 </td><td>  1 </td></tr><tr><th>  5 </th><td>  0 </td><td>  5 </td><td>  6 </td><td>  1 </td><td>  2 </td><td>  5 </td><td>  2 </td></tr><tr><th>  6 </th><td>  1 </td><td>  6 </td><td>  0 </td><td>  2 </td><td>  3 </td><td>  6 </td><td>  3 </td></tr><tr><th>  7 </th><td>  2 </td><td>  0 </td><td>  1 </td><td>  3 </td><td>  4 </td><td>  0 </td><td>  4 </td></tr></tbody></table></div><br>  Jede Zelle enth√§lt einen Tetrimino-Typ, der berechnet wird, indem die Orientierungs-ID der erstellten Figur (Spalte) zu einem 3-Bit-Wert (Zeile) addiert und dann der Rest der Division durch 7 auf die Summe <code>$0E</code> . Jede Zeile enth√§lt Duplikate, da <code>$07</code> und <code>$0E</code> gleichm√§√üig geteilt werden um 7, w√§hrend <code>$0B</code> und <code>$12</code> ein gemeinsames Guthaben haben.  Die Zeilen 0 und 7 sind identisch, da sie einen Abstand von 7 haben. <br><br>  Es gibt 56 m√∂gliche Eingabekombinationen, und wenn die resultierenden Tetrimino-Typen gleichm√§√üig verteilt sind, k√∂nnen wir erwarten, dass in der obigen Tabelle jeder Typ genau achtmal vorkommt.  Wie unten gezeigt, ist dies jedoch nicht der Fall. <br><br><div class="scrollable-table"><table><tbody><tr><th>  Typ </th><th>  Frequenz </th></tr><tr><td>  T. </td><td>  9 </td></tr><tr><td>  J. </td><td>  8 </td></tr><tr><td>  Z. </td><td>  8 </td></tr><tr><td>  O. </td><td>  8 </td></tr><tr><td>  S. </td><td>  9 </td></tr><tr><td>  L. </td><td>  7 </td></tr><tr><td>  Ich </td><td>  7 </td></tr></tbody></table></div><br>  T und S erscheinen h√§ufiger und L und I - seltener.  Aber verzerrter Code, der die Orientierungs-ID verwendet, wird nicht jedes Mal ausgef√ºhrt, wenn das Unterprogramm aufgerufen wird. <br><br>  Angenommen, PRNG erstellt eine Folge gleichm√§√üig verteilter statistischer unabh√§ngiger Werte.  Dies ist eigentlich eine faire Annahme, wenn man bedenkt, wie das Spiel versucht, die richtige Zuf√§lligkeit aus den Aktionen des Spielers zu ziehen.  Das Hinzuf√ºgen der Anzahl der erstellten Zahlen zur Adresse <code>$990C</code> sich nicht auf die Verteilung aus, da sich die Anzahl zwischen den Anrufen gleichm√§√üig erh√∂ht.  Die Verwendung der Bitmaske bei <code>$990E</code> √§hnelt der Anwendung der Division durch 8 mit dem Rest, was sich auch nicht auf die Verteilung auswirkt.  Daher geht die √úberpr√ºfung bei <code>$9910</code> <code>invalidIndex</code> in 1/8 aller F√§lle an <code>invalidIndex</code> .  Und die Wahrscheinlichkeit, beim Pr√ºfen an der Adresse <code>$9918</code> , wo die neu ausgew√§hlte Zahl mit der vorherigen Zahl verglichen wird, betr√§gt 7/8, mit einer Wahrscheinlichkeit des Zusammentreffens von 1/7.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies bedeutet, dass es eine zus√§tzliche Chance gibt, </font></font><code>7/8 √ó 1/7 = 1/8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dabei zu sein </font></font><code>invalidIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Im Allgemeinen besteht eine Wahrscheinlichkeit von 25%, einen verzerrten Code zu verwenden, und eine Wahrscheinlichkeit von 75%, einen Code zu verwenden, der Tetrimino gleichm√§√üig ausw√§hlt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In einem Satz von 224 erstellten Tetriminos betr√§gt die mathematische Erwartung 32 Instanzen f√ºr jeden Typ. </font><font style="vertical-align: inherit;">Tats√§chlich erstellt der Code jedoch die folgende Verteilung:</font></font><br><br><div class="scrollable-table"><table><tbody><tr><th>  Typ </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Frequenz </font></font></th></tr><tr><td>  T. </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 33 </font></font></td></tr><tr><td>  J. </td><td>  32 </td></tr><tr><td>  Z. </td><td>  32 </td></tr><tr><td>  O. </td><td>  32 </td></tr><tr><td>  S. </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 33 </font></font></td></tr><tr><td>  L. </td><td>  31 </td></tr><tr><td>  Ich </td><td>  31 </td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, wenn Sie 90 Zeilen l√∂schen und Level 9 erreichen, erh√§lt der Spieler ein zus√§tzliches T und S und ein L und I weniger als statistisch erwartet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tetrimino werden mit folgenden Wahrscheinlichkeiten ausgew√§hlt:</font></font><br><br><div class="scrollable-table"><table><tbody><tr><th>  Typ </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wahrscheinlichkeit </font></font></th></tr><tr><td>  T. </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14,73% </font></font></td></tr><tr><td>  J. </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14,29% </font></font></td></tr><tr><td>  Z. </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14,29% </font></font></td></tr><tr><td>  O. </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14,29% </font></font></td></tr><tr><td>  S. </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14,73% </font></font></td></tr><tr><td>  L. </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 13,84% </font></font></td></tr><tr><td>  Ich </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 13,84% </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es scheint, dass in der Aussage, dass der ‚Äûlange Stock‚Äú, den ich nie sehe, wenn er gebraucht wird, ein Teil der Wahrheit enthalten ist (zumindest f√ºr Nintendo Tetris). </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tetrimino-Schicht </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nintendo Tetris verwendet Delayed Auto Shift (DAS). </font><font style="vertical-align: inherit;">Durch Klicken auf "Links" oder "Rechts" wird das Tetrimino sofort um eine Zelle horizontal verschoben. </font><font style="vertical-align: inherit;">Wenn Sie eine dieser Richtungstasten gedr√ºckt halten, verschiebt das Spiel die Figur automatisch alle 6 Frames mit einer anf√§nglichen Verz√∂gerung von 16 Frames. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Art der horizontalen Bewegung wird durch den Code an der Adresse gesteuert </font></font><code>$89AE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wie im Rotationscode wird hier eine tempor√§re Variable verwendet, um die Koordinaten zu </font><font style="vertical-align: inherit;">sichern, falls die neue Position falsch ist. </font><font style="vertical-align: inherit;">Beachten Sie, dass die Pr√ºfung verhindert, dass Sie das St√ºck bewegen, w√§hrend der Spieler nach unten dr√ºckt.</font></font><br><br> <code>89AE: LDA $0040 <br> 89B0: STA $00AE ; originalX = tetriminoX; <br> <br> 89B2: LDA $00B6 ; if (pressing down) { <br> 89B4: AND #$04 ; return; <br> 89B6: BNE $8A09 ; } <br> <br> 89B8: LDA $00B5 ; if (just pressed left/right) { <br> 89BA: AND #$03 ; goto resetAutorepeatX; <br> 89BC: BNE $89D3 ; } <br> <br> 89BE: LDA $00B6 ; if (not pressing left/right) { <br> 89C0: AND #$03 ; return; <br> 89C2: BEQ $8A09 ; } <br> <br> 89C4: INC $0046 ; autorepeatX++; <br> 89C6: LDA $0046 ; if (autorepeatX &lt; 16) { <br> 89C8: CMP #$10 ; return; <br> 89CA: BMI $8A09 ; } <br> <br> 89CC: LDA #$0A <br> 89CE: STA $0046 ; autorepeatX = 10; <br> 89D0: JMP $89D7 ; goto buttonHeldDown; <br> <br> resetAutorepeatX: <br> <br> 89D3: LDA #$00 <br> 89D5: STA $0046 ; autorepeatX = 0; <br> <br> buttonHeldDown: <br> <br> 89D7: LDA $00B6 ; if (not pressing right) { <br> 89D9: AND #$01 ; goto notPressingRight; <br> 89DB: BEQ $89EC ; } <br> <br> 89DD: INC $0040 ; tetriminoX++; <br> 89DF: JSR $948B ; if (new position not valid) { <br> 89E2: BNE $8A01 ; goto restoreX; <br> ; } <br> <br> 89E4: LDA #$03 <br> 89E6: STA $06F1 ; play shift sound effect; <br> 89E9: JMP $8A09 ; return; <br> <br> notPressingRight: <br> <br> 89EC: LDA $00B6 ; if (not pressing left) { <br> 89EE: AND #$02 ; return; <br> 89F0: BEQ $8A09 ; } <br> <br> 89F2: DEC $0040 ; tetriminoX--; <br> 89F4: JSR $948B ; if (new position not valid) { <br> 89F7: BNE $8A01 ; goto restoreX; <br> ; } <br> <br> 89F9: LDA #$03 <br> 89FB: STA $06F1 ; play shift sound effect; <br> 89FE: JMP $8A09 ; return; <br> <br> restoreX: <br> <br> 8A01: LDA $00AE <br> 8A03: STA $0040 ; tetriminoX = originalX; <br> <br> 8A05: LDA #$10 <br> 8A07: STA $0046 ; autorepeatX = 16; <br> <br> 8A09: RTS ; return;</code> <br> <br><font style="vertical-align: inherit;"></font><code>x</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tetrimino werfen </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Geschwindigkeit des automatischen Abstiegs von Tetrimino ist eine Funktion der Levelnummer. </font><font style="vertical-align: inherit;">Die Geschwindigkeiten werden als Anzahl der gerenderten Frames f√ºr den Abstieg in der Tabelle bei codiert </font></font><code>$898E</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Da NES mit 60,0988 Bildern / s arbeitet, k√∂nnen Sie den Zeitraum zwischen Abfahrten und die Geschwindigkeit berechnen.</font></font><br><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Level </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Abstiegsrahmen </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zeitraum (s / Abstieg) </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Geschwindigkeit (Zellen / s) </font></font></th></tr><tr><td>  0 </td><td>  48 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .799 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1,25 </font></font></td></tr><tr><td>  1 </td><td>  43 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .715 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1,40 </font></font></td></tr><tr><td>  2 </td><td>  38 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .632 </font></font></td><td>  1,58 </td></tr><tr><td>  3 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 33 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .549 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1,82 </font></font></td></tr><tr><td>  4 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 28 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .466 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.15 </font></font></td></tr><tr><td>  5 </td><td>  23 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .383 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.61 </font></font></td></tr><tr><td>  6 </td><td>  18 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .300 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.34 </font></font></td></tr><tr><td>  7 </td><td>  13 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .216 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4.62 </font></font></td></tr><tr><td>  8 </td><td>  8 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .133 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7.51 </font></font></td></tr><tr><td>  9 </td><td>  6 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .100 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10.02 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10-12 </font></font></td><td>  5 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .083 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 12.02 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 13-15 </font></font></td><td>  4 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .067 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 15.05 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 16-18 </font></font></td><td>  3 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .050 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 20.03 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 19‚Äì28 </font></font></td><td>  2 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .033 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 30.05 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29+ </font></font></td><td>  1 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .017 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 60.10 </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Tabelle enth√§lt insgesamt 30 Eintr√§ge. Nach Stufe 29 ist der Wert der Frames f√ºr den Abstieg immer 1. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine ganzzahlige Anzahl von Frames f√ºr den Abstieg ist keine sehr detaillierte Methode zur Beschreibung der Geschwindigkeit. Wie in der folgenden Grafik gezeigt, steigt die Geschwindigkeit mit jedem Level exponentiell an. Tats√§chlich ist Level 29 doppelt so schnell wie Level 28.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddd/18c/a29/ddd18ca2950f9055bd5f82108a4d3ddc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei 1 Frame / Abstieg hat der Spieler nicht mehr als 1/3 Sekunde Zeit, um die Figur zu positionieren. Danach beginnt sie sich zu bewegen. Bei dieser Abstiegsgeschwindigkeit erlaubt DAS der Figur nicht, die R√§nder des Spielfelds zu erreichen, bis sie einrastet, was f√ºr die meisten Menschen ein schnelles Ende des Spiels bedeutet. Einige Spieler, insbesondere </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thor Akerlund</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , haben es jedoch geschafft, DAS mit der schnellen Vibration der Kreuztasten ( </font></font><code>D-pad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">zu besiegen </font><font style="vertical-align: inherit;">. In dem oben gezeigten Verschiebungscode ist zu sehen, dass es m√∂glich ist, das Tetrimino bei Stufen 29 und h√∂her mit halber Frequenz zu verschieben, w√§hrend die horizontale Richtungstaste durch den Rahmen losgelassen wird. Dies ist ein theoretisches Maximum, aber jede Vibration des Daumens √ºber 3,75 Taps / s kann die urspr√ºngliche Verz√∂gerung von 16 Bildern zunichte machen.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der automatische und vom Spieler gesteuerte Abstieg (durch Dr√ºcken von "Down") zusammenf√§llt und in einem Frame erfolgt, summiert sich der Effekt nicht. Durch eines oder beide dieser Ereignisse wird die Form in diesem Frame um genau eine Zelle verringert. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Triggersteuerlogik befindet sich bei </font></font><code>$8914</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Die Abstiegsrahmentabelle befindet sich unter dem Etikett </font><font style="vertical-align: inherit;">. Wie oben erw√§hnt, betr√§gt die Geschwindigkeit ab Stufe 29 konstant 1 Verschluss / Bild. </font><font style="vertical-align: inherit;">(Adresse </font><font style="vertical-align: inherit;">) startet den Abstieg, wenn er </font><font style="vertical-align: inherit;">( </font><font style="vertical-align: inherit;">) erreicht. Das Inkrement </font><font style="vertical-align: inherit;">wird an einer Adresse </font><font style="vertical-align: inherit;">au√üerhalb dieses Codefragments ausgef√ºhrt. W√§hrend des automatischen oder kontrollierten Abstiegs wird es auf 0 zur√ºckgesetzt. Die </font><font style="vertical-align: inherit;">Variable </font><font style="vertical-align: inherit;">( </font><font style="vertical-align: inherit;">) wird mit dem Wert </font><font style="vertical-align: inherit;">(an der Adresse </font><font style="vertical-align: inherit;">) initialisiert</font></font><br><br> <code>8914: LDA $004E ; if (autorepeatY &gt; 0) { <br> 8916: BPL $8922 ; goto autorepeating; <br> ; } else if (autorepeatY == 0) { <br> ; goto playing; <br> ; } <br> <br> ; game just started <br> ; initial Tetrimino hanging at spawn point <br> <br> 8918: LDA $00B5 ; if (not just pressed down) { <br> 891A: AND #$04 ; goto incrementAutorepeatY; <br> 891C: BEQ $8989 ; } <br> <br> ; player just pressed down ending startup delay <br> <br> 891E: LDA #$00 <br> 8920: STA $004E ; autorepeatY = 0; <br> 8922: BNE $8939 <br> <br> playing: <br> <br> 8924: LDA $00B6 ; if (left or right pressed) { <br> 8926: AND #$03 ; goto lookupDropSpeed; <br> 8928: BNE $8973 ; } <br> <br> ; left/right not pressed <br> <br> 892A: LDA $00B5 <br> 892C: AND #$0F ; if (not just pressed only down) { <br> 892E: CMP #$04 ; goto lookupDropSpeed; <br> 8930: BNE $8973 ; } <br> <br> ; player exclusively just presssed down <br> <br> 8932: LDA #$01 <br> 8934: STA $004E ; autorepeatY = 1; <br> <br> 8936: JMP $8973 ; goto lookupDropSpeed; <br> <br> autorepeating: <br> <br> 8939: LDA $00B6 <br> 893B: AND #$0F ; if (down pressed and not left/right) { <br> 893D: CMP #$04 ; goto downPressed; <br> 893F: BEQ $894A ; } <br> <br> ; down released <br> <br> 8941: LDA #$00 <br> 8943: STA $004E ; autorepeatY = 0 <br> 8945: STA $004F ; holdDownPoints = 0 <br> 8947: JMP $8973 ; goto lookupDropSpeed; <br> <br> downPressed: <br> <br> 894A: INC $004E ; autorepeatY++; <br> 894C: LDA $004E <br> 894E: CMP #$03 ; if (autorepeatY &lt; 3) { <br> 8950: BCC $8973 ; goto lookupDropSpeed; <br> ; } <br> <br> 8952: LDA #$01 <br> 8954: STA $004E ; autorepeatY = 1; <br> <br> 8956: INC $004F ; holdDownPoints++; <br> <br> drop: <br> <br> 8958: LDA #$00 <br> 895A: STA $0045 ; fallTimer = 0; <br> <br> 895C: LDA $0041 <br> 895E: STA $00AE ; originalY = tetriminoY; <br> <br> 8960: INC $0041 ; tetriminoY++; <br> 8962: JSR $948B ; if (new position valid) { <br> 8965: BEQ $8972 ; return; <br> ; } <br> <br> ; the piece is locked <br> <br> 8967: LDA $00AE <br> 8969: STA $0041 ; tetriminoY = originalY; <br> <br> 896B: LDA #$02 <br> 896D: STA $0048 ; playState = UPDATE_PLAYFIELD; <br> 896F: JSR $9CAF ; updatePlayfield(); <br> <br> 8972: RTS ; return; <br> <br> lookupDropSpeed: <br> <br> 8973: LDA #$01 ; tempSpeed = 1; <br> <br> 8975: LDX $0044 ; if (level &gt;= 29) { <br> 8977: CPX #$1D ; goto noTableLookup; <br> 8979: BCS $897E ; } <br> <br> 897B: LDA $898E,X ; tempSpeed = framesPerDropTable[level]; <br> <br> noTableLookup: <br> <br> 897E: STA $00AF ; dropSpeed = tempSpeed; <br> <br> 8980: LDA $0045 ; if (fallTimer &gt;= dropSpeed) { <br> 8982: CMP $00AF ; goto drop; <br> 8984: BPL $8958 ; } <br> <br> 8986: JMP $8972 ; return; <br> <br> incrementAutorepeatY: <br> <br> 8989: INC $004E ; autorepeatY++; <br> 898B: JMP $8972 ; return;</code> <br> <br><font style="vertical-align: inherit;"></font><code>lookupDropSpeed</code><font style="vertical-align: inherit;"></font><br><br> <code>fallTimer</code><font style="vertical-align: inherit;"></font><code>$0045</code><font style="vertical-align: inherit;"></font><code>dropSpeed</code><font style="vertical-align: inherit;"></font><code>$00AF</code><font style="vertical-align: inherit;"></font><code>fallTimer</code><font style="vertical-align: inherit;"></font><code>$8892</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>autorepeatY</code><font style="vertical-align: inherit;"></font><code>$004E</code><font style="vertical-align: inherit;"></font><code>$0A</code><font style="vertical-align: inherit;"></font><code>$8739</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), was als ‚àí96 interpretiert wird. Ein Zustand ganz am Anfang verursacht eine anf√§ngliche Verz√∂gerung. Der allererste Tetrimino bleibt zum Zeitpunkt der Erstellung in der Luft schwebend, bis </font></font><code>autorepeatY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">er auf 0 ansteigt, was 1,6 Sekunden dauert. Wenn Sie in dieser Phase jedoch auf Nach unten dr√ºcken, wird </font></font><code>autorepeatY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sofort 0 zugewiesen. Es ist interessant, dass Sie die Figur in dieser Phase der anf√§nglichen Verz√∂gerung verschieben und drehen k√∂nnen, ohne sie abzubrechen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Inkrement </font></font><code>autorepeatY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird ausgef√ºhrt, w√§hrend Sie gedr√ºckt halten. Wenn es 3 erreicht, tritt ein vom Menschen kontrollierter Abstieg ("weicher" Abstieg) auf und wird 1 </font></font><code>autorepeatY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zugewiesen. Daher erfordert der anf√§ngliche weiche Abstieg 3 Rahmen, der sich dann jedoch in jedem Rahmen wiederholt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au√üerdem </font></font><code>autorepeatY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erh√∂ht </font><font style="vertical-align: inherit;">es </font><font style="vertical-align: inherit;">sich nur dann von 0 auf 1, wenn das Spiel erkennt, dass der Spieler gerade auf Nach unten geklickt hat (um</font></font><code>$00B5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), erkennt aber nicht das Halten. Dies ist wichtig, da es </font></font><code>autorepeatY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beim Erstellen eines Tetrimino (an der Adresse </font></font><code>$98E8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">auf 0 zur√ºckgesetzt wird </font><font style="vertical-align: inherit;">, was eine wichtige Funktion erzeugt: Wenn der Spieler selbst die Figur senkt und sie blockiert ist und er beim Erstellen der n√§chsten Figur weiter auf ‚ÄûNach unten‚Äú dr√ºckt, was dann h√§ufig auf hohen Ebenen geschieht Dies f√ºhrt nicht zu einem sanften Abstieg der neuen Figur. Dazu muss der Player ‚ÄûDown‚Äú loslassen und dann die Taste erneut dr√ºcken. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Potenziell sanfter Abstieg kann Punkte erh√∂hen. </font></font><code>holdDownPoints</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>$004F</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) nimmt mit jedem Abstieg zu, aber wenn losgelassen, wird ‚ÄûDown‚Äú auf 0 zur√ºckgesetzt. Um Punkte zu erzielen, muss das Tetrimino daher mit einem sanften Abstieg in das Schloss abgesenkt werden. Ein kurzfristiger sanfter Abstieg, der in der Abbildung auftreten kann, wirkt sich nicht auf die Punkte aus. Das Konto wird um aktualisiert</font></font><code>$9BFE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wird aber </font></font><code>holdDownPoints</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bald darauf an der Adresse auf 0 zur√ºckgesetzt </font></font><code>$9C2F</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Pr√ºfung, die den Spieler daran hindert, einen sanften Abstieg mit einer horizontalen Verschiebung der Figur durchzuf√ºhren, erschwert das Setzen von Punkten. Dies bedeutet, dass der letzte Zug vor dem Verriegeln des Teils "Ab" sein sollte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der Abstieg erfolgt, wird </font></font><code>tetriminoY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>$0041</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) nach </font></font><code>originalY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>$00AE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">kopiert </font><font style="vertical-align: inherit;">. Wenn </font></font><code>tetriminoY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sich herausstellt, dass </font><font style="vertical-align: inherit;">die durch das Inkrement erzeugte neue Position </font><font style="vertical-align: inherit;">falsch ist (dh die Figur schiebt sich entweder durch den Boden des Spielfelds oder √ºberlagert bereits liegende Felder), bleibt das Tetrimino in der vorherigen Position. In diesem Fall wird es wiederhergestellt</font></font><code>tetriminoY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und die Figur gilt als blockiert. </font><font style="vertical-align: inherit;">Dies bedeutet, dass die Verz√∂gerung vor dem Verriegeln (die maximale Anzahl von Frames, die ein Tetrimino erwartet und die vor dem Verriegeln in der Luft h√§lt) gleich der Verz√∂gerung beim Abstieg ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Starrer Abstieg (sofortiger Abstieg) wird in Nintendo Tetris nicht unterst√ºtzt.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Schieben und Scrollen </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das Nintendo Tetris-Handbuch enth√§lt ein illustriertes Belegbeispiel: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f6f/4bb/647/f6f4bb647937094d3d68fae530b0bfd4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Gleiten besteht darin, sich entlang der Oberfl√§che anderer Figuren oder entlang des Bodens des Spielfelds zu verschieben. </font><font style="vertical-align: inherit;">Es wird normalerweise verwendet, um eine Figur unter ein √ºberh√§ngendes Quadrat zu schieben. </font><font style="vertical-align: inherit;">Das Gleiten kann durchgef√ºhrt werden, bis der Fall-Timer die Sinkgeschwindigkeit erreicht hat. Danach wird die Figur fixiert. </font><font style="vertical-align: inherit;">Ein animiertes Beispiel ist unten dargestellt.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/efe/9f5/022/efe9f502248d4185409fc20db3a47647.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Auf der anderen Seite k√∂nnen Sie durch Scrollen Figuren in R√§ume verschieben, die auf andere Weise nicht erreichbar sind (siehe unten). </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c53/ca5/350/c53ca53509826b9f2c462c0290ffa9c9.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie beim Schieben ist das Scrollen ohne Sperrverz√∂gerung nicht m√∂glich. </font><font style="vertical-align: inherit;">Dar√ºber hinaus nutzt das Scrollen die Art und Weise, wie das Spiel Formen manipuliert. </font><font style="vertical-align: inherit;">Vor dem Bewegen oder Drehen der Figur pr√ºft das Spiel, ob sich nach dem √Ñndern der Position alle Tetrimino-Quadrate in leeren Zellen innerhalb der Grenzen des Spielfelds befinden. </font><font style="vertical-align: inherit;">Eine solche Pr√ºfung, wie unten gezeigt, verhindert nicht die Drehung durch nahegelegene gef√ºllte Bl√∂cke. </font><font style="vertical-align: inherit;">Wie im Abschnitt Tetrimino-Beschreibung angegeben, enth√§lt jede Zeile der Orientierungstabelle 12 Bytes. </font><font style="vertical-align: inherit;">Daher wird der Index in dieser Tabelle berechnet, indem die Orientierungs-ID des aktiven Tetriminos mit 12 multipliziert wird. Wie unten gezeigt, werden alle Multiplikationen in der Routine unter Verwendung von Verschiebungen und Additionen durchgef√ºhrt.</font></font><br><br> <code>948B: LDA $0041 <br> 948D: ASL <br> 948E: STA $00A8 <br> 9490: ASL <br> 9491: ASL <br> 9492: CLC <br> 9493: ADC $00A8 <br> 9495: ADC $0040 <br> 9497: STA $00A8 <br> <br> 9499: LDA $0042 <br> 949B: ASL <br> 949C: ASL <br> 949D: STA $00A9 <br> 949F: ASL <br> 94A0: CLC <br> 94A1: ADC $00A9 <br> 94A3: TAX ; index = 12 * orientationID; <br> 94A4: LDY #$00 <br> <br> 94A6: LDA #$04 <br> 94A8: STA $00AA ; for(i = 0; i &lt; 4; i++) { <br> <br> 94AA: LDA $8A9C,X ; squareY = orientationTable[index]; <br> 94AD: CLC <br> 94AE: ADC $0041 ; cellY = squareY + tetriminoY; <br> 94B0: ADC #$02 ; if (cellY &lt; -2 || cellY &gt;= 20) { <br> 94B2: CMP #$16 ; return false; <br> 94B4: BCS $94E9 ; } <br> <br> 94B6: LDA $8A9C,X <br> 94B9: ASL <br> 94BA: STA $00AB <br> 94BC: ASL <br> 94BD: ASL <br> 94BE: CLC <br> 94BF: ADC $00AB <br> 94C1: CLC <br> 94C2: ADC $00A8 <br> 94C4: STA $00AD <br> <br> 94C6: INX <br> 94C7: INX ; index += 2; <br> <br> 94C8: LDA $8A9C,X ; squareX = orientationTable[index]; <br> 94CB: CLC <br> 94CC: ADC $00AD <br> 94CE: TAY ; cellX = squareX + tetriminoX; <br> 94CF: LDA ($B8),Y ; if (playfield[10 * cellY + cellX] != EMPTY_TILE) { <br> 94D1: CMP #$EF ; return false; <br> 94D3: BCC $94E9 ; } <br> <br> 94D5: LDA $8A9C,X <br> 94D8: CLC <br> 94D9: ADC $0040 ; if (cellX &lt; 0 || cellX &gt;= 10) { <br> 94DB: CMP #$0A ; return false; <br> 94DD: BCS $94E9 ; } <br> <br> 94DF: INX ; index++; <br> 94E0: DEC $00AA <br> 94E2: BNE $94AA ; } <br> <br> 94E4: LDA #$00 <br> 94E6: STA $00A8 <br> 94E8: RTS ; return true; <br> <br> 94E9: LDA #$FF <br> 94EB: STA $00A8 <br> 94ED: RTS</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>index = (orientationID &lt;&lt; 3) + (orientationID &lt;&lt; 2); // index = 8 * orientationID + 4 * orientationID; <br> <br> (cellY &lt;&lt; 3) + (cellY &lt;&lt; 1) // 8 * cellY + 2 * cellY</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jede Iteration des Zyklus verschiebt die Tetrimino-Position um die relativen Koordinaten eines der Quadrate aus der Orientierungstabelle, um den entsprechenden Zellenort auf dem Spielfeld zu erhalten. Anschlie√üend √ºberpr√ºft sie, ob die Koordinaten der Zelle innerhalb der Grenzen des Spielfelds liegen und ob die Zelle selbst leer ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In den Kommentaren wird klarer beschrieben, wie der Zeilenabstand √ºberpr√ºft wird. </font><font style="vertical-align: inherit;">Zus√§tzlich zu den Zellen in den sichtbaren Linien betrachtet der Code die beiden ausgeblendeten Linien √ºber dem Spielfeld als die rechtlichen Positionen der Quadrate, ohne eine zusammengesetzte Bedingung zu verwenden. Dies funktioniert, weil im </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">zus√§tzlichen Code die</font></a><font style="vertical-align: inherit;"> negativen Zahlen, die durch Einzelbyte-Variablen dargestellt werden, Werten gr√∂√üer als 127 entsprechen. In diesem Fall ist der Mindestwert </font><font style="vertical-align: inherit;">‚Äì2, der als gespeichert wird</font></font><br><br> <code>94AA: LDA $8A9C,X ; squareY = orientationTable[index]; <br> 94AD: CLC <br> 94AE: ADC $0041 ; cellY = squareY + tetriminoY; <br> 94B0: ADC #$02 ; if (cellY + 2 &gt;= 22) { <br> 94B2: CMP #$16 ; return false; <br> 94B4: BCS $94E9 ; }</code> <br> <br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code>cellY</code><font style="vertical-align: inherit;"></font><code>$FE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(254 in Dezimalschreibweise). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Index des Spielfeldes ist die Summe </font></font><code>cellY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multipliziert mit 10 und </font></font><code>cellX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wenn jedoch </font></font><code>cellY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äì1 ( </font></font><code>$FF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 255) oder ‚Äì2 ( </font></font><code>$FE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 254), ergibt das Produkt ‚Äì10 ( </font></font><code>$F6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 246) und ‚Äì20 ( </font></font><code>$EC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= 236). Im Intervall </font></font><code>cellX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kann es nicht mehr als 9 sein, was einen maximalen Index von 246 + 9 = 255 ergibt, und dies ist viel weiter als das Ende des Spielfelds. Das Spiel wird jedoch initialisiert </font></font><code>$0400</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>$04FF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mit einem Wert </font></font><code>$EF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(eines leeren Pl√§ttchens), wodurch weitere 56 zus√§tzliche Bytes leeren Raums erstellt werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seltsam diese Intervallpr√ºfung</font></font><code>cellX</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">durchgef√ºhrt nach der Untersuchung der Zelle des Spielfeldes. </font><font style="vertical-align: inherit;">Aber es funktioniert in jeder Reihenfolge richtig. </font><font style="vertical-align: inherit;">Durch √úberpr√ºfen des Intervalls wird au√üerdem die zusammengesetzte Bedingung vermieden, wie im folgenden Kommentar angegeben. </font><font style="vertical-align: inherit;">Die unten gezeigten Bildlaufbeispiele sind aufgrund der Art und Weise m√∂glich, wie dieser Code Positionen √ºberpr√ºft.</font></font><br><br> <code>94D5: LDA $8A9C,X <br> 94D8: CLC <br> 94D9: ADC $0040 ; if (cellX &gt;= 10) { <br> 94DB: CMP #$0A ; return false; <br> 94DD: BCS $94E9 ; }</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/45f/c2d/dc0/45fc2ddc0d156d534aad4fd065b86aa4.gif"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/185/0db/15f1850dbfca0b491498e8d81ab03877.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wie unten gezeigt, k√∂nnen Sie sogar durch Scrollen gleiten. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08f/74c/c78/08f74cc7825cd53d5a8002b8e33c4612.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> AI nutzt die Bewegungsfunktionen des Nintendo Tetris voll aus, einschlie√ülich Schieben und Scrollen. </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Level 30 und h√∂her </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nach Erreichen von Level 30 scheint das Level auf Null zur√ºckgesetzt worden zu sein. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/feb/fee/b1f/febfeeb1faafda1a70f5da385c2276ac.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aber Level 31 zeigt, dass etwas anderes passiert: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26e/057/20c/26e05720ca15aa302a0b61e09498e5a0.png"></div><br>         <code>$96B8</code> . <br><br> <code>96B8: 00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29</code> <br> <br>   ,     ,    <code>$00</code>  <code>$0F</code>      <code>0</code>  <code>F</code> .  ,                 .        -  (binary-coded decimal, BCD);         . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e00/97a/713/e0097a713f629afaf73936d3192820e3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leider scheinen die Spieleentwickler davon ausgegangen zu sein, dass niemand Level 29 bestehen w√ºrde, und haben daher beschlossen, nur 30 Eintr√§ge in die Tabelle einzuf√ºgen. Seltsame angezeigte Werte sind verschiedene Bytes nach der Tabelle. Nur ein Byte (an der Adresse </font></font><code>$0044</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) wird </font><font style="vertical-align: inherit;">verwendet, um die Levelnummer anzugeben </font><font style="vertical-align: inherit;">, weshalb das Spiel langsam die unten gezeigten 256 Werte </font><font style="vertical-align: inherit;">uml√§uft </font><font style="vertical-align: inherit;">.</font></font><br><br><div class="scrollable-table"><table><tbody><tr><th> <code>00</code> </th> <th> <code>0</code> </th> <th> <code>1</code> </th> <th> <code>2</code> </th> <th> <code>3</code> </th> <th> <code>4</code> </th> <th> <code>5</code> </th> <th> <code>6</code> </th> <th> <code>7</code> </th> <th> <code>8</code> </th> <th> <code>9</code> </th> <th> <code>A</code> </th> <th> <code>B</code> </th> <th> <code>C</code> </th> <th> <code>D</code> </th> <th> <code>E</code> </th> <th> <code>F</code> </th> </tr><tr><th> <code>0</code> </th> <td> <code>00</code> </td> <td> <code>01</code> </td> <td> <code>02</code> </td> <td> <code>03</code> </td> <td> <code>04</code> </td> <td> <code>05</code> </td> <td> <code>06</code> </td> <td> <code>07</code> </td> <td> <code>08</code> </td> <td> <code>09</code> </td> <td> <code>10</code> </td> <td> <code>11</code> </td> <td> <code>12</code> </td> <td> <code>13</code> </td> <td> <code>14</code> </td> <td> <code>15</code> </td> </tr><tr><th> <code>1</code> </th> <td> <code>16</code> </td> <td> <code>17</code> </td> <td> <code>18</code> </td> <td> <code>19</code> </td> <td> <code>20</code> </td> <td> <code>21</code> </td> <td> <code>22</code> </td> <td> <code>23</code> </td> <td> <code>24</code> </td> <td> <code>25</code> </td> <td> <code>26</code> </td> <td> <code>27</code> </td> <td> <code>28</code> </td> <td> <code>29</code> </td> <td> <code>00</code> </td> <td> <code>0A</code> </td> </tr><tr><th> <code>2</code> </th> <td> <code>14</code> </td> <td> <code>1E</code> </td> <td> <code>28</code> </td> <td> <code>32</code> </td> <td> <code>3C</code> </td> <td> <code>46</code> </td> <td> <code>50</code> </td> <td> <code>5A</code> </td> <td> <code>64</code> </td> <td> <code>6E</code> </td> <td> <code>78</code> </td> <td> <code>82</code> </td> <td> <code>8C</code> </td> <td> <code>96</code> </td> <td> <code>A0</code> </td> <td> <code>AA</code> </td> </tr><tr><th> <code>3</code> </th> <td> <code>B4</code> </td> <td> <code>BE</code> </td> <td> <code>C6</code> </td> <td> <code>20</code> </td> <td> <code>E6</code> </td> <td> <code>20</code> </td> <td> <code>06</code> </td> <td> <code>21</code> </td> <td> <code>26</code> </td> <td> <code>21</code> </td> <td> <code>46</code> </td> <td> <code>21</code> </td> <td> <code>66</code> </td> <td> <code>21</code> </td> <td> <code>86</code> </td> <td> <code>21</code> </td> </tr><tr><th> <code>4</code> </th> <td> <code>A6</code> </td> <td> <code>21</code> </td> <td> <code>C6</code> </td> <td> <code>21</code> </td> <td> <code>E6</code> </td> <td> <code>21</code> </td> <td> <code>06</code> </td> <td> <code>22</code> </td> <td> <code>26</code> </td> <td> <code>22</code> </td> <td> <code>46</code> </td> <td> <code>22</code> </td> <td> <code>66</code> </td> <td> <code>22</code> </td> <td> <code>86</code> </td> <td> <code>22</code> </td> </tr><tr><th> <code>5</code> </th> <td> <code>A6</code> </td> <td> <code>22</code> </td> <td> <code>C6</code> </td> <td> <code>22</code> </td> <td> <code>E6</code> </td> <td> <code>22</code> </td> <td> <code>06</code> </td> <td> <code>23</code> </td> <td> <code>26</code> </td> <td> <code>23</code> </td> <td> <code>85</code> </td> <td> <code>A8</code> </td> <td> <code>29</code> </td> <td> <code>F0</code> </td> <td> <code>4A</code> </td> <td> <code>4A</code> </td> </tr><tr><th> <code>6</code> </th> <td> <code>4A</code> </td> <td> <code>4A</code> </td> <td> <code>8D</code> </td> <td> <code>07</code> </td> <td> <code>20</code> </td> <td> <code>A5</code> </td> <td> <code>A8</code> </td> <td> <code>29</code> </td> <td> <code>0F</code> </td> <td> <code>8D</code> </td> <td> <code>07</code> </td> <td> <code>20</code> </td> <td> <code>60</code> </td> <td> <code>A6</code> </td> <td> <code>49</code> </td> <td> <code>E0</code> </td> </tr><tr><th> <code>7</code> </th> <td> <code>15</code> </td> <td> <code>10</code> </td> <td> <code>53</code> </td> <td> <code>BD</code> </td> <td> <code>D6</code> </td> <td> <code>96</code> </td> <td> <code>A8</code> </td> <td> <code>8A</code> </td> <td> <code>0A</code> </td> <td> <code>AA</code> </td> <td> <code>E8</code> </td> <td> <code>BD</code> </td> <td> <code>EA</code> </td> <td> <code>96</code> </td> <td> <code>8D</code> </td> <td> <code>06</code> </td> </tr><tr><th> <code>8</code> </th> <td> <code>20</code> </td> <td> <code>CA</code> </td> <td> <code>A5</code> </td> <td> <code>BE</code> </td> <td> <code>C9</code> </td> <td> <code>01</code> </td> <td> <code>F0</code> </td> <td> <code>1E</code> </td> <td> <code>A5</code> </td> <td> <code>B9</code> </td> <td> <code>C9</code> </td> <td> <code>05</code> </td> <td> <code>F0</code> </td> <td> <code>0C</code> </td> <td> <code>BD</code> </td> <td> <code>EA</code> </td> </tr><tr><th> <code>9</code> </th> <td> <code>96</code> </td> <td> <code>38</code> </td> <td> <code>E9</code> </td> <td> <code>02</code> </td> <td> <code>8D</code> </td> <td> <code>06</code> </td> <td> <code>20</code> </td> <td> <code>4C</code> </td> <td> <code>67</code> </td> <td> <code>97</code> </td> <td> <code>BD</code> </td> <td> <code>EA</code> </td> <td> <code>96</code> </td> <td> <code>18</code> </td> <td> <code>69</code> </td> <td> <code>0C</code> </td> </tr><tr><th> <code>A</code> </th> <td> <code>8D</code> </td> <td> <code>06</code> </td> <td> <code>20</code> </td> <td> <code>4C</code> </td> <td> <code>67</code> </td> <td> <code>97</code> </td> <td> <code>BD</code> </td> <td> <code>EA</code> </td> <td> <code>96</code> </td> <td> <code>18</code> </td> <td> <code>69</code> </td> <td> <code>06</code> </td> <td> <code>8D</code> </td> <td> <code>06</code> </td> <td> <code>20</code> </td> <td> <code>A2</code> </td> </tr><tr><th> <code>B</code> </th> <td> <code>0A</code> </td> <td> <code>B1</code> </td> <td> <code>B8</code> </td> <td> <code>8D</code> </td> <td> <code>07</code> </td> <td> <code>20</code> </td> <td> <code>C8</code> </td> <td> <code>CA</code> </td> <td> <code>D0</code> </td> <td> <code>F7</code> </td> <td> <code>E6</code> </td> <td> <code>49</code> </td> <td> <code>A5</code> </td> <td> <code>49</code> </td> <td> <code>C9</code> </td> <td> <code>14</code> </td> </tr><tr><th> <code>C</code> </th> <td> <code>30</code> </td> <td> <code>04</code> </td> <td> <code>A9</code> </td> <td> <code>20</code> </td> <td> <code>85</code> </td> <td> <code>49</code> </td> <td> <code>60</code> </td> <td> <code>A5</code> </td> <td> <code>B1</code> </td> <td> <code>29</code> </td> <td> <code>03</code> </td> <td> <code>D0</code> </td> <td> <code>78</code> </td> <td> <code>A9</code> </td> <td> <code>00</code> </td> <td> <code>85</code> </td> </tr><tr><th> <code>D</code> </th> <td> <code>AA</code> </td> <td> <code>A6</code> </td> <td> <code>AA</code> </td> <td> <code>B5</code> </td> <td> <code>4A</code> </td> <td> <code>F0</code> </td> <td> <code>5C</code> </td> <td> <code>0A</code> </td> <td> <code>A8</code> </td> <td> <code>B9</code> </td> <td> <code>EA</code> </td> <td> <code>96</code> </td> <td> <code>85</code> </td> <td> <code>A8</code> </td> <td> <code>A5</code> </td> <td> <code>BE</code> </td> </tr><tr><th> <code>E</code> </th> <td> <code>C9</code> </td> <td> <code>01</code> </td> <td> <code>D0</code> </td> <td> <code>0A</code> </td> <td> <code>A5</code> </td> <td> <code>A8</code> </td> <td> <code>18</code> </td> <td> <code>69</code> </td> <td> <code>06</code> </td> <td> <code>85</code> </td> <td> <code>A8</code> </td> <td> <code>4C</code> </td> <td> <code>BD</code> </td> <td> <code>97</code> </td> <td> <code>A5</code> </td> <td> <code>B9</code> </td> </tr><tr><th> <code>F</code> </th> <td> <code>C9</code> </td> <td> <code>04</code> </td> <td> <code>D0</code> </td> <td> <code>0A</code> </td> <td> <code>A5</code> </td> <td> <code>A8</code> </td> <td> <code>38</code> </td> <td> <code>E9</code> </td> <td> <code>02</code> </td> <td> <code>85</code> </td> <td> <code>A8</code> </td> <td> <code>4C</code> </td> <td> <code>BD</code> </td> <td> <code>97</code> </td> <td> <code>A5</code> </td> <td> <code>A8</code> </td> </tr></tbody></table></div><br>  20   ‚Äî      ,           20 . <br><br> <code>96D6: 00 ; 0 <br> 96D7: 0A ; 10 <br> 96D8: 14 ; 20 <br> 96D9: 1E ; 30 <br> 96DA: 28 ; 40 <br> 96DB: 32 ; 50 <br> 96DC: 3C ; 60 <br> 96DD: 46 ; 70 <br> 96DE: 50 ; 80 <br> 96DF: 5A ; 90 <br> 96E0: 64 ; 100 <br> 96E1: 6E ; 110 <br> 96E2: 78 ; 120 <br> 96E3: 82 ; 130 <br> 96E4: 8C ; 140 <br> 96E5: 96 ; 150 <br> 96E6: A0 ; 160 <br> 96E7: AA ; 170 <br> 96E8: B4 ; 180 <br> 96E9: BE ; 190</code> <br> <br>      <code>$0400</code>     10 ,    : <br><br> <code>$0400 + 10 * y + x</code> <br> <br> ,      ,         . <br><br> <code>$0400 + [$96D6 + y] + x</code> <br> <br>     40 .    20    little endian  nametable 0 (  VRAM,    ).          <code>$06</code> . <br><br>  ,      ,  . <br><br><h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Anzahl der abgeschlossenen Zeilen und Tetrimino-Statistiken belegen an den folgenden Adressen jeweils 2 Byte. </font></font><br><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adressen </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Menge </font></font></th></tr><tr><td> <code>0050</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - - </font></font><code>0051</code> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R√§nge </font></font></td></tr><tr><td> <code>03F0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - - </font></font><code>03F1</code> </td><td>  T. </td></tr><tr><td> <code>03F2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - - </font></font><code>03F3</code> </td><td>  J. </td></tr><tr><td> <code>03F4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - - </font></font><code>03F5</code> </td><td>  Z. </td></tr><tr><td> <code>03F6</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - - </font></font><code>03F7</code> </td><td>  O. </td></tr><tr><td> <code>03F8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - - </font></font><code>03F9</code> </td><td>  S. </td></tr><tr><td> <code>03FA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - - </font></font><code>03FB</code> </td><td>  L. </td></tr><tr><td> <code>03FC</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - - </font></font><code>03FD</code> </td><td>  Ich </td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tats√§chlich werden diese Werte als 16-Bit-gepackte Little-Endian-BCDs gespeichert. </font><font style="vertical-align: inherit;">Beispielsweise wird unten die Anzahl der Zeilen angezeigt, die 123 betr√§gt. Die Bytes werden von rechts nach links gez√§hlt, sodass die Dezimalstellen der Reihe nach angeordnet sind.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f4/68b/c0e/4f468bc0e6f22afe40d74f1711bad46e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Spieleentwickler gingen jedoch davon aus, dass keiner der Werte gr√∂√üer als 999 sein w√ºrde. Daher verarbeitet die Anzeigelogik das erste Byte korrekt als gepacktes BCD, wobei jedes Halbbyte als Kachelwert verwendet wird. </font><font style="vertical-align: inherit;">Das gesamte zweite Byte wird jedoch tats√§chlich als oberste Dezimalstelle verwendet. </font><font style="vertical-align: inherit;">Wenn die unteren Ziffern von </font></font><code>99</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bis </font><font style="vertical-align: inherit;">gehen </font><font style="vertical-align: inherit;">, </font></font><code>00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tritt das normale Inkrement des zweiten Bytes auf. </font><font style="vertical-align: inherit;">Infolgedessen durchl√§uft das zweite Byte alle 256 Kacheln. </font><font style="vertical-align: inherit;">Ein Beispiel hierf√ºr ist unten dargestellt.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c7/b4a/d52/6c7b4ad52a59641b8c2e04971415f0df.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach dem L√∂schen der Zeile wird der folgende Code ausgef√ºhrt, um die Anzahl der Zeilen zu erh√∂hen. </font><font style="vertical-align: inherit;">√úberpr√ºfungen werden f√ºr die mittlere und untere Ziffer durchgef√ºhrt, so dass sie zwischen 0 und 9 bleiben. Die obere Ziffer kann jedoch unendlich erh√∂ht werden. </font><font style="vertical-align: inherit;">Wenn nach dem Erh√∂hen der Anzahl der Zeilen die untere Ziffer 0 ist, bedeutet dies, dass der Spieler gerade einen Satz von 10 Zeilen abgeschlossen hat und Sie die Levelnummer erh√∂hen m√ºssen. Wie Sie dem folgenden Code entnehmen k√∂nnen, wird vor dem Pegelinkrement eine zus√§tzliche √úberpr√ºfung durchgef√ºhrt. </font><font style="vertical-align: inherit;">Die zweite Pr√ºfung bezieht sich auf das ausgew√§hlte Einstiegsniveau. Um zu einem bestimmten Level zu gelangen </font><font style="vertical-align: inherit;">, muss der Spieler unabh√§ngig vom Anfangslevel kl√§ren</font></font><br><br> <code>9BA8: INC $0050 ; increment middle-lowest digit pair <br> 9BAA: LDA $0050 <br> 9BAC: AND #$0F <br> 9BAE: CMP #$0A ; if (lowest digit &gt; 9) { <br> 9BB0: BMI $9BC7 <br> 9BB2: LDA $0050 <br> 9BB4: CLC <br> 9BB5: ADC #$06 ; set lowest digit to 0, increment middle digit <br> 9BB7: STA $0050 <br> 9BB9: AND #$F0 <br> 9BBB: CMP #$A0 ; if (middle digit &gt; 9) { <br> 9BBD: BCC $9BC7 <br> 9BBF: LDA $0050 <br> 9BC1: AND #$0F <br> 9BC3: STA $0050 ; set middle digit to 0 <br> 9BC5: INC $0051 ; increment highest digit <br> ; } <br> ; }</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br> <code>9BC7: LDA $0050 <br> 9BC9: AND #$0F <br> 9BCB: BNE $9BFB ; if (lowest digit == 0) { <br> 9BCD: JMP $9BD0 <br> <br> 9BD0: LDA $0051 <br> 9BD2: STA $00A9 <br> 9BD4: LDA $0050 <br> 9BD6: STA $00A8 ; copy digits from $0050-$0051 to $00A8-$00A9 <br> <br> 9BD8: LSR $00A9 <br> 9BDA: ROR $00A8 <br> 9BDC: LSR $00A9 <br> 9BDE: ROR $00A8 <br> 9BE0: LSR $00A9 <br> 9BE2: ROR $00A8 ; treat $00A8-$00A9 as a 16-bit packed BCD value <br> 9BE4: LSR $00A9 ; and right-shift it 4 times <br> 9BE6: ROR $00A8 ; this leaves the highest and middle digits in $00A8 <br> <br> 9BE8: LDA $0044 <br> 9BEA: CMP $00A8 ; if (level &lt; [$00A8]) { <br> 9BEC: BPL $9BFB <br> <br> 9BEE: INC $0044 ; increment level <br> ; } <br> ; }</code> <br> <br><font style="vertical-align: inherit;"></font><code>X</code><font style="vertical-align: inherit;"></font><code>10X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linien. Wenn ein Spieler beispielsweise mit Level 5 beginnt, bleibt er darauf, bis er 60 Zeilen gekl√§rt hat. Danach geht er zu Level 6. Danach f√ºhren alle weiteren 10 Zeilen zu einer Erh√∂hung der Levelnummer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um diese Pr√ºfung durchzuf√ºhren, wird der Wert der gef√ºllten Zeilen von </font></font><code>$0050</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>$0051</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nach </font></font><code>$00A8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">kopiert </font></font><code>$00A9</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dann wird die Kopie viermal nach rechts verschoben, was f√ºr eine gepackte BCD der Division durch 10 √§hnelt. Die kleinste Dezimalstelle wird verworfen, und die h√∂chste und die mittlere Stelle werden um eine Position verschoben, was zu Knabbereien f√ºhrt </font></font><code>$00A8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e4/c0b/2e7/8e4c0b2e7d53a33d54cea8717a872a65.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An der Adresse wird </font></font><code>$9BEA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die Ebenennummer jedoch direkt mit dem gepackten Wert des BCD verglichen </font></font><code>$00A8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In der Tabelle gibt es keine Suche, um den BCD-Wert in eine Dezimalzahl umzuwandeln, und dies ist ein eindeutiger Fehler. </font><font style="vertical-align: inherit;">Im obigen Bild sollte beispielsweise die Levelnummer mit </font></font><code>$12</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(18 in Dezimalzahl) und nicht mit 12 </font><font style="vertical-align: inherit;">verglichen werden. </font><font style="vertical-align: inherit;">Wenn sich ein Spieler entscheidet, mit Level 17 zu beginnen, geht das Level tats√§chlich auf 120 Zeilen, da 18 mehr als ist 17. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Tabelle zeigt die erwartete Anzahl von Zeilen, die f√ºr den √úbergang auf jeder Anfangsebene erforderlich sind. </font><font style="vertical-align: inherit;">Es wird mit dem verglichen, was aufgrund eines Fehlers tats√§chlich passiert.</font></font><br><br><div class="scrollable-table"><table><tbody><tr><th> <code> </code> </th> <td>  0 </td><td>  1 </td><td>  2 </td><td>  3 </td><td>  4 </td><td>  5 </td><td>  6 </td><td>  7 </td><td>  8 </td><td>  9 </td><td>  10 </td><td>  11 </td><td>  12 </td><td>  13 </td><td>  14 </td><td>  15 </td><td>  16 </td><td>  17 </td><td>  18 </td><td>  19 </td></tr><tr><th> <code>  </code> </th> <td>  10 </td><td>  20 </td><td>  30 </td><td>  40 </td><td>  50 </td><td>  60 </td><td>  70 </td><td>  80 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 90 </font></font></td><td>  100 </td><td>  110 </td><td>  120 </td><td>  130 </td><td>  140 </td><td>  150 </td><td>  160 </td><td>  170 </td><td>  180 </td><td>  190 </td><td>  200 </td></tr><tr><th> <code>    </code> </th> <td>  10 </td><td>  20 </td><td>  30 </td><td>  40 </td><td>  50 </td><td>  60 </td><td>  70 </td><td>  80 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 90 </font></font></td><td>  100 </td><td>  100 </td><td>  100 </td><td>  100 </td><td>  100 </td><td>  100 </td><td>  100 </td><td>  110 </td><td>  120 </td><td>  130 </td><td>  140 </td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der erwartete Betrag entspricht dem f√ºr die Anfangsstufen 0‚Äì9. </font><font style="vertical-align: inherit;">Tats√§chlich ist der Zufall f√ºr Einstiegsniveau 9 zuf√§llig; </font><font style="vertical-align: inherit;">10-15 geht auch mit 100 Zeilen zur n√§chsten Ebene, weil </font></font><code>$10</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- dies ist 16 in Dezimalform. </font><font style="vertical-align: inherit;">Der gr√∂√üte Unterschied zwischen erwartet und tats√§chlich betr√§gt 60 Zeilen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich vermute, dass der Fehler auf Design√§nderungen in sp√§teren Entwicklungsstadien zur√ºckzuf√ºhren ist. </font><font style="vertical-align: inherit;">Schauen Sie sich den Men√ºbildschirm an, damit der Spieler eine Einstiegsstufe ausw√§hlen kann.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/858/51e/019/85851e019d65bf00d265fa4ea277b8c2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es gibt keine Erkl√§rung, wie man von Levels √ºber 9 ausgeht. In der Nintendo Tetris-Brosch√ºre wird dieses Geheimnis jedoch enth√ºllt: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c20/cee/c3b/c20ceec3b4b30879812be109b6666b79.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es scheint, dass dieses versteckte Merkmal im letzten Moment erfunden wurde. Vielleicht wurde es sehr kurz vor dem Ver√∂ffentlichungsdatum hinzugef√ºgt, was es nicht erm√∂glichte, es vollst√§ndig zu testen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tats√§chlich enth√§lt das √úberpr√ºfen der anf√§nglichen Reihe einen zweiten Fehler, der sich auf die Ausgabe von Werten f√ºr das Intervall bezieht. Unten finden Sie Kommentare im Code, die besser erkl√§ren, was auf niedriger Ebene passiert. </font><font style="vertical-align: inherit;">Der Vergleich erfolgt durch Subtrahieren und √úberpr√ºfen des Vorzeichens des Ergebnisses. Eine vorzeichenbehaftete Einzelbyte-Zahl ist jedoch auf ‚Äì128 bis 127 begrenzt. Wenn die Differenz kleiner als ‚Äì128 ist, wird die Zahl √ºbertragen und das Ergebnis wird zu einer positiven Zahl. Dieses Prinzip wird in den Kommentaren zum Code erl√§utert. </font><font style="vertical-align: inherit;">Bei der √úberpr√ºfung, ob die Differenz in diesem Intervall liegt, muss ber√ºcksichtigt werden, dass die Ebenennummer beim Inkrementieren auf Werte gr√∂√üer als 255 die √úbertragung auf 0 und ausf√ºhrt</font></font><br><br> <code>9BE8: LDA $0044 <br> 9BEA: CMP $00A8 ; if (level - [$00A8] &lt; 0) { <br> 9BEC: BPL $9BFB <br> <br> 9BEE: INC $0044 ; increment level <br> ; }</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>9BE8: LDA $0044 ; difference = level - [$00A8]; <br> 9BEA: CMP $00A8 ; if (difference &lt; 0 &amp;&amp; difference &gt;= -128) { <br> 9BEC: BPL $9BFB <br> <br> 9BEE: INC $0044 ; increment level <br> ; }</code> <br> <br><font style="vertical-align: inherit;"></font><code>$00A8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√∂glicherweise kann es einen beliebigen Wert enthalten, da sein oberes Halbbyte entnommen wird </font></font><code>$0051</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dessen Inkrement unendlich auftreten kann. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Effekte √ºberschneiden sich und erzeugen Perioden, in denen die Levelnummer f√§lschlicherweise unver√§ndert bleibt. </font><font style="vertical-align: inherit;">Perioden treten in regelm√§√üigen Abst√§nden von 2.900 Zeilen auf, beginnend bei 2.190 Zeilen und dauern 800 Zeilen. </font><font style="vertical-align: inherit;">Beispielsweise </font><font style="vertical-align: inherit;">bleibt der Pegel </font><font style="vertical-align: inherit;">von 2190 ( </font></font><code>L90</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) bis 2990 ( </font></font><code>T90</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) gleich </font></font><code>$DB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>96</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), wie unten gezeigt.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/055/e15/8de/055e158de2ecde24e0f052cd325bef32.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der n√§chste Zeitraum liegt zwischen 5090 und 5890, der Pegel ist konstant gleich </font></font><code>$AD</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>06</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Dar√ºber hinaus √§ndert sich w√§hrend dieser Zeitr√§ume auch die Farbpalette nicht.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tetrimino Malvorlagen </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auf jeder Ebene werden Tetrimino-Kacheln 4 einzigartige Farben zugewiesen. </font><font style="vertical-align: inherit;">Die Farben stammen aus der Tabelle unter </font></font><code>$984C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ihre Aufzeichnungen werden alle 10 Ebenen wiederverwendet. </font><font style="vertical-align: inherit;">Von links nach rechts: Die Spalten der Tabelle entsprechen den schwarzen, wei√üen, blauen und roten Bereichen des Bildes unten.</font></font><br><br> <code>984C: 0F 30 21 12 ; level 0 <br> 9850: 0F 30 29 1A ; level 1 <br> 9854: 0F 30 24 14 ; level 2 <br> 9858: 0F 30 2A 12 ; level 3 <br> 985C: 0F 30 2B 15 ; level 4 <br> 9860: 0F 30 22 2B ; level 5 <br> 9864: 0F 30 00 16 ; level 6 <br> 9868: 0F 30 05 13 ; level 7 <br> 986C: 0F 30 16 12 ; level 8 <br> 9870: 0F 30 27 16 ; level 9</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/68e/fc4/7d7/68efc47d771e9c673b003d76810d74fb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Werte entsprechen der NES-Farbpalette. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e80/c0a/8b6/e80c0a8b624b90261042d71eb21d50db.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die ersten beiden Farben jedes Eintrags sind immer schwarz und wei√ü. Die erste Farbe wird jedoch tats√§chlich ignoriert. Unabh√§ngig vom Wert wird es als transparente Farbe betrachtet, durch die ein fester schwarzer Hintergrund sp√§ht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Zugriff auf die Farbtabelle erfolgt in der Routine unter </font></font><code>$9808</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Der Farbtabellenindex basiert auf der Ebenennummer geteilt durch einen Rest von 10. Der Zyklus kopiert den Eintrag in die Palettentabellen in VRAM. </font><font style="vertical-align: inherit;">Die Division mit dem Rest wird durch eine konstante Subtraktion von 10 emuliert, bis das Ergebnis kleiner als 10 ist. Der Beginn der Subroutine mit Kommentaren ist unten gezeigt.</font></font><br><br> <code>9808: LDA $0064 <br> 980A: CMP #$0A <br> 980C: BMI $9814 <br> 980E: SEC <br> 980F: SBC #$0A <br> 9811: JMP $980A ; index = levelNumber % 10; <br> <br> 9814: ASL <br> 9815: ASL <br> 9816: TAX ; index *= 4; <br> <br> 9817: LDA #$00 <br> 9819: STA $00A8 ; for(i = 0; i &lt; 32; i += 16) { <br> <br> 981B: LDA #$3F <br> 981D: STA $2006 <br> 9820: LDA #$08 <br> 9822: CLC <br> 9823: ADC $00A8 <br> 9825: STA $2006 ; palette = $3F00 + i + 8; <br> <br> 9828: LDA $984C,X <br> 982B: STA $2007 ; palette[0] = colorTable[index + 0]; <br> <br> 982E: LDA $984D,X <br> 9831: STA $2007 ; palette[1] = colorTable[index + 1]; <br> <br> 9834: LDA $984E,X <br> 9837: STA $2007 ; palette[2] = colorTable[index + 2]; <br> <br> 983A: LDA $984F,X <br> 983D: STA $2007 ; palette[3] = colorTable[index + 3]; <br> <br> 9840: LDA $00A8 <br> 9842: CLC <br> 9843: ADC #$10 <br> 9845: STA $00A8 <br> 9847: CMP #$20 <br> 9849: BNE $981B ; } <br> <br> 984B: RTS ; return;</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br> <code>9808: LDA $0064 ; index = levelNumber; <br> 980A: CMP #$0A ; while(index &gt;= 10) { <br> 980C: BMI $9814 <br> 980E: SEC <br> 980F: SBC #$0A ; index -= 10; <br> 9811: JMP $980A ; }</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie im vorherigen Abschnitt angegeben, werden jedoch im Vergleich Subtraktion und Verzweigung basierend auf dem Differenzzeichen verwendet. </font><font style="vertical-align: inherit;">Eine vorzeichenbehaftete Einzelbyte-Nummer ist auf ‚Äì128 bis 127 begrenzt. Die aktualisierten Kommentare unten spiegeln dieses Prinzip wider. </font><font style="vertical-align: inherit;">Die folgenden Kommentare werden weiter vereinfacht. </font><font style="vertical-align: inherit;">Dieser Wortlaut zeigt einen Fehler im Code. </font><font style="vertical-align: inherit;">Der Restdivisionsvorgang wird f√ºr Stufen ab 138 vollst√§ndig √ºbersprungen. </font><font style="vertical-align: inherit;">Stattdessen wird der Index direkt der Ebenennummer zugewiesen, die den Zugriff auf Bytes weit √ºber das Ende der Farbtabelle hinaus erm√∂glicht. </font><font style="vertical-align: inherit;">Wie unten gezeigt, kann dies sogar zu einem fast unsichtbaren Tetrimino f√ºhren.</font></font><br><br> <code>9808: LDA $0064 ; index = levelNumber; <br> ; difference = index - 10; <br> 980A: CMP #$0A ; while(difference &gt;= 0 &amp;&amp; difference &lt;= 127) { <br> 980C: BMI $9814 <br> 980E: SEC ; index -= 10; <br> 980F: SBC #$0A ; difference = index - 10; <br> 9811: JMP $980A ; }</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>9808: LDA $0064 ; index = levelNumber; <br> 980A: CMP #$0A ; while(index &gt;= 10 &amp;&amp; index &lt;= 137) { <br> 980C: BMI $9814 <br> 980E: SEC <br> 980F: SBC #$0A ; index -= 10; <br> 9811: JMP $980A ; }</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ed/2e5/2c6/6ed2e52c6a20dc9c8c1ffd1bf13d9b37.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unten sind die Farben aller 256 Ebenen. </font><font style="vertical-align: inherit;">Die Kacheln sind in 10 Spalten angeordnet, um die zyklische Verwendung der Farbtabelle hervorzuheben, gegen die auf Stufe 138 versto√üen wurde. Zeilen und Spalten in den √úberschriften werden dezimal angegeben.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/423/6f0/ed6/4236f0ed6a508633b746d773a530fe90.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach 255 kehrt die Ebenennummer auf 0 zur√ºck </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wie im vorherigen Abschnitt erw√§hnt, √§ndern sich einige Ebenen erst, wenn 800 Zeilen entfernt wurden. </font><font style="vertical-align: inherit;">W√§hrend dieser langen Pegel bleiben die Farben unver√§ndert.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Spielmodus </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der unter der Adresse gespeicherte Spielemodus </font></font><code>$00C0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bestimmt, welcher der verschiedenen Bildschirme und Men√ºs dem Benutzer derzeit angezeigt wird.</font></font><br><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wert </font></font></th><th>  Beschreibung </th></tr><tr><td> <code>00</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bildschirm mit rechtlichen Informationen </font></font></td></tr><tr><td> <code>01</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Begr√º√üungsbildschirm </font></font></td></tr><tr><td> <code>02</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Spieltyp-Men√º </font></font></td></tr><tr><td> <code>03</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Men√º der Ebenen und H√∂hen </font></font></td></tr><tr><td> <code>04</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Spiel / Highscore / Ende / Pause </font></font></td></tr><tr><td> <code>05</code> </td> <td>  Demo </td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie oben gezeigt, verf√ºgt das Spiel √ºber eine clever geschriebene Routine, die als Switch-Anweisung unter Verwendung der kleinen Endian-Navigationstabelle fungiert, die sich unmittelbar nach dem Aufruf befindet. </font><font style="vertical-align: inherit;">Die obige Liste zeigt die Adressen aller Spielmodi. Beachten Sie, dass die Modi "Spiel" und "Demo" denselben Code verwenden. </font><font style="vertical-align: inherit;">Diese Routine kehrt niemals zur√ºck. Stattdessen verwendet der Code die Absenderadresse. Normalerweise zeigt es auf die Anweisung unmittelbar nach dem Aufruf des Sprunges zum Unterprogramm (minus 1 Byte), aber in diesem Fall zeigt es auf die Sprungtabelle. Die Absenderadresse wird vom Stapel genommen und in </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">gespeichert </font><font style="vertical-align: inherit;">. Nach dem Speichern der Adresse der Sprungtabelle verwendet der Code den Wert in Register A als Index und f√ºhrt den entsprechenden √úbergang durch.</font></font><br><br> <code>8161: LDA $00C0 <br> 8163: JSR $AC82 ; switch(gameMode) { <br> 8166: 00 82 ; case 0: goto 8200; //     <br> 8168: 4F 82 ; case 1: goto 824F; //   <br> 816A: D1 82 ; case 2: goto 82D1; //    <br> 816C: D7 83 ; case 3: goto 83D7; //     <br> 816E: 5D 81 ; case 4: goto 815D; //  /   /  /  <br> 8170: 5D 81 ; case 5: goto 815D; //  <br> ; }</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>$0000</code><font style="vertical-align: inherit;"></font><code>$0001</code><font style="vertical-align: inherit;"></font><br><br> <code>AC82: ASL <br> AC83: TAY <br> AC84: INY <br> <br> AC85: PLA <br> AC86: STA $0000 <br> AC88: PLA ; pop return address off of stack <br> AC89: STA $0001 ; and store it at $0000-$0001 <br> <br> AC8B: LDA ($00),Y <br> AC8D: TAX <br> AC8E: INY <br> AC8F: LDA ($00),Y <br> AC91: STA $0001 <br> AC93: STX $0000 <br> AC95: JMP ($0000) ; goto Ath 16-bit address <br> ; in table at [$0000-$0001]</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Code kann diese Schaltroutine verwenden, solange die Indizes nahe bei 0 liegen und zwischen den m√∂glichen F√§llen keine oder nur wenige Leerzeichen stehen. </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bildschirm mit rechtlichen Informationen </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das Spiel beginnt mit einem Bildschirm mit einem rechtlichen Hinweis. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/524/4e2/d4b/5244e2d4b26989579afaad64838c0962.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Am unteren Rand des Bildschirms wird </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aleksey Pazhitnov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als Erfinder, Designer und Programmierer des ersten Tetris erw√§hnt. 1984 entwickelte er als Computerentwickler am </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dorodnitsyn Computing Center</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (einem f√ºhrenden Forschungsinstitut der Russischen Akademie der Wissenschaften in Moskau) einen Prototyp des Spiels auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Electronics-60</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (sowjetischer Klon DEC </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LSI-11</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). F√ºr einen gr√ºnen monochromen Textmodus wurde ein Prototyp entwickelt, bei dem Quadrate durch Paare von eckigen Klammern angezeigt werden </font></font><code>[]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mit Hilfe des 16-j√§hrigen Sch√ºlers </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vadim Gerasimov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und des Computeringenieurs Dmitry Pavlovsky wurde der Prototyp wenige Tage nach der Erfindung des Spiels auf einen IBM-PC mit MS DOS und </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Turbo Pascal</font></a><font style="vertical-align: inherit;"> portiert</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Im Laufe von zwei Jahren perfektionierten sie das Spiel gemeinsam und f√ºgten Funktionen wie Tetrimino-Farben, Statistiken und vor allem einen Timing- und Grafikcode hinzu, mit dem das Spiel auf einer Vielzahl von PC-Modellen und Klonen arbeiten konnte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leider waren ihre Versuche, das Spiel zu monetarisieren, aufgrund der Besonderheiten der Sowjetunion zu dieser Zeit erfolglos und am Ende beschlossen sie, die PC-Version kostenlos mit ihren Freunden zu teilen. Von diesem Moment an verbreitete sich ‚ÄûTetris‚Äú viral im ganzen Land und dar√ºber hinaus und wurde von Festplatte zu Festplatte kopiert. Da das Spiel jedoch von Mitarbeitern einer Regierungsbeh√∂rde entwickelt wurde, geh√∂rte es dem Staat, und 1987 √ºbernahm die f√ºr den internationalen Handel mit elektronischen Technologien zust√§ndige Organisation die Lizenzierung des Spiels ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Electronorgtekhnika (ELORG)).</font></font></a> ).  V/O         ¬´Version Originale¬ª. <br><br>  -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Andromeda</a>     Tetris        , ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mirrorsoft</a> . Mirrorsoft,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tengen</a> ,   Atari Games. Tengen  Bullet-Proof Software          ,     Tetris  Nintendo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Famicom</a> .      . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/750/b96/6c0/750b966c0d526110e504b409b3f1a1af.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interessanterweise wird in dieser Version der Sch√ºler Vadim Gerasimov der urspr√ºngliche Designer und Programmierer genannt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nintendo versuchte, die tragbare Version der kommenden Game Boy-Konsole zu sichern, und verwendete die Bullet-Proof-Software, um einen erfolgreichen Deal direkt mit ELORG abzuschlie√üen. W√§hrend des Abschlusses des Vertrags √ºberarbeitete ELORG seinen Vertrag mit Andromeda und f√ºgte hinzu, dass Andromeda nur Rechte an Spielen f√ºr Computer und Arcade-Automaten erhielt. Aus diesem Grund musste Bullet-Proof Software ELORG-Lizenzgeb√ºhren f√ºr alle f√ºr Famicom verkauften Patronen zahlen, da sich die von Tengen erhaltenen Rechte als F√§lschung herausstellten. Durch die Abstimmung mit ELORG gelang es Bullet-Proof Software schlie√ülich, weltweite Konsolenspielrechte f√ºr Nintendo zu erlangen.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bullet-Proof Software hat Nintendos Rechte an tragbaren Spielen unterlizenziert und gemeinsam Game Boy Tetris entwickelt, was sich im folgenden Bildschirm mit rechtlichen Informationen widerspiegelt.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0dc/d28/e4c/0dcd28e4c4f7b3da1a0259fcdbcf9b70.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit globalen Konsolenspielrechten hat Nintendo die Tetris-Version f√ºr NES entwickelt, die wir in diesem Artikel untersuchen. Dann hat Bullet-Proof Software die Rechte von Nintendo unterlizenziert, wodurch sie weiterhin Patronen f√ºr Famicom in Japan verkaufen konnte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es folgte ein komplexer Rechtsstreit. Sowohl Nintendo als auch Tengen forderten die gegnerische Partei auf, ihre Version des Spiels nicht mehr zu produzieren und zu verkaufen. Infolgedessen gewann Nintendo und Hunderttausende von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tengen Tetris-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Patronen </font><font style="vertical-align: inherit;">wurden zerst√∂rt. Das Gerichtsurteil verbot auch mehreren anderen Unternehmen wie Mirrorsoft, Konsolenversionen zu erstellen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pajitnov erhielt niemals Abz√ºge von ELORG oder dem Sowjetstaat. 1991 zog er jedoch in die USA und 1996 mit Unterst√ºtzung des Inhabers von Bullet-Proof Software</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Henka Rogers war</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mitbegr√ºnder von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Tetris Company</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wodurch er von Versionen f√ºr mobile Ger√§te und moderne Konsolen profitieren konnte.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist interessant, den Bildschirm mit rechtlichen Informationen als ein Fenster zu betrachten, das eine Vorstellung von der bescheidenen Herkunft des Spiels und den darauf folgenden K√§mpfen um Rechte an geistigem Eigentum gibt, da dieser Bildschirm f√ºr die meisten Spieler nur ein √§rgerliches Hindernis darstellt, dessen Verschwinden scheinbar ewig warten muss. Die Verz√∂gerung wird durch zwei Z√§hler eingestellt, die nacheinander von 255 bis 0 z√§hlen. Die erste Phase kann nicht √ºbersprungen werden, und die zweite Phase wird durch Dr√ºcken der Starttaste √ºbersprungen. Daher wird der Bildschirm mit den rechtlichen Informationen mindestens 4,25 Sekunden und h√∂chstens 8,5 Sekunden lang angezeigt. Ich denke jedoch, dass die meisten Spieler aufgeben und w√§hrend des ersten Intervalls aufh√∂ren, Start zu dr√ºcken, und aus diesem Grund auf den vollst√§ndigen Abschluss warten.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Timing der Phasen sowie der Rest des Spiels wird von einem nicht maskierten Interrupt-Handler gesteuert, der zu Beginn jedes vertikalen Austastintervalls aufgerufen wird, eine kurze Zeitspanne zwischen dem Rendern von Fernsehbildern. Das hei√üt, alle 16.6393 Millisekunden wird die normale Programmausf√ºhrung durch den folgenden Code unterbrochen. </font><font style="vertical-align: inherit;">Der Handler beginnt damit, die Werte der Hauptregister an den Stapel zu √ºbergeben und sie nach Abschluss abzurufen, um die unterbrochene Aufgabe nicht zu st√∂ren. Der Aufruf </font><font style="vertical-align: inherit;">aktualisiert VRAM und konvertiert die Beschreibung des Speichermodells in das, was auf dem Bildschirm angezeigt wird. Ferner reduziert der Handler den Wert des Z√§hlers des Bildschirms f√ºr rechtliche Informationen, wenn er gr√∂√üer als Null ist. Herausforderung</font></font><br><br> <code>8005: PHA <br> 8006: TXA <br> 8007: PHA <br> 8008: TYA <br> 8009: PHA ; save A, X, Y <br> <br> 800A: LDA #$00 <br> 800C: STA $00B3 <br> 800E: JSR $804B ; render(); <br> <br> 8011: DEC $00C3 ; legalScreenCounter1--; <br> <br> 8013: LDA $00C3 <br> 8015: CMP #$FF ; if (legalScreenCounter1 &lt; 0) { <br> 8017: BNE $801B ; legalScreenCounter1 = 0; <br> 8019: INC $00C3 ; } <br> <br> 801B: JSR $AB5E ; initializeOAM(); <br> <br> 801E: LDA $00B1 <br> 8020: CLC <br> 8021: ADC #$01 <br> 8023: STA $00B1 <br> 8025: LDA #$00 <br> 8027: ADC $00B2 <br> 8029: STA $00B2 ; frameCounter++; <br> <br> 802B: LDX #$17 <br> 802D: LDY #$02 <br> 802F: JSR $AB47 ; randomValue = generateNextPseudorandomNumber(randomValue); <br> <br> 8032: LDA #$00 <br> 8034: STA $00FD <br> 8036: STA $2005 ; scrollX = 0; <br> 8039: STA $00FC <br> 803B: STA $2005 ; scrollY = 0; <br> <br> 803E: LDA #$01 <br> 8040: STA $0033 ; verticalBlankingInterval = true; <br> <br> 8042: JSR $9D51 ; pollControllerButtons(); <br> <br> 8045: PLA <br> 8046: TAY <br> 8047: PLA <br> 8048: TAX <br> 8049: PLA ; restore A, X, Y <br> <br> 804A: RTI ; resume interrupted task</code> <br> <br><font style="vertical-align: inherit;"></font><code>render()</code><font style="vertical-align: inherit;"></font><code>initializeOAM()</code>  ,    .   ,     ‚Äî 16-  little endian,    <code>$00B1</code> ‚Äì <code>$00B2</code> ,         .      ;   ,            .   <code>$8040</code>   vertical blanking interval, ,     . ,   ;     ,   ¬´¬ª. <br><br>  <code>verticalBlankingInterval</code>  ,  .  ,      . <br><br> <code>AA2F: JSR $E000 ; updateAudio(); <br> <br> AA32: LDA #$00 <br> AA34: STA $0033 ; verticalBlankingInterval = false; <br> <br> AA36: NOP <br> <br> AA37: LDA $0033 <br> AA39: BEQ $AA37 ; while(!verticalBlankingInterval) { } <br> <br> AA3B: LDA #$FF <br> AA3D: LDX #$02 <br> AA3F: LDY #$02 <br> AA41: JSR $AC6A ; fill memory page 2 with all $FF's <br> <br> AA44: RTS ; return;</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Blockierungsroutine wird von zwei Zeitstufen des Rechtsinformationsbildschirms verwendet, die nacheinander ausgef√ºhrt werden. </font><font style="vertical-align: inherit;">Das Lua AI-Skript umgeht diese Verz√∂gerung, indem beide Z√§hler auf 0 gesetzt werden.</font></font><br><br> <code>8236: LDA #$FF <br> 8238: JSR $A459 <br> <br> ... <br> <br> A459: STA $00C3 ; legalScreenCounter1 = 255; <br> <br> A45B: JSR $AA2F ; do { <br> A45E: LDA $00C3 ; waitForVerticalBlankingInterval(); <br> A460: BNE $A45B ; } while(legalScreenCounter1 &gt; 0); <br> <br> A462: RTS ; return;</code> <br> <br> <code>823B: LDA #$FF <br> 823D: STA $00A8 ; legalScreenCounter2 = 255; <br> <br> ; do { <br> <br> 823F: LDA $00F5 ; if (just pressed Start) { <br> 8241: CMP #$10 ; break; <br> 8243: BEQ $824C ; } <br> <br> 8245: JSR $AA2F ; waitForVerticalBlankingInterval(); <br> <br> 8248: DEC $00A8 ; legalScreenCounter2--; <br> 824A: BNE $823F ; } while(legalScreenCounter2 &gt; 0); <br> <br> 824C: INC $00C0 ; gameMode = TITLE_SCREEN;</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><h3>  Demo </h3><br>     80    .       ,     ,    .     . ,    <code>$DF00</code> ,     : <br><br> <code>TJTSZJTSZJSZLZJTTSITO JSZLZLIOLZLIOJTSITOJ</code> <br> <br>      ,    ,    .     <code>$98EB</code> . <br><br> <code>98EB: LDA $00C0 <br> 98ED: CMP #$05 <br> 98EF: BNE $9903 ; if (gameMode == DEMO) { <br> <br> 98F1: LDX $00D3 <br> 98F3: INC $00D3 <br> 98F5: LDA $DF00,X ; value = demoTetriminoTypeTable[++demoIndex]; <br> <br> 98F8: LSR <br> 98F9: LSR <br> 98FA: LSR <br> 98FB: LSR <br> 98FC: AND #$07 <br> 98FE: TAX ; tetriminoType = bits 6,5,4 of value; <br> <br> 98FF: LDA $994E,X <br> 9902: RTS ; return spawnTable[tetriminoType]; <br> ; } else { <br> ; pickRandomTetrimino(); <br> ; }</code> <br> <br>      6, 5  4  .         <code>$07</code> ‚Äî  .     ( <code>$994E</code> ),       ID ,        : <br><br> <code>993B: 00 00 00 00 ; T <br> 993F: 01 01 01 01 ; J <br> 9943: 02 02 ; Z <br> 9945: 03 ; O <br> 9946: 04 04 ; S <br> 9948: 05 05 05 05 ; L <br> 994C: 06 06 ; I</code> <br> <br> <code>994E: 02 ; Td <br> 994F: 07 ; Jd <br> 9950: 08 ; Zh <br> 9951: 0A ; O <br> 9952: 0B ; Sh <br> 9953: 0E ; Ld <br> 9954: 12 ; Ih</code> <br> <br> <code>9956: 02 02 02 02 ; Td <br> 995A: 07 07 07 07 ; Jd <br> 995E: 08 08 ; Zh <br> 9960: 0A ; O <br> 9961: 0B 0B ; Sh <br> 9963: 0E 0E 0E 0E ; Ld <br> 9967: 12 12 ; Ih</code> <br> <br>  <code>$07</code>       ,  ,   <code>Td</code> ( <code>$02</code> ). <br><br> -        ,     ID   .   ,           ,   .       <code>$DF00</code>    -     ,   ,    5   ,     . <br><br>        ( <code>$00D3</code> )    <code>$872B</code> . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die zweite Tabelle der Demo enth√§lt eine Aufzeichnung der Gamepad-Schaltfl√§chen, die in Bytepaaren codiert sind. </font><font style="vertical-align: inherit;">Die Bits des ersten Bytes entsprechen den Tasten.</font></font><br><br><div class="scrollable-table"><table><tbody><tr><th> <code>7</code> </th> <th> <code>6</code> </th> <th> <code>5</code> </th> <th> <code>4</code> </th> <th> <code>3</code> </th> <th> <code>2</code> </th> <th> <code>1</code> </th> <th> <code>0</code> </th> </tr><tr><td>  A. </td><td>  B. </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> W√§hlen Sie </font></font></td><td>  Starten Sie </td><td>  Auf </td><td>  Runter </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Links </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rechts </font></font></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das zweite Byte speichert die Anzahl der Frames, w√§hrend der eine Tastenkombination gedr√ºckt wird. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Tabelle nimmt Adressen auf </font></font><code>$DD00</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>$DEFF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und besteht aus 256 Paaren. Der Zugriff darauf erfolgt durch das Unterprogramm an der Adresse </font></font><code>$9D5B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Da die Demo-Schaltfl√§chentabelle 512 Byte lang ist, ist ein Zwei-Byte-Index erforderlich, um darauf zuzugreifen. Der Index wird als Little Endian bei </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">gespeichert </font><font style="vertical-align: inherit;">. Es wird mit dem Wert der Adresse der Tabelle initialisiert </font><font style="vertical-align: inherit;">und sein Inkrement wird durch den folgenden Code ausgef√ºhrt. </font><font style="vertical-align: inherit;">Die Programmierer haben die Eingabeverarbeitung des Players im Code belassen, sodass wir den Entwicklungsprozess betrachten und die Demo durch einen anderen Datensatz ersetzen k√∂nnen. Der Demo-Aufnahmemodus wird aktiviert, wenn </font><font style="vertical-align: inherit;">ein Wert zugewiesen wird.</font></font><br><br> <code>9D5B: LDA $00D0 ; if (recording mode) { <br> 9D5D: CMP #$FF ; goto recording; <br> 9D5F: BEQ $9DB0 ; } <br> <br> 9D61: JSR $AB9D ; pollController(); <br> 9D64: LDA $00F5 ; if (start button pressed) { <br> 9D66: CMP #$10 ; goto startButtonPressed; <br> 9D68: BEQ $9DA3 ; } <br> <br> 9D6A: LDA $00CF ; if (repeats == 0) { <br> 9D6C: BEQ $9D73 ; goto finishedMove; <br> ; } else { <br> 9D6E: DEC $00CF ; repeats--; <br> 9D70: JMP $9D9A ; goto moveInProgress; <br> ; } <br> <br> finishedMove: <br> <br> 9D73: LDX #$00 <br> 9D75: LDA ($D1,X) <br> 9D77: STA $00A8 ; buttons = demoButtonsTable[index]; <br> <br> 9D79: JSR $9DE8 ; index++; <br> <br> 9D7C: LDA $00CE <br> 9D7E: EOR $00A8 <br> 9D80: AND $00A8 <br> 9D82: STA $00F5 ; setNewlyPressedButtons(difference between heldButtons and buttons); <br> <br> 9D84: LDA $00A8 <br> 9D86: STA $00CE ; heldButtons = buttons; <br> <br> 9D88: LDX #$00 <br> 9D8A: LDA ($D1,X) <br> 9D8C: STA $00CF ; repeats = demoButtonsTable[index]; <br> <br> 9D8E: JSR $9DE8 ; index++; <br> <br> 9D91: LDA $00D2 ; if (reached end of demo table) { <br> 9D93: CMP #$DF ; return; <br> 9D95: BEQ $9DA2 ; } <br> <br> 9D97: JMP $9D9E ; goto holdButtons; <br> <br> moveInProgress: <br> <br> 9D9A: LDA #$00 <br> 9D9C: STA $00F5 ; clearNewlyPressedButtons(); <br> <br> holdButtons: <br> <br> 9D9E: LDA $00CE <br> 9DA0: STA $00F7 ; setHeldButtons(heldButtons); <br> <br> 9DA2: RTS ; return; <br> <br> startButtonPressed: <br> <br> 9DA3: LDA #$DD <br> 9DA5: STA $00D2 ; reset index; <br> <br> 9DA7: LDA #$00 <br> 9DA9: STA $00B2 ; counter = 0; <br> <br> 9DAB: LDA #$01 <br> 9DAD: STA $00C0 ; gameMode = TITLE_SCREEN; <br> <br> 9DAF: RTS ; return;</code> <br> <br><font style="vertical-align: inherit;"></font><code>$00D1</code><font style="vertical-align: inherit;"></font><code>$00D2</code><font style="vertical-align: inherit;"></font><code>$872D</code><font style="vertical-align: inherit;"></font><br><br> <code>9DE8: LDA $00D1 <br> 9DEA: CLC ; increment [$00D1] <br> 9DEB: ADC #$01 ; possibly causing wrap around to 0 <br> 9DED: STA $00D1 ; which produces a carry <br> <br> 9DEF: LDA #$00 <br> 9DF1: ADC $00D2 <br> 9DF3: STA $00D2 ; add carry to [$00D2] <br> <br> 9DF5: RTS ; return</code> <br> <br><font style="vertical-align: inherit;"></font><code>$00D0</code><font style="vertical-align: inherit;"></font><code>$FF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In diesem Fall wird der folgende Code gestartet, der zum Schreiben in die Schaltfl√§chentabelle f√ºr die Demo vorgesehen ist. </font><font style="vertical-align: inherit;">Die Tabelle ist jedoch im PRG-ROM gespeichert. </font><font style="vertical-align: inherit;">Der Versuch, darauf zu schreiben, wirkt sich nicht auf die gespeicherten Daten aus. </font><font style="vertical-align: inherit;">Stattdessen l√∂st jede Schreiboperation einen Bankwechsel aus, was zu dem unten gezeigten Glitch-Effekt f√ºhrt.</font></font><br><br> <code>recording: <br> <br> 9DB0: JSR $AB9D ; pollController(); <br> <br> 9DB3: LDA $00C0 ; if (gameMode != DEMO) { <br> 9DB5: CMP #$05 ; return; <br> 9DB7: BNE $9DE7 ; } <br> <br> 9DB9: LDA $00D0 ; if (not recording mode) { <br> 9DBB: CMP #$FF ; return; <br> 9DBD: BNE $9DE7 ; } <br> <br> 9DBF: LDA $00F7 ; if (getHeldButtons() == heldButtons) { <br> 9DC1: CMP $00CE ; goto buttonsNotChanged; <br> 9DC3: BEQ $9DE4 ; } <br> <br> 9DC5: LDX #$00 <br> 9DC7: LDA $00CE <br> 9DC9: STA ($D1,X) ; demoButtonsTable[index] = heldButtons; <br> <br> 9DCB: JSR $9DE8 ; index++; <br> <br> 9DCE: LDA $00CF <br> 9DD0: STA ($D1,X) ; demoButtonsTable[index] = repeats; <br> <br> 9DD2: JSR $9DE8 ; index++; <br> <br> 9DD5: LDA $00D2 ; if (reached end of demo table) { <br> 9DD7: CMP #$DF ; return; <br> 9DD9: BEQ $9DE7 ; } <br> <br> 9DDB: LDA $00F7 <br> 9DDD: STA $00CE ; heldButtons = getHeldButtons(); <br> <br> 9DDF: LDA #$00 <br> 9DE1: STA $00CF ; repeats = 0; <br> <br> 9DE3: RTS ; return; <br> <br> buttonsNotChanged: <br> <br> 9DE4: INC $00CF ; repeats++; <br> <br> 9DE6: RTS <br> 9DE7: RTS ; return;</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a07/66a/261/a0766a261967e1ee2e7d4a61d3367ee6.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies deutet darauf hin, dass Entwickler das Programm teilweise oder vollst√§ndig im RAM ausf√ºhren k√∂nnten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um dieses Hindernis zu umgehen, habe ich </font></font><code>lua/RecordDemo.lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine in einer </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zip mit Quellcode erstellt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Nach dem Umschalten in den Demo-Aufnahmemodus werden die Schreibvorg√§nge in die Tabelle in der Lua-Konsole umgeleitet. </font><font style="vertical-align: inherit;">Von dort k√∂nnen Bytes kopiert und in das ROM eingef√ºgt werden.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um Ihre eigene Demo aufzunehmen, f√ºhren Sie FCEUX aus und laden Sie die Nintendo Tetris ROM-Datei herunter (Datei | ROM √∂ffnen ...). √ñffnen Sie dann das Lua-Skriptfenster (Datei | Lua | Neues Lua-Skriptfenster ...), navigieren Sie zur Datei oder geben Sie den Pfad ein. Dr√ºcken Sie die Run-Taste, um den Demo-Aufnahmemodus zu starten, und klicken Sie dann auf das FCEUX-Fenster, um den Fokus darauf zu schalten. Sie k√∂nnen die Formen steuern, bis die Schaltfl√§chentabelle voll ist. Danach kehrt das Spiel automatisch zum Bildschirmschoner zur√ºck. Klicken Sie im Lua-Skriptfenster auf Stopp, um das Skript zu stoppen. Die aufgezeichneten Daten werden in der Ausgabekonsole angezeigt (siehe Abbildung unten).</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f2e/3cd/f61/f2e3cdf61589005f2e1cae0659f66467.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W√§hlen Sie den gesamten Inhalt aus und kopieren Sie ihn in die Zwischenablage (Strg + C). </font><font style="vertical-align: inherit;">F√ºhren Sie dann den Hex-Editor aus (Debug | Hex-Editor ...). </font><font style="vertical-align: inherit;">W√§hlen Sie im Men√º Hex Editor die Option Ansicht | </font><font style="vertical-align: inherit;">ROM-Datei und dann Datei | </font><font style="vertical-align: inherit;">Gehe zu Adresse. </font><font style="vertical-align: inherit;">Geben Sie im Dialogfeld Springen 5D10 (Adresse der Tabelle der Demo-Schaltfl√§chen in der ROM-Datei) ein und klicken Sie auf OK. </font><font style="vertical-align: inherit;">F√ºgen Sie dann den Inhalt der Zwischenablage ein (Strg + V).</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bef/599/392/bef599392455c773652e850de13f6413.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W√§hlen Sie schlie√ülich im FCEUX-Men√º NES | </font><font style="vertical-align: inherit;">Zur√ºcksetzen </font><font style="vertical-align: inherit;">Wenn Sie alle diese Schritte wiederholt haben, sollte die Demo durch Ihre eigene Version ersetzt werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie √Ñnderungen speichern m√∂chten, w√§hlen Sie Datei | </font><font style="vertical-align: inherit;">Speichern Sie Rom unter ..., geben Sie den Namen der ge√§nderten ROM-Datei ein und klicken Sie dann auf Speichern. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auf √§hnliche Weise k√∂nnen Sie die Reihenfolge der erstellten Tetriminos anpassen.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bildschirm des Todes </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie oben erw√§hnt, k√∂nnen die meisten Spieler die Geschwindigkeit des Abstiegs von Figuren auf Stufe 29 nicht bew√§ltigen, was schnell zum Abschluss des Spiels f√ºhrt. Daher wurden die Spieler, die er mit dem Namen "Bildschirm des Todes" verbunden. Aus technischer Sicht erlaubt der Todesbildschirm dem Spieler jedoch nicht, aufgrund eines Fehlers, bei dem ein schneller Abstieg eigentlich kein Fehler, sondern eine Funktion ist, weiter zu gehen. Die Designer waren so nett, dass sie das Spiel fortsetzen lie√üen, w√§hrend der Spieler der √ºbermenschlichen Geschwindigkeit standhalten konnte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein wahrer Todesbildschirm erscheint in ungef√§hr 1550 zur√ºckgezogenen Reihen. Es manifestiert sich auf unterschiedliche Weise. Manchmal wird das Spiel neu gestartet. In anderen F√§llen wird der Bildschirm nur schwarz. Normalerweise friert ein Spiel sofort nach dem L√∂schen einer Zeile ein (‚Äûfriert ein‚Äú), wie unten gezeigt. Diesen Effekten gehen h√§ufig zuf√§llige grafische Artefakte voraus.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/09d/7fe/4f3/09d7fe4f3ec1e77057c7ee5e252d8d75.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Todesbildschirm ist das Ergebnis eines Fehlers im Code, der beim L√∂schen von Zeilen Punkte hinzuf√ºgt. Das aus sechs Zeichen bestehende Konto wird als 24-Bit-gepacktes Little-Endian-BCD gespeichert und befindet sich unter </font></font><code>$0053</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>$0055</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Um Konvertierungen zwischen der Anzahl der gel√∂schten Zeilen und den erhaltenen Punkten durchzuf√ºhren, wird eine Tabelle verwendet. Jeder Eintrag darin ist ein 16-Bit-gepackter BCD-Little-Endian-Wert. </font><font style="vertical-align: inherit;">Nach dem Erh√∂hen der Gesamtzahl der Zeilen und m√∂glicherweise der Ebene wird der Wert in dieser Liste mit der Ebenennummer plus eins multipliziert und das Ergebnis zu den Punkten addiert. Dies wird in der Tabelle aus dem Nintendo Tetris-Handbuch deutlich:</font></font><br><br> <code>9CA5: 00 00 ; 0: 0 <br> 9CA7: 40 00 ; 1: 40 <br> 9CA9: 00 01 ; 2: 100 <br> 9CAB: 00 03 ; 3: 300 <br> 9CAD: 00 12 ; 4: 1200</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/34b/a36/7cf/34ba367cfefad47e493306fa6ef8fe3e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie unten gezeigt, wird die Multiplikation durch einen Zyklus simuliert, der der Punktzahl Punkte hinzuf√ºgt. Es wird ausgef√ºhrt, nachdem die Form gesperrt wurde, auch wenn keine Zeilen gel√∂scht wurden. </font><font style="vertical-align: inherit;">Leider verf√ºgt der </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Ricoh 2A03</font></a><font style="vertical-align: inherit;"> nicht √ºber einen bin√§ren Dezimalmodus 6502; er konnte den K√∂rper des Zyklus stark vereinfachen. Stattdessen erfolgt die Addition schrittweise im Bin√§rmodus. Jede Ziffer, die nach der Addition 9 √ºberschreitet, wird im Wesentlichen durch Subtrahieren von 10 und Inkrementieren der Ziffern links erhalten. Zum Beispiel wird </font><font style="vertical-align: inherit;">das in konvertiert </font><font style="vertical-align: inherit;">. Ein solches System ist jedoch nicht vollst√§ndig gesch√ºtzt. Nehmen Sie </font><font style="vertical-align: inherit;">: Ein Scheck kann das Ergebnis nicht in konvertieren</font></font><br><br> <code>9C31: LDA $0044 <br> 9C33: STA $00A8 <br> 9C35: INC $00A8 ; for(i = 0; i &lt;= level; i++) { <br> <br> 9C37: LDA $0056 <br> 9C39: ASL <br> 9C3A: TAX <br> 9C3B: LDA $9CA5,X ; points[0] = pointsTable[2 * completedLines]; <br> <br> 9C3E: CLC <br> 9C3F: ADC $0053 <br> 9C41: STA $0053 ; score[0] += points[0]; <br> <br> 9C43: CMP #$A0 <br> 9C45: BCC $9C4E ; if (upper digit of score[0] &gt; 9) { <br> <br> 9C47: CLC <br> 9C48: ADC #$60 <br> 9C4A: STA $0053 ; upper digit of score[0] -= 10; <br> 9C4C: INC $0054 ; score[1]++; <br> ; } <br> <br> 9C4E: INX <br> 9C4F: LDA $9CA5,X ; points[1] = pointsTable[2 * completedLines + 1]; <br> <br> 9C52: CLC <br> 9C53: ADC $0054 <br> 9C55: STA $0054 ; score[1] += points[1]; <br> <br> 9C57: AND #$0F <br> 9C59: CMP #$0A <br> 9C5B: BCC $9C64 ; if (lower digit of score[1] &gt; 9) { <br> <br> 9C5D: LDA $0054 <br> 9C5F: CLC ; lower digit of score[1] -= 10; <br> 9C60: ADC #$06 ; increment upper digit of score[1]; <br> 9C62: STA $0054 ; } <br> <br> 9C64: LDA $0054 <br> 9C66: AND #$F0 <br> 9C68: CMP #$A0 <br> 9C6A: BCC $9C75 ; if (upper digit of score[1] &gt; 9) { <br> <br> 9C6C: LDA $0054 <br> 9C6E: CLC <br> 9C6F: ADC #$60 <br> 9C71: STA $0054 ; upper digit of score[1] -= 10; <br> 9C73: INC $0055 ; score[2]++; <br> ; } <br> <br> 9C75: LDA $0055 <br> 9C77: AND #$0F <br> 9C79: CMP #$0A <br> 9C7B: BCC $9C84 ; if (lower digit of score[2] &gt; 9) { <br> <br> 9C7D: LDA $0055 <br> 9C7F: CLC ; lower digit of score[2] -= 10; <br> 9C80: ADC #$06 ; increment upper digit of score[2]; <br> 9C82: STA $0055 ; } <br> <br> 9C84: LDA $0055 <br> 9C86: AND #$F0 <br> 9C88: CMP #$A0 <br> 9C8A: BCC $9C94 ; if (upper digit of score[2] &gt; 9) { <br> <br> 9C8C: LDA #$99 <br> 9C8E: STA $0053 <br> 9C90: STA $0054 <br> 9C92: STA $0055 ; max out score to 999999; <br> ; } <br> <br> 9C94: DEC $00A8 <br> 9C96: BNE $9C37 ; }</code> <br> <br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code>$07 + $07 = $0E</code><font style="vertical-align: inherit;"></font><code>$14</code><font style="vertical-align: inherit;"></font><code>$09 + $09 = $12</code><font style="vertical-align: inherit;"></font><code>$18</code> .   ,            6.  ,     ,       0. <br><br>         .          ,         1/60 .         ¬´ ¬ª. <br><br>    Lua       30 ‚Äî  ,       ,     . <br><br><h3>  </h3><br>    Nintendo Tetris    A-Type  : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c53/f16/5ea/c53f165ea675badb06f75f6409f6c836.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Spiel belohnt die Spieler, die in einer der f√ºnf Animationen der Endungen eine ausreichend gro√üe Anzahl von Punkten erzielt haben. Die Wahl der Endung basiert vollst√§ndig auf den beiden Ziffern ganz links der sechsstelligen Punktzahl. Wie unten gezeigt, muss der Spieler mindestens 30.000 Punkte erzielen, um eines der Endungen zu erhalten. </font><font style="vertical-align: inherit;">Es ist erw√§hnenswert, dass </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">ein Spiegel der Adressen ist </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">. Das Konto wird an den Adressen dupliziert </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nach dem Bestehen des ersten Tests wird die Endanimation durch die folgende switch-Anweisung ausgew√§hlt.</font></font><br><br> <code>9A4D: LDA $0075 <br> 9A4F: CMP #$03 <br> 9A51: BCC $9A5E ; if (score[2] &gt;= $03) { <br> <br> 9A53: LDA #$80 <br> 9A55: JSR $A459 <br> 9A58: JSR $9E3A <br> 9A5B: JMP $9A64 ; select ending; <br> ; }</code> <br> <br><font style="vertical-align: inherit;"></font><code>$0060</code><font style="vertical-align: inherit;"></font><code>$007F</code><font style="vertical-align: inherit;"></font><code>$0040</code><font style="vertical-align: inherit;"></font><code>$005F</code><font style="vertical-align: inherit;"></font><code>$0073</code><font style="vertical-align: inherit;"></font><code>$0075</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br> <code>A96E: LDA #$00 <br> A970: STA $00C4 <br> A972: LDA $0075 ; if (score[2] &lt; $05) { <br> A974: CMP #$05 ; ending = 0; <br> A976: BCC $A9A5 ; } <br> <br> A978: LDA #$01 <br> A97A: STA $00C4 <br> A97C: LDA $0075 ; else if (score[2] &lt; $07) { <br> A97E: CMP #$07 ; ending = 1; <br> A980: BCC $A9A5 ; } <br> <br> A982: LDA #$02 <br> A984: STA $00C4 <br> A986: LDA $0075 ; else if (score[2] &lt; $10) { <br> A988: CMP #$10 ; ending = 2; <br> A98A: BCC $A9A5 ; } <br> <br> A98C: LDA #$03 <br> A98E: STA $00C4 <br> A990: LDA $0075 ; else if (score[2] &lt; $12) { <br> A992: CMP #$12 ; ending = 3; <br> A994: BCC $A9A5 ; } <br> <br> A996: LDA #$04 ; else { <br> A998: STA $00C4 ; ending = 4; <br> ; }</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Am Ende werden Raketen von zunehmender Gr√∂√üe von der Startrampe neben der Basilius-Kathedrale abgefeuert. </font><font style="vertical-align: inherit;">Am vierten Ende wird das Raumschiff Buran gezeigt - die sowjetische Version des amerikanischen Space Shuttles. </font><font style="vertical-align: inherit;">Am besten Ende erhebt sich die Kathedrale selbst in die Luft und ein UFO h√§ngt √ºber der Startrampe. </font><font style="vertical-align: inherit;">Unten sehen Sie ein Bild von jedem Ende und die damit verbundene Punktzahl.</font></font><br><div class="scrollable-table"><table><tbody><tr><td> <code>30000‚Äì49999</code> <div style="text-align:center;"> <img src="https://habrastorage.org/getpro/habr/post_images/0b9/b73/4b4/0b9b734b43dae52eccafaa71e3c1441d.png"></div></td><td> <code>50000‚Äì69999</code> <div style="text-align:center;"> <img src="https://habrastorage.org/getpro/habr/post_images/ade/f93/f39/adef93f395eb2bef2c1fd71562857c39.png"></div></td><td> <code>70000‚Äì99999</code> <div style="text-align:center;"> <img src="https://habrastorage.org/getpro/habr/post_images/df3/480/b63/df3480b63de128a70b7c9e4dd7cec81f.png"></div></td></tr><tr><td> <code>100000‚Äì119999</code> <div style="text-align:center;"> <img src="https://habrastorage.org/getpro/habr/post_images/8e3/91a/658/8e391a6581df6e7ec0c08134b6a6d5bf.png"></div></td><td> <code>120000+</code> <div style="text-align:center;"> <img src="https://habrastorage.org/getpro/habr/post_images/3e1/2bd/42f/3e12bd42ffc331742d809325db418f78.png"></div></td><td></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Im B-Type-Spielemodus wird ein weiterer Test implementiert, der im Nintendo Tetris-Booklet wie folgt beschrieben wird: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0aa/929/624/0aa929624f41a68ea1388b6ba9013dd3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der Spieler 25 Zeilen erfolgreich beendet hat, zeigt das Spiel das Ende, abh√§ngig vom Anfangslevel. Die Enden der Stufen 0 bis 8 bestehen aus Tieren und Gegenst√§nden, die im Rahmen fliegen oder rennen und auf mysteri√∂se Weise hinter der Basilius-Kathedrale vorbeiziehen. Das UFO vom besten Ende des A-Typ-Modus erscheint am Ende 3. Am Ende 4 erscheinen ausgestorbene fliegende Flugsaurier, und am Ende 7 werden die mythischen fliegenden Drachen gezeigt. In den Endungen 2 und 6 sind fl√ºgellose V√∂gel dargestellt: laufende Pinguine und Strau√üe. Am Ende von 5 ist der Himmel mit GUTEN Luftschiffen gef√ºllt (nicht zu verwechseln mit Goodyear-Luftschiffen). Und am Ende von 8 fegen viele ‚ÄûBuranas‚Äú √ºber den Bildschirm, obwohl es in Wirklichkeit nur einen gab. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Starth√∂he (plus 1) wird als Multiplikator verwendet, wodurch der Spieler mit einer gro√üen Anzahl von Tieren / Objekten f√ºr eine erh√∂hte Komplexit√§t belohnt wird.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Am besten Ende des B-Typs wird ein Schloss mit Charakteren aus dem Nintendo-Universum gezeigt: Prinzessin Peach klatscht in die H√§nde, Kid Icarus spielt Geige, Donkey Kong klopft auf die gro√üe Trommel, Mario und Luigi tanzen, Bowser spielt Akkordeon, Samus spielt Cello, Link - auf einer Fl√∂te, w√§hrend die Kuppeln der Basilius-Kathedrale in die Luft fliegen. Die Anzahl dieser Elemente am Ende h√§ngt von der Anfangsh√∂he ab. Unten finden Sie Bilder aller 10 Endungen.</font></font><br><br><div class="scrollable-table"><table><tbody><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5d9/c8e/525/5d9c8e525177613cb3fcd59c7c6aa53a.png"></div></td><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ade/2fc/f3d/ade2fcf3d389b67e5d4b3d7e8c5c1ea0.png"></div></td><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ec9/bd3/9dd/ec9bd39dd26529013d7d408f6a4e855b.png"></div></td></tr><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fdb/125/132/fdb125132ecaed550966562b5e08f169.png"></div></td><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/22b/758/028/22b75802841a3b558f8fae476f2d2598.png"></div></td><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43e/710/858/43e710858220b08e1860da00a309c665.png"></div></td></tr><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dda/332/1d5/dda3321d5e5246d2aa92eafb69f3cf5d.png"></div></td><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6f/2d0/843/c6f2d0843995d294393bbbf277b83bdf.png"></div></td><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/572/3b8/f29/5723b8f2919ac35746b52923d59dbf41.png"></div></td></tr><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/639/938/9df/6399389dfff187a8db7ac92f1dc815e3.png"></div></td><td></td><td></td></tr></tbody></table></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AI kann schnell alle 25 Zeilen l√∂schen, die im B-Type-Modus auf jeder Anfangsebene und H√∂he erforderlich sind, sodass Sie alle Endungen sehen k√∂nnen. Es lohnt sich auch zu bewerten, wie cool er mit gro√üen Haufen zuf√§lliger Bl√∂cke umgeht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In den Endungen 0‚Äì8 k√∂nnen sich bis zu 6 Objekte im Rahmen bewegen. Die y-Koordinaten der Objekte werden in einer Tabelle unter at gespeichert </font></font><code>$A7B7</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Horizontale Abst√§nde zwischen Objekten werden in einer Tabelle unter der Adresse gespeichert </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Eine Folge von Werten mit einem Vorzeichen an der Adresse </font><font style="vertical-align: inherit;">bestimmt die Geschwindigkeit und Richtung der Objekte. </font><font style="vertical-align: inherit;">Sprite-Indizes werden bei gespeichert </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tats√§chlich besteht jedes Objekt aus zwei Sprites mit benachbarten Indizes. Um den zweiten Index zu erhalten, m√ºssen Sie 1 hinzuf√ºgen. Zum Beispiel besteht ein Drache aus</font></font><br><br> <code>A7B7: 98 A8 C0 A8 90 B0 ; 0 <br> A7BD: B0 B8 A0 B8 A8 A0 ; 1 <br> A7C3: C8 C8 C8 C8 C8 C8 ; 2 <br> A7C9: 30 20 40 28 A0 80 ; 3 <br> A7CF: A8 88 68 A8 48 78 ; 4 <br> A7D5: 58 68 18 48 78 38 ; 5 <br> A7DB: C8 C8 C8 C8 C8 C8 ; 6 <br> A7E1: 90 58 70 A8 40 38 ; 7 <br> A7E7: 68 88 78 18 48 A8 ; 8</code> <br> <br><font style="vertical-align: inherit;"></font><code>$A77B</code><font style="vertical-align: inherit;"></font><br><br> <code>A77B: 3A 24 0A 4A 3A FF ; 0 <br> A781: 22 44 12 32 4A FF ; 1 <br> A787: AE 6E 8E 6E 1E 02 ; 2 <br> A78D: 42 42 42 42 42 02 ; 3 <br> A793: 22 0A 1A 04 0A FF ; 4 <br> A799: EE DE FC FC F6 02 ; 5 <br> A79F: 80 80 80 80 80 FF ; 6 <br> A7A5: E8 E8 E8 E8 48 FF ; 7 <br> A7AB: 80 AE 9E 90 80 02 ; 8</code> <br> <br><font style="vertical-align: inherit;"></font><code>$A771</code><font style="vertical-align: inherit;"></font><br><br> <code>A771: 01 ; 0: 1 <br> A772: 01 ; 1: 1 <br> A773: FF ; 2: -1 <br> A774: FC ; 3: -4 <br> A775: 01 ; 4: 1 <br> A776: FF ; 5: -1 <br> A777: 02 ; 6: 2 <br> A778: 02 ; 7: 2 <br> A779: FE ; 8: -1</code> <br> <br><font style="vertical-align: inherit;"></font><code>$A7F3</code><font style="vertical-align: inherit;"></font><br><br> <code>A7F3: 2C ; 0: dragonfly <br> A7F4: 2E ; 1: dove <br> A7F5: 54 ; 2: penguin <br> A7F6: 32 ; 3: UFO <br> A7F7: 34 ; 4: pterosaur <br> A7F8: 36 ; 5: blimp <br> A7F9: 4B ; 6: ostrich <br> A7FA: 38 ; 7: dragon <br> A7FB: 3A ; 8: Buran</code> <br> <br><font style="vertical-align: inherit;"></font><code>$38</code>  <code>$39</code> .          . <br><br><div class="scrollable-table"><table><tbody><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/86d/524/373/86d5243738d9c3e34db5318889c4f894.png"></div></td><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d82/2d1/229/d822d122984b77a0973f08feac962647.png"></div></td><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d8a/3c1/9b5/d8a3c19b513fb9f7338e250b97fdeac1.png"></div></td></tr></tbody></table></div><br>      ,        . ,     ,             .            ;      ,     . ,        <code>$30</code>  <code>$16</code>      ,     . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/04e/2e2/203/04e2e2203b1581876d99736ad9b56fd6.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/445/153/3b4/4451533b43874485cb5a0cdfd9df0c58.png"></div><br>  ,    ,       . <br><br><h3> 2 Player Versus </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nintendo Tetris enth√§lt einen unvollst√§ndigen Zwei-Spieler-Modus, den Sie aktivieren k√∂nnen, indem Sie die Anzahl der Spieler ( </font></font><code>$00BE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) auf 2 </font><font style="vertical-align: inherit;">√§ndern </font><font style="vertical-align: inherit;">. Wie unten gezeigt, werden im Hintergrund des Einzelspieler-Modus zwei Spielfelder angezeigt.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/418/6e7/2af/4186e72af40c6c617996ca2f8d39a72c.png"></div><br>    ,         .  <code>003</code> ,    ,      .           ,       .  ,      .      .      . <br><br>      ,    .          .     Double, Triple  Tetris (   ,    ),             . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein zus√§tzliches Feld befindet sich unter </font></font><code>$0500</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A </font></font><code>$0060</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>$007F</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">normalerweise ein Spiegel </font></font><code>$0040</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font><code>$005F</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird f√ºr den zweiten Spieler verwendet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wahrscheinlich wurde dieser interessante Modus aufgrund eines vollen Entwicklungsplans aufgegeben. Oder vielleicht wurde er absichtlich unvollendet gelassen. Einer der Gr√ºnde, warum Tetris als mit dem Nintendo Game Boy geb√ºndeltes Spiel ausgew√§hlt wurde, war, dass es den Kauf von </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Game Link Cable</font></a><font style="vertical-align: inherit;"> f√∂rderte</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Ein Zubeh√∂r, das zwei Game Boys miteinander verbindet, um den 2-Spieler-Versus-Modus zu starten. </font><font style="vertical-align: inherit;">Dieses Kabel f√ºgte dem System ein Element der ‚ÄûSozialit√§t‚Äú hinzu - es ermutigte Freunde, einen Game Boy zu kaufen, um sich dem Spa√ü anzuschlie√üen. </font><font style="vertical-align: inherit;">Vielleicht bef√ºrchtete Nintendo, dass die Werbekraft von Tetris, die den Kauf von Game Boy stimulierte, geschw√§cht werden k√∂nnte, wenn die Konsolenversion des Spiels einen 2-Spieler-Versus-Modus h√§tte.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Musik und Soundeffekte </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hintergrundmusik wird eingeschaltet, wenn </font></font><code>$06F5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einer der in der Tabelle aufgef√ºhrten Werte zugewiesen wird.</font></font><br><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wert </font></font></th><th>  Beschreibung </th></tr><tr><td> <code>01</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nicht verwendete Begr√º√üungsbildschirmmusik </font></font></td></tr><tr><td> <code>02</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ziel im B-Typ-Modus erreicht </font></font></td></tr><tr><td> <code>03</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Musik-1 </font></font></td></tr><tr><td> <code>04</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Musik-2 </font></font></td></tr><tr><td> <code>05</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Musik-3 </font></font></td></tr><tr><td> <code>06</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Musik-1 Allegro </font></font></td></tr><tr><td> <code>07</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Musik-2 Allegro </font></font></td></tr><tr><td> <code>08</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Musik-3 Allegro </font></font></td></tr><tr><td> <code>09</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gl√ºckwunsch Bildschirm </font></font></td></tr><tr><td> <code>0A</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Endungen </font></font></td></tr><tr><td> <code>0B</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ziel im B-Typ-Modus erreicht </font></font></td></tr></tbody></table></div>       <a href=""></a> .          . <br><br> Music-1 ‚Äî   " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> ",       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">--</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><i>¬´¬ª</i></a> .   ‚Äî   " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> ",    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><i></i></a>  .         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> . <br><br> Music-2     . Music-3 ,   ; -          Nintendo of America. <br><br>       ,        ,        ( <code>$06</code> ‚Äì <code>$08</code> ). <br><br> ,      " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> ",  ,   Game Boy Tetris. <br><br>      <code>$06F0</code>  <code>$06F1</code> ,     . <br><br><div class="scrollable-table"><table><tbody><tr><th>  Die Adresse </th><th>  </th><th>  Beschreibung </th></tr><tr><td> <code>06F0</code> </td> <td> <code>02</code> </td> <td>    </td></tr><tr><td> <code>06F0</code> </td> <td> <code>03</code> </td> <td>    </td></tr><tr><td> <code>06F1</code> </td> <td> <code>01</code> </td> <td>    </td></tr><tr><td> <code>06F1</code> </td> <td> <code>02</code> </td> <td>    </td></tr><tr><td> <code>06F1</code> </td> <td> <code>03</code> </td> <td>   </td></tr><tr><td> <code>06F1</code> </td> <td> <code>04</code> </td> <td>  Tetris </td></tr><tr><td> <code>06F1</code> </td> <td> <code>05</code> </td> <td>   </td></tr><tr><td> <code>06F1</code> </td> <td> <code>06</code> </td> <td>   </td></tr><tr><td> <code>06F1</code> </td> <td> <code>07</code> </td> <td>   </td></tr><tr><td> <code>06F1</code> </td> <td> <code>08</code> </td> <td>  </td></tr><tr><td> <code>06F1</code> </td> <td> <code>09</code> </td> <td>   </td></tr><tr><td> <code>06F1</code> </td> <td> <code>0A</code> </td> <td>   </td></tr></tbody></table></div><br><h3>      </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W√§hrend des Spiels wird der aktuelle Status des Spiels durch eine Ganzzahl an der Adresse dargestellt </font></font><code>$0048</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Meistens hat es eine Bedeutung </font></font><code>$01</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, die angibt, dass der Spieler das aktive Tetrimino kontrolliert. </font><font style="vertical-align: inherit;">Wenn das St√ºck jedoch verriegelt ist, wechselt das Spiel allm√§hlich von Zustand </font></font><code>$02</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zu Zustand </font></font><code>$08</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wie in der Tabelle gezeigt.</font></font><br><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zustand </font></font></th><th>  Beschreibung </th></tr><tr><td> <code>00</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nicht zugewiesene Orientierungs-ID </font></font></td></tr><tr><td> <code>01</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Spieler steuert das aktive Tetrimino </font></font></td></tr><tr><td> <code>02</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tetrimino-Sperre auf dem Spielfeld </font></font></td></tr><tr><td> <code>03</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gef√ºllte Zeilen pr√ºfen </font></font></td></tr><tr><td> <code>04</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zeilenbereinigungsanimation anzeigen </font></font></td></tr><tr><td> <code>05</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zeilen und Statistiken aktualisieren </font></font></td></tr><tr><td> <code>06</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √úberpr√ºfen des Ziels des B-Typ-Modus </font></font></td></tr><tr><td> <code>07</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wird nicht benutzt </font></font></td></tr><tr><td> <code>08</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erstellen Sie das n√§chste Tetrimino </font></font></td></tr><tr><td> <code>09</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wird nicht benutzt </font></font></td></tr><tr><td> <code>0A</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Spielvorhang Update </font></font></td></tr><tr><td> <code>0B</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Inkrement des Spielstatus </font></font></td></tr></tbody></table></div><br>           <code>$81B2</code> : <br><br> <code>81B2: LDA $0048 <br> 81B4: JSR $AC82 ; switch(playState) { <br> 81B7: 2F 9E ; case 00: goto 9E2F; // Unassign orientationID <br> 81B9: CF 81 ; case 01: goto 81CF; // Player controls active Tetrimino <br> 81BB: A2 99 ; case 02: goto 99A2; // Lock Tetrimino into playfield <br> 81BD: 6B 9A ; case 03: goto 9A6B; // Check for completed rows <br> 81BF: 39 9E ; case 04: goto 9E39; // Display line clearing animation <br> 81C1: 58 9B ; case 05: goto 9B58; // Update lines and statistics <br> 81C3: F2 A3 ; case 06: goto A3F2; // B-Type goal check; Unused frame for A-Type <br> 81C5: 03 9B ; case 07: goto 9B03; // Unused frame; Execute unfinished 2 player mode logic <br> 81C7: 8E 98 ; case 08: goto 988E; // Spawn next Tetrimino <br> 81C9: 39 9E ; case 09: goto 9E39; // Unused <br> 81CB: 11 9A ; case 0A: goto 9A11; // Update game over curtain <br> 81CD: 37 9E ; case 0B: goto 9E37; // Increment play state <br> ; }</code> <br> <br>   <code>$00</code> switch    ,  <code>orientationID</code>  <code>$13</code> , ,    . <br><br> <code>9E2F: LDA #$13 <br> 9E31: STA $0042 ; orientationID = UNASSIGNED; <br> <br> 9E33: RTS ; return;</code> <br> <br>    ;    <code>$00</code>      . <br><br>  <code>$01</code>   ,      : <br><br> <code>81CF: JSR $89AE ; shift Tetrimino; <br> 81D2: JSR $88AB ; rotate Tetrimino; <br> 81D5: JSR $8914 ; drop Tetrimino; <br> <br> 81D8: RTS ; return;</code> <br> <br>     ,  ,           .        ‚Äî      .    .   ,      <code>$02</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Wenn die gesperrte Position korrekt ist, werden die 4 zugeordneten Zellen des Spielfelds als belegt markiert. Ansonsten macht sie den √úbergang zu einem Staat </font><font style="vertical-align: inherit;">- dem bedrohlichen Vorhang zum Ende des Spiels.</font></font><br><br> <code>99A2: JSR $948B ; if (new position valid) { <br> 99A5: BEQ $99B8 ; goto updatePlayfield; <br> ; } <br> <br> 99A7: LDA #$02 <br> 99A9: STA $06F0 ; play curtain sound effect; <br> <br> 99AC: LDA #$0A <br> 99AE: STA $0048 ; playState = UPDATE_GAME_OVER_CURTAIN; <br> <br> 99B0: LDA #$F0 <br> 99B2: STA $0058 ; curtainRow = -16; <br> <br> 99B4: JSR $E003 ; updateAudio(); <br> <br> 99B7: RTS ; return;</code> <br> <br><font style="vertical-align: inherit;"></font><code>$0A</code><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b1b/7c0/a46/b1b7c0a4637995c25423a07984bce24e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Vorhang wird von der Oberseite des Spielfelds nach unten gezogen und alle 4 Bilder um eine Linie nach unten verschoben. </font></font><code>curtainRow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>$0058</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) wird mit einem Wert von ‚Äì16 initialisiert, wodurch eine zus√§tzliche Verz√∂gerung von 0,27 Sekunden zwischen der endg√ºltigen Sperre und dem Start der Animation entsteht. An der Adresse </font></font><code>$9A21</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im Status des </font></font><code>$0A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unten gezeigten Codes wird auf die Multiplikationstabelle zugegriffen, die f√§lschlicherweise als Ebenennummern angezeigt wird. Dies erfolgt auf </font></font><code>curtainRow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 </font><font style="vertical-align: inherit;">skaliert </font><font style="vertical-align: inherit;">. Wie oben gezeigt, </font></font><code>$9A51</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">startet </font><font style="vertical-align: inherit;">der Code an der Adresse </font><font style="vertical-align: inherit;">die Endanimation, wenn die Punktzahl des Spielers nicht weniger als 30.000 Punkte betr√§gt. Andernfalls wird erwartet, dass auf Start geklickt wird. </font><font style="vertical-align: inherit;">Der Code wird vervollst√§ndigt, indem dem Spielstatus ein Wert </font><font style="vertical-align: inherit;">zugewiesen wird. Der entsprechende Handler wird jedoch nicht aufgerufen, da das Spiel abgeschlossen ist.</font></font><br><br> <code>9A11: LDA $0058 ; if (curtainRow == 20) { <br> 9A13: CMP #$14 ; goto endGame; <br> 9A15: BEQ $9A47 ; } <br> <br> 9A17: LDA $00B1 ; if (frameCounter not divisible by 4) { <br> 9A19: AND #$03 ; return; <br> 9A1B: BNE $9A46 ; } <br> <br> 9A1D: LDX $0058 ; if (curtainRow &lt; 0) { <br> 9A1F: BMI $9A3E ; goto incrementCurtainRow; <br> ; } <br> <br> 9A21: LDA $96D6,X <br> 9A24: TAY ; rowIndex = 10 * curtainRow; <br> <br> 9A25: LDA #$00 <br> 9A27: STA $00AA ; i = 0; <br> <br> 9A29: LDA #$13 <br> 9A2B: STA $0042 ; orientationID = NONE; <br> <br> drawCurtainRow: <br> <br> 9A2D: LDA #$4F <br> 9A2F: STA ($B8),Y ; playfield[rowIndex + i] = CURTAIN_TILE; <br> 9A31: INY <br> 9A32: INC $00AA ; i++; <br> 9A34: LDA $00AA <br> 9A36: CMP #$0A ; if (i != 10) { <br> 9A38: BNE $9A2D ; goto drawCurtainRow; <br> ; } <br> <br> 9A3A: LDA $0058 <br> 9A3C: STA $0049 ; vramRow = curtainRow; <br> <br> incrementCurtainRow: <br> <br> 9A3E: INC $0058 ; curtainRow++; <br> <br> 9A40: LDA $0058 ; if (curtainRow != 20) { <br> 9A42: CMP #$14 ; return; <br> 9A44: BNE $9A46 ; } <br> <br> 9A46: RTS ; return; <br> <br> endGame: <br> <br> 9A47: LDA $00BE <br> 9A49: CMP #$02 <br> 9A4B: BEQ $9A64 ; if (numberOfPlayers == 1) { <br> <br> 9A4D: LDA $0075 <br> 9A4F: CMP #$03 <br> 9A51: BCC $9A5E ; if (score[2] &gt;= $03) { <br> <br> 9A53: LDA #$80 <br> 9A55: JSR $A459 <br> 9A58: JSR $9E3A <br> 9A5B: JMP $9A64 ; select ending; <br> ; } <br> <br> 9A5E: LDA $00F5 ; if (not just pressed Start) { <br> 9A60: CMP #$10 ; return; <br> 9A62: BNE $9A6A ; } <br> ; } <br> <br> 9A64: LDA #$00 <br> 9A66: STA $0048 ; playState = INITIALIZE_ORIENTATION_ID; <br> 9A68: STA $00F5 ; clear newly pressed buttons; <br> <br> 9A6A: RTS ; return;</code> <br> <br><font style="vertical-align: inherit;"></font><code>$00</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linien des Spielfelds werden schrittweise in den VRAM kopiert, um sie anzuzeigen. </font><font style="vertical-align: inherit;">Der Index der aktuell zu kopierenden Zeile ist in </font></font><code>vramRow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><code>$0049</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) enthalten. </font><font style="vertical-align: inherit;">An der Adresse </font><font style="vertical-align: inherit;">wird </font><font style="vertical-align: inherit;">ein </font></font><code>$9A3C</code> <code>vramRow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wert zugewiesen </font></font><code>curtainRow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, der diese Zeile beim Rendern letztendlich sichtbar macht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manipulationen mit VRAM erfolgen w√§hrend eines vertikalen Austastintervalls, das vom Interrupt-Handler erkannt wird, der im Abschnitt ‚ÄûBildschirm mit rechtlichen Informationen‚Äú beschrieben ist. </font><font style="vertical-align: inherit;">Es ruft die unten gezeigte Unterroutine auf (markiert in den Kommentaren des Interrupt-Handlers als </font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Der Rendering-Modus √§hnelt dem Spielemodus. </font><font style="vertical-align: inherit;">Es wird unter der Adresse gespeichert </font><font style="vertical-align: inherit;">und kann einen der folgenden Werte haben:</font></font><br><br> <code>804B: LDA $00BD <br> 804D: JSR $AC82 ; switch(renderMode) { <br> 8050: B1 82 ; case 0: goto 82B1; // Legal and title screens <br> 8052: DA 85 ; case 1: goto 85DA; // Menu screens <br> 8054: 44 A3 ; case 2: goto A344; // Congratulations screen <br> 8056: EE 94 ; case 3: goto 94EE; // Play and demo <br> 8058: 95 9F ; case 4: goto 9F95; // Ending animation <br> ; }</code> <br> <br><font style="vertical-align: inherit;"></font><code>$00BD</code><font style="vertical-align: inherit;"></font><br><br><div class="scrollable-table"><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wert </font></font></th><th>  Beschreibung </th></tr><tr><td> <code>00</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bildschirm mit legal </font><font style="vertical-align: inherit;">Informationen und Bildschirmschoner</font></font></td></tr><tr><td> <code>01</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Men√ºbildschirme </font></font></td></tr><tr><td> <code>02</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gl√ºckwunsch Bildschirm </font></font></td></tr><tr><td> <code>03</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Spiel und Demo </font></font></td></tr><tr><td> <code>04</code> </td> <td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Animation beenden </font></font></td></tr></tbody></table></div><br>    <code>$03</code>  . <br><br> <code>952A: JSR $9725 ; copyPlayfieldRowToVRAM(); <br> 952D: JSR $9725 ; copyPlayfieldRowToVRAM(); <br> 9530: JSR $9725 ; copyPlayfieldRowToVRAM(); <br> 9533: JSR $9725 ; copyPlayfieldRowToVRAM();</code> <br> <br>   , <code>copyPlayfieldRowToVRAM()</code>   VRAM   ,   <code>vramRow</code> .  <code>vramRow</code>  20,    . <br><br> <code>9725: LDX $0049 ; if (vramRow &gt; 20) { <br> 9727: CPX #$15 ; return; <br> 9729: BPL $977E ; } <br> <br> 972B: LDA $96D6,X <br> 972E: TAY ; playfieldAddress = 10 * vramRow; <br> <br> 972F: TXA <br> 9730: ASL <br> 9731: TAX <br> 9732: INX ; high = vramPlayfieldRows[vramRow * 2 + 1]; <br> 9733: LDA $96EA,X <br> 9736: STA $2006 <br> 9739: DEX <br> <br> 973A: LDA $00BE <br> 973C: CMP #$01 <br> 973E: BEQ $975E ; if (numberOfPlayers == 2) { <br> <br> 9740: LDA $00B9 <br> 9742: CMP #$05 <br> 9744: BEQ $9752 ; if (leftPlayfield) { <br> <br> 9746: LDA $96EA,X <br> 9749: SEC <br> 974A: SBC #$02 <br> 974C: STA $2006 ; low = vramPlayfieldRows[vramRow * 2] - 2; <br> <br> 974F: JMP $9767 ; } else { <br> <br> 9752: LDA $96EA,X <br> 9755: CLC <br> 9756: ADC #$0C <br> 9758: STA $2006 ; low = vramPlayfieldRows[vramRow * 2] + 12; <br> <br> 975B: JMP $9767 ; } else { <br> <br> 975E: LDA $96EA,X <br> 9761: CLC <br> 9762: ADC #$06 ; low = vramPlayfieldRows[vramRow * 2] + 6; <br> 9764: STA $2006 ; } <br> <br> ; vramAddress = (high &lt;&lt; 8) | low; <br> <br> 9767: LDX #$0A <br> 9769: LDA ($B8),Y <br> 976B: STA $2007 <br> 976E: INY ; for(i = 0; i &lt; 10; i++) { <br> 976F: DEX ; vram[vramAddress + i] = playfield[playfieldAddress + i]; <br> 9770: BNE $9769 ; } <br> <br> 9772: INC $0049 ; vramRow++; <br> 9774: LDA $0049 ; if (vramRow &lt; 20) { <br> 9776: CMP #$14 ; return; <br> 9778: BMI $977E ; } <br> <br> 977A: LDA #$20 <br> 977C: STA $0049 ; vramRow = 32; <br> <br> 977E: RTS ; return;</code> <br> <br>  <code>vramPlayfieldRows</code> ( <code>$96EA</code> )   VRAM   little endian,     ,   6      ‚àí2  12       2 Player Versus.       ,        29.                16- ,     . <br><br>      <code>vramRow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Wenn der Wert 20 erreicht, wird ihm ein Wert von 32 zugewiesen, was bedeutet, dass die Kopie vollst√§ndig abgeschlossen ist. Wie oben gezeigt, werden nur 4 Zeilen pro Frame kopiert. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der State Handler </font></font><code>$03</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist daf√ºr verantwortlich, fertige Zeilen zu erkennen und vom Spielfeld zu entfernen. W√§hrend 4 separater Anrufe scannt er die Linienvers√§tze </font></font><code>[‚àí2, 1]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nahe der Mitte des Tetriminos (beide Koordinaten aller Quadrate des Tetriminos liegen in diesem Intervall). Indizes abgeschlossener Zeilen werden bei </font></font><code>$004A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">gespeichert </font></font><code>$004D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; Der aufgezeichnete Index 0 wird verwendet, um anzuzeigen, dass in diesem Durchgang keine abgeschlossenen Zeilen gefunden wurden. Der Handler wird unten gezeigt. </font><font style="vertical-align: inherit;">Die Pr√ºfung </font><font style="vertical-align: inherit;">am Anfang erlaubt es dem Handler nicht, auszuf√ºhren, wenn Zeilen des Spielfelds an VRAM (State Handler) √ºbertragen werden</font></font><br><br> <code>9A6B: LDA $0049 <br> 9A6D: CMP #$20 ; if (vramRow &lt; 32) { <br> 9A6F: BPL $9A74 ; return; <br> 9A71: JMP $9B02 ; } <br> <br> 9A74: LDA $0041 ; rowY = tetriminoY - 2; <br> 9A76: SEC <br> 9A77: SBC #$02 ; if (rowY &lt; 0) { <br> 9A79: BPL $9A7D ; rowY = 0; <br> 9A7B: LDA #$00 ; } <br> <br> 9A7D: CLC <br> 9A7E: ADC $0057 <br> 9A80: STA $00A9 ; rowY += lineIndex; <br> <br> 9A82: ASL <br> 9A83: STA $00A8 <br> 9A85: ASL <br> 9A86: ASL <br> 9A87: CLC <br> 9A88: ADC $00A8 <br> 9A8A: STA $00A8 ; rowIndex = 10 * rowY; <br> <br> 9A8C: TAY <br> 9A8D: LDX #$0A <br> 9A8F: LDA ($B8),Y <br> 9A91: CMP #$EF ; for(i = 0; i &lt; 10; i++) { <br> 9A93: BEQ $9ACC ; if (playfield[rowIndex + i] == EMPTY_TILE) { <br> 9A95: INY ; goto rowNotComplete; <br> 9A96: DEX ; } <br> 9A97: BNE $9A8F ; } <br> <br> 9A99: LDA #$0A <br> 9A9B: STA $06F1 ; play row completed sound effect; <br> <br> 9A9E: INC $0056 ; completedLines++; <br> <br> 9AA0: LDX $0057 <br> 9AA2: LDA $00A9 <br> 9AA4: STA $4A,X ; lines[lineIndex] = rowY; <br> <br> 9AA6: LDY $00A8 <br> 9AA8: DEY <br> 9AA9: LDA ($B8),Y <br> 9AAB: LDX #$0A <br> 9AAD: STX $00B8 <br> 9AAF: STA ($B8),Y <br> 9AB1: LDA #$00 <br> 9AB3: STA $00B8 <br> 9AB5: DEY ; for(i = rowIndex - 1; i &gt;= 0; i--) { <br> 9AB6: CPY #$FF ; playfield[i + 10] = playfield[i]; <br> 9AB8: BNE $9AA9 ; } <br> <br> 9ABA: LDA #$EF <br> 9ABC: LDY #$00 <br> 9ABE: STA ($B8),Y <br> 9AC0: INY ; for(i = 0; i &lt; 10; i++) { <br> 9AC1: CPY #$0A ; playfield[i] = EMPTY_TILE; <br> 9AC3: BNE $9ABE ; } <br> <br> 9AC5: LDA #$13 <br> 9AC7: STA $0042 ; orientationID = UNASSIGNED; <br> <br> 9AC9: JMP $9AD2 ; goto incrementLineIndex; <br> <br> rowNotComplete: <br> <br> 9ACC: LDX $0057 <br> 9ACE: LDA #$00 <br> 9AD0: STA $4A,X ; lines[lineIndex] = 0; <br> <br> incrementLineIndex: <br> <br> 9AD2: INC $0057 ; lineIndex++; <br> <br> 9AD4: LDA $0057 ; if (lineIndex &lt; 4) { <br> 9AD6: CMP #$04 ; return; <br> 9AD8: BMI $9B02 ; } <br> <br> 9ADA: LDY $0056 <br> 9ADC: LDA $9B53,Y <br> 9ADF: CLC <br> 9AE0: ADC $00BC <br> 9AE2: STA $00BC ; totalGarbage += garbageLines[completedLines]; <br> <br> 9AE4: LDA #$00 <br> 9AE6: STA $0049 ; vramRow = 0; <br> 9AE8: STA $0052 ; clearColumnIndex = 0; <br> <br> 9AEA: LDA $0056 <br> 9AEC: CMP #$04 <br> 9AEE: BNE $9AF5 ; if (completedLines == 4) { <br> 9AF0: LDA #$04 ; play Tetris sound effect; <br> 9AF2: STA $06F1 ; } <br> <br> 9AF5: INC $0048 ; if (completedLines &gt; 0) { <br> 9AF7: LDA $0056 ; playState = DISPLAY_LINE_CLEARING_ANIMATION; <br> 9AF9: BNE $9B02 ; return; <br> ; } <br> <br> 9AFB: INC $0048 ; playState = UPDATE_LINES_AND_STATISTICS; <br> <br> 9AFD: LDA #$07 <br> 9AFF: STA $06F1 ; play piece locked sound effect; <br> <br> 9B02: RTS ; return;</code> <br> <br><font style="vertical-align: inherit;"></font><code>vramRow</code><font style="vertical-align: inherit;"></font><code>$03</code>    ).    , <code>vramRow</code>   0,     . <br><br> <code>lineIndex</code> ( <code>$00A9</code> )    0       . <br><br>      <code>$0A</code>     ,       <code>$96D6</code> , ,   <code>$9A82</code>  <code>rowY</code>  10     : <br><br> <code>rowIndex = (rowY &lt;&lt; 1) + (rowY &lt;&lt; 3); // rowIndex = 2 * rowY + 8 * rowY;</code> <br> <br>    ,  <code>rowY</code>   <code>[0, 20]</code> ,      <code>[0, 19]</code> .        . ,   ,   <code>$0400</code> ‚Äì <code>$04FF</code>   <code>$EF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(leeres Pl√§ttchen), wodurch mehr als 5 zus√§tzliche leere versteckte Linien unter dem Boden des Spielfelds entstehen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Block, der mit beginnt, </font></font><code>$9ADA</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist Teil des unvollst√§ndigen Modus von 2 Player Versus. Wie oben erw√§hnt, f√ºgt das L√∂schen der Reihen dem Spielfeld des Gegners Schmutz hinzu. Die Anzahl der M√ºllzeilen wird durch die Tabelle an der Adresse bestimmt </font></font><code>$9B53</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font><font style="vertical-align: inherit;">Der Zyklus an der Adresse </font><font style="vertical-align: inherit;">verschiebt das Material √ºber der gef√ºllten Zeile um eine Zeile nach unten. Er nutzt die Tatsache, dass jede Zeile in einer fortlaufenden Sequenz um 10 Bytes voneinander getrennt ist. Die n√§chste Schleife l√∂scht die oberste Zeile. </font><font style="vertical-align: inherit;">Die Animation zum L√∂schen von Zeilen wird w√§hrend des Spielstatus ausgef√ºhrt </font><font style="vertical-align: inherit;">, aber wie unten gezeigt, tritt sie nicht im Spielstatus-Handler auf, der vollst√§ndig leer ist.</font></font><br><br> <code>9B53: 00 ; no cleared lines <br> 9B54: 00 ; Single <br> 9B55: 01 ; Double <br> 9B56: 02 ; Triple <br> 9B57: 04 ; Tetris</code> <br> <br><font style="vertical-align: inherit;"></font><code>$9AA6</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>$04</code><font style="vertical-align: inherit;"></font><br><br> <code>9E39: RTS ; return;</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stattdessen wird w√§hrend des Spielzustands </font></font><code>$04</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die n√§chste Verzweigung des Rendering-Modus durchgef√ºhrt </font></font><code>$03</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">und gespiegelte Werte werden f√ºr den unfertigen Modus 2 Player Versus ben√∂tigt. </font><font style="vertical-align: inherit;">Das Unterprogramm ist unten dargestellt </font><font style="vertical-align: inherit;">. Es wird in jedem Frame aufgerufen, aber die Bedingung am Anfang erlaubt, dass es nur in jedem vierten Frame ausgef√ºhrt wird. In jedem Durchgang durchl√§uft es die Liste der Indizes der abgeschlossenen Zeilen und l√∂scht 2 Spalten in diesen Zeilen, wobei es sich von der mittleren Spalte nach au√üen bewegt. </font><font style="vertical-align: inherit;">Eine 16-Bit-VRAM-Adresse wird auf die gleiche Weise wie in der Kopierfeldroutine gezeigt aufgebaut. In diesem Fall wird jedoch ein Versatz um den Spaltenindex ausgef√ºhrt, der aus der folgenden Tabelle erhalten wird.</font></font><br><br> <code>94EE: LDA $0068 <br> 94F0: CMP #$04 <br> 94F2: BNE $9522 ; if (playState == DISPLAY_LINE_CLEARING_ANIMATION) { <br> <br> 94F4: LDA #$04 <br> 94F6: STA $00B9 ; leftPlayfield = true; <br> <br> 94F8: LDA $0072 <br> 94FA: STA $0052 <br> 94FC: LDA $006A <br> 94FE: STA $004A <br> 9500: LDA $006B <br> 9502: STA $004B <br> 9504: LDA $006C <br> 9506: STA $004C <br> 9508: LDA $006D <br> 950A: STA $004D <br> 950C: LDA $0068 <br> 950E: STA $0048 ; mirror values; <br> <br> 9510: JSR $977F ; updateLineClearingAnimation(); <br> <br> ; ... <br> ; }</code> <br> <br> <code>leftPlayfield</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>updateLineClearingAnimation()</code><font style="vertical-align: inherit;"></font><br><br> <code>977F: LDA $00B1 ; if (frameCounter not divisible by 4) { <br> 9781: AND #$03 ; return; <br> 9783: BNE $97FD ; } <br> <br> 9785: LDA #$00 ; for(i = 0; i &lt; 4; i++) { <br> 9787: STA $00AA ; rowY = lines[i]; <br> 9789: LDX $00AA ; if (rowY == 0) { <br> 978B: LDA $4A,X ; continue; <br> 978D: BEQ $97EB ; } <br> <br> 978F: ASL <br> 9790: TAY <br> 9791: LDA $96EA,Y <br> 9794: STA $00A8 ; low = vramPlayfieldRows[2 * rowY]; <br> <br> 9796: LDA $00BE ; if (numberOfPlayers == 2) { <br> 9798: CMP #$01 ; goto twoPlayers; <br> 979A: BNE $97A6 ; } <br> <br> 979C: LDA $00A8 <br> 979E: CLC <br> 979F: ADC #$06 <br> 97A1: STA $00A8 ; low += 6; <br> <br> 97A3: JMP $97BD ; goto updateVRAM; <br> <br> twoPlayers: <br> <br> 97A6: LDA $00B9 <br> 97A8: CMP #$04 <br> 97AA: BNE $97B6 ; if (leftPlayfield) { <br> <br> 97AC: LDA $00A8 <br> 97AE: SEC <br> 97AF: SBC #$02 <br> 97B1: STA $00A8 ; low -= 2; <br> <br> 97B3: JMP $97BD ; } else { <br> <br> 97B6: LDA $00A8 <br> 97B8: CLC <br> 97B9: ADC #$0C ; low += 12; <br> 97BB: STA $00A8 ; } <br> <br> updateVRAM: <br> <br> 97BD: INY <br> 97BE: LDA $96EA,Y <br> 97C1: STA $00A9 <br> 97C3: STA $2006 <br> 97C6: LDX $0052 ; high = vramPlayfieldRows[2 * rowY + 1]; <br> 97C8: LDA $97FE,X <br> 97CB: CLC ; rowAddress = (high &lt;&lt; 8) | low; <br> 97CC: ADC $00A8 <br> 97CE: STA $2006 ; vramAddress = rowAddress + leftColumns[clearColumnIndex]; <br> 97D1: LDA #$FF <br> 97D3: STA $2007 ; vram[vramAddress] = 255; <br> <br> 97D6: LDA $00A9 <br> 97D8: STA $2006 <br> 97DB: LDX $0052 ; high = vramPlayfieldRows[2 * rowY + 1]; <br> 97DD: LDA $9803,X <br> 97E0: CLC ; rowAddress = (high &lt;&lt; 8) | low; <br> 97E1: ADC $00A8 <br> 97E3: STA $2006 ; vramAddress = rowAddress + rightColumns[clearColumnIndex]; <br> 97E6: LDA #$FF <br> 97E8: STA $2007 ; vram[vramAddress] = 255; <br> <br> 97EB: INC $00AA <br> 97ED: LDA $00AA <br> 97EF: CMP #$04 <br> 97F1: BNE $9789 ; } <br> <br> 97F3: INC $0052 ; clearColumnIndex++; <br> 97F5: LDA $0052 ; if (clearColumnIndex &lt; 5) { <br> 97F7: CMP #$05 ; return; <br> 97F9: BMI $97FD ; } <br> <br> 97FB: INC $0048 ; playState = UPDATE_LINES_AND_STATISTICS; <br> <br> 97FD: RTS ; return;</code> <br> <br><font style="vertical-align: inherit;"></font><br><br> <code>97FE: 04 03 02 01 00 ; left columns <br> 9803: 05 06 07 08 09 ; right columns</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr die Reinigung der Animation sind 5 Durchg√§nge erforderlich. Dann geht der Code zum n√§chsten Spielstatus √ºber. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Handler f√ºr </font></font><code>$05</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den </font><font style="vertical-align: inherit;">Spielstatus </font><font style="vertical-align: inherit;">enth√§lt den Code, der im Abschnitt ‚ÄûZeilen und Statistiken‚Äú beschrieben ist. Der Handler endet mit folgendem Code: Die </font><font style="vertical-align: inherit;">Variable wird </font><font style="vertical-align: inherit;">erst am Ende des </font><font style="vertical-align: inherit;">Spielstatus zur√ºckgesetzt. Anschlie√üend wird die Gesamtzahl der Zeilen und die Punktzahl aktualisiert. Diese Sequenz erm√∂glicht die Ausf√ºhrung eines interessanten Fehlers. Im Demo-Modus m√ºssen Sie warten, bis das Spiel die gesamte Zeile gesammelt hat, und dann schnell Start dr√ºcken, bis die Animation zum L√∂schen der Serie beendet ist. Das Spiel kehrt zum Bildschirmschoner zur√ºck. Wenn Sie jedoch den richtigen Zeitpunkt ausw√§hlen, wird der Wert </font><font style="vertical-align: inherit;">gespeichert. Jetzt k√∂nnen Sie das Spiel im A-Type-Modus starten. Wenn anstelle der ersten Figur gesperrt, der Spielstatus-Handler</font></font><br><br> <code>9C9E: LDA #$00 <br> 9CA0: STA $0056 ; completedLines = 0; <br> <br> 9CA2: INC $0048 ; playState = B_TYPE_GOAL_CHECK; <br> <br> 9CA4: RTS ; return;</code> <br> <br><font style="vertical-align: inherit;"></font><code>completedLines</code><font style="vertical-align: inherit;"></font><code>$05</code><font style="vertical-align: inherit;"></font><code>completedLines</code><font style="vertical-align: inherit;"></font><code>$03</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Startet das Scannen abgeschlossener Zeilen. Er wird sie nicht finden, sondern </font></font><code>completedLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unver√§ndert lassen. Wenn der Spielstatus erf√ºllt ist, </font></font><code>$05</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erh√∂hen sich </font><font style="vertical-align: inherit;">die </font><font style="vertical-align: inherit;">Gesamtzahl der Zeilen und die Punktzahl, als h√§tten Sie sie erzielt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der einfachste Weg, dies zu tun, besteht darin, den gr√∂√üten Betrag zu erhalten und darauf zu warten, dass die Demo Tetris sammelt (es werden 2 davon in der Demo sein). Sobald der Bildschirm flackert, klicken Sie auf Start.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a8/80a/091/2a880a09173c42fb8c5256f9921a635b.png"></div><br>       .     ,   . <br><br> <code>9673: LDA #$3F <br> 9675: STA $2006 <br> 9678: LDA #$0E <br> 967A: STA $2006 ; prepare to modify background tile color; <br> <br> 967D: LDX #$00 ; color = DARK_GRAY; <br> <br> 967F: LDA $0056 <br> 9681: CMP #$04 <br> 9683: BNE $9698 ; if (completedLines == 4) { <br> <br> 9685: LDA $00B1 <br> 9687: AND #$03 <br> 9689: BNE $9698 ; if (frameCounter divisible by 4) { <br> <br> 968B: LDX #$30 ; color = WHITE; <br> <br> 968D: LDA $00B1 <br> 968F: AND #$07 <br> 9691: BNE $9698 ; if (frameCounter divisible by 8) { <br> <br> 9693: LDA #$09 <br> 9695: STA $06F1 ; play clear sound effect; <br> <br> ; } <br> ; } <br> ; } <br> <br> 9698: STX $2007 ; update background tile color;</code> <br> <br>   ,           ,      ,   <code>holdDownPoints</code> ( <code>$004F</code> )      .     ,       . <code>holdDownPoints</code>  ,     ¬´¬ª. <br><br>  ,   Start       Tetris   ,      ,        Tetris,     .     .             Start. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Spielstatus </font></font><code>$06</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f√ºhrt eine Zielpr√ºfung f√ºr Spiele vom Typ B durch. </font><font style="vertical-align: inherit;">Im A-Type-Modus handelt es sich im Wesentlichen um einen nicht verwendeten Frame. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Spielstatus </font></font><code>$07</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enth√§lt ausschlie√ülich die unvollst√§ndige 2-Spieler-Versus-Logik. </font><font style="vertical-align: inherit;">Im Einzelspielermodus verh√§lt es sich wie ein nicht verwendeter Frame. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Spielstatus wird </font></font><code>$08</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in den Abschnitten ‚ÄûTetrimino erstellen‚Äú und ‚ÄûTetrimino ausw√§hlen‚Äú erl√§utert. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Spielstatus wird </font></font><code>$09</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht verwendet. </font></font><code>$0B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erh√∂ht den Spielstatus, sieht aber auch unbenutzt aus. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und schlie√ülich der Hauptzyklus des Spiels:</font></font><br><br> <code>; while(true) { <br> <br> 8138: JSR $8161 ; branchOnGameMode(); <br> <br> 813B: CMP $00A7 ; if (vertical blanking interval wait requested) { <br> 813D: BNE $8142 ; waitForVerticalBlankingInterval(); <br> 813F: JSR $AA2F ; } <br> <br> 8142: LDA $00C0 <br> 8144: CMP #$05 <br> 8146: BNE $815A ; if (gameMode == DEMO) { <br> <br> 8148: LDA $00D2 <br> 814A: CMP #$DF <br> 814C: BNE $815A ; if (reached end of demo table) { <br> <br> 814E: LDA #$DD <br> 8150: STA $00D2 ; reset demo table index; <br> <br> 8152: LDA #$00 <br> 8154: STA $00B2 ; clear upper byte of frame counter; <br> <br> 8156: LDA #$01 <br> 8158: STA $00C0 ; gameMode = TITLE_SCREEN; <br> ; } <br> ; } <br> 815A: JMP $8138 ; }</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de420725/">https://habr.com/ru/post/de420725/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de420707/index.html">Der JITX-Start verwendet AI, um die Entwicklung komplexer Leiterplatten zu automatisieren</a></li>
<li><a href="../de420709/index.html">T2F: Ein Projekt zur Umwandlung von Text in Gesichtszeichnung mit tiefem Lernen</a></li>
<li><a href="../de420711/index.html">Moscow Data Science Major: Ank√ºndigung und Registrierung</a></li>
<li><a href="../de420713/index.html">Wie Chuck Hull den 3D-Druck erfand</a></li>
<li><a href="../de420715/index.html">Die harte Wahrheit √ºber die Schwere des Lernens</a></li>
<li><a href="../de420729/index.html">Offenes Webinar "Naive Bayes Classifier"</a></li>
<li><a href="../de420731/index.html">Zabbix √ºber Steroide: Funktionsweise der einheitlichen √úberwachungsplattform von Sbertech</a></li>
<li><a href="../de420735/index.html">Wir laden Sie zum Finale des Find Yourself in Digital-Marathons im B√ºro der Mail.Ru Group ein</a></li>
<li><a href="../de420737/index.html">Mini ai cup 2 oder fast AgarIO - was k√∂nnte man tun, um zu gewinnen?</a></li>
<li><a href="../de420739/index.html">Die Box ist noch im Griff: Warum m√ºssen Sie 2018 noch selbst Sprachen lernen?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>