<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìí üë®üèø‚Äç‚öïÔ∏è üòß Informationen zum Erstellen von JDK 8 unter Ubuntu, zur Qualit√§t des Hotspot-Codes und warum in C ++ alles fehlschl√§gt üíß ü¶â üíÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich wollte heute schlafen, scheiterte aber wieder. Im Telegramm erschien die Nachricht, dass jemand nicht nach Java gehen w√ºrde ... und wir wachten er...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Informationen zum Erstellen von JDK 8 unter Ubuntu, zur Qualit√§t des Hotspot-Codes und warum in C ++ alles fehlschl√§gt</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/422861/"><p>  Ich wollte heute schlafen, scheiterte aber wieder.  Im Telegramm erschien die Nachricht, dass jemand nicht nach Java gehen w√ºrde ... und wir wachten erst nach ein paar Stunden m√ºde und gl√ºcklich auf. </p><br><img src="https://habrastorage.org/webt/ti/ov/lf/tiovlf2wctfucdlsql2-avqmkwe.png"><br><br>  Wer kann diesen Beitrag nutzen?  Ja, wahrscheinlich f√ºr jeden, au√üer f√ºr diejenigen, die auch JDK8 sammeln oder einfach gerne Albtraum-Horror lesen.  Im Allgemeinen habe ich Sie gewarnt, schlie√üen Sie den Artikel dringend. <br><p>  Drei Probleme: </p><br><ul><li>  Nicht gehen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Stufe eins</a> ) <br>  Ein sehr langweiliger Teil zum √úberspringen.  Nur f√ºr diejenigen erforderlich, die die Geschichte der Ereignisse vollst√§ndig wiederherstellen m√∂chten. </li><li>  Nicht gehen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Level zwei</a> ) <br>  Es ist interessanter, weil es einige typische Fehler gibt, Nekromantie, Nekrophilie, welche BSD besser ist als GNU / Linux und warum es sich lohnt, auf neue Versionen von JDK zu migrieren. </li><li>  Selbst wenn es geht, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">f√§llt es in die Kruste</a> <br>  Interessanter.  Yahuuu, die JVM ist in die Kruste gefallen, lass es uns treten! </li></ul><br><p>  Unter der Katze zeigt sich eine detaillierte L√∂sung f√ºr Probleme, mit unterschiedlichen Nebengedanken √ºber das Leben. </p><br><p>  Es wird viel C ++ geben, es wird √ºberhaupt keinen Java-Code geben.  Jeder Javist am Ende beginnt nur in C ++ zu schreiben ... </p><a name="habracut"></a><br><h1 id="ne-sobiraetsya">  Ich werde nicht gehen </h1><br><p>  Wer mindestens einmal Java erstellt hat, wei√ü, dass es ungef√§hr so ‚Äã‚Äãaussieht: </p><br><pre><code class="bash hljs">hg <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> http://hg.openjdk.java.net/jdk8u/jdk8u <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> jdk8u sh ./get_source.sh sh ./configure \ --with-debug-level=fastdebug \ --with-target-bits=64 \ --with-native-debug-symbols=internal \ --with-boot-jdk=/home/me/opt/jdk1.8.0_161 make images</code> </pre> <br><p>  (Alle meine Benutzer werden einfach "ich" genannt, sodass Sie die virtuelle Maschine jederzeit jeder Person geben k√∂nnen und keine Ablehnung der Verwendung Ihres eigenen Benutzernamens erstellen k√∂nnen.) </p><br><p>  Das Problem ist nat√ºrlich, dass dies nicht funktioniert.  Und das eher zynisch. </p><br><a name="one"></a><br><h2 id="pervyy-uroven-pogruzheniya">  Erste Tauchstufe </h2><br><p>  Versuchen wir zu rennen: </p><br><pre> <code class="bash hljs">/home/me/git/jdk8u/hotspot/src/os/linux/vm/os_linux.inline.hpp:127:18: warning: <span class="hljs-string"><span class="hljs-string">'int readdir_r(DIR*, dirent*, dirent**)'</span></span> is deprecated [-Wdeprecated-declarations] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((status = ::readdir_r(dirp, dbuf, &amp;p)) != 0) { ^~~~~~~~~</code> </pre> <br><p>  Damit Sie verstehen, habe ich Folgendes installiert: </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> g++ -<span class="hljs-literal"><span class="hljs-literal">-version</span></span> g++ (Ubuntu <span class="hljs-number"><span class="hljs-number">7.3</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-literal"><span class="hljs-literal">-16ubuntu3</span></span>) <span class="hljs-number"><span class="hljs-number">7.3</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> Copyright (C) <span class="hljs-number"><span class="hljs-number">2017</span></span> Free Software Foundation, Inc.</code> </pre> <br><p>  Der Compiler ist nicht die erste Frische, nicht 8.2, aber diese sollte auch funktionieren. </p><br><p>  C ++ - Entwickler testen Software nur auf der Version des von ihnen installierten Compilers.  Normalerweise endet der Wunsch, auf verschiedenen Plattformen zu testen, irgendwo im Bereich des Unterschieds zwischen gcc und clang im Allgemeinen.  Daher ist es ganz normal, zuerst <code>-Werror</code> ("Warnungen als Fehler behandeln") und dann Code zu schreiben, der in allen anderen Versionen als vorings betrachtet wird. </p><br><p>  Dies ist ein bekanntes Problem, und es ist klar, wie es gel√∂st werden kann.  Sie m√ºssen Ihre Umgebungsvariable CXX_FLAGS festlegen, in der die richtige Fehlerstufe festgelegt werden soll. </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CXX_FLAGS=-Wno-error=deprecated-declarations -Wno-error-deprecated-declarations</code> </pre> <br><p>  Und dann sehen wir das Wunderbare: </p><br><pre> <code class="hljs powershell">Ignoring CXXFLAGS found <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> environment. Use -<span class="hljs-literal"><span class="hljs-literal">-with</span></span><span class="hljs-literal"><span class="hljs-literal">-extra</span></span><span class="hljs-literal"><span class="hljs-literal">-cxxflags</span></span></code> </pre> <br><p>  Ok, baue ein System, was auch immer du willst!  Wir ersetzen configure durch dieses: </p><br><pre> <code class="bash hljs">hg <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> http://hg.openjdk.java.net/jdk8u/jdk8u <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> jdk8u sh ./configure \ --with-extra-cflags=<span class="hljs-string"><span class="hljs-string">'-Wno-cpp -Wno-error=deprecated-declarations'</span></span> \ --with-extra-cxxflags=<span class="hljs-string"><span class="hljs-string">'-Wno-cpp -Wno-error=deprecated-declarations'</span></span> \ --with-debug-level=fastdebug \ --with-target-bits=64 \ --with-native-debug-symbols=internal \ --with-boot-jdk=/home/me/opt/jdk1.8.0_161 make images</code> </pre> <br><p>  Und der Fehler bleibt gleich! <br>  Wir gehen zur schweren Artillerie √ºber: dem Quellcode. </p><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -rl <span class="hljs-string"><span class="hljs-string">"Werror"</span></span> .</code> </pre> <br><p>  Eine gro√üe Menge von automatisch generierten H√ºten f√§llt heraus, darunter gibt es Einblicke in sinnvolle Dateien: </p><br><pre> <code class="hljs go">./common/autoconf/flags.m4 ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/bsd/makefiles/gcc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span> ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/solaris/makefiles/gcc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span> ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/aix/makefiles/xlc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span></code> </pre> <br><p>  In <code>flags.m4</code> wir leicht die vorherige Nachricht √ºber "Ignorieren von CXXFLAGS" und das ausgereiftere <code>CCXX_FLGS</code> Flag <code>CCXX_FLGS</code> (ja, zwei Buchstaben C), das sofort anstelle von <code>CFLAGS</code> und anstelle von <code>XX_FLAGS</code> .  Bequem!  Zwei Fakten sind interessant: </p><br><ul><li>  Dieses Flag wird nicht √ºber Konfigurationsparameter √ºbergeben. </li><li>  Im Standardwert sind diese Parameter sinnvoll und verd√§chtig √§hnlich: </li></ul><br><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment"># Setup compiler/platform specific flags to CFLAGS_JDK, # CXXFLAGS_JDK and CCXXFLAGS_JDK (common to C and CXX?) if test "x$TOOLCHAIN_TYPE" = xgcc; then # these options are used for both C and C++ compiles CCXXFLAGS_JDK="$CCXXFLAGS $CCXXFLAGS_JDK -Wall -Wno-parentheses -Wextra -Wno-unused -Wno-unused-parameter -Wformat=2 \ -pipe -D_GNU_SOURCE -D_REENTRANT -D_LARGEFILE64_SOURCE"</span></span></code> </pre> <br><p>  Diese Frage sieht in den Kommentaren sehr gut aus - aber was, sind die Flaggen gemeinsam?  Richtig? </p><br><p>  Wir werden keine Demokratie spielen und sie dort autorit√§r fest codieren <code>-w</code> ("keine Fehler zeigen"): </p><br><pre> <code class="bash hljs"> CCXXFLAGS_JDK=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CCXXFLAGS</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CCXXFLAGS_JDK</span></span></span><span class="hljs-string"> -w -ffreestanding -fno-builtin -Wno-parentheses -Wno-unused -Wno-unused-parameter -Wformat=2 \</span></span></code> </pre> <br><p>  Und - Prost!  - Der erste Fehler, den wir durchgemacht haben.  Sie berichtet nicht mehr und im Allgemeinen ist alles in Ordnung.  Es scheint. </p><br><a name="two"></a><br><h2 id="vtoroy-uroven-pogruzheniya">  Zweite Tauchstufe </h2><br><p>  Aber jetzt f√§llt es in einen Haufen anderer neuer Orte! </p><br><p>  Es stellt sich heraus, dass unser <code>-w</code> funktioniert, aber nicht an alle Teile der Baugruppe weitergeleitet wird.  Wir lesen die Makefiles sorgf√§ltig durch und verstehen nicht, wie genau dieser Parameter √ºberhaupt weitergeleitet werden kann.  Wirklich vergessen ihn? </p><br><p>  Wenn wir die richtige Google-Frage kennen ("Warum kommt cxx nicht zum Build ?!"), Kommen wir schnell zur <strong>Fehlerseite</strong> mit dem Spruch <strong>"configure --with-extra-cxxflags hat keinen Einfluss auf den Hotspot"</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JDK-8156967</a> ). </p><br><p>  Welches Versprechen soll in JDK 12 behoben werden? Vielleicht.  Wunderbar - der wichtigste Build-Parameter wird in der Assembly nicht verwendet! </p><br><p>  Die erste Idee ist, die √Ñrmel hochzukrempeln und die Fehler zu beheben! </p><br><h2 id="oshibka-1-xn12">  Fehler 1.xn [12] </h2><br><pre> <code class="hljs powershell">dependencies.cpp: <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dependencies</span></span></span><span class="hljs-function">::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write_dependency_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xmlStream*, Dependencies::DepType, GrowableArray&lt;Dependencies::DepArgument&gt;*, Klass*)</span></span></span><span class="hljs-function">': </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dependencies</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cpp</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">498</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">6</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-function">: '%</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">directive</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writing</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">between</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">1</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">10</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bytes</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">into</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">region</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">9</span></span></span><span class="hljs-function"> [-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Werror</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">format-overflow</span></span></span><span class="hljs-function">=] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dependencies</span></span></span><span class="hljs-function">::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write_dependency_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xmlStream* xtty, ^~~~~~~~~~~~ dependencies.cpp:498:6: note: directive argument in the range [0, 2147483647]</span></span></span></span></code> </pre> <br><p>  Nun, wir m√ºssen wahrscheinlich die Region vergr√∂√üern.  Einhundert Pfund, jemand berechnete den Puffer durch Klicken auf "Ich bin gl√ºcklich!"  in google. </p><br><p>  Aber wie w√ºrden Sie verstehen, wie viel Sie brauchen?  Es gibt eine andere Art der Verfeinerung unten: </p><br><pre> <code class="hljs pgsql">stdio2.h:<span class="hljs-number"><span class="hljs-number">34</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>: note: <span class="hljs-string"><span class="hljs-string">'__builtin___sprintf_chk'</span></span> output <span class="hljs-keyword"><span class="hljs-keyword">between</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> bytes <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> a destination <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> size <span class="hljs-number"><span class="hljs-number">10</span></span> __bos (__s), __fmt, __va_arg_pack ());</code> </pre> <br><p>  Position 12 sieht nach etwas Wertvollem aus, mit dem Sie jetzt mit schmutzigen F√º√üen in die Quelle einbrechen k√∂nnen. </p><br><p>  Wir klettern in <code>dependencies.cpp</code> und beobachten das folgende Bild: </p><br><pre> <code class="cpp hljs">DepArgument arg = args-&gt;at(j); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j == <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg.is_oop()) { xtty-&gt;object(<span class="hljs-string"><span class="hljs-string">"x"</span></span>, arg.oop_value()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xtty-&gt;object(<span class="hljs-string"><span class="hljs-string">"x"</span></span>, arg.metadata_value()); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> xn[<span class="hljs-number"><span class="hljs-number">10</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(xn, <span class="hljs-string"><span class="hljs-string">"x%d"</span></span>, j); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg.is_oop()) { xtty-&gt;object(xn, arg.oop_value()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xtty-&gt;object(xn, arg.metadata_value()); } }</code> </pre> <br><p>  Achten Sie auf die problematische Linie: </p><br><pre> <code class="hljs perl">char xn[<span class="hljs-number"><span class="hljs-number">10</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">sprintf</span></span>(xn, <span class="hljs-string"><span class="hljs-string">"x%d"</span></span>, j);</code> </pre> <br><p>  Wir wechseln 10 zu 12, bauen wieder zusammen und ... die Montage ist weg! </p><br><p>  Aber bin ich der einzige, der so schlau ist und den Fehler aller Zeiten behoben hat?  Keine Frage, wir fahren unser Megapatch erneut in Google: <code>char xn[12];</code> </p><br><p>  Und wir sehen ... ja, das stimmt.  Der von Vladimir Ivanov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gesperrte Fehler JDK-8184309</a> enth√§lt genau das gleiche Update. </p><br><p>  Aber das Fazit ist, dass es nur in JDK 10 behoben ist und nifiga nicht auf jdk8u zur√ºckportiert wird.  Dies ist die Frage, warum neue Versionen von Java ben√∂tigt werden. </p><br><h2 id="oshibka-2-strcmp">  Fehler 2. strcmp </h2><br><pre> <code class="hljs powershell">fprofiler.cpp: <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> member <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ThreadProfiler</span></span></span><span class="hljs-function">::</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vm_update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TickPosition)</span></span></span><span class="hljs-function">': /</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">home</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">me</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">git</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jdk8ut</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hotspot</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">src</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">share</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vm</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runtime</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fprofiler</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cpp</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">638</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">56</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">argument</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">1</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">null</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">where</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">non-null</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expected</span></span></span><span class="hljs-function"> [-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Werror</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nonnull</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vm_match</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(const char* name)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> strcmp(name, _name) == <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  Aufgrund fr√ºherer bitterer Erfahrungen sehen wir uns sofort an, was sich an dieser Stelle in JDK 11 befindet. Und ... diese Datei ist nicht vorhanden.  Die Verzeichnisstruktur wurde ebenfalls √ºberarbeitet. </p><br><p>  Aber Sie k√∂nnen nicht einfach von uns wegkommen! </p><br><p>  Jeder Javist ist ein kleiner Nekromant in seiner Seele und vielleicht sogar ein Nekrophiler.  Daher wird es jetzt NECROMANCE IN ACTION geben! </p><br><p>  Zuerst m√ºssen Sie an die Seele der Toten appellieren und herausfinden, wann er gestorben ist: </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> hg log -<span class="hljs-literal"><span class="hljs-literal">-template</span></span> <span class="hljs-string"><span class="hljs-string">"File(s) deleted in rev {rev}: {file_dels % '\n {file}'}\n\n"</span></span> <span class="hljs-literal"><span class="hljs-literal">-r</span></span> <span class="hljs-string"><span class="hljs-string">'removes("**/fprofiler.cpp")'</span></span> File(s) deleted <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rev <span class="hljs-number"><span class="hljs-number">47106</span></span>: hotspot/src/share/vm/runtime/fprofiler.cpp hotspot/src/share/vm/runtime/fprofiler.hpp hotspot/test/runtime/MinimalVM/Xprof.java</code> </pre> <br><p>  Jetzt m√ºssen Sie die Todesursache herausfinden: </p><br><pre> <code class="hljs pgsql">hg <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> -r <span class="hljs-number"><span class="hljs-number">47106</span></span> changeset: <span class="hljs-number"><span class="hljs-number">47106</span></span>:bed18a111b90 parent: <span class="hljs-number"><span class="hljs-number">47104</span></span>:<span class="hljs-number"><span class="hljs-number">6</span></span>bdc0c9c44af <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>: gziemski <span class="hljs-type"><span class="hljs-type">date</span></span>: Thu Aug <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">26</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span> <span class="hljs-number"><span class="hljs-number">-0500</span></span> <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>: <span class="hljs-number"><span class="hljs-number">8173715</span></span>: Remove FlatProfiler</code> </pre><br><p>  Wir haben also einen M√∂rder: <strong>Gziemski</strong> .  Lassen Sie uns herausfinden, warum er diese ungl√ºckliche Akte genagelt hat. </p><br><p>  Gehen Sie dazu in dem in der Zusammenfassung des Commits angegebenen Ticket zu Fett.  Dies ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JDK-8173715</a> : </p><br><p>  FlatProfiler entfernen: <br>  Wir gehen davon aus, dass diese Technologie nicht mehr verwendet wird und eine Quelle f√ºr das Root-Scannen f√ºr den GC darstellt. </p><br><p>  F√ºr shih bis.  Tats√§chlich sind wir jetzt eingeladen, die Leiche zu reparieren, damit der Bau l√§uft.  Was sich so sehr zersetzt hat, dass sogar unsere Nekromantenkollegen von OpenJDK es aufgegeben haben. </p><br><p>  Lassen Sie uns den Toten wiederbeleben und versuchen, ihn zu fragen, woran er sich zuletzt erinnert hat.  Er war bereits in Revision 47106 tot, was bedeutet, dass die Revision eine weniger enth√§lt - dies ist ‚Äûeine Sekunde vorher‚Äú: </p><br><pre> <code class="bash hljs">hg cat <span class="hljs-string"><span class="hljs-string">"~/git/jdk11/hotspot/src/share/vm/runtime/fprofiler.cpp"</span></span> -r 47105 &gt; ~/tmp/fprofiler_new.cpp cp ~/git/jdk8u/hotspot/src/share/vm/runtime/fprofiler.cpp ~/tmp/fprofiler_old.cpp <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/tmp diff fprofiler_old.cpp fprofiler_new.cpp</code> </pre> <br><p>  Leider nichts in Bezug auf <code>return strcmp(name, _name) == 0;</code>  in diff nr.  Der Patient starb an einem Schlag mit einem stumpfen, scharfen Gegenstand (Dienstprogramm), war jedoch zum Zeitpunkt des Todes bereits todkrank. </p><br><p>  Lassen Sie uns die Essenz des Fehlers untersuchen. </p><br><p>  Folgendes m√∂chte der Code-Autor uns mitteilen: </p><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_compiled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vm_match</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* name)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(name, _name) == <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  Nun eine kleine Philosophie. </p><br><p>  Der C11-Standard in Abschnitt 7.1.4, ‚ÄûVerwendung von Bibliotheksfunktionen‚Äú, besagt ausdr√ºcklich: </p><br><blockquote>  Jede der folgenden Aussagen gilt, sofern in den folgenden detaillierten Beschreibungen nicht ausdr√ºcklich anders angegeben: Wenn ein Argument f√ºr eine Funktion einen ung√ºltigen Wert hat (z. B. [...] einen Nullzeiger [...]), [...], Das Verhalten ist undefiniert. </blockquote><p>  Das hei√üt, jetzt ist die ganze Frage, ob es einige <em>"ausdr√ºcklich anders angegeben" gibt</em> .  In der Beschreibung von <code>strcmp</code> in Abschnitt 7.24.4 ist <code>strcmp</code> dergleichen geschrieben, und ich habe keine anderen Abschnitte f√ºr Sie. </p><br><p>  Das hei√üt, wir haben hier undefiniertes Verhalten. </p><br><p>  Nat√ºrlich k√∂nnen Sie diesen Code nehmen und neu schreiben und ihn mit einer √úberpr√ºfung umgeben.  Ich bin mir jedoch nicht sicher, ob ich die Logik von Menschen, die UB verwenden, dort richtig verstehe, wo es nicht sein sollte.  Beispielsweise generieren einige Systeme SIGSERV f√ºr die Null-Dereferenzierung, und ein Hack-Liebhaber kann dies nutzen. Dieses Verhalten ist jedoch nicht obligatorisch und kann auf einer anderen Plattform gestartet werden. </p><br><p>  Ja, nat√ºrlich wird jemand sagen, dass Sie ein Dummkopf f√ºr sich selbst sind, dass Sie GCC 7.3 verwenden, aber in GCC 4 h√§tte sich alles angesammelt.  Aber undefiniertes Verhalten! = Nicht spezifiziert! = Implementierung definiert.  Dies f√ºr die letzten beiden kann festgelegt werden, um im alten Compiler zu arbeiten.  Und UB in der sechsten Version war UB. </p><br><p>  Kurz gesagt, ich war v√∂llig traurig √ºber diese komplexe philosophische Frage (sollte ich mit meinen Annahmen in den Code einsteigen), als mir pl√∂tzlich klar wurde, dass es anders sein k√∂nnte. </p><br><h1 id="est-drugoy-put">  Es gibt noch einen anderen Weg </h1><br><p>  Wie Sie wissen, gehen gute Helden immer herum. </p><br><p>  Selbst wenn wir unsere Philosophie √ºber UB ignorieren, gibt es dort unglaublich viele Probleme.  Nicht die Tatsache, dass sie bis zum Morgen repariert werden k√∂nnen.  Nicht die Tatsache, dass ich es nicht mit meinen krummen H√§nden tun kann.  Noch weniger ist die Tatsache, dass dies im Upstream akzeptiert wird: Der letzte Patch in jdk8u war vor 6 Wochen, und dies war die globale Zusammenf√ºhrung des neuen Tags. </p><br><p>  Stellen Sie sich vor, der obige Code ist tats√§chlich korrekt geschrieben.  Alles, was zwischen uns und seiner Ausf√ºhrung steht, ist eine Warnung, die aufgrund eines Fehlers im Build-System als Fehler wahrgenommen wurde.  Aber wir k√∂nnen ein Build-System aufbauen. </p><br><p>  Der Hexer Geralt von Rivia sagte einmal: </p><br><blockquote>  "Das B√∂se ist b√∂se, Stregobor", sagte der Hexer ernst und stand auf.  - Kleiner, gr√∂√üer, durchschnittlich - alles ist gleich, die Proportionen sind willk√ºrlich und die Grenzen sind verschwommen.  Ich bin kein heiliger Einsiedler, habe nicht nur einem in meinem Leben Gutes getan.  Aber wenn Sie zwischen einem √úbel und einem anderen w√§hlen m√ºssen, ziehe ich es vor, √ºberhaupt nicht zu w√§hlen. <br><br>  - Z≈Ço bis z≈Ço, Stregoborze - rzek≈Ç powa≈ºnie wied≈∫min wstajƒÖc.  - Mniejsze, wiƒôksze, ≈õrednie, wszystko jedno, proporcje sƒÖ umowne a granice zatarte.  Nie jestem ≈õwiƒÖtobliwym pustelnikiem, nie samo dobro czyni≈Çem w ≈ºyciu.  Ale je≈ºeli mam wybieraƒá pomiƒôdzy jednym z≈Çem a drugim, wolƒô nie wybieraƒá wcale. </blockquote><p>  Dies ist ein Zitat aus The Last Wish, einer Geschichte namens Lesser Evil.  Wir alle wissen, dass Geralt fast nie die Rolle eines wirklich neutralen Charakters spielen konnte und sogar aufgrund eines anderen klassischen chaotischen Verhaltens starb. </p><br><p>  Lassen Sie uns also kurz das kleinere √úbel zeigen.  Lassen Sie uns √ºber das Build-System gehen. </p><br><p>  Ganz am Anfang haben wir diesen Auspuff gesehen: </p><br><pre> <code class="hljs go">grep -rl <span class="hljs-string"><span class="hljs-string">"Werror"</span></span> . ./common/autoconf/flags.m4 ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/linux/makefiles/gcc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span> ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/bsd/makefiles/gcc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span> ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/solaris/makefiles/gcc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span> ./hotspot/<span class="hljs-built_in"><span class="hljs-built_in">make</span></span>/aix/makefiles/xlc.<span class="hljs-built_in"><span class="hljs-built_in">make</span></span></code> </pre> <br><p>  Beim Vergleich dieser beiden Dateien habe ich das ganze Gesicht mit dem Facespalm gebrochen und den Unterschied in der Kultur der beiden Plattformen erkannt: </p><br><p>  BSD ist eine Geschichte √ºber Freiheit und Wahlm√∂glichkeiten: </p><br><pre> <code class="hljs lisp"># Compiler warnings are treated as errors ifneq ($(<span class="hljs-name"><span class="hljs-name">COMPILER_WARNINGS_FATAL</span></span>),false) WARNINGS_ARE_ERRORS = -Werror endif</code> </pre> <br><p>  GNU / Linux ist ein autorit√§res puristisches Regime: </p><br><pre> <code class="hljs sql"><span class="hljs-comment"><span class="hljs-comment"># Compiler warnings are treated as errors WARNINGS_ARE_ERRORS = -Werror</span></span></code> </pre> <br><p>  Nun, es w√ºrde √ºber <code>XX_FLAGS</code> an Linux <code>XX_FLAGS</code> , diese Variable wird bei der Berechnung von <code>WARNINGS_ARE_ERRORS</code> nicht ber√ºcksichtigt!  Im Build f√ºr GNU / Linux haben wir einfach keine andere Wahl, als den von oben gestarteten Standardeinstellungen zu folgen. </p><br><p>  Nun, oder Sie k√∂nnen es einfacher machen und den Wert von <code>WARNINGS_ARE_ERRORS</code> in ein kurzes, aber nicht weniger leistungsf√§higes <code>-w</code> √§ndern.  Wie gef√§llt dir das, Elon Musk? </p><br><p>  Wie Sie vielleicht erraten haben, l√∂st dies dieses Build-Problem vollst√§ndig. </p><br><p>  Wenn der Code zusammengestellt ist, sehen Sie eine Reihe seltsamer, schrecklich aussehender Probleme, die vorbeifliegen.  Manchmal war es so be√§ngstigend, dass ich unbedingt Strg + C dr√ºcken und versuchen wollte, es herauszufinden.  Aber nein, du kannst nicht, du kannst nicht ... </p><br><p>  Es scheint, dass sich alles angesammelt hat und keine zus√§tzlichen Probleme mit sich gebracht hat.  Obwohl ich es nat√ºrlich nicht gewagt habe, mit dem Testen zu beginnen.  Trotzdem bleiben meine Augen nachts zusammen und irgendwie m√∂chte ich nicht zum letzten Ausweg gehen - vier Dosen Energie aus dem K√ºhlschrank. </p><br><a name="three"></a><br><h1 id="padaet-v-korku">  F√§llt in die Kruste </h1><br><p>  Die Assembly ist bestanden, die ausf√ºhrbaren Dateien wurden generiert, wir sind gro√üartig. </p><br><p>  Und so kamen wir zur Ziellinie.  Oder nicht gekommen? </p><br><p>  Unsere Versammlung liegt folgenderma√üen vor: </p><br><pre> <code class="hljs powershell">export JAVA_HOME=~/git/jdk8u/build/linux<span class="hljs-literal"><span class="hljs-literal">-x86_64</span></span><span class="hljs-literal"><span class="hljs-literal">-normal</span></span><span class="hljs-literal"><span class="hljs-literal">-server</span></span><span class="hljs-literal"><span class="hljs-literal">-fastdebug</span></span>/jdk export PATH=<span class="hljs-variable"><span class="hljs-variable">$JAVA_HOME</span></span>/bin:<span class="hljs-variable"><span class="hljs-variable">$PATH</span></span></code> </pre> <br><p>  Wenn Sie versuchen, die ausf√ºhrbare <code>java</code> Datei auszuf√ºhren, st√ºrzt sie sofort ab.  F√ºr diejenigen, die nicht vertraut sind - es sieht ungef√§hr so ‚Äã‚Äãaus: </p><br><p><img src="https://habrastorage.org/webt/n2/3p/ep/n23pepls-unfomopiqb1zgkx5eq.png"><br></p><br><p>  Zur gleichen Zeit hat Alex Debian 9.5 und ich habe Ubuntu.  Zwei verschiedene Versionen von GCC, zwei unterschiedlich aussehende Krusten.  Ich habe unschuldige Streiche mit dem manuellen Strcmp-Patch und ein paar weiteren Stellen, Alex nicht.  Was ist das Problem? </p><br><p>  Diese Geschichte verdient eine eigene Geschichte, aber hier gehen wir direkt zu den trockenen Schlussfolgerungen, sonst werde ich diesen Beitrag nie hinzuf√ºgen. </p><br><p>  Das Problem ist, dass unsere bevorzugten C ++ - Pogromisten wieder undefiniertes Verhalten verwendeten. </p><br><p>  (Au√üerdem h√§ngt es in unbekannter Weise von der Implementierung des Compilers ab. Wir m√ºssen jedoch daran denken, dass UB immer UB ist, selbst bei einer bekannten Version des Compilers ist es unm√∂glich, darauf zu liegen.) </p><br><p>  An einer Stelle wenden wir uns dort dem Feld einer untergestalteten Klasse zu, und alles bricht zusammen.  Fragen Sie nicht, wie es passiert ist, alles ist kompliziert. </p><br><p>  F√ºr einen Javista ist es sehr schwierig, sich vorzustellen, wie man sich einer unterkonstruierten Klasse zuwenden kann, es sei denn, man gibt direkt vom Konstruktor einen Link dazu.  Gl√ºcklicherweise kann die wunderbare C ++ - Sprache alles oder fast alles.  Ich werde ein Beispiel mit einem bestimmten Pseudocode schreiben: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> {</span></span> A() { _b.Show(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> B _b; }; A a; BA::_b; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre> <br><p>  Habt ein sch√∂nes Debug! </p><br><p>  Wenn Sie sich C ++ 98 [class.cdtor] ansehen: </p><br><blockquote>  F√ºr ein Objekt vom Nicht-POD-Klassentyp ... f√ºhrt der Verweis auf ein nicht statisches Element oder eine nicht statische Basisklasse des Objekts zu undefiniertem Verhalten, bevor der Konstruktor mit der Ausf√ºhrung beginnt </blockquote><p>  Beginnend mit GCC einer Version (und ich habe 7.3) wurde eine Optimierung der "Eliminierung von lebenslangen toten Speichern" ver√∂ffentlicht, die glaubt, dass wir uns nur w√§hrend seiner Lebensdauer auf ein Objekt beziehen und alles au√üerhalb der Lebensdauer aushustet. </p><br><p>  Die L√∂sung besteht darin, die neuen Optimierungen zu deaktivieren und wie im alten GCC zur√ºckzukehren: </p><br><pre> <code class="hljs powershell">CFLAGS += <span class="hljs-literal"><span class="hljs-literal">-fno</span></span><span class="hljs-literal"><span class="hljs-literal">-strict</span></span><span class="hljs-literal"><span class="hljs-literal">-aliasing</span></span> <span class="hljs-literal"><span class="hljs-literal">-fno</span></span><span class="hljs-literal"><span class="hljs-literal">-lifetime</span></span><span class="hljs-literal"><span class="hljs-literal">-dse</span></span> <span class="hljs-literal"><span class="hljs-literal">-fno</span></span><span class="hljs-literal"><span class="hljs-literal">-delete</span></span><span class="hljs-literal"><span class="hljs-literal">-null</span></span><span class="hljs-literal"><span class="hljs-literal">-pointer</span></span><span class="hljs-literal"><span class="hljs-literal">-checks</span></span></code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier</a> gibt es eine Diskussion dar√ºber. <br>  Aus irgendeinem Grund entschieden die Diskussionsteilnehmer, dass dies nicht in den Upstream aufgenommen werden w√ºrde.  Aber Sie m√ºssen immer noch versuchen, es zu senden. </p><br><p>  F√ºgen Sie diese Optionen zu unserer <code>./hotspot/make/linux/makefiles/gcc.make</code> , setzen Sie alles wieder zusammen und sehen Sie die gesch√§tzten Linien: </p><br><pre> <code class="hljs powershell">t<span class="hljs-variable"><span class="hljs-variable">$</span></span> ~/git/jdk8u/build/linux<span class="hljs-literal"><span class="hljs-literal">-x86_64</span></span><span class="hljs-literal"><span class="hljs-literal">-normal</span></span><span class="hljs-literal"><span class="hljs-literal">-server</span></span><span class="hljs-literal"><span class="hljs-literal">-fastdebug</span></span>/jdk/bin/java <span class="hljs-literal"><span class="hljs-literal">-version</span></span> openjdk version <span class="hljs-string"><span class="hljs-string">"1.8.0-internal-fastdebug"</span></span> OpenJDK Runtime Environment (build <span class="hljs-number"><span class="hljs-number">1.8</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-literal"><span class="hljs-literal">-internal</span></span><span class="hljs-literal"><span class="hljs-literal">-fastdebug</span></span><span class="hljs-literal"><span class="hljs-literal">-me_2018_09_10_08_14</span></span><span class="hljs-literal"><span class="hljs-literal">-b00</span></span>) OpenJDK <span class="hljs-number"><span class="hljs-number">64</span></span><span class="hljs-literal"><span class="hljs-literal">-Bit</span></span> Server VM (build <span class="hljs-number"><span class="hljs-number">25.71</span></span><span class="hljs-literal"><span class="hljs-literal">-b00</span></span><span class="hljs-literal"><span class="hljs-literal">-fastdebug</span></span>, mixed mode)</code> </pre> <br><h1 id="zaklyuchenie">  Fazit </h1><br><p>  Sie dachten wahrscheinlich, dass die Schlussfolgerung lauten w√ºrde: "Java ist eine Art H√∂lle, es gibt M√ºll im Code, es gibt keine Unterst√ºtzung, alles ist schlecht." </p><br><p>  Es ist nicht so!  Im Gegenteil, die obigen Beispiele zeigen, von welchem ‚Äã‚Äãschrecklichen √úbel unsere Freunde, Nekromanten von OpenJDK, uns abhalten. </p><br><p>  Und trotz der Tatsache, dass sie C ++ leben und verwenden m√ºssen, mit jedem UB zittern und die Compilerversion √§ndern und die Feinheiten der Plattformen lernen m√ºssen, ist der endg√ºltige Benutzercode in Java wahnsinnig stabil und basiert auf Builds, die auf offiziellen Websites von Unternehmen wie Azul ver√∂ffentlicht wurden. Red Hat und Oracle k√∂nnen in einem einfachen Fall kaum in die Kruste laufen. </p><br><p>  Das einzig traurige ist h√∂chstwahrscheinlich, dass die gefundenen Fehler in jdk8u wahrscheinlich nicht akzeptiert werden.  Wir haben JDK 8 einfach genommen, weil es f√ºr uns einfacher ist, es hier und jetzt zu patchen, und wir m√ºssen uns mit JDK 11 befassen.  Trotzdem ist es meiner Meinung nach IMHO, JDK 8 im Jahr 2018 zu verwenden. Dies ist eine sehr schlechte Praxis, und wir tun dies nicht aus einem guten Leben heraus.  Vielleicht wird sich unser Leben in Zukunft verbessern und Sie werden viele weitere unglaubliche Geschichten aus der Welt von JDK 11 und JDK 12 lesen. </p><br><p>  Vielen Dank f√ºr die Aufmerksamkeit, die einem so langweiligen Text ohne Bilder geschenkt wurde :-) </p><br><blockquote>  Minute der Werbung.  Die Joker 2018 Konferenz wird sehr bald stattfinden, wo es viele prominente Spezialisten f√ºr Java und JVM geben wird.  Die vollst√§ndige Liste der Redner und Berichte finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf der offiziellen Website</a> .  Ich werde auch dort sein, es wird m√∂glich sein, sich zu treffen und f√ºr das Leben und OpenJDK zu mahlen. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de422861/">https://habr.com/ru/post/de422861/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de422843/index.html">Eine Einf√ºhrung in die Welt der gef√§lschten Chips: Techniken zur Erkennung gef√§lschter Chips</a></li>
<li><a href="../de422845/index.html">Wie macht man Fernsehen wirklich schlau?</a></li>
<li><a href="../de422851/index.html">Warum die Zukunft der Datenspeicherung immer noch Magnetband ist</a></li>
<li><a href="../de422857/index.html">Implementieren Ihres IoC-Containers</a></li>
<li><a href="../de422859/index.html">Das Kommunikationsministerium schlug vor, auf SIM-Karten mit Verschl√ºsselung vom FSB umzusteigen</a></li>
<li><a href="../de422863/index.html">St√§mme, Gilden, Zugz√ºge und kein TDD: Wie die mobile Entwicklung in Uber, Spotify, Odnoklassniki und Avito funktioniert</a></li>
<li><a href="../de422865/index.html">Java Enterprise Open Lektion "CDI in Aktion"</a></li>
<li><a href="../de422867/index.html">Bestimmung der Anzahl der Stockwerke eines Hauses aus seinem Foto ohne maschinelles Lernen</a></li>
<li><a href="../de422869/index.html">Wir beherrschen neue Programmiersprachen und st√ºtzen uns auf das bereits Gelernte</a></li>
<li><a href="../de422871/index.html">Identifizieren Sie aussagekr√§ftige Profile in VK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>