<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯОИ ЁЯЖС ЁЯдн рд╣рдо рд░рд╕реНрдЯ рдкрд░ рдПрдХ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рд▓рд┐рдЦрддреЗ рд╣реИрдВред рдкреЗрдЬ рдореЗрдореЛрд░реА рд▓рд╛рдЧреВ рдХрд░рдирд╛ (рдирдпрд╛) ЁЯФР ЁЯЪ║ ЁЯУЕ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдПрдВрдЧреЗ рдХрд┐ рд╣рдорд╛рд░реЗ рдХреЛрд░ рдореЗрдВ рдкреЗрдЬ рдореЗрдореЛрд░реА рд╕рдкреЛрд░реНрдЯ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рдПред рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░реЗрдВрдЧреЗ рддрд╛рдХрд┐ рднреМрддрд┐рдХ рдкреГрд╖реНрда рддрд╛...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╣рдо рд░рд╕реНрдЯ рдкрд░ рдПрдХ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рд▓рд┐рдЦрддреЗ рд╣реИрдВред рдкреЗрдЬ рдореЗрдореЛрд░реА рд▓рд╛рдЧреВ рдХрд░рдирд╛ (рдирдпрд╛)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445618/">  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдПрдВрдЧреЗ рдХрд┐ рд╣рдорд╛рд░реЗ рдХреЛрд░ рдореЗрдВ рдкреЗрдЬ рдореЗрдореЛрд░реА рд╕рдкреЛрд░реНрдЯ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рдПред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░реЗрдВрдЧреЗ рддрд╛рдХрд┐ рднреМрддрд┐рдХ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдлреНрд░реЗрдо рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реЛ рдЬрд╛рдПрдВ, рдФрд░ рдЙрдирдХреЗ рдлрд╛рдпрджреЗ рдФрд░ рдиреБрдХрд╕рд╛рди рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВред  рдлрд┐рд░ рд╣рдо рдПрдбреНрд░реЗрд╕ рдЯреНрд░рд╛рдВрд╕рд▓реЗрд╢рди рдлрдВрдХреНрд╢рди рдФрд░ рдирдпрд╛ рдореИрдкрд┐рдВрдЧ рдмрдирд╛рдиреЗ рдХреЗ рдлрдВрдХреНрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВред <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧрд┐рдЯрд╣рдм</a> рдкрд░ рдкреНрд░рдХрд╛рд╢рд┐рдд рд▓реЗрдЦреЛрдВ рдХреА рдпрд╣ рд╢реНрд░реГрдВрдЦрд▓рд╛ред  рдпрджрд┐ рдЖрдкрдХреЗ рдХреЛрдИ рдкреНрд░рд╢реНрди рдпрд╛ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реИрдВ, рддреЛ рд╡рд╣рд╛рдВ рд╕рдВрдмрдВрдзрд┐рдд рдЯрд┐рдХрдЯ рдЦреЛрд▓реЗрдВред  рд▓реЗрдЦ рдХреЗ рд╕рднреА рд╕реНрд░реЛрдд <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд╕ рд╕реВрддреНрд░ рдореЗрдВ рд╣реИрдВ</a> ред <br><br>  <i><b>рдкреЗрдЬрд┐рдВрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдЕрдиреНрдп рд▓реЗрдЦ?</b></i> <i><br></i>  <i>рдпрджрд┐ рдЖрдк рдЗрд╕ рдЪрдХреНрд░ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдиреЗ рдЬрдирд╡рд░реА рдХреЗ рдЕрдВрдд рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">"рдкреГрд╖реНрда рдореЗрдореЛрд░реА: рдЙрдиреНрдирдд рд╕реНрддрд░"</a> рд▓реЗрдЦ рджреЗрдЦрд╛ред</i>  <i>рд▓реЗрдХрд┐рди рдкреБрдирд░рд╛рд╡рд░реНрддреА рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдореЗрд░реА рдЖрд▓реЛрдЪрдирд╛ рдХреА рдЧрдИ</a> ред</i>  <i>рдЗрд╕рд▓рд┐рдП, рдореИрдВрдиреЗ рдлрд╝реНрд░реЗрдо рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд▓реЗрдЦ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ред</i> <br><a name="habracut"></a><br>  <i>рдпрд╣рд╛рдБ рдПрдХ рдирдпрд╛ рд╡рд┐рдХрд▓реНрдк рд╣реИред</i>  <i>рд▓реЗрдЦ рдЕрднреА рднреА рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдХреИрд╕реЗ рдкреБрдирд░рд╛рд╡рд░реНрддреА рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдПрдВ рдХрд╛рдо рдХрд░рддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╣рдо рдПрдХ рд╕рд░рд▓ рдФрд░ рдЕрдзрд┐рдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</i>  <i>рд╣рдо рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ рдХреЛ рдирд╣реАрдВ рд╣рдЯрд╛рдПрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдкреБрд░рд╛рдиреЗ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░реЗрдВрдЧреЗ рдФрд░ рдЗрд╕реЗ рдЕрдкрдбреЗрдЯ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред</i> <i><br><br></i>  <i>рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдк рдирдП рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЖрдирдВрдж рд▓реЗрдВрдЧреЗ!</i> <br><br><h1>  рд╕рд╛рдордЧреНрд░реА </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд░рд┐рдЪрдп</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирд┐рд░реНрднрд░рддрд╛ рдЕрджреНрдпрддрди</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд╣рдЪрд╛рди рдорд╛рдирдЪрд┐рддреНрд░рдг</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд┐рдХреНрд╕реНрдб рдСрдлрд╕реЗрдЯ рдирдХреНрд╢рд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреВрд░реНрдг рднреМрддрд┐рдХ рд╕реНрдореГрддрд┐ рдорд╛рдирдЪрд┐рддреНрд░рдг</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрд╕реНрдерд╛рдпреА рдкреНрд░рджрд░реНрд╢рди</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреБрдирд░рд╛рд╡рд░реНрддреА рдкреГрд╖реНрда рд╕рд╛рд░рдгреА</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреВрдЯрд▓реЛрдбрд░ рд╕рдорд░реНрдерди</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреВрдЯ рдЬрд╛рдирдХрд╛рд░реА</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ рдореИрдХреНрд░реЛ</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрддрд╛ рдЕрдиреБрд╡рд╛рдж</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">MappedPageTable рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХ рдирдИ рдореИрдкрд┐рдВрдЧ рдмрдирд╛рдПрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлреНрд░реЗрдо рдЪрдпрди</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд╛рд░рд╛рдВрд╢</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдЧреЗ рдХреНрдпрд╛ рд╣реИ?</a> </li></ul><br><a name="1"></a><h1>  рдкрд░рд┐рдЪрдп </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ рд╕реЗ,</a> рд╣рдордиреЗ рдкреЗрдЬрд┐рдВрдЧ рдореЗрдореЛрд░реА рдХреЗ рд╕рд┐рджреНрдзрд╛рдВрддреЛрдВ рдФрд░ <code>x86_64</code> рдкрд░ рдЪрд╛рд░-рд╕реНрддрд░реАрдп рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реАрдЦрд╛ред  рд╣рдордиреЗ рдпрд╣ рднреА рдкрд╛рдпрд╛ рдХрд┐ рд▓реЛрдбрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╣рдорд╛рд░реЗ рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдкрджрд╛рдиреБрдХреНрд░рдо рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХрд░реНрдиреЗрд▓ рд╡рд░реНрдЪреБрдЕрд▓ рдкрддреЛрдВ рдкрд░ рдЪрд▓рддрд╛ рд╣реИред  рдЗрд╕рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдмрдврд╝ рдЬрд╛рддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╕реНрдореГрддрд┐ рддрдХ рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдХреЗ рдХрд╛рд░рдг рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдХреЛ рдмреЗрддрд░рддреАрдм рдврдВрдЧ рд╕реЗ рдмрджрд▓рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдкреГрд╖реНрда рджреЛрд╖ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд▓реЗрдЦ рд╣рдорд╛рд░реЗ рдХрд░реНрдиреЗрд▓ рд╕реЗ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВ, рдФрд░ рдХрд░реНрдиреЗрд▓ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЖрднрд╛рд╕реА рдкрддреЛрдВ рдкрд░ рдЪрд▓ рд░рд╣рд╛ рд╣реИред  рдпрд╣рд╛рдВ рд╣рдо рд╡рд┐рд╖рдп рдХреЛ рдЬрд╛рд░реА рд░рдЦрддреЗ рд╣реИрдВ рдФрд░ рдХрд░реНрдиреЗрд▓ рд╕реЗ рдкреЗрдЬ рдЯреЗрдмрд▓ рдХреЗ рдлреНрд░реЗрдо рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддреЗ рд╣реИрдВред  рд╣рдо рдЙрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рдлрд╛рдпрджреЗ рдФрд░ рдиреБрдХрд╕рд╛рди рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдлрд┐рд░ рд╣рдорд╛рд░реЗ рдХреЛрд░ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╡рд┐рдХрд▓реНрдк рдЪреБрдиреЗрдВрдЧреЗред <br><br>  рдмреВрдЯ рд▓реЛрдбрд░ рд╕рдорд░реНрдерди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рдкрд╣рд▓реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВрдЧреЗред  рдлрд┐рд░ рд╣рдо рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рднреМрддрд┐рдХ рдкрддреЛрдВ рдореЗрдВ рдЖрднрд╛рд╕реА рдкрддреЛрдВ рдХрд╛ рдЕрдиреБрд╡рд╛рдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рдкреВрд░реЗ рдкрджрд╛рдиреБрдХреНрд░рдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрд▓рддрд╛ рд╣реИред  рдЕрдВрдд рдореЗрдВ, рд╣рдо рд╕реАрдЦреЗрдВрдЧреЗ рдХрд┐ рдкреЗрдЬ рдЯреЗрдмрд▓ рдореЗрдВ рдирдП рдореИрдкрд┐рдВрдЧ рдХреИрд╕реЗ рдмрдирд╛рдПрдВ рдФрд░ рдирдП рдЯреЗрдмрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкреНрд░рдпреБрдХреНрдд рдореЗрдореЛрд░реА рдлреНрд░реЗрдо рдХреЛ рдХреИрд╕реЗ рдЦреЛрдЬреЗрдВред <br><br><a name="1_1"></a><h3>  рдирд┐рд░реНрднрд░рддрд╛ рдЕрджреНрдпрддрди </h3><br>  рдЗрд╕ рдЖрд▓реЗрдЦ рдореЗрдВ рдЖрдкрдХреЛ <code>bootloader</code> рд╕рдВрд╕реНрдХрд░рдг 0.4.0 рдпрд╛ рдЙрдЪреНрдЪрддрд░ рдФрд░ <code>x86_64</code> рд╕рдВрд╕реНрдХрд░рдг 0.5.2 рдпрд╛ рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ рдирд┐рд░реНрднрд░рддрд╛ рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЖрдк <code>Cargo.toml</code> рдореЗрдВ рдирд┐рд░реНрднрд░рддрд╛ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="plaintext hljs">[dependencies] bootloader = "0.4.0" x86_64 = "0.5.2"</code> </pre> <br>  рдЗрди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рд▓рд┐рдП, <a href="">рдмреВрдЯрд▓реЛрдбрд░ рд▓реЙрдЧ</a> рдФрд░ <a href="">x86_64 рд▓реЙрдЧ рджреЗрдЦреЗрдВ</a> ред <br><br><a name="2"></a><h1>  рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ </h1><br>  рдХрд░реНрдиреЗрд▓ рд╕реЗ рдкреЗрдЬ рдЯреЗрдмрд▓ рдПрдХреНрд╕реЗрд╕ рдХрд░рдирд╛ рдЗрддрдирд╛ рдЖрд╕рд╛рди рдирд╣реАрдВ рд╣реИ рдЬрд┐рддрдирд╛ рдпрд╣ рд▓рдЧ рд╕рдХрддрд╛ рд╣реИред  рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП, рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ рдХреЗ рдЪрд╛рд░ рд╕реНрддрд░реАрдп рддрд╛рд▓рд┐рдХрд╛ рдкрджрд╛рдиреБрдХреНрд░рдо рдкрд░ рдПрдХ рдФрд░ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c8/5e8/a14/9c85e8a145a9078cfcfd92e204f69a5b.svg"></div><br><br>  рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдкреГрд╖реНрда рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдЕрдЧрд▓реА рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ <i>рднреМрддрд┐рдХ</i> рдкрддрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреА рд╣реИред  рдпрд╣ рдЗрди рдкрддреЛрдВ рдХреЗ рдЕрдиреБрд╡рд╛рдж рд╕реЗ рдмрдЪрддрд╛ рд╣реИ, рдЬреЛ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЖрд╕рд╛рдиреА рд╕реЗ рдЕрдВрддрд╣реАрди рдЫреЛрд░реЛрдВ рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рд╕реАрдзреЗ рдХрд░реНрдиреЗрд▓ рд╕реЗ рднреМрддрд┐рдХ рдкрддреЛрдВ рддрдХ рдирд╣реАрдВ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╡рд░реНрдЪреБрдЕрд▓ рдкрддреЛрдВ рдкрд░ рднреА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬрдм рд╣рдо рдПрдбреНрд░реЗрд╕ <code>4 KiB</code> , рддреЛ рд╣рдо <i>рд╡рд░реНрдЪреБрдЕрд▓</i> рдПрдбреНрд░реЗрд╕ <code>4 KiB</code> рддрдХ рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВ, рди рдХрд┐ рдЙрд╕ <i>рднреМрддрд┐рдХ</i> рдкрддреЗ рдкрд░, рдЬрд╣рд╛рдВ 4 рд╡реЗрдВ рд╕реНрддрд░ рдХреЗ рдкреЗрдЬреЛрдВ рдХреА рддрд╛рд▓рд┐рдХрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИред  рдпрджрд┐ рд╣рдо <code>4 KiB</code> рдХреЗ рднреМрддрд┐рдХ рдкрддреЗ рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдХреБрдЫ рдЖрднрд╛рд╕реА рдкрддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬреЛ рдЗрд╕рдореЗрдВ рдЕрдиреБрд╡рд╛рджрд┐рдд рд╣реИред <br><br>  рдЗрд╕рд▓рд┐рдП, рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рдлрд╝реНрд░реЗрдореЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЗрди рдлрд╝реНрд░реЗрдореЛрдВ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╡рд░реНрдЪреБрдЕрд▓ рдкреЗрдЬреЛрдВ рдХреЛ рдореИрдк рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕ рддрд░рд╣ рдХреА рддреБрд▓рдирд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВред <br><br><a name="2_1"></a><h3>  рдкрд╣рдЪрд╛рди рдорд╛рдирдЪрд┐рддреНрд░рдг </h3><br>  рдПрдХ рд╕рд░рд▓ рд╕рдорд╛рдзрд╛рди <b>рд╕рднреА рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХрд╛ рд╕рдорд╛рди рдкреНрд░рджрд░реНрд╢рди рд╣реИ</b> ред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f3/813/916/8f3813916cd0a5b5174c8d14dabedb7a.svg"></div><br><br>  рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдо рдлреНрд░реЗрдо рдХреЗ рд╕рдорд╛рди рдкреНрд░рджрд░реНрд╢рди рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред  рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рднреМрддрд┐рдХ рдкрддреЗ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдорд╛рдиреНрдп рдЖрднрд╛рд╕реА рдкрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рд╣рдо рдЖрд╕рд╛рдиреА рд╕реЗ рд╕рднреА рд╕реНрддрд░реЛрдВ рдХреЗ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рд░рдЬрд┐рд╕реНрдЯрд░ рд╕реАрдЖрд░ 3 рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВред <br><br>  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рдХреЛ рдЕрд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдореБрдлреНрдд рдореЗрдореЛрд░реА рдХреЗ рдмрдбрд╝реЗ рд╕рдиреНрдирд┐рд╣рд┐рдд рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдЦреЛрдЬрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдмрдирд╛рддрд╛ рд╣реИред  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд╣рдо рдЙрдкрд░реЛрдХреНрдд рдЖрдХреГрддрд┐ рдореЗрдВ 1000 KiB рд╡рд░реНрдЪреБрдЕрд▓ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдирд╛</a> ред  рд╣рдо <code>28 KiB</code> рдХреНрд╖реЗрддреНрд░ рд╕реЗ рд╢реБрд░реВ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ <code>1004  KiB</code> рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдореМрдЬреВрдж рдкреГрд╖реНрда рдкрд░ рдЯрд┐рдХреА рд╣реБрдИ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдЖрдкрдХреЛ рддрдм рддрдХ рдЖрдЧреЗ рджреЗрдЦрдирд╛ рд╣реЛрдЧрд╛ рдЬрдм рддрдХ рдХрд┐ рд╣рдо рдПрдХ рдЙрдкрдпреБрдХреНрдд рдмрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХреЛ рди рдкрд╛ рд▓реЗрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <code>1008  KiB</code> рд╕рд╛рдеред  рдЦрдВрдбрд┐рдд рдореЗрдореЛрд░реА рдореЗрдВ рдЙрддрдиреА рд╣реА рд╡рд┐рдЦрдВрдбрди рдХреА рд╕рдорд╕реНрдпрд╛ рд╣реИред <br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдирдП рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ рдЙрди рднреМрддрд┐рдХ рдлрд╝реНрд░реЗрдореЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рдирдХреЗ рд╕рдВрдмрдВрдзрд┐рдд рдкреГрд╖реНрда рдЕрднреА рддрдХ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдП рдЧрдП рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реА рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП, рд╣рдордиреЗ 10008 kB <i>рд╡рд░реНрдЪреБрдЕрд▓</i> рдореЗрдореЛрд░реА рдХрд╛ рдПрдХ рдХреНрд╖реЗрддреНрд░ рдЖрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдкрддрд╛ <code>1008  KiB</code> ред  рдЕрдм рд╣рдо <code>1000  KiB</code> рдФрд░ <code>2008  KiB</code> рдмреАрдЪ рднреМрддрд┐рдХ рдкрддреЗ рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА рдлреНрд░реЗрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕реЗ рдкрд╣рдЪрд╛рди рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><a name="2_2"></a><h3>  рдлрд┐рдХреНрд╕реНрдб рдСрдлрд╕реЗрдЯ рдирдХреНрд╢рд╛ </h3><br>  рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рдХреЛ рдЕрд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдиреЗ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рдПрдХ <b>рдЕрд▓рдЧ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░</b> рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░ рд╕рдХрддреЗ <b>рд╣реИрдВ</b> ред  рдЗрд╕рд▓рд┐рдП, рдореИрдкрд┐рдВрдЧ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рдореЗрдВ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдСрдлрд╕реЗрдЯ рдХреЗ рд╕рд╛рде рдлреНрд░реЗрдо рдХреЛ рдореИрдк рдХрд░рддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдСрдлрд╕реЗрдЯ 10 TiB рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f4a/c8a/5ea/f4ac8a5ea64fd215de176248b5f74e20.svg"><br><br>  рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реБрджреНрдз рд░реВрдк рд╕реЗ рд╡рд░реНрдЪреБрдЕрд▓ рдореЗрдореЛрд░реА рдХреА рдЗрд╕ рд░реЗрдВрдЬ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдХреЗ, рд╣рдо рд╕рдорд╛рди рдбрд┐рд╕реНрдкреНрд▓реЗ рдХреА рд╕рдорд╕реНрдпрд╛рдУрдВ рд╕реЗ рдмрдЪрддреЗ рд╣реИрдВред  рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рдХреЗ рдЗрддрдиреЗ рдмрдбрд╝реЗ рдХреНрд╖реЗрддреНрд░ рдХрд╛ рд╕рдВрд░рдХреНрд╖рдг рдХреЗрд╡рд▓ рддрднреА рд╕рдВрднрд╡ рд╣реИ рдЬрдм рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдХреЗ рдЖрдХрд╛рд░ рд╕реЗ рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╣реЛред  <code>x86_64</code> рдпрд╣ рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ 48-рдмрд┐рдЯ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ 256 TiB рд╣реИред <br><br>  рд▓реЗрдХрд┐рди рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдиреБрдХрд╕рд╛рди рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдмрдирд╛рддреЗ рд╕рдордп, рдЖрдкрдХреЛ рдПрдХ рдирдИ рдореИрдкрд┐рдВрдЧ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдЕрдиреНрдп рдкрддрд╛ рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ рддрд╛рд▓рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдмрдирд╛рддреЗ рд╕рдордп рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛ред <br><br><a name="2_3"></a><h3>  рдкреВрд░реНрдг рднреМрддрд┐рдХ рд╕реНрдореГрддрд┐ рдорд╛рдирдЪрд┐рддреНрд░рдг </h3><br>  рд╣рдо <b>рд╕рднреА рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдкреНрд░рджрд░реНрд╢рд┐рдд</b> рдХрд░рдХреЗ рдЗрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рди рдХрд┐ рдХреЗрд╡рд▓ рдкреЗрдЬ рдЯреЗрдмрд▓ рдлреНрд░реЗрдо: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c39/3cf/7df/c393cf7df76515739e1d9274160c4b5d.svg"><br><br>  рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд░реНрдиреЗрд▓ рдХреЛ рдордирдорд╛рдиреЗ рдврдВрдЧ рд╕реЗ рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЕрдиреНрдп рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рдХреЗ рдкреЗрдЬ рдЯреЗрдмрд▓ рдлреНрд░реЗрдо рднреА рд╢рд╛рдорд┐рд▓ рд╣реИрдВред  рд╡рд░реНрдЪреБрдЕрд▓ рдореЗрдореЛрд░реА рдХреА рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдкрд╣рд▓реЗ рдХреА рддрд░рд╣ рд╣реА рдЖрдХрд╛рд░ рдореЗрдВ рдЖрд░рдХреНрд╖рд┐рдд рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдХреЗрд╡рд▓ рдХреЛрдИ рдмреЗрдЬреЛрдбрд╝ рдкреГрд╖реНрда рдирд╣реАрдВ рд╣реИрдВред <br><br>  рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдиреБрдХрд╕рд╛рди рдпрд╣ рд╣реИ рдХрд┐ рднреМрддрд┐рдХ рд╕реНрдореГрддрд┐ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЗрди рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рдХрд╣реАрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП рд╡реЗ рдХреБрдЫ рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдХрд┐ рдереЛрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рд░реИрдо рдХреЗ рд╕рд╛рде рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ рдПрдХ рд╕рдорд╕реНрдпрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред <br><br>  рд╣рд╛рд▓рд╛рдБрдХрд┐, x86_64 рдкрд░ рд╣рдо 4 KiB рдХреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЖрдХрд╛рд░ рдХреЗ рдмрдЬрд╛рдп рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рд╢рд╛рд▓</a> 2 MiB <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреГрд╖реНрдареЛрдВ</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдХреЗ 32 GiB рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкреНрд░рддрд┐ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдХреЗрд╡рд▓ 132 KiB рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ: рдХреЗрд╡рд▓ рдПрдХ рддреГрддреАрдп-рд╕реНрддрд░реАрдп рддрд╛рд▓рд┐рдХрд╛ рдФрд░ 32 рджреНрд╡рд┐рддреАрдп-рд╕реНрддрд░реАрдп рддрд╛рд▓рд┐рдХрд╛рдПрдБред  рд╡рд┐рд╢рд╛рд▓ рдкреГрд╖реНрдареЛрдВ рдХреЛ рднреА рдЕрдзрд┐рдХ рдХреБрд╢рд▓рддрд╛ рд╕реЗ рдХреИрд╢ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЧрддрд┐рд╢реАрд▓ рдЕрдиреБрд╡рд╛рдж рдмрдлрд░ (рдЯреАрдПрд▓рдмреА) рдореЗрдВ рдХрдо рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред <br><br><a name="2_4"></a><h3>  рдЕрд╕реНрдерд╛рдпреА рдкреНрд░рджрд░реНрд╢рди </h3><br>  рдмрд╣реБрдд рдХрдо рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рд╡рд╛рд▓реЗ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП, рдЖрдк рдХреЗрд╡рд▓ рдЙрди рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП <b>рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдкреЗрдЬ рдЯреЗрдмрд▓ рдкреНрд░рджрд░реНрд╢рд┐рдд</b> рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЕрд╕реНрдерд╛рдпреА рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП, рдХреЗрд╡рд▓ рдкреНрд░рдердо рд╕реНрддрд░ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдПрдХ рд╕рдорд╛рди рдкреНрд░рджрд░реНрд╢рди рдЖрд╡рд╢реНрдпрдХ рд╣реИ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/00a/3ab/5ce/00a3ab5ce85057d3679a48379d3d2297.svg"></div><br><br>  рдЗрд╕ рдЖрдВрдХрдбрд╝реЗ рдореЗрдВ, рдПрдХ рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рдХреЗ рдкрд╣рд▓реЗ 2 MiB рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддреА рд╣реИред  рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ CR3 рд░рдЬрд┐рд╕реНрдЯрд░ рд╕реЗ рдкрд╣реБрдВрдЪ 4, 3 рдФрд░ 2 рдХреЗ рд╕реНрддрд░реЛрдВ рдореЗрдВ рд╢реВрдиреНрдп рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реИред рд╕реВрдЪрдХрд╛рдВрдХ <code>8</code> рд╕рд╛рде рд░рд┐рдХреЙрд░реНрдб <code>32 KiB</code> рдкрд░ рдЖрднрд╛рд╕реА рдкреГрд╖реНрда рдХреЛ <code>32 KiB</code> рдореЗрдВ рдПрдХ рднреМрддрд┐рдХ рдлреНрд░реЗрдо рдореЗрдВ рдЕрдиреБрд╡рд╛рдж рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рдХреА рдкрд╣рдЪрд╛рди рд╣реЛрддреА рд╣реИред рдЖрдХреГрддрд┐ рдореЗрдВ рдпрд╣ рдПрдХ рдХреНрд╖реИрддрд┐рдЬ рддреАрд░ рджреНрд╡рд╛рд░рд╛ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br>  рдЖрдЗрдбреЗрдВрдЯрд▓реА рдореИрдкреНрдб рд▓реЗрд╡рд▓ 1 рдЯреЗрдмрд▓ рдкрд░ рд▓рд┐рдЦрдХрд░, рд╣рдорд╛рд░рд╛ рдХрд░реНрдиреЗрд▓ 511 рдЯрд╛рдЗрдо рдХрдВрдкреЗрд░рд┐рдЬрди (рдкрд╣рдЪрд╛рди рдореИрдкрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЬрд░реВрд░реА рд░рд┐рдХреЙрд░реНрдб рдорд╛рдЗрдирд╕ 512 рдорд┐рдирдЯ) рддрдХ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред  рдЙрдкрд░реЛрдХреНрдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдХрд░реНрдиреЗрд▓ рджреЛ рдмрд╛рд░ рддреБрд▓рдирд╛ рдмрдирд╛рддрд╛ рд╣реИ: <br><br><ul><li>  <code>24 KiB</code> рдкрд░ рдПрдХ рдлреНрд░реЗрдо рдореЗрдВ рдПрдХ рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдХ рд╢реВрдиреНрдп рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХрд╛ рдорд╛рдирдЪрд┐рддреНрд░рдгред  рдпрд╣ рдбреЙрдЯреЗрдб рддреАрд░ рджреНрд╡рд╛рд░рд╛ рдЗрдВрдЧрд┐рдд рдкреГрд╖реНрда рд╕реНрддрд░ 2 рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рднреМрддрд┐рдХ рдлреНрд░реЗрдо рдореЗрдВ <code>0 KiB</code> рдкрд░ рдЖрднрд╛рд╕реА рдкреГрд╖реНрда рдХрд╛ рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдорд╛рдирдЪрд┐рддреНрд░рдг рдмрдирд╛рддрд╛ рд╣реИред </li><li>  <code>4 KiB</code> рдореЗрдВ рдПрдХ рдлреНрд░реЗрдо рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рдХреЗ 9 рд╡реЗрдВ рд░рд┐рдХреЙрд░реНрдб рдХрд╛ рдорд┐рд▓рд╛рди рдХрд░реЗрдВред  рдпрд╣ рдбреЙрдЯреЗрдб рдПрд░реЛ рджреНрд╡рд╛рд░рд╛ рдЗрдВрдЧрд┐рдд рдкреЗрдЬ рд▓реЗрд╡рд▓ 4 рдЯреЗрдмрд▓ рдХреЗ рднреМрддрд┐рдХ рдлреНрд░реЗрдо рдореЗрдВ <code>36 KiB</code> рдкрд░ рд╡рд░реНрдЪреБрдЕрд▓ рдкреЗрдЬ рдХрд╛ рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдорд╛рдирдЪрд┐рддреНрд░рдг рдмрдирд╛рддрд╛ рд╣реИред </li></ul><br>  рдЕрдм рдХрд░реНрдиреЗрд▓ рдПрдХ рд╕реНрддрд░ 2 рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдЙрд╕ рдкреГрд╖реНрда рдкрд░ рд▓рд┐рдЦрдХрд░ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ <code>0 KiB</code> рдкрд░ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдПрдХ рд╕реНрддрд░ 4 рддрд╛рд▓рд┐рдХрд╛ <code>33 KiB</code> рдкрд░ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рдкреГрд╖реНрда рдкрд░ рд▓рд┐рдЦрдХрд░ред <br><br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЕрд╕реНрдерд╛рдпреА рдореИрдкрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдПрдХ рдордирдорд╛рдиреЗ рдврдВрдЧ рд╕реЗ рдлреНрд░реЗрдо рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреНрд░рд┐рдпрд╛рдПрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: <br><br><ul><li>  рд╕рдорд╛рди рд░реВрдк рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдХ рдирд┐рдГрд╢реБрд▓реНрдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред <br></li><li>  рдЗрд╕ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдЙрд╕ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рднреМрддрд┐рдХ рдлрд╝реНрд░реЗрдо рдореЗрдВ рдореИрдк рдХрд░реЗрдВ рдЬрд┐рд╕реЗ рд╣рдо рдПрдХреНрд╕реЗрд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред <br></li><li>  рдкреНрд░рд╡реЗрд╢ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реЗ рдЖрднрд╛рд╕реА рдкреГрд╖реНрда рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕ рдлреНрд░реЗрдо рддрдХ рдкрд╣реБрдВрдЪреЗрдВред <br></li><li>  рдЕрдкреНрд░рдпреБрдХреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд╛рдкрд╕ рд░рд┐рдХреЙрд░реНрдб рд╕реЗрдЯ, рдЬрд┐рд╕рд╕реЗ рдЕрд╕реНрдерд╛рдпреА рдорд╛рдирдЪрд┐рддреНрд░рдг рдХреЛ рд╣рдЯрд╛рдиреЗред </li></ul><br>  рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рде, рдЖрднрд╛рд╕реА рдкрддрд╛ рд╕реНрдерд╛рди рд╕рд╛рдл тАЛтАЛрд░рд╣рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╕рдорд╛рди 512 рдЖрднрд╛рд╕реА рдкреГрд╖реНрда рд▓рдЧрд╛рддрд╛рд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдиреБрдХрд╕рд╛рди рдХреБрдЫ рдмреЛрдЭрд┐рд▓ рд╣реИ, рдЦрд╛рд╕рдХрд░ рдЬрдм рд╕реЗ рдПрдХ рдирдИ рддреБрд▓рдирд╛ рдореЗрдВ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдХрдИ рд╕реНрддрд░реЛрдВ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЕрд░реНрдерд╛рдд, рд╣рдореЗрдВ рдХрдИ рдмрд╛рд░ рд╡рд░реНрдгрд┐рдд рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рджреЛрд╣рд░рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред <br><br><a name="2_5"></a><h3>  рдкреБрдирд░рд╛рд╡рд░реНрддреА рдкреГрд╖реНрда рд╕рд╛рд░рдгреА </h3><br>  рдПрдХ рдФрд░ рджрд┐рд▓рдЪрд╕реНрдк рджреГрд╖реНрдЯрд┐рдХреЛрдг рдЬрд┐рд╕рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рд╡рд╣ <b>рдкреБрдирд░рд╛рд╡рд░реНрддреА рдорд┐рд▓рд╛рди рд╣реИ</b> ред <br><br>  рд╡рд┐рдЪрд╛рд░ рдЕрдкрдиреЗ рдЖрдк рдореЗрдВ рдЪреМрдереЗ рд╕реНрддрд░ рдХреА рддрд╛рд▓рд┐рдХрд╛ рд╕реЗ рдХреБрдЫ рд░рд┐рдХреЙрд░реНрдб рдХрд╛ рдЕрдиреБрд╡рд╛рдж рдХрд░рдирд╛ рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рдХрд╛ рдПрдХ рд╣рд┐рд╕реНрд╕рд╛ рдЖрд░рдХреНрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╕рднреА рд╡рд░реНрддрдорд╛рди рдФрд░ рднрд╡рд┐рд╖реНрдп рдХреЗ рдЯреЗрдмрд▓ рдлреНрд░реЗрдо рдХреЛ рдЗрд╕ рд╕реНрдкреЗрд╕ рдореЗрдВ рдореИрдк рдХрд░рддреЗ рд╣реИрдВред <br><br>  рдЖрдЗрдП рдПрдХ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/779/ee6/d9b/779ee6d9bf771dec8e6d22c0440e503d.png"></div><br><br>  рд▓реЗрдЦ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдЙрджрд╛рд╣рд░рдг рд╕реЗ рдПрдХрдорд╛рддреНрд░ рдЕрдВрддрд░ 4 рдЯреЗрдмрд▓ рдХреЗ рд╕реНрддрд░ рдореЗрдВ рд╕реВрдЪрдХрд╛рдВрдХ <code>511</code> рд╕рд╛рде рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд░рд┐рдХреЙрд░реНрдб рд╣реИ, рдЬрд┐рд╕реЗ рднреМрддрд┐рдХ рдлреНрд░реЗрдо <code>4 KiB</code> рдореЗрдВ рдореИрдк рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╣реА рд╕реНрдерд┐рдд рд╣реИред <br><br>  рдЬрдм рд╕реАрдкреАрдпреВ рдЗрд╕ рд░рд┐рдХреЙрд░реНрдб рдкрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕реНрддрд░ 3 рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рд╕реЗ рд╕реНрддрд░ 4 рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдкреБрдирд░рд╛рд╡рд░реНрддреА рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рдорд╛рди рд╣реИ рдЬреЛ рд╕реНрд╡рдпрдВ рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдкреНрд░реЛрд╕реЗрд╕рд░ рдорд╛рдирддрд╛ рд╣реИ рдХрд┐ рд╕реНрддрд░ 4 рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд░рд┐рдХреЙрд░реНрдб рд╕реНрддрд░ 3 рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд▓рд┐рдП рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЕрдм рдпрд╣ рд╕реНрддрд░ 4 рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рд╕реНрддрд░ 3 рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирддрд╛ рд╣реИред рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ x86_64 рдореЗрдВ рд╕рднреА рд╕реНрддрд░реЛрдВ рдХреЗ рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреА рд╕рдВрд░рдЪрдирд╛ рд╕рдорд╛рди рд╣реЛрддреА рд╣реИред <br><br>  рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд░реВрдкрд╛рдВрддрд░рдг рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рдмрд╛рд░ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░рд┐рдХреЙрд░реНрдб рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ, рд╣рдо рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕реНрддрд░реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдкреНрд░рднрд╛рд╡реА рдврдВрдЧ рд╕реЗ рдХрдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рд╣рдо рдПрдХ рдмрд╛рд░ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░рд┐рдХреЙрд░реНрдб рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рд╕реНрддрд░ 3 рддрд╛рд▓рд┐рдХрд╛ рдкрд░ рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕реЛрдЪрддрд╛ рд╣реИ рдХрд┐ рд╕реНрддрд░ 3 рддрд╛рд▓рд┐рдХрд╛ рдПрдХ рд╕реНрддрд░ 2 рддрд╛рд▓рд┐рдХрд╛ рд╣реИред рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реБрдП, рд╡рд╣ рд╕реНрддрд░ 2 рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирддрд╛ рд╣реИ, рдФрд░ рд╕реНрддрд░ рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдореИрдк рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рднреМрддрд┐рдХ рд╕реНрдореГрддрд┐ рдореЗрдВ рдлреНрд░реЗрдоред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЕрдм рд╣рдо рдкреЗрдЬ рд▓реЗрд╡рд▓ 1 рдЯреЗрдмрд▓ рдкрд░ рдкрдврд╝ рдФрд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдореИрдкреНрдб рдлреНрд░реЗрдо рд╣реИред  рдиреАрдЪреЗ рджрд┐рдпрд╛ рдЧрдпрд╛ рдЖрдВрдХрдбрд╝рд╛ рдРрд╕реЗ рдЕрдиреБрд╡рд╛рдж рдХреЗ рдкрд╛рдБрдЪ рдЪрд░рдгреЛрдВ рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bda/ac7/191/bdaac719103c574c655efa3604d0b842.png"></div><br><br>  рдЗрд╕реА рддрд░рд╣, рд╣рдо рд░реВрдкрд╛рдВрддрд░рдг рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рджреЛ рдмрд╛рд░ рдкрд╛рд░рд┐рдд рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╕реНрддрд░ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреБрдирд░рд╛рд╡рд░реНрддреА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХрд╛ рдкрд╛рд▓рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f4/b9a/c47/7f4b9ac47fce9552dead4e551b804256.png"></div><br><br>  рдЖрдЗрдП рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЪрд░рдг рджрд░ рдЪрд░рдг рджреЗрдЦреЗрдВред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, CPU рд╕реНрддрд░ 4 рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдХ рдкреБрдирд░рд╛рд╡рд░реНрддреА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕реЛрдЪрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕реНрддрд░ 3 рддрд╛рд▓рд┐рдХрд╛ рддрдХ рдкрд╣реБрдВрдЪ рдЧрдпрд╛ рд╣реИред рдлрд┐рд░ рд╡рд╣ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░рд┐рдХреЙрд░реНрдб рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕реЛрдЪрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рд╕реНрддрд░ 2 рддрдХ рдкрд╣реБрдВрдЪ рдЧрдпрд╛ рд╣реИред рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рдЕрднреА рднреА 4 рдХреЗ рд╕реНрддрд░ рдкрд░ рд╣реИред рддрдм CPU рдирдП рдкрддреЗ рдкрд░ рдЬрд╛рддрд╛ рд╣реИред рдФрд░ рд╕реНрддрд░ 3 рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╕реЛрдЪрддрд╛ рд╣реИред рдЕрдВрдд рдореЗрдВ, рд╕реНрддрд░ 2 рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЕрдЧрд▓реЗ рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ рдкрд░, рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЙрд╕рдиреЗ рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдлреНрд░реЗрдо рддрдХ рдкрд╣реБрдВрдЪ рдмрдирд╛рдИ рд╣реИред  рдпрд╣ рд╣рдореЗрдВ рдПрдХ рд╕реНрддрд░ 2 рдЯреЗрдмрд▓ рдкрд░ рдкрдврд╝рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред <br><br>  рд╕реНрддрд░ 3 рдФрд░ 4 рдХреА рддрд╛рд▓рд┐рдХрд╛рдПрдБ рднреА рдПрдХреНрд╕реЗрд╕ рдХреА рдЧрдИ рд╣реИрдВред рд╕реНрддрд░ 3 рдХреА рддрд╛рд▓рд┐рдХрд╛ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рддреАрди рдмрд╛рд░ рдПрдХ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░рд┐рдХреЙрд░реНрдб рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реИрдВ: рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕реЛрдЪрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕реНрддрд░ 1 рдХреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╣реИ, рдФрд░ рдЕрдЧрд▓реЗ рдЪрд░рдг рдореЗрдВ рд╣рдо рд╕реНрддрд░ 3 рддрдХ рдкрд╣реБрдБрдЪрддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рд╕реАрдкреАрдпреВ рдПрдХ рдореИрдкреНрдб рдлрд╝реНрд░реЗрдо рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦрддрд╛ рд╣реИред  рд╕реНрддрд░ 4 рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рд╕реНрд╡рдпрдВ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдХреЗрд╡рд▓ рдЪрд╛рд░ рдмрд╛рд░ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░рд┐рдХреЙрд░реНрдб рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реИрдВ рдЬрдм рддрдХ рдХрд┐ рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕реНрддрд░ 4 рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдПрдХ рдореИрдкреНрдб рдлрд╝реНрд░реЗрдо (рдиреАрдЪреЗ рдХреА рдЖрдХреГрддрд┐ рдореЗрдВ рдиреАрд▓рд╛) рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/487/a82/92c/487a8292cf8fe673f1914f5f198c0956.png"></div><br><br>  рдЕрд╡рдзрд╛рд░рдгрд╛ рдкрд╣рд▓реА рдмрд╛рд░ рдореЗрдВ рд╕рдордЭрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИ, рд▓реЗрдХрд┐рди рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ рдпрд╣ рдмрд╣реБрдд рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред <br><br><h4>  рдкрддрд╛ рдЧрдгрдирд╛ </h4><br>  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рдмрд╛рд░ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░рд┐рдХреЙрд░реНрдб рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ рд╕рднреА рд╕реНрддрд░реЛрдВ рдХреА рддрд╛рд▓рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВред  рдЪреВрдВрдХрд┐ рдЪрд╛рд░ рд╕реНрддрд░реЛрдВ рдХреЗ рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЕрдиреБрдХреНрд░рдорд┐рдд рдХреЛ рд╕реАрдзреЗ рдЖрднрд╛рд╕реА рдкрддреЗ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рдкрджреНрдзрддрд┐ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рдЖрднрд╛рд╕реА рдкрддреЗ рдмрдирд╛рдП рдЬрд╛рдиреЗ рдЪрд╛рд╣рд┐рдПред  рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рдпрд╛рдж рдХрд░рддреЗ рд╣реИрдВ, рдкреЗрдЬ рдЯреЗрдмрд▓ рдЗрдВрдбреЗрдХреНрд╕ рдЗрд╕ рдкрддреЗ рд╕реЗ рдирд┐рдХрд╛рд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c44/33c/8f9/c4433c8f99b6fcb54d4b79983ca35dbc.svg"></div><br><br>  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд╣рдо рдПрдХ рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреГрд╖реНрда рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдКрдкрд░ рд╕реАрдЦрд╛ рд╣реИ, рдЖрдкрдХреЛ рдПрдХ рдмрд╛рд░ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░рд┐рдХреЙрд░реНрдб рд╕реЗ рдЧреБрдЬрд░рдирд╛ рд╣реЛрдЧрд╛, рдФрд░ рдлрд┐рд░ 4, 3 рдФрд░ 2 рдХреЗ рд╕реНрддрд░ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕рднреА рдПрдбреНрд░реЗрд╕ рдмреНрд▓реЙрдХ рдХреЛ рдПрдХ рдмреНрд▓реЙрдХ рдореЗрдВ рджрд╛рдИрдВ рдУрд░ рд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░рд┐рдХреЙрд░реНрдб рдХреЗ рдЗрдВрдбреЗрдХреНрд╕ рдХреЛ рд▓реЗрд╡рд▓ 4 рдХреЗ рд╢реБрд░реБрдЖрддреА рдЗрдВрдбреЗрдХреНрд╕ рдХреЗ рд╕реНрдерд╛рди рдкрд░ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/62a/d82/b54/62ad82b54b233a37e40b964953a16bf8.svg"></div><br><br>  рдЗрд╕ рдкреГрд╖реНрда рдХреЗ рд╕реНрддрд░ 2 рддрд╛рд▓рд┐рдХрд╛ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕рднреА рд╕реВрдЪрдХрд╛рдВрдХ рдЦрдВрдбреЛрдВ рдХреЛ рджреЛ рдЦрдВрдбреЛрдВ рдХреЛ рджрд╛рдИрдВ рдУрд░ рд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рджреЛрдиреЛрдВ рд╕реНрд░реЛрдд рдЦрдВрдбреЛрдВ рдХреЗ рд╕реНрддрд░ рдкрд░ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ: рд╕реНрддрд░ 4 рдФрд░ рд╕реНрддрд░ 3: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d9/ae5/7c8/1d9ae57c8c68a0b239e5b37397a4d0f7.svg"></div><br><br>  рд╕реНрддрд░ 3 рддрд╛рд▓рд┐рдХрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдРрд╕рд╛ рд╣реА рдХрд░рддреЗ рд╣реИрдВ, рд╣рдо рдЕрднреА рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рддреАрди рдкрддреЗ рд╡рд╛рд▓реЗ рдмреНрд▓реЙрдХ рдкрд░ рдЬрд╛рддреЗ рд╣реИрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b8/6ee/c9f/4b86eec9fd1df3445718ed8246fd4473.svg"></div><br><br>  рдЕрдВрдд рдореЗрдВ, рд╕реНрддрд░ 4 рддрд╛рд▓рд┐рдХрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЪрд╛рд░ рдмреНрд▓реЙрдХреЛрдВ рдХреЛ рджрд╛рдИрдВ рдУрд░ рд▓реЗ рдЬрд╛рдПрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36b/6b0/29b/36b6b029b31578b143ff1e7605e358fb.svg"></div><br><br>  рдЕрдм рдЖрдк рд╕рднреА рдЪрд╛рд░ рд╕реНрддрд░реЛрдВ рдХреЗ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЖрднрд╛рд╕реА рдкрддреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдо рдПрдХ рдкрддреЗ рдХреА рднреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ 8 рд╕реЗ рдЧреБрдгрд╛ рдХрд░рдХреЗ, рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХрд╛ рдЖрдХрд╛рд░ред <br><br>  рдиреАрдЪреЗ рджреА рдЧрдИ рддрд╛рд▓рд┐рдХрд╛ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдлрд╝реНрд░реЗрдореЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдкрддреЗ рдХреА рд╕рдВрд░рдЪрдирд╛ рдХреЛ рджрд░реНрд╢рд╛рддреА рд╣реИ: <br><br><table><thead><tr><th>  рдХреЗ рд▓рд┐рдП рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ </th><th>  рдкрддрд╛ рд╕рдВрд░рдЪрдирд╛ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрд╖реНрдЯрд╛рдзрд╛рд░реА</a> ) </th></tr></thead><tbody><tr><td>  рдкреЗрдЬ </td><td> <code>0o_SSSSSS_AAA_BBB_CCC_DDD_EEEE</code> </td> </tr><tr><td>  рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ </td><td> <code>0o_SSSSSS_RRR_AAA_BBB_CCC_DDDD</code> </td> </tr><tr><td>  рдПрдХ рд╕реНрддрд░ 2 рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ </td><td> <code>0o_SSSSSS_RRR_RRR_AAA_BBB_CCCC</code> </td> </tr><tr><td>  рдПрдХ рд╕реНрддрд░ 3 рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ </td><td> <code>0o_SSSSSS_RRR_RRR_RRR_AAA_BBBB</code> </td> </tr><tr><td>  рд╕реНрддрд░ 4 рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ </td><td> <code>0o_SSSSSS_RRR_RRR_RRR_RRR_AAAA</code> </td> </tr></tbody></table><br>  рдпрд╣рд╛рдВ <code></code> рд╕реНрддрд░ 4 рд╕реВрдЪрдХрд╛рдВрдХ рд╣реИ, <code></code> рд╕реНрддрд░ 3 рд╣реИ, <code></code> рд╕реНрддрд░ 2 рд╣реИ, рдФрд░ <code>DDD</code> рдкреНрд░рджрд░реНрд╢рд┐рдд рдлреНрд░реЗрдо рдХреЗ рд▓рд┐рдП рд╕реНрддрд░ 1 рд╕реВрдЪрдХрд╛рдВрдХ рд╣реИ, <code>EEEE</code> рдЗрд╕рдХреА рднрд░рдкрд╛рдИ рд╣реИред  <code>RRR</code> рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░рд┐рдХреЙрд░реНрдб рдХрд╛ рд╕реВрдЪрдХрд╛рдВрдХ рд╣реИред  рдПрдХ рд╕реВрдЪрдХрд╛рдВрдХ (рддреАрди рдЕрдВрдХ) 8 (рдкреЗрдЬ рдЯреЗрдмрд▓ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЗ рдЖрдХрд╛рд░) рд╕реЗ рдЧреБрдгрд╛ рдХрд░рдХреЗ рдПрдХ рдСрдлрд╕реЗрдЯ (рдЪрд╛рд░ рдЕрдВрдХ) рдореЗрдВ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕ рдСрдлрд╕реЗрдЯ рдХреЗ рд╕рд╛рде, рдкрд░рд┐рдгрд╛рдореА рдкрддрд╛ рд╕реАрдзреЗ рд╕рдВрдмрдВрдзрд┐рдд рддрд╛рд▓рд┐рдХрд╛ рддрд╛рд▓рд┐рдХрд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред <br><br>  <code>SSSS</code> рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдЕрдВрдХ рдХреЗ рд╡рд┐рд╕реНрддрд╛рд░ рдмрд┐рдЯреНрд╕ рд╣реИрдВ, <code>SSSS</code> , рд╡реЗ рд╕рднреА рдмрд┐рдЯ 47 рдХреА рдкреНрд░рддрд┐рдпрд╛рдВ рд╣реИрдВред рдпрд╣ x86_64 рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдореЗрдВ рдорд╛рдиреНрдп рдкрддреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреА рд╣рдордиреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ</a> рдореЗрдВ рдЪрд░реНрдЪрд╛ рдХреА рдереАред <br><br>  рдкрддреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдСрдХреНрдЯрд▓ рд╣реИрдВ</a> , рдХреНрдпреЛрдВрдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдСрдХреНрдЯрд▓ рдЪрд░рд┐рддреНрд░ рддреАрди рдмрд┐рдЯреНрд╕ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЖрдкрдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реНрддрд░реЛрдВ рдкрд░ 9-рдмрд┐рдЯ рдЗрдВрдбреЗрдХреНрд╕ рдЯреЗрдмрд▓ рдХреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдпрд╣ рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ, рдЬрд╣рд╛рдВ рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рд┐рддреНрд░ рдЪрд╛рд░ рдмрд┐рдЯреНрд╕ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИред <br><br><h4>  рд░рд╕реНрдЯ рдХреЛрдб </h4><br>  рдЖрдк рдмрд┐рдЯ рдХреЛрдб рд╕рдВрдЪрд╛рд▓рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░рд╕реНрдЯ рдХреЛрдб рдореЗрдВ рдРрд╕реЗ рдкрддреЗ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// the virtual address whose corresponding page tables you want to access let addr: usize = [тАж]; let r = 0o777; // recursive index let sign = 0o177777 &lt;&lt; 48; // sign extension // retrieve the page table indices of the address that we want to translate let l4_idx = (addr &gt;&gt; 39) &amp; 0o777; // level 4 index let l3_idx = (addr &gt;&gt; 30) &amp; 0o777; // level 3 index let l2_idx = (addr &gt;&gt; 21) &amp; 0o777; // level 2 index let l1_idx = (addr &gt;&gt; 12) &amp; 0o777; // level 1 index let page_offset = addr &amp; 0o7777; // calculate the table addresses let level_4_table_addr = sign | (r &lt;&lt; 39) | (r &lt;&lt; 30) | (r &lt;&lt; 21) | (r &lt;&lt; 12); let level_3_table_addr = sign | (r &lt;&lt; 39) | (r &lt;&lt; 30) | (r &lt;&lt; 21) | (l4_idx &lt;&lt; 12); let level_2_table_addr = sign | (r &lt;&lt; 39) | (r &lt;&lt; 30) | (l4_idx &lt;&lt; 21) | (l3_idx &lt;&lt; 12); let level_1_table_addr = sign | (r &lt;&lt; 39) | (l4_idx &lt;&lt; 30) | (l3_idx &lt;&lt; 21) | (l2_idx &lt;&lt; 12);</span></span></code> </pre> <br>  рдпрд╣ рдХреЛрдб рдЗрдВрдбреЗрдХреНрд╕ <code>0o777</code> (511) рдХреЗ рд╕рд╛рде рдкрд┐рдЫрд▓реЗ рд╕реНрддрд░ 4 рд░рд┐рдХреЙрд░реНрдб рдХреЗ рдПрдХ рдкреБрдирд░рд╛рд╡рд░реНрддреА рдорд╛рдирдЪрд┐рддреНрд░рдг рдХрд╛ рдкреБрдирд░рд╛рд╡рд░реНрддреА рдорд┐рд▓рд╛рди рдХрд░рддрд╛ рд╣реИред  рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдРрд╕рд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХреЛрдб рдЕрднреА рддрдХ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред  рд▓реЛрдбрд░ рдХреЛ рдкреБрдирд░рд╛рд╡рд░реНрддреА рдореИрдкрд┐рдВрдЧ рд╕реЗрдЯ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдмрддрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рджреЗрдЦреЗрдВред <br><br>  рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдмрд┐рдЯрд╡рд╛рдЗрдЬрд╝ рдСрдкрд░реЗрд╢рди рдХрд░рдиреЗ рдХреЗ рд╡рд┐рдХрд▓реНрдк рдХреЗ рд░реВрдк рдореЗрдВ, рдЖрдк <code>x86_64</code> рдЯреЛрдХрд░рд╛ рдХреЗ <code>RecursivePageTable</code> рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рд╡рд┐рднрд┐рдиреНрди рддрд╛рд▓рд┐рдХрд╛ рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рд╛рд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХреЛрдб рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдЖрднрд╛рд╕реА рдкрддреЗ рдХреЛ рдЙрд╕рдХреЗ рд╕рдВрдмрдВрдзрд┐рдд рднреМрддрд┐рдХ рдкрддреЗ рдореЗрдВ рдХреИрд╕реЗ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП: <br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs use x86_64::structures::paging::{Mapper, Page, PageTable, RecursivePageTable}; use x86_64::{VirtAddr, PhysAddr}; /// Creates a RecursivePageTable instance from the level 4 address. let level_4_table_addr = [тАж]; let level_4_table_ptr = level_4_table_addr as *mut PageTable; let recursive_page_table = unsafe { let level_4_table = &amp;mut *level_4_table_ptr; RecursivePageTable::new(level_4_table).unwrap(); } /// Retrieve the physical address for the given virtual address let addr: u64 = [тАж] let addr = VirtAddr::new(addr); let page: Page = Page::containing_address(addr); // perform the translation let frame = recursive_page_table.translate_page(page); frame.map(|frame| frame.start_address() + u64::from(addr.page_offset()))</span></span></code> </pre> <br>  рдлрд┐рд░ рд╕реЗ, рдЗрд╕ рдХреЛрдб рдХреЛ рдПрдХ рд╕рд╣реА рдкреБрдирд░рд╛рд╡рд░реНрддреА рдорд╛рдирдЪрд┐рддреНрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕ рдореИрдкрд┐рдВрдЧ рдХреЗ рд╕рд╛рде, рдЕрдиреБрдкрд▓рдмреНрдз <code>level_4_table_addr</code> рдЧрдгрдирд╛ рдкрд╣рд▓реЗ рдХреЛрдб рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдХреА рдЬрд╛рддреА рд╣реИред <br><br><hr><br>  рд░рд┐рдХрд░реНрд╕рд┐рд╡ рдореИрдкрд┐рдВрдЧ рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рд╡рд┐рдзрд┐ рд╣реИ рдЬреЛ рдпрд╣ рдмрддрд╛рддреА рд╣реИ рдХрд┐ рдПрдХрд▓ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рддрдирд╛ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдорд┐рд▓рд╛рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдЖрд╕рд╛рди рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдиреНрдпреВрдирддрдо рд╕реЗрдЯрдЕрдк (рдХреЗрд╡рд▓ рдПрдХ рдкреБрдирд░рд╛рд╡рд░реНрддреА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдкрд╣рд▓реЗ рдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдЪреНрдЫрд╛ рд╡рд┐рдХрд▓реНрдк рд╣реИред <br><br>  рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рдХреБрдЫ рдиреБрдХрд╕рд╛рди рднреА рд╣реИрдВ: <br><br><ul><li>  рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рд╡рд░реНрдЪреБрдЕрд▓ рдореЗрдореЛрд░реА (512 GiB)ред  рдпрд╣ рдПрдХ рдмрдбрд╝реЗ 48-рдмрд┐рдЯ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рдореЗрдВ рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЙрдк-рдХреИрд╢ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдЬрдиреНрдо рджреЗ рд╕рдХрддрд╛ рд╣реИред <br></li><li>  рдпрд╣ рдЖрд╕рд╛рдиреА рд╕реЗ рдХреЗрд╡рд▓ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рд╕рдХреНрд░рд┐рдп рдкрддрд╛ рд╕реНрдерд╛рди рддрдХ рдкрд╣реБрдБрдЪ рджреЗрддрд╛ рд╣реИред  рдкреБрдирд░рд╛рд╡рд░реНрддреА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдмрджрд▓рдХрд░ рдЕрдиреНрдп рдкрддрд╛ рд╕реНрдерд╛рдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдВрднрд╡ рд╣реИ, рд▓реЗрдХрд┐рди рд╕реНрд╡рд┐рдЪрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЕрд╕реНрдерд╛рдпреА рдорд┐рд▓рд╛рди рдЖрд╡рд╢реНрдпрдХ рд╣реИред  рд╣рдордиреЗ рдкрд┐рдЫрд▓реЗ (рдЕрдкреНрд░рдЪрд▓рд┐рдд) рд▓реЗрдЦ рдореЗрдВ рдРрд╕рд╛ рдХрд░рдиреЗ рдХрд╛ рд╡рд░реНрдгрди рдХрд┐рдпрд╛ рд╣реИред <br></li><li>  рдпрд╣ x86 рдкреЗрдЬ рдЯреЗрдмрд▓ рдлреЙрд░реНрдореЗрдЯ рдкрд░ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЕрдиреНрдп рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдкрд░ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИред </li></ul><br><a name="3"></a><h1>  рдмреВрдЯрд▓реЛрдбрд░ рд╕рдорд░реНрдерди </h1><br>  рдКрдкрд░ рд╡рд░реНрдгрд┐рдд рд╕рднреА рджреГрд╖реНрдЯрд┐рдХреЛрдгреЛрдВ рдХреЛ рдкреЗрдЬ рдЯреЗрдмрд▓ рдФрд░ рд╕рдВрдмрдВрдзрд┐рдд рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рднреМрддрд┐рдХ рд╕реНрдореГрддрд┐ рдХреЛ рдкрд╣рдЪрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╛ рдЪрддреБрд░реНрде-рд╕реНрддрд░реАрдп рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд░рд┐рдХреЙрд░реНрдб рдХреЛ рдкреБрди: рдореИрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред  рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рдкреЗрдЬ рдЯреЗрдмрд▓ рддрдХ рдкрд╣реБрдБрдЪ рдХреЗ рдмрд┐рдирд╛ рдпреЗ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред <br><br>  рдЗрд╕рд▓рд┐рдП, рдореБрдЭреЗ рдмреВрдЯрд▓реЛрдбрд░ рдХреА рдорджрдж рдЪрд╛рд╣рд┐рдПред  рдЙрд╕рдХреЗ рдкрд╛рд╕ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд╣ рдХрд┐рд╕реА рднреА рдбрд┐рд╕реНрдкреНрд▓реЗ рдХреЛ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдХреА рд╣рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЕрдкрдиреЗ рд╡рд░реНрддрдорд╛рди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ, <code>bootloader</code> рдХреНрд░реЗрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд╛рд░реНрдЧреЛ рдХрд╛рд░реНрдпреЛрдВ</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрд░реЛрдХреНрдд рджреЛрдиреЛрдВ рджреГрд╖реНрдЯрд┐рдХреЛрдгреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд░рддрд╛ рд╣реИ</a> : <br><br><ul><li>  <code>map_physical_memory</code> рдлрд╝рдВрдХреНрд╢рди рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рдореЗрдВ рдкреВрд░реА рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдХреЛ рдХрд╣реАрдВ рди рдХрд╣реАрдВ рдореИрдк рдХрд░рддрд╛ рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдХрд░реНрдиреЗрд▓ рд╕рднреА рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреВрд░реНрдг рднреМрддрд┐рдХ рдореЗрдореЛрд░реА</a> рдХреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рджрд░реНрд╢рди рдХреЗ</a> рд╕рд╛рде рдПрдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддрд╛ рд╣реИред <br></li><li>  <code>recursive_page_table</code> рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд▓реЛрдбрд░ рдкреБрдирд░рд╛рд╡рд░реНрддреА рд░реВрдк рд╕реЗ рдПрдХ рдЪреМрдереЗ-рд╕реНрддрд░реАрдп рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рдХрд░реНрдиреЗрд▓ рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">"рдкреБрдирд░рд╛рд╡рд░реНрддреА рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ" рдЕрдиреБрднрд╛рдЧ</a> рдореЗрдВ рд╡рд░реНрдгрд┐рдд рд╡рд┐рдзрд┐ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реА рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП, рд╣рдо рдкрд╣рд▓рд╛ рд╡рд┐рдХрд▓реНрдк рдЪреБрдирддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ рд╕рд░рд▓, рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо-рд╕реНрд╡рддрдВрддреНрд░ рдФрд░ рдЕрдзрд┐рдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИ (рдпрд╣ рдХреЗрд╡рд▓ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рд╣реА рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдЕрдиреНрдп рдлрд╝реНрд░реЗрдореЛрдВ рдХреЛ рднреА рдПрдХреНрд╕реЗрд╕ рджреЗрддрд╛ рд╣реИ)ред </font><font style="vertical-align: inherit;">рдмреВрдЯрд▓реЛрдбрд░ рд╕реЗ рд╕рдорд░реНрдерди рдХреЗ рд▓рд┐рдП, рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЗрд╕рдХреА рдирд┐рд░реНрднрд░рддрд╛ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ </font></font><code>map_physical_memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="plaintext hljs">[dependencies] bootloader = { version = "0.4.0", features = ["map_physical_memory"]}</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ рдмреВрдЯрд▓реЛрдбрд░ рдкреВрд░реА рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдХреЛ рд╡рд░реНрдЪреБрдЕрд▓ рдкрддреЗ рдХреЗ рдХреБрдЫ рдЕрдкреНрд░рдпреБрдХреНрдд рд╢реНрд░реЗрдгреА рдореЗрдВ рдореИрдк рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП рдХрдИ рд╡рд░реНрдЪреБрдЕрд▓ рдкрддреЛрдВ рдХреЛ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдмреВрдЯрд▓реЛрдбрд░ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреВрдЯ рд╕реВрдЪрдирд╛</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреА рд╕рдВрд░рдЪрдирд╛ рд╕реЗ рдЧреБрдЬрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br><br><a name="3_1"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмреВрдЯ рдЬрд╛рдирдХрд╛рд░реА </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЛрдХрд░рд╛ </font><font style="vertical-align: inherit;">рдХрд░реНрдиреЗрд▓ рдХреЛ рдкрд╛рд░рд┐рдд рдХреА рдЧрдИ рд╕рднреА </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рд╕реВрдЪрдирд╛рдУрдВ рдХреЗ</font></a><font style="vertical-align: inherit;"> рд╕рд╛рде </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">BootInfo</font></a></font><code>bootloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреА рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдЕрднреА рднреА рдЕрдВрддрд┐рдо рд░реВрдк рджрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рднрд╡рд┐рд╖реНрдп рдХреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдкрдЧреНрд░реЗрдб рдХрд┐рдП рдЬрд╛рдиреЗ рдХреЗ рджреМрд░рд╛рди рдХреБрдЫ рд╡рд┐рдлрд▓рддрд╛рдПрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рдЬреЛ рдХрд┐ рд╕реЗрд╡рд░ рдХреЗ рд╕рд╛рде рдЕрд╕рдВрдЧрдд рд╣реИрдВ</font></a><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рдореЗрдВ, рд╕рдВрд░рдЪрдирд╛ рдХреЗ рджреЛ рдХреНрд╖реЗрддреНрд░ рд╣реИрдВ: </font><font style="vertical-align: inherit;">рдФрд░ </font><font style="vertical-align: inherit;">:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code>memory_map</code><font style="vertical-align: inherit;"></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝реАрд▓реНрдб </font></font><code>memory_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрд▓рдмреНрдз рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдХрд╛ рдЕрд╡рд▓реЛрдХрди рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдХрд░реНрдиреЗрд▓ рдХреЛ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдХрд┐рддрдиреА рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдЙрдкрд▓рдмреНрдз рд╣реИ рдФрд░ рдореЗрдореЛрд░реА рдХреЗ рдХреМрди рд╕реЗ рдХреНрд╖реЗрддреНрд░ рд╡реАрдЬреАрдП рдЬреИрд╕реЗ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдЖрд░рдХреНрд╖рд┐рдд рд╣реИрдВред </font><font style="vertical-align: inherit;">рдПрдХ рдореЗрдореЛрд░реА рдХрд╛рд░реНрдб рдХреЛ BIOS рдпрд╛ рдпреВрдИрдПрдлрдЖрдИ рдлрд░реНрдорд╡реЗрдпрд░ рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдмреВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рдХрд╛рд░рдг рд╕реЗ, рд▓реЛрдбрд░ рдХреЛ рдЗрд╕реЗ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рддрдм рдХрд░реНрдиреЗрд▓ рдЕрдм рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдмрд╛рдж рдореЗрдВ рдПрдХ рдореЗрдореЛрд░реА рдХрд╛рд░реНрдб рдХрд╛рдо рдЖрдПрдЧрд╛ред</font></font><br></li><li> <code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдореИрдкрд┐рдВрдЧ рдХреЗ рд╡рд░реНрдЪреБрдЕрд▓ рдкреНрд░рд╛рд░рдВрдн рдкрддреЗ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдСрдлрд╕реЗрдЯ рдХреЛ рднреМрддрд┐рдХ рдкрддреЗ рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдкрд░, рд╣рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рд╡рд░реНрдЪреБрдЕрд▓ рдкрддрд╛ рдорд┐рд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдХрд░реНрдиреЗрд▓ рд╕реЗ рдордирдорд╛рдиреА рднреМрддрд┐рдХ рд╕реНрдореГрддрд┐ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЛрдбрд░ </font><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП </font></font><code>BootInfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ </font><font style="vertical-align: inherit;">рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП рд╕рдВрд░рдЪрдирд╛ </font><font style="vertical-align: inherit;">рдХреЛ </font><font style="vertical-align: inherit;">рдкрд╛рд╕ </font></font><code>&amp;'static BootInfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░рддрд╛ рд╣реИ </font></font><code>_start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдЬреЛрдбрд╝реЗрдВ:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs use bootloader::BootInfo; #[cfg(not(test))] #[no_mangle] pub extern "C" fn _start(boot_info: &amp;'static BootInfo) -&gt; ! { // new argument [тАж] }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╣реА рддрд░реНрдХ рдкреНрд░рдХрд╛рд░ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХрдВрдкрд╛рдЗрд▓рд░ рд╣рдорд╛рд░реЗ рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╣реА рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдкреНрд░рдХрд╛рд░ рдХреЛ рдирд╣реАрдВ рдЬрд╛рдирддрд╛ рд╣реИред </font></font><br><br><a name="3_2"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ рдореИрдХреНрд░реЛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдлрд╝рдВрдХреНрд╢рди </font></font><code>_start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЛрдбрд░ рд╕реЗ рдмрд╛рд╣рд░реА рд░реВрдк рд╕реЗ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рдЗрд╕реЗ рд╕рдВрдХрд▓рди рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рдмрд┐рдирд╛ рдордирдорд╛рдиреА рддрд░реНрдХ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрдкрд╡рд╛рд╣рд┐рдд рд░рдирдЯрд╛рдЗрдо рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдХреНрд░реИрд╢ рдпрд╛ рдХрд╛рд░рдг рджреЗрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдмрд┐рдВрджреБ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╣рдореЗрд╢рд╛ рд╕рд╣реА рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╣реИрдВ, рдЯреЛрдХрд░рд╛ </font></font><code>bootloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдореИрдХреНрд░реЛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ </font></font><code>entry_point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╣рдо рдЗрд╕ рдореИрдХреНрд░реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрддреЗ рд╣реИрдВ:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs use bootloader::{BootInfo, entry_point}; entry_point!(kernel_main); #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [тАж] }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЖрдкрдХреЛ рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ </font></font><code>extern "C"</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╛ </font></font><code>no_mangle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЪреВрдВрдХрд┐ рдореИрдХреНрд░реЛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдирд┐рдЪрд▓реЗ рд╕реНрддрд░ рдХреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ </font></font><code>_start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдлрд╝рдВрдХреНрд╢рди </font></font><code>kernel_main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рд░рд╕реНрдЯ рдлрд╝рдВрдХреНрд╢рди рдмрди рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдордирдорд╛рдирд╛ рдирд╛рдо рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдпрд╣ рдкреНрд░рдХрд╛рд░ рджреНрд╡рд╛рд░рд╛ рдЬрд╛рдБрдЪ рдХреА рдЬрд╛рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк рдЧрд▓рдд рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рддрд░реНрдХ рдЬреЛрдбрд╝рдХрд░ рдпрд╛ рдЙрд╕рдХрд╛ рдкреНрд░рдХрд╛рд░ рдмрджрд▓рдХрд░, рдПрдХ рд╕рдВрдХрд▓рди рддреНрд░реБрдЯрд┐ рдЙрддреНрдкрдиреНрди рд╣реЛрдЧреА</font></font><br><br><a name="4"></a><h1>  рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ, рдФрд░ рд╣рдо рдЕрдВрддрддрдГ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╡рд░реНрддрдорд╛рди рд╕рдХреНрд░рд┐рдп рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ, рдЬрд┐рд╕ рдкрд░ рдХрд░реНрдиреЗрд▓ рдЪрд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рджреВрд╕рд░реЗ рдЪрд░рдг рдореЗрдВ, рдПрдХ рдЯреНрд░рд╛рдВрд╕рд▓реЗрд╢рди рдлрд╝рдВрдХреНрд╢рди рдмрдирд╛рдПрдВ рдЬреЛ рднреМрддрд┐рдХ рдкрддреЗ рдХреЛ рд▓реМрдЯрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдпрд╣ рд╡рд░реНрдЪреБрдЕрд▓ рдкрддрд╛ рдореИрдк рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдВрддрд┐рдо рдЪрд░рдг рдореЗрдВ, рд╣рдо рдирдпрд╛ рдорд╛рдирдЪрд┐рддреНрд░рдг рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдХреЛрдб рдореЗрдВ рдПрдХ рдирдпрд╛ рдореЙрдбреНрдпреВрд▓ рдмрдирд╛рдПрдВ </font></font><code>memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/lib.rs pub mod memory;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЙрдбреНрдпреВрд▓ рдХреЗ рд▓рд┐рдП, рдПрдХ рдЦрд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдВ </font></font><code>src/memory.rs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><a name="4_1"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ </font></font></h3><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЗ рдЕрдВрдд рдореЗрдВ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">,</font></a><font style="vertical-align: inherit;"> рд╣рдордиреЗ рдЙрди рдкреГрд╖реНрдареЛрдВ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдЬрд┐рди рдкрд░ рдХрд░реНрдиреЗрд▓ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд░рдЬрд┐рд╕реНрдЯрд░ рджреНрд╡рд╛рд░рд╛ рдмрддрд╛рдП рдЧрдП рднреМрддрд┐рдХ рдлреНрд░реЗрдо рддрдХ рдирд╣реАрдВ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ </font></font><code>CR3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЕрдм рд╣рдо рдЗрд╕ рдЬрдЧрд╣ рд╕реЗ рдХрд╛рдо рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ: рдлрд╝рдВрдХреНрд╢рди </font></font><code>active_level_4_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреМрдереЗ рд╕реНрддрд░ рдХреЗ рдкреГрд╖реНрдареЛрдВ рдХреА рд╕рдХреНрд░рд┐рдп рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рд▓рд┐рдВрдХ рд▓реМрдЯрд╛ рджреЗрдЧрд╛:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs use x86_64::structures::paging::PageTable; /// Returns a mutable reference to the active level 4 table. /// /// This function is unsafe because the caller must guarantee that the /// complete physical memory is mapped to virtual memory at the passed /// `physical_memory_offset`. Also, this function must be only called once /// to avoid aliasing `&amp;mut` references (which is undefined behavior). pub unsafe fn active_level_4_table(physical_memory_offset: u64) -&gt; &amp;'static mut PageTable { use x86_64::{registers::control::Cr3, VirtAddr}; let (level_4_table_frame, _) = Cr3::read(); let phys = level_4_table_frame.start_address(); let virt = VirtAddr::new(phys.as_u64() + physical_memory_offset); let page_table_ptr: *mut PageTable = virt.as_mut_ptr(); &amp;mut *page_table_ptr // unsafe }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдордиреЗ рд░рдЬрд┐рд╕реНрдЯрд░ рд╕реЗ рдЪреМрдереЗ рд╕реНрддрд░ рдХреА рд╕рдХреНрд░рд┐рдп рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рднреМрддрд┐рдХ рдлреНрд░реЗрдо рдХреЛ рдкрдврд╝рд╛ </font></font><code>CR3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдлрд┐рд░ рд╣рдо рдЗрд╕рдХрд╛ рднреМрддрд┐рдХ рдЖрд░рдВрднрд┐рдХ рдкрддрд╛ рд▓реЗрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдЬреЛрдбрд╝рдХрд░ рдЖрднрд╛рд╕реА рдкрддреЗ рдореЗрдВ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВ </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЕрдВрдд рдореЗрдВ, рдкрддреЗ рдХреЛ </font></font><code>*mut PageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рджреНрд╡рд╛рд░рд╛ </font><font style="vertical-align: inherit;">рдХрдЪреНрдЪреЗ рдкреЙрдЗрдВрдЯрд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░реЗрдВ </font></font><code>as_mut_ptr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рдЗрд╕рд╕реЗ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рд▓рд┐рдВрдХ рдмрдирд╛рдПрдВ </font></font><code>&amp;mut PageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╣рдо </font></font><code>&amp;mut</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп </font><font style="vertical-align: inherit;">рд▓рд┐рдВрдХ рдмрдирд╛рддреЗ рд╣реИрдВ </font></font><code>&amp;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдХреНрдпреЛрдВрдХрд┐ рдмрд╛рдж рдореЗрдВ рд▓реЗрдЦ рдореЗрдВ рд╣рдо рдЗрди рдкреЗрдЬ рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдмреНрд▓реЙрдХ рдбрд╛рд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд░рд╕реНрдЯ рдкреВрд░реЗ рд╢рд░реАрд░ </font></font><code>unsafe fn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рдПрдХ рдмрдбрд╝реЗ, рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдмреНрд▓реЙрдХ рдХреЗ рд░реВрдк рдореЗрдВ </font><font style="vertical-align: inherit;">рдорд╛рдирддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред рдЗрд╕рд╕реЗ рдЬреЛрдЦрд┐рдо рдмрдврд╝ рдЬрд╛рддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдкрд┐рдЫрд▓реА рд▓рд╛рдЗрдиреЛрдВ рдореЗрдВ рдЧрд▓рддреА рд╕реЗ рдПрдХ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдСрдкрд░реЗрд╢рди рд╢реБрд░реВ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдЗрд╕рд╕реЗ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдВрдЪрд╛рд▓рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рднреА рдореБрд╢реНрдХрд┐рд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">Rust рдХреЗ рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ </font><font style="vertical-align: inherit;">рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдЪреМрдереЗ рд╕реНрддрд░ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд░рд┐рдХреЙрд░реНрдб рдХреЛ рдЖрдЙрдЯрдкреБрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [тАж] // initialize GDT, IDT, PICS use blog_os::memory::active_level_4_table; let l4_table = unsafe { active_level_4_table(boot_info.physical_memory_offset) }; for (i, entry) in l4_table.iter().enumerate() { if !entry.is_unused() { println!("L4 Entry {}: {:?}", i, entry); } } println!("It did not crash!"); blog_os::hlt_loop(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд╕рдВрдмрдВрдзрд┐рдд рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЧреБрдЬрд░рддреЗ рд╣реИрдВ </font></font><code>BootInfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдлрд┐рд░ рд╣рдо </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рддрддреНрд╡ рдореЗрдВ </font><font style="vertical-align: inherit;">рдПрдХ рд╕реВрдЪрдХрд╛рдВрдХ рдЬреЛрдбрд╝рдиреЗ рдХреЗ </font></font><code>iter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд┐рдП рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдФрд░ рдПрдХ рд╕рдВрдпреЛрдЬрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреБрдирд░рд╛рд╡реГрддрд┐ рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдПрдХ рдлрд╝рдВрдХреНрд╢рди </font><font style="vertical-align: inherit;">рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ </font><font style="vertical-align: inherit;">рдХрд░рддреЗ рд╣реИрдВред рдХреЗрд╡рд▓ рдЧреИрд░-рд░рд┐рдХреНрдд рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдБ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╕рднреА 512 рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдБ рд╕реНрдХреНрд░реАрди рдкрд░ рдлрд┐рдЯ рдирд╣реАрдВ рд╣реЛрдВрдЧреАред </font><font style="vertical-align: inherit;">рдЬрдм рд╣рдо рдХреЛрдб рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдЗрд╕ рдкрд░рд┐рдгрд╛рдо рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ: </font><font style="vertical-align: inherit;">рд╣рдо рдХрдИ рдЧреИрд░-рдЦрд╛рд▓реА рд░рд┐рдХреЙрд░реНрдб рджреЗрдЦрддреЗ рд╣реИрдВ рдЬреЛ рд╡рд┐рднрд┐рдиреНрди рддреГрддреАрдп-рд╕реНрддрд░реАрдп рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдореЗрдВ рдореИрдк рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рдХрдИ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХрд░реНрдиреЗрд▓ рдХреЛрдб, рдХрд░реНрдиреЗрд▓ рд╕реНрдЯреИрдХ, рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдЕрдиреБрд╡рд╛рдж рдФрд░ рдмреВрдЯ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рддреАрд╕рд░реЗ рд╕реНрддрд░ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдлрд┐рд░ рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдлреНрд░реЗрдо рдХреЛ рдЖрднрд╛рд╕реА рдкрддреЗ рдореЗрдВ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ:</font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">enumerate</a></code><font style="vertical-align: inherit;"></font><code>i</code><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a33/def/50d/a33def50db528880395b665882aabe75.png"><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in the for loop in src/main.rs use x86_64::{structures::paging::PageTable, VirtAddr}; if !entry.is_unused() { println!("L4 Entry {}: {:?}", i, entry); // get the physical address from the entry and convert it let phys = entry.frame().unwrap().start_address(); let virt = phys.as_u64() + boot_info.physical_memory_offset; let ptr = VirtAddr::new(virt).as_mut_ptr(); let l3_table: &amp;PageTable = unsafe { &amp;*ptr }; // print non-empty entries of the level 3 table for (i, entry) in l3_table.iter().enumerate() { if !entry.is_unused() { println!(" L3 Entry {}: {:?}", i, entry); } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреВрд╕рд░реЗ рдФрд░ рдкрд╣рд▓реЗ рд╕реНрддрд░реЛрдВ рдХреА рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдХреНрд░рдорд╢рдГ рддреАрд╕рд░реЗ рдФрд░ рджреВрд╕рд░реЗ рд╕реНрддрд░ рдХреЗ рд░рд┐рдХреЙрд░реНрдб рдХреЗ рд▓рд┐рдП, рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рджреЛрд╣рд░рд╛рдПрдВред </font><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдХрд▓реНрдкрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХреЛрдб рдХреА рдорд╛рддреНрд░рд╛ рдмрд╣реБрдд рддреЗрдЬрд╝реА рд╕реЗ рдмрдврд╝ рд░рд╣реА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдкреВрд░реА рд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рдкреНрд░рдХрд╛рд╢рд┐рдд рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЯреНрд░реИрд╡рд░реНрд╕рд┐рдВрдЧ рдЯреЗрдмрд▓ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреИрд╕реЗ рдкрддреЗ рдХрд╛ рдЕрдиреБрд╡рд╛рдж рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЖрдорддреМрд░ рдкрд░ рд╣рдо рдХреЗрд╡рд▓ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд░реНрдЪреБрдЕрд▓ рдкрддреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рднреМрддрд┐рдХ рдкрддрд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЪрд▓рд┐рдП рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдмрдирд╛рддреЗ рд╣реИрдВред</font></font><br><br><a name="4_2"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрддрд╛ рдЕрдиреБрд╡рд╛рдж </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ рдХреЛ рдлрд┐рдЬрд┐рдХрд▓ рдПрдбреНрд░реЗрд╕ рдореЗрдВ рдЯреНрд░рд╛рдВрд╕рд▓реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдореИрдк рдХрд┐рдП рдЧрдП рдлреНрд░реЗрдо рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рддрдХ рдЪрд╛рд░-рд╕реНрддрд░реАрдп рдкреЗрдЬ рдЯреЗрдмрд▓ рд╕реЗ рдЧреБрдЬрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдмрдирд╛рдПрдВ рдЬреЛ рдЗрд╕ рдкрддреЗ рдХрд╛ рдЕрдиреБрд╡рд╛рдж рдХрд░рддрд╛ рд╣реИ:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs use x86_64::{PhysAddr, VirtAddr}; /// Translates the given virtual address to the mapped physical address, or /// `None` if the address is not mapped. /// /// This function is unsafe because the caller must guarantee that the /// complete physical memory is mapped to virtual memory at the passed /// `physical_memory_offset`. pub unsafe fn translate_addr(addr: VirtAddr, physical_memory_offset: u64) -&gt; Option&lt;PhysAddr&gt; { translate_addr_inner(addr, physical_memory_offset) }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо </font></font><code>translate_addr_inner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдХреЛрдб рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рди </font><font style="vertical-align: inherit;">рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрд▓реНрд▓реЗрдЦ рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрдВрдЧ рдкреВрд░реЗ рд╢рд░реАрд░ </font></font><code>unsafe fn</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рдПрдХ рдмрдбрд╝реЗ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдмреНрд▓реЙрдХ рдХреЗ рд░реВрдк рдореЗрдВ </font><font style="vertical-align: inherit;">рдорд╛рдирддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдХреЗ, рд╣рдо рдлрд┐рд░ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдСрдкрд░реЗрд╢рди рдХреЛ рд╕реНрдкрд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>unsafe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЖрдВрддрд░рд┐рдХ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИ:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs /// Private function that is called by `translate_addr`. /// /// This function is safe to limit the scope of `unsafe` because Rust treats /// the whole body of unsafe functions as an unsafe block. This function must /// only be reachable through `unsafe fn` from outside of this module. fn translate_addr_inner(addr: VirtAddr, physical_memory_offset: u64) -&gt; Option&lt;PhysAddr&gt; { use x86_64::structures::paging::page_table::FrameError; use x86_64::registers::control::Cr3; // read the active level 4 frame from the CR3 register let (level_4_table_frame, _) = Cr3::read(); let table_indexes = [ addr.p4_index(), addr.p3_index(), addr.p2_index(), addr.p1_index() ]; let mut frame = level_4_table_frame; // traverse the multi-level page table for &amp;index in &amp;table_indexes { // convert the frame into a page table reference let virt = frame.start_address().as_u64() + physical_memory_offset; let table_ptr: *const PageTable = VirtAddr::new(virt).as_ptr(); let table = unsafe {&amp;*table_ptr}; // read the page table entry and update `frame` let entry = &amp;table[index]; frame = match entry.frame() { Ok(frame) =&gt; frame, Err(FrameError::FrameNotPresent) =&gt; return None, Err(FrameError::HugeFrame) =&gt; panic!("huge pages not supported"), }; } // calculate the physical address by adding the page offset Some(frame.start_address() + u64::from(addr.page_offset())) }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, </font></font><code>active_level_4_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдордиреЗ рд░рдЬрд┐рд╕реНрдЯрд░ рд╕реЗ рдЪреМрдереЗ рд╕реНрддрд░ рдХреЗ рдлреНрд░реЗрдо рдХреЛ рдлрд┐рд░ рд╕реЗ рдкрдврд╝рд╛ </font></font><code>CR3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ рд╕рд░рд▓ рдХрд░рддрд╛ рд╣реИред рдЪрд┐рдВрддрд╛ рди рдХрд░реЗрдВ, рд╣рдо рдЬрд▓реНрдж рд╣реА рд╕рдорд╛рдзрд╛рди рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░реЗрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрд░рдЪрдирд╛ </font></font><code>VirtAddr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЪрд╛рд░ рд╕реНрддрд░реЛрдВ рдХреЗ рдкреГрд╖реНрдареЛрдВ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЕрдиреБрдХреНрд░рдорд┐рдд рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рддрд░реАрдХреЗ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред рд╣рдо рдЗрди рдЕрдиреБрдХреНрд░рдореЛрдВ рдХреЛ рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рд╕рд░рдгреА рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЖрдкрдХреЛ рд╕рднреА рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реВрдк рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд▓реВрдк рдХреЗ рдмрд╛рд╣рд░, рд╣рдореЗрдВ рдпрд╛рдж рд╣реИ рдХрд┐ рдЖрдЦрд┐рд░реА рдлреНрд░реЗрдо рдмрд╛рдж рдореЗрдВ рднреМрддрд┐рдХ рдкрддреЗ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреМрд░рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font></font><code>frame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреГрд╖реНрда рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреЗ рджреМрд░рд╛рди рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдлрд╝реНрд░реЗрдореЛрдВ рдФрд░ рдЕрдВрддрд┐рдо рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреЗ рдмрд╛рдж рд╕рдВрдмрджреНрдз рдлрд╝реНрд░реЗрдо рдкрд░, рдЬреЛ рдХрд┐ рд╕реНрддрд░ 1 рд░рд┐рдХреЙрд░реНрдб рдХреЛ рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реВрдк рдХреЗ рдЕрдВрджрд░, рд╣рдо рдлрд┐рд░ рд╕реЗ рдЖрд╡реЗрджрди рдХрд░рддреЗ рд╣реИрдВред</font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝реНрд░реЗрдо рдХреЛ рдкреЗрдЬ рдЯреЗрдмрд▓ рд▓рд┐рдВрдХ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдПред рдлрд┐рд░ рд╣рдо рд╡рд░реНрддрдорд╛рди рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рд░рд┐рдХреЙрд░реНрдб рдкрдврд╝рддреЗ рд╣реИрдВ рдФрд░ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>PageTableEntry::frame</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд┐рд▓рд╛рди рдХрд┐рдП рдЧрдП рдлреНрд░реЗрдо рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рди </font><font style="vertical-align: inherit;">рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред рдпрджрд┐ рд░рд┐рдХреЙрд░реНрдб рдлрд╝реНрд░реЗрдо рдореЗрдВ рдореИрдк рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рд╡рд╛рдкрд╕ рд▓реМрдЯреЗрдВ </font></font><code>None</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдпрджрд┐ рд░рд┐рдХреЙрд░реНрдб 2 MiB рдпрд╛ 1 GiB рдХреЗ рд╡рд┐рд╢рд╛рд▓ рдкреГрд╖реНрда рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЕрдм рддрдХ рд╣рдореЗрдВ рдШрдмрд░рд╛рд╣рдЯ рд╣реЛрдЧреАред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреЛ, рдХреБрдЫ рдкрддреЗ рдкрд░ рдЕрдиреБрд╡рд╛рдж рд╕рдорд╛рд░реЛрд╣ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [тАж] // initialize GDT, IDT, PICS use blog_os::memory::translate_addr; use x86_64::VirtAddr; let addresses = [ // the identity-mapped vga buffer page 0xb8000, // some code page 0x20010a, // some stack page 0x57ac_001f_fe48, // virtual address mapped to physical address 0 boot_info.physical_memory_offset, ]; for &amp;address in &amp;addresses { let virt = VirtAddr::new(address); let phys = unsafe { translate_addr(virt, boot_info.physical_memory_offset) }; println!("{:?} -&gt; {:?}", virt, phys); } println!("It did not crash!"); blog_os::hlt_loop(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рд╣рдо рдХреЛрдб рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдирд┐рдореНрди рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓рддреЗ рд╣реИрдВ: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a0b/e32/db8/a0be32db8b6353452f9d40d7b1d350ad.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдЕрдкреЗрдХреНрд╖рд┐рдд рдерд╛, рдПрдХ рд╕рдорд╛рди рдорд╛рдирдЪрд┐рддреНрд░рдг рдХреЗ рд╕рд╛рде, рдкрддрд╛ </font></font><code>0xb8000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕реА рднреМрддрд┐рдХ рдкрддреЗ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХреЛрдб рдкреГрд╖реНрда рдФрд░ рд╕реНрдЯреИрдХ рдкреГрд╖реНрда рдХреЛ рдордирдорд╛рдиреЗ рдврдВрдЧ рд╕реЗ рднреМрддрд┐рдХ рдкрддреЗ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЗрд╕ рдмрд╛рдд рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд▓реЛрдбрд░ рдиреЗ рд╣рдорд╛рд░реА рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдореИрдкрд┐рдВрдЧ рдХреИрд╕реЗ рдмрдирд╛рдИред </font><font style="vertical-align: inherit;">рдореИрдкрд┐рдВрдЧ </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рднреМрддрд┐рдХ рдкрддреЗ рдкрд░ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП </font></font><code>0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рд╡рд┐рдлрд▓ рд░рд╣рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЕрдиреБрд╡рд╛рдж рджрдХреНрд╖рддрд╛ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢рд╛рд▓ рдкреГрд╖реНрдареЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдмреВрдЯрд▓реЛрдбрд░ рдХрд╛ рднрд╛рд╡реА рд╕рдВрд╕реНрдХрд░рдг рдХрд░реНрдиреЗрд▓ рдФрд░ рд╕реНрдЯреИрдХ рдкреГрд╖реНрдареЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реА рдЕрдиреБрдХреВрд▓рди рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддрд╛ рд╣реИред</font></font><br><br><a name="4_3"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MappedPageTable рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднреМрддрд┐рдХ рдкрддреЛрдВ рдореЗрдВ рдЖрднрд╛рд╕реА рдкрддреЛрдВ рдХрд╛ рдЕрдиреБрд╡рд╛рдж OS рдХрд░реНрдиреЗрд▓ рдХрд╛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдп рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЯреЛрдХрд░рд╛ рдЗрд╕рдХреЗ </font></font><code>x86_64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд┐рдП рдПрдХ рдЕрдореВрд░реНрддрддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╡рд┐рд╢рд╛рд▓ рдкреГрд╖реНрдареЛрдВ рдФрд░ рдХрдИ рдЕрдиреНрдп рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ </font></font><code>translate_addr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП рдмрдбрд╝реЗ рдкреГрд╖реНрдареЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдореВрд░реНрддрддрд╛ рдХрд╛ рдЖрдзрд╛рд░ рджреЛ рд▓рдХреНрд╖рдг рд╣реИрдВ рдЬреЛ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдЕрдиреБрд╡рд╛рдж рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рдХреНрд╖рдг </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>Mapper</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреГрд╖реНрдареЛрдВ рдкрд░ рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХрд╛рд░реНрдп рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>translate_page</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рдЙрд╕реА рдЖрдХрд╛рд░ рдХреЗ рдлреНрд░реЗрдо рдореЗрдВ рдЕрдиреБрд╡рд╛рдж рдХрд░рдиреЗ </font><font style="vertical-align: inherit;">рдХреЗ рд▓рд┐рдП, </font><font style="vertical-align: inherit;">рд╕рд╛рде рд╣реА </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>map_to</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдПрдХ рдирдпрд╛ рдорд╛рдирдЪрд┐рддреНрд░рдг рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдПред</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖рддрд╛ рдХрд╛ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>MapperAllSizes</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рддреНрдкрд░реНрдп </font></font><code>Mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рдкреГрд╖реНрда рдЖрдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЖрд╡реЗрджрди рд╕реЗ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдРрд╕реЗ рдлрд╝рдВрдХреНрд╢рдВрд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╡рд┐рднрд┐рдиреНрди рдЖрдХрд╛рд░реЛрдВ рдХреЗ рдкреГрд╖реНрдареЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>translate_addr</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╛ рд╕рд╛рдорд╛рдиреНрдп рднреА рд╢рд╛рдорд┐рд▓ рд╣реИ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>translate</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рдХреНрд╖рдг рдХреЗрд╡рд▓ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреЛрдИ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдм рдЯреЛрдХрд░рд╛ </font></font><code>x86_64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдкреНрд░рдХрд╛рд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд▓рдХреНрд╖рдг рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>MappedPageTable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>RecursivePageTable</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдкреНрд░рддреНрдпреЗрдХ рдлреНрд░реЗрдо рдХрд╣реАрдВ рдкрд░ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдСрдлрд╝рд╕реЗрдЯ рдХреЗ рд╕рд╛рде)ред </font><font style="vertical-align: inherit;">рджреВрд╕рд░реЗ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рдЪреМрдереЗ рд╕реНрддрд░ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдкреБрди: рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕рднреА рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдореИрдк рдХреА рдЧрдИ рд╣реИрдВ </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП рдЖрдк рдореИрдкреНрдбрдкреЗрдЬреЗрдЬ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдЖрд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЙрдбреНрдпреВрд▓ рдореЗрдВ </font><font style="vertical-align: inherit;">рдПрдХ рдирдпрд╛ рдлрд╝рдВрдХреНрд╢рди рдмрдирд╛рдПрдВ </font></font><code>memory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> x86_64::structures::paging::{PhysFrame, MapperAllSizes, MappedPageTable}; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> x86_64::PhysAddr; <span class="hljs-comment"><span class="hljs-comment">/// Initialize a new MappedPageTable. /// /// This function is unsafe because the caller must guarantee that the /// complete physical memory is mapped to virtual memory at the passed /// `physical_memory_offset`. Also, this function must be only called once /// to avoid aliasing `&amp;mut` references (which is undefined behavior). pub unsafe fn init(physical_memory_offset: u64) -&gt; impl MapperAllSizes { let level_4_table = active_level_4_table(physical_memory_offset); let phys_to_virt = move |frame: PhysFrame| -&gt; *mut PageTable { let phys = frame.start_address().as_u64(); let virt = VirtAddr::new(phys + physical_memory_offset); virt.as_mut_ptr() }; MappedPageTable::new(level_4_table, phys_to_virt) } // make private unsafe fn active_level_4_table(physical_memory_offset: u64) -&gt; &amp;'static mut PageTable {тАж}</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рд╕реАрдзреЗ </font></font><code>MappedPageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рд╕реЗ </font><font style="vertical-align: inherit;">рдирд╣реАрдВ рд▓реМрдЯ рд╕рдХрддреЗ </font><font style="vertical-align: inherit;">рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ рдХреНрд▓реЛрдЬрд░ рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рд╣реИред рд╣рдо рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдПрдХ рд╕рд┐рдВрдЯреИрдХреНрд╕ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>impl Trait</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд▓рд╛рдн рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк </font></font><code>RecursivePageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЛ рдмрджрд▓реЗ рдмрд┐рдирд╛ </font><font style="vertical-align: inherit;">рдХрд░реНрдиреЗрд▓ рдХреЛ рд╕реНрд╡рд┐рдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>MappedPageTable::new</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдорд╛рдкрджрдВрдбреЛрдВ рдХреА рдЙрдореНрдореАрдж </font><font style="vertical-align: inherit;">рдХрд░рддрд╛ </font><font style="vertical-align: inherit;">рд╣реИ: рд╕реНрддрд░ 4 рдХреЗ рдкреЗрдЬ рдЯреЗрдмрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрд░рд╕реНрдкрд░ рд▓рд┐рдВрдХ рдФрд░ рдПрдХ рдмрдВрдж </font></font><code>phys_to_virt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреЛ рдкреЗрдЬ рдлреНрд░реЗрдо рдкреЙрдЗрдВрдЯрд░ рдореЗрдВ рднреМрддрд┐рдХ рдлреНрд░реЗрдо рдХреЛ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИ </font></font><code>*mut PageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдкрд╣рд▓реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд▓рд┐рдП, рд╣рдо рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>active_level_4_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рджреВрд╕рд░реЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рдХреНрд▓реЛрдЬрд░ рдмрдирд╛рддреЗ </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрдВ рдЬреЛ рд░реВрдкрд╛рдВрддрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ </font><font style="vertical-align: inherit;">рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдПрдХ </font></font><code>active_level_4_table</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдЬреА рд╕рдорд╛рд░реЛрд╣ </font><font style="vertical-align: inherit;">рднреА рдмрдирд╛рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">, рдХреНрдпреЛрдВрдХрд┐ рдЕрдм рд╕реЗ рдЗрд╕реЗ рдХреЗрд╡рд▓ рдХрд╣рд╛ рдЬрд╛рдПрдЧрд╛ </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП</font></font><code>MapperAllSizes::translate_addr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдХрд╛рд░реНрдп рдХреЗ рдмрдЬрд╛рдп </font></font><code>memory::translate_addr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдХреБрдЫ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>kernel_main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [тАж] // initialize GDT, IDT, PICS // new: different imports use blog_os::memory; use x86_64::{structures::paging::MapperAllSizes, VirtAddr}; // new: initialize a mapper let mapper = unsafe { memory::init(boot_info.physical_memory_offset) }; let addresses = [тАж]; // same as before for &amp;address in &amp;addresses { let virt = VirtAddr::new(address); // new: use the `mapper.translate_addr` method let phys = mapper.translate_addr(virt); println!("{:?} -&gt; {:?}", virt, phys); } println!("It did not crash!"); blog_os::hlt_loop(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдкрд╣рд▓реЗ рдЬреИрд╕реЗ рд╣реА рдЕрдиреБрд╡рд╛рдж рдкрд░рд┐рдгрд╛рдо рджреЗрдЦрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдм рдХреЗрд╡рд▓ рд╡рд┐рд╢рд╛рд▓ рдкреГрд╖реНрда рднреА рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/51d/5ed/d9c/51d5edd9c004e1238b321dee51fdf8b3.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдЕрдкреЗрдХреНрд╖рд┐рдд рдерд╛, рдЖрднрд╛рд╕реА рдкрддреЗ рдХреЛ </font></font><code>physical_memory_offset</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднреМрддрд┐рдХ рдкрддреЗ рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>0x0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд╡рд╛рдж рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП </font></font><code>MappedPageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд╣рдо рд╡рд┐рд╢рд╛рд▓ рдкреГрд╖реНрдареЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрдиреНрдп рдкреГрд╖реНрда рдХрд╛рд░реНрдпреЛрдВ рддрдХ рднреА рдкрд╣реБрдВрдЪ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ </font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЕрдЧрд▓реЗ рднрд╛рдЧ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕реНрддрд░ рдкрд░, рд╣рдореЗрдВ рдЕрдм рдлрд╝рдВрдХреНрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ </font></font><code>memory::translate_addr</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЖрдк рдЪрд╛рд╣реЗрдВ рддреЛ рдЗрд╕реЗ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><a name="4_4"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рдирдИ рдореИрдкрд┐рдВрдЧ рдмрдирд╛рдПрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рддрдХ, рд╣рдордиреЗ рдХреЗрд╡рд▓ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рджреЗрдЦрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХреБрдЫ рднреА рдирд╣реАрдВ рдмрджрд▓рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рди рдХрд┐рдП рдЧрдП рдкреГрд╖реНрда рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рдорд╛рдирдЪрд┐рддреНрд░рдг рдмрдирд╛рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>map_to</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖рддрд╛ рд╕реЗ </font><font style="vertical-align: inherit;">рдХрд░реЗрдВрдЧреЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>Mapper</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП рдкрд╣рд▓реЗ рд╣рдо рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдкреНрд░рд▓реЗрдЦрди рдХрд╣рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЪрд╛рд░ рддрд░реНрдХ рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВ: рд╡рд╣ рдкреГрд╖реНрда рдЬрд┐рд╕реЗ рд╣рдо рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ; </font><font style="vertical-align: inherit;">рдЬрд┐рд╕ рдлрд╝реНрд░реЗрдо рдХреЛ рдкреГрд╖реНрда рдореИрдк рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдФрд░ рдлреНрд░реЗрдо рд╡рд┐рддрд░рдХ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЭрдВрдбреЗ рдХрд╛ рд╕реЗрдЯ </font></font><code>frame_allocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдПрдХ рдлреНрд░реЗрдо рдПрд▓реЛрдХреЗрдЯрд░ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рдореИрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдмреИрдХрдЕрдк рд╕реНрдЯреЛрд░реЗрдЬ рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдкреНрд░рдпреБрдХреНрдд рдлрд╝реНрд░реЗрдо рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдорд╛рд░реЛрд╣ </font></font><code>create_example_mapping</code> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдкрд╣рд▓рд╛ рдХрджрдо рдПрдХ рдирдпрд╛ рдлрд╝рдВрдХреНрд╢рди рдмрдирд╛рдирд╛ рд╣реИ </font></font><code>create_example_mapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреЛ рдЗрд╕ рдкреГрд╖реНрда рдХреЛ </font></font><code>0xb8000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реАрдЬреАрдП рдЯреЗрдХреНрд╕реНрдЯ рдмрдлрд░ </font><font style="vertical-align: inherit;">рдХреЗ </font><font style="vertical-align: inherit;">рднреМрддрд┐рдХ рдлреНрд░реЗрдо рдореЗрдВ </font><font style="vertical-align: inherit;">рдореИрдк </font><font style="vertical-align: inherit;">рдХрд░рддрд╛ </font><font style="vertical-align: inherit;">рд╣реИ </font><font style="vertical-align: inherit;">ред рд╣рдо рдЗрд╕ рдлреНрд░реЗрдо рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЖрд╕рд╛рди рдмрдирд╛рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдбрд┐рд╕реНрдкреНрд▓реЗ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдмрдирд╛рдИ рдЧрдИ рдереА: рд╣рдореЗрдВ рдмрд╕ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдкреЗрдЬ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рд╕реНрдХреНрд░реАрди рдкрд░ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди </font></font><code>create_example_mapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs use x86_64::structures::paging::{Page, Size4KiB, Mapper, FrameAllocator}; /// Creates an example mapping for the given page to frame `0xb8000`. pub fn create_example_mapping( page: Page, mapper: &amp;mut impl Mapper&lt;Size4KiB&gt;, frame_allocator: &amp;mut impl FrameAllocator&lt;Size4KiB&gt;, ) { use x86_64::structures::paging::PageTableFlags as Flags; let frame = PhysFrame::containing_address(PhysAddr::new(0xb8000)); let flags = Flags::PRESENT | Flags::WRITABLE; let map_to_result = unsafe { mapper.map_to(page, frame, flags, frame_allocator) }; map_to_result.expect("map_to failed").flush(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреЗрдЬ рдХреЗ рдЕрд▓рд╛рд╡рд╛ </font></font><code>page</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИ рдХрд┐ рдЖрдк рд╕рдВрдмрджреНрдз рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рд╕рдорд╛рд░реЛрд╣ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреА рдЙрдореНрдореАрдж рд╣реИ </font></font><code>mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>frame_allocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдкреНрд░рдХрд╛рд░ </font></font><code>mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ </font></font><code>Mapper&lt;Size4KiB&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИ рдЬреЛ рд╡рд┐рдзрд┐ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ </font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЖрдо рдкреИрд░рд╛рдореАрдЯрд░ </font></font><code>Size4KiB</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╡рд┐рд╢реЗрд╖рддрд╛ </font></font><code>Mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдо</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рд▓рд┐рдП </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">PageSize</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рдирдХ 4 KiB рдкреГрд╖реНрдареЛрдВ рдХреЗ рд╕рд╛рде рдФрд░ рднрд╛рд░реА рдкреГрд╖реНрдареЛрдВ 2 рдФрд░ MiB 1 GiB рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛,ред рд╣рдо рдХреЗрд╡рд▓ 4 KiB рдкреЗрдЬ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо </font></font><code>Mapper&lt;Size4KiB&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрдЬрд╛рдп </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>MapperAllSizes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП, рдзреНрд╡рдЬ рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВ </font></font><code>PRESENT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рднреА рдорд╛рдиреНрдп рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдФрд░ рдзреНрд╡рдЬ </font></font><code>WRITABLE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреГрд╖реНрда рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдПред рдХреЙрд▓</font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реБрд░рдХреНрд╖рд┐рдд: рдЖрдк рдЕрдорд╛рдиреНрдп рддрд░реНрдХреЛрдВ рдХреЗ рд╕рд╛рде рд╕реНрдореГрддрд┐ рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛ рдЙрд▓реНрд▓рдВрдШрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ рдмреНрд▓реЙрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ </font></font><code>unsafe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╕рднреА рд╕рдВрднрд╛рд╡рд┐рдд рдЭрдВрдбреЛрдВ рдХреА рд╕реВрдЪреА рдХреЗ рд▓рд┐рдП, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛ "рдкреЗрдЬ рдЯреЗрдмрд▓ рдкреНрд░рд╛рд░реВрдк" рдЕрдиреБрднрд╛рдЧ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рджреЗрдЦреЗрдВ</font></a><font style="vertical-align: inherit;"> ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди </font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдлрд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╡рд╛рдкрд╕ рдЖ рдЬрд╛рддрд╛ рд╣реИ </font></font><code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Result</a></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдпрд╣ рдХреЗрд╡рд▓ рдХреЛрдб рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ рдЬреЛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд╣рдо рдмрд╕ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>expect</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рддреНрд░реБрдЯрд┐ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдШрдмрд░рд╛рд╣рдЯ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдлрд╝рдВрдХреНрд╢рди рдПрдХ рдкреНрд░рдХрд╛рд░ рджреЗрддрд╛ рд╣реИ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>MapperFlush</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреЛ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧрддрд┐рд╢реАрд▓ рдЕрдиреБрд╡рд╛рдж рдмрдлрд░ (рдЯреАрдПрд▓рдмреА) рд╕реЗ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдкреГрд╖реНрда рдХреЛ рд╕рд╛рдлрд╝ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>flush</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬреИрд╕реЗ </font></font><code>Result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдпрд╣ рдкреНрд░рдХрд╛рд░ [ </font></font><code>#[must_use]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] </font><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖рддрд╛ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ </font><font style="vertical-align: inherit;">рд╣реИ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреЗрддрд╛рд╡рдиреА рдЬрд╛рд░реА рдХрд░рдирд╛ рдЕрдЧрд░ рд╣рдо рдЧрд▓рддреА рд╕реЗ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рднреВрд▓ рдЬрд╛рддреЗ рд╣реИрдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛рд▓реНрдкрдирд┐рдХ </font></font><code>FrameAllocator</code> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font></font><code>create_example_mapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ </font></font><code>FrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдПрдХ рдирдпрд╛ рдкреНрд░рджрд░реНрд╢рди рдмрдирд╛рдиреЗ рдХреА рдЬрдЯрд┐рд▓рддрд╛ рдЙрд╕ рдЖрднрд╛рд╕реА рдкреГрд╖реНрда рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИ рдЬрд┐рд╕реЗ рд╣рдо рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рд╕рд░рд▓ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкреГрд╖реНрда рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдореМрдЬреВрдж рд╣реИ, рдФрд░ рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рд░рд┐рдХреЙрд░реНрдб рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдХрдард┐рди рдорд╛рдорд▓реЗ рдореЗрдВ, рдкреГрд╖реНрда рдПрдХ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╣реИ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рд╕реНрддрд░ 3 рдЕрднреА рддрдХ рдирд╣реАрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рд╕реНрддрд░ 3, 2 рдФрд░ 1. рдХреЗ рдкреЗрдЬ рдЯреЗрдмрд▓ рдмрдирд╛рдиреЗ рд╣реЛрдВрдЧреЗред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдХреЗрд╕ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВ рдФрд░ рдорд╛рди рд▓реЗрдВ рдХрд┐ рдЖрдкрдХреЛ рдирдпрд╛ рдкреЗрдЬ рдЯреЗрдмрд▓ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рдлреНрд░реЗрдо рд╡рд┐рддрд░рдХ рдЬреЛ рд╣рдореЗрд╢рд╛ рд░рд┐рдЯрд░реНрди рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ </font></font><code>None</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо </font></font><code>EmptyFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЗрд╕ рддрд░рд╣ рдХреЗ рдПрдХ </font><font style="vertical-align: inherit;">рдкреНрд░рджрд░реНрд╢рди рд╕рдорд╛рд░реЛрд╣ </font><font style="vertical-align: inherit;">рдмрдирд╛рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs /// A FrameAllocator that always returns `None`. pub struct EmptyFrameAllocator; impl FrameAllocator&lt;Size4KiB&gt; for EmptyFrameAllocator { fn allocate_frame(&amp;mut self) -&gt; Option&lt;PhysFrame&gt; { None } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЖрдкрдХреЛ рдПрдХ рдкреГрд╖реНрда рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рдирдП рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рдмрдирд╛рдП рдмрд┐рдирд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд▓реЛрдбрд░ рдХреЛ рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреНрд░реЗрд╕ рд╕реНрдкреЗрд╕ рдХреЗ рдкрд╣рд▓реЗ рдореЗрдЧрд╛рдмрд╛рдЗрдЯ рдореЗрдВ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕ рдХреНрд╖реЗрддреНрд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдорд╛рдиреНрдп рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рд╣реИред рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрд╕ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдХрд┐рд╕реА рднреА рдЕрдкреНрд░рдпреБрдХреНрдд рдкреГрд╖реНрда рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкрддреЗ рдкрд░ рдкреЗрдЬ </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдкрд╣рд▓реЗ рдкреГрд╖реНрда </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдореЗрдореЛрд░реА рдХреА рд╕рд╛рдордЧреНрд░реА рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреЗ рд╣реИрдВ:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [тАж] // initialize GDT, IDT, PICS use blog_os::memory; use x86_64::{structures::paging::Page, VirtAddr}; let mut mapper = unsafe { memory::init(boot_info.physical_memory_offset) }; let mut frame_allocator = memory::EmptyFrameAllocator; // map a previously unmapped page let page = Page::containing_address(VirtAddr::new(0x1000)); memory::create_example_mapping(page, &amp;mut mapper, &amp;mut frame_allocator); // write the string `New!` to the screen through the new mapping let page_ptr: *mut u64 = page.start_address().as_mut_ptr(); unsafe { page_ptr.offset(400).write_volatile(0x_f021_f077_f065_f04e)}; println!("It did not crash!"); blog_os::hlt_loop(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдкреЗрдЬ рдХреЗ рд▓рд┐рдП рдПрдХ рдореИрдкрд┐рдВрдЧ рдмрдирд╛рддреЗ рд╣реИрдВ </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬреЛ рдПрдХ рдлрд╝рдВрдХреНрд╢рди </font></font><code>create_example_mapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрд░рд╕реНрдкрд░ рд▓рд┐рдВрдХ рдХреЗ рд╕рд╛рде </font><font style="vertical-align: inherit;">рдмреБрд▓рд╛рддрд╛ рд╣реИ </font></font><code>mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>frame_allocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдпрд╣ рдкреГрд╖реНрда </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рд╡реАрдЬреАрдП рдЯреЗрдХреНрд╕реНрдЯ рдмрдлрд░ рдлреНрд░реЗрдо рдореЗрдВ </font><font style="vertical-align: inherit;">рдореИрдк рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдпрд╣ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рд╕реНрдХреНрд░реАрди рдкрд░ рд╡рд╣рд╛рдВ рдХреНрдпрд╛ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд░ рдкреГрд╖реНрда рдХреЛ рдХрдЪреНрдЪреЗ рд╕реВрдЪрдХ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░реЗрдВ рдФрд░ рдСрдлрд╝рд╕реЗрдЯ рдХреЛ рдорд╛рди рд▓рд┐рдЦреЗрдВ </font></font><code>400</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╣рдо рдкреГрд╖реНрда рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдирд╣реАрдВ рд▓рд┐рдЦрддреЗ рдХреНрдпреЛрдВрдХрд┐ рд╡реАрдЬреАрдП рдмрдлрд░ рдХреА рд╢реАрд░реНрд╖ рдкрдВрдХреНрддрд┐ рд╕реАрдзреЗ рд╕реНрдХреНрд░реАрди рд╕реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ </font></font><code>println</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдорд╛рди рд▓рд┐рдЦреЗрдВ рдЬреЛ </font></font><code>0x_f021_f077_f065_f04e</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдЯреНрд░рд┐рдВрдЧ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"рдирдпрд╛!" рд╕реЗ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрд▓ рдЦрд╛рддреА рд╣реИ </font><font style="vertical-align: inherit;">рдПрдХ рд╕рдлреЗрдж рдкреГрд╖реНрдарднреВрдорд┐ рдкрд░ред рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рд▓реЗрдЦ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"рд╡реАрдЬреАрдП рдЯреЗрдХреНрд╕реНрдЯ рдореЛрдб"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рд╕реАрдЦрд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рд╡реАрдЬреАрдП рдмрдлрд░ рдХреЛ рд▓рд┐рдЦрдирд╛ рдЕрд╕реНрдерд┐рд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП рд╣рдо рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>write_volatile</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рд╣рдо QEMU рдореЗрдВ рдХреЛрдб рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдирд┐рдореНрди рдкрд░рд┐рдгрд╛рдо рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВ: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4cf/248/1a0/4cf2481a07f40c681954ff4954dce866.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреЗрдЬ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреЗ рдмрд╛рдж </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд╢рд┐рд▓рд╛рд▓реЗрдЦ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"рдирдпрд╛!"</font></font></i>  ред<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдордиреЗ рдкреЗрдЬ рдЯреЗрдмрд▓ рдореЗрдВ рдПрдХ рдирдпрд╛ рдореИрдкрд┐рдВрдЧ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдмрдирд╛рдпрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдЯрдХрд░рд╛рд╡ рдиреЗ рдХрд╛рдо рдХрд┐рдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рдЯрдХрд░рд╛рд╡ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рд╕реНрддрд░ 1 рдЯреЗрдмрд▓ рдерд╛ </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬрдм рд╣рдо рдХрд┐рд╕реА рдРрд╕реЗ рдкреГрд╖реНрда рдХреЛ рдореИрдк рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рдЕрднреА рддрдХ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ, рддреЛ рдлрд╝рдВрдХреНрд╢рди </font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ </font></font><code>EmptyFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдП рдЯреЗрдмрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдлрд╝реНрд░реЗрдо рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдРрд╕рд╛ рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рд╣рдо </font></font><code>0xdeadbeaf000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп </font><font style="vertical-align: inherit;">рдкреГрд╖реНрда рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ </font><font style="vertical-align: inherit;">рдХрд░рддреЗ рд╣реИрдВ </font></font><code>0x1000</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [тАж] let page = Page::containing_address(VirtAddr::new(0xdeadbeaf000)); [тАж] }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрджрд┐ рдЗрд╕реЗ рдкреНрд░рд╛рд░рдВрдн рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдирд┐рдореНрди рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреЗ рд╕рд╛рде рдПрдХ рдШрдмрд░рд╛рд╣рдЯ рд╣реЛрддреА рд╣реИ: </font></font><br><br><pre> <code class="plaintext hljs">panicked at 'map_to failed: FrameAllocationFailed', /тАж/result.rs:999:5</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрди рдкреГрд╖реНрдареЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдирдХреЗ рдкрд╛рд╕ рдЕрднреА рддрдХ рдкреГрд╖реНрда рд╕реНрддрд░ 1 рддрд╛рд▓рд┐рдХрд╛ рдирд╣реАрдВ рд╣реИ, рдЖрдкрдХреЛ рд╕рд╣реА рдПрдХ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>FrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЖрдк рдХреИрд╕реЗ рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕реЗ рдлреНрд░реЗрдо рдореБрдлреНрдд рд╣реИрдВ рдФрд░ рдХрд┐рддрдиреА рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдЙрдкрд▓рдмреНрдз рд╣реИ?</font></font><br><br><a name="4_5"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдлреНрд░реЗрдо рдЪрдпрди </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдП рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рд╕рд╣реА рдлреНрд░реЗрдо рд╡рд┐рддрд░рдХ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рд╕рд╛рдорд╛рдиреНрдп рдХрдВрдХрд╛рд▓ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░реЗрдВ:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs pub struct BootInfoFrameAllocator&lt;I&gt; where I: Iterator&lt;Item = PhysFrame&gt; { frames: I, } impl&lt;I&gt; FrameAllocator&lt;Size4KiB&gt; for BootInfoFrameAllocator&lt;I&gt; where I: Iterator&lt;Item = PhysFrame&gt; { fn allocate_frame(&amp;mut self) -&gt; Option&lt;PhysFrame&gt; { self.frames.next() } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд╖реЗрддреНрд░ </font></font><code>frames</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рдПрдХ рдордирдорд╛рдирд╛ рдлреНрд░реЗрдо рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреЗ рд╕рд╛рде рдЖрд░рдВрдн рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдЖрдкрдХреЛ </font></font><code>alloc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ </font><font style="vertical-align: inherit;">рдХреЛ рдХреЗрд╡рд▓ рдХреЙрд▓ рдкреНрд░рддрд┐рдирд┐рдзрд┐ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>Iterator::next</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд░рдВрднреАрдХрд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо </font></font><code>BootInfoFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдореЛрд░реА рдХрд╛рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>memory_map</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреЛ рдмреВрдЯрд▓реЛрдбрд░ рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>BootInfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЬреИрд╕рд╛ рдХрд┐ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреВрдЯ рд╕реВрдЪрдирд╛ рдЕрдиреБрднрд╛рдЧ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рдореЗрдореЛрд░реА рдХрд╛рд░реНрдб BIOS / UEFI рдлрд░реНрдорд╡реЗрдпрд░ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдмреВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рд╣реА рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдмреВрдЯрд▓реЛрдбрд░ рдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдп рдХрд╣рд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдореЗрдореЛрд░реА рдХрд╛рд░реНрдб рдореЗрдВ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреА рдПрдХ рд╕реВрдЪреА рд╣реЛрддреА </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>MemoryRegion</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдореЗрдореЛрд░реА рдХреНрд╖реЗрддреНрд░ рдХрд╛ рд╢реБрд░реБрдЖрддреА рдкрддрд╛, рд▓рдВрдмрд╛рдИ рдФрд░ рдкреНрд░рдХрд╛рд░ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЕрдкреНрд░рдпреБрдХреНрдд, рдЖрд░рдХреНрд╖рд┐рдд, рдЖрджрд┐) рд╣реЛрддреЗ рд╣реИрдВред рдЕрдиреБрдкрдпреЛрдЧреА рдХреНрд╖реЗрддреНрд░реЛрдВ рд╕реЗ рдлрд╝реНрд░реЗрдо рдмрдирд╛рдиреЗ рд╡рд╛рд▓рд╛ рдПрдХ рдЗрдЯрд░реЗрдЯрд░ рдмрдирд╛рдХрд░, рд╣рдо рдПрдХ рд╡реИрдз рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>BootInfoFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╛рд░рдВрднрд┐рдХ </font></font><code>BootInfoFrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд░реНрдп рдПрдХ рдирдП рд╕рдорд╛рд░реЛрд╣ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ </font></font><code>init_frame_allocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/memory.rs use bootloader::bootinfo::{MemoryMap, MemoryRegionType}; /// Create a FrameAllocator from the passed memory map pub fn init_frame_allocator( memory_map: &amp;'static MemoryMap, ) -&gt; BootInfoFrameAllocator&lt;impl Iterator&lt;Item = PhysFrame&gt;&gt; { // get usable regions from memory map let regions = memory_map .iter() .filter(|r| r.region_type == MemoryRegionType::Usable); // map each region to its address range let addr_ranges = regions.map(|r| r.range.start_addr()..r.range.end_addr()); // transform to an iterator of frame start addresses let frame_addresses = addr_ranges.flat_map(|r| r.step_by(4096)); // create `PhysFrame` types from the start addresses let frames = frame_addresses.map(|addr| { PhysFrame::containing_address(PhysAddr::new(addr)) }); BootInfoFrameAllocator { frames } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рдЙрдкрдпреЛрдЧ </font></font><code>MemoryMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рдП рдЧрдП рднреМрддрд┐рдХ рдлрд╝реНрд░реЗрдореЛрдВ рдХреЗ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдирдХреНрд╢реЗ рдХреЛ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдпреЛрдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо </font></font><code>iter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдореЛрд░реА рдХрд╛рд░реНрдб рдХреЛ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рд╡рд┐рдзрд┐ рдХрд╣рддреЗ рд╣реИрдВ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>MemoryRegion</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рддрдм рд╣рдо </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>filter</code></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд░рдХреНрд╖рд┐рдд рдпрд╛ рджреБрд░реНрдЧрдо рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рд╡рд┐рдзрд┐ </font><font style="vertical-align: inherit;">рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЛрдбрд░ рдЕрдкрдиреЗ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП рд╕рднреА рдореИрдкрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдореЗрдореЛрд░реА рдХрд╛рд░реНрдб рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХрд░реНрдиреЗрд▓ (рдХреЛрдб, рдбреЗрдЯрд╛ рдпрд╛ рд╕реНрдЯреИрдХ) рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝реНрд░реЗрдо рдпрд╛ рдмреВрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рд╕реЗ рд╣реА </font></font><code>InUse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╛ рдЗрд╕реА рддрд░рд╣ </font><font style="vertical-align: inherit;">рд╕реЗ рдЪрд┐рд╣реНрдирд┐рдд рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдлрд╝реНрд░реЗрдо рдХрд╛ </font></font><code>Usable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ </font><font style="vertical-align: inherit;">рдХрд╣реАрдВ рдФрд░ </font><font style="vertical-align: inherit;">рдирд╣реАрдВ рдХрд┐рдпрд╛ </font><font style="vertical-align: inherit;">рдЧрдпрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br></li><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>map</code></a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">range</a>  Rust         . <br></li><li>    :         <code>into_iter</code> ,     4096-    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>step_by</code></a> .  4096  (= 4 ) тАФ   ,      .      ,         .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>flat_map</code></a>  <code>map</code> ,   <code>Iterator&lt;Item = u64&gt;</code>  <code>Iterator&lt;Item = Iterator&lt;Item = u64&gt;&gt;</code> . <br></li><li>         <code>PhysFrame</code> ,    <code>Iterator&lt;Item = PhysFrame&gt;</code> .          <code>BootInfoFrameAllocator</code> . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп </font></font><code>kernel_main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЕрдкрдирд╛ рдлрд╝рдВрдХреНрд╢рди рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">:</font></font><code>BootInfoFrameAllocator</code><font style="vertical-align: inherit;"></font><code>EmptyFrameAllocator</code><font style="vertical-align: inherit;"></font><br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// in src/main.rs #[cfg(not(test))] fn kernel_main(boot_info: &amp;'static BootInfo) -&gt; ! { [тАж] let mut frame_allocator = memory::init_frame_allocator(&amp;boot_info.memory_map); [тАж] }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдмрд╛рд░ рдкрддрд╛ рдорд╛рдирдЪрд┐рддреНрд░рдг рд╕рдлрд▓ рд░рд╣рд╛ рдФрд░ рд╣рдо рдлрд┐рд░ рд╕реЗ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"рдирдпрд╛!"</font></font></i>  ред<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпреЛрдВ рдХреЗ рдкреАрдЫреЗ, рд╡рд┐рдзрд┐ </font></font><code>map_to</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреБрдкрд▓рдмреНрдз рдкреЗрдЬ рдЯреЗрдмрд▓ рдмрдирд╛рддреА рд╣реИ:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реЗрд╖рд┐рдд рдПрдХ рд╕реЗ рдЕрдкреНрд░рдпреБрдХреНрдд рдлреНрд░реЗрдо рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ </font></font><code>frame_allocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рдирдпрд╛ рдЦрд╛рд▓реА рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реВрдиреНрдп рдлреНрд░реЗрдоред </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕ рдлрд╝реНрд░реЗрдо рдореЗрдВ рдЙрдЪреНрдЪ рд╕реНрддрд░реАрдп рддрд╛рд▓рд┐рдХрд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдореИрдк рдХрд░реЗрдВред </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдЕрдЧрд▓реЗ рд╕реНрддрд░ рдкрд░ рдЬрд╛рдПрдВред </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рд╣рдорд╛рд░рд╛ рдХрд╛рд░реНрдп </font></font><code>create_example_mapping</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рдирдореВрдирд╛ рдХреЛрдб рд╣реИ, рд╣рдо рдЕрдм рдордирдорд╛рдиреЗ рдкрдиреНрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдирдП рдорд╛рдирдЪрд┐рддреНрд░рдг рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реНрдореГрддрд┐ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдиреЗ рдФрд░ рднрд╡рд┐рд╖реНрдп рдХреЗ рд▓реЗрдЦреЛрдВ рдореЗрдВ рдорд▓реНрдЯреАрдереНрд░реЗрдбрд┐рдВрдЧ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдЧрд╛ред</font></font><br><br><a name="5"></a><h1>  рд╕рд╛рд░рд╛рдВрд╢ </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдордиреЗ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рднреМрддрд┐рдХ рдлрд╝реНрд░реЗрдореЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реАрдЦрд╛, рдЬрд┐рд╕рдореЗрдВ рдкрд╣рдЪрд╛рди рдорд╛рдирдЪрд┐рддреНрд░рдг, рдкреВрд░реНрдг рднреМрддрд┐рдХ рд╕реНрдореГрддрд┐ рдореИрдкрд┐рдВрдЧ, рдЕрд╕реНрдерд╛рдпреА рдорд╛рдирдЪрд┐рддреНрд░рдг рдФрд░ рдкреБрдирд░рд╛рд╡рд░реНрддреА рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ред рд╣рдордиреЗ рдкреВрд░реНрдг рднреМрддрд┐рдХ рд╕реНрдореГрддрд┐ рдХреЛ рдПрдХ рд╕рд░рд▓ рдФрд░ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рд╡рд┐рдзрд┐ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪреБрдирд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдкреЗрдЬ рдЯреЗрдмрд▓ рддрдХ рдкрд╣реБрдБрдЪ рдХреЗ рдмрд┐рдирд╛ рдХрд░реНрдиреЗрд▓ рд╕реЗ рднреМрддрд┐рдХ рдореЗрдореЛрд░реА рдХреЛ рдореИрдк рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдмреВрдЯрд▓реЛрдбрд░ рд╕рдорд░реНрдерди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рд░реИрдХ </font></font><code>bootloader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд╛рд░реНрдЧреЛ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрд╡рд╢реНрдпрдХ рдореИрдкрд┐рдВрдЧ рдмрдирд╛рддрд╛ рд╣реИред рдпрд╣ </font></font><code>&amp;BootInfo</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ рдлрд╝рдВрдХреНрд╢рди рдХреЗ </font><font style="vertical-align: inherit;">рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░реНрдиреЗрд▓ рдХреЛ рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рдирдХрд╛рд░реА рджреЗрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП, рд╣рдо рдкрд╣рд▓реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдкреГрд╖реНрда рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЧрдП, рдПрдХ рдЕрдиреБрд╡рд╛рдж рдХрд╛рд░реНрдп рдХрд┐рдпрд╛, рдФрд░ рдлрд┐рд░ </font></font><code>MappedPageTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЛрдХрд░рд╛ </font><font style="vertical-align: inherit;">рдХреЗ рдкреНрд░рдХрд╛рд░ рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛</font></font><code>x86_64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдордиреЗ рдпрд╣ рднреА рд╕реАрдЦрд╛ рдХрд┐ рдкреЗрдЬ рдЯреЗрдмрд▓ рдореЗрдВ рдирдП рдореИрдкрд┐рдВрдЧ рдХреИрд╕реЗ рдмрдирд╛рдПрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ </font></font><code>FrameAllocator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреВрдЯрд▓реЛрдбрд░ рджреНрд╡рд╛рд░рд╛ рдкреНрд░реЗрд╖рд┐рдд рдореЗрдореЛрд░реА рдХрд╛рд░реНрдб рдкрд░ </font><font style="vertical-align: inherit;">рдХреИрд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдП </font><font style="vertical-align: inherit;">ред</font></font><br><br><a name="6"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрдЧреЗ рдХреНрдпрд╛ рд╣реИ? </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЧрд▓реЗ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо рдЕрдкрдиреЗ рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдвреЗрд░ рд╕реНрдореГрддрд┐ рдХреНрд╖реЗрддреНрд░ рдмрдирд╛рдПрдВрдЧреЗ, рдЬреЛ рд╣рдореЗрдВ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрд┐рдд</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд░рдиреЗ </font><font style="vertical-align: inherit;">рдФрд░ рд╡рд┐рднрд┐рдиреНрди </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рдВрдЧреНрд░рд╣ рдХрд╛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрдкрдпреЛрдЧ </font><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ </font><font style="vertical-align: inherit;">ред</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi445618/">https://habr.com/ru/post/hi445618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi445596/index.html">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдЯрд┐рдкреНрд╕ рдПрдВрдб рдЯреНрд░рд┐рдХреНрд╕: рдПрдирдЬреАрдЖрдИрдПрдирдПрдХреНрд╕ рдЗрдирдЧреНрд░реЗрдб рдореЗрдВ рд╡реНрдпрдХреНрддрд┐рдЧрдд рддреНрд░реБрдЯрд┐ рдкреГрд╖реНрда</a></li>
<li><a href="../hi445600/index.html">[рдкреЛрд▓ рдФрд░ рдмреБрд░рд╛рдИ] рдореЗрдЬрдмрд╛рди, рд╡реЗ рдЧрд▓рдд рд╣реЛ</a></li>
<li><a href="../hi445602/index.html">PHP рд░реВрд╕ 2019: рдкрд╣рд▓реА рд▓реАрдЧ рдХреА рднрд╛рд╖рд╛ рдХреЗ рд▓рд┐рдП "рд╕реНрдЯреЗрдбрд┐рдпрдо"</a></li>
<li><a href="../hi445608/index.html">рдЧреЗрдо рдУрд╡рд░: рд╡рд┐рд╢реНрд▓реЗрд╖рдХреЛрдВ рдиреЗ рдЧреЗрдорд┐рдВрдЧ рд╕реЗрдЧрдореЗрдВрдЯ рдкрд░ DDoS рд╣рдорд▓реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рд╡реГрджреНрдзрд┐ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХреА</a></li>
<li><a href="../hi445612/index.html">рдЫреЛрдЯреЗ рд╡реЗрдм-рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╕реНрдЯрд░ рд╕рдВрдЧреНрд░рд╣рдг drbd + ocfs2 рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ</a></li>
<li><a href="../hi445620/index.html">рдПрдХ UX рд▓реЗрдЦрдХ рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИ?</a></li>
<li><a href="../hi445622/index.html">рдЬрд╛рд╡рд╛ 12 рдореЗрдВ рдирдпрд╛: рдЯреАрдЗрдВрдЧ рдХрд▓реЗрдХреНрдЯрд░</a></li>
<li><a href="../hi445626/index.html">рдЦрд░рдЧреЛрд╢ рдХрд╛ рдЫреЗрдж рдХрд┐рддрдирд╛ рдЧрд╣рд░рд╛ рд╣реИ? CLRium # 5: рдХрдЪрд░рд╛ рдХрд▓реЗрдХреНрдЯрд░</a></li>
<li><a href="../hi445632/index.html">рдкрд╛рдпрдерди рдерд┐рдПрдЯрд░ рдХреЗ рдкреЛрд╕реНрдЯрд░ рд╕реЗ рд▓реЗрдХрд░ рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдмреЙрдЯ рддрдХред рднрд╛рдЧ реи</a></li>
<li><a href="../hi445638/index.html">рдЖрдзреБрдирд┐рдХ рдХрд▓рд╛ рдХреЗ рдЧреИрд░реЗрдЬ рд╕рдВрдЧреНрд░рд╣рд╛рд▓рдп рдореЗрдВ рдмреНрд▓рд╛рдЗрдВрдб рдЗрдВрдЯрд░реНрдирд╢рд┐рдк</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>