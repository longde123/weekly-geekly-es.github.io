<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💮 ♉️ 👨🏿‍🤝‍👨🏻 Wenig Bequemlichkeit im Studentenleben 🗜️ 🏛️ ⛓️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine einfache Geschichte darüber, wie ich mich schämte, Klassenkameraden ständig nach fehlenden Informationen zu fragen, und ich beschloss, unser Lebe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wenig Bequemlichkeit im Studentenleben</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428808/"><p>  Eine einfache Geschichte darüber, wie ich mich schämte, Klassenkameraden ständig nach fehlenden Informationen zu fragen, und ich beschloss, unser Leben ein wenig einfacher zu gestalten. </p><br><p><img src="http://www.wallpapermaiden.com/wallpaper/14997/download/2560x1700/talos-principle-robot-painting-profile-view-artwork.jpg" alt="Bild"></p><br><p>  Ich glaube, dass viele meiner Kollegen mit der Situation vertraut sind, wenn in einem allgemeinen Chatroom, in dem wichtige Informationen häufig geflasht werden, etwa 30 aktive Gesprächspartner ständig Vkontakte-Datenbanken mit ihren Nachrichten laden.  Unter solchen Bedingungen ist es unwahrscheinlich, dass jeder diese wichtigen Informationen sieht.  Das passiert mir auch.  Vor einem Jahr wurde beschlossen, dieses Missverständnis zu korrigieren. </p><br><p>  Diejenigen, die bereit sind, sich nicht über den nächsten Artikel über den Bot zu empören, frage ich unter Katze. </p><a name="habracut"></a><br><p> Da ich ein Student der ersten Stufe bin, werden Beispiele zu diesem Thema verwendet. <br>  Es gibt also eine Aufgabe: Die Übertragung von Informationen vom Schulleiter an die Schüler ist sowohl für den Schulleiter als auch für die Schüler bequem.  Dank der relativ neuen Funktionen von Vkontakte (nämlich persönliche Nachrichten von Communities) fiel mir die Entscheidung sofort auf.  Ein Bot, der in einer Gruppe sitzt, sollte Nachrichten vom Ältesten (Älteste, wenn sich viele Gruppen im Stream befinden) empfangen und an interessierte Parteien (Studenten) senden. </p><br><p>  Die Aufgabe ist eingestellt, fahren Sie fort. </p><br><p>  <u>Wir werden brauchen:</u> </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vk_api</a> Bibliothek zur Verwendung von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vk</a> api </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">peewee orm</a> , um mit der Datenbank zu arbeiten </li><li>  und in Python integrierte Module </li></ol><br><p>  Außerdem schlage ich vor dem Lesen vor, die Erinnerung an die Muster "Observer" ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Habr</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wiki</a> ) und "Facade" ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Habr</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wiki</a> ) zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aktualisieren</a> . </p><br><p>  <strong>Teil 1. "Schön, Sie kennenzulernen, Genosse Bot."</strong> </p><br><p>  Zuerst müssen Sie unserem Bot beibringen, sich selbst als Gemeinschaft zu verstehen.  Erstellen Sie eine Klasse namens Group.  Lassen Sie es als Argumente ein Sitzungsobjekt und ein datenbankrepräsentatives Objekt (Proxy) akzeptieren. </p><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Group</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BaseCommunicateVK)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, vksession, storage)</span></span></span><span class="hljs-function">:</span></span> super().__init__(vksession) self.storage = storage</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">BaseCommunicateVK?</b>  <b class="spoiler_title">Was ist dort?</b> <div class="spoiler_text"><p>  Die Entscheidung, diese Funktionalität in eine separate Klasse zu stellen, erklärt sich aus der Tatsache, dass einige von Ihnen in Zukunft möglicherweise beschließen werden, den Bot durch eine andere Vkontakte-Funktionalität zu ergänzen. <br>  Natürlich, um die Abstraktion der Community zu entladen. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseCommunicateVK</span></span></span><span class="hljs-class">:</span></span> longpoll = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, vksession)</span></span></span><span class="hljs-function">:</span></span> self.session = vksession self.api = vksession.get_api() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> BaseCommunicateVK.longpoll <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: BaseCommunicateVK.longpoll = VkLongPoll(self.session) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_api</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.api <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_longpoll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.longpoll <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">method</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, func, args)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.api.method(func, args) @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_session</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(token=None, login=None, password=None, api_v=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'5.85'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> token: session = vk_api.VkApi(token=token, api_version=api_v) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> login <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> password: session = vk_api.VkApi(login, password, api_version=api_v) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> vk_api.AuthError(<span class="hljs-string"><span class="hljs-string">"Define login and password or token."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> session <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> vk_api.ApiError <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> error: logging.info(error) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_last_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.api.messages.getHistory( peer_id=user_id, count=<span class="hljs-number"><span class="hljs-number">1</span></span>)[<span class="hljs-string"><span class="hljs-string">"items"</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_attachments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(last_message)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> last_message <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">"attachments"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> last_message: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> attachments = last_message[<span class="hljs-string"><span class="hljs-string">"attachments"</span></span>] attach_strings = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> attach <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> attachments: attach_type = attach[<span class="hljs-string"><span class="hljs-string">"type"</span></span>] attach_info = attach[attach_type] attach_id = attach_info[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] attach_owner_id = attach_info[<span class="hljs-string"><span class="hljs-string">"owner_id"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">"access_key"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> attach_info: access_key = attach_info[<span class="hljs-string"><span class="hljs-string">"access_key"</span></span>] attach_string = <span class="hljs-string"><span class="hljs-string">"{}{}_{}_{}"</span></span>.format(attach_type, attach_owner_id, attach_id, access_key) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: attach_string = <span class="hljs-string"><span class="hljs-string">"{}{}_{}"</span></span>.format(attach_type, attach_owner_id, attach_id) attach_strings.append(attach_string) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">","</span></span>.join(attach_strings) @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_forwards</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(attachments, last_message)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> attachments <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">"fwd_count"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> attachments: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(last_message[<span class="hljs-string"><span class="hljs-string">"fwd_messages"</span></span>]) == int(attachments[<span class="hljs-string"><span class="hljs-string">"fwd_count"</span></span>]): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> last_message[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id, message, attachments=None, **kwargs)</span></span></span><span class="hljs-function">:</span></span> send_to = int(user_id) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">"last_message"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> kwargs: last_message = kwargs[<span class="hljs-string"><span class="hljs-string">"last_message"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: last_message = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> p_attachments = self.get_attachments(last_message) p_forward = self.get_forwards(attachments, last_message) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> message <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> p_attachments <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> p_forward: self.api.messages.send( user_id=send_to, message=message, attachment=p_attachments, forward_messages=p_forward) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> destroy: accept_msg_id = self.api.messages \ .getHistory(peer_id=user_id, count=<span class="hljs-number"><span class="hljs-number">1</span></span>) \ .get(<span class="hljs-string"><span class="hljs-string">'items'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) self.delete(accept_msg_id, destroy_type=destroy_type) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, msg_id, destroy_type=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.api.messages.delete(message_id=msg_id, delete_for_all=destroy_type)</code> </pre> </div></div><br><p>  Erstellen Sie eine Methode zum Aktualisieren von Community-Mitgliedern.  Teilen Sie sie sofort in Administratoren und Teilnehmer auf und speichern Sie sie in der Datenbank. </p><br><ul><li>  self.api wird beim Erstellen der Gruppenbasisklasse (BaseCommunicateVK) konfiguriert. </li></ul><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update_members</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> fields = <span class="hljs-string"><span class="hljs-string">'domain, sex'</span></span> admins = self.api.groups.getMembers(group_id=self.group_id, fields=fields, filter=<span class="hljs-string"><span class="hljs-string">'managers'</span></span>) self.save_members(self._configure_users(admins)) members = self.api.groups.getMembers(group_id=self.group_id, fields=fields) self.save_members(self._configure_users(members)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save_members</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, members)</span></span></span><span class="hljs-function">:</span></span> self.storage.update(members) @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_configure_users</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(items, exclude=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exclude <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: exclude = [] users = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> user <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items.get(<span class="hljs-string"><span class="hljs-string">'items'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> user.get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> exclude: member = User() member.configure(**user) users.append(member) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> users</code> </pre> <br><p>  Diese Klasse sollte auch in der Lage sein, Nachrichten an Empfänger zu senden, also die nächste Methode im Studio.  In den Parametern: Mailingliste, Nachrichtentext und Anwendung.  Das Ganze beginnt in einem separaten Thread, damit der Bot Nachrichten von anderen Teilnehmern empfangen kann. <br>  Nachrichten werden im synchronen Modus empfangen, sodass mit zunehmender Anzahl aktiver Clients die Antwortgeschwindigkeit offensichtlich abnimmt. </p><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">broadcast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, uids, message, attachments=None, **kwargs)</span></span></span><span class="hljs-function">:</span></span> report = BroadcastReport() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> users_ids = uids <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isinstance(users_ids, list): users_ids = list(users_ids) report.should_be_sent = len(users_ids) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> user_id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> users_ids: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: self.send(user_id, message, attachments, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> message <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> attachments: report.sent += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> vk_api.VkApiError <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> error: report.errors.append(<span class="hljs-string"><span class="hljs-string">'vk.com/id{}: {}'</span></span>.format(user_id, error)) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> uid <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.get_member_ids(admins=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, moders=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): self.send(uid, str(report)) broadcast_thread = Thread(target=send_all) broadcast_thread.start() broadcast_thread.join()</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">BroadcastReport - Berichtsklasse</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReport</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.should_be_sent = <span class="hljs-number"><span class="hljs-number">0</span></span> self.sent = <span class="hljs-number"><span class="hljs-number">0</span></span> self.errors = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__str__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> res = <span class="hljs-string"><span class="hljs-string">"#  #"</span></span> res += <span class="hljs-string"><span class="hljs-string">"\n: {}  "</span></span>.format(self.should_be_sent) res += <span class="hljs-string"><span class="hljs-string">"\n: {} "</span></span>.format(self.sent) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.errors: res += <span class="hljs-string"><span class="hljs-string">"\n:"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.errors: res += <span class="hljs-string"><span class="hljs-string">"\n- {}"</span></span>.format(i) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res</code> </pre> </div></div><br><p>  Damit scheint die Abstraktion der Gruppe vorbei zu sein.  Wir haben uns mit allen Mitgliedern der Community getroffen, jetzt müssen wir lernen, wie man sie versteht. </p><br><p>  <strong>Teil 2. "Psh ... willkommen .."</strong> </p><br><p>  Lassen Sie den Bot alle Nachrichten von Mitgliedern unserer Community abhören. <br>  Erstellen Sie dazu eine Klasse ChatHandler, die dies ausführt <br>  In den Parametern: </p><br><ul><li>  group_manager ist eine Instanz der Community-Klasse, die wir gerade geschrieben haben </li><li>  command_observer erkennt verbundene Befehle (mehr dazu im dritten Teil) </li></ul><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChatHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Handler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, group_manager, command_observer)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.longpoll = group_manager.get_longpoll() self.group = group_manager self.api = group_manager.get_api() self.command_observer = command_observer</code> </pre> <br><p>  Außerdem hören wir Nachrichten von Benutzern ab und erkennen Befehle. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.longpoll.listen(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> event.user_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> event.type == VkEventType.MESSAGE_NEW <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> event.to_me: self.group.api.messages.markAsRead(peer_id=event.user_id) self.handle(event.user_id, event.text, event.attachments, message_id=event.message_id) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ConnectionError: logging.error(<span class="hljs-string"><span class="hljs-string">"I HAVE BEEN DOWNED AT {}"</span></span>.format(datetime.datetime.today())) self.longpoll.update_longpoll_server() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id, message, attachments, **kwargs)</span></span></span><span class="hljs-function">:</span></span> member = self.group.get_member(user_id) self.group.update_members() self.command_observer.execute(member, message, attachments, self.group, **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.listen()</code> </pre> <br><p>  <strong>Teil 3. "Was hast du über meine geschrieben?"</strong> </p><br><p>  Die Befehlserkennung wird von einem separaten Subsystem ausgeführt, das über das Observer-Muster implementiert ist. <br>  Achtung CommandObserver: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandObserver</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(AbstractObserver)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, member, message, attachments, group, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> command <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.commands: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> trigger <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> command.triggers: body = command.get_body(trigger, message) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> body <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: group.api.messages.setActivity(user_id=member.id, type=<span class="hljs-string"><span class="hljs-string">"typing"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> command.system: kwargs.update({<span class="hljs-string"><span class="hljs-string">"trigger"</span></span>: trigger, <span class="hljs-string"><span class="hljs-string">"commands"</span></span>: self.commands}) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: kwargs.update({<span class="hljs-string"><span class="hljs-string">"trigger"</span></span>: trigger}) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> command.proceed(member, body, attachments, group, **kwargs)</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">AbstractObserver</b> <div class="spoiler_text"><p>  Auch hier ist das Rendering für eine mögliche zukünftige Erweiterung vorgesehen. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractObserver</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(metaclass=ABCMeta)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.commands = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> arg <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> args: self.commands.append(arg) @abstractmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> </div></div><br><p>  Aber was wird dieser Beobachter erkennen? <br>  Also kamen wir zum interessantesten Teil - dem Team. <br>  Jedes Team ist eine unabhängige Klasse, ein Nachkomme der Basisbefehlsklasse. <br>  Für den Befehl muss lediglich die Methode continue () ausgeführt werden, wenn das Schlüsselwort am Anfang der Nachricht des Benutzers gefunden wird.  Befehlsschlüsselwörter werden in der Auslöservariablen der Befehlsklasse (Zeichenfolge oder Liste von Zeichenfolgen) definiert. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(metaclass=ABCMeta)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.triggers = [] self.description = <span class="hljs-string"><span class="hljs-string">"Empty description."</span></span> self.system = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.privilege = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.activate_times = [] self.activate_days = set() self.autostart_func = self.proceed <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proceed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, member, message, attachments, group, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError() @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_body</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(kw, message)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isinstance(kw, list): kw = [kw, ] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> kw: reg = <span class="hljs-string"><span class="hljs-string">'^ *(\\{}) *'</span></span>.format(i) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> re.search(reg, message): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> re.sub(reg, <span class="hljs-string"><span class="hljs-string">''</span></span>, message).strip(<span class="hljs-string"><span class="hljs-string">' '</span></span>)</code> </pre> <br><p>  Wie aus der Signatur der Methode continue () hervorgeht, erhält jeder Befehl eine Verknüpfung zu einer Instanz eines Gruppenmitglieds, seine Nachricht (ohne Schlüsselwort), Anwendungen und eine Verknüpfung zu einer Gruppeninstanz.  Das heißt, die gesamte Interaktion mit einem Gruppenmitglied liegt beim Team.  Ich denke, dies ist die richtigste Lösung, da auf diese Weise eine Shell (Shell) für eine größere Interaktivität erstellt werden kann. <br>  (In Wahrheit müssen Sie dazu entweder asynchron hinzufügen, da die Verarbeitung synchron ist, oder jede empfangene Nachricht sollte in einem neuen Thread verarbeitet werden, was überhaupt nicht rentabel ist.) </p><br><p>  Beispiele für die Implementierung von Befehlen: </p><br><div class="spoiler">  <b class="spoiler_title">BroadcastCommand</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastCommand</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Command)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.triggers = [<span class="hljs-string"><span class="hljs-string">'.mb'</span></span>] self.privilege = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.description = <span class="hljs-string"><span class="hljs-string">"    ."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proceed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, member, message, attachments, group, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> member.id <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> group.get_member_ids(admins=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, editors=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): group.send(member.id, <span class="hljs-string"><span class="hljs-string">"You cannot do this ^_^"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> last_message = group.get_last_message(member.id) group.broadcast(group.get_member_ids(), message, attachments, last_message=last_message, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">HelpCommand</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelpCommand</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Command)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.commands = [] self.triggers = [<span class="hljs-string"><span class="hljs-string">'.h'</span></span>, <span class="hljs-string"><span class="hljs-string">'.help'</span></span>] self.system = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.description = <span class="hljs-string"><span class="hljs-string">"  ."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proceed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, member, message, attachments, group, **kwargs)</span></span></span><span class="hljs-function">:</span></span> commands = kwargs[<span class="hljs-string"><span class="hljs-string">"commands"</span></span>] help = <span class="hljs-string"><span class="hljs-string">"  :\n\n"</span></span> admins = group.get_member_ids(admins=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, moders=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> command <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> commands: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> command.privilege <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> member.id <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> admins: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> help += <span class="hljs-string"><span class="hljs-string">"{}) {}\n\n"</span></span>.format(i + <span class="hljs-number"><span class="hljs-number">1</span></span>, command.name()) i += <span class="hljs-number"><span class="hljs-number">1</span></span> group.send(member.id, help) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> </div></div><br><p>  <strong>Teil 4. "Wir sind ein großes Team."</strong> </p><br><p>  Jetzt müssen alle diese Module und Handler kombiniert und konfiguriert werden. <br>  Noch eine Klasse bitte! <br>  Erstellen Sie eine Fassade, die unseren Bot anpasst. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKManage</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, token=None, login=None, password=None)</span></span></span><span class="hljs-function">:</span></span> self.session = BaseCommunicateVK.create_session(token, login, password, api_version) self.storage = DBProxy(DatabaseORM) self.group = Group(self.session, self.storage).setup().update_members() self.chat = ChatHandler(self.group, CommandObserver.get_observer()) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.chat.run() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, command_name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-string"><span class="hljs-string">" "</span></span>: BroadcastCommand(), <span class="hljs-string"><span class="hljs-string">" "</span></span>: AdminBroadcastCommand(), <span class="hljs-string"><span class="hljs-string">""</span></span>: HelpCommand(), <span class="hljs-string"><span class="hljs-string">" "</span></span>: SkippedLectionsCommand(), <span class="hljs-string"><span class="hljs-string">""</span></span>: TopicTimetableCommand().setup_account(self.bot.api), }.get(command_name) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect_command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, command_name)</span></span></span><span class="hljs-function">:</span></span> command = self.get_command(str(command_name).lower()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> command: self.chat.command_observer.add(command) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect_commands</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, command_names)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> command_names.split(<span class="hljs-string"><span class="hljs-string">','</span></span>): self.connect_command(i.strip()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self</code> </pre> <br><p>  Die letzte Phase ist der Start.  Immer die böse, weil eine Art Überraschung herauskommen kann.  Nicht dieses Mal. </p><br><ul><li>  ConfigParser wird aus core.settings.ConfigParser importiert.  Tatsächlich liest es nur die Konfiguration. </li><li><p>  project_path wird aus dem Einstellungsmodul im Projektstamm importiert. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: config = ConfigParser(project_path) VKManage(token=config[<span class="hljs-string"><span class="hljs-string">'token'</span></span>], login=config[<span class="hljs-string"><span class="hljs-string">'login'</span></span>], password=config[<span class="hljs-string"><span class="hljs-string">'password'</span></span>])\ .connect_commands(<span class="hljs-string"><span class="hljs-string">",  ,  ,  "</span></span>)\ .start()</code> </pre> <br></li></ul><br><p>  Das scheint alles zu sein. </p><br><p>  Im Moment hat dieses Programm mindestens drei Gruppen geholfen und ich hoffe, Sie werden es auch mitbringen. </p><br><p>  Sie können es kostenlos auf Heroku bereitstellen, aber das ist eine andere Geschichte. </p><br><p>  <strong>Referenzen:</strong> </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> auf Github </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de428808/">https://habr.com/ru/post/de428808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de428794/index.html">Überblick über die grundlegenden Methoden der mathematischen Optimierung bei Problemen mit Einschränkungen</a></li>
<li><a href="../de428796/index.html">Echtzeit-Manipulation von Maschen auf Einheit</a></li>
<li><a href="../de428798/index.html">Wie man einen Indie-Entwickler überlebt. Teil 2</a></li>
<li><a href="../de428800/index.html">Perfektes CSS kochen</a></li>
<li><a href="../de428806/index.html">Consumer Check Analysis: Was sie bei Amazon kaufen</a></li>
<li><a href="../de428810/index.html">18 Materialien zur digitalen Technologie in Audio</a></li>
<li><a href="../de428812/index.html">TypeScript: Deserialisieren von JSON in Klassen mit Typüberprüfung für Eigenschaften</a></li>
<li><a href="../de428814/index.html">Produktabgleich mit Elasticsearch für den Preisüberwachungsservice von Wettbewerbern</a></li>
<li><a href="../de428818/index.html">DeOldify: Ein Programm zum Färben von Schwarzweißbildern</a></li>
<li><a href="../de428820/index.html">Sie befinden sich in 3D für Dritte: Oculus Go + Raspberry Pi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>