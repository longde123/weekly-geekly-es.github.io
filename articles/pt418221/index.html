<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’¬ ğŸ¥ƒ ğŸ†— Curso MIT "SeguranÃ§a de sistemas de computadores". Palestra 6: â€œOportunidadesâ€, parte 3 ğŸ‘ğŸ¿ ğŸ‘©ğŸ½â€ğŸ¤â€ğŸ‘¨ğŸ¿ ğŸ“š</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instituto de Tecnologia de Massachusetts. Curso de Aula nÂº 6.858. "SeguranÃ§a de sistemas de computador". Nikolai Zeldovich, James Mickens. 2014 ano 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Curso MIT "SeguranÃ§a de sistemas de computadores". Palestra 6: â€œOportunidadesâ€, parte 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418221/"><h3>  Instituto de Tecnologia de Massachusetts.  Curso de Aula nÂº 6.858.  "SeguranÃ§a de sistemas de computador".  Nikolai Zeldovich, James Mickens.  2014 ano </h3><br>  Computer Systems Security Ã© um curso sobre o desenvolvimento e implementaÃ§Ã£o de sistemas de computador seguros.  As palestras abrangem modelos de ameaÃ§as, ataques que comprometem a seguranÃ§a e tÃ©cnicas de seguranÃ§a baseadas em trabalhos cientÃ­ficos recentes.  Os tÃ³picos incluem seguranÃ§a do sistema operacional (SO), recursos, gerenciamento de fluxo de informaÃ§Ãµes, seguranÃ§a de idiomas, protocolos de rede, seguranÃ§a de hardware e seguranÃ§a de aplicativos da web. <br><br>  Palestra 1: â€œIntroduÃ§Ã£o: modelos de ameaÃ§asâ€ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3</a> <br>  Palestra 2: â€œControle de ataques de hackersâ€ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3</a> <br>  Aula 3: â€œEstouros de Buffer: ExploraÃ§Ãµes e ProteÃ§Ã£oâ€ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3</a> <br>  Palestra 4: â€œSeparaÃ§Ã£o de PrivilÃ©giosâ€ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3</a> <br>  Palestra 5: â€œDe onde vÃªm os sistemas de seguranÃ§a?â€ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> <br>  Palestra 6: â€œOportunidadesâ€ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3</a> <a name="habracut"></a><br><br>  <b>PÃºblico-alvo:</b> se esse <b>UID</b> fornecer acesso somente leitura a esse arquivo e vocÃª tambÃ©m tiver um descritor de arquivo, se perder o <b>UID</b> , ainda poderÃ¡ obter permissÃ£o para ler esse arquivo? <br><br>  <b>Professor:</b> sim, pois ele aparecerÃ¡ em catÃ¡logos.  Porque assim que vocÃª adiciona o recurso ao arquivo, Ã© isso.  EstÃ¡ aberto para vocÃª com privilÃ©gios especiais e assim por diante.  Mas o problema Ã© que eles tÃªm esse design hÃ­brido. <br><br>  Ou seja, eles dizem - vocÃª realmente pode adicionar recursos aos diretÃ³rios e pode abrir um novo arquivo enquanto trabalha em paralelo.  Pode ser que vocÃª adicione o recurso a um diretÃ³rio, como <b>/ etc</b> , mas vocÃª nÃ£o tem acesso obrigatÃ³rio a todos os arquivos no diretÃ³rio <b>/ etc.</b>  Mas assim que vocÃª entra no modo de recursos, pode tentar abrir esses arquivos, sabendo que tem acesso ao diretÃ³rio <b>/ etc.</b>  Afinal, ele jÃ¡ estÃ¡ aberto. Por que vocÃª nÃ£o me fornece um arquivo chamado <b>"senha"</b> localizado neste diretÃ³rio? <br><br><img src="https://habrastorage.org/webt/8y/ew/2d/8yew2dwzcw7lpgl31ttm1ayzj6g.jpeg"><br><br>  E entÃ£o o kernel precisa decidir se vocÃª deseja abrir o arquivo neste diretÃ³rio no modo de leitura ou gravaÃ§Ã£o ou o que vocÃª possui.  EntÃ£o, acho que este Ã© o Ãºnico lugar em que vocÃª ainda precisa desse privilÃ©gio externo, porque eles tentaram criar um design compatÃ­vel, onde usavam semÃ¢nticas nÃ£o muito naturais para descrever a operaÃ§Ã£o de diretÃ³rios.  Este parece ser o Ãºnico local onde permanecem os princÃ­pios para a configuraÃ§Ã£o de um <b>sistema de</b> arquivos <b>Unix</b> . <br><br>  <b>PÃºblico:</b> existem outros lugares? <br><br>  <b>Professor:</b> boa pergunta.  Acho que terei que obter o cÃ³digo-fonte anterior para descobrir o que estÃ¡ acontecendo, mas a maioria das outras situaÃ§Ãµes realmente nÃ£o exige verificaÃ§Ã£o de <b>UID</b> .  Porque, por exemplo, nÃ£o Ã© usado para redes.  Essas sÃ£o provavelmente as operaÃ§Ãµes usuais do sistema de arquivos - se vocÃª possui um segmento de memÃ³ria compartilhada, basta abri-lo e pronto. <br><br>  <b>PÃºblico:</b> poderia explicar novamente qual Ã© exatamente o ID do usuÃ¡rio, se vocÃª tiver o recurso de <b>capacidade</b> ? <br><br>  <b>Professor:</b> isso Ã© importante quando vocÃª tem a oportunidade de catalogar.  A questÃ£o Ã©: o que essa oportunidade apresenta a vocÃª?  Considere uma interpretaÃ§Ã£o, por exemplo, o estado dos recursos de um sistema limpo, nÃ£o o <b>Capsicum</b> .  Se nesse sistema vocÃª tiver a oportunidade de um diretÃ³rio, terÃ¡ acesso incondicional a todos os arquivos desse diretÃ³rio. <br><br>  No <b>Unix,</b> esse geralmente nÃ£o Ã© o caso.  VocÃª pode abrir o diretÃ³rio como <b>/ etc</b> , mas ele possui muitos arquivos de sistema nos quais as informaÃ§Ãµes confidenciais podem ser armazenadas, por exemplo, a chave privada do servidor.  E o fato de poder abrir e rolar por esse diretÃ³rio nÃ£o significa que vocÃª nÃ£o pode abrir arquivos nesse diretÃ³rio.  Ou seja, tendo acesso ao diretÃ³rio, vocÃª tem acesso aos arquivos. <br><br>  No <b>Capsicum</b> , se vocÃª abrir o diretÃ³rio <b>/ etc</b> e entrar no modo de recurso, acontece o seguinte.  VocÃª diz: â€œNÃ£o sei o que Ã© esse diretÃ³rio.  Acabei de adicionar um descritor de arquivo. "  HÃ¡ um arquivo chamado "chave".  Por que vocÃª nÃ£o abre este arquivo <b>"chave"</b> ?  SÃ³ porque naquele momento, vocÃª provavelmente nÃ£o deseja que esse processo baseado em recursos abra esse arquivo, porque vocÃª nÃ£o precisa dele.  Embora isso permita que vocÃª ignore <b>as</b> permissÃµes do <b>Unix</b> para o arquivo. <br><br>  Portanto, acho que os autores deste artigo abordaram cuidadosamente o desenvolvimento de um sistema que nÃ£o violaria os mecanismos de seguranÃ§a existentes. <br><br>  <b>PÃºblico:</b> ou seja, vocÃª diz que, em alguns casos, pode usar uma combinaÃ§Ã£o desses dois fatores de seguranÃ§a?  Ou seja, embora o usuÃ¡rio possa alterar o arquivo no diretÃ³rio, quais arquivos ele acessa depende de seu ID de usuÃ¡rio? <br><br>  <b>Professor:</b> sim, exatamente.  Na prÃ¡tica, no <b>Capsicum</b> , antes de entrar no modo de recursos, vocÃª precisa adivinhar quais arquivos podem ser necessÃ¡rios posteriormente.  VocÃª pode precisar de bibliotecas compartilhadas, arquivos de texto, modelos, conexÃµes de rede e assim por diante.  Portanto, vocÃª abre tudo isso com antecedÃªncia.  E nem sempre Ã© necessÃ¡rio saber qual arquivo vocÃª precisa.  EntÃ£o esses caras fizeram isso para que vocÃª possa simplesmente abrir o descritor de arquivo do diretÃ³rio e visualizar os arquivos necessÃ¡rios mais tarde.  No entanto, pode ser que esses arquivos nÃ£o tenham as mesmas permissÃµes que vocÃª possui.  Ã‰ precisamente por esse motivo que uma combinaÃ§Ã£o de dois fatores de seguranÃ§a Ã© usada - verificando os recursos e o <b>uid do</b> usuÃ¡rio.  Portanto, isso faz parte do mecanismo do kernel. <br><br><img src="https://habrastorage.org/webt/xk/zu/ea/xkzueav2oq8qjqezg3f7hrzvemc.jpeg"><br><br>  Por que eles precisam de uma biblioteca como <b>libcapsicum</b> ?  Eu acho que hÃ¡ duas coisas principais que eles apÃ³iam nesta biblioteca. <br><br>  Uma delas Ã© que eles implementam uma funÃ§Ã£o chamada <b>lch_start</b> , que vocÃª deve usar em vez da funÃ§Ã£o <b>cap_enter</b> .  Outra funÃ§Ã£o que <b>libcapsicum</b> fornece Ã© o conceito de listas fd, que Ã© usado para passar descritores de arquivo por nÃºmeros.  O objetivo desta <b>lista fd Ã©</b> fÃ¡cil de explicar.  Isso Ã© basicamente uma generalizaÃ§Ã£o de como o <b>Unix</b> gerencia e passa descritores de arquivos entre processos.  No <b>Unix</b> e <b>Linux</b> tradicional, que vocÃª usa hoje, alguns descritores de arquivo sÃ£o passados â€‹â€‹para ele quando o processo Ã© iniciado.  VocÃª simplesmente abre alguns descritores de arquivo com valores inteiros nesta tabela e inicia o processo filho de que precisa.  Ou vocÃª executa um binÃ¡rio especÃ­fico e ele herda todos esses slots abertos na tabela <b>fd</b> .  No entanto, nÃ£o hÃ¡ outra maneira boa de nomear essas coisas alÃ©m de usar nÃºmeros como nomes. <br><br>  Considere um exemplo no qual o slot 0 serÃ¡ usado para entrada, slot 1 para saÃ­da e slot 2 para impressÃ£o de mensagens de erro.  Ã‰ assim que funciona no <b>Unix</b> .  E funciona bem se vocÃª apenas transferir esses trÃªs arquivos ou trÃªs fluxos de dados para o processo. <br><br><img src="https://habrastorage.org/webt/bn/kq/yt/bnkqytvftq_0clyfqaqlqmwlfbs.jpeg"><br><br>  Mas no <b>Capsicum,</b> acontece que vocÃª â€œpassa porâ€ muito mais descritores de arquivos no seu caminho.  Portanto, quando vocÃª passa um descritor de arquivo para alguns arquivos, passa por um descritor de arquivo para uma conexÃ£o de rede, um descritor para uma biblioteca compartilhada que vocÃª possui e assim por diante.  Gerenciar todos esses nÃºmeros Ã© bastante tedioso.  Portanto, de fato, <b>libcapsicum</b> fornece a capacidade de abstrair o nome desses descritores de arquivo anteriores entre processos usando um nome hierÃ¡rquico usado em vez desses nÃºmeros inteiros obscuros. <br>  Essa Ã© uma das coisas simples que eles fornecem em sua biblioteca.  Para que eu possa passar o descritor de arquivo para o processo e dar um nome, nÃ£o importa qual nÃºmero seja indicado.  Este mÃ©todo Ã© muito mais simples. <br><br>  Eles ainda tÃªm outro mecanismo de inicializaÃ§Ã£o de sandbox mais complexo.  Isso Ã© <b>lch</b> , a <b>API do</b> host da sandbox usada em vez de apenas entrar no modo de recursos de <b>capacidade</b> .  Por que eles precisavam de algo mais do que uma simples entrada no modo de oportunidade?  O que geralmente incomoda vocÃª ao criar uma sandbox? <br><br>  <b>PÃºblico:</b> provavelmente, <b>lch</b> apaga todas as coisas herdadas para garantir um inÃ­cio "limpo" do sistema. <br><br>  <b>Professor:</b> sim.  Eu acho que eles estÃ£o preocupados em tentar levar em conta tudo o que a sandbox tem acesso.  O problema Ã© que, se vocÃª simplesmente chamar <b>cap_enter</b> , tecnicamente, no nÃ­vel do mecanismo do kernel, ele funcionarÃ¡.  Certo?  Isso apenas impede que vocÃª descubra novas oportunidades. <br><br>  Mas o problema Ã© que pode haver muitas coisas existentes Ã s quais o processo jÃ¡ tem acesso. <br><br>  Portanto, acho que o exemplo mais simples Ã© a presenÃ§a de descritores de arquivos abertos lÃ¡ que vocÃª esqueceu, e eles simplesmente serÃ£o herdados por esse processo. <br><br><img src="https://habrastorage.org/webt/td/yv/dd/tdyvddlujfmx8gudizztmw9n5gm.jpeg"><br><br>  Por exemplo, eles consideraram <b>tcpdump</b> .  Primeiro, eles mudaram o <b>tcpdump</b> simplesmente chamando <b>cap_enter</b> antes mesmo de analisar todas as conexÃµes de rede recebidas.  De certa forma, isso funciona bem porque vocÃª nÃ£o pode obter mais recursos de <b>capacidade</b> .  Mas entÃ£o, olhando para o descritor de arquivo aberto, eles perceberam que vocÃª tem acesso total ao terminal do usuÃ¡rio, porque vocÃª possui um descritor de arquivo aberto.  Para que vocÃª possa interceptar todas as teclas digitadas pelo usuÃ¡rio e assim por diante.  Portanto, este provavelmente nÃ£o Ã© um bom plano para o <b>tcpdump</b> .  Porque vocÃª nÃ£o deseja que alguÃ©m intercepte sua atividade no teclado. <br><br>  Portanto, no caso do <b>tcpdump,</b> eles alteraram manualmente os descritores de arquivo e adicionaram alguns bits de recursos a eles para limitar os tipos de operaÃ§Ãµes que vocÃª pode executar.  Se vocÃª se lembra, no <b>Capsicum, o</b> recurso tambÃ©m possui esses bits extras, indicando a classe de operaÃ§Ãµes que podem ser executadas para um determinado descritor de arquivo.  Assim, eles assumem basicamente que o descritor de arquivo Ã© 0. Aponta para o <b>terminal do</b> usuÃ¡rio tty.  Inicialmente, era apenas um ponteiro direto para a estrutura <b>tty</b> no kernel.  Para limitar o tipo de operaÃ§Ãµes que podem ser executadas para esse descritor, eles introduziram alguma estrutura beta intermediÃ¡ria de recursos no meio.  Portanto, o descritor de arquivo aponta para essa estrutura de recursos e jÃ¡ aponta para o arquivo real que vocÃª estÃ¡ tentando acessar.  E essa estrutura de recursos contÃ©m alguns bits ou permissÃµes restritivos para um objeto descritor de arquivo que pode ser implementado. <br><br>  Assim, com a entrada de dados padrÃ£o no <b>tcpdump,</b> vocÃª nÃ£o pode fazer nada com ele.  VocÃª pode apenas ver que existe, e Ã© isso.  Para o descritor do arquivo de saÃ­da, eles forneceram uma oportunidade quando vocÃª pode gravar algo nele, mas nÃ£o pode alterar o registro, ou seja, nÃ£o Ã© possÃ­vel cancelar as alteraÃ§Ãµes feitas. <br><br><img src="https://habrastorage.org/webt/cg/-4/p5/cg-4p5ivw8r8yde-rotszxgxn2a.jpeg"><br><br>  EntÃ£o, o que mais vocÃª poderia se preocupar em lanÃ§ar <b>a sandbox</b> ?  Penso no estado do descritor de arquivo.  Mais alguma coisa importa?  Eu acho que no <b>Unix</b> sÃ£o descritores de arquivos e memÃ³ria. <br><br>  Outra coisa Ã© que esses caras estÃ£o preocupados com o fato de que no seu espaÃ§o de endereÃ§o possa haver dados confidenciais alocados anteriormente.  E o processo que vocÃª vai isolar na caixa de areia pode ler toda a memÃ³ria disponÃ­vel.  Portanto, se houver algum tipo de senha que vocÃª verificou anteriormente, quando o usuÃ¡rio efetuar login e vocÃª ainda nÃ£o tiver limpado a memÃ³ria, esse processo poderÃ¡ lÃª-la e fazer algo "interessante". <br><br>  Eles resolveram esse problema da seguinte maneira: no <b>lch_start,</b> vocÃª precisa executar um programa "novo".  VocÃª pega o programa e empacota todos os argumentos nele, todos os descritores de arquivos que deseja fornecer.  Em seguida, vocÃª inicia um novo processo ou inicia a operaÃ§Ã£o de reinicializaÃ§Ã£o de todo o espaÃ§o de memÃ³ria virtual.  E nÃ£o hÃ¡ dÃºvida de que esse processo nÃ£o receberÃ¡ privilÃ©gios adicionais para afetar o conjunto de dados confidenciais.  Isso Ã© exatamente o que vocÃª passou para a funÃ§Ã£o <b>lch_start</b> , em termos de nomes binÃ¡rios, argumentos e recursos do programa. <br><br>  <b>PÃºblico: o</b> que acontece se o processo iniciado contiver <b>setuid</b> binÃ¡rio <b>= 0</b> ? <br><br>  <b>Professor:</b> Eu acho que esses caras nÃ£o usam "binÃ¡rios" <b>setuid</b> no modo de recurso para evitar algumas interaÃ§Ãµes estranhas que possam aparecer.  Eles implementam esta regra: vocÃª pode ter um programa <b>setuid</b> que obtÃ©m seus privilÃ©gios do binÃ¡rio <b>setuid</b> e, em seguida, pode chamar <b>cap_enter</b> ou <b>lch_start</b> .  Mas depois que vocÃª entra no modo de recursos, nÃ£o pode restaurar preferÃªncias adicionais. <br><br>  Em princÃ­pio, isso poderia funcionar, mas seria muito estranho.  Porque, se vocÃª se lembrar, a Ãºnica coisa em que o <b>UID</b> importa quando vocÃª estÃ¡ no modo de recurso Ã© abrir arquivos dentro de um diretÃ³rio.  Portanto, nÃ£o estÃ¡ claro se esse Ã© realmente um excelente plano para obter privilÃ©gios adicionais ou se hÃ¡ falhas nele. <br><br>  <b>PÃºblico:</b> Anteriormente, falamos sobre por que a biblioteca nÃ£o suporta realmente uma separaÃ§Ã£o estrita entre os dois fatores de seguranÃ§a.  Mas nÃ£o precisamos usar <b>lch_start</b> ? <br><br>  <b>Professor:</b> isso mesmo.  Suponha que vocÃª tenha algo como <b>tcpdump</b> ou <b>gzip</b> - essa Ã© outra coisa com a qual eles trabalham.  VocÃª supÃµe que o aplicativo provavelmente nÃ£o esteja comprometido, e hÃ¡ alguma funÃ§Ã£o bÃ¡sica do aplicativo e se preocupa com o modo como ele se comporta na caixa de proteÃ§Ã£o.  No caso do <b>tcpdump,</b> Ã© uma anÃ¡lise de pacotes provenientes da rede; no caso do <b>gzip</b> , estÃ¡ descompactando arquivos.  E atÃ© certo ponto, vocÃª assume que o processo estÃ¡ fazendo tudo certo e que nÃ£o haverÃ¡ vulnerabilidades.  Portanto, vocÃª confia nele para executar <b>lch_start</b> e acredita que ele criarÃ¡ a imagem corretamente, configurarÃ¡ corretamente todos os recursos e se limitarÃ¡ a qualquer outra chamada de sistema fora do modo de recursos. <br><br>  E entÃ£o vocÃª lanÃ§a coisas perigosas.  Mas atÃ© entÃ£o a instalaÃ§Ã£o estava correta e vocÃª nÃ£o tem como sair dessa sandbox.  EntÃ£o, acho que vocÃª precisa ver como realmente pode usar o modo de recurso para aplicativos sandbox. <br><br>  EntÃ£o conversamos um pouco sobre o <b>tcpdump</b> .  Como vocÃª isola esse processo?  Outro exemplo interessante Ã© o programa <b>gzip</b> , que compacta e descompacta arquivos.  EntÃ£o, por que eles estÃ£o preocupados com a caixa de areia?  Acho que eles estÃ£o preocupados com o fato de o cÃ³digo de descompactaÃ§Ã£o poder ser potencialmente defeituoso ou com erros no gerenciamento de memÃ³ria, gerenciamento de buffer durante a descompactaÃ§Ã£o etc. <br><br><img src="https://habrastorage.org/webt/rg/0p/fj/rg0pfjhm0nsvzqfxtmemlhvwoq8.jpeg"><br><br>  Outra questÃ£o interessante Ã© por que as alteraÃ§Ãµes no <b>gzip</b> parecem muito mais complicadas do que no <b>tcpdump</b> ?  Eu acho que isso se deve Ã  forma como o aplicativo Ã© estruturado internamente, certo?  Portanto, se vocÃª tiver um aplicativo que simplesmente compactou ou descompactou um arquivo, Ã© normal iniciÃ¡-lo sem alterÃ¡-lo no modo de recursos.  VocÃª simplesmente atribui um novo padrÃ£o para descompactar algo, e o padrÃ£o fornece dados descompactados na saÃ­da, e isso funcionarÃ¡ bem. <br><br>  O problema, como quase sempre acontece com esses mÃ©todos de sandbox, Ã© que o aplicativo realmente tem uma lÃ³gica de processo muito mais complexa.  Por exemplo, o <b>gzip</b> pode compactar vÃ¡rios arquivos de uma vez e assim por diante.  E, nesse caso, vocÃª tem algum tipo de processo de lideranÃ§a no inÃ­cio do aplicativo, que na verdade possui direitos adicionais para abrir vÃ¡rios arquivos, compactÃ¡-los e assim por diante.  E a lÃ³gica principal geralmente precisa ser outro processo de suporte.  No caso do <b>gzip, o</b> aplicativo nÃ£o foi estruturado para que a compactaÃ§Ã£o e descompactaÃ§Ã£o atuassem como processos separados.  Portanto, eles tiveram que mudar a implementaÃ§Ã£o do kernel <b>gzip</b> e alguma estrutura do prÃ³prio aplicativo, para que, alÃ©m de apenas passar dados para a funÃ§Ã£o de descompressÃ£o, eles fossem enviados por uma chamada <b>RPC</b> ou realmente gravados em algum tipo de descritor de arquivo.  Isso foi para evitar problemas de terceiros e descompactar praticamente sem privilÃ©gios.  A Ãºnica coisa que o <b>gzip</b> poderia fazer ao mesmo tempo era retornar os dados descompactados ou compactados para o processo que o chamou. <br><br>  Outra coisa de liÃ§Ã£o de casa Ã© como vocÃª realmente usa <b>Capsicum</b> no <b>OKWS</b> ?  O que vocÃª acha disso?  Seria Ãºtil?  O pessoal do <b>OKWS ficaria</b> feliz em atualizar para o <b>FreeBSD</b> porque Ã© muito mais fÃ¡cil de usar?  Como vocÃª usaria <b>Capsicum</b> no <b>FreeBSD</b> ? <br><br>  <b>PÃºblico:</b> Pode-se livrar-se de algumas restriÃ§Ãµes estritas. <br><br>  <b>Professor:</b> sim, podemos substituÃ­-los completamente pela presenÃ§a de um diretÃ³rio de descritores e recursos de arquivos.  VocÃª nÃ£o precisaria configurar um <b>chroot</b> confuso.  Em vez de usar o <b>chroot</b> com muitas pequenas coisas, vocÃª pode definir permissÃµes com cuidado.  VocÃª pode simplesmente abrir os arquivos exatos que precisa.  EntÃ£o isso parece uma grande vantagem. <br><br>  Em seguida, no <b>OKWS</b> , vocÃª tem o serviÃ§o de inicializaÃ§Ã£o <b>OK</b> , que deve iniciar todos os processos pai.  Assim que eles morrem, o sinal volta ao <b>okld</b> para reiniciar o processo "morto".  E isso teria que ser executado como <b>root</b> , porque ele tinha que isolar os processos na caixa de areia.  Mas hÃ¡ vÃ¡rias coisas no <b>OKWS</b> que podem ser melhoradas com <b>Capsicum</b> . <br><br>  Por exemplo, vocÃª pode fornecer ao <b>okld</b> muito menos privilÃ©gios.  Porque, por exemplo, para obter a porta 80, vocÃª precisa de privilÃ©gios de root.  Mas depois disso, vocÃª pode colocar com seguranÃ§a todo o resto na sandbox, porque os direitos de root nÃ£o sÃ£o mais necessÃ¡rios.  EntÃ£o Ã© bem legal.  Talvez vocÃª possa atÃ© delegar ao processo o direito de responder Ã s solicitaÃ§Ãµes de outra pessoa, por exemplo, um processo de monitoramento do sistema que apenas possui esse descritor de processo ou descritor de processo para o processo filho e, sempre que esse processo falha, ele inicia um novo.  Portanto, acho que a capacidade de criar uma caixa de proteÃ§Ã£o sem privilÃ©gios de root Ã© muito Ãºtil. <br><br>  <b>PÃºblico-alvo:</b> vocÃª pode atribuir a cada processo um descritor de arquivo que permita adicionar apenas entradas ao log. <br><br>  <b>Professor:</b> sim, e isso Ã© muito legal.  Como dissemos na Ãºltima vez, o <b>oklogd</b> pode "bagunÃ§ar" o arquivo de log.  E quem sabe o que o kernel permitirÃ¡ que ele faÃ§a quando tiver o descritor de arquivo do prÃ³prio arquivo de log.  No entanto, podemos determinar com mais precisÃ£o os recursos do descritor de arquivo, fornecendo um arquivo de log e indicando que ele pode apenas gravar, mas nÃ£o procurar nada.  Assim, obtemos a funÃ§Ã£o somente acrÃ©scimo se vocÃª Ã© apenas um "escritor" para este arquivo.  Ã‰ muito conveniente  VocÃª pode conceder ao processo permissÃµes para gravar no arquivo, mas nÃ£o lÃª-lo, o que Ã© muito difÃ­cil de fazer usando apenas <b>as</b> permissÃµes do <b>Unix</b> . <br><br>         <b>Capsicum</b> ? <br><br> <b>:</b>  , ,   ,        .     ,       ,  ,       . <br><br> : ,  .   <b>Capsicum</b> ,   ,      .           . <br><br> <b>:</b> ,     ,  okld      .      ,    . <br><br> <b>:</b>  ,      .   .     ,    ,   <b>Capability</b>      ,       .   ,     ,   ,   , ,        . <br>   ,         <b>OKWS</b> .               . , ,        ,    .    . <br><br> ,      ,   Â«Â».     ,       .  ,  ,         ,    ,       .        . <br> :    Â«Â»   ,      ,   ? <br><br> : ,   <b>FreeBSD</b>   .   ,     -   ,     .  <b>FreeBSD</b>     <b>Casper</b> ,    ,   <b>Capability</b> .            ,   Â«Â». <br><br>      - ,    ,  ,  - ,        ,  <b>Casper</b>    . <br><br><img src="https://habrastorage.org/webt/pj/hd/aw/pjhdaw8gumxqioaoawbwert89ks.jpeg"><br><br>      ,    Â«Â»     .   . ,     ,     ,   <b>Casper</b>     - . <br><br>   ,         ,       -  .    ,   <b>Unix</b>         <b>FD</b> .      ,      .  ,        ,    . <br><br>  ,       <b>FreeBSD</b> ,      <b>DNS</b> .       <b>DNS</b> -,   Â«Â».    ,    <b>tcpdump</b> .    tcpdump   ,        IP-.   ,   ,     <b>DNS</b> -. <br><br>  , ,     DNS-      DNS-,    .    <b>Casper</b> ,      DNS-. <br><br>  ,     ,   ,     Capsicum?    ?       ?       ,   ,    .         <b>Capsicum</b> ,    ? <br><br>     tcpdump  <b>GZIP</b> ,  ,   .            ? <br><br><img src="https://habrastorage.org/webt/yn/u5/ov/ynu5ovmtuqxeqgmma5p7hnhhwrg.jpeg"><br><br> <b>:</b> ,    ,   ,  . ,      <b>Capability</b> . <br><br> <b>:</b> ,  .      <b>Capsicum</b>  ,    ,    .  ,    ,        .  ,   ,   ,    ,    <b>Capsicum</b> ,   . <br><br>     ,          Â«Â». ,  <b>TCP â€” helper</b> , ,  , ,    .    ,  ,  ,    . <br><br> <b>:</b>  ,             . <br><br> <b>:</b> , .        . ,          .    <b>lth_start</b> ,      .  ,   ,      ,     - . <br><br>  ,   ,  Capsicum        .    ,       ,   ,             .    Unix    -    ,      . <br><br>          ,     . ,               .  ,          ,    .   ,    . <br><br> ,   Chrome      .  ,     ,       ,        Unix,  -,     <b>Unix</b> . <br><br> ,      ? <br><br> <b>:</b>            . <br><br> <b>:</b> .       .    ,    .      ,       , ,                 ,     . <br><br>     <b>Unix</b>     ,      .  ,        .    ,              .        .      ,     . <br><br>     .  <b>Linux</b>  ,  <b>setcall</b> ,     ,    .  ,    <b>Capsicum</b> ,        ,  <b>Capsicum</b>     ,     .   <b>Linux</b>  <b>setcall</b>     ,   .    ,   ,      <b>Linux</b> . <br><br> ,    â€”    , ,      ,     ,        .   ,      -  ,     Â«//Â»,       .        <b>Capsicum</b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> onde vocÃª pode iniciar o processo para um arquivo especÃ­fico e nÃ£o para o diretÃ³rio pessoal inteiro. </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/MlWK2YbZRZ8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A versÃ£o completa do curso estÃ¡ disponÃ­vel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br>  Obrigado por ficar conosco.  VocÃª gosta dos nossos artigos?  Deseja ver materiais mais interessantes?  Ajude-nos fazendo um pedido ou recomendando a seus amigos, um <b>desconto de 30% para os usuÃ¡rios da Habr em um anÃ¡logo exclusivo de servidores bÃ¡sicos que inventamos para vocÃª:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Toda a verdade sobre o VPS (KVM) E5-2650 v4 (6 nÃºcleos) 10GB DDR4 240GB SSD 1Gbps de US $ 20 ou como dividir o servidor?</a>  (as opÃ§Ãµes estÃ£o disponÃ­veis com RAID1 e RAID10, atÃ© 24 nÃºcleos e atÃ© 40GB DDR4). <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 meses de graÃ§a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ao pagar por um novo Dell R630 por um perÃ­odo de seis meses - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 x HDD Intel Deca-Core Xeon E5-2630 v4 / 128GB DDR4 / 4x1TB ou SSD 2x240GB / 1Gbps 10 TB - de US $ 99,33 por mÃªs</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , apenas atÃ© o final de agosto, faÃ§a o pedido pode estar </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br>  <b>Dell R730xd 2 vezes mais barato?</b>  Somente nÃ³s temos <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2 TVs Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 a partir de US $ 249</a> na Holanda e nos EUA!</b>  Leia sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como criar um prÃ©dio de infraestrutura.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">classe usando servidores Dell R730xd E5-2650 v4 custando 9.000 euros por um centavo?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt418221/">https://habr.com/ru/post/pt418221/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt418211/index.html">Curso MIT "SeguranÃ§a de sistemas de computadores". Palestra 4: â€œCompartilhando PrivilÃ©giosâ€, Parte 3</a></li>
<li><a href="../pt418213/index.html">Curso MIT "SeguranÃ§a de sistemas de computadores". Palestra 5: â€œDe onde vÃªm os sistemas de seguranÃ§aâ€, parte 1</a></li>
<li><a href="../pt418215/index.html">Curso MIT "SeguranÃ§a de sistemas de computadores". Aula 5: â€œDe onde vÃªm os erros do sistema de seguranÃ§aâ€, Parte 2</a></li>
<li><a href="../pt418217/index.html">Curso MIT "SeguranÃ§a de sistemas de computadores". Palestra 6: â€œOportunidadesâ€, parte 1</a></li>
<li><a href="../pt418219/index.html">Curso MIT "SeguranÃ§a de sistemas de computadores". Palestra 6: Oportunidades, Parte 2</a></li>
<li><a href="../pt418223/index.html">Curso MIT "SeguranÃ§a de sistemas de computadores". Palestra 7: A Sandbox do Cliente Nativo, Parte 1</a></li>
<li><a href="../pt418225/index.html">Curso MIT "SeguranÃ§a de sistemas de computadores". Palestra 7: Sandbox do Cliente Nativo Parte 2</a></li>
<li><a href="../pt418227/index.html">Curso MIT "SeguranÃ§a de sistemas de computadores". Palestra 7: A Sandbox do Cliente Nativo, Parte 3</a></li>
<li><a href="../pt418229/index.html">Curso MIT "SeguranÃ§a de sistemas de computadores". Aula 8: Modelo de SeguranÃ§a de Rede, Parte 1</a></li>
<li><a href="../pt418233/index.html">MnemÃ´nicos da BMW para encontrar valores-limite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>