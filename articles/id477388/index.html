<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>❎ 🧗🏼 🌬️ NILFS2 - sistem file antipeluru untuk / rumah 🍬 ⏏️ 🖖🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seperti yang Anda tahu, jika masalah bisa terjadi, maka itu akan terjadi. Mungkin, semua orang memiliki kasus ketika file penting baru terhapus secara...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>NILFS2 - sistem file antipeluru untuk / rumah</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/477388/"><img src="https://habrastorage.org/webt/kb/yr/gu/kbyrgu_gfsr0kcqjrxmnu-l3oic.png"><br><br>  Seperti yang Anda tahu, jika masalah bisa terjadi, maka itu akan terjadi.  Mungkin, semua orang memiliki kasus ketika file penting baru terhapus secara tidak sengaja, atau teks dalam editor teks secara tidak sengaja dipilih dan dihapus. <br><br>  Jika Anda adalah hoster atau pemilik situs, maka Anda mungkin menghadapi peretasan akun pengguna atau situs Anda.  Dalam kasus seperti itu, penting untuk mengembalikan kronologi, menemukan cara penetrasi dan kerentanan yang digunakan penyerang. <br><br>  Untuk mengatasi masalah seperti itu, sistem file NILFS2 sempurna. <br><a name="habracut"></a><br>  Telah hadir di kernel Linux sejak versi 2.6.30. <br><br>  Fitur dari sistem file ini adalah mirip dengan sistem kontrol versi: Anda selalu dapat memutar kembali kondisi sistem dan melihat seperti apa beberapa waktu lalu. <br><br>  Untuk menyediakan fungsionalitas ini, Anda tidak perlu mengonfigurasi skrip Cron, membuat snapshot, dll.  Sistem file NILFS2 melakukan ini dengan sendirinya.  Dia tidak pernah menimpa data lama dan selalu menulis ke area baru disk jika ada cukup ruang disk kosong.  Sesuai sepenuhnya dengan prinsip Copy-on-Write. <br><br>  Faktanya, setiap perubahan pada file memerlukan pembuatan otomatis snapshot baru dari sistem file, sehingga Anda dapat menggunakan sistem file ini sebagai mesin waktu dan memundurkan status file. <br><br><h2>  Ceritanya </h2><br><img src="https://habrastorage.org/webt/pt/gh/1r/ptgh1rcdscjbdoogumo8pu_dbcw.jpeg" align="right">  NILFS2 dikembangkan di perut <a href="https://ru.wikipedia.org/wiki/Nippon_Telegraph_and_Telephone">Nippon Telegraph dan Telephone Corporation</a> , pada kenyataannya, negara (memiliki saham pengendali) dan perusahaan telekomunikasi terbesar di Jepang.  Lebih khusus lagi, Laboratorium CyberSpace dipimpin oleh <a href="https://github.com/konis">Ryusuke Konishi</a> . <br><br>  Mengapa ini dikembangkan secara khusus - tidak diketahui, namun, dapat diasumsikan bahwa FS seperti itu, dengan fungsionalitas "mesin waktu", sangat ideal untuk menyimpan data di mana Anda mungkin ingin menggali lebih dalam ke layanan khusus untuk memutar ulang seluruh gambar SMS, email, dll. <br><br>  NILFS2 juga, berpotensi, alat yang sangat berharga untuk layanan keamanan internal, karena memungkinkan Anda untuk memulihkan semua surat yang dihapus dalam basis data surat, membuka tiang-tiang karyawan yang kemudian dapat mencoba menyamarkan mereka dengan menghapus atau mengubah file mereka. <br><br><div class="spoiler">  <b class="spoiler_title">Bagaimana saya bisa melacak seluruh sejarah korespondensi</b> <div class="spoiler_text"> Di Linux, di server (dan ada baiknya menempatkan NILFS2 di sana untuk tujuan keamanan internal), metode file untuk menyimpan email sering digunakan untuk menyimpan pesan email.  Format yang disebut <a href="https://ru.wikipedia.org/wiki/Maildir">Maildir</a> .  Cukup menginstal <a href="http://www.courier-mta.org/">Server Surat Kurir</a> dan mengkonfigurasi penyimpanan surat di Maildir.  Format <a href="https://ru.wikipedia.org/wiki/Mbox">mbox</a> lainnya adalah file teks besar yang mudah diurai menjadi pesan individual. <br><br>  Jika server email menggunakan basis data, maka NILFS2 akan memungkinkan untuk mengembalikan waktu yang tepat dari perubahan basis data dan kemampuan untuk memulihkan basis data pada titik-titik ini.  Dan kemudian Anda perlu menggunakan alat basis data untuk melihat apa yang ada di dalamnya pada saat itu ... <br></div></div><br>  Namun, ada yang tidak beres.  Entah pemerintah Jepang memutuskan untuk tidak mengikuti semua orang (prinsip a la Yarovaya), atau kinerja NILFS2 pada HDD tradisional ternyata lebih rendah daripada alas tiang, dan NILFS2 dirilis di bawah lisensi GPL dan dengan cepat memasuki kernel Linux, karena ada keluhan khusus tentang kode yang dituliskan sangat terampil Jepang, pengembang kernel Linux tidak punya. <br><br><h2>  Seperti apa NILFS2? </h2><br>  Dari sudut pandang penggunaan: pada sistem kontrol versi <a href="https://ru.wikipedia.org/wiki/Subversion">SVN</a> .  Setiap pos pemeriksaan FS adalah komit yang dibuat secara otomatis tanpa sepengetahuan pengguna pada perubahan apa pun: apakah menghapus, mengubah isi file atau hak akses.  Setiap komit memiliki angka yang meningkat secara linear. <br><br>  Dari sudut pandang programmer: pada buffer melingkar.  Sistem file menyimpan perubahan dan menulisnya ke bagian yang sama dengan sekitar 8 MB (2048 * 4096, di mana 2048 adalah jumlah elemen dalam blok, dan 4096 adalah ukuran halaman memori).  Seluruh disk dibagi menjadi potongan-potongan seperti itu.  Rekaman dalam urutan.  Ketika ruang kosong habis, gambar tertua dihapus, dan potongan ditimpa. <br><br><h2>  Basic NILFS2 Buns </h2><br><ul><li>  Versi !!! </li><li>  Prosedur untuk memulihkan sistem file setelah kegagalan adalah dasar: ketika memuat, ia mencari potongan terakhir yang memiliki checksum yang benar dan menginstal superblock di atasnya.  Ini hampir merupakan operasi instan. </li><li>  Karena fakta bahwa rekaman selalu berjalan secara linear, maka: <br><br><ul><li>  dapat menunjukkan hasil yang baik saat bekerja pada SSD, dengan perekaman acak yang lambat. </li><li>  NILFS2 menghemat sumber daya SSD karena hampir tidak ada pengganda rekaman. <br><div class="spoiler">  <b class="spoiler_title">Lebih tepatnya, tidak lebih dari 2.</b> <div class="spoiler_text">  Faktanya adalah bahwa selama penulisan ulang siklik dari seluruh disk, NILFS2 akan mentransfer data yang tidak dapat diubah ke bagian baru (potongan). <br><br>  Jika kami memiliki 10% data yang tidak berubah pada disk, maka kami akan mendapatkan peningkatan 10% dalam perekaman dengan 1 penulisan ulang penuh.  Nah, peningkatan 50% dengan perangkat penuh 50% untuk 1 penulisan ulang penuh disk. <br><br>  Gain perekaman maksimum adalah 2. Ini sangat kecil mengingat semuanya ditulis secara berurutan.  Secara umum, animasi catatan akan kurang dari sistem file terfragmentasi biasa dengan sektor 4096 byte.  (Mengomentari pikiran). </div></div></li></ul><br></li><li>  Potensi kemudahan replikasi ke NILFS2 FS jarak jauh </li></ul><br><h2>  NILFS2 untuk / rumah </h2><br>  Dalam sistem operasi mirip Unix, sebagai aturan, ada folder / home tempat data pengguna disimpan.  Berbagai program menyimpan pengaturannya terkait dengan pengguna tertentu dalam folder ini. <br><br>  Dan siapa, jika bukan pengguna, paling sering memotong?  Karena itu, seperti yang mereka katakan, Tuhan sendiri memerintahkan untuk menggunakan NILFS2 di / rumah. <br><br>  Terlebih lagi, dengan penyebaran SSD yang luas, kita sekarang tidak dapat khawatir tentang penarikan yang kuat ketika menggunakan sistem file CoW. <br><br>  Ya, kami dapat membuat snapshot FS sesering yang kami suka di ZFS dan BTRFS, tetapi selalu ada risiko bahwa perubahan file yang hilang akan berada di antara snapshots.  Dan gambar-gambar masih perlu dikelola: hapus yang lama.  Dalam NILFS2, semua ini terjadi secara otomatis, setiap beberapa detik. <br><br>  Saya membuat volume logis menggunakan lvcreate (dalam grup volume nvme, kumpulan tipis tipis).  Saya sarankan untuk membuatnya pada volume lvm, karena nanti dapat dengan mudah diperluas.  Saya merekomendasikan memiliki 50% ruang disk kosong dengan NILFS2 untuk kedalaman versi yang layak. <br><br><pre><code class="bash hljs">lvcreate -V10G -T nvme/thin -n home</code> </pre> <br>  dan memformatnya dalam NILFS2: <br><br><pre> <code class="bash hljs">mkfs.nilfs2 -L nvme_home /dev/nvme/home mkfs.nilfs2 (nilfs-utils 2.1.5) Start writing file system initial data to the device      Blocksize:4096 Device:/dev/nvme/home1 Device Size:10737418240 File system initialization succeeded !!</code> </pre><br>  Setelah itu, Anda perlu menyalin semua data dari saat ini / rumah. <br><br>  Saya melakukan ini segera setelah mem-boot komputer, sebelum memasuki akun saya, dari pengguna root.  Jika saya masuk sebagai pengguna, maka beberapa program akan membuka soket dan file di folder / rumah / pengguna pengguna saya, yang akan membuat penyalinan menjadi sulit.  Seperti yang Anda ketahui, folder home untuk pengguna root biasanya terletak di path / root, jadi tidak ada file yang dibuka di bagian / home. <br><br><pre> <code class="bash hljs">mkdir /mnt/newhome mount -t nilfs2 /dev/nvme/home /mnt/newhome cp -a /home/. /mnt/newhome</code> </pre> <br>  <i>Untuk baris terakhir, lihat <a href="https://habr.com/ru/company/ruvds/blog/471092/">artikel</a> .</i> <i><br></i> <br>  Selanjutnya, edit / etc / fstab, yang me-mount sistem file untuk / home, ke <br><br> <code>/dev/disk/by-label/nvme_home /home nilfs2  noatime 0 0</code> <br> <br>  Opsi <code>noatime</code> diperlukan untuk meningkatkan kinerja sehingga atime tidak berubah pada setiap akses file.  Selanjutnya, kita reboot. <br><br><h2>  Jenis gambar di NILFS2. </h2><br>  Snapshot normal tanpa kekebalan penghapusan disebut pos pemeriksaan (pos pemeriksaan atau titik pemulihan). <br>  Sebuah snapshot dengan perlindungan penghapusan otomatis disebut snapshot, kemudian hanya snapshot. <br><br>  Melihat pos-pos pemeriksaan dilakukan dengan menggunakan perintah lscp <br><br>  Lihat snapshot lscp -s <br><br>  Kami dapat membuat snapshot dan pos pemeriksaan sendiri kapan saja menggunakan: <br><br><pre> <code class="bash hljs">mkcp [-s] </code> </pre> <br><h2>  Pulihkan data. </h2><br>  NILFS memungkinkan kita untuk memasang sebanyak mungkin foto lama yang kita butuhkan secara paralel dengan bekerja dengan cabang FS utama.  Tetapi hanya dalam mode baca. <br><br>  Semuanya diatur seperti ini.  Pos pemeriksaan biasa yang dilakukan NILFS2 dapat secara otomatis dihapus kapan saja (ketika ruang disk habis atau dengan aturan nilfs_cleanerd), oleh karena itu, sebelum memasang, kita harus menerjemahkan pos pemeriksaan ke snapshot atau, dalam bahasa Rusia, memperbaiki gambar. <br><br><pre> <code class="bash hljs">chcp ss _</code> </pre> <br>  Setelah itu, kita dapat memasang snapshot, misalnya, seperti ini: <br><br><pre> <code class="bash hljs">mount -t nilfs2 -r -o cp=_ /dev/nvme/home /mnt/nilfs/_</code> </pre> <br>  Kemudian kami menyalin file yang dipulihkan dari snapshot ke / home. <br>  Dan kemudian kami menghapus bendera ketidakteraturan dari gambar, sehingga di masa depan, pengumpul sampah otomatis dapat menghapus data yang sudah usang: <br><br><pre> <code class="bash hljs">chcp cp _</code> </pre> <br><h2>  Utilitas untuk NILFS2 </h2><br>  Tapi ini masalahnya.  Ya, tentu saja, kita dapat membuat sistem file, mengubah ukurannya secara online, melihat daftar poin berantai, membuat dan menghapusnya.  Paket nilfs2-utils menyediakan perangkat minimal pria. <br><br>  Karena NTT membatasi pendanaan, tidak ada utilitas tingkat rendah yang dapat menampilkan riwayat perubahan file dan membuat perbedaan di antara snapshot. <br><br><h2>  Utilitas n2u saya </h2><br>  Untuk mengisi kekosongan ini, saya menulis <a href="https://github.com/sukamenev/nilfs2_tools">utilitas n2u saya</a> , yang dapat menampilkan riwayat perubahan dari file / direktori tertentu: <br><br><pre> <code class="bash hljs">n2u <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> filename</code> </pre> <br>  Outputnya kira-kira seperti ini: <br><br><pre> <code class="bash hljs"> CHECKPOINT DATE TIME TYPE SIZE MODE 1787552 2019-11-24 22:08:00 first 7079 cp 1792659 2019-11-25 23:09:05 changed 7081 cp</code> </pre> <br>  Ini bekerja cukup cepat untuk metode implementasi yang dipilih: ini mencari perbedaan antara file menggunakan metode membagi dua, dengan cepat memasang dan membandingkan file / direktori dalam gambar yang berbeda. <br><br>  Anda dapat mengatur rentang pos pemeriksaan menggunakan kunci <code>-cp CP1:CP2</code> atau <code>-cp {YEAR-MM-DD}:{YEAR-MM-DD}</code> . <br><br>  Anda juga dapat melihat perbedaan antara pos-pos pemeriksaan untuk file atau direktori tertentu: <br><br><pre> <code class="bash hljs">n2u diff -r cp1:cp2 filename</code> </pre> <br>  Anda dapat menampilkan seluruh kronologi perubahan: semua perbedaan antara pos pemeriksaan dari file / direktori tertentu: <br><br><pre> <code class="bash hljs">n2u blame [-r cp1:cp2] filename</code> </pre> <br>  Rentang tanggal dalam perintah ini juga didukung. <br><br><h2>  Menangislah ke pengembang </h2><br>  Ada banyak spesialis di Habré.  Silakan selesaikan NILFS2.  Buat replikasi, perbedaan cepat level rendah antara revisi, reflink, dan barang lainnya! <br><br><h2>  Referensi </h2><br>  <a href="https://nilfs.sourceforge.io/en/index.html">Situs web resmi NILFS</a> . <br><br>  Repositori: <br>  <a href="https://github.com/konis/nilfs2">NILFS2</a> . <br>  <a href="http://github.com/nilfs-dev/">Utilitas dan Modul NILFS2</a> . <br><br>  Nawala: <br>  <a href="http://vger.kernel.org/">Email Pengembang NILFS2</a> .  Pengidentifikasi untuk langganan linux-nilfs. <br>  <a href="https://marc.info/%3Fl%3Dlinux-nilfs">Arsip Buletin</a> . <br><br>  <a href="https://forum.manjaro.org/t/tuning-the-nilfs2-file-system/42943">Panduan konfigurasi Nilfs_cleanerd</a> . <br>  <a href="https://www.phoronix.com/scan.php%3Fpage%3Darticle%26item%3Dlinux-48-hdd">Tes kinerja komparatif EXT4, Btrfs, XFS &amp; NILFS2</a> . <br><hr><br>  Ucapan Terima Kasih: <br><br><ul><li>  Pengembang NILFS2: Ryusuke Konishi, Koji Sato, Naruhiko Kamimura, Seiji Kihara, Yoshiji Amagai, Hisashi Hifumi, dan Satoshi Moriai.  Kontributor utama lainnya adalah: Andreas Rohner, Dan McGee, David Arendt, David Smid, dexen deVries, Dmitry Smirnov, Eric Sandeen, Jiro SEKIBA, Matteo Frigo, Hitoshi Mitake, Takashi Iwai, Vyacheslav Dubeyko. </li><li>  Amblin Entertainment dan Universal Pictures untuk serangkaian film indah mereka <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B0%25D0%25B7%25D0%25B0%25D0%25B4_%25D0%25B2_%25D0%25B1%25D1%2583%25D0%25B4%25D1%2583%25D1%2589%25D0%25B5%25D0%25B5_(%25D1%2581%25D0%25B5%25D1%2580%25D0%25B8%25D1%258F_%25D1%2584%25D0%25B8%25D0%25BB%25D1%258C%25D0%25BC%25D0%25BE%25D0%25B2)">"Back to the Future</a> . <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B0%25D0%25B7%25D0%25B0%25D0%25B4_%25D0%25B2_%25D0%25B1%25D1%2583%25D0%25B4%25D1%2583%25D1%2589%25D0%25B5%25D0%25B5_(%25D1%2581%25D0%25B5%25D1%2580%25D0%25B8%25D1%258F_%25D1%2584%25D0%25B8%25D0%25BB%25D1%258C%25D0%25BC%25D0%25BE%25D0%25B2)">"</a>  Gambar pertama kiriman diambil dari film "Back to the Future - 3". </li><li>  <a href="https://ruvds.com/">Perusahaan-perusahaan RUVDS</a> atas dukungan mereka dan kesempatan untuk mempublikasikan di blog mereka di Habré. </li></ul><br>  Kesalahan <b>PS</b> Direct yang Anda perhatikan di PM.  Saya meningkatkan karma untuk ini. <br><br><hr><br>  Anda dapat bereksperimen dengan NILFS2 dengan memesan mesin virtual dari <a href="https://ruvds.com/">RUVDS</a> untuk kupon di bawah ini.  Untuk semua pelanggan baru, masa percobaan gratis 3 hari. <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id477388/">https://habr.com/ru/post/id477388/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id477374/index.html">Mesin Z yang membingungkan</a></li>
<li><a href="../id477378/index.html">Mixed Agile - Pendekatan Waterfall ketika menerapkan aplikasi bisnis (alias Agile-like)</a></li>
<li><a href="../id477382/index.html">Esports - menghasilkan keuntungan: Mercedes, megaphone, taruhan, dan branding untuk esports</a></li>
<li><a href="../id477384/index.html">Konferensi “Keamanan Informasi. Ancaman masa kini dan masa depan ”</a></li>
<li><a href="../id477386/index.html">Security Week 48: Kebocoran Data Raksasa dan Kerentanan Whatsapp</a></li>
<li><a href="../id477390/index.html">Debugging keterlambatan jaringan di Kubernetes</a></li>
<li><a href="../id477392/index.html">Buka mikrofon: backend. Kami mengundang pembicara</a></li>
<li><a href="../id477396/index.html">Cara mendaftar dalam suatu kursus dan ... lanjutkan ke bagian akhir</a></li>
<li><a href="../id477400/index.html">Tentang profesi manajer produk: bagaimana mencapai yang ideal?</a></li>
<li><a href="../id477402/index.html">Menyebarkan Model Keras Deep Learning sebagai Aplikasi Web Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>