<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úäüèø ü§∞üèΩ üìë Lorsque la vitesse et la mise √† l'√©chelle sont n√©cessaires: serveur d'appareils iOS distribu√©s üö£üèø üï∫üèª üëò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nombreux d√©veloppeurs de tests iOS UI connaissent probablement le probl√®me de l'ex√©cution des tests. Badoo ex√©cute plus de 1 400 tests de bout en b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lorsque la vitesse et la mise √† l'√©chelle sont n√©cessaires: serveur d'appareils iOS distribu√©s</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/423901/"><img src="https://habrastorage.org/webt/8j/f8/63/8jf863oxmvo6waqabyycx6d0hvq.jpeg"><br><br>  De nombreux d√©veloppeurs de tests iOS UI connaissent probablement le probl√®me de l'ex√©cution des tests.  Badoo ex√©cute plus de 1 400 tests de bout en bout pour les applications iOS pour chaque ex√©cution de r√©gression.  Ce sont plus de 40 heures de tests machine qui passent en 30 minutes r√©elles. <br><br>  <b>Nikolai Abalov</b> de Badoo a <b>expliqu√©</b> comment il avait r√©ussi √† acc√©l√©rer l'ex√©cution du test de 1,5 heure √† 30 minutes;  comment ils d√©m√™lent les tests √©troitement li√©s et l'infrastructure iOS en allant sur le serveur de l'appareil;  comment il a facilit√© l'ex√©cution de tests en parall√®le et facilit√© la prise en charge et la mise √† l'√©chelle des tests et de l'infrastructure. <br><br>  Vous d√©couvrirez √† quel point il est facile d'ex√©cuter des tests en parall√®le avec des outils tels que fbsimctl, et comment la s√©paration des tests et de l'infrastructure peut faciliter l'h√©bergement, la prise en charge et la mise √† l'√©chelle de vos tests. <br><a name="habracut"></a><br>  Initialement, Nikolai a pr√©sent√© un rapport lors de la conf√©rence de Heisenbug (vous pouvez regarder la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vid√©o</a> ), et maintenant pour Habr, nous avons fait une version texte du rapport.  Vient ensuite un r√©cit √† la premi√®re personne: <br><br>  Bonjour √† tous, aujourd'hui, je vais parler des tests de mise √† l'√©chelle pour iOS.  Je m'appelle Nicholas, je m'occupe principalement de l'infrastructure iOS chez Badoo.  Avant cela, il a travaill√© pour 2GIS pendant trois ans, s'est engag√© dans le d√©veloppement et l'automatisation, en particulier, il a √©crit Winium.Mobile - une impl√©mentation de WebDriver pour Windows Phone.  J'ai √©t√© emmen√© √† Badoo pour travailler sur l'automatisation de Windows Phone, mais apr√®s un certain temps, l'entreprise a d√©cid√© de suspendre le d√©veloppement de cette plate-forme.  Et on m'a propos√© des t√¢ches int√©ressantes pour l'automatisation d'iOS, √† ce sujet je vais vous le dire aujourd'hui. <br><br>  De quoi allons-nous parler?  Le plan est le suivant: <br><br><ul><li>  Un expos√© informel du probl√®me, une introduction aux outils utilis√©s: comment et pourquoi. </li><li>  Tests parall√®les sur iOS et son √©volution (en particulier, selon l'histoire de notre entreprise, depuis que nous avons commenc√© √† travailler dessus en 2015). </li><li>  Le serveur de p√©riph√©riques est la partie principale du rapport.  Notre nouveau mod√®le de parall√©lisation des tests. </li><li>  Les r√©sultats que nous avons obtenus avec le serveur. </li><li>  Si vous n'avez pas 1500 tests, vous n'avez peut-√™tre pas vraiment besoin d'un serveur de p√©riph√©riques, mais vous pouvez toujours en tirer des choses int√©ressantes, et nous en parlerons.  Ils peuvent √™tre appliqu√©s si vous avez 10 √† 25 tests, ce qui donnera toujours une acc√©l√©ration ou une stabilit√© suppl√©mentaire. </li><li>  Et enfin, un d√©briefing. </li></ul><br><h2>  Les outils </h2><br>  Le premier est un peu sur qui utilise quoi.  Notre pile est un peu non standard, car nous utilisons √† la fois Calabash et WebDriverAgent (ce qui nous donne de la vitesse et des backdoors Calabash lors de l'automatisation de notre application et en m√™me temps un acc√®s complet au syst√®me et aux autres applications via WebDriverAgent).  WebDriverAgent est une impl√©mentation Facebook de WebDriver pour iOS qui est utilis√©e en interne par Appium.  Et Calabash est un serveur int√©gr√© pour l'automatisation.  Nous √©crivons les tests eux-m√™mes sous une forme lisible par l'homme en utilisant Cucumber.  Autrement dit, dans notre soci√©t√© pseudo-BDD.  Et parce que nous avons utilis√© Cucumber et Calabash, nous avons h√©rit√© de Ruby, tout le code est √©crit dessus.  Il y a beaucoup de code et vous devez continuer √† √©crire en Ruby.  Pour ex√©cuter des tests en parall√®le, nous utilisons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">parallel_cucumber</a> , un outil √©crit par un de mes coll√®gues de Badoo. <br><br>  Commen√ßons par ce que nous avions.  Lorsque j'ai commenc√© √† pr√©parer le rapport, il y avait 1200 tests.  Au moment o√π ils ont √©t√© termin√©s, il √©tait 1300. Pendant que je suis arriv√© ici, il y avait d√©j√† 1400 tests, ce sont des tests de bout en bout, pas des tests unitaires et des tests d'int√©gration.  Ils repr√©sentent 35 √† 40 heures de temps informatique sur un seul simulateur.  Ils sont pass√©s plus t√¥t dans une heure et demie.  Je vais vous dire comment ils ont commenc√© √† passer en 30 minutes. <br><br>  Nous avons un flux de travail dans notre entreprise avec des succursales, des examens et des tests en cours sur ces succursales.  Les d√©veloppeurs cr√©ent environ 10 requ√™tes vers le r√©f√©rentiel principal de notre application.  Mais il a √©galement des composants qui sont partag√©s avec d'autres applications, donc parfois il y en a plus de dix.  En cons√©quence, 30 tests par jour au moins.  Depuis que les d√©veloppeurs poussent, ils se rendent compte qu'ils ont commenc√© avec des bugs, recharger, et tout cela commence une r√©gression compl√®te, simplement parce que nous pouvons l'ex√©cuter.  Sur la m√™me infrastructure, nous lan√ßons des projets suppl√©mentaires, tels que Liveshot, qui prend des captures d'√©cran de l'application dans les principaux scripts utilisateur dans toutes les langues, afin que les traducteurs puissent v√©rifier l'exactitude de la traduction, qu'elle s'adapte √† l'√©cran, etc.  En cons√©quence, environ un millier et demi d'heures de temps machine sortent actuellement. <br><br>  Tout d'abord, nous voulons que les d√©veloppeurs et les testeurs fassent confiance √† l'automatisation et s'appuient sur elle pour r√©duire la r√©gression manuelle.  Pour que cela se produise, il est n√©cessaire d'obtenir un fonctionnement rapide et, surtout, stable et fiable √† partir de l'automatisation.  Si les tests r√©ussissent dans une heure et demie, le d√©veloppeur se lassera d'attendre les r√©sultats, il commencera √† faire une autre t√¢che, sa concentration changera.  Et quand certains tests tomberont, il ne sera pas tr√®s content qu'il doive revenir, changer son attention et r√©parer quelque chose.  Si les tests ne sont pas fiables, au fil du temps, les gens commencent √† les percevoir uniquement comme une barri√®re.  Ils tombent constamment, bien qu'il n'y ait pas de bogues dans le code.  Ce sont des tests Flaky, une sorte d'obstacle.  En cons√©quence, ces deux points ont √©t√© divulgu√©s dans ces exigences: <br><br><ul><li>  Les tests devraient prendre 30 minutes ou plus. </li><li>  Ils doivent √™tre stables. </li><li>  Ils doivent √™tre √©volutifs afin que nous puissions ajouter une demi-heure pour ajouter une centaine de tests suppl√©mentaires. </li><li>  L'infrastructure doit √™tre facilement entretenue et d√©velopp√©e. </li><li>  Sur les simulateurs et les appareils physiques, tout devrait commencer de la m√™me mani√®re. </li></ul><br>  Nous effectuons principalement des tests sur des simulateurs, et non sur des appareils physiques, car c'est plus rapide, plus stable et plus facile.  Les appareils physiques ne sont utilis√©s que pour les tests qui l'exigent vraiment.  Par exemple, appareil photo, notifications push et similaires. <br><br>  Comment satisfaire ces exigences et tout bien faire?  La r√©ponse est tr√®s simple: nous supprimons les deux tiers des tests!  Cette solution tient en 30 minutes (car il ne reste qu'un tiers des tests), √©volue facilement (d'autres tests peuvent √™tre supprim√©s) et augmente la fiabilit√© (car la premi√®re chose que nous supprimons est les tests les moins fiables).  C‚Äôest tout pour moi.  Des questions? <br><br>  Mais s√©rieusement, il y a du vrai dans chaque blague.  Si vous avez beaucoup de tests, vous devez les revoir et comprendre ceux qui apportent de r√©els avantages.  Nous avions une t√¢che diff√©rente, nous avons donc d√©cid√© de voir ce qui pouvait √™tre fait. <br><br>  La premi√®re approche consiste √† filtrer les tests en fonction de la couverture ou des composants.  Autrement dit, s√©lectionnez les tests appropri√©s en fonction des modifications de fichiers dans l'application.  Je n'en parlerai pas, mais c'est l'une des t√¢ches que nous r√©solvons actuellement. <br><br>  Une autre option consiste √† acc√©l√©rer et √† stabiliser les tests eux-m√™mes.  Vous passez un test sp√©cifique, voyez quelles √©tapes prennent le plus de temps et si elles peuvent √™tre optimis√©es d'une mani√®re ou d'une autre.  Si certains d'entre eux sont tr√®s instables tr√®s souvent, vous les corrigez, car cela r√©duit les red√©marrages de test, et tout va plus vite. <br><br>  Et, enfin, une t√¢che compl√®tement diff√©rente: parall√©liser les tests, les distribuer sur un grand nombre de simulateurs et fournir une infrastructure √©volutive et stable pour qu'il y ait beaucoup √† parall√©liser. <br><br>  Dans cet article, nous parlerons principalement des deux derniers points et √† la fin, dans les trucs et astuces, nous aborderons le point sur la vitesse et la stabilisation. <br><br><hr><br><h2>  Test parall√®le pour iOS </h2><br>  Commen√ßons par l'histoire des tests parall√®les pour iOS en g√©n√©ral et Badoo en particulier.  Pour commencer, arithm√©tique simple, ici, cependant, il y a une erreur dans la formule si l'on compare les dimensions: <br><br><img src="https://habrastorage.org/webt/65/_e/on/65_eonxg0kf7kpvkttiiigw1-yo.jpeg"><br><br>  Il y a eu 1300 tests pour un simulateur, il s'av√®re que 40 heures.  Puis Satish, mon chef, vient et dit qu'il a besoin d'une demi-heure.  Vous devez inventer quelque chose.  X appara√Æt dans la formule: combien de simulateurs ex√©cuter, pour que tout se passe en une demi-heure.  La r√©ponse est 80 simulateurs.  Et imm√©diatement la question se pose, o√π mettre ces 80 simulateurs, car ils ne rentrent nulle part. <br><br>  Il existe plusieurs options: vous pouvez acc√©der √† des clouds tels que SauceLabs, Xamarin ou AWS Device Farm.  Et vous pouvez penser √† tout √† la maison et bien faire.  √âtant donn√© que cet article existe, nous avons tout bien fait √† la maison.  Nous l'avons d√©cid√©, car un cloud avec une telle √©chelle serait assez cher, et il y avait aussi une situation o√π iOS 10 est sorti et Appium a pris en charge le support pendant pr√®s d'un mois.  Cela signifie que dans SauceLabs pendant un mois, nous n'avons pas pu tester automatiquement iOS 10, ce qui ne nous convenait pas du tout.  De plus, tous les nuages ‚Äã‚Äãsont ferm√©s et vous ne pouvez pas les affecter. <br><br>  Nous avons donc d√©cid√© de tout faire en interne.  Nous avons commenc√© quelque part en 2015, puis Xcode n'a pas pu ex√©cuter plus d'un simulateur.  Il s'est av√©r√© qu'il ne peut pas ex√©cuter plus d'un simulateur sous un m√™me utilisateur sur la m√™me machine.  Si vous avez de nombreux utilisateurs, vous pouvez ex√©cuter autant de simulateurs que vous le souhaitez.  Mon coll√®gue Tim Bawerstock a propos√© un mod√®le sur lequel nous avons v√©cu assez longtemps. <br><br><img src="https://habrastorage.org/webt/ba/24/wv/ba24wvwggc_youxauleaydytmrs.jpeg"><br><br>  Il y a un agent (TeamCity, Jenkins Node et similaires), il ex√©cute parallel_cucumber, qui va simplement aux machines distantes via ssh.  La photo montre deux voitures pour deux utilisateurs.  Tous les fichiers n√©cessaires tels que les tests sont copi√©s et ex√©cut√©s sur des machines distantes via ssh.  Et les tests ex√©cutent d√©j√† le simulateur localement sur le bureau actuel.  Pour que cela fonctionne, vous devez d'abord aller sur chaque machine, cr√©er, par exemple, 5 utilisateurs, si vous voulez 5 simulateurs, cr√©er un utilisateur une connexion automatique, ouvrir le partage d'√©cran pour le reste, afin qu'ils aient toujours un bureau.  Et configurez le d√©mon ssh pour qu'il ait acc√®s aux processus sur le bureau.  D'une mani√®re si simple, nous avons commenc√© √† ex√©cuter des tests en parall√®le.  Mais il y a plusieurs probl√®mes dans cette image.  Premi√®rement, les tests contr√¥lent le simulateur, ils sont au m√™me endroit que le simulateur lui-m√™me.  Autrement dit, ils doivent toujours √™tre ex√©cut√©s sur des coquelicots, ils consomment des ressources qui pourraient √™tre d√©pens√©es pour ex√©cuter des simulateurs.  En cons√©quence, vous avez moins de simulateurs sur la machine et ils co√ªtent plus cher.  Un autre point est que vous devez aller sur chaque machine, configurer les utilisateurs.  Et puis vous tombez simplement sur l'ultime limite mondiale.  S'il y a cinq utilisateurs et qu'ils soul√®vent beaucoup de processus, √† un moment donn√©, les descripteurs se termineront dans le syst√®me.  Apr√®s avoir atteint la limite, les tests commenceront √† tomber lors de l'ouverture de nouveaux fichiers et du d√©marrage de nouveaux processus. <br><br><img src="https://habrastorage.org/webt/jd/dw/pu/jddwputxzxak2en8qhmlu3zkn04.jpeg"><br><br>  En 2016-2017, nous avons d√©cid√© de passer √† un mod√®le l√©g√®rement diff√©rent.  Nous avons regard√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport de Lawrence Lomax</a> de Facebook - ils ont pr√©sent√© fbsimctl, et ont partiellement expliqu√© comment fonctionne l'infrastructure sur Facebook.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Viktor Koronevich</a> a √©galement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publi√©</a> un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport</a> sur ce mod√®le.  L'image n'est pas tr√®s diff√©rente de la pr√©c√©dente - nous venons de nous d√©barrasser des utilisateurs, mais c'est un grand pas en avant, car maintenant il n'y a qu'un seul bureau, moins de processus sont lanc√©s, les simulateurs sont devenus moins chers.  Il y a trois simulateurs dans cette image, pas deux, car les ressources ont √©t√© lib√©r√©es pour en lancer un autre.  Nous avons v√©cu avec ce mod√®le pendant tr√®s longtemps, jusqu'√† la mi-octobre 2017, lorsque nous avons commenc√© √† passer √† notre serveur d'appareils distants. <br><br><img src="https://habrastorage.org/webt/oy/e_/b3/oye_b3yfctrsxuigvdwy0_8atzy.jpeg"><br><br>  Cela ressemblait donc √† du fer.  √Ä gauche, une bo√Æte avec des macbooks.  Pourquoi nous avons effectu√© tous les tests sur eux est une grande histoire distincte.  Ex√©cuter les tests sur les macbooks que nous avons ins√©r√©s dans la bo√Æte en fer n'√©tait pas une bonne id√©e, car quelque part dans l'apr√®s-midi, ils ont commenc√© √† surchauffer, car la chaleur ne part pas bien lorsqu'ils sont en surface.  Les tests sont devenus instables, en particulier lorsque les simulateurs ont commenc√© √† planter lors du chargement. <br><br>  Nous l'avons d√©cid√© simplement: nous avons mis les ordinateurs portables ¬´dans des tentes¬ª, la zone de circulation d'air a augment√© et la stabilit√© de l'infrastructure a soudainement augment√©. <br><br><img src="https://habrastorage.org/webt/mg/ko/em/mgkoemho5h9pftkjtphfaldxqdm.jpeg"><br><br>  Donc, parfois, vous n'avez pas √† vous occuper de logiciels, mais faites tourner des ordinateurs portables. <br><br>  Mais si vous regardez cette image, il y a un d√©sordre de fils, d'adaptateurs et g√©n√©ralement d'√©tain.  C'est la partie en fer, et c'√©tait toujours bon.  Dans le logiciel, une imbrication compl√®te des tests avec l'infrastructure √©tait en cours, et il √©tait impossible de continuer √† vivre comme √ßa. <br><br>  Nous avons identifi√© les probl√®mes suivants: <br><br><ul><li>  Le fait que les tests soient √©troitement li√©s √† l'infrastructure, lancent des simulateurs et g√®rent l'ensemble de leur cycle de vie. </li><li>  Cela a rendu la mise √† l'√©chelle difficile, car l'ajout d'un nouveau n≈ìud impliquait sa configuration pour les tests et l'ex√©cution de simulateurs.  Par exemple, si vous souhaitez mettre √† jour Xcode, vous devez ajouter une solution de contournement directement aux tests, car ils s'ex√©cutent sur diff√©rentes versions de Xcode.  Certains si des tas semblent ex√©cuter le simulateur. </li><li>  Les tests sont li√©s √† la machine o√π se trouve le simulateur, et cela co√ªte un sou, car ils doivent √™tre ex√©cut√©s sur des coquelicots au lieu de * nix, qui sont moins chers. </li><li>  Et c'√©tait toujours tr√®s facile de se plonger dans le simulateur.  Dans certains tests, nous sommes all√©s dans le syst√®me de fichiers du simulateur, avons supprim√© certains fichiers ou les avons modifi√©s, et tout s'est bien pass√© jusqu'√† ce qu'il soit fait de trois mani√®res diff√©rentes dans trois tests diff√©rents, puis de mani√®re inattendue, le quatri√®me a commenc√© √† planter s'il n'avait pas de chance de d√©marrer apr√®s ces trois-l√†. </li><li>  Et le dernier moment - les ressources n'ont pas √©t√© fouill√©es en aucune fa√ßon.  Par exemple, il y avait quatre agents TeamCity, cinq machines √©taient connect√©es √† chacun et les tests ne pouvaient √™tre ex√©cut√©s que sur leurs cinq machines.  Il n'y avait pas de syst√®me centralis√© de gestion des ressources, de ce fait, lorsqu'une seule t√¢che arrive, elle est all√©e sur cinq machines, et les 15 autres √©taient inactives.  Pour cette raison, les builds ont pris tr√®s longtemps. </li></ul><br><hr><br><h2>  Nouveau mod√®le </h2><br>  Nous avons d√©cid√© de passer √† un beau nouveau mod√®le. <br><br><img src="https://habrastorage.org/webt/kl/is/rm/klisrmoqwnidkdpj0bqbdemsa1g.jpeg"><br><br>  Suppression de tous les tests sur une seule machine, o√π l'agent TeamCity.  Cette machine peut maintenant √™tre sur * nix ou m√™me sur Windows si vous le souhaitez.  Ils communiqueront via HTTP avec quelque chose que nous appellerons serveur d'appareil.  Tous les simulateurs et les appareils physiques seront situ√©s quelque part l√†-bas, et les tests s'ex√©cuteront ici, demander l'appareil via HTTP et continuer √† travailler avec.  Le diagramme est tr√®s simple, il n'y a que deux √©l√©ments dans le diagramme. <br><br><img src="https://habrastorage.org/webt/rj/mg/vl/rjmgvlykdmj4v6inlblbn20nrs0.jpeg"><br><br>  En r√©alit√©, bien s√ªr, ssh et plus sont rest√©s derri√®re le serveur.  Mais maintenant, cela ne d√©range personne, car les gars qui √©crivent les tests sont en haut de ce diagramme, et ils ont une sorte d'interface sp√©cifique pour travailler avec un simulateur local ou distant, donc ils vont bien.  Et maintenant je travaille en dessous, et j'ai tout comme √ßa.  Nous devons vivre avec. <br><br>  Qu'est-ce que √ßa donne? <br><br><ul><li>  Tout d'abord, la r√©partition des responsabilit√©s.  √Ä un moment donn√© du test de l'automatisation, vous devez le consid√©rer comme un d√©veloppement normal.  Il utilise les m√™mes principes et approches que les d√©veloppeurs utilisent. </li><li>  Le r√©sultat est une interface strictement d√©finie: vous ne pouvez pas faire quelque chose directement avec le simulateur, pour cela, vous devez ouvrir un ticket dans le serveur de p√©riph√©riques, et nous allons voir comment le faire de mani√®re optimale sans casser d'autres tests. </li><li>  L'environnement de test est devenu moins cher parce que nous l'avons augment√© dans * nix, qui sont beaucoup moins chers que les coquelicots de service. </li><li>  Et le partage des ressources est apparu, car il y a une seule couche avec laquelle tout le monde communique, il peut planifier la distribution des machines situ√©es derri√®re, c'est-√†-dire  partager les ressources entre les agents. </li></ul><br><img src="https://habrastorage.org/webt/co/2d/kf/co2dkfppgemvysgg4sescmoeiuy.jpeg"><br><br>  Ci-dessus est repr√©sent√©, comme c'√©tait le cas auparavant.  √Ä gauche, des unit√©s de temps conventionnelles, disons des dizaines de minutes.  Il y a deux agents, 7 simulateurs sont connect√©s √† chacun, au moment o√π 0 build arrive et prend 40 minutes.  Apr√®s 20 minutes, un autre arrive et prend le m√™me temps.  Tout semble super.  Mais l√†, et il y a des carr√©s gris.  Ils signifient que nous avons perdu de l'argent parce que nous n'avons pas utilis√© les ressources disponibles. <br><br><img src="https://habrastorage.org/webt/qh/xo/ls/qhxols1pqnraxnhyasyg6tyzsw0.jpeg"><br><br>  Vous pouvez le faire: la premi√®re version arrive et voit tous les simulateurs gratuits, est distribu√©e et les tests sont acc√©l√©r√©s deux fois.  Il n'y avait rien √† faire.  En r√©alit√©, cela se produit souvent parce que les d√©veloppeurs poussent rarement leurs brunchs au m√™me moment.  Bien que cela se produise parfois, les "pions", les "pyramides" et similaires commencent.  Cependant, dans la plupart des cas, une acc√©l√©ration gratuite peut √™tre obtenue deux fois en installant simplement un syst√®me de gestion centralis√© pour toutes les ressources. <br><br>  Autres raisons de passer √† cela: <br><br><ul><li>  Boxe noire, c'est-√†-dire que maintenant le serveur de p√©riph√©rique est une bo√Æte noire.  Lorsque vous √©crivez des tests, vous ne pensez qu'aux tests et pensez que cette bo√Æte noire fonctionnera toujours.  Si cela ne fonctionne pas, vous allez juste frapper qui devrait le faire, c'est-√†-dire moi.  Et je dois le r√©parer.  Non seulement moi, en fait, plusieurs personnes sont impliqu√©es dans l'ensemble de l'infrastructure. </li><li>  Vous ne pouvez pas g√¢cher l'int√©rieur du simulateur. </li><li>  Vous n'avez pas besoin de mettre un million d'utilitaires sur la machine pour que tout d√©marre - il vous suffit de mettre un utilitaire qui masque tout le travail sur le serveur de p√©riph√©riques. </li><li>  Il est devenu plus facile de mettre √† jour l'infrastructure, dont nous parlerons quelque part √† la fin. </li></ul><br>  Une question raisonnable: pourquoi pas Selenium Grid?  Premi√®rement, nous avions beaucoup de code h√©rit√©, 1 500 tests, 130 000 lignes de code pour diff√©rentes plates-formes.  Et tout cela a √©t√© contr√¥l√© par parallel_cucumber, qui a cr√©√© le cycle de vie du simulateur en dehors du test.  Autrement dit, il y avait un syst√®me sp√©cial qui chargeait le simulateur, attendant qu'il soit pr√™t et le soumettant au test.  Afin de ne pas tout r√©√©crire, nous avons d√©cid√© d'essayer de ne pas utiliser Selenium Grid. <br><br>  Nous avons √©galement de nombreuses actions non standard et nous utilisons tr√®s rarement WebDriver.  La partie principale des tests sur Calabash, et WebDriver uniquement auxiliaire.  Autrement dit, nous n'utilisons pas de s√©l√©nium dans la plupart des cas. <br><br>  Et, bien s√ªr, nous voulions que tout soit flexible, facile √† prototyper.  Parce que tout le projet a commenc√© simplement avec une id√©e qu'ils ont d√©cid√© de tester, mise en ≈ìuvre en un mois, tout a commenc√© et c'est devenu la d√©cision principale de notre entreprise.  Soit dit en passant, nous avons d'abord √©crit en Ruby, puis r√©√©crit le serveur de p√©riph√©riques sur Kotlin.  Les tests se sont av√©r√©s √™tre sur Ruby et le serveur sur Kotlin. <br><br><hr><br><h2>  Serveur d'appareil </h2><br>  Maintenant, en savoir plus sur le serveur de p√©riph√©riques lui-m√™me, comment il fonctionne.  Lorsque nous avons commenc√© √† √©tudier ce probl√®me, nous avons utilis√© les outils suivants: <br><br><ul><li>  xcrun simctl et fbsimctl - utilitaires de ligne de commande pour g√©rer les simulateurs (le premier est officiellement d'Apple, le second de Facebook, il est un peu plus pratique √† utiliser) </li><li>  WebDriverAgent, √©galement de Facebook, afin de lancer des applications en dehors du processus lorsque la notification push arrive ou quelque chose comme √ßa </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ideviceinstaller, pour mettre l'application sur des appareils physiques puis automatiser en quelque sorte sur l'appareil. </font></font></li></ul><br>  ,    device server,  . , fbsimctl       ,   xcrun simctl  ideviceinstaller,      ,   fbsimctl  WebDriverAgent.   - .   :   - ,   Facebook   .  , fbsimctl    .    : <br><br><img src="https://habrastorage.org/webt/c3/hg/s0/c3hgs0o_qahel7f3wvzcyc9ds-u.jpeg"><br><br>      ,    . <br><br><img src="https://habrastorage.org/webt/1a/xb/im/1axbim1aufeap5q2sh-wfepww_i.jpeg"><br><br>    ,     . <br><br>    ? ,   curl  list,        : <br><br><img src="https://habrastorage.org/webt/af/yo/de/afyodekcsgu6v8jgpro6whwsdy4.jpeg"><br><br>     JSON,      ,     .      ,       . <br><br><img src="https://habrastorage.org/webt/iq/pl/bg/iqplbgqpn7kq2zoglk8rt_z6kh8.jpeg"><br><br> , approve ‚Äî      ,   .  open   deep links  .  ,    ,   fbsimctl.  ,      : <br><br><img src="https://habrastorage.org/webt/yq/53/tk/yq53tkhd2w7kpvnxbvsf9st_o-u.jpeg"><br><br>   ,         .   -        .   :       .         ,        ,   . <br><br><ul><li>  ‚Äî       .   liveshot'      iPhone X,   iPhone 5S,         iPhone 6s.           . </li><li>    -   WebDriverAgent   XCUI-     ,    . </li><li>       .      -   iOS 8   ,     ,       .     device server iOS 8,     ,     , -        .     fbsimctl. </li><li> ,       cookies  ,        ,    ,       . </li><li>    ‚Äî   .    ,   device server     ,        ,    ,       ,     .        ,          .        ,   . </li></ul><br><img src="https://habrastorage.org/webt/tp/pr/cg/tpprcgg2k2qawsspzkaiwtgu23m.jpeg"><br><br>     ,   - ,       .   ‚Äî    ,    .   ‚Äî  , ,   ,      . <br><br><img src="https://habrastorage.org/webt/rj/fv/n0/rjfvn0ripc5aocy79heogwzfqko.jpeg"><br><br>     :  Test Runner,       ;  Device Provider,   Device Server,     ; Remote Device ‚Äî     ; Device Server ‚Äî  -.      ,   - -          fbsimctl  WebDriverAgent. <br><br>    ?     Test Runner     capability,  iPhone 6.    Device Provider,    device server,    ,    -           , , ,        .        Device Server   .       RemoteDevice         . <br><br>     ,          fbsimctl.  , ,    headless-.       ,        ,       headless-.  - ,     .  ,    , ,  syslog    SpringBoard       . <br><br>    ,  XCTest,      WebDriverAgent,       healthCheck,   WebDriverAgent   ,      .      ,   ¬´ready¬ª  .       healthCheck.          ,    . <br><br><img src="https://habrastorage.org/webt/8j/-3/fz/8j-3fzvwjrjcth5do9mbdi74qqg.jpeg"><br><br>            fbsimctl.   .    ,    WebDriverAgent,   .     . <br><br>  ‚Äî       ,        device server,      ,  ,     .      (release),  ,     ,     .      .  ,  device server   ,        Test Runner      .    ,       -,   ,        -   . <br><br><h2>     </h2><br>    ‚Äî  .  .  30    60.   ,   .  ,         30 .    :     ,       ? <br><br>     .       ‚Äî   .         ,       . <br><br>        .     ,   ,               . Separation of Concerns ‚Äî    ,     ,     . <br><br>    . ,      ,     Xcode 9,         .      Xcode 9.2,       ,     ‚Äî  .   ,    - . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons grandement simplifi√© le Test Runner, qui comprenait rsync, ssh et d'autres logiques. </font><font style="vertical-align: inherit;">Maintenant, tout cela est jet√© et fonctionne quelque part sur * nix, dans des conteneurs Docker. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les prochaines √©tapes: pr√©parer le serveur de p√©riph√©riques pour l'open source </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(apr√®s le rapport, il a √©t√© publi√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , et nous pensons √† supprimer ssh, car cela n√©cessite une configuration suppl√©mentaire sur les machines et complique dans la plupart des cas la logique et le support de l'ensemble du syst√®me. </font><font style="vertical-align: inherit;">Mais maintenant, vous pouvez prendre le serveur de p√©riph√©riques, l'activer sur toutes les machines ssh, et les tests fonctionneront vraiment sans probl√®me.</font></font><br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Trucs et astuces </font></font></h2><br>  Maintenant, la chose la plus importante est toutes sortes d'astuces et de choses utiles que nous avons trouv√©es lors de la cr√©ation d'un serveur de p√©riph√©riques et de cette infrastructure. <br><br>  Le premier est le plus simple.  Comme vous vous en souvenez, nous avions un MacBook Pro, tous les tests ont √©t√© ex√©cut√©s sur des ordinateurs portables.  Nous les lan√ßons maintenant sur Mac Pro. <br><br><img src="https://habrastorage.org/webt/rv/jq/5k/rvjq5kfsrkhnyh9-zseoonlv-8e.jpeg"><br><br>  Voici deux configurations.  Ce sont en fait les meilleures versions de chacun des appareils.  Sur le MacBook, nous pourrions ex√©cuter de mani√®re stable 6 simulateurs en parall√®le.  Si vous essayez de charger plus en m√™me temps, les simulateurs commencent √† √©chouer car ils chargent fortement le processeur, ils ont des verrous mutuels, etc.  Vous pouvez ex√©cuter 18 sur le Mac Pro - c'est tr√®s facile √† calculer, car au lieu de 4, il y a 12 c≈ìurs.  Nous multiplions par trois - vous obtenez environ 18 simulateurs.  En fait, vous pouvez essayer d'ex√©cuter un peu plus, mais ils doivent en quelque sorte √™tre s√©par√©s dans le temps, vous ne pouvez pas, par exemple, ex√©cuter en une minute.  Bien qu'il y ait un truc avec ces 18 simulateurs, ce n'est pas si simple. <br><br><img src="https://habrastorage.org/webt/j3/mg/q2/j3mgq2s3vsucdkwbtbia-xcrr6a.jpeg"><br><br>  Et c'est leur prix.  Je ne me souviens pas combien il est en roubles, mais il est clair que cela co√ªte cher.  Le co√ªt de chaque simulateur pour le MacBook Pro co√ªte pr√®s de 400 ¬£ et pour le Mac Pro pr√®s de 330 ¬£.  C'est d√©j√† environ 70 ¬£ d'√©conomies sur chaque simulateur. <br><br>  De plus, ces macbooks devaient √™tre install√©s d'une certaine mani√®re, ils devaient √™tre charg√©s sur des aimants, qui devaient √™tre coll√©s sur du ruban adh√©sif, car parfois ils tombaient.  Et vous avez d√ª acheter un adaptateur pour connecter Ethernet, car tant d'appareils √† proximit√© dans la bo√Æte de fer sur le Wi-Fi ne fonctionnent pas, il devient instable.  L'adaptateur co√ªte √©galement environ 30 ¬£, lorsque vous divisez par 6, vous obtiendrez alors 5 ¬£ suppl√©mentaires pour chaque appareil.  Mais si vous n'avez pas besoin de cette super-parall√©lisation, vous n'avez que 20 tests et 5 simulateurs, il est en fait plus facile d'acheter un MacBook, car vous pouvez le trouver dans n'importe quel magasin, et vous devrez commander et attendre le Mac Pro haut de gamme.  Soit dit en passant, ils nous ont co√ªt√© un peu moins cher, car nous les avons pris en vrac et il y avait une sorte de r√©duction.  Vous pouvez √©galement acheter un Mac Pro avec une petite m√©moire, puis vous mettre √† niveau, en √©conomisant encore plus. <br><br>  Mais avec le Mac Pro, il y a une astuce.  Nous avons d√ª les diviser en trois machines virtuelles, y mettre ESXi.  Il s'agit de la virtualisation bare metal, c'est-√†-dire d'un hyperviseur install√© sur une machine nue, et non sur le syst√®me h√¥te.  Il est l'h√¥te lui-m√™me, nous pouvons donc ex√©cuter trois machines virtuelles.  Et si vous installez une sorte de virtualisation normale sur macOS, par exemple Parallels, vous ne pourrez ex√©cuter que 2 machines virtuelles en raison des restrictions de licence Apple.  J'ai d√ª le casser car CoreSimulator, le principal service g√©rant les simulateurs, s'est av√©r√© avoir des verrous internes, et en m√™me temps plus de 6 simulateurs n'√©taient tout simplement pas charg√©s, ils ont commenc√© √† attendre quelque chose dans la file d'attente, et le temps de chargement total de 18 simulateurs est devenu inacceptable.  Au fait, ESXi co√ªte 0 ‚Ç¨, c'est toujours bien quand quelque chose ne vaut rien, mais √ßa marche bien. <br><br>  Pourquoi n'avons-nous pas mis en commun?  En partie parce que nous avons acc√©l√©r√© la r√©initialisation du simulateur.  Supposons que le test se bloque, vous souhaitez nettoyer compl√®tement le simulateur afin que le suivant ne se bloque pas en raison de fichiers obscurs restants dans le syst√®me de fichiers.  La solution la plus simple consiste √† arr√™ter le simulateur, √† effacer explicitement (effacer) et √† d√©marrer (d√©marrage). <br><br><img src="https://habrastorage.org/webt/iz/di/hb/izdihbksdhla1kpstvwfufcbhju.jpeg"><br><br>  Tr√®s simple, une ligne, mais prend 18 secondes.  Et il y a six mois ou un an, cela a pris pr√®s d'une minute.  Merci √† Apple d'avoir optimis√© cela, mais vous pouvez le faire plus compliqu√©.  T√©l√©chargez le simulateur et copiez ses r√©pertoires de travail dans le dossier de sauvegarde.  Et puis vous √©teignez le simulateur, supprimez le r√©pertoire de travail et copiez la sauvegarde, d√©marrez le simulateur. <br><br><img src="https://habrastorage.org/webt/wh/am/hp/whamhpflltyp2qfgiq_8cpigugs.jpeg"><br><br>  Il s'av√®re que 8 secondes: le t√©l√©chargement s'est acc√©l√©r√© plus de deux fois.  En m√™me temps, il n'y avait rien de compliqu√© √† faire, c'est-√†-dire que dans le code Ruby, cela prend litt√©ralement deux lignes.  Dans l'image, je donne un exemple sur un bash afin qu'il puisse √™tre facilement traduit dans d'autres langues. <br><br>  La prochaine astuce.  Il existe une application Bumble, elle est similaire √† Badoo, mais avec un concept l√©g√®rement diff√©rent, beaucoup plus int√©ressant.  L√†, vous devez vous connecter via Facebook.  Dans tous nos tests, puisque nous utilisons √† chaque fois un nouvel utilisateur du pool, nous avons d√ª nous d√©connecter du pr√©c√©dent.  Pour ce faire, en utilisant WebDriverAgent, nous avons ouvert Safari, sommes all√©s sur Facebook, avons cliqu√© sur D√©connexion.  Cela semble bien, mais cela prend presque une minute √† chaque test.  Une centaine de tests.  Cent minutes suppl√©mentaires. <br><br>  De plus, Facebook aime parfois faire des tests A / B, afin qu'ils puissent changer les localisateurs, le texte sur les boutons.  Soudain, un tas de tests tombera et tout le monde sera extr√™mement m√©content.  Par cons√©quent, via fbsimctl, nous cr√©ons list_apps, qui trouve toutes les applications. <br><br><img src="https://habrastorage.org/webt/7c/gt/ry/7cgtrymkxuiq9cmpouvz-dqkehg.jpeg"><br><br>  Trouvez MobileSafari: <br><br><img src="https://habrastorage.org/webt/4t/es/z2/4tesz2buq_0d4aht9washdmaozi.jpeg"><br><br>  Et il y a un chemin vers le DataContainer, et il a un fichier binaire avec des cookies: <br><br><img src="https://habrastorage.org/webt/hw/1k/rl/hw1krlg_1x5nmgvuoc1uobnrqjw.jpeg"><br><br>  Nous le supprimons simplement - cela prend 20 ms.  Les tests ont commenc√© √† passer 100 minutes plus vite, sont devenus plus stables, car ils ne peuvent pas tomber √† cause de Facebook.  La parall√©lisation n'est donc parfois pas n√©cessaire.  Vous pouvez trouver des endroits pour l'optimisation, c'est facile moins 100 minutes, rien n'a besoin d'√™tre fait.  Dans le code, ce sont deux lignes. <br><br>  Ensuite: comment pr√©parer les machines h√¥tes √† ex√©cuter des simulateurs. <br><br><img src="https://habrastorage.org/webt/fl/kr/tb/flkrtbwjie0s6eeekvg9viviory.jpeg"><br><br>  Avec le premier exemple, beaucoup de ceux qui ont lanc√© Appium connaissent bien la d√©sactivation du clavier dur.  Le simulateur a l'habitude de connecter le clavier mat√©riel sur l'ordinateur lors de la saisie de texte dans le simulateur et de masquer compl√®tement le virtuel.  Et Appium utilise un clavier virtuel pour saisir du texte.  Par cons√©quent, apr√®s un d√©bogage local des tests d'entr√©e, d'autres tests peuvent commencer √† √©chouer en raison de l'absence de clavier.  Avec cette commande, vous pouvez d√©sactiver le clavier dur, et nous le faisons avant de soulever chaque n≈ìud de test. <br><br><img src="https://habrastorage.org/webt/ro/fe/zi/rofeziypdamsqtfbetbkouvlxvo.jpeg"><br><br>  Le paragraphe suivant est plus pertinent pour nous, car l'application est li√©e √† la g√©olocalisation.  Et tr√®s souvent, vous devez ex√©cuter des tests pour qu'il soit initialement d√©sactiv√©.  Vous pouvez d√©finir 3101 dans le LocationMode. Pourquoi?  Il y avait un article dans la documentation d'Apple, mais ils l'ont supprim√© pour une raison quelconque.  Maintenant, c'est juste une constante magique dans le code pour laquelle nous prions tous et esp√©rons qu'il ne se cassera pas.  Parce que d√®s qu'il se casse, tous les utilisateurs seront √† San Francisco, car fbsimctl met un tel emplacement lors du chargement.  D'un autre c√¥t√©, nous le saurons facilement, car tout le monde sera √† San Francisco. <br><br><img src="https://habrastorage.org/webt/3l/1l/80/3l1l80irnsg8lljrexp06cjgbee.jpeg"><br><br>  La prochaine consiste √† d√©sactiver Chrome, un cadre autour du simulateur qui a divers boutons.  Lors de l'ex√©cution d'autotests, ce n'est pas n√©cessaire.  Auparavant, la d√©sactiver vous permettait de placer plus de simulateurs de gauche √† droite pour voir comment tout se passe en parall√®le.  Maintenant, nous ne le faisons pas, car tout est sans t√™te.  Combien ne vont pas dans la voiture, les simulateurs eux-m√™mes ne seront pas visibles.  Si cela est n√©cessaire, vous pouvez diffuser √† partir du simulateur souhait√©. <br><br><img src="https://habrastorage.org/webt/nb/dr/bz/nbdrbzscl-havdqqe2tjzdpru3a.jpeg"><br><br>  Il existe √©galement un ensemble de diff√©rentes options que vous pouvez activer / d√©sactiver.  Parmi ceux-ci, je ne mentionnerai que SlowMotionAnimation, car j'ai eu un deuxi√®me ou troisi√®me jour tr√®s int√©ressant au travail.  J'ai ex√©cut√© les tests, et ils ont tous commenc√© √† tomber dans les d√©lais d'attente.  Ils n'ont pas trouv√© les √©l√©ments dans l'inspecteur, bien qu'il l'ait √©t√©.  Il s'est av√©r√© qu'√† ce moment-l√†, j'ai commenc√© Chrome, j'ai appuy√© sur cmd + T pour ouvrir un nouvel onglet.  √Ä ce stade, le simulateur est devenu actif et a intercept√© l'√©quipe.  Et pour lui, cmd + T est un ralentissement de toutes les animations de 10 fois pour d√©boguer l'animation.  Cette option doit √©galement toujours √™tre automatiquement d√©sactiv√©e si vous souhaitez ex√©cuter des tests sur des machines auxquelles les utilisateurs ont acc√®s, car ils peuvent interrompre accidentellement les tests en ralentissant les animations. <br><br>  La chose probablement la plus int√©ressante pour moi, puisque je l'ai fait il n'y a pas si longtemps, est la gestion de toute cette infrastructure.  60 h√¥tes virtuels (en fait 64 + 6 agents TeamCity) que personne ne veut d√©ployer manuellement.  Nous avons trouv√© l'utilitaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">xcversion</a> - maintenant il fait partie de fastlane, un joyau Ruby qui peut √™tre utilis√© comme un utilitaire de ligne de commande: il automatise partiellement l'installation de Xcode.  Ensuite, nous avons pris Ansible, √©crit des playbooks, pour lancer fbsimctl partout dans la version souhait√©e, Xcode et d√©ployer des configurations pour le serveur de p√©riph√©rique lui-m√™me.  Et Ansible pour supprimer et mettre √† jour les simulateurs.  Lorsque nous passons √† iOS 11, nous quittons iOS 10. Mais lorsque l'√©quipe de test dit qu'elle abandonne compl√®tement les tests automatiques sur iOS 10, nous passons simplement par Ansible et nettoyons les anciens simulateurs.  Sinon, ils occupent beaucoup d'espace disque. <br><br><img src="https://habrastorage.org/webt/6u/ms/_b/6ums_bp8kls-rwg3wzxvtk9qqfm.jpeg"><br><br>  Comment √ßa marche?  Si vous venez de prendre xcversion et de l'appeler sur chacune des 60 machines, cela prendra beaucoup de temps, car il va sur le site Web d'Apple et t√©l√©charge toutes les images.  Pour mettre √† jour les machines qui se trouvent dans le parc, vous devez s√©lectionner une machine qui fonctionne, ex√©cutez xcversion install dessus avec la version n√©cessaire de Xcode, mais n'installez rien et ne supprimez rien.  Le package d'installation sera t√©l√©charg√© dans le cache.  La m√™me chose peut √™tre faite pour n'importe quelle version du simulateur.  Le package d'installation est plac√© dans ~ / Library / Caches / XcodeInstall.  Ensuite, vous chargez tout avec Ceph, et s'il n'est pas l√†, d√©marrez une sorte de serveur Web dans ce r√©pertoire.  Je suis habitu√© √† Python, donc je lance un serveur Python Python sur des machines. <br><br><img src="https://habrastorage.org/webt/hw/jb/5e/hwjb5epull9o-qjls05slw5ztes.jpeg"><br><br>  Maintenant, sur n'importe quelle autre machine du d√©veloppeur ou du testeur, vous pouvez faire installer xcversion et sp√©cifier le lien vers le serveur sur√©lev√©.  Il t√©l√©chargera xip √† partir de la machine sp√©cifi√©e (si le r√©seau local est rapide, cela se produira presque instantan√©ment), d√©ballez le package, confirmez la licence - en g√©n√©ral, il fera tout pour vous.  Il y aura un Xcode enti√®rement fonctionnel dans lequel il sera possible d'ex√©cuter des simulateurs et des tests.  Malheureusement, ils n'√©taient pas si pratiques avec les simulateurs, vous devez donc faire curl ou wget, t√©l√©charger un package de ce serveur sur votre ordinateur local dans le m√™me r√©pertoire, ex√©cuter les simulateurs xcversion --install.  Nous avons plac√© ces appels dans des scripts Ansible et mis √† jour 60 machines en une journ√©e.  Le temps principal a √©t√© pris par la copie de fichiers r√©seau.  De plus, nous nous d√©placions √† ce moment-l√†, c'est-√†-dire que certaines voitures ont √©t√© √©teintes.  Nous avons red√©marr√© Ansible deux ou trois fois pour rattraper les voitures absentes lors du d√©m√©nagement. <br><br>  Un petit d√©briefing.  Dans la premi√®re partie: il me semble que les priorit√©s sont importantes.  Autrement dit, vous devez d'abord avoir la stabilit√© et la fiabilit√© des tests, puis la vitesse.  Si vous ne poursuivez que la vitesse, commencez √† tout parall√©liser, alors les tests fonctionneront rapidement, mais personne ne les regardera jamais, ils recommenceront tout jusqu'√† ce que tout passe soudainement.  Ou m√™me marquer sur les tests et pousser vers le ma√Ætre. <br><br>  Le point suivant: l'automatisation est le m√™me d√©veloppement, vous pouvez donc simplement prendre les mod√®les que vous avez d√©j√† pens√©s pour nous et les utiliser.  Si maintenant votre infrastructure est √©troitement li√©e aux tests et que la mise √† l'√©chelle est planifi√©e, c'est le bon moment pour diviser d'abord, puis pour √©voluer. <br><br>  Et le dernier point: si la t√¢che est d'acc√©l√©rer les tests, la premi√®re chose qui me vient √† l'esprit est d'ajouter plus de simulateurs pour l'acc√©l√©rer d'un facteur.  En fait, tr√®s souvent, vous n'avez pas besoin d'ajouter, mais d'analyser soigneusement le code et d'optimiser tout avec quelques lignes, comme dans l'exemple avec les cookies.  C'est mieux que la parall√©lisation, car 100 minutes ont √©t√© enregistr√©es avec deux lignes de code, et pour la parall√©lisation, vous devrez √©crire beaucoup de code, puis prendre en charge la partie de fer de l'infrastructure.  Pour l'argent et les ressources, cela co√ªtera beaucoup plus. <br><br><blockquote>  Ceux qui sont int√©ress√©s par ce rapport de la conf√©rence de Heisenbug peuvent √©galement √™tre int√©ress√©s par le <b>Heisenbug</b> suivant: il se tiendra √† Moscou du 6 au 7 d√©cembre, et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le site Web de la</a> conf√©rence contient d√©j√† des descriptions d'un certain nombre de rapports (et, soit dit en passant, l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">acceptation des demandes</a> de rapports est toujours ouverte). </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423901/">https://habr.com/ru/post/fr423901/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423889/index.html">Ma d√©ception dans le logiciel</a></li>
<li><a href="../fr423891/index.html">Arbres d'expression de d√©veloppement d'entreprise</a></li>
<li><a href="../fr423893/index.html">Hello World pour recevoir des donn√©es d'un appareil Bluetooth (BLE) via C #</a></li>
<li><a href="../fr423895/index.html">Vous n'avez pas besoin d'un avocat. Mais ce n'est pas s√ªr</a></li>
<li><a href="../fr423897/index.html">Conseils utiles pour l'utilisation de l'assistant DDR HyperLynx pour l'analyse QDR4</a></li>
<li><a href="../fr423903/index.html">Immersion dans AD: nous analysons les attaques avanc√©es sur Microsoft Active Directory et comment les d√©tecter</a></li>
<li><a href="../fr423905/index.html">Les d√©veloppeurs sont rest√©s inconnus. Conf√©rence Yandex</a></li>
<li><a href="../fr423911/index.html">La photonique sur silicium tr√©buche sur le dernier m√®tre</a></li>
<li><a href="../fr423919/index.html">Comment automatiser la collecte de KPI par mois et laisser les utilisateurs presque satisfaits</a></li>
<li><a href="../fr423921/index.html">10 ans d'Android: souvenez-vous de tout</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>