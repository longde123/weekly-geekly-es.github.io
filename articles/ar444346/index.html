<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฟ ๐ต ๐๐พ GraphQL ู Golang ๐ โ๏ธ ๐คบ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฃุตุจุญุช ุชูููุฉ GraphQL ุนูู ูุฏู ุงูุณููุงุช ุงูููููุฉ ุงููุงุถูุฉ ุ ุจุนุฏ ุฃู ูุงูุช ุดุฑูุฉ Facebook ุจููููุง ุฅูู ูุฆุฉ ุงููุตุงุฏุฑ ุงูููุชูุญุฉ ุ ุจุดุนุจูุฉ ูุจูุฑุฉ. ูููู ูุคูู ูุฐู ุงููุงุฏุฉ ุ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GraphQL ู Golang</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/444346/" style=";text-align:right;direction:rtl">  ุฃุตุจุญุช ุชูููุฉ GraphQL ุนูู ูุฏู ุงูุณููุงุช ุงูููููุฉ ุงููุงุถูุฉ ุ ุจุนุฏ ุฃู ูุงูุช ุดุฑูุฉ Facebook ุจููููุง ุฅูู ูุฆุฉ ุงููุตุงุฏุฑ ุงูููุชูุญุฉ ุ ุจุดุนุจูุฉ ูุจูุฑุฉ.  ูููู ูุคูู ูุฐู ุงููุงุฏุฉ ุ ุงูุชู ููุดุฑูุง ุงูููู ุ ุฅูู ุญุงูู ุงูุนูู ูุน GraphQL ูู Node.js ุ ููู ุชุฌุฑุจุชู ุงูุฎุงุตุฉ ุ ูุงู ููุชูุนูุง ุฃู ูุฐู ุงูุชูููููุฌูุง ุ ูุธุฑูุง ููุฏุฑุงุชูุง ุงูุฑุงุฆุนุฉ ูุจุณุงุทุชูุง ุ ูุง ุชุฌุฐุจ ุงููุซูุฑ ูู ุงูุงูุชูุงู ุนู ุทุฑูู ุงูุฎุทุฃ.  ูู ุงูุขููุฉ ุงูุฃุฎูุฑุฉ ุ ุฃุซูุงุก ูุดุงุฑูุชู ูู ูุดุฑูุน ุฌุฏูุฏ ุ ุงูุชูู ูู Node.js ุฅูู Golang.  ุซู ูุฑุฑ ุงุฎุชุจุงุฑ ุชุนุงูู Golang ู GraphQL. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/webt/jp/qa/qv/jpqaqvlt5xh7d7mlhwpxvvwhptq.jpeg"></a> <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">ูุนูููุงุช ุฃูููุฉ</font> </h2><br>  ููููู ุฃู ุชุชุนูู ูู ุชุนุฑูู GraphQL ุงูุฑุณูู ุฃู ูุฐู ูุบุฉ ุงุณุชุนูุงู ููุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูููุช ุชุดุบูู ูุชูููุฐ ูุซู ูุฐู ุงูุงุณุชุนูุงูุงุช ุนูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ.  ูููุฑ GraphQL ูุตููุง ูุงููุงู ูููููููุง ููุจูุงูุงุช ูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูุนููุฉ ุ ููุณูุญ ููุนููุงุก ุจุทูุจ ุงููุนูููุงุช ุงูุชู ูุญุชุงุฌูู ุฅูููุง ุจุงูุถุจุท ุ ููุง ุดูุก ุฃูุซุฑ ูู ุฐูู ุ ูุจุณุท ุนูููุฉ ุชุทููุฑ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุน ูุฑูุฑ ุงูููุช ููููุญ ุงููุทูุฑูู ุฃุฏูุงุช ูููุฉ. <br><br>  ูุง ุชูุฌุฏ ุงูุนุฏูุฏ ูู ููุชุจุงุช GraphQL ุงูุฎุงุตุฉ ุจู Golang.  ุนูู ูุฌู ุงูุฎุตูุต ุ ุฌุฑุจุช ููุชุจุงุช ูุซู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Thunder</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">graphql</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">graphql-go</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">gqlgen</a> .  ุฃูุฏ ุฃู ุฃุดูุฑ ุฅูู ุฃู ุฃูุถู ูุง ุญุงููุช ูู ููุชุจุฉ gqlgen. <br><br>  ููุชุจุฉ gqlgen ูุง ุชุฒุงู ูู ูุฑุญูุฉ ุชุฌุฑูุจูุฉ ุ ูู ููุช ูุชุงุจุฉ ูุฐู ุงููุงุฏุฉ ูุงูุช ุงููุณุฎุฉ <a href="">0.7.2</a> .  ุงูููุชุจุฉ ุชุชุทูุฑ ุจุณุฑุนุฉ.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> ููููู ูุนุฑูุฉ ุงููุฒูุฏ ุนู ุฎุทุท ุชุทููุฑูุง.  ุงูุขู ุงูุฑุงุนู ุงูุฑุณูู ูู gqlgen ูู ูุดุฑูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">99designs</a> ุ ููุง ูุนูู ุฃู ูุฐู ุงูููุชุจุฉ ุ ุนูู ุงูุฃุฑุฌุญ ุ ุณุชุชุทูุฑ ุจุดูู ุฃุณุฑุน ูู ุฐู ูุจู.  ุงููุทูุฑูู ุงูุฑุฆูุณููู ููุฐู ุงูููุชุจุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">vektah</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">neelance</a> ุ ุจูููุง neelance ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุนูู ุนูู ููุชุจุฉ graphql-go. <br><br>  ุฏุนููุง ูุชุญุฏุซ ุนู ููุชุจุฉ gqlgen ุจูุงุกู ุนูู ุงูุชุฑุงุถ ุฃู ูุฏูู ุจุงููุนู ูุนุฑูุฉ ุฃุณุงุณูุฉ ุจู GraphQL. <br><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">ููุฒุงุช Gqlgen</font> </h2><br>  ูู ูุตู gqlgen ุ ููููู ูุนุฑูุฉ ูุง ุฃูุงููุง ูู ููุชุจุฉ ูุฅูุดุงุก ุฎูุงุฏู GraphQL ููุชูุจุฉ ุจุฏูุฉ ูู Golang.  ูุฐู ุงูุนุจุงุฑุฉ ุชุจุฏู ูู ูุงุนุฏุฉ ููุบุงูุฉ ุ ุญูุซ ุฅููุง ุชุนูู ุฃูู ุนูุฏ ุงูุนูู ูุน ูุฐู ุงูููุชุจุฉ ุ ูู ุฃูุงุฌู ุดูุฆูุง ูุซู <code>map[string]interface{}</code> ุ ุญูุซ ูุชู ุงุณุชุฎุฏุงู ููุฌ ูุงุฆู ุนูู ุงููุชุงุจุฉ ุงูุตุงุฑูุฉ ููุง. <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุชุณุชุฎุฏู ูุฐู ุงูููุชุจุฉ ุฃุณููุจูุง ูุนุชูุฏ ุนูู ูุฎุทุท ุงูุจูุงูุงุช.  ูุฐุง ูุนูู ุฃู ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ููุตููุฉ ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุบุฉ ุชุนุฑูู ูุฎุทุท</a> GraphQL.  ุชุญุชูู ูุฐู ุงููุบุฉ ุนูู ุฃุฏูุงุช ุฅูุดุงุก ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููููุฉ ุงูุฎุงุตุฉ ุจูุง ูุงูุชู ุชูุดุฆ ุฑูุฒ GraphQL ุชููุงุฆููุง.  ูู ูุฐู ุงูุญุงูุฉ ุ ูููู ูููุจุฑูุฌ ููุท ุชูููุฐ ุงูููุทู ุงูุฃุณุงุณู ูุฃุณุงููุจ ุงููุงุฌูุฉ ุงูููุงุจูุฉ. <br><br>  ูููุณู ูุฐุง ุงูููุงู ุฅูู ูุณููู.  ุงูุฃูู ูุฎุตุต ูุฃุณุงููุจ ุงูุนูู ุงูุฃุณุงุณูุฉ ุ ูุงูุซุงูู ููุทุฑู ุงููุชูุฏูุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">ุทุฑู ุงูุนูู ุงูุฑุฆูุณูุฉ: ุงูุฅุนุฏุงุฏ ุ ุทูุจุงุช ุงุณุชูุงู ูุชุบููุฑ ุงูุจูุงูุงุช ุ ุงูุงุดุชุฑุงูุงุช</font> </h2><br>  ูุญู ูุชุทุจูู ุชุฌุฑูุจู ุ ุณูู ูุณุชุฎุฏู ูููุนูุง ูููู ูููุณุชุฎุฏููู ูู ุฎูุงูู ูุดุฑ ููุงุทุน ููุฏูู ูุฅุถุงูุฉ ููุทุงุช ุดุงุดุฉ ููุฑุงุฌุนุงุช ูุงูุจุญุซ ุนู ููุงุทุน ุงูููุฏูู ูุนุฑุถ ููุงุฆู ุงูุณุฌูุงุช ุงููุฑุชุจุทุฉ ุจุงูุณุฌูุงุช ุงูุฃุฎุฑู.  ููุจุฏุฃ ุงูุนูู ูู ูุฐุง ุงููุดุฑูุน: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">mkdir -p $GOPATH/src/github.com/ridhamtarpara/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>-graphql-demo/</code> </pre> <br>  ูู <code>schema.graphql</code> ููู ูุฎุทุท ุงูุจูุงูุงุช ุงูุชุงูู ( <code>schema.graphql</code> ) ูู ุงูุฏููู ุงูุฌุฐุฑ ูููุดุฑูุน: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> User {   id: ID!   name: String!   email: String! } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Video {   id: ID!   name: String!   description: String!   user: User!   url: String!   createdAt: Timestamp!   screenshots: [Screenshot]   related(limit: Int = <span class="hljs-number"><span class="hljs-number">25</span></span>, offset: Int = <span class="hljs-number"><span class="hljs-number">0</span></span>): [Video!]! } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Screenshot {   id: ID!   videoId: ID!   url: String! } input NewVideo {   name: String!   description: String!   userId: ID!   url: String! } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Mutation {   createVideo(input: NewVideo!): Video! } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Query {   Videos(limit: Int = <span class="hljs-number"><span class="hljs-number">25</span></span>, offset: Int = <span class="hljs-number"><span class="hljs-number">0</span></span>): [Video!]! } scalar Timestamp</code> </pre> <br>  ูุตู ููุงุฐุฌ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ุ ุทูุฑุฉ ูุงุญุฏุฉ ( <code>Mutation</code> ุ ูุตู ูุทูุจ ุชุบููุฑ ุงูุจูุงูุงุช) ุ ูุงูุชู ุชูุณุชุฎุฏู ููุดุฑ ูููุงุช ููุฏูู ุฌุฏูุฏุฉ ุนูู ุงููููุน ุ ูุงุณุชุนูุงู ูุงุญุฏ ( <code>Query</code> ) ููุญุตูู ุนูู ูุงุฆูุฉ ุจุฌููุน ูููุงุช ุงูููุฏูู.  ุงูุฑุฃ ุงููุฒูุฏ ุนู ูุฎุทุท GraphQL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุฃุนููุง ููุง ุฃุญุฏ ุฃููุงุน ุงูุจูุงูุงุช ุงูุนุฏุฏูุฉ ุงูุฎุงุตุฉ ุจูุง.  ูุญู ุบูุฑ ุฑุงุถูู ุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃููุงุน</a> ุงูุจูุงูุงุช ุงูููุงุณูุฉ ุงูุฎูุณุฉ ( <code>Int</code> ู <code>Float</code> ู <code>String</code> ู <code>Boolean</code> ู <code>ID</code> ) ุงูููุฌูุฏุฉ ูู GraphQL. <br><br>  ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู ุงุณุชุฎุฏุงู <code>schema.graphql</code> ุงูุฎุงุตุฉ ุ ููููู <code>schema.graphql</code> ูู <code>schema.graphql</code> (ูู ุญุงูุชูุง ุ ูุฐุง ุงูููุน ูู <code>Timestamp</code> ) ูุชูุฏูู ุชุนุฑููุงุชูู ูู ุงูููุฏ.  ุนูุฏ ุงุณุชุฎุฏุงู ููุชุจุฉ gqlgen ุ ูุฌุจ ุนููู ุชูููุฑ ุทุฑู <code>gqlgen.yml</code> ุงูุนุฏุฏูุฉ ูุชูููู ุงูุชุนููู ุจุงุณุชุฎุฏุงู <code>gqlgen.yml</code> . <br><br>  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃูู ูู ุฃุญุฏุซ ุฅุตุฏุงุฑ ูู ุงูููุชุจุฉ ูุงู ููุงู ุชุบููุฑ ููู ูุงุญุฏ.  ููู ุ ุชูุช ุฅุฒุงูุฉ ุงูุชุจุนูุฉ ุนูู ุงููููุงุช ุงูุซูุงุฆูุฉ ุงููุชุฑุฌูุฉ ูู ุฐูู.  ูุฐูู ุ ูุฌุจ ุฅุถุงูุฉ ููู <code>scripts/gqlgen.go</code> ุฅูู ุงููุดุฑูุน ุจุงููุญุชูู ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// +build ignore package main import "github.com/99designs/gqlgen/cmd" func main() { cmd.Execute() }</span></span></code> </pre> <br>  ุจุนุฏ ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุชููุฆุฉ <code>dep</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">dep init</code> </pre> <br>  ุญุงู ุงูููุช ุงูุขู ููุงุณุชูุงุฏุฉ ูู ุฅููุงูุงุช ุฅูุดุงุก ููุฏ ุงูููุชุจุฉ.  ุฅููุง ุชุชูุญ ูู ุฅูุดุงุก ุฌููุน ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููููุฉ ููููู ุ ูุงูุชู ุ ุนูู ุงูุฑุบู ูู ุฐูู ุ ูุง ูููู ุชุณููุชูุง ุบูุฑ ูููุฉ ุชูุงููุง.  ูุจุฏุก ุชุดุบูู ุขููุฉ ุฅูุดุงุก ุงูููุฏ ุงูุชููุงุฆู ุ ูู ุจุชูููุฐ ุงูุฃูุฑ ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">go</span></span> run scripts/gqlgen.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span> init</code> </pre> <br>  ูุชูุฌุฉ ูุชูููุฐู ุ ุณูุชู ุฅูุดุงุก ุงููููุงุช ุงูุชุงููุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>gqlgen.yml</code> : ููู ุงูุชูููู ูุฅุฏุงุฑุฉ ุชูููุฏ ุงูุดูุฑุฉ. <br></li><li style=";text-align:right;direction:rtl">  <code>generated.go</code> . <br></li><li style=";text-align:right;direction:rtl">  <code>models_gen.go</code> : ูู โโุงูููุงุฐุฌ ูุฃููุงุน ุงูุจูุงูุงุช ูููุฎุทุท ุงูููุฏู. <br></li><li style=";text-align:right;direction:rtl">  <code>resolver.go</code> : ุณูููู ููุง ุงูุฑูุฒ ุงูุฐู ูููู ุงููุจุฑูุฌ ุจุฅูุดุงุฆู. <br></li><li style=";text-align:right;direction:rtl">  <code>server/server.go</code> : ููุทุฉ ุงูุฏุฎูู ุจุงุณุชุฎุฏุงู <code>http.Handler</code> ูุจุฏุก ุฎุงุฏู GraphQL. <br></li></ul><br>  ุฃููู ูุธุฑุฉ ุนูู ุงููููุฐุฌ ุงูุฐู ุชู ุฅูุดุงุคู ูููุน <code>Video</code> (file <code>generated_video.go</code> ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Video <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { ID          <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>  <span class="hljs-string"><span class="hljs-string">`json:"id"`</span></span> Name        <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>  <span class="hljs-string"><span class="hljs-string">`json:"name"`</span></span> User        User  <span class="hljs-string"><span class="hljs-string">`json:"user"`</span></span> URL         <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>  <span class="hljs-string"><span class="hljs-string">`json:"url"`</span></span> CreatedAt   <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>  <span class="hljs-string"><span class="hljs-string">`json:"createdAt"`</span></span> Screenshots []*Screenshot <span class="hljs-string"><span class="hljs-string">`json:"screenshots"`</span></span> Related     []Video  <span class="hljs-string"><span class="hljs-string">`json:"related"`</span></span> }</code> </pre> <br>  ููุง ููููู ุฃู ุชุฑู ุฃู <code>ID</code> ูู ุณูุณูุฉ ุ <code>CreatedAt</code> ูู ุฃูุถุง ุณูุณูุฉ.  ูุชู ุชูููู ุงูููุงุฐุฌ ุงูุฃุฎุฑู ุฐุงุช ุงูุตูุฉ ูููุง ูุฐูู.  ููุน ุฐูู ุ ูู ุชุทุจููุงุช ุญููููุฉ ูุฐุง ููุณ ุถุฑูุฑูุง.  ุฅุฐุง ููุช ุชุณุชุฎุฏู ุฃู ููุน ูู ุจูุงูุงุช SQL ุ ูุฃูุช ุจุญุงุฌุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅูู ุฃู ูููู ุญูู <code>ID</code> ุ ููููุง ููุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ ุ ูู <code>int64</code> <code>int</code> ุฃู <code>int64</code> . <br><br>  ุนูู ุณุจูู ุงููุซุงู ุ ุฃุณุชุฎุฏู PostgreSQL ูู ูุฐุง ุงูุชุทุจูู ุงูุชุฌุฑูุจู ุ ูุฐูู ุจุงูุทุจุน ุฃุญุชุงุฌ ุฅูู ุฃู ูููู ุญูู <code>ID</code> ูู ุงูููุน <code>int</code> ู <code>CreatedAt</code> ููุน <code>time.Time</code> .  ูุฐุง ูุคุฏู ุฅูู ุญูููุฉ ุฃููุง ุจุญุงุฌุฉ ุฅูู ุชุญุฏูุฏ ูููุฐุฌูุง ุงูุฎุงุต ูุฅุฎุจุงุฑ gqlgen ุฃููุง ุจุญุงุฌุฉ ุฅูู ุงุณุชุฎุฏุงู ูููุฐุฌูุง ุจุฏูุงู ูู ุฅูุดุงุก ูููุฐุฌ ุฌุฏูุฏ.  ูููุง ููู ูุญุชููุงุช ููู <code>models.go</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Video <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { ID          <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-string"><span class="hljs-string">`json:"id"`</span></span> Name        <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"name"`</span></span> Description <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>    <span class="hljs-string"><span class="hljs-string">`json:"description"`</span></span> User        User <span class="hljs-string"><span class="hljs-string">`json:"user"`</span></span> URL         <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"url"`</span></span> CreatedAt   time.Time <span class="hljs-string"><span class="hljs-string">`json:"createdAt"`</span></span> Related     []Video } <span class="hljs-comment"><span class="hljs-comment">//    int  ID func MarshalID(id int) graphql.Marshaler { return graphql.WriterFunc(func(w io.Writer) {   io.WriteString(w, strconv.Quote(fmt.Sprintf("%d", id))) }) } //        func UnmarshalID(v interface{}) (int, error) { id, ok := v.(string) if !ok {   return 0, fmt.Errorf("ids must be strings") } i, e := strconv.Atoi(id) return int(i), e } func MarshalTimestamp(t time.Time) graphql.Marshaler { timestamp := t.Unix() * 1000 return graphql.WriterFunc(func(w io.Writer) {   io.WriteString(w, strconv.FormatInt(timestamp, 10)) }) } func UnmarshalTimestamp(v interface{}) (time.Time, error) { if tmpStr, ok := v.(int); ok {   return time.Unix(int64(tmpStr), 0), nil } return time.Time{}, errors.TimeStampError }</span></span></code> </pre> <br>  ูููู ููููุชุจุฉ ุฃูู ููุจุบู ููุง ุงุณุชุฎุฏุงู ูุฐู ุงูููุงุฐุฌ (ููู <code>gqlgen.yml</code> ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">schema: - schema.graphql exec: filename: generated.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span> model: filename: models_gen.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span> resolver: filename: resolver.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: Resolver models: Video:   model: github.com/ridhamtarpara/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>-graphql-demo/api.Video ID:   model: github.com/ridhamtarpara/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>-graphql-demo/api.ID Timestamp:   model: github.com/ridhamtarpara/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>-graphql-demo/api.Timestamp</code> </pre> <br>  ุงููุฏู ูู ูู ูุฐุง ูู ุฃู ูุฏููุง ุงูุขู <code>gqlgen.yml</code> <code>Timestamp</code> ูุน ุทุฑู ุชูุธูู <code>gqlgen.yml</code> ููู <code>gqlgen.yml</code> .  ุงูุขู ุจุนุฏ ุฃู ูุฏู ุงููุณุชุฎุฏู ุงูุณูุณูุฉ <code>UnmarshalID()</code> ุ ุชููู ุงูุทุฑููุฉ <code>UnmarshalID()</code> ุจุชุญููู ูุฐู ุงูุณูุณูุฉ ุฅูู ุนุฏุฏ ุตุญูุญ.  ุนูุฏ ุฅุฑุณุงู ุงุณุชุฌุงุจุฉ ุ ูููู ุงูุฃุณููุจ <code>MarshalID()</code> ุจุชุญููู ุงูุฑูู ุฅูู ุณูุณูุฉ.  ูุญุฏุซ ุงูุดูุก ููุณู ูุน <code>Timestamp</code> ุฃู ูุน ุฃู ููุน ููุงุณู ุขุฎุฑ ุฃุนููู ุงููุจุฑูุฌ. <br><br>  ุงูุขู ุญุงู ุงูููุช ูุชูููุฐ ููุทู ุงูุชุทุจูู.  ุงูุชุญ ููู <code>resolver.go</code> ูุฃุถู ุฃูุตุงู ุงูุทูุฑุงุช ูุงูุงุณุชุนูุงูุงุช ููู.  ููุฌุฏ ุจุงููุนู ุฑูุฒ boilerplate ุชู ุฅูุดุงุคู ุชููุงุฆููุง ูุญุชุงุฌ ุฅูู ููุฆู ุจุงููุนูู.  ููุง ูู ุฑูุฒ ููุฐุง ุงูููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r *mutationResolver)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateVideo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx context.Context, input NewVideo)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(api.Video, error)</span></span></span></span> { newVideo := api.Video{   URL:         input.URL,   Name:        input.Name,   CreatedAt:   time.Now().UTC(), } rows, err := dal.LogAndQuery(r.db, <span class="hljs-string"><span class="hljs-string">"INSERT INTO videos (name, url, user_id, created_at) VALUES($1, $2, $3, $4) RETURNING id"</span></span>,   input.Name, input.URL, input.UserID, newVideo.CreatedAt) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> rows.Close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> || !rows.Next() {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> api.Video{}, err } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := rows.Scan(&amp;newVideo.ID); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> {   errors.DebugPrintf(err)   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> errors.IsForeignKeyError(err) {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> api.Video{}, errors.UserNotExist   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> api.Video{}, errors.InternalServerError } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newVideo, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r *queryResolver)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Videos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx context.Context, limit *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, offset *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([]api.Video, error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> video api.Video <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> videos []api.Video rows, err := dal.LogAndQuery(r.db, <span class="hljs-string"><span class="hljs-string">"SELECT id, name, url, created_at, user_id FROM videos ORDER BY created_at desc limit $1 offset $2"</span></span>, limit, offset) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> rows.Close();   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> {   errors.DebugPrintf(err)   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, errors.InternalServerError } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rows.Next() {   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := rows.Scan(&amp;video.ID, &amp;video.Name, &amp;video.URL, &amp;video.CreatedAt, &amp;video.UserID); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> {     errors.DebugPrintf(err)     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, errors.InternalServerError   }   videos = <span class="hljs-built_in"><span class="hljs-built_in">append</span></span>(videos, video) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> videos, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br>  ุงูุขู ุฏุนููุง ุงุฎุชุจุงุฑ ุงูุทูุฑุฉ. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f7b/a2c/01f/f7ba2c01f766ebc31ed90880376136f1.png"></div>  <i><font color="#999999">ุทูุฑุฉ ุฎููููุฏูู</font></i> <br><br>  ุฅูู ูุนูู!  ูููู ููุงุฐุง ูุง ููุฌุฏ ุดูุก ูู ูุนูููุงุช <code>user</code> (ูุงุฆู <code>user</code> )ุ  ุนูุฏ ุงูุนูู ูุน GraphQL ุ ุชููู ููุงููู ูุดุงุจูุฉ ููุชุญููู "ุงููุณูู" (ุงููุณูู) ู "ุงูุฌุดุน" (ุญุฑูุตุฉ) ูุงุจูุฉ ููุชุทุจูู.  ูุธุฑูุง ูุฃู ูุฐุง ุงููุธุงู ูุงุจู ููุชูุณูุน ุ ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุงูุญููู ุงูุชู ูุฌุจ ููุคูุง "ุฌุดุนูุง" ูุฃููุง "ูุณูู". <br><br>  ุงูุชุฑุญุช ุนูู ุงููุฑูู ูู ุงููุคุณุณุฉ ุงูุชู ุฃุนูู ูููุง "ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ" ุงูุชู ุชูุทุจู ุนูุฏ ุงูุนูู ูุน gqlgen: "ูุง ุชุฏุฑุฌ ูู ุงููููุฐุฌ ุงูุญููู ุงูุชู ุชุญุชุงุฌ ุฅูู ุชุญููููุง ููุท ุฅุฐุง ุทูุจ ุงูุนููู ุฐูู". <br><br>  ูู ุญุงูุชูุง ุ ุฃุญุชุงุฌ ุฅูู ุชูุฒูู ุจูุงูุงุช ุญูู ููุงุทุน ุงูููุฏูู ุฐุงุช ุงูุตูุฉ (ูุญุชู ูุนูููุงุช ุงููุณุชุฎุฏู) ููุท ุฅุฐุง ุทูุจ ุงูุนููู ูุฐู ุงูุญููู.  ูููู ุจูุง ุฃููุง ูููุง ุจุฅุฏุฑุงุฌ ูุฐู ุงูุญููู ูู ุงููููุฐุฌ ุ ูุฅู gqlgen ููุชุฑุถ ุฃููุง ููุฏู ูุฐู ุงูุจูุงูุงุช ุนู ุทุฑูู ุชููู ูุนูููุงุช ุญูู ุงูููุฏูู.  ูุชูุฌุฉ ูุฐูู ุ ุงูุขู ูุญุตู ุนูู ููุงูู ูุงุฑุบุฉ. <br><br>  ูุญุฏุซ ุฃุญูุงููุง ุฃู ููุงู ุญุงุฌุฉ ุฅูู ููุน ูุนูู ูู ุงูุจูุงูุงุช ูู ูู ูุฑุฉ ุ ูุฐูู ูู ุบูุฑ ุงูุนููู ุชูุฒูููุง ุจุงุณุชุฎุฏุงู ุทูุจ ูููุตู.  ููุฐุง ุ ูู ุฃุฌู ุชุญุณูู ุงูุฃุฏุงุก ุ ููููู ุงุณุชุฎุฏุงู ุดูุก ูุซู ุตูุงุช SQL.  ุจูุฌุฑุฏ ุฃู (ูุง ููุทุจู ูุฐุง ุนูู ุงููุซุงู ุงูููุถุญ ููุง) ุ ููุช ุจุญุงุฌุฉ ุฅูู ุชุญููู ุจูุงูุงุช ุงูุชุนุฑูู ุงูุฎุงุตุฉ ุจู ูุน ุงูููุฏูู.  ุชู ุชุฎุฒูู ูุฐู ุงูููุงูุงุช ูู ุฃูุงูู ูุฎุชููุฉ.  ูุชูุฌุฉู ูุฐูู ุ ุฅุฐุง ุชููู ูุธุงูู ุทูุจูุง ูุชูุฒูู ููุทุน ููุฏูู ุ ูุงู ุนููู ุชูุฏูู ุทูุจ ุขุฎุฑ ููุญุตูู ุนูู ุจูุงูุงุช ุงูุชุนุฑูู.  ูููู ุ ุจูุง ุฃููู ููุช ุฃุนุฑู ูุฐุง ุงููุทูุจ (ุฃู ุฃููู ููุช ุฃุนูู ุฃู ุงูุนููู ูุงูููุฏูู ูุทููุจุงู ุฏุงุฆููุง ูู ุฌุงูุจ ุงูุนููู) ุ ููุฏ ูุถูุช ุงุณุชุฎุฏุงู ุชูููุฉ ุงูุชุญููู ุงูุฌุดุน ูุชุญุณูู ุงูุฃุฏุงุก. <br><br>  ุฏุนููุง ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงููููุฐุฌ ูุฅูุดุงุก ุฑูุฒ gqlgen ูุฑุฉ ุฃุฎุฑู.  ูู ุฃุฌู ุนุฏู ุชุนููุฏ ุงููุตุฉ ุ ููุชุจ ููุท ุทุฑููุง ูุญูู <code>user</code> (file <code>models.go</code> ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Video <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { ID          <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-string"><span class="hljs-string">`json:"id"`</span></span> Name        <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"name"`</span></span> Description <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>    <span class="hljs-string"><span class="hljs-string">`json:"description"`</span></span> UserID      <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-string"><span class="hljs-string">`json:"-"`</span></span> URL         <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`json:"url"`</span></span> CreatedAt   time.Time <span class="hljs-string"><span class="hljs-string">`json:"createdAt"`</span></span> }</code> </pre> <br>  ุฃุถููุง <code>UserID</code> <code>User</code> ูุฃุฒููุง ุจููุฉ <code>User</code> .  ุฌุฏุฏ ุงูุขู ุงูููุฏ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">go</span></span> run scripts/gqlgen.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span> -v</code> </pre> <br>  ุจูุถู ูุฐุง ุงูุฃูุฑ ุ ุณูุชู ุฅูุดุงุก ุทุฑู ุงููุงุฌูุฉ ุงูุชุงููุฉ ูุญู ุงูููุงูู ุบูุฑ ุงููุญุฏุฏุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุณุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ูุง ููู ูู ูุญูู ุงูุจูุงูุงุช (ููู gener.go): <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> VideoResolver <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { User(ctx context.Context, obj *api.Video) (api.User, error) Screenshots(ctx context.Context, obj *api.Video) ([]*api.Screenshot, error) Related(ctx context.Context, obj *api.Video, limit *<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, offset *<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) ([]api.Video, error) }</code> </pre> <br>  ูููุง ููู ุงูุชุนุฑูู (ููู <code>resolver.go</code> ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r *videoResolver)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx context.Context, obj *api.Video)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(api.User, error)</span></span></span></span> { rows, _ := dal.LogAndQuery(r.db,<span class="hljs-string"><span class="hljs-string">"SELECT id, name, email FROM users where id = $1"</span></span>, obj.UserID) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> rows.Close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !rows.Next() {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> api.User{}, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user api.User <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := rows.Scan(&amp;user.ID, &amp;user.Name, &amp;user.Email); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> {   errors.DebugPrintf(err)   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> api.User{}, errors.InternalServerError } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br>  ุงูุขู ุ ุณูู ุชุธูุฑ ูุชุงุฆุฌ ุงุฎุชุจุงุฑ ุงูุทูุฑุฉ ููุง ูู ููุถุญ ุฃุฏูุงู. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/25a/41d/aaa/25a41daaa86b8db5407bd432312c3028.png"></div><br>  <i><font color="#999999">ุทูุฑุฉ ุฎููููุฏูู</font></i> <br><br>  ูุง ูุงูุดูุงู ููุชู ูู ุฃุณุงุณูุงุช GraphQL ุ ุจุนุฏ ุงูุชููู ูู ุ ููููู ุจุงููุนู ูุชุงุจุฉ ุดูุก ุฎุงุต ุจู.  ููุน ุฐูู ุ ูุจู ุงูุงูุฎุฑุงุท ูู ุชุฌุงุฑุจ ูุน GraphQL ู Golang ุ ุณูููู ูู ุงููููุฏ ุงูุชุญุฏุซ ุนู ุงูุงุดุชุฑุงูุงุช ุ ูุงูุชู ุชุฑุชุจุท ุงุฑุชุจุงุทูุง ูุจุงุดุฑูุง ุจูุง ูููู ุจู ููุง. <br><br><h3 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">riptions ุงูุงุดุชุฑุงูุงุช</font> </h3><br>  ูููุฑ GraphQL ุงููุฏุฑุฉ ุนูู ุงูุงุดุชุฑุงู ูู ุชุบููุฑุงุช ุงูุจูุงูุงุช ุงูุชู ุชุญุฏุซ ูู ุงูููุช ุงูุญูููู.  ุชุชูุญ ููุชุจุฉ gqlgen ุ ูู ุงูููุช ุงูุญูููู ุ ุจุงุณุชุฎุฏุงู ูุขุฎุฐ ุงูููุจ ุ ุงูุนูู ูุน ุฃุญุฏุงุซ ุงูุงุดุชุฑุงู. <br><br>  ููุฒู ูุตู ุงูุงุดุชุฑุงู ูู ููู <code>schema.graphql</code> .  ูููุง ููู ูุตู ุงูุงุดุชุฑุงู ูู ุญุฏุซ ูุดุฑ ุงูููุฏูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Subscription {   videoPublished: Video! }</code> </pre> <br>  ุงูุขู ุ ูู ุจุชุดุบูู ุชูููุฏ ุงูุดูุฑุฉ ุงูุชููุงุฆู ูุฑุฉ ุฃุฎุฑู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">go</span></span> run scripts/gqlgen.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span> -v</code> </pre> <br>  ููุง ุณุจู ุฐูุฑู ุ ุฃุซูุงุก ุงูุฅูุดุงุก ุงูุชููุงุฆู ููุฑูุฒ ูู ููู <code>generated.go</code> ุ ูุชู ุฅูุดุงุก ูุงุฌูุฉ ูุฌุจ ุชูููุฐูุง ูู ุฃุฏุงุฉ ุงูุชุนุฑู.  ูู ุญุงูุชูุง ุ ูุจุฏู ูุฐุง (ููู <code>resolver.go</code> ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> videoPublishedChannel <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> api.Video <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { videoPublishedChannel = <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> api.Video{} } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> subscriptionResolver <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{ *Resolver } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r *subscriptionResolver)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VideoPublished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx context.Context)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&lt;-</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">chan</span></span></span></span><span class="hljs-function"><span class="hljs-params"> api.Video, error)</span></span></span></span> { id := randx.String(<span class="hljs-number"><span class="hljs-number">8</span></span>) videoEvent := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> api.Video, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   &lt;-ctx.Done() }() videoPublishedChannel[id] = videoEvent <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> videoEvent, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r *mutationResolver)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateVideo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx context.Context, input NewVideo)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(api.Video, error)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//   ... for _, observer := range videoPublishedChannel {   observer &lt;- newVideo } return newVideo, nil }</span></span></code> </pre> <br>  ุงูุขู ุ ุนูุฏ ุฅูุดุงุก ููุฏูู ุฌุฏูุฏ ุ ุชุญุชุงุฌ ุฅูู ุชุดุบูู ุญุฏุซ.  ูู ูุซุงููุง ุ ูุชู ุฐูู ูู ุงูุณุทุฑ <code>for _, observer := range videoPublishedChannel</code> . <br><br>  ุงูุขู ุญุงู ุงูููุช ููุชุญูู ูู ุงุดุชุฑุงูู. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f71/d7f/42b/f71d7f42b147f59d227a25e577ef57fb.gif"></div><br>  <i><font color="#999999">ุชุญูู ูู ุงูุงุดุชุฑุงู</font></i> <br><br>  ูุฏู GraphQL ุ ุจุงูุทุจุน ุ ูุฏุฑุงุช ูููุฉ ูุนููุฉ ุ ูููู ููุง ูููููู ุ ููุณ ูู ูุง ูููุน ูู ุงูุฐูุจ.  ุฃู ุฃููุง ูุชุญุฏุซ ุนู ุญูููุฉ ุฃู ุงูุดุฎุต ุงูุฐู ูุณุชุฎุฏู GraphQL ูุญุชุงุฌ ุฅูู ุฑุนุงูุฉ ุงูุชูููุถ ูุชุนููุฏ ุงูุทูุจุงุช ูุงูุชุฎุฒูู ุงููุคูุช ููุดููุฉ ุทูุจุงุช N + 1 ูุชูููุฏ ุณุฑุนุฉ ุชูููุฐ ุงูุงุณุชุนูุงู ูุจุนุถ ุงูุฃุดูุงุก ุงูุฃุฎุฑู.  ุฎูุงู ุฐูู ุ ูุฏ ููุงุฌู ูุธุงู ุชู ุชุทููุฑู ุจุงุณุชุฎุฏุงู GraphQL ุงูุฎูุงุถูุง ุฎุทูุฑูุง ูู ุงูุฃุฏุงุก. <br><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">ุงูุชูููุงุช ุงููุชูุฏูุฉ: ุงููุตุงุฏูุฉ ุ ุชุญููู ุงูุจูุงูุงุช ุ ุชุนููุฏ ุงูุงุณุชุนูุงู</font> </h2><br>  ูู ูู ูุฑุฉ ุฃูุฑุฃ ูุชูุจุงุช ูุซู ูุฐู ุ ุฃุดุนุฑ ุฃูู ุฃุชูู ูู ุดูุก ุฃุญุชุงุฌ ุฅูู ูุนุฑูุชู ุนู ุชูููุฉ ูุนููุฉ ูุงูุญุตูู ุนูู ุงููุฏุฑุฉ ุนูู ุญู ุงููุดููุงุช ุจุฃู ุชุนููุฏ ุ ุจุนุฏ ุฅุชูุงููุง. <br><br>  ููู ุนูุฏูุง ุฃุจุฏุฃ ุงูุนูู ูู ูุดุงุฑูุนู ุงูุฎุงุตุฉ ุ ุนุงุฏุฉู ูุง ุฃูุงุฌู ููุงูู ุบูุฑ ูุชููุนุฉ ุชุจุฏู ููุฃููุง ุฃุฎุทุงุก ูู ุงูุฎุงุฏู ุฃู ูุซู ุงูุทูุจุงุช ุงูุชู ูุงูุช ุชุนูู ุนูู ูุฑ ุงูุนุตูุฑ ุ ุฃู ูุซู ุจุนุถ ุญุงูุงุช ุงูุฌููุฏ ุงูุฃุฎุฑู.  ููุชูุฌุฉ ูุฐูู ุ ูู ุฃุฌู ุงูููุงู ุจุฐูู ุ ูุฌุจ ุฃู ุฃุชุนูู ูู ุงูุญุฏูุซ ุนูุง ุจุฏุง ูููููุง ุชูุงููุง.  ูู ูุฐุง ุงูุฏููู ููุณู ุ ุขูู ุฃู ูุชู ุชุฌูุจ ุฐูู.  ูุฐุง ูู ุงูุณุจุจ ูู ูุฐุง ุงููุณู ุณูููู ูุธุฑุฉ ุนูู ุจุนุถ ุงูุชูููุงุช ุงููุชูุฏูุฉ ููุนูู ูุน GraphQL. <br><br><h3 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">โ ุงููุตุงุฏูุฉ</font> </h3><br>  ุนูุฏ ุงูุนูู ูุน REST API ุ ูุฏููุง ูุธุงู ูุตุงุฏูุฉ ูุฃุฏูุงุช ุชูููุถ ููุงุณูุฉ ุนูุฏ ุงูุนูู ูุน ููุทุฉ ููุงูุฉ ูุนููุฉ.  ูููู ุนูุฏ ุงุณุชุฎุฏุงู GraphQL ุ ูุชู ุงุณุชุฎุฏุงู ููุทุฉ ููุงูุฉ ูุงุญุฏุฉ ููุท ุ ูุจุงูุชุงูู ุ ูููู ุญู ููุงู ุงููุตุงุฏูุฉ ุจุงุณุชุฎุฏุงู ุชูุฌููุงุช ุงููุฎุทุท.  ูู ุจุชุญุฑูุฑ ููู <code>schema.graphql</code> ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Mutation {   createVideo(input: NewVideo!): Video! @isAuthenticated } directive @isAuthenticated on FIELD_DEFINITION</code> </pre> <br>  ููุฏ ุฃูุดุฃูุง ุงูุชูุฌูู <code>createVideo</code> ุงุดุชุฑุงู <code>createVideo</code> .  ุจุนุฏ ุฌูุณุฉ ุฅูุดุงุก ุงูุดูุฑุฉ ุงูุชููุงุฆูุฉ ุงูุชุงููุฉ ุ ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุชุนุฑูู ููุฐุง ุงูุชูุฌูู.  ุงูุขู ูุชู ุชูููุฐ ุงูุชูุฌููุงุช ูู ุดูู ุฃุณุงููุจ ุงูููุงูู ุ ูููุณ ูู ุดูู ูุงุฌูุงุช ุ ูุฐูู ูุญู ุจุญุงุฌุฉ ุฅูู ูุตููุง.  ููุฏ ููุช ุจุชุญุฑูุฑ ุงูููุฏ ุงูุฐู ุชู ุฅูุดุงุคู ุชููุงุฆููุง ูุงูููุฌูุฏ ูู ููู <code>server.go</code> ูููุช ุจุฅูุดุงุก ุทุฑููุฉ ุชูุฑุฌุน ุชูููู <code>server.go</code> ูููู <code>server.go</code> .  ููุง ูู ููู <code>resolver.go</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewRootResolvers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(db *sql.DB)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Config</span></span></span></span> { c := Config{   Resolvers: &amp;Resolver{     db: db,   }, } <span class="hljs-comment"><span class="hljs-comment">//   c.Directives.IsAuthenticated = func(ctx context.Context, obj interface{}, next graphql.Resolver) (res interface{}, err error) {   ctxUserID := ctx.Value(UserIDCtxKey)   if ctxUserID != nil {     return next(ctx)   } else {     return nil, errors.UnauthorisedError   } } return c }</span></span></code> </pre> <br>  ููุง ูู ุงูููู <code>server.go</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">rootHandler:= dataloaders.DataloaderMiddleware(   db,   handler.GraphQL(     go_graphql_demo.NewExecutableSchema(go_graphql_demo.NewRootResolvers(db)   ) ) http.Handle(<span class="hljs-string"><span class="hljs-string">"/query"</span></span>, auth.AuthMiddleware(rootHandler))</code> </pre> <br>  ููุฑุฃ <code>ID</code> ุงููุณุชุฎุฏู ูู ุงูุณูุงู.  ูุง ุชุฌุฏ ูุฐุง ุบุฑูุจุ  ููู ุฏุฎู ูุฐุง ุงููุนูู ูู ุงูุณูุงู ูููุงุฐุง ุธูุฑ ูู ุงูุณูุงูุ  ุงูุญูููุฉ ูู ุฃู gqlgen ูููุฑ ุณูุงูุงุช ุงูุทูุจ ููุท ุนูู ูุณุชูู ุงูุชูููุฐ ุ ูุฐูู ููุณ ูุฏููุง ุทุฑููุฉ ููุฑุงุกุฉ ุฃู ุจูุงูุงุช ุทูุจ HTTP ุ ูุซู ุงูุฑุคูุณ ุฃู ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท ุ ูู ุฃุฏูุงุช ุงูุชุนุฑู ุฃู ุงูุชูุฌููุงุช.  ูุชูุฌุฉ ูุฐูู ุ ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุขููุงุช ุงููุณูุทุฉ ุงูุฎุงุตุฉ ุจู ุฅูู ุงููุธุงู ุ ูุชููู ูุฐู ุงูุจูุงูุงุช ููุถุนูุง ูู ุงูุณูุงู. <br><br>  ูุญุชุงุฌ ุงูุขู ุฅูู ูุตู ุขููุฉ ุงููุตุงุฏูุฉ ุงููุณูุทุฉ ุงูุฎุงุตุฉ ุจูุง ููุญุตูู ุนูู ุจูุงูุงุช ุงููุตุงุฏูุฉ ูู ุงูุทูุจ ูุงูุชุญูู ูููุง. <br><br>  ูุง ููุฌุฏ ููุทู ูุญุฏุฏ ููุง.  ุจุฏูุงู ูู ุฐูู ุ ููุญุตูู ุนูู ุจูุงูุงุช ุงูุชุฑุฎูุต ุ ูุฃุบุฑุงุถ ุงูุนุฑุถ ุงูุชูุถูุญู ุ <code>ID</code> ุจุจุณุงุทุฉ ุชูุฑูุฑ <code>ID</code> ุงููุณุชุฎุฏู ููุง.  ุซู ูุชู ุฏูุฌ ูุฐู ุงูุขููุฉ ูู <code>server.go</code> ูุน ุทุฑููุฉ ุชุญููู ุงูุชูููู ุงูุฌุฏูุฏุฉ. <br><br>  ุงูุขู ูุตู ุงูุชูุฌูู ุงูููุทูู.  ูุง ูููู ุจูุนุงูุฌุฉ ุทูุจุงุช ุงููุณุชุฎุฏู ุบูุฑ ุงููุตุฑุญ ุจู ูู ุฑูุฒ ุงููุณูุทุฉ ุ ุญูุซ ุณูุชู ูุนุงูุฌุฉ ูุฐู ุงูุทูุจุงุช ุจูุงุณุทุฉ ุงูุชูุฌูู.  ููุง ูู ููู ูุจุฏู. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/6f6/a26/09c/6f6a2609cec8936c024fd68c7ed30096.png"></div><br>  <i><font color="#999999">ุงูุนูู ูุน ูุณุชุฎุฏู ุบูุฑ ูุตุฑุญ ุจู</font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/267/b92/378/267b923783521a82738973f82600a2a4.png"></div><br>  <i><font color="#999999">ุงูุนูู ูุน ูุณุชุฎุฏู ูุตุฑุญ ูู</font></i> <br><br>  ุนูุฏ ุงูุนูู ูุน ุชูุฌููุงุช ุงููุฎุทุท ุ ููููู ุญุชู ุชูุฑูุฑ ุงููุณุงุฆุท: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">directive @hasRole(role: Role!) on FIELD_DEFINITION enum Role { ADMIN USER }</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">ุฑุงูุนุงุช ุงูุจูุงูุงุช</font> </h3><br>  ูุจุฏู ูู ุฃู ูู ูุฐุง ูุจุฏู ูุซูุฑุง ููุงูุชูุงู.  ููููู ุชูุฒูู ุงูุจูุงูุงุช ุนูุฏ ุงูุญุงุฌุฉ ุฅูููุง.  ุงูุนููุงุก ูุฏููู ุงููุฏุฑุฉ ุนูู ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช ุ ุจุงูุถุจุท ูุง ูู ูุทููุจ ูุคุฎุฐ ูู ุงูุชุฎุฒูู.  ูููู ูู ุดูุก ูู ุซูู. <br><br>  ูุง ูู ุงูุซูู ุงูุฐู ูุฌุจ ุฏูุนู ููุงุจู ูุฐู ุงููุฑุตุ  ุฃููู ูุธุฑุฉ ุนูู ุณุฌูุงุช ุงูุชูุฒูู ูุฌููุน ููุงุทุน ุงูููุฏูู.  ููู ูุชุญุฏุซ ุนู ุญูููุฉ ุฃู ูุฏููุง 8 ููุงุทุน ููุฏูู ู 5 ูุณุชุฎุฏููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">query{ Videos(limit: <span class="hljs-number"><span class="hljs-number">10</span></span>){   name   user{     name   } } }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/562/7c1/b5c/5627c1b5c34f74aec26381f8b0431147.png"></div><br>  <i><font color="#999999">ุชูุงุตูู ุชูุฒูู ุงูููุฏูู</font></i> <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">Query: Videos : SELECT id, name, description, url, created_at, user_id FROM videos ORDER BY created_at desc limit $<span class="hljs-number"><span class="hljs-number">1</span></span> offset $<span class="hljs-number"><span class="hljs-number">2</span></span> Resolver: User : SELECT id, name, email FROM users where id = $<span class="hljs-number"><span class="hljs-number">1</span></span> Resolver: User : SELECT id, name, email FROM users where id = $<span class="hljs-number"><span class="hljs-number">1</span></span> Resolver: User : SELECT id, name, email FROM users where id = $<span class="hljs-number"><span class="hljs-number">1</span></span> Resolver: User : SELECT id, name, email FROM users where id = $<span class="hljs-number"><span class="hljs-number">1</span></span> Resolver: User : SELECT id, name, email FROM users where id = $<span class="hljs-number"><span class="hljs-number">1</span></span> Resolver: User : SELECT id, name, email FROM users where id = $<span class="hljs-number"><span class="hljs-number">1</span></span> Resolver: User : SELECT id, name, email FROM users where id = $<span class="hljs-number"><span class="hljs-number">1</span></span> Resolver: User : SELECT id, name, email FROM users where id = $<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  ูุง ุงูุฐู ูุญุฏุซ ููุงุ  ููุงุฐุง ููุงู 9 ุทูุจุงุช (ูุฑุชุจุท ุทูุจ ูุงุญุฏ ุจุฌุฏูู ุงูููุฏูู ู 8 - ุจุฌุฏูู ุงููุณุชุฎุฏู)ุ  ูุจุฏู ูุฑูุนุง.  ุชููู ููุจู ุชูุฑูุจูุง ุนูุฏูุง ุธููุช ุฃู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุญุงููุฉ ุงูุฎุงุตุฉ ุจูุง ูุฌุจ ุงุณุชุจุฏุงููุง ุจูุฐุง ... ุตุญูุญูุง ุ ูููู ููุงุฏุฑ ุชุญููู ุงูุจูุงูุงุช ุงูุชุนุงูู ูุน ูุฐู ุงููุดููุฉ ุชูุงููุง. <br><br>  ููุนุฑู ูุฐุง ุจูุดููุฉ N + 1. ูุญู ูุชุญุฏุซ ุนู ุญูููุฉ ุฃู ููุงู ุงุณุชุนูุงููุง ูุงุญุฏูุง ููุญุตูู ุนูู ุฌููุน ุงูุจูุงูุงุช ุ ูููู ุฌุฒุก ูู ุงูุจูุงูุงุช (N) ุณูููู ููุงู ุงุณุชุนูุงู ุขุฎุฑ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. <br><br>  ูุฐู ูุดููุฉ ุฎุทูุฑุฉ ููุบุงูุฉ ุนูุฏูุง ูุชุนูู ุงูุฃูุฑ ุจุงูุฃุฏุงุก ูุงูููุงุฑุฏ: ุนูู ุงูุฑุบู ูู ุฃู ูุฐู ุงูุทูุจุงุช ูุชูุงุฒูุฉ ุ ุฅูุง ุฃููุง ุชุณุชูุฒู ููุงุฑุฏ ุงููุธุงู. <br><br>  ูุญู ูุฐู ุงููุดููุฉ ุ ุณูู ูุณุชุฎุฏู ููุชุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">dataloaden</a> ูู ูุคูู ููุชุจุฉ gqlgen.  ุชุณูุญ ูู ูุฐู ุงูููุชุจุฉ ุจุฅูุดุงุก ููุฏ Go.  ุฃููุงู ุ ูู ุจุฅูุดุงุก ูุญูู ุจูุงูุงุช ูููุงู <code>User</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">go</span></span> get github.com/vektah/dataloaden dataloaden github.com/ridhamtarpara/<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>-graphql-demo/api.User</code> </pre> <br>  ูุฏููุง ุชุญุช <code>userloader_gen.go</code> ุ ูุงูุฐู ูุญุชูู ุนูู ุทุฑู ูุซู <code>Fetch</code> ู <code>LoadAll</code> ู <code>Prime</code> . <br><br>  ุงูุขู ุ ูู ุฃุฌู ุงูุญุตูู ุนูู ูุชุงุฆุฌ ุนุงูุฉ ุ ูุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุทุฑููุฉ <code>Fetch</code> (ููู <code>dataloader.go</code> ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataloaderMiddleware</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(db *sql.DB, next http.Handler)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">http</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Handler</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> {   userloader := UserLoader{     wait : <span class="hljs-number"><span class="hljs-number">1</span></span> * time.Millisecond,     maxBatch: <span class="hljs-number"><span class="hljs-number">100</span></span>,     fetch: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ids []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([]*api.User, []error)</span></span></span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sqlQuery <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(ids) == <span class="hljs-number"><span class="hljs-number">1</span></span> {         sqlQuery = <span class="hljs-string"><span class="hljs-string">"SELECT id, name, email from users WHERE id = ?"</span></span>       } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {         sqlQuery = <span class="hljs-string"><span class="hljs-string">"SELECT id, name, email from users WHERE id IN (?)"</span></span>       }       sqlQuery, arguments, err := sqlx.In(sqlQuery, ids)       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> {         log.Println(err)       }       sqlQuery = sqlx.Rebind(sqlx.DOLLAR, sqlQuery)       rows, err := dal.LogAndQuery(db, sqlQuery, arguments...)       <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> rows.Close();       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> {         log.Println(err)       }       userById := <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]*api.User{}       <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rows.Next() {         user:= api.User{}         <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := rows.Scan(&amp;user.ID, &amp;user.Name, &amp;user.Email); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> {           errors.DebugPrintf(err)           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, []error{errors.InternalServerError}         }         userById[user.ID] = &amp;user       }       users := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>([]*api.User, <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(ids))       <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, id := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> ids {         users[i] = userById[id]         i++       }       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> users, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>     },   }   ctx := context.WithValue(r.Context(), CtxKey, &amp;userloader)   r = r.WithContext(ctx)   next.ServeHTTP(w, r) }) }</code> </pre> <br>  ููุง ููุชุธุฑ 1 ูููู ุซุงููุฉ.  ูุจู ุชูููุฐ ุงูุทูุจ ูุฌูุน ุงูุทูุจุงุช ูู ุญุฒู ุชุตู ุฅูู 100 ุทูุจ.  ุงูุขู ุ ุจุฏูุงู ูู ุชูููุฐ ุทูุจ ููู ูุณุชุฎุฏู ุนูู ุญุฏุฉ ุ ุณููุชุธุฑ ุงูููุญูู ุงูููุช ุงููุญุฏุฏ ูุจู ุงููุตูู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ุจุนุฏ ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุชุบููุฑ ููุทู ุฃุฏุงุฉ ุงูุชุนุฑูู ูู ุฎูุงู ุฅุนุงุฏุฉ ุชููููู ุจุงุณุชุฎุฏุงู ุทูุจ ุงุณุชุฎุฏุงู ุฃุฏุงุฉ ุชุญููู ุงูุจูุงูุงุช (ููู <code>resolver.go</code> ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r *videoResolver)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx context.Context, obj *api.Video)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(api.User, error)</span></span></span></span> { user, err := ctx.Value(dataloaders.CtxKey).(*dataloaders.UserLoader).Load(obj.UserID) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *user, err }</code> </pre> <br>  ุฅููู ููู ุชุจุฏู ุงูุณุฌูุงุช ุจุนุฏ ุฐูู ูู ูููู ูุดุงุจู ููุญุงูุฉ ุงูููุถุญุฉ ุฃุนูุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">Query: Videos : SELECT id, name, description, url, created_at, user_id FROM videos ORDER BY created_at desc limit $<span class="hljs-number"><span class="hljs-number">1</span></span> offset $<span class="hljs-number"><span class="hljs-number">2</span></span> Dataloader: User : SELECT id, name, email from users WHERE id IN ($<span class="hljs-number"><span class="hljs-number">1</span></span>, $<span class="hljs-number"><span class="hljs-number">2</span></span>, $<span class="hljs-number"><span class="hljs-number">3</span></span>, $<span class="hljs-number"><span class="hljs-number">4</span></span>, $<span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre> <br>  ูุชู ุชูููุฐ ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุจูุงูุงุช ุงุซููู ููุท ููุง ุ ูุชูุฌุฉ ูุฐูู ุ ุงููู ุณุนูุฏ ุงูุขู.  ูู ุงููุซูุฑ ููุงูุชูุงู ููุงุญุธุฉ ุฃูู ูุชู ุฅุฑุณุงู 5 ูุนุฑููุงุช ูุณุชุฎุฏููู ููุท ุฅูู ุงูุทูุจ ุ ุนูู ุงูุฑุบู ูู ุฃู ุงูุจูุงูุงุช ูุทููุจุฉ ูู ุฃุฌู 8 ููุงุทุน ููุฏูู.  ูุฐุง ูุดูุฑ ุฅูู ุฃู ุฃุฏุงุฉ ุชุญููู ุงูุจูุงูุงุช ุชุฒูู ุงูุณุฌูุงุช ุงูููุฑุฑุฉ. <br><br><h3 style=";text-align:right;direction:rtl"> <font color="#3AC1EF">โ </font> </h3><br> GraphQL   API  ,    .    ,   API   DOS-. <br><br>     ,     . <br><br>   <code>Video</code>  ,   .      GraphQL  <code>Video</code> .           .   โ  . <br><br>  ,      โ   : <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">{ Videos(limit: <span class="hljs-number"><span class="hljs-number">10</span></span>, offset: <span class="hljs-number"><span class="hljs-number">0</span></span>){   name   url   related(limit: <span class="hljs-number"><span class="hljs-number">10</span></span>, offset: <span class="hljs-number"><span class="hljs-number">0</span></span>){     name     url     related(limit: <span class="hljs-number"><span class="hljs-number">10</span></span>, offset: <span class="hljs-number"><span class="hljs-number">0</span></span>){       name       url       related(limit: <span class="hljs-number"><span class="hljs-number">100</span></span>, offset: <span class="hljs-number"><span class="hljs-number">0</span></span>){         name         url       }     }   } } }</code> </pre> <br>           100,        .  (, , )    ,         . <br><br>  gqlgen      ,     .     ,       ( <code>handler.ComplexityLimit(300)</code>   )   GraphQL     (300   ).  ,     ( <code>server.go</code> ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">rootHandler:= dataloaders.DataloaderMiddleware( db, handler.GraphQL(   go_graphql_demo.NewExecutableSchema(go_graphql_demo.NewRootResolvers(db)),   handler.ComplexityLimit(<span class="hljs-number"><span class="hljs-number">300</span></span>) ), )</code> </pre> <br>       ,   ,        .        12.   ,       ,   ,      ( ,  ,  ,   ,     ).    <code>resolver.go</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewRootResolvers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(db *sql.DB)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Config</span></span></span></span> { c := Config{   Resolvers: &amp;Resolver{     db: db,   }, } <span class="hljs-comment"><span class="hljs-comment">//  countComplexity := func(childComplexity int, limit *int, offset *int) int {   return *limit * childComplexity } c.Complexity.Query.Videos = countComplexity c.Complexity.Video.Related = countComplexity //   c.Directives.IsAuthenticated = func(ctx context.Context, obj interface{}, next graphql.Resolver) (res interface{}, err error) {   ctxUserID := ctx.Value(UserIDCtxKey)   if ctxUserID != nil {     return next(ctx)   } else {     return nil, errors.UnauthorisedError   } } return c }</span></span></code> </pre> <br>     ,     ,       . <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/d0a/702/045/d0a7020450bf5115f69c6a1ba61beca4.png"></div><br> <i><font color="#999999">    </font></i> <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/057/fec/7e3/057fec7e30f98b63aed8bbb6aec5193f.png"></div><br> <i><font color="#999999">      </font></i> <br><br>       ,   ,   <code>related</code>  . , , ,      ,             . <br><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">ุงููุชุงุฆุฌ</font> </h2><br> ,        ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GitHub</a> .         .       ,     ,      . <br><br>  <b>ุฃุนุฒุงุฆู ุงููุฑุงุก!</b>     GraphQL  ,   Go? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar444346/">https://habr.com/ru/post/ar444346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar444336/index.html">ููุงุฆู ุงูุงูุชูุงุท ุงูุณุฑูุน: ูุง ุงููุฑู ุจูู ุงูุฑูุงุจุท ุงูุถุนููุฉ ูุงููููุฉ ูุบูุฑ ุงููุนุฑููุฉุ</a></li>
<li><a href="../ar444338/index.html">ุงูุชุบููู ูู ุจูุซูู 3</a></li>
<li><a href="../ar444340/index.html">ููุฒุงุช ุงุณุชุฎุฏุงู ููุน ุงูุจูุงูุงุช Symbol ูู JavaScript</a></li>
<li><a href="../ar444342/index.html">ุชุทููุฑ ุชุทุจููุงุช JavaScript ุจุณูุทุฉ ูุญุฏูุซุฉ ุจุงุณุชุฎุฏุงู Webpack ูุชูููุงุช ุงูููุจ ุงููุชูุฏูุฉ</a></li>
<li><a href="../ar444344/index.html">10 ุฎุทูุงุช ููุดุฑูุน ุจูุซูู ุงููุงุฌุญ</a></li>
<li><a href="../ar444348/index.html">ููู ุชุฎุชูู ููููุงุช React ุงููุธูููุฉ ุนู ุงูููููุงุช ุงููุงุฆูุฉ ุนูู ุงููุตูุ</a></li>
<li><a href="../ar444350/index.html">ูุณุจุจ ูุง ุ ูุง ูุจุฏุฃ MVP (ุงูุญุฏ ุงูุฃุฏูู ูู ุงูููุชุฌ ุงููุงุจู ููุชุทุจูู)</a></li>
<li><a href="../ar444352/index.html">Kontur.Kampus: ูุฏุนูู ุฅูู ูุนุณูุฑ ุทูุงุจู ูุฌุงูู ููุชูููุฉ ุงูุตูุงุนูุฉ ุจุงููุฑุจ ูู ุณุงู ุจุทุฑุณุจุฑุบ</a></li>
<li><a href="../ar444356/index.html">ุฑุฏ ูุนู ุงูุจุฑูุงูุฌ ุงูุชุนูููู ุงูุฌุฒุก 24: ุฃุดูุงู ุงูุฏุฑุณ ุงูุซุงูู</a></li>
<li><a href="../ar444358/index.html">ูููู ุชุนุฏุงุฏู: ููููุฉ ุงูุญุตูู ุนูู ูููุฉ ุงูุนูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>