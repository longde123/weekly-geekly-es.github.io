<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯМЖ ЁЯЕ╛я╕П ЁЯСйтАНЁЯТ╝ YandexSpeechKit рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдПрдХ рдЖрд╡рд╛рдЬ рдЧрд╛рдЗрдб рдХрд╛ рдПрд╣рд╕рд╛рд╕ тЩВя╕П ЁЯСйЁЯП╜тАНЁЯН│ тЬЦя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рд╡рд┐рднрд┐рдиреНрди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди, рдореЗрд░реА рд░рд╛рдп рдореЗрдВ, рд╡реЗ рд╕рднреА рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИрдВред рдореИрдВ рддрд╛рд░рд╛рдВрдХрди рдХреЗ рд▓рд┐рдП рд╡реЙрдпрд╕ рдЧрд╛рдЗрдб рдХреЗ рдЕрдкрдиреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдкреНрд░рд╕реНрдд...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>YandexSpeechKit рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдПрдХ рдЖрд╡рд╛рдЬ рдЧрд╛рдЗрдб рдХрд╛ рдПрд╣рд╕рд╛рд╕</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417273/"><p>  рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рд╡рд┐рднрд┐рдиреНрди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди, рдореЗрд░реА рд░рд╛рдп рдореЗрдВ, рд╡реЗ рд╕рднреА рдХрд╛рдлреА рд╕рд░рд▓ рд╣реИрдВред  рдореИрдВ рддрд╛рд░рд╛рдВрдХрди рдХреЗ рд▓рд┐рдП рд╡реЙрдпрд╕ рдЧрд╛рдЗрдб рдХреЗ рдЕрдкрдиреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВред </p><br><p>  <em>рдиреЛрдЯ:</em> рдореИрдВ рдПрдХ рдкреЗрд╢реЗрд╡рд░ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдирд╣реАрдВ рд╣реВрдВ, рдФрд░ рд╢рд╛рдпрдж рдХреБрдЫ рд╕рдорд╛рдзрд╛рди рдЖрдкрдХреЛ рдЬрдВрдЧрд▓реА рд▓рдЧ рд╕рдХрддреЗ рд╣реИрдВред  рдХреБрдЫ рддрд░рдХреАрдмреЗрдВ рдкреБрд░рд╛рдиреА рд╣реЛ рд╕рдХрддреА рд╣реИрдВред  рдореИрдВ рдЖрд▓реЛрдЪрдирд╛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдФрд░ рдмреЗрд╣рддрд░ рдХреЗ рд▓рд┐рдП рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реВрдВред </p><br><p>  <strong>рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХрд╛ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдг:</strong> </p><br><p>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрд╡реАрдЖрд░ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рддрд╛ рд╣реИ, рдЕрдкрдирд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ рдФрд░, рдЬреНрдпрд╛рджрд╛рддрд░ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдЬрд╣рд╛рдВ рд╡рд╣ рдЪрд╛рд╣рддрд╛ рд╣реИ, рд╡рд╣рд╛рдВ рдкрд╣реБрдВрдЪ рдЬрд╛рддрд╛ рд╣реИред  Mysql рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЗ рд╕рд╛рде рдЖрдВрдХрдбрд╝реЗ рднреА рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП рдЦрд░рд╛рдм рд╣реИрдВред <br>  рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдХрдВрдкрдиреА рдФрд░ рдЙрд╕ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд┐рд╕рдореЗрдВ рдпрд╣ рдкреНрд░рдгрд╛рд▓реА рддреИрдирд╛рдд рд╣реИ: <br>  ~ 1000 рдлреЛрди, рд▓рдЧрднрдЧ 50 рд╡рд┐рднрд╛рдЧ </p><a name="habracut"></a><br><p>  <strong>рд╕рд┐рд╕реНрдЯрдо рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдЙрддреНрдкрд╛рдж:</strong> </p><br><ul><li>  рддрд╛рд░рд╛рдВрдХрди 13.10 </li><li>  YandexSpeechKit </li><li>  рдЕрдЬрдЧрд░ 2.6.6 </li><li>  рдореИрд╕реВрд░, MSSQL </li><li>  sox 14.2.0 </li><li>  рдХрд░реНрд▓ 7.19.7 </li><li>  рд▓рдВрдЧрдбрд╝рд╛ 3.99.5 </li></ul><br><p>  <strong>рддрд╛рд░рд╛рдВрдХрди рдореЗрдВ рдбрд╛рдпрд▓рдкреНрд▓рд╛рди рдХрд╛ рд╡рд░реНрдгрдиред</strong> </p><br><pre><code class="hljs php">[officevoicerec] exten =&gt; s,<span class="hljs-number"><span class="hljs-number">1</span></span>,Answer() same =&gt; n,Macro(hangercheck,${CALLERID(num)}) same =&gt; n,Set(ITERATIONS=<span class="hljs-number"><span class="hljs-number">1</span></span>) same =&gt; n,Set(HANGFLAG=<span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>) same =&gt; n,Background(/<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/asterisk/sounds/ru/speechrec/zdravstvuite)</code> </pre> <br><p>  рдЗрд╕ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ, рдПрдХ рдореИрдХреНрд░реЛ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рдЬрд╛рдВрдЪрд╛ рдЬрд╛ рд╕рдХреЗ рдХрд┐ рдлреЛрди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдиреЗ рд╢реБрднрдХрд╛рдордирд╛ рд╕рдВрджреЗрд╢ рд╕реБрдирдиреЗ рдХреЗ рдмрд╛рдж рд╣реА рд▓рдЯрдХрд╛ рджрд┐рдпрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред  рдЕрдЧрд▓рд╛ рдЪрд░ рдХрд╛ рдорд╛рди рд╕реЗрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИ: <br>  рдорд╛рдиреНрдпрддрд╛ - рдХрд┐рд╕реА рджрд┐рдП рдЧрдП рд╕рдордп рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рджреЛрд╣рд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред  HANGFLAG - рдЗрд╕ рдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реИрдВрдЧрд░рдЪреЗрдХ рдореИрдХреНрд░реЛ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><pre> <code class="hljs ruby">same =&gt; n(rec),Set(RECFILE=<span class="hljs-regexp"><span class="hljs-regexp">/tmp/</span></span>${UNIQUEID}.wav) same =&gt; n,Playback(<span class="hljs-regexp"><span class="hljs-regexp">/var/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/asterisk/sounds</span></span><span class="hljs-regexp"><span class="hljs-regexp">/en/beep</span></span>) same =&gt; n,Record(${RECFILE},<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>) same =&gt; n,AGI(pyreq8.py,${RECFILE}) same =&gt; n,GotoIf($[<span class="hljs-string"><span class="hljs-string">"${NUMTOCALL}"</span></span> = <span class="hljs-string"><span class="hljs-string">"repeat"</span></span>]?repeat) same =&gt; n,Set(HANGFLAG=FALSE)</code> </pre> <br><p>  рд░рд┐рдХреЙрд░реНрдб рдлрд╝рд╛рдЗрд▓ рдЪрд░ рд╕реЗрдЯ рдХрд░реЗрдВ, рдлрд╝рд╛рдЗрд▓ рд▓рд┐рдЦреЗрдВред  рд╣рдо рдорд╛рдиреНрдпрддрд╛ рдФрд░ рд╕рдВрдЦреНрдпрд╛ рдЦреЛрдЬ (рдмрд╛рдж рдореЗрдВ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рд╡рд░реНрдгрди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛) рдХреЗ рд▓рд┐рдП рдлрд╝рд╛рдЗрд▓ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рдПрдХ рдПрдЧреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рддреЗ рд╣реИрдВ, NUMTOCALL рдЪрд░ (рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рдорд╛рди рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ) рдХреА рдЬрд╛рдБрдЪ рдХрд░рддреЗ рд╣реБрдП, HANGFLAG рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╡реНрдпрдХреНрддрд┐ рд╕рдордп рд╕реЗ рдкрд╣рд▓реЗ рд▓рдЯрдХрд╛ рдирд╣реАрдВ рд╣реИред </p><br><pre> <code class="hljs powershell">same =&gt; n,Macro(VRstat,<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CALLERID(num)},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{NUMTOCALL},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{RSTATUS},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CHANNEL},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{RECREZ}) same =&gt; n,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[[<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">EXISTS</span></span>(<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">FNAME</span></span>})}]]?foundName:havenodescr) same =&gt; n(foundName),Set(FILE_FNAME=<span class="hljs-variable"><span class="hljs-variable">$</span></span>{STRREPLACE(FNAME, ,)}) same =&gt; n,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{STAT(f,/var/lib/asterisk/sounds/ru/cache/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{FILE_FNAME}.mp3)}"</span></span>=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]?havecache:nocache)</code> </pre> <br><p>  рдЗрд╕ рдЦрдВрдб рдореЗрдВ, рдпрд╣ рдЬрд╛рдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдореИрдХреНрд░реЛ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдЕрднрд┐рд╡рд╛рджрди рд╕рдВрджреЗрд╢ рдХреЛ рд╕реБрдирдиреЗ рдХреЗ рдмрд╛рдж рдХреЙрд▓рд░ рдХреЛ рд▓рдЯрдХрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдпрд╛ рдирд╣реАрдВ, рдлрд┐рд░ рдЪрд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХрдИ рдмрд╛рд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рджреЛрд╣рд░рд╛рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред  HANGFLAG - рдЗрд╕ рдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реИрдВрдЧрд░рдЪреЗрдХ рдореИрдХреНрд░реЛ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><pre> <code class="hljs ruby">same =&gt; n(rec),Set(RECFILE=<span class="hljs-regexp"><span class="hljs-regexp">/tmp/</span></span>${UNIQUEID}.wav) same =&gt; n,Playback(<span class="hljs-regexp"><span class="hljs-regexp">/var/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/asterisk/sounds</span></span><span class="hljs-regexp"><span class="hljs-regexp">/en/beep</span></span>) same =&gt; n,Record(${RECFILE},<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>) same =&gt; n,AGI(pyreq8.py,${RECFILE}) same =&gt; n,GotoIf($[<span class="hljs-string"><span class="hljs-string">"${NUMTOCALL}"</span></span> = <span class="hljs-string"><span class="hljs-string">"repeat"</span></span>]?repeat) same =&gt; n,Set(HANGFLAG=FALSE)</code> </pre> <br><p>  рд░рд┐рдХреЙрд░реНрдб рдлрд╝рд╛рдЗрд▓ рдЪрд░ рд╕реЗрдЯ рдХрд░реЗрдВ, рдлрд╝рд╛рдЗрд▓ рд▓рд┐рдЦреЗрдВред  рд╣рдо рдлрд╝рд╛рдЗрд▓ рдХреЛ рдорд╛рдиреНрдпрддрд╛ рдХреЗ рд▓рд┐рдП рднреЗрдЬрдиреЗ рдХреА рдЬрд╝рд┐рдореНрдореЗрджрд╛рд░реА рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдирдВрдмрд░ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░рддреЗ рд╣реИрдВ (рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рд╡рд┐рд╡рд░рдг рдиреАрдЪреЗ рд╣реЛрдЧрд╛), NUMTOCALL рдЪрд░ (рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рдорд╛рди рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ) рдХреА рдЬрд╛рдБрдЪ рдХрд░рддреЗ рд╣реБрдП, HANGFLAG рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВ рдХрд┐ рд╡реНрдпрдХреНрддрд┐ рд╕рдордп рд╕реЗ рдкрд╣рд▓реЗ рд▓рдЯрдХрд╛ рдирд╣реАрдВ рдерд╛ред </p><br><pre> <code class="hljs powershell">same =&gt; n,Macro(VRstat,<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CALLERID(num)},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{NUMTOCALL},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{RSTATUS},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CHANNEL},<span class="hljs-variable"><span class="hljs-variable">$</span></span>{RECREZ}) same =&gt; n,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[[<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">EXISTS</span></span>(<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">FNAME</span></span>})}]]?foundName:havenodescr) same =&gt; n(foundName),Set(FILE_FNAME=<span class="hljs-variable"><span class="hljs-variable">$</span></span>{STRREPLACE(FNAME, ,)}) same =&gt; n,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{STAT(f,/var/lib/asterisk/sounds/ru/cache/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{FILE_FNAME}.mp3)}"</span></span>=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]?havecache:nocache) same =&gt; n(nocache),System(curl <span class="hljs-string"><span class="hljs-string">"https://tts.voicetech.yandex.net/generate?format=mp3&amp;lang=ru-RU&amp;speaker=zahar&amp;emotion=neutral&amp;speed=0.8&amp;key="</span></span> <span class="hljs-literal"><span class="hljs-literal">-G</span></span> -<span class="hljs-literal"><span class="hljs-literal">-data</span></span><span class="hljs-literal"><span class="hljs-literal">-urlencode</span></span> <span class="hljs-string"><span class="hljs-string">"text= </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{FNAME}."</span></span> &gt; /tmp/speech-<span class="hljs-variable"><span class="hljs-variable">$</span></span>{UNIQUEID}.mp3) same =&gt; n,System(/usr/local/bin/lame <span class="hljs-literal"><span class="hljs-literal">-S</span></span> -<span class="hljs-literal"><span class="hljs-literal">-scale</span></span> <span class="hljs-number"><span class="hljs-number">30</span></span> /tmp/speech-<span class="hljs-variable"><span class="hljs-variable">$</span></span>{UNIQUEID}.mp3 /var/lib/asterisk/sounds/ru/cache/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{FILE_FNAME}.mp3) same =&gt; n(havecache),Playback(/var/lib/asterisk/sounds/ru/cache/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{FILE_FNAME}) same =&gt; n,Dial(Local/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{NUMTOCALL}@common<span class="hljs-literal"><span class="hljs-literal">-context</span></span>)</code> </pre> <br><p>  рд╡реГрд╕реНрдЯ рдореИрдХреНрд░реЛ рдХреЛ рдЪрд▓рд╛рдирд╛ (рдЖрдВрдХрдбрд╝реЛрдВ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░, рдЗрд╕рдХреА рддреБрдЪреНрдЫрддрд╛ рдХреЗ рдХрд╛рд░рдг рд╡рд░реНрдгрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛)ред  рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЕрдиреБрд░реЛрдз рдХреЗ FNAME рд╡рд┐рд╡рд░рдг (рдЪрд░ pyreq8.py рджреНрд╡рд╛рд░рд╛ рд╕реЗрдЯ рд╣реИ)ред  рдпрджрд┐ рдХреЛрдИ рд╡рд┐рд╡рд░рдг рд╣реИ, рддреЛ рдЪрд░ рдореЗрдВ рдХреИрд╢ рдлрд╝рд╛рдЗрд▓ рдирд╛рдо рд╕реЗрдЯ рдХрд░реЗрдВ рдФрд░ рдЗрд╕рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред  рдпрджрд┐ рдлрд╝рд╛рдЗрд▓ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рдЗрд╕реЗ рд╕рдВрд╢реНрд▓реЗрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдПрдордкреА 3 рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рд╡реЙрд▓реНрдпреВрдо рдмрдврд╝рд╛рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ (рдпрд╛ рдпрджрд┐ рдХреИрд╢ рдореМрдЬреВрдж рд╣реИ), рддреЛ рдЗрд╕реЗ рдЪрд▓рд╛рдПрдВ рдФрд░ рдЧреНрд░рд╛рд╣рдХ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВред </p><br><pre> <code class="hljs powershell">same =&gt; n(repeat),GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{ITERATIONS}"</span></span>=<span class="hljs-string"><span class="hljs-string">"1"</span></span>]?secretary) same =&gt; n,Background(/var/lib/asterisk/sounds/ru/speechrec/<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-literal"><span class="hljs-literal">-wav</span></span>) same =&gt; n,Set(ITERATIONS=<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-variable"><span class="hljs-variable">$</span></span>{<span class="hljs-type"><span class="hljs-type">ITERATIONS</span></span>}+<span class="hljs-number"><span class="hljs-number">1</span></span>]) same =&gt; n,Goto(rec)</code> </pre> <br><p>  рдмрд╛рд░-рдмрд╛рд░ рдкрд╣рдЪрд╛рдиред  рдпрджрд┐ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рддреЛ рд╣рдо рд╕рдЪрд┐рд╡реЛрдВ рдореЗрдВ рдЕрдиреБрд╡рд╛рдж рдХрд░рддреЗ рд╣реИрдВред </p><br><pre> <code class="hljs cmake"> same =&gt; n(secretary),<span class="hljs-keyword"><span class="hljs-keyword">Macro</span></span>(VRstat,<span class="hljs-variable"><span class="hljs-variable">${CALLERID(num)}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${NUMTOCALL}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${RSTATUS}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${CHANNEL}</span></span>,<span class="hljs-variable"><span class="hljs-variable">${RECREZ}</span></span>) same =&gt; n,<span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>(HANGFLAG=<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) same =&gt; n,Dial(Local/<span class="hljs-number"><span class="hljs-number">1000</span></span>@common-context)</code> </pre> <br><p>  рд╕рдЪрд┐рд╡реЛрдВ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рдгред  рд╣рдо рдЖрдВрдХрдбрд╝реЛрдВ рдореЗрдВ рджрд░реНрдЬ рдХрд░рддреЗ рд╣реИрдВ, рдЭрдВрдбрд╛ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╡реЗ рд▓рдЯрдХрд╛ рдирд╣реАрдВред  рд╣рдо рд╕рдЪрд┐рд╡ рдХреЛ рдмреБрд▓рд╛рддреЗ рд╣реИрдВред </p><br><pre> <code class="hljs ruby">same =&gt; n(havenodescr),Playback(<span class="hljs-regexp"><span class="hljs-regexp">/var/lib</span></span><span class="hljs-regexp"><span class="hljs-regexp">/asterisk/sounds</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ru/speechrec</span></span><span class="hljs-regexp"><span class="hljs-regexp">/wait2);thanks-wait) same =&gt; n,Noop('no description') same =&gt; n,Dial(Local/</span></span>${NUMTOCALL}@common-context) same =&gt; n,Hangup()</code> </pre> <br><p>  рдПрдХ рдЧреНрд░рд╛рд╣рдХ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ, рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╡рд┐рд╡рд░рдг рдирд╣реАрдВ рд╣реИред  рд╣рдо рд╕рдВрджреЗрд╢ рдЦреЛ рджреЗрддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдЖрдВрдХрдбрд╝реЛрдВ рдореЗрдВ рджрд░реНрдЬ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВред </p><br><pre> <code class="hljs bash">exten =&gt; h,1,Gotoif($[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${HANGFLAG}</span></span></span><span class="hljs-string">"</span></span>=<span class="hljs-string"><span class="hljs-string">"TRUE"</span></span>]?<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>:noop) same =&gt; n(<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>),Macro(VRstat,<span class="hljs-variable"><span class="hljs-variable">${CALLERID(num)}</span></span>,x,HANGER,<span class="hljs-variable"><span class="hljs-variable">${CHANNEL}</span></span>) same =&gt; n(noop),Noop(<span class="hljs-string"><span class="hljs-string">'exiting'</span></span>)</code> </pre> <br><p>  рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрдВрдЧрд░рдЪреЗрдХ рдореИрдХреНрд░реЛ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рд╕рдорд╛рдкреНрддрд┐ рдХреЛ рд╕рдВрднрд╛рд▓рдирд╛ред </p><br><p>  <strong>рдбрд╛рдпрд▓рди рд╡рд┐рд╡рд░рдгред</strong>  <strong>рдореИрдХреНрд░реЛред</strong> </p><br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">macro</span></span>-<span class="hljs-type"><span class="hljs-type">hangercheck</span></span>] ;<span class="hljs-variable"><span class="hljs-variable">$</span></span>{ARG1} <span class="hljs-literal"><span class="hljs-literal">-clid</span></span> exten =&gt; s,<span class="hljs-number"><span class="hljs-number">1</span></span>,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{ARG1}"</span></span>=<span class="hljs-string"><span class="hljs-string">"anonymous"</span></span>]?<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) exten =&gt; s,n,MYSQL(Connect connid SRV user password db utf8) exten =&gt; s,n,MYSQL(SET NAMES utf8) exten =&gt; s,n,MYSQL(Query resultid <span class="hljs-variable"><span class="hljs-variable">$</span></span>{connid} SELECT IFNULL((SELECT clid from ivr_stat where rstatus=<span class="hljs-string"><span class="hljs-string">"HANGER"</span></span> and calldate &gt;=ADDDATE(NOW(),INTERVAL <span class="hljs-literal"><span class="hljs-literal">-48</span></span> HOUR) and clid=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{ARG1}"</span></span> order by calldate desc limit <span class="hljs-number"><span class="hljs-number">1</span></span>),<span class="hljs-string"><span class="hljs-string">"NF"</span></span>)) exten =&gt; s,n,MYSQL(Fetch fetchid <span class="hljs-variable"><span class="hljs-variable">$</span></span>{resultid} VAR) exten =&gt; s,n,MYSQL(Clear <span class="hljs-variable"><span class="hljs-variable">$</span></span>{resultid}) exten =&gt; s,n,MYSQL(Disconnect <span class="hljs-variable"><span class="hljs-variable">$</span></span>{connid}) exten =&gt; s,n,GotoIf(<span class="hljs-variable"><span class="hljs-variable">$</span></span>[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$</span></span></span><span class="hljs-string">{VAR}"</span></span>=<span class="hljs-string"><span class="hljs-string">"NF"</span></span>]?<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) exten =&gt; s,n,Macro(VRstat,<span class="hljs-variable"><span class="hljs-variable">$</span></span>{ARG1},x,H_RECALL,<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CHANNEL}) exten =&gt; s,n,Dial(Local/<span class="hljs-number"><span class="hljs-number">1000</span></span>@common<span class="hljs-literal"><span class="hljs-literal">-context</span></span>) exten =&gt; s,n,Hangup() exten =&gt; s,n(<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>),Noop(Hanger check failed)</code> </pre> <br><p>  рд╣рдо рдЖрдБрдХрдбрд╝реЛрдВ рдХреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдЬрд╛рдБрдЪ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рджрд┐рдП рдЧрдП рдирдВрдмрд░ рдХреЛ рдкрд┐рдЫрд▓реЗ 48 рдШрдВрдЯреЗ рдХрд╣рд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдЕрдЧрд░ рд╡рд╣ рдорд╛рдиреНрдпрддрд╛ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд┐рдП рдмрд┐рдирд╛ рдлреЛрди рд▓рдЯрдХрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдо рдЗрд╕реЗ рдЖрдБрдХрдбрд╝реЛрдВ рдореЗрдВ рджрд░реНрдЬ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рд╕рдЪрд┐рд╡ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  <strong>рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП sql рдФрд░ mysql рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХрд╛ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдгред</strong> </p><br><p>  Sql рддрд╛рд▓рд┐рдХрд╛ dbo.phrasesред </p><br><p> <code>id(PK, int), phrase (text), number(varchar(50))</code> </p> <br><p>  рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрдг-рдкрд╛рда рдЦреЛрдЬ рдХреЛ рдЙрдард╛рдпрд╛ рдЧрдпрд╛ рд╣реИ; рдпрд╣ рдПрдХ рд▓рдВрдмреА рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╕рдордп рдХреАрд╡рд░реНрдб рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╡рд╛рдХреНрдпрд╛рдВрд╢: "рдХреГрдкрдпрд╛ рдореБрдЭреЗ рд╡рд┐рдЬреНрдЮрд╛рдкрди рд╡рд┐рднрд╛рдЧ рдХреЗ рдПрдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐ рдХреЗ рд╕рд╛рде рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ," рдпрджрд┐ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдХреЛрдИ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рд╣реИ рдЬрд╣рд╛рдВ рд╡рд╛рдХреНрдпрд╛рдВрд╢ = "рд╡рд┐рдЬреНрдЮрд╛рдкрди рд╡рд┐рднрд╛рдЧ", рддреЛ рдХреЙрд▓рд░ рд╕рдВрдмрдВрдзрд┐рдд рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реЛрдЧрд╛ред </p><br><p>  рдореАрдХрд▓ рдЯреЗрдмрд▓ рд░рд┐рдХреЛрдЧрд╕реНрдЯреИрдЯреНрд╕ред </p><br><p> <code>id(PK, int), date (datetime), ctime(float), rtime(float),stime(float), phrase(varchar(60))</code> </p> <br><p>  рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдорд╛рдиреНрдпрддрд╛ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдФрд░ рдорд╛рдиреНрдпрддрд╛ рд╕рдордп рдкрд░ рдЖрдВрдХрдбрд╝реЗ рдПрдХрддреНрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  CIME - рдСрдбрд┐рдпреЛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдХрдирд╡рд░реНрдЯ рдХрд░рдиреЗ рдореЗрдВ рдмрд┐рддрд╛рдпрд╛ рдЧрдпрд╛ рд╕рдордп, рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рдкрд╣рдЪрд╛рдирдиреЗ рдореЗрдВ рдЦрд░реНрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛, stime - рдЦреЛрдЬ рдореЗрдВ рдмрд┐рддрд╛рдпрд╛ рдЧрдпрд╛ рд╕рдордп </p><br><p>  рдорд╛рдпрд┐рдХрд▓ рдЯреЗрдмрд▓ ivr_stat </p><br><p> <code>id(PK, int), calldate (datetime),clid(varchar(15)),duration(int(20)),callednum(varchar(10)),rstatus(varchar(20)),channame(varchar30)),RECREZ(varchar(200))</code> </p> <br><p>  рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдкрд╣рдЪрд╛рди рдкрд░рд┐рдгрд╛рдореЛрдВ (RECREZ, rstatus) рдкрд░ рдирдЬрд╝рд░ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдХреЙрд▓рд░ рдиреЗ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╡рд╛рдХреНрдпрд╛рдВрд╢ (рдбрд┐рдЧреНрдирдо) рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдорд╛рдиреНрдпрддрд╛ рдореЗрдиреВ (рдЕрд╡рдзрд┐) рдФрд░ рдбрд┐рдмрдЧрд┐рдВрдЧ (channame) рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рд╡реНрдпрдХреНрддрд┐ рджреНрд╡рд╛рд░рд╛ рдХрд┐рддрдирд╛ рд╕рдордп рдХрд╛ рдЯреНрд░реИрдХ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдерд╛ </p><br><p>  рдордпреНрдпрдХрд▓ рдХрд╕реНрдЯрдорд░реИрд▓реЗрд╕реНрдЯреНрд╕ рдЯреЗрдмрд▓ред </p><br><p> <code>id(PK, int), nomer(int(10)), request(varchar(100))</code> <br>  рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдореВрд╣реЛрдВ рдФрд░ рд╡рд┐рднрд╛рдЧреЛрдВ рдХреА рдПрдХ рд╕рд╣рд╛рдпрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ред </p><br><p>  рдордпрд╕реНрдХрд▓ рдЕрдВрдХ рддрд╛рд▓рд┐рдХрд╛ред </p><br><p> <code>Num(text), name(text)</code> </p> <br><p>  рдЖрд╡рд╛рдЬ рдЕрднрд┐рдирдп рдХреЗ рд▓рд┐рдП рджрд░реНрдЬ рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рд╡рд░реНрдгрди рдХреЗ рд╕рд╛рде рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ред </p><br><p>  рдореИрд╕рдХрд▓ рдЯреЗрдмрд▓ spravochnik_rus рдФрд░ spravochnik_rus_name_num_no_tops </p><br><p> <code>nomer(varchar(11)), fio(varchar(100))</code> </p> <br><p>  рд╕рдВрдЦреНрдпрд╛ рд╡рд╛рд▓реЗ рд╕рдВрджрд░реНрдн рд╡реНрдпрдХреНрддрд┐ред  рдЖрдВрддрд░рд┐рдХ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓рд╛ рдкреВрд░рд╛ рд╣реЛ рдЧрдпрд╛ рд╣реИред  рджреВрд╕рд░реЗ рдореЗрдВ, рдмрд╛рд╣рд░реА рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП, рдирд┐рджреЗрд╢рдХреЛрдВ рдФрд░ рдкреНрд░рдмрдВрдзрдХреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдПрдХ рд╕рдЪрд┐рд╡рд╛рд▓рдп рдореЗрдВ рд▓рдкреЗрдЯреА рдЬрд╛рддреА рд╣реИред </p><br><p>  <strong>рдПрдЬреАрдЖрдИ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЬреЛ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╡рд╛рдХреНрдпрд╛рдВрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдЕрднрд┐рд╕рд░рдг, рднреЗрдЬрддрд╛ рдФрд░ рдЦреЛрдЬрддрд╛ рд╣реИред</strong> </p><br><p>  рдкреНрд░рдпреБрдХреНрдд рдкреБрд╕реНрддрдХрд╛рд▓рдп: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> difflib <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> exit <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uuid <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> subprocess <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> xml.etree.ElementTree <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MySQLdb <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pymssql <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> string <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> itertools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> permutations <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> remove <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> timeit</code> </pre> <br><p>  рдФрд░ <strong>asterisk.agi</strong> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рднреА, рдЬрд┐рд╕реЗ рд╣рдо рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЖрдпрд╛рдд рдХрд░рддреЗ рд╣реИрдВ (рдбрд┐рдмрдЧрд┐рдВрдЧ рдПрдХ рд╡рд┐рдВрдбреЛрдЬрд╝ рдорд╢реАрди рдкрд░ рдХреА рдЬрд╛рддреА рд╣реИ)ред </p><br><p>  <strong>рдЪрд░реЛрдВ рдХрд╛ рд╡рд░реНрдгрдиред</strong> </p><br><pre> <code class="python hljs">WINDEBUG = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br><p>  рдбрд┐рдмрдЧ рдзреНрд╡рдЬ </p><br><pre> <code class="python hljs">_digits = re.compile(<span class="hljs-string"><span class="hljs-string">'\d'</span></span>)</code> </pre> <br><p>  рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрдХрд▓рд┐рдд рдЪрд░ред </p><br><pre> <code class="python hljs">uniqid = str(uuid.uuid1()).replace(<span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>)</code> </pre> <br><p>  рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдЪрд░ред </p><br><pre> <code class="python hljs">dkey = <span class="hljs-string"><span class="hljs-string">'12345678-9101-1121-3141-51617181920'</span></span></code> </pre> <br><p>  Yandex рднрд╛рд╖рдг рдХрд┐рдЯ рдПрдкреАрдЖрдИ рдХреБрдВрдЬреАред </p><br><pre> <code class="python hljs">lang = <span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span></code> </pre> <br><p>  рдпрд╛рдВрдбреЗрдХреНрд╕ рд╕реНрдкреАрдЪрд┐рдЯрдХ рдХреЗ рд▓рд┐рдП рднрд╛рд╖рд╛ рд╡рд┐рдХрд▓реНрдкред </p><br><pre> <code class="python hljs">topic = <span class="hljs-string"><span class="hljs-string">'queries'</span></span></code> </pre> <br><p>  рдпрд╛рдВрдбреЗрдХреНрд╕ рд╕реНрдкреАрдЪрд┐рдЯрдХ рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдпрддрд╛ рдереАрдо рд╡рд┐рдХрд▓реНрдкред </p><br><pre> <code class="python hljs">callnumber = <span class="hljs-string"><span class="hljs-string">'222'</span></span></code> </pre> <br><p>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЙрд▓ рдирдВрдмрд░ред </p><br><pre> <code class="python hljs">setVar(<span class="hljs-string"><span class="hljs-string">'NUMTOCALL'</span></span>, callnumber)</code> </pre> <br><p>  рдХреБрдЫ рдЧрд▓рдд рд╣реЛрдиреЗ рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЙрд▓ рдирдВрдмрд░ рд╕реЗрдЯ рдХрд░рдирд╛ред </p><br><pre> <code class="python hljs">persondic = dict()</code> </pre> <br><p>  рд╢рдмреНрджрдХреЛрд╢ рдирд╛рдо - рд╕рдВрдЦреНрдпрд╛ред </p><br><pre> <code class="python hljs">persondicFI=dict()</code> </pre> <br><p>  рдПрдлрдЖрдИ тАЛтАЛрд╢рдмреНрджрдХреЛрд╢ - рд╕рдВрдЦреНрдпрд╛ред </p><br><pre> <code class="python hljs">persondicF=dict()</code> </pre> <br><p>  рд╢рдмреНрджрдХреЛрд╢ рдЕрдВрддрд┐рдо рдирд╛рдо - рд╕рдВрдЦреНрдпрд╛ред </p><br><pre> <code class="python hljs">otherdic = dict()</code> </pre> <br><p>  рдкреНрд░рдкрддреНрд░ рдХреА рдЕрдиреНрдп рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╢рдмреНрджрдХреЛрд╢ рд░рд┐рдХреЙрд░реНрдб - рд╕рдВрдЦреНрдпрд╛ред </p><br><pre> <code class="python hljs">descriptions = dict()</code> </pre> <br><p>  рдЖрд╡рд╛рдЬ рдЕрднрд┐рдирдп рдХреА рдкреАрдврд╝реА рдХреЗ рд▓рд┐рдП рд╡рд┐рд╡рд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рд╢рдмреНрджрдХреЛрд╢, рд░рд┐рдХреЙрд░реНрдб - рд╕рдВрдЦреНрдпрд╛ред </p><br><pre> <code class="python hljs">duplicates = list()</code> </pre> <br><p>  рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛ рд╕реВрдЪреА рд▓реЗрддрд╛ рд╣реИред </p><br><pre> <code class="python hljs">nums = list()</code> </pre> <br><p>  рд╕рднреА рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд╕рд╛рде рд╕реВрдЪреАред </p><br><pre> <code class="python hljs">outfile = <span class="hljs-string"><span class="hljs-string">'/tmp/'</span></span> + uniqid + <span class="hljs-string"><span class="hljs-string">'-pcm.wav'</span></span></code> </pre> <br><p>  рдЪрд░ рдЕрд╕реНрдерд╛рдпреА рдЖрдЙрдЯрдкреБрдЯ рдСрдбрд┐рдпреЛ рдлрд╝рд╛рдЗрд▓ред </p><br><pre> <code class="python hljs">mysqlhost=<span class="hljs-string"><span class="hljs-string">'myhost'</span></span> mysqlpass=<span class="hljs-string"><span class="hljs-string">'mypass'</span></span> mysqluser=<span class="hljs-string"><span class="hljs-string">'myuser'</span></span> mysqldb=<span class="hljs-string"><span class="hljs-string">'mydb'</span></span> mssqlhost=<span class="hljs-string"><span class="hljs-string">'mshost'</span></span> mssqlpass=<span class="hljs-string"><span class="hljs-string">'mspass'</span></span> mssqluser=<span class="hljs-string"><span class="hljs-string">'msuser'</span></span> mssqldb=<span class="hljs-string"><span class="hljs-string">'msdb'</span></span></code> </pre> <br><p>  Mysql рдФрд░ mssql рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╡рд░рдгред </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> WINDEBUG: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> asterisk.agi <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * agi = AGI() infile = agi.env[<span class="hljs-string"><span class="hljs-string">'agi_arg_1'</span></span>] caller = agi.get_variable(<span class="hljs-string"><span class="hljs-string">'CALLERID(num)'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: caller = <span class="hljs-string"><span class="hljs-string">'1064'</span></span> infile = <span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre><br><p>  рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЖрдпрд╛рдд рдХрд░реЗрдВ, рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЗрдирдкреБрдЯ рдСрдбрд┐рдпреЛ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдирд╛рдо рдФрд░ рдХреЙрд▓рд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЪрд░ рд╕реЗрдЯ рдХрд░реЗрдВред </p><br><p>  <strong>рдлрд╝реАрдЪрд░ рд╡рд┐рд╡рд░рдг</strong> </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> WINDEBUG: agi.verbose(s) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> s</code> </pre> <br><p>  рдбрд┐рдмрдЧрд┐рдВрдЧ рд╡реИрд░рд┐рдПрдмрд▓ рдХреЗ рдорд╛рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рд╣рдо рддрд╛рд░рд╛рдВрдХрди рдХрдВрд╕реЛрд▓ рдпрд╛ рд╕реНрдЯреИрдбрдЖрдЙрдЯ рдореЗрдВ рд╕рдВрджреЗрд╢ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setVar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(varname, varval)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> WINDEBUG: agi.set_variable(varname, varval) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"setting var "</span></span> + varname + <span class="hljs-string"><span class="hljs-string">" with value "</span></span> + varval</code> </pre> <br><p>  рдбреАрдмрдЧрд┐рдВрдЧ рд╡реИрд░рд┐рдПрдмрд▓ рдХреЗ рдорд╛рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рд╣рдо рдбрд╛рдпрд▓рдкреИрди рд╡реИрд░рд┐рдПрдмрд▓ рдХреЗ рдорд╛рди рдХреЛ рддрд╛рд░рд╛рдВрдХрди рдпрд╛ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рд╕реНрдЯрдбрдЖрдЙрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд╕рд╛рдЗрди рдХрд░рддреЗ рд╣реИрдВред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contains_digits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s)</span></span></span><span class="hljs-function">:</span></span> verb(<span class="hljs-string"><span class="hljs-string">'enter contains_digits'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bool(_digits.search(s))</code> </pre> <br><p>  рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЕрдВрдХ рд╣реИрдВред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return_digits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s)</span></span></span><span class="hljs-function">:</span></span> verb(<span class="hljs-string"><span class="hljs-string">'return digits'</span></span>) pstr = s.encode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) all = string.maketrans(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) nodigs = all.translate(all, string.digits) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> unicode(pstr.translate(all, nodigs), <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>)</code> </pre> <br><p>  рд╣рдо рдПрд╕ рд╕реЗ рдХреЗрд╡рд▓ рдирдВрдмрд░ рд▓реМрдЯрд╛рддреЗ рд╣реИрдВред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_dob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> int(num) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> nums: verb(<span class="hljs-string"><span class="hljs-string">'checkdob success'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: verb(<span class="hljs-string"><span class="hljs-string">'checkdob fail'</span></span> + num) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre> <br><p>  рдЕрдВрдХ рд╕реВрдЪреА рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░ рдХреЗ рдЕрд╕реНрддрд┐рддреНрд╡ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_dob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(strnum)</span></span></span><span class="hljs-function">:</span></span> buf = return_digits(strnum) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> contains_digits(strnum): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> check_dob(buf): verb(<span class="hljs-string"><span class="hljs-string">'setting var '</span></span> + buf) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SAYDIAL'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buf <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"repeat"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"repeat"</span></span></code> </pre> <br><p>  рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╕реЗрдЯрд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рдиред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(infile)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> int(os.stat(infile).st_size) &lt;= <span class="hljs-number"><span class="hljs-number">26364</span></span>: setVar(<span class="hljs-string"><span class="hljs-string">'NUMTOCALL'</span></span>, <span class="hljs-string"><span class="hljs-string">'repeat'</span></span>) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SILENCE'</span></span>) verb(<span class="hljs-string"><span class="hljs-string">'empty file received'</span></span>) remove(infile) exit(<span class="hljs-number"><span class="hljs-number">9</span></span>)</code> </pre> <br><p>  рдорд╛рдиреНрдпрддрд╛ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рдкреНрдд рдСрдбрд┐рдпреЛ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдлрд╝рд╛рдЗрд▓ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛, рдпрджрд┐ рдЖрдХрд╛рд░ рдмрд╣реБрдд рдЫреЛрдЯрд╛ рд╣реИ, рддреЛ рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╡реЗ рд╣реИрдВрдбрд╕реЗрдЯ рдореЗрдВ рдЪреБрдк рдереЗред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSessionStat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctime, rtime, stime, phrase)</span></span></span><span class="hljs-function">:</span></span> cdate = time.strftime(<span class="hljs-string"><span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span></span>) db = MySQLdb.connect(host=mysqlhost, user=mysqluser, passwd=mysqluser, db=mysqldb, charset=<span class="hljs-string"><span class="hljs-string">'utf8'</span></span>) cur = db.cursor() cur.execute( <span class="hljs-string"><span class="hljs-string">"INSERT INTO recogStats(date,ctime,rtime,stime,phrase) VALUES ('"</span></span> + cdate + <span class="hljs-string"><span class="hljs-string">"','"</span></span> + str(ctime) + <span class="hljs-string"><span class="hljs-string">"','"</span></span> + str( rtime) + <span class="hljs-string"><span class="hljs-string">"','"</span></span> + str(stime) + <span class="hljs-string"><span class="hljs-string">"','"</span></span> + phrase + <span class="hljs-string"><span class="hljs-string">"')"</span></span>) db.commit() db.close()</code> </pre> <br><p>  рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдЖрдБрдХрдбрд╝реЗ рдорд╛рдиреНрдпрддрд╛ рд╕рдорд╛рд░реЛрд╣ред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fillDics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> db = MySQLdb.connect(host=mysqlhost, user=mysqluser, passwd=mysqlpass, db=<span class="hljs-string"><span class="hljs-string">"central_cdr"</span></span>, charset=<span class="hljs-string"><span class="hljs-string">'utf8'</span></span>) cur = db.cursor() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(caller) != <span class="hljs-number"><span class="hljs-number">4</span></span>: tbname = <span class="hljs-string"><span class="hljs-string">'spravochnik_rus_name_num_no_tops'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: tbname = <span class="hljs-string"><span class="hljs-string">'svravochnik_rus_persons'</span></span> cur.execute(<span class="hljs-string"><span class="hljs-string">"""SELECT nomer,fio from """</span></span> + tbname) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cur.fetchall(): fullfio=row[<span class="hljs-number"><span class="hljs-number">1</span></span>].lower() f=<span class="hljs-string"><span class="hljs-string">" "</span></span>.join(fullfio.split(<span class="hljs-string"><span class="hljs-string">' '</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> persondicF.keys():<span class="hljs-comment"><span class="hljs-comment"># and f not in duplicates : persondicF[f] = int(row[0]) elif fullfio in persondic.keys(): pass else: duplicates.append(f) if not fullfio in persondic.keys(): persondic[fullfio] = int(row[0]) fi=" ".join(fullfio.split(' ')[0:2]) if not fi in persondicFI.keys(): persondicFI[fi] = int(row[0]) elif fullfio in persondic.keys(): pass else: persondicFI.pop(fi) uniquedups=[x for x in list(set(duplicates)) if x != ''] for item in uniquedups: for key in persondicF.keys(): if item in key: persondicF.pop(key) cur.execute("""SELECT nomer,request from CustomRequests """) for row in cur.fetchall(): otherdic[row[1].lower()] = row[0] cur.execute("""SELECT num,name from numdescriptions """) for row in cur.fetchall(): descriptions[str(row[0])] = row[1] cur.execute("""SELECT nomer from spravochnik_rus """) for row in cur.fetchall(): nums.append(int(row[0])) db.close()</span></span></code> </pre> <br><p>  рдпрд╣ рдлрдВрдХреНрд╢рди рд▓рд╛рд╕реНрдЯ рдиреЗрдо (PersondicF), рд▓рд╛рд╕реНрдЯ рдиреЗрдо (persondicFI), рдиреЗрдо (Persondic), рдбрд┐рдкрд╛рд░реНрдЯрдореЗрдВрдЯ рдиреЗрдо (рдЕрдиреНрдп), рд╕реНрдкреАрдЪ рд╕рд┐рдВрдереЗрд╕рд┐рд╕ рдХреЗ рд▓рд┐рдП рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрд╢рди (рдбрд┐рд╕реНрдХреНрд░рд┐рдкреНрд╢рди) рдФрд░ рд╕рднреА рдХрдВрдкрдиреА рдирдВрдмрд░ (рдЕрдВрдХ) рднрд░рддрд╛ рд╣реИред <br>  рдХреЙрд▓рд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреА рд▓рдВрдмрд╛рдИ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рд▓реА рдЬрд╛рддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдирд┐рджреЗрд╢рдХреЛрдВ (рдЖрдВрддрд░рд┐рдХ рдХреЙрд▓рд░) рдХреА рд╕рдВрдЦреНрдпрд╛ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИ рдпрд╛ рдЗрд╕рдореЗрдВ (рдмрд╛рд╣реНрдп рдХреЙрд▓рд░) рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред <br>  рдЙрдкрдирд╛рдореЛрдВ рдХреА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рджреЛ рдЗрд╡рд╛рдиреЛрд╡реНрд╕ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдмрд╛рд╣рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢рд┐рд╖реНрдЯрддрд╛ рдХреЗ рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(infile, outfile)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#convert file verb("Converting WAV " + infile) soxconvert = subprocess.Popen(['sox', infile, '-r', '16000', '-b', '16', '-c', '1', outfile], stdout=subprocess.PIPE) (out, err) = soxconvert.communicate() # remove(infile) if soxconvert.returncode != 0: setVar('NUMTOCALL', callnumber) # return "" exit(9)</span></span></code> </pre> <br><p>  рдпрджрд┐ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рдорд┐рд▓рддреА рд╣реИ, рддреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕реЗрдЯ рдХреА рдЧрдИ рд╕рдВрдЦреНрдпрд╛ рдФрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдкрд░, рддрд╛рд░рд╛рдВрдХрди рдЪрд┐рд╣реНрди рдореЗрдВ рджрд░реНрдЬ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░реНрдпред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendRecog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(file)</span></span></span><span class="hljs-function">:</span></span> verb(<span class="hljs-string"><span class="hljs-string">"Sending file to yandex: "</span></span> + outfile) proc = subprocess.Popen([<span class="hljs-string"><span class="hljs-string">'curl'</span></span>, <span class="hljs-string"><span class="hljs-string">'--max-time'</span></span>, <span class="hljs-string"><span class="hljs-string">'5'</span></span>, <span class="hljs-string"><span class="hljs-string">'--silent'</span></span>, <span class="hljs-string"><span class="hljs-string">'asr.yandex.net/asr_xml?key='</span></span> + dkey + <span class="hljs-string"><span class="hljs-string">'&amp;uuid='</span></span> + uniqid + <span class="hljs-string"><span class="hljs-string">'&amp;topic='</span></span> + topic + <span class="hljs-string"><span class="hljs-string">'&amp;lang=ru-RU'</span></span>, <span class="hljs-string"><span class="hljs-string">'-F'</span></span>, <span class="hljs-string"><span class="hljs-string">'Content-Type=audio/x-pcm;bit=16;rate=16000'</span></span>, <span class="hljs-string"><span class="hljs-string">'-F'</span></span>, <span class="hljs-string"><span class="hljs-string">'audio=@'</span></span> + outfile], stdout=subprocess.PIPE) (out, err) = proc.communicate() verb(<span class="hljs-string"><span class="hljs-string">"return code is: "</span></span> + str(proc.returncode)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> proc.returncode != <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> remove(file) e = xml.etree.ElementTree.fromstring(out) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.attrib[<span class="hljs-string"><span class="hljs-string">'success'</span></span>] == <span class="hljs-string"><span class="hljs-string">'1'</span></span>: verb(e._children[<span class="hljs-number"><span class="hljs-number">0</span></span>].text) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e._children[<span class="hljs-number"><span class="hljs-number">0</span></span>].text <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br><p>  рдорд╛рдиреНрдпрддрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдлрд╝рд╛рдЗрд▓ рднреЗрдЬрдиреЗ рдФрд░ рдпреИрдВрдбреЗрдХреНрд╕ рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░реНрдпред  рдпрджрд┐ рдорд╛рдиреНрдпрддрд╛ рд╕рдлрд▓ рд╣реИ, рддреЛ рд╣рдо рдкрд╣рд▓рд╛ рдЙрддреНрддрд░ рд▓реЗрддреЗ рд╣реИрдВред  рдореИрдВ рдХрд░реНрд▓ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд╕рд╛рде рдРрд╕рд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрд╛, рдЗрд╕ рдХрд╛рд░рдг рд╕реЗ рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">searchfiobyf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(f.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>))==<span class="hljs-number"><span class="hljs-number">2</span></span>: limit=<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(f.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>))&gt;=<span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: limit=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> fio,num <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> persondic.iteritems(): cutfio=<span class="hljs-string"><span class="hljs-string">" "</span></span>.join(fio.split(<span class="hljs-string"><span class="hljs-string">' '</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>:limit]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> f == cutfio: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fio</code> </pre> <br><p>  рдПрдХ рдкреВрд░реНрдг рдирд╛рдо рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░реНрдп, рдХреЗрд╡рд▓ рдЗрд╕ рдмрд╛рдд рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЕрдВрддрд┐рдо рдирд╛рдо рдпрд╛ рдЕрдВрддрд┐рдо рдирд╛рдо рдФрд░ рдкрд╣рд▓рд╛ рдирд╛рдо рдЗрдирдкреБрдЯ рдХреЗ рд▓рд┐рдП рдЖрдпрд╛ рдерд╛ рдпрд╛ рдирд╣реАрдВред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">combinationSearcher</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(phrase,pdic,quality)</span></span></span><span class="hljs-function">:</span></span> verb(<span class="hljs-string"><span class="hljs-string">u'searching in persons'</span></span>) result = difflib.get_close_matches(phrase, pdic.keys(), <span class="hljs-number"><span class="hljs-number">1</span></span>, quality) <span class="hljs-comment"><span class="hljs-comment">#verb(" ".join(result)) if len(result) &gt; 0: fullfio=searchfiobyf(result[0]) verb(u'found ' + str(pdic[result[0]])) setVar('RSTATUS', 'NAMESUCCESS') setVar('FNAME', fullfio) return pdic[result[0]] else: return ""</span></span></code> </pre> <br><p>  рд╕рдВрдпреЛрдЬрди рдЦреЛрдЬ рдлрд╝рдВрдХреНрд╢рди, рдЙрджрд╛рд╣рд░рдг: рд╡рд╛рдХреНрдпрд╛рдВрд╢ = "рдПрд▓реЗрдХреНрд╕реА рдкреЗрдЯреНрд░", pdic рдореЗрдВ "рдПрд▓реЗрдХреНрд╕реЗрд╡ рдкреАрдЯрд░" рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рд╢рд╛рдорд┐рд▓ рд╣реИ, get_close_matches рдлрд╝рдВрдХреНрд╢рди "рдПрд▓реЗрдХреНрд╕реАрд╡ рдкреАрдЯрд░" рд▓реМрдЯрд╛рдПрдЧрд╛ред  рдлрд╝рдВрдХреНрд╢рди рдЧрд▓рдд рдкрд░рд┐рдгрд╛рдо рджреЗ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди, рдЬреИрд╕рд╛ рдХрд┐ рдЕрднреНрдпрд╛рд╕ рдиреЗ рджрд┐рдЦрд╛рдпрд╛ рд╣реИ, рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╕рд╣реА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рд╣реИрдВред  рдЧреБрдгрд╡рддреНрддрд╛ рдкреИрд░рд╛рдореАрдЯрд░ рдЖрдкрдХреЛ рд╕рдорд╛рди рд╡рд╛рдХреНрдпрд╛рдВрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХреА рд╕рдЯреАрдХрддрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNumByName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(recognizedString)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">u''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> recognizedString: verb(<span class="hljs-string"><span class="hljs-string">'enter dobavochn'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> set_dob(recognizedString) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(recognizedString.replace(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) == <span class="hljs-number"><span class="hljs-number">4</span></span>: verb(<span class="hljs-string"><span class="hljs-string">'enter num say'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> set_dob(recognizedString) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(recognizedString) &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> recognizedString.lower() <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">u""</span></span>,<span class="hljs-string"><span class="hljs-string">u""</span></span>,<span class="hljs-string"><span class="hljs-string">u""</span></span>]: setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SHORT'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"repeat"</span></span> verb(<span class="hljs-string"><span class="hljs-string">u'start searching'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  split = list(set(recognizedString.split(" "))) parts = len(split) fixedstring=" ".join(split) if parts &gt;= 5: verb('Phrase is long. Using FTDB') buf = mssqlwrapper(fixedstring) if buf != '': buf = mssqlwrapper(fixedstring)[0] if str(buf) in descriptions.keys(): setVar('FNAME', descriptions[str(buf)]) setVar('RSTATUS', 'DEPTSUCCESS') return buf else: setVar('RSTATUS', 'REQUESTNOTFOUND') return "repeat" result="" if parts == 1: mssqlcheck=mssqlwrapper(fixedstring) if mssqlcheck!='': if mssqlcheck[2]&gt;=80: buf=str(mssqlcheck[0]) if buf in descriptions.keys(): setVar('FNAME', descriptions[str(buf)]) setVar('RSTATUS', 'DEPTSUCCESS') result=buf else: result=combinationSearcher(fixedstring,persondicF,0.7) elif parts ==2: combs = list(permutations(split, parts)) # (  ,   ,   .....) for item in combs: element = " ".join(item) result=combinationSearcher(element,persondicFI,0.7) if result!="": break elif parts ==3: combs = list(permutations(split, parts)) for item in combs: element = " ".join(item) result=combinationSearcher(element,persondic,0.8) if result!="": break if result!="": return result verb('Low ftdbsearch') buf = mssqlwrapper(recognizedString) if buf != '': buf = mssqlwrapper(recognizedString)[0] if str(buf) in descriptions.keys(): verb('it is') setVar('FNAME', descriptions[str(buf)]) setVar('RSTATUS', 'DEPTSUCCESS') return buf else: verb(u'item not found ' + recognizedString) #    setVar('RSTATUS', 'REQUESTNOTFOUND') return callnumber</span></span></code> </pre> <br><p>  <strong>рд╡рд╛рдХреНрдпрд╛рдВрд╢ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рдореБрдЦреНрдп рдХрд╛рд░реНрдпред</strong> </p><br><p>  рдЖрдЗрдП рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рднрд╛рдЧреЛрдВ рдореЗрдВ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВред </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">u''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> recognizedString: verb(<span class="hljs-string"><span class="hljs-string">'enter dobavochn'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> set_dob(recognizedString)</code> </pre> <br><p>  рдЙрджрд╛рд╣рд░рдг: рд╡рд╛рдХреНрдпрд╛рдВрд╢ "рдХреГрдкрдпрд╛, рд╡рд┐рд╕реНрддрд╛рд░ 1234" рд╡рд┐рд╕реНрддрд╛рд░ рд╕рдВрдЦреНрдпрд╛ (рдпрджрд┐ рдХреЛрдИ рд╣реЛ) рд╡рд╛рдкрд╕ рдХрд░ рджреЗрдЧрд╛ред </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(recognizedString.replace(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) == <span class="hljs-number"><span class="hljs-number">4</span></span>: verb(<span class="hljs-string"><span class="hljs-string">'enter num say'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> set_dob(recognizedString)</code> </pre> <br><p>  рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдиреЗ рдЪрд╛рд░-рдЕрдВрдХреАрдп рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рдЙрдЪреНрдЪрд╛рд░рдг рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рд╕рдВрдмрдВрдзрд┐рдд рдПрдХреНрд╕рдЯреЗрдВрд╢рди (рдпрджрд┐ рдХреЛрдИ рд╣реЛ) рд▓реМрдЯрд╛рдПрдВ </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(recognizedString) &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> recognizedString.lower() <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">u""</span></span>,<span class="hljs-string"><span class="hljs-string">u""</span></span>,<span class="hljs-string"><span class="hljs-string">u""</span></span>]: setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SHORT'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"repeat"</span></span></code> </pre> <br><p>  рдЫреЛрдЯреЗ рд╡рд╛рдХреНрдпрд╛рдВрд╢реЛрдВ рдореЗрдВ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЗ рдЕрдирд╛рд╡рд╢реНрдпрдХ рд░рди рдирд╣реАрдВ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП (рдпрд╣ рддрдм рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдпрд╛рдВрдбреЗрдХреНрд╕ рдиреЗ рдмрд╛рддрдЪреАрдд рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╕реБрдирд╛ рдФрд░ рдкрд╣рдЪрд╛рдирд╛ рдЧрдпрд╛, рдЬрдм рдХреЙрд▓рд░ рдиреЗ рдорд╛рдиреНрдпрддрд╛ рд╕рдВрджреЗрд╢ рдирд╣реАрдВ рд╕реБрдирд╛)ред </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> parts &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span>: verb(<span class="hljs-string"><span class="hljs-string">'Phrase is long. Using FTDB'</span></span>) buf = mssqlwrapper(fixedstring) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> buf != <span class="hljs-string"><span class="hljs-string">''</span></span>: buf = mssqlwrapper(fixedstring)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> str(buf) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> descriptions.keys(): setVar(<span class="hljs-string"><span class="hljs-string">'FNAME'</span></span>, descriptions[str(buf)]) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'DEPTSUCCESS'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buf <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'REQUESTNOTFOUND'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"repeat"</span></span> result=<span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre><br><p>  рд▓рдВрдмреЗ рд╡рд╛рдХреНрдпрд╛рдВрд╢реЛрдВ (рдкрд╛рдВрдЪ рд╕реЗ рдЕрдзрд┐рдХ рд╢рдмреНрджреЛрдВ) рдХреЗ рд▓рд┐рдП, рд╣рдо рддреБрд░рдВрдд mssql рдХреЗ FT рдмреЗрд╕ рдХреА рдУрд░ рдореБрдбрд╝ рдЬрд╛рддреЗ рд╣реИрдВред </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> parts == <span class="hljs-number"><span class="hljs-number">1</span></span>: mssqlcheck=mssqlwrapper(fixedstring) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> mssqlcheck!=<span class="hljs-string"><span class="hljs-string">''</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> mssqlcheck[<span class="hljs-number"><span class="hljs-number">2</span></span>]&gt;=<span class="hljs-number"><span class="hljs-number">80</span></span>: buf=str(mssqlcheck[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> buf <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> descriptions.keys(): setVar(<span class="hljs-string"><span class="hljs-string">'FNAME'</span></span>, descriptions[str(buf)]) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'DEPTSUCCESS'</span></span>) result=buf <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: result=combinationSearcher(fixedstring,persondicF,<span class="hljs-number"><span class="hljs-number">0.7</span></span>)</code> </pre> <br><p>  рдпрджрд┐ рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдореЗрдВ рдПрдХ рд╢рдмреНрдж рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдкрд╣рд▓реЗ рд╣рдо FT рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, 80% рдХреА рд╕рдЯреАрдХрддрд╛ рдХреЗ рд╕рд╛рде, рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд╡рд┐рд╡рд░рдг рдХреА рддрд▓рд╛рд╢ рдХрд░рддреЗ рд╣реИрдВ, рдкрд░рд┐рдгрд╛рдо рдЪрд░ рдФрд░ рд╕реНрдерд┐рддрд┐ рдпреЛрдЬрдирд╛ рдирдВрдмрд░ рдЪрд░ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рдЕрдиреНрдпрдерд╛ рд╣рдо рдЙрдкрдирд╛рдореЛрдВ рдХреЗ рд╢рдмреНрджрдХреЛрд╢ рдореЗрдВ рд╕рдорд╛рди рд╢рдмреНрджреЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рддреЗ рд╣реИрдВред </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> parts ==<span class="hljs-number"><span class="hljs-number">2</span></span>: combs = list(permutations(split, parts)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> combs: element = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(item) result=combinationSearcher(element,persondicFI,<span class="hljs-number"><span class="hljs-number">0.7</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result!=<span class="hljs-string"><span class="hljs-string">""</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre> <br><p>  рдпрджрд┐ рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдореЗрдВ рджреЛ рд╢рдмреНрдж рд╣реИрдВ, рддреЛ рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдПрдХ рдЙрдкрдирд╛рдо рдФрд░ рдПрдХ рдирд╛рдо рд╣реИред <br>  рд╣рдо рд╕рдВрдпреЛрдЬрдиреЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рдмрдирд╛рддреЗ рд╣реИрдВ (рдЗрд╡рд╛рди рдЗрд╡рд╛рди, рдЗрд╡рд╛рди рдЗрд╡рд╛рди) рдФрд░ рдЗрд╕реА рддрд░рд╣ рдХреЗ рдореИрдЪреЛрдВ рдХреА рддрд▓рд╛рд╢ рдХрд░рддреЗ рд╣реИрдВред </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> parts ==<span class="hljs-number"><span class="hljs-number">3</span></span>: combs = list(permutations(split, parts)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> combs: element = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(item) result=combinationSearcher(element,persondic,<span class="hljs-number"><span class="hljs-number">0.8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result!=<span class="hljs-string"><span class="hljs-string">""</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> result!=<span class="hljs-string"><span class="hljs-string">""</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result</code> </pre> <br><p>  рддреАрди-рд╢рдмреНрдж рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдПрдХ рдирд╛рдо рд╣реИ, рд╕рдВрдпреЛрдЬрди рдХреА рдПрдХ рд╕реВрдЪреА рдмрдирд╛рдПрдВ рдФрд░ рдПрдХ рдирд╛рдо рдХреЗ рд╕рд╛рде рд╢рдмреНрджрдХреЛрд╢ рдореЗрдВ рджреЗрдЦреЗрдВред  рдпрджрд┐ рдЪрд░ рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реИ рддреЛ рд╣рдо рдкрд░рд┐рдгрд╛рдо рд▓реМрдЯрд╛рддреЗ рд╣реИрдВред </p><br><pre> <code class="python hljs">buf = mssqlwrapper(recognizedString) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> buf != <span class="hljs-string"><span class="hljs-string">''</span></span>: buf = mssqlwrapper(recognizedString)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> str(buf) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> descriptions.keys(): verb(<span class="hljs-string"><span class="hljs-string">'it is'</span></span>) setVar(<span class="hljs-string"><span class="hljs-string">'FNAME'</span></span>, descriptions[str(buf)]) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'DEPTSUCCESS'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buf <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: verb(<span class="hljs-string"><span class="hljs-string">u'item not found '</span></span> + recognizedString) <span class="hljs-comment"><span class="hljs-comment">#    setVar('RSTATUS', 'REQUESTNOTFOUND') return callnumber</span></span></code> </pre> <br><p>  рдпрджрд┐ рд╣рдореЗрдВ рдорд┐рд▓рд╛рди рдирд╣реАрдВ рдорд┐рд▓рд╛ рд╣реИ, рддреЛ рд╣рдо рдПрдлрдЯреА рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдПрдХ рдЦреЛрдЬ рдХрд░рддреЗ рд╣реИрдВ, рдЕрдЧрд░ рд╣рдореЗрдВ рдПрдХ рдореИрдЪ рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рд╣рдо рдкрд░рд┐рдгрд╛рдо рдФрд░ рд╡рд┐рд╡рд░рдг рд▓реМрдЯрд╛рддреЗ рд╣реИрдВ, рдЕрдиреНрдпрдерд╛ рд╣рдо рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рдВрдЦреНрдпрд╛ рд▓реМрдЯрд╛рддреЗ рд╣реИрдВ рдФрд░ рд╕реНрдерд┐рддрд┐ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдирд╣реАрдВ рдорд┐рд▓рд╛ред </p><br><p>  <strong>рдХрд╛рд░реНрдпрдХреНрд░рдо рдХрд╛ рдореБрдЦреНрдп рдЕрдВрдЧред</strong> </p><br><pre> <code class="python hljs">fillDics() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> WINDEBUG: checkSize(infile) start_time = timeit.default_timer() convert(infile, outfile) convert_elapsed = timeit.default_timer() - start_time start_time = timeit.default_timer() checkstring = sendRecog(outfile).lower() recog_elapsed = timeit.default_timer() - start_time verb(<span class="hljs-string"><span class="hljs-string">'convert_elapsed = '</span></span> + str(recog_elapsed)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> checkstring == <span class="hljs-string"><span class="hljs-string">""</span></span>: verb(<span class="hljs-string"><span class="hljs-string">'not recognized. using default.'</span></span>) setVar(<span class="hljs-string"><span class="hljs-string">'NUMTOCALL'</span></span>, <span class="hljs-string"><span class="hljs-string">'repeat'</span></span>) setVar(<span class="hljs-string"><span class="hljs-string">'RSTATUS'</span></span>, <span class="hljs-string"><span class="hljs-string">'SILENCE'</span></span>) exit(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: setVar(<span class="hljs-string"><span class="hljs-string">'RECREZ'</span></span>, checkstring) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: checkstring = <span class="hljs-string"><span class="hljs-string">u""</span></span> start_time = timeit.default_timer() callnumber = getNumByName(checkstring) search_elapsed = timeit.default_timer() - start_time <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> WINDEBUG: setVar(<span class="hljs-string"><span class="hljs-string">'NUMTOCALL'</span></span>, str(callnumber)) addSessionStat(convert_elapsed, recog_elapsed, search_elapsed, checkstring.lower())</code> </pre> <br><p>  рд╢рдмреНрджрдХреЛрд╢реЛрдВ рдХреЛ рднрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╝рдВрдХреНрд╢рди рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЕрдЧрд░ рд╣рдо рдбрд┐рдмрдЧрд┐рдВрдЧ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рдирд╣реАрдВ рд╣реИрдВ - рд╣рдо рдЯрд╛рдЗрдорд░ рдЪрд░ рдореЗрдВ рднрд░рддреЗ рд╣реИрдВ, рдлрд╝рд╛рдЗрд▓ рдЖрдХрд╛рд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ, рдХрдиреНрд╡рд░реНрдЯ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдорд╛рдиреНрдпрддрд╛ рдХреЗ рд▓рд┐рдП рднреЗрдЬрддреЗ рд╣реИрдВ, рдЕрдиреНрдпрдерд╛ рд╣рдо рдЪреЗрдХ рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдХреЗ рд╕рд╛рде рдЪреЗрдХрд╕реНрдЯреНрд░рд┐рдВрдЧ рдЪрд░ рднрд░рддреЗ рд╣реИрдВред <br>  рдЕрдЧрд▓рд╛, рд╣рдо рдорд╛рдиреНрдпрддрд╛ рдХреЗ рд▓рд┐рдП рдЯрд╛рдЗрдорд░ рдХреЗ рдЪрд░ рдореЗрдВ рднрд░рддреЗ рд╣реИрдВ, рд╣рдо рдЕрдкрдиреА рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рд╡рд╛рдХреНрдпрд╛рдВрд╢реЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рддреЗ рд╣реИрдВред  рдФрд░, рд▓рдбрд╝рд╛рдХреВ рдХрд╛рдордХрд╛рдЬ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдирдВрдмрд░рд┐рдВрдЧ рдпреЛрдЬрдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдЪрд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЖрдВрдХрдбрд╝реЗ рджрд░реНрдЬ рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  <strong>рдХреБрдЫ рдЖрдБрдХрдбрд╝реЗред</strong> </p><br><p>  <em>рдЬреВрди 2018:</em> <br>  рд╕рдлрд▓ рдорд╛рдиреНрдпрддрд╛ - 1010 <br>  рдПрдХ рдЯреНрдпреВрдм рдореЗрдВ рдЪреБрдк рдереЗ - 78 <br>  рдорд╛рдиреНрдпрддрд╛ рд╡рд┐рдлрд▓ (рдХреЛрдИ рдореИрдЪ рдирд╣реАрдВ рдорд┐рд▓рд╛) - 79 <br>  рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдЕрдиреБрд░реЛрдз - 4 <br>  рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╡рд┐рднрд╛рдЧ - 7 <br>  рдФрд╕рдд рдорд╛рдиреНрдпрддрд╛ рд╕рдордп (рдФрд╕рдд Yandex рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп) - 2.6 рд╕реЗрдХрдВрдб </p><br><p>  <em>рдЬреВрди 2017:</em> <br>  рд╕рдлрд▓ рдорд╛рдиреНрдпрддрд╛ - 1271 <br>  рдорд╛рдиреНрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рд╡рд┐рднрд╛рдЧ - 18 <br>  рдорд╛рдиреНрдпрддрд╛ рд╡рд┐рдлрд▓ (рдХреЛрдИ рдореИрдЪ рдирд╣реАрдВ рдорд┐рд▓рд╛) - 127 <br>  рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдЕрдиреБрд░реЛрдз - 9 <br>  рдПрдХ рдЯреНрдпреВрдм рдореЗрдВ рдЪреБрдк рдереЗ - 71 <br>  рдФрд╕рдд рдорд╛рдиреНрдпрддрд╛ рд╕рдордп (рдФрд╕рдд Yandex рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕рдордп) - 1.5 рд╕реЗрдХрдВрдб </p><br><p>  рдпрд╣ рд╕реЗрд╡рд╛ рдЙрд╕ рдХрдВрдкрдиреА рдореЗрдВ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИ рдЬрд╣рд╛рдВ рдореИрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реВрдВред  рдореБрдЭреЗ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдореЗрд░реА рдЙрдкрд▓рдмреНрдзрд┐рдпрд╛рдВ рдЕрдиреНрдп рд▓реЛрдЧреЛрдВ рдХреЛ рдЙрдирдХреЗ рд╡рд┐рдЪрд╛рд░реЛрдВ рдпрд╛ рдЗрд╕реА рддрд░рд╣ рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдорджрдж рдХрд░реЗрдВрдЧреАред  рд╕рднреА рд╕рд╡рд╛рд▓реЛрдВ рдХреЗ рдЬрд╡рд╛рдм рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ред </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi417273/">https://habr.com/ru/post/hi417273/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi417257/index.html">C рдПрдХ рднрд╛рд╖рд╛рдИ рд╡рд┐рд░реЛрдзрд╛рднрд╛рд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi417259/index.html">рдорд╛рд╕реНрдХреЛ рдореЗрдВ 16 рдЬреБрд▓рд╛рдИ рд╕реЗ 22 рдЬреБрд▓рд╛рдИ рддрдХ рдбрд┐рдЬрд┐рдЯрд▓ рдХрд╛рд░реНрдпрдХреНрд░рдо</a></li>
<li><a href="../hi417265/index.html">рд╢реАрд░реНрд╖ 10: рдбреЙрдЯрдиреЗрдХреНрд╕реНрдЯ 2017 рдореЙрд╕реНрдХреЛ рдХреА рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рд░рд┐рдкреЛрд░реНрдЯ</a></li>
<li><a href="../hi417269/index.html">рдПрдХ рдбрд┐рдЬрд╛рдЗрдирд░ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛рдВ рдЬрд╛рдПрдВ: рдкреНрд░рддрд┐рд╖реНрдард┐рдд рдЕрдВрддрд░рд░рд╛рд╖реНрдЯреНрд░реАрдп рдкреБрд░рд╕реНрдХрд╛рд░</a></li>
<li><a href="../hi417271/index.html">рдХреНрдпрд╛ рдХреЛрдИ рд╣реИрдХрд░ рдЕрдВрдЧреНрд░реЗрдЬреА рдЪреИрдирд▓ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реИ?</a></li>
<li><a href="../hi417275/index.html">рдкреНрд░рднрд╛рд╡реА рдбрд┐рдЬрд╛рдЗрдирд░реЛрдВ рдХреЗ 7 рдХреМрд╢рд▓ред рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдХреИрд░рд┐рдпрд░ рд╡рд┐рдХрд╛рд╕ рдЙрдкрдХрд░рдг</a></li>
<li><a href="../hi417277/index.html">рдкреАрдбреАрдПрдл рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдФрд░ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдлреНрдд рдкреБрд╕реНрддрдХрд╛рд▓рдп</a></li>
<li><a href="../hi417283/index.html">рдбрд┐рдЬрд╝рдиреА рдиреЗ рдЕрдкрдирд╛ рд╣реЗрдпрд░рдХрдВрдЯреНрд░реЛрд▓ рд╣реЗрдпрд░ рдПрдирд┐рдореЗрд╢рди рд╕рд┐рд╕реНрдЯрдо рдкреЗрд╢ рдХрд┐рдпрд╛</a></li>
<li><a href="../hi417285/index.html">IPv6 рдореЗрдВ рдХреЛрдЯреЗрд╢рди рдорд╛рд░реНрдХ рдХрд╣рд╛рдВ рд▓рдЧрд╛рдПрдВ</a></li>
<li><a href="../hi417287/index.html">рдЬреБрд▓рд╛рдИ рдХреЗ рд▓рд┐рдП "рдкрд░реАрдХреНрд╖рдХ рдХреИрд▓реЗрдВрдбрд░"ред рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдХреА рдкрд░реАрдХреНрд╖рдг</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>