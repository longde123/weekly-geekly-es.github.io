<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëπ ü¶É ü•Ö CUBA 7: ¬øqu√© hay de nuevo? üëãüèª üë©‚Äçüë¶ üòú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace tres a√±os, anunciamos el lanzamiento de CUBA 6 . Esa versi√≥n se volvi√≥ revolucionaria: en lugar de una licencia propietaria cerrada, comenzamos a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CUBA 7: ¬øqu√© hay de nuevo?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/447538/"><p><img src="https://habrastorage.org/webt/f8/-f/_k/f8-f_kslug-6yzi1yx-ui1e51gy.png"></p><br><p>  Hace tres a√±os, anunciamos el lanzamiento de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CUBA 6</a> .  Esa versi√≥n se volvi√≥ revolucionaria: en lugar de una licencia propietaria cerrada, comenzamos a distribuir el marco libremente, bajo la licencia Apache 2.0.  En ese momento, ni siquiera pod√≠amos tener una idea cercana de c√≥mo esto afectar√≠a el desarrollo del marco a largo plazo.  La comunidad de CUBA comenz√≥ a crecer exponencialmente, y nos encontramos con todas las formas posibles (y a veces imposibles) de usar el marco.  Ahora estamos presentando el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CUBA 7</a> .  Esperamos que esta versi√≥n haga que el desarrollo sea a√∫n m√°s f√°cil y agradable para todos los miembros de la comunidad: desde principiantes que acaban de familiarizarse con CUBA y Java, hasta desarrolladores experimentados que tienen m√°s de un proyecto completado a nivel de una gran empresa. </p><a name="habracut"></a><br><h2 id="instrumenty-razrabotki">  Herramientas de desarrollo </h2><br><p>  Una parte importante del √©xito de CUBA, le debemos a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CUBA Studio</a> .  Este entorno de desarrollo ha simplificado enormemente la implementaci√≥n de tareas t√≠picas que se realizan en cada proyecto Java, reduci√©ndolas a la creaci√≥n de configuraciones simples en dise√±adores visuales.  No necesita conocer todos los atributos de anotaci√≥n de la API de persistencia, la sintaxis de Gradle o las sutilezas de la configuraci√≥n de Spring para desarrollar una aplicaci√≥n CRUD completa y con muchas funciones: CUBA Studio se encarga de crear el c√≥digo t√≠pico. </p><br><p><img src="https://habrastorage.org/webt/lr/5f/8g/lr5f8gtzh5ls_zvskmqccmrccpc.png"></p><br><p>  Studio era una aplicaci√≥n web separada, que caus√≥ una serie de limitaciones significativas: </p><br><ul><li>  En primer lugar, Studio no era un IDE completo, por lo que los desarrolladores tuvieron que cambiar entre Studio e IntelliJ IDEA o Eclipse para desarrollar la l√≥gica empresarial y al mismo tiempo utilizar una navegaci√≥n conveniente, completar el c√≥digo y otras cosas necesarias, lo que fue algo molesto. </li><li>  En segundo lugar, toda esta simplicidad m√°gica se bas√≥ en una gran cantidad de trabajo que gastamos en escribir algoritmos para analizar y generar c√≥digo fuente.  La implementaci√≥n de una funcionalidad a√∫n m√°s avanzada significar√≠a pasar al desarrollo de un IDE completo, una tarea demasiado ambiciosa para nosotros. </li></ul><br><p>  Decidimos confiar en otro gigante para superar estas limitaciones y construimos Studio basado en IntelliJ IDEA.  Ahora puede instalar Studio como una aplicaci√≥n independiente (IntelliJ IDEA Bundle) y como un complemento para IDEA. </p><br><p><img src="https://habrastorage.org/webt/bh/qk/kg/bhqkkgmeebyr6fjyecadq1ln_cm.png"></p><br><p>  Y esto nos da nuevas oportunidades: </p><br><ul><li>  Soporte para otros lenguajes JVM (y, sobre todo, Kotlin) </li><li>  Despliegue en caliente superior </li><li>  Navegaci√≥n intuitiva en todo el proyecto </li><li>  Sugerencias m√°s inteligentes y generadores de c√≥digo </li></ul><br><p>  Actualmente, estamos desarrollando activamente una nueva versi√≥n de Studio: transferimos la funcionalidad de la versi√≥n anterior y agregamos cosas nuevas utilizando la funcionalidad de la plataforma IntelliJ.  En un futuro cercano: la traducci√≥n de editores espec√≠ficos de CUBA a componentes IntelliJ y la mejora de la navegaci√≥n a trav√©s del c√≥digo del proyecto. </p><br><h2 id="obnovlenie-tehnologicheskogo-steka">  Actualizaci√≥n de la pila de tecnolog√≠a </h2><br><p>  Por tradici√≥n, la pila de tecnolog√≠a en el n√∫cleo de CUBA se ha actualizado a nuevas versiones: Java 8/11, Vaadin 8, Spring 5. </p><br><p>  Por defecto, los nuevos proyectos usan Java 8, pero puede especificar la versi√≥n de Java agregando el siguiente c√≥digo al archivo build.gradle: </p><br><pre><code class="plaintext hljs">subprojects { sourceCompatibility = JavaVersion.VERSION_11 targetCompatibility = JavaVersion.VERSION_11 }</code> </pre> <br><p>  Un problema especialmente grande fue la actualizaci√≥n a Vaadin 8, en la que la API de enlace de datos ha cambiado mucho.  Afortunadamente, CUBA protege a los desarrolladores de los componentes internos de Vaadin, envolvi√©ndolos en su propia API.  El equipo de CUBA hizo un gran trabajo al actualizar los componentes internos sin cambiar la API de CUBA.  Esto significa que la compatibilidad se conserva por completo, y puede aprovechar todas las nuevas caracter√≠sticas de Vaadin 8 inmediatamente despu√©s de migrar el proyecto a CUBA 7, sin realizar ninguna refactorizaci√≥n. </p><br><p>  Una lista completa de dependencias actualizadas est√° disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la lista de cambios</a> . </p><br><h2 id="novyy-api-ekranov">  Nuevas pantallas API </h2><br><p>  Esta secci√≥n podr√≠a llamarse la "API de la primera pantalla", ya que CUBA nunca tuvo una API de pantalla anunciada oficialmente en el m√≥dulo de cliente web.  Esto sucedi√≥ hist√≥ricamente, incluso debido a algunos supuestos que surgieron en la etapa inicial: </p><br><ul><li>  Un enfoque orientado a la declaraci√≥n: todo lo que podr√≠a describirse declarativamente ten√≠a que declararse en el descriptor de la pantalla, y no en el c√≥digo del controlador. </li><li>  Las pantallas est√°ndar (navegador y editor) proporcionaban una cierta funcionalidad general, y no hab√≠a necesidad de cambiarla. </li></ul><br><p><img src="https://habrastorage.org/webt/vd/ym/le/vdymlejgwnh3eco6adm3ly5smmi.png"></p><br><p>  Cuando los primeros mil miembros se unieron a nuestra comunidad, nos dimos cuenta de cu√°ntos requisitos diferentes se colocan en las pantallas CRUD "est√°ndar".  Y todos estos requisitos fueron mucho m√°s all√° de la funcionalidad inicial.  Sin embargo, durante mucho tiempo pudimos satisfacer las solicitudes para implementar un comportamiento de pantalla at√≠pico sin cambiar la API, gracias a otro principio arquitect√≥nico establecido en la etapa inicial: herencia abierta.  De hecho, la herencia abierta significa que puede reescribir cualquier m√©todo p√∫blico o protegido de la clase principal para personalizar su comportamiento de acuerdo con sus necesidades.  Esto puede parecer una panacea milagrosa, pero de hecho no puede confiar en ella ni siquiera a corto plazo.  ¬øQu√© sucede si un m√©todo anulado se renombra, se elimina o simplemente nunca se usa en futuras versiones del marco? </p><br><p>  Entonces, en respuesta a la creciente demanda de la comunidad, decidimos introducir una nueva API de pantalla.  Esta API proporciona puntos de extensi√≥n claros (sin ninguna magia oculta), flexibles y f√°ciles de usar que se garantiza que no cambiar√°n durante mucho tiempo. </p><br><h3 id="deklaraciya-ekranov">  Declaraci√≥n de pantalla </h3><br><p>  En CUBA 7, declarar pantallas es extremadamente simple: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@UiController</span></span>(<span class="hljs-string"><span class="hljs-string">"new-screen"</span></span>) <span class="hljs-comment"><span class="hljs-comment">// screen id public class NewScreen extends Screen { }</span></span></code> </pre> <br><p>  El ejemplo anterior muestra que el identificador de pantalla se define expl√≠citamente directamente encima de la declaraci√≥n de clase de controlador.  En otras palabras, la ID de pantalla y la clase de controlador ahora coinciden entre s√≠ de una manera √∫nica.  Entonces, tenemos buenas noticias: ahora puede acceder de forma segura a las pantallas directamente por tipo de controlador: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ScreenBuilders screenBuilders; <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBeforeClose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BeforeCloseEvent event)</span></span></span><span class="hljs-function"> </span></span>{ screenBuilders.screen(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .withScreenClass(SomeConfirmationScreen.class) .build() .show(); }</code> </pre> <br><p>  El descriptor de pantalla se convierte en una parte opcional de la pantalla.  Una IU puede crearse mediante programaci√≥n o declararse como un descriptor de pantalla xml, que se define mediante la anotaci√≥n <code>@UiDescriptor</code> sobre la clase de controlador.  Esto hace que los controladores y el marcado sean mucho m√°s f√°ciles de leer y comprender: este enfoque es muy similar al utilizado en el desarrollo de Android. </p><br><p>  Anteriormente, tambi√©n era necesario registrar un identificador de pantalla en el archivo web-Screens.xml y asignarle un identificador.  En CUBA 7, este archivo se guard√≥ con fines de compatibilidad, pero la nueva forma de crear pantallas no requiere dicho registro. </p><br><h3 id="zhiznennyy-cikl-ekrana">  Ciclo de vida de la pantalla </h3><br><p>  La nueva API presenta eventos de ciclo de vida de pantalla simples y autoexplicativos: </p><br><ul><li>  Init </li><li>  Afterinit </li><li>  Antes de </li><li>  Despu√©s del espect√°culo </li><li>  Antes de cerrar </li><li>  Afterclose </li></ul><br><p>  Puede suscribirse a todos los eventos en CUBA 7 de la siguiente manera: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@UiController</span></span>(<span class="hljs-string"><span class="hljs-string">"new-screen"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NewScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InitEvent event)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBeforeShow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BeforeShowEvent event)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><p>  En comparaci√≥n con el enfoque anterior, la nueva API muestra que no se superponen los m√©todos de enlace que se invocan impl√≠citamente en la inicializaci√≥n, sino que se define expl√≠citamente la l√≥gica para procesar un evento espec√≠fico y espec√≠fico del ciclo de vida de la pantalla. </p><br><h3 id="obrabotka-sobytiy-i-funkcionalnye-delegaty">  Manejo de eventos y delegados funcionales </h3><br><p>  En la secci√≥n anterior, aprendimos c√≥mo suscribirse a los eventos del ciclo de vida, pero ¬øqu√© pasa con los otros componentes?  ¬øSigue siendo necesario verter todos los oyentes necesarios en el mismo mont√≥n al inicializar la pantalla, en el m√©todo init (), como lo fue en las versiones 6.x?  La nueva API es bastante consistente, por lo que puede suscribirse a otros eventos de la misma manera que en los eventos de la vida de la pantalla. </p><br><p>  Considere un ejemplo simple con dos elementos de la interfaz de usuario: un bot√≥n y un campo para mostrar la cantidad de dinero en una determinada moneda;  El descriptor XML se ver√° as√≠: </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.haulmont.com/cuba/screen/window.xsd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">caption</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"msg://caption"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">messagesPack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.company.demo.web"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">spacing</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">currencyField</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"currencyField"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currency</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyLabelPosition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LEFT"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"calcPriceBtn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">caption</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Calculate Price"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbox</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Cuando hace clic en el bot√≥n, llamamos al servicio desde el backend, que devuelve un n√∫mero, lo escribimos en el campo de cantidad.  Este campo debe cambiar el estilo seg√∫n el valor del precio. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@UiController</span></span>(<span class="hljs-string"><span class="hljs-string">"demo_MyFirstScreen"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@UiDescriptor</span></span>(<span class="hljs-string"><span class="hljs-string">"my-first-screen.xml"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyFirstScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PricingService pricingService; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CurrencyField&lt;BigDecimal&gt; currencyField; <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span>(<span class="hljs-string"><span class="hljs-string">"calcPriceBtn"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCalcPriceBtnClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Button.ClickEvent event)</span></span></span><span class="hljs-function"> </span></span>{ currencyField.setValue(pricingService.calculatePrice()); } <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span>(<span class="hljs-string"><span class="hljs-string">"currencyField"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPriceChange</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HasValue.ValueChangeEvent&lt;BigDecimal&gt; event)</span></span></span><span class="hljs-function"> </span></span>{ currencyField.setStyleName(getStyleNameByPrice(event.getValue())); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStyleNameByPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BigDecimal price)</span></span></span><span class="hljs-function"> </span></span>{ ... } }</code> </pre> <br><p>  En el ejemplo anterior, vemos dos controladores de eventos: uno se llama cuando se presiona el bot√≥n y el otro se inicia cuando el campo de moneda cambia su valor; todo es simple. </p><br><p>  Ahora imagine que necesitamos verificar el precio y asegurarnos de que su valor sea positivo.  Esto se puede hacer "frente" - agregue un validador durante la inicializaci√≥n de la pantalla: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@UiController</span></span>(<span class="hljs-string"><span class="hljs-string">"demo_MyFirstScreen"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@UiDescriptor</span></span>(<span class="hljs-string"><span class="hljs-string">"my-first-screen.xml"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyFirstScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CurrencyField&lt;BigDecimal&gt; currencyField; <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InitEvent event)</span></span></span><span class="hljs-function"> </span></span>{ currencyField.addValidator(value -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value.compareTo(BigDecimal.ZERO) &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationException(<span class="hljs-string"><span class="hljs-string">"Price should be greater than zero"</span></span>); }); } }</code> </pre> <br><p>  En aplicaciones reales, despu√©s de alg√∫n tiempo, el m√©todo de inicializaci√≥n ser√° un desastre de inicializadores, validadores, oyentes, etc.  Para resolver este problema, CUBA tiene una √∫til anotaci√≥n <code>@Install</code> .  Veamos c√≥mo puede ayudar en nuestro caso: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@UiController</span></span>(<span class="hljs-string"><span class="hljs-string">"demo_MyFirstScreen"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@UiDescriptor</span></span>(<span class="hljs-string"><span class="hljs-string">"my-first-screen.xml"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyFirstScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CurrencyField&lt;BigDecimal&gt; currencyField; <span class="hljs-meta"><span class="hljs-meta">@Install</span></span>(to = <span class="hljs-string"><span class="hljs-string">"currencyField"</span></span>, subject = <span class="hljs-string"><span class="hljs-string">"validator"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currencyFieldValidator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BigDecimal value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value.compareTo(BigDecimal.ZERO) &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationException(<span class="hljs-string"><span class="hljs-string">"Price should be greater than zero"</span></span>); } }</code> </pre> <br><p>  De hecho, delegamos la l√≥gica de validaci√≥n del campo de moneda al m√©todo currencyFieldValidator en la pantalla.  Esto puede parecer un poco complicado a primera vista, pero los desarrolladores se acostumbraron sorprendentemente r√°pido a este m√©todo de agregar funcionalidad e inmediatamente comenzaron a usarlo. </p><br><h3 id="postroiteli-ekranov-notifikacii-dialogi">  Creadores de pantalla, notificaciones, di√°logos. </h3><br><p><img src="https://habrastorage.org/webt/mo/ni/n-/monin-pixoctyntukkkflsdgvc4.png"></p><br><p>  CUBA 7 tiene un conjunto de componentes √∫tiles con una API conveniente: </p><br><ul><li>  <strong>ScreenBuilders</strong> combina f√°bricas fluidas para crear pantallas est√°ndar para ver y editar entidades, as√≠ como pantallas personalizadas.  El siguiente ejemplo muestra c√≥mo puede abrir una pantalla desde otra.  Tenga en cuenta que el m√©todo build () devuelve inmediatamente la pantalla del tipo deseado sin la necesidad de una conversi√≥n: <br><pre> <code class="java hljs">CurrencyConversions currencyConversions = screenBuilders.screen(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .withScreenClass(CurrencyConversions.class) .withLaunchMode(OpenMode.DIALOG) .build(); currencyConversions.setBaseCurrency(Currency.EUR); currencyConversions.show();</code> </pre> </li><li>  El componente <strong>Pantallas</strong> proporciona un nivel m√°s bajo de abstracci√≥n para crear y mostrar pantallas, a diferencia de la <em>API ScreenBuilders</em> .  Tambi√©n proporciona acceso a informaci√≥n sobre todas las pantallas abiertas en su aplicaci√≥n CUBA ( <em>Screens # getOpenedScreens</em> ), si de repente necesita <em>revisarlas</em> todas en un ciclo. </li><li>  Los <strong>componentes de</strong> <strong>Notificaciones</strong> y <strong>Di√°logos</strong> proporcionan una API conveniente y literalmente autodocumentada.  El siguiente es un ejemplo de creaci√≥n y visualizaci√≥n de un cuadro de di√°logo y notificaci√≥n: <br><pre> <code class="java hljs">dialogs.createOptionDialog() .withCaption(<span class="hljs-string"><span class="hljs-string">"My first dialog"</span></span>) .withMessage(<span class="hljs-string"><span class="hljs-string">"Would you like to thank CUBA team?"</span></span>) .withActions( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DialogAction(DialogAction.Type.YES).withHandler(e -&gt; notifications.create() .withCaption(<span class="hljs-string"><span class="hljs-string">"Thank you!"</span></span>) .withDescription(<span class="hljs-string"><span class="hljs-string">"We appreciate all community members"</span></span>) .withPosition(Notifications.Position.MIDDLE_CENTER) .withHideDelayMs(<span class="hljs-number"><span class="hljs-number">3000</span></span>) .show()), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DialogAction(DialogAction.Type.CANCEL) ) .show();</code> </pre> </li></ul><br><h3 id="privyazka-dannyh">  Enlace de datos </h3><br><p>  CUBA proporciona un desarrollo de interfaz de usuario extremadamente r√°pido para el back office, no solo con herramientas avanzadas de desarrollo visual y un poderoso sistema de generaci√≥n de c√≥digo, sino tambi√©n con su rico conjunto de componentes disponibles de inmediato.  Estos componentes solo necesitan saber con qu√© datos est√°n trabajando, y el resto se har√° autom√°ticamente.  Por ejemplo, listas desplegables, calendarios, tablas con operaciones CRUD integradas, etc. </p><br><p>  Antes de la versi√≥n 7, el enlace de datos se realizaba a trav√©s del llamado origen de datos, objetos que envuelven una o m√°s entidades para su enlace reactivo a los componentes.  Este enfoque funcion√≥ muy bien, pero en t√©rminos de implementaci√≥n, fue un monolito.  La arquitectura monol√≠tica suele ser problem√°tica de configurar, por lo que en CUBA 7 este enorme adoqu√≠n se dividi√≥ en tres componentes para trabajar con datos: </p><br><ul><li>  El cargador de datos es un proveedor de datos para contenedores de datos.  El cargador no almacena datos, simplemente pasa todos los par√°metros de consulta necesarios al almac√©n de datos y coloca los datos resultantes en contenedores de datos. </li><li>  El contenedor de datos guarda los datos cargados (una o m√°s entidades) y los proporciona a los componentes de datos: todos los cambios en estas entidades se transfieren a los componentes correspondientes y viceversa, todos los cambios en los componentes conducir√°n a los cambios correspondientes en las entidades que se encuentran en el contenedor de datos. </li><li>  Datacontext (contexto de datos) es una clase que rastrea los cambios y almacena todas las entidades modificadas.  Las entidades monitoreadas se marcan como sucias cada vez que cambian sus atributos, y el DataContext guarda instancias sucias en Middleware cuando se llama a su m√©todo commit (). </li></ul><br><p>  Por lo tanto, hay flexibilidad para trabajar con datos.  Un ejemplo artificial: el cargador puede seleccionar datos en la interfaz de usuario de un RDBMS, y el contexto puede guardar los cambios en el servicio REST. </p><br><p>  En CUBA 6.x, deber√° escribir su propia fuente de datos para esto, que puede funcionar tanto con RDBMS como con REST.  En CUBA 7, puede tomar un cargador est√°ndar que pueda funcionar con la base de datos y escribir solo su implementaci√≥n de contexto para trabajar con REST. </p><br><p>  Los componentes para trabajar con datos se pueden declarar en descriptores de pantalla o crear mediante programaci√≥n utilizando una f√°brica especializada: DataComponents. </p><br><h3 id="prochee">  Otros </h3><br><p>  Uff ... Se describen las partes m√°s importantes de la nueva API en pantalla, as√≠ que enumeremos brevemente otras funciones importantes a nivel de cliente web: </p><br><ul><li>  <strong>Historial de URL y navegaci√≥n</strong> .  Esta funci√≥n resuelve un problema de SPA muy com√∫n: el comportamiento del bot√≥n Atr√°s en el navegador web no siempre es correcto.  Ahora proporciona una manera f√°cil de asignar rutas a las pantallas de aplicaciones y permite que la API muestre el estado actual de la pantalla en una URL. </li><li>  <strong>Formulario en lugar de FieldGroup</strong> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FieldGroup</a> es un componente para mostrar y cambiar los campos de una entidad.  Muestra la IU para el campo en tiempo de ejecuci√≥n.  En otras palabras, si la entidad tiene un campo Fecha, se mostrar√° como <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DateField</a></em> .  Sin embargo, si desea trabajar con este campo mediante programaci√≥n, deber√° ingresarlo en el controlador de pantalla y convertirlo manualmente al tipo correcto ( <em>DateField en nuestro ejemplo</em> ).  Si luego cambiamos el tipo de campo a otro, nuestra aplicaci√≥n se bloquear√° en tiempo de ejecuci√≥n.  El formulario resuelve este problema declarando expl√≠citamente el tipo de campo.  Puede encontrar m√°s informaci√≥n sobre el componente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </li><li>  <strong>La integraci√≥n de componentes JavaScript de terceros se</strong> simplifica enormemente; lea la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> sobre c√≥mo incorporar componentes JavaScript personalizados en una aplicaci√≥n CUBA. </li><li>  <strong>Los</strong> atributos <strong>HTML / CSS</strong> ahora pueden definirse f√°cilmente directamente desde el descriptor de pantalla xml o configurarse mediante programaci√≥n.  M√°s informaci√≥n se puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </li></ul><br><h2 id="novye-vozmozhnosti-bekend-modulya">  Nuevas caracter√≠sticas del m√≥dulo de backend </h2><br><p>  La secci√≥n anterior en la nueva API en pantalla result√≥ ser m√°s de lo que esperaba, por lo que en esta secci√≥n ser√© breve. </p><br><h3 id="sobytie-entity-changed">  Evento modificado de entidad </h3><br><p>  El evento Entity Changed es un evento en una aplicaci√≥n Spring que se activa cuando una entidad ingresa a un almac√©n de datos, se coloca f√≠sicamente y est√° a un paso de la confirmaci√≥n.  Al procesar este evento, puede configurar verificaciones adicionales (por ejemplo, verificar la disponibilidad de mercanc√≠as en el almac√©n antes de confirmar el pedido) y cambiar los datos (por ejemplo, recalcular los totales) justo antes de que sean visibles para otras transacciones (por supuesto, si tiene un nivel leer el aislamiento comprometido).  Este evento tambi√©n puede ser la √∫ltima oportunidad para abortar la transacci√≥n lanzando una excepci√≥n, que puede ser √∫til en algunos casos dif√≠ciles. </p><br><p>  Tambi√©n hay una manera de manejar el evento Entity Changed inmediatamente despu√©s de un commit. </p><br><p>  Puede ver un ejemplo en este <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cap√≠tulo de la documentaci√≥n</a> . </p><br><h3 id="tranzakcionnyy-menedzher-dannyh">  Administrador de datos transaccionales </h3><br><p>  Al desarrollar una aplicaci√≥n, generalmente trabajamos con entidades separadas, aquellas que no est√°n en el contexto de ninguna transacci√≥n.  Sin embargo, no siempre es posible trabajar con entidades separadas, especialmente cuando necesita cumplir completamente con los requisitos de ACID; este es el caso cuando puede usar un administrador de datos transaccionales.  Es muy similar a un gerente regular, pero difiere en los siguientes aspectos: </p><br><ul><li>  Puede unirse a una transacci√≥n existente (que se llama en el contexto de esta transacci√≥n) o crear su propia transacci√≥n. </li><li>  No tiene un m√©todo de confirmaci√≥n, pero hay un m√©todo de guardar que no se compromete inmediatamente, pero espera a que se confirme la transacci√≥n actual. </li></ul><br><p>  Aqu√≠ hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un ejemplo de</a> su uso. </p><br><h3 id="obratnye-vyzovy-jpa">  Callbacks JPA </h3><br><p>  Finalmente, CUBA 7 admite devoluciones de llamada JPA.  Para no repetir los materiales conocidos para el uso de estas devoluciones de llamada, solo dejo un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace</a> aqu√≠.  En este material, el tema de las devoluciones de llamada se divulga completamente. </p><br><h2 id="kak-naschet-sovmestimosti">  ¬øQu√© hay de la compatibilidad? </h2><br><p><img src="https://habrastorage.org/webt/tk/fu/lb/tkfulbguaccnmhsisnhgsgepteg.png"></p><br><p>  ¬°Una pregunta justa para cualquier lanzamiento importante, especialmente cuando hay tantos cambios cr√≠ticos!  Desarrollamos todas estas nuevas caracter√≠sticas y API con compatibilidad con versiones anteriores: </p><br><ul><li>  La antigua API es compatible con CUBA 7 y se implementa a trav√©s de la nueva bajo el cap√≥ :) </li><li>  Tambi√©n proporcionamos adaptadores para el enlace de datos a trav√©s de la antigua API.  Estos adaptadores funcionar√°n perfectamente para pantallas creadas de acuerdo con el esquema anterior. </li></ul><br><p>  La buena noticia es que el proceso de migraci√≥n de la versi√≥n 6 a la 7 deber√≠a ser bastante simple. </p><br><h2 id="zaklyuchenie">  Conclusi√≥n </h2><br><p>  Concluyendo la revisi√≥n t√©cnica, quiero se√±alar que hay otras innovaciones importantes, especialmente en el campo de las licencias: </p><br><ul><li>  El l√≠mite de 10 entidades para Studio ahora se elimina </li><li>  Los complementos para Informes, BPM, Gr√°ficos y Mapas, y la b√∫squeda de texto completo ahora son gratuitos y de c√≥digo abierto. </li><li>  La versi√≥n comercial de Studio se suma al desarrollo de conveniencia con la ayuda de dise√±adores visuales de entidades, pantallas, men√∫s y otros elementos de la plataforma, y ‚Äã‚Äãla versi√≥n gratuita se enfoca en trabajar con c√≥digo. </li><li>  ¬°Tenga en cuenta que para las versiones 6.xy versiones anteriores, las condiciones de licencia para Platform y Studio siguen siendo las mismas! </li></ul><br><p>  Finalmente, perm√≠tanme agradecer una vez m√°s a la comunidad por su apoyo y comentarios.  ¬°Espero que te guste la versi√≥n 7!  La informaci√≥n completa est√° tradicionalmente disponible en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">registro de cambios</a> oficial. <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/447538/">https://habr.com/ru/post/447538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447528/index.html">¬øQui√©n es responsable de la calidad?</a></li>
<li><a href="../447530/index.html">OceanLotus: actualizaci√≥n de Malvari para macOS</a></li>
<li><a href="../447532/index.html">Splunk Universal Forwarder en el Docker como recopilador de registros del sistema</a></li>
<li><a href="../447534/index.html">El cosmonauta Aleksandr Laveykin sobre la mejor pel√≠cula espacial, fuerza G de 20 g y aterrizaje suave</a></li>
<li><a href="../447536/index.html">Implementar IdM. Preparaci√≥n para la implementaci√≥n por parte del cliente.</a></li>
<li><a href="../447540/index.html">Taller Beta de RHEL 8: Creaci√≥n de aplicaciones web en vivo</a></li>
<li><a href="../447542/index.html">Estimaci√≥n de VaR y ConVaR para el precio de las acciones de la empresa kazaja</a></li>
<li><a href="../447546/index.html">Bowers y Wilkins PX. Revisi√≥n tard√≠a de Neo</a></li>
<li><a href="../447548/index.html">¬øCu√°n justificada est√° la introducci√≥n de VDI en las peque√±as y medianas empresas?</a></li>
<li><a href="../447552/index.html">C√≥mo optimizar las secciones del cat√°logo en una tienda en l√≠nea: instrucciones paso a paso</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>