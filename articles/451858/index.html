<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§µüèø üèÇüèø üë®üèª‚Äçüî¨ Hacer un disyuntor basado en cach√© simple en primavera üìõ ü§∞üèΩ üëçüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo es para aquellos que usan un cach√© efectivo en su aplicaci√≥n y desean agregar estabilidad no solo a la aplicaci√≥n, sino a todo el entorn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hacer un disyuntor basado en cach√© simple en primavera</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451858/">  Este art√≠culo es para aquellos que usan un cach√© efectivo en su aplicaci√≥n y desean agregar estabilidad no solo a la aplicaci√≥n, sino a todo el entorno simplemente agregando 1 clase al proyecto. <br><br>  Si te reconoces, sigue leyendo. <br><br><h2>  ¬øQu√© es un disyuntor? </h2><br><img src="https://habrastorage.org/webt/w-/bn/xj/w-bnxjrhl9n7nnjby9grw571koa.png" alt="Fotograma de la pel√≠cula Regreso al futuro"><br><a name="habracut"></a><br>  El tema est√° trillado como el mundo y no te aburrir√©, aumentando la entrop√≠a y repitiendo lo mismo.  Desde mi punto de vista, Martin Fowler habl√≥ lo mejor de todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , pero tratar√© de ajustar la definici√≥n en una oraci√≥n: <br>  <i>funcionalidad que evita las solicitudes condenados a un servicio no disponible, lo que le permite "ponerse de rodillas" y continuar la operaci√≥n normal</i> . <br><br>  Idealmente, para evitar solicitudes condenadas, el disyuntor (en adelante CB) no debe interrumpir su aplicaci√≥n.  En cambio, es una buena pr√°ctica devolver, si no los datos m√°s actuales, pero a√∫n son relevantes ("no incorrectos") o, si esto no es posible, alg√∫n valor predeterminado. <br><br><h2>  Objetivos </h2><br>  Destacamos lo principal: <br><br><ol><li>  Es necesario permitir que la fuente de datos se recupere, deteniendo las consultas por un tiempo </li><li>  En caso de detener las solicitudes al servicio de destino, debe proporcionar, si no la √∫ltima, pero a√∫n datos relevantes </li><li>  Si el servicio de destino no est√° disponible y no hay datos relevantes, proporcione una estrategia de comportamiento (devolver el valor predeterminado u otra estrategia adecuada para un caso particular) </li></ol><br><h2>  Mecanismo de implementaci√≥n </h2><br><h3>  Caso: el servicio est√° disponible (primera solicitud) </h3><br><ol><li>  Vamos al cach√©.  Por clave (CRT ver abajo).  Vemos que no hay nada en el cach√© </li><li>  Vamos al servicio objetivo.  Obtenemos el valor </li><li>  Almacenamos el valor en la memoria cach√©, lo configuramos en un TTL que cubra el tiempo m√°ximo posible de que el servicio objetivo no est√© disponible, pero al mismo tiempo no debe exceder el per√≠odo de relevancia de los datos que est√° listo para proporcionar al cliente en caso de p√©rdida de conexi√≥n con el servicio objetivo. </li><li>  El tiempo de actualizaci√≥n de la memoria cach√© (CRT) se almacena en la memoria cach√© para el valor de la cl√°usula 3, el tiempo despu√©s del cual debe intentar ir al servicio de destino y actualizar el valor </li><li>  Devuelva el valor del elemento 2 al usuario </li></ol><br><h3>  Caso: CRT no expir√≥ </h3><br><ol><li>  Vamos al cach√©.  Por la clave encontramos CRT.  Vemos que es relevante </li><li>  Obtenga el valor del cach√©. </li><li>  Devuelve el valor al usuario. </li></ol><br><h3>  Caso: CRT expir√≥, el servicio objetivo est√° disponible </h3><br><ol><li>  Vamos al cach√©.  Por la clave encontramos CRT.  Vemos que es irrelevante </li><li>  Vamos al servicio objetivo.  Obtenemos el valor </li><li>  Actualizaci√≥n del valor en el cach√© y su TTL </li><li>  Actualice CRT para ello agregando el per√≠odo de actualizaci√≥n de cach√© (CRP): este es el valor que debe agregarse a CRT para obtener el siguiente CRT </li><li>  Devuelve el valor al usuario. </li></ol><br><h3>  Caso: CRT caducado, servicio de destino no disponible </h3><br><ol><li>  Vamos al cach√©.  Por la clave encontramos CRT.  Vemos que es irrelevante </li><li>  Vamos al servicio objetivo.  No esta disponible </li><li>  Obtenga el valor del cach√©.  No es el m√°s fresco (con un CRT podrido), pero sigue siendo relevante, ya que su TTL a√∫n no ha expirado </li><li>  Se lo devolvemos al usuario </li></ol><br><h3>  Caso: CRT caducado, servicio de destino no disponible, nada en cach√© </h3><br><ol><li>  Vamos al cach√©.  Por la clave encontramos CRT.  Vemos que es irrelevante </li><li>  Vamos al servicio objetivo.  No esta disponible </li><li>  Obtenga el valor del cach√©.  El no es </li><li>  Estamos tratando de aplicar una estrategia especial para tales casos.  Por ejemplo, devolver un valor predeterminado para un campo espec√≠fico o un valor especial del tipo "Esta informaci√≥n no est√° disponible actualmente".  En general, si esto es posible, es mejor devolver algo y no romper la aplicaci√≥n.  Si esto no es posible, entonces debe aplicar la estrategia de lanzamiento de excepci√≥n y una respuesta r√°pida al usuario de excepci√≥n. </li></ol><br><h2>  Lo que usaremos </h2><br>  Utilizo Spring Boot 1.5 en mi proyecto, todav√≠a no he encontrado el tiempo para actualizar a la segunda versi√≥n. <br><br>  Que el art√≠culo no result√≥ 2 veces m√°s largo, usar√© Lombok. <br><br>  Como almacenamiento de valor clave (en lo sucesivo, simplemente denominado KV), uso Redis 5.0.3, pero estoy seguro de que Hazelcast o un an√°logo funcionar√°.  Lo principal es que hay una implementaci√≥n de la interfaz CacheManager.  En mi caso, este es RedisCacheManager de spring-boot-starter-data-redis. <br><br><h2>  Implementaci√≥n </h2><br>  Arriba, en la secci√≥n ‚ÄúMecanismo de implementaci√≥n‚Äù, se hicieron dos definiciones importantes: CRT y CRP.  Los volver√© a escribir con m√°s detalle, porque  son muy importantes para entender el siguiente c√≥digo: <br><br>  El tiempo de actualizaci√≥n de cach√© ( <b>CRT</b> ) es una entrada separada en KV (clave + postfix "_crt"), que muestra el momento en que es hora de ir al servicio de destino para obtener datos nuevos.  A diferencia de TTL, el inicio de CRT no significa que sus datos est√©n "podridos", sino que es probable que se vuelvan m√°s recientes en el servicio de destino.  Se puso fresco, bueno, si no, y la corriente bajar√°. <br><br>  El per√≠odo de actualizaci√≥n de cach√© ( <b>CRP</b> ) es un valor que se agrega a la CRT despu√©s de sondear el servicio de destino (no importa si es exitoso o no).  Gracias a ella, un servicio remoto tiene la capacidad de "recuperar el aliento" y restaurar su trabajo en caso de una ca√≠da. <br><br>  Entonces, tradicionalmente, comenzamos dise√±ando la interfaz principal.  Es a trav√©s de √©l que necesitar√° trabajar con el cach√© si necesita l√≥gica CB.  Deber√≠a ser lo m√°s simple posible: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CircuitBreakerService</span></span></span><span class="hljs-class"> </span></span>{ &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStableValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EvictValueParameter parameter)</span></span></span></span>; }</code> </pre> <br>  Par√°metros de interfaz <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StableValueParameter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String cachePrefix; <span class="hljs-comment"><span class="hljs-comment">//    private String objectCacheKey; private long crpInSeconds; // Cache Refresh Period private Supplier&lt;T&gt; targetServiceAction; //      private DisasterStrategy disasterStrategy; //   : CRT ,   ,     public StableValueParameter( String cachePrefix, String objectCacheKey, long crpInSeconds, Supplier&lt;T&gt; targetServiceAction ) { this.cachePrefix = cachePrefix; this.objectCacheKey = objectCacheKey; this.crpInSeconds = crpInSeconds; this.targetServiceAction = targetServiceAction; this.disasterStrategy = new ThrowExceptionDisasterStrategy(); } }</span></span></code> </pre><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EvictValueParameter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String cachePrefix; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String objectCacheKey; }</code> </pre><br>  As√≠ es como lo usaremos: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AccountDataResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAccount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String accountId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> StableValueParameter&lt;?&gt; parameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StableValueParameter&lt;&gt;( ACCOUNT_CACHE_PREFIX, accountId, properties.getCrpInSeconds(), () -&gt; bankClient.findById(accountId) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> circuitBreakerService.getStableValue(parameter); }</code> </pre><br>  Si necesita borrar el cach√©, entonces: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictAccount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String accountId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> EvictValueParameter parameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EvictValueParameter( ACCOUNT_CACHE_PREFIX, accountId ); circuitBreakerService.evictValue(parameter); }</code> </pre><br>  Ahora lo m√°s interesante es la implementaci√≥n (explicada en los comentarios en el c√≥digo): <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStableValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Cache cache = cacheManager.getCache(parameter.getCachePrefix()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cache == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> logAndThrowUnexpectedCacheMissing(parameter.getCachePrefix(), parameter.getObjectCacheKey()); } <span class="hljs-comment"><span class="hljs-comment">//   .   CRT final String crtKey = parameter.getObjectCacheKey() + CRT_CACHE_POSTFIX; //  CRT  ,    final LocalDateTime crt = Optional.ofNullable(cache.get(crtKey, LocalDateTime.class)) .orElseGet(() -&gt; DateTimeUtils.now().minusSeconds(1)); if (DateTimeUtils.now().isBefore(crt)) { //  CRT   ,     final Optional&lt;T&gt; valueFromCache = getFromCache(parameter, cache); if (valueFromCache.isPresent()) { return valueFromCache.get(); } } //  CRT  ,        return getFromTargetServiceAndUpdateCache(parameter, cache, crtKey, crt); } private static &lt;T&gt; Optional&lt;T&gt; getFromCache(StableValueParameter parameter, Cache cache) { return (Optional&lt;T&gt;) Optional.ofNullable(cache.get(parameter.getObjectCacheKey())) .map(Cache.ValueWrapper::get); }</span></span></code> </pre><br>  Si el servicio de destino no est√° disponible, intente obtener los datos a√∫n relevantes del cach√©: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromTargetServiceAndUpdateCache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( StableValueParameter parameter, Cache cache, String crtKey, LocalDateTime crt )</span></span></span><span class="hljs-function"> </span></span>{ T result; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = getFromTargetService(parameter); } <span class="hljs-comment"><span class="hljs-comment">/* Circuit breaker exceptions */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (WebServiceIOException ex) { log.warn( <span class="hljs-string"><span class="hljs-string">"[CircuitBreaker] Service responded with error: {}. Try get from cache {}: {}"</span></span>, ex.getMessage(), parameter.getCachePrefix(), parameter.getObjectCacheKey()); result = getFromCacheOrDisasterStrategy(parameter, cache); } cache.put(parameter.getObjectCacheKey(), result); cache.put(crtKey, crt.plusSeconds(parameter.getCrpInSeconds())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromTargetService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) parameter.getTargetServiceAction().get(); }</code> </pre><br>  Si no hab√≠a datos reales en el cach√© (fueron eliminados por TTL, y el servicio de destino todav√≠a no est√° disponible), entonces usamos DisasterStrategy: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromCacheOrDisasterStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter, Cache cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) getFromCache(parameter, cache).orElseGet(() -&gt; parameter.getDisasterStrategy().getValue()); }</code> </pre><br>  Eliminar del cach√© no es nada interesante, lo dar√© aqu√≠ solo para completar: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromCacheOrDisasterStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter, Cache cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) getFromCache(parameter, cache).orElseGet(() -&gt; parameter.getDisasterStrategy().getValue()); }</code> </pre><br>  Eliminar del cach√© no es nada interesante, lo dar√© aqu√≠ solo para completar: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EvictValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Cache cache = cacheManager.getCache(parameter.getCachePrefix()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cache == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { logAndThrowUnexpectedCacheMissing(parameter.getCachePrefix(), parameter.getObjectCacheKey()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String crtKey = parameter.getObjectCacheKey() + CRT_CACHE_POSTFIX; cache.evict(crtKey); }</code> </pre><br><h2>  Estrategia de desastre </h2><br><img src="https://habrastorage.org/webt/ka/fw/_0/kafw_0jvueyuguwcdbjz4eksnz8.png" alt="Fotograma de la pel√≠cula Regreso al futuro"><br><br>  De hecho, esta es la l√≥gica que ocurre si el CRT caduca, el servicio de destino no est√° disponible y no hay nada en la memoria cach√©. <br><br>  Quer√≠a describir esta l√≥gica por separado, porque  muchos no tienen en sus manos pensar en c√≥mo implementarlo.  Pero esto, de hecho, es lo que hace que nuestro sistema sea realmente estable. <br><br>  ¬øNo quieres sentir esa sensaci√≥n de orgullo en tu creaci√≥n cuando todo lo que solo puede fallar es rechazado y tu sistema a√∫n funciona?  Incluso a pesar del hecho de que, por ejemplo, no se mostrar√° el precio real de los productos en el campo "precio", sino la inscripci√≥n: "se est√° especificando ahora", pero ¬øcu√°nto mejor es esto que la respuesta "El servicio 500 no est√° disponible".  Despu√©s de todo, por ejemplo, los 10 campos restantes: descripci√≥n del producto, etc.  Regresaste.  ¬øCu√°nto cambia la calidad de un servicio de este tipo? .. Mi llamado es prestar m√°s atenci√≥n a los detalles para mejorarlos. <br><br>  Terminando la digresi√≥n l√≠rica.  Entonces, la interfaz de la estrategia ser√° la siguiente: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  Debe elegir la implementaci√≥n seg√∫n el caso espec√≠fico.  Por ejemplo, si puede devolver alg√∫n valor predeterminado, puede hacer algo como esto: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultValueDisasterStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"   "</span></span>; } }</code> </pre><br>  O, si en un caso particular no tiene que devolver nada, puede lanzar una excepci√≥n: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThrowExceptionDisasterStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Object</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CircuitBreakerNullValueException(<span class="hljs-string"><span class="hljs-string">"Ops! Service is down and there's null value in cache"</span></span>); } }</code> </pre><br>  En este caso, el CRT no se incrementar√° y la pr√≥xima solicitud seguir√° nuevamente al servicio de destino. <br><br><h2>  Conclusi√≥n </h2><br>  Me adhiero al siguiente punto de vista: si tiene la oportunidad de usar una soluci√≥n preparada y no hacer un esc√°ndalo, de hecho, aunque simple, pero a√∫n en bicicleta en este art√≠culo, h√°galo.  Use este art√≠culo para comprender c√≥mo funciona, y no como una gu√≠a de acci√≥n. <br><br>  Hay tantas soluciones listas para usar, especialmente si est√° utilizando Spring Boot 2, como Hystrix. <br><br>  Lo m√°s importante a entender es que esta soluci√≥n se basa en la memoria cach√© y su eficacia es igual a la efectividad de la memoria cach√©.  Si el cach√© es ineficaz (pocos golpes, muchos fallos), entonces este disyuntor ser√° igualmente ineficaz: cada fallo de cach√© ir√° acompa√±ado de un viaje al servicio de destino, que, quiz√°s en este momento est√° en agon√≠a y agon√≠a, tratando de elevarse. <br><br>  Aseg√∫rese de medir la efectividad de su cach√© antes de aplicar este enfoque.  Esto se puede hacer mediante ‚ÄúCache Hit Rate‚Äù = hits / (hits + miss), debe tender a 1, no a 0. <br><br>  Y s√≠, nadie lo molesta para mantener varias variedades de CB en su proyecto a la vez, utilizando el que mejor resuelva el problema espec√≠fico. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/451858/">https://habr.com/ru/post/451858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451842/index.html">Sobre encontrarte a ti mismo</a></li>
<li><a href="../451848/index.html">Automatizando Let's Encrypt SSL Certificate Management usando DNS-01 challenge y AWS</a></li>
<li><a href="../451852/index.html">Ejecuci√≥n remota de c√≥digo arbitrario en RDP</a></li>
<li><a href="../451854/index.html">Entrevista: 10 preguntas sobre Swift. Parte 1</a></li>
<li><a href="../451856/index.html">Instale openmeetings 5.0.0-M1. Conferencias WEB sin Flash</a></li>
<li><a href="../451860/index.html">Los matem√°ticos han descubierto la forma perfecta de multiplicar n√∫meros.</a></li>
<li><a href="../451862/index.html">Rayo musical de Joe Diprim: un ingeniero autodidacta hace bobinas de Tesla para entretenimiento y ganancias</a></li>
<li><a href="../451864/index.html">Vulnerabilidad cr√≠tica de RCE del nivel EternalBlue detectado en el sistema operativo Windows</a></li>
<li><a href="../451866/index.html">Elija los nodos m√°s cercanos en la red</a></li>
<li><a href="../451870/index.html">Funciones modernas de C ++ que todos los programadores deben conocer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>