<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçüé® ‚è© üîä Pr√©sentation des interfaces virtuelles Linux: tunnels üßõüèæ ‚ò†Ô∏è üíÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Linux prend en charge de nombreux types de tunnels. Cela confond les d√©butants qui ont du mal √† comprendre les diff√©rences technologiques et √† compren...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pr√©sentation des interfaces virtuelles Linux: tunnels</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/457386/"> Linux prend en charge de nombreux types de tunnels.  Cela confond les d√©butants qui ont du mal √† comprendre les diff√©rences technologiques et √† comprendre quel tunnel est pr√©f√©rable d'utiliser dans une situation particuli√®re.  Le mat√©riel, dont nous publions la traduction aujourd'hui, donnera un bref aper√ßu des interfaces de tunnel couramment utilis√©es du noyau Linux.  Nous ne nous pencherons pas en profondeur sur ce sujet, en consid√©rant uniquement les caract√©ristiques g√©n√©rales des tunnels et les options pour leur utilisation sous Linux. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/-0/wg/hq/-0wghqvj6hymntfthlttl1xu6tm.jpeg"></a> <br><br>  L'auteur de ce document estime que ce qui sera discut√© ici peut int√©resser tous ceux qui ont quelque chose √† voir avec la gestion des r√©seaux informatiques.  La liste des interfaces de tunnel, ainsi que des informations de r√©f√©rence sur une configuration sp√©cifique, peuvent √™tre obtenues √† l' <code>ip link help</code> commande d' <code>ip link help</code> iproute2 <code>ip link help</code> . <br><br>  Les interfaces couramment utilis√©es suivantes seront couvertes ici: IPIP, SIT, ip6tnl, VTI et VTI6, GRE et GRETAP, GRE6 et GRE6TAP, FOU, GUE, GENEVE, ERSPAN et IP6ERSPAN. <br><br>  Apr√®s avoir lu cet article, vous d√©couvrirez les fonctionnalit√©s de ces interfaces et d√©couvrirez les diff√©rences entre elles.  Vous apprendrez comment les cr√©er et d√©couvrirez les situations dans lesquelles ils sont le mieux utilis√©s. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">IPIP</font> </h2><br>  Le tunnel IPIP, comme son nom l'indique, est un tunnel fonctionnant en mode IP sur IP ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC 2003</a> ).  L'en-t√™te de paquet de tunnel IPIP est comme indiqu√© ci-dessous. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/369/49b/92c/36949b92c3d045185f09095a7a23dbfd.png"></div><br>  <i><font color="#999999">En-t√™te de paquet de tunnel IPIP</font></i> <br><br>  Ces tunnels sont couramment utilis√©s pour connecter deux sous-r√©seaux IPv4 internes sur un r√©seau IPv4 public (Internet).  L'utilisation d'IPIP cr√©e une charge suppl√©mentaire minimale sur le syst√®me, mais seule la transmission de donn√©es unidirectionnelle (unicast) peut √™tre effectu√©e sur un tel tunnel.  Autrement dit, apr√®s avoir construit un tel tunnel, il ne sera pas possible de l'utiliser pour la transmission de donn√©es de multidiffusion. <br><br>  Les tunnels IPIP prennent en charge les modes IP sur IP et MPLS sur IP. <br><br>  Veuillez noter que lorsque le module ipip est charg√©, ou lorsque le p√©riph√©rique IPIP est cr√©√© pour la premi√®re fois, le noyau Linux cr√©era un p√©riph√©rique <code>tunl0</code> par d√©faut dans chaque espace de noms avec les attributs <code>local=any</code> et <code>remote=any</code> .  Lors de la r√©ception de paquets IPIP, le noyau, dans certains cas, les redirigera vers <code>tunl0</code> comme p√©riph√©rique par d√©faut.  Cela se produit lorsque le noyau ne peut pas trouver un autre p√©riph√©rique dont <code>local/remote</code> attributs <code>local/remote</code> plus √©troitement aux adresses source et de destination des paquets. <br><br>  Voici comment cr√©er un tunnel IPIP: <br><br>  Sur le serveur A: <br><br><pre> <code class="plaintext hljs"># ip link add name ipip0 type ipip local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR # ip link set ipip0 up # ip addr add INTERNAL_IPV4_ADDR/24 dev ipip0 Add a remote internal subnet route if the endpoints don't belong to the same subnet # ip route add REMOTE_INTERNAL_SUBNET/24 dev ipip0</code> </pre> <br>  Sur le serveur B: <br><br><pre> <code class="plaintext hljs"># ip link add name ipip0 type ipip local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR # ip link set ipip0 up # ip addr add INTERNAL_IPV4_ADDR/24 dev ipip0 # ip route add REMOTE_INTERNAL_SUBNET/24 dev ipip0</code> </pre> <br>  Veuillez noter que lorsque vous utilisez cette configuration, elle doit √™tre align√©e sur des donn√©es r√©elles.  En particulier, <code>LOCAL_IPv4_ADDR</code> , <code>REMOTE_IPv4_ADDR</code> , <code>INTERNAL_IPV4_ADDR</code> et <code>REMOTE_INTERNAL_SUBNET</code> doivent √™tre remplac√©s par les adresses utilis√©es dans votre environnement.  Il en va de m√™me pour d'autres exemples de configurations, que nous consid√©rerons plus loin. <br><br><h2>  <font color="#3AC1EF">S'asseoir</font> </h2><br>  SIT (Simple Internet Transition) est une technologie de tunneling dont le but principal est de connecter des r√©seaux IPv6 isol√©s via Internet en utilisant le protocole IPv4. <br><br>  Initialement, la technologie SIT ne pouvait fonctionner qu'en mode de tunneling ¬´IPv6 sur IPv4¬ª.  Cependant, au fil des ann√©es de d√©veloppement, il a gagn√© le soutien de plusieurs autres r√©gimes.  En particulier, c'est <code>ipip</code> (la m√™me chose s'est produite avec le tunnel IPIP), <code>ip6ip</code> , <code>mplsip</code> et <code>any</code> . <br><br>  <code>any</code> mode est utilis√© pour fonctionner avec le trafic IP et IPv6, ce qui peut √™tre utile dans certaines situations.  Les tunnels SIT prennent √©galement en charge <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ISATAP</a> .  Voici <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un exemple d'</a> utilisation de cette technologie. <br><br>  L'en-t√™te du paquet SIT est comme indiqu√© ci-dessous. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/193/172/49e/19317249ec76200873dabf9aac6bc755.png"></div><br>  <i><font color="#999999">En-t√™te de paquet de tunnel SIT</font></i> <br><br>  Lorsque le module <code>sit</code> charge, le noyau Linux cr√©e le <code>sit0</code> par d√©faut <code>sit0</code> . <br><br>  Voici comment cr√©er un tunnel SIT (ces √©tapes doivent √™tre effectu√©es sur les serveurs A et B): <br><br><pre> <code class="plaintext hljs"># ip link add name sit1 type sit local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR mode any # ip link set sit1 up # ip addr add INTERNAL_IPV4_ADDR/24 dev sit1</code> </pre> <br><h2>  <font color="#3AC1EF">Ip6tnl</font> </h2><br>  L'interface ip6tnl fonctionne en mode IPv4 / IPv6 sur IPv6.  Elle est similaire √† la version IPv6 du tunnel SIT.  Voici √† quoi ressemble l'en-t√™te du package ip6tnl. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e7/b3b/1b6/9e7b3b1b6862d0f3100c9c64db2171b7.png"></div><br>  <i><font color="#999999">En-t√™te de paquet de tunnel IP6TNL</font></i> <br><br>  Les tunnels IP6tnl prennent en charge <code>ip6ip6</code> , <code>ipip6</code> et <code>any</code> modes.  Le mode <code>ipip6</code> repr√©sent√© par le sch√©ma IPv4 sur IPv6, le mode <code>ip6ip6</code> est IPv6 sur IPv6.  <code>any</code> mode prend en charge les deux sch√©mas. <br><br>  Lorsque le module <code>ip6tnl</code> , le noyau Linux cr√©e un p√©riph√©rique par d√©faut appel√© <code>ip6tnl0</code> . <br><br>  Voici comment cr√©er un tunnel ip6tnl: <br><br><pre> <code class="plaintext hljs"># ip link add name ipip6 type ip6tnl local LOCAL_IPv6_ADDR remote REMOTE_IPv6_ADDR mode any</code> </pre> <br><h2>  <font color="#3AC1EF">VTI et VTI6</font> </h2><br>  L'interface Linux VTI (Virtual Tunnel Interface) est similaire √† l'interface Cisco VTI et √† l'impl√©mentation Juniper d'un tunnel s√©curis√© (st.xx). <br><br>  Ce pilote de tunneling impl√©mente l'encapsulation IP, qui peut √™tre utilis√©e avec xfrm pour cr√©er des tunnels s√©curis√©s, puis utiliser des tunnels de routage au niveau du noyau sur ces tunnels. <br><br>  En g√©n√©ral, les tunnels VTI fonctionnent un peu comme les tunnels IPIP ou SIT.  L'exception est qu'ils utilisent l'encapsulation / d√©capsulation fwmark et IPsec. <br><br>  VTI6 est l'√©quivalent IPv6 de VTI. <br><br>  Voici comment cr√©er un tunnel VTI: <br><br><pre> <code class="plaintext hljs"># ip link add name vti1 type vti key VTI_KEY local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR # ip link set vti1 up # ip addr add LOCAL_VIRTUAL_ADDR/24 dev vti1 # ip xfrm state add src LOCAL_IPv4_ADDR dst REMOTE_IPv4_ADDR spi SPI PROTO ALGR mode tunnel # ip xfrm state add src REMOTE_IPv4_ADDR dst LOCAL_IPv4_ADDR spi SPI PROTO ALGR mode tunnel # ip xfrm policy add dir in tmpl src REMOTE_IPv4_ADDR dst LOCAL_IPv4_ADDR PROTO mode tunnel mark VTI_KEY # ip xfrm policy add dir out tmpl src LOCAL_IPv4_ADDR dst REMOTE_IPv4_ADDR PROTO mode tunnel mark VTI_KEY</code> </pre> <br>  De plus, IPsec peut √™tre configur√© √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libreswan</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">strongSwan</a> . <br><br><h2>  <font color="#3AC1EF">GRE et GRETAP</font> </h2><br>  La technologie GRE (Generic Routing Encapsulation) est d√©crite dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC 2784</a> .  Dans le tunneling GRE, un en-t√™te GRE suppl√©mentaire est ajout√© entre les en-t√™tes des paquets IP internes et externes. <br><br>  Th√©oriquement, GRE peut encapsuler des paquets de n'importe quel protocole de couche 3 avec un type Ethernet valide.  Cela distingue la technologie GRE de la technologie IPIP, qui ne prend en charge que l'encapsulation des paquets IP.  Voici √† quoi ressemble l'en-t√™te du package lors de l'utilisation de la technologie GRE. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/22d/b74/b09/22db74b090586084bfe845c7df963139.png"></div><br>  <i><font color="#999999">En-t√™te de paquet tunnel GRE</font></i> <br><br>  Veuillez noter que les tunnels GRE permettent la prise en charge de la multidiffusion et IPv6. <br><br>  Lors du chargement du module <code>gre</code> , le noyau Linux cr√©e le <code>gre0</code> par d√©faut <code>gre0</code> . <br><br>  Voici comment cr√©er un tunnel GRE: <br><br><pre> <code class="plaintext hljs"># ip link add name gre1 type gre local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR [seq] key KEY</code> </pre> <br>  Alors que les tunnels GRE fonctionnent sur la couche 3 OSI, les tunnels GRETAP fonctionnent sur la couche 2 OSI.  Cela signifie que l'un des en-t√™tes internes des paquets respectifs est un en-t√™te Ethernet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1da/ec8/099/1daec8099c6cede117df740da4791144.png"></div><br>  <i><font color="#999999">En-t√™te de paquet de tunnel GRETAP</font></i> <br><br>  Voici comment cr√©er un tunnel GRETAP: <br><br><pre> <code class="plaintext hljs"># ip link add name gretap1 type gretap local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR</code> </pre> <br><h2>  <font color="#3AC1EF">GRE6 et GRE6TAP</font> </h2><br>  GRE6 est l'√©quivalent IPv6 de GRE.  Les tunnels GRE6 vous permettent d'encapsuler n'importe quel protocole de couche 3 dans IPv6.  Voici √† quoi ressemble l'en-t√™te du package GRE6. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d8c/69e/45a/d8c69e45aab1f77ea5948cf2a6e81c35.png"></div><br>  <i><font color="#999999">En-t√™te de paquet de tunnel GRE6</font></i> <br><br>  Dans les tunnels GRE6TAP, comme dans les tunnels GRETAP, il existe des en-t√™tes Ethernet parmi les en-t√™tes de paquets internes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72c/290/7c7/72c2907c7c649e6390d1e51156bcac57.png"></div><br>  <i><font color="#999999">En-t√™te de paquet de tunnel GRE6TAP</font></i> <br><br>  Voici comment cr√©er un tunnel GRE: <br><br><pre> <code class="plaintext hljs"># ip link add name gre1 type gre6 local LOCAL_IPv6_ADDR remote REMOTE_IPv6_ADDR # ip link add name gretap1 type gretap6 local LOCAL_IPv6_ADDR remote REMOTE_IPv6_ADDR</code> </pre> <br><h2>  <font color="#3AC1EF">Fou</font> </h2><br>  Le tunneling peut √™tre effectu√© √† diff√©rents niveaux de la pile r√©seau.  Les tunnels IPIP, SIT et GRE existent au niveau de la couche IP.  Et les tunnels FOU (ils sont dispos√©s selon le sch√©ma ¬´foo over UDP¬ª) fonctionnent au niveau UDP. <br><br>  Il existe certains avantages √† utiliser le tunneling UDP sur le tunnelage IP.  Le fait est que le protocole UDP fonctionne avec l'infrastructure mat√©rielle existante. <br><br>  Par exemple, c'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RSS</a> dans les cartes r√©seau, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ECMP</a> dans les commutateurs, ce sont des technologies pour calculer les sommes de contr√¥le sans la participation d'un processeur central.  L'application du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">correctif</a> FOU appropri√© aux d√©veloppeurs montre une augmentation significative des performances pour SIT et IPIP. <br><br>  Actuellement, les tunnels FOU prennent en charge l'encapsulation de protocole bas√©e sur IPIP, SIT et GRE.  Voici √† quoi pourrait ressembler l'en-t√™te d'un package FOU. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90d/a66/cb9/90da66cb92c6e3083f29ed97b952e0b6.png"></div><br>  <i><font color="#999999">En-t√™te de l'ensemble de tunnels FOU</font></i> <br><br>  Voici comment cr√©er un tunnel FOU: <br><br><pre> <code class="plaintext hljs"># ip fou add port 5555 ipproto 4 # ip link add name tun1 type ipip remote 192.168.1.1 local 192.168.1.2 ttl 225 encap fou encap-sport auto encap-dport 5555</code> </pre> <br>  La premi√®re commande configure le port de r√©ception FOU pour IPIP li√© √† 5555. Pour utiliser GRE, vous devez utiliser <code>ipproto 47</code> .  La deuxi√®me commande configure la nouvelle interface IPIP virtuelle ( <code>tun1</code> ), con√ßue pour l'encapsulation FOU, dont le port cible est 5555. <br><br>  Veuillez noter que les tunnels FOU ne sont pas pris en charge sur Red Hat Enterprise Linux. <br><br><h2>  <font color="#3AC1EF">Gue</font> </h2><br>  Un autre type de tunneling UDP est introduit par la technologie GUE ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Generic UDP Encapsulation</a> ).  La diff√©rence entre FOU et GUE est que GUE a son propre en-t√™te, qui contient des informations de protocole et d'autres donn√©es. <br><br>  Les tunnels GUE prennent actuellement en charge l'encapsulation interne d'IPIP, SIT et GRE.  Voici √† quoi pourrait ressembler un en-t√™te de package GUE. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/412/d7f/d38/412d7fd38350aa55b24cb0b93865d93c.png"></div><br>  <i><font color="#999999">En-t√™te de package de tunnel GUE</font></i> <br><br>  Voici comment cr√©er un tunnel GUE: <br><br><pre> <code class="plaintext hljs"># ip fou add port 5555 gue # ip link add name tun1 type ipip remote 192.168.1.1 local 192.168.1.2 ttl 225 encap gue encap-sport auto encap-dport 5555</code> </pre> <br>  Gr√¢ce √† ces commandes, un port GUE de r√©ception pour IPIP li√© au num√©ro 5555 et un tunnel IPIP configur√© pour l'encapsulation GUE seront cr√©√©s. <br><br>  Les tunnels GUE ne sont pas pris en charge sur Red Hat Enterprise Linux. <br><br><h2>  <font color="#3AC1EF">GENEVE</font> </h2><br>  Les tunnels GENEVE (Generic Network Virtualization Encapsulation) prennent en charge toutes les fonctionnalit√©s de XLAN, NVGRE et STT.  La technologie GENEVE est con√ßue pour contourner les limites identifi√©es de ces trois technologies.  Beaucoup pensent que cette technologie est capable, √† long terme, de remplacer compl√®tement ces trois anciens formats.  Voici √† quoi ressemble l'en-t√™te du paquet de tunnel GENEVE. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/767/f30/98e/767f3098ee539caf3f03778143fa6106.png"></div><br>  <i><font color="#999999">En-t√™te de paquet de tunnel GENEVE</font></i> <br><br>  Cet en-t√™te est similaire √† l'en-t√™te d'un paquet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VXLAN</a> .  La principale diff√©rence entre les deux est que l'en-t√™te GENEVE est plus flexible.  Il facilite l'impl√©mentation de nouvelles fonctionnalit√©s en d√©veloppant les en-t√™tes √† l'aide des champs TLV (Type-Length-Value). <br><br>  Des d√©tails sur GENEVE peuvent √™tre trouv√©s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  GENEVE est utilis√© dans la solution SDN <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Open Virtual Network</a> (OVN) comme outil d'encapsulation standard.  Voici comment cr√©er un tunnel GENEVE: <br><br><pre> <code class="plaintext hljs"># ip link add name geneve0 type geneve id VNI remote REMOTE_IPv4_ADDR</code> </pre> <br><h2>  <font color="#3AC1EF">ERSPAN et IP6ERSPAN</font> </h2><br>  La technologie ERSPAN (Encapsulated Remote Switched Port Analyzer) utilise l'encapsulation GRE pour √©tendre les capacit√©s de base de la mise en miroir des ports de la couche 2 √† la couche 3.  Cela vous permet de transf√©rer le trafic en miroir sur un r√©seau IP rout√©.  Voici √† quoi ressemble l'en-t√™te du package ERSPAN. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dee/15d/871/dee15d871a6ee9d433f154b9a6a6e048.png"></div><br>  <i><font color="#999999">En-t√™te de package de tunnel ERSPAN</font></i> <br><br>  Les tunnels ERSPAN permettent aux h√¥tes Linux d'agir en tant que source de trafic ERSPAN et d'envoyer du trafic ERSPAN en miroir soit vers un h√¥te distant, soit vers une destination ERSPAN qui re√ßoit et traite les paquets ERSPAN g√©n√©r√©s par les commutateurs Cisco ou d'autres p√©riph√©riques prenant en charge ERSPAN.  Un syst√®me similaire peut √™tre utilis√© pour analyser et diagnostiquer le r√©seau, pour d√©tecter le trafic malveillant. <br><br>  Linux prend actuellement en charge la plupart des fonctionnalit√©s des deux versions d'ERSPAN - v1 (type II) et v2 (type III). <br><br>  Voici comment cr√©er des tunnels ERSPAN: <br><br><pre> <code class="plaintext hljs"># ip link add dev erspan1 type erspan local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR seq key KEY erspan_ver 1 erspan IDX</code> </pre> <br>  Vous pouvez √©galement le faire: <br><br><pre> <code class="plaintext hljs"># ip link add dev erspan1 type erspan local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR seq key KEY erspan_ver 2 erspan_dir DIRECTION erspan_hwid HWID</code> </pre> <br>  Ajoutez un filtre tc pour surveiller le trafic: <br><br><pre> <code class="plaintext hljs"># tc qdisc add dev MONITOR_DEV handle ffff: ingress # tc filter add dev MONITOR_DEV parent ffff: matchall skip_hw action mirred egress mirror dev erspan1</code> </pre> <br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  Nous avons couvert pas mal de technologies de tunneling sous Linux ici.  Voici un tableau r√©capitulatif pour eux. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Type de tunnel / connexion <br></td><td>  En-t√™te externe <br></td><td>  En-t√™te encapsul√© <br></td><td>  En-t√™te int√©rieur <br></td></tr><tr><td>  ipip <br></td><td>  IPv4 <br></td><td>  Aucun <br></td><td>  IPv4 <br></td></tr><tr><td>  s'asseoir <br></td><td>  IPv4 <br></td><td>  Aucun <br></td><td>  IPv4 / IPv6 <br></td></tr><tr><td>  ip6tnl <br></td><td>  IPv4 <br></td><td>  Aucun <br></td><td>  IPv4 / IPv6 <br></td></tr><tr><td>  vti <br></td><td>  IPv4 <br></td><td>  IPsec <br></td><td>  IPv4 <br></td></tr><tr><td>  vti6 <br></td><td>  IPv6 <br></td><td>  IPsec <br></td><td>  IPv6 <br></td></tr><tr><td>  gre <br></td><td>  IPv4 <br></td><td>  GRE <br></td><td>  IPv4 / IPv6 <br></td></tr><tr><td>  gretap <br></td><td>  IPv4 <br></td><td>  GRE <br></td><td>  Ether + IPv4 / IPv6 <br></td></tr><tr><td>  gre6 <br></td><td>  IPv6 <br></td><td>  GRE <br></td><td>  IPv4 / IPv6 <br></td></tr><tr><td>  gre6tap <br></td><td>  IPv6 <br></td><td>  GRE <br></td><td>  Ether + IPv4 / IPv6 <br></td></tr><tr><td>  fou <br></td><td>  IPv4 / IPv6 <br></td><td>  UDP <br></td><td>  IPv4 / IPv6 / GRE <br></td></tr><tr><td>  gue <br></td><td>  IPv4 / IPv6 <br></td><td>  UDP + GUE <br></td><td>  IPv4 / IPv6 / GRE <br></td></tr><tr><td>  geneve <br></td><td>  IPv4 / IPv6 <br></td><td>  UDP + Geneve <br></td><td>  Ether + IPv4 / IPv6 <br></td></tr><tr><td>  erspan <br></td><td>  IPv4 <br></td><td>  GRE + ERSPAN <br></td><td>  IPv4 / IPv6 <br></td></tr><tr><td>  ip6erspan <br></td><td>  IPv6 <br></td><td>  GRE + ERSPAN <br></td><td>  IPv4 / IPv6 <br></td></tr></tbody></table></div><br>  Veuillez noter que tous les tunnels, dont les exemples de cr√©ation sont pr√©sent√©s ici, n'existent que jusqu'au red√©marrage du serveur.  Si vous souhaitez cr√©er un tunnel qui se r√©tablit apr√®s le red√©marrage, envisagez d'utiliser un d√©mon pour configurer le r√©seau, comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NetworkManager</a> , ou utilisez le m√©canisme appropri√© de la distribution Linux que vous utilisez. <br><br>  <b>Chers lecteurs!</b>  Quels tunnels Linux utilisez-vous? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr457386/">https://habr.com/ru/post/fr457386/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr457366/index.html">Un fanatique, un morceau de fer ou un spectateur - quel genre de joueur √™tes-vous?</a></li>
<li><a href="../fr457374/index.html">R√©duisez le temps de construction de vos projets Android</a></li>
<li><a href="../fr457378/index.html">Comment id Software a cr√©√© Wolfenstein 3D bas√© sur la technologie du commandant Keen</a></li>
<li><a href="../fr457380/index.html">OpenGL ultramoderne. 2e partie</a></li>
<li><a href="../fr457382/index.html">7 habitudes des programmeurs performants</a></li>
<li><a href="../fr457390/index.html">Madagascar - √Æle des contrastes</a></li>
<li><a href="../fr457392/index.html">√âconomies sur le d√©veloppement multiplateforme mobile: √©tude de cas Skyeng</a></li>
<li><a href="../fr457396/index.html">D√©verrouillage automatique du conteneur racine LUKS apr√®s un d√©marrage √† chaud</a></li>
<li><a href="../fr457398/index.html">Mais je fais des conneries? Pourquoi les d√©veloppeurs se tournent vers gemba</a></li>
<li><a href="../fr457400/index.html">Le nombre de victimes de catastrophes nucl√©aires comme Tchernobyl est consid√©rablement exag√©r√© pour le drame</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>