<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòé üé¥ üßÄ Wie man Omega 2 oder die Legende von I2S spricht üë®‚Äç‚öñÔ∏è ü§õüèª ‚ú≥Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Was ist die gro√üe Sache mit I2S, sagst du? Schlie√üen Sie die Verkabelung an die gew√ºnschten Stifte an und alles funktioniert. 

 Das dachte ich auch, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie man Omega 2 oder die Legende von I2S spricht</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413623/"> Was ist die gro√üe Sache mit I2S, sagst du?  Schlie√üen Sie die Verkabelung an die gew√ºnschten Stifte an und alles funktioniert. <br><br><img align="left" width="250" src="https://habrastorage.org/webt/io/ka/bd/iokabddcyoi7quzs2gfgy8imhgi.png" alt="Omega2-Minicomputer">  Das dachte ich auch, aber mit dem Omega2-Minicomputer stellte sich heraus, dass es nicht so einfach war.  Also habe ich beschlossen, diesen Artikel zu schreiben. <br><br>  Beginnen wir mit dem, was ich am Ende erreicht habe.  Ich habe den TDA1543-Chip (Stereo-I2S-DAC mit einer Aufl√∂sung von 16 Bit in der Amplitude) an den Omega-2-Mikrocomputer angeschlossen. Der Klang ist gut, ich h√∂re gerne Internetradiosender (es sollte einen Witz √ºber audiophilen und warmen R√∂hrensound geben).  Ich verstand den Grund f√ºr die √úberlastung des Audios jedoch immer noch nicht, sondern lernte nur, ihn mit der Kr√ºckenmethode zu umgehen.  Und ich w√ºrde sehr gerne Ihre Ideen zu diesem Thema h√∂ren. <br><a name="habracut"></a><br>  Vielleicht wei√ü jemand nicht, was Omega2 ist.  Dies ist der Minicomputer, auf dem Linux auf LEDE basiert, einem Zweig von OpenWRT.  MT7688-Prozessor, 64 MB RAM und 16 MB Flash.  Im Allgemeinen k√∂nnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> mehr auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wikipedia</a> lesen. <br><br>  <b>Es ist auch wichtig zu beachten, dass alle Aktionen mit der urspr√ºnglichen Firmware-Version 0.2.0 ausgef√ºhrt werden</b> <br><br>  Und jetzt lass uns ein wenig √ºber den <s>Schmerz</s> sprechen, als ich dazu kam. <br>  Zun√§chst ist alles transparent, wir verbinden alle Leitungen von I2S TDA'shki und Omega.  Dies sind die CLK-Taktleitung, die WS-Kanalsynchronisationsleitung, die DATA-Datenleitung bzw. die GND-Masse.  Au√üerdem f√ºgen wir einige Widerst√§nde und Kondensatoren hinzu, aber die Hauptsache ist der Abstimmwiderstand am 7. Zweig des TDA1543.  Auf dieses Bein muss ein Nullpunktversatz angewendet werden, auf dem ich zum ersten Mal eingeschlafen bin.  Tatsache ist, dass der f√ºr seine Zeit einzigartige TDA1543-Chip mit unipolarer Energie betrieben wird.  Nun, das Tonsignal besteht aus Schwingungen in Bezug auf 0 nach unten und oben. Sie m√ºssen diese Null also in die Mitte des Versorgungsspannungsbereichs verschieben und die Schwingungen relativ zu diesem Punkt ermitteln.  Alles ist im Datenblatt geschrieben, aber anfangs habe ich eine Schaltung mit einem herk√∂mmlichen Widerstand (aus diesen aus Ihrem Internet) zusammengebaut und Verzerrungen erhalten, die ich lange nicht verstanden habe.  Setzen Sie einen variablen Widerstand ein und erreichen Sie eine Nullvorspannung, wenn am Eingang kein Signal vorhanden ist (Standby-Modus). 1,3-1,5 V (mit 3,3 V-Stromversorgung).  Es stellt sich das folgende Schema heraus. <br><br><img src="https://habrastorage.org/webt/nv/wr/wd/nvwrwdpyw7fjsnbhslbvqw7nq5i.png" alt="Anschlussplan TDA1543 zu Omega2"><br><br>  Au√üerdem werden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wir</a> gem√§√ü den Schritten auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der offiziellen Zwiebel-Website</a> aktualisiert, um die Firmware-Version zu entwickeln, die Unterst√ºtzung f√ºr I2S hinzuf√ºgt (ich wollte weniger als ein Jahr schreiben, aber es ist kein ... vergangen).  Wir aktualisieren und installieren die notwendigen Pakete f√ºr Sound: <br><br><pre><code class="hljs sql">opkg <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> opkg <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> alsa-utils mpg123</code> </pre> <br>  Schalten Sie GPIO mit dem folgenden Befehl in den I2S-Modus: <br><br><pre> <code class="hljs swift">omega2-ctrl gpiomux <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> i2s i2s</code> </pre> <br>  Wir kopieren die Test-WAV-Datei, ich habe die klassische Suzanne Vega - Tom's Diner verwendet.  Und versuchen Sie, mit aplay zu spielen: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">aplay</span></span> za_sebya_i_za_sashky.wav</code> </pre> <br>  Und wir h√∂ren Verzerrungen.  Nur viel harte √úberlastung.  So sehr, dass es so aussieht, als w√§ren Sie 2007 zur√ºck. Aber das Schockmotiv des Songs l√§sst sich darin nachvollziehen, also funktioniert dort etwas, oder? <br><br>  Ich habe versucht, die Lautst√§rke im alsa-Mixer zu verringern - ohne Erfolg, da der Treiber durch den von I2C gesteuerten MAX98090-Chip gesch√§rft wird und dementsprechend alle Einstellungen einfach an I2C gesendet werden und sich die I2S-Daten selbst nicht √§ndern. <br><br>  Ok, √∂ffnen Sie das Datenblatt auf dem MAX98090.  Und wir fangen an zu leuchten.  Die Mikroschaltung unterst√ºtzt viele Eingabedatenformate: I2S / LJ / RJ / TDM und kann ein gro√ües Bit verarbeiten.  Der MT7688-Prozessor selbst kann auch gr√∂√üer und schneller als der TDDA sein.  Vielleicht Datenprobleme in I2S? <br><br>  Ich bastelte allm√§hlich am Oszilloskop. <br><br>  <i>Bit 16 Bit?</i>  Ja  Ich habe die WS-Leitung an einen Kanal des anderen Kanals, die CLK-Leitung, geh√§ngt.  Und ich war von der Pulsl√§nge WS - 16 √ºberzeugt. <br><br>  <i>Falsche Betriebsfrequenzen?</i>  Nein.  Die Frequenzen entsprechen alle den Arbeitern.  WS - 44100 Hz, CLK - 1411200 Hz. <br><br>  <i>Typnummern in den Daten formatieren?</i>  Es wird das richtige Zeichenformat verwendet (ja, ich dachte, es w√§re nicht signiert erforderlich).  Er √ºberpr√ºfte, indem er k√ºnstliche Sinus erzeugte und sie relativ zu 0 in der K√ºhnheit auf und ab bewegte und die Amplitude √§nderte.  Es gibt keine qualitativen √Ñnderungen. <br>  <i>Gibt es √ºberhaupt I2S?</i>  h√∂chstwahrscheinlich ja.  Erstens, weil dann alles f√ºr mich funktioniert hat (na ja, oder so scheint es mir), und zweitens habe ich versucht, dies mit einem Oszilloskop zu √ºberpr√ºfen, obwohl dies ohne einen Logikanalysator nat√ºrlich schwierig ist.  Es kann sich lohnen, einen genaueren Test durchzuf√ºhren und Ihren Beaglebone hierher zu bringen. <br><br>  Es scheint, dass alles wahr ist und f√ºr die Jungs vom Zwiebelforum funktioniert alles, aber die Wahrheit ist auf anderen Chips: MAX98357A und PCM5102.  Im Allgemeinen gebe ich die Idee auf, Wav'ki zu spielen und mpg123 dazu zu bringen, MP3s abzuspielen.  Ich schneide es mit dem Flag -C und beginne die Lautst√§rke zu verringern.  Und hier habe ich mich gesetzt.  Wenn ich die Lautst√§rke im Programm mpg123 auf ungef√§hr 1 Prozent einstelle, erhalte ich einen gro√üartigen Klang.  Der Chip schwingt auf volle Amplitude.  Ich starte das Radio mit der Flagge -f 128: <br><br><pre> <code class="hljs powershell">mpg123 <span class="hljs-operator"><span class="hljs-operator">-f</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> http://us2.internet<span class="hljs-literal"><span class="hljs-literal">-radio</span></span>.com:<span class="hljs-number"><span class="hljs-number">8443</span></span>/</code> </pre> <br>  Und die Kl√§nge eines entspannenden amerikanischen Blues treffen mich.  √úbrigens funktioniert die Verbindung zum Radio m√∂glicherweise nicht, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">von hier aus</a> . <br><br><img align="left" width="250" src="https://habrastorage.org/webt/5q/rr/2i/5qrr2ix-zdxzylgae0zhc1-jmr0.png" alt="Bild">  Ich starte ein S√§gezahnsignal und erh√∂he allm√§hlich die Amplitude.  Als Ergebnis habe ich gesehen, dass Verzerrungen chaotische Spr√ºnge von 0 zur Versorgungsspannung sind und je h√∂her der Pegel, desto mehr diese Spr√ºnge.  Ich habe mehrere Wochen gebraucht, um Omega zum Sprechen zu bringen.  Ich war sehr m√ºde und deshalb habe ich mich in diesem Moment entschlossen aufzuh√∂ren - es funktioniert! <br><br>  Ich verstehe jedoch, dass dies unm√∂glich ist, und freue mich √ºber Ihre Ideen und Vorschl√§ge.  Nun, f√ºr diejenigen, die versuchen, Omega in Qualen zum Reden zu bringen, hoffe ich, dass ich Ihnen geholfen habe! <br><br>  Danke an alle! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413623/">https://habr.com/ru/post/de413623/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413613/index.html">Dieses Raumschiff wird der Sonne n√§her kommen als alles, was davor war, und wird nicht schmelzen</a></li>
<li><a href="../de413615/index.html">Der VPNFilter-Virus, der 500.000 Router infizierte, erwies sich als noch gef√§hrlicher als angenommen</a></li>
<li><a href="../de413617/index.html">30% der Leistungsbeschreibung wurden ge√§ndert und der Plan wurde zweimal √ºbertroffen: Wie VTB die Berichterstellung automatisierte</a></li>
<li><a href="../de413619/index.html">Neue Informationen zu VPNFilter: Durch einen Angriff auf Benutzerger√§te wurde die Liste der Netzwerkger√§te erweitert</a></li>
<li><a href="../de413621/index.html">Lebe es. Stirb. Auferstehen. Wiederholen</a></li>
<li><a href="../de413627/index.html">Hierarchische Schl√ºsselgenerierung</a></li>
<li><a href="../de413631/index.html">Verschl√ºsselung von Zertifikatstoken auf einem Token unter Linux am Beispiel von JaCarta, Debian und dem Evolution-Mail-Client</a></li>
<li><a href="../de413633/index.html">Wie ich Englisch beherrschte</a></li>
<li><a href="../de413635/index.html">Wir entwerfen eine Viehfarm. Und nanoCAD VK verwenden?</a></li>
<li><a href="../de413637/index.html">Google hat 7 KI-Ethikprinzipien ver√∂ffentlicht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>