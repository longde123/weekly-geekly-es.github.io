<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐖 💔 🤽🏽 我们将VoIP GSM网关Yeastar TG100泵送到PBX ⛏️ 😜 👙</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="绝大多数现成的IP-PBX都是为员工人数为10人或以上的公司设计的。实际上，在俄罗斯，有很多公司拥有2至5名员工，并且他们还需要组织电话通讯。现成的IP-PBX的功能对其来说是多余的，并且成本太高。您可以使用常规计算机和Asterisk建立自己的电话交换机。您可以连接到VoIP服务提供商并使用服务“...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我们将VoIP GSM网关Yeastar TG100泵送到PBX</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/arttel/blog/396481/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绝大多数现成的IP-PBX都是为员工人数为10人或以上的公司设计的。实际上，在俄罗斯，有很多公司拥有2至5名员工，并且他们还需要组织电话通讯。现成的IP-PBX的功能对其来说是多余的，并且成本太高。您可以使用常规计算机和Asterisk建立自己的电话交换机。您可以连接到VoIP服务提供商并使用服务“ cloud PBX”。您可以采用另一种方法-拿一台已经预装了Asterisk的廉价设备，例如</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yeastar TG100</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后稍微增加一下其功能。对于那些不喜欢简单方法的人，欢迎光临。</font></font><br>
<br>
<img src="https://habrastorage.org/files/aed/b8a/870/aedb8a87057b45d9830ed77b91cfce41.jpg"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Yeastar TG100是用于一张SIM卡的VoIP GSM网关，通常用于使用SIP协议将蜂窝线路连接到IP-PBX。我们将尝试不将Yeastar TG100与IP-PBX一起使用。为什么我们选择GSM网关作为测试对象？许多公司在活动开始时就使用固定的手机号码与世界进行通信已不是什么秘密。在增长的过程中，通信需求增加了，但我也想保留旧的数字-从这个意义上讲，在计算机或虚拟IP-PBX上，使用VoIP GSM网关的选项看起来比Asterisk好。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为什么是Yeastar？首先，我们认为，这些是我们市场上质量最高的VoIP GSM网关。其次，这些网关提供了访问安装在其上的Asterisk并修改配置文件的能力（对此工程师应表示特别的感谢）。第三，制造商自己声称Yeastar VoIP GSM网关支持“用于注册IP电话的SIP服务器”，这常常会误导最终用户，他们认为他们可以将网关用作完整的IP-PBX。此类用户可能只对本文感兴趣。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
最后，为什么我们选择最年轻的Yeastar TG100？</font><font style="vertical-align: inherit;">这里的一切都很简单-因为我们在谈论最小的自动电话交换，所以我们选择了最便宜的网关。</font><font style="vertical-align: inherit;">如果需要，可以使用TG200（用于两张SIM卡），TG400（用于四张）甚至TG800（用于八张）代替TG100，它们的设置不会发生根本变化。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们想得到什么？</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
首先，我们将确定未来的IP-PBX应该具有的最小功能集。</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对讲机 </font><font style="vertical-align: inherit;">在网关上注册的用户的IP电话或软电话应能够拨打电话和转接电话</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来电。</font><font style="vertical-align: inherit;">来电应转到交互式语音菜单，该菜单将为呼叫者提供几个与公司员工联系的选项</font></font></li>
<li>SIP-.  GSM- –  ,          ,    ,     VoIP- </li>
<li> .           – SIP  GSM,     ,         .      –         GSM-,   –  SIP</li>
</ol><br>
<h3>     ?</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将尝试通过使用标准配置工具（即Web界面）的配置文件来最大限度地减少网关的配置。例如，使用它，我们可以创建将用户连接到IP电话网关所需的SIP帐户数量。转到“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网关-VoIP线路”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分</font><font style="vertical-align: inherit;">，然后单击“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加VoIP线路”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<img src="https://habrastorage.org/files/72e/37b/b67/72e37bb6774243699862301ba5506049.jpg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线路类型：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VoIP帐户</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SIP </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何名称</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部电话号码</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复杂密码</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们会根据需要多次重复执行此操作，以获取电话。不幸的是，即使创建了所有SIP帐户，内部通信也将无法正常工作，要启用该功能，我们将需要使用配置文件。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们将Yeastar TG100连接到VoIP服务提供商，因为网络界面可提供所有可能。在同一部分的“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网关-VoIP线路”中</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，再次单击“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加</font></font></b><font style="vertical-align: inherit;"><b><font style="vertical-align: inherit;">VoIP线路”</font></b><font style="vertical-align: inherit;">，然后</font><font style="vertical-align: inherit;">在“线路</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段中</font><font style="vertical-align: inherit;">选择“ VoIP线路”。每个电信运营商都有自己的注册要求，但是，可用字段足以成功连接其中的大多数。</font></font><br>
<br>
<img src="https://habrastorage.org/files/f04/70c/0a0/f0470c0a036e4b3a8fbcdc38118cb89f.jpg"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线路类型：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VoIP线路的</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：类型</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的SIP </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意名称</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机/ IP：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SIP服务器的IP地址或域名及其端口。</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SIP服务器的IP地址或域名</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：操作员发出的SIP ID </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标识名：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作员发出的</font><font style="vertical-align: inherit;">SIP ID </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作员</font><font style="vertical-align: inherit;">提供的密码</font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从（从“高级”选项卡）：</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作员发出的SIP ID </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过Web-创建交互式语音菜单该界面当然将不起作用。但是无论如何，对于他来说，您都需要语音问候，以便我们可以使用Web界面进行下载。在“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统-音频</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件” </font><font style="vertical-align: inherit;">部分中</font><b><font style="vertical-align: inherit;">，</font></b><font style="vertical-align: inherit;">单击“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载文件”。</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该文件必须为wav格式，并且大小不得超过1.8 Mb。</font><font style="vertical-align: inherit;">允许以下编码：</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
gsm 6.10 8kHz，单声道，1Kb / s </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
律/律法8kHz，单声道，1Kb / s </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pcm 8kHz，单声道，16Kb / s </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
这是Web界面终止的地方。</font><font style="vertical-align: inherit;">我们将自行配置内部，传出和传入路由。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到Yeastar TG100</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要进行连接，我们将使用SSH协议，该协议必须首先在网关上激活。在“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统”“网络设置”“局域网设置”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分中，</font><font style="vertical-align: inherit;">启用“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用S​​SH”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">，保存并应用更改。</font></font><br>
<br>
<img src="https://habrastorage.org/files/5eb/13a/27a/5eb13a27a8aa4e758bc0b9e78e645199.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
使用您喜欢的SSH客户端连接到网关。缺省情况下，连接端口为8022，登录名为root，密码为ys123456。通过连接，您将进入Linux OS的环境。</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
星号配置文件位于通常的位置-/ etc /星号，但是，您不能直接在其中进行任何更改，否则在Web界面中对设置进行任何应用后，配置文件中的所有设置都将丢失。要添加或更改Asterisk配置文件的设置，提供了一个特殊目录-/ persistent / custom-cfg。它包含gncustom.conf文件，其中包含所有星号配置文件的名称，您可以对其进行修改或向其中添加新的内容。</font></font><br>
<br>
<pre><code class="lisp hljs">cat /persistent/custom-cfg/gncustom.conf :<font></font>
[modifyfile]<font></font>
/etc/asterisk/extensions.conf<font></font>
/etc/asterisk/sip.conf<font></font>
/etc/asterisk/users.conf<font></font>
/etc/asterisk/iax.conf<font></font>
/etc/asterisk/queues.conf<font></font>
/etc/asterisk/features.conf<font></font>
/etc/asterisk/voicemail.conf<font></font>
/etc/asterisk/meetme.conf<font></font>
/etc/asterisk/rc_org.conf<font></font>
/etc/asterisk/rtp.conf<font></font>
/etc/asterisk/http.conf<font></font>
/etc/asterisk/musiconhold.conf<font></font>
/etc/asterisk/followme.conf<font></font>
/etc/asterisk/logger.conf<font></font>
/etc/asterisk/manager.conf<font></font>
/etc/asterisk/chan_dahdi.conf<font></font>
/etc/asterisk/digital-channel.conf<font></font>
[replacefile]<font></font>
/etc/asterisk/dahdi-channels.conf<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
因此，[modifyfile]部分中的文件是允许对现有设置进行更改或添加的文件。</font><font style="vertical-align: inherit;">[replacefile]部分中的文件-完全由您的设置替换的文件。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为了更改星号配置文件中的任何设置，您需要知道三个参数：</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于/ etc / asterisk文件夹中的Asterisk配置文件的名称</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方括号[section]中指示的节名称，将在其中更改相应的选项</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">期权本身的名称</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
接下来，在/ persistent / custom-cfg目录中创建一个名为&lt;name&gt; _custom.conf格式的文件。其中，&lt;name&gt;是/ etc / asterisk目录中配置文件的名称，不以“ .conf”结尾。例如，如果要更改/etc/asterisk/users.conf文件，则具有更改的文件将称为users_custom.conf。带有更改内容的文件以及您要更改的原始文件中均带有方括号的部分，并且下面的行用等号后的新值更改了选项。一个例子：</font></font><br>
<pre><code class="lisp hljs">[new-context]<font></font>
parameter1=value1<font></font>
parameter2=value2<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
如果在设置更改文件中指定的部分不在原始配置文件中，则将仅添加该部分。对配置文件进行更改后，必须应用它们。</font><font style="vertical-align: inherit;">最简单的方法是在Web界面中-在“任何设置”部分中，单击“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后</font><font style="vertical-align: inherit;">单击“ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用”</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部通话</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
稍早些时候，我们使用Web界面创建了SIP帐户，分别是401、402和403。这些SIP设备的配置位于文件/etc/asterisk/users.conf中。</font><font style="vertical-align: inherit;">每个设备使用其自己的拨号计划上下文-上下文参数。</font><font style="vertical-align: inherit;">对于401，它是Voip-Account-401；对于402，它是Voip-Account-402；对于403，它是Voip-Account-403。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
在设置计划文件/etc/asterisk/extensions.conf中，我们可以看到以下条目：</font></font><br>
<pre><code class="lisp hljs">[Voip-Account-401] <font></font>
[Voip-Account-402] <font></font>
[Voip-Account-403] <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
从本质上讲，这意味着我们创建的每个设备都在其自己且完全为空的拨号计划上下文中。</font><font style="vertical-align: inherit;">这解释了以下事实：默认情况下，网关中的内部呼叫不起作用，必须对此进行修复。</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们为拨号计划创建一个特殊的上下文，在该上下文中我们将处理来自SIP电话的拨出电话。</font><font style="vertical-align: inherit;">原始的拨号计划文件称为extensions.conf-因此，在目录/ persistent / custom-cfg中创建一个名为extensions_custom.conf的文件，其内容如下：</font></font><br>
<pre><code class="lisp hljs">[from-internal]
<span class="hljs-comment"><span class="hljs-comment">;internal routes</span></span>
exten =&gt; _4XX,<span class="hljs-number"><span class="hljs-number">1</span></span>,NoOp(<span class="hljs-name"><span class="hljs-name">Internal</span></span> Call)<font></font>
exten =&gt; _4XX,n,Dial(${trunk-${EXTEN}},<span class="hljs-number"><span class="hljs-number">30</span></span>,Ttr)<font></font>
exten =&gt; _4XX,n,Hangup()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
该条目的本质是，任何以数字4开头的三位数的呼叫都将使用网关的Web界面中先前创建的相应号码呼叫设备。</font></font><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还需要允许我们的电话在拨打电话时使用此拨号计划上下文。</font><font style="vertical-align: inherit;">为此，请在以下相同的extensions_custom.conf文件中添加以下行：</font></font><br>
<pre><code class="lisp hljs">[Voip-Account-401]	<font></font>
include =&gt; from-internal<font></font>
<font></font>
[Voip-Account-402]<font></font>
include =&gt; from-internal<font></font>
<font></font>
[Voip-Account-403]<font></font>
include =&gt; from-internal<font></font>
</code></pre><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用网络界面应用更改</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们查看文件/etc/asterisk/extensions.conf，并确保我们所做的更改已出现</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们会进行实际检查-我们尝试从一部内部电话拨打另一部内部电话</font></font></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来电</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
所有通过GSM线路和SIP中继线传入的呼叫，我们都将发送到具有以下结构的交互式语音菜单：</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">播放先前下载的带有语音问候的声音文件。</font><font style="vertical-align: inherit;">我们上传的文件位于/ var / lib / asterisk / sounds / record文件夹中</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们正在等待订户拨打该号码。</font><font style="vertical-align: inherit;">输入数字“ 1”时，呼叫号码为401的用户；输入数字“ 2”时，呼叫被发送到拨号组，电话401、402、403依次振铃</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果用户没有拨打任何电话，则呼叫也会转到同一个拨号组，但其中的电话不会依次响铃，而是同时响铃</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
要实现此功能，请将以下内容添加到extensions_custom.conf文件：</font></font><br>
<br>
<pre><code class="lisp hljs">[arttel-ivr]                                                             <font></font>
exten =&gt; _.,<span class="hljs-number"><span class="hljs-number">1</span></span>,NoOp(<span class="hljs-name"><span class="hljs-name">Custom</span></span> IVR by ArtTel)                                 <font></font>
exten =&gt; _.,n,Set(<span class="hljs-name"><span class="hljs-name">CDR</span></span>(<span class="hljs-name"><span class="hljs-name">userfield</span></span>)=SIP_TRUNK-&gt;IP)                          <font></font>
exten =&gt; _.,n,Answer()                                                   <font></font>
exten =&gt; _.,n,Set(<span class="hljs-name"><span class="hljs-name">TIMEOUT</span></span>(<span class="hljs-name"><span class="hljs-name">digit</span></span>)=2)                                                 <font></font>
exten =&gt; _.,n,Background(<span class="hljs-name"><span class="hljs-name">record/arttel_ivr_alaw</span></span>) <span class="hljs-comment"><span class="hljs-comment">;                                   </span></span>
exten =&gt; _.,n,WaitExten(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-comment"><span class="hljs-comment">; 3                                                             </span></span><font></font>
                                                                                    <font></font>
exten =&gt; <span class="hljs-literal"><span class="hljs-literal">t</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,NoOp(<span class="hljs-name"><span class="hljs-name">Goto</span></span> by Timeout) <span class="hljs-comment"><span class="hljs-comment">;   ,                                                   </span></span>
exten =&gt; <span class="hljs-literal"><span class="hljs-literal">t</span></span>,n,Macro(<span class="hljs-name"><span class="hljs-name">arttel-ringgroup</span></span>,ringall,<span class="hljs-number"><span class="hljs-number">402</span></span><span class="hljs-number"><span class="hljs-number">-403</span></span><span class="hljs-number"><span class="hljs-number">-401</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment">;                              </span></span>
exten =&gt; <span class="hljs-literal"><span class="hljs-literal">t</span></span>,n,Hangup()                                                               <font></font>
                                                                                    <font></font>
exten =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,NoOp(<span class="hljs-name"><span class="hljs-name">Goto</span></span> by pressed <span class="hljs-number"><span class="hljs-number">1</span></span>)                                                <font></font>
exten =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>,n,Dial(${trunk-401},<span class="hljs-number"><span class="hljs-number">30</span></span>,T) <span class="hljs-comment"><span class="hljs-comment">;  «1»,   401                                                </span></span>
exten =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>,n,Hangup()                                                               <font></font>
                                                                                    <font></font>
exten =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,NoOp(<span class="hljs-name"><span class="hljs-name">Goto</span></span> by pressed <span class="hljs-number"><span class="hljs-number">2</span></span>)                                                <font></font>
exten =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>,n,Macro(<span class="hljs-name"><span class="hljs-name">arttel-ringgroup</span></span>,linear,<span class="hljs-number"><span class="hljs-number">402</span></span><span class="hljs-number"><span class="hljs-number">-403</span></span><span class="hljs-number"><span class="hljs-number">-401</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment">;  «2»,  402, 403  404                               </span></span>
exten =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>,n,Hangup()<font></font>
<font></font>
[macro-arttel-ringgroup]                                                            <font></font>
<span class="hljs-comment"><span class="hljs-comment">;ARG1 - Type: linear, ringall                                                                                </span></span>
<span class="hljs-comment"><span class="hljs-comment">;ARG2 - Numbers separated dash: 401-402-403                                         </span></span>
<span class="hljs-comment"><span class="hljs-comment">;ARG3 - Time Dial for Dial app                                                      </span></span>
<span class="hljs-comment"><span class="hljs-comment">;ARG4 - Repeat Count for linear                                                     </span></span><font></font>
                                                                                    <font></font>
exten =&gt; s,<span class="hljs-number"><span class="hljs-number">1</span></span>,Set(<span class="hljs-name"><span class="hljs-name">RG_Type=</span></span>${ARG1})                                                            <font></font>
exten =&gt; s,n,Set(<span class="hljs-name"><span class="hljs-name">RG_Nums=</span></span>${ARG2})                                                   <font></font>
exten =&gt; s,n,NoOp(<span class="hljs-name"><span class="hljs-name">Macro</span></span> RingGroup type: ${RG_Type} for numbers: $RG_Nums)           <font></font>
exten =&gt; s,n,GotoIf($[ <span class="hljs-string"><span class="hljs-string">"${RG_Type}"</span></span> = <span class="hljs-string"><span class="hljs-string">"linear"</span></span> ]?linear,<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">:ringall</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)               <font></font>
exten =&gt; s,n,Hangup()                                                               <font></font>
                                                                                    <font></font>
exten =&gt; ringall,<span class="hljs-number"><span class="hljs-number">1</span></span>,Set(<span class="hljs-name"><span class="hljs-name">COUNT=1</span></span>)                                                     <font></font>
exten =&gt; ringall,n,Set(<span class="hljs-name"><span class="hljs-name">REPEAT_COUNT=1</span></span>)                                               <font></font>
exten =&gt; ringall,n,Set(<span class="hljs-name"><span class="hljs-name">Repeat=</span></span>${ARG4})                                               <font></font>
exten =&gt; ringall,n,Set(<span class="hljs-name"><span class="hljs-name">TimeDial=</span></span>${ARG3})                                             <font></font>
exten =&gt; ringall,n(<span class="hljs-name"><span class="hljs-name">loop</span></span>),Set(<span class="hljs-name"><span class="hljs-name">RG_Dial=</span></span>${RG_Dial}&amp;${trunk-${CUT(<span class="hljs-name"><span class="hljs-name">RG_Nums</span></span>,-,${COUNT})}})<font></font>
exten =&gt; ringall,n,NoOp(<span class="hljs-name"><span class="hljs-name">RG_Dial=</span></span>${RG_Dial})                                         <font></font>
exten =&gt; ringall,n,Set(<span class="hljs-name"><span class="hljs-name">COUNT=</span></span>$[${COUNT} + <span class="hljs-number"><span class="hljs-number">1</span></span>])                                       <font></font>
exten =&gt; ringall,n,GotoIf(${CUT(<span class="hljs-name"><span class="hljs-name">RG_Nums</span></span>,-,${COUNT})}?loop)                          <font></font>
exten =&gt; ringall,n(<span class="hljs-name"><span class="hljs-name">repeat</span></span>),Dial(${RG_Dial:<span class="hljs-number"><span class="hljs-number">1</span></span>},${TimeDial},T)                                <font></font>
exten =&gt; ringall,n,Set(<span class="hljs-name"><span class="hljs-name">REPEAT_COUNT=</span></span>$[${REPEAT_COUNT} + <span class="hljs-number"><span class="hljs-number">1</span></span>])                          <font></font>
exten =&gt; ringall,n,GotoIf($[ ${REPEAT_COUNT} &lt;= ${Repeat} ]?repeat)                    <font></font>
exten =&gt; ringall,n,Hangup()                                                         <font></font>
                                                                                    <font></font>
exten =&gt; linear,<span class="hljs-number"><span class="hljs-number">1</span></span>,Set(<span class="hljs-name"><span class="hljs-name">COUNT=1</span></span>)                                                      <font></font>
exten =&gt; linear,n,Set(<span class="hljs-name"><span class="hljs-name">REPEAT_COUNT=1</span></span>)                                               <font></font>
exten =&gt; linear,n,Set(<span class="hljs-name"><span class="hljs-name">Repeat=</span></span>${ARG4})                                               <font></font>
exten =&gt; linear,n,Set(<span class="hljs-name"><span class="hljs-name">TimeDial=</span></span>${ARG3})                                             <font></font>
exten =&gt; linear,n(<span class="hljs-name"><span class="hljs-name">loop</span></span>),Dial(${trunk-${CUT(<span class="hljs-name"><span class="hljs-name">RG_Nums</span></span>,-,${COUNT})}},${TimeDial},T)    <font></font>
exten =&gt; linear,n,Set(<span class="hljs-name"><span class="hljs-name">COUNT=</span></span>$[${COUNT} + <span class="hljs-number"><span class="hljs-number">1</span></span>])                                        <font></font>
exten =&gt; linear,n,GotoIf(${CUT(<span class="hljs-name"><span class="hljs-name">RG_Nums</span></span>,-,${COUNT})}?loop)                           <font></font>
exten =&gt; linear,n,Set(<span class="hljs-name"><span class="hljs-name">COUNT=1</span></span>)                                                      <font></font>
exten =&gt; linear,n,Set(<span class="hljs-name"><span class="hljs-name">REPEAT_COUNT=</span></span>$[${REPEAT_COUNT} + <span class="hljs-number"><span class="hljs-number">1</span></span>])                          <font></font>
exten =&gt; linear,n,GotoIf($[ ${REPEAT_COUNT} &lt;= ${Repeat} ]?loop)                    <font></font>
exten =&gt; linear,n,Hangup()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们的语音问候语上下文已经创建，现在有必要从GSM通道和SIP中继发送所有来电。</font><font style="vertical-align: inherit;">为此，请在/ persistent / custom-cfg文件夹中使用以下内容创建users_custom.conf文件：</font></font><br>
<br>
<pre><code class="lisp hljs">[gsm_1]<font></font>
context=arttel-ivr<font></font>
<font></font>
[trunk-arttel_telecom]<font></font>
context=arttel-ivr<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们保存并接受通过Web界面进行的更改。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拨出电话</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们要做的最后一件事是配置拨出呼叫的逻辑。</font><font style="vertical-align: inherit;">她将是下一个：</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼叫从89 ...开始的所有手机号码将通过GSM频道发出</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">俄罗斯的电话，其号码由10个字符组成，以83 ...，84 ...或88 ...开头，我们将通过SIP提供商发出</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从810开始拨打国际电话...我们还将通过GSM频道发布电话</font></font></li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
为此，将以下内容添加到我们已经创建的extensions_custom.conf文件的[from-internal]部分中：</font></font><br>
<br>
<pre><code class="lisp hljs"><span class="hljs-comment"><span class="hljs-comment">;outbound routes</span></span>
<span class="hljs-comment"><span class="hljs-comment">;STRATEGY: 0 - default(first free), 1 - linear(linear with memories), 2- balance</span></span>
exten =&gt; _89XX.,<span class="hljs-number"><span class="hljs-number">1</span></span>,NoOp(<span class="hljs-name"><span class="hljs-name">Outbound</span></span> dial to Mobile)<font></font>
exten =&gt; _89XX.,n,Set(<span class="hljs-name"><span class="hljs-name">CDR</span></span>(<span class="hljs-name"><span class="hljs-name">userfield</span></span>)=IP-&gt;MOBILE)<font></font>
exten =&gt; _89XX.,n,Set(<span class="hljs-name"><span class="hljs-name">STRATEGY=0</span></span>)                                                                                                  <font></font>
exten =&gt; _89XX.,n,Macro(<span class="hljs-name"><span class="hljs-name">trunkdial-failover-0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,,${EXTEN:<span class="hljs-number"><span class="hljs-number">0</span></span>},trunk-GSM1,)<font></font>
exten =&gt; _89XX.,n,Hangup()<font></font>
                                                                                             <font></font>
exten =&gt; _8[<span class="hljs-number"><span class="hljs-number">348</span></span>]XXXXXXXXX,<span class="hljs-number"><span class="hljs-number">1</span></span>,NoOp(<span class="hljs-name"><span class="hljs-name">Outbound</span></span> dial to Russia)<font></font>
exten =&gt; _8[<span class="hljs-number"><span class="hljs-number">348</span></span>]XXXXXXXXX,n,Set(<span class="hljs-name"><span class="hljs-name">CDR</span></span>(<span class="hljs-name"><span class="hljs-name">userfield</span></span>)=IP-&gt;SIP_TRUNK)<font></font>
exten =&gt; _8[<span class="hljs-number"><span class="hljs-number">348</span></span>]XXXXXXXXX,n,Set(<span class="hljs-name"><span class="hljs-name">STRATEGY=0</span></span>)<font></font>
exten =&gt; _8[<span class="hljs-number"><span class="hljs-number">348</span></span>]XXXXXXXXX,n,Macro(<span class="hljs-name"><span class="hljs-name">trunkdial-failover-0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,,${EXTEN:<span class="hljs-number"><span class="hljs-number">0</span></span>},trunk-arttel_telecom,)<font></font>
exten =&gt; _8[<span class="hljs-number"><span class="hljs-number">348</span></span>]XXXXXXXXX,n,Hangup()<font></font>
                                                                                    <font></font>
exten =&gt; _810XX.,<span class="hljs-number"><span class="hljs-number">1</span></span>,NoOp(<span class="hljs-name"><span class="hljs-name">Outbound</span></span> dial to International)<font></font>
exten =&gt; _810XX.,n,Set(<span class="hljs-name"><span class="hljs-name">CDR</span></span>(<span class="hljs-name"><span class="hljs-name">userfield</span></span>)=IP-&gt;MOBILE)<font></font>
exten =&gt; _810XX.,n,Set(<span class="hljs-name"><span class="hljs-name">STRATEGY=0</span></span>)<font></font>
exten =&gt; _810XX.,n,Macro(<span class="hljs-name"><span class="hljs-name">trunkdial-failover-0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,,${EXTEN:<span class="hljs-number"><span class="hljs-number">0</span></span>},trunk-GSM1,) <span class="hljs-comment"><span class="hljs-comment">; 1 trunk</span></span><font></font>
exten =&gt; _810XX.,n,Hangup()<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
通过分机号码模式不难理解哪些规则负责哪个方向：_89XX。</font><font style="vertical-align: inherit;">-手机号码，_8 [348] XXXXXXXXX-俄罗斯境内的电话，_810XX。</font><font style="vertical-align: inherit;">-拨打国际电话。</font><font style="vertical-align: inherit;">trunkdial-failover-0.4宏负责通过特定的中继发送呼叫。</font><font style="vertical-align: inherit;">第一个参数指示用于拨出呼叫的线路数。</font><font style="vertical-align: inherit;">最后一个参数列出可以通过其发出呼叫的中继。</font><font style="vertical-align: inherit;">例如，如果我们使用的是四端口网关</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yeastar TG400</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是单端口Yeastar TG100，则该行：</font></font><br>
<pre><code class="lisp hljs">exten =&gt; _89XX.,n,Macro(<span class="hljs-name"><span class="hljs-name">trunkdial-failover-0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,,${EXTEN:<span class="hljs-number"><span class="hljs-number">0</span></span>},trunk-GSM1,)  
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
应替换为：</font></font><br>
<pre><code class="lisp hljs">exten =&gt; _89XX.,n,Macro(<span class="hljs-name"><span class="hljs-name">trunkdial-failover-0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,,${EXTEN:<span class="hljs-number"><span class="hljs-number">0</span></span>},trunk-GSM1,trunk-GSM2,trunk-GSM3,trunk-GSM4,)
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
我们保存并应用所做的更改。</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结论</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
由于进行了这些更改，我们获得了功能全面的解决方案，准备完全平静地为2至10人的办公室提供服务。</font><font style="vertical-align: inherit;">是的，它不支持诸如录制和收听对话，呼叫寄存，电话会议，语音信箱等功能。</font><font style="vertical-align: inherit;">但是，实际上，对于最小的公司，并不需要所有这些功能。</font><font style="vertical-align: inherit;">但是该解决方案紧凑，功耗低并且支持GSM线路。</font><font style="vertical-align: inherit;">如果您有时间，渴望和想象力，</font><font style="vertical-align: inherit;">可以使用更多有趣的功能来补充</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yeastar TG100</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VoIP GSM网关</font><font style="vertical-align: inherit;">。</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN396481/">https://habr.com/ru/post/zh-CN396481/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN396467/index.html">暗物质有实际用途吗？</a></li>
<li><a href="../zh-CN396471/index.html">安德烈·什克里亚罗夫（Andrey Shklyarov）：“在印度，他们会毫不犹豫地画出为什么是“是”，在东欧-为什么是“否”。</a></li>
<li><a href="../zh-CN396473/index.html">什么是暗能量？</a></li>
<li><a href="../zh-CN396477/index.html">向伊桑80号提问：空间扩展的速度是否快于光速？</a></li>
<li><a href="../zh-CN396479/index.html">科学：为什么膝盖受伤经常无法he愈？</a></li>
<li><a href="../zh-CN396485/index.html">英格兰一家酒吧的所有者在一个机构中安装了法拉第笼，以阻止手机通讯</a></li>
<li><a href="../zh-CN396487/index.html">抽奖活动：令人印象深刻的下注工程解决方案</a></li>
<li><a href="../zh-CN396491/index.html">欧洲电子商务-2016</a></li>
<li><a href="../zh-CN396493/index.html">«Атака на СОРМ»: интервью с автором проекта</a></li>
<li><a href="../zh-CN396495/index.html">纽约州立纳米技术：纽约州立大学及其公司如何将国家转变为21世纪的硅谷</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>