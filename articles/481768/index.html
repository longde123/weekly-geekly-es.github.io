<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👊🏿 🧜🏼 🕜 Nos ocupamos de WebKit en 1C, por ejemplo, la integración de TinyMCE en un formulario administrado en UT 11.4 👨🏿‍🍳 👨🏻‍🌾 🧚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Muchos ya saben que en el lanzamiento de la plataforma 8.3.14.1565, el navegador Internet Explorer fue reemplazado por el Web-Kit, esto es en realidad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nos ocupamos de WebKit en 1C, por ejemplo, la integración de TinyMCE en un formulario administrado en UT 11.4</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481768/">  Muchos ya saben que en el lanzamiento de la plataforma 8.3.14.1565, el navegador Internet Explorer fue reemplazado por el Web-Kit, esto es en realidad un gran paso adelante, pero estoy seguro de que, como yo, aún no está claro qué es qué.  Hubo una experiencia de usar web-kit en 1C, llamando a JS desde 1C y llamando a 1C desde JS.  Tratemos de entender juntos cómo se diferencia uno del otro y, al mismo tiempo, hagamos algo útil.  Sí, y seguramente muchos tendrán que reescribir sus manualidades similares después de actualizar a una nueva plataforma, por lo que espero que mi experiencia sea útil. <br><a name="habracut"></a><br>  Todo comenzó con el hecho de que surgió la tarea: "Queremos, en UT, ingresar una descripción formateada del producto para que luego vuele a la tienda en línea", porque la descripción estándar del producto llega en una línea continua sin guiones y no se ve muy bien.  Inmediatamente hubo un deseo de usar un documento formateado, hay un editor simple y puedes subirlo a HTML.  Pero tan pronto como mostré el HTML generado por el documento formateado a los desarrolladores web, inmediatamente agitaron sus manos y dijeron que esto no funcionaría.  El sitio ya tiene sus propios estilos para mostrar los elementos de bloque necesarios y el comportamiento de este tipo de texto puede volverse impredecible. <br><br>  La función Obtener HTML de un documento formateado devuelve una página HTML completamente formada, con toda la estructura de las etiquetas, y lo que es más desagradable, con estilos en línea.  Se ve así. <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"X-UA-Compatible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IE=Edge"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"format-detection"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"telephone=no"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">8px</span></span></span><span class="css">;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">p</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">line-height</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">1.15</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">white-space</span></span></span><span class="css">:pre-wrap;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">ol</span></span></span><span class="css">,</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">ul</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin-top</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin-bottom</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">img</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border</span></span></span><span class="css">:none;} </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">li</span></span></span><span class="css">&gt;</span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">p</span></span></span><span class="css">{</span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">display</span></span></span><span class="css">:inline;} </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-decoration: underline;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"font-weight: bold;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color: #ff0000;font-weight: normal;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Y si obtener el contenido de la etiqueta del cuerpo es una tarea simple, entonces no quería analizar y recortar los atributos de estilo de las etiquetas. <br><br>  TinyMCE trae de vuelta un diseño agradable.  Permitirse estilos en línea solo en el caso del color, que ya es mucho mejor. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color: #ff0000;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Se decidió integrar TinyMCE, un editor de texto de terceros.  Además, la experiencia de su integración con la comunidad 1C ya es bastante grande. <br><br>  Tal vez fue un error entonces, y solo tenía que analizar el texto generado por un documento formateado, pero tenemos lo que tenemos. <br><br><h4>  1. Características de la solución. </h4><br>  Dado que 1C no permite cargar archivos locales desde el sistema de archivos a la página en el campo HTML, para esto definitivamente necesita un servidor web o al menos la dirección de este archivo en almacenamiento temporal, coloque la biblioteca Tiny js al lado de 1C y cárguela en los encabezados del documento HTML no puede: también tendrá que crear un archivo con un diseño HTML que internamente forme una ventana de editor preparada y que ya esté conectada al documento HTML. <br><br>  En general, de hecho, puede cargar una biblioteca si obtiene una dirección para ella en el repositorio si se compiló en un archivo, y Tiny, además de la biblioteca principal, también contiene archivos js, un administrador de estilos y estilos, archivos crack ellos mismos , íconos, etc., y como lo entiendes, esto complica enormemente la tarea.  Hubo un tiempo en que incluso surgió la idea de compilar todo esto en un solo archivo y no conocer los problemas, pero llevó mucho tiempo comprender las herramientas.  Luego se encontró TinyMCE Builder en el sitio web oficial, que compila todos los js en un solo archivo y sería una pequeña victoria si hiciera lo mismo con css, pero no, css aún se encuentra junto a varias carpetas. <br><br>  TinyMCE crea un iframe para la ventana de edición, que en sí mismo es un documento HTML incrustado en la página, por lo que los eventos que ocurren en este iframe 1C no pueden rastrearse, más sobre eso a continuación. <br><br>  La configuración de UT 11.4 en el momento del desarrollo tenía un modo de compatibilidad de 8.3.12, de modo que ahora usaba IE como navegador incorporado, pero una actualización adicional implicaba una transición a nuevas versiones que ya usan el kit web. <br><br><h4>  2. Primeros pasos </h4><br>  Las principales diferencias en el trabajo con el kit web: <br><br>  El objeto principal de los campos HTML ahora tiene una estructura diferente y para trabajar con el contenido de la página debe usar la propiedad <b>defaultView</b> <br><br><pre> <code class="1c hljs">.HTML.Document.DefaultView</code> </pre> <br>  utilizamos previamente la propiedad <b>parentWindow</b> para esto <br><br><pre> <code class="1c hljs">.HTML.Document.parentWindow</code> </pre> <br>  La prohibición de usar eval, que solía usarse universalmente para invocar código JS.  Algo como esto <br><br>  Elements.FieldHTML.Document.parentWindow.eval ("alert ('Código de llamada de 1C')") <br>  Pero puede acceder a los métodos directamente desde 1C. <br><br>  Elements.Description HTML.Document.DefaultView.NameMethodJS (); <br>  Y rápidamente construí funciones de ajuste para todos los métodos de Tiny que necesito. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tinyMCE.activeEditor.getContent({<span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">"text"</span></span>}); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tinyMCE.activeEditor.setContent(text); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHTML</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tinyMCE.activeEditor.getContent(); }</code> </pre> <br>  Que además se dirigió desde 1C <br><br><pre> <code class="1c hljs">HTML = .HTML.Document.DefaultView; HTML = HTML.GetHTML();  = HTML.GetText();</code> </pre> <br>  Aunque se podría pasar con llamadas directas al objeto editor, por ejemplo, <br><br><pre> <code class="1c hljs">.HTML..defaultView.tinyMCE.activeEditor.getContent()</code> </pre> <br>  El procesamiento de la publicación se descargó de inmediato (un respeto separado al autor), lo que me mostró muchas cosas interesantes.  Funcionó más o menos en IE, pero copiar y pegar no funcionó en webkit, al principio causó un estupor, pero luego quedó claro que era por el iframe que el campo HTML no estaba activado al hacer clic dentro de él, ya que el clic realmente ocurrió en el documento adjunto HTML cuyos eventos se atascaron en algún lugar en el camino a 1C.  Y, por lo tanto, si presiona Ctrl + C en un lugar del formulario e intenta pegarlo dentro del campo del editor, el texto se insertará en ese campo desde donde se copió porque el campo HTML del documento no está activado.  Lo mismo sucede en el caso contrario, los atajos de teclado para copiar y pegar no funcionan. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/759/7b5/9e3/7597b59e3048362a6cc6d715e64c43f3.gif" alt="imagen"><br><br>  Al principio, surgió la idea de que era una jamba Tiny, y bloquea la pasta directa del búfer, como CKEditor, que ofrece una ventana separada para pegar desde el búfer.  Pero para comprobar que fue bastante fácil, creé un documento vacío con un campo de entrada e intenté copiar y pegar <br><br><img src="https://habrastorage.org/getpro/habr/post_images/496/d00/ca5/496d00ca55f4a4ed0b593f56575b8336.gif" alt="imagen"><br><br>  Como puedes ver, todo funciona.  Entonces, el problema está en algún lugar de Tiny o en interacción con 1C. <br><br><h4>  3. Decisión </h4><br>  Para resolver el problema con la interacción del navegador y 1C, se aplicó el truco habitual, creé un botón invisible en la página HTML y planeé hacer clic en él desde JS cuando ocurrieron los eventos necesarios dentro de la página que 1C interceptaría en el evento HTML Press.  ¿Pero en qué evento llevar a cabo un programa de prensa? <br><br>  El diseño se ve así: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"editor"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button1c"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display: none"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Y una función para activar un evento de clic de botón <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickButton</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ button1c.click(); }</code> </pre> <br>  Anteriormente, era posible transferir un objeto de forma 1C en el campo HTML como un objeto, y debido al hecho de que IE se conectaba a 1C a través de COM, el formulario en sí mismo se convertía de alguna manera en un objeto que IE entendía y era posible llamar a las funciones de exportación de la forma 1C directamente desde el código JS .  Ahora es imposible. <br><br>  Estudiamos la documentación de Tiny API y encontramos una construcción para interceptar controladores de eventos y una combinación adecuada de eventos que deberían activar el campo HTML del documento <br><br><pre> <code class="javascript hljs">tinymce.activeEditor.on(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{clickButton(e)}); tinymce.activeEditor.on(<span class="hljs-string"><span class="hljs-string">'KeyDown'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{clickButton(e)});</code> </pre> <br>  Debe poner este código en el lugar donde Tiny ya se inicializó.  Hice esto en el controlador de carga del objeto de <b>ventana</b> .  Pero puede hacerlo más bellamente y colocar el código al inicializar Tiny en el parámetro: <br><br><pre> <code class="javascript hljs">init_instance_callback</code> </pre> <br>  Ahora todo debería estar en orden.  Y la forma debería funcionar como debería ... <br><br>  Se hizo mucho mejor, el campo HTML realmente comenzó a activarse, pero no siempre, por alguna razón, algunos clics no hicieron que el foco se moviera al campo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e91/403/d67/e91403d6763d389bcbb7b95a884e07e9.gif" alt="imagen"><br><br>  Este registro muestra que si hace clic en la línea donde parpadea el cursor, el foco del campo funciona como debería, pero si hace clic a continuación, el campo no se activa. <br><br>  Era un artefacto molesto, y los intentos de comprender lo que estaba sucediendo no dieron ninguna solución.  Envié alertas al controlador y se mostraron alertas, pero 1C no respondió al evento <br><br><img src="https://habrastorage.org/getpro/habr/post_images/531/81f/f82/53181ff82d52da46e812d260056e6d79.gif" alt="imagen"><br><br>  De repente, se me ocurrió la idea: qué pasa si 1C no logra procesar el evento que ocurre en el campo, qué pasa si ralentizas un poco la ejecución del script JS y ves lo que sucede.  La función de pausa en JS se implementó rápidamente usando promesas y espera asíncrona.  Como puede ver en JS, tampoco existe por defecto y nada, la gente vive). <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleep</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ms</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> setTimeout(resolve, ms)); } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickButton</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>); button1c.click(); }</code> </pre> <br>  Aquí configuro el retraso en un milisegundo, antes de hacer clic en el botón.  Y voila, funcionó.  1C comenzó a procesar el clic de un botón a tiempo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4fd/c95/937/4fdc959377f0ec372414c1db88959d9e.gif" alt="imagen"><br><br><h4>  4. Terminamos el intercambio. </h4><br>  Dado que para almacenar la nueva descripción en formato HTML, se agregó un nuevo atributo al directorio, debemos reemplazar el valor del campo típico durante la descarga.  Para hacer esto, en el módulo ExchangeSiteRemoveable, agregue la función GetTexts de RequestsCatalog a la extensión y escriba allí: <br><br><pre> <code class="1c hljs">. = <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(., <span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">".HTML_HTML"</span></span>);</code> </pre> <br>  Eso es todo.  Comenzamos el intercambio y todo funciona, solo queda hacer cambios en el sitio, si es necesario, para que la descripción del producto se perciba como diseño y no como una cadena. <br><br><h4>  Resumen </h4><br>  En este ejemplo, probé la interacción de JS WebKit y 1C, recogí el rastrillo y encontré una solución. <br><br>  Quizás para resolver este problema fue más fácil analizar y borrar el texto HTML de un documento formateado, pero no sería tan interesante y podría tener algunos problemas con algunas opciones de formato complejas. <br><br>  Gracias por leer </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/481768/">https://habr.com/ru/post/481768/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../481754/index.html">Yo bot y mi punzón</a></li>
<li><a href="../481756/index.html">¿Cómo organizar DDoS para buenos propósitos?</a></li>
<li><a href="../481758/index.html">Estadísticas de construcción, suministro y visitas a la ISS</a></li>
<li><a href="../481762/index.html">Ecuaciones para la cocina bajo el arbol de navidad</a></li>
<li><a href="../481764/index.html">¿Por qué la energía verde tiene un futuro difícil?</a></li>
<li><a href="../481770/index.html">El pionero de la programación informática Tony Brucker fallece a los 94 años</a></li>
<li><a href="../481772/index.html">Experimento VonmoTrade. Parte 2: Órdenes. Tipos, características de procesamiento</a></li>
<li><a href="../481774/index.html">Hojas de trucos de seguridad: parches virtuales</a></li>
<li><a href="../481776/index.html">Servicios 5G y de juegos en la nube: pruebe cómo funciona en Moscú</a></li>
<li><a href="../481778/index.html">Análisis de malware Skeleton Key</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>