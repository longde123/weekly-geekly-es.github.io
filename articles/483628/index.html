<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöÜ üí£ üî∫ Generaci√≥n de c√≥digo de OpenAPI v3 (tambi√©n conocido como Swagger 3) a TypeScript y no solo üë∑üèª ‚è≠Ô∏è üêà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace dos a√±os comenc√© a desarrollar  uno mas  un generador de c√≥digo gratuito de OpenAPI Specification v3 a TypeScript ( est√° disponible en Github ). ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Generaci√≥n de c√≥digo de OpenAPI v3 (tambi√©n conocido como Swagger 3) a TypeScript y no solo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483628/"><p>  Hace dos a√±os comenc√© a desarrollar <del>  uno mas </del>  un generador de c√≥digo gratuito de <a href="https://swagger.io/docs/specification/about/">OpenAPI Specification</a> v3 a TypeScript ( <a href="https://github.com/koshevy/codegena">est√° disponible en Github</a> ).  Inicialmente, me <a href="https://json-schema.org/understanding-json-schema/reference/combining.html">propuse</a> hacer una generaci√≥n eficiente de tipos de datos primitivos y complejos en TypeScript, teniendo en cuenta varias caracter√≠sticas del <a href="https://json-schema.org/">esquema JSON</a> , como <a href="https://json-schema.org/understanding-json-schema/reference/combining.html">oneOf / anyOf / allOf</a> , etc.  (La <a href="https://github.com/swagger-api/swagger-codegen">soluci√≥n nativa</a> de Swagger tuvo algunos problemas con esto).  Otra idea era usar esquemas de especificaciones para validaci√≥n en la parte frontal, posterior y otras partes del sistema. </p><br><p><img src="https://habrastorage.org/webt/hz/cd/u4/hzcdu47rcjbutgqbe6pdb2k46x8.png"></p><a name="habracut"></a><br><p>  Ahora el generador de c√≥digo est√° relativamente listo, est√° en la etapa <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B8%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE_%25D0%25B6%25D0%25B8%25D0%25B7%25D0%25BD%25D0%25B5%25D1%2581%25D0%25BF%25D0%25BE%25D1%2581%25D0%25BE%25D0%25B1%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BA%25D1%2582">MVP</a> .  Tiene mucho de lo que se necesita en t√©rminos de generaci√≥n de tipos de datos, as√≠ como una biblioteca experimental para generar servicios front-end (hasta ahora para Angular).  En este art√≠culo quiero mostrar los desarrollos y decirles c√≥mo pueden ayudar si usa TypeScript y OpenAPI v3.  En el camino, quiero compartir algunas ideas y consideraciones que han surgido en mi proceso de trabajo.  Bueno, si est√° interesado, puede leer la historia de fondo que escond√≠ en el spoiler para no complicar la lectura de la parte t√©cnica. </p><br><h2 id="soderzhanie">  Contenido </h2><br><ol><li>  <a href="https://habr.com/ru/post/483628/">Antecedentes</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Descripci√≥n</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Instalaci√≥n y uso</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Practica usando un generador de c√≥digo</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Uso de tipos de datos generados en aplicaciones</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Descomposici√≥n de circuitos dentro de la especificaci√≥n OEA</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Descomposici√≥n anidada</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Servicios generados autom√°ticamente para trabajar con la API REST</a> <br><ol><li>  <a href="https://habr.com/ru/post/483628/">¬øPor qu√© se necesita esto?</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Servicio de generaci√≥n</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Usar servicios generados</a> </li></ol></li><li>  <a href="https://habr.com/ru/post/483628/">En lugar de un ep√≠logo</a> </li></ol><br><a name="Foreword"></a><br><h2 id="predystoriya">  Antecedentes </h2><br><div class="spoiler">  <b class="spoiler_title">Expandir para leer (omitir)</b> <div class="spoiler_text"><p>  Todo comenz√≥ hace dos a√±os, luego trabaj√© en una empresa que desarrollaba una plataforma de miner√≠a de datos y fui responsable de la interfaz (principalmente TypeScript + Angular).  Las caracter√≠sticas del proyecto eran estructuras de datos complejas con una gran cantidad de par√°metros (30 o m√°s) y no siempre relaciones comerciales obvias entre ellos.  La compa√±√≠a estaba creciendo y el entorno de software estaba experimentando cambios bastante frecuentes.  El frontend ten√≠a que estar bien informado sobre los matices, porque algunos c√°lculos estaban duplicados en el frente y en el backend.  Es decir, este fue el caso cuando usar OpenAPI es m√°s que apropiado.  Encontr√© un per√≠odo en la empresa en el que en cuesti√≥n de meses el equipo de desarrollo adquiri√≥ una sola especificaci√≥n, que se convirti√≥ en una base de conocimiento com√∫n para el departamento posterior, frontal e incluso central, que estaba oculto detr√°s del amplio back-end web.  La versi√≥n de OpenAPI fue elegida "para el crecimiento", entonces todav√≠a bastante joven v3.0 </p><br><p>  Esto ya no era una especificaci√≥n en uno o m√°s archivos YML / JSON est√°ticos, y no el resultado de <a href="https://github.com/zircote/swagger-php">anotadores</a> , sino una biblioteca completa de componentes, m√©todos, plantillas y propiedades, organizados de acuerdo con el concepto DDD de la plataforma.  La biblioteca se dividi√≥ en directorios y archivos, y un recolector especialmente organizado produjo documentos de la OEA para cada √°rea tem√°tica.  Se cre√≥ una forma experimental de flujo de trabajo, que podr√≠a describirse como Design-First. </p><br><blockquote>  Hay un <a href="https://habr.com/ru/company/yamoney/blog/347390/">buen art√≠culo</a> en el blog de la compa√±√≠a Yandex.Money, que habl√≥ sobre Design First </blockquote><p>  Design First y la especificaci√≥n general ayudaron a desacralizar el conocimiento, pero se hizo evidente un nuevo problema: mantener la relevancia del c√≥digo.  La especificaci√≥n describe varias docenas de m√©todos y docenas (y luego cientos) de entidades.  Pero el c√≥digo ten√≠a que escribirse manualmente: tipos de datos, servicios para trabajar con REST, etc.  Uno o dos sprints con historias paralelas cambiaron enormemente la imagen;  Agregar complejidad a la fusi√≥n de varias historias y el factor humano.  La rutina amenazaba con ser significativa, y la soluci√≥n parec√≠a obvia: necesita generar c√≥digo.  Despu√©s de todo, las especificaciones de la OEA ya conten√≠an todo lo necesario para no volver a escribirlo manualmente.  Pero no fue tan simple. </p><br><p>  La interfaz est√° al final del ciclo de producci√≥n, por lo que sent√≠ cambios m√°s dolorosos que los colegas de otros departamentos.  Al dise√±ar la API REST, el entorno de back-end fue decisivo, e incluso despu√©s de la aprobaci√≥n de "Design First", permaneci√≥ la inercia;  para el front end, todo parec√≠a menos obvio.  De hecho, entend√≠ esto desde el principio, y comenc√© a sondear el suelo de antemano, cuando apenas se comenzaba a hablar de una especificaci√≥n "universal".  No se habl√≥ de escribir su propio generador de c√≥digo;  Solo quer√≠a encontrar algo listo. </p><br><p>  Estaba decepcionado  Hubo dos problemas: la versi√≥n 3.0 de la OEA, con el apoyo de la cual, al parecer, nadie ten√≠a prisa, y la calidad de las soluciones en s√≠ mismas; en ese momento (recuerdo, esto fue hace dos a√±os), logr√© encontrar dos soluciones relativamente listas: <a href="https://github.com/swagger-api/swagger-codegen">de Swagger</a> y de Microsoft (Parece <a href="https://github.com/Azure/autorest">que</a> ).  En el primero, el soporte para OAS 3.0 estaba en beta profunda.  El segundo funcion√≥ solo con la versi√≥n 2.x, pero no hubo pron√≥sticos inequ√≠vocos.  Por cierto, no pude iniciar el generador de c√≥digo de Microsoft incluso en un documento de prueba del formato Swagger 2.0.  La soluci√≥n de Swagger funcion√≥, pero un esquema m√°s o menos complicado con enlaces $ ref se convirti√≥ en un "ERROR" incomprensible, y las dependencias recursivas lo enviaron a un bucle sin fin.  Hubo problemas con <a href="">los tipos primitivos</a> .  Adem√°s, no entend√≠a bien c√≥mo trabajar con servicios generados autom√°ticamente: parec√≠an estar hechos para mostrar, y su uso real cre√≥ m√°s problemas de los que resolvieron (en mi opini√≥n).  Y finalmente, la integraci√≥n del archivo JAR en un CI / CD orientado a NPM fue inconveniente: tuve que descargar manualmente la <a href="https://oss.sonatype.org/content/repositories/snapshots/io/swagger/codegen/v3/swagger-codegen-cli/3.0.15-SNAPSHOT/">instant√°nea necesaria</a> , que parec√≠a pesar 13 megabytes, y hacer algo con ella.  En general, me tom√© un descanso y decid√≠ ver qu√© pasa despu√©s. </p><br><p>  Despu√©s de unos cinco meses, surgi√≥ nuevamente el problema de la generaci√≥n de c√≥digo.  Tuve que reescribir y expandir parte de la aplicaci√≥n web, y al mismo tiempo quer√≠a refactorizar los servicios antiguos para trabajar con la API REST y los tipos de datos.  Pero la evaluaci√≥n de la complejidad no fue optimista: de una semana a dos personas, y esto es solo para servicios REST y descripciones de tipos.  No dir√© que me deprimi√≥ mucho, pero a√∫n as√≠.  Por otro lado, nunca encontr√© una soluci√≥n para la generaci√≥n de c√≥digo y no esper√©, y su implementaci√≥n dif√≠cilmente tomar√≠a menos tiempo.  Es decir, no hab√≠a dudas al respecto: el beneficio es dudoso, los riesgos son grandes.  Nadie apoyar√≠a esta idea, y no lo propuse.  Mientras tanto, se acercaban las vacaciones de mayo, y la compa√±√≠a me "debi√≥" varios d√≠as por trabajar el fin de semana.  Durante dos semanas me escap√© de todas las experiencias laborales a Georgia, donde una vez viv√≠ durante casi un a√±o. </p><br><p>  Entre fiestas y fiestas, necesitaba hacer algo, y decid√≠ escribir mi decisi√≥n.  Trabajar en caf√©s de verano cerca de Vake Park fue sorprendentemente productivo, y volv√≠ a Peter con un generador de c√≥digo listo para usar para tipos de datos.  Luego, durante otro mes, "termin√©" los servicios los fines de semana antes de que estuviera listo para trabajar. </p><br><p>  Desde el principio, abr√≠ el generador de c√≥digo, trabajando en √©l en mi tiempo libre.  Aunque, de hecho, escribi√≥ para un borrador de trabajo.  No dir√© que la revisi√≥n / ejecuci√≥n se realiz√≥ sin ning√∫n problema;  y no dir√© que fueron significativos.  Pero en alg√∫n momento not√© que dej√© de usar la documentaci√≥n Redoc / Swagger: navegar por el c√≥digo era m√°s conveniente, siempre que el c√≥digo est√© siempre actualizado y comentado.  Pronto, "anot√©" mis logros, sin desarrollarlos en absoluto, hasta que un colega (ahora hace seis meses que me fui a otra empresa) me aconsej√≥ que los tomara m√°s en serio (tambi√©n se le ocurri√≥ el nombre). </p><br><blockquote>  No ten√≠a suficiente tiempo libre y me llev√≥ varios meses finalizar en segundo plano: √°rea de <a href="https://stackblitz.com/edit/codegena-playground">juegos</a> , aplicaci√≥n de prueba, reorganizaci√≥n del proyecto.  Ahora estoy listo para recibir comentarios. </blockquote></div></div><br><a name="Description"></a><br><h2 id="opisanie">  Descripci√≥n </h2><br><p> Por el momento, la soluci√≥n para la generaci√≥n de c√≥digo incluye tres bibliotecas NPM integradas en el <code>@codegena</code> @codegena y ubicadas en un <a href="https://github.com/koshevy/codegena">mono-repositorio</a> com√∫n: </p><br><div class="scrollable-table"><table><thead><tr><th>  La biblioteca </th><th>  Descripci√≥n </th></tr></thead><tbody><tr><td>  @ codegena / oapi3ts </td><td>  La biblioteca base es un convertidor de OAS3 a descripciones de tipo de datos (ahora solo admite TypeScript) </td></tr><tr><td>  @ codegena / ng-api-service </td><td>  Extensi√≥n para servicios angulares </td></tr><tr><td>  @ codegena / oapi3ts-cli </td><td>  Shell para uso conveniente en scripts CLI </td></tr></tbody></table></div><br><a name="SetupAndUsing"></a><br><h3 id="ustanovka-i-ispolzovanie">  Instalaci√≥n y uso </h3><br><p>  La opci√≥n m√°s pr√°ctica es usar los scripts NodeJS que se ejecutan desde la CLI.  Primero necesitas instalar las dependencias: </p><br><pre> <code class="plaintext hljs">npm i @codegena/oapi3ts, @codegena/ng-api-service, @codegena/oapi3ts-cli</code> </pre> <br><p>  Luego, cree un archivo js (por ejemplo, <code>update-typings.js</code> ) con el c√≥digo: </p><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">"use strict"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliLib = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@codegena/oapi3ts-cli'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliApp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> cliLib.CliApplication; cliApp.createTypings(); <span class="hljs-comment"><span class="hljs-comment">// cliApp.createServices('angular'); // optional</span></span></code> </pre> <br><p>  Y comience pasando tres par√°metros: </p><br><pre> <code class="plaintext hljs">node ./update-typings.js --srcPath ./specs/todo-app-spec.json --destPath ./src/lib --separatedFiles true</code> </pre> <br><p>  En <code>destPath</code> se generar√°n archivos y, de hecho, los contenidos de <a href="https://github.com/koshevy/codegena/tree/master/libs/todo-app-scheme/src/lib">este directorio</a> en el repositorio del proyecto se crean de la misma manera.  <a href="">Aqu√≠ est√° el script generador</a> , y <a href="">as√≠ es como</a> se ejecuta en los scripts NPM.  Sin embargo, si lo desea, puede usarlo incluso en el navegador, como se hace en <a href="https://codegena-playground.stackblitz.io/">Playground</a> . </p><br><a name="CodegenerationUsingPractice"></a><br><h2 id="praktika-ispolzovanie-kodogeneratora">  Practica usando un generador de c√≥digo </h2><br><p>  A continuaci√≥n, quiero hablar sobre lo que obtendremos como resultado: cu√°l es la idea de c√≥mo esto nos ayudar√°.  Una ayuda visual ser√° el c√≥digo de la aplicaci√≥n de demostraci√≥n.  Consta de dos partes: un back-end (en el marco <a href="https://nestjs.com/">NestJS</a> ) y una interfaz (en <a href="https://angular.io/">Angular</a> ).  Si lo desea, incluso puede <a href="https://github.com/koshevy/codegena/tree/5367749623826d270fb652e32fa394c023751877">ejecutarlo localmente</a> . </p><br><blockquote>  Incluso si no est√° familiarizado con Angular y / o NestJS, esto no deber√≠a causar problemas: la mayor√≠a de los desarrolladores de TypeScript deben entender los ejemplos de c√≥digo que se proporcionar√°n. </blockquote><p>  Aunque la aplicaci√≥n se simplifica tanto como sea posible (por ejemplo, el back-end almacena datos en una sesi√≥n, no en la base de datos), trat√© de recrear el flujo de datos y las caracter√≠sticas de la jerarqu√≠a de tipos de datos inherentes a la aplicaci√≥n real.  Est√° listo en un 80-85%, pero el "acabado" puede retrasarse, pero por ahora es m√°s importante hablar sobre lo que ya est√° all√≠. </p><br><a name="UsingGeneratedDataTypes"></a><br><h2 id="ispolzovanie-generiruemyh-tipov-dannyh-v-prilozheniyah">  Uso de tipos de datos generados en aplicaciones </h2><br><p>  Supongamos que tenemos una especificaci√≥n OpenAPI (por ejemplo, <a href="">esta</a> ) con la que tenemos que trabajar.  No importa si creamos algo desde cero, o si apoyamos, hay una cosa importante con la que es m√°s probable que comencemos: escribir.  Comenzaremos a describir los tipos de datos b√°sicos o haremos cambios en ellos.  La mayor√≠a de los programadores hacen esto para facilitar su desarrollo futuro.  Para que no tenga que revisar la documentaci√≥n una vez m√°s, tenga en cuenta los listados de par√°metros;  y puede estar seguro de que el IDE y / o el compilador notar√°n un error tipogr√°fico. </p><br><p>  Nuestra especificaci√≥n puede o no incluir la secci√≥n de <a href="">componentes</a> .  Pero, en cualquier caso, describir√° conjuntos de par√°metros, solicitudes y respuestas, y podemos usarlo.  Considere un ejemplo: </p><br><pre> <code class="javascript hljs">@Controller(<span class="hljs-string"><span class="hljs-string">'group'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... @Put(':groupId') rewriteGroup( @Param(ParseQueryPipe) { groupId }: RewriteGroupParameters, @Body() body: RewriteGroupRequest, @Session() session ): RewriteGroupResponse&lt;HttpStatus.OK&gt; { return this.appService .setSession(session) .rewriteGroup(groupId, body); } // ... }</span></span></code> </pre> <br><p>  Este es un fragmento de <a href="">controlador</a> para el marco NestJS con par√°metros ( <code>RewriteGroupParameters</code> ), cuerpo de solicitud ( <code>RewriteGroupRequest</code> ) y cuerpo de respuesta ( <code>RewriteGroupResponse&lt;T&gt;</code> ) <code>RewriteGroupResponse&lt;T&gt;</code> .  Ya en este fragmento de c√≥digo podemos ver los beneficios de escribir: </p><br><ul><li>  Si confundimos el nombre del par√°metro destruido <code>groupId</code> , especificando <code>groupId</code> en <code>groupId</code> lugar, inmediatamente recibimos un error en el editor. <br><img src="https://habrastorage.org/webt/1z/2q/0c/1z2q0cstw2lv3vncwmgi8gkxfa0.png"></li><li>  Si el <a href="">m√©todo this.appService.rewriteGroup (groupId, body)</a> tiene par√°metros escritos, podemos controlar la correcci√≥n del par√°metro <code>body</code> pasado.  Y si el formato de datos de entrada del m√©todo del controlador o el m√©todo del servicio cambia, lo sabremos de inmediato.  Mirando hacia el futuro, noto que el m√©todo de entrada del m√©todo de servicio tiene un tipo de datos diferente de <code>RewriteGroupRequest</code> , pero en nuestro caso, ser√°n id√©nticos entre s√≠.  Sin embargo, si de repente se cambia el m√©todo de servicio y comienza a aceptar <code>ToDoGroup</code> lugar de <code>ToDoGroupBlank</code> , el IDE y el compilador mostrar√°n inmediatamente los lugares de discrepancias: <br><img src="https://habrastorage.org/webt/wo/cq/rr/wocqrrks2gtcthaq_wghrhlbbta.png"></li><li>  Del mismo modo, podemos controlar el cumplimiento del resultado devuelto.  Si el estado de una respuesta exitosa cambia repentinamente en la especificaci√≥n y se convierte en <code>202</code> lugar de <code>200</code> , tambi√©n lo descubriremos, porque <code>RewriteGroupResponse</code> es <a href="">un gen√©rico con un tipo enumerado</a> : <br><img src="https://habrastorage.org/webt/pt/io/ss/ptiossjjfhihchrlwdlydrrkft4.png"></li></ul><br><p>  Ahora veamos <a href="">un ejemplo de la aplicaci√≥n front-end</a> que funciona con <a href="">otro m√©todo API</a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initSelectedGroupData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(truth: ComponentTruth)</span></span></span><span class="hljs-function">: Observable&lt;ComponentTruth&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getGroupsService.request(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, { isComplete: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, withItems: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }).pipe( pickResponseBody&lt;GetGroupsResponse&lt;<span class="hljs-number"><span class="hljs-number">200</span></span>&gt;&gt;(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), switchMap&lt;ToDoGroup[], Observable&lt;ComponentTruth&gt;&gt;( groups =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadItemsOfSelectedGroups({ ...truth, groups }) ) ); }</code> </pre> <br><p>  No nos adelantemos y analicemos el operador <code>pickResponseBody</code> personalizado <code>pickResponseBody</code> , sino que nos centremos en el refinamiento del tipo <code>GetGroupsResponse</code> .  Lo usamos en una cadena de operadores RxJS, y el operador que lo sigue tiene un refinamiento de entrada de <code>ToDoGroup[]</code> .  Si este c√≥digo funciona, los tipos de datos indicados se corresponden entre s√≠.  Aqu√≠ tambi√©n podemos controlar la coincidencia de tipos, y si el formato de respuesta en nuestra API cambia repentinamente, esto no escapar√° a nuestra atenci√≥n: </p><br><p><img src="https://habrastorage.org/webt/ci/hr/7c/cihr7csbo5kqn9fqkreoij7kuxk.png"></p><br><p>  Y, por supuesto, tambi√©n se escriben los par√°metros de llamada de <code>this.getGroupsService.request</code> .  Pero este es el tema de los servicios generados. </p><br><blockquote>  En los ejemplos anteriores, vemos que la tipificaci√≥n de solicitudes, respuestas y par√°metros se puede utilizar en varias partes del sistema: frontend, back-end, etc.  Si el backend y el frontend est√°n en el mismo mono-repositorio y tienen un entorno ecol√≥gico compatible, pueden usar la misma <a href="https://github.com/koshevy/codegena/tree/5367749623826d270fb652e32fa394c023751877/libs/todo-app-scheme">biblioteca compartida</a> con el c√≥digo generado.  Pero incluso si el backend y el frontend son compatibles con diferentes equipos y no tienen nada en com√∫n, excepto la especificaci√≥n p√∫blica de la OEA, a√∫n ser√° m√°s f√°cil para ellos sincronizar su c√≥digo. </blockquote><br><a name="DecompositionInOAS"></a><br><h2 id="dekompoziciya-shem-vnutri-oas-specifikacii">  Descomposici√≥n de circuitos dentro de la especificaci√≥n OEA </h2><br><p>  Probablemente, en los ejemplos anteriores, prest√≥ atenci√≥n a las <code>ToDoGroup</code> <code>ToDoGroupBlank</code> , <code>ToDoGroup</code> , con las cuales <code>RewriteGroupResponse</code> y <code>GetGroupsResponse</code> .  En realidad, <code>RewriteGroupResponse</code> es solo un alias gen√©rico para <code>ToDoGroup</code> , <code>HttpErrorBadRequest</code> , etc.  Es f√°cil adivinar que tanto <a href="">ToDoGroup</a> como <a href="">HttpErrorBadRequest</a> son diagramas de la secci√≥n de especificaci√≥n de <a href="">componentes.schem a la que hace</a> referencia el <a href="">punto final rewriteGroup</a> (directamente o a trav√©s de <a href="">intermediarios</a> ): </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"responses"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"200"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Todo group saved"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"content"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"application/json"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"schema"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ToDoGroup"</span></span> } } } }, <span class="hljs-attr"><span class="hljs-attr">"400"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorBadRequest"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"404"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorGroupNotFound"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"409"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorConflict"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"500"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorServer"</span></span> } }</code> </pre><br><p>  Esta es la descomposici√≥n habitual de las estructuras de datos, y su principio es el mismo que en otros lenguajes de programaci√≥n.  Los componentes, a su vez, tambi√©n se pueden descomponer: consulte otros componentes (incluso de forma recursiva), use la combinaci√≥n y otras caracter√≠sticas del esquema JSON.  Pero independientemente de la complejidad, deben convertirse correctamente a descripciones de tipos de datos.  Quiero mostrar c√≥mo puede usar la descomposici√≥n en OpenAPI y c√≥mo se ver√° el c√≥digo generado. </p><br><blockquote>  Los componentes en una especificaci√≥n OAS bien dise√±ada se superpondr√°n con el modelo DDD de las aplicaciones que lo utilizan.  Pero incluso si la especificaci√≥n es imperfecta, puede confiar en ella, creando su propio modelo de datos.  Esto le dar√° m√°s control sobre la correspondencia de sus tipos de datos con los tipos de datos de subsistemas integrables. </blockquote><p>  Dado que nuestra aplicaci√≥n es una lista de tareas, la esencia principal es la tarea.  Es l√≥gico ponerlo en los componentes en primer lugar, porque  otras entidades y puntos finales estar√°n de alguna manera conectados con √©l.  Pero antes de eso necesitas entender dos cosas: </p><br><ul><li>  Describimos no solo la abstracci√≥n, sino tambi√©n las reglas de validaci√≥n, y cuanto m√°s precisas e inequ√≠vocas sean, mejor. </li><li>  Al igual que cualquier entidad almacenada en una base de datos, una tarea tiene dos tipos de propiedades: servicio e ingresada por el usuario. </li></ul><br><p>  Resulta que, dependiendo del escenario de uso, tenemos dos estructuras de datos: la Tarea que el usuario acaba de crear y la Tarea que ya est√° almacenada en la base de datos.  En el segundo caso, tiene un UID √∫nico, fecha de creaci√≥n, cambio, etc., y estos datos deben asignarse en el back-end.  Describ√≠ dos entidades ( <code>ToDoTaskBlank</code> y <code>ToDoTask</code> ) de tal manera que la primera es un subconjunto de la segunda: </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"components"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ToDoTaskBlank"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Base part of data of item in todo's group"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Data about group item needed for creation of it"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"groupUid"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"An unique id of group that item belongs to"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/Uid"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Short brief of task to be done"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"minLength"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxLength"</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Detailed description and context of the task. Allowed using of Common Markdown."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: [<span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"null"</span></span>], <span class="hljs-attr"><span class="hljs-attr">"minLength"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxLength"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"isDone"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Status of task: is done or not"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Position of a task in group. Allows to track changing of state of a concrete item, including changing od position."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"number"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"min"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max"</span></span>: <span class="hljs-number"><span class="hljs-number">4096</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"attachments"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"array"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Any material attached to the task: may be screenshots, photos, pdf- or doc- documents on something else"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMeta"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"maxItems"</span></span>: <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: [] } }, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"isDone"</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"isDone"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Book soccer field"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"The complainant agreed and recruited more members to play soccer."</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"ToDoTask"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Item in todo's group"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Describe data structure of an item in group of tasks"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"allOf"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ToDoTaskBlank"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"object"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"uid"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"An unique id of task"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/Uid"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dateCreated"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Date/time (ISO) when task was created"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"format"</span></span>: <span class="hljs-string"><span class="hljs-string">"date-time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-11-17T11:20:51.555Z"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dateChanged"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Date/time (ISO) when task was changed last time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"format"</span></span>: <span class="hljs-string"><span class="hljs-string">"date-time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-11-17T11:20:51.555Z"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"dateChanged"</span></span>, <span class="hljs-string"><span class="hljs-string">"dateCreated"</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span>, <span class="hljs-string"><span class="hljs-string">"uid"</span></span> ] } ] } }</code> </pre> <br><p>  En la salida, obtenemos dos interfaces TypeScript, y la <a href="">primera</a> ser√° heredada por la <a href="">segunda</a> : </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * ## Base part of data of item in todo's group * Data about group item needed for creation of it */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskBlank</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... imagine there are ToDoTaskBlank properties } /** * ## Item in todo's group * Describe data structure of an item in group of tasks */ export interface ToDoTask extends ToDoTaskBlank { /** * ## UID of element * An unique id of task */ readonly uid: string; /** * Date/time (ISO) when task was created */ readonly dateCreated: string; /** * Date/time (ISO) when task was changed last time */ readonly dateChanged: string; // ... imagine there are ToDoTaskBlank properties }</span></span></code> </pre> <br><p>  Ahora tenemos las descripciones b√°sicas de la entidad Tarea, y nos referimos a ellas <strong>en el c√≥digo de nuestra aplicaci√≥n</strong> tal como se hizo en la <a href="">aplicaci√≥n de demostraci√≥n</a> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTask, ToDoTaskBlank, } from <span class="hljs-string"><span class="hljs-string">'@our-npm-scope/our-generated-lib'</span></span>; export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskTeaser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-class"> </span></span>{ isInvalid?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Means this task just created, has temporary uid * and not saved yet. */</span></span> isJustCreated?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Means this task is saving now. */</span></span> isPending?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Previous uid of task temporary assigned until * it gets saved and gets new UID from backend. */</span></span> prevTempUid?: string; }</code> </pre> <br><p>  En este ejemplo, describimos una nueva entidad, agregando a <code>ToDoTask</code> las propiedades que nos faltan en el lado de la aplicaci√≥n front-end.  Es decir, de hecho, ampliamos el modelo de datos resultante teniendo en cuenta los detalles locales.  Alrededor de este modelo, un conjunto de <a href="">herramientas locales</a> y algo as√≠ como un DTO primitivo crece gradualmente: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">downgradeTeaserToTask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> taskTeaser: ToDoTaskTeaser </span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> task = { ...taskTeaser }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!task.description || !task.description.trim()) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.description; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { task.description = task.description.trim(); } <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.isJustCreated; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.isPending; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.prevTempUid; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">downgradeTeaserToTaskBlank</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> taskTeaser: ToDoTaskTeaser </span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToDoTaskBlank</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> task = downgradeTeaserToTask(taskTeaser) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> any; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.dateChanged; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.dateCreated; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.uid; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Alguien prefiere hacer que el modelo de datos sea m√°s integral y usar clases.</b> <div class="spoiler_text"><pre> <code class="java hljs">export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskTeaser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ imagine, definitions from ToDoTask are here constructor( task: ToDoTask, public isInvalid?: boolean, public isJustCreated?: boolean, public isPending?: boolean, public prevTempUid?: string ) { Object.assign(this, task); } downgradeTeaserToTask(): ToDoTask { const task = {...this}; if (!task.description || !task.description.trim()) { delete task.description; } else { task.description = task.description.trim(); } delete task.isJustCreated; delete task.isPending; delete task.prevTempUid; return task; } downgradeTeaserToTaskBlank(): ToDoTaskBlank { // ‚Ä¶ some code } }</span></span></code> </pre> </div></div><br><p>  Pero esta es una cuesti√≥n de estilo, adecuaci√≥n y c√≥mo se desarrollar√° la arquitectura de la aplicaci√≥n.  En general, independientemente del enfoque, podemos confiar en un modelo de datos b√°sico y tener m√°s control sobre la conformidad de la escritura.  Entonces, si por alguna raz√≥n el <code>uid</code> de <code>ToDoTask</code> convierte en un n√∫mero, sabremos todas las partes del c√≥digo que requieren actualizaci√≥n: </p><br><p><img src="https://habrastorage.org/webt/cc/7g/yz/cc7gyzy0tc4oh5zpomvjy09endw.png"></p><br><a name="NestedDecomposition"></a><br><h2 id="vlozhennaya-dekompoziciya">  Descomposici√≥n anidada </h2><br><p>  As√≠ que ahora tenemos la interfaz <code>ToDoTask</code> y podemos hacer referencia a ella.  Del mismo modo, describiremos <a href="">ToDoTaskGroup</a> y <a href="">ToDoTaskGroupBlank</a> , y contendr√°n propiedades de los tipos <code>ToDoTask</code> y <code>ToDoTaskBlank</code> , respectivamente.  Pero ahora dividiremos el "Grupo de tareas" en dos, no en tres componentes: para mayor claridad, describiremos el delta en <a href="">ToDoGroupExtendedData</a> .  As√≠ que quiero demostrar un enfoque en el que un componente se crea a partir de los otros dos: </p><br><pre> <code class="plaintext hljs">"ToDoGroup": { "allOf": [ { "$ref": "#/components/schemas/ToDoGroupBlank" }, { "$ref": "#/components/schemas/ToDoGroupExtendedData" } ] }</code> </pre> <br><p>  Despu√©s de comenzar la generaci√≥n del c√≥digo, obtenemos una construcci√≥n TypeScript ligeramente diferente: </p><br><pre> <code class="java hljs">export type ToDoGroup = ToDoGroupBlank &amp; <span class="hljs-comment"><span class="hljs-comment">// Data needed for group creation ToDoGroupExtendedData; // Extended data has to be obtained after first save</span></span></code> </pre> <br><p>  Como <code>ToDoGroup</code> no tiene su propio "cuerpo", el generador de c√≥digo prefiri√≥ convertirlo en una uni√≥n de interfaces.  Sin embargo, si agrega la tercera parte con su propio esquema (an√≥nimo), el resultado ser√° una interfaz con dos antepasados ‚Äã‚Äã(pero es mejor no hacerlo).  Y <code>ToDoGroupBlank</code> que la propiedad de <code>items</code> de la interfaz <code>ToDoGroupBlank</code> escribe como una matriz de <code>ToDoTaskBlank</code> y se redefine en <code>ToDoGroupBlank</code> en <code>ToDoTask</code> .  Por lo tanto, el generador de c√≥digo puede transferir los matices de descomposici√≥n bastante complejos del esquema JSON a TypeScipt. </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTaskBlank } from <span class="hljs-string"><span class="hljs-string">'./to-do-task-blank'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * ## Base part of data of group * Data needed for group creation */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoGroupBlank</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... items?: Array&lt;ToDoTaskBlank&gt;; // ... }</span></span></code> </pre> <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTask } from <span class="hljs-string"><span class="hljs-string">'./to-do-task'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * ## Extended data of group * Extended data has to be obtained after first save */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoGroupExtendedData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... items: Array&lt;ToDoTask&gt;; }</span></span></code> </pre><br><p>  Bueno y, por supuesto, en <code>ToDoTask</code> / <code>ToDoTaskBlank</code> tambi√©n podemos usar la descomposici√≥n.  Es posible que haya notado que la propiedad de <code>attachments</code> se describe como una matriz de elementos de tipo <a href="">AttachmentMeta</a> .  Y este componente se describe de la siguiente manera: </p><br><pre> <code class="java hljs"><span class="hljs-string"><span class="hljs-string">"AttachmentMeta"</span></span>: { <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Common meta data model of any type of attachment"</span></span>, <span class="hljs-string"><span class="hljs-string">"oneOf"</span></span>: [ {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMetaImage"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMetaDocument"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ExternalResource"</span></span>} ] }</code> </pre> <br><p>  Es decir, este componente se refiere a otros componentes.  Como no tiene su propio esquema, el generador de c√≥digo no lo convierte en un tipo de datos separado para no multiplicar entidades, sino que convierte una descripci√≥n an√≥nima del tipo enumerado: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Any material attached to the task: may be screenshots, photos, pdf- or doc- * documents on something else */</span></span> attachments?: Array&lt; | AttachmentMetaImage <span class="hljs-comment"><span class="hljs-comment">// Meta data of image attached to task | AttachmentMetaDocument // Meta data of document attached to task | string // Link to any external resource &gt;;</span></span></code> </pre> <br><p>  Al mismo tiempo, para los componentes <code>AttachmentMetaImage</code> y <code>AttachmentMetaDocument</code> , se describen interfaces no an√≥nimas que se importan en los archivos que las utilizan: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AttachmentMetaDocument } from <span class="hljs-string"><span class="hljs-string">'./attachment-meta-document'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AttachmentMetaImage } from <span class="hljs-string"><span class="hljs-string">'./attachment-meta-image'</span></span>;</code> </pre> <br><p>  Pero incluso en <a href="">AttachmentMetaImage,</a> podemos encontrar un enlace a otra interfaz <a href="">ImageOptions</a> renderizada, que se usa dos veces, incluso dentro de una interfaz an√≥nima (el resultado de la conversi√≥n de <a href="">propiedades</a> <a href="">adicionales</a> ): </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ImageOptions } from <span class="hljs-string"><span class="hljs-string">'./image-options'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Meta data of image attached to task */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AttachmentMetaImage</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... /** * Possible thumbnails of uploaded image */ thumbs?: { [key: string]: { /** * Link to any external resource */ url?: string; imageOptions?: ImageOptions; }; }; // ... imageOptions: ImageOptions; }</span></span></code> </pre> <br><p>  Por lo tanto, en base a las <code>ToDoGroup</code> <code>ToDoTask</code> o <code>ToDoGroup</code> , en realidad integramos varias entidades y una cadena de sus conexiones comerciales en nuestro c√≥digo, lo que nos da m√°s control sobre los cambios en el sistema que van m√°s all√° de nuestro c√≥digo.  Por supuesto, esto no tiene sentido en todos los casos.  Pero si usa OpenAPI, entonces puede tener una peque√±a bonificaci√≥n m√°s, adem√°s de la documentaci√≥n real. </p><br><a name="ServiceGeneration"></a><br><h2 id="avtogeneraciya-servisov-dlya-raboty-s-rest-api">  Servicios generados autom√°ticamente para trabajar con la API REST </h2><br><a name="WhyItNeccessary"></a><br><h3 id="zachem-eto-nuzhno">  ¬øPor qu√© se necesita esto? </h3><br><p>  Si tomamos una aplicaci√≥n front-end estad√≠stica promedio que funciona con una API REST m√°s o menos compleja, una parte considerable de su c√≥digo ser√°n servicios (o simplemente funciones) para acceder a la API.  Incluir√°n: </p><br><ul><li>  Asignaciones de URL y par√°metros </li><li>  Validaci√≥n de par√°metros, solicitud y respuesta. </li><li>  Extracci√≥n de datos y manejo de emergencias </li></ul><br><p>  Es desagradable que, en muchos sentidos, esto sea t√≠pico y no contenga ninguna l√≥gica √∫nica.  Supongamos un ejemplo: como esquema general, se puede construir el trabajo con la API: </p><br><div class="spoiler">  <b class="spoiler_title">Un ejemplo esquem√°tico simplificado de trabajar con la API REST</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable, fromFetch, throwError } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { switchMap } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/operators'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Definitions const URLS = { 'getTasksOfGroup': `${env.REST_API_BASE_URL}/tasks/\${groupId}`, // ... other urls ... }; const URL_TEMPLATES = _.mapValues(urls, url =&gt; _.template(url)); interface GetTaskConditions { isDone?: true | false; offset?: number; limit?: number; } interface ErrorReponse { error: boolean; message?: string; } // Helpers // I taken this snippet from StackOverflow only for example function encodeData(data) { return Object.keys(data).map(function(key) { return [key, data[key]].map(encodeURIComponent).join("="); }).join("&amp;"); } // REST API functions // our REST API working function example function getTasksFromServer(groupUid: string, conditions: GetTaskConditions = {}): Observable&lt;Response&gt; { if (!groupUid) { return throwError(new Error('You should specify "groupUid"!')); } if (!_.isString(groupUid)) { return throwError(new Error('`groupUid` should be string!')); } if (_.isBoolean(conditions.isDone)) { // ... applying of conditions.isDone } else if (conditions.isDone !== undefined) { return throwError(new Error('`isDone` should be "true", "false" or should\'t be set!'!)); } if (offset) { // ... check of `offset` and applying or error throwing } if (limit) { // ... check of `limit` and applying or error throwing } const url = [ URL_TEMPLATES['getTasksOfGroup']({groupUid}), ...(conditions ? [encodeData(conditions)] : []) ]; return fromFetch(url); } // Using of REST API working functions function getRemainedTasks(groupUid: number): Observable&lt;ToDoTask[] | ErrorReponse&gt; { return getTasksFromServer(groupUid, {isDone: false}).pipe( switchMap(response =&gt; { if (response.ok) { // OK return data return response.json(); } else { // Server is returning a status requiring the client to try something else. return of({ error: true, message: `Error ${response.status}` }); } }), catchError(err =&gt; { // Network or other error, handle appropriately console.error(err); return of({ error: true, message: err.message }) }) ); }</span></span></code> </pre> </div></div><br><p>  Puede utilizar una abstracci√≥n de alto nivel para trabajar con REST; en funci√≥n de la pila utilizada, puede ser: <a href="https://github.com/axios/axios">Axios</a> , <a href="http">Angular HttpClient</a> o cualquier otra soluci√≥n similar.  Pero lo m√°s probable es que b√°sicamente su c√≥digo coincida con este ejemplo.  Es casi seguro que incluir√°: </p><br><ul><li>  Servicios o funciones para acceder a puntos finales espec√≠ficos (funci√≥n <code>getTasksFromServer</code> en nuestro ejemplo) </li><li>  Piezas de c√≥digo que procesan el resultado (funci√≥n <code>getRemainedTasks</code> ) </li></ul><br><p>  En una aplicaci√≥n del mundo real, este c√≥digo ser√° m√°s complicado: la especificaci√≥n de la aplicaci√≥n de demostraci√≥n <a href="">describe 5-6 opciones de respuesta</a> .  A menudo, la API REST est√° dise√±ada de tal manera que cada estado de respuesta del servidor debe manejarse en consecuencia.  Pero incluso la comprobaci√≥n de los datos de entrada tiende a ser m√°s dif√≠cil durante el desarrollo de la aplicaci√≥n: cuanto m√°s tiempo demore en admitir y procesar revisiones de errores, m√°s querr√° saber sobre los cuellos de botella en la circulaci√≥n de datos en la aplicaci√≥n. </p><br><blockquote>  Pueden producirse errores en cada nodo de acoplamiento de partes de software, cuya detecci√≥n inoportuna (as√≠ como la b√∫squeda de problemas dif√≠ciles de diagnosticar) puede ser muy costosa para las empresas.  Por lo tanto, habr√° verificaciones de aclaraciones adicionales.  A medida que crece la base del c√≥digo, y el n√∫mero de casos cubiertos, tambi√©n lo hace la complejidad de realizar cambios.  Pero el negocio es un cambio constante y no hay forma de evitarlo.  Por lo tanto, debemos preocuparnos por c√≥mo haremos cambios por adelantado. </blockquote><p>  Volviendo al tema de OpenAPI, observamos que en las especificaciones de la OEA puede haber suficiente informaci√≥n para: </p><br><ul><li>  Describa todos los puntos finales necesarios en forma de funciones o servicios. </li><li>       </li><li>   URL      </li><li>         </li></ul><br><p>         ‚Äî <strong></strong> .    ,     ,     /  ‚Äî 5, 10  200,            .  ,      ,   : , , , RxJS- <a href="">pickResponseBody</a> ,            ,     - ;  <a href="">tapResponse</a> ,    side-effect (tap)   HTTP-.     ,     -   .    ,       ,    . </p><br><blockquote> ,     ‚Äî   -,      .      ,       ,  ,   ""  /     API     "-"  "" .    -   ,        "" (    ),     . </blockquote><p>   ,          REST API   Angular.         ,      ,        /.      . ,      ,    .  ,      , ..      . </p><br><a name="HowToGenerateServices"></a><br><h3 id="generaciya-servisov">   </h3><br><p>   " <a href="https://habr.com/ru/post/483628/">  </a> "      .   Angular-,       <code>update-typings.js</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">"use strict"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliLib = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@codegena/oapi3ts-cli'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliApp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> cliLib.CliApplication; cliApp.createTypings(); cliApp.createServices(<span class="hljs-string"><span class="hljs-string">'angular'</span></span>);</code> </pre> <br><p>             ,   Angular-    API   .    , -   - ,     <a href="https://github.com/koshevy/codegena/tree/master/libs/todo-app-scheme/src/lib/services"> </a> .     ,    <a href="">RewriteGroupService</a> .    <a href="">ApiService</a> ,        ,   ,   -: </p><br><div class="spoiler"> <b class="spoiler_title">-  </b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Typings for this API method import { RewriteGroupParameters, RewriteGroupResponse, RewriteGroupRequest } from '../typings'; // Schemas import { schema as domainSchema } from './schema.b4c655ec1635af1be28bd6'; /** * Service for angular based on ApiAgent solution. * Provides assured request to API method with implicit * validation and common errors handling scheme. */ @Injectable() export class RewriteGroupService extends ApiService&lt; RewriteGroupResponse, RewriteGroupRequest, RewriteGroupParameters &gt; { protected get method(): 'PUT' { return 'PUT'; } /** * Path template, example: `/some/path/{id}`. */ protected get pathTemplate(): string { return '/group/{groupId}'; } /** * Parameters in a query. */ protected get queryParams(): string[] { return ['forceSave']; } // ... }</span></span></code> </pre> </div></div><br><p> , <a href="">   JSON Schema</a>  ,   .    <a href=""> </a> ,        ,       : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { schema as domainSchema } from <span class="hljs-string"><span class="hljs-string">'./schema.b4c655ec1635af1be28bd6'</span></span>;</code> </pre> <br><blockquote> ,     <code>schema.b4c655ec1635af1be28bd6.ts</code>       ,  <a href="">  </a>  ,  . </blockquote><br><a name="UsingOfGeneratedServices"></a><br><h3 id="ispolzovanie-generiruemyh-servisov">    </h3><br><p>       ,   Angular-. </p><br><div class="spoiler"> <b class="spoiler_title">    Angular-</b> <div class="spoiler_text"><p>      <code>ApiModule</code>       : </p><br><pre> <code class="plaintext hljs">import { ApiModule, API_ERROR_HANDLER } from '@codegena/ng-api-service'; import { CreateGroupItemService, GetGroupsService, GetGroupItemsService, UpdateFewItemsService } from '@codegena/todo-app-scheme'; @NgModule({ imports: [ ApiModule, // ... ], providers: [ RewriteGroupService, { provide: API_ERROR_HANDLER, useClass: ApiErrorHandlerService }, // ... ], // ... }) export class TodoAppModule { }</code> </pre> </div></div><br><p>    ,     [])( <a href="https://angular.io/guide/dependency-injection">https://angular.io/guide/dependency-injection</a> ): </p><br><pre> <code class="plaintext hljs">@Injectable() export class TodoTasksStore { constructor( protected createGroupItemService: CreateGroupItemService, protected getGroupsService: GetGroupsService, protected getGroupItemsService: GetGroupItemsService, protected updateFewItemsService: UpdateFewItemsService ) {} }</code> </pre> <br><p>         ‚Äî  ,       <a href="">request</a> ,        : </p><br><pre> <code class="plaintext hljs">return this.getGroupsService.request(null, { isComplete: null, withItems: false }).pipe( pickResponseBody&lt;GetGroupsResponse&lt;200&gt;&gt;(200, null, true), switchMap&lt;ToDoGroup[], Observable&lt;ComponentTruth&gt;&gt;( groups =&gt; this.loadItemsOfSelectedGroups({ ...truth, groups }) ) );</code> </pre> <br><p>  <code>request</code>   <code>Observable&lt;HttpResponse&lt;R&gt; | HttpEvent&lt;R&gt;&gt;</code> ,   ,        . ,     ,      . ,  ,      ,     .     RxJS- <code>pickResponseBody</code> . </p><br><p>  ,    ,    ,   .         API,    .        .   ,     : </p><br><p><img src="https://habrastorage.org/webt/3y/xe/dy/3yxedy51z7su99butzrk2dvunnq.png"></p><br><p>      .   JSON Schema     .       ,   ""      - .   ,      <a href="https://sentry.io/welcome/">Sentry</a>  <a href="https://www.elastic.co/products/kibana">Kibana</a> ,   .       .  ,      ,      . </p><br><blockquote>  ,             .  ,      :) </blockquote><br><a name="AfterWord"></a><br><h2 id="vmesto-poslesloviya">  En lugar de un ep√≠logo </h2><br><p>   ,       .       -,   "    "    ‚Äî   .  ,  ,   ,   . </p><br><p>     ‚Äî    ,  - /    (   ).      ,  ‚Äî   . </p><br><p>   . </p></div></div><p>Source: <a href="https://habr.com/ru/post/483628/">https://habr.com/ru/post/483628/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../483612/index.html">Conductor de Tesla multado por cepillarse los dientes mientras conduc√≠a en piloto autom√°tico</a></li>
<li><a href="../483614/index.html">M√©todos para combatir el robo en un club de rob√≥tica.</a></li>
<li><a href="../483616/index.html">Proyecto Lacmus: c√≥mo la visi√≥n por computadora ayuda a salvar a las personas perdidas</a></li>
<li><a href="../483624/index.html">Competencia de Yandex.Taxi: an√°lisis de la pista de back-end del campeonato de programaci√≥n</a></li>
<li><a href="../483626/index.html">C√≥mo describir un trabajo de 100 gitlab en 100 l√≠neas en Jsonnet</a></li>
<li><a href="../483630/index.html">The Ember Times - N√∫mero 130</a></li>
<li><a href="../483634/index.html">Propiedades de ancho / alto m√≠nimo y m√°ximo en CSS</a></li>
<li><a href="../483646/index.html">Hack The Box - Tutorial de Bitlab. Ofuscaci√≥n JS d√©bil, GIT y aplicaciones de Windows inversas</a></li>
<li><a href="../483648/index.html">Offshore para negocios de TI en Georgia: trucos y trampas para la vida</a></li>
<li><a href="../483650/index.html">Cosm√≥dromos m√°s cercanos al ecuador - Cosm√≥dromo tropical de Wenchang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>