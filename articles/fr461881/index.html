<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👏🏻 ✉️ 🚥 Guide de journalisation Node.js 🧒🏾 🧝🏼 🏟️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La première tâche la plus souvent rencontrée par les développeurs qui commencent à programmer en JavaScript est de consigner les événements dans le jo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide de journalisation Node.js</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/461881/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/o7/dd/qs/o7ddqsvqk7dz2uljo7mz4e-ox2o.png"></div><br>  La première tâche la plus souvent rencontrée par les développeurs qui commencent à programmer en JavaScript est de consigner les événements dans le journal de la console à l'aide de la méthode <code>console.log</code> .  À la recherche d'informations sur le débogage du code JavaScript, vous trouverez des centaines d'articles de blog, ainsi que des instructions sur StackOverflow, vous conseillant de «simplement» sortir des données vers la console via la méthode <code>console.log</code> .  C'est une telle pratique courante que j'ai dû introduire des règles pour le contrôle de la qualité du code, comme <code>no-console</code> , afin de ne pas laisser des entrées de journal aléatoires dans le code de production.  Mais que se passe-t-il si vous devez enregistrer spécifiquement un événement pour fournir des informations supplémentaires? <br><br>  Cet article décrit diverses situations dans lesquelles vous devez conserver des journaux;  Il montre la différence entre les méthodes <code>console.log</code> et <code>console.error</code> dans Node.js et montre comment passer la fonction de journalisation aux bibliothèques sans surcharger la console utilisateur. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/fl/st/fl/flstflpirz79u4y-4nc0ot6yroe.png"><br><br><h3>  Fondements théoriques de l'utilisation de Node.js </h3><br>  Les méthodes <code>console.log</code> et <code>console.error</code> peuvent être utilisées à la fois dans le navigateur et dans Node.js.  Cependant, lorsque vous utilisez Node.js, il y a une chose importante à retenir.  Si vous créez le code suivant dans Node.js à l'aide d'un fichier appelé <code>index.js</code> , <br><br><img src="https://habrastorage.org/webt/9d/f8/fr/9df8fr10y-luiwbcqp6kizl8-ce.png"><br><br>  puis l'exécuter dans le terminal en utilisant le <code>node index.js</code> , puis les résultats de l'exécution de la commande seront situés l'un au-dessus de l'autre: <br><br><img src="https://habrastorage.org/webt/rf/n_/wi/rfn_wioub6pircw7tcrgvmt8g4w.png"><br><br>  Malgré le fait qu'ils semblent similaires, le système les traite différemment.  Si vous regardez la section sur le fonctionnement de la <code>console</code> dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation Node.js</a> , il s'avère que <code>console.log</code> imprime le résultat via <code>stdout</code> et <code>console.error</code> imprime via <code>stderr</code> . <br><br>  Chaque processus peut fonctionner avec trois flux ( <code>stream</code> ) par défaut: <code>stdin</code> , <code>stdout</code> et <code>stderr</code> .  Le flux <code>stdin</code> traite l'entrée pour un processus, par exemple, les clics sur les boutons ou la sortie redirigée (plus de détails ci-dessous).  Le flux de sortie standard <code>stdout</code> sert à la sortie des données d'application.  Enfin, le flux d'erreurs <code>stderr</code> standard est conçu pour afficher des messages d'erreur.  Si vous avez besoin de savoir à quoi <code>stderr</code> et quand l'utiliser, lisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cet article</a> . <br><br>  En bref, il peut être utilisé pour utiliser les opérateurs de redirection ( <code>&gt;</code> ) et de pipeline ( <code>|</code> ) pour travailler avec les erreurs et les informations de diagnostic séparément des résultats réels de l'application.  Si l'opérateur <code>&gt;</code> vous permet de rediriger la sortie du résultat de la commande vers un fichier, alors en utilisant l'opérateur <code>2&gt;</code> vous pouvez rediriger la sortie du flux d'erreurs <code>stderr</code> vers un fichier.  Par exemple, cette commande envoie <i>Hello</i> dans le fichier <code>hello.log</code> et <i>Bye bye</i> dans le fichier <code>error.log</code> . <br><br><img src="https://habrastorage.org/webt/cf/xm/se/cfxmsetuf_6ohz4zqoeg_oqsojw.png"><br><br><img src="https://habrastorage.org/webt/ve/ji/i0/vejii0f6_q4zhetko-f9bg1pozy.png"><br><br><h3>  Quand dois-je écrire des événements dans le journal? </h3><br>  Maintenant que nous avons passé en revue les aspects techniques qui sous-tendent la journalisation, passons à divers scénarios dans lesquels vous devez enregistrer des événements.  En règle générale, ces scénarios se répartissent en plusieurs catégories: <br><br><ul><li>  débogage rapide en cas de comportement inattendu pendant le développement; </li><li>  journalisation par navigateur pour l'analyse et le diagnostic; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">journalisation des applications serveur</a> pour enregistrer les demandes entrantes et les erreurs possibles; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">maintenir des journaux de débogage supplémentaires pour les bibliothèques</a> pour aider les utilisateurs à résoudre les problèmes; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">journalisation pour la sortie de l'interface de ligne de commande</a> et pour afficher des messages dans la console sur la progression de l'opération, les confirmations et les erreurs. </li></ul><br>  Cet article ne traite que des trois derniers scénarios basés sur Node.js. <br><br><h3>  Journalisation des applications serveur </h3><br>  Il existe plusieurs raisons pour consigner les événements qui se produisent sur le serveur.  Par exemple, la journalisation des demandes entrantes vous permet d'obtenir des statistiques sur la fréquence à laquelle les utilisateurs rencontrent des erreurs 404, quelle pourrait en être la raison ou quelle application cliente <code>User-Agent</code> est utilisée.  Vous pouvez également connaître l'heure à laquelle l'erreur s'est produite et sa cause. <br><br>  Afin d'expérimenter avec le matériel donné dans cette partie de l'article, vous devez créer un nouveau catalogue pour le projet.  Dans le répertoire du projet, créez <code>index.js</code> pour le code à utiliser et exécutez les commandes suivantes pour démarrer le projet et installer <code>express</code> : <br><br><img src="https://habrastorage.org/webt/ma/sw/qo/maswqo4k3lr9my_vnkcmrksqxme.png"><br><br>  Nous mettons en place un serveur avec middleware, qui enregistrera chaque requête dans la console en utilisant la méthode <code>console.log</code> .  Nous mettons les lignes suivantes dans le fichier <code>index.js</code> : <br><br><img src="https://habrastorage.org/webt/pr/y5/js/pry5js_udhlcqeurmmwyld57zky.png"><br><br>  Cela utilise <code>console.log('%O', req)</code> pour journaliser l'objet entier dans le journal.  Du point de vue de la structure interne, la méthode <code>console.log</code> utilise <code>util.forma</code> t, qui, en plus de <code>%O</code> prend en charge d'autres espaces réservés.  Des informations à leur sujet peuvent être trouvées dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation Node.js.</a> <br><br>  Lors de l'exécution du <code>node index.js</code> pour démarrer le serveur et du passage à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 3000, la console affiche de nombreuses informations inutiles: <br><br><img src="https://habrastorage.org/webt/qy/c1/ta/qyc1ta1h1em_xkl0f9683zvesfe.png"><br><br>  Si vous utilisez plutôt <code>console.log('%s', req)</code> pour ne pas afficher complètement l’objet, vous n’obtiendrez pas beaucoup d’informations: <br><br><img src="https://habrastorage.org/webt/ru/ew/kz/ruewkz1ihxicigymk_oqta9s9gc.png"><br><br>  Vous pouvez écrire votre propre fonction de journalisation, qui ne produira que les données nécessaires, mais vous devez d'abord décider quelles informations sont nécessaires.  Bien que l'accent soit généralement mis sur le contenu du message, en réalité, il est souvent nécessaire d'obtenir des informations supplémentaires, notamment: <br><br><ul><li>  horodatage - pour savoir quand les événements se sont produits; </li><li>  nom de l'ordinateur / serveur - si un système distribué est en cours d'exécution; </li><li>  identificateur de processus - si plusieurs processus Node s'exécutent en utilisant, par exemple, <code>pm2</code> ; </li><li>  message - un message réel avec un certain contenu; </li><li>  trace de pile - si une erreur est enregistrée; </li><li>  variables / informations supplémentaires. </li></ul><br>  De plus, étant donné que dans tous les cas, tout est <code>stderr</code> flux <code>stdout</code> et <code>stderr</code> , il est nécessaire de conserver un journal à différents niveaux, ainsi que de configurer et de filtrer les entrées de journal en fonction du niveau. <br><br>  Cela peut être réalisé en accédant à différentes parties du <code>process</code> et en écrivant plusieurs lignes de code en JavaScript.  Cependant, Node.js est remarquable en ce qu'il possède déjà un écosystème <code>npm</code> et plusieurs bibliothèques qui peuvent être utilisées à ces fins.  Cela comprend: <br><br><ul><li>  <code>pino</code> ; </li><li>  <code>winston</code> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">roarr</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bunyan</a> (cette bibliothèque n'a pas été mise à jour depuis deux ans). </li></ul><br>  Pino est souvent préféré car il est rapide et possède son propre écosystème.  Voyons comment <code>pino</code> peut aider à la journalisation.  Un autre avantage de cette bibliothèque est le package <code>express-pino-logger</code> , qui vous permet d'enregistrer des requêtes. <br><br>  Installez <code>pino</code> et <code>express-pino-logger</code> : <br><br><img src="https://habrastorage.org/webt/nq/j_/jq/nqj_jqvxgyqqdmfgydf9740la-y.png"><br><br>  Après cela, nous mettons à jour le fichier <code>index.js</code> pour utiliser le <code>index.js</code> des événements et le middleware: <br><br><img src="https://habrastorage.org/webt/qw/ge/sq/qwgesqqth2bnxd447led_m35ud8.png"><br><br>  Dans ce fragment, nous avons créé une instance de l' <code>logger</code> événements pour <code>pino</code> et l'avons transmise à <code>express-pino-logger</code> pour créer un nouveau logiciel de journalisation d'événements multiplateforme avec lequel vous pouvez appeler <code>app.use</code> .  De plus, <code>console.log</code> remplacé dans <code>logger.info</code> par <code>logger.info</code> et <code>logger.debug</code> ajouté à l'itinéraire pour afficher différents niveaux du journal. <br><br>  Si vous redémarrez le serveur en exécutant à plusieurs reprises le <code>node index.js</code> , vous obtiendrez un résultat différent à la sortie, dans lequel chaque ligne / ligne sera sortie au format JSON.  Encore une fois, accédez à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 3000 pour voir une autre nouvelle ligne au format JSON. <br><br><img src="https://habrastorage.org/webt/tr/mh/0v/trmh0vi7-h9khu3355byqn5s-pg.png"><br><br>  Parmi les données au format JSON, vous pouvez trouver les informations mentionnées précédemment, comme un horodatage.  Notez également que le message <code>logger.debug</code> pas affiché.  Pour le rendre visible, vous devez modifier le niveau de journal par défaut.  Après avoir créé une instance de l'enregistrement d'événement de l'enregistreur, la valeur <code>process.env.LOG_LEVEL</code> été définie.  Cela signifie que vous pouvez modifier la valeur ou accepter la valeur d' <code>info</code> par défaut.  <code>LOG_LEVEL=debug node index.js</code> exécutant <code>LOG_LEVEL=debug node index.js</code> , nous modifions le niveau de journalisation. <br><br>  Avant de faire cela, il est nécessaire de résoudre le problème du format de sortie, ce qui n'est pas très pratique pour la perception pour le moment.  Cette étape est intentionnelle.  Selon la philosophie <code>pino</code> , pour des raisons de performances, il est nécessaire de transférer le traitement des écritures de journal vers un processus distinct, en passant la sortie (à l'aide de l'opérateur <code>|</code> ).  Le processus consiste à traduire la sortie dans un format plus pratique pour la perception humaine, ou à la télécharger sur le cloud.  Cette tâche est effectuée par des outils de transfert appelés <code>transports</code> .  Consultez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation de la boîte à outils</a> <code>transports</code> et voyez pourquoi les erreurs <code>pino</code> ne sont pas sorties via <code>stderr</code> . <br><br>  Pour afficher une version plus lisible du magazine, utilisez l'outil <code>pino-pretty</code> .  Exécutez dans le terminal: <br><br><img src="https://habrastorage.org/webt/yi/-b/v6/yi-bv6ct4r1zozscacob9xp5urc.png"><br><br>  Toutes les entrées de journal sont transférées à l'aide de la <code>|</code>  à la disposition de <code>pino-pretty</code> , grâce à quoi la sortie est "effacée", qui ne contiendra que des informations importantes affichées dans différentes couleurs.  Si vous interrogez à nouveau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 3000, un message de <code>debug</code> débogage doit apparaître. <br><br><img src="https://habrastorage.org/webt/_p/lb/w1/_plbw1wcxgonrmw4lsyt5ls7cka.png"><br><br>  Afin de rendre les entrées de journal plus lisibles ou de les convertir, il existe de nombreux outils de transmission.  Ils peuvent même être affichés en utilisant des emojis en utilisant <code>pino-colada</code> .  Ces outils seront utiles pour le développement local.  Lorsque le serveur est en production, il peut être nécessaire de transférer les données du journal à l'aide d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un autre outil</a> , de les écrire sur le disque à l'aide de <code>&gt;</code> pour un traitement ultérieur, ou d'effectuer deux opérations en même temps à l'aide d'une commande spécifique, par exemple <code>tee</code> . <br><br>  Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">document</a> traite également de la rotation des fichiers journaux, du filtrage et de l'écriture des données des journaux dans d'autres fichiers. <br><br><h3>  Journalisation de la bibliothèque </h3><br>  En explorant les moyens d'organiser efficacement la journalisation des applications serveur, vous pouvez utiliser la même technologie pour vos propres bibliothèques. <br><br>  Le problème est que dans le cas de la bibliothèque, vous devrez peut-être conserver un journal à des fins de débogage sans charger l'application cliente.  Au contraire, le client doit pouvoir activer le journal si le débogage est nécessaire.  Par défaut, la bibliothèque ne doit pas enregistrer la sortie, ce qui donne à l'utilisateur ce droit. <br><br>  Un bon exemple de ceci est le cadre <code>express</code> .  De nombreux processus se déroulent dans la structure interne du framework <code>express</code> , ce qui peut susciter un intérêt à l'étudier plus en profondeur lors du débogage d'application.  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation du framework</a> <code>express</code> indique que vous pouvez ajouter <code>DEBUG=express:*</code> au début de la commande comme suit: <br><br><img src="https://habrastorage.org/webt/ts/ht/a9/tshta9wjl_atyr3wrm11i11fuzu.png"><br><br>  Si vous appliquez cette commande à une application existante, vous pouvez voir beaucoup de résultats supplémentaires qui aideront au débogage: <br><br><img src="https://habrastorage.org/webt/tn/ea/pl/tneaplymuzok_eenshb-zv50oiq.png"><br><br>  Ces informations ne sont visibles que si le journal de débogage est activé.  Il existe un package de <code>debug</code> pour cela.  Il peut être utilisé pour écrire des messages dans «l'espace de noms», et si l'utilisateur de la bibliothèque inclut cet espace de noms ou un caractère générique qui lui correspond dans leur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">variable d'environnement</a> <code>DEBUG</code> , les messages seront affichés.  Vous devez d'abord installer la bibliothèque de <code>debug</code> : <br><br><img src="https://habrastorage.org/webt/gi/4h/mp/gi4hmppeawcqdpwsncu3g5rqlzs.png"><br><br>  Créez un nouveau fichier appelé <code>random-id.j</code> s qui simulera la bibliothèque et y placera le code suivant: <br><br><img src="https://habrastorage.org/webt/le/fq/cn/lefqcnt7-3nft1klqsjuugnkupa.png"><br><br>  Par conséquent, un nouvel enregistreur d'événements de <code>debug</code> sera créé avec l' <code>mylib:randomid</code> , dans lequel deux messages seront ensuite enregistrés.  Nous l'utilisons dans <code>index.js</code> de la section précédente: <br><br><img src="https://habrastorage.org/webt/bb/cj/ja/bbcjjan7ygf-9z26w8etpccfx8o.png"><br><br>  Si vous redémarrez le serveur, en ajoutant cette fois <code>DEBUG=mylib:randomid node index.js</code> , les entrées du journal de débogage de notre "bibliothèque" seront affichées: <br><br><img src="https://habrastorage.org/webt/fg/3c/8t/fg3c8tejhceciqntzcb-a1n2xd4.png"><br><br>  Si les utilisateurs de la bibliothèque souhaitent placer des informations de débogage dans les entrées du journal <code>pino</code> , ils peuvent utiliser une bibliothèque appelée <code>pino-debug</code> créée par la commande <code>pino</code> pour formater correctement ces entrées. <br><br>  Installez la bibliothèque: <br><br><img src="https://habrastorage.org/webt/wg/dh/y1/wgdhy11xkqt-e8csfhcrjcctkl8.png"><br><br>  Avant d'utiliser <code>debug</code> pour la première fois, <code>pino-debug</code> doit être initialisé.  La façon la plus simple de le faire est d'utiliser les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">drapeaux</a> <code>-r</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ou</a> <code>--require</code> pour demander un module avant d'exécuter le script.  Nous redémarrons le serveur à l'aide de la commande (à condition que <code>pino-colada</code> installé): <br><br><img src="https://habrastorage.org/webt/l-/ug/yn/l-ugyn16-kzn1hhye_zus2adfkk.png"><br><br>  Par conséquent, les entrées du journal de débogage de la bibliothèque s'affichent de la même manière que dans le journal des applications: <br><br><img src="https://habrastorage.org/webt/-y/n8/7e/-yn87ertfjgensbyew95aaz8f7y.png"><br><br><h3>  Sortie de l'interface de ligne de commande (CLI) </h3><br>  Le dernier cas décrit dans cet article est la journalisation de l'interface de ligne de commande.  De préférence, le journal qui enregistre les événements liés à la logique du programme est séparé du journal pour enregistrer les données d'interface de ligne de commande.  Pour enregistrer tous les événements liés à la logique du programme, vous devez utiliser une bibliothèque spécifique, par exemple le <code>debug</code> .  Dans ce cas, vous pouvez réutiliser la logique du programme sans être limité à un scénario à l'aide de l'interface de ligne de commande. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En créant une interface de ligne de commande à l'aide de Node.js</a> , vous pouvez ajouter différentes couleurs, des blocs de valeurs variables ou des outils de mise en forme pour donner à l'interface un aspect visuellement attrayant.  Cependant, vous devez garder à l'esprit plusieurs scénarios. <br><br>  Selon l'un d'eux, l'interface peut être utilisée dans le cadre d'un système d'intégration continue (CI), auquel cas il vaut mieux abandonner la mise en forme des couleurs et la présentation visuellement surchargée des résultats.  Certains systèmes d'intégration continue ont l'indicateur <code>CI</code> défini.  Vous pouvez vérifier que vous êtes dans un système d'intégration continue à l'aide du package <code>is-ci</code> , qui prend en charge plusieurs de ces systèmes. <br><br>  Certaines bibliothèques, telles que <code>chalk</code> , définissent des systèmes d'intégration continue et remplacent la sortie de texte en couleur vers la console.  Voyons comment cela fonctionne. <br><br>  Installez <code>chalk</code> avec la <code>install chalk</code> npm <code>install chalk</code> et créez un fichier appelé <code>cli.js</code>  Mettez les lignes suivantes dans le fichier: <br><br><img src="https://habrastorage.org/webt/6c/oa/u-/6coau-msy3lievszm36fvfaeffi.png"><br><br>  Maintenant, si vous exécutez ce script en utilisant le <code>node cli.js</code> , les résultats seront présentés en utilisant différentes couleurs: <br><br><img src="https://habrastorage.org/webt/nn/zf/rl/nnzfrlbh5jqiyoqfn-m2b3j2ff8.png"><br><br>  Mais si vous exécutez le script en utilisant <code>CI=true node cli.js</code> , la mise en forme des couleurs des textes sera annulée: <br><br><img src="https://habrastorage.org/webt/iz/fg/cs/izfgcsne498gjwybmd_3f7p9ap0.png"><br><br>  Dans un autre scénario à retenir, <code>stdout</code> fonctionne en mode terminal, c'est-à-dire  les données sont sorties vers le terminal.  Dans ce cas, les résultats peuvent être bien affichés à l'aide de <code>boxen</code> .  Sinon, la sortie sera très probablement redirigée vers un fichier ou ailleurs. <br><br>  Vous pouvez vérifier le fonctionnement des <code>stdin</code> , <code>stdout</code> ou <code>stderr</code> en mode terminal en regardant l'attribut <code>isTTY</code> du flux correspondant.  Par exemple, <code>process.stdout.isTTY</code> .  <code>TTY</code> signifie "téléscripteur" et dans ce cas est conçu spécifiquement pour le terminal. <br><br>  Les valeurs peuvent varier pour chacun des trois threads, selon la façon dont les processus Node.js ont été démarrés.  Des informations détaillées à ce sujet peuvent être trouvées dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation Node.js, dans la section «Entrée / sortie des processus»</a> . <br><br>  Voyons comment la valeur de <code>process.stdout.isTTY</code> varie dans différentes situations.  <code>cli.js</code> fichier <code>cli.js</code> pour le vérifier: <br><br><img src="https://habrastorage.org/webt/ha/qh/gl/haqhglnf6rs38hn6gxl2_ihnntw.png"><br><br>  Exécutez maintenant le <code>node cli.js</code> dans le terminal et voyez le mot <code>true</code> , après quoi le message s'affiche en police colorée: <br><br><img src="https://habrastorage.org/webt/i8/z2/gx/i8z2gxbba0zk1cm5cnk4gxzkqbq.png"><br><br>  Après cela, nous réexécutons la commande, mais redirige la sortie vers un fichier, puis affichons le contenu: <br><br><img src="https://habrastorage.org/webt/sb/8b/sf/sb8bsftkufhbufqrmj_a2fkg4jk.png"><br><br>  Cette fois, le mot <code>undefined</code> est apparu dans le terminal, suivi d'un message affiché dans une police incolore, car le flux <code>stdout</code> redirigé hors du mode terminal.  Ici, la <code>chalk</code> utilise l'outil <code>supports-color</code> , qui du point de vue de la structure interne vérifie l' <code>isTTY</code> flux correspondant. <br><br><img src="https://habrastorage.org/webt/2n/8j/bs/2n8jbshyf2a9qdqpt7ihez8hcsy.png"><br><br>  Des outils comme la <code>chalk</code> font ces choses par eux-mêmes.  Cependant, lors du développement d'une interface de ligne de commande, vous devez toujours être conscient des situations où l'interface fonctionne dans un système d'intégration continue ou la sortie est redirigée.  Ces outils vous aident à utiliser l'interface de ligne de commande à un niveau supérieur.  Par exemple, les données dans le terminal peuvent être organisées de manière plus structurée et si <code>isTTY</code> n'est <code>undefined</code> , passez à une méthode d'analyse plus simple. <br><br><h3>  Conclusion </h3><br>  Commencer à utiliser JavaScript et entrer la première ligne dans le journal de la console à l'aide de <code>console.log</code> assez simple.  Mais avant de déployer le code en production, vous devez considérer plusieurs aspects de l'utilisation du journal.  Cet article n'est qu'une introduction aux différentes méthodes et solutions utilisées pour organiser le journal des événements.  Il ne contient pas tout ce que vous devez savoir.  Par conséquent, il est recommandé de prêter attention aux projets open source réussis et de surveiller comment ils ont résolu le problème de journalisation et quels outils sont utilisés.  Et maintenant, essayez de vous connecter sans générer de données sur la console. <br><br><div style="text-align:center;"><img src="https://s3.amazonaws.com/com.twilio.prod.twilio-docs/original_images/mDf8ceyn8JviZCtuUmtELF8nB0-JFgfvtuRqE6kGRq_9OBdN54bcmQNMKDJ_YdFPOuqO5T_pSHHKV4"></div><br><br>  Si vous connaissez d'autres outils qui méritent d'être mentionnés, écrivez-les dans les commentaires. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461881/">https://habr.com/ru/post/fr461881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461871/index.html">101 conseils pour devenir un bon programmeur (et humain)</a></li>
<li><a href="../fr461873/index.html">ViewPager 2 - nouvelle fonctionnalité dans l'ancien wrapper</a></li>
<li><a href="../fr461875/index.html">5 nm vs 3 nm</a></li>
<li><a href="../fr461877/index.html">Java vs Kotlin pour Android: avis des développeurs</a></li>
<li><a href="../fr461879/index.html">Le livre "Linux en action"</a></li>
<li><a href="../fr461885/index.html">EDS est un autre type de fraude</a></li>
<li><a href="../fr461887/index.html">Entrée dans Aeronet Episode 2: Homing Drone</a></li>
<li><a href="../fr461891/index.html">Comment nous nous sommes fait des amis dans l'infrastructure bancaire à l'aide de ManageIQ</a></li>
<li><a href="../fr461895/index.html">Apprenez en voyage - comment nous avons conduit lors de la première journée européenne de l'analyse commerciale</a></li>
<li><a href="../fr461897/index.html">Comment nous maintenons la stabilité de l'application Lamoda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>