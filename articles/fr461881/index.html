<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëèüèª ‚úâÔ∏è üö• Guide de journalisation Node.js üßíüèæ üßùüèº üèüÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La premi√®re t√¢che la plus souvent rencontr√©e par les d√©veloppeurs qui commencent √† programmer en JavaScript est de consigner les √©v√©nements dans le jo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide de journalisation Node.js</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/461881/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/o7/dd/qs/o7ddqsvqk7dz2uljo7mz4e-ox2o.png"></div><br>  La premi√®re t√¢che la plus souvent rencontr√©e par les d√©veloppeurs qui commencent √† programmer en JavaScript est de consigner les √©v√©nements dans le journal de la console √† l'aide de la m√©thode <code>console.log</code> .  √Ä la recherche d'informations sur le d√©bogage du code JavaScript, vous trouverez des centaines d'articles de blog, ainsi que des instructions sur StackOverflow, vous conseillant de ¬´simplement¬ª sortir des donn√©es vers la console via la m√©thode <code>console.log</code> .  C'est une telle pratique courante que j'ai d√ª introduire des r√®gles pour le contr√¥le de la qualit√© du code, comme <code>no-console</code> , afin de ne pas laisser des entr√©es de journal al√©atoires dans le code de production.  Mais que se passe-t-il si vous devez enregistrer sp√©cifiquement un √©v√©nement pour fournir des informations suppl√©mentaires? <br><br>  Cet article d√©crit diverses situations dans lesquelles vous devez conserver des journaux;  Il montre la diff√©rence entre les m√©thodes <code>console.log</code> et <code>console.error</code> dans Node.js et montre comment passer la fonction de journalisation aux biblioth√®ques sans surcharger la console utilisateur. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/fl/st/fl/flstflpirz79u4y-4nc0ot6yroe.png"><br><br><h3>  Fondements th√©oriques de l'utilisation de Node.js </h3><br>  Les m√©thodes <code>console.log</code> et <code>console.error</code> peuvent √™tre utilis√©es √† la fois dans le navigateur et dans Node.js.  Cependant, lorsque vous utilisez Node.js, il y a une chose importante √† retenir.  Si vous cr√©ez le code suivant dans Node.js √† l'aide d'un fichier appel√© <code>index.js</code> , <br><br><img src="https://habrastorage.org/webt/9d/f8/fr/9df8fr10y-luiwbcqp6kizl8-ce.png"><br><br>  puis l'ex√©cuter dans le terminal en utilisant le <code>node index.js</code> , puis les r√©sultats de l'ex√©cution de la commande seront situ√©s l'un au-dessus de l'autre: <br><br><img src="https://habrastorage.org/webt/rf/n_/wi/rfn_wioub6pircw7tcrgvmt8g4w.png"><br><br>  Malgr√© le fait qu'ils semblent similaires, le syst√®me les traite diff√©remment.  Si vous regardez la section sur le fonctionnement de la <code>console</code> dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation Node.js</a> , il s'av√®re que <code>console.log</code> imprime le r√©sultat via <code>stdout</code> et <code>console.error</code> imprime via <code>stderr</code> . <br><br>  Chaque processus peut fonctionner avec trois flux ( <code>stream</code> ) par d√©faut: <code>stdin</code> , <code>stdout</code> et <code>stderr</code> .  Le flux <code>stdin</code> traite l'entr√©e pour un processus, par exemple, les clics sur les boutons ou la sortie redirig√©e (plus de d√©tails ci-dessous).  Le flux de sortie standard <code>stdout</code> sert √† la sortie des donn√©es d'application.  Enfin, le flux d'erreurs <code>stderr</code> standard est con√ßu pour afficher des messages d'erreur.  Si vous avez besoin de savoir √† quoi <code>stderr</code> et quand l'utiliser, lisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cet article</a> . <br><br>  En bref, il peut √™tre utilis√© pour utiliser les op√©rateurs de redirection ( <code>&gt;</code> ) et de pipeline ( <code>|</code> ) pour travailler avec les erreurs et les informations de diagnostic s√©par√©ment des r√©sultats r√©els de l'application.  Si l'op√©rateur <code>&gt;</code> vous permet de rediriger la sortie du r√©sultat de la commande vers un fichier, alors en utilisant l'op√©rateur <code>2&gt;</code> vous pouvez rediriger la sortie du flux d'erreurs <code>stderr</code> vers un fichier.  Par exemple, cette commande envoie <i>Hello</i> dans le fichier <code>hello.log</code> et <i>Bye bye</i> dans le fichier <code>error.log</code> . <br><br><img src="https://habrastorage.org/webt/cf/xm/se/cfxmsetuf_6ohz4zqoeg_oqsojw.png"><br><br><img src="https://habrastorage.org/webt/ve/ji/i0/vejii0f6_q4zhetko-f9bg1pozy.png"><br><br><h3>  Quand dois-je √©crire des √©v√©nements dans le journal? </h3><br>  Maintenant que nous avons pass√© en revue les aspects techniques qui sous-tendent la journalisation, passons √† divers sc√©narios dans lesquels vous devez enregistrer des √©v√©nements.  En r√®gle g√©n√©rale, ces sc√©narios se r√©partissent en plusieurs cat√©gories: <br><br><ul><li>  d√©bogage rapide en cas de comportement inattendu pendant le d√©veloppement; </li><li>  journalisation par navigateur pour l'analyse et le diagnostic; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">journalisation des applications serveur</a> pour enregistrer les demandes entrantes et les erreurs possibles; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">maintenir des journaux de d√©bogage suppl√©mentaires pour les biblioth√®ques</a> pour aider les utilisateurs √† r√©soudre les probl√®mes; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">journalisation pour la sortie de l'interface de ligne de commande</a> et pour afficher des messages dans la console sur la progression de l'op√©ration, les confirmations et les erreurs. </li></ul><br>  Cet article ne traite que des trois derniers sc√©narios bas√©s sur Node.js. <br><br><h3>  Journalisation des applications serveur </h3><br>  Il existe plusieurs raisons pour consigner les √©v√©nements qui se produisent sur le serveur.  Par exemple, la journalisation des demandes entrantes vous permet d'obtenir des statistiques sur la fr√©quence √† laquelle les utilisateurs rencontrent des erreurs 404, quelle pourrait en √™tre la raison ou quelle application cliente <code>User-Agent</code> est utilis√©e.  Vous pouvez √©galement conna√Ætre l'heure √† laquelle l'erreur s'est produite et sa cause. <br><br>  Afin d'exp√©rimenter avec le mat√©riel donn√© dans cette partie de l'article, vous devez cr√©er un nouveau catalogue pour le projet.  Dans le r√©pertoire du projet, cr√©ez <code>index.js</code> pour le code √† utiliser et ex√©cutez les commandes suivantes pour d√©marrer le projet et installer <code>express</code> : <br><br><img src="https://habrastorage.org/webt/ma/sw/qo/maswqo4k3lr9my_vnkcmrksqxme.png"><br><br>  Nous mettons en place un serveur avec middleware, qui enregistrera chaque requ√™te dans la console en utilisant la m√©thode <code>console.log</code> .  Nous mettons les lignes suivantes dans le fichier <code>index.js</code> : <br><br><img src="https://habrastorage.org/webt/pr/y5/js/pry5js_udhlcqeurmmwyld57zky.png"><br><br>  Cela utilise <code>console.log('%O', req)</code> pour journaliser l'objet entier dans le journal.  Du point de vue de la structure interne, la m√©thode <code>console.log</code> utilise <code>util.forma</code> t, qui, en plus de <code>%O</code> prend en charge d'autres espaces r√©serv√©s.  Des informations √† leur sujet peuvent √™tre trouv√©es dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation Node.js.</a> <br><br>  Lors de l'ex√©cution du <code>node index.js</code> pour d√©marrer le serveur et du passage √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 3000, la console affiche de nombreuses informations inutiles: <br><br><img src="https://habrastorage.org/webt/qy/c1/ta/qyc1ta1h1em_xkl0f9683zvesfe.png"><br><br>  Si vous utilisez plut√¥t <code>console.log('%s', req)</code> pour ne pas afficher compl√®tement l‚Äôobjet, vous n‚Äôobtiendrez pas beaucoup d‚Äôinformations: <br><br><img src="https://habrastorage.org/webt/ru/ew/kz/ruewkz1ihxicigymk_oqta9s9gc.png"><br><br>  Vous pouvez √©crire votre propre fonction de journalisation, qui ne produira que les donn√©es n√©cessaires, mais vous devez d'abord d√©cider quelles informations sont n√©cessaires.  Bien que l'accent soit g√©n√©ralement mis sur le contenu du message, en r√©alit√©, il est souvent n√©cessaire d'obtenir des informations suppl√©mentaires, notamment: <br><br><ul><li>  horodatage - pour savoir quand les √©v√©nements se sont produits; </li><li>  nom de l'ordinateur / serveur - si un syst√®me distribu√© est en cours d'ex√©cution; </li><li>  identificateur de processus - si plusieurs processus Node s'ex√©cutent en utilisant, par exemple, <code>pm2</code> ; </li><li>  message - un message r√©el avec un certain contenu; </li><li>  trace de pile - si une erreur est enregistr√©e; </li><li>  variables / informations suppl√©mentaires. </li></ul><br>  De plus, √©tant donn√© que dans tous les cas, tout est <code>stderr</code> flux <code>stdout</code> et <code>stderr</code> , il est n√©cessaire de conserver un journal √† diff√©rents niveaux, ainsi que de configurer et de filtrer les entr√©es de journal en fonction du niveau. <br><br>  Cela peut √™tre r√©alis√© en acc√©dant √† diff√©rentes parties du <code>process</code> et en √©crivant plusieurs lignes de code en JavaScript.  Cependant, Node.js est remarquable en ce qu'il poss√®de d√©j√† un √©cosyst√®me <code>npm</code> et plusieurs biblioth√®ques qui peuvent √™tre utilis√©es √† ces fins.  Cela comprend: <br><br><ul><li>  <code>pino</code> ; </li><li>  <code>winston</code> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">roarr</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bunyan</a> (cette biblioth√®que n'a pas √©t√© mise √† jour depuis deux ans). </li></ul><br>  Pino est souvent pr√©f√©r√© car il est rapide et poss√®de son propre √©cosyst√®me.  Voyons comment <code>pino</code> peut aider √† la journalisation.  Un autre avantage de cette biblioth√®que est le package <code>express-pino-logger</code> , qui vous permet d'enregistrer des requ√™tes. <br><br>  Installez <code>pino</code> et <code>express-pino-logger</code> : <br><br><img src="https://habrastorage.org/webt/nq/j_/jq/nqj_jqvxgyqqdmfgydf9740la-y.png"><br><br>  Apr√®s cela, nous mettons √† jour le fichier <code>index.js</code> pour utiliser le <code>index.js</code> des √©v√©nements et le middleware: <br><br><img src="https://habrastorage.org/webt/qw/ge/sq/qwgesqqth2bnxd447led_m35ud8.png"><br><br>  Dans ce fragment, nous avons cr√©√© une instance de l' <code>logger</code> √©v√©nements pour <code>pino</code> et l'avons transmise √† <code>express-pino-logger</code> pour cr√©er un nouveau logiciel de journalisation d'√©v√©nements multiplateforme avec lequel vous pouvez appeler <code>app.use</code> .  De plus, <code>console.log</code> remplac√© dans <code>logger.info</code> par <code>logger.info</code> et <code>logger.debug</code> ajout√© √† l'itin√©raire pour afficher diff√©rents niveaux du journal. <br><br>  Si vous red√©marrez le serveur en ex√©cutant √† plusieurs reprises le <code>node index.js</code> , vous obtiendrez un r√©sultat diff√©rent √† la sortie, dans lequel chaque ligne / ligne sera sortie au format JSON.  Encore une fois, acc√©dez √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 3000 pour voir une autre nouvelle ligne au format JSON. <br><br><img src="https://habrastorage.org/webt/tr/mh/0v/trmh0vi7-h9khu3355byqn5s-pg.png"><br><br>  Parmi les donn√©es au format JSON, vous pouvez trouver les informations mentionn√©es pr√©c√©demment, comme un horodatage.  Notez √©galement que le message <code>logger.debug</code> pas affich√©.  Pour le rendre visible, vous devez modifier le niveau de journal par d√©faut.  Apr√®s avoir cr√©√© une instance de l'enregistrement d'√©v√©nement de l'enregistreur, la valeur <code>process.env.LOG_LEVEL</code> √©t√© d√©finie.  Cela signifie que vous pouvez modifier la valeur ou accepter la valeur d' <code>info</code> par d√©faut.  <code>LOG_LEVEL=debug node index.js</code> ex√©cutant <code>LOG_LEVEL=debug node index.js</code> , nous modifions le niveau de journalisation. <br><br>  Avant de faire cela, il est n√©cessaire de r√©soudre le probl√®me du format de sortie, ce qui n'est pas tr√®s pratique pour la perception pour le moment.  Cette √©tape est intentionnelle.  Selon la philosophie <code>pino</code> , pour des raisons de performances, il est n√©cessaire de transf√©rer le traitement des √©critures de journal vers un processus distinct, en passant la sortie (√† l'aide de l'op√©rateur <code>|</code> ).  Le processus consiste √† traduire la sortie dans un format plus pratique pour la perception humaine, ou √† la t√©l√©charger sur le cloud.  Cette t√¢che est effectu√©e par des outils de transfert appel√©s <code>transports</code> .  Consultez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation de la bo√Æte √† outils</a> <code>transports</code> et voyez pourquoi les erreurs <code>pino</code> ne sont pas sorties via <code>stderr</code> . <br><br>  Pour afficher une version plus lisible du magazine, utilisez l'outil <code>pino-pretty</code> .  Ex√©cutez dans le terminal: <br><br><img src="https://habrastorage.org/webt/yi/-b/v6/yi-bv6ct4r1zozscacob9xp5urc.png"><br><br>  Toutes les entr√©es de journal sont transf√©r√©es √† l'aide de la <code>|</code>  √† la disposition de <code>pino-pretty</code> , gr√¢ce √† quoi la sortie est "effac√©e", qui ne contiendra que des informations importantes affich√©es dans diff√©rentes couleurs.  Si vous interrogez √† nouveau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">localhost</a> : 3000, un message de <code>debug</code> d√©bogage doit appara√Ætre. <br><br><img src="https://habrastorage.org/webt/_p/lb/w1/_plbw1wcxgonrmw4lsyt5ls7cka.png"><br><br>  Afin de rendre les entr√©es de journal plus lisibles ou de les convertir, il existe de nombreux outils de transmission.  Ils peuvent m√™me √™tre affich√©s en utilisant des emojis en utilisant <code>pino-colada</code> .  Ces outils seront utiles pour le d√©veloppement local.  Lorsque le serveur est en production, il peut √™tre n√©cessaire de transf√©rer les donn√©es du journal √† l'aide d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un autre outil</a> , de les √©crire sur le disque √† l'aide de <code>&gt;</code> pour un traitement ult√©rieur, ou d'effectuer deux op√©rations en m√™me temps √† l'aide d'une commande sp√©cifique, par exemple <code>tee</code> . <br><br>  Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">document</a> traite √©galement de la rotation des fichiers journaux, du filtrage et de l'√©criture des donn√©es des journaux dans d'autres fichiers. <br><br><h3>  Journalisation de la biblioth√®que </h3><br>  En explorant les moyens d'organiser efficacement la journalisation des applications serveur, vous pouvez utiliser la m√™me technologie pour vos propres biblioth√®ques. <br><br>  Le probl√®me est que dans le cas de la biblioth√®que, vous devrez peut-√™tre conserver un journal √† des fins de d√©bogage sans charger l'application cliente.  Au contraire, le client doit pouvoir activer le journal si le d√©bogage est n√©cessaire.  Par d√©faut, la biblioth√®que ne doit pas enregistrer la sortie, ce qui donne √† l'utilisateur ce droit. <br><br>  Un bon exemple de ceci est le cadre <code>express</code> .  De nombreux processus se d√©roulent dans la structure interne du framework <code>express</code> , ce qui peut susciter un int√©r√™t √† l'√©tudier plus en profondeur lors du d√©bogage d'application.  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation du framework</a> <code>express</code> indique que vous pouvez ajouter <code>DEBUG=express:*</code> au d√©but de la commande comme suit: <br><br><img src="https://habrastorage.org/webt/ts/ht/a9/tshta9wjl_atyr3wrm11i11fuzu.png"><br><br>  Si vous appliquez cette commande √† une application existante, vous pouvez voir beaucoup de r√©sultats suppl√©mentaires qui aideront au d√©bogage: <br><br><img src="https://habrastorage.org/webt/tn/ea/pl/tneaplymuzok_eenshb-zv50oiq.png"><br><br>  Ces informations ne sont visibles que si le journal de d√©bogage est activ√©.  Il existe un package de <code>debug</code> pour cela.  Il peut √™tre utilis√© pour √©crire des messages dans ¬´l'espace de noms¬ª, et si l'utilisateur de la biblioth√®que inclut cet espace de noms ou un caract√®re g√©n√©rique qui lui correspond dans leur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">variable d'environnement</a> <code>DEBUG</code> , les messages seront affich√©s.  Vous devez d'abord installer la biblioth√®que de <code>debug</code> : <br><br><img src="https://habrastorage.org/webt/gi/4h/mp/gi4hmppeawcqdpwsncu3g5rqlzs.png"><br><br>  Cr√©ez un nouveau fichier appel√© <code>random-id.j</code> s qui simulera la biblioth√®que et y placera le code suivant: <br><br><img src="https://habrastorage.org/webt/le/fq/cn/lefqcnt7-3nft1klqsjuugnkupa.png"><br><br>  Par cons√©quent, un nouvel enregistreur d'√©v√©nements de <code>debug</code> sera cr√©√© avec l' <code>mylib:randomid</code> , dans lequel deux messages seront ensuite enregistr√©s.  Nous l'utilisons dans <code>index.js</code> de la section pr√©c√©dente: <br><br><img src="https://habrastorage.org/webt/bb/cj/ja/bbcjjan7ygf-9z26w8etpccfx8o.png"><br><br>  Si vous red√©marrez le serveur, en ajoutant cette fois <code>DEBUG=mylib:randomid node index.js</code> , les entr√©es du journal de d√©bogage de notre "biblioth√®que" seront affich√©es: <br><br><img src="https://habrastorage.org/webt/fg/3c/8t/fg3c8tejhceciqntzcb-a1n2xd4.png"><br><br>  Si les utilisateurs de la biblioth√®que souhaitent placer des informations de d√©bogage dans les entr√©es du journal <code>pino</code> , ils peuvent utiliser une biblioth√®que appel√©e <code>pino-debug</code> cr√©√©e par la commande <code>pino</code> pour formater correctement ces entr√©es. <br><br>  Installez la biblioth√®que: <br><br><img src="https://habrastorage.org/webt/wg/dh/y1/wgdhy11xkqt-e8csfhcrjcctkl8.png"><br><br>  Avant d'utiliser <code>debug</code> pour la premi√®re fois, <code>pino-debug</code> doit √™tre initialis√©.  La fa√ßon la plus simple de le faire est d'utiliser les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">drapeaux</a> <code>-r</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ou</a> <code>--require</code> pour demander un module avant d'ex√©cuter le script.  Nous red√©marrons le serveur √† l'aide de la commande (√† condition que <code>pino-colada</code> install√©): <br><br><img src="https://habrastorage.org/webt/l-/ug/yn/l-ugyn16-kzn1hhye_zus2adfkk.png"><br><br>  Par cons√©quent, les entr√©es du journal de d√©bogage de la biblioth√®que s'affichent de la m√™me mani√®re que dans le journal des applications: <br><br><img src="https://habrastorage.org/webt/-y/n8/7e/-yn87ertfjgensbyew95aaz8f7y.png"><br><br><h3>  Sortie de l'interface de ligne de commande (CLI) </h3><br>  Le dernier cas d√©crit dans cet article est la journalisation de l'interface de ligne de commande.  De pr√©f√©rence, le journal qui enregistre les √©v√©nements li√©s √† la logique du programme est s√©par√© du journal pour enregistrer les donn√©es d'interface de ligne de commande.  Pour enregistrer tous les √©v√©nements li√©s √† la logique du programme, vous devez utiliser une biblioth√®que sp√©cifique, par exemple le <code>debug</code> .  Dans ce cas, vous pouvez r√©utiliser la logique du programme sans √™tre limit√© √† un sc√©nario √† l'aide de l'interface de ligne de commande. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En cr√©ant une interface de ligne de commande √† l'aide de Node.js</a> , vous pouvez ajouter diff√©rentes couleurs, des blocs de valeurs variables ou des outils de mise en forme pour donner √† l'interface un aspect visuellement attrayant.  Cependant, vous devez garder √† l'esprit plusieurs sc√©narios. <br><br>  Selon l'un d'eux, l'interface peut √™tre utilis√©e dans le cadre d'un syst√®me d'int√©gration continue (CI), auquel cas il vaut mieux abandonner la mise en forme des couleurs et la pr√©sentation visuellement surcharg√©e des r√©sultats.  Certains syst√®mes d'int√©gration continue ont l'indicateur <code>CI</code> d√©fini.  Vous pouvez v√©rifier que vous √™tes dans un syst√®me d'int√©gration continue √† l'aide du package <code>is-ci</code> , qui prend en charge plusieurs de ces syst√®mes. <br><br>  Certaines biblioth√®ques, telles que <code>chalk</code> , d√©finissent des syst√®mes d'int√©gration continue et remplacent la sortie de texte en couleur vers la console.  Voyons comment cela fonctionne. <br><br>  Installez <code>chalk</code> avec la <code>install chalk</code> npm <code>install chalk</code> et cr√©ez un fichier appel√© <code>cli.js</code>  Mettez les lignes suivantes dans le fichier: <br><br><img src="https://habrastorage.org/webt/6c/oa/u-/6coau-msy3lievszm36fvfaeffi.png"><br><br>  Maintenant, si vous ex√©cutez ce script en utilisant le <code>node cli.js</code> , les r√©sultats seront pr√©sent√©s en utilisant diff√©rentes couleurs: <br><br><img src="https://habrastorage.org/webt/nn/zf/rl/nnzfrlbh5jqiyoqfn-m2b3j2ff8.png"><br><br>  Mais si vous ex√©cutez le script en utilisant <code>CI=true node cli.js</code> , la mise en forme des couleurs des textes sera annul√©e: <br><br><img src="https://habrastorage.org/webt/iz/fg/cs/izfgcsne498gjwybmd_3f7p9ap0.png"><br><br>  Dans un autre sc√©nario √† retenir, <code>stdout</code> fonctionne en mode terminal, c'est-√†-dire  les donn√©es sont sorties vers le terminal.  Dans ce cas, les r√©sultats peuvent √™tre bien affich√©s √† l'aide de <code>boxen</code> .  Sinon, la sortie sera tr√®s probablement redirig√©e vers un fichier ou ailleurs. <br><br>  Vous pouvez v√©rifier le fonctionnement des <code>stdin</code> , <code>stdout</code> ou <code>stderr</code> en mode terminal en regardant l'attribut <code>isTTY</code> du flux correspondant.  Par exemple, <code>process.stdout.isTTY</code> .  <code>TTY</code> signifie "t√©l√©scripteur" et dans ce cas est con√ßu sp√©cifiquement pour le terminal. <br><br>  Les valeurs peuvent varier pour chacun des trois threads, selon la fa√ßon dont les processus Node.js ont √©t√© d√©marr√©s.  Des informations d√©taill√©es √† ce sujet peuvent √™tre trouv√©es dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation Node.js, dans la section ¬´Entr√©e / sortie des processus¬ª</a> . <br><br>  Voyons comment la valeur de <code>process.stdout.isTTY</code> varie dans diff√©rentes situations.  <code>cli.js</code> fichier <code>cli.js</code> pour le v√©rifier: <br><br><img src="https://habrastorage.org/webt/ha/qh/gl/haqhglnf6rs38hn6gxl2_ihnntw.png"><br><br>  Ex√©cutez maintenant le <code>node cli.js</code> dans le terminal et voyez le mot <code>true</code> , apr√®s quoi le message s'affiche en police color√©e: <br><br><img src="https://habrastorage.org/webt/i8/z2/gx/i8z2gxbba0zk1cm5cnk4gxzkqbq.png"><br><br>  Apr√®s cela, nous r√©ex√©cutons la commande, mais redirige la sortie vers un fichier, puis affichons le contenu: <br><br><img src="https://habrastorage.org/webt/sb/8b/sf/sb8bsftkufhbufqrmj_a2fkg4jk.png"><br><br>  Cette fois, le mot <code>undefined</code> est apparu dans le terminal, suivi d'un message affich√© dans une police incolore, car le flux <code>stdout</code> redirig√© hors du mode terminal.  Ici, la <code>chalk</code> utilise l'outil <code>supports-color</code> , qui du point de vue de la structure interne v√©rifie l' <code>isTTY</code> flux correspondant. <br><br><img src="https://habrastorage.org/webt/2n/8j/bs/2n8jbshyf2a9qdqpt7ihez8hcsy.png"><br><br>  Des outils comme la <code>chalk</code> font ces choses par eux-m√™mes.  Cependant, lors du d√©veloppement d'une interface de ligne de commande, vous devez toujours √™tre conscient des situations o√π l'interface fonctionne dans un syst√®me d'int√©gration continue ou la sortie est redirig√©e.  Ces outils vous aident √† utiliser l'interface de ligne de commande √† un niveau sup√©rieur.  Par exemple, les donn√©es dans le terminal peuvent √™tre organis√©es de mani√®re plus structur√©e et si <code>isTTY</code> n'est <code>undefined</code> , passez √† une m√©thode d'analyse plus simple. <br><br><h3>  Conclusion </h3><br>  Commencer √† utiliser JavaScript et entrer la premi√®re ligne dans le journal de la console √† l'aide de <code>console.log</code> assez simple.  Mais avant de d√©ployer le code en production, vous devez consid√©rer plusieurs aspects de l'utilisation du journal.  Cet article n'est qu'une introduction aux diff√©rentes m√©thodes et solutions utilis√©es pour organiser le journal des √©v√©nements.  Il ne contient pas tout ce que vous devez savoir.  Par cons√©quent, il est recommand√© de pr√™ter attention aux projets open source r√©ussis et de surveiller comment ils ont r√©solu le probl√®me de journalisation et quels outils sont utilis√©s.  Et maintenant, essayez de vous connecter sans g√©n√©rer de donn√©es sur la console. <br><br><div style="text-align:center;"><img src="https://s3.amazonaws.com/com.twilio.prod.twilio-docs/original_images/mDf8ceyn8JviZCtuUmtELF8nB0-JFgfvtuRqE6kGRq_9OBdN54bcmQNMKDJ_YdFPOuqO5T_pSHHKV4"></div><br><br>  Si vous connaissez d'autres outils qui m√©ritent d'√™tre mentionn√©s, √©crivez-les dans les commentaires. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461881/">https://habr.com/ru/post/fr461881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461871/index.html">101 conseils pour devenir un bon programmeur (et humain)</a></li>
<li><a href="../fr461873/index.html">ViewPager 2 - nouvelle fonctionnalit√© dans l'ancien wrapper</a></li>
<li><a href="../fr461875/index.html">5 nm vs 3 nm</a></li>
<li><a href="../fr461877/index.html">Java vs Kotlin pour Android: avis des d√©veloppeurs</a></li>
<li><a href="../fr461879/index.html">Le livre "Linux en action"</a></li>
<li><a href="../fr461885/index.html">EDS est un autre type de fraude</a></li>
<li><a href="../fr461887/index.html">Entr√©e dans Aeronet Episode 2: Homing Drone</a></li>
<li><a href="../fr461891/index.html">Comment nous nous sommes fait des amis dans l'infrastructure bancaire √† l'aide de ManageIQ</a></li>
<li><a href="../fr461895/index.html">Apprenez en voyage - comment nous avons conduit lors de la premi√®re journ√©e europ√©enne de l'analyse commerciale</a></li>
<li><a href="../fr461897/index.html">Comment nous maintenons la stabilit√© de l'application Lamoda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>