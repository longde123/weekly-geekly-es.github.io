<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤘🏼 🐧 👆🏾 Système d'arbitrage pour débutants, partie 1 🙆🏻 ⛹🏼 👩🏼‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a environ 7 ans, j'avais de l'expérience en écrivant un terminal pour la Bourse de Moscou. Une partie de l'équipe aimait le trading algorithmique...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Système d'arbitrage pour débutants, partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436062/">  Il y a environ 7 ans, j'avais de l'expérience en écrivant un terminal pour la Bourse de Moscou.  Une partie de l'équipe aimait le trading algorithmique, moi y compris.  Cependant, il n'a jamais perçu cette entreprise comme une véritable source de revenus, bien que cela n'ait guère réussi.  Il est clair que pour concurrencer les banques et divers fonds, avec leurs équipes de mathématiciens et de programmeurs, il est difficile et plus facile à mettre en œuvre dans d'autres domaines. <br><br>  Maintenant que les crypto-monnaies sont entendues, un grand nombre d'échanges sont apparus.  Partant de l'hypothèse qu'il est possible de gagner de l'argent sur la différence de taux de change sur différents échanges, j'ai décidé d'étudier la possibilité de créer un robot d'arbitrage.  Mais en gros, pour commencer à apprendre python avec un vrai exemple.  Commençons donc. <br><a name="habracut"></a><br>  Tout d'abord, il est nécessaire de détecter les paires de devises pour lesquelles un arbitrage est possible.  Nous avons besoin de paires qui, en première approximation, se négocient activement, et les prix sur différents échanges divergent et convergent. <br><br>  D'un côté, le plan de travail devrait être comme ceci: <br><br><ul><li>  Création d'une base de données où les prix des paires de devises seront stockés. </li><li>  Un serveur qui enregistrera les données dans la base de données. </li><li>  Analyse primaire. </li></ul><br>  Les sources sont disponibles sur <a href="">arb_analysis</a> . <br><br><h3>  Création de base de données </h3><br>  Pour stocker des données, vous avez besoin de 3 tables. <br><br>  Ce tableau stockera une liste d'échanges. <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`exchange`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM;</code> </pre> <br>  Liste des paires de crypto-monnaies. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`market`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`id_exchange`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> id_exchange <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> market (id_exchange);</code> </pre><br>  Un tableau avec les transactions, les informations seront également stockées ici, selon les données du verre de la bourse. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`ticker`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`id_market`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`local_time`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`timestamp`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`last`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`low`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`high`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`bid`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`ask`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>), PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> id_market <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ticker (id_market);</code> </pre><br><h3>  Obtention des données des échanges </h3><br>  Pour un accès pratique aux échanges, il existe un projet open source ccxt.  A l'aide duquel il est possible de postuler à différents échanges dans un même style.  Cependant, il s'est avéré que tout n'était pas si rose, pour un certain nombre d'échanges, des informations n'ont pas pu être obtenues et certaines méthodes n'ont pas fonctionné. <br><br>  Dans le fichier create_markets.py, l'initialisation a lieu, nous obtenons une liste de paires de crypto-monnaie, par échange.  Dans ce cas, la méthode load_markets () est utilisée, qui renvoie une liste de paires pour l'échange. <br><br><pre> <code class="python hljs">name_exchange = [<span class="hljs-string"><span class="hljs-string">"acx"</span></span>, <span class="hljs-string"><span class="hljs-string">"binance"</span></span>, <span class="hljs-string"><span class="hljs-string">"bitfinex"</span></span>, <span class="hljs-string"><span class="hljs-string">"bitfinex2"</span></span>, <span class="hljs-string"><span class="hljs-string">"wex"</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_exchange_and_market_in_db</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> exchanges = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> name_exchange: exchange = getattr(ccxt, id) exchanges[id] = exchange() id_exchage = db_helper.insert_exchage_to_db(exchanges[id],cnx,cursor) markets = exchanges[id].load_markets() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> mark <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> markets: id_market = db_helper.insert_market_to_db( id_exchage, mark, cnx,cursor)</code> </pre><br>  Ensuite, dans le fichier ex_data_saver.py, nous commençons à enregistrer la modification des prix des paires: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> markets = db_helper.get_data_exch() exchanges = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> name_exchange: exchange = getattr(ccxt, id) <span class="hljs-comment"><span class="hljs-comment">#isHas = exchange.hasFetchTickers #if isHas: exchanges[id] = exchange({ 'enableRateLimit': True, # or .enableRateLimit = True later }) cnx = db_helper.CreateConnection() cursor = cnx.cursor() loop = asyncio.get_event_loop() while True: start_time = time.time() input_coroutines = [fetch_ticker(exchanges, name) for name in exchanges] exch_tickers = loop.run_until_complete(asyncio.gather(*input_coroutines, return_exceptions=True)) count_exchange = 0 delta = time.time() - start_time for tickers in exch_tickers: if tickers is not None: count_exchange+=1 inserted_start = time.time() db_helper.insert_tick(markets,exch_tickers,cnx,cursor) inserted_time = time.time() print(count_exchange," ", delta, ' ', inserted_start - inserted_time)</span></span></code> </pre><br>  La réception asynchrone des ticks pour une paire spécifique se produit à l'aide de la méthode ccxt fetchTickers (). <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch_ticker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(exchanges, name)</span></span></span><span class="hljs-function">:</span></span> item = exchanges[name] <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: ticker = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> item.fetchTickers() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {name:ticker}</code> </pre><br><h3>  Analyse préliminaire des données </h3><br>  Tout d'abord, il est intéressant de savoir sur quels échanges et sur quelles paires se déroule le trading le plus actif, nous nous intéressons aux paires liquides.  Pour ce faire, vous devez calculer le nombre de transactions regroupées par échanges et paires spécifiques.  En conséquence, nous obtenons des paires qui se négocient activement. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ex.name <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> exchange_name, m.name <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> market_name, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> count_deals <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exchange</span></span> ex <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> market m <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> m.id_exchange = ex.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ticker t <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> t.id_market =m.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ex.id, t.id_market <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> m.name <span class="hljs-keyword"><span class="hljs-keyword">HAVING</span></span> count_deals &gt; <span class="hljs-number"><span class="hljs-number">10000</span></span>;</code> </pre><br>  À l'aide de requêtes SQL, vous pouvez trouver divers modèles et filtrer les données.Cependant, pour une analyse détaillée, vous devez créer un robot de test qui fonctionne sur les données accumulées à partir de divers échanges. <br><br>  Le prochain article sera consacré à la création de ce robot.  Et le serveur de test - émuler le travail d'un véritable échange. Je veux poser les points suivants dans le serveur de test: <br><br><ul><li>  Retards. </li><li>  Glissement. </li><li>  Commissions. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr436062/">https://habr.com/ru/post/fr436062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr436050/index.html">Comment connecter Raspberry PI à Azure IoT: instructions étape par étape</a></li>
<li><a href="../fr436052/index.html">Comment créer un département Data Science et ne pas le gâcher</a></li>
<li><a href="../fr436056/index.html">Événements numériques à Moscou du 14 janvier au 20 janvier</a></li>
<li><a href="../fr436058/index.html">Présentation des modules d'extension Snom D3 et D7</a></li>
<li><a href="../fr436060/index.html">Solutions architecturales pour un jeu mobile. Partie 3: Vue sur la poussée du jet</a></li>
<li><a href="../fr436064/index.html">L'intelligence artificielle pour tous</a></li>
<li><a href="../fr436066/index.html">Mathématiques de l'apocalypse: théorie des jeux et crise nucléaire des Caraïbes</a></li>
<li><a href="../fr436068/index.html">Conférence C ++ Russie 2019</a></li>
<li><a href="../fr436070/index.html">Comment gérer les tests floconneux dans la communauté opensource</a></li>
<li><a href="../fr436072/index.html">Nettoyer, marquer: comment nous avons appris à chatbot à distinguer les problèmes des clients</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>