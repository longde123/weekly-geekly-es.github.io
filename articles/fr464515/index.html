<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”¼ ğŸŸ ğŸ› Comment faire des e-mails et ne pas gÃ¢cher: conseils pratiques ğŸï¸ ğŸ¤¾ğŸ» ğŸ‘©ğŸ»â€âš•ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un dÃ©veloppeur, qui a rencontrÃ© pour la premiÃ¨re fois la gÃ©nÃ©ration d'e-mails, n'a presque aucune chance d'Ã©crire une application, qui le fera correct...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment faire des e-mails et ne pas gÃ¢cher: conseils pratiques</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/464515/"><img src="https://habrastorage.org/webt/s8/cx/7x/s8cx7xzo0rsuk0xw3z25hbfcjke.png"><br><br>  Un dÃ©veloppeur, qui a rencontrÃ© pour la premiÃ¨re fois la gÃ©nÃ©ration d'e-mails, n'a presque aucune chance d'Ã©crire une application, qui le fera correctement.  Environ 40% des e-mails, gÃ©nÃ©rÃ©s par des applications d'entreprise, violent une certaine forme de norme, et Ã  cause de cela, il y a des problÃ¨mes de livraison et d'affichage.  Il y a des raisons Ã  cela: les e-mails sont techniquement plus difficiles que le Web, et le fonctionnement des e-mails est rÃ©glementÃ© par quelques centaines de normes, ainsi qu'un nombre incalculable de pratiques gÃ©nÃ©ralement acceptÃ©es (et pas autant), tandis que les clients de messagerie sont plus variÃ©s et imprÃ©visible que les navigateurs.  Les tests peuvent amÃ©liorer considÃ©rablement la situation, mais le matÃ©riel dÃ©diÃ© au test du systÃ¨me de messagerie Ã©lectronique est pratiquement inexistant. <br><br>  Mail.ru interagit rÃ©guliÃ¨rement avec ses utilisateurs par e-mail.  Dans nos projets, tous les composants responsables de la gÃ©nÃ©ration des emails et mÃªme des mailings individuels, sont soumis Ã  des tests obligatoires.  Dans cet article, nous partagerons notre expÃ©rience (apprendre de nos erreurs). <br><a name="habracut"></a><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quels types d'e-mails existe-t-il?</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Qui est impliquÃ© dans le processus de test et de contrÃ´le?</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Envoi et transport du courrier</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'interface de l'infrastructure de messagerie et les limites de l'application testÃ©e</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DÃ©finition des paramÃ¨tres de test</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structure typique d'une application gÃ©nÃ©ratrice</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quoi et quand tester</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Infrastructure de livraison</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GÃ©nÃ©ration d'une application</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ModÃ¨les d'e-mails structurels et typographiques</a> <br></li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Exigences de base pour vÃ©rifier l'infrastructure</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Exigences d'authentification</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VÃ©rification de l'application gÃ©nÃ©ratrice</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conditions requises pour les adresses e-mail</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Adresses d'enveloppe</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Adresses d'en-tÃªte de messagerie</a> <br></li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Exigences pour les en-tÃªtes</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conditions requises pour la structure de l'e-mail</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Exigences d'URI</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Exigences de mise en page des e-mails</a> <br></li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RÃ©alisation de tests fractionnÃ©s</a> <br></li></ul><br><a name="1"></a><h2>  Quels types d'e-mails existe-t-il? </h2><br>  L'application peut gÃ©nÃ©rer diffÃ©rents types d'e-mails.  Ils peuvent Ãªtre classÃ©s en plusieurs catÃ©gories.  Par la mÃ©thode de sÃ©lection des destinataires - personnels / dÃ©clenchÃ©s - groupe sÃ©lectif.  Sur rendez-vous: transactions-marketing-service.  Vous pouvez dÃ©finir diffÃ©rentes exigences pour diffÃ©rents types de courrier Ã©lectronique et appliquer diffÃ©rents scÃ©narios de test. <br><br>  Les e-mails personnels dÃ©clenchÃ©s sont gÃ©nÃ©rÃ©s en rÃ©ponse Ã  tout Ã©vÃ©nement, par exemple, les actions de l'utilisateur ou les changements d'Ã©tat des objets systÃ¨me.  Ils sont gÃ©nÃ©rÃ©s par l'application et sont donc les plus intÃ©ressants pour les tests.  Les e-mails dÃ©clenchÃ©s peuvent Ãªtre transactionnels, marketing et Ã  usage de service.  Des e-mails sÃ©lectifs sont envoyÃ©s Ã  une sÃ©lection dynamique d'utilisateurs, qui rÃ©pondent Ã  une forme de critÃ¨re.  Les e-mails de groupe sont envoyÃ©s Ã  un groupe permanent de destinataires, par exemple, tous les utilisateurs ou partenaires.  Les e-mails sÃ©lectifs et de groupe sont souvent Ã  des fins marketing, et l'envoi de tels e-mails est dÃ©marrÃ© manuellement ou selon un calendrier. <br><br>  Les e-mails transactionnels sont gÃ©nÃ©rÃ©s au cours d'un utilisateur effectuant une certaine forme d'action.  Ces e-mails incluent, par exemple, des factures, des tickets ou des notifications d'Ã©tat de livraison.  Les e-mails transactionnels sont toujours dÃ©clenchÃ©s et sont destinÃ©s Ã  vÃ©hiculer des informations importantes.  Ils doivent Ãªtre aussi simples et compatibles que possible, et les tester doit Ãªtre effectuÃ© sur un grand nombre de clients de messagerie. <br><br>  Les e-mails marketing encouragent l'utilisateur Ã  entreprendre une action, par exemple, cela peut Ãªtre une offre de remise personnelle basÃ©e sur des achats prÃ©cÃ©dents.  Les donnÃ©es transactionnelles peuvent Ãªtre utilisÃ©es dans ces e-mails et peuvent Ãªtre dÃ©clenchÃ©es par e-mails ou en masse, pÃ©riodiques ou ponctuelles.  Pour ces e-mails, l'efficacitÃ© est plus importante et les rÃ©sultats du split-test le dÃ©terminent gÃ©nÃ©ralement.  Certains aspects de la compatibilitÃ© peuvent Ãªtre sacrifiÃ©s pour l'efficacitÃ©. <br><br>  Les e-mails de marketing de groupe, par exemple, les messages sur les offres saisonniÃ¨res, les promotions et les ventes, sont souvent envoyÃ©s `` manuellement '' et ne font pas partie de votre application, mais vous pouvez (et devez) Ã©galement leur appliquer des principes de test gÃ©nÃ©raux. <br><br>  Il peut Ã©galement y avoir des e-mails de service: notifications gÃ©nÃ©rÃ©es pour le personnel, pour les systÃ¨mes CRM automatisÃ©s, journalisation, audit ou DWH.  Ces e-mails sont gÃ©nÃ©ralement des e-mails dÃ©clenchÃ©s, ce qui signifie qu'ils font Ã©galement partie de l'application et doivent Ãªtre testÃ©s. <br><br><a name="2"></a><h2>  Qui est impliquÃ© dans le processus de test et de contrÃ´le? </h2><br><ol><li>  IngÃ©nieur AQ - participe Ã  toutes les Ã©tapes du processus. <br></li><li>  IngÃ©nieur rÃ©seau - responsable de la configuration de l'infrastructure rÃ©seau et de l'infrastructure de livraison des messages.  L'ingÃ©nieur rÃ©seau doit Ãªtre impliquÃ© dans la planification et les tests d'infrastructure. <br></li><li>  SpÃ©cialiste de la livraison - personne qui surveille la dÃ©livrabilitÃ© des courriels, qui participe Ã©galement au suivi des paramÃ¨tres techniques et administratifs de tous les courriels envoyÃ©s et surveille la progression du processus d'envoi.  Il est chargÃ© de s'assurer que les e-mails envoyÃ©s atteignent le pourcentage le plus Ã©levÃ© d'utilisateurs et ne se retrouvent pas dans le spam.  Pour cela, le spÃ©cialiste doit avoir des connaissances et des contacts spÃ©cifiques.  S'il y a des problÃ¨mes avec la livraison des courriels, c'est lui qui doit comprendre la cause probable et l'Ã©liminer;  soit en Ã©liminant les obstacles techniques;  ou changer quelque chose dans le contenu des e-mails;  ou essayez de rÃ©soudre le problÃ¨me avec le service d'assistance du fournisseur de messagerie, auquel les e-mails ne parviennent pas.  Un tel spÃ©cialiste (le cas Ã©chÃ©ant) devrait Ã©galement Ãªtre impliquÃ© dans l'Ã©laboration de la liste de contrÃ´le et le test des infrastructures gÃ©nÃ©rant des applications et des e-mails.  Cependant, le processus de test lui-mÃªme devrait Ãªtre sous le contrÃ´le du service QA. <br></li><li>  Email-marketer - dÃ©termine l'efficacitÃ© des newsletters marketing.  Sous son contrÃ´le, le split-testing pour la distribution de marketing au public se produit.  Le marketing par e-mail contrÃ´le Ã©galement la segmentation de la base d'utilisateurs, la composition et la frÃ©quence des e-mails envoyÃ©s, la Â«prÃ©sentationÂ» visuelle de l'e-mail Ã  l'utilisateur. <br></li></ol><br>  Tous ces rÃ´les ne sont pas nÃ©cessairement exÃ©cutÃ©s par un employÃ© dÃ©vouÃ©;  le rÃ´le de l'agent de commercialisation peut Ãªtre effectuÃ© par l'un des chefs de produit, et le rÃ´le du spÃ©cialiste de la livraison, par exemple, peut Ãªtre jouÃ© par un employÃ© de support ou un ingÃ©nieur rÃ©seau.  Dans les start-ups, il est trÃ¨s probable que tout cela devra Ãªtre traitÃ© par une seule personne, et il se peut quâ€™elles soient un spÃ©cialiste de la qualitÃ©. <br><br><a name="3"></a><h2>  Envoi et transport du courrier </h2><br>  La structure de l'e-mail est comme un Ã©norme iceberg, et il y a deux niveaux.  Il existe plus d'une centaine de normes diffÃ©rentes rÃ©gissant les e-mails, mais presque toutes appartiennent Ã  l'un de ces deux niveaux: <br><br>  <b>La partie sous-marine d'un</b> service de rÃ©seau <b>iceberg</b> , dont le protocole de base est le protocole d'application SMTP dÃ©fini par la RFC 5321. Il est responsable de la livraison des courriels.  Une enveloppe dite SMTP est formÃ©e pour la remise de l'e-mail, qui comprend les adresses de l'expÃ©diteur et du destinataire du niveau SMTP.  D'autres services rÃ©seau, tels que DNS, sont Ã©galement responsables de la livraison de l'e-mail.  Le composant principal de l'infrastructure rÃ©seau est l'agent de transfert de courrier (MTA).  Le MTA est responsable de la remise de la file d'attente de remise des messages et du processus de remise lui-mÃªme aux serveurs destinataires.  Les exemples MTA incluent Postfix, Sendmail, Exim, le service Microsoft SMTP. <br><br>  Cette partie sous-marine de l'iceberg, qui comprend le MTA, les paramÃ¨tres DNS et d'autres paramÃ¨tres de rÃ©seau, nous appellerons l'infrastructure de messagerie ou l'infrastructure de livraison de messages. <br><br>  <b>La pointe de l'iceberg</b> - l'e-mail lui-mÃªme.  La structure de base de l'e-mail est dÃ©finie par la norme RFC 5322. L'e-mail se compose d'en-tÃªtes de service et d'une ou plusieurs parties de donnÃ©es.  Les donnÃ©es peuvent Ãªtre au format texte brut et / ou HTML ou mÃªme AMP, avec des images en ligne ou des piÃ¨ces jointes de presque n'importe quel type. <br><br><a name="4"></a><h2>  L'interface de l'infrastructure de messagerie et les limites de l'application testÃ©e </h2><br>  L'infrastructure de messagerie, en rÃ¨gle gÃ©nÃ©rale, possÃ¨de une ou plusieurs interfaces via lesquelles un e-mail est envoyÃ© (lorsqu'il entre dans la file d'attente de remise MTA).  Par exemple, le service de soumission SMTP, la fonction <code>mail()</code> en PHP, le transfert de donnÃ©es vers une application de messagerie externe ou sendmail, une API pour un service interne ou externe (comme GetResponse, SendPulse ou Amazon SES).  Nous considÃ©rerons ces interfaces comme faisant partie de l'infrastructure.  Il arrive souvent que l'application A prÃ©pare des donnÃ©es pour un e-mail et une liste de destinataires, puis les envoie Ã  l'application B via son API (pour le marketing de publipostage, cela peut Ãªtre fait manuellement via l'interface utilisateur - UI), et l'application B gÃ©nÃ¨re un message Ã©lectronique dans RFC 5322 et le remet au MTA.  Pour l'application A (et lors de son test), l'application B fera partie de l'infrastructure de messagerie.  L'API ou l'interface utilisateur de l'application B sera pour l'interface A de l'application de l'infrastructure de messagerie.  Bien que pour l'application B, la situation sera diffÃ©rente et l'infrastructure de messagerie pour elle sera constituÃ©e d'applications ou de protocoles rÃ©seau de niveau infÃ©rieur. <br><br><a name="5"></a><h2>  DÃ©finition des paramÃ¨tres de test </h2><br>  Lors du test de chaque application, il est important de sÃ©lectionner toutes les infrastructures de messagerie utilisÃ©es par celle-ci (il peut y en avoir plusieurs), et pour chaque infrastructure de distinguer les interfaces utilisÃ©es (il peut Ã©galement y en avoir plusieurs pour chaque infrastructure).  Pour chaque interface, la composition et le format des donnÃ©es qui lui sont transmises sont dÃ©terminÃ©s aussi prÃ©cisÃ©ment que possible, par exemple, texte de l'e-mail en TEXT / HTML, texte de l'e-mail en TEXT / PLAIN, objet de l'e-mail, nom du destinataire, adresse du destinataire, nom de l'expÃ©diteur, adresse de l'expÃ©diteur (RFC5321.From), l'adresse de l'expÃ©diteur du convecteur SMTP (RFC5322.mailfrom).  Ensuite, un ensemble d'exigences est dÃ©veloppÃ© pour chaque paramÃ¨tre (reprÃ©sentations, codages, valeurs limites, etc.), des mÃ©thodes de surveillance de chacun des paramÃ¨tres sont dÃ©terminÃ©es (comment comparer le rÃ©sultat rÃ©el avec le rÃ©sultat attendu). <br><br><a name="6"></a><h2>  Structure typique d'une application gÃ©nÃ©ratrice </h2><br>  En rÃ¨gle gÃ©nÃ©rale, le mÃªme produit que nous testons est responsable de la gÃ©nÃ©ration d'e-mails et de donnÃ©es qu'il contient.  Il s'agit gÃ©nÃ©ralement d'une application serveur (mais parfois cliente).  Il dÃ©finit la structure de l'e-mail, une partie des en-tÃªtes de service, les formats d'encapsulation des donnÃ©es, les reprÃ©sentations de chaÃ®nes et l'encodage de texte.  Un exemple simple d'une telle application est le script qui forme l'e-mail et appelle la fonction <code>mail()</code> .  Les principaux Ã©lÃ©ments de l'application Ã  contrÃ´ler sont: <br><br><ul><li>  le code responsable de la gÃ©nÃ©ration des en-tÃªtes et / ou de la structure des e-mails, si la structure des e-mails est gÃ©nÃ©rÃ©e dynamiquement, et / ou des modÃ¨les d'e-mails statiques dÃ©crivant sa structure; <br></li><li>  Disposition HTML de l'e-mail (idÃ©alement, il s'agit d'une entitÃ© ou d'une partie distincte du modÃ¨le / de la mise en page de l'e-mail, mais elle peut Ãªtre intÃ©grÃ©e dans le code de l'application); <br></li><li>  substitution des donnÃ©es d'application dans un e-mail (ou dans un modÃ¨le d'e-mail); <br></li><li>  intÃ©gration de l'application avec l'infrastructure de livraison des e-mails, la justesse des paramÃ¨tres passÃ©s Ã  l'interface de l'infrastructure. <br></li></ul><br><a name="7"></a><h2>  Quoi et quand tester </h2><br>  Que cela nous plaise ou non, tout l'iceberg doit Ãªtre testÃ©.  Il existe plusieurs composants principaux qui nÃ©cessitent des tests: <br><br><a name="8"></a><h4>  Infrastructure de livraison </h4><br>  L'accent doit Ãªtre mis sur les tests: dÃ©livrabilitÃ© des e-mails;  les enregistrements DNS corrects, y compris les enregistrements PTR / FCrDNS, MX et A;  ParamÃ¨tres du protocole SMTP (HELO, utilisez TLS);  autorisation par e-mail (SPF / DKIM / DMARC);  Adresses d'enveloppe SMTP (si l'application ne les gÃ¨re pas);  exactitude du traitement des paramÃ¨tres d'entrÃ©e de l'interface d'infrastructure;  suivi, enregistrement et traitement des e-mails non livrÃ©s. <br><br>  Il est nÃ©cessaire de tester l'infrastructure lors de la mise en Å“uvre initiale et chaque fois que des modifications sont apportÃ©es Ã  l'infrastructure elle-mÃªme (la configuration du MTA, du DNS ou des modifications du rÃ©seau) ou Ã  l'interface d'envoi d'un e-mail;  en utilisant un nouveau domaine, rÃ©seau ou API;  des tests supplÃ©mentaires sont nÃ©cessaires si les caractÃ©ristiques des e-mails envoyÃ©s, telles que leur langue, leur taille ou leur nombre, sont considÃ©rablement modifiÃ©es.  Selon l'expÃ©rience, l'infrastructure a tendance Ã  changer Â«par elle-mÃªmeÂ», de sorte que des tests de base devraient Ãªtre effectuÃ©s pÃ©riodiquement, mÃªme en l'absence d'informations sur les changements. <br><br>  Il est possible et nÃ©cessaire d'impliquer l'ingÃ©nieur rÃ©seau et le spÃ©cialiste de la dÃ©livrabilitÃ© dans l'Ã©laboration du plan et des check-lists de test de l'infrastructure. <br><br><a name="9"></a><h4>  GÃ©nÃ©ration d'une application </h4><br>  Les adresses de l'enveloppe SMTP doivent Ãªtre surveillÃ©es (si l'application les contrÃ´le, c'est-Ã -dire qu'elles sont transfÃ©rÃ©es vers l'interface - enveloppe-de, enveloppe-Ã ), les valeurs des en-tÃªtes de service de l'e-mail (Date, Message -ID, Liste-DÃ©sabonnement, Soumission automatique, etc.).  Clause), autorisation de courrier Ã©lectronique (DKIM / DMARC), encodage MIME (base64, quoted-printable), exactitude gÃ©nÃ©rale du format de courrier Ã©lectronique, par exemple, l'absence de caractÃ¨res non ASCII dans les en-tÃªtes, la composition des donnÃ©es injectÃ©es , le dÃ©clenchement correct des dÃ©clencheurs, les mÃ©canismes de dÃ©sabonnement, les mÃ©canismes de suivi Ã©crivant et collectant des statistiques (en-tÃªtes de postmaster, par exemple, Feedback-ID ou X-Mailru-Msgtype, ainsi que les pixels de suivi). <br><br>  Il est nÃ©cessaire de tester une application au cours de son dÃ©veloppement, lorsque tous ses composants liÃ©s qui sont responsables de la gÃ©nÃ©ration et du stockage des donnÃ©es changent, avec des changements importants dans les modÃ¨les de courrier Ã©lectronique, lors du changement de l'infrastructure utilisÃ©e ou de l'interface avec celle-ci, ainsi que dans le cadre de rÃ©gressions gÃ©nÃ©rales. <br><br><a name="10"></a><h4>  ModÃ¨les d'e-mails structurels et typographiques (peuvent faire partie d'une application gÃ©nÃ©ratrice ou sont dÃ©veloppÃ©s sÃ©parÃ©ment) </h4><br>  La structure de l'e-mail est vÃ©rifiÃ©e (Content-Type, Content-Disposition, imbrication de plusieurs parties de l'e-mail, encodage de texte, paramÃ¨tres de chaÃ®ne), la valeur de la cible et les en-tÃªtes affichÃ©s (From, To, Reply-to, Subject ), la faÃ§on dont le courrier Ã©lectronique est affichÃ© dans la liste des courriels et lors de la lecture dans diverses interfaces, les microformats (par exemple, qu'un Ã©vÃ©nement de calendrier est reconnu comme un Ã©vÃ©nement de calendrier ou un billet d'avion comme un billet d'avion), l'image de marque. <br><br>  Les modÃ¨les d'e-mails doivent Ãªtre testÃ©s chaque fois que vous effectuez au moins les moindres modifications, ainsi que sÃ©parÃ©ment, par exemple, dans une situation oÃ¹ des e-mails pÃ©nÃ¨trent dans l'application avant que la partie serveur ne soit prÃªte. <br><br>  Il est recommandÃ© d'impliquer un spÃ©cialiste du marketing par e-mail et un spÃ©cialiste de la dÃ©livrabilitÃ© pour compiler une liste de contrÃ´le pour tester un modÃ¨le de courrier Ã©lectronique. <br><br><a name="11"></a><h4>  Exigences de base pour vÃ©rifier l'infrastructure </h4><br>  L'adresse IP sÃ©lectionnÃ©e pour le serveur de messagerie doit Ãªtre aussi proche que possible de l'adresse IP du serveur de messagerie.  Il est recommandÃ© de le vÃ©rifier Ã  l'aide de l'utilitaire whois.  En particulier, l'adresse de l'expÃ©diteur ne doit pas appartenir au rÃ©seau, ce qui peut Ãªtre perÃ§u comme dynamique;  le rÃ©seau sÃ©lectionnÃ© doit avoir des contacts actifs auxquels les plaintes peuvent Ãªtre envoyÃ©es;  le rÃ©seau doit Ãªtre utilisÃ© (avoir le statut ASSIGNÃ‰ dans RIPE) L'adresse IP doit avoir un enregistrement PTR correctement configurÃ©.  Il peut Ãªtre configurÃ© indÃ©pendamment via le panneau de contrÃ´le d'hÃ©bergement ou avec l'aide du fournisseur de services.  Un enregistrement PTR doit pointer vers le vÃ©ritable nom d'hÃ´te et toujours Ãªtre significatif, rÃ©solu Ã  la mÃªme adresse IP (soi-disant vÃ©rification FCrDNS), ne pas rappeler le nom de l'hÃ´te dynamique et ne pas inclure un grand groupe de chiffres ou de caractÃ¨res.  Un bon exemple est mailserver.example.com. <br><br>  Chaque domaine utilisÃ© dans les adresses d'enveloppe ou les en-tÃªtes de courrier Ã©lectronique doit avoir un enregistrement MX valide pointant vers un enregistrement hÃ´te A, qui, au minimum, peut gÃ©rer les messages non distribuables.  MX n'est pas autorisÃ© Ã  se rÃ©fÃ©rer directement Ã  une adresse IP. <br><br>  ContrÃ´lez le passage de SPF, DKIM, DMARC.  SPF permet au propriÃ©taire du domaine de spÃ©cifier dans les enregistrements TXT une liste de serveurs autorisÃ©s Ã  envoyer des e-mails avec des adresses de retour dans ce domaine.  Il est configurÃ© pour l'adresse utilisÃ©e dans l'enveloppe-de (enveloppe SMTP) dans la section de gestion des zones DNS du domaine.  DKIM fournit la vÃ©rification de la paternitÃ© d'un message ou de son expÃ©diteur Ã  un domaine spÃ©cifique Ã  l'aide des technologies de signature numÃ©rique, qui est ajoutÃ©e Ã  l'e-mail lui-mÃªme (dans son en-tÃªte DKIM-Signature).  En rÃ¨gle gÃ©nÃ©rale, une signature DKIM est configurÃ©e au niveau MTA (infrastructure).  DMARC dÃ©finit la politique de vÃ©rification du courrier entrant dans un domaine spÃ©cifique et des actions sur les e-mails qui ne passent pas l'authentification SPF ou DKIM.  Lorsque vous tentez de violer cette politique, un rapport structurÃ© s'accompagne d'informations sur une telle tentative.  DMARC, ainsi que SPF, est publiÃ© en tant qu'enregistrement TXT dans la zone de domaine. <br><br>  VÃ©rifiez la dÃ©livrabilitÃ© des e-mails vers les principaux services postaux - pour Russia Mail.Ru, Yandex, Gmail, Microsoft (Hotmail / Outlook.com / Office365), Rambler, nic.ru.  Dans les e-mails arrivÃ©s, vous devez vÃ©rifier l'exactitude de HELO;  la prÃ©sence et le passage des chÃ¨ques PTR / FCrDNS, SPF, DKIM et DMARC;  la validitÃ© des en-tÃªtes et des donnÃ©es qu'ils contiennent, en particulier le synchronisme de l'horloge dans les dates et l'exactitude des fuseaux horaires. <br><br><img src="https://habrastorage.org/webt/dg/kr/ml/dgkrmlpmq_rsds5zu40kwxuqz1o.png"><br>  (Le courrier d'inscription a rompu l'authentification en raison de l'adresse de messagerie gratuite utilisÃ©e) <br><br>  La formation de certains paramÃ¨tres, par exemple l'autorisation, la dÃ©livrabilitÃ© et le spam, est intÃ©gralement influencÃ©e par tous les composants, mais pour leur contrÃ´le, il existe gÃ©nÃ©ralement des outils opÃ©rationnels distincts - rapports DMARC et FBL, API des services postmaster, outils de suivi des e-mails, statistiques de livraison.  Les tests doivent tenir compte du niveau de mise en Å“uvre des outils de suivi opÃ©rationnel dans l'entreprise - par exemple, en l'absence de contrÃ´le opÃ©rationnel des rapports DMARC, l'autorisation des e-mails doit Ãªtre rÃ©guliÃ¨rement testÃ©e, alors qu'en l'absence de contrÃ´le opÃ©rationnel de la dÃ©livrabilitÃ©, oÃ¹ et comment les e-mails vont, mÃªme s'il n'y a pas de dÃ©veloppement liÃ© Ã  l'envoi d'e-mails. <br><br>  Pour tester l'infrastructure, vous pouvez utiliser des services spÃ©cialisÃ©s, par exemple, mail-tester.com, mxtoolbox.com.  Les exigences d'infrastructure dÃ©taillÃ©es peuvent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ãªtre trouvÃ©es dans cet article</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dab/868/c01/dab868c01fb1de36df5259aba785e92f.png"><br>  (un exemple de l'enregistrement SPF cassÃ©) <br><br><a name="12"></a><h2>  Exigences d'authentification </h2><br>  La vÃ©rification du passage de SPF, DKIM, DMARC est gÃ©nÃ©ralement possible en utilisant l'en-tÃªte Authentication-Results sur le serveur du destinataire. <br><br>  VÃ©rifiez la validitÃ© de l'enregistrement SPF pour la syntaxe, la limite pour les requÃªtes DNS (par exemple, en utilisant mxtoolbox.com).  Lors de la crÃ©ation d'un SPF, toutes les sources d'envois doivent Ãªtre prises en compte (n'oubliez pas les systÃ¨mes CRM, toutes les infrastructures de livraison actuellement utilisÃ©es, y compris celles Ã  travers lesquelles des campagnes marketing ponctuelles sont menÃ©es).  Il est recommandÃ© de dÃ©finir les serveurs autorisÃ©s pour le domaine via la liste des rÃ©seaux ('ip4' / 'ip6').  SPF est vÃ©rifiÃ© pour l'adresse de l'expÃ©diteur Ã  partir de l'enveloppe SMTP.  VÃ©rifiez que le domaine d'enveloppe SMTP (enveloppe-de) correspond au domaine de l'en-tÃªte De.  Les erreurs SPF courantes sont rÃ©pertoriÃ©es dans cet article (https://medium.com/hackernoon/myths-and-legends-of-spf-d17919a9e817). <br><br>  VÃ©rifiez l'enregistrement DNS DKIM, la validitÃ© et la composition de la signature DKIM.  VÃ©rifiez que vous utilisez une clÃ© DKIM d'au moins 1024 bits.  Mode de hachage recommandÃ© pour la signature DKIM: dÃ©tendu / dÃ©tendu.  Assurez-vous que tous les en-tÃªtes importants sont signÃ©s (De, Ã€, Objet, Date, ID de message, Version MIME, Type de contenu), que les en-tÃªtes de suivi (ReÃ§u, LivrÃ© Ã , Chemin de retour) ne sont pas signÃ©s et DKIM est validÃ© pour les services de messagerie de base.  Configurer le transfert vers l'un des services de messagerie vers un autre;  DKIM ne doit pas "battre" sur les e-mails transfÃ©rÃ©s.  VÃ©rifiez que le domaine de signature DKIM correspond au domaine de l'expÃ©diteur Ã  partir de l'en-tÃªte Â«DeÂ». <br><br>  VÃ©rifiez DMARC pour les services de messagerie de base.  Recherchez les rapports DMARC, identifiez et dÃ©pannez SPF et DKIM pour toutes les adresses IP de votre infrastructure. <br><br>  VÃ©rifiez que les messages sont remis Ã  des serveurs externes Ã  l'aide du chiffrement (TLS).  Vous pouvez parfois vÃ©rifier TLS par l'en-tÃªte Received sur le serveur du destinataire: par exemple, en spÃ©cifiant le protocole ESMTPS ou en ayant des paramÃ¨tres de la forme (version = TLS1_2 cipher = ECDHE-RSA-AES128-GCM-SHA256 bits = 128/128);  indique la prÃ©sence de TLS. <br><br><a name="13"></a><h2>  VÃ©rification de l'application gÃ©nÃ©ratrice </h2><br><a name="14"></a><h3>  Exigences d'adresse e-mail </h3><br><a name="15"></a><h4>  Adresses d'enveloppe </h4><br>  Nous commenÃ§ons la vÃ©rification de l'application gÃ©nÃ©ratrice avec les adresses dans l'enveloppe SMTP. <br>  Les adresses d'enveloppe sont des adresses du niveau de l'infrastructure de messagerie.  Ils ne sont pas visibles pour l'utilisateur, mais ils sont importants pour la livraison car l'adresse de l'enveloppe dÃ©termine dans quelle boÃ®te aux lettres l'e-mail va. <br><br>  <i>L'adresse du destinataire dans l'enveloppe</i> ( <code>envelope-to</code> , alias <code>RCPT TO:</code> est l'adresse Ã  laquelle l'e-mail sera effectivement livrÃ©. <br><br><ul><li>  pour tous les e-mails, Ã  l'exception de l'inscription, l'adresse doit Ãªtre lÃ©galement signÃ©e et validÃ©e pour l'envoi conformÃ©ment aux exigences administratives. <br></li><li>  pour les newsletters, l'adresse doit Ãªtre Â«en directÂ», les adresses auxquelles les e-mails ne peuvent pas Ãªtre livrÃ©s rÃ©guliÃ¨rement doivent Ãªtre marquÃ©es comme inactives, aucun courrier ne doit leur Ãªtre envoyÃ©.  Mais certaines catÃ©gories d'e-mails (par exemple, la rÃ©cupÃ©ration d'accÃ¨s) peuvent Ã©galement devoir Ãªtre envoyÃ©es Ã  des adresses prÃ©cÃ©demment marquÃ©es comme inactives. <br></li></ul><br>  <i>Adresse de l'expÃ©diteur dans une enveloppe SMTP</i> (gÃ©nÃ©ralement appelÃ©e <code>envelope-from</code> , <code>smtp.mailfrom</code> , <code>MAIL FROM:</code> ou <code>Return-Path</code> ) - des messages seront livrÃ©s Ã  cette adresse concernant l'impossibilitÃ© de livrer un e-mail et des rÃ©ponses automatiques.  Cette adresse n'est pas visible pour l'utilisateur.  Cette adresse est Ã©galement utilisÃ©e pour l'autorisation SPF.  Nous vÃ©rifions que: <br><br><ul><li>  L'adresse est disponible; <br></li><li>  Ce n'est pas l'adresse de l'employÃ© et il n'est pas redirigÃ© vers lui afin d'exclure les rÃ©ponses automatiques, les messages d'inaccessibilitÃ©, etc.; <br></li><li>  Il est traitÃ© par un script qui marquera les adresses des utilisateurs inaccessibles comme inactives; <br></li><li>  L'adresse peut Ãªtre gÃ©nÃ©rÃ©e automatiquement, c'est-Ã -dire unique pour chaque e-mail; <br></li><li>  Un e-mail Ã  cette adresse ne doit pas entraÃ®ner la gÃ©nÃ©ration d'un e-mail de rÃ©ponse, par exemple un message concernant un dÃ©bordement de boÃ®te aux lettres. <br></li></ul><br><a name="16"></a><h4>  Adresses d'en-tÃªte de messagerie </h4><br>  Ces adresses sont soit directement visibles par l'utilisateur, soit utilisÃ©es lors de la rÃ©ponse Ã  un e-mail. <br>  Adresse de l'expÃ©diteur (l'en-tÃªte <code>From:</code> est l'adresse et le nom de l'expÃ©diteur affichÃ©s dans la liste des e-mails et lors de la lecture d'un e-mail.  Nous vÃ©rifions que: <br><br><ul><li>  Il s'agit d'une adresse conviviale lisible par l'homme qui identifie l'entreprise. <br></li><li>  Il contient non seulement une adresse e-mail mais Ã©galement le nom de l'expÃ©diteur. <br></li><li>  Noreply @ est possible, mais seulement si nous voulons souligner que nous ne nous attendons pas Ã  recevoir une rÃ©ponse Ã  l'e-mail et qu'elle ne sera pas lue.  Il vaut mieux dupliquer cette idÃ©e dans le texte de l'email. <br></li><li>  En prÃ©sence de caractÃ¨res non ASCII (par exemple cyrillique), le nom de l'expÃ©diteur doit Ãªtre codÃ© conformÃ©ment Ã  MIME, le domaine en prÃ©sence de caractÃ¨res non ASCII doit Ãªtre codÃ© en Punycode <br></li><li>  Les e-mails de la mÃªme catÃ©gorie doivent avoir la mÃªme adresse;  l'utilisation d'adresses gÃ©nÃ©rÃ©es automatiquement doit Ãªtre Ã©vitÃ©e.  Cela est dÃ» au fait que Â«De:Â» est le plus souvent utilisÃ© par les gens pour trier les e-mails par dossiers Ã  l'aide de filtres. <br></li><li>  L'adresse doit Ãªtre diffÃ©rente (de prÃ©fÃ©rence dans diffÃ©rents sous-domaines) pour les e-mails transactionnels, marketing et urgents (tels que les e-mails du service d'assistance).  Cela est Ã©galement dÃ» au fait que l'utilisateur peut marquer les e-mails marketing comme spam ou les filtrer dans un dossier illisible. <br></li><li>  L'adresse <code>From:</code> et l'adresse d'enveloppe SMTP doivent Ãªtre dans le mÃªme domaine ou dans des sous-domaines du mÃªme domaine d'organisation afin de passer le SPF dans le DMARC. <br></li><li>  L'adresse doit provenir du domaine de l'organisation.  Il est inacceptable d'utiliser des services de messagerie gratuits et d'autres domaines de messagerie publique dans <code>From:</code> car ces mailings ne passeront pas l'authentification SPF et DKIM dans le cadre de DMARC. <br></li></ul><br>  L'adresse <code>Reply-to</code> - les rÃ©ponses Â«manuellesÂ» seront envoyÃ©es Ã  cette adresse lorsqu'un utilisateur rÃ©pond Ã  un e-mail.  C'est facultatif.  S'il est absent, l'adresse de Â«De:Â» est utilisÃ©e pour la rÃ©ponse.  VÃ©rifiez que Â«RÃ©pondre Ã Â»: <br><br><ul><li>  Il peut Ãªtre gÃ©nÃ©rÃ© automatiquement, c'est-Ã -dire unique Ã  l'e-mail (vous permet de savoir Ã  quel e-mail la rÃ©ponse est arrivÃ©e). <br></li><li>  Il ne doit pas tomber dans la boÃ®te aux lettres de l'employÃ© pour Ã©viter la rÃ©ponse automatique, mais devrait idÃ©alement Ãªtre Â«enveloppÃ©Â» dans CRM. <br></li><li>  Il peut gÃ©nÃ©rer une rÃ©ponse automatique CRM standard, mais il ne doit pas gÃ©nÃ©rer quoi que ce soit de superflu, par exemple un dÃ©bordement de boÃ®te aux lettres ou des messages "sur vocation".  Lors de la gÃ©nÃ©ration de rÃ©ponses automatiques, des mesures doivent Ãªtre prises pour Ã©viter le bouclage, elles sont rÃ©pertoriÃ©es dans la RFC 3834. <br></li><li>  Il peut provenir de n'importe quel domaine qui ne coÃ¯ncide pas nÃ©cessairement avec Â«De:Â», mais cela effraie parfois les utilisateurs lorsqu'ils rÃ©pondent. <br></li><li>  Peut Ãªtre absent, alors l'adresse <code>From:</code> remplit ses fonctions. <br></li><li>  En plus de l'adresse, le nom de l'expÃ©diteur est indiquÃ©. <br></li></ul><br>  L'adresse <code>To:</code> <br><br><ul><li>  Doit contenir l'e-mail du destinataire (sinon cela effraie le destinataire du message et gÃªne l'anti-spam). <br></li><li>  IdÃ©alement, il devrait contenir le nom du destinataire.  Mais si le nom est inconnu ou douteux (par exemple, l'adresse n'a pas encore Ã©tÃ© confirmÃ©e), il est prÃ©fÃ©rable de ne pas l'indiquer (quelqu'un peut entrer l'adresse de quelqu'un d'autre avec un mauvais nom et le destinataire peut Ãªtre offensÃ©). <br></li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/aab/7da/212/aab7da2120c8351588fcd4ea0e126a6c.png"><br><br><a name="17"></a><h3>  Exigences de l'en-tÃªte de l'e-mail </h3><br>  L'encodage rÃ©el du texte doit correspondre Ã  celui indiquÃ© dans l'en-tÃªte.  Il est conseillÃ© d'utiliser un seul codage dans tous les en-tÃªtes et parties de l'e-mail.  Il est recommandÃ© d'utiliser UTF-8 comme Ã©tant largement pris en charge.  L'encodage est indiquÃ© dans les en-tÃªtes Content-Type et dans la balise de la partie HTML. <br><br>  Les en-tÃªtes From:, Message-ID: et Date: doivent Ãªtre formÃ©s directement dans le script pour envoyer l'e-mail (et selon les normes - avec le texte de l'e-mail) et toujours dans le format correct.  S'ils sont absents ou mal formÃ©s, l'un des serveurs de transit peut ajouter ces en-tÃªtes, ce qui entraÃ®ne une violation de l'intÃ©gritÃ© de la signature DKIM. <br><br>  Les caractÃ¨res de 8 bits dans les en-tÃªtes, y compris la ligne d'objet (Objet) et les noms des fichiers joints (Content-Type et Content-Disposition), doivent Ãªtre absents;  Tous les caractÃ¨res non ASCII, y compris cyrillique, doivent Ãªtre codÃ©s en imprimable entre guillemets ou en base64. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e25/bc4/a54/e25bc4a54a84fffce6f28d01cf3542f9.png"><br>  (confirmation d'inscription dans un codage Ã©trange) <br><br><a name="18"></a><h3>  Exigences relatives Ã  la structure de l'e-mail </h3><br>  Pour la partie HTML de l'e-mail, il est souhaitable de former une partie alternative (texte brut).  Il est Ã©galement nÃ©cessaire de vÃ©rifier la conformitÃ© et la lisibilitÃ© de la partie en texte brut de l'e-mail (le cas Ã©chÃ©ant) et la structure gÃ©nÃ©rale de l'e-mail. <br><br>  Selon la RFC 5322, la longueur d'une ligne dans un e-mail ne doit pas dÃ©passer 998 caractÃ¨res 8 bits.  Veuillez noter qu'en UTF-8, un personnage peut occuper plusieurs octets.  Le terminateur de lignes dans un e-mail est une paire de CRLF (ascii 13, ascii 10), qui prend 2 octets.  Vous devez vÃ©rifier l'exactitude du terminateur de chaÃ®ne, car les e-mails sont souvent envoyÃ©s Ã  l'aide d'un script Unix, et dans Unix, le terminateur de chaÃ®ne est un seul caractÃ¨re - il s'agit d'une erreur pour le courrier Ã©lectronique.  Vous devez Ã©galement vÃ©rifier si les terminateurs de chaÃ®ne rompent les caractÃ¨res codÃ©s UTF-8: vous ne pouvez pas autoriser la prÃ©sence d'un terminateur de chaÃ®ne entre deux octets du mÃªme caractÃ¨re, par exemple, le symbole cyrillique.  Pour Ã©viter de telles situations, il est nÃ©cessaire de casser le texte avant de former l'e-mail ou de coder le texte en base64, base64 a gÃ©nÃ©ralement une longueur de ligne fixe. <br><br>  Il est nÃ©cessaire de vÃ©rifier le marquage correct des piÃ¨ces jointes et des inlines - c'est-Ã -dire l'exactitude de la formation des en-tÃªtes "Content-Disposition: inline", s'il s'agit d'une image affichÃ©e Ã  l'intÃ©rieur de l'e-mail, ou "Content-Disposition: attachment" si le fichier joint est destinÃ© au tÃ©lÃ©chargement. <br><br>  La structure de l'e-mail doit Ãªtre aussi simple que possible: en particulier, il ne doit pas y avoir plus d'une partie en plusieurs parties de chaque type (mixte, alternative, liÃ©e), et en plusieurs parties / mixte est utilisÃ© uniquement si l'e-mail contient des piÃ¨ces jointes, en plusieurs parties / connexes - si HTML est fourni avec des images en ligne, en plusieurs parties / alternative - en prÃ©sence de texte brut et de parties HTML.  En gÃ©nÃ©ral, la structure de l'e-mail, en l'absence de piÃ¨ces jointes et d'images en ligne, devrait ressembler Ã  ceci: <br><br>  multipart / alternative <br>  - texte / uni <br>  - texte / html <br><br>  L'ordre des parties est important, text / plain doit aller AVANT text / html ou multipart / related.  Ceci est nÃ©cessaire pour que la partie HTML soit affichÃ©e par dÃ©faut, et seulement si son affichage n'est pas disponible pour une raison quelconque, la partie simple est affichÃ©e. <br><br>  S'il y a des images en ligne dans l'e-mail, sa structure devrait ressembler Ã  ceci: <br><br>  multipart / alternative <br>  - texte / uni <br>  - multipart / apparentÃ© <br>  â€”â€” texte / html <br>  â€”â€” image / ... (image en ligne) <br>  â€”â€” image / ... (image en ligne) <br><br>  Les images en ligne doivent avoir Content-Disposition: en ligne et Ãªtre strictement Ã  l'intÃ©rieur de la partie en plusieurs parties / associÃ©e. <br>  Dans le cas le plus difficile, lorsqu'il y a Ã  la fois des images en ligne et des fichiers joints, l'e-mail a la structure suivante: <br><br>  multipart / mixte <br>  - multipart / alternative <br>  â€”â€” texte / clair <br>  â€”â€” multipart / connexe <br>  â€”â€”â€” texte / html <br>  â€”â€”â€” image / png <br>  â€”â€”â€” image / png <br>  ... <br>  - application / octet-string (content-disposition: attachment) <br>  - application / octet-string (content-disposition: attachment) <br>  ... <br>  les parties liÃ©es et multipart / alternatives doivent Ãªtre fermÃ©es avant les piÃ¨ces jointes, les piÃ¨ces jointes appartiennent Ã  la partie multipart / mixte externe) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/944/23a/506/94423a506f8f81b02314ff4dc8d76385.png"><br>  (message d'enregistrement avec une structure de piÃ¨ces incorrecte) <br><br><a name="19"></a><h2>  Exigences d'URI </h2><br><br>  Tous les URI (en src, attributs href, styles, etc.) doivent contenir le protocole et le nom d'hÃ´te (https://example.com/somepath).  Les erreurs typiques sont l'utilisation de liens relatifs (/ somepath) et l'absence de protocole (//example.com/somepath), ce qui est inacceptable pour les e-mails, car dans ceux-ci, le protocole par dÃ©faut peut Ãªtre <code>file://</code> . <br><br><ul><li>  Tous les caractÃ¨res de service et non ASCII (en particulier cyrillique) dans l'URI doivent Ãªtre codÃ©s Ã  l'aide d'un pourcentage de codage. <br></li><li>  Un lien insÃ©rÃ© sous forme de texte (c'est-Ã -dire visible par l'utilisateur sous forme d'URL et non sous forme de texte) doit toujours Ãªtre marquÃ© avec la balise <code>&lt;&gt;</code> , sinon l'utilisateur ne pourra pas cliquer dessus.  Certains webmails marquent ces liens par eux-mÃªmes, mais ce n'est pas un comportement standard.  Dans ce cas, l'adresse href Ã  l'intÃ©rieur de A doit correspondre au texte du lien, sinon le filtre de contenu peut rÃ©agir Ã  un tel lien comme une tentative de tromper l'utilisateur.  Cela vaut particuliÃ¨rement la peine de faire attention lorsqu'il existe des "cliqueurs" qui suivent les transitions de l'utilisateur Ã  partir de l'e-mail. <br></li><li>  Il vaut mieux se limiter Ã  l'utilisation des protocoles <code>http://</code> , <code>https://</code> et <code>mailto:</code> <br></li><li>  Avec des exigences de haute sÃ©curitÃ©, vous devez abandonner complÃ¨tement l'utilisation de <code>http://</code> au profit de <code>https://</code> . <br></li><li>  Les ports non standard ne doivent pas Ãªtre utilisÃ©s (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">example.com</a> : 8080 / somepath), car ils peuvent ne pas Ãªtre accessibles Ã  l'utilisateur. <br></li><li>  Le fait de cliquer sur le lien Ã  l'intÃ©rieur de la partie HTML ne doit entraÃ®ner aucune modification de l'Ã©tat de l'application (abonnement, dÃ©sabonnement, annulation de la commande, etc.) sans confirmation supplÃ©mentaire de l'utilisateur sur la page, car certains systÃ¨mes de filtrage de contenu peuvent indÃ©pendamment vÃ©rifier la sÃ©curitÃ© d'une telle transition en demandant une page par rÃ©fÃ©rence;  l'application de messagerie peut afficher l'aperÃ§u de la page par le lien en survol et les navigateurs modernes peuvent charger la page avant que l'utilisateur clique sur le lien pour rÃ©duire le temps de chargement (dans l'application Web, il n'est gÃ©nÃ©ralement pas recommandÃ© d'effectuer des actions de modification sur le GET request, toutes les demandes de modification doivent passer par POST ou PUT). <br></li><li>  En revanche, cliquer sur le lien dans l'en-tÃªte List-Unsubscribe ne devrait pas nÃ©cessiter d'actions supplÃ©mentaires de la part de l'utilisateur, car la dÃ©sinscription par ce lien se fait gÃ©nÃ©ralement par programme de messagerie Ã©lectronique ou webmail au nom de l'utilisateur.  En outre, il y a un nouvel en-tÃªte List-Unsubscribe-Post introduit par RFC 8058. <br></li><li>  Vous ne devez pas vous attendre Ã  ce que l'utilisateur lise l'e-mail et suive le lien dans le mÃªme navigateur dans lequel il initie l'action conduisant Ã  l'envoi de l'e-mail (par exemple, enregistre un compte).  Le lien doit fonctionner dans tout autre navigateur ou appareil mobile.  En particulier, l'utilisateur peut ouvrir le lien sans Ãªtre autorisÃ© ou autorisÃ© dans un compte autre que celui auquel l'e-mail a Ã©tÃ© envoyÃ©. <br></li><li>  Parce que la longueur de l'URI peut Ãªtre limitÃ©e;  vous ne devez pas utiliser d'URI de type 'data:' pour les gros objets.  Pour la mÃªme raison, n'utilisez pas d'URI trop longs dans les hyperliens. <br></li><li>  Vous ne devez pas utiliser de raccourcisseurs de liens externes, cela affecte nÃ©gativement la livraison des e-mails.  Il est prÃ©fÃ©rable que tous les liens pointent vers votre domaine, cela rÃ©duira l'impact nÃ©gatif potentiel de la rÃ©putation d'une autre personne sur la livraison des e-mails. <br></li><li>  Ne placez pas d'images externes sur certains services publics ou d'hÃ©bergement gratuit, utilisez un service d'hÃ©bergement fiable ou un CDN avec de bonnes performances et une bonne rÃ©putation. <br></li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/05a/afd/4b3/05aafd4b3ef1a07a9654a92fc0419b32.png"><br>  (image non valide et URI d'ancrage en raison d'une spÃ©cification de protocole manquante) <br><br><a name="20"></a><h2>  Exigences de mise en page des e-mails </h2><br>  Pourquoi est-il si difficile de crÃ©er des e-mails? <br><br>  Les clients de messagerie d'une maniÃ¨re ou d'une autre affichent le contenu utilisateur dans leur interface.  Potentiellement, cela peut entraÃ®ner divers problÃ¨mes de sÃ©curitÃ© - scripts intersites (XSS, Crossite scripting), usurpation d'interface, DOM clobbering, dÃ©sanonymisation des utilisateurs / fuite d'informations (par exemple, l'adresse IP de l'utilisateur ou les cookies via des requÃªtes externes), etc.  Par consÃ©quent, tout service de messagerie et toute application de messagerie ont une certaine forme de protection contre chaque classe d'attaques.  Malheureusement, il n'y a pas d'approche unique pour organiser cette protection.  Il peut Ãªtre organisÃ© Ã  travers: <br><br><ul><li>  cadres limitÃ©s isolÃ©s, <br></li><li>  balises et / ou attributs de filtrage, <br></li><li>  restrictions de positionnement absolu, <br></li><li>  interdiction ou restriction de l'utilisation des styles de bloc (ce qui est essentiel pour une mise en page adaptative), <br></li><li>  l'interdiction d'Ã©lÃ©ments externes par dÃ©faut (ie le tÃ©lÃ©chargement d'images externes nÃ©cessite l'autorisation de l'utilisateur) ou l'utilisation d'un proxy pour y accÃ©der, <br></li><li>  convertir des e-mails HTML en un autre format intermÃ©diaire (par exemple, Microsoft Exchange / Outlook utilise RTF, ce qui peut rendre extrÃªmement difficile l'affichage correct des Ã©lÃ©ments dans Outlook Ã  l'aide de mÃ©thodes conventionnelles), <br></li><li>  interdiction ou restriction de l'utilisation des formulaires ou de leurs Ã©lÃ©ments individuels. <br></li></ul><br>  Les e-mails utilisent Ã©galement des Ã©lÃ©ments spÃ©cifiques, tels que des images en ligne et l'URI <code>cid://</code> , dont la prise en charge peut Ãªtre limitÃ©e.  Par exemple, Mozilla Thunderbird ne prend pas en charge <code>cid://</code> pour les images d'arriÃ¨re-plan. <br><br>  MÃªme un e-mail correctement formÃ© peut Ãªtre affichÃ© diffÃ©remment dans diffÃ©rentes interfaces en raison des particularitÃ©s de leur mise en Å“uvre et du filtrage du contenu de l'e-mail. <br><br>  S'il y a des erreurs dans le format de l'e-mail, le comportement devient complÃ¨tement imprÃ©visible.  Par exemple, les clients de messagerie peuvent avoir un comportement diffÃ©rent avec des URI incorrects ou ce formatage d'en-tÃªte incorrect est gÃ©rÃ© diffÃ©remment.  En outre, la dÃ©tection automatique de l'encodage de texte fonctionne diffÃ©remment si elle n'est pas spÃ©cifiÃ©e ou si elle est spÃ©cifiÃ©e de maniÃ¨re incorrecte.  Par consÃ©quent, l'e-mail doit Ãªtre affichÃ© dans diffÃ©rentes interfaces: l'affichage correct de l'e-mail dans une interface ne signifie pas qu'il est composÃ© correctement (en fait, mÃªme l'affichage correct de l'e-mail dans toutes les interfaces ne garantit pas qu'il n'y aura pas problÃ¨mes d'affichage Ã  l'avenir). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b5/127/114/9b512711407c1cac545a57fd629d6b1a.png"><br><br>  Il est nÃ©cessaire de prÃªter attention aux points suivants: <br><br><ul><li>  VÃ©rifiez le texte de l'e-mail pour le contenu sÃ©mantique, l'affichage, l'absence de fautes de frappe, les erreurs de syntaxe, d'orthographe et lexicales. <br></li><li>  VÃ©rifiez l'exactitude de la substitution des donnÃ©es d'application dans le modÃ¨le ou la prÃ©sentation de l'e-mail. <br></li><li>  VÃ©rifiez l'exactitude des montants, dates, numÃ©ros, articles de marchandise et autres informations, en tenant compte des conditions aux limites autorisÃ©es.  Les dates doivent avoir un an (certains utilisateurs entrent trÃ¨s rarement dans la case).  Un fuseau horaire doit Ãªtre prÃ©sent dans le temps.  L'adresse doit contenir une ville, et dans certains cas, il est nÃ©cessaire d'indiquer le pays. <br></li><li>  VÃ©rifiez l'Ã©tat opÃ©rationnel de tous les liens dans l'e-mail, le cas Ã©chÃ©ant. <br></li><li>  Dans les courriels envoyÃ©s avant la confirmation de l'adresse, incl.  e-mails avec un lien de confirmation, aucun texte ne doit Ãªtre contrÃ´lÃ© de l'extÃ©rieur, mÃªme le nom d'utilisateur, sinon, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ils peuvent Ãªtre utilisÃ©s pour le spam</a> (dans le champ affichÃ© dans l'e-mail, par exemple, dans le nom, le texte du spam est insÃ©rÃ© et l'adresse est l'adresse indiquÃ©e de la victime).  Par exemple, si vous pouvez envoyer un texte obscÃ¨ne Ã  l'adresse du dÃ©veloppeur au nom de votre service, il y a un problÃ¨me. <br></li><li>  VÃ©rifiez l'absence d'images externes sur les services tiers.  Cela peut affecter la livraison et la fuite d'informations sur vos clients. <br></li><li>  VÃ©rifiez la disponibilitÃ© des compteurs pour l'envoi, la livraison, la lecture des e-mails, les transitions.  Certains d'entre eux sont situÃ©s dans l'e-mail lui-mÃªme (par exemple, le contre-pixel de lecture de l'e-mail), certains sont suivis par l'expÃ©diteur, mais, en rÃ¨gle gÃ©nÃ©rale, tous sont disponibles dans le panneau d'administration de l'expÃ©diteur. <br></li><li>  VÃ©rifiez l'exactitude de la catÃ©gorie d'abonnement et la dÃ©sinscription de l'utilisateur pour cette catÃ©gorie via le lien dans l'e-mail. <br></li><li>  VÃ©rifiez Ã  quoi ressemble l'e-mail: <br><ul><li>  Versions Web populaires du courrier pour un pays ciblÃ©: les "trois grands" pour la Russie sont Mail.Ru, Yandex, Gmail.  Vous pouvez Ã©galement ajouter Rambler et Outlook.com; <br></li><li>  Applications mobiles des fournisseurs de messagerie ci-dessus; <br></li><li>  Applications mobiles standard utilisant IMAP, en tenant compte des plates-formes mobiles populaires, au moins pour l'iPhone, Pixel (plate-forme de rÃ©fÃ©rence Android), Samsung (le plus courant pour Android), MIUI (prend la deuxiÃ¨me place en Russie pour les plates-formes Android); <br></li><li>  Divers navigateurs de bureau: Chrome, Firefox, Edge, Internet Explorer, Opera, etc.; <br></li><li>  Applications de bureau (programmes de messagerie), en particulier Thunderbird, Outlook et Apple Mail, Ã©ventuellement The Bat!  et Opera Mail; <br></li><li>  Solutions d'entreprise populaires avec une interface Web (Exchange, peut-Ãªtre Roundcube, Communigate, Zimbra, SquirrelMail) - pour les solutions B2B; <br></li><li>  N'oubliez pas de vÃ©rifier la disposition des moniteurs Retina et des moniteurs de rÃ©solution infÃ©rieure. <br></li></ul></li><li>  Lors de la vÃ©rification dans chaque cas, vous devez faire attention Ã : <br><ul><li>  Passer les en-tÃªtes d'autorisation, SPF / DKIM / DMARC. <br></li><li>  Vitesse de tÃ©lÃ©chargement des e-mails: il devrait se charger rapidement et ne pas prendre son temps. <br></li><li>  Affichage d'un e-mail dans la liste des e-mails: avatar, nom de l'expÃ©diteur et sujet qui tombe dans l'extrait de message, si sa catÃ©gorie a Ã©tÃ© correctement dÃ©finie (par exemple, si la commande ne tombe pas dans la catÃ©gorie "rÃ©seaux sociaux"). <br></li><li>  La mise en page de l'e-mail dans son ensemble: si la mise en page restait cohÃ©rente, y avait-il des sauts de mots incorrects, etc., y compris lors de la mise Ã  l'Ã©chelle et du redimensionnement de la fenÃªtre. <br></li><li>  Les polices ne doivent pas Ãªtre petites ou difficiles Ã  lire. <br></li><li>  Images d'arriÃ¨re-plan et couleurs d'arriÃ¨re-plan. <br></li><li>  Correspondant au livre de la marque. <br></li><li>  FacilitÃ© d'exÃ©cution des actions impliquÃ©es par l'e-mail.  Par exemple, si l'e-mail contient un code de confirmation ou d'autres informations qui peuvent avoir besoin d'Ãªtre stockÃ©es quelque part, il ne doit pas seulement Ãªtre bien lu, il doit Ã©galement Ãªtre pratique de le sÃ©lectionner et de le copier mÃªme dans l'interface mobile. <br></li></ul><br></li><li>  Gardez une trace de la taille globale de l'e-mail (y compris les images externes) et qu'elle ne dÃ©passe pas les valeurs raisonnables.  Plus le temps de chargement est lourd, plus il est probable qu'une personne y rÃ©agira nÃ©gativement. <br></li><li>  MÃªme les courriels qui n'ont pas Ã©tÃ© modifiÃ©s devraient Ãªtre vÃ©rifiÃ©s pÃ©riodiquement, car des changements peuvent survenir du cÃ´tÃ© du service postal et, par exemple, Â«rÃ©vÃ©lerÂ» un problÃ¨me auparavant invisible. <br></li><li>  Certains paramÃ¨tres doivent Ãªtre contrÃ´lÃ©s dans tous les tests.  Par exemple, les problÃ¨mes de rÃ©ussite de l'authentification DKIM peuvent Ãªtre dus Ã  des problÃ¨mes dans l'infrastructure (problÃ¨mes avec DNS ou la formation d'une signature DKIM, erreurs de synchronisation horaire), dus Ã  des erreurs dans le programme de gÃ©nÃ©ration (l'adresse de l'expÃ©diteur est mal formÃ©e, des caractÃ¨res incorrects dans les en-tÃªtes sont manquants ou les en-tÃªtes obligatoires De, Date ou Message-ID ont Ã©tÃ© dupliquÃ©s) et en raison d'erreurs de contenu (terminateurs de ligne incorrects, les lignes sont trop longues, adresses incorrectes).  Dans le mÃªme temps, l'e-mail peut ne pas Â«battreÂ» et le problÃ¨me peut n'apparaÃ®tre sur aucun service. <br></li></ul><br><a name="21"></a><h2>  RÃ©alisation de tests fractionnÃ©s </h2><br>  La recherche marketing dÃ©passe le cadre de cet article, mais il convient de mentionner quelques points clÃ©s qui affectent considÃ©rablement la qualitÃ© des e-mails. <br><br> The newsletter has a purpose, so it should entail through its quality, not quantity (which is the opposite for spammers). The newsletter must be segmented. When conducting an advertising campaign, you need to know exactly who gets into the segment sample, why they need the offered product and what they want to convey. <br><br> For each mailing list, it is necessary to calculate the CTR of the list of emails â€” this is the ratio of the number of emails read to the total number that has been sent out. In postmaster.mail.ru, you can see indicators for unique users. If the measurement goes through the counter in the email (pixel), then the absolute number of openings is estimated. CTR &lt;10% is a very low indicator, it is undesirable to carry out such mailing. It should strive for a CTR&gt; 30%. For marketing emails, the clickthrough rate of clickthroughs and the percentage of completed actions (Â«salesÂ») on these links are also of great importance. Be sure to monitor complaints (marking the email as spam). Typically, for one-time mailings, a tenth of a percent is a good indicator, for regular ones, a hundredth of a percent. The critical values, after which the mailing is always interpreted as spam, are indicated here: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://help.mail.ru/developers/mailing_rules/technical</a> . <br><br> It is necessary to conduct split testing of various distribution options to obtain optimal performance. Just changing the name of the sender and the subject of the email can increase the CTR by several times and significantly reduce the number of complaints. The number of emails should be statistically significant for evaluating the results (for large projects, usually a few thousand). The final version of the email is sent in several stages for additional measurement of indicators and Â«warming upÂ» â€” starting with about 10,000 recipients, with an increase of about an order of the day. <br><br> The main idea: emails are part of your application, perhaps one of the most complex and problematic. At the same time, this is often a Â«blind spotÂ» in terms of testing. I hope that I was able to draw your attention to this issue. <br><br> I would like to thank Vladimir Dubrovin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">z3apa3a</a> ) and Alena Likhacheva ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">s4ever</a> ) for helping me with this article. As well as that, the article utilised sources of Eduard Tyantov ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">edT</a> ) and Alexander Purtov ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">4Alexander</a> ). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464515/">https://habr.com/ru/post/fr464515/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464499/index.html">"Mat. ModÃ¨le de Wall Street Â»ou une tentative d'optimiser le coÃ»t de l'infrastructure informatique cloud</a></li>
<li><a href="../fr464503/index.html">Correspondance de mot de passe Wi-Fi avec aircrack-ng</a></li>
<li><a href="../fr464509/index.html">Le livre "Grok deep learning"</a></li>
<li><a href="../fr464511/index.html">Comment collecter des cohortes d'utilisateurs sous forme de graphiques dans Grafana [+ image docker avec un exemple]</a></li>
<li><a href="../fr464513/index.html">Duffle: Transformer de XD Design</a></li>
<li><a href="../fr464517/index.html">Nouvelles cartes CUBA</a></li>
<li><a href="../fr464523/index.html">SystÃ¨mes de paiement (PSP) pour l'informatique: nous jouons gros</a></li>
<li><a href="../fr464525/index.html">Votre propre convertisseur JSON ou un peu plus sur ExpressionTrees</a></li>
<li><a href="../fr464529/index.html">Pour la publicitÃ© contextuelle par les noms des concurrents peut dÃ©sormais Ãªtre condamnÃ© Ã  une amende de 500 000 roubles</a></li>
<li><a href="../fr464535/index.html">DÃ©tails sur l'appareil et les fonctions du scooter Ã©lectrique KickScooter T60</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>