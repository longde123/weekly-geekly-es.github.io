<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ùáÔ∏è üï¥üèª üë©üèø‚Äçüéì Graphique d'√©tat anim√© ‚è≠Ô∏è üëâüèæ üêØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut Chez Playrix, nous avons d√©cid√© de fabriquer notre Unity3D . Et il y a Animator. Dans cet article, je vais vous dire comment nous l'avons fait √†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Graphique d'√©tat anim√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/playrix/blog/471956/">  Salut  Chez Playrix, nous avons d√©cid√© de fabriquer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre Unity3D</a> .  Et il y a Animator.  Dans cet article, je vais vous dire comment nous l'avons fait √† la maison et comment cela fonctionne. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67b/a57/9de/67ba579dec3dab6038fcdfc5cc9aad25.png"></div><a name="habracut"></a><br>  Lorsque nous avons commenc√© √† concevoir l'architecture de nos graphes d'animation, nous avons bien s√ªr regard√© d'autres analogues, notamment sur Unity Animator.  Cependant, nous voulions faire une solution plus universelle.  Contrairement √† la m√™me unit√©, nous avons la personnalisation des √©tats d'animation via l'interface du contr√¥leur.  Mais d'abord, il vaut la peine de comprendre ce qu'est un graphique d'√©tat anim√©.  Si vous l'avez d√©j√† rencontr√©, il est logique d'ignorer la partie introductive et de passer aux fonctionnalit√©s d'impl√©mentation. <br><br><h2>  Alors, quel est exactement ce graphique d'√©tat anim√©? </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b20/d16/b78/b20d16b789def0dd88b8a65ee6deb99d.png"></div><br>  Un graphique d'√©tat d'animation vous permet de repr√©senter graphiquement les transitions entre diff√©rents √©tats d'animation. <br><br>  Prenez, par exemple, l'animation des personnages: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/535/bf0/e94/535bf0e940d917fc81734e0747a71de1.png"></div><br>  Nous avons un mod√®le en trois dimensions d'un homme et il y a plusieurs de ses animations: <br><br><ul><li>  inactif - reste immobile; </li><li>  marcher - va de l'avant; </li><li>  assis </li><li>  bonjour - agite une main. </li></ul><br>  L'approche classique de la gestion des animations est la suivante: si vous voulez que l'objet se tienne - allumez le ralenti, marchez-marchez, asseyez-vous.  Mais cela pr√©sente certaines difficult√©s. <br><br>  Tout d'abord, vous devez contr√¥ler manuellement la dur√©e et la s√©quence des animations.  Par exemple, pour qu'une personne s'assoie, vous devez d'abord lire l'animation, comment elle s'assoit, puis commencer √† lire l'animation en boucle, o√π la personne est d√©j√† assise.  La personnalisation des articulations de ces animations dans le code est difficile et peu pratique. <br><br>  Deuxi√®mement, les articulations entre les animations deviennent visibles si les extr√©mit√©s de l'animation ne correspondent pas, ou si nous devons inclure une autre animation au milieu de l'animation actuelle.  Dans ce cas, il est tout simplement impossible de faire correspondre parfaitement les animations.  Rappelez-vous les anciens jeux o√π les animations des personnages changeaient instantan√©ment. <br><br>  Le graphique d'animation est con√ßu pour r√©soudre ces probl√®mes.  Avec lui, vous n'avez pas besoin de faire fonctionner les animations manuellement, maintenant vous travaillez avec des √©tats.  La fa√ßon dont un objet sera anim√© pour atteindre cet √©tat est le travail des animateurs et des concepteurs.  Maintenant, le programmeur ne pense pas au timing et √† la s√©quence de l'animation, il indique simplement dans quel √©tat l'objet doit entrer. <br><br>  De plus, avec le graphique d'animation, le probl√®me de la jonction d'animations dispara√Æt.  Dans la transition entre les √©tats, nous pouvons effectuer une transition en douceur d'une animation √† une autre.  Cela se fait en utilisant des poids.  Le poids est un facteur de m√©lange de 0 √† 1, o√π 0 signifie que l'animation n'affecte en aucune fa√ßon l'objet et 1 l'affecte compl√®tement. <br><br>  Par exemple, la transition entre la marche (ralenti) et la position debout (ralenti) est tr√®s exigeante pour la mise en place du processus.  √Ä tout moment dans l'animation de marche, le personnage peut s'arr√™ter.  Par cons√©quent, la transition n'est pas effectu√©e instantan√©ment, mais pendant une courte p√©riode de temps.  √Ä ce moment, le poids de marche diminue de 1 √† 0 et le poids debout de 0 √† 1. Il est important que la somme des poids soit √©gale √† un, sinon des artefacts peuvent appara√Ætre. <br><br><h2>  Comment √ßa marche? </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/94d/fc8/f36/94dfc8f3609b5f7353813ee40fa071b6.gif"></div><br>  Un graphique se compose d'√©tats et de transitions.  Un √©tat est un ensemble de contr√¥leurs d'animation, chacun pouvant jouer une sorte d'animation sur un objet ou ex√©cuter une sorte de logique.  Le contr√¥leur a des points d'entr√©e et de sortie - ce sont les moments o√π le graphique active l'√©tat avec ce contr√¥leur et le d√©sactive en cons√©quence.  Le contr√¥leur a √©galement une fonction de mise √† jour, o√π, en plus de l'intervalle de temps de la derni√®re image, vient le poids de la transition.  Pour mixer des animations, il faut en tenir compte. <br><br>  Les contr√¥leurs ont une interface unique.  De plus, les d√©veloppeurs peuvent ajouter leurs contr√¥leurs.  Par exemple, vous pouvez cr√©er un contr√¥leur qui ex√©cute une sorte de logique ou d√©finit du texte dans une fen√™tre contextuelle, etc.  Cette personnalisation simple vous permet d'utiliser le graphique d'animation de mani√®re tr√®s flexible. <br><br>  Nous avons √©galement des variables.  Ces variables peuvent √™tre d√©finies en externe, y compris √† partir du code, puis lues dans les contr√¥leurs.  Ainsi, par exemple, vous pouvez basculer une sorte d'animation pour un personnage sur le m√™me √©tat.  En g√©n√©ral, vous pouvez m√™me r√©p√©ter le paradigme de transition entre les √©tats √† travers des variables et des conditions, comme Unity.  En conjonction avec des contr√¥leurs personnalisables, cela s'av√®re tr√®s pratique. <br><br>  Les transitions peuvent √™tre n'importe quel nombre.  De nombreuses transitions peuvent entrer en √©tat et sortir de la m√™me mani√®re de mani√®re illimit√©e.  Les transitions d√©terminent la possibilit√© d'atteindre des √âtats.  Par exemple, s'il n'y a pas de transition directement entre les √©tats A et F, mais qu'il y a une cha√Æne A ‚Üí B ‚Üí C ‚Üí D ‚Üí E ‚Üí F, alors lorsque vous demandez une transition de A √† F, le graphique lui-m√™me comprendra qu'il doit passer par les √©tats interm√©diaires B, C, D et E. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca5/a75/506/ca5a755065638088486c8aaae5e30eb3.png"></div><br>  Les transitions ont des param√®tres et des dur√©es d'intervalle de d√©marrage.  Avec la dur√©e, tout est simple - c'est le temps pour lequel la transition se fera.  Mais l'intervalle est d√©j√† plus compliqu√©: il d√©termine la p√©riode de temps acceptable pour l'animation lorsque la transition peut √™tre lanc√©e. <br><br>  Par exemple, pour qu'un personnage puisse s'asseoir, vous devez d'abord jouer l'animation pendant qu'il s'assoit, puis d√©marrer l'animation de si√®ge.  Dans ce cas, l'intervalle de transition de "s'asseoir" √† "s'asseoir" devrait √™tre √† la fin de l'animation "s'assoit" afin que nous puissions voir comment il s'assoit, puis √† la fin, rapidement mais sans √†-coup, entrer dans l'animation du si√®ge. <br><br>  Autre exemple: un personnage marche et il doit s'arr√™ter.  Dans ce cas, l'intervalle de d√©but de transition doit √™tre sur toute la longueur de l'animation, car le personnage peut s'arr√™ter √† tout moment. <br><br>  Le graphique d'animation fait tout le travail connexe: <br><br><ul><li>  pr√©voit un chemin vers l'√©tat n√©cessaire; </li><li>  Met √† jour les √©tats en cours d'ex√©cution </li><li>  effectue une transition en douceur entre les √âtats; </li><li>  ajuste les poids en eux. </li></ul><br><h2>  Fonctionnalit√©s int√©ressantes </h2><br>  Il existe de nombreux types d'animations dans le moteur Playrix: mod√®les 3D, colonne vert√©brale, Flash, effets de particules, animation squelettique.  Chaque type a un contr√¥leur sp√©cifique. <br><br>  En plus de simples contr√¥leurs d'animation, nous en avons plusieurs auxiliaires.  Par exemple, un contr√¥leur al√©atoire.  Il peut inclure une liste d'autres contr√¥leurs et la probabilit√© de leur choix.  Chaque fois qu'un objet entre dans un √©tat avec un tel contr√¥leur randomis√©, la s√©lection al√©atoire prend en compte les probabilit√©s et le contr√¥leur s√©lectionn√© commence √† fonctionner.  Les autres sont endormis et inactifs, attendant leur moment. <br><br>  Mais parfois, sur un √©tat, nous devons changer d'animation.  Par exemple, si plusieurs personnages ont le m√™me graphique et ont tous une sorte d'animation d'action.  Un personnage doit obtenir son balai et commencer sa vengeance, un autre pour obtenir son appareil photo et commencer √† prendre des photos, le troisi√®me mange de la glace.  Pour de telles situations, il existe un contr√¥leur sp√©cial, qui contient √©galement une liste de contr√¥leurs, mais, contrairement aux contr√¥leurs al√©atoires, il s√©lectionne ici un contr√¥leur en fonction de la variable. <br><br>  Les variables sont d√©finies dans le graphique et peuvent √™tre modifi√©es en externe, par exemple √† partir du code.  Dans cet exemple, un type de cha√Æne est utilis√© et chaque type d'action correspond √† une certaine valeur de la variable.  Lorsqu'un personnage est cr√©√© dans le jeu, cette variable lui est fix√©e en fonction du comportement souhait√©. <br><br>  Nous avons √©galement un contr√¥leur qui peut m√©langer plusieurs animations.  Par exemple, vous pouvez m√©langer des animations de marche, gauche, droite et avant.  Ainsi, dans les virages, vous pouvez ajuster les poids entre eux afin que les jambes du personnage ne glissent pas et que la marche semble naturelle. <br><br><h2>  Nous devons aller plus loin </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c17/ad8/196/c17ad819664185e383a0a5942fcbf7ef.png"></div><br>  Il y a beaucoup d'avantages √† faire notre unit√©.  L'un d'eux est que nous pouvons faire ce que nous voulons et ce que nous voulons.  Et nous voulions une possibilit√© illimit√©e d'√©tendre le graphique d'animation. <br><br>  Nous avons une interface de contr√¥leur, il y a plusieurs contr√¥leurs ¬´pr√™ts √† l'emploi¬ª, et il y a la possibilit√© de mettre en ≈ìuvre l'interface et de faire n'importe quoi (et pas n√©cessairement une animation): <br><br><ul><li>  changer le texte sur le bouton; </li><li>  interagir avec d'autres objets de la hi√©rarchie; </li><li>  et m√™me g√©rer un autre graphique d'animation. </li></ul><br>  Nous avons utilis√© cette approche chez les visiteurs du zoo dans le jeu Wildscapes.  Chaque visiteur dispose de deux graphiques: l'un pour animer le mod√®le, l'autre pour animer le comportement. <br><br>  Le premier graphique est assez simple, il contr√¥le la marche, peut jouer des animations de personnages distinctes. <br><br>  Le deuxi√®me graphique est beaucoup plus compliqu√© et comporte certains sc√©narios de comportement.  Par exemple, d'abord le personnage s'en va, puis s'assoit sur un banc, salue quelqu'un, prend des photos et continue.  Il s'agit d'une branche d'√âtat distincte. <br><br>  Cette logique pourrait √™tre plac√©e sur la premi√®re colonne, mais ensuite les animations seraient dupliqu√©es plusieurs fois.  Mais avec deux graphiques, tout est beaucoup plus simple.  Le graphique de contr√¥le contient une cha√Æne d'√©tats, y compris les √©tats du premier graphique, qui s'ex√©cute en parall√®le. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1e/4c7/eb5/e1e4c7eb5f1ca273a001c98e5c61c6e6.png"></div><br><h2>  Et ensuite? </h2><br>  Notre graphique en sait d√©j√† beaucoup, mais il y a encore beaucoup de place pour le d√©veloppement.  Les plans font un groupement de plusieurs √©tats, avec embo√Ætement.  Cela simplifiera consid√©rablement les colonnes de qu√™te.  Les plans comprennent √©galement des travaux visant √† am√©liorer l'affichage des graphiques et des liens.  Maintenant, les connexions sur les grands graphiques ressemblent √† des spaghettis (m√™me la couleur est similaire), et parfois il est facile de se confondre. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr471956/">https://habr.com/ru/post/fr471956/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr471940/index.html">Comment r√©duire le risque de d√©faillance dans les r√®glements diff√©r√©s: l'affacturage pour les entreprises</a></li>
<li><a href="../fr471942/index.html">Selon vos besoins: test professionnel des SSD Kingston DC500R et DC500M</a></li>
<li><a href="../fr471948/index.html">Jouez dans la bo√Æte</a></li>
<li><a href="../fr471950/index.html">Ma vision de l'avenir D</a></li>
<li><a href="../fr471954/index.html">Radio Internet propre</a></li>
<li><a href="../fr471958/index.html">Amazon EX Windows en GA avec des bugs, mais plus rapide que quiconque</a></li>
<li><a href="../fr471960/index.html">Op√©ration TA505, deuxi√®me partie: apprentissage de la porte d√©rob√©e ServHelper avec NetSupport RAT</a></li>
<li><a href="../fr471962/index.html">Riise de l'oracle</a></li>
<li><a href="../fr471964/index.html">Les oracles viennent √† la rescousse</a></li>
<li><a href="../fr471968/index.html">Rencontrez le ran√ßongiciel Nemty √† partir d'un faux site PayPal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>