<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✅ 🤵🏻 👨‍👨‍👧 Pembuatan konfigurasi untuk nginx, riwayat satu permintaan tarik 👰🏿 🧘 👐🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salam, kawan. Di server pertempuran saya, nginx yang indah telah berputar sejak 2006 dan selama bertahun-tahun pemerintahannya saya telah mengumpulkan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pembuatan konfigurasi untuk nginx, riwayat satu permintaan tarik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448522/"> Salam, kawan.  Di server pertempuran saya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nginx yang</a> indah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">telah</a> berputar sejak 2006 dan selama bertahun-tahun pemerintahannya saya telah mengumpulkan banyak konfigurasi dan template.  Saya sangat memuji nginx dan ternyata hub nginx di Habr juga memulai saya, Ponte \ m / <br><br>  Teman-teman meminta saya untuk membuat pertanian pengembangan untuk mereka, dan alih-alih menyeret mereka dengan templat khusus saya, saya ingat proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nginxconfig.io</a> yang menarik, yang mencerai-beraikan konfigurasi dan menyiapkan segala sesuatu untuk memungkinkan enkripsi, dll.  Saya pikir, mengapa tidak?  Namun, saya sangat marah dengan fakta bahwa nginxconfig menawarkan saya untuk mengunduh arsip zip ke browser, tidak mengizinkan saya untuk menggabungkannya langsung ke server menggunakan wget / fetch / curl.  Omong kosong macam apa, mengapa saya membutuhkannya di browser, saya membutuhkannya di server dari konsol.  Marah, saya naik ke github untuk melihat nyali proyek, yang menyebabkan garpu dan, sebagai hasilnya, menarik permintaan.  Tentang yang saya tidak akan menulis jika itu tidak menarik;) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf1/0c3/6c3/cf10c36c3b10ad401a5a0f94f4074384.svg" alt="gambar"><a name="habracut"></a><br><br>  Tentu saja, sebelum memilih sumber, saya melihat dari mana krom menarik arsip zip yang dihasilkan dengan konfigurasi, dan di sana saya menunggu alamat yang dimulai dengan "gumpalan:", oppa.  Sudah menjadi jelas bahwa dalam prosesnya layanan tidak menghasilkan apa-apa, pada kenyataannya bahwa js melakukan semua ini.  Memang, arsip zip dihasilkan oleh klien itu sendiri, peramban, javascript.  Yaitu  pesona adalah bahwa proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nginxconfig.io</a> dapat dengan mudah disimpan sebagai halaman html, diunggah ke beberapa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">narod.ru</a> dan itu akan berfungsi) Ini adalah solusi yang sangat lucu dan menarik, namun, sangat merepotkan untuk menyiapkan server, pada kenyataannya, untuk untuk apa proyek ini dibuat.  Unduh arsip yang dihasilkan oleh browser, lalu transfer ke server menggunakan nc ... pada tahun 2019?  Saya mengatur sendiri tugas menemukan cara untuk mengunduh konfigurasi yang dihasilkan langsung ke server. <br><br>  Setelah melakukan proyek ini, saya mulai memikirkan opsi apa yang saya miliki.  Tugas itu diperumit oleh kenyataan bahwa saya tidak ingin menyimpang dari kondisi bahwa proyek harus tetap menjadi front-end yang bersih, tanpa back-end.  Tentu saja, solusi paling sederhana adalah dengan menarik nodejs, dan membuatnya menghasilkan arsip dengan konfigurasi melalui tautan langsung. <br><br>  Padahal, tidak banyak pilihan.  Lebih tepatnya, hanya satu yang terpikir.  Kita perlu mengkonfigurasi konfigurasi dan mendapatkan tautan yang bisa kita salin ke konsol server untuk mendapatkan arsip zip. <br><br>  Beberapa file teks dalam arsip zip yang dihasilkan berbobot sedikit, secara harfiah beberapa kilobyte.  Solusi yang jelas adalah untuk mendapatkan string base64 dari arsip zip yang dihasilkan dan membuangnya ke buffer, sementara di server dengan perintah di konsol <br><pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'base64string'</span></span> | base64 --decode &gt; config.zip</code> </pre>  kita bisa membuat file yang sangat zip ini. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nginxconfig.io</a> ditulis dalam AngularJS, saya bahkan tidak bisa membayangkan berapa kilometer kode yang diperlukan jika penulis tidak memilih kerangka kerja js reaktif.  Tapi saya membayangkan dengan sempurna betapa jauh lebih mudah dan lebih indah akan mungkin untuk menerapkan semua ini di VueJS, meskipun ini sudah menjadi topik yang sangat berbeda. <br><br>  Dalam sumber daya proyek kami melihat metode menghasilkan arsip zip: <br><br><pre> <code class="javascript hljs">$scope.downloadZip = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> zip = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSZip(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourceCodes = $<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.document.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'main .file .code.source'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; sourceCodes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourceCode = sourceCodes[i]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = sourceCode.dataset.filename; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = sourceCode.children[<span class="hljs-number"><span class="hljs-number">0</span></span>].children[<span class="hljs-number"><span class="hljs-number">0</span></span>].innerText; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$scope.isSymlink() &amp;&amp; name.match(<span class="hljs-regexp"><span class="hljs-regexp">/^sites-available\//</span></span>)) { name = name.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^sites-available\//</span></span>, <span class="hljs-string"><span class="hljs-string">'sites-enabled/'</span></span>); } zip.file(name, content); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name.match(<span class="hljs-regexp"><span class="hljs-regexp">/^sites-available\//</span></span>)) { zip.file(name.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^sites-available\//</span></span>, <span class="hljs-string"><span class="hljs-string">'sites-enabled/'</span></span>), <span class="hljs-string"><span class="hljs-string">'../'</span></span> + name, { <span class="hljs-attr"><span class="hljs-attr">unixPermissions</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-string"><span class="hljs-string">'120755'</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>), }); } } zip.generateAsync({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'blob'</span></span>, <span class="hljs-attr"><span class="hljs-attr">platform</span></span>: <span class="hljs-string"><span class="hljs-string">'UNIX'</span></span>, }).then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">content</span></span></span><span class="hljs-function">) </span></span>{ saveAs(content, <span class="hljs-string"><span class="hljs-string">'nginxconfig.io-'</span></span> + $scope.getDomains().join(<span class="hljs-string"><span class="hljs-string">','</span></span>) + <span class="hljs-string"><span class="hljs-string">'.zip'</span></span>); }); gtag(<span class="hljs-string"><span class="hljs-string">'event'</span></span>, $scope.getDomains().join(<span class="hljs-string"><span class="hljs-string">','</span></span>), { <span class="hljs-attr"><span class="hljs-attr">event_category</span></span>: <span class="hljs-string"><span class="hljs-string">'download_zip'</span></span>, }); };</code> </pre><br>  semuanya cukup sederhana, menggunakan perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">jszip</a> , zip dibuat di mana file konfigurasi ditempatkan.  Setelah membuat arsip zip, js memasukkannya ke browser menggunakan perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">FileSaver.js</a> : <br><br><pre> <code class="javascript hljs">saveAs(content, <span class="hljs-string"><span class="hljs-string">'nginxconfig.io-'</span></span> + $scope.getDomains().join(<span class="hljs-string"><span class="hljs-string">','</span></span>) + <span class="hljs-string"><span class="hljs-string">'.zip'</span></span>);</code> </pre><br>  di mana konten adalah objek arsip gumpalan zip yang dihasilkan. <br><br>  Ok, yang harus saya lakukan adalah menambahkan tombol lain di sebelahnya, dan ketika saya mengkliknya, jangan menyimpan arsip zip yang dihasilkan ke browser, tetapi dapatkan kode base64 dari itu.  Setelah sedikit perdukunan, saya mendapatkan 2 metode, bukan satu downloadZip: <br><br><pre> <code class="javascript hljs">$scope.downloadZip = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ generateZip(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">content</span></span></span><span class="hljs-function">) </span></span>{ saveAs(content, <span class="hljs-string"><span class="hljs-string">'nginxconfig.io-'</span></span> + $scope.getDomains().join(<span class="hljs-string"><span class="hljs-string">','</span></span>) + <span class="hljs-string"><span class="hljs-string">'.zip'</span></span>); }); gtag(<span class="hljs-string"><span class="hljs-string">'event'</span></span>, $scope.getDomains().join(<span class="hljs-string"><span class="hljs-string">','</span></span>), { <span class="hljs-attr"><span class="hljs-attr">event_category</span></span>: <span class="hljs-string"><span class="hljs-string">'download_zip'</span></span>, }); }; $scope.downloadBase64 = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ generateZip(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">content</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileReader(); reader.readAsDataURL(content); reader.onloadend = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> base64 = reader.result.replace(<span class="hljs-regexp"><span class="hljs-regexp">/^data:.+;base64,/</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   base64     zip    base64  } }); gtag('event', $scope.getDomains().join(','), { event_category: 'download_base64', }); };</span></span></code> </pre><br>  Seperti yang Anda lihat, saya menempatkan generasi arsip zip ke dalam metode generateZip pribadi, karena  ini AngularJS, dan penulis sendiri mematuhi panggilan balik, tidak menerapkannya melalui janji.  downloadZip masih melakukan saveAs dalam output, sedangkan downloadBase64 sedikit berbeda.  Kami membuat objek FileReader yang datang kepada kami di html5 dan sudah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tersedia</a> untuk digunakan.  Yang, pada waktunya, tahu bagaimana membuat string base64 dari gumpalan, lebih tepatnya membuat string DataURL, tetapi ini tidak begitu penting bagi kami, karena  DataURL berisi persis apa yang kita butuhkan.  Bingo, tangkapan kecil sedang menunggu saya ketika saya mencoba untuk menempatkan semua ini dalam buffer.  Penulis menggunakan pustaka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">clipboard</a> dalam proyek, yang memungkinkan bekerja dengan clipboard tanpa objek flash, berdasarkan pada teks yang dipilih.  Awalnya, saya memutuskan untuk meletakkan base64 saya di sebuah elemen dengan tampilan: tidak;, tetapi dalam kasus itu saya tidak bisa meletakkannya di clipboard, karena  tidak ada seleksi.  Karena itu, alih-alih tampilan: tidak ada;  saya lakukan <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">position</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">absolute</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">z-index</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">opacity</span></span>: 0;</code> </pre><br>  yang memungkinkan saya untuk menyembunyikan elemen dari mata saya dan bahkan meninggalkannya di halaman.  Voila, tugas selesai, ketika saya mengklik tombol saya, baris formulir ditempatkan di buffer: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'base64string'</span></span> | base64 --decode &gt; config.zip</code> </pre> <br>  yang saya cukup masukkan ke konsol di server dan segera menerima arsip zip dengan semua konfigurasi. <br><br>  Yah, tentu saja, saya melemparkan permintaan tarik kepada penulis, karena  proyek ini aktif dan hidup, saya ingin melihat pembaruan dari penulis dan memiliki tombol sendiri) Siapa yang peduli, ini <a href="">garpu</a> proyek dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tarik permintaan sendiri</a> , di mana Anda dapat melihat apa yang saya perbaiki / perbarui. <br><br>  Pengembangan semangat :-) <br><br><img src="https://habrastorage.org/webt/et/op/sv/etopsv7os4ew9wv8kkccgvvbw78.gif"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id448522/">https://habr.com/ru/post/id448522/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id448504/index.html">Mereka mengumpulkan untuk semua orang "Habrom" buku referensi "Oleh siapa itu diterbitkan ..." untuk paspor. Unduh untuk kesehatan</a></li>
<li><a href="../id448506/index.html">Matrix berusia 20 tahun: bagaimana Wachowski membuat cyberpunk, yang menentukan agenda untuk seluruh generasi</a></li>
<li><a href="../id448510/index.html">Acer in 2019: bagaimana jika Anda menghapus semua lalat dari laptop gaming</a></li>
<li><a href="../id448516/index.html">Evolusi atau buat basis untuk robot pada platform ARDUINO, dan kami menggerakkan sensor dan video ke komputer melalui smartphone</a></li>
<li><a href="../id448518/index.html">Bagaimana cara melihat lubang hitam?</a></li>
<li><a href="../id448524/index.html">Ilmuwan Israel untuk pertama kalinya di dunia mencetak hati yang hidup</a></li>
<li><a href="../id448528/index.html">Layanan VPN Wireguard Gratis di AWS</a></li>
<li><a href="../id448530/index.html">Bagaimana Megaphone tidur di langganan seluler</a></li>
<li><a href="../id448532/index.html">Pusat Data Luar Angkasa. Ringkas percobaan</a></li>
<li><a href="../id448534/index.html">Mengapa kita membutuhkan sakelar industri dengan EMC yang ditingkatkan?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>