<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óÄÔ∏è üèª üíã Como construir uma pir√¢mide no tronco ou nos aplicativos de desenvolvimento orientados a teste no Spring Boot üë®üèª‚Äç‚öñÔ∏è ‚öúÔ∏è üíÜüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Spring Framework √© frequentemente citado como um exemplo do framework Cloud Native , projetado para funcionar na nuvem, desenvolver aplicativos de d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como construir uma pir√¢mide no tronco ou nos aplicativos de desenvolvimento orientados a teste no Spring Boot</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431306/"><p> <em>O Spring Framework √©</em> frequentemente citado como um exemplo do framework <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cloud Native</a> , projetado para funcionar na nuvem, desenvolver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aplicativos de doze fatores</a> , microsservi√ßos e um dos produtos mais est√°veis, mas ao mesmo tempo inovadores.  Mas neste artigo, gostaria de me debru√ßar sobre um lado mais forte do Spring: √© o suporte ao <em>desenvolvimento por meio de testes</em> (capacidade TDD?).  Apesar da conectividade TDD, notei com frequ√™ncia que os projetos Spring ignoram algumas pr√°ticas recomendadas para teste, inventam suas pr√≥prias bicicletas ou n√£o escrevem testes porque s√£o "lentos" ou "n√£o confi√°veis".  E explicarei exatamente como escrever testes <strong>r√°pidos</strong> e <strong>confi√°veis</strong> para aplicativos no Spring Framework e conduzir o desenvolvimento por meio de testes.  Portanto, se voc√™ usa o Spring (ou deseja iniciar), entenda o que s√£o testes em geral (ou deseja entender) ou pense que <code>contextLoads</code> √© o n√≠vel necess√°rio e suficiente de testes de integra√ß√£o - ser√° interessante! </p><a name="habracut"></a><br><p>  O recurso "TDD" √© muito amb√≠guo e pouco mensur√°vel, mas, no entanto, o Spring tem muitas coisas que, por design, ajudam a escrever testes de integra√ß√£o e unidade com um m√≠nimo de esfor√ßo.  Por exemplo: </p><br><ul><li>  Teste de integra√ß√£o - voc√™ pode facilmente iniciar o aplicativo, bloquear componentes, redefinir par√¢metros etc. </li><li>  Teste de integra√ß√£o de foco - somente acesso a dados, apenas web etc. </li><li>  Suporte pronto para uso - bancos de dados em mem√≥ria, filas de mensagens, autentica√ß√£o e autoriza√ß√£o em testes </li><li>  Teste atrav√©s de contratos (Spring Cloud Contract) </li><li>  Suporte √† Web UI Testing usando HtmlUnit </li><li>  Flexibilidade de configura√ß√£o de aplicativos - perfis, configura√ß√µes de teste, componentes etc. </li><li>  E muito mais </li></ul><br><p>  Para come√ßar, uma pequena mas necess√°ria introdu√ß√£o sobre TDD e testes em geral. </p><br><h1 id="test-driven-development">  Desenvolvimento orientado a testes </h1><br><p>  O TDD √© baseado em uma id√©ia muito simples - escrevemos testes <strong>antes de</strong> escrever c√≥digo.  Em teoria, parece assustador, mas depois de algum tempo chega a compreens√£o de pr√°ticas e t√©cnicas, e a op√ß√£o de escrever testes <em>depois</em> causa desconforto tang√≠vel.  Uma das principais pr√°ticas √© a <em>itera√ß√£o</em> , ou seja,  fa√ßa tudo itera√ß√µes pequenas e focadas, cada uma delas descrita como um <strong>refator vermelho-verde</strong> . </p><br><p>  Na fase <strong>vermelha</strong> , escrevemos um teste de queda, e √© muito importante que ele caia com uma raz√£o e descri√ß√£o claras e compreens√≠veis, e que o teste em si seja completo e passe quando o c√≥digo for escrito.  O teste deve verificar o <em>comportamento</em> , n√£o a <em>implementa√ß√£o</em> , ou seja,  siga a abordagem da caixa preta, ent√£o vou explicar o porqu√™. </p><br><p>  Na fase <strong>verde</strong> , escrevemos o <em>c√≥digo m√≠nimo necess√°rio</em> para passar no teste.  √Äs vezes, √© interessante praticar e deix√°-lo o mais louco poss√≠vel (embora seja melhor n√£o se deixar levar) e quando uma fun√ß√£o retorna um booleano dependendo do estado do sistema, o primeiro "passe" pode ser simplesmente <code>return true</code> . </p><br><p>  Na fase de <strong>refatora√ß√£o</strong> , que <em>s√≥</em> pode ser iniciada <em>quando todos os testes estiverem em verde</em> , refatoraremos o c√≥digo e o colocaremos em condi√ß√µes adequadas.  Nem √© necess√°rio para um peda√ßo de c√≥digo que escrevemos, portanto, √© importante come√ßar a refatorar em um sistema est√°vel.  A abordagem de "caixa preta" ajudar√° apenas a refatora√ß√£o, alterando a implementa√ß√£o, mas n√£o afetando o comportamento. </p><br><p>  Falarei sobre diferentes aspectos do TDD no futuro, afinal, essa √© a ideia de uma s√©rie de artigos, ent√£o agora n√£o vou me concentrar nos detalhes.  Mas, antes de responder √†s cr√≠ticas padr√£o do TDD, mencionarei alguns mitos que ou√ßo com frequ√™ncia. </p><br><ul><li>  <em>"TDD √© cerca de 100% de cobertura do c√≥digo, mas n√£o oferece garantias"</em> - o desenvolvimento atrav√©s de testes n√£o tem nenhuma rela√ß√£o com 100% de cobertura.  Em muitas equipes em que trabalhei, essa m√©trica nem sequer foi medida e foi classificada como vaidade.  E sim, 100% da cobertura do teste n√£o significa nada. </li><li>  <em>"O TDD funciona apenas para fun√ß√µes simples; um aplicativo real com um banco de dados e um estado dif√≠cil n√£o podem ser criados com ele"</em> √© uma desculpa muito popular, geralmente complementada por "Temos um aplicativo t√£o complicado que n√£o escrevemos testes, voc√™ n√£o pode faz√™-lo".  Eu vi uma abordagem TDD funcional em aplicativos completamente diferentes - Web (com e sem SPA), m√≥vel, API, microsservi√ßos, mon√≥litos, sistemas banc√°rios complexos, plataformas em nuvem, estruturas, plataformas de varejo escritas em diferentes idiomas e tecnologias.  Portanto, o mito popular ‚ÄúSomos √∫nicos, tudo √© diferente‚Äù costuma ser uma desculpa para n√£o investir esfor√ßo e dinheiro em testes, mas n√£o √© um motivo real (embora tamb√©m possa haver motivos reais). </li><li>  <em>"Ainda haver√° erros no TDD"</em> - √© claro, como em qualquer outro software.  TDD n√£o √© sobre bugs ou sua aus√™ncia, √© uma ferramenta de desenvolvimento.  Como depura√ß√£o.  Como um IDE.  Como a documenta√ß√£o.  Nenhuma dessas ferramentas garante a aus√™ncia de bugs, elas apenas ajudam a lidar com a crescente complexidade do sistema. </li></ul><br><blockquote>  O principal objetivo do TDD e geralmente testar √© dar √† equipe a <strong>confian√ßa de</strong> que o sistema est√° funcionando de maneira est√°vel.  Portanto, nenhuma das pr√°ticas de teste determina quantos e quais testes gravar.  Escreva quanto voc√™ acha necess√°rio, quanto voc√™ precisa ter certeza de que agora o c√≥digo <em>pode ser colocado em produ√ß√£o e funcionar√°</em> .  H√° pessoas que consideram os testes de integra√ß√£o r√°pida como uma caixa preta ultimativa necess√°ria e suficiente, e os testes de unidade opcionais.  Algu√©m diz que o e2e testa com a possibilidade de uma revers√£o r√°pida para a vers√£o anterior e a presen√ßa de lan√ßamentos de can√°rios n√£o √© t√£o cr√≠tica.  Quantas equipes - tantas abordagens, √© importante encontrar a sua. </blockquote><p>  Um dos meus objetivos √© me afastar do formato <em>‚Äúdesenvolvimento atrav√©s do teste de uma fun√ß√£o que adiciona dois n√∫meros‚Äù</em> na hist√≥ria do TDD e olhar para um aplicativo real, um tipo de pr√°tica de teste que foi evaporada para um aplicativo m√≠nimo, coletada em projetos reais.  Como um exemplo semi-real, usarei um pequeno aplicativo da Web que eu mesmo inventei para resumo <del>  f√°bricas </del>  Padaria - <strong>F√°brica de Bolos</strong> .  Eu pretendo escrever pequenos artigos, concentrando-me cada vez em uma parte separada da funcionalidade do aplicativo e mostrar atrav√©s do TDD que voc√™ pode projetar APIs, a estrutura interna do aplicativo e manter refatora√ß√£o constante. </p><br><p>  Um plano de amostra para uma s√©rie de artigos, como eu vejo no momento, √©: </p><br><ol><li>  Esqueleto ambulante - estrutura de aplicativo onde voc√™ pode executar o ciclo Refatorar Vermelho-Verde </li><li>  Teste de UI e design orientado a comportamento </li><li>  Teste de acesso a dados (Spring Data) </li><li>  Teste de autoriza√ß√£o e autentica√ß√£o (Spring Security) </li><li>  Jet Stack (WebFlux + Reator de Projeto) </li><li>  Interoperabilidade de (micro) servi√ßos e contratos (Spring Cloud) </li><li>  Testando o servi√ßo de enfileiramento de mensagens (Spring Cloud) </li></ol><br><p>  Este artigo introdut√≥rio abordar√° os pontos 1 e 2 - vou criar uma estrutura de aplicativo e um teste b√°sico de interface do usu√°rio usando a abordagem BDD - ou <strong>desenvolvimento orientado a comportamento</strong> .  Cada artigo come√ßar√° com uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hist√≥ria de usu√°rio</a> , mas n√£o falarei sobre a parte "produto" para economizar tempo.  A hist√≥ria do usu√°rio ser√° escrita em ingl√™s, logo ficar√° claro o porqu√™.  Todos os exemplos de c√≥digo podem ser encontrados no GitHub, portanto, n√£o analisarei todo o c√≥digo, apenas as partes importantes. </p><br><blockquote>  A hist√≥ria do usu√°rio √© uma descri√ß√£o de um recurso de um aplicativo de linguagem natural que geralmente √© escrito em nome de um usu√°rio do sistema. </blockquote><br><h1 id="user-story-1-polzovatel-vidit-stranicu-privetstviya">  Hist√≥ria do usu√°rio 1: o usu√°rio v√™ a p√°gina de boas-vindas </h1><br><blockquote>  <strong>Como</strong> Alice, uma nova usu√°ria <br>  <strong>Quero</strong> ver uma p√°gina de boas-vindas ao visitar o site Cake Factory <br>  <strong>Para que</strong> eu saiba quando a Cake Factory est√° prestes a lan√ßar <br><br>  Crit√©rios de aceita√ß√£o: <br>  Cen√°rio: um usu√°rio que visita a visita ao site antes da data de lan√ßamento <br>  Dado que eu sou um novo usu√°rio <br>  Quando visito o site da Cake Factory <br>  Ent√£o, vejo a mensagem "Obrigado pelo seu interesse" <br>  E vejo uma mensagem 'O site est√° chegando em breve ...' </blockquote><p>  √â preciso conhecimento: o que √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Desenvolvimento Orientado a Comportamento</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pepino</a> , os princ√≠pios b√°sicos do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spring Boot Testing</a> . </p><br><p>  A primeira hist√≥ria do usu√°rio √© bastante b√°sica, mas o objetivo ainda n√£o √© complexo, mas na cria√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esqueleto ambulante</a> - um aplicativo m√≠nimo para iniciar o <strong>ciclo TDD</strong> . </p><br><p>  Depois de criar um novo projeto no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spring Initializr</a> com m√≥dulos Web e Bigode, para come√ßar, precisarei de mais algumas altera√ß√µes para <code>build.gradle</code> : </p><br><ul><li>  adicione <code>testImplementation('net.sourceforge.htmlunit:htmlunit')</code> HtmlUnit <code>testImplementation('net.sourceforge.htmlunit:htmlunit')</code> .  Voc√™ n√£o precisa especificar a vers√£o, o plug-in de gerenciamento de depend√™ncia do Spring Boot para Gradle selecionar√° automaticamente a vers√£o necess√°ria e compat√≠vel </li><li>  migrar um projeto da JUnit 4 para a JUnit 5 (porque 2018 est√° no quintal) </li><li>  adicionar depend√™ncias ao Cucumber - uma biblioteca que eu usarei para escrever especifica√ß√µes de BDD </li><li>  remover criado por padr√£o <code>CakeFactoryApplicationTests</code> com <code>contextLoads</code> inevit√°vel </li></ul><br><p>  Em geral, este √© o "esqueleto" b√°sico do aplicativo, voc√™ j√° pode escrever o primeiro teste. </p><br><p>  Para facilitar a navega√ß√£o no c√≥digo, falarei brevemente sobre as tecnologias usadas. </p><br><h2 id="cucumber">  Pepino </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O pepino</a> √© uma estrutura de <strong>desenvolvimento orientada</strong> a <strong>comportamento</strong> que ajuda a criar "especifica√ß√µes execut√°veis", ou seja,  executar testes (especifica√ß√µes) escritos em linguagem natural.  O plug-in Cucumber analisa o c√≥digo-fonte em Java (e muitas outras linguagens) e usa <em>defini√ß√µes de etapas</em> para executar o c√≥digo real.  As defini√ß√µes de etapa s√£o m√©todos de classe anotados por <code>@Given</code> , <code>@When</code> , <code>@Then</code> e outras anota√ß√µes. </p><br><h2 id="htmlunit">  Unidade html </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A home page do</a> projeto chama o HtmlUnit "de um navegador sem GUI para aplicativos Java".  Diferentemente do Selenium, o HtmlUnit n√£o inicia um navegador real e, mais importante, n√£o renderiza a p√°gina, trabalhando diretamente com o DOM.  O JavaScript √© suportado pelo mecanismo Mozilla Rhino.  O HtmlUnit √© adequado para aplicativos cl√°ssicos, mas n√£o muito amig√°vel com os aplicativos de p√°gina √∫nica.  Para come√ßar, ser√° suficiente e tentarei mostrar que mesmo coisas como uma estrutura de teste podem fazer parte da implementa√ß√£o, e n√£o a base do aplicativo. </p><br><h1 id="pervyy-test">  Primeiro teste </h1><br><p>  Agora, uma hist√≥ria de usu√°rio escrita em ingl√™s ser√° √∫til para mim.  O melhor gatilho para iniciar a pr√≥xima itera√ß√£o TDD √© o crit√©rio de aceita√ß√£o escrito de tal maneira que eles possam ser transformados em uma especifica√ß√£o execut√°vel com um m√≠nimo de gestos. </p><br><blockquote>  Idealmente, as hist√≥rias do usu√°rio devem ser escritas para que possam ser simplesmente copiadas para a especifica√ß√£o do BDD e executadas.  Isso est√° longe de ser sempre simples e nem sempre poss√≠vel, mas esse deve ser o objetivo do propriet√°rio do produto e de toda a equipe, embora nem sempre seja poss√≠vel. </blockquote><p>  Ent√£o, meu primeiro longa. </p><br><pre> <code class="plaintext hljs">Feature: Welcome page Scenario: a user visiting the web-site visit before the launch date Given a new user, Alice When she visits Cake Factory web-site Then she sees a message 'Thank you for your interest' And she sees a message 'The web-site is coming in December!'</code> </pre> <br><p>  Se voc√™ gerar descri√ß√µes de etapas (o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plugin Intellij IDEA</a> ajuda bastante no Gherkin) e executar o teste, √© claro que ser√° verde - ainda n√£o testa nada.  E aqui vem a fase importante do trabalho no teste - <em>voc√™ precisa escrever um teste, como se o c√≥digo principal tivesse sido escrito</em> . </p><br><p>  Freq√ºentemente, para quem come√ßa a banir o TDD, um estupor se instala aqui - √© dif√≠cil colocar na cabe√ßa os algoritmos e a l√≥gica de algo que ainda n√£o existe.  E, portanto, √© muito importante ter <em>itera√ß√µes</em> t√£o <em>pequenas e focadas</em> quanto poss√≠vel, come√ßando na hist√≥ria do usu√°rio e indo para o n√≠vel de integra√ß√£o e unidade.  √â importante se concentrar <strong>em um teste de cada vez</strong> e tentar se molhar e ignorar depend√™ncias que ainda n√£o s√£o importantes.  √Äs vezes, notei como as pessoas se afastam facilmente - crie uma interface ou classe para uma depend√™ncia, gere imediatamente uma classe de teste vazia, mais uma depend√™ncia √© adicionada l√°, outra interface √© criada e assim por diante. </p><br><blockquote>  Se a hist√≥ria for "seria necess√°rio atualizar o status ao salvar", √© muito dif√≠cil automatizar e formalizar.  No meu exemplo, cada etapa pode ser claramente definida em uma sequ√™ncia de etapas que podem ser descritas por c√≥digo.  √â claro que este √© o exemplo mais simples e n√£o mostra muito, mas espero que mais, com crescente complexidade, seja mais interessante. </blockquote><br><h2 id="red">  Vermelho </h2><br><p>  Portanto, no meu primeiro recurso, criei as seguintes descri√ß√µes de etapas: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span>(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WelcomePage</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> WebClient webClient; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HtmlPage page; <span class="hljs-meta"><span class="hljs-meta">@LocalServerPort</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> port; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String baseUrl; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ webClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient(); baseUrl = <span class="hljs-string"><span class="hljs-string">"http://localhost:"</span></span> + port; } <span class="hljs-meta"><span class="hljs-meta">@Given</span></span>(<span class="hljs-string"><span class="hljs-string">"a new user, Alice"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aNewUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// nothing here, every user is new by default } @When("she visits Cake Factory web-site") public void sheVisitsCakeFactoryWebSite() throws IOException { page = webClient.getPage(baseUrl); } @Then("she sees a message {string}") public void sheSeesAMessageThanksForYourInterest(String expectedMessage) { assertThat(page.getBody().asText()).contains(expectedMessage); } }</span></span></code> </pre> <br><p>  Alguns pontos a serem observados: </p><br><ul><li>  recursos s√£o iniciados por outro arquivo, <code>Features.java</code> usando a anota√ß√£o <code>RunWith</code> do JUnit 4, o Cucumber n√£o suporta a vers√£o 5, infelizmente </li><li>  <code>@SpringBootTest</code> anota√ß√£o <code>@SpringBootTest</code> √© adicionada √† descri√ß√£o das etapas, a <code>cucumber-spring</code> pega a partir da√≠ e configura o contexto de teste (ou seja, inicia o aplicativo) </li><li>  O aplicativo Spring para o teste come√ßa com <code>webEnvironment = RANDOM_PORT</code> e essa porta aleat√≥ria √© passada para o teste usando <code>@LocalServerPort</code> , o Spring encontrar√° essa anota√ß√£o e definir√° o valor do campo para a porta do servidor </li></ul><br><p>  E o teste, como esperado, falha com o erro <code>404 for http://localhost:51517</code> . </p><br><blockquote>  Os erros com os quais o teste trava s√£o incrivelmente importantes, especialmente quando se trata de testes de unidade ou integra√ß√£o, e esses erros fazem parte da API.  Se o teste falhar com uma <code>NullPointerException</code> isso n√£o √© muito bom, mas a <code>BaseUrl configuration property is not set</code> - muito melhor. </blockquote><br><h2 id="green">  Verde </h2><br><p>  Para tornar o teste verde, adicionei um controlador base e exibi-lo com o m√≠nimo de HTML: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IndexController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"index"</span></span>; } }</code> </pre> <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Cake Factory<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Thank you for your interest<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>The web-site is coming in December!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  O teste √© verde, o aplicativo funciona, embora seja feito na tradi√ß√£o de projetos de engenharia severos. </p><br><blockquote>  Em um projeto real e em uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">equipe equilibrada</a> , √© claro, eu me sentava com o designer e transformavamos o HTML puro em algo muito mais bonito.  Mas, no √¢mbito do artigo, um milagre n√£o acontecer√°, a princesa continuar√° sendo um sapo. </blockquote><p>  A pergunta ‚Äúque parte do TDD √© design‚Äù n√£o √© t√£o simples.  Uma das pr√°ticas que achei √∫teis √© a princ√≠pio nem olhar para a interface do usu√°rio (nem mesmo executar o aplicativo para poupar os nervos), escrever um teste, torn√°-lo verde - e, em seguida, ter uma base est√°vel, trabalhar no front-end, reiniciar constantemente os testes . </p><br><h2 id="refactor">  Refatorar </h2><br><p>  Na primeira itera√ß√£o, n√£o h√° refatora√ß√£o espec√≠fica, mas, embora eu tenha passado os √∫ltimos 10 minutos escolhendo um modelo para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bulma</a> , que pode ser contado como refatora√ß√£o! </p><br><h1 id="v-zaklyuchenie">  Em conclus√£o </h1><br><p>  Embora o aplicativo n√£o tenha trabalho de seguran√ßa, nem banco de dados, nem API, os testes e TDDs parecem bastante simples.  E, em geral, a partir da pir√¢mide de testes, toquei apenas no topo, o teste da interface do usu√°rio.  Mas nisso, em parte, o segredo da abordagem enxuta √© fazer tudo em pequenas itera√ß√µes, um componente de cada vez.  Isso ajuda a focar nos testes, simplific√°-los e controlar a qualidade do c√≥digo.  Espero que nos artigos a seguir sejam mais interessantes. </p><br><h1 id="ssylki">  Refer√™ncias </h1><br><ul><li>  Projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Concurso ci</a> </li></ul><br><p>  <em>PS: O t√≠tulo do artigo n√£o √© t√£o louco quanto parece no come√ßo, acho que muitos j√° imaginaram.</em>  <em>"Como construir uma pir√¢mide na sua bota" √© uma refer√™ncia √† pir√¢mide de teste (falarei mais sobre isso mais tarde) e ao Spring Boot, onde boot no ingl√™s brit√¢nico tamb√©m significa "trunk".</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt431306/">https://habr.com/ru/post/pt431306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt431296/index.html">Pap√©is emocionais nos jogos. Narra√ß√£o competente e envolvimento no fluxo</a></li>
<li><a href="../pt431298/index.html">Valida√ß√£o de exclusividade verdadeira</a></li>
<li><a href="../pt431300/index.html">Tr√™s anos de certifica√ß√£o sem l√≠deres - voo normal</a></li>
<li><a href="../pt431302/index.html">Fazendo uma simples antena de sonar com o lixo</a></li>
<li><a href="../pt431304/index.html">√Ä procura de sombras promissoras para roguelike</a></li>
<li><a href="../pt431308/index.html">Innotrans 2018: que tipo de transporte ferrovi√°rio ser√° amanh√£?</a></li>
<li><a href="../pt431310/index.html">Configure o Firefox / Chrome para internet muito lenta e limitada</a></li>
<li><a href="../pt431312/index.html">DeezLoader + PlexMediaServer. Criando um portal de m√∫sica em casa</a></li>
<li><a href="../pt431316/index.html">Vota√ß√£o na segunda vers√£o beta do Relat√≥rio Revisado 7 sobre Esquema de Linguagem Algor√≠tmica (Linguagem Grande)</a></li>
<li><a href="../pt431318/index.html">Cadeia de transpiladores Python ‚Üí 11l ‚Üí C ++ [para acelerar o c√≥digo Python e mais]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>