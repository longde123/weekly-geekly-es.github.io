<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§±üèø ü§±üèΩ ü•å IBM System i (aka AS / 400) - Como fizemos testes autom√°ticos de aplicativos em tela verde üóø üõµ üëáüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi Meu nome √© Anton Vorobyov, sou respons√°vel no Alfa Bank pelo desenvolvimento de aplicativos para um sistema banc√°rio centralizado. 

 Neste post, v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IBM System i (aka AS / 400) - Como fizemos testes autom√°ticos de aplicativos em tela verde</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfa/blog/446332/">  Oi  Meu nome √© Anton Vorobyov, sou respons√°vel no Alfa Bank pelo desenvolvimento de aplicativos para um sistema banc√°rio centralizado. <br><br>  Neste post, vou falar sobre o que s√£o os aplicativos de tela verde, por que eles s√£o necess√°rios e como fizemos os autotestes para eles, escrevendo nossa pr√≥pria solu√ß√£o para isso, o que nos permitiu acelerar os autotestes em 11 vezes. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ui/j8/z2/uij8z2alj0kcdqv2wtd_uo4yghq.jpeg"></a> <br><br>  A plataforma AS / 400 (Application System / 400) nasceu em 1988.  O primeiro sistema operacional desta plataforma √© o OS / 400, renomeado posteriormente para i5 / OS e ainda mais tarde para IBM i.  N√£o faz muito tempo, ela comemorou seu trig√©simo anivers√°rio. <br><br>  Mergulhando no mundo do desenvolvimento sob o sistema operacional IBM i, voc√™ entende que isso realmente n√£o √© "legado" no sentido cl√°ssico da palavra.  Este √© um ambiente diferente, completamente diferente, que √© um pouco semelhante aos sistemas Windows ou Unix usuais.  A principal tarefa deste sistema operacional √© ser o mais produtivo poss√≠vel no equipamento com o qual trabalha, e n√£o ser conveniente para o usu√°rio. <br><br>  IMHO, esse sistema operacional pode deix√°-lo louco por qu√£o ineficazes as abordagens usuais para escrever c√≥digo C ++ s√£o ineficazes (at√© dezenas de vezes a perda de CPU), que alguns antipadr√µes demonstrados em livros did√°ticos s√£o a melhor pr√°tica de c√≥digo eficaz e a fonte com a data da escrita para 1978, al√©m de montar sem problemas, tamb√©m funciona como projetado!  Tudo isso nos faz dar uma nova olhada nas abordagens modernas do desenvolvimento de software. <br><a name="habracut"></a><br><h2>  1. Introdu√ß√£o </h2><br>  A quest√£o de melhorar a qualidade do software em desenvolvimento excita as mentes de cada equipe de desenvolvimento.  Uma de nossas equipes de cr√©dito, cuja tarefa √© desenvolver e desenvolver a parte traseira do m√≥dulo para o sistema banc√°rio automatizado da Misys Equation, tamb√©m n√£o passou por esse momento.  A peculiaridade desse ABS √© que: <br><br><ul><li>  as primeiras vers√µes do ABS trabalharam sob o predecessor AS / 400 - a plataforma IBM System / 38 (apresentada em 1978) sob o CPF OS - "Control Program Facility"; </li><li>  Foi desenvolvido desde os anos 70 do s√©culo XX, e voc√™ pode encontrar um c√≥digo escrito antes de seu nascimento (muitos c√≥digos antigos); </li><li>  os recursos do trabalho com o ABS devem-se √† estreita integra√ß√£o com o IBM i e, devido √† colossal compatibilidade com vers√µes anteriores, parece que voc√™ est√° trabalhando como arque√≥logo nas escava√ß√µes da Grande Pir√¢mide. </li></ul><br><br><img src="https://habrastorage.org/webt/wu/va/gc/wuvagcwh4kmqi-fgc1sz_faezp0.jpeg"><br>  <i>IBM i (logotipo)</i> <br><br>  O desenvolvimento de aplicativos para esse ABS (op√ß√µes ABS) √© realizado de acordo com o padr√£o do Pacote T√©cnico do Misys ITP Integrator, que estipula que a op√ß√£o deve consistir em um programa interativo para intera√ß√£o do terminal com o usu√°rio final e implementar a API usando a interface instalada para execu√ß√£o em segundo plano . <br><br>  Tais programas interativos desenvolvidos no sistema operacional IBM i s√£o historicamente chamados de aplicativos de tela verde e s√£o a √∫nica UI com a qual o usu√°rio deste ABS interage. <br><br><h2>  O que √© um aplicativo de tela verde? </h2><br>  A resposta simples √© uma aplica√ß√£o que se parece com isso: <br><br><img src="https://habrastorage.org/webt/6m/gq/gy/6mgqgy4eklp7fvboyyeunnnazgy.jpeg"><br><br>  Ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ent√£o</a> : <br><br><img src="https://habrastorage.org/webt/cu/d2/km/cud2kmgmxlpe_9eqgxyymmqp9iy.png"><br><br><h2>  Por que aplicativos de tela verde? </h2><br>  Historicamente, os √∫nicos aplicativos interativos em execu√ß√£o nos sistemas de baixo e m√©dio alcance da fam√≠lia AS / 400 e outros mainframes IBM que permitem solicitar qualquer entrada do usu√°rio s√£o aplicativos de tela verde.  A instala√ß√£o, administra√ß√£o, configura√ß√£o e desenvolvimento no sistema operacional IBM i (e seus antecessores i5 / OS e AS400) foram realizadas (e ainda est√£o sendo realizadas em algum lugar) exclusivamente usando aplicativos de tela verde. <br><br>  A imagem do aplicativo de tela verde tem dois tamanhos - caracteres 24x80 e 27x132 e 16 cores poss√≠veis.  Nessa escala, a maioria do trabalho de desenvolvedores e usu√°rios deste sistema operacional √© realizada. <br><br>  Esses tamanhos de tela s√£o o resultado da evolu√ß√£o de "esta√ß√µes de trabalho" conectadas aos progenitores do AS400 nos segmentos de gama baixa e m√©dia dos computadores comerciais IBM System / 32, System / 34, System / 36 e System / 38.  Essas esta√ß√µes de trabalho eram chamadas de terminais e consistiam em uma tela em uma caixa de metal com um teclado e equipamento adicional na forma de uma caneta de luz.  Inicialmente, apenas duas cores de tela eram suportadas - verde e verde brilhante, raz√£o pela qual a frase estabelecida "aplicativo de tela verde" (aplicativo de tela verde na literatura inglesa) foi exclu√≠da.  Na d√©cada de 1970, o n√∫mero de cores suportadas aumentou para 16. <br><br><img src="https://habrastorage.org/webt/i-/is/u6/i-isu68vczilipq75gx8jnq8xzs.png"><br>  <i>Esta√ß√£o de Display 5251 Modelo 11</i> <br><br>  As op√ß√µes de terminal mais comuns foram 5251 Display Station Modelo 1 (960 caracteres na tela) e Modelo 11 (1920 caracteres na tela) com dimens√µes Largura / Profundidade / Altura iguais a 530/400/400 mm, respectivamente, e pesando 34 kg.  A resolu√ß√£o da tela do Modelo 1 era 12x80, Modelo 11 - 24x80.  O terminal foi conectado diretamente ao sistema host. <br><br>  Os terminais 5251 Display Station Modelo 2 (960 caracteres na tela) e Modelo 12 (1920 caracteres na tela) com grandes dimens√µes e peso de 45 kg tamb√©m eram bastante comuns.  Eles se distinguem do Modelo 1 e do Modelo 11 pela possibilidade de "encaminhar" a conex√£o a montante atrav√©s deles mesmos para a m√°quina host de clientes mais baratos na forma de terminais Modelo 1 (ou 11) com impressoras de mesa ou uma impressora de piso separada.  Assim, os modelos 2 e 12 agiram como um hub, proxy da conex√£o com o host de dispositivos que exigem uma conex√£o direta com a m√°quina host e custam significativamente mais. <br><br>  Os terminais da s√©rie 5252 Dual Display Station tamb√©m parecer√£o incomuns para o leigo moderno. <br><br><img src="https://habrastorage.org/webt/qq/nf/qx/qqnfqxfkc_sddfyxg1nq6i-v154.png"><br>  <i>Imagem promocional do folheto IBM System / 38 Equipment and Programs (5252 Dual Display Station)</i> <br><br>  O pre√ßo de um kit de terminal com uma impressora conectada a ele pode chegar a v√°rios milhares de d√≥lares. <br><br>  Os terminais foram conectados atrav√©s de um cabo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">biaxial</a> √† m√°quina host com uma topologia de barramento no modo half-duplex com uma velocidade de transmiss√£o de at√© 1 Mbps.  O n√∫mero m√°ximo de terminais suportados pelo twinaxial √© de at√© 6 terminais, e o terminal mais remoto do host deve estar localizado a uma dist√¢ncia n√£o superior a 1500 metros. <br><br>  O n√∫mero de cada terminal √© definido durante sua instala√ß√£o por tr√™s interruptores, para que um endere√ßo exclusivo seja determinado dentro do barramento.  Na presen√ßa de uma rede coaxial existente, √© poss√≠vel usar adaptadores de um cabo biaxial a um cabo coaxial e um conjunto apropriado de termina√ß√µes de cabo para crimpagem.  Com esse esquema, foi poss√≠vel conectar apenas dois dispositivos no barramento com um comprimento m√°ximo de segmento de at√© 30 metros.  O n√∫mero total de dispositivos conectados variou de uma d√∫zia a v√°rias dezenas, dependendo do modelo. <br><br>  Com o desenvolvimento de sistemas de desktop e redes de acesso, terminais volumosos foram substitu√≠dos por esta√ß√µes de trabalho, onde v√°rias placas de expans√£o de empresas terceirizadas foram usadas como meio de acesso √† m√°quina host, suportando conex√£o direta via twinaxial.  Depois que a IBM desenvolveu a tecnologia Token Ring em 1984, surgiram solu√ß√µes de software para acessar a m√°quina, inclusive por meio dessa interface. <br><br><img src="https://habrastorage.org/webt/5d/ek/m2/5dekm2mgcz43rgjiaxyjje3lyas.jpeg"><br>  <i>Adaptador 5250 para barramento ISA (fabricante desconhecido)</i> <br><br><img src="https://habrastorage.org/webt/mm/sr/0a/mmsr0av497ergmgdj4hjtd4a-84.png"><br>  <i>Placas adaptadoras Blackbox 5250 (PC470C, PC471C, PC472C, PC473C, PC478C)</i> <br><br>  Emuladores para MS-DOS e MS Windows aparecem tanto da IBM como de terceiros, incluindo implementa√ß√µes de c√≥digo aberto (por exemplo, tn5250j.sourceforge.net) Em meados dos anos 90, a pilha TCP / IP chega ao mundo intermedi√°rio de neg√≥cios de gama baixa e baixa.  Para suportar o acesso ao host por meio do novo protocolo, a IBM est√° desenvolvendo emuladores de terminal da s√©rie 5250. <br><br>  Para criar um protocolo host, a IBM est√° desenvolvendo <br>  Extens√µes de protocolo Telnet (RFC 854, RFC 855, RFC 856, RFC 860, RFC 885, RFC 1091, RFC 1205, RFC 1572, RFC 2877), coletivamente chamadas de Telnet5250 (TN5250), que descreve o processo de recebimento e transmiss√£o de fluxos Fluxos de dados 5250 (fluxos de dados 5250) sobre o protocolo Telnet padr√£o. <br><br><img src="https://habrastorage.org/webt/8w/gg/_i/8wgg_idu8zojbdf5_1u-gweewkm.gif"><br>  <i>IBM Client Access / 400 para Windows 3.1 Installer</i> <br><br><h2>  O que h√° de especial no IBM 5250? </h2><br>  Um recurso dos terminais IBM 5250 (e, consequentemente, do protocolo TN5250) √© a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">orienta√ß√£o do bloco,</a> em contraste com os terminais * nix usuais, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">orientados a s√≠mbolos</a> .  Isso significa que os fluxos de dados 5250 pelos quais o host se comunica com o terminal s√£o transmitidos pelos blocos de dados, e um s√≠mbolo separado nele, sem o contexto do bloco transmitido, n√£o faz sentido. <br><br>  Por exemplo, a m√°quina host transmite ao terminal um bloco de dados que cont√©m as informa√ß√µes est√°ticas exibidas na tela, juntamente com os atributos e coordenadas dos campos de entrada e uma indica√ß√£o do deslocamento nesse bloco, onde gravar o resultado da entrada do usu√°rio nos campos.  Depois disso, a m√°quina host espera mensagens do terminal e n√£o participa do processo de entrada do usu√°rio. <br><br><img src="https://habrastorage.org/webt/kg/ld/ha/kgldha8aef46matytdr3ugjm7ce.png"><br>  <i>Tela de login para o IBM i host RZKH.de (pub400.com)</i> <br><br>  Al√©m disso, a tarefa do emulador de terminal √© interpretar o bloco de dados da m√°quina e formar a tela de entrada para o usu√°rio, onde ele tem a oportunidade de inserir qualquer informa√ß√£o nos campos permitidos.  Al√©m disso, as tarefas do emulador de terminal incluem uma rea√ß√£o √†s a√ß√µes do usu√°rio.  As teclas F1-F24 (F13-F24 s√£o simuladas via SHIFT + Fx), Enter, Home, End, PageUp, PageDn e algumas outras teclas especiais que n√£o est√£o dispon√≠veis nos teclados modernos s√£o consideradas teclas do host.  Isso significa que, pressionando essa tecla, um buffer de fluxo com informa√ß√µes dos campos de entrada e a posi√ß√£o do cursor na tela, previamente preenchida com o emulador de terminal, ser√° enviada ao host para processamento. <br><br><img src="https://habrastorage.org/webt/nf/oe/vx/nfoevxx5yvr-kbzcnejytv9hk4q.png"><br>  <i>Tentativa de logon do WIreshark 5250 Data Stream na tentativa de despejo em pub400.com</i> <br><br>  O host recebe o buffer, analisa-o e o resultado da entrada √© transmitido ao programa que solicitou a rea√ß√£o do usu√°rio para valida√ß√£o de dados adicionais e o aplicativo continua a funcionar, enquanto o aplicativo recebe o c√≥digo da tecla host pressionada. <br><br><h2>  Por que o autoteste aqui </h2><br>  Pensamos em automatizar o teste manual de aplicativos de tela verde quando tivemos a necessidade de testar centenas de telas de um m√≥dulo desenvolvido, onde at√© oitenta verifica√ß√µes de neg√≥cios diferentes (valida√ß√µes) podiam ocorrer em uma tela. <br><br>  A dor particular da equipe foi a aus√™ncia quase completa em 2017 de ferramentas de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">teste autom√°tico de</a> tela verde, exceto a solu√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">UIPath</a> propriet√°ria.  Ainda hoje n√£o existem muitas solu√ß√µes semelhantes, o autor conhece o Automate da HelpSystems e a extens√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JMeter</a> para o BlazeMeter (ficarei feliz em saber sobre outros produtos similares). <br><br><h2>  A primeira pesquisa sobre o problema </h2><br>  O emulador padr√£o do terminal TN5250 instalado nos locais de trabalho no banco √© o IBM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Personal Communications</a> para Windows 6.0 (PCOMM 6.0).  Os colegas descobriram que este produto possui meios regulares de automatizar seu gerenciamento na forma de uma API diversa, a saber: <br><br><ol><li>  Interface de Programa de Aplicativo de Linguagem de Alto N√≠vel (HLLAPI); </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HLLAPI aprimorado;</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Windows HLLAPI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HACL (Host Access Client Library).</a> </li></ol><br>  As tr√™s primeiras interfaces s√£o as mais antigas e s√£o suportadas desde o DOS e as vers√µes de 16 bits do Windows.  O trabalho na interface EHLLAPI √© implementado chamando uma √∫nica fun√ß√£o de acordo com o seguinte prot√≥tipo: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hllapi</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LPWORD, LPSTR, LPWORD, LPWORD)</span></span></span></span>;</code> </pre> <br>  onde o primeiro par√¢metro √© um ponteiro para o n√∫mero num√©rico da fun√ß√£o que est√° sendo executada, os outros dois s√£o seus argumentos sens√≠veis ao contexto da fun√ß√£o que est√° sendo chamada e o √∫ltimo √© o resultado da fun√ß√£o.  Ou seja, para solicitar o status de conex√£o 'A' (as sess√µes no emulador s√£o numeradas com uma letra latina do intervalo de 'A' a 'Z'), voc√™ deve executar o seguinte c√≥digo (retirado da documenta√ß√£o da IBM): <br><br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"hapi_c.h"</span></span></span><span class="hljs-meta"> struct HLDQuerySessionStatus QueryData; int Func, Len, Rc; long Rc; memset(QueryData, 0, sizeof(QueryData)); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Init buffer QueryData.qsst_shortname = 'A'; // Session to query Func = HA_QUERY_SESSION_STATUS; // Function number Len = sizeof(QueryData); // Len of buffer Rc = 0; // Unused on input hllapi(&amp;Func, (char *)&amp;QueryData, &amp;Len, &amp;Rc); // Call EHLLAPI if (Rc != 0) { // Check return code // ...Error handling }</span></span></span></span></code> </pre><br>  O n√∫mero de fun√ß√µes dispon√≠veis para chamadas dessa maneira √© de cerca de 60. <br><br>  A interface WinHLLAPI expande levemente essa funcionalidade com v√°rias fun√ß√µes adicionais que permitem registrar fun√ß√µes de retorno de chamada para chamadas ass√≠ncronas, a fim de notificar sobre eventos de estabelecimento de uma conex√£o com o host, desconex√£o do host, altera√ß√£o de dados na tela do terminal etc. <br><br>  A interface HACL (Host Access Client Library) parecia mais amig√°vel, porque, ao contr√°rio de chamar a "fun√ß√£o do mesmo nome", foi fornecida uma variante da hierarquia de classes orientada a objetos que imitava completamente qualquer a√ß√£o do usu√°rio. <br><br><img src="https://habrastorage.org/webt/bv/km/nx/bvkmnxfp3dcskk9uiw9kzbtyffo.gif"><br>  <i>Hierarquia de classes da biblioteca de classes do emulador HACL (C ++)</i> <br><br>  Existem implementa√ß√µes HACL para C ++, Java, LotusScript e um servidor de automa√ß√£o COM para Windows (conveniente para Visual Basic e .NET). <br><br><h2>  Primeiro prot√≥tipo </h2><br>  Devido √† enorme complexidade do protocolo de fluxo de dados 5250 e √†s informa√ß√µes extremamente escassas sobre seu dispositivo interno com links para literatura paga fechada da IBM, ficou √≥bvio que o desenvolvimento de seu pr√≥prio emulador √© extremamente n√£o trivial e demorado.  A esse respeito, surgiu a id√©ia de usar uma camada de middleware que permitir√° controlar o emulador de terminal dentro da funcionalidade m√≠nima exigida, em particular ‚Äúinsira um valor no campo‚Äù, ‚Äúcompare parte da tela com o padr√£o‚Äù ou ‚Äúpressione a tecla host F22‚Äù. <br><br>  Os colegas que usaram interfaces HACL anteriormente alegaram (e uma pesquisa no StackOverflow confirmou) que o objeto COM apresentava problemas de estabilidade e poderia travar ap√≥s a execu√ß√£o de um certo n√∫mero de comandos.  Somente reiniciar o processo do servidor de automa√ß√£o ajudou.  Uma an√°lise r√°pida da vers√£o Java mostrou que o Wrapper √© usado na interface C ++ por meio do JNI.  Portanto, a escolha caiu na interface C ++.  Os arquivos de cabe√ßalho e arquivos .lib correspondentes estavam dispon√≠veis no diret√≥rio de instala√ß√£o do Personal Communications para Windows. <br><br>  O primeiro prot√≥tipo foi baseado no Qt5, onde foi poss√≠vel executar o c√≥digo JavaScript por meio do QtScript.  No ambiente do script execut√°vel, um objeto foi registrado com um pequeno n√∫mero de m√©todos que permitiam executar comandos no emulador de terminal como se estivessem sendo executados por uma pessoa (entrando em um campo, pressionando as teclas do host, aguardando a linha aparecer na tela).  Demonstramos uma "demonstra√ß√£o" ao vivo, onde escrevemos um caso de usu√°rio para iniciar um aplicativo de tela verde da ABS Equation com um teste da rea√ß√£o do aplicativo √† entrada incorreta nos campos.  A demonstra√ß√£o mostrou que o prot√≥tipo foi bem sucedido e que podemos seguir em frente. <br><br><h2>  A apar√™ncia de um vizinho </h2><br>  Juntamente com a demonstra√ß√£o do primeiro prot√≥tipo, colegas de outro departamento reuniram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√°rios</a> m√≥dulos Ruby + Pepino + <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Quick3270</a> + Ruby ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cheeze / te3270</a> ).  A op√ß√£o proposta usa um m√≥dulo Ruby que interage com o emulador de terminal DN32 Computing Quick3270 atrav√©s de seus objetos COM especializados (incompat√≠veis com as interfaces HACL).  Era uma solu√ß√£o completa para aplicativos de autoteste de tela verde no estilo BDD, com algumas etapas pr√©-descritas.  No entanto, na solu√ß√£o proposta, ficamos alarmados com o seguinte: <br><br><ol><li>  Usamos um emulador pago de terceiros, n√£o da IBM (todos os emuladores funcionam de maneira um pouco diferente, mas precisamos verificar o trabalho nos padr√µes usados ‚Äã‚Äãno banco, o pre√ßo do erro √© incrivelmente alto); </li><li>  As implementa√ß√µes das etapas do Cucumber para o Quick3270 usaram um grande n√∫mero de inativos para aguardar uma resposta da m√°quina; </li><li>  Um desempenho muito ruim do Quick3270 por meio da interface de automa√ß√£o (trabalhar com HACL no prot√≥tipo por meio da interface C ++ parecia muito mais din√¢mico). </li></ol><br><img src="https://habrastorage.org/webt/wy/j3/2u/wyj32ub0tvoxzbh-va3yxajiqfs.jpeg"><br>  <i>Emulador de terminal Quick3270</i> <br><br>  Com base no prot√≥tipo, decidimos tentar implementar nosso pr√≥prio servidor de automa√ß√£o para conectar o Pepino ao Personal Communications para Windows e projetar as etapas para que o tempo de inatividade entre as a√ß√µes na tela do emulador seja m√≠nimo. <br><br>  <i><b>Digress√£o l√≠rica</b> .</i>  <i>Apesar de existir um grande n√∫mero de problemas t√©cnicos em torno da IBM supostamente "legada", que, ao que parece, j√° deveria ter sido resolvida para sistemas de n√≠vel m√©dio e corporativo, a relev√¢ncia de adaptar e transferir solu√ß√µes t√©cnicas existentes √© muito alta simplesmente por causa de sua aus√™ncia na plataforma.</i>  <i>Freq√ºentemente, a aus√™ncia est√° conectada aos pr√≥prios recursos deste sistema operacional, que √© fundamentalmente diferente do moderno * nix, Windows ou MacOS X, que requer otimiza√ß√£o significativa do software para essa pilha.</i> <br><br><h2>  Decis√£o pr√≥pria </h2><br>  Como nossa pr√≥pria solu√ß√£o, criamos um servidor de automa√ß√£o como um desenvolvimento do prot√≥tipo demonstrado anteriormente.  Este servidor executa comandos para automatizar a intera√ß√£o dos consumidores atrav√©s de um servidor RPC (Qt5 WebSocket).  Ele interage com o Personal Communications para Windows, que faz parte da imagem corporativa do sistema operacional Windows, e permite: <br><br><ul><li>  iniciar / parar sess√µes de emulador de terminal; </li><li>  Executar raspagem de tela Tela verde; </li><li>  pesquise campos de entrada na tela; </li><li>  controlar o cursor e simular pressionamentos de tecla (incluindo host); </li><li>  e outros </li></ul><br><img src="https://habrastorage.org/webt/ub/qf/xp/ubqfxpqwu5q9pz3ievcpkfb0_sm.png"><br>  <i>Iniciar servidor de automa√ß√£o</i> <br><br>  No entanto, para todas as vantagens da API HACL, ela tem uma desvantagem - n√£o sabe como trabalhar com o DB2 for i DBMS integrado ao sistema operacional e n√£o permite a execu√ß√£o de comandos que s√£o vitais para a constru√ß√£o de um ambiente simulado no qual um script de teste seria executado.  Se o cliente DB2 para Ruby existir na IBM, o cliente para o comando remoto e o servidor de chamada de programa distribu√≠do ser√° apenas para Java na forma da biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JTOpen</a> : A vers√£o de c√≥digo aberto do IBM Toolbox for Java (tamb√©m conhecido como jt400 )  N√≥s "espiamos" a solu√ß√£o para esse problema na pr√≥pria IBM, analisando o comportamento de seus produtos com funcionalidade semelhante (em particular, Personal Communications para Windows Data Transfer, iSeries para PC / PC para iSeries Transfer, etc.).  Acontece que esses produtos, por sua implementa√ß√£o, executam o IBM JRE 6 ou 8, dependendo da vers√£o do aplicativo, e usam a biblioteca jt400. <br><br>  Para o servidor de automa√ß√£o, decidimos fazer o mesmo.  O JNI lan√ßa o IBM JVM, fornecido com o Personal Communications para Windows.  Usando m√©todos especiais do wrapper, os comandos do servidor RPC provenientes de fora s√£o executados por meio de proxy em chamadas para a funcionalidade necess√°ria do jt400.  Como o √∫ltimo tamb√©m cont√©m um driver JDBC para DB2, foi decidido us√°-lo para acessar o DBMS no IBM i. <br><br>  √â importante observar que voc√™ n√£o pode usar o Oracle JVM ao usar o HACL.  Se voc√™ executar uma sess√£o de emulador de terminal, a tentativa de criar uma inst√¢ncia da m√°quina virtual falhar√°.  Da mesma forma, se voc√™ executar a JVM do Oracle no espa√ßo de endere√ßo de um processo que interage com o HACL, o √∫ltimo trava sem explica√ß√£o. <br><br>  Com o tempo, a solu√ß√£o foi implementada em um n√∫mero crescente de tarefas.  Funcionou mais r√°pido que a solu√ß√£o com o Quick3270.  A popularidade cresceu, assim como o n√∫mero de autotestes.  No entanto, durante a opera√ß√£o, surgiram dificuldades adicionais: <br><br><ol><li>  Terminal ocasional congela; </li><li>  Incapacidade de trabalhar em uma posi√ß√£o de regress√£o devido ao emulador de terminal se recusar a iniciar se a √°rea de trabalho do usu√°rio sob a qual o emulador √© iniciado estiver bloqueada ou sua sess√£o RDP estiver bloqueada; </li><li>  Somente Windows; </li><li>  Um procedimento complexo para instalar, configurar e atualizar ferramentas (via pacote msi); </li><li>  Nosso ciclo de regress√£o para 130 autotestes (cerca de 4000 etapas) come√ßou a levar 7-8 horas. </li></ol><br><h2>  Algo precisa ser feito ... </h2><br>  Ao analisar os logs de rastreamento de v√°rias ativa√ß√µes de autoteste, encontrando gargalos no desempenho das etapas usadas com freq√º√™ncia, o tempo total de execu√ß√£o da regress√£o foi reduzido para 4-5 horas.  Mas ficou claro que o uso da camada de middleware na forma de um servidor RPC de automa√ß√£o em conjunto com a interface HACL, que tamb√©m possui erros "flutuantes" que se acumulam ao longo de todo o sistema, n√£o ajudar√° a melhorar o desempenho da solu√ß√£o. <br><br>  Por outro lado, como alternativa ao IBM Personal Communications para Windows, o fornecedor fornece uma solu√ß√£o de plataforma cruzada chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IBM i Access - Client Solutions.</a> <br><br><img src="https://habrastorage.org/webt/et/8d/kr/et8dkrlouhhuuqe3ew3krvyjq6u.png"><br>  <i>IBM i Access - Solu√ß√µes para Clientes</i> <br><br>  A an√°lise de sua estrutura interna nas manh√£s de s√°bado e domingo sobre x√≠caras de caf√© mostrou que sua base de c√≥digos √© baseada em outro produto da IBM chamado IBM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Host on-Demand</a> (IBM HOD).  Esta √© uma solu√ß√£o completa para acessar o IBM i, desenvolvida em Java 6, que n√£o apenas possui a implementa√ß√£o completa de v√°rios protocolos de comunica√ß√£o usados ‚Äã‚Äãem m√°quinas IBM (TN3270, TN5250, VTxxx etc.), mas tamb√©m componentes de interface do usu√°rio de alto n√≠vel da interface Java, usado para construir seus pr√≥prios emuladores de terminal na forma de um construtor, que pode ser montado a partir da escassa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o da</a> IBM  Um estudo mais detalhado do IBM HOD mostrou que os componentes da interface do usu√°rio s√£o baseados na implementa√ß√£o Java da interface HACL, cuja documenta√ß√£o est√° aberta.  O comportamento deles coincide com apenas pequenas diferen√ßas da documenta√ß√£o do C ++ HACL. <br><br><img src="https://habrastorage.org/webt/8u/fx/7-/8ufx7-3eikew1kjwcr0h-3uuw40.png"><br>  <i>IBM Host On-Demand (logotipo)</i> <br><br>  Em seguida, criamos uma biblioteca Java para uso interno, que implementa a mesma interface que o servidor de automa√ß√£o C ++ RPC, mas usa internamente o IBM HOD.  Para reduzir a sobrecarga durante a execu√ß√£o das etapas de autoteste, migramos do Ruby Cucumber para cucumber-jvm com a reimplementa√ß√£o de todas as etapas semelhantes √†s op√ß√µes do Ruby.  Na presen√ßa de uma interface de software semelhante ao servidor RPC, isso n√£o era grande coisa, especialmente considerando que tentamos restringir o crescimento descontrolado no n√∫mero de etapas em si e t√≠nhamos esse valor na regi√£o de 30 unidades. <br><br><h2>  Qual √© o resultado </h2><br>  Como resultado, alcan√ßamos a operacionalidade de todos os autotestes sem alter√°-los, e a velocidade do trabalho se tornou t√£o alta que tivemos que introduzir um atraso artificial entre as etapas para que, ao desenvolver um autoteste, voc√™ pudesse observar seu trabalho, caso contr√°rio, a interface do usu√°rio n√£o teria tempo para desenhar a tela at√© o fim. <br><br>  Os 180 autotestes j√° existentes, com mais de 16.000 etapas com um atraso definido de 60 ms entre as etapas, come√ßaram a executar cerca de 30 minutos contra 5 horas e 30 minutos, o que corresponde a um aumento de onze vezes no desempenho do suporte de regress√£o. <br><br>  Os resultados superaram todas as expectativas.  Estamos pr√≥ximos dos limites f√≠sicos do protocolo TN5250. <br><br>  At√© o momento, a decis√£o foi publicada em todo o banco e colegas de outras cidades se uniram √† melhoria.  Das mudan√ßas recentes, os colegas est√£o integrando a solu√ß√£o ao Jenkins, na vers√£o de teste, testando o lan√ßamento em um servidor Linux com Xvfb e concluindo o est√°gio da opera√ß√£o piloto de execu√ß√£o de autotestes. <br><br>  Obrigado por ler at√© o fim! <br>  Todo o sucesso! <br><br>  PS Em dezembro de 2018, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">foi realizada</a> a pr√≥xima <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IBMi Developer Conference,</a> na qual foi feito um relat√≥rio sobre o t√≥pico deste artigo. <br><br>  At√© agora, realizamos a Confer√™ncia anualmente apenas para funcion√°rios do Banco.  A partir de 2019, convidaremos participantes de outras empresas.  √â muito interessante expandir o c√≠rculo da comunica√ß√£o profissional e pessoal, compartilhar emo√ß√µes, conhecimentos e experi√™ncias. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt446332/">https://habr.com/ru/post/pt446332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt446322/index.html">Criptografia em Java. Utilit√°rio Keytool</a></li>
<li><a href="../pt446324/index.html">Navega√ß√£o no DataGrip com Yandex.Navigator</a></li>
<li><a href="../pt446326/index.html">Resolvendo problemas de tr√°fego</a></li>
<li><a href="../pt446328/index.html">Por que precisamos de servi√ßos de recep√ß√£o de SMS e com o que eles comem</a></li>
<li><a href="../pt446330/index.html">M√°quinas autom√°ticas contra c√≥digo de espaguete</a></li>
<li><a href="../pt446334/index.html">Reflex√µes sobre uma carreira em TI e dicas para iniciantes</a></li>
<li><a href="../pt446336/index.html">Como banir senhas padr√£o e fazer com que todos te odeiem</a></li>
<li><a href="../pt446338/index.html">SVG 3D: criar, girar e animar</a></li>
<li><a href="../pt446340/index.html">Sistemas operacionais: tr√™s pe√ßas f√°ceis. Parte 1: Introdu√ß√£o (tradu√ß√£o)</a></li>
<li><a href="../pt446342/index.html">O impacto de p√°ginas grandes e transparentes no desempenho do sistema</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>