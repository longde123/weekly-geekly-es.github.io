<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë®‚Äçüëß‚Äçüëß üë©üèΩ‚Äçü§ù‚Äçüë©üèª üç£ Coroutines :: experi√™ncia pr√°tica üåà üëçüèΩ üéõÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, falarei sobre como as corotinas funcionam e como cri√°-las. Considere o aplicativo em execu√ß√£o sequencial e paralela. Vamos falar sobre t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Coroutines :: experi√™ncia pr√°tica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/e-Legion/blog/442920/"> Neste artigo, falarei sobre como as corotinas funcionam e como cri√°-las.  Considere o aplicativo em execu√ß√£o sequencial e paralela.  Vamos falar sobre tratamento de erros, depura√ß√£o e maneiras de testar a corotina.  No final, resumirei e falarei sobre as impress√µes que permaneceram ap√≥s a aplica√ß√£o dessa abordagem. <br><br>  O artigo foi preparado com base nos materiais do meu relat√≥rio no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MBLT DEV 2018</a> , no final do post - um link para o v√≠deo. <br><br><h2>  Estilo consistente </h2><br><img src="https://habrastorage.org/webt/ke/8z/tu/ke8ztulkufchujj6k5pxutqtigw.png"><a name="habracut"></a><br>  <i>Fig.</i>  <i>2.1</i> <br><br>  Qual foi o objetivo dos desenvolvedores Corutin?  Eles queriam que a programa√ß√£o ass√≠ncrona fosse o mais simples poss√≠vel.  N√£o h√° nada mais f√°cil do que executar o c√≥digo ‚Äúlinha por linha‚Äù usando as constru√ß√µes sint√°ticas da linguagem: try-catch-finalmente, loops, instru√ß√µes condicionais e assim por diante. <br><br>  Vamos considerar duas fun√ß√µes.  Cada um √© executado em seu pr√≥prio thread (Fig. 2.1).  O primeiro √© executado no encadeamento <b>B</b> e retorna alguns dados do resultadoB, ent√£o precisamos passar esse resultado para a segunda fun√ß√£o, que aceita o <b>dataB</b> como argumento e j√° est√° sendo executado no encadeamento <b>A.</b>  Com a corotina, podemos escrever nosso c√≥digo como mostrado na fig.  2.1  Considere como conseguir isso. <br><br>  As fun√ß√µes <b>longOpOnB, longOpOnA</b> s√£o as chamadas fun√ß√µes de <i>suspens√£o</i> , antes das quais o encadeamento √© liberado e, ap√≥s o t√©rmino, ele fica ocupado novamente. <br><br>  Para que essas duas fun√ß√µes sejam realmente executadas em um encadeamento diferente em rela√ß√£o ao chamado, mantendo um estilo "consistente" de escrever c√≥digo, devemos mergulh√°-las no contexto da corotina. <br><br>  Isso √© feito atrav√©s da cria√ß√£o de corotinas usando o chamado Coroutine Builder.  Na figura, este √© o <i>lan√ßamento</i> , mas existem outros, por exemplo, <i>ass√≠ncrono</i> , <i>runBlocking</i> .  Falarei sobre eles mais tarde. <br><br>  O √∫ltimo argumento √© um bloco de c√≥digo executado no contexto da corotina: chamar fun√ß√µes de suspens√£o, o que significa que todo o comportamento acima √© poss√≠vel apenas no contexto da corotina ou em outra fun√ß√£o de suspens√£o. <br><br>  Existem outros par√¢metros no m√©todo Coroutine Builder, por exemplo, o tipo de inicializa√ß√£o, o encadeamento no qual o bloco ser√° executado e outros. <br><br><h2>  Gerenciamento do ciclo de vida </h2><br>  O Coroutine Builder nos fornece o valor de retorno como valor de retorno - uma subclasse da classe <i>Job</i> (Fig.2.2).  Com ele, podemos gerenciar o ciclo de vida de corutin. <br><br>  Comece com o m√©todo <i>start ()</i> , cancele com o m√©todo <i>cancel ()</i> , aguarde a conclus√£o da tarefa usando o m√©todo <i>join (</i> ), inscreva-se no evento de conclus√£o da tarefa e muito mais. <br><br><img src="https://habrastorage.org/webt/os/bf/9j/osbf9jvwmvqtlidv_ugwrfbk-yc.png"><br>  <i>Fig.</i>  <i>2.2</i> <br><br><h2>  Mudan√ßa de fluxo </h2><br>  Voc√™ pode alterar o fluxo de execu√ß√£o da corotina alterando o elemento de contexto da corotina respons√°vel pelo planejamento.  (Fig. 2.3) <br><br>  Por exemplo, a corutin 1 ser√° executada em um encadeamento da <i>interface do usu√°rio</i> , enquanto a corutin 2 em um encadeamento retirado do pool <i>Dispatchers.IO</i> . <br><br><img src="https://habrastorage.org/webt/oe/9e/o1/oe9eo1ynqwdskvi-laxuunj-xkk.png"><br>  <i>Fig.2.3</i> <br><br>  A biblioteca de corotina tamb√©m fornece uma fun√ß√£o de suspens√£o <i>comContext (CoroutineContext)</i> , com a qual voc√™ pode alternar entre os segmentos no contexto de uma corotina.  Portanto, saltar entre os threads pode ser bastante simples: <br><br><img src="https://habrastorage.org/webt/ga/ca/im/gacaimxsxh_bjcxjweywrc8kstw.png"><br>  <i>Fig.</i>  <i>2.4</i> <br><br>  Iniciamos a nossa rotina na rosca da interface do usu√°rio 1 ‚Üí mostramos o indicador de carga ‚Üí alternamos para a rosca de trabalho 2, liberando a principal ‚Üí realizamos uma opera√ß√£o longa que n√£o pode ser executada na rosca da interface do usu√°rio ‚Üí retornamos o resultado para a rosca da interface do usu√°rio 3 ‚Üí e j√° trabalhamos l√° com ele, renderizando os dados recebidos e ocultando o indicador de carregamento. <br><br>  Parece bastante confort√°vel at√© agora, siga em frente. <br><br><h2>  Suspender Fun√ß√£o </h2><br>  Considere o trabalho de corutin no exemplo do caso mais comum - trabalhando com solicita√ß√µes de rede usando a biblioteca Retrofit 2. <br><br>  A primeira coisa que precisamos fazer √© converter a <b>chamada de retorno de</b> chamada em uma fun√ß√£o de <i>suspens√£o</i> para tirar proveito do recurso de rotina: <br><br><img src="https://habrastorage.org/webt/hs/kk/ue/hskkuekq2frbocs_hd-oxsz8k7o.png"><br>  <i>Fig.</i>  <i>2.5</i> <br><br>  Para controlar o estado da corotina, a biblioteca fornece fun√ß√µes no formato <i>suspendXXXXCoroutine</i> , que fornecem um argumento que implementa a interface <i>Continuation</i> , usando os m√©todos <i>resumeWithException</i> e <i>resume</i> dos quais podemos retomar a corotina em caso de erro e sucesso, respectivamente. <br><br>  A seguir, descobriremos o que acontece quando o m√©todo resumeWithException for chamado e, primeiro, teremos o cuidado de precisar cancelar de alguma forma a chamada de solicita√ß√£o de rede. <br><br><h2>  Suspender fun√ß√£o.  Cancelamento de chamadas </h2><br>  Para cancelar a chamada e outras a√ß√µes relacionadas √† libera√ß√£o de recursos n√£o utilizados, ao implementar a fun√ß√£o de suspens√£o, voc√™ pode usar o m√©todo <i>suspendCancellableCoroutine</i> que <i>sai</i> da caixa (Fig. 2.6).  Aqui, o argumento de bloco j√° implementa a interface <i>CancellableContinuation</i> , um dos m√©todos adicionais <i>chamado invokeOnCancellation</i> , que permite que voc√™ se inscreva em um erro ou em um evento bem-sucedido de cancelamento de rotina.  Portanto, aqui tamb√©m √© necess√°rio cancelar a chamada do m√©todo. <br><br><img src="https://habrastorage.org/webt/59/ut/hw/59uthwhyrpuk2-hzm6c2rax0vzk.png"><br>  <i>Fig.</i>  <i>2.6</i> <br><br><h3>  Exibir altera√ß√µes na interface do usu√°rio </h3><br>  Agora que a fun√ß√£o de suspens√£o foi preparada para solicita√ß√µes de rede, voc√™ pode usar sua chamada no fluxo da interface do usu√°rio da Coroutine como seq√ºencial, enquanto durante a execu√ß√£o da solicita√ß√£o o fluxo estar√° livre e o fluxo de retroajuste ser√° usado para a solicita√ß√£o. <br><br>  Assim, implementamos o comportamento ass√≠ncrono em rela√ß√£o ao fluxo da interface do usu√°rio, mas o escrevemos em um estilo consistente (Figura 2.6). <br><br>  Se, depois de receber a resposta, voc√™ precisar fazer o trabalho duro, por exemplo, gravando os dados recebidos no banco de dados, essa fun√ß√£o, como j√° foi mostrada, poder√° ser facilmente executada usando <i>withContext</i> no pool de fluxos de back-stream e continue a execu√ß√£o na interface do usu√°rio sem uma √∫nica linha de c√≥digo. <br><br><img src="https://habrastorage.org/webt/ks/qk/g4/ksqkg48x7gjja00x6hii4cpc1uo.png"><br>  <i>Fig.</i>  <i>2.7</i> <br><br>  Infelizmente, isso n√£o √© tudo o que precisamos para o desenvolvimento de aplicativos.  Considere o tratamento de erros. <br><br><h3>  Tratamento de erros: try-catch-finalmente.  Cancelar Coroutine: CancellationException </h3><br>  Uma exce√ß√£o que n√£o foi capturada dentro da corotina √© considerada n√£o tratada e pode levar √† falha do aplicativo.  Al√©m de situa√ß√µes normais, uma exce√ß√£o √© lan√ßada retomando a corotina usando o m√©todo <i>resumeWithException</i> na linha correspondente da chamada √† fun√ß√£o de suspens√£o.  Nesse caso, a exce√ß√£o passada como argumento √© lan√ßada inalterada.  (Fig. 2.8) <br><br><img src="https://habrastorage.org/webt/hm/sv/f0/hmsvf0yzwobbhf3mlv_ce8xy2l8.png"><br>  <i>Fig.</i>  <i>2.8</i> <br><br>  Para manipula√ß√£o de exce√ß√µes, a constru√ß√£o padr√£o de tentativa de captura finalmente de linguagem est√° dispon√≠vel.  Agora, o c√≥digo que pode exibir o erro na interface do usu√°rio assume o seguinte formato: <br><br><img src="https://habrastorage.org/webt/ce/53/hp/ce53hpazfknfd3962fn0wvfv8x8.png"><br>  <i>Fig.</i>  <i>2.9</i> <br><br>  No caso de cancelar a corotina, que pode ser obtida chamando o m√©todo Job # cancel, <i>√©</i> lan√ßada uma <i>CancellationException</i> .  Essa exce√ß√£o √© tratada por padr√£o e n√£o causa falhas ou outras consequ√™ncias negativas. <br><br>  No entanto, ao usar a constru√ß√£o <b>try / catch</b> , ela ser√° capturada no <b>bloco catch</b> e voc√™ precisar√° considerar isso nos casos se desejar lidar apenas com situa√ß√µes realmente "err√¥neas".  Por exemplo, o tratamento de erros na interface do usu√°rio quando √© poss√≠vel "cancelar" solicita√ß√µes ou o log de erros √© fornecido.  No primeiro caso, o erro ser√° exibido para o usu√°rio, embora ele realmente n√£o exista, e no segundo, uma exce√ß√£o in√∫til ser√° registrada e desorganizar√° os relat√≥rios. <br><br>  Para ignorar a situa√ß√£o de cancelamento de corotinas, voc√™ precisa modificar levemente o c√≥digo: <br><br><img src="https://habrastorage.org/webt/cw/9p/yf/cw9pyfzj3sbzqrpz49b0ochntjq.png"><br>  <i>Fig.</i>  <i>2.10</i> <br><br><h2>  Registro de erro </h2><br>  Considere o rastreamento de pilha de exce√ß√£o de exce√ß√£o. <br><br>  Se voc√™ lan√ßar uma exce√ß√£o diretamente no bloco de c√≥digo da corotina (Fig. 2.11), o rastreamento da pilha parecer limpo, com apenas algumas chamadas da corotina, indica corretamente a linha e as informa√ß√µes sobre a exce√ß√£o.  Nesse caso, √© poss√≠vel entender facilmente a partir do rastreamento da pilha onde exatamente, em qual classe e em qual fun√ß√£o a exce√ß√£o foi lan√ßada. <br><br><img src="https://habrastorage.org/webt/70/1q/h7/701qh72uei7qbt8jpf9kegbnavy.png"><br>  <i>Fig.</i>  <i>2.11</i> <br><br>  No entanto, as exce√ß√µes que s√£o passadas para o m√©todo <i>resumeWithException de</i> fun√ß√µes de <i>suspens√£o</i> , como regra, n√£o cont√™m informa√ß√µes sobre a corotina na qual ocorreu.  Por exemplo (Fig. 2.12), se voc√™ retomar a corotina da fun√ß√£o de suspens√£o implementada anteriormente com a mesma exce√ß√£o do exemplo anterior, o rastreamento da pilha n√£o fornecer√° informa√ß√µes sobre onde procurar especificamente o erro. <br><br><img src="https://habrastorage.org/webt/wd/41/xr/wd41xr4kb6f-luf61_cvcmxetr4.png"><br>  <i>Fig.</i>  <i>2.12</i> <br><br>  Para entender qual coroutine recome√ßou com uma exce√ß√£o, voc√™ pode usar o <i>elemento de</i> contexto <i>CoroutineName</i> .  (Fig. 2.13) <br><br>  O elemento <i>CoroutineName √©</i> usado para depura√ß√£o, passando o nome da corotina para ele, voc√™ pode extra√≠-lo nas fun√ß√µes de suspens√£o e, por exemplo, complementar a mensagem de exce√ß√£o.  Ou seja, pelo menos ficar√° claro onde procurar um erro. <br><br>  Essa abordagem funcionar√° apenas se a fun√ß√£o de suspens√£o for exclu√≠da disso: <br><br><img src="https://habrastorage.org/webt/5u/xs/st/5uxsstlugngflzdlcrarrfws1d4.png"><br>  <i>Fig.</i>  <i>2,13</i> <br><br><h3>  Erro no registro.  ExceptionHandler </h3><br>  Para alterar o log de exce√ß√µes para uma corotina espec√≠fica, voc√™ pode definir seu pr√≥prio ExceptionHandler, que √© um dos elementos do contexto da corotina.  (Fig. 2.14) <br><br>  O manipulador deve implementar a interface <i>CoroutineExceptionHandler</i> .  Usando o operador + substitu√≠do para o contexto da rotina, voc√™ pode substituir o manipulador de exce√ß√£o padr√£o pelo seu.  A exce√ß√£o n√£o tratada se enquadra no m√©todo <i>handleException</i> , onde voc√™ pode fazer o que for necess√°rio.  Por exemplo, ignore completamente.  Isso acontecer√° se voc√™ deixar o manipulador vazio ou adicionar suas pr√≥prias informa√ß√µes: <br><br><img src="https://habrastorage.org/webt/c_/1w/3y/c_1w3ya8lagmhplbeeq9ajvtbws.png"><br>  <i>Fig.</i>  <i>2,14</i> <br><br>  Vamos ver como pode ser o registro da nossa exce√ß√£o: <br><br><ol><li>  Voc√™ precisa se lembrar da <i>CancellationException</i> , que queremos ignorar. </li><li>  Adicione seus pr√≥prios logs. </li><li>  Lembre-se do comportamento padr√£o, que inclui registrar e encerrar o aplicativo, caso contr√°rio, a exce√ß√£o simplesmente "desaparecer√°" e n√£o ficar√° claro o que aconteceu. </li></ol><br>  Agora, no caso de lan√ßar uma exce√ß√£o, uma lista de rastreamento de pilha ser√° enviada ao logcat com as informa√ß√µes adicionadas: <br><br><img src="https://habrastorage.org/webt/mr/jl/sc/mrjlscj8bilbyancdfmygexqlki.png"><br>  <i>Fig.</i>  <i>2,15</i> <br><br><h2>  Execu√ß√£o paralela.  ass√≠ncrono </h2><br>  Considere a opera√ß√£o paralela das fun√ß√µes de suspens√£o. <br><br>  <i>O Async</i> √© mais adequado para organizar resultados paralelos de v√°rias fun√ß√µes.  Ass√≠ncrono, como o <i>lan√ßamento</i> - Coroutine Builder.  Sua conveni√™ncia √© que, usando o m√©todo waitit <i>()</i> , ele retorne dados se for bem-sucedido ou gere uma exce√ß√£o que ocorreu durante a execu√ß√£o da corotina.  O m√©todo de espera aguardar√° a conclus√£o da rotina, se ainda n√£o estiver conclu√≠da, caso contr√°rio, retornar√° imediatamente o resultado do trabalho.  Observe que wait √© uma fun√ß√£o de suspens√£o e, portanto, n√£o pode ser executada fora do contexto de uma corotina ou outra fun√ß√£o de suspens√£o. <br><br>  Usando async, obter dados de duas fun√ß√µes em paralelo ser√° algo como isto: <br><br><img src="https://habrastorage.org/webt/w1/-t/hv/w1-thvudknznjyexdz7_c5rb0w8.png"><br>  <i>Fig.</i>  <i>2,16</i> <br><br>  Imagine que somos confrontados com a tarefa de obter dados de duas fun√ß√µes em paralelo.  Ent√£o, voc√™ precisa combin√°-los e exibir.  Em caso de erro, √© necess√°rio desenhar a interface do usu√°rio, cancelando todas as solicita√ß√µes atuais.  Tal caso √© freq√ºentemente encontrado na pr√°tica. <br><br>  Nesse caso, o erro deve ser tratado da seguinte maneira: <br><br><ol><li>  Traga o tratamento de erros dentro de cada um dos ass√≠ncronos-corutinos. </li><li>  Em caso de erro, cancele todas as corotinas.  Felizmente, para isso, √© poss√≠vel especificar um trabalho pai, no cancelamento do qual todos os seus filhos s√£o cancelados. </li><li>  Criamos uma implementa√ß√£o adicional para entender se todos os dados foram carregados com √™xito.  Por exemplo, assumimos que, se aguardar retornado nulo, ocorreu um erro ao receber dados. </li></ol><br>  Com tudo isso em mente, a implementa√ß√£o da rotina dos pais est√° se tornando um pouco mais complicada.  A implementa√ß√£o de async-corutin tamb√©m √© complicada: <br><br><img src="https://habrastorage.org/webt/wy/xe/ny/wyxenyk2quyek7zmhz4ze1dq5sw.png"><br>  <i>Fig.</i>  <i>2,17</i> <br><br>  Essa abordagem n√£o √© a √∫nica poss√≠vel.  Por exemplo, voc√™ pode implementar a execu√ß√£o paralela com o tratamento de erros usando <i>ExceptionHandler</i> ou <i>SupervisorJob</i> . <br><br><h2>  Corotinas aninhadas </h2><br>  Vejamos o trabalho da corotina aninhada. <br><br>  Por padr√£o, a rotina aninhada √© criada usando um escopo externo e herda seu contexto.  Como resultado, a corotina aninhada se torna filha e o pai externo. <br><br>  Se cancelarmos a corotina externa, as corotinas aninhadas criadas dessa maneira, usadas no exemplo anterior, tamb√©m ser√£o canceladas.  Tamb√©m ser√° √∫til ao sair da tela quando voc√™ precisar cancelar as solicita√ß√µes atuais.  Al√©m disso, o pai corutin sempre aguardar√° a conclus√£o da filha. <br><br>  Voc√™ pode criar uma rotina independente da externa usando um escopo global.  Nesse caso, quando a corotina externa √© cancelada, a aninhada continuar√° funcionando como se nada tivesse acontecido: <br><br><img src="https://habrastorage.org/webt/fj/pu/_y/fjpu_yzyp3z0ttuypjypxu2oav4.png"><br>  <i>Fig.</i>  <i>2,18</i> <i><br></i> <br>  Voc√™ pode criar um filho da corotina aninhada global substituindo o elemento de contexto pela chave <i>Job</i> pelo trabalho pai ou pode usar totalmente o contexto da corotina pai.  Mas, neste caso, vale lembrar que todos os elementos da rotina principal s√£o assumidos: o pool de threads, o manipulador de exce√ß√µes e assim por diante: <br><br><img src="https://habrastorage.org/webt/hh/wd/jx/hhwdjxobjkl0arojj0sh6ufii7m.png"><br>  <i>Fig.</i>  <i>2,19</i> <br><br>  Agora est√° claro que, se voc√™ usar a rotina externa, precisar√° fornecer a eles a capacidade de instalar uma inst√¢ncia do trabalho ou o contexto do pai.  E os desenvolvedores de bibliotecas precisam considerar a possibilidade de instal√°-lo quando crian√ßa, o que causa transtornos. <br><br><h2>  Pontos de interrup√ß√£o </h2><br>  As corotinas afetam a exibi√ß√£o dos valores do objeto no modo de depura√ß√£o.  Se voc√™ colocar um ponto de interrup√ß√£o na pr√≥xima corotina na fun√ß√£o <b>logData</b> , quando for acionado, veremos que tudo est√° bem aqui e os valores s√£o exibidos corretamente: <br><br><img src="https://habrastorage.org/webt/hp/t-/oc/hpt-ockcfqvrlzej2ncx0v2cboy.png"><br>  <i>Fig.</i>  <i>2,20</i> <br><br>  Agora obtenha <b>dataA</b> usando a rotina aninhada, deixando um ponto de interrup√ß√£o no <b>logData</b> : <br><br><img src="https://habrastorage.org/webt/bq/0j/cb/bq0jcbefwitj0ss-bhahf8_cjy8.png"><br>  <i>Fig.</i>  <i>2,21</i> <br><br>  Tentar expandir o bloco this para tentar encontrar os valores desejados falha.  Assim, a depura√ß√£o na presen√ßa de fun√ß√µes de suspens√£o se torna dif√≠cil. <br><br><h2>  Teste de unidade </h2><br>  O teste de unidade √© bastante direto.  Voc√™ pode usar o <i>runBlocking do Coroutine</i> Builder <i>para isso</i> .  <i>O runBlocking</i> bloqueia um encadeamento at√© que todas as suas corotinas aninhadas sejam conclu√≠das, exatamente o que voc√™ precisa para testar. <br><br>  Por exemplo, se for sabido que em algum lugar dentro do m√©todo coroutine √© usado para implement√°-lo, para testar o m√©todo, voc√™ s√≥ precisa envolv√™-lo no <i>runBlocking</i> . <br><br>  <i>O runBlocking</i> pode ser usado para testar uma fun√ß√£o de suspens√£o: <br><br><img src="https://habrastorage.org/webt/ok/vi/4t/okvi4t5bogczdolbbiimwmqyz5g.png"><br>  <i>Fig.</i>  <i>2,22</i> <br><br><h2>  Exemplos </h2><br>  Finalmente, gostaria de mostrar alguns exemplos do uso de corutin. <br><br>  Imagine que precisamos executar tr√™s consultas A, B e C em paralelo, mostrar sua conclus√£o e refletir o momento de conclus√£o das solicita√ß√µes A e B. <br><br>  Para fazer isso, voc√™ pode simplesmente agrupar as corotinas de consulta A e B em uma comum e trabalhar com ela como um √∫nico todo: <br><br><img src="https://habrastorage.org/webt/xy/ut/fo/xyutfowgblzyjx5l-fb0tcazbx4.png"><br>  <i>Fig.</i>  <i>2,23</i> <br><br>  O exemplo a seguir demonstra como usar o loop for regular para executar consultas peri√≥dicas com um intervalo de 5 segundos: <br><br><img src="https://habrastorage.org/webt/an/bk/zb/anbkzbm6ozetsl3vtwopsmtm2f0.png"><br>  <i>Fig.</i>  <i>2,24</i> <br><br><h2>  Conclus√µes </h2><br>  Das desvantagens, noto que as corotinas s√£o uma ferramenta relativamente jovem; portanto, se voc√™ quiser us√°-las no produto, fa√ßa isso com cautela.  Existem dificuldades na depura√ß√£o, um pequeno padr√£o na implementa√ß√£o de coisas √≥bvias. <br><br>  Em geral, as corotinas s√£o bastante f√°ceis de usar, especialmente para implementar tarefas ass√≠ncronas n√£o complicadas.  Em particular, devido ao fato de que constru√ß√µes de linguagem padr√£o podem ser usadas.  As corotinas s√£o facilmente pass√≠veis de teste de unidade e tudo isso sai da caixa da mesma empresa que desenvolve o idioma. <br><br><h2>  Denunciar v√≠deo </h2><br>  Acabou muitas cartas.  Para quem gosta de ouvir mais - v√≠deo do meu relat√≥rio no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MBLT DEV 2018</a> : <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/wsYou5lx6zA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Materiais √∫teis sobre o tema: </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Introdu√ß√£o √†s corotinas</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mergulho profundo em corotinas</a> </li><li>  <a href="">Guia para kotlinx.coroutines por exemplo</a> </li><li>  <a href="">Guia de programa√ß√£o da interface do usu√°rio com corotinas</a> </li><li>  <a href="">Documento de design das corotinas (KEEP)</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt442920/">https://habr.com/ru/post/pt442920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt442910/index.html">Por que precisamos de an√°lises avan√ßadas no SIBUR</a></li>
<li><a href="../pt442912/index.html">Com√≠cio contra o isolamento do Runet</a></li>
<li><a href="../pt442914/index.html">Battle royale: crie segredos do g√™nero de jogos mais popular</a></li>
<li><a href="../pt442916/index.html">As esta√ß√µes de r√°dio FM pirateadas s√£o relevantes hoje?</a></li>
<li><a href="../pt442918/index.html">Guia para implantar modelos de aprendizado de m√°quina em um ambiente de produ√ß√£o como uma API usando o Flask</a></li>
<li><a href="../pt442922/index.html">Miss√£o lunar "Bereshit" - caracter√≠sticas do dispositivo, uma s√©rie de manobras e o caminho mais longo para a lua</a></li>
<li><a href="../pt442924/index.html">Respingos avan√ßados de textura do terreno</a></li>
<li><a href="../pt442926/index.html">"Barulho de camundongo" na luz infravermelha: a introdu√ß√£o de nanopart√≠culas na regi√£o sub-retiniana do olho do mouse</a></li>
<li><a href="../pt442928/index.html">Escrevendo um c√≥digo flex√≠vel usando o SOLID</a></li>
<li><a href="../pt442934/index.html">Como contratar pessoas em uma grande empresa com uma pilha impopular. Conversa com Wrike</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>