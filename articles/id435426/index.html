<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¶üèª üçº üè® Cara Microsoft Excel bekerja dengan ketinggian baris üåì üíÖüèΩ üëÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kadang-kadang saya bosan dan, dengan dipersenjatai dengan debugger, saya mulai menggali berbagai program. Kali ini, pilihan saya jatuh pada Excel dan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara Microsoft Excel bekerja dengan ketinggian baris</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435426/"><p> Kadang-kadang saya bosan dan, dengan dipersenjatai dengan debugger, saya mulai menggali berbagai program.  Kali ini, pilihan saya jatuh pada Excel dan ada keinginan untuk mencari tahu bagaimana menangani ketinggian baris, apa yang menyimpannya, bagaimana ia mempertimbangkan ketinggian berbagai sel, dll.  Saya mem-parsing Excel 2010 (excel.exe, 32bit, versi 14.0.4756.1000, SHA1 a805cf60a5542f21001b0ea5d142d1cd0ee00b28). </p><a name="habracut"></a><br><h2 id="nachnyom-s-teorii">  Mari kita mulai dengan teorinya </h2><br><p>  Jika Anda membuka dokumentasi VBA untuk Microsoft Office, Anda dapat melihat bahwa ketinggian baris dapat diperoleh dengan satu atau lain cara melalui dua properti: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Rowheight">RowHeight</a> - Mengembalikan atau menetapkan ketinggian baris pertama dalam rentang yang ditentukan, diukur dalam poin.  Baca / tulis Ganda; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Tinggi">Tinggi</a> - Mengembalikan nilai ganda yang mewakili tinggi, dalam poin, dari kisaran.  Hanya baca. </li></ul><br><p>  Dan jika Anda melihat juga di sini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Spesifikasi dan batas Excel">Spesifikasi dan batasan Excel</a> .  Anda dapat menemukan bahwa ketinggian baris maksimum adalah 409 poin.  Sayangnya, ini jauh dari satu-satunya kasus ketika dokumen resmi Microsoft sedikit licik.  Bahkan, dalam kode Excel, tinggi baris maksimum diatur ke 2047 piksel, yang akan menjadi 1535,25 poin.  Dan ukuran font maksimum adalah 409,55 poin.  Tidak mungkin mendapatkan deretan tinggi seperti itu hanya dengan menetapkannya di VBA / Interop, tetapi Anda dapat mengambil satu baris, mengatur font Cambria Math di sel pertama, dan mengatur ukuran font menjadi 409,55 poin.  Kemudian Excel dengan algoritma liciknya akan menghitung tinggi baris berdasarkan format sel, mendapatkan angka lebih dari 2.047 piksel (percaya kata), dan mengatur baris ke ketinggian maksimum yang mungkin.  Jika Anda bertanya ketinggian seri ini melalui UI, maka Excel akan berbohong bahwa tingginya adalah 409,5 poin, tetapi jika Anda meminta tinggi seri melalui VBA, Anda mendapatkan poin 1535,25 jujur, yang sama dengan 2047 piksel.  Benar, setelah menyimpan dokumen, tingginya masih akan turun menjadi 409,5 poin.  Manipulasi ini dapat diamati di sini di video ini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://recordit.co/ivnFEsELLI</a> </p><br><p>  Saya menyebutkan piksel pada paragraf sebelumnya karena suatu alasan.  Excel benar-benar menyimpan dan menghitung ukuran sel dalam bilangan bulat (umumnya melakukan segalanya sebanyak mungkin dalam bilangan bulat).  Paling sering ini adalah piksel yang dikalikan dengan beberapa faktor.  Menariknya, Excel menyimpan skala tampilan dalam bentuk fraksi biasa, misalnya skala 75% akan disimpan sebagai dua angka 3 dan 4. Dan ketika diperlukan untuk menampilkan baris, Excel akan mengambil tinggi baris sebagai jumlah integer piksel, dikalikan 3 dan dibagi oleh 4. Tapi dia akan melakukan operasi ini sudah di akhir .. Dari sini efeknya dibuat bahwa semuanya dianggap dalam angka fraksional.  Untuk memverifikasi ini, tulis kode berikut dalam VBA: </p><br><pre><code class="vbscript hljs">w.Rows(<span class="hljs-number"><span class="hljs-number">1</span></span>).RowHeight = <span class="hljs-number"><span class="hljs-number">75.375</span></span> Debug.Print w.Rows(<span class="hljs-number"><span class="hljs-number">1</span></span>).Height</code> </pre> <br><p>  VBA akan memberikan 75 karena  75,375 piksel akan menjadi 100,5 piksel, dan Excel tidak mampu membelinya dan akan menjatuhkan bagian pecahan hingga 100 piksel.  Ketika VBA meminta tinggi baris dalam poin, Excel dengan jujur ‚Äã‚Äãmenerjemahkan 100 piksel menjadi poin dan mengembalikan 75. </p><br><p>  Pada prinsipnya, kita telah menulis kelas di C # yang akan menjelaskan informasi tentang tinggi baris: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RowHeightInfo</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//    ,   4. public ushort Flags { get; set; } //  }</span></span></code> </pre> <br><p>  Anda harus mengambil kata saya untuk saat ini, tetapi di Excel, tinggi baris disimpan dengan cara itu.  Yaitu, jika ditentukan bahwa tinggi baris adalah 75 poin, itu akan menjadi 100 dalam piksel, maka 400 akan disimpan dalam Nilai. Saya belum sepenuhnya memahami apa arti semua bit dalam Bendera (sulit dan lama untuk mengetahui nilai-nilai bendera), tetapi saya tahu 0x4000 diatur untuk baris yang tingginya diatur secara manual, dan 0x2000 - diatur untuk baris tersembunyi.  Secara umum, untuk baris yang terlihat dengan ketinggian yang diatur secara manual, Flags paling sering sama dengan 0x4005, dan untuk baris di mana tinggi dihitung berdasarkan format Flags, itu bisa 0xA atau 0x800E. </p><br><h2 id="sprashivaem-vysotu-ryada">  Kami meminta tinggi baris </h2><br><p>  Sekarang, pada prinsipnya, Anda dapat melihat metode dari excel.exe, yang mengembalikan tinggi baris dengan indeksnya (terima kasih kepada HexRays untuk kode yang indah): </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __userpurge GetRowHeight@&lt;eax&gt;(<span class="hljs-keyword"><span class="hljs-keyword">signed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowIndex@&lt;edx&gt;, SheetLayoutInfo *sheetLayoutInfo@&lt;esi&gt;, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> flag) { RowHeightInfo *rowHeightInfo; <span class="hljs-comment"><span class="hljs-comment">// eax int result; // ecx if ( sheetLayoutInfo-&gt;dword1A0 ) return sheetLayoutInfo-&gt;defaultFullRowHeightMul4 | (~(sheetLayoutInfo-&gt;defaultRowDelta2 &gt;&gt; 14 &lt;&lt; 15) &amp; 0x8000); if ( rowIndex &lt; sheetLayoutInfo-&gt;MinRowIndexNonDefault ) return sheetLayoutInfo-&gt;defaultFullRowHeightMul4 | (~(sheetLayoutInfo-&gt;defaultRowDelta2 &gt;&gt; 14 &lt;&lt; 15) &amp; 0x8000); if ( rowIndex &gt;= sheetLayoutInfo-&gt;MaxRowIndexNonDefault ) return sheetLayoutInfo-&gt;defaultFullRowHeightMul4 | (~(sheetLayoutInfo-&gt;defaultRowDelta2 &gt;&gt; 14 &lt;&lt; 15) &amp; 0x8000); rowHeightInfo = GetRowHeightCore(sheetLayoutInfo, rowIndex); if ( !rowHeightInfo ) return sheetLayoutInfo-&gt;defaultFullRowHeightMul4 | (~(sheetLayoutInfo-&gt;defaultRowDelta2 &gt;&gt; 14 &lt;&lt; 15) &amp; 0x8000); result = 0; if ( flag || !(rowHeightInfo-&gt;Flags &amp; 0x2000) ) result = rowHeightInfo-&gt;Value; if ( !(rowHeightInfo-&gt;Flags &amp; 0x4000) ) result |= 0x8000u; return result; }</span></span></code> </pre> <br><p>  Apa itu dword1A0, saya masih belum menemukan jawabannya.  tidak dapat menemukan tempat di mana bendera ini diset :( <br>  Apa defaultRowDelta2 bagi saya juga masih menjadi misteri.  Ketika excel menghitung tinggi baris berdasarkan format, itu menyatakannya sebagai jumlah dari dua angka.  defaultRowDelta2 adalah angka kedua dari jumlah ini untuk tinggi baris standar.  Nilai parameter flag juga misterius, karena  di mana pun saya melihat panggilan ke metode ini di flag lewat false. <br>  Kelas SheetLayoutInfo juga muncul dalam metode ini.  Saya menamakannya seperti itu, karena menyimpan banyak semua jenis informasi tentang penampilan lembar.  Di SheetLayoutInfo ada bidang seperti: </p><br><ul><li>  DefaultFullRowHeightMul4 - tinggi baris standar; </li><li>  MinRowIndexNonDefault - indeks baris pertama, di mana ketinggian berbeda dari standar; </li><li>  MaxRowIndexNonDefault - indeks dari seri mengikuti yang terakhir, di mana ketinggian berbeda dari standar; </li><li>  DefaultRowDelta2 adalah bagian yang sama dari jumlah tinggi baris standar. </li><li>  GroupIndexDelta - lebih lanjut tentang ini nanti </li></ul><br><p>  Pada prinsipnya, logika metode ini dapat dimengerti: </p><br><ol><li>  Jika indeks seri kurang dari yang pertama dengan tinggi non-standar, maka kembalikan standar; </li><li>  Jika indeks seri lebih besar dari yang terakhir dengan tinggi non-standar, maka kembalikan standar; </li><li>  Kalau tidak, kita mendapatkan objek rowHeightInfo untuk seri dari metode GetRowHeightCore; </li><li>  Jika rowHeightInfo == null mengembalikan tinggi baris standar; </li><li>  Ada keajaiban dengan flag, tetapi secara umum, kami mengembalikan apa yang ada di rowHeightInfo.Value dan mengatur bit ke-16 dalam respons jika tinggi baris tidak diatur secara manual. </li></ol><br><p>  Jika Anda menulis ulang kode ini dalam C #, Anda mendapatkan sesuatu seperti berikut: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> HiddenRowMask = <span class="hljs-number"><span class="hljs-number">0x2000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span> CustomHeightMask = <span class="hljs-number"><span class="hljs-number">0x4000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> DefaultHeightMask = <span class="hljs-number"><span class="hljs-number">0x8000</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">ushort</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRowHeight</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex, SheetLayoutInfo sheetLayoutInfo</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> defaultHeight = (<span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span>) (sheetLayoutInfo.DefaultFullRowHeightMul4 | (~(sheetLayoutInfo.DefaultRowDelta2 &gt;&gt; <span class="hljs-number"><span class="hljs-number">14</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">15</span></span>) &amp; DefaultHeightMask)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowIndex &lt; sheetLayoutInfo.MinRowIndexNonDefault) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> defaultHeight; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowIndex &gt;= sheetLayoutInfo.MaxRowIndexNonDefault) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> defaultHeight; RowHeightInfo rowHeightInfo = GetRowHeightCore(sheetLayoutInfo, rowIndex); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowHeightInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> defaultHeight; <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((rowHeightInfo.Flags &amp; HiddenRowMask) == <span class="hljs-number"><span class="hljs-number">0</span></span>) result = rowHeightInfo.Value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((rowHeightInfo.Flags &amp; CustomHeightMask) == <span class="hljs-number"><span class="hljs-number">0</span></span>) result |= DefaultHeightMask; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  Sekarang Anda dapat melihat apa yang terjadi di dalam GetRowHeightCore: </p><br><pre> <code class="cpp hljs">RowHeightInfo *__<span class="hljs-function"><span class="hljs-function">fastcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRowHeightCore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SheetLayoutInfo *sheetLayoutInfo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">signed</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex)</span></span></span><span class="hljs-function"> </span></span>{ RowHeightInfo *result; <span class="hljs-comment"><span class="hljs-comment">// eax RowsGroupInfo *rowsGroupInfo; // ecx int rowInfoIndex; // edx result = 0; if ( rowIndex &lt; sheetLayoutInfo-&gt;MinRowIndexNonDefault || rowIndex &gt;= sheetLayoutInfo-&gt;MaxRowIndexNonDefault ) return result; rowsGroupInfo = sheetLayoutInfo-&gt;RowsGroups[sheetLayoutInfo-GroupIndexDelta + (rowIndex &gt;&gt; 4)]; result = 0; if ( !rowsGroupInfo ) return result; rowInfoIndex = rowsGroupInfo-&gt;Indices[rowIndex &amp; 0xF]; if ( rowInfoIndex ) result = (rowsGroupInfo + 8 * (rowInfoIndex + rowsGroupInfo-&gt;wordBA + rowsGroupInfo-&gt;wordBC - rowsGroupInfo-&gt;wordB8)); return result; }</span></span></code> </pre> <br><ol><li>  Sekali lagi, di awal, Excel memeriksa untuk melihat apakah indeks seri berada di antara baris dengan ketinggian yang dimodifikasi, dan jika tidak, mengembalikan nol. </li><li>  Menemukan grup baris yang diinginkan, jika tidak ada grup seperti itu, ia mengembalikan nol. </li><li>  Mendapat indeks seri dalam grup. </li><li>  Selanjutnya, dengan indeks seri, ia menemukan objek yang diinginkan dari kelas RowHeightInfo.  wordBA, wordBC, wordB8 - beberapa konstanta.  Mereka berubah hanya dengan sejarah.  Pada prinsipnya, mereka tidak mempengaruhi pemahaman algoritma. </li></ol><br><p>  Di sini ada baiknya menyimpang dari topik dan menceritakan lebih banyak tentang RowsGroupInfo.  Excel menyimpan RowHeightInfo dalam grup yang terdiri dari 16 buah, di mana grup ke-i, yang diwakili oleh kelas RowsGroupInfo, akan menyimpan informasi tentang baris dari i √ó 16 hingga i √ó 16 + 15 inklusif. </p><br><p>  Tetapi informasi tinggi baris di RowsGroupInfo disimpan dengan cara yang agak tidak biasa.  Kemungkinan besar karena kebutuhan untuk mempertahankan riwayat di Excel. </p><br><p>  Ada tiga bidang penting dalam RowsGroupInfo: Indeks, HeightInfos, dan RowsCount, yang kedua tidak terlihat dalam kode di atas (harus di baris ini: (rowsGroupInfo + 8 √ó (...)), karena rowInfoIndex dapat mengambil nilai yang sangat berbeda , Saya telah melihat lebih dari 1000 dan saya tidak tahu cara mengatur struktur seperti itu di IDA. Bidang RowsCount tidak muncul dalam kode di atas, tetapi ini adalah berapa banyak baris yang benar-benar non-standar disimpan dalam grup. <br>  Selain itu, di SheetLayoutInfo ada GroupIndexDelta - perbedaan antara indeks nyata grup dan indeks grup pertama dengan tinggi baris yang dimodifikasi. </p><br><p>  Bidang Indeks menyimpan offset RowHeightInfo untuk setiap indeks seri dalam grup.  Mereka disimpan di sana secara berurutan, tetapi di HeightInfos RowHeightInfo sudah disimpan dalam urutan perubahan. </p><br><p>  Misalkan kita memiliki lembaran kosong baru dan entah bagaimana kita mengubah ketinggian nomor baris 23. Baris ini terletak pada kelompok kedua dari 16 baris, lalu: </p><br><ol><li>  Excel akan menentukan indeks grup untuk seri ini.  Dalam kasus saat ini, indeks akan menjadi 1 dan akan mengubah GroupIndexDelta = -1. </li><li>  Membuat objek kelas RowsGroupInfo untuk serangkaian baris dan meletakkannya di sheetLayoutInfo-&gt; RowsGroups di bawah indeks 0 (sheetLayoutInfo-&gt; GroupIndexDelta + 1); </li><li>  Dalam RowsGroupInfo, Excel akan mengalokasikan memori untuk 16 Indeks 4-byte, untuk RowsCount, wordBA, wordBC dan wordB8, dll.; </li><li>  Kemudian Excel menghitung indeks seri dalam grup melalui operasi AND bitwise (ini jauh lebih cepat daripada mengambil sisa divisi): rowIndex &amp; 0xF.  Indeks yang diinginkan dalam grup adalah: 23 &amp; 0xF = 7; </li><li>  Setelah itu, Excel mendapatkan offset untuk indeks 7: offset = Indeks [7].  Jika offset = 0, maka Excel mengalokasikan 8 byte di akhir RowsGroupInto, menambah RowsCount per satu, dan menulis offset baru ke Indeks [7].  Dalam hal apa pun, pada akhirnya, Excel menulis informasi tentang tinggi baris baru dan tanda pada offset di RowsGroupInfo. </li></ol><br><p>  Kelas RowsGroupInfo di C # itu sendiri akan terlihat seperti ini: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RowsGroupInfo</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] Indices { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;RowHeightInfo&gt; HeightInfos { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RowsGroupInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Indices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[SheetLayoutInfo.MaxRowsCountInGroup]; HeightInfos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;RowHeightInfo&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; SheetLayoutInfo.MaxRowsCountInGroup; i++) { Indices[i] = <span class="hljs-number"><span class="hljs-number">-1</span></span>; } } }</code> </pre> <br><p>  Metode GetRowHeightCore akan terlihat seperti ini: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> RowHeightInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRowHeightCore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SheetLayoutInfo sheetLayoutInfo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowIndex &lt; sheetLayoutInfo.MinRowIndexNonDefault || rowIndex &gt;= sheetLayoutInfo.MaxRowIndexNonDefault) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; RowsGroupInfo rowsGroupInfo = sheetLayoutInfo.RowsGroups[sheetLayoutInfo.GroupIndexDelta + (rowIndex &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>)]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowsGroupInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowInfoIndex = rowsGroupInfo.Indices[rowIndex &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rowInfoIndex != <span class="hljs-number"><span class="hljs-number">-1</span></span> ? rowsGroupInfo.HeightInfos[rowInfoIndex] : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><p>  Dan inilah yang akan terlihat oleh SetRowHeight (saya tidak mencantumkan kodenya dari excel.exe): </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRowHeight</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ushort</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newRowHeight, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ushort</span></span></span></span><span class="hljs-function"><span class="hljs-params"> flags, SheetLayoutInfo sheetLayoutInfo</span></span></span><span class="hljs-function">)</span></span> { sheetLayoutInfo.MaxRowIndexNonDefault = Math.Max(sheetLayoutInfo.MaxRowIndexNonDefault, rowIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); sheetLayoutInfo.MinRowIndexNonDefault = Math.Min(sheetLayoutInfo.MinRowIndexNonDefault, rowIndex); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> realGroupIndex = rowIndex &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sheetLayoutInfo.RowsGroups.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { sheetLayoutInfo.RowsGroups.Add(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); sheetLayoutInfo.GroupIndexDelta = -realGroupIndex; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sheetLayoutInfo.GroupIndexDelta + realGroupIndex &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bucketSize = -(sheetLayoutInfo.GroupIndexDelta + realGroupIndex); sheetLayoutInfo.RowsGroups.InsertRange(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowsGroupInfo[bucketSize]); sheetLayoutInfo.GroupIndexDelta = -realGroupIndex; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sheetLayoutInfo.GroupIndexDelta + realGroupIndex &gt;= sheetLayoutInfo.RowsGroups.Count) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bucketSize = sheetLayoutInfo.GroupIndexDelta + realGroupIndex - sheetLayoutInfo.RowsGroups.Count + <span class="hljs-number"><span class="hljs-number">1</span></span>; sheetLayoutInfo.RowsGroups.AddRange(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowsGroupInfo[bucketSize]); } RowsGroupInfo rowsGroupInfo = sheetLayoutInfo.RowsGroups[sheetLayoutInfo.GroupIndexDelta + realGroupIndex]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowsGroupInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { rowsGroupInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowsGroupInfo(); sheetLayoutInfo.RowsGroups[sheetLayoutInfo.GroupIndexDelta + realGroupIndex] = rowsGroupInfo; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowInfoIndex = rowsGroupInfo.Indices[rowIndex &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>]; RowHeightInfo rowHeightInfo; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowInfoIndex == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { rowHeightInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowHeightInfo(); rowsGroupInfo.HeightInfos.Add(rowHeightInfo); rowsGroupInfo.Indices[rowIndex &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>] = rowsGroupInfo.HeightInfos.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rowHeightInfo = rowsGroupInfo.HeightInfos[rowInfoIndex]; } rowHeightInfo.Value = newRowHeight; rowHeightInfo.Flags = flags; }</code> </pre> <br><h2 id="nemnogo-praktiki">  Sedikit latihan </h2><br><p>  Setelah contoh di atas, dengan perubahan ketinggian baris 23, Excel akan terlihat seperti ini (saya menetapkan baris 23 ke ketinggian 75 poin): </p><br><div class="spoiler">  <b class="spoiler_title">sheetLayoutInfo</b> <div class="spoiler_text"><ul><li>  DefaultFullRowHeightMul4 = 80 </li><li>  DefaultRowDelta2 = 5 </li><li>  MaxRowIndexNonDefault = 24 </li><li>  MinRowIndexNonDefault = 23 </li><li>  GroupIndexDelta = -1 </li><li>  Hitungan RowsGroups = 1 <br><ul><li>  [0] RowsGroupInfo </li><li>  Hitungan HeightInfos = 1 <br><ul><li>  [0] RowHeightInfo </li><li>  Bendera = 0x4005 </li><li>  Nilai = 100 </li></ul></li><li>  Indeks <br><ul><li>  [0] = -1 </li><li>  [1] = -1 </li><li>  [2] = -1 </li><li>  [3] = -1 </li><li>  [4] = -1 </li><li>  [5] = -1 </li><li>  [6] = -1 </li><li>  [7] = 0 </li><li>  [8] = -1 </li><li>  [9] = -1 </li><li>  [10] = -1 </li><li>  [11] = -1 </li><li>  [12] = -1 </li><li>  [13] = -1 </li><li>  [14] = -1 </li><li>  [15] = -1 </li></ul></li></ul></li></ul></div></div><br>  Di sini dan dalam contoh berikut, saya akan memberikan gambaran skematis tentang bagaimana data dalam memori Excel terlihat, dibuat dalam Visual Studio dari kelas yang ditulis sendiri, karena pembuangan langsung dari memori tidak terlalu informatif. <br>  Sekarang mari kita coba sembunyikan baris 23. Untuk melakukan ini, atur bit 0x2000.  Kami akan mengubah memori untuk hidup.  Hasilnya dapat dilihat di video ini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://recordit.co/79vYIbwbzB</a> . <br>  Setiap kali Anda menyembunyikan baris, Excel melakukan hal yang sama. <br>  Sekarang mari kita atur tinggi baris tidak secara eksplisit, tetapi melalui format sel.  Biarkan font di sel A20 menjadi ketinggian 40 poin, maka tinggi sel dalam poin akan menjadi 45,75 dan dalam memori Excel akan menjadi sesuatu seperti ini: <br><div class="spoiler">  <b class="spoiler_title">sheetLayoutInfo</b> <div class="spoiler_text"><ul><li>  DefaultFullRowHeightMul4 = 80 </li><li>  DefaultRowDelta2 = 5 </li><li>  MaxRowIndexNonDefault = 24 </li><li>  MinRowIndexNonDefault = 20 </li><li>  GroupIndexDelta = -1 </li><li>  Hitungan RowsGroups = 1 <br><ul><li>  [0] RowsGroupInfo </li><li>  Hitungan HeightInfos = 2 <br><ul><li>  [0] RowHeightInfo </li><li>  Bendera = 0x4005 </li><li>  Nilai = 100 </li><li>  [1] RowHeightInfo </li><li>  Bendera = 0x800E </li><li>  Nilai = 244 </li></ul></li><li>  Indeks <br><ul><li>  [0] = -1 </li><li>  [1] = -1 </li><li>  [2] = -1 </li><li>  [3] = -1 </li><li>  [4] = 1 </li><li>  [5] = -1 </li><li>  [6] = -1 </li><li>  [7] = 0 </li><li>  [8] = -1 </li><li>  [9] = -1 </li><li>  [10] = -1 </li><li>  [11] = -1 </li><li>  [12] = -1 </li><li>  [13] = -1 </li><li>  [14] = -1 </li><li>  [15] = -1 </li></ul></li></ul></li></ul></div></div><br><p>  Anda mungkin memperhatikan bahwa Excel selalu menyimpan tinggi baris jika tidak standar.  Sekalipun tingginya tidak disetel secara eksplisit, tetapi dihitung berdasarkan konten sel atau format, Excel masih akan menghitungnya sekali dan meletakkan hasilnya di grup yang sesuai. </p><br><h2 id="razbiraemsya-so-vstavkoyudaleniem-ryadov">  Kami berurusan dengan penyisipan / penghapusan baris </h2><br><p>  Akan menarik untuk menguraikan apa yang terjadi ketika memasukkan / menghapus baris.  Kode yang sesuai di excel.exe tidak sulit ditemukan, tetapi tidak ada keinginan untuk membongkarnya, Anda dapat melihat bagian darinya: </p><br><div class="spoiler">  <b class="spoiler_title">sub_305EC930</b> <div class="spoiler_text"><p>  Bendera a5 menentukan operasi mana yang sedang berlangsung. </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __userpurge sub_305EC930@&lt;eax&gt;(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a1@&lt;eax&gt;, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a2@&lt;edx&gt;, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a3@&lt;ecx&gt;, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a4, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a5, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a6) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v6; <span class="hljs-comment"><span class="hljs-comment">// esi int v7; // ebx int v8; // edi int v9; // edx int v10; // ecx size_t v11; // eax _WORD *v12; // ebp size_t v13; // eax size_t v14; // eax int v15; // eax unsigned __int16 *v16; // ecx _WORD *v17; // eax _WORD *v18; // ecx int v19; // edx __int16 v20; // bx int v21; // eax _WORD *v22; // ecx int v24; // edx int v25; // eax int v26; // esi int v27; // ebx size_t v28; // eax int v29; // ebp size_t v30; // eax int v31; // esi size_t v32; // eax int v33; // eax unsigned __int16 *v34; // ecx int v35; // eax _WORD *v36; // edx _WORD *v37; // ecx int v38; // eax __int16 v39; // bx int v40; // eax _WORD *v41; // ecx int v42; // [esp+10h] [ebp-48h] int v43; // [esp+10h] [ebp-48h] int v44; // [esp+14h] [ebp-44h] char v45; // [esp+14h] [ebp-44h] int Dst[16]; // [esp+18h] [ebp-40h] int v47; // [esp+5Ch] [ebp+4h] int v48; // [esp+60h] [ebp+8h] v6 = a1; v7 = a1 &amp; 0xF; v8 = a2; if ( !a5 ) { v24 = a4 - a1; v25 = a1 - a3; v43 = a4 - v6; if ( v7 &gt;= v25 ) v7 = v25; v47 = a4 - v7; v26 = v6 - v7; v27 = v7 + 1; v48 = v27; if ( !v8 ) return v27; v28 = 4 * v24; if ( (4 * v24) &gt; 0x40 ) v28 = 64; v45 = v27 + v26; v29 = (v27 + v26) &amp; 0xF; memmove(Dst, (v8 + 4 * v29), v28); v30 = 4 * v27; if ( (4 * v27) &gt; 0x40 ) v30 = 64; v31 = v26 &amp; 0xF; memmove((v8 + 4 * (v47 &amp; 0xF)), (v8 + 4 * v31), v30); v32 = 4 * v43; if ( (4 * v43) &gt; 0x40 ) v32 = 64; memmove((v8 + 4 * v31), Dst, v32); if ( !a6 ) return v48; v33 = v29; if ( v29 &lt; v29 + v43 ) { v34 = (v8 + 4 * v29 + 214); do { Dst[v33++] = *v34 &gt;&gt; 15; v34 += 2; } while ( v33 &lt; v29 + v43 ); } v35 = (v45 - 1) &amp; 0xF; if ( v35 &gt;= v31 ) { v36 = (v8 + 4 * ((v27 + v47 - 1) &amp; 0xF) + 214); v37 = (v8 + 4 * ((v45 - 1) &amp; 0xF) + 214); v38 = v35 - v31 + 1; do { v39 = *v37 ^ (*v37 ^ *v36) &amp; 0x7FFF; v37 -= 2; *v36 = v39; v36 -= 2; --v38; } while ( v38 ); v27 = v48; } v40 = v31; if ( v31 &gt;= v31 + v43 ) return v27; v41 = (v8 + 4 * v31 + 214); do { *v41 = *v41 &amp; 0x7FFF | (LOWORD(Dst[v40++]) &lt;&lt; 15); v41 += 2; } while ( v40 &lt; v31 + v43 ); return v27; } v9 = a1 - a4; v10 = a3 - a1; v42 = a1 - a4; v48 = 16 - v7; if ( 16 - v7 &gt;= v10 ) v48 = v10; if ( !v8 ) return v48; v11 = 4 * v9; if ( (4 * v9) &gt; 0x40 ) v11 = 64; v12 = (v8 + 4 * (a4 &amp; 0xF)); v44 = a4 &amp; 0xF; memmove(Dst, v12, v11); v13 = 4 * v48; if ( (4 * v48) &gt; 0x40 ) v13 = 64; memmove(v12, (v8 + 4 * v7), v13); v14 = 4 * v42; if ( (4 * v42) &gt; 0x40 ) v14 = 64; memmove((v8 + 4 * ((a4 + v48) &amp; 0xF)), Dst, v14); if ( !a6 ) return v48; v15 = a4 &amp; 0xF; if ( v44 &lt; v44 + v42 ) { v16 = (v8 + 4 * v44 + 214); do { Dst[v15++] = *v16 &gt;&gt; 15; v16 += 2; } while ( v15 &lt; v44 + v42 ); } if ( v7 &lt; v48 + v7 ) { v17 = (v8 + 4 * v7 + 214); v18 = v12 + 107; v19 = v48; do { v20 = *v17 ^ (*v17 ^ *v18) &amp; 0x7FFF; v17 += 2; *v18 = v20; v18 += 2; --v19; } while ( v19 ); } v21 = a4 &amp; 0xF; if ( v44 &gt;= v44 + v42 ) return v48; v22 = (v8 + 4 * (v44 + v48) + 214); do { *v22 = *v22 &amp; 0x7FFF | (LOWORD(Dst[v21++]) &lt;&lt; 15); v22 += 2; } while ( v21 &lt; v44 + v42 ); return v48; }</span></span></code> </pre> </div></div><br><p>  Selain itu, dalam penampilan, Anda dapat secara kasar memahami apa yang terjadi di sana, dan sisanya berakhir dengan tanda tidak langsung. <br>  Kami mencoba mengidentifikasi fitur-fitur tidak langsung ini.  Pertama, atur ketinggian untuk baris 16 hingga 64 inklusif dalam urutan acak.  Kemudian, di depan baris di bawah indeks 39, masukkan baris baru.  Baris baru akan menyalin ketinggian baris 38. <br>  Mari kita lihat informasi dalam kelompok seri sebelum dan sesudah menambahkan seri, saya menyoroti perbedaan yang mencolok: </p><br><table><thead><tr><th>  Sebelum menambahkan baris </th><th>  Setelah menambahkan satu baris </th></tr></thead><tbody><tr><td>  Perpindahan di grup pertama: </td><td>  Perpindahan di grup pertama: </td></tr><tr><td>  0E, 04, 07, 00, 05, 0A, 09, 0F, 03, 06, 08, 0D, 01, 0B, 0C, 02 </td><td>  0E, 04, 07, 00, 05, 0A, 09, 0F, 03, 06, 08, 0D, 01, 0B, 0C, 02 </td></tr><tr><td>  Nilai-nilai ketinggian baris di grup pertama: </td><td>  Nilai-nilai ketinggian baris di grup pertama: </td></tr><tr><td>  05, 2B, 35, 45, 4B, 50, 5B, 6B, 7B, 8B, A5, AB, B0, B5, E0, 100 </td><td>  05, 2B, 35, 45, 4B, 50, 5B, 6B, 7B, 8B, A5, AB, B0, B5, E0, 100 </td></tr><tr><td>  Perpindahan di grup kedua: </td><td>  Perpindahan di grup kedua: </td></tr><tr><td>  06, 02, 0E, 09, 01, 07, <strong>0F, 0C</strong> , 00, 0A, 04, 0B, 03, 08, <strong>0D, 05</strong> </td><td>  06, 02, 0E, 09, 01, 07, <strong>0F, 05, 0C</strong> , 00, 0A, 04, 0B, 03, 08, <strong>0D</strong> </td></tr><tr><td>  Nilai ketinggian baris pada grup kedua: </td><td>  Nilai ketinggian baris pada grup kedua: </td></tr><tr><td>  10, 15, 20, 25, 30, <strong>75</strong> , 85, 90, 9B, A0, C5, CB, D0, D5, E5, F0 </td><td>  10, 15, 20, 25, 30, <strong>F0</strong> , 85, 90, 9B, A0, C5, CB, D0, D5, E5, F0 </td></tr><tr><td>  Perpindahan di kelompok ketiga: </td><td>  Perpindahan di kelompok ketiga: </td></tr><tr><td>  0C, 08, 0E, 07, 0A, 01, 06, 0F, 09, 0D, 00, 05, 0B, 02, 04, <strong>03</strong> </td><td>  <strong>03</strong> , 0C, 08, 0E, 07, 0A, 01, 06, 0F, 09, 0D, 00, 05, 0B, 02, 04 </td></tr><tr><td>  Nilai ketinggian baris pada grup ketiga: </td><td>  Nilai ketinggian baris pada grup ketiga: </td></tr><tr><td>  0B, 1B, 3B, <strong>40</strong> , 55, 60, 65, 70, 80, 95, BB, C0, DB, EB, F5, FB </td><td>  0B, 1B, 3B, <strong>75</strong> , 55, 60, 65, 70, 80, 95, BB, C0, DB, EB, F5, FB </td></tr><tr><td>  Offset di grup keempat: </td><td>  Offset di grup keempat: </td></tr><tr><td>  _ </td><td>  <strong>00</strong> </td></tr><tr><td>  Nilai-nilai ketinggian baris di grup keempat: </td><td>  Nilai-nilai ketinggian baris di grup keempat: </td></tr><tr><td>  _ </td><td>  <strong>40</strong> </td></tr></tbody></table><br><p>  Inilah yang diharapkan: Excel memasukkan ke grup kedua baris baru dengan indeks 7 (39 &amp; 0xF), yang offsetnya 0x05, menyalin tinggi baris pada indeks 6, sedangkan baris terakhir, yang diimbangi 05, didorong ke berikutnya grup, dan dari sana baris terakhir didorong ke keempat, dll. </p><br><p>  Sekarang mari kita lihat apa yang terjadi jika Anda menghapus baris ke-29. </p><br><table><thead><tr><th>  Sebelum menghapus satu baris </th><th>  Setelah menghapus baris </th></tr></thead><tbody><tr><td>  Perpindahan di grup pertama: </td><td>  Perpindahan di grup pertama: </td></tr><tr><td>  0E, 04, 07, 00, 05, 0A, 09, 0F, 03, 06, 08, 0D, 01, <strong>0B, 0C, 02</strong> </td><td>  0E, 04, 07, 00, 05, 0A, 09, 0F, 03, 06, 08, 0D, 01, <strong>0C, 02, 0B</strong> </td></tr><tr><td>  Nilai-nilai ketinggian baris di grup pertama: </td><td>  Nilai-nilai ketinggian baris di grup pertama: </td></tr><tr><td>  05, 2B, 35, 45, 4B, 50, 5B, 6B, 7B, 8B, A5, <strong>AB</strong> , B0, B5, E0, 100 </td><td>  05, 2B, 35, 45, 4B, 50, 5B, 6B, 7B, 8B, A5, <strong>85</strong> , B0, B5, E0, 100 </td></tr><tr><td>  Perpindahan di grup kedua: </td><td>  Perpindahan di grup kedua: </td></tr><tr><td>  <strong>06</strong> , 02, 0E, 09, 01, 07, 0F, 05, 0C, 00, 0A, 04, 0B, 03, 08, 0D </td><td>  02, 0E, 09, 01, 07, 0F, 05, 0C, 00, 0A, 04, 0B, 03, 08, 0D, <strong>06</strong> </td></tr><tr><td>  Nilai ketinggian baris pada grup kedua: </td><td>  Nilai ketinggian baris pada grup kedua: </td></tr><tr><td>  10, 15, 20, 25, 30, F0, <strong>85</strong> , 90, 9B, A0, C5, CB, D0, D5, E5, F0 </td><td>  10, 15, 20, 25, F0, <strong>75</strong> , 90, 9B, A0, C5, CB, D0, D5, E5, F0 </td></tr><tr><td>  Perpindahan di kelompok ketiga: </td><td>  Perpindahan di kelompok ketiga: </td></tr><tr><td>  <strong>03</strong> , 0C, 08, 0E, 07, 0A, 01, 06, 0F, 09, 0D, 00, 05, 0B, 02, 04 </td><td>  0C, 08, 0E, 07, 0A, 01, 06, 0F, 09, 0D, 00, 05, 0B, 02, 04, <strong>03</strong> </td></tr><tr><td>  Nilai ketinggian baris pada grup ketiga: </td><td>  Nilai ketinggian baris pada grup ketiga: </td></tr><tr><td>  0B, 1B, 3B, <strong>75</strong> , 55, 60, 65, 70, 80, 95, BB, C0, DB, EB, F5, FB </td><td>  0B, 1B, 3B, <strong>40</strong> , 55, 60, 65, 70, 80, 95, BB, C0, DB, EB, F5, FB </td></tr><tr><td>  Offset di grup keempat: </td><td>  Offset di grup keempat: </td></tr><tr><td>  00 </td><td>  00 </td></tr><tr><td>  Nilai-nilai ketinggian baris di grup keempat: </td><td>  Nilai-nilai ketinggian baris di grup keempat: </td></tr><tr><td>  <strong>40</strong> </td><td>  <strong>50</strong> </td></tr></tbody></table><br><p>  Pada prinsipnya, ketika sebuah baris dihapus, operasi terbalik terjadi.  Dalam hal ini, grup keempat terus ada dan nilai tinggi baris di sana diisi dengan tinggi standar dengan bendera yang sesuai - 0x8005. </p><br><p>  Data ini cukup untuk mereproduksi algoritma ini dalam C #: </p><br><div class="spoiler">  <b class="spoiler_title">Masukkan</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InsertRow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SheetLayoutInfo sheetLayoutInfo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowIndex &gt;= sheetLayoutInfo.MaxRowIndexNonDefault) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; RowHeightInfo etalonRowHeightInfo = GetRowHeightCore(sheetLayoutInfo, rowIndex); RowHeightInfo newRowHeightInfo = etalonRowHeightInfo != <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? etalonRowHeightInfo.Clone() : CreateDefaultRowHeight(sheetLayoutInfo); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> realGroupIndex = (rowIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newRowInGroupIndex = (rowIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> groupIndex; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (groupIndex = realGroupIndex + sheetLayoutInfo.GroupIndexDelta; groupIndex &lt; sheetLayoutInfo.RowsGroups.Count; groupIndex++, newRowInGroupIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (groupIndex &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (groupIndex == SheetLayoutInfo.MaxGroupsCount) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; RowsGroupInfo rowsGroupInfo = sheetLayoutInfo.RowsGroups[groupIndex]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowsGroupInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((newRowHeightInfo.Flags &amp; CustomHeightMask) == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; rowsGroupInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowsGroupInfo(); sheetLayoutInfo.RowsGroups[groupIndex] = rowsGroupInfo; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowInfoIndex = rowsGroupInfo.Indices[newRowInGroupIndex]; RowHeightInfo lastRowHeightInGroup; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowInfoIndex == <span class="hljs-number"><span class="hljs-number">-1</span></span> || rowsGroupInfo.HeightInfos.Count &lt; SheetLayoutInfo.MaxRowsCountInGroup) { lastRowHeightInGroup = GetRowHeightCore(sheetLayoutInfo, ((groupIndex - sheetLayoutInfo.GroupIndexDelta) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) + SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span>); Array.Copy(rowsGroupInfo.Indices, newRowInGroupIndex, rowsGroupInfo.Indices, newRowInGroupIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>, SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span> - newRowInGroupIndex); rowsGroupInfo.HeightInfos.Add(newRowHeightInfo); rowsGroupInfo.Indices[newRowInGroupIndex] = rowsGroupInfo.HeightInfos.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lastIndex = rowsGroupInfo.Indices[SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span>]; lastRowHeightInGroup = rowsGroupInfo.HeightInfos[lastIndex]; Array.Copy(rowsGroupInfo.Indices, newRowInGroupIndex, rowsGroupInfo.Indices, newRowInGroupIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>, SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span> - newRowInGroupIndex); rowsGroupInfo.HeightInfos[lastIndex] = newRowHeightInfo; rowsGroupInfo.Indices[newRowInGroupIndex] = lastIndex; } newRowHeightInfo = lastRowHeightInGroup ?? CreateDefaultRowHeight(sheetLayoutInfo); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((newRowHeightInfo.Flags &amp; CustomHeightMask) != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; groupIndex != SheetLayoutInfo.MaxGroupsCount) { SetRowHeight(((groupIndex - sheetLayoutInfo.GroupIndexDelta) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) + newRowInGroupIndex, newRowHeightInfo.Value, newRowHeightInfo.Flags, sheetLayoutInfo); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { sheetLayoutInfo.MaxRowIndexNonDefault = Math.Min(sheetLayoutInfo.MaxRowIndexNonDefault + <span class="hljs-number"><span class="hljs-number">1</span></span>, SheetLayoutInfo.MaxRowsCount); } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Removerow</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveRow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SheetLayoutInfo sheetLayoutInfo, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowIndex &gt;= sheetLayoutInfo.MaxRowIndexNonDefault) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> realGroupIndex = rowIndex &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newRowInGroupIndex = rowIndex &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> groupIndex; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (groupIndex = realGroupIndex + sheetLayoutInfo.GroupIndexDelta; groupIndex &lt; sheetLayoutInfo.RowsGroups.Count; groupIndex++, newRowInGroupIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (groupIndex &lt; <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (groupIndex == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { sheetLayoutInfo.RowsGroups.Insert(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); sheetLayoutInfo.GroupIndexDelta++; groupIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (groupIndex == SheetLayoutInfo.MaxGroupsCount) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newRowHeightInfo = groupIndex == SheetLayoutInfo.MaxGroupsCount - <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-literal"><span class="hljs-literal">null</span></span> : GetRowHeightCore(sheetLayoutInfo, (groupIndex - sheetLayoutInfo.GroupIndexDelta + <span class="hljs-number"><span class="hljs-number">1</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>); RowsGroupInfo rowsGroupInfo = sheetLayoutInfo.RowsGroups[groupIndex]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowsGroupInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newRowHeightInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || (newRowHeightInfo.Flags &amp; CustomHeightMask) == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; rowsGroupInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RowsGroupInfo(); sheetLayoutInfo.RowsGroups[groupIndex] = rowsGroupInfo; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newRowHeightInfo == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { newRowHeightInfo = CreateDefaultRowHeight(sheetLayoutInfo); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowInfoIndex = rowsGroupInfo.Indices[newRowInGroupIndex]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowInfoIndex == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = newRowInGroupIndex; i &lt; SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { rowsGroupInfo.Indices[i] = rowsGroupInfo.Indices[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; } rowsGroupInfo.HeightInfos.Add(newRowHeightInfo); rowsGroupInfo.Indices[SheetLayoutInfo.MaxRowsCountInGroup - <span class="hljs-number"><span class="hljs-number">1</span></span>] = rowsGroupInfo.HeightInfos.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = newRowInGroupIndex; i &lt; rowsGroupInfo.HeightInfos.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { rowsGroupInfo.Indices[i] = rowsGroupInfo.Indices[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; } rowsGroupInfo.Indices[rowsGroupInfo.HeightInfos.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>] = rowInfoIndex; rowsGroupInfo.HeightInfos[rowInfoIndex] = newRowHeightInfo; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rowIndex &lt;= sheetLayoutInfo.MinRowIndexNonDefault) { sheetLayoutInfo.MinRowIndexNonDefault = Math.Max(sheetLayoutInfo.MinRowIndexNonDefault - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } }</code> </pre> </div></div><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Anda dapat menemukan semua kode di atas di GitHub</strong></a> </p><br><h2 id="vyvody">  Kesimpulan </h2><br><p>  Ini bukan pertama kalinya kode Excel terkejut dengan trik menarik.  Kali ini saya menemukan bagaimana dia menyimpan informasi tentang ketinggian baris.  Jika komunitas tertarik, maka pada artikel berikutnya saya akan menunjukkan bagaimana Excel mempertimbangkan ketinggian rentang sel (spoiler: ada sesuatu yang mirip dengan dekomposisi SQRT, tetapi untuk beberapa alasan tanpa caching jumlah), di sana Anda dapat melihat bagaimana itu menerapkan penskalaan dalam bilangan bulat . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id435426/">https://habr.com/ru/post/id435426/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id435416/index.html">Teknik proyek DIY. Bagian pengantar</a></li>
<li><a href="../id435418/index.html">Menggunakan SQLite di Flutter</a></li>
<li><a href="../id435420/index.html">Masa depan perang melawan kejahatan adalah studi tentang pohon keluarga</a></li>
<li><a href="../id435422/index.html">Betapa berpengalamannya orang-orang di Lembah Silikon</a></li>
<li><a href="../id435424/index.html">Parse & Android: rekomendasi untuk pengembang pemula</a></li>
<li><a href="../id435428/index.html">Remote control emulator Fceux menggunakan Python</a></li>
<li><a href="../id435430/index.html">Berita paling keren CES 2019</a></li>
<li><a href="../id435432/index.html">Tahun Baru, GitHub Baru: Repositori Pribadi Gratis Tanpa Batas</a></li>
<li><a href="../id435436/index.html">5 tren dalam infrastruktur TI: perkiraan untuk 2019</a></li>
<li><a href="../id435438/index.html">PHP: mengubah struktur basis data dalam pengembangan tim</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>