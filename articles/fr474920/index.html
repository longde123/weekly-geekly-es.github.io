<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ö∞Ô∏è üë®üèΩ‚Äçüé§ üë´ Et s'il n'y a pas d'analyseur statique pour votre langue pr√©f√©r√©e? ‚òëÔ∏è ‚òÆÔ∏è üë©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eh bien, si votre langue pr√©f√©r√©e est le russe, l'anglais, etc., c'est dans un autre hub . Et si le langage de programmation ou de balisage, alors bie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Et s'il n'y a pas d'analyseur statique pour votre langue pr√©f√©r√©e?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474920/"><p>  Eh bien, si votre langue pr√©f√©r√©e est le russe, l'anglais, etc., c'est dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un autre hub</a> .  Et si le langage de programmation ou de balisage, alors bien s√ªr, √©crivez l'analyseur vous-m√™me!  √Ä premi√®re vue, c'est tr√®s difficile, mais, heureusement, il existe des outils multilingues pr√™ts √† l'emploi, qui sont relativement faciles √† ajouter √† la prise en charge d'une nouvelle langue.  Aujourd'hui, je vais montrer comment ajouter la prise en charge du langage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Modelica</a> √† l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">analyseur PMD</a> avec un temps assez court. </p><br><p> Soit dit en passant, savez-vous ce qui peut d√©grader la qualit√© de la base de code obtenue √† partir d'une s√©quence de demandes d'extraction id√©ales?  Le fait que des programmeurs tiers aient copi√© des morceaux de code de projet existant dans leurs correctifs au lieu d'une abstraction comp√©tente.  Vous devez admettre que, dans une certaine mesure, il est encore plus difficile de d√©tecter une telle banalit√© qu'un code de mauvaise qualit√© - il est de haute qualit√© et m√™me <strong>d√©j√†</strong> compl√®tement d√©bogu√©, donc la v√©rification locale ne suffit pas ici, vous devez garder √† l'esprit l'int√©gralit√© de la base de code, mais ce n'est pas facile pour une personne ... Donc: l'ajout de la prise en charge compl√®te de Modelica (sans cr√©er de r√®gles sp√©cifiques) √† l'√©tat ¬´peut ex√©cuter des v√©rifications primitives¬ª m'a pris environ une semaine, puis seule la prise en charge du d√©tecteur copier-coller peut souvent √™tre ajout√©e en une journ√©e! </p><a name="habracut"></a><br><h2 id="kakaya-eschyo-modelica">  Quoi d'autre est Modelica? </h2><br><p> Modelica est, comme son nom l'indique, un langage pour √©crire des mod√®les de syst√®mes physiques.  En fait, non seulement physique: il est possible de d√©crire les processus chimiques, le comportement quantitatif des populations animales, etc. - cela est d√©crit par des syst√®mes d'√©quations diff√©rentielles de la forme <code>der(X) = f(X)</code> , o√π <code>X</code> est le vecteur d'inconnues.  Des morceaux de code imp√©ratifs sont √©galement pris en charge.  Les √©quations diff√©rentielles partielles ne sont pas explicitement prises en charge, mais il est possible de diviser la zone d'√©tude en morceaux (comme nous l'aurions probablement fait dans un langage √† usage g√©n√©ral), puis d'√©crire les √©quations pour chaque √©l√©ment, r√©duisant le probl√®me au pr√©c√©dent.  L'astuce de Modelka est que la solution √† ce <code>der(X) = f(X)</code> r√©side dans le compilateur: vous pouvez simplement changer le solveur <strong>dans les param√®tres</strong> , l'√©quation n'a pas √† √™tre lin√©aire, etc. En bref, il y a quelques avantages (j'ai √©crit la formule du manuel - et cela a fonctionn√©), et les inconv√©nients (avec plus d'abstraction, nous obtenons moins de contr√¥le).  Une introduction √† Modelika fait l'objet d'un article s√©par√© (qui a d√©j√† paru plusieurs fois sur Habr√©), et m√™me d'un cycle entier, aujourd'hui il m'int√©resse comme un open et ayant plusieurs impl√©mentations, mais, h√©las, toujours un standard humide. </p><br><p>  De plus, Modelika, d'une part, a une typification statique (ce qui nous aidera √† √©crire une analyse significative plus rapidement), d'autre part, lors de l'instanciation d'un mod√®le, le compilateur n'est pas oblig√© de v√©rifier enti√®rement la biblioth√®que enti√®re (par cons√©quent, un analyseur statique est tr√®s utile pour capturer ¬´dormant¬ª bugs).  Enfin, contrairement √† certains C ++, pour lesquels il existe un nuage d'analyseurs statiques et de compilateurs avec de belles, <del>  et surtout d√©taill√©, voir les mod√®les C ++ </del>  diagnostics d'erreurs, compilateurs Les mod√®les g√©n√®rent toujours p√©riodiquement une erreur de compilation interne, ce qui signifie qu'il y a de la place pour aider l'utilisateur m√™me avec un analyseur assez simple. </p><br><h2 id="a-chto-za-pmd">  Qu'est-ce que PMD? </h2><br><p>  Je r√©pondrai <del>  chanson </del>  √† v√©lo.  Une fois, je voulais faire une petite demande d'extraction dans l'environnement de d√©veloppement pour OpenModelica.  En voyant comment l'enregistrement du mod√®le est trait√© dans une autre partie du code, j'ai remarqu√© une petite partie int√©rieure peu claire de quatre lignes de code qui supportait une sorte d'invariant.  Ne comprenant pas avec quel type d'√©diteur interne il interagit, mais r√©alisant que du point de vue de ce morceau de code, ma t√¢che est compl√®tement identique, je l'ai simplement mis dans une fonction afin de pouvoir le r√©utiliser et non le casser.  Menteiner a dit, c'est merveilleux, alors seulement remplacez ce code par un appel de fonction dans les vingt endroits restants ... J'ai d√©cid√© de ne pas m'impliquer encore, et j'ai juste fait une autre copie, notant qu'alors d'une certaine fa√ßon je devrais tout peigner √† la fois sans m√©langer avec le patch actuel.  Googler, j'ai trouv√© le d√©tecteur de copier-coller (CPD) - une partie de l'analyseur statique PMD - qui prend en charge encore plus de langues que l'analyseur lui-m√™me.  Apr√®s l'avoir d√©fini sur la base de code OMEdit, je m'attendais √† voir ces deux douzaines de morceaux de quatre lignes.  Je ne les ai tout simplement pas vus (chacun d'eux n'a tout simplement pas d√©pass√© le seuil du nombre de jetons), mais j'ai vu, par exemple, la r√©p√©tition de pr√®s de cinquante lignes de code C ++.  Comme je l'ai d√©j√† dit, il est peu probable que le mentor ait simplement copi√© une gigantesque pi√®ce d'un autre fichier.  Mais il pourrait facilement passer √† c√¥t√© de PR - car le code, par d√©finition, r√©pondait d√©j√† √† toutes les normes du projet!  Lorsque j'ai partag√© l'observation avec le mentor, il a convenu qu'il serait n√©cessaire de nettoyer dans le cadre d'une t√¢che distincte. </p><br><p>  En cons√©quence, le d√©tecteur d'erreur de programme (PMD) est un analyseur statique facilement extensible.  Peut-√™tre qu'il ne calcule pas l'ensemble de valeurs qu'une variable peut prendre (bien que qui sait ...), mais pour y ajouter des r√®gles, vous n'avez m√™me pas besoin de conna√Ætre Java et de changer son code!  Le fait est que la premi√®re chose que lui, et sans surprise, construit des fichiers AST avec des codes sources.  Et √† quoi ressemble l'arbre d'analyse source?  Vers l'arbre d'analyse XML!  Ainsi, vous pouvez d√©crire les r√®gles simplement comme des demandes XPath - pour lesquelles elles correspondent, puis nous √©mettons un avertissement.  Ils ont m√™me un d√©bogueur graphique pour les r√®gles!  Des r√®gles plus complexes, bien s√ªr, peuvent √™tre √©crites directement en Java en tant que visiteurs de l'AST. </p><br><p>  <em><strong>Cons√©quence</strong></em> : PMD peut √™tre utilis√© non seulement pour les r√®gles strictes et universelles que les programmeurs Java s√©v√®res ont appliqu√©es au code de l'analyseur, mais aussi pour le style de codage local - m√™me si vous poussez votre propre jeu de r√®gles local.xml dans chaque r√©f√©rentiel! </p><br><h2 id="uroven-1-nahodim-kopipast-avtomatizirovanno">  Niveau 1: trouver le copier-coller automatiquement </h2><br><p>  En principe, l'ajout d'une prise en charge d'une nouvelle langue en CPD est souvent tr√®s simple.  Je ne vois aucun sens √† raconter la documentation ¬´comment faire¬ª - elle est tr√®s claire, structur√©e et √©tape par √©tape.  Pour raconter une telle chose - ne jouez que dans un t√©l√©phone endommag√©.  Je ferais mieux de d√©crire ce qui vous attend <em>(TLDR: √ßa va)</em> : </p><br><ul><li>  L'analyseur (PMD et CPD) est d√©velopp√© sur le github dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel pmd / pmd</a> </li><li>  Le d√©bogueur de r√®gles visuelles a √©t√© d√©plac√© vers un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel pmd / pmd-designer</a> distinct.  Veuillez noter que le pseudonyme fini est automatiquement int√©gr√© dans la <em>distribution binaire PMD</em> , que Gradle collectera pour vous dans le r√©f√©rentiel pr√©c√©dent, vous n'avez pas besoin de cloner sp√©cialement <code>pmd-designer</code> pour cela. </li><li>  Le projet dispose d'une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation d√©veloppeur</a> .  Celui que j'ai lu √©tait tr√®s d√©taill√©.  Certes, un peu d√©pass√©, mais cela est trait√© par la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deuxi√®me demande de tirage</a> :) </li></ul><br><p>  Je vous pr√©viens que je d√©veloppe sur Ubuntu.  Sous Windows, cela devrait √©galement fonctionner parfaitement - √† la fois en termes de qualit√© et dans le sens d'une mani√®re l√©g√®rement diff√©rente de lancer des outils. </p><br><p>  Donc, pour ajouter une nouvelle langue au CPD, il vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">suffit de</a> ... </p><br><ul><li>  <strong>ATTENTION:</strong> si vous voulez une prise en charge compl√®te de PMD avant la sortie de PMD 7, alors il vaut mieux aller directement au niveau 2, car la prise en charge normale pour le chemin facile √† travers la grammaire Antlr finie appara√Ætra, selon les rumeurs, dans la version 7, mais pour l'instant, vous ne passerez que du temps (bien que et un peu ...) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Forkez le r√©f√©rentiel pmd / pmd</a> . </li><li>  Trouvez dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">antlr / grammars-v4</a> une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">grammaire</a> pr√™te √† l'emploi pour votre langue - bien s√ªr, si la langue est interne, vous devez l'√©crire vous-m√™me, mais pour Modelika, par exemple, elle a √©t√© trouv√©e.  Ici, bien s√ªr, vous devez vous conformer aux formalit√©s avec les licences - je ne suis pas avocat, mais au moins je dois sp√©cifier la source d'o√π j'ai copi√©. </li><li>  Apr√®s cela, vous devez cr√©er le <code>pmd-&lt;your language name&gt;</code> , l'ajouter √† Gradle et y placer le fichier de grammaire.  De plus, apr√®s avoir lu deux pages de documentation non stressante, refaire le script d'assemblage du module pour Go, quelques classes pour charger le module par r√©flexion, <em>eh bien, il y a une petite chose ...</em> </li><li>  Corrigez la sortie de r√©f√©rence dans l'un des tests, car CPD prend d√©sormais en charge une autre langue!  Comment trouvez-vous ce test?  Tr√®s facile: <em>il veut casser la construction</em> . </li><li>  PROFIT!  C'est vraiment simple √† <em>condition qu'il y ait une grammaire toute faite</em> </li></ul><br><p>  Maintenant, √©tant √† la racine du r√©f√©rentiel pmd, vous pouvez taper <code>./mvnw clean verify</code> , tandis que dans <code>pmd-dist/target</code> vous obtiendrez, entre autres, une distribution binaire sous la forme d'une archive zip que vous devez d√©compresser et ex√©cuter √† l'aide de <code>./bin/run.sh cpd --minimum-tokens 100 --files /path/to/source/dir --language &lt;your language name&gt;</code> du r√©pertoire d√©compress√©.  En principe, vous pouvez effectuer <code>../mvnw clean verify</code> partir de votre nouveau module, ce qui acc√©l√©rera consid√©rablement l'assemblage, mais vous devrez ensuite placer correctement le surnom de bocal assembl√© dans la distribution binaire non compress√©e (par exemple, assembl√© une fois apr√®s l'enregistrement d'un nouveau module). </p><br><h2 id="uroven-2-nahodim-oshibki-i-narusheniya-style-guide">  Niveau 2: recherche d'erreurs et de violations du guide de style </h2><br><p>  Comme je l'ai dit, un support complet pour Antlr est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">promis dans PMD 7</a> .  Si vous, comme moi, ne voulez pas attendre la sortie de la mer, vous devrez obtenir une description de la grammaire de la langue au format JJTree quelque part.  Vous pouvez peut-√™tre durcir vous-m√™me le support d'un analyseur arbitraire - la documentation dit que c'est possible, <em>mais ils ne disent pas exactement comment</em> ... J'ai simplement pris <code>modelica.g4</code> du m√™me r√©f√©rentiel avec les grammaires pour Anltr comme base, et je l'ai manuellement refait dans JJTree.  Naturellement, si la grammaire s'est av√©r√©e √™tre un traitement de l'existant, indiquez √† nouveau la source, v√©rifiez le respect des licences et.  etc. </p><br><p>  Soit dit en passant, pour une personne qui conna√Æt bien toutes sortes de g√©n√©rateurs d'analyseurs, il est peu probable que cela surprenne.  Avant cela, je l'ai utilis√© s√©rieusement √† moins que j'aie moi-m√™me √©crit des habitu√©s et des combinateurs d'analyseurs sur Scala.  Par cons√©quent, la chose √©vidente, en fait, m'a d'abord attrist√©: AST, bien s√ªr, je vais partir de <code>modelica.g4</code> , mais cela n'a pas l'air tr√®s clair et "utilisable": il y aura des nuages ‚Äã‚Äãde n≈ìuds suppl√©mentaires dedans, et si vous ne regardez pas les <strong>jetons</strong> , mais seulement √† n≈ìuds, il n'est pas toujours clair o√π, par exemple, la branche <code>then</code> se termine, et <code>else</code> commence. </p><br><p>  Encore une fois, je ne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">reverrai</a> pas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la documentation JJTree</a> et un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bon tutoriel</a> - cette fois, cependant, non pas parce que l'original brille avec d√©tails et clart√©, mais parce que je ne l'ai pas compris moi-m√™me, mais la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation a √©t√© retransmise</a> incorrectement, mais avec confiance, √©videmment pire que pas de r√©cit.  Je ferais mieux de laisser un petit indice, d√©couvert en cours de route: </p><br><ul><li>  Premi√®rement, le <strong>code de description de l'analyseur JavaCC suppose des insertions Java qui seront inscrites dans l'analyseur g√©n√©r√©.</strong> </li><li>  Ne soyez pas confus par le fait que lors de la construction d'un AST, une syntaxe comme <code>[ Expression() ]</code> signifie facultatif, et dans le contexte de la description des jetons - choisir un caract√®re, comme dans une expression r√©guli√®re.  Pour autant que je comprends l'explication des d√©veloppeurs PMD, ce sont des constructions similaires qui ont une signification si diff√©rente - h√©rit√©, monsieur ... </li><li>  Pour le n≈ìud racine (dans mon cas, <code>StoredDefinition</code> ), vous devez sp√©cifier son type au lieu de <code>void</code> (c'est-√†-dire <code>ASTStoredDefiniton</code> ) </li><li>  En utilisant la syntaxe <code>#void</code> apr√®s le nom du n≈ìud, vous pouvez le cacher de l'arborescence analys√©e (c'est-√†-dire, cela n'affectera que ce qui est la bonne source et ce qui ne l'est pas, et comment les autres n≈ìuds seront imbriqu√©s) </li><li>  En utilisant une construction de la forme <code>void SimpleExpression() #SimpleExpression(&gt;1)</code> nous pouvons dire que le n≈ìud doit √™tre affich√© dans l'AST r√©sultant, s'il a plus d'un descendant.  Ceci est tr√®s pratique pour d√©crire des expressions avec de nombreux op√©rateurs avec des priorit√©s diff√©rentes: c'est-√†-dire, du point de vue de l'analyseur, la constante solitaire <code>1</code> sera quelque chose comme <code>LogicExpression(AdditiveExpression(MultiplicativeExperssion(Constant(1))))</code> - <em>entrez tous les n niveaux de priorit√©s de fonctionnement</em> - mais le code de l'analyseur obtiendra juste <code>Constant(1)</code> </li><li>  Le n≈ìud a une <code>image</code> variable standard (voir les <code>setImage</code> <code>getImage</code> , <code>setImage</code> ), qui <code>setImage</code> g√©n√©ralement "l'essence" de ce n≈ìud: par exemple, pour un n≈ìud correspondant au nom d'une variable locale, il est logique de copier le jeton correspondant avec l'identifiant dans l' <code>image</code> (par d√©faut, tous les jetons de les arbres seront jet√©s, il vaut donc la peine de copier le sens qu'ils contiennent, dans tous les cas, s'il s'agit de quelque chose de variable, et pas seulement de mots cl√©s) </li><li>  <strong>LOOKAHEAD</strong> - eh bien, c'est une chanson distincte, m√™me un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chapitre s√©par√©</a> de la documentation lui est consacr√© <br><ul><li>  En gros, dans JavaCC, si vous allez sur un n≈ìud, vous ne pouvez pas le renvoyer et essayer d'analyser diff√©remment, mais vous pouvez regarder en avant √† l'avance et d√©cider si vous allez ou non </li><li>  dans le cas le plus simple, en voyant un avertissement JavaCC, <del>  vous venez de dire dans l'en-t√™te <code>LOOKAHEAD = n</code> </del>  et vous obtenez de myst√©rieuses erreurs d'analyse, car dans le cas g√©n√©ral, il semble que cela ne peut pas r√©soudre tous les probl√®mes (enfin, sauf qu'en d√©finissant quelques milliards de jetons, vous obtenez en fait un aper√ßu de tout, mais pas le fait que cela fonctionne de cette fa√ßon ... .) </li><li>  devant le nom du n≈ìud int√©gr√©, vous pouvez indiquer explicitement sur la base du nombre de jetons ici, vous pouvez certainement prendre la d√©cision finale </li><li>  si dans le cas g√©n√©ral il n'y a pas un tel nombre <strong>fixe</strong> de jetons, vous pouvez dire "allez ici, si pr√©c√©demment, √† partir de ce point, nous avons r√©ussi √† faire correspondre un tel pr√©fixe - puis la description habituelle du sous-arbre" </li><li>  soyez prudent: dans le cas g√©n√©ral, JavaCC ne peut pas v√©rifier l'exactitude des directives <code>LOOKAHEAD</code> - il vous fait confiance, alors trouvez au moins la preuve math√©matique pourquoi une telle anticipation est suffisante ... </li></ul></li></ul><br><p>  Maintenant que vous avez une description de la grammaire de la langue au format JJTree, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ces 14 √©tapes simples</a> vous aideront √† ajouter la prise en charge de la langue.  La plupart d'entre eux ont la forme "cr√©er une classe similaire √† l'impl√©mentation pour java ou vm, mais adapt√©e".  Je ne noterai que les fonctionnalit√©s typiques, certaines d'entre elles appara√Ætront dans la documentation principale si elles acceptent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ma demande d'extraction de documentation</a> : </p><br><ul><li>  Commentant la suppression de tous les fichiers g√©n√©r√©s dans le script d'assemblage <code>alljavacc.xml</code> (qui se trouve dans votre nouveau module), vous pouvez les transf√©rer vers l'arborescence source √† partir <code>target/generated-sources</code> .  Mais mieux vaut pas.  Probablement, seule une petite partie sera modifi√©e, il est donc pr√©f√©rable de ne supprimer que quelques-uns: ils ont vu la n√©cessit√© de modifier l'impl√©mentation par d√©faut, copi√©e dans l'arborescence source, ajout√©e √† la liste des fichiers supprim√©s, reconstruite - et maintenant vous g√©rez le fichier - en <strong>particulier ce fichier</strong> .  Sinon, il sera difficile de comprendre exactement ce qui a √©t√© chang√© et le support peut difficilement √™tre qualifi√© d'agr√©able. </li><li>  maintenant que vous avez une impl√©mentation du mode PMD ¬´principal¬ª, vous pouvez facilement accrocher √† votre analyseur JJTree une liaison pour CPD, similaire √† Java ou √† une autre impl√©mentation disponible </li><li>  N'oubliez pas d'impl√©menter une m√©thode qui renvoie le nom d'h√¥te pour les requ√™tes XPath.  Dans l'impl√©mentation par d√©faut, soit une r√©cursion infinie est obtenue (le nom du n≈ìud passe par <code>toString</code> et vice versa), soit autre chose, en g√©n√©ral, √† cause de cela, il n'est √©galement pas possible de regarder l'arborescence dans PMD Designer et de d√©boguer la grammaire sans elle </li><li>  une partie des enregistrements de composants se fait en ajoutant des fichiers texte des points d'entr√©e de nom de classe pleinement qualifi√©s √† <code>META-INF/services</code> </li><li>  ce qui peut √™tre d√©crit de mani√®re d√©clarative dans les r√®gles (par exemple, une description d√©taill√©e de la v√©rification et des exemples d'erreurs) n'est pas d√©crit dans le code, mais dans la <code>category/&lt;language name&gt;/&lt;ruleset&gt;.xml</code> - dans tous les cas, vous devrez y enregistrer vos r√®gles </li><li>  ... mais lors de la mise en ≈ìuvre des tests, apparemment, certains m√©canismes de d√©couverte automatique, peut-√™tre d'origine locale, sont activement utilis√©s, donc <br><ul><li>  si on vous dit, "ajoutez un test trivial pour chaque version du langage" - mieux vaut ne pas discuter, ils disent "je n'en ai pas besoin, √ßa fonctionne comme √ßa" - c'est peut-√™tre le m√©canisme de d√©couverte automatique </li><li>  si vous voyez un test pour une r√®gle sp√©cifique avec un corps de classe contenant uniquement un commentaire <code>// no additional unit tests</code> , alors ce ne sont pas des tests, ils se trouvent juste dans les ressources sous la forme d'une description XML des donn√©es d'entr√©e et des r√©actions attendues de l'analyseur, tout de suite: quelques-unes correctes et quelques exemples incorrects. </li></ul></li></ul><br><h2 id="malenkiy-no-vazhnyy-kvest-dopili-pmd-designer">  Une petite mais importante qu√™te: a termin√© le concepteur PMD </h2><br><p>  Vous pouvez peut-√™tre tout d√©boguer sans visualiseur.  Mais pourquoi?  Tout d'abord, pour terminer, c'est tr√®s simple.  Deuxi√®mement, cela aidera grandement vos utilisateurs qui ne sont pas familiers avec Java: ils sont faciles et simples (si cela s'applique √† XPath du tout), enfin, ou du moins sans recompilation, PMD pourra d√©crire des mod√®les simples de ce qu'ils n'aiment pas (dans le cas le plus simple) - un guide de style comme ¬´le nom d'un package de mod√®le commence toujours par un p minuscule¬ª). </p><br><p>  Contrairement √† d'autres erreurs qui sont imm√©diatement visibles, les probl√®mes avec PMD Designer sont assez insidieux: il semblerait que vous ayez d√©j√† compris que l'inscription Java sur le c√¥t√© droit du menu n'est pas un bouton, mais une liste d√©roulante de la s√©lection de langue O_o, dans laquelle elle est d√©j√† apparue Modelica, car un nouveau module avec enregistrement des points d'entr√©e est apparu dans le chemin de classe.  Mais ici, vous choisissez votre langue, t√©l√©chargez un fichier de test et consultez AST.  Et cela semble √™tre une victoire, mais c'est en quelque sorte en noir et blanc, et le sous-arbre en surbrillance pourrait √™tre mis en surbrillance dans le texte - bien que non, le point culminant est l√†, mais il est mis √† jour de mani√®re tordue - et pourtant, comment n'ont-ils pas devin√© pour mettre en √©vidence les correspondances trouv√©es avec XPath ... Estimant d√©j√† la quantit√© de travail, vous pensez √† la prochaine demande de pull, mais vous d√©cidez accidentellement de basculer le langage vers Java et de t√©l√©charger du code source du PMD lui-m√™me ... Oh!  Il est color√©! .. Et le surbrillance du sous-arbre fonctionne!  Euh ... et il s'av√®re qu'il met normalement en surbrillance les correspondances trouv√©es et √©crit des morceaux de texte dans la zone √† droite de la demande ... Il semble que lorsqu'une exception se produit dans le code JavaFX pendant le rendu de l'interface, il interrompt le rendu, mais n'imprime pas sur la console ... </p><br><p>  En g√©n√©ral, il vous suffit d'ajouter une classe ma-a-scarlet pour mettre en √©vidence la syntaxe bas√©e sur les expressions r√©guli√®res.  Dans mon cas, c'√©tait <code>net.sourceforge.pmd.util.fxdesigner.util.codearea.syntaxhighlighting.ModelicaSyntaxHighlighter</code> , qui doit √™tre enregistr√© dans la classe <code>AvailableSyntaxHighlighters</code> .  Veuillez noter que ces deux modifications se produisent dans le <code>pmd-designer</code> , dont l'artefact d'assembly doit √™tre plac√© dans votre distribution binaire. </p><br><p>  Au final, cela ressemble √† ceci (GIF extrait de README dans le r√©f√©rentiel PMD Designer): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/289/e3e/92b/289e3e92b353b29c696ed466434307ed.gif" alt="PMD Designer au travail"></p><br><h2 id="promezhutochnyy-itog">  Sous-total </h2><br><p>  Si vous avez termin√© tous ces niveaux, vous avez maintenant: </p><br><ul><li>  copier le d√©tecteur de p√¢te </li><li>  moteur de r√®gles </li><li>  visualiseur pour d√©boguer AST et le mettre sous une forme pratique pour l'analyse (comme nous l'avons d√©j√† vu, toutes les grammaires du m√™me langage ne sont pas √©galement utiles!) </li><li>  le m√™me visualiseur pour le d√©bogage des r√®gles XPath que vos utilisateurs peuvent √©crire sans recompiler PMD et g√©n√©ralement aucune connaissance de Java (XPath, bien s√ªr, n'est pas non plus BASIC, mais c'est au moins un langage de requ√™te standard et non local) </li></ul><br><p>  J'esp√®re que vous comprenez √©galement le fait que la grammaire est maintenant une API stable pour votre impl√©mentation de la prise en charge des langues - ne la modifiez pas (ou plut√¥t la fonction de conversion de la source en AST d√©crite par elle) √† moins que cela ne soit absolument n√©cessaire, et si vous avez chang√©, notifiez-le comme un changement de rupture, et les utilisateurs seront boulevers√©s: tr√®s probablement, tout le monde n'√©crira pas de tests pour leurs r√®gles, mais c'est tr√®s triste quand les r√®gles ont v√©rifi√© le code, puis se sont arr√™t√©es sans avertissement - presque comme une sauvegarde, qui s'est bris√©e soudainement, et il y a un an ... </p><br><p>  L'histoire ne s'arr√™te pas l√†: au moins quelques r√®gles utiles doivent √™tre √©crites. </p><br><p>  Mais ce n'est pas tout: PMD prend en charge nativement les √©tendues et les d√©clarations.  Chaque n≈ìud AST a une port√©e qui lui est associ√©e: le corps de la classe, la fonction, la boucle ... Le fichier entier, au pire!  Et dans chaque domaine, il y a une liste de d√©finitions (d√©clarations) qu'il contient directement.  Comme dans d'autres cas, il est propos√© de l'impl√©menter par analogie avec d'autres langages, par exemple, Modelika (mais au moment de la r√©daction, la logique de ma pull request est, franchement, brute).   scopes  declarations    visitor,  -  <code>ScopeAndDeclarationFinder</code> ,           ‚Äî  ,    ,  ,  - ,  read-only    AST.        ,    . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelicaHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractLanguageVersionHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... @Override public VisitorStarter getSymbolFacade() { return new VisitorStarter() { @Override public void start(Node rootNode) { new SymbolFacade().initializeWith((ASTStoredDefinition) rootNode); } }; } }</span></span></code> </pre> <br><h2 id="vyvod">  </h2><br><p>   PMD     .  ,     ¬´¬ª  Clang Static Analyzer   ,           .      ,      CPD (   ),         . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr474920/">https://habr.com/ru/post/fr474920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr474906/index.html">Xamarin.Forms - Cartographie QRCode d√©corative avec SkiaSharp</a></li>
<li><a href="../fr474910/index.html">Que jouer avec les enfants avant l'√©cole</a></li>
<li><a href="../fr474912/index.html">Messages et alertes sur Android via JSON</a></li>
<li><a href="../fr474916/index.html">Appliquer l'environnement Nix-Shell dans Visual Studio Code</a></li>
<li><a href="../fr474918/index.html">Am√©lioration de la conception conjointe des composants √©lectrom√©caniques</a></li>
<li><a href="../fr474922/index.html">Comment choisir un VPS</a></li>
<li><a href="../fr474924/index.html">Comment devenir un bon manager? 4 fa√ßons de combler le manque de comp√©tences en gestion</a></li>
<li><a href="../fr474928/index.html">Apprendre √† suivre le navigateur Vivaldi</a></li>
<li><a href="../fr474930/index.html">Meetup Burning Leads: obtenez le streaming</a></li>
<li><a href="../fr474936/index.html">15 excellents outils pour cr√©er, stocker et g√©rer des liens (Bourget)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>