<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â–ªï¸ ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦â€ğŸ‘¦ ğŸ‘©ğŸ¾â€ğŸ¤â€ğŸ‘¨ğŸ¿ FiabilitÃ© World of Tanks Server ğŸ‘¨ğŸ¿â€ğŸ« ğŸ‘‡ğŸ¼ ğŸ‘‚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le sujet d'aujourd'hui - la fiabilitÃ© de World of Tanks Server - est plutÃ´t glissant. La fiabilitÃ© du jeu est un compromis, donc tout doit Ãªtre fait r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>FiabilitÃ© World of Tanks Server</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/418977/"><p>  Le sujet d'aujourd'hui - la fiabilitÃ© de World of Tanks Server - est plutÃ´t glissant.  La fiabilitÃ© du jeu est un compromis, donc tout doit Ãªtre fait rapidement et rapidement dans le dÃ©veloppement du jeu.  La charge sur les serveurs est importante et les utilisateurs ont tendance Ã  casser quelque chose juste par intÃ©rÃªt.  <strong>Levon Avakyan</strong> de RIT ++ a expliquÃ© ce que Wargaming fait pour garantir la fiabilitÃ©. </p><br><p>  Habituellement, quand ils parlent de fiabilitÃ©, la surveillance, les tests de rÃ©sistance, etc. sont constamment mentionnÃ©s.  Il n'y a rien de surnaturel lÃ -dedans, et le rapport a Ã©tÃ© consacrÃ© Ã  des moments spÃ©cifiques aux Tanks. </p><br><img src="https://habrastorage.org/webt/x6/id/gr/x6idgr4r-xse32m9p4kqkps8ndi.jpeg"><br><br><p>  <strong>Ã€ propos du confÃ©rencier:</strong> Levon Avakyan travaille pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wargaming en</a> tant que responsable des services de jeu et de la fiabilitÃ© de WoT et s'occupe des problÃ¨mes de fiabilitÃ© du serveur de tank. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/x-Uk5xBsstA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  Aujourd'hui, je vais vous expliquer comment nous procÃ©dons, y compris en quoi consiste le serveur World Of Tanks, en quoi il consiste, sur quoi il est construit, afin que vous compreniez le sujet de la conversation.  De plus, nous examinerons ce qui peut mal tourner Ã  l'intÃ©rieur du serveur lui-mÃªme et autour de lui, car le jeu est dÃ©jÃ  plus que le serveur.  Et nous parlerons Ã©galement un peu des processus, car beaucoup oublient qu'un processus bien Ã©tabli dans la production fait partie du succÃ¨s non seulement en termes d'Ã©conomie de ressources (de nombreuses pratiques proviennent de la production rÃ©elle), mais il affecte la qualitÃ© et la fiabilitÃ© de la solution. <br><br><img src="https://habrastorage.org/webt/qa/oj/17/qaoj17globztvoj2lxan-yry9-a.jpeg"><br>  Habituellement, quand ils parlent de fiabilitÃ©, la surveillance, les tests de rÃ©sistance, etc. sont constamment mentionnÃ©s.  Je ne l'ai pas inclus ici parce que je pense que c'est ennuyeux.  Nous n'avons rien dÃ©couvert de surnaturel lÃ -dedans.  Oui, nous avons Ã©galement un systÃ¨me de surveillance, nous effectuons des tests de rÃ©sistance avec des tests de rÃ©sistance afin d'augmenter la fiabilitÃ© du systÃ¨me et de savoir oÃ¹ il peut tomber.  Mais aujourd'hui, je vais parler de ce qui est plus spÃ©cifique pour les chars. <br><br>
<h2>  Technologie BigWorld <br></h2><br>  Il s'agit d'un moteur backend, ainsi que d'une boÃ®te Ã  outils pour crÃ©er des MMO. <br><br>  Ce moteur BigWorld Server assez ancien (nÃ© Ã  la fin des annÃ©es 90 - dÃ©but des annÃ©es 2000) est un ensemble de processus diffÃ©rents qui prennent en charge le jeu.  Les processus sont lancÃ©s sur un cluster, interconnectÃ©s dans un rÃ©seau de machines.  En interagissant les uns avec les autres, les processus montrent Ã  l'utilisateur une sorte de mÃ©canique de jeu. <br><br>  Le moteur s'appelle BigWorld, car il est trÃ¨s bon d'y faire des jeux, dans lesquels il y a un grand champ (espace), sur lequel se dÃ©roulent des opÃ©rations militaires (batailles).  Pour les rÃ©servoirs, cela convient parfaitement. <br><br>  En termes de fiabilitÃ©, les fonctionnalitÃ©s clÃ©s suivantes ont Ã©tÃ© investies dans BigWorld: <br><br><ul><li>  <strong>Ã‰quilibrage de charge.</strong>  Le moteur alloue des ressources, essayant d'atteindre deux objectifs: <br><ol><li>  utiliser le moins de machines possible; </li><li>  en mÃªme temps, ne chargez pas vos applications afin que leur charge dÃ©passe une certaine limite. </li></ol></li><li>  <strong>Ã‰volutivitÃ©.</strong>  Nous avons ajoutÃ© la voiture au cluster, lancÃ© des processus dessus - ce qui signifie que vous pouvez compter plus de batailles et accepter des joueurs. <br></li><li>  <strong>Haute disponibilitÃ©.</strong>  Si, par exemple, une voiture est tombÃ©e ou que quelque chose s'est mal passÃ© avec l'un des processus de jeu qui sert le jeu lui-mÃªme, il n'y a rien Ã  craindre - le jeu ne le remarquera pas, sera restaurÃ© Ã  un autre endroit et fonctionnera. </li><li>  <strong>Maintenez l'intÃ©gritÃ© et la cohÃ©rence des donnÃ©es.</strong>  Il s'agit du deuxiÃ¨me niveau de tolÃ©rance aux pannes.  S'il y a plusieurs clusters, comme dans Tanks, et qu'il y a eu une sorte de catastrophe dans le centre de donnÃ©es ou sur le canal principal, cela ne signifie pas que nous perdrons complÃ¨tement les donnÃ©es de jeu auxquelles la personne a jouÃ©.  Nous allons rÃ©cupÃ©rer, la cohÃ©rence sera. </li></ul><br>  <strong>Les processus qui sont dans notre systÃ¨me et leurs fonctions</strong> <br><br><ul><li>  <strong>CellApp</strong> est le processus responsable du traitement de l'espace de jeu ou d'une partie de celui-ci. <br></li></ul>  Comme je l'ai dit, BigWorld fonctionne avec certains espaces que nous divisons en cellules.  Chaque cellule spÃ©cifique de notre espace de jeu est calculÃ©e par une application spÃ©cifique. <br><br><ul><li>  <strong>CellAppMgr</strong> - le processus qui coordonne le travail de CellApp, l'Ã©quilibrage de charge. <br></li></ul>  CellApp peut Ãªtre nombreux, en consÃ©quence, il doit y avoir un processus qui les contrÃ´le. <br><br><ul><li>  <strong>BaseApp</strong> gÃ¨re les entitÃ©s, isole les clients de travailler avec CellApp. </li></ul>  L'une des choses fondamentales dans BigWorld est le concept d'entitÃ© - par exemple, le compte d'un joueur.  Tout ce que nous faisons sur le champ de bataille, nous le faisons avec cette entitÃ©.  CellApps calcule la physique et la mÃ©canique du jeu, comme le tir.  BaseApp fonctionne avec des entitÃ©s.  Il sert le compte, le rÃ©servoir, etc. <br><br><ul><li>  <strong>ServiceApp</strong> est une BaseApp spÃ©cialisÃ©e qui implÃ©mente une sorte de service. </li></ul>  Il s'agit d'une version simplifiÃ©e de BaseApp, un processus qui effectue diverses tÃ¢ches de service.  Par exemple, quelqu'un devrait pouvoir lire Ã  partir de RabbitMQ.  Il ne s'agit pas d'entitÃ©s de jeu, mais Ã©galement nÃ©cessaires. <br><br><ul><li>  <strong>BaseAppMgr</strong> gÃ¨re BaseApp et ServiceApp, car ils sont Ã©galement nombreux. </li><li>  <strong>LoginApp</strong> crÃ©e de nouvelles connexions Ã  partir des clients, ainsi que des utilisateurs mandataires sur BaseApp. </li><li>  <strong>DBApp</strong> implÃ©mente une interface d'accÃ¨s au stockage (bases de donnÃ©es).  Nous travaillons avec Percona, mais il peut s'agir d'une autre base de donnÃ©es. </li><li>  <strong>DBAppMgr</strong> coordonne le travail de DBApp. </li><li>  <strong>InterClusterMgr</strong> gÃ¨re la communication intercluster. </li><li>  <strong>Reviewer</strong> est un inspecteur de processus qui peut redÃ©marrer les processus. </li><li>  <strong>Bwmachined</strong> <strong>&nbsp;</strong>  - un dÃ©mon qui s'exÃ©cute sur chaque machine du cluster pour coordonner son travail.  Il permet Ã  tous les gestionnaires BaseApp de communiquer entre eux. </li></ul><br><img src="https://habrastorage.org/webt/z9/dq/he/z9dqhes39d5hjaah6aq4igy6kzg.jpeg"><br><br>  Voici Ã  quoi ressemblent les chars de l'intÃ©rieur, si briÃ¨vement: <br><br><ul><li>  Les clients se connectent via Internet, accÃ©dez Ã  LoginApp. </li><li>  LoginApp les autorise Ã  utiliser DBApp et Ã©met une adresse depuis BaseApp. </li><li>  D'autres clients y jouent. </li></ul><br>  Tout cela est dispersÃ© sur de nombreuses machines, chacune ayant un BWMachineD, qui peut gÃ©rer tout cela, orchestrer, etc. <br><br><h2>  Ã‰cosystÃ¨me World of Tanks <br></h2><br>  Qu'y a-t-il autour?  Il semblerait qu'il y ait un serveur de jeu et des joueurs - a choisi un tank, est allÃ© jouer.  Mais, malheureusement (ou joyeusement), le jeu se dÃ©veloppe, et la mÃ©canique du jeu de Â«juste tirerÂ» ne suffit plus.  En consÃ©quence, le serveur de jeu a commencÃ© Ã  Ãªtre envahi par divers services, dont certains Ã©taient gÃ©nÃ©ralement impossibles Ã  faire Ã  l'intÃ©rieur du serveur, tandis que nous avons commencÃ© Ã  en supprimer d'autres spÃ©cialement pour augmenter la vitesse de livraison de contenu au joueur.  Autrement dit, il est plus rapide d'Ã©crire un petit service en Python qui fait une sorte de mÃ©canique de jeu que de le faire Ã  l'intÃ©rieur du serveur sur tous les BaseAPP, les clusters de support, etc. <br><br>  Certaines choses, par exemple, les systÃ¨mes de paiement ont Ã©tÃ© initialement Ã©mis.  Nous en subissons d'autres, car Wargaming dÃ©veloppe plus d'un jeu, aprÃ¨s tout.  Il s'agit d'une trilogie: rÃ©servoirs, avions, navires, et il y a Blitz et des plans pour de nouveaux jeux.  S'ils Ã©taient Ã  l'intÃ©rieur de BigWorld, ils ne pourraient pas Ãªtre utilisÃ©s de maniÃ¨re pratique dans d'autres produits. <br><br>  Tout s'est dÃ©roulÃ© assez rapidement et de maniÃ¨re chaotique, ce qui a abouti Ã  certaines technologies de zoo utilisÃ©es dans notre Ã©cosystÃ¨me de rÃ©servoirs. <br><br>  Technologies et protocoles clÃ©s: <br><br>  1. Python 2.7, 3.5; <br><br>  2. Erlang; <br><br>  3. Scala; <br><br>  4. JavaScript; <br><br>  Cadres <br><br>  5. Django; <br><br>  6. Falcon; <br><br>  7. asyncio; <br><br>  Stockage: <br><br>  8. Postgres; <br><br>  9. Percona. <br><br>  10. Memcached et Redis pour la mise en cache. <br><br>  Tous ensemble pour le joueur c'est le serveur de tank: <br><br><ul><li>  Point d'autorisation unique; </li><li>  Clavarder </li><li>  Clans; </li><li>  SystÃ¨me de paiement; </li><li>  SystÃ¨me de tournoi; </li><li>  MÃ©ta-jeux (carte globale, zones fortifiÃ©es); </li><li>  Portail de chars, Portail de clan; </li><li>  Gestion de contenu, etc. </li></ul><br>  Mais si vous regardez, ce sont des choses lÃ©gÃ¨rement diffÃ©rentes Ã©crites sur diffÃ©rentes technologies.  Cela provoque des problÃ¨mes de fiabilitÃ©. <br><br><img src="https://habrastorage.org/webt/oi/-o/ax/oi-oaxdx4eek4e5omtpwlyp5ism.jpeg"><br><br>  Le diagramme montre notre serveur de rÃ©servoir avec son Ã©cosystÃ¨me.  Il y a un serveur de jeu, des services Web (internes et externes), y compris des services complÃ¨tement spÃ©ciaux qui sont situÃ©s dans le rÃ©seau principal et exÃ©cutent des fonctions de service et un service pour eux, qui implÃ©mentent rÃ©ellement les interfaces.  Par exemple, il existe un service de clan avec son propre portail de clan, qui vous permet de gÃ©rer ce clan, il y a un portail du jeu lui-mÃªme, etc. <br><br>  Cette sÃ©paration nous permet de moins nous soucier de la sÃ©curitÃ©, car personne n'a accÃ¨s au rÃ©seau interne - moins de problÃ¨mes.  Mais cela entraÃ®ne des efforts supplÃ©mentaires, car nous avons besoin de procurations qui donneront accÃ¨s si nous devons les pousser Ã  l'extÃ©rieur. <br><br>  J'ai dÃ©jÃ  dit que nous avions dÃ©cidÃ© de supprimer une partie de la logique du jeu et d'autres choses du serveur.  Il y avait une tÃ¢che pour inclure en quelque sorte tout dans le client.  Nous avons une merveilleuse passerelle client qui permet Ã  un client de rÃ©servoir d'accÃ©der directement Ã  un serveur Ã  partir de certaines des API de ces services internes - les mÃªmes clans ou API de nos mÃ©ta-jeux. <br><br>  De plus, nous avons poussÃ© le Chromium Embedded Framework (CEF) Ã  l'intÃ©rieur du client du rÃ©servoir.  Nous avons maintenant le mÃªme navigateur.  Le joueur ne le distingue pas de la fenÃªtre de jeu.  Cela vous permet de travailler avec l'ensemble de l'infrastructure, en contournant le travail avec le serveur de jeu. <br><br>  Nous avons de nombreux clusters - il en est ainsi - je vais vous dire pourquoi.  VoilÃ  Ã  quoi ressemble la rÃ©gion de la CEI. <br><br><img src="https://habrastorage.org/webt/rc/w4/ri/rcw4rignlicjgsjz8oeepp9cipa.jpeg"><br><br>  Tout est dispersÃ© dans les centres de donnÃ©es.  Les joueurs, selon l'endroit oÃ¹ le ping est le meilleur, se connectent Ã  l'emplacement.  Mais l'ensemble de l'Ã©cosystÃ¨me ne se modifie pas de cette faÃ§on, c'est principalement en Europe et Ã  Moscou, ce qui nous ajoute Ã©galement quelques problÃ¨mes de fiabilitÃ© - latence supplÃ©mentaire et redirection. <br><br>  VoilÃ  Ã  quoi ressemble l'Ã©cosystÃ¨me de World of Tanks. <br><br>  Qu'est-ce qui peut mal tourner avec toute cette Ã©conomie?  Tout ce que vous voulez!  Et va J. Mais dÃ©montons-le. <br><br><h2>  Points de dÃ©faillance clÃ©s au sein d'un cluster <br></h2><br><h4>  DÃ©faillance d'une seule machine ou d'un seul processus <br></h4><br>  L'option la plus simple que nous pouvons prÃ©voir est la dÃ©faillance d'une machine ou d'un processus au sein d'un cluster.  Nous avons des groupes de 10 Ã  100 voitures - quelque chose peut s'envoler.  Comme je l'ai dit, BigWorld lui-mÃªme fournit des mÃ©canismes prÃªts Ã  l'emploi qui nous permettent d'Ãªtre plus fiables. <br><br><img src="https://habrastorage.org/webt/-3/tl/-q/-3tl-qfzv-9slfdcdbymwl--s3a.jpeg"><br><br>  SchÃ©ma standard: il existe des BaseApps rÃ©parties sur diffÃ©rentes machines.  Sur ces BaseApp, il existe des entitÃ©s qui contiennent des entitÃ©s d'Ã©tat.  Chaque BaseApp se sauvegarde avec Round Robin sur les autres. <br><br>  Supposons que nous ayons un fichier et que certains BaseApp soient morts, ou que la machine entiÃ¨re soit morte - Ã§a va!  Les BaseApp restantes ont quittÃ© ces entitÃ©s, elles seront restaurÃ©es et le gameplay du joueur n'en souffrira pas. <br><br><img src="https://habrastorage.org/webt/mm/ix/tp/mmixtp-1r1cmzro9zznc1o76a2g.jpeg"><br><br>  Les CellAPP font exactement la mÃªme chose, la seule chose est qu'ils stockent Ã©galement leurs Ã©tats sur BaseApps, et non sur d'autres CellAPP. <br><br>  Cela semble Ãªtre un mÃ©canisme fiable, mais ... <br><br><h5>  Vous devez tout payer <br></h5><br>  Au fil du temps, nous avons commencÃ© Ã  observer ce qui suit. <br><br>  â€¢ La crÃ©ation de copies de sauvegarde d'entitÃ©s commence Ã  consommer de plus en plus de ressources systÃ¨me et de trafic rÃ©seau. <br><br>  En fait, le processus de sauvegarde lui-mÃªme commence Ã  affecter la stabilitÃ© du systÃ¨me lorsque, Ã  l'intÃ©rieur du cluster, la plupart du rÃ©seau est occupÃ© Ã  transmettre des copies Ã  Round Robins. <br><br>  â€¢ La taille des entitÃ©s augmente avec le temps, Ã  mesure que de nouveaux attributs et mÃ©canismes de jeu sont ajoutÃ©s. <br><br>  Mais le plus dÃ©sagrÃ©able est que la taille de ces entitÃ©s croÃ®t comme une avalanche.  Par exemple, un joueur effectue une action (achÃ¨te une propriÃ©tÃ© de jeu) et cette opÃ©ration a commencÃ© Ã  ralentir.  Nous ne l'avons pas encore terminÃ©, mais nous avons enregistrÃ© les modifications apportÃ©es Ã  ces attributs.  Autrement dit, le systÃ¨me est si mauvais, et nous commenÃ§ons toujours Ã  augmenter la taille de la sauvegarde qui doit Ãªtre effectuÃ©e.  Il y a un effet boule de neige. <br><br>  â€¢ La stabilitÃ© du systÃ¨me diminue globalement <br><br>  En raison du fait que nous essayons d'Ã©chapper Ã  la chute d'une machine ou d'un processus, nous abandonnons la stabilitÃ© de l'ensemble du systÃ¨me. <br><br>  <strong>Qu'avons-nous fait pour y faire face</strong> ?  Nous avons dÃ©cidÃ© pour chaque entitÃ© de mettre en Ã©vidence ce qui doit vraiment Ãªtre sauvegardÃ©.  Nous avons divisÃ© les attributs en mutables et immuables, et nous ne copions pas l'entitÃ© entiÃ¨re, mais nous sauvegardons uniquement ses attributs mutables.  De cette faÃ§on, nous avons simplement rÃ©duit la quantitÃ© d'informations qui doivent vraiment Ãªtre conservÃ©es.  Maintenant, lors de l'ajout d'un nouvel attribut, celui qui le fait devrait voir plus clairement oÃ¹ l'attribuer.  Mais en gÃ©nÃ©ral, cela nous a sauvÃ© la situation. <br><br>  Pour Ãªtre complÃ¨tement franc, ce mÃ©canisme a Ã©tÃ© dÃ©fini dans BigWorld, mais dans Tanks Ã  un moment donnÃ©, il n'Ã©tait plus pris en charge jusqu'Ã  la fin, et toutes les entitÃ©s ne peuvent pas rÃ©cupÃ©rer de leur sauvegarde.  Dans Ships, par exemple, les gars le soutiennent.  LÃ , vous pouvez Ã©teindre les machines en toute sÃ©curitÃ© - les informations seront simplement restaurÃ©es sur d'autres machines, et le client ne remarquera rien.  Malheureusement, ce n'est pas toujours le cas dans Tanks, mais nous obtiendrons le retour de toutes ces fonctionnalitÃ©s pour qu'elles fonctionnent comme il se doit. <br><br><h4>  Ã‰chec du centre de donnÃ©es.  Multi-cluster <br></h4><br>  Si soudainement pas 1-2 voitures sont tombÃ©es et que nous avons commencÃ© Ã  perdre tout le centre de donnÃ©es, c'est-Ã -dire le cluster complÃ¨tement, quelles propriÃ©tÃ©s le systÃ¨me devrait-il avoir pour que le jeu ne tombe pas dans une telle situation? <br><br><ul><li>  Chaque cluster doit Ãªtre indÃ©pendant, c'est-Ã -dire: <br><ol><li>  doit avoir sa propre base de donnÃ©es; </li><li>  le cluster ne traite que ses espaces (arÃ¨nes de combat). </li></ol>  Ainsi, si certaines arÃ¨nes frappent, d'autres fonctionnent toujours. </li><li>  Les clusters doivent communiquer entre eux pour que l'on puisse dire au second: Â«Je suis tombÃ©!Â»  Lorsqu'il augmente, les donnÃ©es seront restaurÃ©es Ã  partir des copies enregistrÃ©es. </li><li>  Il est Ã©galement souhaitable que vous puissiez transfÃ©rer l'utilisateur d'un cluster Ã  l'autre. </li></ul><br>  Pour le moment, le schÃ©ma de notre multi-cluster ressemble Ã  ceci. <br><br><img src="https://habrastorage.org/webt/ov/qd/2u/ovqd2ufkauofi1ybo1wduomewtu.jpeg"><br><br>  Nous avons un cluster central et ce que nous appelons des pÃ©riphÃ©riques sur lesquels les batailles rÃ©elles sont menÃ©es.  CellApp ne fonctionne pas sur le cluster central, sinon c'est exactement la mÃªme chose que tout le monde.  C'est le point central du traitement des comptes: ils y montent, sont envoyÃ©s en pÃ©riphÃ©rie, et en pÃ©riphÃ©rie une personne joue dÃ©jÃ .  Autrement dit, l'Ã©chec de l'un des clusters ne conduit pas Ã  une perte d'opÃ©rabilitÃ© de l'ensemble du jeu.  MÃªme l'Ã©chec du cluster central ne permet tout simplement pas aux nouveaux joueurs de se connecter, mais ceux qui jouent dÃ©jÃ  en pÃ©riphÃ©rie peuvent continuer la partie. <br><br>  Le fait que tout fonctionne pour nous via le cluster central s'est avÃ©rÃ© parce qu'en gÃ©nÃ©ral, la technologie BigWorld elle-mÃªme suppose qu'il existe un processus de gestion spÃ©cial entre les gestionnaires de clusters.  En fait, ces gestionnaires inter-claster peuvent Ãªtre quelque peu relevÃ©s. <br><br>  Historiquement, Tanks avait besoin d'un multi-cluster, car il commenÃ§ait Ã  se dÃ©velopper en avalanche en ligne.  Lorsque nous avons atteint le pic de 200 000 joueurs, le trafic entrant d'eux a simplement cessÃ© d'Ãªtre placÃ© dans le centre de donnÃ©es sur le rÃ©seau.  Nous avons dÃ» littÃ©ralement agenouiller une sorte de solution pour que les joueurs puissent Ãªtre lancÃ©s dans plusieurs centres de donnÃ©es. <br><br>  En fait, nous n'avons gagnÃ© que parce que nous avons maintenant un multi-cluster.  Il est Ã©galement devenu utile pour les joueurs, car le ping, c'est-Ã -dire l'accessibilitÃ© sur le rÃ©seau, affecte considÃ©rablement le gameplay.  Si le retard est supÃ©rieur Ã  50-70 ms, cela commence dÃ©jÃ  Ã  affecter la qualitÃ© du jeu lui-mÃªme, car dans Tanks, tout est calculÃ© sur le serveur.  Il n'y a aucun calcul sur le client.  Par consÃ©quent, gardez Ã  l'esprit qu'il n'y a pratiquement rien Ã  faire.  Bien sÃ»r, certains mods y sont fabriquÃ©s, mais ils n'affectent pas le processus lui-mÃªme.  Vous pouvez essayer de deviner ce qui se passera, mais affecter les mÃ©canismes de jeu eux-mÃªmes - non. <br><br>  GrÃ¢ce Ã  cette approche, notre <strong>cluster central est devenu un point d'Ã©chec</strong> .  Tout Ã©tait fermÃ© sur lui.  Nous avons dÃ©cidÃ© - puisque ces machines et une grande base de repaire de jeu se tiennent lÃ , que nos pÃ©riphÃ©riques s'occupent exclusivement des combats.  Ensuite, il n'est vraiment pas nÃ©cessaire de stocker de grandes quantitÃ©s d'informations - les batailles sont jouÃ©es et sont jouÃ©es - verrouillons tout lÃ -bas. <br><br>  Pour rÃ©Ã©crire absolument tout pour s'Ã©loigner du concept de cluster central, il n'y a plus de temps, ni de dÃ©sir particulier.  Mais nous avons d'abord dÃ©cidÃ© d'enseigner aux clusters pÃ©riphÃ©riques Ã  communiquer entre eux.  Ensuite, nous avons creusÃ© un trou en eux afin qu'il soit possible de les influencer en utilisant des services tiers. <br><br>  Par exemple, afin de crÃ©er une bataille plus tÃ´t, il Ã©tait nÃ©cessaire de dire au cluster central qu'il Ã©tait nÃ©cessaire de crÃ©er une bataille sur une partie de la pÃ©riphÃ©rie.  De plus, par des mÃ©canismes internes, les entitÃ©s se dÃ©plaÃ§aient, l'essence de l'arÃ¨ne Ã©tait crÃ©Ã©e, etc. <br><br>  <strong>Il est dÃ©sormais possible de contacter directement la pÃ©riphÃ©rie, en contournant le cluster central.</strong>  Nous lui retirons donc le travail supplÃ©mentaire.  Mais jusqu'Ã  prÃ©sent, il n'y a aucun dÃ©sir de basculer complÃ¨tement vers un schÃ©ma dans lequel tous les clusters sont presque peer-to-peer, et tout cela est contrÃ´lÃ© par certains processus, mais pas le cluster. <br><br>  Je vous rappelle qu'en plus du cluster de jeux avec ses BaseApps, CellApps et autres, nous avons un Ã©cosystÃ¨me. <br><br><img src="https://habrastorage.org/webt/oi/-o/ax/oi-oaxdx4eek4e5omtpwlyp5ism.jpeg"><br><br>  Nous essayons de nous assurer que les performances de l'Ã©cosystÃ¨me n'affectent pas le gameplay.  Dans le pire des cas, par exemple, le systÃ¨me de tournoi ne fonctionne pas, mais vous pouvez jouer au hasard - de toute faÃ§on, la plupart des gens jouent au hasard.  Oui, nous avons abaissÃ© la qualitÃ©, mais en gÃ©nÃ©ral, vous pouvez survivre plusieurs heures sans tournois. <br><br>  Cela n'arrive pas toujours.  PremiÃ¨rement, il existe dÃ©jÃ  de tels services Web qui sont profondÃ©ment intÃ©grÃ©s dans le jeu.  Par exemple, un point d'autorisation unique est un service qui vous permet de vous connecter sur le Web ou quelque part en un seul endroit, et d'Ãªtre connectÃ© Ã  l'ensemble de l'univers Wargaming. <br><br>  Le deuxiÃ¨me exemple est un service qui sert les achats et les transactions de jeux.  Il a Ã©galement dÃ» Ãªtre introduit dans le jeu uniquement parce que nous avions besoin d'une trace des achats du joueur.  Le fait est que dans certaines rÃ©gions, nous sommes obligÃ©s d'afficher des informations au client sur la propriÃ©tÃ© du jeu achetÃ©e pour de l'argent rÃ©el et celle pour l'argent du jeu.  Au dÃ©part, le systÃ¨me ne le supposait pas, personne ne l'a exposÃ© il y a 5 ans, mais la <strong>loi est sÃ©vÃ¨re: vous devez le faire - le faire</strong> . <br><br><h2>  Points de dÃ©faillance de l'Ã©cosystÃ¨me de World of Tanks <br></h2><br><h3>  ProblÃ¨me numÃ©ro 1. Charge accrue <br></h3><br>  Nous avons un multi-cluster dans lequel 10 clusters avec un grand nombre de machines.  Les joueurs les jouent et le web est petit.  Personne n'achÃ¨te cinq machines supplÃ©mentaires dans chaque centre de donnÃ©es.  Mais en mÃªme temps, nous fournissons toutes les mÃªmes fonctionnalitÃ©s et tout ce qui est nÃ©cessaire directement Ã  l'intÃ©rieur du client.  C'est le principal problÃ¨me. <br><br><blockquote>  L'interactivitÃ© et la rÃ©activitÃ© de l'interface sont la principale source d'augmentation de la charge de l'Ã©cosystÃ¨me. <br></blockquote><br>  Je vais donner deux exemples du service de clan: <br><br><ol><li>  Vous souhaitez inviter un autre joueur dans le clan.  Bien sÃ»r, je souhaite que l'invitÃ© reÃ§oive immÃ©diatement une notification, et il pourra vous rejoindre.  Pour implÃ©menter cela, il est nÃ©cessaire de faire en sorte que le service de clan informe le client d'une maniÃ¨re ou d'une autre, ou de laisser le client demander au service Web de temps en temps: Â«Est-ce que quelque chose a changÃ©?  Ai-je de nouvelles invitations? "  Il s'agit de la premiÃ¨re option d'oÃ¹ peut provenir la charge supplÃ©mentaire. </li><li>  Les chars ont un rÃ©gime fortifiÃ©.  Supposons qu'il soit jouÃ© non par une seule personne, mais par plusieurs.  Tous les joueurs ont une fenÃªtre ouverte avec des zones fortifiÃ©es.  Le commandant a construit le bÃ¢timent.  Il est conseillÃ© que pour tous ceux qui ont cette fenÃªtre ouverte, le bÃ¢timent apparaisse immÃ©diatement. </li></ol><br>  La dÃ©cision sur le front avec l'enquÃªte n'est pas trÃ¨s bonne.  En fait, cela fonctionne, c'est juste que vous devez allouer autant de capacitÃ©s pour cela que cette fonctionnalitÃ© n'apportera aucun profit Ã  l'entreprise.  Et si la fonctionnalitÃ© n'apporte pas de profit, vous n'avez pas besoin de le faire. <br><br><blockquote>  Mon conseil personnel sur la faÃ§on de gÃ©rer cela: la meilleure faÃ§on de rendre le systÃ¨me plus fiable sous charge est gÃ©nÃ©ralement de rÃ©duire la charge de maniÃ¨re logique. </blockquote><br>  Vous ne devriez pas vous asseoir avec le fer, trouver des systÃ¨mes nouveaux, optimiser quelque chose - de toute faÃ§on, plus la charge est Ã©levÃ©e, plus il y aura d'artefacts que vous ne pourrez pas Ã©chapper.  De plus, des artefacts se produiront mÃªme Ã  des niveaux d'abstraction de plus en plus bas - d'abord avec des applications, puis avec diffÃ©rents services Web, puis vous accÃ©derez au rÃ©seau (Cisco, etc.).  Ã€ un certain niveau, vous ne pouvez tout simplement pas rÃ©soudre les problÃ¨mes. <br><br>  Si vous rÃ©flÃ©chissez bien, ils peuvent simplement Ãªtre Ã©vitÃ©s. <br><br>  La premiÃ¨re chose que nous avons faite a Ã©tÃ© d' <strong>apprendre Ã  notifier les clients via un serveur de jeux en</strong> utilisant son infrastructure.  Par exemple, lorsqu'une invitation arrive au clan, nous disons au serveur: Â«Nous avons invitÃ© telle ou telle personneÂ», puis le cluster cluster lui-mÃªme trouve celui Ã  qui la notification doit Ãªtre envoyÃ©e, d'autant plus qu'ils ont une connexion.  Autrement dit, nous poussons du service, et personne ne nous dÃ©verse constamment.    ,          ,       .   ,   ,    . <br><br>  â€”  <strong>Web-sockets (nginx-pushstream)</strong> . ,      Web-sockets.   ,      Chromium Embedded Framework â€”  ,   , Web-sockets   Nginx.   pushstream,     Web-sockets       . <br><br><h3>  â„– 2.    <br></h3><br>  ,    ,   ,  <strong> â€”  </strong> .    ,    ,    â€”    . <strong>    ,    </strong> ,   . <br><br>   ?  : -  , - ,             ,    .   - , , .    . <br><br>        . <br><br><img src="https://habrastorage.org/webt/ul/8f/6m/ul8f6mjlivwkgkswzl-cwtxlx-o.jpeg"><br><br>  ,      <strong>120      </strong> <strong>Game Play</strong> .    .         ,     ,      .      ,          .    . <br><br> <strong> </strong> <br><br>  3  ,   : <br><br><ol><li> HTTP API; </li><li> RabbitMQ â€”  ; </li><li> Apache Kafka     . </li></ol><br>     ,    ,  ,  ,      ,    .     ,  -  â€” ,    .          ,      . <br><br> <strong> </strong> <br><br> <strong>1. HTTP</strong> <br><br>    â€”  HTTP.   ,  ,   -,      .      : <br><br><ul><li>      (  ,     ). <br></li></ul><br> ,    ,       .    ,   , ,  Django,    100  200 ,    API,  .    ,   ,   - 30-40 ,     ,   .   ,   â€”     . <br><br><ul><li>      . <br></li></ul><br>  ,    ,   HTTP, â€”       .      .   â€”  â€”  .   , <strong> ,  , ,  </strong> . <br><br><ul><li>     . <br></li></ul><br>     .   .  - ,   - API â€”    API,        . <br><br>      â€”      ,      . ,   ,      . ,      10 ,  -     100    500. ,    HTTP     .    nginx'   ,       â€”  . <br><br>  ,    HTTP  ,         . <br><br> <strong>2. RabbitMQ</strong> <br><br>    RabbitMQ     BigWord     . <br><br><ul><li>     . <br></li></ul><br>         â€” -  ,   ,  , . <br><br><ul><li>   Â«Â»,    ,        . <br></li></ul><br>    :      .    ,     API: Â«      N    â€”    Â».    ,      , , ,  â€”          .      ,      . <br><br>  Â«Â»,   Â«Â»,    â€”       . <br><br><ul><li>     . <br></li></ul><br> RabbitMQ  ,      , ,      ,      ,   ,      ,   . <br><br><blockquote>   â€”    RabbitMQ     . </blockquote><br> <strong>3. Kafka</strong> <br><br>     ,    ,     â€”   Kafka.   ,   RabbitMQ   -     . <br><br><ul><li>     . <br></li></ul><br>     ,       ,    ,    .  ,  ,        .      .   Kafka. ,    â€”    ,    . <br><br><ul><li>     . <br></li></ul><br>    ,     .        ,    ,     -  â€”     . <br><br>  Kafka   ,    ,        ,    -   ,       .      . <br><br><h2>    <br></h2><br>      â€”    . <br><br><img src="https://habrastorage.org/webt/ke/ty/oc/ketyocondz4qhsiguntwchhmonq.jpeg"><br><br> : <br><br><ul><li>   <strong> </strong> .         ,   - ,   .. </li><li>   <strong> </strong> â€”  , , , . </li><li>      â€” <strong>      </strong> ,    .       ,    ,   . </li></ul><br>     .     , , ,   entity.   .    ,     ,       . <br><br><h2> DLC <br></h2><br>    ,   DLC (Development Lifecycle) â€” ,  ,   . <br><br><img src="https://habrastorage.org/webt/3c/5t/c2/3c5tc2hlxbrgpdtjts88yxrcp3e.jpeg"><br><br>     ,  ,   . DLC   ,        ,          .       ,  . ,      ,       ,     . <br><br>           DLC,       .     ,        ,    ,  . <br><br>     DLC,   ,    : <br><br> â€¢ <strong>   (      ).</strong> <br><br>     ,    ,    Â«- ,   Â»,   .     ,       , ,    ,    . <br><br> â€¢        :   SRE. <br><br>    ,  solution-, technical-owner, reability- â€”       ,   -  ,    game-    .    , ,     ,       .   - ,      ,    ,      ,   .    ,     . <br><br> â€¢ <strong>SRE    .</strong> <br><br>        â€”  -   .          ,        .    ,  SRE     -.    SRE  ,     : Â«    ,       ,    ,     â€”   !Â»      ,   . <br><br>        QA ,    , -  , ,    â€”    . <br><br><h2>  <br></h2><br> BigWorld Technology  Â«Â»       .      ,  .         .  Â« Â»,    . <br><br>  Â«  Â»     ,     ,    .   â€” Â«Â» (, ) â€”     .      ,        . , -  . <br><br> <i>:         ++.    ,    40        ,    .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a>  ,      .</i> <br><br><blockquote>  RootConf   â€”   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DevOpsConf Russia</a> .        DevOps <b>1  2   </b> ,  .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> ,       . ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a>    â€”    ! <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418977/">https://habr.com/ru/post/fr418977/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418963/index.html">Test du robot de bureau DoBot Magician</a></li>
<li><a href="../fr418969/index.html">Comment sont les derniers jours de la course Ã  1 billion de dollars? (UPD.: Apple a gagnÃ©)</a></li>
<li><a href="../fr418971/index.html">Les cartes de rayonnement de Jupiter sont la clÃ© d'une nouvelle exploration en Europe</a></li>
<li><a href="../fr418973/index.html">Rencontrez DevOpsConf Russia</a></li>
<li><a href="../fr418975/index.html">Comment mesurer le succÃ¨s. Suivi des stratÃ©gies et de leur relation avec les problÃ¨mes de l'entreprise</a></li>
<li><a href="../fr418979/index.html">Alors que je traversais le pays en avion, mettant en Å“uvre un projet pour plusieurs milliers d'emplois</a></li>
<li><a href="../fr418981/index.html">MÃ©thodes numÃ©riques pour rÃ©soudre des Ã©quations elliptiques</a></li>
<li><a href="../fr418985/index.html">Analytique et conception dans leur ensemble</a></li>
<li><a href="../fr418987/index.html">Firefox contourne facilement la protection dans la nouvelle interface Gmail</a></li>
<li><a href="../fr418991/index.html">Le microfilm existera pendant un demi-millÃ©naire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>