<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСйЁЯП╗тАНтЪХя╕П тЫ╜я╕П ЁЯП┤тАНтШая╕П S3, NFS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрдд рд▓рд┐рдпреЛрдлрд╝реН рд╕ рд╡рд┐рддрд░рд┐рдд рд╡рд┐рдлрд▓-рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдВрдЧреНрд░рд╣рдг рд╕реБрд╡рд┐рдзрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ тЪТя╕П ЁЯСЙЁЯП╛ тЖШя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдореИрдВ рд▓рдХреНрд╕реЙрдлреНрдЯ рд╕реЗ рд╣реВрдВред 
 рдУрдкреЗрдиреЗрдЯ рдХреЗ рдЕрдиреБрд╕рд╛рд░: рд▓рд┐рдпреЛрдлрд╝реНрд╕ рд▓рд┐рдпреЛрдПрдлрдПрд╕ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рддрд░рд┐рдд рджреЛрд╖-рд╕рд╣рд┐рд╖реНрдгреБ рднрдВрдбрд╛рд░рдг рд╕реБрд╡рд┐рдзрд╛ рд╣реИ, рдЬреЛ рдЕрдореЗрдЬрд╝реЕрди рдПрд╕ 3 рдПрдкреАрдЖрдИ рдФрд░ рд░реАрд╕реНрдЯ -рдПрдкреАрдЖ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>S3, NFS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрдд рд▓рд┐рдпреЛрдлрд╝реН рд╕ рд╡рд┐рддрд░рд┐рдд рд╡рд┐рдлрд▓-рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдВрдЧреНрд░рд╣рдг рд╕реБрд╡рд┐рдзрд╛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478990/"><p>  рдореИрдВ рд▓рдХреНрд╕реЙрдлреНрдЯ рд╕реЗ рд╣реВрдВред <br>  <a href="https://www.opennet.ru/opennews/art.shtml%3Fnum%3D48357" rel="nofollow">рдУрдкреЗрдиреЗрдЯ рдХреЗ</a> рдЕрдиреБрд╕рд╛рд░: <a href="http://leo-project.net/leofs/index.html" rel="nofollow">рд▓рд┐рдпреЛрдлрд╝реНрд╕</a> <a href="http://leo-project.net/leofs/index.html" rel="nofollow">рд▓рд┐рдпреЛрдПрдлрдПрд╕</a> рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рддрд░рд┐рдд рджреЛрд╖-рд╕рд╣рд┐рд╖реНрдгреБ рднрдВрдбрд╛рд░рдг рд╕реБрд╡рд┐рдзрд╛ рд╣реИ, рдЬреЛ рдЕрдореЗрдЬрд╝реЕрди рдПрд╕ 3 рдПрдкреАрдЖрдИ рдФрд░ <a href="http://leo-project.net/leofs/index.html" rel="nofollow">рд░реАрд╕реНрдЯ</a> -рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрдд рд╣реИ, рд╕рд╛рде рд╣реА рдПрдирдПрдлрдПрд╕ рд╕рд░реНрд╡рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдСрдкрд░реЗрд╢рди рдХреЗ рдореЛрдб рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред  рдЫреЛрдЯреА рдФрд░ рдмрд╣реБрдд рдмрдбрд╝реА рджреЛрдиреЛрдВ рд╡рд╕реНрддреБрдУрдВ рдХреЗ рднрдВрдбрд╛рд░рдг рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рди рд╣реИрдВ, рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдХреИрд╢рд┐рдВрдЧ рддрдВрддреНрд░ рд╣реИ, рдбреЗрдЯрд╛ рдХреЗрдВрджреНрд░реЛрдВ рдХреЗ рдмреАрдЪ рднрдВрдбрд╛рд░рдг рдХреА рдкреНрд░рддрд┐рдХреГрддрд┐ рд╕рдВрднрд╡ рд╣реИред  рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХреА рдЕрддреНрдпрдзрд┐рдХ рдкреНрд░рддрд┐рдХреГрддрд┐ рдФрд░ рд╡рд┐рдлрд▓рддрд╛ рдХреЗ рдПрдХ рдмрд┐рдВрджреБ рдХреЗ рдЙрдиреНрдореВрд▓рди рдХреЗ рдХрд╛рд░рдг рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдореЗрдВ 99.9999999% рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдХреА рдЙрдкрд▓рдмреНрдзрд┐ рд╣реИред  рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛрдб Erlang рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИред </p><br><p>  LeoFS рдореЗрдВ рддреАрди рдШрдЯрдХ рд╣реЛрддреЗ рд╣реИрдВ: </p><br><ul><li> <a href="https://leo-project.net/leofs/docs/architecture/leo_storage/" rel="nofollow">рд▓рд┐рдпреЛрдлрд╝реНрд╕ рд╕реНрдЯреЛрд░реЗрдЬ</a> - рд╡рд╕реНрддреБрдУрдВ рдФрд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЛ рдЬреЛрдбрд╝рдиреЗ, рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рд╣рдЯрд╛рдиреЗ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреА рд╕реЗрд╡рд╛ рд╣реИ, рдЬреЛ рдкреНрд░рддрд┐рдХреГрддрд┐, рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐ рдФрд░ рдЧреНрд░рд╛рд╣рдХ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред </li><li>  <a href="https://leo-project.net/leofs/docs/architecture/leo_gateway/" rel="nofollow">LeoFS рдЧреЗрдЯрд╡реЗ</a> - HTTP рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рдФрд░ REST-API рдпрд╛ S3-API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ, рдореЗрдореЛрд░реА рдФрд░ рдбрд┐рд╕реНрдХ рдореЗрдВ рд╕рдмрд╕реЗ рдЕрдиреБрд░реЛрдзрд┐рдд рдбреЗрдЯрд╛ рдХрд╛ рдХреИрд╢рд┐рдВрдЧ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </li><li>  <a href="https://leo-project.net/leofs/docs/architecture/leo_manager/" rel="nofollow">рд▓рд┐рдпреЛрдлрд╝реНрд╕ рдкреНрд░рдмрдВрдзрдХ</a> - рд▓рд┐рдпреЛрдлрд╝рд╕ рдЧреЗрдЯрд╡реЗ рдФрд░ рд▓рд┐рдпреЛрдлрд╝реНрд╕ рд╕реНрдЯреЛрд░реЗрдЬ рдиреЛрдбреНрд╕ рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рддрд╛ рд╣реИ, рдиреЛрдбреНрд╕ рдФрд░ рдЪреЗрдХрд╕рдо рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рддрд╛ рд╣реИред  рдбреЗрдЯрд╛ рдЕрдЦрдВрдбрддрд╛ рдФрд░ рдЙрдЪреНрдЪ рднрдВрдбрд╛рд░рдг рдЙрдкрд▓рдмреНрдзрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИред </li></ul><br><p>  рдЗрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ, Ansible-playbook, S3, NFS рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Leofs рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред </p><a name="habracut"></a><br><p>  рдпрджрд┐ рдЖрдк рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдкреНрд▓реЗрдмреБрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд┐рдпреЛрдлрд╝реНрд╕ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╡рд┐рднрд┐рдиреНрди рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдЖрдкрдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣реА рд╣реИрдВ: <a href="https://github.com/leo-project/leofs_ansible/issues/5" rel="nofollow">1</a> , <a href="https://github.com/leo-project/leofs_ansible/issues/4" rel="nofollow">2</a> ред  рдЗрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ рдореИрдВ рд▓рд┐рдЦреВрдВрдЧрд╛ рдХрд┐ рдЗрди рддреНрд░реБрдЯрд┐рдпреЛрдВ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпрд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рдЬрд╣рд╛рдВ рдЖрдк ansible-playbook рдЪрд▓рд╛рдПрдВрдЧреЗ, рдЖрдкрдХреЛ netcat рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </p><br><h4 id="primer-inventory">  рдЗрдиреНрд╡реЗрдВрдЯрд░реА рдЙрджрд╛рд╣рд░рдг </h4><br><div class="spoiler">  <b class="spoiler_title">рдЙрджрд╛рд╣рд░рдг рдЗрдиреНрд╡реЗрдВрдЯреНрд░реА (рд╣реЛрд╕реНрдЯреЗрд╕ рд╕реИрдВрдкрд▓ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ):</b> <div class="spoiler_text"><pre><code class="plaintext hljs"># Please check roles/common/vars/leofs_releases for available versions [all:vars] leofs_version=1.4.3 build_temp_path="/tmp/leofs_builder" build_install_path="/tmp/" build_branch="master" source="package" #[builder] #172.26.9.177 # nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all [leo_manager_0] 172.26.9.176 # nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all [leo_manager_1] 172.26.9.178 [leo_storage] 172.26.9.179 leofs_module_nodename=S0@172.26.9.179 172.26.9.181 leofs_module_nodename=S0@172.26.9.181 172.26.9.182 leofs_module_nodename=S0@172.26.9.182 172.26.9.183 leofs_module_nodename=S0@172.26.9.183 [leo_gateway] 172.26.9.180 leofs_module_nodename=G0@172.26.9.180 172.26.9.184 leofs_module_nodename=G0@172.26.9.184 [leofs_nodes:children] leo_manager_0 leo_manager_1 leo_gateway leo_storage</code> </pre> </div></div><br><h4 id="podgotovka-serverov">  рд╕рд░реНрд╡рд░ рдХреА рддреИрдпрд╛рд░реА </h4><br><p>  рд╕реЗрд▓рд┐рдирдХреНрд╕ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ред  рдореБрдЭреЗ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рд╕рдореБрджрд╛рдп LeoFS рдХреЗ рд▓рд┐рдП рд╕реЗрд▓рд┐рдирдХреНрд╕ рдиреАрддрд┐рдпрд╛рдВ рдмрдирд╛рддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs"> - name: Install libselinux as prerequisite for SELinux Ansible module yum: name: "{{item}}" state: latest with_items: - libselinux-python - libsemanage-python - name: Disable SELinux at next reboot selinux: state: disabled - name: Set SELinux in permissive mode until the machine is rebooted command: setenforce 0 ignore_errors: true changed_when: false</code> </pre><br><p>  <code>netcat</code> рдФрд░ <code>redhat-lsb-core</code> рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред  <code>netcat</code> рдЬрд╝рд░реВрд░рдд <code>leofs-adm</code> , <a href="" rel="nofollow">рдпрд╣рд╛рдБ</a> OS рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>redhat-lsb-core</code> рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА <a href="" rel="nofollow">рд╣реИ</a> ред </p><br><pre> <code class="plaintext hljs"> - name: Install Packages yum: name={{ item }} state=present with_items: - nmap-ncat - redhat-lsb-core</code> </pre> <br><p>  рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдирд╛ рдФрд░ рдЗрд╕реЗ рдкрд╣рд┐рдпрд╛ рд╕рдореВрд╣ рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ </p><br><pre> <code class="plaintext hljs"> - name: Create user leofs group: name: leofs state: present - name: Allow 'wheel' group to have passwordless sudo lineinfile: dest: /etc/sudoers state: present regexp: '^%wheel' line: '%wheel ALL=(ALL) NOPASSWD: ALL' validate: 'visudo -cf %s' - name: Add the user 'leofs' to group 'wheel' user: name: leofs groups: wheel append: yes</code> </pre> <br><p>  рдПрд░реНрд▓рд╛рдВрдЧ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ </p><br><pre> <code class="plaintext hljs"> - name: Remote erlang-20.3.8.23-1.el7.x86_64.rpm install with yum yum: name=https://github.com/rabbitmq/erlang-rpm/releases/download/v20.3.8.23/erlang-20.3.8.23-1.el7.x86_64.rpm</code> </pre><br><p>  рд╕реБрдзрд╛рд░реЗ рд╣реБрдП рдЕрдиреВрд╕рд┐рдмрд▓ рдкреНрд▓реЗрдмреБрдХ рдХрд╛ рдкреВрд░рд╛ рд╕рдВрд╕реНрдХрд░рдг рдпрд╣рд╛рдБ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: <a href="https://github.com/patsevanton/leofs_ansible" rel="nofollow">https://github.com/patsevanton/leofh_mible</a> </p><br><h4 id="ustanovka-konfigurirovanie-zapusk">  рд╕реНрдерд╛рдкрдирд╛, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди, рдкреНрд░рд╛рд░рдВрдн </h4><br><p>  рдЗрд╕рдХреЗ рдмрд╛рдж, рдЬреИрд╕рд╛ рдХрд┐ build_leofs.nl рдХреЗ рдмрд┐рдирд╛ <a href="https://github.com/leo-project/leofs_ansible" rel="nofollow">https://github.com/leo-project/leofs_ansible</a> рдореЗрдВ рд▓рд┐рдЦрд╛ рд╣реИ, рдирд┐рд╖реНрдкрд╛рджрд┐рдд <a href="https://github.com/leo-project/leofs_ansible" rel="nofollow">рдХрд░реЗрдВ</a> </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">## Install LeoFS $ ansible-playbook -i hosts install_leofs.yml ## Config LeoFS $ ansible-playbook -i hosts config_leofs.yml ## Start LeoFS $ ansible-playbook -i hosts start_leofs.yml</span></span></code> </pre> <br><h4 id="proveryaem-status-klastera-na-primary-leomanager">  рдкреНрд░рд╛рдердорд┐рдХ рд▓рд┐рдпреЛрдореЗрдиреЗрдЧрд░ рдкрд░ рдХреНрд▓рд╕реНрдЯрд░ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдБрдЪ </h4><br><pre> <code class="bash hljs">leofs-adm status</code> </pre> <br><p>  рдкреНрд░рд╛рдЗрдорд░реА рдФрд░ рд╕реЗрдХреЗрдВрдбрд░реА рдХреЛ рдПрдВрд╕рд┐рдмрд▓-рдкреНрд▓реЗрдмреБрдХ рд▓реЙрдЧ рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </p><br><p><img src="https://habrastorage.org/webt/do/kp/oj/dokpoj8lmzwh3bmakpxx9anc-4i.png"></p><br><p><img src="https://habrastorage.org/webt/ku/0o/bt/ku0obtn6ezvfghyfai01zldeaws.png"></p><br><div class="spoiler">  <b class="spoiler_title">рдирд┐рд╖реНрдХрд░реНрд╖ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╣реЛрдЧрд╛</b> <div class="spoiler_text"><pre> <code class="bash hljs"> [System Confiuration] -----------------------------------+---------- Item | Value -----------------------------------+---------- Basic/Consistency level -----------------------------------+---------- system version | 1.4.3 cluster Id | leofs_1 DC Id | dc_1 Total replicas | 2 number of successes of R | 1 number of successes of W | 1 number of successes of D | 1 number of rack-awareness replicas | 0 ring size | 2^128 -----------------------------------+---------- Multi DC replication settings -----------------------------------+---------- [mdcr] max number of joinable DCs | 2 [mdcr] total replicas per a DC | 1 [mdcr] number of successes of R | 1 [mdcr] number of successes of W | 1 [mdcr] number of successes of D | 1 -----------------------------------+---------- Manager RING <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span> -----------------------------------+---------- current ring-hash | a0314afb previous ring-hash | a0314afb -----------------------------------+---------- [State of Node(s)] -------+----------------------+--------------+---------+----------------+----------------+---------------------------- <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> | node | state | rack id | current ring | prev ring | updated at -------+----------------------+--------------+---------+----------------+----------------+---------------------------- S | S0@172.26.9.179 | running | | a0314afb | a0314afb | 2019-12-05 10:33:47 +0000 S | S0@172.26.9.181 | running | | a0314afb | a0314afb | 2019-12-05 10:33:47 +0000 S | S0@172.26.9.182 | running | | a0314afb | a0314afb | 2019-12-05 10:33:47 +0000 S | S0@172.26.9.183 | attached | | | | 2019-12-05 10:33:58 +0000 G | G0@172.26.9.180 | running | | a0314afb | a0314afb | 2019-12-05 10:33:49 +0000 G | G0@172.26.9.184 | running | | a0314afb | a0314afb | 2019-12-05 10:33:49 +0000 -------+----------------------+--------------+---------+----------------+----------------+----------------------------</code> </pre> </div></div><br><h4 id="sozdaem-yuzera">  рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдПрдБ </h4><br><p>  рдЙрдкрдпреЛрдХреНрддрд╛ рд╢рдмреНрдж рдмрдирд╛рдПрдВ: </p><br><pre> <code class="bash hljs">leofs-adm create-user leofs leofs access-key-id: 9c2615f32e81e6a1caf5 secret-access-key: 8aaaa35c1ad78a2cbfa1a6cd49ba8aaeb3ba39eb</code> </pre> <br><p>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рд╕реВрдЪреА: </p><br><pre> <code class="bash hljs">leofs-adm get-users user_id | role_id | access_key_id | created_at ------------+---------+------------------------+--------------------------- _test_leofs | 9 | 05236 | 2019-12-02 06:56:49 +0000 leofs | 1 | 9c2615f32e81e6a1caf5 | 2019-12-02 10:43:29 +0000</code> </pre> <br><h4 id="sozdaem-bucket">  рдПрдХ рдмрд╛рд▓реНрдЯреА рдмрдирд╛рдПрдБ </h4><br><p>  рдПрдХ рдмрд╛рд▓реНрдЯреА рдмрдирд╛рдИ </p><br><pre> <code class="bash hljs">leofs-adm add-bucket leofs 9c2615f32e81e6a1caf5 OK</code> </pre> <br><p>  рдмрд╛рд▓реНрдЯреА рд╕реВрдЪреА: </p><br><pre> <code class="bash hljs"> leofs-adm get-buckets cluster id | bucket | owner | permissions | created at -------------+----------+--------+------------------+--------------------------- leofs_1 | leofs | leofs | Me(full_control) | 2019-12-02 10:44:02 +0000</code> </pre> <br><h4 id="konfigurirovanie-s3cmd">  S3cmd рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ </h4><br><p>  <code>HTTP Proxy server name</code> рдлрд╝реАрд▓реНрдб рдореЗрдВ, рдЧреЗрдЯрд╡реЗ рд╕рд░реНрд╡рд░ рдЖрдИрдкреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ </p><br><pre> <code class="bash hljs">s3cmd --configure Enter new values or accept defaults <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> brackets with Enter. Refer to user manual <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> detailed description of all options. Access key and Secret key are your identifiers <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Amazon S3. Leave them empty <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> using the env variables. Access Key [9c2615f32e81e6a1caf5]: Secret Key [8aaaa35c1ad78a2cbfa1a6cd49ba8aaeb3ba39eb]: Default Region [US]: Use <span class="hljs-string"><span class="hljs-string">"s3.amazonaws.com"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> S3 Endpoint and not modify it to the target Amazon S3. S3 Endpoint [s3.amazonaws.com]: Use <span class="hljs-string"><span class="hljs-string">"%(bucket)s.s3.amazonaws.com"</span></span> to the target Amazon S3. <span class="hljs-string"><span class="hljs-string">"%(bucket)s"</span></span> and <span class="hljs-string"><span class="hljs-string">"%(location)s"</span></span> vars can be used <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> the target S3 system supports dns based buckets. DNS-style bucket+hostname:port template <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> accessing a bucket [%(bucket)s.s3.amazonaws.com]: leofs Encryption password is used to protect your files from reading by unauthorized persons <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> transfer to S3 Encryption password: Path to GPG program [/usr/bin/gpg]: When using secure HTTPS protocol all communication with Amazon S3 servers is protected from 3rd party eavesdropping. This method is slower than plain HTTP, and can only be proxied with Python 2.7 or newer Use HTTPS protocol [No]: On some networks all internet access must go through a HTTP proxy. Try setting it here <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you can<span class="hljs-string"><span class="hljs-string">'t connect to S3 directly HTTP Proxy server name [172.26.9.180]: HTTP Proxy server port [8080]: New settings: Access Key: 9c2615f32e81e6a1caf5 Secret Key: 8aaaa35c1ad78a2cbfa1a6cd49ba8aaeb3ba39eb Default Region: US S3 Endpoint: s3.amazonaws.com DNS-style bucket+hostname:port template for accessing a bucket: leofs Encryption password: Path to GPG program: /usr/bin/gpg Use HTTPS protocol: False HTTP Proxy server name: 172.26.9.180 HTTP Proxy server port: 8080 Test access with supplied credentials? [Y/n] Y Please wait, attempting to list all buckets... Success. Your access key and secret key worked fine :-) Now verifying that encryption works... Not configured. Never mind. Save settings? [y/N] y Configuration saved to '</span></span>/home/user/.s3cfg<span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre> <br><p>  рдпрджрд┐ рдЖрдкрдХреЛ рддреНрд░реБрдЯрд┐ рдорд┐рд▓рддреА рд╣реИ рддреНрд░реБрдЯрд┐: S3 рддреНрд░реБрдЯрд┐: 403 (AccessDenied): рдкреНрд░рд╡реЗрд╢ рдирд┐рд╖реЗрдз: </p><br><pre> <code class="bash hljs">s3cmd put test.py s3://leofs/ upload: <span class="hljs-string"><span class="hljs-string">'test.py'</span></span> -&gt; <span class="hljs-string"><span class="hljs-string">'s3://leofs/test.py'</span></span> [1 of 1] 382 of 382 100% <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0s 3.40 kB/s <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> ERROR: S3 error: 403 (AccessDenied): Access Denied</code> </pre> <br><p>  рдлрд┐рд░ рдЖрдкрдХреЛ True s3cmd рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдореЗрдВ signature_v2 рдХреЛ рд╕рд╣реА рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдЗрд╕ <a href="https://github.com/leo-project/leofs/issues/487" rel="nofollow">рдЕрдВрдХ</a> рдореЗрдВ рд╡рд┐рд╡рд░рдгред </p><br><p>  рдпрджрд┐ рд╣рд╕реНрддрд╛рдХреНрд╖рд░_v2 рдЧрд▓рдд рд╣реИ, рддреЛ рдРрд╕реА рддреНрд░реБрдЯрд┐ рд╣реЛрдЧреА: </p><br><pre> <code class="bash hljs">WARNING: Retrying failed request: /?delimiter=%2F (getaddrinfo() argument 2 must be <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> or string) WARNING: Waiting 3 sec... WARNING: Retrying failed request: /?delimiter=%2F (getaddrinfo() argument 2 must be <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> or string) WARNING: Waiting 6 sec... ERROR: Test failed: Request failed <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: /?delimiter=%2F</code> </pre> <br><h4 id="testirovanie-zagruzki">  рдмреВрдЯ рдкрд░реАрдХреНрд╖рдг </h4><br><p>  1GB рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдБ </p><br><pre> <code class="bash hljs">fallocate -l 1GB 1gb</code> </pre> <br><p>  рдЗрд╕реЗ Leofs рдкрд░ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ </p><br><pre> <code class="bash hljs">time s3cmd put 1gb s3://leofs/ real 0m19.099s user 0m7.855s sys 0m1.620s</code> </pre> <br><h4 id="statistika">  рдЖрдВрдХрдбрд╝реЗ </h4><br><p>  1 рдиреЛрдб рдХреЗ рд▓рд┐рдП leofs-adm du: </p><br><pre> <code class="bash hljs">leofs-adm du S0@172.26.9.179 active number of objects: 156 total number of objects: 156 active size of objects: 602954495 total size of objects: 602954495 ratio of active size: 100.0% last compaction start: ____-__-__ __:__:__ last compaction end: ____-__-__ __:__:__</code> </pre> <br><p>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдирд┐рд╖реНрдХрд░реНрд╖ рдмрд╣реБрдд рдЬрд╛рдирдХрд╛рд░реАрдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИред </p><br><p>  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдпрд╣ рдлрд╝рд╛рдЗрд▓ рдХрд╣рд╛рдБ рд╕реНрдерд┐рдд рд╣реИред <br>  leofs- рдкреНрд░рд╡реЗрд╢, рдЬрд┐рд╕рдореЗрдВ leofs / 1gb рд╣реИ </p><br><pre> <code class="bash hljs">leofs-adm whereis leofs/1gb -------+----------------------+--------------------------------------+------------+--------------+----------------+----------------+----------------+---------------------------- del? | node | ring address | size | checksum | has children | total chunks | clock | when -------+----------------------+--------------------------------------+------------+--------------+----------------+----------------+----------------+---------------------------- | S0@172.26.9.181 | 657a9f3a3db822a7f1f5050925b26270 | 976563K | a4634eea55 | <span class="hljs-literal"><span class="hljs-literal">true</span></span> | 64 | 598f2aa976a4f | 2019-12-05 10:48:15 +0000 | S0@172.26.9.182 | 657a9f3a3db822a7f1f5050925b26270 | 976563K | a4634eea55 | <span class="hljs-literal"><span class="hljs-literal">true</span></span> | 64 | 598f2aa976a4f | 2019-12-05 10:48:15 +0000</code> </pre> <br><h4 id="aktiviruem-nfs">  NFS рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВ </h4><br><p>  рд╣рдо рд▓рд┐рдпреЛ рдЧреЗрдЯрд╡реЗ 172.26.9.184 рд╕рд░реНрд╡рд░ рдкрд░ рдПрдирдПрдлрдПрд╕ рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рд╕рд░реНрд╡рд░ рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдкрд░, nfs-utils рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░реЗрдВ </p><br><pre> <code class="bash hljs">sudo yum install nfs-utils</code> </pre> <br><p>  рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рд╣рдо рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ <code>/usr/local/leofs/current/leo_gateway/etc/leo_gateway.conf</code> рдареАрдХ рдХрд░реЗрдВрдЧреЗ </p><br><pre> <code class="bash hljs">protocol = nfs</code> </pre> <br><p>  рд╕рд░реНрд╡рд░ 172.26.9.184 рдкрд░, rpcbind рдФрд░ leofs-Gateway рдЪрд▓рд╛рдПрдВ </p><br><pre> <code class="bash hljs">sudo service rpcbind start sudo service leofs-gateway restart</code> </pre> <br><p>  рд╕рд░реНрд╡рд░ рдкрд░ рдЬрд╣рд╛рдВ leo_manager рдЪрд▓ рд░рд╣рд╛ рд╣реИ, NFS рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рд▓реНрдЯреА рдмрдирд╛рдПрдВ рдФрд░ NFS рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреБрдВрдЬреА рдмрдирд╛рдПрдВ </p><br><pre> <code class="bash hljs">leofs-adm add-bucket <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> 05236 leofs-adm gen-nfs-mnt-key <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> 05236 ip--nfs-</code> </pre> <br><h4 id="podklyuchenie-k-nfs">  NFS рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ </h4><br><pre> <code class="bash hljs">sudo mkdir /mnt/leofs <span class="hljs-comment"><span class="hljs-comment">## for Linux - "sudo mount -t nfs -o nolock &lt;host&gt;:/&lt;bucket&gt;/&lt;token&gt; &lt;dir&gt;" sudo mount -t nfs -o nolock ip--nfs-------gateway:/bucket/access_key_id/---gen-nfs-mnt-key /mnt/leofs sudo mount -t nfs -o nolock 172.26.9.184:/test/05236/bb5034f0c740148a346ed663ca0cf5157efb439f /mnt/leofs</span></span></code> </pre> <br><h4 id="prosmotr-diskovogo-prostanstva-cherez-nfs-klient">  NFS рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рджреЗрдЦреЗрдВ </h4><br><p>  рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рднрдВрдбрд╛рд░рдг рдиреЛрдб рдореЗрдВ 40GB рдбрд┐рд╕реНрдХ (3 рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рдиреЛрдбреНрд╕, 1 рд╕рдВрд▓рдЧреНрди рдиреЛрдб) рд╣реИрдВ: </p><br><pre> <code class="bash hljs">df -hP Filesystem Size Used Avail Use% Mounted on 172.26.9.184:/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/05236/e7298032e78749149dd83a1e366afb328811c95b 60G 3.6G 57G 6% /mnt/leofs</code> </pre> <br><h4 id="ustanovka-leofs-s-6-storage-nodami">  6 рд╕реНрдЯреЛрд░реЗрдЬ рдиреЛрдбреНрд╕ рдХреЗ рд╕рд╛рде рд▓рд┐рдпреЛрдПрдлрдПрд╕ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред </h4><br><div class="spoiler">  <b class="spoiler_title">рдЗрдиреНрд╡реЗрдВрдЯрд░реА (рдмрд┐рд▓реНрдбрд░ рдХреЗ рдмрд┐рдирд╛):</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Please check roles/common/vars/leofs_releases for available versions [all:vars] leofs_version=1.4.3 build_temp_path="/tmp/leofs_builder" build_install_path="/tmp/" build_branch="master" source="package" # nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all [leo_manager_0] 172.26.9.177 # nodename of leo_manager_0 and leo_manager_1 are set at group_vars/all [leo_manager_1] 172.26.9.176 [leo_storage] 172.26.9.178 leofs_module_nodename=S0@172.26.9.178 172.26.9.179 leofs_module_nodename=S0@172.26.9.179 172.26.9.181 leofs_module_nodename=S0@172.26.9.181 172.26.9.182 leofs_module_nodename=S0@172.26.9.182 172.26.9.183 leofs_module_nodename=S0@172.26.9.183 172.26.9.185 leofs_module_nodename=S0@172.26.9.185 [leo_gateway] 172.26.9.180 leofs_module_nodename=G0@172.26.9.180 172.26.9.184 leofs_module_nodename=G0@172.26.9.184 [leofs_nodes:children] leo_manager_0 leo_manager_1 leo_gateway leo_storage</span></span></code> </pre> </div></div><br><h4 id="vyvod-leofs-adm-status">  Leofs- рдкреНрд░рд╡реЗрд╢ рд╕реНрдерд┐рддрд┐ рдЙрддреНрдкрд╛рджрди </h4><br><div class="spoiler">  <b class="spoiler_title">Leofs- рдкреНрд░рд╡реЗрд╢ рд╕реНрдерд┐рддрд┐ рдЙрддреНрдкрд╛рджрди</b> <div class="spoiler_text"><pre> <code class="bash hljs"> [System Confiuration] -----------------------------------+---------- Item | Value -----------------------------------+---------- Basic/Consistency level -----------------------------------+---------- system version | 1.4.3 cluster Id | leofs_1 DC Id | dc_1 Total replicas | 2 number of successes of R | 1 number of successes of W | 1 number of successes of D | 1 number of rack-awareness replicas | 0 ring size | 2^128 -----------------------------------+---------- Multi DC replication settings -----------------------------------+---------- [mdcr] max number of joinable DCs | 2 [mdcr] total replicas per a DC | 1 [mdcr] number of successes of R | 1 [mdcr] number of successes of W | 1 [mdcr] number of successes of D | 1 -----------------------------------+---------- Manager RING <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span> -----------------------------------+---------- current ring-hash | d8ff465e previous ring-hash | d8ff465e -----------------------------------+---------- [State of Node(s)] -------+----------------------+--------------+---------+----------------+----------------+---------------------------- <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> | node | state | rack id | current ring | prev ring | updated at -------+----------------------+--------------+---------+----------------+----------------+---------------------------- S | S0@172.26.9.178 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:29 +0000 S | S0@172.26.9.179 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:29 +0000 S | S0@172.26.9.181 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:30 +0000 S | S0@172.26.9.182 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:29 +0000 S | S0@172.26.9.183 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:29 +0000 S | S0@172.26.9.185 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:29 +0000 G | G0@172.26.9.180 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:31 +0000 G | G0@172.26.9.184 | running | | d8ff465e | d8ff465e | 2019-12-06 05:18:31 +0000 -------+----------------------+--------------+---------+----------------+----------------+----------------------------</code> </pre> </div></div><br><p>  рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди, рдпрд╣ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдЯреЛрд░реЗрдЬ рдиреЛрдб рдореЗрдВ 40GB рдбрд┐рд╕реНрдХ (6 рд░рдирд┐рдВрдЧ рдиреЛрдбреНрд╕) рд╣реИрдВ: </p><br><pre> <code class="bash hljs">df -hP Filesystem Size Used Avail Use% Mounted on 172.26.9.184:/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/05236/e7298032e78749149dd83a1e366afb328811c95b 120G 3.6G 117G 3% /mnt/leofs</code> </pre> <br><h4 id="esli-ispolzuetsya-5-nod-storage">  рдпрджрд┐ 5 рд╕реНрдЯреЛрд░реЗрдЬ рдиреЛрдбреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </h4><br><pre> <code class="bash hljs">[leo_storage] 172.26.9.178 leofs_module_nodename=S0@172.26.9.178 172.26.9.179 leofs_module_nodename=S1@172.26.9.179 172.26.9.181 leofs_module_nodename=S2@172.26.9.181 172.26.9.182 leofs_module_nodename=S3@172.26.9.182 172.26.9.183 leofs_module_nodename=S4@172.26.9.183</code> </pre> <br><pre> <code class="bash hljs">df -hP 172.26.9.184:/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/05236/e7298032e78749149dd83a1e366afb328811c95b 100G 3.0G 97G 3% /mnt/leofs</code> </pre> <br><h4 id="logi">  рд▓реЙрдЧ </h4><br><p>  рд▓реЙрдЧ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ <code>/usr/local/leofs/current/*/log</code> </p><br><h4 id="esli-vy-budete-ustanavlivatnastraivat-leofs-vruchnuyu-to-vozmozhno-stolknetes-so-sleduyuschimi-oshibkami">  рдпрджрд┐ рдЖрдк рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ Leofs рдХреЛ рд╕реНрдерд╛рдкрд┐рдд / рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдирд┐рдореНрди рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </h4><br><h5 id="error-mnesia-is-not-available">  [ERROR] рдордиреЗрд╕рд┐рдпрд╛ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИ </h5><br><p>  Systemctl рд╕реЗрд╡рд╛ рд╢реБрд░реВ рдХрд░рдирд╛ leofs-manager-master рд╢реБрд░реВ рдХрд░реЗрдВ </p><br><pre> <code class="bash hljs">leofs-adm status [ERROR] Mnesia is not available</code> </pre> <br><p>  Leo_manager_1 рдкрд░ leofs-manager-slave рдХреЛ systemctl рд╢реБрд░реВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </p><br><h5 id="ne-startuet-leofs-storage">  Leofs-Storage рдкреНрд░рд╛рд░рдВрдн рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред </h5><br><p>  рдпрд╣ рд╕реНрдерд┐рддрд┐ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд▓рдиреЗ рдХреЗ рд▓рд┐рдП leofs-manager-master рдФрд░ leofs-manager-slave рдФрд░ leofs-adm рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИред </p><br><h5 id="attached-nodes-less-than--of-replicas">  рдкреНрд░рддрд┐рдХреГрддрд┐ рдХреЗ # рд╕реЗ рдХрдо рдиреЛрдб рд╕рдВрд▓рдЧреНрди </h5><br><p>  рдЬрдм рдЖрдк рд▓рдлрд╝реНрдЬрд╝-рдкреНрд░рд╢рдВрд╕рд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ рддреНрд░реБрдЯрд┐ рдорд┐рд▓рддреА рд╣реИ: </p><br><pre> <code class="bash hljs">leofs-adm start [ERROR] Attached nodes less than <span class="hljs-comment"><span class="hljs-comment"># of replicas</span></span></code> </pre> <br><p>  рдкрд░реНрдпрд╛рдкреНрдд рднрдВрдбрд╛рд░рдг рдиреЛрдбреНрд╕ рдирд╣реАрдВред  leofs-adm рдХреА рд╕реНрдерд┐рддрд┐ рдЖрдкрдХреЛ 2 рд╕реЗ рдХрдо рд╕рдВрдЧреНрд░рд╣рдг рдиреЛрдб рджрд┐рдЦрд╛рдПрдЧреАред  рд╕реНрдЯреЛрд░реЗрдЬ рдиреЛрдбреНрд╕ рдХреА рдиреНрдпреВрдирддрдо рдЖрд╡рд╢реНрдпрдХ рд╕рдВрдЦреНрдпрд╛ 2ред </p><br><h5 id="leofs-adm-status-pokazyvaet-attached-ostalnye-running">  leofs-adm рдХреА рд╕реНрдерд┐рддрд┐ рдЬреБрдбрд╝реА рд╣реБрдИ рд╣реИ, рдмрд╛рдХреА рднрд╛рдЧ рд░рд╣рд╛ рд╣реИред </h5><br><p>  рдиреЛрдбреНрд╕ рдХреЛ рдкреБрдирд░реНрд╕рдВрддреБрд▓рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </p><br><pre> <code class="bash hljs">leofs-adm rebalance</code> </pre> <br><h5 id="posle-starta-leofs-gateway-vy-ne-vidite-nodu-gateway-v-leofs-adm-status">  рд▓реЗрдУрдлрд╝реНрд╕-рдЧреЗрдЯрд╡реЗ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рдЧреЗрдЯрд╡реЗ рдиреЛрдб рдХреЛ рд▓реЗрдУрдлрд╝реНрд╕-рдкреНрд░рд╡реЗрд╢ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдирд╣реАрдВ рджреЗрдЦрддреЗ рд╣реИрдВ </h5><br><p>  рд▓рдлреНрдЬрд╝-рджрд╛рдЦрд┐рд▓рд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ </p><br><pre> <code class="bash hljs">leofs-adm start</code> </pre> <br><h5 id="couldnt-connect-to-leofs-manager-na-slave-uzle">  рджрд╛рд╕ рдиреЛрдб рдкрд░ рд▓рд┐рдпреЛрдлрд╝реНрд╕ рдкреНрд░рдмрдВрдзрдХ рд╕реЗ рдЬреБрдбрд╝ рдирд╣реАрдВ рд╕рдХрд╛ </h5><br><p>  (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, leofs-adm рджрд╛рд╕ рдиреЛрдб рдкрд░ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ!] ( <a href="https://leo-project.net/leofs/docs/issues/documentation-issues/" rel="nofollow">Https://leo-project.net/leofs/docs/issues/documentation-issues/</a> ) </p><br><h3 id="nagruzochnoe-testirovanie">  рд▓реЛрдб рдкрд░реАрдХреНрд╖рдг </h3><br><p>  рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рд╕рд╛рде 2 рдиреЛрдбреНрд╕ рдкрд░ рдкрд░реАрдХреНрд╖рдг рд╣реЛрддрд╛ рд╣реИ: </p><br><pre> <code class="bash hljs">CPU: Single Core Intel Core (Broadwell) (-MCP-) speed: 2295 MHz Kernel: 3.10.0-862.3.2.el7.x86_64 x86_64 Up: 1h 08m Mem: 1023.8/1999.6 MiB (51.2%) Storage: 10.00 GiB (43.5% used) Procs: 98 Shell: bash 4.2.46 inxi: 3.0.37</code> </pre> <br><p>  рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдЫреЛрдЯреА рд╕реА рдбрд┐рд╕реНрдХ рд▓реЗрдВ <br>  рджреЛрдиреЛрдВ рдиреЛрдбреНрд╕ рдкрд░ рд╣рдо рдПрдХ 9.4G рдФрд░ 5.9G рдлреНрд░реА рд╕реНрдкреЗрд╕ рдбрд┐рд╕реНрдХ рджреЗрдЦрддреЗ рд╣реИрдВред </p><br><pre> <code class="bash hljs">df -hP Filesystem Size Used Avail Use% Mounted on /dev/vda1 9.4G 5.9G 3.1G 66% /</code> </pre> <br><p>  рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдЪреИрдирд▓: <a href="https://t.me/sds_ru" rel="nofollow">рдПрд╕рдбреАрдПрд╕ рдФрд░ рдХреНрд▓рд╕реНрдЯрд░ рдПрдлрдПрд╕</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi478990/">https://habr.com/ru/post/hi478990/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi478974/index.html">рдЧрддрд┐рд╢реАрд▓ рдЖрдпрд╛рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдореЙрдбреНрдпреВрд▓ рдСрдЯреЛрд▓реЙрдб</a></li>
<li><a href="../hi478978/index.html">.NET рдХреЗ рд▓рд┐рдП Azure SDK: рдПрдХ рдХрдард┐рди рддреНрд░реБрдЯрд┐ рдЦреЛрдЬ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХрд╣рд╛рдиреА</a></li>
<li><a href="../hi478982/index.html">рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдорд╛рдирд╛ рдХрд┐ рдЗрд▓реЛрдирд╛ рдорд╛рд╕реНрдХред рдФрд░ рдЬрдм рд╣рдо рдлрд┐рд░ рд╕реЗ рдЪрд╛рдБрдж рдкрд░ рд╣реЛрдВрдЧреЗ</a></li>
<li><a href="../hi478986/index.html">рдпрд╛рдВрдбреЗрдХреНрд╕ рдиреЗ рд░реЗрдЯреНрд░реЛ рдЧреЗрдо рдХреЗ рд▓рд┐рдП рдПрдХ рд▓реЛрдХрдкреНрд░рд┐рдп рд╡реЛрдЯ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ред рд░реЗрдЯреНрд░реЛ рдЧреЗрдореНрд╕ рдмреИрдЯрд▓ 2019 рдХреЗ рдлрд╛рдЗрдирд▓рд┐рд╕реНрдЯ</a></li>
<li><a href="../hi478988/index.html">рд╡реЗрдирд┐рд╕: рдирдВрдЧреЗ рдЪрдЯреНрдЯрд╛рдиреЛрдВ рдХреА рдПрдХ рдЬреЛрдбрд╝реА рдкрд░ рдЬрдВрдЧрд▓реА рд▓рд╛рдн</a></li>
<li><a href="../hi478992/index.html">рдбрд░ рдФрд░ рдЖрдИрдЯреА рдореЗрдВ рдЬреАрд╡рди рдХреА рдЦреБрд╢реА рдХрд╛ рдЕрднрд╛рд╡</a></li>
<li><a href="../hi478994/index.html">рдЬрд░реНрдорди рдкреЛрд╕реНрдЯ рдиреЗ рд╕реЛрдорд╡рд╛рд░ рдХреЛ рдзреАрдореА рдФрд░ рдЖрд░рд╛рдо рдХрд░рдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рдИ рд╣реИ</a></li>
<li><a href="../hi478996/index.html">рдХрд╛рдо рдПрдХ рднреЗрдбрд╝рд┐рдпрд╛ рдирд╣реАрдВ рд╣реИ, рднрд╛рдЧ 4. рдЕрдиреБрднрд╡реА рдХрд░реНрдордЪрд╛рд░реА: рдХреИрд╕реЗ рдмрд╛рд╣рд░ рдирд╣реАрдВ рдЬрд▓рд╛ рдФрд░ рд╣рд╛рд░ рдирд╣реАрдВ</a></li>
<li><a href="../hi478998/index.html">рд╣рдо рд╣рдореЗрд╢рд╛ рд╕реНрд╡рд░реНрдгрд┐рдо рдЕрдиреБрдкрд╛рдд рдХреНрдпреЛрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? C ++ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдкреНрд░рдпрд╛рд╕ (рдЕрд╕рдлрд▓) рд╡рд┐рдХрд╛рд╕рд╡рд╛рджреА рд╡рд┐рд╢реНрд▓реЗрд╖рдг</a></li>
<li><a href="../hi479000/index.html">рд╕рдорд╛рдирддрд╛рдПрдВ рдЗрдВрдЯрд░реНрдирд╢рд┐рдк рдЬрдм рдЖрдк 14 рд╕рд╛рд▓ рдХреЗ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>