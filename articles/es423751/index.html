<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ú¥Ô∏è üö¥üèª üåØ Java para Playstation 2: ¬øes posible? üõÄüèæ üê¨ ü§∏üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduccion 
 Con este proyecto quer√≠a responder una pregunta: ¬øes posible escribir una API Java para Playstation 2 y crear una demostraci√≥n gr√°fica ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Java para Playstation 2: ¬øes posible?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423751/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a7/fd3/7b6/7a7fd37b645e7bd2c38240c53a9ab6a5.jpg" alt="imagen"></div><br><h2>  Introduccion </h2><br>  Con este proyecto quer√≠a responder una pregunta: ¬øes posible escribir una API Java para Playstation 2 y crear una demostraci√≥n gr√°fica en ella?  No quiero revelar los spoilers, pero la respuesta es s√≠. <br><br>  Hace unos a√±os empec√© el proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de Java Grinder</a> , la recepci√≥n de los archivos compilados .class de Java y en realidad el trabajo como un desensamblador.  Pero en lugar de desarmarse en el c√≥digo ensamblador de Java, se desarma en el c√≥digo fuente del ensamblador para procesadores reales.  Si el archivo de clase necesita otros archivos de clase, tambi√©n se leen y procesan.  Todas las llamadas al m√©todo API se escriben en la salida, ya sea como c√≥digo ensamblador incorporado o como llamadas a funciones preescritas que realizan su tarea prevista. <br><a name="habracut"></a><br>  Dado que <a href="">Java Grinder</a> se escribi√≥ en C ++, palabras de recursos humanos preferidas, orientadas a objetos, abstra√≠das, polim√≥rficas y muchas m√°s de alto perfil, para expandirlo, se requer√≠a principalmente crear la clase Playstation2, expandir la nueva clase R5900, expandir la clase principal del generador. <br><br>  Como resultado, el proyecto result√≥ ser m√°s grande de lo que esperaba.  El sistema en s√≠ es bastante simple, pero todav√≠a tengo mucho que aprender, y encontrar informaci√≥n de calidad no es tan simple.  De hecho, por primera vez en este proyecto, comenc√© a programar en 3D.  En otra publicaci√≥n, ya habl√© sobre lo que aprend√≠ en mi p√°gina de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">programaci√≥n de Playstation 2</a> . <br><br>  A continuaci√≥n hay un video y una explicaci√≥n detallada del proceso de desarrollo. <br><br><h2>  Video </h2><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AjM069oKUGs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Grab√© una demostraci√≥n en una PS2 slim conectando cables de audio y video a una grabadora de DVD.  Estaba un poco preocupado de que la PS2 tuviera alg√∫n tipo de protecci√≥n de Macrovision que arruinara la se√±al de video, pero estaba apagada o la grabadora de DVD la ignoraba.  El video comienza con una demostraci√≥n de la Playstation 2 real, que ejecuta una demostraci√≥n.  La consola est√° conectada a un convertidor de se√±al compuesta a VGA, conectada a una pantalla LCD, lo que demuestra que la demostraci√≥n se est√° ejecutando en una m√°quina real.  Luego agregu√© un pegado con el video real grabado directamente desde la PS2 en la grabadora de DVD. <br><br>  YouTube: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://youtu.be/AjM069oKUGs</a> <br><br><h2>  Proyectos similares en mikekohn.net </h2><br><table><tbody><tr><td>  Amoladora Java: </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Playstation 2 Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sega Genesis Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apple IIgs Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TI99 / 4A Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C64 Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dsPIC Mandelbrots</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Atari 2600 de Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">chipKIT Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Amoladora Java</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">naken_asm</a> </td></tr></tbody></table><br><h2>  Demo </h2><br>  Recordando la demostraci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sega Genesis Java</a> , lamento un poco no haberlo hecho m√°s interesante.  Entonces fue m√°s interesante para m√≠ demostrar las capacidades de la API de Java.  Cuando comenc√© este proyecto, decid√≠ hacer algo m√°s serio.  Desafortunadamente, nuevamente me qued√© tan agotado en el proceso de estudiar el sistema y crear la API que no tuve suficiente fuerza para una gran demostraci√≥n. <br><br><ul><li>  Logotipo de 3 mil millones de dispositivos: este es el logotipo de Java de 3 mil millones de dispositivos de baja resoluci√≥n creado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Joe Davisson</a> para su demostraci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Java Commodore 64</a> . </li><li>  Logotipos: los dibuj√© con un marcador y los escane√© (con la excepci√≥n del logotipo de Java). </li><li>  Estrellas: Copi√© el c√≥digo de la demostraci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sega Genesis Java</a> y lo modifiqu√© para que funcione con la API de Playstation 2.  El texto aqu√≠ tambi√©n se escribe con un marcador y se escanea. </li><li>  Fractales de Mandelbrot: se demuestran usando la unidad de vector 0, que calcula fractales, y la unidad de vector 1 realiza c√°lculos 3D.  MIPS controla lo que hacen ambos dispositivos vectoriales. </li><li>  Cubos: Dibuj√© estos cubos en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wings3d</a> y escrib√≠ el c√≥digo C para convertir archivos STL en matrices que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Java Grinder</a> podr√≠a usar.  Agregu√© colores manualmente. </li><li>  Anillo de cuadrados: solo un intento de dibujar muchos objetos en movimiento en la pantalla.  Probablemente vali√≥ la pena agregar m√°s objetos antes de que el sistema comenzara a ralentizarse. </li></ul><br><h2>  Musica </h2><br>  Para la demostraci√≥n, compuse y grab√© tres canciones, pero como resultado solo us√© dos.  La primera composici√≥n es en realidad una melod√≠a que escrib√≠ para otro proyecto publicado en mi sitio web ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proyecto aceptador de monedas</a> ) hace aproximadamente un a√±o ... inicialmente solo hab√≠a una parte.  Despu√©s de que se complet√≥ el proyecto, pens√© que ser√≠a interesante ponerle un solo de guitarra, y despu√©s de grabar, imagin√© que esta m√∫sica suena mientras las estrellas vuelan en la demo.  Logr√© usarlo solo despu√©s de unos meses.  La guitarra en la composici√≥n es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Fender Strat I festoneada</a> . <br><br>  Grab√© la segunda composici√≥n solo un d√≠a antes de la publicaci√≥n del art√≠culo.  El solo de guitarra suena un poco ... borracho porque se toca en una guitarra que convert√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sin trastes</a> .  No soy muy bueno para tocarlo, y las notas altas se desvanecen muy r√°pidamente, pero las diapositivas suenan bastante bien.  La parte r√≠tmica se jug√≥ en mi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">kit de</a> aspirantes a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Yngwie</a> (Squier Strat festoneado barato, sobremarcha DOD YJM308 y Mini-Marshall con bater√≠as de 9 voltios). <br><br>  Program√© la bater√≠a para ambas composiciones usando el programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Drums ++ de</a> larga duraci√≥n.  Recibe archivos de texto de entrada grabados en mi propio idioma, y ‚Äã‚Äãlos convierte en archivos .mid, que import√© a Apple Garage Band, despu√©s de lo cual puede grabar pistas base y de guitarra.  Los archivos fuente <a href="">fretless.dpp</a> y <a href="">shoebox.dpp</a> est√°n en la carpeta de activos de mi repositorio de demostraci√≥n. <br><br>  Playstation 2 SPU2 reproduce la m√∫sica y, gracias al R5900, puede hacer otro trabajo.  Debido a la falta de buena documentaci√≥n, casi termin√© la demostraci√≥n sin m√∫sica alguna.  M√°s sobre esto a continuaci√≥n. <br><br>  Aqu√≠ hay dos pistas en formato MP3: <br><br><ul><li>  <a href="">shoebox_full.mp3</a> </li><li>  <a href="">fretless.mp3</a> </li></ul><br><h2>  Desarrollo </h2><br>  El proyecto se ha desarrollado durante mucho tiempo.  Comenc√© a agregar instrucciones de R5900 Emotion Engine al ensamblador MIPS en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">naken_asm</a> , luego <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">busqu√©</a> instrucciones de punto flotante e instrucciones de unidad de macro / micro vector.  Haciendo un gran respiro para trabajar en otros proyectos, estudi√© todos los dem√°s aspectos necesarios para esta demostraci√≥n, y proced√≠ a agregar su apoyo a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Java Grinder</a> .  Si alguien est√° interesado en los detalles de bajo nivel, cre√© una p√°gina en la que intent√© documentar toda la informaci√≥n recopilada: la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">programaci√≥n de Playstation 2</a> . <br><br>  Principalmente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">program√©</a> usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el emulador PCXS2</a> .  Es bastante conveniente, porque en √©l puedo examinar registros y similares en la pantalla.  Pero definitivamente no es tan flexible y simple como MAME cuando se desarrolla <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sega Genesis</a> .  Por ejemplo, en MAME es m√°s f√°cil examinar la memoria y la RAM, y los registros de video / audio para asegurarse de que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Java Grinder</a> funciona correctamente. <br><br>  Cuando trabaj√© con el c√≥digo para Sega, comet√≠ un error: no lo prob√© en la m√°quina hasta que se escribi√≥ la demostraci√≥n.  Hubo al menos tres rarezas en el c√≥digo Sega que el emulador ignor√≥, pero no les gust√≥ la m√°quina real.  Esta vez, despu√©s de escribir las partes individuales del c√≥digo, las prob√© en una m√°quina real, de modo que una vez completada la demostraci√≥n, funciona tanto en el equipo real como en el emulador.  Nuevamente me encontr√© con cosas que funcionaban en el emulador, pero que no comenzaron en una PS2 real.  Tambi√©n descubr√≠ que funcionaba en una Playstation 2 real, pero funcionaba incorrectamente en el emulador. <br><br><h2>  Caracter√≠sticas de la API </h2><br><ul><li>  Vector Unit 0 tiene m√©todos para cargar / ejecutar c√≥digo y cargar / descargar datos. </li><li>  Vector Unit 1 realiza rotaciones y proyecciones 3D. </li><li>  Texturas que utilizan un formato de 16 o 24 bits (la transparencia se indica en negro). </li><li>  Las texturas en formato de 16 bits se pueden codificar con RLE. </li><li>  C√≥digo para dibujar puntos, l√≠neas, tri√°ngulos, con y sin texturas. </li><li>  Niebla y sombreado por Guro. </li><li>  M√©todos para acceder a un generador de n√∫meros aleatorios. </li><li>  Usando dos contextos (reemplazando p√°ginas) </li><li>  Inserte datos binarios grandes en el c√≥digo ensamblador compilado. </li><li>  Tocando musica. </li></ul><br><h2>  API </h2><br>  La parte principal de la API se establece en la clase <a href="">Playstation2</a> .  Inicialmente, iba a darle un alto grado de libertad: la capacidad de configurar modos de video y cosas similares, pero luego pens√© que ser√≠a mejor ocultar todas estas dificultades.  Esencialmente, solo configura una pantalla entrelazada de 640x448.  Al igual que con otros proyectos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Java Grinder</a> , b√°sicamente agregu√© m√©todos / caracter√≠sticas seg√∫n sea necesario. <br><br>  Hay otro conjunto de clases, la cual di a aburrido nombre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Draw3D</a> .  En esencia, definen todos los tipos de primitivas que Graphics Synthesizer puede procesar con soporte para texturas de 16, 24 y 32 bits.  Pens√© en agregar texturas de 8 bits, pero decid√≠ no hacerlo todav√≠a.  Draw3D proporciona rotaciones 3D, proyecci√≥n, transferencia de hardware DMA, texturas, etc.  Probablemente se preguntar√° por qu√© no lo cre√© basado en OpenGL, pero nunca antes hab√≠a trabajado con OpenGL.  √ârase una vez una simple programaci√≥n de ps2dev, pero no hab√≠a nada serio all√≠ y apenas recuerdo ese proyecto, as√≠ que repito: podemos suponer que esta es la primera vez que hago algo serio en 3D. <br><br>  Hay ejemplos de uso de todas estas cosas, no solo en la demostraci√≥n, sino tambi√©n en la carpeta de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">muestras</a> . <br>  Casi todas las dificultades est√°n ocultas en la API.  El desarrollador no necesita preocuparse por borrar el cach√©, por la inform√°tica en 3D, etc.  Sin embargo, la recompensa por esto fue una disminuci√≥n en la versatilidad.  Por lo tanto, si, por ejemplo, el procesador cambi√≥ la textura, pero solo han cambiado los primeros 64 p√≠xeles, entonces solo necesita borrar una l√≠nea de cach√© de 64 bytes, pero Java Grinder borra toda la imagen.  Marca objetos, por lo tanto, se borran solo si es necesario, pero borra todo el fragmento de memoria.  Con una alta probabilidad al cambiar 64 bytes, la imagen completa tambi√©n cambia. <br><br><h2>  Unidad vectorial 0 (VU0) </h2><br>  El usuario de Java Grinder es libre de usar VU0.  Us√© la parte de demostraci√≥n llamada "Dos unidades de vectores, un MIPS" para representar los fractales de Mandelbrot.  El c√≥digo se puede optimizar mejor, por ejemplo, la mayor√≠a de las instrucciones de coma flotante de la unidad vectorial tienen un tiempo de ejecuci√≥n de 1 y una latencia de 4. Hasta donde yo entiendo, esto significa que si el registro es el objetivo de la instrucci√≥n, entonces se puede ejecutar en 1 ciclo, pero para para que el resultado est√© disponible, se requieren 4 ciclos.  Si se utiliza este registro, la unidad de vector permanecer√° inactiva hasta que est√© lista.  Por lo tanto, la idea es que necesita organizar las instrucciones para que pueda ejecutar cada instrucci√≥n en 1 ciclo sin tiempo de inactividad.  Cuando cre√© los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fractales Mandelbrot en Playstation 3</a> el a√±o pasado, optimic√© este c√≥digo mientras calculaba simult√°neamente 8 p√≠xeles (2 registros SIMD), al tiempo que not√© un gran aumento de velocidad.  En el caso actual, trat√© de hacer que el c√≥digo fuera m√°s f√°cil de leer, por lo que no me molest√© con su optimizaci√≥n. <br><br>  VU0 contiene solo 4 KB de memoria de datos, y no escribir√° all√≠ toda la imagen fractal, por lo que MIPS env√≠a las coordenadas de solo 1/8 de la imagen a la vez. <br><br>  Lo extra√±o que encontr√© al trabajar con VU0: inicialmente ejecut√© el c√≥digo VU0 usando instrucciones y us√© VIF0_STAT para verificar la finalizaci√≥n de su ejecuci√≥n.  Parece que VIF0_STAT no funciona si no inicia VU0 con el paquete VIF.  Esto se soluciona en el emulador, pero el error todav√≠a est√° en el hardware real.  Como resultado, descubr√≠ que vcallms y el uso de cfc2 en el registro 29 funciona en ambos casos. <br><br>  Me parece que los conjuntos de instrucciones de la unidad vectorial carecen de las instrucciones de comparaci√≥n paralelas que se encuentran en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Intel X86_64, Playstation 3</a> e incluso en el conjunto de instrucciones MIPS R5900 Emotion Engine.  Los fractales de Mandelbrot deben calcular iterativamente la f√≥rmula hasta que el resultado sea superior, por lo que con un conjunto diferente de instrucciones, simplemente realizar√≠a una comparaci√≥n paralela que crear√≠a una m√°scara para todos los binarios 1 o 0. La m√°scara se puede usar para detener el incremento de los contadores de color.  Para Playstation 2, tuve que derivar una f√≥rmula muy inc√≥moda, que est√° bastante cerca de la f√≥rmula fractal.  Document√© esto en el c√≥digo fuente de <a href="">mandelbrot_vu0.asm</a> en l√≠neas con Python comentado. <br><br>  Me parece genial en los dispositivos de unidad de vector de la consola Playstation 2 que es genial que no haya visto ning√∫n otro conjunto de instrucciones SIMD en el que todas las instrucciones de FPU puedan tener el atributo .xyzw que indique a la instrucci√≥n cu√°l de los cuatro n√∫meros de punto flotante tiene afectos  Es decir, si necesitaba que el resultado de la instrucci√≥n afectara solo el componente x del vector, entonces simplemente agregar√≠a .x al final de la instrucci√≥n.  Otra cosa interesante es que es un conjunto de instrucciones VLIW, es decir, en cada ciclo, se ejecutan dos instrucciones simult√°neamente.  De hecho, el m√≥dulo se parece m√°s a un DSP que a un procesador de uso general. <br><br><h2>  Unidad vectorial 1 (VU1) </h2><br>  VU1 est√° reservado por Java Grinder para realizar rotaciones, movimientos y proyecciones en 3D.  Los objetos Draw3D se pasan a VU1 utilizando el m√©todo draw (), que utiliza el ensamblador de unidades vectoriales para convertir los puntos y transferirlos al Sintetizador de gr√°ficos.  El c√≥digo del ensamblador en VU1 puede optimizarse mucho mejor para la velocidad, pero es adecuado para mis prop√≥sitos, as√≠ que decid√≠ dejar el c√≥digo f√°cil de leer (no optimizado). <br><br>  Para estudiar las f√≥rmulas de proyecciones y giros, utilic√© Wikipedia: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proyecciones</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">giros</a> . <br><br>  El c√≥digo de transformaci√≥n 3D tambi√©n est√° en el repositorio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">naken_asm</a> como un simple archivo .asm: <a href="">rotacion_vu1.asm</a> . <br><br><h2>  MIPS R5900 </h2><br>  Realmente no me gust√≥ el conjunto de instrucciones MIPS hasta que comenc√© a trabajar en este proyecto.  De hecho, es bastante f√°cil trabajar con esta CPU.  La versi√≥n Emotion Engine de esta CPU tiene caracter√≠sticas muy convenientes.  Lo m√°s notable es que los registros tienen una longitud de 128 bits, pero de hecho simplemente se usan para cargar / almacenar y SIMD.  Es decir, en realidad, estos son registros de 128 bits, ALU de 64 bits y punteros de 32 bits. <br><br>  Tambi√©n fue posible introducir optimizaciones en el c√≥digo MIPS principal, pero no lo hice para mantener la legibilidad del c√≥digo o por falta de tiempo.  Por ejemplo, la CPU MIPS est√° inactiva durante un ciclo si el registro de instrucciones de destino se us√≥ inmediatamente despu√©s de configurarlo.  Este comportamiento podr√≠a mejorarse. <br><br><h2>  Hacks de Java </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Java Grinder en s√≠</a> tambi√©n tiene sus propias ... rarezas, pero simplemente falta algo, principalmente porque inicialmente apunt√© al MSP430 y en su mayor parte fue un experimento.  Uno de los elementos que faltaban era la incapacidad de asignar memoria para los objetos.  Agregu√© esta caracter√≠stica en Playstation 2 para instanciar m√∫ltiples objetos, principalmente usando la API Draw3D.  No escrib√≠ ning√∫n asignador de memoria o recolector de basura, por lo que todas las llamadas nuevas se realizan en la pila.  Estaba pensando en implementar algo como un asignador din√°mico de memoria, pero al final decid√≠ no complicarlo.  Tambi√©n agregu√© soporte extendido para Playstation 2 para n√∫meros de punto flotante (flotante) (parcialmente este soporte todav√≠a estaba en el c√≥digo Epiphany / Parallella).  Algunas otras cosas, como los tipos largos y dobles, todav√≠a no son compatibles. <br><br>  Probablemente lo m√°s molesto que hice estuvo relacionado con la terrible restricci√≥n de los archivos de clase Java.  El m√©todo Java no puede ser mayor que 64K si no recuerdo mal.  Quiz√°s esto es normal, pero el problema surge cuando hay una matriz est√°tica en el archivo de clase y no se descarga en el archivo de clase como datos binarios.  Se coloca en el archivo de clase como una instrucci√≥n de ensamblador Java en un inicializador est√°tico para crear una matriz.  Intent√© guardar im√°genes en archivos de clase como arreglos de bytes est√°ticos [], pero algunos de ellos no encajaban, as√≠ que agregu√© un m√©todo al archivo de clase Memory <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Java Grinder</a> : <br><br><pre><code class="cpp hljs">byte[] Memory.preloadByteArray(String filename);</code> </pre> <br>  No descarga este archivo en tiempo de ejecuci√≥n, pero lo descarga en tiempo de compilaci√≥n utilizando la directiva .binfile <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">naken_asm</a> .  Las im√°genes se copian al binario de salida durante el ensamblaje. <br><br>  Con todo esto en mente, realmente espero que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">James Gosling</a> nunca tropiece con mi proyecto. <br><br><h2>  Im√°genes </h2><br>  Draw3D API puede usar texturas de 16, 24 y 32 bits.  Los p√≠xeles de textura se pueden configurar p√≠xel por p√≠xel o cargando utilizando conjuntos de bytes [].  Tambi√©n agregu√© la capacidad de comprimir im√°genes RLE en el formato {longitud, lo16, hi16}, donde lo16 y hi16 son el color de 16 bits en el formato little endian, que se copia en los tiempos de "longitud" de la textura. <br><br><h2>  Las herramientas </h2><br>  Cuando trabaj√© en Sega para crear herramientas para crear im√°genes, m√∫sica y similares, utilic√© el idioma Google Go, solo para aprender un nuevo idioma.  Esta vez prob√© Rust.  La primera herramienta convierte binarios en c√≥digo fuente Java, y la segunda convierte BMP en formato binario, que puede cargarse en texturas, incluso en formato RLE.  Como resultado, los escrib√≠ en Python, en caso de que alguien quiera unirse a m√≠ para crear una demostraci√≥n. <br><br><h2>  Sonido </h2><br>  Habiendo descubierto c√≥mo funcionan los dispositivos gr√°ficos y de unidad de vector, el √∫ltimo paso fue el sonido.  Pens√© que ser√≠a la parte m√°s f√°cil, especialmente despu√©s de estudiar el PDF con la descripci√≥n de Sony SPU2.  Qu√© equivocado estaba.  Esta parte del sistema est√° muy poco documentada. <br><br>  Lo primero que descubr√≠ es que SPU2 (unidad de procesamiento de sonido) est√° conectado a IOP (procesador de E / S, tambi√©n conocido como procesador Playstation 1).  La CPU Playstation 2 est√° conectada a este IOP a trav√©s de algo llamado SIF.  El PDF de Sony solo menciona SIF DMA, pero no dice nada sobre su uso. <br><br>  Como resultado, me negu√© a usar SIF, pero decid√≠ agregar un enlazador a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">naken_asm</a> para poder usar kernel.a desde el SDK de PS2DEV.  Linker gan√≥, pero fall√≥. <br><br>  En esta etapa, ya decid√≠ que no pod√≠a hacer que el sonido funcionara, y solo quer√≠a terminar la demostraci√≥n sin √©l.  Pero me atorment√≥, as√≠ que decid√≠ echar un vistazo al c√≥digo fuente de varios emuladores de Playstation 2 para comprender c√≥mo funciona SIF.  Finalmente, descubr√≠ c√≥mo acceder directamente a la memoria desde el c√≥digo MIPS R3000 en IOP y ejecutarlo (hay un ejemplo en la carpeta de muestras del repositorio naken_asm).  Logr√© que el sonido funcionara en el emulador. <br><br>  Al final, descubr√≠ que la memoria IOP (incluida la SPU2) estaba ubicada en el espacio de Emotion Engine, as√≠ que puse mucho esfuerzo (la documentaci√≥n es extremadamente peque√±a y en ninguno de los emuladores est√° implementada completamente correctamente, pero no les importa que funcionen) ), Aprend√≠ a trabajar con sonido. <br><br><h2>  Comparaci√≥n de emulador y hierro </h2><br>  Encontr√© algunas diferencias entre la ejecuci√≥n en una m√°quina real y en un emulador. <br><br><ul><li>  Si el paquete GIF establece que el PRIM registra ambos valores IIP (m√©todo de sombreado), y los bits FIX son todos 1, entonces el emulador tiene en cuenta el bit IIP y realiza el sombreado Gouro, mientras que el equipo real realiza el sombreado plano. </li><li>  Si el paquete GIF se transmite a trav√©s de PATH3 (EE directo a GS), y el indicador EOP (final del paquete) no est√° configurado, entonces si VU1 intenta enviar el paquete GIF a trav√©s de PATH 1 (VU1 a GS), esto provocar√° un bloqueo en el hardware real, pero funcionar√° en el emulador. </li><li>  Omitir borrar el cach√© de la CPU antes de la transferencia DMA no es necesario, pero en una m√°quina real conduce a un comportamiento extra√±o. </li><li>  Al colocar SPU2 en el espacio EE, el emulador puede simplemente grabar datos de audio en FIFO SPU2.  En una Playstation 2 real, despu√©s de grabar 32 palabras, es necesario escribir en el registro para dar un comando para borrar el FIFO.  Adem√°s, en hardware real, al configurar la direcci√≥n de transmisi√≥n / inicio de SPU2, el modo de transmisi√≥n debe establecerse en 0. A los emuladores no les importa si el modo tiene un valor de 0. </li><li>  Escribir IOP desde EE en los registros de memoria asignados se bloquea en una m√°quina real, aunque est√© en modo kernel.  El emulador permite que tales operaciones funcionen independientemente del modo de CPU actual. </li><li>  El uso de canales SIF DMA funciona en el emulador, pero a√∫n no he podido hacer que funcionen en equipos reales.  Estaba recibiendo un error de acceso a la memoria para registros SIF DMA incluso en modo kernel. </li><li>  El emulador es demasiado lento para ejecutar una demostraci√≥n al calcular fractales usando VU0, por lo que el sonido no est√° sincronizado. </li></ul><br><h2>  Para resumir </h2><br>  Quer√≠a escribir alg√∫n programa para Playstation 2 casi desde el momento de su compra.  De hecho, ya tuve un kit de Linux para PS2 durante mucho tiempo (creo que es por eso que compr√© Playstation 2), e incluso intent√© trabajar con la biblioteca PS2DEV en C, pero esta es una experiencia completamente diferente en comparaci√≥n con la programaci√≥n en lenguaje ensamblador directamente para hierro <br><br>  Dar las gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lukas</a> para el mantenimiento de viejos documentos de c√≥digo fuente en ensamblador y PS2.  No estoy seguro de si podr√≠a comenzar sin la demostraci√≥n de Duke 3 Star, que me ayud√≥ a inicializar el equipo.  Tambi√©n estoy agradecido a los desarrolladores del emulador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PCSX2</a> , que aceler√≥ enormemente el proceso de depuraci√≥n.  Adem√°s, no podr√≠a descifrar el sonido si no hubiera mirado el c√≥digo fuente del emulador y no hubiera entendido lo que estaba mal. <br><br>  Y gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sony</a> por esta peque√±a y hermosa computadora.  Si alguien de Sony lee este art√≠culo, aqu√≠ hay un consejo: ¬øpor qu√© no reducirlo al tama√±o de un Rapsberry Pi y venderlo como un tablero para proyectos de pasatiempo?  :). <br><br><h2>  Construir demostraci√≥n </h2><br> <code>git clone https://github.com/mikeakohn/playstation2_demo.git <br> git clone https://github.com/mikeakohn/java_grinder.git <br> git clone https://github.com/mikeakohn/naken_asm.git <br> cd naken_asm <br> ./configure <br> make <br> cd .. <br> cd java_grinder <br> make java <br> make <br> cd .. <br> cd playstation2_demo <br> make</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423751/">https://habr.com/ru/post/es423751/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423741/index.html">Resumen CRUD del repositorio al controlador: ¬øqu√© m√°s se puede hacer con Spring + Generics?</a></li>
<li><a href="../es423743/index.html">Bajo control: herramienta de monitoreo de disco del servidor VDS</a></li>
<li><a href="../es423745/index.html">Uso de Python para analizar habilidades demandadas relacionadas entre desarrolladores</a></li>
<li><a href="../es423747/index.html">Nuevas herramientas de desarrollo con LEGO Education: de Microsoft, MIT y m√°s</a></li>
<li><a href="../es423749/index.html">8 sencillos pasos para fallar un gerente de desarrollo novato</a></li>
<li><a href="../es423753/index.html">Mantenga seguros los tokens de autorizaci√≥n</a></li>
<li><a href="../es423759/index.html">Fintech-digest: datos personales de ciudadanos de la Federaci√≥n de Rusia, mercado del Banco Central, un nuevo servicio de CloudFlare</a></li>
<li><a href="../es423763/index.html">Lo que Uber Cash ense√±a a los innovadores</a></li>
<li><a href="../es423765/index.html">Estamos escribiendo una aplicaci√≥n para el control remoto del reproductor MPV de RetroOrangePi</a></li>
<li><a href="../es423767/index.html">Los hackers atacaron British Airways: 380,000 tarjetas bancarias de clientes robadas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>