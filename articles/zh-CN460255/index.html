<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐐 🐫 ⤵️ Node.js上的后门程序：为什么，为什么以及如何工作 👊🏿 🤧 👨🏽‍🔧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近，Yandex的同事与我们分享了一个有趣的特洛伊木马样本，我们在此新闻中对此进行了报道。 这种恶意软件并不经常出现，因此我们决定对其进行详细介绍，同时讨论为什么我们很少遇到此类样本。 

 该木马是一个用JavaScript编写并使用Node.js运行的多组件后门。 它的主要元素是worker和...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Node.js上的后门程序：为什么，为什么以及如何工作</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/drweb/blog/460255/"> 最近，Yandex的同事与我们分享了一个有趣的特洛伊木马样本，我们在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此</a>新闻中<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">对此进行了</a>报道。 这种恶意软件并不经常出现，因此我们决定对其进行详细介绍，同时讨论为什么我们很少遇到此类样本。 <br><a name="habracut"></a><br> 该木马是一个用JavaScript编写并使用Node.js运行的多组件后门。 它的主要元素是worker和updater，它们由引导程序下载并安装到系统中。 有效负载可以是任何负载，但在这种情况下，特洛伊木马会安装xmrig挖矿机。 在研究时，开发人员使用矿工来开采TurtleCoin加密货币。 <br><br>  MonsterInstall通过带有欺骗手段的站点进行分发，这些站点可以欺骗流行的视频游戏。 这些资源大多数属于Trojan的开发人员，但是我们在其他类似的站点上发现了更多受感染的文件。 其中一个的所有者定期监视竞争对手的更新，并用新内容补充他的资源。 为此，他使用了parser.php脚本，该脚本通过代理在cheathappens.com上搜索新的作弊文件。 <br><br><pre><code class="plaintext hljs">Proxy parse done, total: 1 Use sox 84.228.64.133:1080 Error: CURL error(#52), attempts left: 10 Use sox 84.228.64.133:1080 Posts found: 30! [33mPage Satisfactory: ўЂµ№ЅµЂ +8 vCL#96731 {CheatHappens.com} already in base[0m [33mPage Borderlands: The Pre-Sequel - ўЂµ№ЅµЂ +28 v1.2019 {LinGon} already in base[0m [33mPage Borderlands - Game of the Year Enhanced: ўЂµ№ЅµЂ +19 v1.0.1 {LinGon} already in base[0m [33mPage Star Wars: Battlefront 2 (2017): ўЂµ№ЅµЂ +4 v01.04.2019 {MrAntiFun} already in base[0m [36mPage Far Cry 5: ўЂµ№ЅµЂ +23 v1.012 (+LOST ON MARS/DEAD LIVING ZOMBIES) {CheatHappens.com} added 2019-Apr-09[0m [36mPage Fate/Extella Link: ўЂµ№ЅµЂ +13 v04.09.2019 {CheatHappens.com} added 2019-Apr-09[0m [36mPage Superhot: ўЂµ№ЅµЂ +3 v2.1.01p { MrAntiFun} added 2019-Apr-09[0m [36mPage Dawn of Man: ўЂµ№ЅµЂ +7 v1.0.6 {CheatHappens.com} added 2019-Apr-08[0m [36mPage Borderlands 2: ўЂµ№ЅµЂ +14 v06.04.2019 {MrAntiFun} added 2019-Apr-08[0m [36mPage Borderlands: The Pre-Sequel - ўЂµ№ЅµЂ +17 v06.04.2019 {MrAntiFun} added 2019-Apr-08[0m [36mPage Tropico 6: ўЂµ№ЅµЂ +9 v1.01 {MrAntiFun} added 2019-Apr-08[0m [36mPage Operencia: The Stolen Sun - ўЂµ№ЅµЂ +20 v1.2.2 {CheatHappens.com} added 2019-Apr-08[0m [36mPage Enter the Gungeon: ўЂµ№ЅµЂ +6 v2.1.3 {MrAntiFun} added 2019-Apr-07[0m [36mPage The Guild 3: ўЂµ№ЅµЂ +2 v0.7.5 {MrAntiFun} added 2019-Apr-07[0m [36mPage Dead Effect 2: ўЂµ№ЅµЂ +8 v190401 {MrAntiFun} added 2019-Apr-07[0m [36mPage Assassin's Creed: Odyssey - ўЂµ№ЅµЂ +26 v1.2.0 {FLiNG} added 2019-Apr-07[0m [36mPage Assassin's Creed: Odyssey - ўЂµ№ЅµЂ +12 v1.2.0 {MrAntiFun} added 2019-Apr-06[0m [36mPage Super Dragon Ball Heroes: World Mission - ўЂµ№ЅµЂ +11 v1.0 {FLiNG} added 2019-Apr-05[0m [36mPage Tropico 6: ўЂµ№ЅµЂ +7 v1.02 97490 {CheatHappens.com} added 2019-Apr-05[0m [36mPage Risk of Rain 2: ўЂµ№ЅµЂ +10 Build 3703355 {CheatHappens.com} added 2019-Apr-05[0m [36mPage Sid Meier's Civilization 6 - Rise and Fall: ўЂµ№ЅµЂ +12 v1.0.0.314 {MrAntiFun} added 2019-Apr-05[0m [36mPage Sid Meier's Civilization 6 - Gathering Storm: ўЂµ№ЅµЂ +12 v1.0.0.314 {MrAntiFun} added 2019-Apr-05[0m [36mPage Sid Meier's Civilization 6: ўЂµ№ЅµЂ +12 v1.0.0.314 {MrAntiFun} added 2019-Apr-05[0m [36mPage Borderlands GOTY Enhanced: ўЂµ№ЅµЂ +16 v1.0 {CheatHappens.com} added 2019-Apr-05[0m [36mPage Borderlands Game of the Year Enhanced: ўЂµ№ЅµЂ +13 v1.00 {MrAntiFun} added 2019-Apr-04[0m [36mPage Assassin's Creed: Odyssey: ўЂµ№ЅµЂ +24 v1.2.0 (04.04.2019) {CheatHappens.com} added 2019-Apr-04[0m [36mPage Sekiro: Shadows Die Twice - ўЂµ№ЅµЂ +24 v1.02 {FLiNG} added 2019-Apr-04[0m [36mPage Hearts of Iron 4: ўЂµ№ЅµЂ +24 v1.6.2 {MrAntiFun} added 2019-Apr-04[0m [36mPage Wolcen: Lords of Mayhem - ўЂµ№ЅµЂ +5 v1.0.2.1 {MrAntiFun} added 2019-Apr-04[0m [36mPage Devil May Cry 5: ўЂµ№ЅµЂ +18 v1.0 (04.03.2019) {CheatHappens.com} added 2019-Apr-04[0m Parse done</code> </pre> <br><br> 在开发人员的网站上，有很多作弊手段，但是所有链接都将返回相同的存档。 如果尝试从恶意软件站点下载任何文件，则用户将收到Trojan.MonsterInstall。 可以从下载链接中猜测木马的一些参数： <br><br><pre> <code class="plaintext hljs">https://&lt;malicious_site&gt;/fc/download.php?name=Borderlands%20GOTY%20Enhanced:%20%D0%A2%D1%80%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%20+16%20v1.0%20{CheatHappens.com}&amp;link=https://&lt;malicious_site&gt;//r.php?site=http://gtrainers.com/load/0-0-1-7081-20&amp;password=&lt;malicious_site&gt;/&amp;uid=101&amp;sid1=1&amp;sid2=1&amp;charset=utf-8</code> </pre><br><ul><li>  name-档案名称和档案中的exe； </li><li>  link-指向用户想要下载的文件的链接（连接在data.json中）； </li><li> 密码-存档的密码。 </li></ul><br> 假设我们选择了所需的作弊文件，并从特洛伊木马程序开发人员的网站下载了受密码保护的7zip存档，其名称很有前途：“ ExtrimHack.rar”。 它的内部有一个可执行文件，一个配置文件，一个7zip库以及一个带有使用Node.js Binar启动的本机C ++库和脚本的bin存档。 <br><br> 存档内容示例： <br><br><ul><li>  7z.dll; </li><li>  data.bin; </li><li>  data.json; </li><li>  ESP作弊COP GO.exe。 </li></ul><br><br> 启动可执行文件后，特洛伊木马将使用data.json文件中的参数信息安装其运行所需的所有组件，并下载用户所需的作弊文件。 <br><br>  data.json的示例内容： <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"source"</span></span>:[<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">43</span></span>],<span class="hljs-string"><span class="hljs-string">"dataVersion"</span></span>:[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">115</span></span>],<span class="hljs-string"><span class="hljs-string">"link"</span></span>:<span class="hljs-string"><span class="hljs-string">"http:\/\/clearcheats.ru\/images\/dl\/csgo\/ESP_csgo.dll"</span></span>}</code> </pre><br><br> 为了排除其过程的多个副本，特洛伊木马创建了“ cortelMoney-suncMutex”互斥体并将其安装在“％WINDIR％\ WinKit \”目录中。 然后，它检查它是否在注册表中（[HKLM \\ Software \\ Microsoft \\ Windows Node]）。 如果是这样，它将读取其参数并将版本与data.json中指定的版本进行比较。 如果版本是最新版本，则它将不再执行任何操作并结束。 <br><br> 然后，木马将WINDIR％\\ WinKit \\中的data.bin内容解压缩，并安装服务以启动start.js。 <br><br>  data.bin的内容： <br><ul><li> 守护进程 </li><li>  node_modules; </li><li>  7z.dll; </li><li>  msnode.exe; </li><li>  start.js; </li><li>  startDll.dll; </li><li>  update.js; </li><li>  updateDll.dll。 </li></ul><br> 同时，msnode.exe是具有有效数字签名的可执行文件Node.js，node_modules目录包含库“ ffi”，“ node-windows”和“ ref”。 <br><br> 将startDll.dll库加载到start.js中，并调用其mymain导出，该库从注册表中读取其参数，启动“％WINDIR％\\ WinKit \\ msnode％WINDIR％\\ WinKit \\ update.js”并停止该服务“ Windows节点”。 依次，update.js脚本加载updateDll.dll库并调用其mymain导出。 没什么复杂的。 <br><br> 在updateDll.dll中，木马将开始检查您的Internet连接。 为此，他将每10秒将请求发送到google.com，yahoo.com，facebook.com，直到所有三个返回200个代码为止。 然后它将带有配置数据的请求发送到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">s44571fu</a> [。] Bget [。] Ru / CortelMoney / enter.php POST服务器： <br><br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"login"</span></span>:<span class="hljs-string"><span class="hljs-string">"NULL"</span></span>,<span class="hljs-string"><span class="hljs-string">"mainId"</span></span>:<span class="hljs-string"><span class="hljs-string">"PPrn1DXeGvUtzXC7jna2oqdO2m?WUMzHAoM8hHQF"</span></span>,<span class="hljs-string"><span class="hljs-string">"password"</span></span>:<span class="hljs-string"><span class="hljs-string">"NULL"</span></span>,<span class="hljs-string"><span class="hljs-string">"source"</span></span>:[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>],<span class="hljs-string"><span class="hljs-string">"updaterVersion"</span></span>:[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>],<span class="hljs-string"><span class="hljs-string">"workerVersion"</span></span>:[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>]}</code> </pre> <br><br> 在这种情况下，对于基本授权，使用一对“ cortel：money”，并且将User-Agent设置为“ USER AGENT”。 对于后续请求的基本授权，将使用login：密码，该密码将由服务器报告。 <br><br> 服务器使用json进行响应，如下所示： <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"login"</span></span>: <span class="hljs-string"><span class="hljs-string">"240797"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"tdzjIF?JgEG5NOofJO6YrEPQcw2TJ7y4xPxqcz?X"</span></span>, <span class="hljs-string"><span class="hljs-string">"updaterVersion"</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">115</span></span>], <span class="hljs-string"><span class="hljs-string">"updaterLink"</span></span>: <span class="hljs-string"><span class="hljs-string">"http:\/\/s44571fu.bget.ru\/CortelMoney\/version\/0-0-0-115-upd.7z"</span></span>, <span class="hljs-string"><span class="hljs-string">"workerVersion"</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"workerLink"</span></span>: <span class="hljs-string"><span class="hljs-string">"http:\/\/s44571fu.bget.ru\/CortelMoney\/version\/0-0-3-0-work.7z"</span></span> }</code> </pre> <br><br> 如您所见，服务器的响应包含特洛伊木马主要元素的版本。 如果用户设备上的更新程序的当前版本比服务器报告的版本旧，则特洛伊木马会从指定的链接下载文件并将压缩文件解压缩到目录“％WINDIR％\\ WinKit \\\\”中，在该目录中将显示服务器响应中的updaterVersion参数的值。 。 <br><br> 该木马将工作文件解压缩到％WINDIR％\\ WinKit \\ SystemNode \\目录中，然后启动“％WINDIR％\\ WinKit \\ SystemNode \\ sysnode％WINDIR％\\ WinKit \\ SystemNode \\ main.js”。 <br><br> 与工作人员一起归档的内容： <br><ul><li>  node_modules; </li><li>  7za.exe; </li><li> 食典; </li><li>  main.js; </li><li>  sysnode.exe。 </li></ul><br> 然后，木马删除Windows Node Guard服务，然后再次创建它，将可执行文件替换为Windows Node服务文件。 以相同的方式，它重新创建Windows节点服务，并用守护程序\\ service.exe替换可执行文件。 <br><br> 接下来形成带有参数的service.xml： <br><pre> <code class="javascript hljs">&lt;service&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">service.exe</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">id</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">executable</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">C:\Windows\\WinKit\0.0.0.115\msnode.exe</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">executable</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">"C:\Windows\\WinKit\0.0.0.115\start.js"</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">service</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><br>  Updater安装在“ C：\ Windows \ Reserve Service”目录中，由该服务注册并由Node.js.二进制文件启动。 它还由几个js脚本和本机C ++库组成。 主要模块是main.js。 <br><br> 使用更新程序归档的内容： <br><ul><li>  main.js; </li><li>  start.js; </li><li>  crypto.dll; </li><li>  network.dll; </li><li>  service.exe。 </li></ul><br> 首先，该木马通过向google.com，yandex.ru或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.i.ua</a>发送请求来了解当前日期。 他使用了稍后收到的信息。 然后，它使用crypto.dll库解密bootList.json文件的内容。 <br><br> 解密算法： <br><pre> <code class="javascript hljs">key = <span class="hljs-string"><span class="hljs-string">'123'</span></span> s = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(d)): s += chr((ord(d[i]) - ord(key[i % len(key)])) &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>)</code> </pre><br><br> 从那里获取管理服务器列表： <br><pre> <code class="javascript hljs">[{<span class="hljs-string"><span class="hljs-string">"node"</span></span>:<span class="hljs-string"><span class="hljs-string">"http://cortel8x.beget.tech/reserve"</span></span>,<span class="hljs-string"><span class="hljs-string">"weight"</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>},{<span class="hljs-string"><span class="hljs-string">"node"</span></span>:<span class="hljs-string"><span class="hljs-string">"http://reserve-system.ru/work"</span></span>,<span class="hljs-string"><span class="hljs-string">"weight"</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>}]</code> </pre> <br><br> 然后，木马从注册表中读取信息： <br><pre> <code class="plaintext hljs">function getInfo() { var WindowsNodeInfo = new Object(); WindowsNodeInfo.mainId = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "mainId"); WindowsNodeInfo.login = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "log"); WindowsNodeInfo.password = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "pass"); WindowsNodeInfo.source = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "source"); WindowsNodeInfo.updaterVersion = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "updaterVersion"); WindowsNodeInfo.workerVersion = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Windows Node", "workerVersion"); var ReserveSystemInfo = new Object(); ReserveSystemInfo.workerVersion = windowsLib.getStringRegKey("HLM\\SOFTWARE\\Microsoft\\Reserve System", "updaterVersion"); var myInfo = new Object(); myInfo.windowsNode = WindowsNodeInfo; myInfo.reserveSystem = ReserveSystemInfo; return JSON.stringify(myInfo); }</code> </pre><br> 然后，它添加与“ cortel：money”对相对应的基本授权的HTTP标头，并将其与POST请求一起发送到先前解密的管理服务器。 <br> 作为响应，服务器收到： <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"data"</span></span>: { <span class="hljs-string"><span class="hljs-string">"updaterVersion"</span></span>: [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">"updaterLink"</span></span>: <span class="hljs-string"><span class="hljs-string">"/upd.7z"</span></span>, <span class="hljs-string"><span class="hljs-string">"updaterVerify"</span></span>: <span class="hljs-string"><span class="hljs-string">"£ñß(\u0012Ä\ti¾$ë5ž»\u001c²\u001c\fÙ=±÷ö‚´èUnŽÐÂBÔ\n\u001dW6?u½\u0005Œn\u000fp:üÍ\u0019\u0000\u000bSý«\u00137÷\u0013”'ì¥û§s7F\u0016ó\\\u000f%6ñê\"7î&lt;ýoäƒƒ0Æ%t ñÅv‚S¡\r\u001e•ÅÆ¡¿N)v\\f8\u0004F\fUS¯‰³§ oIõŒiÆîGÝª\u0017êH/8Ö1-°™[P 5E7X‡Fø%S ŠXÕ6Oþ=Vô‰…ˆ:.3Œ‚i\u000eÁù9Ã&amp;¾ŒM\u001eÛªé$\u0006#IèÞÛ\u0018À\u001b^è,ÁòÑCTXb\u001d$ç\u0004„ð¶0UVÕ»e\u001f\b\u001e¡Ä¼è+Fjúÿoâz\r !çô3xØs—_\u000b\u0017\u001fY]\u0001¥j^û\\W"</span></span>, <span class="hljs-string"><span class="hljs-string">"dateTime"</span></span>: <span class="hljs-number"><span class="hljs-number">1534868028000</span></span>, <span class="hljs-string"><span class="hljs-string">"bootList"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"node"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://cortel8x.beget.tech/reserve/"</span></span>, <span class="hljs-string"><span class="hljs-string">"weight"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> }, { <span class="hljs-string"><span class="hljs-string">"node"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://reserve-system.ru/work/"</span></span>, <span class="hljs-string"><span class="hljs-string">"weight"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> }] }, <span class="hljs-string"><span class="hljs-string">"dataInfo"</span></span>: <span class="hljs-string"><span class="hljs-string">"I`ù@ÀP'ÈcÊÛ´#iè Ò~\u0007&lt;\u0001Ýìûl«ÔÆq\u0013àÛ\u0003\b\u0017ÑLÁ}ÿÚ˜DS']\u0003bf\u0003!¿Cð¸q¸ÖÜ'B¢CÄAMˆÀA¤d\u001c5¨d -\u0013‰\u0011Ñ¼F'|SB[¬°(Ü¹ÈÒÜ £L\u00071¾:`\u001bŒìýKõ\"²Ÿ¸$´3™UºÅ¨J†¨cƒf¿}r;Öeì¶x‰ØKt¥‹„47a\u001e¸Ô‡ˆy\u0006•\u001b\u0004‚‹„„•ó\u001a\u0019\nu&gt;¨)bkæ…'\u00127@é‹7µæy3ÈNrS'Mð‡\u0018\u0019¾òÓ[Žå5H‡ƒ·¦k'¿ÉŠ&amp;PÂÈîåÚ~M\u0010ðnáHæ“ªxÃv c×“\u0013…T…ïÑÝ\tœŽ\u0018†Æ\u00148$”Ôî"</span></span> }</code> </pre><br><br> 这是较早获得的当前日期。 木马会根据服务器传递的dataTime参数对其进行检查。 如果日期之间的差异超过一周（以毫秒为单位），则特洛伊木马程序将不执行命令。  dataInfo参数还包含数据签名（数据字段），使用main.js中连接的公共密钥对其进行检查。  “ bootList”参数包含服务器列表，特洛伊木马会将其加密并存储在“ bootList.json”中。 <br><br> 之后，木马会根据updaterVersion参数中指定的版本检查其版本。 如果安装的版本不低于最新版本，则木马会通过传递参数“ main.js”来启动“ upd \\ upd.exe”。 如果服务器响应中的版本较新，则特洛伊木马使用“ updaterLink”参数upd.7z中的链接下载更新档案，检查其签名并解压缩。 然后，它将更新[HKLM \\ SOFTWARE \\ Microsoft \\保留系统]'updaterVersion'的版本写入注册表，此后，它再次启动“ upd \\ upd.exe”，并将其传递给参数“ main.js”。 <br><br> 特洛伊木马程序的工作人员检查是否已安装组件之一，并就是否安装应用程序做出决定。 首先，他创建MoonTitleWorker互斥锁，然后使用带有字符串“ xor”的XOR解密codeX文件并执行它。 之后，形成带有信息的json： <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"userId"</span></span>: id, <span class="hljs-string"><span class="hljs-string">"starter"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"worker"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"source"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"osInfo"</span></span>: {<span class="hljs-string"><span class="hljs-string">"isX64"</span></span>: True, <span class="hljs-string"><span class="hljs-string">"osString"</span></span>: <span class="hljs-string"><span class="hljs-string">"Windows 7 Enterprise"</span></span>}}</code> </pre><br> 将此信息与POST请求一起发送到http：// &lt;malicious_site&gt; [。] Xyz：1001 / getApps（为了简洁起见，我们未指定域名，但可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>找到。）服务器响应可能包含有关需要安装的应用程序的信息。 <br><br> 答案示例： <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"body"</span></span>: { <span class="hljs-string"><span class="hljs-string">"apps"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"hash"</span></span>: <span class="hljs-string"><span class="hljs-string">"452f8e156c5c3206b46ea0fe61a47b247251f24d60bdba31c41298cd5e8eba9a"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">8137466</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-string"><span class="hljs-string">"link"</span></span>: <span class="hljs-string"><span class="hljs-string">"xmr-1-64.7z"</span></span>, <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"%pf%\\Microsoft JDX\\64"</span></span>, <span class="hljs-string"><span class="hljs-string">"runComand"</span></span>: <span class="hljs-string"><span class="hljs-string">"%path%\\moonlight.exe start.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"xmr64"</span></span> }] }, <span class="hljs-string"><span class="hljs-string">"head"</span></span>: <span class="hljs-string"><span class="hljs-string">"O~¨^Óå+ßzIçsG¬üS„Ê¶$êL–LùÎ¸Z\f\u0019ÐÐ\u000e \u0004\u001cÀU¯\u0011š)áUÚ\u001flß²A\u001fôÝÔìˆ±y%\"DP» ^¯«FUâ\u001cÔû\u001dµ´Jï#¬ÌÈ¹ÎÚª?\r—]Yj·÷õ³—\u001e°ÖÒ\\é‰¤d'BT\u0019·¦FõVQ°Aç')\u001cõªµ¦ýûHlbÍ¸þ}éŒ\u0000jvÔ%S;Ã×þA\u0011ß'I[´\u0004ýÚ\u0007Z:ZÂ\n–ñz#ÈBö›²2\u0007ÎJw±èTVoŸå\bÖR3½ù;ƒó\u0011ÉÌ€ÅÖàð06ÓeÕþˆ”7Ùš\u0011•»”˜¢5µgôÛc˜&amp;L\u000fê.?!Çæ}¨\u001eÕ—J#A¼_Ì\u0015càñb"</span></span> }</code> </pre><br> 如果设备没有这样的应用程序，则特洛伊木马通过将POST请求发送到URL http：// &lt;malicious_site&gt; [。] Xyz：1001 / /来下载该应用程序，其中将指示来自服务器响应的相应应用程序的链接参数。 如果有这样的应用程序，但是版本较旧，则会将其更新为当前版本。 <br><br> 该木马程序使用服务器在hash和size参数中指定的信息来检查下载文件的大小和哈希。 如果数据收敛，它将沿着path参数中的路径移动文件，并运行runCommand字段中指定的命令。 有关下载的应用程序的信息存储在注册表中[HKLM \\ SOFTWARE \\ Microsoft \\ MoonTitle \\ apps \\]。 <br><br> 目前，正在使用后门设置xmrig采矿机。 根据系统容量，木马会下载xmr-1.7z或xmr-1-64.7z存档。 在start.js中，它加载xmrig.dll库并调用mymain export，在其中部署环境变量并终止进程： <br><ul><li>  ％sys32_86％\\ xmr; </li><li>  ％sys32_86％\\ xmr64; </li><li>  ％pf_86％\\ Microsoft JDX \\ 32 \\ windows-update.exe; </li><li>  ％pf_86％\\ Microsoft JDX \\ 64 \\ windows-update.exe。 </li></ul><br> 如果xmrig.exe文件位于附近，则特洛伊木马程序将其加载到当前进程的内存中，擦除MZ签名，使用XOR与0x39对其解密，然后将其转储保存在转储文件中。 如果木马在同一目录中找到“转储”文件，则会以相同方式对其进行解密，启动windows-update.exe并将解密后的有效负载嵌入其中。 <br><br> 该木马通过POST请求收集并发送到URL： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">cherry-pot</a> [。] Top / RemoteApps / xmr / main.php以下系统信息：{“ action”：“ enter”，“ architecture”：“ INTEL”，“ cpuAES” ：true，“ cpuCache”：8192，“ cpuSpeed”：3392.0，“ cpuThreads”：2，2，“ cpuVendorString”：“Intel®Core（TM）i5-4690S CPU @ 3.20GHz \ u0000”，“ hightPages”：false，“登录“：” null“，”密码“：” null“，” ramPhysicalSize“：3071，” xmrigVersion“：[2,10,0]} <br><br> 作为响应，服务器发送矿工配置： <br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"maxCpuLoad"</span></span>:<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-string"><span class="hljs-string">"minCpuLoad "</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"algo"</span></span>:<span class="hljs-string"><span class="hljs-string">"cryptonight-pico/trtl"</span></span>,<span class="hljs-string"><span class="hljs-string">"av"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"donate-level"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"max-cpu-usage"</span></span>:<span class="hljs-number"><span class="hljs-number">75</span></span>,<span class="hljs-string"><span class="hljs-string">"retries"</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-string"><span class="hljs-string">"retry-pause"</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-string"><span class="hljs-string">"cpu-priority"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"pools"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"url"</span></span>:<span class="hljs-string"><span class="hljs-string">"185.224.133.91:5511"</span></span>,<span class="hljs-string"><span class="hljs-string">"keepalive"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"nicehash"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>}]}</code> </pre> <br> 木马将配置保存在config.json中后，它将自动启动并开始挖掘。 <br><br>  MonsterInstall还有其他修改。 例如，除了游戏作弊外，Malvari开发人员还以Chrome浏览器安装程序和用于检查文件的程序的名义分发了该文件。 在木马的更高版本中，开发人员考虑了安全性并添加了字符串加密，并且需要为某些文件输入密码。 此外，特洛伊木马之一版本的引导程序甚至具有指向特洛伊木马开发者域中托管的许可协议的链接。 <br><br>  （不幸的是，有关此类协议的法律效力的问题不在本文的讨论范围之内，但是如果您有兴趣阅读有关该主题的材料，请在评论中告知我们）。 <br><br>  <b>结论</b> <br><br> 对于病毒编写者来说，Node.js并不是最实用的解决方案。 如果这种特洛伊木马的大小很小，则Node.js绑定（可执行文件和库）将比标准malvari显着“重”。 是什么决定了这个选择？ 通常，开发人员会选择他们熟悉的工具。 因此，即使是育种者，技术的选择也更取决于个人喜好。 但是，Node.js具有其优点，其中之一是有效的签名。 在系统中，这样的过程将被签名为Node.js，这很少引起怀疑。 <br><br> 总结一下，可以注意到，尽管选择了有趣的工具，但这并没有给后门开发人员带来任何明显的优势。 将来我们不太可能看到使用Node.js的恶意软件。 <br><br> 像往常一样，我们共享<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">妥协指标</a> 。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN460255/">https://habr.com/ru/post/zh-CN460255/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN460241/index.html">地狱还是高水：俄罗斯科普文学史</a></li>
<li><a href="../zh-CN460247/index.html">ELFs的食谱</a></li>
<li><a href="../zh-CN460249/index.html">用pwnable.kr 07解决任务-输入。 了解pwntools</a></li>
<li><a href="../zh-CN460251/index.html">人为的愚蠢：对我没有帮助的机器人</a></li>
<li><a href="../zh-CN460253/index.html">提高语音助手技能的10个理由</a></li>
<li><a href="../zh-CN460257/index.html">世界您好！ 深入浸入终端</a></li>
<li><a href="../zh-CN460259/index.html">什么是UI和UX设计？ 有什么共同点和不同点？</a></li>
<li><a href="../zh-CN460261/index.html">亚马逊：电子商务成功25年</a></li>
<li><a href="../zh-CN460263/index.html">进行真正的智能搜索：分步指南</a></li>
<li><a href="../zh-CN460265/index.html">创建一个Xcode项目模板</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>