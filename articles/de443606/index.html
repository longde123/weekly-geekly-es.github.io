<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòõ üë¢ üìè Jenkins f√ºr Android Build mit Docker üçÇ üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üñ®Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 

 Ich arbeite als Android-Entwickler und vor nicht allzu langer Zeit sind wir auf einige Routineaufgaben in unserem Projekt gesto√üe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jenkins f√ºr Android Build mit Docker</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443606/">  Hallo allerseits! <br><br>  Ich arbeite als Android-Entwickler und vor nicht allzu langer Zeit sind wir auf einige Routineaufgaben in unserem Projekt gesto√üen, die wir automatisieren m√∂chten.  Zum Beispiel haben wir 5 verschiedene Geschmacksrichtungen, f√ºr die wir jeweils unseren Build auf Stoff hochladen m√ºssen, manchmal f√ºr verschiedene Wagen mehrmals am Tag.  Ja, diese Aufgabe kann auch mit der Gradle-Aufgabe ausgef√ºhrt werden, aber ich m√∂chte diesen Prozess nicht auf dem Computer des Entwicklers starten, sondern irgendwie zentral ausf√ºhren.  Oder laden Sie beispielsweise den Build in Google Play automatisch in die Beta hoch.  Nun, ich wollte nur das CI-System ausw√§hlen.  Was daraus wurde und wie wir es eingerichtet haben, warum gibt es Docker sp√§ter in diesem Artikel. <br><br><img src="https://habrastorage.org/webt/at/pi/_v/atpi_veqcyb-lryxth_ia4m0uag.png"><br><a name="habracut"></a><br>  Nach meinem Verst√§ndnis war die gesamte Aufgabe in ungef√§hr zwei Phasen unterteilt: <br><br><ol><li>  Installieren und konfigurieren Sie Jenkins selbst mit dem Android SDK </li><li>  Richten Sie Aufgaben bereits in Jenkins ein </li></ol><br>  In diesem Artikel m√∂chte ich auf den ersten Punkt eingehen. Wenn es f√ºr jemanden interessant sein wird, werde ich im n√§chsten Artikel den Prozess des Einrichtens von Montageaufgaben in Jenkins selbst beschreiben. <br><br><h2>  Der erste Punkt ist also die Installation und Konfiguration des Jenkins-Systems </h2><br>  <i>Habr√© hat bereits einen wunderbaren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> zu diesem Thema, aber sie ist bereits ein paar Jahre alt, und einige Dinge darin sind etwas veraltet (zum Beispiel sdkmanager), obwohl sie mir sehr geholfen hat, herauszufinden, was ich in der Anfangsphase tun soll.</i> <br><br>  Wenn Sie sich die offizielle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> zur Installation von Jenkins ansehen, sehen Sie drei verschiedene M√∂glichkeiten, um dies zu tun: Starten Sie ein vorgefertigtes Docker-Image, laden Sie eine War-Datei herunter und f√ºhren Sie sie aus.  Die erste Option ist die richtigste, da sie keine unn√∂tigen Einstellungen und Abh√§ngigkeiten zu unserem Hostsystem enth√§lt. Selbst wenn etwas schief geht, ist es jederzeit einfach, alles zu l√∂schen und erneut zu starten.  Das Standard-Docker-Image f√ºr Jenkins enth√§lt jedoch einige der Daten, die wir nicht ben√∂tigen (z. B. das Blueocean-Plugin), und nicht das, was wir definitiv ben√∂tigen (z. B. Android SDK).  Es wurde beschlossen, ein eigenes Docker-Image zu erstellen, in dem die War-Datei heruntergeladen und ausgef√ºhrt, Android SDK heruntergeladen und installiert sowie alle anderen erforderlichen Einstellungen konfiguriert werden.  Um es sp√§ter zu starten, ben√∂tigen wir ein Hostsystem mit installiertem Docker.  Ich schlage hier vor, das Rad nicht neu zu erfinden und DigitalOcean zu verwenden. <br><br><h4>  Erstellen und konfigurieren Sie eine virtuelle Maschine </h4><br>  Wenn jemand anderes dort nicht registriert ist, schlage ich zun√§chst vor, sich zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">registrieren</a> (hier gab es zum Zeitpunkt des Schreibens des Artikels einen Empfehlungslink, aber nachdem ich die Regeln gelesen hatte, habe ich ihn verworfen).  Nach der Registrierung k√∂nnen Sie den einen oder anderen Aktionscode im Internet googeln und erhalten ungef√§hr 10 Dollar f√ºr den Start. <br><br>  Nachdem wir ein neues Tr√∂pfchen bekommen m√ºssen.  W√§hlen Sie den Punkt Droplets und dann <b>Create Droplet</b> . <br><br><img src="https://habrastorage.org/webt/gx/5m/th/gx5mthmcjzw-okm6ktxpfekimn8.png" alt="Bild"><br><br>  Das Hostsystem ist Ubuntu 18.04.  Sie k√∂nnen ein Image ausw√§hlen, bei dem Docker bereits installiert und konfiguriert ist, aber wir werden alles selbst erledigen.  Da die Zusammenstellung von Android-Builds immer noch ressourcenintensiv ist, m√ºssen wir eine Konfiguration f√ºr mindestens 20 Dollar ausw√§hlen, damit die Builds normal und relativ schnell erfasst werden. <br><br><img src="https://habrastorage.org/webt/1e/y_/z1/1ey_z1uyjffbqocqz6i4ef8ium8.png" alt="Bild"><br><br>  Wir w√§hlen einen n√§heren Ort (zum Beispiel in Deutschland).  Dann gibt es zwei M√∂glichkeiten, wie wir uns mit unserem virtuellen Server verbinden.  Wir k√∂nnen einen SSH-Schl√ºssel hinzuf√ºgen oder darauf verzichten.  Wenn wir an dieser Stelle nicht angeben, welcher Schl√ºssel verwendet werden soll, wird das Kennwort f√ºr den Root-Benutzer an unsere E-Mail gesendet. <br><br><img src="https://habrastorage.org/webt/eg/qd/hu/egqdhuamgiddwijvsfidcxu7ieq.png" alt="Bild"><br><br>  Hier k√∂nnen wir den Servernamen √§ndern und die Erstellung abschlie√üen, indem wir auf die Schaltfl√§che Erstellen klicken. <br><br><img src="https://habrastorage.org/webt/ad/mw/6w/admw6wwv2zyontaxpzx-fgp-rfg.png" alt="Bild"><br><br>  Jetzt gehen wir in das erstellte Droplet und kopieren die IP-Adresse f√ºr uns selbst, um die Verbindung und Konfiguration fortzusetzen. <br><br><img src="https://habrastorage.org/webt/q7/th/yv/q7thyvgm-hppvgrured6dogeqva.png" alt="Bild"><br><br>  Wir brauchen einen SSH-Client.  Wenn Sie unter einer Mohnblume arbeiten, k√∂nnen Sie das Standardterminal verwenden. Wenn Sie unter Windows arbeiten, k√∂nnen Sie mit Putty <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">arbeiten</a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das Linux-Subsystem verwenden</a> (nur f√ºr Windows 10).  Ich pers√∂nlich benutze die letztere Option und sie passt perfekt zu mir. <br><br>  Stellen Sie mit dem folgenden Befehl eine Verbindung zu unserem Server her <br><br><pre> <code class="bash hljs">ssh root@YOUR_IP_ADDRESS</code> </pre> <br>  Die Konsole bietet Ihnen die M√∂glichkeit, den Schl√ºssel zu speichern. Wir sind damit einverstanden.  Nach dem Verbinden erstellen wir einen neuen Benutzer f√ºr uns selbst, f√ºgen ihn den Superusern hinzu (und geben ihm die M√∂glichkeit, sudo ohne Passwort zu verwenden), kopieren ihm den Schl√ºssel f√ºr den Zugriff √ºber ssh und sagen, dass er der Eigent√ºmer dieser Dateien ist (andernfalls funktioniert es nicht).  Der <b>Benutzername wird</b> in einen f√ºr Sie geeigneten Namen ge√§ndert. <br><br><pre> <code class="bash hljs">useradd -m -s /bin/bash username \ &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'username ALL=(ALL) NOPASSWD:ALL'</span></span> &gt;&gt; /etc/sudoers \ &amp;&amp; mkdir /home/username/.ssh \ &amp;&amp; cp /root/.ssh/authorized_keys /home/username/.ssh/authorized_keys \ &amp;&amp; chown username:username -R /home/username/.ssh</code> </pre><br>  Trennen Sie die Verbindung mit dem Befehl von root <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br>  Und wir werden uns bereits mit Hilfe des neu erstellten Benutzers wieder verbinden <br><br><pre> <code class="bash hljs">ssh username@YOUR_IP_ADDRESS</code> </pre> <br>  Nachdem wir das System aktualisiert und unseren Server neu gestartet haben (wenn Sie w√§hrend des Aktualisierungsvorgangs vom System gefragt werden, reicht es in diesem Fall aus, immer die Standardwerte auszuw√§hlen). <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt full-upgrade -y &amp;&amp; sudo apt autoremove -y &amp;&amp; sudo reboot</code> </pre> <br>  Die Grundeinstellung ist abgeschlossen.  Aus Sicht des Kampfsystems ist es nicht sehr sicher, aber im Rahmen dieses Artikels ist es v√∂llig geeignet. <br><br><h4>  Installieren Sie Docker. </h4><br>  Um Docker in unserem System zu installieren, verwenden wir die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offizielle Dokumentation</a> .  Da wir ein neu installiertes System haben, √ºberspringen wir diesen Punkt. Wenn Sie ein System haben, auf dem schon lange etwas l√§uft, l√∂schen Sie auf Empfehlung der Mitarbeiter von Docker m√∂gliche alte Versionen <br><br><pre> <code class="bash hljs">sudo apt-get remove docker docker-engine docker.io containerd runc</code> </pre> <br>  Vergessen Sie nicht, zuerst √ºber ssh eine Verbindung zu unserem Server herzustellen.  Die Installation von Docker selbst wird in der Dokumentation ausf√ºhrlich beschrieben. Ich werde allgemeine Befehle geben, um es Ihnen einfacher zu machen.  Was sie tun, kann dort gelesen werden.  F√ºgen Sie zuerst das Repository hinzu. <br><br><pre> <code class="bash hljs">sudo apt update \ &amp;&amp; sudo apt install -y apt-transport-https ca-certificates \ curl gnupg-agent software-properties-common \ &amp;&amp; curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - \ &amp;&amp; sudo apt-key fingerprint 0EBFCD88 \ &amp;&amp; sudo add-apt-repository <span class="hljs-string"><span class="hljs-string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(lsb_release -cs)</span></span></span><span class="hljs-string"> stable"</span></span></code> </pre> <br>  Und dann installieren Sie Docker selbst: <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt install -y docker-ce docker-ce-cli containerd.io</code> </pre> <br>  Damit wir in Zukunft Docker-Befehle ohne das Pr√§fix sudo aufrufen k√∂nnen, f√ºhren Sie den folgenden Befehl aus (der auch in den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anweisungen</a> sorgf√§ltig beschrieben wird). <br><br><pre> <code class="bash hljs">sudo usermod -aG docker username</code> </pre> <br>  Danach m√ºssen Sie sich erneut anmelden (mit dem Befehl exit und erneut eine Verbindung zum Server herstellen), damit dies funktioniert. <br><br>  Docker selbst ist installiert, was wir mit dem Befehl √ºberpr√ºfen k√∂nnen <br><br><pre> <code class="bash hljs">docker run hello-world</code> </pre> <br>  Sie l√§dt das Testbild herunter und f√ºhrt es im Container aus.  Der Container druckt nach dem Start eine Informationsnachricht und wird beendet. <br><br>  Herzlichen Gl√ºckwunsch, wir haben die Phase der Vorbereitung des Servers f√ºr die Arbeit abgeschlossen! <br><br><h4>  Erstellen Ihres Docker-Images </h4><br>  Wir erstellen das Docker-Image, indem wir unsere eigene Docker-Datei schreiben.  Beispiele, wie man dies im Internet richtig macht, ein Wagen und ein kleiner Wagen, ich werde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">meine</a> fertige Version zeigen und ich werde versuchen, sie so oft wie m√∂glich zu kommentieren.  Es gibt auch eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bedienungsanleitung</a> von Docker selbst mit Beispielen zur korrekten und kanonischen Schreibweise von Docker-Datei. <br><br>  Erstellen Sie Ihre Docker-Datei und √∂ffnen Sie sie zur Bearbeitung <br><br><pre> <code class="bash hljs">touch Dockerfile &amp;&amp; nano Dockerfile</code> </pre> <br>  Darin werden wir beispielsweise den Inhalt meiner Docker-Datei ablegen <br><br><div class="spoiler">  <b class="spoiler_title">Meine gesamte Docker-Datei mit Kommentaren</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    . FROM ubuntu:18.04 #      LABEL author="osipovaleks" LABEL maintainer="osipov.aleks.kr@gmail.com" LABEL version="1.0" LABEL description="Docker image for Jenkins with Android SDK" #  ,  Jenkins    ENV TZ=Europe/Kiev RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone # i386    ia32-libs RUN dpkg --add-architecture i386 #      RUN apt-get update &amp;&amp; apt-get install -y git \ wget \ unzip \ sudo \ tzdata \ locales\ openjdk-8-jdk \ libncurses5:i386 \ libstdc++6:i386 \ zlib1g:i386 #  ,       RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists /var/cache/apt #  RUN locale-gen en_US.UTF-8 ENV LANG en_US.UTF-8 ENV LANGUAGE en_US:en ENV LC_ALL en_US.UTF-8 #   Android Sdk     ARG android_home_dir=/var/lib/android-sdk/ ARG sdk_tools_zip_file=sdk-tools-linux-4333796.zip RUN mkdir $android_home_dir RUN wget https://dl.google.com/android/repository/$sdk_tools_zip_file -P $android_home_dir -nv RUN unzip $android_home_dir$sdk_tools_zip_file -d $android_home_dir RUN rm $android_home_dir$sdk_tools_zip_file &amp;&amp; chmod 777 -R $android_home_dir # environment    ENV ANDROID_HOME=$android_home_dir ENV PATH="${PATH}:$android_home_dir/tools/bin:$android_home_dir/platform-tools" ENV JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/ #   Android SDK RUN yes | sdkmanager --licenses #    Jenkins ENV JENKINS_HOME=/var/lib/jenkins RUN mkdir $JENKINS_HOME &amp;&amp; chmod 777 $JENKINS_HOME #     jenkins,   ,         RUN useradd -m jenkins &amp;&amp; echo 'jenkins ALL=(ALL) NOPASSWD:ALL' &gt;&gt; /etc/sudoers USER jenkins WORKDIR /home/jenkins #   war     Jenkins RUN wget http://mirrors.jenkins.io/war-stable/latest/jenkins.war -nv CMD java -jar jenkins.war #      EXPOSE 8080/tcp</span></span></code> </pre><br></div></div><br>  Einige Klarstellungen: <br><br><ul><li>  Am Anfang bestand der Wunsch, anstelle von Ubuntu ein leichteres Alpin zu verwenden, das jedoch keine Unterst√ºtzung f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ia32-libs</a> bietet, die f√ºr die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erstellung von</a> Projekten mit dem Android SDK erforderlich ist. </li><li>  Wir installieren openjdk-8-jdk, nicht das leichtere openjdk-8-jdk-headless, da einige Jenkins-Funktionen ein komplettes System ben√∂tigen (z. B. Anzeigen von Unit-Testergebnissen). </li><li>  Es ist notwendig, Gebietsschemas zu installieren, da bei einigen Projekten ohne diese die Gradle-Assembly ohne eindeutige Fehler und Protokolle abst√ºrzt und ich mehrere Tage damit verbracht habe, diesem Grund auf den Grund zu gehen (auf regul√§ren Ubuntu, die nicht im Docker enthalten sind, sind alle Gebietsschemas standardm√§√üig gef√ºllt). . </li><li>  Wir m√ºssen sofort alle Lizenzen f√ºr das Android SDK akzeptieren, damit Jenkins w√§hrend des Erstellungsprozesses die ben√∂tigten Komponenten unabh√§ngig installieren kann (z. B. die SDKs, die f√ºr verschiedene Versionen der API ben√∂tigt werden).  Falls erforderlich, k√∂nnen Sie das SDK in Zukunft im Docker-Container mit sdkmanager verwalten. Mit sdkmanager <code>sdkmanager --list</code> k√∂nnen <code>sdkmanager --list</code> beispielsweise alle verf√ºgbaren und alle installierten Komponenten <code>sdkmanager --install "platforms;android-26"</code> , und <code>sdkmanager --install "platforms;android-26"</code> installiert das SDK f√ºr Version 26 der API. </li><li>  Im Allgemeinen war es m√∂glich, die Benutzer-Jenkins nicht zu starten und beim Root-Benutzer zu bleiben, aber irgendwie ist es nicht ganz richtig, Sie konnten ihm auch keine Superuser-Rechte geben, aber dies wurde aus praktischen Gr√ºnden durchgef√ºhrt, wenn etwas installiert werden muss in der Setup- und Debug-Phase. </li><li>  Die Grundgr√∂√üe des Bildes erwies sich als ziemlich gro√ü (fast 800 MB), aber insgesamt kam ich zu dem Schluss, dass dies f√ºr mich nicht sehr kritisch ist und es f√ºr mich einfacher ist, es in dieser Form herunterzuladen, als Zeit damit zu verbringen, nicht ben√∂tigte Pakete zu suchen und zu entfernen. </li></ul><br>  Nach dem Schreiben von Dockerfile m√ºssen wir daraus ein fertiges Image f√ºr Docker machen, auf dessen Grundlage Container erstellt werden.  Dies geschieht einfach durch ein Team <br><br><pre> <code class="bash hljs">docker build -t jenkins-image</code> </pre> <br>  Dabei ist der Parameter <code>-t jenkins-image</code> f√ºr den Namen Ihres Bildes verantwortlich, und der Punkt am Ende des Befehls gibt an, dass Sie in diesem Verzeichnis nach der Docker-Datei f√ºr die Assembly suchen m√ºssen.  Der Montageprozess selbst dauert einige Zeit, und nach der Montage sollte sich so etwas in der Konsole befinden. <br><blockquote>  9fd8f5545c27 erfolgreich gebaut <br>  Erfolgreich getaggt jenkins-image: aktuell </blockquote>  Dies zeigt uns, dass unser Image erfolgreich zusammengestellt wurde und wir mit dem n√§chsten Schritt fortfahren k√∂nnen, n√§mlich dem Start unseres Containers <br><br><h4>  Docker Hub und fertige Bilder </h4><br>  Ja, nat√ºrlich k√∂nnen wir unser fertiges Image zum Starten des Containers verwenden. Wenn wir dies jedoch auf mehr als mehreren Ger√§ten tun m√ºssen, ist es nicht sehr praktisch, jedes Mal eine Docker-Datei zu erstellen und daraus ein fertiges Image zu erstellen.  Und wenn wir auch den Inhalt unserer Docker-Datei aktualisieren, ist es √ºberhaupt nicht bequem, die √Ñnderungen auf alle Knoten zu √ºbertragen.  Zu diesem Zweck gibt es ein √∂ffentliches Repository f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Docker Hub-</a> Images.  Sie k√∂nnen nicht jedes Mal ein Bild auf jedem Knoten erfassen, sondern es einfach aus dem √∂ffentlichen Repository in sich selbst herunterladen und auf allen Computern gleicherma√üen verwenden.  Das Bild, das als Beispiel f√ºr diesen Artikel diente, ist beispielsweise im Repository mit dem Namen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">osipovaleks / docker-jenkins-android</a> verf√ºgbar. Sp√§ter in diesem Artikel werden wir damit arbeiten. <br><br>  Dieser Artikel impliziert keine detaillierte Untersuchung des Docker Hub. Wir werden nicht verstehen, wie wir unsere Bilder dort hochladen (obwohl dies nicht sehr schwierig ist) und was mit ihnen dort gemacht werden kann. Wir werden nicht verstehen, dass es m√∂glicherweise noch Ihre eigenen √∂ffentlichen oder privaten Repositories gibt. Dabei kann bei Bedarf alles unabh√§ngig aussortiert werden. <br><br><h4>  Containerstart </h4><br>  Es gibt zwei M√∂glichkeiten, einen Container zu starten. <br><br><ol><li>  Der erste Weg, einfach mit dem <code>docker run</code> , erm√∂glicht es Ihnen, dies einfach und schnell auf folgende Weise zu tun <br><br><pre> <code class="bash hljs">docker run --name jenkins -d -it -v jenkins-data:/var/lib/jenkins -v jenkins-home:/home/jenkins -p 8080:8080 --restart unless-stopped osipovaleks/docker-jenkins-android</code> </pre> <br>  Dabei hat der Befehl <code>run</code> die folgenden Parameter <br><br><ul><li>  <code>--name jenkins</code> - Name des zuk√ºnftigen Containers </li><li>  <code>-d</code> - Container im Hintergrund starten </li><li>  <code>-it</code> - Flags f√ºr die Arbeit mit STDIN und tty </li><li>  <code>-v jenkins-data:/var/lib/jenkins</code> und <code>-v jenkins-home:/home/jenkins</code> - Erstellen (falls nicht erstellt) und Zuordnen spezieller Volumendateien zu den internen Abschnitten des Containers, damit wir unsere konfigurierten Jenkins auch nach der Rekonstruktion speichern k√∂nnen Beh√§lter </li><li>  <code>-p 8080:8080</code> - Ordnen Sie den Host-Port dem Container-Port zu, damit wir Zugriff auf die Weboberfl√§che haben (ja, dies ist der Port, den wir in der Docker-Datei angegeben haben). </li><li>  <code>--restart unless-stopped</code> - Die Option bestimmt die Autorun-Richtlinie f√ºr Container nach dem Neustart des Hosts (in diesem Fall Autostart, wenn der Container nicht manuell deaktiviert wurde). </li><li>  <code>osipovaleks/docker-jenkins-android</code> - Bild f√ºr die Bereitstellung. </li></ul><br>  Am Ausgang der Docker-Konsole sollten wir die ID des erstellten Containers abrufen und Informationen dar√ºber anzeigen, wie das Image in das System geladen wird (nat√ºrlich, falls es noch nicht geladen ist) <br><blockquote>  Bild 'osipovaleks / docker-jenkins-android: aktuell' kann lokal nicht gefunden werden <br>  sp√§testens: Ziehen von Osipovaleks / Docker-Jenkins-Android <br>  6cf436f81810: Fertig ziehen <br>  987088a85b96: Fertig ziehen <br>  b4624b3efe06: Fertig ziehen <br>  d42beb8ded59: Fertig ziehen <br>  b3896048bb8c: Vollst√§ndig ziehen <br>  8eeace4c3d64: Fertig ziehen <br>  d9b74624442c: Vollst√§ndig ziehen <br>  36bb3b7da419: Vollst√§ndig ziehen <br>  31361bd508cb: Fertig ziehen <br>  cee49ae4c825: komplett ziehen <br>  868ddf54d4c1: Fertig ziehen <br>  361bd7573dd0: Vollst√§ndig ziehen <br>  bb7b15e36ae8: Vollst√§ndig ziehen <br>  97f19daace79: Vollst√§ndig ziehen <br>  1f5eb3850f3e: Fertig ziehen <br>  651e7bbedad2: Fertig ziehen <br>  a52705a2ded7: Fertig ziehen <br>  Digest: sha256: 321453e2f2142e433817cc9559443387e9f680bb091d6369bbcbc1e0201be1c5 <br>  Status: Neuere Bilder f√ºr osipovaleks / docker-jenkins-android heruntergeladen: neueste <br>  ef9e5512581da66d66103d9f6ea6ccd74e5bdb3776747441ce6a88a98a12b5a4 </blockquote></li><li>  Der zweite Weg besteht darin, eine spezielle Compose-Datei zu schreiben, in der der Befehl run einfach mit der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">YAML-</a> Sprache beschrieben und mit Docker Compose gestartet wird. <br><br>  Dazu m√ºssen wir es installieren: <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt install -y docker-compose</code> </pre> <br>  Erstellen Sie als N√§chstes ein Verzeichnis f√ºr das Projekt (dies ist wichtig, wenn Sie sich darum k√ºmmern, wie die automatisch erstellten Volumes f√ºr den Container aufgerufen werden) und wechseln Sie zu diesem Verzeichnis <br><br><pre> <code class="bash hljs">mkdir jenkinsProject &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> jenkinsProject</code> </pre> <br>  und im Inneren erstellen wir die Erstellungsdatei selbst und gehen in den Bearbeitungsmodus <br><br><pre> <code class="bash hljs">touch docker-compose.yml &amp;&amp; nano docker-compose.yml</code> </pre> <br>  und f√ºgen Sie den folgenden Inhalt ein <br><br><pre> <code class="markdown hljs">version: '3' services: jenkins: container_name: jenkins image: osipovaleks/docker-jenkins-android ports: - "8080:8080" restart: unless-stopped volumes: - "jenkins-data:/var/lib/jenkins" - "jenkins-home:/home/jenkins" volumes: jenkins-data: jenkins-home:</code> </pre> <br>  Darin wirft m√∂glicherweise nur die erste Zeile Fragen auf ( <code>version: '3'</code> ), die die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Version der Funktionen der</a> Erstellungsdatei angeben, sowie einen Abschnitt mit dem <code>volumes</code> Block, in dem die in diesem Container verwendeten aufgef√ºhrt sind <br><br>  F√ºhren Sie Ihren Container mit dem folgenden Befehl aus: <br><br><pre> <code class="bash hljs">docker-compose up -d</code> </pre> <br>  Dabei zeigt das Flag <code>-d</code> auch an, dass der Container im Hintergrund erstellt und gestartet wird.  Infolgedessen sollte Docker Folgendes anzeigen: <br><blockquote>  Erstellen des Volumes "jenkinsproject_jenkins-data" mit dem Standardtreiber <br>  Erstellen des Volumes "jenkinsproject_jenkins-home" mit dem Standardtreiber <br>  Jenkins ziehen (osipovaleks / docker-jenkins-android: aktuell) ... <br>  sp√§testens: Ziehen von Osipovaleks / Docker-Jenkins-Android <br>  6cf436f81810: Fertig ziehen <br>  987088a85b96: Fertig ziehen <br>  b4624b3efe06: Fertig ziehen <br>  d42beb8ded59: Fertig ziehen <br>  b3896048bb8c: Vollst√§ndig ziehen <br>  8eeace4c3d64: Fertig ziehen <br>  d9b74624442c: Vollst√§ndig ziehen <br>  36bb3b7da419: Vollst√§ndig ziehen <br>  31361bd508cb: Fertig ziehen <br>  cee49ae4c825: komplett ziehen <br>  868ddf54d4c1: Fertig ziehen <br>  361bd7573dd0: Vollst√§ndig ziehen <br>  bb7b15e36ae8: Vollst√§ndig ziehen <br>  97f19daace79: Vollst√§ndig ziehen <br>  1f5eb3850f3e: Fertig ziehen <br>  651e7bbedad2: Fertig ziehen <br>  a52705a2ded7: Fertig ziehen <br>  Digest: sha256: 321453e2f2142e433817cc9559443387e9f680bb091d6369bbcbc1e0201be1c5 <br>  Status: Neuere Bilder f√ºr osipovaleks / docker-jenkins-android heruntergeladen: neueste <br>  Jenkins erstellen ... <br>  Jenkins erstellen ... fertig </blockquote>  Denken Sie daran, ich sagte, dass der Name der erstellten Volumes vom Namen des Projekts abh√§ngt.  F√ºhren Sie den folgenden Befehl aus: <br><br><pre> <code class="bash hljs">docker volume ls</code> </pre> <br>  und wir bekommen eine solche Ausgabe <br><blockquote>  DRIVER VOLUME NAME <br>  lokale jenkinsproject_jenkins-Daten <br>  lokales jenkinsproject_jenkins-home </blockquote>  wo wir sehen werden, dass trotz der Tatsache, dass der Name f√ºr Volume von <code>jenkins-home</code> , in Wirklichkeit ein Pr√§fix aus dem Projektnamen daran <code><b>jenkinsproject _jenkins-home</b></code> und sich herausstellte, dass der Name volume <code><b>jenkinsproject</b> _jenkins-home</code> </li></ol><br><br>  Welche Startoption soll verwendet werden?  Hier k√∂nnen Sie selbst ausw√§hlen, dass Docker Compose eher ein Tool zum gleichzeitigen Starten mehrerer miteinander verbundener Container ist. Wenn Sie nur einen Container starten m√ºssen, k√∂nnen Sie den <code>docker run</code> . <br><br>  Nach diesen Unterschritten zum Starten und Konfigurieren des Servers sowie zum Starten des Containers mit Jenkins k√∂nnen wir nun mit der Erstkonfiguration fortfahren <br><br><h4>  Erstes Jenkins-Setup </h4><br>  Nehmen Sie die IP-Adresse unseres Servers, f√ºgen Sie den von uns angegebenen Port 8080 hinzu und folgen Sie diesem Link im Browser. <br><br> <code>http://YOUR_IP_ADDRESS:8080/</code> <br> <br>  Wenn vorher alles richtig konfiguriert und gestartet wurde, sehen wir hier das folgende Bild <br><br><img src="https://habrastorage.org/webt/za/a5/bi/zaa5bi-5vkvscc-ww7gd2ouxjte.png"><br><br>  F√ºr das erste Setup m√ºssen wir das Kennwort eingeben, das das System w√§hrend der Installation generiert hat.  Dazu m√ºssen wir uns nur den Inhalt der Datei <code>/var/lib/jenkins/secrets/initialAdminPassword</code> .  Diese Datei befindet sich jedoch in unserem laufenden Container. Um sie lesen zu k√∂nnen, m√ºssen wir mit dem folgenden Befehl eine Verbindung zum Container herstellen: <br><br><pre> <code class="bash hljs">docker <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> -it jenkins /bin/bash</code> </pre> <br>  <code>-it</code> Option <code>-it</code> der Ausf√ºhrung von <code>docker run</code> √§hnelt, ist <code>jenkins</code> der Name unseres Containers, und <code>/bin/bash</code> f√ºhrt <code>/bin/bash</code> f√ºr uns im Container aus und gew√§hrt ihm Zugriff.  Danach sehen wir das urspr√ºngliche Passwort f√ºr Jenkins: <br><br><pre> <code class="bash hljs">cat /var/lib/jenkins/secrets/initialAdminPassword</code> </pre> <br>  Folgendes wird in der Konsole angezeigt <br><blockquote>  91092b18d6ca4492a2759b1903241d2a </blockquote>  Dies ist das Passwort. <br><br>  <i>Benutzer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">ALexhha</a> schlug eine einfachere Option zum Lesen dieses Kennworts vor, ohne eine Verbindung zum Container selbst herzustellen.</i>  <i>Tatsache ist, dass zum Zeitpunkt des Starts von Jenkins selbst dieses Kennwort in den Protokollen angezeigt wird.</i>  <i>Es stellt sich heraus, dass wir nur die Containerprotokolle lesen m√ºssen.</i>  <i>In unserem Fall erfolgt dies mit dem folgenden Befehl:</i> <br><br><pre> <code class="bash hljs">docker logs jenkins</code> </pre> <br><br>  <i>Dabei ist</i> <code>jenkins</code> <i>Name unseres Containers. In den Protokollen sehen Sie Folgendes:</i> <br><br><blockquote>  ***************************************************** ** *********** <br>  ******************************************************** *********** <br>  ******************************************************** *********** <br><br>  Jenkins Ersteinrichtung ist erforderlich.  Ein Administrator wurde erstellt und ein Kennwort generiert. <br>  Bitte verwenden Sie das folgende Passwort, um mit der Installation fortzufahren: <br><br>  91092b18d6ca4492a2759b1903241d2a <br><br>  Dies kann auch gefunden werden unter: / var / lib / jenkins / Secrets / initialAdminPassword <br><br>  ***************************************************** ** *********** <br>  ******************************************************** *********** </blockquote><br>  ***************************************************** ** *********** <br><br>  <i>Diese Option ist etwas einfacher und schneller.</i> <br><br>  Kopieren Sie es, f√ºgen Sie es in das Feld <b>Administratorkennwort</b> in der Weboberfl√§che ein und klicken Sie auf <b>Weiter</b> .  <b>W√§hlen</b> Sie im n√§chsten Bildschirm <b>Ausgew√§hlte Plugins</b> installieren und installieren Sie eine Reihe von Standard-Plugins. <br><br><img src="https://habrastorage.org/webt/bs/9d/xs/bs9dxsxd6-cddmut2bww9utxjw4.png"><br><br><img src="https://habrastorage.org/webt/r5/-m/u-/r5-mu-bgyaqswxcqnyrpds0qhic.png"><br><br>  Erstellen Sie nach der Installation der Plugins einen Benutzer f√ºr uns und klicken Sie auf <b>Speichern und beenden</b> <br><br><img src="https://habrastorage.org/webt/iy/ap/jd/iyapjd__vdbys6jsjiinvzcp58q.png"><br><br>  Wir stimmen dem Abschnitt Instanzkonfiguration zu, in dem wir aufgefordert werden, die URL auszuf√ºllen, unter der Jenkins arbeiten wird (in unserem Fall lassen Sie alles so wie es ist). <br><br><img src="https://habrastorage.org/webt/4v/w1/ie/4vw1ieq0o_tm5bkrgn4sb-m__kk.png"><br><br>  Und klicken Sie im n√§chsten Bildschirm auf den gesch√§tzten <b>Start mit Jenkins</b> <br><br><img src="https://habrastorage.org/webt/4a/iw/yq/4aiwyqwkzbxjdkjwyzowxyvsktc.png"><br><br>  Also haben wir Jenkins installiert und gestartet! <br><br><img src="https://habrastorage.org/webt/9a/4z/tu/9a4ztunwk1gxuc8rsho2ql9-tou.png"><br><br>  Es ist bereits durchaus m√∂glich, damit zu arbeiten, aber um unsere Android-Builds zu sammeln, m√ºssen Sie einige weitere Punkte konfigurieren.  Die Lokalisierung von Jenkins h√§ngt mit der ausgew√§hlten Sprache Ihres Browsers zusammen, und nat√ºrlich ist die √úbersetzung ins Russische noch nicht vollst√§ndig abgeschlossen, und wir erhalten eine h√∂llische Mischung aus Russisch und Englisch.  Wenn Sie genau so erfolgreich waren und es Sie w√ºtend macht, k√∂nnen Sie das spezielle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Plug-In verwenden</a> und die Standardsprache f√ºr die Benutzeroberfl√§che festlegen.  Oder schalten Sie Ihren Browser auf die englische Oberfl√§che um. <br><br>  Gehen Sie zu Jenkins Einstellungen und w√§hlen Sie <b>Systemkonfiguration.</b> <br><br><img src="https://habrastorage.org/webt/pk/xo/1d/pkxo1diloanswc7tciicxhaiidq.png"><br><br>  Wir <b>kreuzen</b> die <b>Umgebungsumgebung an</b> , geben den Namen <b>ANDROID_HOME</b> in das Feld ein und geben im Feld <b>/ var / lib / android-sdk /</b> an (wir haben diese Daten in der Docker-Datei als Ausgangsverzeichnis f√ºr das Android SDK angegeben). <br><br><img src="https://habrastorage.org/webt/on/af/4j/onaf4jfhel5_ys078k5ohrxwxuu.png"><br><br>  Klicken Sie auf die Schaltfl√§che <b>Speichern</b> , verlassen Sie diesen Einstellungsabschnitt und wechseln Sie zum Abschnitt <b>Globale Tools-Konfiguration</b> . <br><br><img src="https://habrastorage.org/webt/b9/3i/zx/b93izxlndc-utyrnewgv5kluug0.png"><br><br>  Richten Sie die <b>JDK-</b> Partition ein (wobei die Variable JAVA_HOME auch von uns in der Docker-Datei ausgef√ºllt wurde und wir ihren Wert <b>/ usr / lib / jvm / java-8-openjdk-amd64 / hier verwenden k√∂nnen</b> ). <br><br><img src="https://habrastorage.org/webt/0l/wn/2p/0lwn2prv62virmofscvskc5e6_8.png"><br><br>  Auch hier m√ºssen wir noch den Abschnitt <b>Gradle</b> ausf√ºllen.  Wir w√§hlen und installieren die Version von Gradle, die in den Projekten verwendet wird, die Sie mit diesem CI-System erstellen.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie k√∂nnen mehrere Versionen haben. Sie k√∂nnen die Gradle-Variable auch √ºberhaupt nicht starten, wenn Sie beispielsweise gradlew im Repository haben und es damit erstellen k√∂nnen. </font></font><br><br><img src="https://habrastorage.org/webt/0q/fe/wj/0qfewj73fbwr3vzudpk8woyrsmy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Damit k√∂nnen wir unsere erste Etappe beenden. Das Jenkins-System ist voll funktionsf√§hig und wir k√∂nnen die Build-Aufgaben selbst anpassen. Bitte beachten Sie, dass das System an unsere Bed√ºrfnisse angepasst wurde und m√∂glicherweise nicht das bietet, was Sie ben√∂tigen. Beispielsweise gibt es keine Android-Emulatoren zum Testen und NDK.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn dieser Artikel jemanden interessiert, werde ich im zweiten Teil mit einem Beispiel f√ºr ein oder zwei Probleme fortfahren und die Integration von Jenkins und Bitbucket beschreiben (er ist es, nicht Github, weil es mit kostenlosen privaten Repositories und Artikeln im Internet einfacher ist Es ist kleiner, macht aber vielleicht mehr Spa√ü. Ich werde Ihnen sagen, wie Sie sich mit dem SSH-Schl√ºssel unseres Containers mit dem Repository anfreunden k√∂nnen, √ºber E-Mail-Benachrichtigungen und verschiedene andere Chips. </font><font style="vertical-align: inherit;">Im Allgemeinen √ºber alles, was wir konfiguriert haben. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich bitte Sie, nicht viel zu treten, dies ist mein erster Artikel √ºber Habr. </font><font style="vertical-align: inherit;">Gut zu allen!</font></font></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de443606/">https://habr.com/ru/post/de443606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de443594/index.html">Der Scheideweg von Test und Architektur: Ein Interview mit Neil Ford</a></li>
<li><a href="../de443598/index.html">Es gibt einen massiven Widerruf von TLS-Zertifikaten von einer Vielzahl von Zertifizierungsstellen, die versehentlich auf einem 63-Bit-RNG anstelle eines 64-Bit-Zertifikats generiert wurden</a></li>
<li><a href="../de443600/index.html">Die besten und schlechtesten Trends der MWC 2019</a></li>
<li><a href="../de443602/index.html">Was ist striktes Aliasing und warum sollten wir uns darum k√ºmmern? Teil 2</a></li>
<li><a href="../de443604/index.html">MOBILE FIRST: Hackathon bei OZON</a></li>
<li><a href="../de443608/index.html">Smart Home / Updates bei Lazurite</a></li>
<li><a href="../de443612/index.html">Wir verwenden alte schlechte Festplatten</a></li>
<li><a href="../de443614/index.html">YouTrack 2019.1: W√§hlen Sie Agile Boards, anpassbare Kartenfelder auf Agile Boards und mehr</a></li>
<li><a href="../de443616/index.html">35% Aktienrendite auf alternative Daten</a></li>
<li><a href="../de443618/index.html">80er Jahre Computer Emulator im Browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>