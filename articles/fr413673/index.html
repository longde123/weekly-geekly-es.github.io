<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍🤝‍👨🏼 🔸 👨🏽‍🔧 Sur la question des performances des anciennes et nouvelles versions d'un nœud 🐃 🎅🏼 🧑🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De temps en temps, les développeurs qui prennent en charge les anciennes applications de nœuds ont des doutes quant à la nécessité de transférer l'app...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sur la question des performances des anciennes et nouvelles versions d'un nœud</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413673/"> De temps en temps, les développeurs qui prennent en charge les anciennes applications de nœuds ont des doutes quant à la nécessité de transférer l'application des anciennes versions vers de nouveaux nœuds.  Le principal argument en faveur du maintien des anciennes est "Je n'utilise pas de nouvelles fonctionnalités, mais leur mise en œuvre ralentira certainement le traitement dans son ensemble."  De plus, la situation peut être considérablement compliquée par la présence de dépendances sur des bibliothèques qui ne sont plus prises en charge sous de nouveaux nœuds, et un changement de version d'un nœud se traduit automatiquement par un traitement important de l'architecture de l'application.  J'espère que mon article les aidera à prendre une décision à ce sujet. <br><a name="habracut"></a><br>  Avant de commencer, je vous rappelle le principe de base de l'informatique: <b>FONCTIONNE, NE TOUCHEZ PAS!</b> <br><br>  Si votre application fonctionne comme elle le devrait, si elle fait entièrement face aux tâches et qu'il n'y a aucun besoin urgent de son traitement, il est préférable de tout laisser tel quel.  Le recyclage peut être un processus très douloureux et très long.  Et en conséquence, vous n'obtiendrez aucun avantage tangible, autre qu'un sentiment de satisfaction esthétique, et à ce moment votre entreprise en souffrira. <br><br>  Mon article s'adresse à ceux qui en ont encore besoin.  Je décrirai ma situation récente, parlerai des difficultés rencontrées pour la résoudre et donnerai les résultats que j'ai finalement reçus. <br><br>  Je développe un système de collecte et de traitement des journaux d'autres applications.  Charges de travail établies - des centaines de milliers de journaux par minute par composant.  Le système évoluait bien horizontalement, avait une architecture modulaire, fonctionnait avec succès pendant plus d'un an et faisait face à ses fonctions dans son ensemble.  La version utilisée du nœud est 0,10 <br><br>  <b>À quoi faites-vous face?</b> <br><br>  Naturellement, pas un manque de fonctionnalités.  Les nouvelles fonctionnalités d'es6 n'étaient même pas considérées comme un argument.  Bien sûr, ils rendent la vie un peu plus agréable, mais rien de plus.  Pour n'importe laquelle de nos tâches, la fonctionnalité de l'ancien nœud était tout à fait suffisante.  Des problèmes sont survenus à l'endroit le plus inattendu à mesure que la fonctionnalité devenait plus complexe. <br><br>  Problème un: <br><br>  L'un des composants avec des charges entrantes de pointe et une consommation de mémoire inférieure à 5 Go a soudainement commencé à ralentir de manière infernale.  Le problème ne s'est pas produit à chaque fois, spontanément, généralement vers la fin du pic.  Si l'application n'est pas tombée dans les délais d'attente, les performances ont progressivement repris en une demi-heure ou une heure.  Le redémarrage a guéri immédiatement. <br><br>  Après le processus de «débogage en profondeur», il s'est avéré que l'ensemble du processus commençait à ralentir, même les opérations synchrones, c'est pourquoi il a été conclu que le garbage collector lui-même «empirait».  Que faire à ce sujet n'était pas du tout clair.  La seule solution était de rechercher l'historique des modifications de notre code pendant plusieurs mois et de restaurer des fonctionnalités importantes.  En revanche, le problème ne se produit pas souvent, pas tous les jours, et le redémarrage manuel du système semble également être une solution tout à fait acceptable (manuel signifie un script sur la base du signal du détecteur de backlog).  Nous étions plus enclins à la deuxième option.  Et sans le deuxième problème, il aurait probablement été implémenté. <br><br>  Le deuxième problème: <br><br>  Un autre de nos composants mangeait beaucoup de mémoire.  Comme ce composant était en fait un cache, sa «cupidité» était en principe explicable.  Jusqu'au moment où il fallait la limiter d'en haut à un volume strictement spécifié.  Et puis il s'est avéré que le composant gagnait de la mémoire et n'était pas pressé de le donner.  Et même en travaillant à une vitesse presque inactive.  C'est-à-dire qu'au moment de la charge de pointe, le gestionnaire de mémoire du nœud a sélectionné la mémoire maximale, et même avec une marge, puis l'a maintenue jusqu'à la fin du siècle (redémarrage du composant, par exemple).  Je mentionnerai tout de suite que, naturellement, l'option de fuite a été examinée et vérifiée.  Hélas, il n'y a pas eu de fuite, et là encore nous étions dans une impasse. <br><br>  J'ai essayé de demander à divers endroits sur Internet comment effectuer la gestion de la mémoire d'un nœud et comment résoudre notre situation.  Mais en réponse, je n'ai reçu que beaucoup de négativité concernant l'utilisation du nœud 0.10.  En général, c'est cette négativité qui m'a poussé à passer aux dernières versions du nœud. <br><br>  <b>Qu'est-ce qui retenait?</b> <br><br>  1. Peur d'une perte de productivité. <br><br>  Ceux qui ont travaillé sur python se souviennent que la transition de la ligne 2.x à 3.x s'est accompagnée d'une perte de productivité substantielle.  Je ne sais pas comment les choses sont en python maintenant, peut-être que la situation s'est améliorée.  Mais il est tout à fait logique de s'attendre à ce qu'après avoir ajouté toutes ces nouvelles fonctionnalités à es6, le nœud puisse également couler solidement.  J'ai essayé de google quelques benchmarks pour comparer les nouveaux nœuds avec les anciens, je n'ai rien trouvé de sensé. <br><br>  2. Performance JSON.parse <br><br>  Puisque nous travaillons avec des journaux, JSON.parse occupe la part du lion du processeur.  À un moment donné, nous l'avons comparé sur différentes versions du nœud et avons obtenu une baisse de performances d'environ 30%.  Le nœud 4.x a été comparé à 0,10 et 0,12. <br><br>  En fait, ces raisons n'étaient pas décisives, car le processeur n'était pas un goulot d'étranglement.  De plus, pour de telles tâches, il y a une mise à l'échelle horizontale. <br><br>  3. Dépendances des packages <br><br>  Mais c'était une pierre d'achoppement.  Notre composant central le plus complexe a utilisé le paquet libmysqlclient, qui ne fonctionne que sous le noeud 0.10.  Pire encore, ses appels synchrones.  Autrement dit, il était impossible de simplement changer le pilote mysql, en remplaçant un appel par un autre, sans traiter en profondeur l'architecture des composants d'un traitement partiellement synchrone à un traitement complètement asynchrone.  De plus, la partie la plus difficile de cette tâche n'était pas tant le traitement lui-même que la façon de justifier la gestion de son besoin et de montrer exactement ce qu'il donnerait au projet :) <br><br>  <b>Qu'est-ce qui a donné?</b> <br><br>  En conséquence, nous sommes toujours passés du nœud 0.10 aux derniers lts 8.11.x <br><br>  1. Aucune baisse de performance.  Au contraire, nous avons reçu une augmentation de l'ordre de 10-15% <br>  2. Consommation de mémoire considérablement améliorée, environ 30 à 50%, selon le composant <br>  3. Les problèmes «insolubles» évoqués ci-dessus sont résolus par eux-mêmes <br>  4. Nous avons enfin eu l'opportunité d'utiliser les nouvelles fonctionnalités d'es6!  Bien que par habitude, nous ne les utilisons pas encore))) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413673/">https://habr.com/ru/post/fr413673/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413661/index.html">Saga des services électroniques et de leurs emplacements. Partie 1. Service électronique</a></li>
<li><a href="../fr413663/index.html">Histoires backend MeetUp</a></li>
<li><a href="../fr413665/index.html">Comment déterminer le volume de vos logs?</a></li>
<li><a href="../fr413667/index.html">Kaggle: Amazon from Space - astuces et hacks pour la formation des réseaux de neurones</a></li>
<li><a href="../fr413669/index.html">Samsung IT School: enseigner aux étudiants comment développer des applications mobiles</a></li>
<li><a href="../fr413675/index.html">Joker 2018: Club des développeurs Java anonymes</a></li>
<li><a href="../fr413677/index.html">Lancement de ROS sur le robot auto-équilibrant EduMIP</a></li>
<li><a href="../fr413679/index.html">Angulaire 6. PWA. Modules de chargement paresseux. Déploiement automatique dans Firebase</a></li>
<li><a href="../fr413681/index.html">La technique de développement de serveurs hautement fiables sur Go</a></li>
<li><a href="../fr413683/index.html">ILV a débloqué 7 millions d'adresses IP. Rester verrouillé 4 millions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>