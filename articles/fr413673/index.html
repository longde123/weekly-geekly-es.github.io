<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçü§ù‚Äçüë®üèº üî∏ üë®üèΩ‚Äçüîß Sur la question des performances des anciennes et nouvelles versions d'un n≈ìud üêÉ üéÖüèº üßëüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De temps en temps, les d√©veloppeurs qui prennent en charge les anciennes applications de n≈ìuds ont des doutes quant √† la n√©cessit√© de transf√©rer l'app...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sur la question des performances des anciennes et nouvelles versions d'un n≈ìud</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413673/"> De temps en temps, les d√©veloppeurs qui prennent en charge les anciennes applications de n≈ìuds ont des doutes quant √† la n√©cessit√© de transf√©rer l'application des anciennes versions vers de nouveaux n≈ìuds.  Le principal argument en faveur du maintien des anciennes est "Je n'utilise pas de nouvelles fonctionnalit√©s, mais leur mise en ≈ìuvre ralentira certainement le traitement dans son ensemble."  De plus, la situation peut √™tre consid√©rablement compliqu√©e par la pr√©sence de d√©pendances sur des biblioth√®ques qui ne sont plus prises en charge sous de nouveaux n≈ìuds, et un changement de version d'un n≈ìud se traduit automatiquement par un traitement important de l'architecture de l'application.  J'esp√®re que mon article les aidera √† prendre une d√©cision √† ce sujet. <br><a name="habracut"></a><br>  Avant de commencer, je vous rappelle le principe de base de l'informatique: <b>FONCTIONNE, NE TOUCHEZ PAS!</b> <br><br>  Si votre application fonctionne comme elle le devrait, si elle fait enti√®rement face aux t√¢ches et qu'il n'y a aucun besoin urgent de son traitement, il est pr√©f√©rable de tout laisser tel quel.  Le recyclage peut √™tre un processus tr√®s douloureux et tr√®s long.  Et en cons√©quence, vous n'obtiendrez aucun avantage tangible, autre qu'un sentiment de satisfaction esth√©tique, et √† ce moment votre entreprise en souffrira. <br><br>  Mon article s'adresse √† ceux qui en ont encore besoin.  Je d√©crirai ma situation r√©cente, parlerai des difficult√©s rencontr√©es pour la r√©soudre et donnerai les r√©sultats que j'ai finalement re√ßus. <br><br>  Je d√©veloppe un syst√®me de collecte et de traitement des journaux d'autres applications.  Charges de travail √©tablies - des centaines de milliers de journaux par minute par composant.  Le syst√®me √©voluait bien horizontalement, avait une architecture modulaire, fonctionnait avec succ√®s pendant plus d'un an et faisait face √† ses fonctions dans son ensemble.  La version utilis√©e du n≈ìud est 0,10 <br><br>  <b>√Ä quoi faites-vous face?</b> <br><br>  Naturellement, pas un manque de fonctionnalit√©s.  Les nouvelles fonctionnalit√©s d'es6 n'√©taient m√™me pas consid√©r√©es comme un argument.  Bien s√ªr, ils rendent la vie un peu plus agr√©able, mais rien de plus.  Pour n'importe laquelle de nos t√¢ches, la fonctionnalit√© de l'ancien n≈ìud √©tait tout √† fait suffisante.  Des probl√®mes sont survenus √† l'endroit le plus inattendu √† mesure que la fonctionnalit√© devenait plus complexe. <br><br>  Probl√®me un: <br><br>  L'un des composants avec des charges entrantes de pointe et une consommation de m√©moire inf√©rieure √† 5 Go a soudainement commenc√© √† ralentir de mani√®re infernale.  Le probl√®me ne s'est pas produit √† chaque fois, spontan√©ment, g√©n√©ralement vers la fin du pic.  Si l'application n'est pas tomb√©e dans les d√©lais d'attente, les performances ont progressivement repris en une demi-heure ou une heure.  Le red√©marrage a gu√©ri imm√©diatement. <br><br>  Apr√®s le processus de ¬´d√©bogage en profondeur¬ª, il s'est av√©r√© que l'ensemble du processus commen√ßait √† ralentir, m√™me les op√©rations synchrones, c'est pourquoi il a √©t√© conclu que le garbage collector lui-m√™me ¬´empirait¬ª.  Que faire √† ce sujet n'√©tait pas du tout clair.  La seule solution √©tait de rechercher l'historique des modifications de notre code pendant plusieurs mois et de restaurer des fonctionnalit√©s importantes.  En revanche, le probl√®me ne se produit pas souvent, pas tous les jours, et le red√©marrage manuel du syst√®me semble √©galement √™tre une solution tout √† fait acceptable (manuel signifie un script sur la base du signal du d√©tecteur de backlog).  Nous √©tions plus enclins √† la deuxi√®me option.  Et sans le deuxi√®me probl√®me, il aurait probablement √©t√© impl√©ment√©. <br><br>  Le deuxi√®me probl√®me: <br><br>  Un autre de nos composants mangeait beaucoup de m√©moire.  Comme ce composant √©tait en fait un cache, sa ¬´cupidit√©¬ª √©tait en principe explicable.  Jusqu'au moment o√π il fallait la limiter d'en haut √† un volume strictement sp√©cifi√©.  Et puis il s'est av√©r√© que le composant gagnait de la m√©moire et n'√©tait pas press√© de le donner.  Et m√™me en travaillant √† une vitesse presque inactive.  C'est-√†-dire qu'au moment de la charge de pointe, le gestionnaire de m√©moire du n≈ìud a s√©lectionn√© la m√©moire maximale, et m√™me avec une marge, puis l'a maintenue jusqu'√† la fin du si√®cle (red√©marrage du composant, par exemple).  Je mentionnerai tout de suite que, naturellement, l'option de fuite a √©t√© examin√©e et v√©rifi√©e.  H√©las, il n'y a pas eu de fuite, et l√† encore nous √©tions dans une impasse. <br><br>  J'ai essay√© de demander √† divers endroits sur Internet comment effectuer la gestion de la m√©moire d'un n≈ìud et comment r√©soudre notre situation.  Mais en r√©ponse, je n'ai re√ßu que beaucoup de n√©gativit√© concernant l'utilisation du n≈ìud 0.10.  En g√©n√©ral, c'est cette n√©gativit√© qui m'a pouss√© √† passer aux derni√®res versions du n≈ìud. <br><br>  <b>Qu'est-ce qui retenait?</b> <br><br>  1. Peur d'une perte de productivit√©. <br><br>  Ceux qui ont travaill√© sur python se souviennent que la transition de la ligne 2.x √† 3.x s'est accompagn√©e d'une perte de productivit√© substantielle.  Je ne sais pas comment les choses sont en python maintenant, peut-√™tre que la situation s'est am√©lior√©e.  Mais il est tout √† fait logique de s'attendre √† ce qu'apr√®s avoir ajout√© toutes ces nouvelles fonctionnalit√©s √† es6, le n≈ìud puisse √©galement couler solidement.  J'ai essay√© de google quelques benchmarks pour comparer les nouveaux n≈ìuds avec les anciens, je n'ai rien trouv√© de sens√©. <br><br>  2. Performance JSON.parse <br><br>  Puisque nous travaillons avec des journaux, JSON.parse occupe la part du lion du processeur.  √Ä un moment donn√©, nous l'avons compar√© sur diff√©rentes versions du n≈ìud et avons obtenu une baisse de performances d'environ 30%.  Le n≈ìud 4.x a √©t√© compar√© √† 0,10 et 0,12. <br><br>  En fait, ces raisons n'√©taient pas d√©cisives, car le processeur n'√©tait pas un goulot d'√©tranglement.  De plus, pour de telles t√¢ches, il y a une mise √† l'√©chelle horizontale. <br><br>  3. D√©pendances des packages <br><br>  Mais c'√©tait une pierre d'achoppement.  Notre composant central le plus complexe a utilis√© le paquet libmysqlclient, qui ne fonctionne que sous le noeud 0.10.  Pire encore, ses appels synchrones.  Autrement dit, il √©tait impossible de simplement changer le pilote mysql, en rempla√ßant un appel par un autre, sans traiter en profondeur l'architecture des composants d'un traitement partiellement synchrone √† un traitement compl√®tement asynchrone.  De plus, la partie la plus difficile de cette t√¢che n'√©tait pas tant le traitement lui-m√™me que la fa√ßon de justifier la gestion de son besoin et de montrer exactement ce qu'il donnerait au projet :) <br><br>  <b>Qu'est-ce qui a donn√©?</b> <br><br>  En cons√©quence, nous sommes toujours pass√©s du n≈ìud 0.10 aux derniers lts 8.11.x <br><br>  1. Aucune baisse de performance.  Au contraire, nous avons re√ßu une augmentation de l'ordre de 10-15% <br>  2. Consommation de m√©moire consid√©rablement am√©lior√©e, environ 30 √† 50%, selon le composant <br>  3. Les probl√®mes ¬´insolubles¬ª √©voqu√©s ci-dessus sont r√©solus par eux-m√™mes <br>  4. Nous avons enfin eu l'opportunit√© d'utiliser les nouvelles fonctionnalit√©s d'es6!  Bien que par habitude, nous ne les utilisons pas encore))) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413673/">https://habr.com/ru/post/fr413673/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413661/index.html">Saga des services √©lectroniques et de leurs emplacements. Partie 1. Service √©lectronique</a></li>
<li><a href="../fr413663/index.html">Histoires backend MeetUp</a></li>
<li><a href="../fr413665/index.html">Comment d√©terminer le volume de vos logs?</a></li>
<li><a href="../fr413667/index.html">Kaggle: Amazon from Space - astuces et hacks pour la formation des r√©seaux de neurones</a></li>
<li><a href="../fr413669/index.html">Samsung IT School: enseigner aux √©tudiants comment d√©velopper des applications mobiles</a></li>
<li><a href="../fr413675/index.html">Joker 2018: Club des d√©veloppeurs Java anonymes</a></li>
<li><a href="../fr413677/index.html">Lancement de ROS sur le robot auto-√©quilibrant EduMIP</a></li>
<li><a href="../fr413679/index.html">Angulaire 6. PWA. Modules de chargement paresseux. D√©ploiement automatique dans Firebase</a></li>
<li><a href="../fr413681/index.html">La technique de d√©veloppement de serveurs hautement fiables sur Go</a></li>
<li><a href="../fr413683/index.html">ILV a d√©bloqu√© 7 millions d'adresses IP. Rester verrouill√© 4 millions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>