<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>#‚É£ ü§üüèº üèΩ Web scraping with R. Compara√ß√£o de classifica√ß√µes de filmes no Kinopoisk e IMDB üéì ‚ô¶Ô∏è ‚ñ´Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A World Wide Web √© um oceano de dados. Aqui voc√™ pode ver quase todas as informa√ß√µes de seu interesse. No entanto, "puxar" essas informa√ß√µes da Intern...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Web scraping with R. Compara√ß√£o de classifica√ß√µes de filmes no Kinopoisk e IMDB</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462917/"><p><img src="https://habrastorage.org/webt/tb/ng/o5/tbngo5ub1m2isuzbdmu38whx75a.jpeg" alt="imagem"></p><br><p>  A World Wide Web √© um oceano de dados.  Aqui voc√™ pode ver quase todas as informa√ß√µes de seu interesse.  No entanto, "puxar" essas informa√ß√µes da Internet j√° √© mais dif√≠cil.  Existem v√°rias maneiras de obter dados e a raspagem na web √© uma delas. <a name="habracut"></a></p><br><p>  O que √© raspagem da web?  Em suma, √© uma tecnologia que permite recuperar dados de p√°ginas HTML.  Ao usar raspagem, n√£o √© necess√°rio copiar e colar as informa√ß√µes necess√°rias ou transferi-las da tela para o bloco de notas.  As informa√ß√µes aparecer√£o no seu computador em um formato conveniente para voc√™. </p><br><h2 id="web-scraping-na-primere-sayta-kinopoiskru">  Web-scraping no exemplo do site Kinopoisk.ru </h2><br><p>  √â uma boa ideia definir uma meta para n√£o fazer raspagem por raspagem.  Decidi que seria uma <strong>compara√ß√£o das classifica√ß√µes de filmes no Kinopoisk.ru e IMDB.com, bem como as classifica√ß√µes m√©dias de filmes por g√™nero</strong> .  Para an√°lise, foram realizados os filmes lan√ßados de 2010 a 2018, com um m√≠nimo de 500 votos. </p><br><p>  Para come√ßar, carregue as bibliotecas necess√°rias: </p><br><pre><code class="plaintext hljs">#   library(rvest) library(selectr) library(xml2) library(jsonlite) library(tidyverse)</code> </pre> <br><p>  Em seguida, recebo o n√∫mero de filmes em um ano que atendem √† condi√ß√£o de sele√ß√£o (mais de 500 votos).  Isso √© feito para descobrir o n√∫mero total de p√°ginas com dados e "gerar" links para elas, porque  links s√£o semelhantes em estrutura. </p><br><pre> <code class="plaintext hljs">#        2018  url &lt;- "https://www.kinopoisk.ru/top/navigator/m_act[year]/2018/m_act[rating]/1%3A/order/rating/page/1/#results"</code> </pre> <br><p><img src="https://habrastorage.org/webt/y7/xz/ef/y7xzeffxqz9uurscdhz_17aawns.png"></p><br><p>  Nossa tarefa √© "retirar" o n√∫mero 672, destacado na figura por um ret√¢ngulo vermelho.  Para isso, precisamos de scraping na web. </p><br><h4 id="web-scraping-stranicy-sayta-kinopoiskru-s-pomoschyu-paketa-rvest">  P√°ginas de raspagem da web do site Kinopoisk.ru usando o pacote <code>rvest</code> </h4><br><p>  Primeiro, precisamos "ler" o URL que recebemos.  Para fazer isso, use a fun√ß√£o <code>read_html()</code> do pacote <code>read_html()</code> . </p><br><pre> <code class="plaintext hljs">#     XML  HTML  webpage &lt;- read_html(url)</code> </pre> <br><p>  E ent√£o, usando as fun√ß√µes do pacote <code>rvest</code> primeiro "extra√≠mos" a parte do documento HTML que precisamos (a fun√ß√£o <code>html_nodes()</code> ) e, a partir desta parte, extra√≠mos as informa√ß√µes necess√°rias em um formato conveniente para n√≥s (as <code>html_text()</code> , <code>html_table()</code> , <code>html_attr()</code> outro) </p><br><p>  Mas como entendemos qual elemento precisamos extrair?  Para fazer isso, precisamos passar o mouse sobre as informa√ß√µes em que estamos interessados, clicar em LMB e selecionar "visualizar c√≥digo".  No nosso caso, temos a seguinte imagem: </p><br><p><img src="https://habrastorage.org/webt/wn/vr/h4/wnvrh4sfkpo9xsjqqhbb0zwt8fy.png"></p><br><p>  A fun√ß√£o <code>html_nodes()</code> possui o formato <code>html_nodes(x, css)</code> .  x √© a p√°gina da web definida anteriormente, mas em css escrevemos o id ou a classe do elemento.  No nosso caso, √©: </p><br><pre> <code class="plaintext hljs">number_html &lt;- html_nodes(webpage, ".pagesFromTo")</code> </pre> <br><p>  Al√©m disso, para "detectar" o elemento desejado, voc√™ pode usar a extens√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">selectorGadget</a> , que mostra o que precisamos inserir explicitamente: </p><br><p><img src="https://habrastorage.org/webt/jh/fc/zx/jhfczxtfn3anfeapp4cbtwir0ay.png"></p><br><p>  Em seguida, com a fun√ß√£o html_text, extra√≠mos a parte do texto do elemento selecionado: </p><br><pre> <code class="plaintext hljs">number &lt;- html_text(number_html) [1] "1‚Äî50  672" "1‚Äî50  672"</code> </pre> <br><p>  Obtivemos o n√∫mero necess√°rio na p√°gina HTML do Kinopoisk, mas agora precisamos "limp√°-lo".  Este √© um procedimento padr√£o para a raspagem, porque muito raramente precisamos do elemento que precisamos da forma que precisamos. </p><br><p>  Temos dois elementos id√™nticos devido ao fato de que o n√∫mero total de filmes √© indicado na parte superior e inferior da p√°gina e seu seletor de css √© exatamente o mesmo.  Portanto, para iniciantes, removemos o elemento em excesso: </p><br><pre> <code class="plaintext hljs">number &lt;- number[1] [1] "1‚Äî50  672"</code> </pre> <br><p>  Em seguida, precisamos nos livrar da parte do vetor que sobe para o n√∫mero 672. Voc√™ pode fazer isso de maneiras diferentes, mas a base de todos os m√©todos √© escrever uma express√£o regular.  Nesse caso, eu ‚Äúsubstituo‚Äù a parte ‚Äú1-50 de‚Äù por um vazio (voc√™ pode usar <code>str_remove</code> vez de <code>str_replace</code> ), depois removo os espa√ßos extras (fun√ß√£o <code>str_trim</code> ) e, finalmente, traduzo o vetor do caractere para o tipo num√©rico.  Na sa√≠da, recebo o n√∫mero 672. Exatamente tantos filmes de 2018 t√™m mais de 500 votos de usu√°rios no Kinopoisk. </p><br><pre> <code class="plaintext hljs">number &lt;- str_replace(number, ".{2,}", "") number &lt;- as.numeric(str_trim(number)) [1] 672</code> </pre> <br><p>  O que faremos a seguir?  Se voc√™ olhar as p√°ginas do Kinopoisk, ver√° que os endere√ßos das p√°ginas de pesquisa t√™m a mesma estrutura e diferem apenas em n√∫mero.  Portanto, para n√£o inserir o endere√ßo da p√°gina manualmente a cada vez, calcularemos o n√∫mero de p√°ginas e "geraremos" o n√∫mero necess√°rio de endere√ßos.  √â feito assim: </p><br><pre> <code class="plaintext hljs">#   page_number &lt;- ceiling(number/50) #   page &lt;- sapply(seq(1:page_number), function(n){ list_page &lt;- paste0("https://www.kinopoisk.ru/top/navigator/m_act[year]/2018/m_act[rating]/1%3A/order/rating/page/", n, "/#results") })</code> </pre> <br><p>  A sa√≠da √© 14 endere√ßos.  A fun√ß√£o de <code>ceiling</code> neste exemplo arredonda um n√∫mero para um n√∫mero inteiro BIG. </p><br><p>  E ent√£o usamos a fun√ß√£o <code>lapply</code> na entrada da qual os endere√ßos das p√°ginas s√£o alimentados, e a fun√ß√£o "extrai" informa√ß√µes das p√°ginas do Kinopoisk sobre o nome, classifica√ß√£o, n√∫mero de votos e g√™neros principais (m√°ximo 3) do filme.  O c√≥digo de fun√ß√£o pode ser encontrado no reposit√≥rio no <a href="">Github</a> . </p><br><p>  Como resultado, obtemos uma tabela com 8111 filmes. </p><br><div class="scrollable-table"><table><thead><tr><th>  NAME </th><th>  Classifica√ß√£o </th><th>  VOTOS </th><th>  G√äNERO </th><th>  Ano </th></tr></thead><tbody><tr><td>  Sherlock </td><td>  8,884 </td><td>  235316 </td><td>  suspense, drama, crime </td><td>  2010 </td></tr><tr><td>  homem correndo </td><td>  8,812 </td><td>  1917 </td><td>  jogo, tv de verdade, com√©dia </td><td>  2010 </td></tr><tr><td>  grande guerra </td><td>  8,792 </td><td>  5690 </td><td>  document√°rio, militar, hist√≥ria </td><td>  2010 </td></tr><tr><td>  descoberta como o universo funciona </td><td>  8,740 </td><td>  3033 </td><td>  document√°rio </td><td>  2010 </td></tr><tr><td>  o come√ßo </td><td>  8.664 </td><td>  533715 </td><td>  fic√ß√£o, a√ß√£o, suspense </td><td>  2010 </td></tr><tr><td>  descoberta no universo com Stephen Hawking </td><td>  8.520 </td><td>  4373 </td><td>  document√°rio </td><td>  2010 </td></tr></tbody></table></div><br><p>  Vale a pena notar sobre o uso da fun√ß√£o Sys.sleep.  Usando-o, voc√™ pode definir o tempo de atraso entre as express√µes.  Por que isso √© necess√°rio?  Se voc√™ deseja receber informa√ß√µes em um ano, n√£o h√° necessidade.  Mas se voc√™ estiver interessado em um grande n√∫mero de filmes / anos, depois de um certo n√∫mero de solicita√ß√µes, o Kinopoisk o considerar√° um rob√¥ e voc√™ receber√° uma lista vazia para sua solicita√ß√£o.  Para evitar isso, √© necess√°rio inserir o tempo de atraso. </p><br><p>  Da mesma forma, <a href="">"descarte" o</a> site IMDB.com. </p><br><h4 id="analiz-poluchennyh-dannyh">  An√°lise de dados </h4><br><p>  Temos duas tabelas, em uma informa√ß√£o sobre filmes com IMDB, na outra, do Kinopoisk.  Agora precisamos combin√°-los.  Vamos nos unir de acordo com as colunas NOME e ANO.  Para reduzir o n√∫mero de discrep√¢ncias nos nomes, mesmo no est√°gio de raspagem, removi todos os sinais de pontua√ß√£o e converti as letras para min√∫sculas.  Como resultado, depois de todas as conex√µes e exclus√µes, obtemos 3450 filmes com as informa√ß√µes de que precisamos nos dois sites. </p><br><p>  Estou interessado na diferen√ßa nas classifica√ß√µes de filmes em dois sites, por isso criaremos a vari√°vel DELTA, que √© a diferen√ßa entre as estimativas do IMDB e Kinopoisk.  Se DELTA for positivo, a pontua√ß√£o no IMDB √© maior; se negativo, menor. </p><br><p>  Primeiro, construa um histograma para o indicador DELTA: <br><img src="https://habrastorage.org/webt/-c/xc/nk/-cxcnkbrmizksvf2wvuvbf3hub8.jpeg"><br>  N√£o h√° nada de surpreendente no gr√°fico.  A diferen√ßa nas classifica√ß√µes tem uma distribui√ß√£o normal e um pico na regi√£o de zero, o que sugere que os usu√°rios dos dois sites geralmente concordam com a classifica√ß√£o dos filmes. </p><br><p>  Convergir, mas n√£o exatamente.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O teste t de</a> duas amostras independentes nos permite dizer que as classifica√ß√µes no Kinopoisk s√£o mais altas e essa diferen√ßa √© estatisticamente significativa (valor de p &lt;0,05). <br><img src="https://habrastorage.org/webt/vp/rj/fx/vprjfxr7f_dczpyl3dgcdcxfx2m.png"><br>  Embora a diferen√ßa seja significativa, √© muito pequena. </p><br><p>  A seguir, vamos ver como a diferen√ßa nas classifica√ß√µes depende do n√∫mero de votos. <br><img src="https://habrastorage.org/webt/8e/b0/d4/8eb0d4-dant3xvwu7fojrvjvqqi.jpeg"><br>  Nada de inesperado aqui tamb√©m.  Filmes com um grande n√∫mero de votos geralmente t√™m muito pouca diferen√ßa nas classifica√ß√µes. </p><br><p>  Agora, vamos avaliar filmes por g√™nero.  Vale a pena notar imediatamente que um filme pode ter at√© tr√™s g√™neros, mas apenas uma classifica√ß√£o, para que um filme possa ser "testado", com√©dia e melodrama. </p><br><p>  Vamos come√ßar com o Kinopoisk.  Entre os g√™neros com pelo menos 150 apari√ß√µes no banco de dados, o horror √© um estranho √≥bvio.  Tamb√©m usu√°rios baixos classificam thrillers, detetives de a√ß√£o e, o que foi surpreendente para mim, fic√ß√£o cient√≠fica.  Por outro lado, os filmes melodram√°ticos no Kinopoisk surgem com um estrondo, com uma classifica√ß√£o m√©dia acima de 6,5 e perdendo apenas para os desenhos animados e os filmes biogr√°ficos, que s√£o muito menores no banco de dados. </p><br><p><img src="https://habrastorage.org/webt/xm/vw/gs/xmvwgstrl970cowgtnab72wrrpc.jpeg"></p><br><p>  Agora considere o mesmo gr√°fico, mas para o IMDB.  Em princ√≠pio, ele novamente confirma que a diferen√ßa de classifica√ß√£o entre os sites √© insignificante.  Isso n√£o √© surpreendente, porque muitos usu√°rios t√™m contas nos dois sites e √© improv√°vel que d√™em classifica√ß√µes diferentes em sites diferentes.  Mais uma vez, o principal perdedor s√£o os horrores, e podemos dizer que eles s√£o o g√™nero de filmes com classifica√ß√£o mais baixa.  √â dif√≠cil para mim avaliar por que isso acontece, porque o √∫nico filme de terror que assisti na minha vida √© Gremlins.  Talvez sejam os horrores que s√£o o g√™nero de or√ßamento mais baixo, de onde v√™m a fraca atua√ß√£o de atores baratos e os cen√°rios francamente ruins.  Suspense com fic√ß√£o cient√≠fica e no IMDB est√£o entre os retardat√°rios, mas os militantes est√£o se saindo melhor.  Entre os l√≠deres est√£o novamente filmes e desenhos biogr√°ficos.  O drama ocupa o terceiro lugar, mas a pontua√ß√£o dos melodramas caiu abaixo de 6,5, ao n√≠vel dos filmes de aventura.  Tamb√©m no IMDB abaixo de com√©dias. </p><br><p><img src="https://habrastorage.org/webt/k8/09/u2/k809u2sbxwiw61i284wh6pxipci.jpeg"></p><br><h4 id="zaklyuchenie-i-nemnogo-o-vneshnih-faktorah">  Conclus√£o e um pouco sobre os "fatores externos" </h4><br><p>  Embora exista uma diferen√ßa nas estimativas (no Kinopoisk, elas s√£o um pouco mais altas), √© um pouco.  De acordo com v√°rios g√™neros, a grande diferen√ßa tamb√©m √© impercept√≠vel.  Os blockbusters que t√™m dezenas ou mesmo centenas de milhares de votos, se tiverem diferen√ßas, ficam dentro de 0,5 pontos. </p><br><p>  Filmes com um pequeno n√∫mero (especialmente no Kinopoisk) de votos, at√© 10 mil, geralmente t√™m uma grande diferen√ßa nas classifica√ß√µes.  No entanto, a maior diferen√ßa na classifica√ß√£o a favor do IMDB √© o filme com 30.000 votos em um site estrangeiro e mais de 90.000 no Kinopoisk.  Esta √© a cria√ß√£o de Alexei Pimanov "Crimeia".  O filme √© t√£o apreciado por espectadores estrangeiros?  Dificilmente.  Muito provavelmente, os cineastas usaram a mesma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"pol√≠tica de marketing"</a> em rela√ß√£o ao IMDB do Kinopoisk.  √â que, se o Kinopoisk "limpou" essas estimativas, elas permaneceram no IMDB.  Eu acho que √© por isso que "Crimeia" √© um "bom pequeno parente". </p><br><p>  <em>Ficaria muito grato por quaisquer coment√°rios, sugest√µes, reclama√ß√µes</em> </p><br><p>  Link do reposit√≥rio do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Github</a> <br>  Perfil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do meu c√≠rculo</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt462917/">https://habr.com/ru/post/pt462917/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt462905/index.html">Escrevendo um bot de telegrama em python usando a biblioteca de telebot parte 2</a></li>
<li><a href="../pt462907/index.html">ngFanatic semanalmente</a></li>
<li><a href="../pt462909/index.html">Os frutos da evolu√ß√£o do ASIC: sobre fabricantes, mineradores de SHA-256 e as esquisitices do hashrate astron√¥mico</a></li>
<li><a href="../pt462911/index.html">Um ano ao volante de um carro el√©trico</a></li>
<li><a href="../pt462915/index.html">Desempenho AMD EPYC 7452 atrav√©s dos olhos do Cinebench R20</a></li>
<li><a href="../pt462919/index.html">Gerente de produto x gerente de projeto: como evitar confus√£o?</a></li>
<li><a href="../pt462923/index.html">Entrando no Aeronet Epis√≥dio 3: Encontrando a Bola</a></li>
<li><a href="../pt462929/index.html">Vejo voc√™: t√°ticas de mascaramento de morcegos</a></li>
<li><a href="../pt462933/index.html">Como funciona o bloqueio da Internet: uma revis√£o dos m√©todos modernos com um exemplo real</a></li>
<li><a href="../pt462935/index.html">Como manter o foco enquanto trabalha em um escrit√≥rio de plano aberto?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>