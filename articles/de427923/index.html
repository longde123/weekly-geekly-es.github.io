<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸƒ ğŸ—¨ï¸ ğŸ’• Wie ich dem SmartThings Hub ein neues GerÃ¤t hinzugefÃ¼gt habe, Teil 1 ğŸ‘©ğŸ¿â€ğŸ­ ğŸŒ» ğŸ‘¶ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel mÃ¶chte ich Ã¼ber meine Erfahrungen bei der Entwicklung des sogenannten Device Handler fÃ¼r SmartThings sprechen. Die Aufgabe bestand d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie ich dem SmartThings Hub ein neues GerÃ¤t hinzugefÃ¼gt habe, Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427923/">  In diesem Artikel mÃ¶chte ich Ã¼ber meine Erfahrungen bei der Entwicklung des sogenannten Device Handler fÃ¼r SmartThings sprechen.  Die Aufgabe bestand darin, ein universelles GerÃ¤t hinzuzufÃ¼gen, das auf dem Z-Wave-Protokoll basiert - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Z-Uno</a> - sowie die Verarbeitung der damit verbundenen untergeordneten GerÃ¤te. <br><br><img src="https://habrastorage.org/webt/z7/oy/id/z7oyidfngexle4mupi8hhkxjmbg.png"><br><a name="habracut"></a><br>  Die EinfÃ¼hrung in die Entwicklung hat mich ziemlich viel Zeit gekostet, aber nachdem ich die meisten Dokumentationen sorgfÃ¤ltig studiert hatte, erforderte die weitere Entwicklung keinen groÃŸen Aufwand mehr.  Aus diesem Grund wurde beschlossen, diesen Artikel zu schreiben, um die Arbeit des russischsprachigen Benutzers zu erleichtern. <br><br>  Der gesamte Entwicklungsprozess findet in der SmartThings IDE-Webanwendung in der Sprache GroThy statt.  Das Testen ist bequemer von einem mobilen GerÃ¤t aus durchzufÃ¼hren. Es ist jedoch mÃ¶glich, GerÃ¤tesimulatoren in derselben Entwicklungsumgebung zu erstellen.  Beim Testen der grafischen Shell muss bereits die mobile Anwendung SmartThings Classic ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Android</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">iOS</a> ) verwendet werden. <br><br>  Ein Plug-In-GerÃ¤t ist eine Karte, mit der Sie fast jedem GerÃ¤t in Z-Wave die Steuerung hinzufÃ¼gen kÃ¶nnen.  DarÃ¼ber hinaus kÃ¶nnen die angeschlossenen GerÃ¤te eine andere Nummer haben (bis zu 32 StÃ¼ck).  Dementsprechend mÃ¼ssen auf Softwareebene auch alle Arten verbundener GerÃ¤te verarbeitet und die Ausgabe an die Anwendung gesteuert werden. <br><br>  Liste der verarbeiteten Typen: <br><br><ul><li>  BinÃ¤r schalten - GerÃ¤te mit nur zwei Positionen: Ein / Aus </li><li>  Multilevel wechseln - GerÃ¤te, die mit unterschiedlichen Bedeutungen ein- oder ausgeschaltet werden kÃ¶nnen.  Zum Beispiel ein Dimer. </li><li>  Sensor Multilevel - Sensoren, die nicht-binÃ¤re Werte senden.  Zum Beispiel ein Temperatursensor. </li><li>  MessgerÃ¤t - GerÃ¤te wie ein ZÃ¤hler </li><li>  Benachrichtigung - BinÃ¤rsensoren werden von diesem Typ sein.  Zum Beispiel ein Reed-Schalter. </li><li>  Thermostat - eine separate Klasse von Teams, die fÃ¼r die Arbeit mit dem Thermostat verantwortlich sind </li></ul><br><br><h3>  Dokumentstruktur </h3><br>  Es kÃ¶nnen zwei logische BlÃ¶cke unterschieden werden: <br><br><ul><li> Beschreibung und Metainformationen zum Handler.  Dies beinhaltet Informationen Ã¼ber das GerÃ¤t, wie die BenutzeroberflÃ¤che und andere Informationen gezeichnet werden sollen.  Es wird nach der Methode <code>metadata()</code> zugewiesen. <br><br><img width="300" src="https://habrastorage.org/webt/pv/lc/wr/pvlcwrzmhfhltg1s2vvhp5zdx64.jpeg"><br></li><li>  Handler-Methoden sind Handler-Logik.  Sie sind fÃ¼r die â€Kommunikationâ€œ mit dem GerÃ¤t verantwortlich. <br><br>  Separat kÃ¶nnen wir die parse () -Methode unterscheiden, die die vom GerÃ¤t empfangenen Befehle interpretiert. </li></ul><br>  Ich werde den Zweck und den Inhalt jedes Blocks wÃ¤hrend der Artikelserie genauer beschreiben. <br><br><h2>  Metadaten </h2><br>  Wie Sie dem Namen der Methode entnehmen kÃ¶nnen, enthÃ¤lt diese Metainformationen. <br><br>  Betrachten wir in der Reihenfolge, was in diesem Block enthalten ist: <br><br><h3>  Definition () </h3><br>  Bei dieser Methode geben Argumente jeweils drei Dinge an: den Namen des Handlers, den Namespace und den Namen des Autors. <br><br><ul><li>  Der Name des Handlers wird zukÃ¼nftig beim VerÃ¶ffentlichen und beim Erstellen von untergeordneten GerÃ¤ten verwendet. </li><li>  Der Namespace wird bei der Suche nach Handlern nach Namen verwendet, um sicherzustellen, dass der richtige gefunden wird, z. B. unter Handlern mit demselben Namen.  SmartThings empfiehlt, Ihren Spitznamen auf github zu verwenden. </li><li>  Der Name des Autors wird mit Ihrem Namen ausgefÃ¼llt. </li></ul><br><pre> <code class="hljs pgsql"> definition(<span class="hljs-type"><span class="hljs-type">name</span></span>: "Your device", namespace: "yournamespace", author: "your name") {}</code> </pre><br>  Die folgenden Variablen kÃ¶nnen im Hauptteil der Methode deklariert werden: <code>attribute, capability, command, fingerprint</code> .  Weiter werden wir genauer betrachten, was es ist und wann es angewendet wird. <br><br><h3>  Verbindung und Fingerabdruck </h3><br>  Wir verbinden unser GerÃ¤t.  In unserem Fall werden SmartThings V2 Hub und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Z-Uno</a> verwendet. <br><br>  Beim HinzufÃ¼gen eines neuen Z-Wave- oder ZigBee-GerÃ¤ts versucht der Hub zu erkennen, mit welchem â€‹â€‹GerÃ¤tetyp eine Verbindung hergestellt werden soll, und sucht nach dem relevantesten Handler.  Er wird es durch "FingerabdrÃ¼cke" auswÃ¤hlen.  Wenn der Hub in den benutzerdefinierten Handlern keine Ãœbereinstimmungen findet, versucht er, eine der nÃ¤chstgelegenen Standardvorlagen zu verwenden. <br><br>  Im Handler selbst werden â€FingerabdrÃ¼ckeâ€œ festgelegt, um anzugeben, welche Arten von GerÃ¤ten unterstÃ¼tzt werden.  Die offizielle Dokumentation besagt, dass sie fÃ¼r Z-Wave-GerÃ¤te und ZigBee-GerÃ¤te unterschiedlich sein werden. Wir werden die Implementierung fÃ¼r Z-Wave in Betracht ziehen. <br><br>  Z-Wave-ProtokollgerÃ¤te speichern Informationen Ã¼ber Hersteller, GerÃ¤tetyp, Funktionen usw.  WÃ¤hrend des sogenannten â€Interviewsâ€œ mit dem GerÃ¤t sammelt ST diese Informationen in der Z-Wave-Rohbeschreibung.  Ein Beispiel fÃ¼r eine solche Zeile: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">zw</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ss</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">type</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2101</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mfr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0086</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">prod</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0102</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">model</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0064</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ver</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1.04</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">zwv</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4.05</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lib</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:03</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5E</span></span>,86,72,98,84 <span class="hljs-selector-tag"><span class="hljs-selector-tag">ccOut</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5A</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sec</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:59</span></span>,85,73,71,80,30,31,70,7<span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">role</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:06</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ff</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8C07</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ui</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8C07</span></span></code> </pre><br>  Der Wert jedes SchlÃ¼ssels wird verwendet, um den â€Fingerabdruckâ€œ auszufÃ¼llen.  Eine detaillierte Beschreibung der einzelnen Artikel finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> .  Wir werden diejenigen berÃ¼cksichtigen, die in unserem Handler verwendet werden. <br><br>  Um diese Zeile mit Informationen zu finden, mÃ¼ssen Sie auf die Registerkarte "Meine GerÃ¤te" klicken und auf das GerÃ¤t klicken, an dem wir interessiert sind (vorher muss das GerÃ¤t dem Netzwerk hinzugefÃ¼gt werden). <br><br><img src="https://habrastorage.org/webt/ix/uc/yg/ixucyg3owvrk2usf5brdg-zriyw.png"><br><br>  <b>mfr</b> ist ein 16-Bit-Wert, der die Hersteller-ID enthÃ¤lt.  Eine Liste der Hersteller und ihrer IDs finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  <b>prod</b> - ein 16-Bit-Wert, der die Produkttyp-ID enthÃ¤lt - eine eindeutige GerÃ¤tetyp-ID. <br><br>  <b>Modell</b> ist ein 16-Bit-Wert, der die Produkt-ID enthÃ¤lt. <br><br>  <b>inClusters</b> - Ein 8-Bit-Wert, der die Notwendigkeit einer bestimmten <b>Befehlsklasse</b> festlegt.  Wenn wir beispielsweise angeben mÃ¼ssen, dass unser Handler mit MultiChannel CC funktioniert, mÃ¼ssen Sie den Code 0x60 schreiben.  Die Liste der fÃ¼r SmartThings <abbr title="Befehlsklasse">CC</abbr> verfÃ¼gbaren GerÃ¤te finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Diese vier SchlÃ¼ssel reichen aus, damit der Hub genau versteht, zu welchem â€‹â€‹GerÃ¤t dieser Handler gehÃ¶rt.  Ein Beispiel, wie sie bei mir verwendet werden: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">fingerprint</span></span> mfr: <span class="hljs-string"><span class="hljs-string">"0115"</span></span>, prod: <span class="hljs-string"><span class="hljs-string">"0110"</span></span>, model: <span class="hljs-string"><span class="hljs-string">"0001"</span></span>, inClusters: <span class="hljs-string"><span class="hljs-string">"0x60"</span></span> fingerprint mfr: <span class="hljs-string"><span class="hljs-string">"0115"</span></span>, prod: <span class="hljs-string"><span class="hljs-string">"0111"</span></span>, inClusters: <span class="hljs-string"><span class="hljs-string">"0x60"</span></span></code> </pre><br>  Ein GerÃ¤t kann eine grÃ¶ÃŸere Anzahl von Parametern haben. In diesem Fall kann es erfolgreich eine Verbindung zu diesem Handler herstellen. Wenn jedoch mindestens einer von ihnen nicht mit dem deklarierten Fingerabdruck Ã¼bereinstimmt, ignoriert das GerÃ¤t diesen Handler. <br><br>  Smartthings empfiehlt, Informationen Ã¼ber den Hersteller (Hersteller) und das Modell (Produkt, Modell) in den Fingerabdruck aufzunehmen, um FÃ¤lle auszuschlieÃŸen, in denen die Wahl eines Handlers nicht offensichtlich ist.  Zum Beispiel, wenn FingerabdrÃ¼cke einer der standardmÃ¤ÃŸig verwendeten Vorlagen oder Beispiele mit Ihren Ã¼bereinstimmen. <br><br>  Position im Code <br><pre> <code class="hljs objectivec">metadata { definition(...) { ... fingerprint mfr: <span class="hljs-string"><span class="hljs-string">"0115"</span></span>, prod: <span class="hljs-string"><span class="hljs-string">"0110"</span></span>, model: <span class="hljs-string"><span class="hljs-string">"0001"</span></span>, inClusters: <span class="hljs-string"><span class="hljs-string">"0x60"</span></span> fingerprint mfr: <span class="hljs-string"><span class="hljs-string">"0115"</span></span>, prod: <span class="hljs-string"><span class="hljs-string">"0111"</span></span>, inClusters: <span class="hljs-string"><span class="hljs-string">"0x60"</span></span> } ... }</code> </pre><br><br>  Bis zur VerÃ¶ffentlichung ist ein vollstÃ¤ndiger Artikelzyklus geplant.  Ich hoffe, diese Informationen helfen Ihnen bei der Entwicklung. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de427923/">https://habr.com/ru/post/de427923/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de427913/index.html">Unterhaltsamer Prolog Nr. 2</a></li>
<li><a href="../de427915/index.html">Vermutung der Dummheit</a></li>
<li><a href="../de427917/index.html">Antwort auf den Beitrag "Vermutung des Geistes"</a></li>
<li><a href="../de427919/index.html">COM auf Linux portieren</a></li>
<li><a href="../de427921/index.html">4 Videos Ã¼ber Aufschub</a></li>
<li><a href="../de427925/index.html">Migration ohne Opfer: Technische Checkliste zum Verschieben einer Site in eine neue Domain</a></li>
<li><a href="../de427927/index.html">B - BrutalitÃ¤t. Offizielle Seite des Tischtennisverbandes der Republik Baschkortostan (FTN RB)</a></li>
<li><a href="../de427929/index.html">Arbeitsministerium: Testaufgabe ist ein ArbeitsverhÃ¤ltnis</a></li>
<li><a href="../de427931/index.html">Internetinformationsarchitektur Teil 4</a></li>
<li><a href="../de427933/index.html">Meinung der Steam-Entwickler: Maximaler Umsatz und geringe Verantwortung fÃ¼r das Ventil</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>