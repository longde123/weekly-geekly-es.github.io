<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ปโ๐คโ๐จ๐ฟ ๐ฐ๏ธ โฑ๏ธ ุชุณูู Elbrus - ุงุณุชุทูุงุน ูู ุงููุนุฑูุฉ. ุงูุฌุฒุก ุงูููู 1. ุงูุณุฌูุงุช ูุงููุฏุงุฎู ูุงูุชูุงุตูู ุงููููุฉ ุงูุฃุฎุฑู ๐ฉ๐ฝโ๐ผ ๐ โ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุง ูุนุฏูุง ุ ููุงุตู ุงูุญุฏูุซ ุนู ุชุทููุฑ ูุนุงูุฌุงุช Elbrus . ูุฐุง ุงูููุงู ุชููู ุงููุนูููุงุช ุงููุงุฑุฏุฉ ูู ุงูููุงูุฉ ููุณุช ูุซุงุฆู ุฑุณููุฉ ุ ูุฃูู ุชู ุงูุญุตูู ุนูููุง ุฃุซูุงุก ุฏุฑุงุณุฉ El...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุณูู Elbrus - ุงุณุชุทูุงุน ูู ุงููุนุฑูุฉ. ุงูุฌุฒุก ุงูููู 1. ุงูุณุฌูุงุช ูุงููุฏุงุฎู ูุงูุชูุงุตูู ุงููููุฉ ุงูุฃุฎุฑู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/447704/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ic/4z/5o/ic4z5olelesc04boln85goculk4.png" align="right" width="320">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง ูุนุฏูุง</a> ุ ููุงุตู ุงูุญุฏูุซ ุนู ุชุทููุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุนุงูุฌุงุช Elbrus</a> .  ูุฐุง ุงูููุงู ุชููู  ุงููุนูููุงุช ุงููุงุฑุฏุฉ ูู ุงูููุงูุฉ ููุณุช ูุซุงุฆู ุฑุณููุฉ ุ ูุฃูู ุชู ุงูุญุตูู ุนูููุง ุฃุซูุงุก ุฏุฑุงุณุฉ Elbrus ูุดุจู ุฅูู ุญุฏ ูุจูุฑ ุงูุตูุฏูู ุงูุฃุณูุฏ.  ูููู ุณูููู ูู ุงููุซูุฑ ููุงูุชูุงู ุจุงูุชุฃููุฏ ููู ุฃูุถู ูุนูุงุฑุฉ Elbrus ุ ูุฃูู ุนูู ุงูุฑุบู ูู ุฃู ูุฏููุง ูุซุงุฆู ุฑุณููุฉ ุ ุฅูุง ุฃู ุงูุนุฏูุฏ ูู ุงูุชูุงุตูู ุฃุตุจุญุช ูุงุถุญุฉ ููุท ุจุนุฏ ุชุฌุงุฑุจ ูุทููุฉ ุ ุนูุฏูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฌุญุช Embox</a> . <br><br>  ุชุฐูุฑ ุฃูู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุฉ ุงูุณุงุจูุฉ</a> ุชุญุฏุซูุง ุนู ุชูููุฏ ุงููุธุงู ุงูุฃุณุงุณู ูุจุฑูุงูุฌ ุชุดุบูู ุงููููุฐ ุงูุชุณูุณูู.  ุจุฏุฃุช Embox ุ ูููู ููุฒูุฏ ูู ุงูุชูุฏู ุ ุงุญุชุฌูุง ุฅูู ููุงุทุนุงุช ุ ูุฌูุงุฒ ุชูููุช ูููุธุงู ุ ูุจุงูุทุจุน ุ ุฃูุฏ ุชุถููู ูุฌููุนุฉ ูู ุงุฎุชุจุงุฑุงุช ุงููุญุฏุฉ ุ ูููุฐุง ูุญู ุจุญุงุฌุฉ ุฅูู setjmp.  ุณุชุฑูุฒ ูุฐู ุงูููุงูุฉ ุนูู ุงูุณุฌูุงุช ูุงูููุฏุณุงุช ูุงูุชูุงุตูู ุงูุชูููุฉ ุงูุฃุฎุฑู ุงููุงุฒูุฉ ูุชูููุฐ ูู ูุฐู ุงูุฃุดูุงุก. <br><a name="habracut"></a><br>  ููุจุฏุฃ ุจููุฏูุฉ ูุฎุชุตุฑุฉ ุนู ุงูููุฏุณุฉ ุงููุนูุงุฑูุฉ ุ ููู ุงูุญุฏ ุงูุฃุฏูู ูู ุงููุนูููุงุช ุงููุงุฒูุฉ ูููู ูุง ุณูุชู ููุงูุดุชู ูุงุญููุง.  ูู ุงููุณุชูุจู ุ ุณูู ูุดูุฑ ุฅูู ุงููุนูููุงุช ุงููุงุฑุฏุฉ ูู ูุฐุง ุงููุณู. <br><br><h3 style=";text-align:right;direction:rtl">  ููุฏูุฉ ููุฌุฒุฉ: ุงูุฃููุงู </h3><br>  ููุงู ุซูุงุซุฉ ูุฏุงุฎู ูู Elbrus: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> ุฑุตุฉ ุงูุฅุฌุฑุงุกุงุช (PS) </li><li style=";text-align:right;direction:rtl">  ููุฏุณ ุณูุณูุฉ ุงูุฅุฌุฑุงุกุงุช (PCS) </li><li style=";text-align:right;direction:rtl">  ูููุฉ ุงููุณุชุฎุฏู (ุงูููุงูุงุช ุงููุชุญุฏุฉ) </li></ul><br>  ุฏุนูุง ูุญูููู ุจูุฒูุฏ ูู ุงูุชูุงุตูู.  ุงูุนูุงููู ูู ุงูุดูู ูุดุฑูุทุฉ ุ ูุชุธูุฑ ูู ุฃู ุงุชุฌุงู ูุชู ุชูุฌูู ุงูุญุฑูุงุช - ูู ุงูุนููุงู ุงูุฃูุจุฑ ุฅูู ุงูุฃุตุบุฑ ุฃู ุงูุนูุณ. <br><br><img src="https://habrastorage.org/webt/le/bc/ac/lebcace6fqkdk5vvhwke6kajyuu.png"><br><br>  ุฑุตุฉ ุงูุฅุฌุฑุงุก (PS) ูุฎุตุตุฉ ููุจูุงูุงุช ุงููุฎุตุตุฉ ูุณุฌูุงุช "ุงูุชุดุบูู". <br><br>  ุนูู ุณุจูู ุงููุซุงู ุ ูุฏ ุชููู ูุณูุทุงุช ูุธูููุฉ ุ ูู ุงูุจูู "ุงูุนุงุฏูุฉ" ุ ูููู ูุฐุง ุงูููููู ุงูุฃูุฑุจ ุฅูู ุณุฌูุงุช ุงูุฃุบุฑุงุถ ุงูุนุงูุฉ.  ุนูู ุนูุณ ุจููุงุช ุงููุนุงูุฌ "ุงูุนุงุฏูุฉ" ุ ูู E2K ุ ูุชู ุชูุฏูุณ ุงูุณุฌูุงุช ุงููุณุชุฎุฏูุฉ ูู ุงููุธุงุฆู ุนูู ุฑุตุฉ ูููุตูุฉ. <br><br>  ุชู ุชุตููู Stack of Binding Information (PCS) ููุถุน ูุนูููุงุช ุญูู ุงูุฅุฌุฑุงุก ุงูุณุงุจู (ุงูุงุณุชุฏุนุงุก) ูุงุณุชุฎุฏุงูู ุนูุฏ ุงูุนูุฏุฉ.  ูุชู ูุถุน ุงูุจูุงูุงุช ุนูู ุนููุงู ุงููุฑุณู ุ ููุฐูู ูู ุญุงูุฉ ุงูุณุฌูุงุช ุ ูู ููุงู ูููุตู.  ูุฐูู ุ ูุฅู ุงูุชุฑููุฌ ููููุฏุณ (ุนูู ุณุจูู ุงููุซุงู ุ ููุฎุฑูุฌ ุจุดูู ุงุณุชุซูุงุฆู ูู C ++) ูู ุนูููุฉ ุชุณุชุบุฑู ููุชูุง ุฃุทูู ูู ุชูู ุงูููุฌูุฏุฉ ูู ุงูุจูู "ุงูุนุงุฏูุฉ".  ูู ูุงุญูุฉ ุฃุฎุฑู ุ ูุฐุง ููุบู ูุดุงูู ุชุฌุงูุฒ ุณุนุฉ ุงูููุฏุณ. <br><br>  ุชุชููุฒ ูุงุชุงู ุงููุฌููุนุชุงู (PS ู PCS) ุจุนููุงู ุฃุณุงุณู ูุญุฌู ูุฅุฒุงุญุฉ ุญุงููุฉ.  ูุชู ุชุนููู ูุฐู ุงููุนููุงุช ูู ุณุฌูุงุช PSP ู PCSP ุ ููู 128 ุจุช ููู ุงููุฌููุน ุชุญุชุงุฌ ุฅูู ุงูุฅุดุงุฑุฉ ุฅูู ุญููู ูุญุฏุฏุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ูุฑุชูุนุฉ ุฃู ููุฎูุถุฉ).  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฑุชุจุท ุนูู ุงููุฏุณุงุช ุงุฑุชุจุงุทูุง ูุซูููุง ุจููููู ููู ุงูุณุฌู ุ ูุงููุฒูุฏ ุญูู ุฐูู ุฃุฏูุงู.  ูุญุฏุซ ุงูุชูุงุนู ูุน ุงูููู ูู ุฎูุงู ุขููุฉ ุถุฎ / ุชุจุงุฏู ุงูุณุฌูุงุช.  ูุชู ูุนุจ ุฏูุฑ ูุดุท ูู ูุฐู ุงูุขููุฉ ูู ุฎูุงู ูุง ูุณูู "ูุคุดุฑ ุงูุฃุฌูุฒุฉ ุฅูู ุฃุนูู ุงูููุฏุณ" ุงูุฎุงุต ุจุงููุฌููุนุฉ ูู ุงููุนูููุงุช ุงูุฅุฌุฑุงุฆูุฉ ุฃู ุงูููุฏุณุฉ ุ ุนูู ุงูุชูุงูู.  ุนู ุฐูู ุฃูุถุง ุฃุฏูุงู.  ูู ุงูููู ุฃู ุชููู ุจูุงูุงุช ูุฐู ุงููุฏุณุงุช ูู ูู ููุทุฉ ุฒูููุฉ ุฅูุง ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุฃู ูู ููู ุชุณุฌูู. <br><br>  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฃูุถูุง ุฅูู ุฃู ูุฐู ุงููุฏุณุงุช (ุงูููุฏุณ ุงูุฅุฌุฑุงุฆู ููููุฉ ุงููุนูููุงุช ุงูููุฒูุฉ) ุชูุจุฑ.  ููุฏ ุตุงุฏููุง ูุฐุง ุนูุฏูุง ุทุจููุง ุณูุงู_ุงูุชุบููุฑ. <br><br>  ูุชู ุฅุนุทุงุก ููุฏุณ ุงููุณุชุฎุฏู ุฃูุถูุง ุงูุนููุงู ุงูุฃุณุงุณู ูุงูุญุฌู.  ุงููุคุดุฑ ุงูุญุงูู ูู ุงูุณุฌู USD.lo.  ูู ุฌููุฑูุง ุ ุฅููุง ูููุฉ ููุงุณูููุฉ ุชููู.  ููุท ุ ุนูู ุนูุณ ุงููุจุงูู "ุงูุนุงุฏูุฉ" ุ ูุง ุชุชูุงุกู ุงููุนูููุงุช ุงููุงุฑุฏุฉ ูู ุงููุฏุงุฎู ุงูุฃุฎุฑู (ุงูุณุฌูุงุช ูุนูุงููู ุงูุฅุฑุฌุงุน). <br><br>  ูู ุฑุฃูู ุ ุฃุญุฏ ุงููุชุทูุจุงุช ุบูุฑ ุงูููุงุณูุฉ ูุญุฏูุฏ ูุฃุญุฌุงู ุงูููุฏุณุงุช ูู ูุญุงุฐุงุฉ 4 ูููู ุจุงูุช ุ ููุฌุจ ูุญุงุฐุงุฉ ุงูุนููุงู ุงูุฃุณุงุณู ููููุฏุณ ูุญุฌูู ุฅูู 4 ููููุจุงูุช.  ูู ุฃุจููุฉ ุฃุฎุฑู ุ ูู ุฃูุงุจู ูุซู ูุฐุง ุงูุชูููุฏ.  ููุฏ ุตุงุฏููุง ูุฐู ุงูุชูุงุตูู ุ ูุฑุฉ ุฃุฎุฑู ุ ุนูุฏูุง ุทุจููุง ุณูุงู ุงูุชุบููุฑ. <br><br><h3 style=";text-align:right;direction:rtl">  ููุฏูุฉ ููุฌุฒุฉ: ุงูุณุฌูุงุช.  ุชุณุฌูู ุงููููุงุช.  ุชุณุฌูู ุงูููุงูุฐ </h3><br>  ุงูุขู ูุจุนุฏ ุฃู ุงูุชุดููุง ุจุนุถ ุงููุฏุณุงุช ุ ูุญุชุงุฌ ุฅูู ููู ููููุฉ ุชูุฏูู ุงููุนูููุงุช ูููุง.  ููููุงู ุจุฐูู ุ ูุญุชุงุฌ ุฅูู ุชูุฏูู ุงููุฒูุฏ ูู ุงูููุงููู. <br><br>  ููู ุงูุณุฌู (RF) ูู ูุฌููุนุฉ ูู ุฌููุน ุงูุณุฌูุงุช.  ููุงู ูููุงู ููุชุณุฌูู ูุญุชุงุฌููุง: ููู ูุงุญุฏ ูู ูุนูููุงุช ุงูุงุชุตุงู (ููู ุณูุณูุฉ - CF) ุ ูุงูุขุฎุฑ ูุณูู ููู ุงูุชุณุฌูู (RF) ุ ููู ูุฎุฒู ุงูุณุฌูุงุช "ุงูุชุดุบูููุฉ" ุ ูุงูุชู ูุชู ุชุฎุฒูููุง ุนูู ุงูููุฏุณ ุงูุฅุฌุฑุงุฆู. <br><br>  ูุงูุฐุฉ ุงูุชุณุฌูู ูู ุงููุณุงุญุฉ (ูุฌููุนุฉ ุงูุณุฌูุงุช) ูููู ุงูุณุฌู ุงููุชููุฑ ุญุงูููุง. <br><br>  ุณุฃุดุฑุญ ุจูุฒูุฏ ูู ุงูุชูุตูู.  ูุง ูู ูุฌููุนุฉ ูู ุงูุณุฌูุงุช ุ ูู ุงุนุชูุงุฏู ุ ูุง ูุญุชุงุฌ ุฃู ุดุฎุต ุฅูู ุงูุชูุถูุญ. <br><br>  ูู ุงููุนุฑูู ุฌูุฏูุง ุฃู ุฃุญุฏ ุงูุงุฎุชูุงูุงุช ูู ุจููุฉ x86 ูู ุจุงูุชุญุฏูุฏ ุนุฏุฏ ุตุบูุฑ ูู ุงูุณุฌูุงุช.  ูู ุฃุจููุฉ RISC ูุน ุงูุณุฌูุงุช ุ ูููู ุงูุฃูุฑ ุฃูุซุฑ ุจุณุงุทุฉ ุ ูุนุงุฏุฉ ูุง ูููู ุญูุงูู 16 ุณุฌููุง ุ ูููุง ุนุฏุฉ (2-3) ูุดุบููุฉ ูุชูุจูุฉ ุงูุงุญุชูุงุฌุงุช ุงูุฑุณููุฉ.  ููุงุฐุง ูุง ุชููู ููุท ุจุชุณุฌูู 128 ุชุณุฌูููุง ุ ูุฃูู ูุจุฏู ุฃู ูุฐุง ุณูุฒูุฏ ูู ุฃุฏุงุก ุงููุธุงูุ  ุงูุฅุฌุงุจุฉ ุจุณูุทุฉ ููุบุงูุฉ: ุชุญุชุงุฌ ุฅุฑุดุงุฏุงุช ุงููุนุงูุฌ ุฅูู ููุงู ูุชุฎุฒูู ุนููุงู ุงูุชุณุฌูู ุ ูุฅุฐุง ูุงู ููุงู ุงููุซูุฑ ูููุง ุ ูููุงู ุญุงุฌุฉ ุฅูู ุงููุซูุฑ ูู ุงูุจุชุงุช ูู ูุฐุง ุงูุตุฏุฏ.  ูุฐูู ุ ูุฐูุจูู ุฅูู ุฌููุน ุฃููุงุน ุงูุญูู ุ ููููููู ุจุชุณุฌููุงุช ุงูุธู ุ ูุชุณุฌูู ุงูุจููู ุ ูุงูููุงูุฐ ุ ูููู ุฌุฑุง.  ุจูุงุณุทุฉ ุณุฌูุงุช ุงูุธู ุ ุฃุนูู ูุจุฏุฃ ุชูุธูู ุงูุณุฌู ูู ุฃุฑููููุง.  ูู ุญุงูุฉ ุญุฏูุซ ููุงุทุนุฉ ุฃู ุญุงูุฉ ุฃุฎุฑู ุ ุชููู ููุงู ูุฌููุนุฉ ูุฎุชููุฉ ูู ุงูุณุฌูุงุช ุงูุชู ุชุญูู ููุณ ุงูุฃุณูุงุก (ุงูุฃุฑูุงู) ูุชููุฑุฉ ุ ุจูููุง ุชุธู ุงููุนูููุงุช ุงููุฎุฒูุฉ ูู ุงููุฌููุนุฉ ุงูุฃุตููุฉ ููุฌูุฏุฉ.  ุชุณุฌูู ุงูุจููู ุ ูู ุงููุงูุน ุ ูุดุจู ุฅูู ุญุฏ ูุจูุฑ ุณุฌูุงุช ุงูุธู ุ ุจุจุณุงุทุฉ ูุง ููุฌุฏ ุชุจุฏูู ุฃุฌูุฒุฉ ููุฌููุนุงุช ุงูุชุณุฌูู ุ ููุฎุชุงุฑ ุงููุจุฑูุฌ ุฃู ุจูู (ูุฌููุนุฉ ูู ุงูุณุฌูุงุช) ููุงุชุตุงู ุงูุขู. <br><br>  ุชู ุชุตููู ููุงูุฐ ุงูุชุณุฌูู ูุชุญุณูู ุงูุนูู ุจุงุณุชุฎุฏุงู ุงูููุฏุณ.  ููุง ุชุนูููู ุ ูู ุงููููู "ุงูุนุงุฏู" ุ ุชููู ุจุฅุฏุฎุงู ุฅุฌุฑุงุก ูุง ุ ูุญูุธ ุงูุณุฌูุงุช ุฅูู ุงูููุฏุณ (ุฃู ุญูุธ ุฅุฌุฑุงุก ุงูุงุณุชุฏุนุงุก ูุนุชูุฏ ุนูู ุงูุงุชูุงููุฉ) ูููููู ุงุณุชุฎุฏุงู ุงูุณุฌูุงุช ุ ูุฃู ุงููุนูููุงุช ูุฎุฒูุฉ ุจุงููุนู ุนูู ุงูููุฏุณ.  ููู ุงููุตูู ุฅูู ุงูุฐุงูุฑุฉ ุจุทูุก ุ ูุจุงูุชุงูู ูุฌุจ ุชุฌูุจู.  ุนูุฏ ุฅุฏุฎุงู ุงูุฅุฌุฑุงุก ุ ููุฌุนู ููุท ูุฌููุนุฉ ุฌุฏูุฏุฉ ูู ุงูุณุฌูุงุช ูุชุงุญุฉ ุ ุณูุชู ุญูุธ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ุนูู ุงูุณุฌู ุงููุฏูู ุ ููุง ูุนูู ุฃูู ูุณุช ุจุญุงุฌุฉ ุฅูู ุชูุฑูุบูุง ูู ุงูุฐุงูุฑุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ุนูุฏ ุงูุฑุฌูุน ุฅูู ุฅุฌุฑุงุก ุงูุงุณุชุฏุนุงุก ุ ุณุชุนูุฏ ูุงูุฐุฉ ุงูุชุณุฌูู ุงูุณุงุจูุฉ ุฃูุถูุง ุ ูุจุงูุชุงูู ุ ุณุชููู ุฌููุน ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ุนูู ุงูุณุฌูุงุช ุฐุงุช ุตูุฉ.  ูุฐุง ูู ููููู ูุงูุฐุฉ ุงูุชุณุฌูู. <br><br><img src="https://habrastorage.org/webt/lg/5e/6u/lg5e6u_pfus75yedi6hefckkqkk.png"><br><br>  ูู ุงููุงุถุญ ุฃูู ูุง ุชุฒุงู ุจุญุงุฌุฉ ุฅูู ุญูุธ ุงูุณุฌูุงุช ุนูู ุงูููุฏุณ (ูู ุงูุฐุงูุฑุฉ) ุ ูููู ูููู ุงูููุงู ุจุฐูู ุนูุฏ ุงูุชูุงุก ููุงูุฐ ุงูุชุณุฌูู ุงููุฌุงููุฉ. <br><br>  ููุงุฐุง ุชูุนู ูุน ุณุฌูุงุช ุงููุฏุฎูุงุช ูุงููุฎุฑุฌุงุช (ุงูุญุฌุฌ ุนูุฏ ุฅุฏุฎุงู ุงููุธููุฉ ูุงููุชูุฌุฉ ุงูุชู ุชู ุฅุฑุฌุงุนูุง)ุ  ุฏุน ุงููุงูุฐุฉ ุชุญุชูู ุนูู ุฌุฒุก ูู ุงูุณุฌูุงุช ุงููุฑุฆูุฉ ูู ุงููุงูุฐุฉ ุงูุณุงุจูุฉ ุ ูุจุดูู ุฃูุซุฑ ุฏูุฉ ุ ุณูููู ุฌุฒุก ูู ุงูุณุฌูุงุช ูุชุงุญูุง ูููุง ุงูููุงูุฐ.  ุซู ุ ุจุดูู ุนุงู ุ ุนูุฏ ุงุณุชุฏุนุงุก ุงููุธููุฉ ุ ูุง ููุฒูู ุงููุตูู ุฅูู ุงูุฐุงูุฑุฉ.  ูููุชุฑุถ ุฃู ุณุฌูุงุชูุง ุชุจุฏู ููุฐุง <br><br><img src="https://habrastorage.org/webt/n9/ki/zw/n9kizwn2qkag4rew2jspyassaco.png"><br><br>  ุฃู ุฃู r0 ูู ุงููุงูุฐุฉ ุงูุฃููู ุณูููู ูู ููุณ ุงูุณุฌู ูุซู r2 ูู ุตูุฑ ุ ู r1 ูู ุงููุงูุฐุฉ ุงูุฃููู ูู ููุณ ุงูุณุฌู ูุซู r3.  ุจูุนูู ุ ุงููุชุงุจุฉ ูู r2 ูุจู ุงุณุชุฏุนุงุก ุงูุฅุฌุฑุงุก (ุชุบููุฑ ุฑูู ุงููุงูุฐุฉ) ูุญุตู ุนูู ุงููููุฉ ูู r0 ูู ุงูุฅุฌุฑุงุก ุงููุฏุนู.  ูุณูู ูุฐุง ุงููุจุฏุฃ ุขููุฉ ุชุฏููุฑ ุงูููุงูุฐ. <br><br>  ุฏุนููุง ูุญุณู ุฃูุซุฑ ููููุงู ุ ูุฃู ุงููุจุฏุนูู ูู Elbrus ูุนููุง ุฐูู.  ุฏุน ุงูููุงูุฐ ุงูุชู ูุฏููุง ูู ุชููู ุฐุงุช ุญุฌู ุซุงุจุช ุ ูููู ูุชุบูุฑ ุ ูููู ุถุจุท ุญุฌู ุงููุงูุฐุฉ ูู ููุช ุงูุฏุฎูู ูู ุงูุฅุฌุฑุงุก.  ุณููุนู ููุณ ุงูุดูุก ูุน ุนุฏุฏ ุงูุณุฌูุงุช ุงููุฏูุฑุฉ.  ุณูููุฏูุง ูุฐุง ุจุงูุทุจุน ุฅูู ุจุนุถ ุงููุดููุงุช ุ ูุฃูู ูู ุงูููุงูุฐ ุงูููุงุณูููุฉ ุงููุงุจูุฉ ููุชุฏููุฑ ุ ููุฌุฏ ููุฑุณ ูุงูุฐุฉ ูุชู ูู ุฎูุงูู ุชุญุฏูุฏ ุฃูู ุจุญุงุฌุฉ ุฅูู ุญูุธ ุงูุจูุงูุงุช ูู ููู ุงูุชุณุฌูู ุนูู ุงูููุฏุณ ุฃู ุชุญูููู.  ูููู ุฅุฐุง ูู ุชูู ุจุฅุฏุฎุงู ููุฑุณ ุงููุงูุฐุฉ ุ ูููู ููุฑุณ ุงูุณุฌู ุงูุฐู ูุจุฏุฃ ููู ุฅุทุงุฑูุง ุงูุญุงูู ุ ููู ุชูุดุฃ ูุฐู ุงููุดููุฉ.  ูู Elbrus ุ ุชูุฌุฏ ูุฐู ุงููุคุดุฑุงุช ูู ุณุฌูุงุช PSHTP (ูููุฏุณ ุฅุฌุฑุงุกุงุช PS) ู PCSHTP (ูููุฏุณ ุงููุนูููุงุช ุงูุฅุฌุฑุงุฆูุฉ PCS).  ุชุดูุฑ ุงููุซุงุฆู ุฅูู "ูุคุดุฑุงุช ุงูุฃุฌูุฒุฉ ุฅูู ุฃุนูู ุงูููุฏุณ".  ุงูุขู ููููู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู ููุฑุงุกุฉ ุญูู ุงููุฏุณุงุช ุ ูุฃุนุชูุฏ ุฃูู ุณูููู ุฃูุซุฑ ูุถูุญูุง. <br><br>  ููุง ูููุช ุ ูุฅู ูุฐู ุงูุขููุฉ ุชุนูู ุฃู ูุฏูู ุงููุฏุฑุฉ ุนูู ุงูุชุญูู ูู ูุง ูู ููุฌูุฏ ูู ุงูุฐุงูุฑุฉ.  ููุฐุง ูู ุ ูุฒุงููุฉ ููู ุงูุชุณุฌูู ูุงูููุฏุณ.  ุฃุนูู ูุจุฑูุฌ ุงููุธุงู.  ุฅุฐุง ููุช ูุจุฑูุฌ ุชุทุจูู ุ ูุณูู ูููุฑ ุงูุฌูุงุฒ ุฅุฏุฎุงููุง ุดูุงููุง ูุงูุฎุฑูุฌ ูู ุงูุฅุฌุฑุงุก.  ุฃู ุฅุฐุง ูู ุชูู ููุงู ุณุฌูุงุช ูุงููุฉ ุนูุฏ ูุญุงููุฉ ุชุญุฏูุฏ ูุงูุฐุฉ ุฌุฏูุฏุฉ ุ ูุณูู "ูุงูุฐุฉ ุงูุชุณุฌูู" ุณุชููุฐ ุชููุงุฆููุง.  ูู ูุฐู ุงูุญุงูุฉ ุ ุณูุชู ุญูุธ ุฌููุน ุงูุจูุงูุงุช ูู ููู ุงูุณุฌู ุนูู ุงูููุฏุณ ุงูููุงุณุจ (ูู ุงูุฐุงูุฑุฉ) ุ ูุณูุชู ุฅุนุงุฏุฉ ุชุนููู "ุงููุคุดุฑ ุฅูู ุฃุนูู ุงูุฌูุงุฒ ูู ุงูููุฏุณ" (ููุฑุณ ุงูุฅุฒุงุญุฉ) ุฅูู ุตูุฑ.  ูุจุงููุซู ุ ูุญุฏุซ ุชุจุฏูู ููู ุชุณุฌูู ูู ุงูููุฏุณ ุชููุงุฆููุง.  ูููู ุฅุฐุง ููุช ุชุนูู ุนูู ุชุทููุฑ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชุจุฏูู ุงูุณูุงู ุ ููู ูุง ูุนููุงู ุจุงูุถุจุท ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุขููุฉ ููุนูู ูุน ุงูุฌุฒุก ุงููุฎูู ูู ููู ุงูุชุณุฌูู.  ูู Elbrus ุ ูุชู ุงุณุชุฎุฏุงู ุงูุฃูุงูุฑ FLUSHR ู FLUSHC ููุฐุง ุงูุบุฑุถ.  FLUSHR - ูุญู ููู ุงูุณุฌู ุ ูุชู ูุณุญ ุฌููุน ุงูููุงูุฐ ุจุงุณุชุซูุงุก ุงููุงูุฐุฉ ุงูุญุงููุฉ ุฅูู ุงูููุฏุณ ุงูุฅุฌุฑุงุฆู ุ ูุจุงูุชุงูู ูุชู ุฅุนุงุฏุฉ ุชุนููู ููุฑุณ PSHTP ุฅูู ุงูุตูุฑ.  FLUSHC - ููุธู ููู ูุนูููุงุช ุงูุฑุจุท ุ ูุชู ุฅููุงุก ูู ุดูุก ูุง ุนุฏุง ุงููุงูุฐุฉ ุงูุญุงููุฉ ุนูู ููุฏุณ ูุนูููุงุช ุงูุฑุจุท ุ ููุง ุชุชู ุฅุนุงุฏุฉ ุชุนููู ููุฑุณ PCSHTP ุฅูู ุงูุตูุฑ. <br><br><h3 style=";text-align:right;direction:rtl">  ููุฏูุฉ ููุฌุฒุฉ: ุงูุชูููุฐ ูู Elbrus </h3><br>  ุงูุขู ููุฏ ูุงูุดูุง ุงูุนูู ุบูุฑ ุงููุงุถุญ ูุน ุงูุณุฌูุงุช ูุงูููุฏุณุงุช ุ ุณูุชุญุฏุซ ุจุดูู ุฃูุซุฑ ุชุญุฏูุฏุงู ุนู ุงูููุงูู ุงููุฎุชููุฉ ูู Elbrus. <br><br>  ุนูุฏูุง ูุฏุฎู ุงููุธููุฉ ุงูุชุงููุฉ ุ ููุดุฆ ุงููุนุงูุฌ ูุงูุฐุชูู: ูุงูุฐุฉ ุนูู ูููุฉ PS ููุงูุฐุฉ ุนูู ูููุฉ PCS. <br><br>  ุชุญุชูู ูุงูุฐุฉ ูู ููุฏุณ PCS ุนูู ุงููุนูููุงุช ุงููุงุฒูุฉ ููุฑุฌูุน ูู ุฏุงูุฉ: ุนูู ุณุจูู ุงููุซุงู ุ IP (ูุคุดุฑ ุงูุชุนูููุงุช) ุงูุฎุงุต ุจุงูุชุนููู ุงูุฐู ุณุชุญุชุงุฌ ุฅููู ููุนูุฏุฉ ูู ุงููุธููุฉ.  ูุน ูุฐุง ุ ูู ุดูุก ุฃูุซุฑ ุฃู ุฃูู ูุถูุญุง. <br><br>  ุงููุงูุฐุฉ ุนูู ููุฏุณ PS ุงุตุนุจ ููููุงู.  ูุชู ุชูุฏูู ููููู ุณุฌูุงุช ุงููุงูุฐุฉ ุงูุญุงููุฉ.  ูู ูุฐู ุงููุงูุฐุฉ ุ ููููู ุงููุตูู ุฅูู ุณุฌูุงุช ุงููุงูุฐุฉ ุงูุญุงููุฉ -ูช dr0 ุูช dr1 ุ ... ุูช dr15 ุ ... ููุฐุง ุจุงููุณุจุฉ ููุง ุ ููุณุชุฎุฏู ุ ูุชู ุชุฑููููุง ุฏุงุฆููุง ูู 0 ุ ูููู ูุฐุง ุงูุชุฑููู ุจุงููุณุจุฉ ุฅูู ุงูุนููุงู ุงูุฃุณุงุณู ููุฅุทุงุฑ ุงูุญุงูู.  ูู ุฎูุงู ูุฐู ุงูุณุฌูุงุช ุ ูุชู ุชูุฑูุฑ ุงููุณุงุฆุท ุนูุฏ ุงุณุชุฏุนุงุก ุงููุธููุฉ ุ ููุชู ุฅุฑุฌุงุน ุงููููุฉ ุ ููุชู ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ูุณุฌูุงุช ููุฃุบุฑุงุถ ุงูุนุงูุฉ ุฏุงุฎู ุงููุธููุฉ.  ูู ุงููุงูุน ุ ุชู ุชูุถูุญ ุฐูู ุนูุฏ ุงููุธุฑ ูู ุขููุฉ ุชุฏููุฑ ููุงูุฐ ุงูุณุฌู. <br><br>  ูููู ุงูุชุญูู ูู ุญุฌู ูุงูุฐุฉ ุงูุชุณุฌูู ูู Elbrus.  ูุฐุง ุ ููุง ููุช ุ ุถุฑูุฑู ููุชุญุณูู.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฅุญุฏู ุงููุธุงุฆู ุ ูุญุชุงุฌ ุฅูู 4 ุณุฌูุงุช ููุท ูุชูุฑูุฑ ุงููุณุงุฆุท ูุจุนุถ ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ุ ููู ูุฐู ุงูุญุงูุฉ ููุฑุฑ ุงููุจุฑูุฌ (ุฃู ุงููุชุฑุฌู) ุนุฏุฏ ุงูุณุฌูุงุช ุงููุฑุงุฏ ุชุฎุตูุตูุง ูููุธููุฉ ุ ูุจูุงุกู ุนูู ุฐูู ูุญุฏุฏ ุญุฌู ุงููุงูุฐุฉ.  ูุชู ุถุจุท ุญุฌู ุงููุงูุฐุฉ ุจูุงุณุทุฉ ุนูููุฉ setwd: <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs">setwd wsz=<span class="hljs-number"><span class="hljs-number">0x10</span></span></code> </pre> <br>  ูุญุฏุฏ ุญุฌู ุงููุงูุฐุฉ ูู ุญูุซ ุงูุณุฌูุงุช ุงูุฑุจุงุนูุฉ (ุณุฌูุงุช 128 ุจุช). <br><br><img src="https://habrastorage.org/webt/tf/ov/px/tfovpxrj1wkos3e29zsl0fj_8p8.png"><br><br>  ุงูุขู ุ ูููุชุฑุถ ุฃูู ุชุฑูุฏ ุงุณุชุฏุนุงุก ุฏุงูุฉ ูู ูุธููุฉ.  ููุฐุง ุงูุบุฑุถ ุ ูุชู ุชุทุจูู ุงูููููู ุงูููุตูู ุจุงููุนู ูุฅุทุงุฑ ุงูุชุณุฌูู ุงูููุฏุงุฑ.  ุชูุธูุฑ ุงูุตูุฑุฉ ุฃุนูุงู ุฌุฒุกูุง ูู ููู ุงูุณุฌู ุญูุซ ุชููู ุฏุงูุฉ ุฐุงุช ูุงูุฐุฉ 1 (ุฎุถุฑุงุก) ุจุงุณุชุฏุนุงุก ูุธููุฉ ุฐุงุช ูุงูุฐุฉ 2 (ุจุฑุชูุงููุฉ).  ูู ูู ูู ูุงุชูู ุงููุธููุชูู ุ ุณุชุชููู ูู ุงููุตูู ุฅูููช dr0 ุูช dr1 ุ ... ูููู ุณูุชู ุชูุฑูุฑ ุงููุณุงุฆุท ุนุจุฑ ูุง ูุณูู ุงูุณุฌูุงุช ุงูุฏูุงุฑุฉ.  ุจูุนูู ุขุฎุฑ ุ ุณูุตุจุญ ุฌุฒุก ูู ุณุฌูุงุช ุงููุงูุฐุฉ 1 ุณุฌูุงุช ุงููุงูุฐุฉ 2 (ูุงุญุธ ุฃู ูุฐูู ุงูุฅุทุงุฑูู ูุชูุงุทุนุงู).  ูุชู ุชุนููู ูุฐู ุงูุณุฌูุงุช ุฃูุถูุง ูู ุงููุงูุฐุฉ (ุงูุธุฑ ุณุฌูุงุช ุงูุฑูุชุงุฑู ูู ุงูุตูุฑุฉ) ูููุง ุงูุนููุงููช db [0] ุูช db [1] ุ ... ูุจุงูุชุงูู ุ ูุฅู ุณุฌููช dr0 ูู ุงููุงูุฐุฉ 2 ููุณ ุฃูุซุฑ ูููช db [0] ุงูุชุณุฌูู ูู ูุงูุฐุฉ 1. <br><br>  ูุชู ุชุนููู ูุงูุฐุฉ ุชุณุฌูู ุงูุชูุงูุจ ุจูุงุณุทุฉ ุนูููุฉ setbn: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"> setbn rbs = <span class="hljs-number"><span class="hljs-number">0x3</span></span>, rsz = <span class="hljs-number"><span class="hljs-number">0x8</span></span></code> </pre> <br>  ูุญุฏุฏ rbs ุญุฌู ุงููุงูุฐุฉ ุงููุณุชุฏูุฑุฉ ุ ููููู rsz ุจุชุนููู ุงูุนููุงู ุงูุฃุณุงุณู ุ ูููู ุจุงููุณุจุฉ ุฅูู ูุงูุฐุฉ ุงูุชุณุฌูู ุงูุญุงููุฉ.  ุฃู  ููุง ุฎุตุตูุง 3 ุณุฌูุงุช ุ ุจุฏุกูุง ูู ุงูุซุงูู. <br><br>  ุจูุงุกู ุนูู ูุง ุชูุฏู ุ ูุนุฑุถ ููู ุชุจุฏู ูุธููุฉ ุงูููุงููุฉ.  ููุจุณุงุทุฉ ุ ููุชุฑุถ ุฃู ุงูุฏุงูุฉ ุชุฃุฎุฐ ุญุฌุฉ ูุงุญุฏุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a)</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre> <br>  ุซู ุ ูุงุณุชุฏุนุงุก ูุฐู ุงููุธููุฉ ุ ุชุญุชุงุฌ ุฅูู ุฅุนุฏุงุฏ ูุงูุฐุฉ ูู ุงูุณุฌูุงุช ุงูุฏูุงุฑุฉ (ููุฏ ูุนููุง ูุฐุง ุจุงููุนู ุนุจุฑ setbn).  ุจุนุฏ ุฐูู ุ ูู ุณุฌููช db0 ูุถุน ุงููููุฉ ุงูุชู ุณูุชู ุชูุฑูุฑูุง ุฅูู my_func.  ุจุนุฏ ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุงุณุชุฏุนุงุก ุชุนูููุงุช CALL ููุง ุชูุณ ุฃู ุชุฎุจุฑูุง ุฃูู ุชุจุฏุฃ ูุงูุฐุฉ ุงูุณุฌูุงุช ุงูููุฏุงุฑุฉ.  ูููู ุจุชุฎุทู ุงูุฅุนุฏุงุฏ ููุงุณุชุฏุนุงุก (ุงูุฃูุฑ disp) ุงูุขู ุ ูุฃูู ููุณ ุญุณุงุณูุง ูุญุงูุฉ ุงูุฃุญุฑู.  ูุชูุฌุฉ ูุฐูู ุ ูู ุงููุฌูุน ุ ูุฌุจ ุฃู ุชุจุฏู ุงูุฏุนูุฉ ุฅูู ูุฐู ุงููุธููุฉ ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"> addd <span class="hljs-number"><span class="hljs-number">0</span></span>, %dr9, %db[<span class="hljs-number"><span class="hljs-number">0</span></span>] disp %ctpr1, my_func call %ctpr1, wbs = <span class="hljs-number"><span class="hljs-number">0x8</span></span></code> </pre> <br>  ูุฐูู ุ ูุน ุณุฌูุงุช ุงุญุณุจ ููููุง.  ุงูุขู ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ูููุฉ ุงููุนูููุงุช ุงูููุฒูุฉ.  ูุฎุฒู ุณุฌูุงุช CR ุงููุฒุนููุฉ.  ูู ุงููุงูุน ุ ุงุซูุงู - CR0 ุ CR1.  ูุชุญุชูู ุจุงููุนู ุนูู ุงููุนูููุงุช ุงููุงุฒูุฉ ููุนูุฏุฉ ูู ุงููุธููุฉ. <br><br><img src="https://habrastorage.org/webt/rc/8q/kl/rc8qklg-pb3tgwv3jjz_8pc6l3g.png"><br><br>  ุงูุณุฌูุงุช CR0 ู CR1 ูู ูุงูุฐุฉ ุงููุธููุฉ ุงูุชู ุชุณูู ุงููุธููุฉ ูุน ุงูุณุฌูุงุช ุงููููุฒุฉ ุจุงูููู ุงูุจุฑุชูุงูู ูู ุจุงูููู ุงูุฃุฎุถุฑ.  ุชุญุชูู ุณุฌูุงุช CR0 ุนูู ูุคุดุฑ ุงูุชุนูููุงุช ุงูุฎุงุต ุจูุธููุฉ ุงูุงุณุชุฏุนุงุก ูููู ุชูููู ูุนูู (ููู PF-Predicate) ุ ูุตุฉ ุนู ุฐูู ูู ุจุงูุชุฃููุฏ ุฎุงุฑุฌ ูุทุงู ูุฐู ุงูููุงูุฉ. <br><br>  ุชุญุชูู ุณุฌูุงุช CR1 ุนูู ุจูุงูุงุช ูุซู PSR (ุญุงูุฉ ูุนุงูุฌ ุงููุตูุต) ุ ุฑูู ุงููุงูุฐุฉ ุ ุฃุญุฌุงู ุงููุงูุฐุฉ ุ ููุง ุฅูู ุฐูู.  ูู Elbrus ุ ูู ุดูุก ูุฑู ูุฏุฑุฌุฉ ุฃู ูู ุฅุฌุฑุงุก ูุฎุฒู ุงููุนูููุงุช ูู CR1 ุญุชู ุญูู ูุง ุฅุฐุง ูุงู ูุชู ุชุถููู ุนูููุฉ ุงููุงุตูุฉ ุงูุนุงุฆูุฉ ูู ุงูุฅุฌุฑุงุก ุ ูุณุฌู ูุญุชูู ุนูู ูุนูููุงุช ุญูู ุงุณุชุซูุงุกุงุช ุงูุจุฑุงูุฌ ุ ูููู ููุฐุง ุ ุจุงูุทุจุน ุ ุนููู ุฃู ุชุฏูุน ููุงุจู ุญูุธ ูุนูููุงุช ุฅุถุงููุฉ. <br><br>  ูู ุงูููู ุฌุฏูุง ุฃูุง ููุณู ุฃู ููู ุงูุชุณุฌูู ูููู ูุนูููุงุช ุงูุฑุจุท ูููู ุถุฎููุง ูุงุณุชุจุฏุงูููุง ุจุงูุฐุงูุฑุฉ ุงูุฑุฆูุณูุฉ ูุงูุนูุณ ุตุญูุญ (ูู ููุฏุณุงุช PS ู PCS ุงูููุถุญุฉ ุฃุนูุงู).  ูุฐู ุงูููุทุฉ ูููุฉ ุนูุฏ ุชุทุจูู setjmp ุงูููุตูู ูุงุญููุง. <br><br><h3 style=";text-align:right;direction:rtl">  SETJMP / LONGJMP </h3><br>  ูุฃุฎูุฑูุง ุ ุนูู ุงูุฃูู ุจุทุฑููุฉ ูุง ููู ููููุฉ ุชุฑุชูุจ ูุฌููุนุงุช ุงูุจูุงูุงุช ูุงูุณุฌูุงุช ูู Elbrus ุ ููููู ุงูุจุฏุก ูู ุงูููุงู ุจุดูุก ูููุฏ ุ ุฃู ุฅุถุงูุฉ ูุธุงุฆู ุฌุฏูุฏุฉ ุฅูู Embox. <br><br>  ูู Embox ุ ูุชุทูุจ ูุธุงู ุงุฎุชุจุงุฑ ุงููุญุฏุฉ setjmp / longjmp ุ ูุฐูู ูุงู ุนูููุง ุชูููุฐ ูุฐู ุงููุธุงุฆู. <br><br>  ููุชูููุฐ ุ ูุฌุจ ุญูุธ / ุงุณุชุนุงุฏุฉ ุงูุณุฌูุงุช: CR0 ุ CR1 ุ PSP ุ PCSP ุ USD ุ - ุจุงููุนู ูุฃูููุฉ ููุง ูู ููุฏูุฉ ููุฌุฒุฉ.  ูู ุงููุงูุน ุ ูุชู ุชูููุฐ ุงูุญูุธ / ุงูุงุณุชุนุงุฏุฉ ูู ุฌุจูููุง ุ ููู ููุงู ูุงุฑููุง ูุจูุฑูุง ุชู ุงูุชูููุญ ุฅููู ุบุงูุจูุง ูู ูุตู ุงูููุฏุณุงุช ูุงูุณุฌูุงุช ุ ููู: ูุฌุจ ุฃู ุชุชู ูุฒุงููุฉ ุงูููุฏุณุงุช ุ ูุฃููุง ุชูุน ููุณ ููุท ูู ุงูุฐุงูุฑุฉ ุ ูููู ุฃูุถูุง ูู ููู ุงูุชุณุฌูู.  ุชุนูู ูุฐู ุงููุฑูู ุงูุฏูููุฉ ุฃูู ุจุญุงุฌุฉ ุฅูู ุงูุนูุงูุฉ ุจุงูุนุฏูุฏ ูู ุงูููุฒุงุช ุ ูุงูุชู ุจุฏูููุง ูู ูุนูู ุฃู ุดูุก. <br><br>  ุงูููุฒุฉ ุงูุฃููู ูู ุชุนุทูู ุงูููุงุทุนุงุช ุฃุซูุงุก ุงูุญูุธ ูุงูุงุณุชุนุงุฏุฉ.  ุนูุฏ ุงุณุชุนุงุฏุฉ ุงูููุงุทุนุฉ ุ ูู ุงูุถุฑูุฑู ุญุธุฑูุง ุ ูุฅูุง ููุฏ ููุดุฃ ูููู ูุฏุฎู ููู ูุนุงูุฌ ุงูููุงุทุนุฉ ูุน ููุฏุณุงุช ูุตู ุชุจุฏูู (ูู ุฅุดุงุฑุฉ ุฅูู ุถุฎ ุชุจุงุฏู ููู ุงูุชุณุฌูู ุงูููุถุญ ูู "ุงููุตู ุงููุฎุชุตุฑ").  ูุนูุฏ ุงูุญูุธ ุ ุชููู ุงููุดููุฉ ูู ุฃูู ุจุนุฏ ุงูุฏุฎูู ุฅูู ุงูููุงุทุนุฉ ูุงูุฎุฑูุฌ ูููุง ุ ูููู ูููุนุงูุฌ ูุฑุฉ ุฃุฎุฑู ุชุจุฏูู ุฌุฒุก ูู ููู ุงูุชุณุฌูู ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู (ูุณูุคุฏู ุฐูู ุฅูู ุชุฏููุฑ ุงูุดุฑูุท ุงูุซุงุจุชุฉ PSHTP = 0 ู PSCHTP = 0 ุ ูุงููุฒูุฏ ุนููุง).  ูุฐุง ูู ุงูุณุจุจ ุ ูู ูู ูู setjmp ู longjmp ุ ูุฌุจ ุชุนุทูู ุงูููุงุทุนุงุช.  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ููุง ุฃูุถูุง ุฅูู ุฃู ุงููุชุฎุตุตูู ูู MCST ูุฏ ูุตุญูุงูุง ุจุงุณุชุฎุฏุงู ุงูุฃููุงุณ ุงูุฐุฑูุฉ ุจุฏูุงู ูู ุชุนุทูู ุงูููุงุทุนุงุช ุ ููู ูู ุงูููุช ุงูุญุงูู ุ ูุญู ูุณุชุฎุฏู ุงูุชูููุฐ ุงูุฃุจุณุท (ุงูููููู ููุง). <br><br>  ุชุชุนูู ุงูููุฒุฉ ุงูุซุงููุฉ ุจุถุฎ / ุถุฎ ููู ุชุณุฌูู ูู ุงูุฐุงูุฑุฉ.  ูุฐุง ุนูู ุงููุญู ุงูุชุงูู.  ุญุฌู ููู ุงูุชุณุฌูู ูุญุฏูุฏ ูุจุงูุชุงูู ูุชู ุถุฎู ูู ุงูุฐุงูุฑุฉ ูุงูุนูุณ ุตุญูุญ.  ูุฐูู ุ ุฅุฐุง ูููุง ุจุจุณุงุทุฉ ุจุญูุธ ููู ุณุฌูุงุช PSP ู PSHTP ุ ูุณูู ูุตูุญ ูููุฉ ุงููุคุดุฑ ุงูุญุงูู ูู ุงูุฐุงูุฑุฉ ููู ููู ุงูุชุณุฌูู.  ูููู ูุธุฑูุง ูุฃู ููู ุงูุณุฌู ูุชุบูุฑ ุ ูุฅูู ูู ููุช ุงุณุชุนุงุฏุฉ ุงูุณูุงู ุ ุณูู ูุดูุฑ ุฅูู ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ ุจุงููุนู (ูููุณ ุชูู ุงูุชู "ุญูุธูุง").  ูุชุฌูุจ ุฐูู ุ ุชุญุชุงุฌ ุฅูู ูุณุญ ููู ุงูุณุฌู ุจุฃูููู ูู ุงูุฐุงูุฑุฉ.  ูุจุงูุชุงูู ุ ุนูุฏ ุงูุญูุธ ูู setjmp ุ ูุฏููุง ุณุฌูุงุช PSP.ind ูู ุงูุฐุงูุฑุฉ ูุณุฌูุงุช PSHTP.ind ูู ูุงูุฐุฉ ุงูุชุณุฌูู.  ุงุชุถุญ ุฃูู ุจุญุงุฌุฉ ุฅูู ุญูุธ ุณุฌูุงุช PCSP.ind + PCSHTP.ind ุจุฃููููุง.  ูููุง ููู ุงููุธููุฉ ุงูุชู ุชููุฐ ูุฐู ุงูุนูููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* First arg is PCSP, 2nd arg is PCSHTP * Returns new PCSP value with updated PCSP.ind */</span></span> .type update_pcsp_ind,@function $update_pcsp_ind: setwd wsz = <span class="hljs-number"><span class="hljs-number">0x4</span></span>, nfx = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Here and below, 10 is size of PCSHTP.ind. Here we * extend the sign of PCSHTP.ind */</span></span> shld %dr1, (<span class="hljs-number"><span class="hljs-number">64</span></span> - <span class="hljs-number"><span class="hljs-number">10</span></span>), %dr1 shrd %dr1, (<span class="hljs-number"><span class="hljs-number">64</span></span> - <span class="hljs-number"><span class="hljs-number">10</span></span>), %dr1 <span class="hljs-comment"><span class="hljs-comment">/* Finally, PCSP.ind += PCSHTP.ind */</span></span> addd %dr1, %dr0, %dr0 E2K_ASM_RETURN</code> </pre> <br>  ูู ุงูุถุฑูุฑู ุฃูุถูุง ุชูุถูุญ ููุทุฉ ุตุบูุฑุฉ ูู ูุฐุง ุงูุฑูุฒ ุงูููุตููุฉ ูู ุงูุชุนููู ุ ุฃู ุฃูู ุชุญุชุงุฌ ุฅูู ุชูุณูุน ุงูุญุฑู ุจุฑูุฌููุง ูู ููุฑุณ PCSHTP.ind ุ ูุฃู ุงูููุฑุณ ูููู ุฃู ูููู ุณุงูุจูุง ูุชุฎุฒููู ูู ุฑูุฒ ุฅุถุงูู.  ููููุงู ุจุฐูู ุ ููุชูู ุฃููุงู ุฅูู (64-10) ุฅูู ุงููุณุงุฑ (ุชุณุฌูู 64 ุจุช) ุ ุฅูู ุญูู 10 ุจุช ุ ุซู ุนุฏูุง. <br><br>  ุงูุดูุก ููุณู ููุทุจู ุนูู PSP (ุฑุตุฉ ุงูุฅุฌุฑุงุก) <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* First arg is PSP, 2nd arg is PSHTP * Returns new PSP value with updated PSP.ind */</span></span> .type update_psp_ind,@function $update_psp_ind: setwd wsz = <span class="hljs-number"><span class="hljs-number">0x4</span></span>, nfx = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Here and below, 12 is size of PSHTP.ind. Here we * extend the sign of PSHTP.ind as stated in documentation */</span></span> shld %dr1, (<span class="hljs-number"><span class="hljs-number">64</span></span> - <span class="hljs-number"><span class="hljs-number">12</span></span>), %dr1 shrd %dr1, (<span class="hljs-number"><span class="hljs-number">64</span></span> - <span class="hljs-number"><span class="hljs-number">12</span></span>), %dr1 muld %dr1, <span class="hljs-number"><span class="hljs-number">2</span></span>, %dr1 <span class="hljs-comment"><span class="hljs-comment">/* Finally, PSP.ind += PSHTP.ind */</span></span> addd %dr1, %dr0, %dr0 E2K_ASM_RETURN</code> </pre> <br>  ูุน ุงุฎุชูุงู ุจุณูุท (ุงูุญูู 12 ุจุช ุ ููุชู ุญุณุงุจ ุงูุณุฌูุงุช ููุงู ุจูุตุทูุญุงุช 128 ุจุช ุ ุฃู ุ ูุฌุจ ุถุฑุจ ุงููููุฉ ุจ 2). <br><br>  Setjmp ุงูููุฏ ููุณู <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">C_ENTRY(setjmp): setwd wsz = <span class="hljs-number"><span class="hljs-number">0x14</span></span>, nfx = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-comment"><span class="hljs-comment">/* It's for db[N] registers */</span></span> setbn rsz = <span class="hljs-number"><span class="hljs-number">0x3</span></span>, rbs = <span class="hljs-number"><span class="hljs-number">0x10</span></span>, rcur = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-comment"><span class="hljs-comment">/* We must disable interrupts here */</span></span> disp %ctpr1, ipl_save ipd <span class="hljs-number"><span class="hljs-number">3</span></span> call %ctpr1, wbs = <span class="hljs-number"><span class="hljs-number">0x10</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Store current IPL to dr9 */</span></span> addd <span class="hljs-number"><span class="hljs-number">0</span></span>, %db[<span class="hljs-number"><span class="hljs-number">0</span></span>], %dr9 <span class="hljs-comment"><span class="hljs-comment">/* Store some registers to jmp_buf */</span></span> rrd %cr0.hi, %dr1 rrd %cr1.lo, %dr2 rrd %cr1.hi, %dr3 rrd %usd.lo, %dr4 rrd %usd.hi, %dr5 <span class="hljs-comment"><span class="hljs-comment">/* Prepare RF stack to flush in longjmp */</span></span> rrd %psp.hi, %dr6 rrd %pshtp, %dr7 addd <span class="hljs-number"><span class="hljs-number">0</span></span>, %dr6, %db[<span class="hljs-number"><span class="hljs-number">0</span></span>] addd <span class="hljs-number"><span class="hljs-number">0</span></span>, %dr7, %db[<span class="hljs-number"><span class="hljs-number">1</span></span>] disp %ctpr1, update_psp_ind ipd <span class="hljs-number"><span class="hljs-number">3</span></span> call %ctpr1, wbs = <span class="hljs-number"><span class="hljs-number">0x10</span></span> addd <span class="hljs-number"><span class="hljs-number">0</span></span>, %db[<span class="hljs-number"><span class="hljs-number">0</span></span>], %dr6 <span class="hljs-comment"><span class="hljs-comment">/* Prepare CF stack to flush in longjmp */</span></span> rrd %pcsp.hi, %dr7 rrd %pcshtp, %dr8 addd <span class="hljs-number"><span class="hljs-number">0</span></span>, %dr7, %db[<span class="hljs-number"><span class="hljs-number">0</span></span>] addd <span class="hljs-number"><span class="hljs-number">0</span></span>, %dr8, %db[<span class="hljs-number"><span class="hljs-number">1</span></span>] disp %ctpr1, update_pcsp_ind ipd <span class="hljs-number"><span class="hljs-number">3</span></span> call %ctpr1, wbs = <span class="hljs-number"><span class="hljs-number">0x10</span></span> addd <span class="hljs-number"><span class="hljs-number">0</span></span>, %db[<span class="hljs-number"><span class="hljs-number">0</span></span>], %dr7 <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr1, [%dr0 + E2K_JMBBUFF_CR0_HI] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr2, [%dr0 + E2K_JMBBUFF_CR1_LO] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr3, [%dr0 + E2K_JMBBUFF_CR1_HI] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr4, [%dr0 + E2K_JMBBUFF_USD_LO] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr5, [%dr0 + E2K_JMBBUFF_USD_HI] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr6, [%dr0 + E2K_JMBBUFF_PSP_HI] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr7, [%dr0 + E2K_JMBBUFF_PCSP_HI] <span class="hljs-comment"><span class="hljs-comment">/* Enable interrupts */</span></span> addd <span class="hljs-number"><span class="hljs-number">0</span></span>, %dr9, %db[<span class="hljs-number"><span class="hljs-number">0</span></span>] disp %ctpr1, ipl_restore ipd <span class="hljs-number"><span class="hljs-number">3</span></span> call %ctpr1, wbs = <span class="hljs-number"><span class="hljs-number">0x10</span></span> <span class="hljs-comment"><span class="hljs-comment">/* return 0 */</span></span> adds <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, %r0 E2K_ASM_RETURN</code> </pre> <br>  ุนูุฏ ุชุทุจูู longjmp ุ ูู ุงูููู ุฃูุง ููุณู ุชุฒุงูู ูู ูู ูููุงุช ุงูุชุณุฌูู ุ ูุฐูู ุ ูุง ุชุญุชุงุฌ ุฅูู ูุณุญ ูุงูุฐุฉ ุงูุชุณุฌูู (flushr) ููุท ุ ูููู ุฃูุถูุง ูุณุญ ููู Binder (flushc).  ุฏุนูุง ูุตู ุงููุงูุฑู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_ASM_FLUSH_CPU \ flushr; \ nop 2; \ flushc; \ nop 3;</span></span></code> </pre> <br>  ุงูุขู ุจุนุฏ ุฃู ุฃุตุจุญุช ุฌููุน ุงููุนูููุงุช ูู ุงูุฐุงูุฑุฉ ุ ูููููุง ุงูููุงู ุจุฃูุงู ุชุณุฌูู ุงูุงุณุชุฑุฏุงุฏ ูู longjmp. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">C_ENTRY(longjmp): setwd wsz = <span class="hljs-number"><span class="hljs-number">0x14</span></span>, nfx = <span class="hljs-number"><span class="hljs-number">0x0</span></span> setbn rsz = <span class="hljs-number"><span class="hljs-number">0x3</span></span>, rbs = <span class="hljs-number"><span class="hljs-number">0x10</span></span>, rcur = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-comment"><span class="hljs-comment">/* We must disable interrupts here */</span></span> disp %ctpr1, ipl_save ipd <span class="hljs-number"><span class="hljs-number">3</span></span> call %ctpr1, wbs = <span class="hljs-number"><span class="hljs-number">0x10</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Store current IPL to dr9 */</span></span> addd <span class="hljs-number"><span class="hljs-number">0</span></span>, %db[<span class="hljs-number"><span class="hljs-number">0</span></span>], %dr9 <span class="hljs-comment"><span class="hljs-comment">/* We have to flush both RF and CF to memory because saved values * of P[C]SHTP can be not valid here. */</span></span> E2K_ASM_FLUSH_CPU <span class="hljs-comment"><span class="hljs-comment">/* Load registers previously saved in setjmp. */</span></span> ldd [%dr0 + E2K_JMBBUFF_CR0_HI], %dr2 ldd [%dr0 + E2K_JMBBUFF_CR1_LO], %dr3 ldd [%dr0 + E2K_JMBBUFF_CR1_HI], %dr4 ldd [%dr0 + E2K_JMBBUFF_USD_LO], %dr5 ldd [%dr0 + E2K_JMBBUFF_USD_HI], %dr6 ldd [%dr0 + E2K_JMBBUFF_PSP_HI], %dr7 ldd [%dr0 + E2K_JMBBUFF_PCSP_HI], %dr8 rwd %dr2, %cr0.hi rwd %dr3, %cr1.lo rwd %dr4, %cr1.hi rwd %dr5, %usd.lo rwd %dr6, %usd.hi rwd %dr7, %psp.hi rwd %dr8, %pcsp.hi <span class="hljs-comment"><span class="hljs-comment">/* Enable interrupts */</span></span> addd <span class="hljs-number"><span class="hljs-number">0</span></span>, %dr9, %db[<span class="hljs-number"><span class="hljs-number">0</span></span>] disp %ctpr1, ipl_restore ipd <span class="hljs-number"><span class="hljs-number">3</span></span> call %ctpr1, wbs = <span class="hljs-number"><span class="hljs-number">0x10</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Actually, we return to setjmp caller with second * argument of longjmp stored on r1 register. */</span></span> adds <span class="hljs-number"><span class="hljs-number">0</span></span>, %r1, %r0 E2K_ASM_RETURN</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุชุจุฏูู ุงูุณูุงู </h3><br>  ุจุนุฏ ุฃู ุชูุตููุง ุฅูู setjmp / longjmp ุ ุจุฏุง ุฃู ุงูุชูููุฐ ุงูุฃุณุงุณู ูู context_switch ูุงุถุญ ุจูุง ููู ุงูููุงูุฉ ููุง.  ูู ุงููุงูุน ุ ููุง ูู ุงูุญุงูุฉ ุงูุฃููู ุ ูุญุชุงุฌ ุฅูู ุญูุธ / ุงุณุชุนุงุฏุฉ ุณุฌูุงุช ุชูุตูู ุงููุนูููุงุช ูุงูููุฏุณุงุช ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฃููุง ุจุญุงุฌุฉ ุฅูู ุงุณุชุนุงุฏุฉ ุณุฌู ุญุงูุฉ ุงููุนุงูุฌ (UPSR) ุจุดูู ุตุญูุญ. <br><br>  ุณุงูุถุญ.  ููุง ูู ุงูุญุงู ูู setjmp ุ ุนูุฏ ุญูุธ ุงูุณุฌูุงุช ุ ูุฌุจ ุฃููุงู ุฅุนุงุฏุฉ ุชุนููู ููู ุงูุชุณุฌูู ูููู ูุนูููุงุช ุงูุฑุจุท ุฅูู ุงูุฐุงูุฑุฉ (flushr + flushc).  ุจุนุฏ ุฐูู ุ ูุญุชุงุฌ ุฅูู ุญูุธ ุงูููู ุงูุญุงููุฉ ูุณุฌูุงุช CR0 ู CR1 ุจุญูุซ ุนูุฏูุง ูุนูุฏ ุ ุงูุชูู ุฅูู ุงูููุงู ุงูุฐู ุชู ููู ุชุดุบูู ุงูุฏูู ุงูุญุงูู ุจุงูุถุจุท.  ุจุนุฏ ุฐูู ุ ูููู ุจุญูุธ ูุงุตูุงุช ุงูููุฏุณ ูู PS ู PCS ูุงูููุงูุงุช ุงููุชุญุฏุฉ.  ูุฃุฎูุฑูุง ุ ุชุญุชุงุฌ ุฅูู ุงูุนูุงูุฉ ุจุงูุงุณุชุนุงุฏุฉ ุงูุตุญูุญุฉ ููุถุน ุงูููุงุทุนุฉ - ูููุฐู ุงูุฃุบุฑุงุถ ุ ูููู ุฃูุถูุง ุจุญูุธ ุณุฌู UPSR. <br><br>  ุฑูุฒ ุงููุฌูุน ุณูุงู_ุงูุชุจุฏูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">C_ENTRY(context_switch): setwd wsz = <span class="hljs-number"><span class="hljs-number">0x10</span></span>, nfx = <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Save prev UPSR */</span></span> rrd %upsr, %dr2 <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr2, [%dr0 + E2K_CTX_UPSR] <span class="hljs-comment"><span class="hljs-comment">/* Disable interrupts before saving/restoring context */</span></span> rrd %upsr, %dr2 andnd %dr2, (UPSR_IE | UPSR_NMIE), %dr2 rwd %dr2, %upsr E2K_ASM_FLUSH_CPU <span class="hljs-comment"><span class="hljs-comment">/* Save prev CRs */</span></span> rrd %cr0.lo, %dr2 rrd %cr0.hi, %dr3 rrd %cr1.lo, %dr4 rrd %cr1.hi, %dr5 <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr2, [%dr0 + E2K_CTX_CR0_LO] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr3, [%dr0 + E2K_CTX_CR0_HI] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr4, [%dr0 + E2K_CTX_CR1_LO] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr5, [%dr0 + E2K_CTX_CR1_HI] <span class="hljs-comment"><span class="hljs-comment">/* Save prev stacks */</span></span> rrd %usd.lo, %dr3 rrd %usd.hi, %dr4 rrd %psp.lo, %dr5 rrd %psp.hi, %dr6 rrd %pcsp.lo, %dr7 rrd %pcsp.hi, %dr8 <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr3, [%dr0 + E2K_CTX_USD_LO] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr4, [%dr0 + E2K_CTX_USD_HI] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr5, [%dr0 + E2K_CTX_PSP_LO] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr6, [%dr0 + E2K_CTX_PSP_HI] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr7, [%dr0 + E2K_CTX_PCSP_LO] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span> %dr8, [%dr0 + E2K_CTX_PCSP_HI] <span class="hljs-comment"><span class="hljs-comment">/* Load next CRs */</span></span> ldd [%dr1 + E2K_CTX_CR0_LO], %dr2 ldd [%dr1 + E2K_CTX_CR0_HI], %dr3 ldd [%dr1 + E2K_CTX_CR1_LO], %dr4 ldd [%dr1 + E2K_CTX_CR1_HI], %dr5 rwd %dr2, %cr0.lo rwd %dr3, %cr0.hi rwd %dr4, %cr1.lo rwd %dr5, %cr1.hi <span class="hljs-comment"><span class="hljs-comment">/* Load next stacks */</span></span> ldd [%dr1 + E2K_CTX_USD_LO], %dr3 ldd [%dr1 + E2K_CTX_USD_HI], %dr4 ldd [%dr1 + E2K_CTX_PSP_LO], %dr5 ldd [%dr1 + E2K_CTX_PSP_HI], %dr6 ldd [%dr1 + E2K_CTX_PCSP_LO], %dr7 ldd [%dr1 + E2K_CTX_PCSP_HI], %dr8 rwd %dr3, %usd.lo rwd %dr4, %usd.hi rwd %dr5, %psp.lo rwd %dr6, %psp.hi rwd %dr7, %pcsp.lo rwd %dr8, %pcsp.hi <span class="hljs-comment"><span class="hljs-comment">/* Restore next UPSR */</span></span> ldd [%dr1 + E2K_CTX_UPSR], %dr2 rwd %dr2, %upsr E2K_ASM_RETURN</code> </pre> <br>  ููุทุฉ ุฃุฎุฑู ูููุฉ ูู ุชููุฆุฉ ูุคุดุฑ ุชุฑุงุจุท ูุธุงู ุงูุชุดุบูู.  ูู Embox ุ ูุญุชูู ูู ูุคุดุฑ ุชุฑุงุจุท ุนูู ุฅุฌุฑุงุก ุฃุณุงุณู ูุนูู <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _<span class="hljs-function"><span class="hljs-function">NORETURN </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">thread_trampoline</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>;</code> </pre> <br>  ุญูุซ ุณูุชู ุชูููุฐ ุฌููุน ุฃุนูุงู ุงูุฏูู ุงูุฃุฎุฑู.  ูุจุงูุชุงูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุฅุนุฏุงุฏ ุงููุฏุงุฎู ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ูุฏุนูุฉ ูุฐู ุงููุธููุฉ ุ ูููุง ููุงุฌู ุญูููุฉ ูุฌูุฏ ุซูุงุซุฉ ุฃููุงู ุ ููุง ุชููู ูู ููุณ ุงูุงุชุฌุงู.  ููููุง ููููุฏุณุฉ ุงููุนูุงุฑูุฉ ุ ูููู ุจุฅูุดุงุก ุฏูู ูุน ุฑุตุฉ ูุงุญุฏุฉ ุ ุฃู ุจุงูุฃุญุฑู ุ ูู ููุงู ูุงุญุฏ ุฃุณูู ุงูุฑุตุฉ ุ ูู ุงูุฌุฒุก ุงูุนููู ูุฏููุง ูููู ูุตู ุงูุฏูู ููุณู ุ ูููุฐุง ุ ูุงู ุนูููุง ููุง ุงูุงุนุชูุงุก ุจูุฌููุนุงุช ูุฎุชููุฉ ุ ูููุณ ุฃู ููุณู ุฃูู ููุจุบู ูุญุงุฐุงุชูุง 4 ูููู ุจุงูุช ุ ูุง ุชูุณ ูู ุฃููุงุน ุญููู ุงููุตูู ููุง ุฅูู ุฐูู. <br><br>  ูุชูุฌุฉ ูุฐูู ุ ูู ุงูููุช ุงูุญุงูู ุ ูุฑุฑูุง ุฃู ููุณู ุงููุณุงุญุฉ ุงูููุฌูุฏุฉ ุฃุณูู ุงูููุฏุณ ุฅูู ุซูุงุซุฉ ุฃุฌุฒุงุก ุ ุงูุฑุจุน ุชุญุช ูููุฉ ุงููุนูููุงุช ุงูููุฒูุฉ ุ ูุฑุจุนูุง ุชุญุช ุงูููุฏุณ ุงูุฅุฌุฑุงุฆู ุ ูุงููุตู ุงูุขุฎุฑ ุฃุณูู ููุฏุณ ุงููุณุชุฎุฏู. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฃุญุถุฑ ุงูุดูุฑุฉ ุจุญูุซ ููููู ุชูููู ุญุฌููุง ุงููุจูุฑ ุ ุนููู ุงูุชูููุฑ ูู ุฃู ูุฐุง ูู ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุชููุฆุฉ.</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* This value is used for both stack base and size align. */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_STACK_ALIGN (1UL </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&lt; 12) #define round_down(x, bound) ((x) &amp; ~((bound) - 1)) /* Reserve 1/4 for PSP stack, 1/4 for PCSP stack, and 1/2 for USD stack */ #define PSP_CALC_STACK_BASE(sp, size) binalign_bound(sp - size, E2K_STACK_ALIGN) #define PSP_CALC_STACK_SIZE(sp, size) binalign_bound((size) / 4, E2K_STACK_ALIGN) #define PCSP_CALC_STACK_BASE(sp, size) \ (PSP_CALC_STACK_BASE(sp, size) + PSP_CALC_STACK_SIZE(sp, size)) #define PCSP_CALC_STACK_SIZE(sp, size) binalign_bound((size) / 4, E2K_STACK_ALIGN) #define USD_CALC_STACK_BASE(sp, size) round_down(sp, E2K_STACK_ALIGN) #define USD_CALC_STACK_SIZE(sp, size) \ round_down(USD_CALC_STACK_BASE(sp, size) - PCSP_CALC_STACK_BASE(sp, size),\ E2K_STACK_ALIGN) static void e2k_calculate_stacks(struct context *ctx, uint64_t sp, uint64_t size) { uint64_t psp_size, pcsp_size, usd_size; log_debug("Stacks:\n"); ctx-&gt;psp_lo |= PSP_CALC_STACK_BASE(sp, size) &lt;&lt; PSP_BASE; ctx-&gt;psp_lo |= E2_RWAR_RW_ENABLE &lt;&lt; PSP_RW; psp_size = PSP_CALC_STACK_SIZE(sp, size); assert(psp_size); ctx-&gt;psp_hi |= psp_size &lt;&lt; PSP_SIZE; log_debug(" PSP.base=0x%lx, PSP.size=0x%lx\n", PSP_CALC_STACK_BASE(sp, size), psp_size); ctx-&gt;pcsp_lo |= PCSP_CALC_STACK_BASE(sp, size) &lt;&lt; PCSP_BASE; ctx-&gt;pcsp_lo |= E2_RWAR_RW_ENABLE &lt;&lt; PCSP_RW; pcsp_size = PCSP_CALC_STACK_SIZE(sp, size); assert(pcsp_size); ctx-&gt;pcsp_hi |= pcsp_size &lt;&lt; PCSP_SIZE; log_debug(" PCSP.base=0x%lx, PCSP.size=0x%lx\n", PCSP_CALC_STACK_BASE(sp, size), pcsp_size); ctx-&gt;usd_lo |= USD_CALC_STACK_BASE(sp, size) &lt;&lt; USD_BASE; usd_size = USD_CALC_STACK_SIZE(sp, size); assert(usd_size); ctx-&gt;usd_hi |= usd_size &lt;&lt; USD_SIZE; log_debug(" USD.base=0x%lx, USD.size=0x%lx\n", USD_CALC_STACK_BASE(sp, size), usd_size); } static void e2k_calculate_crs(struct context *ctx, uint64_t routine_addr) { uint64_t usd_size = (ctx-&gt;usd_hi &gt;&gt; USD_SIZE) &amp; USD_SIZE_MASK; /* Reserve space in hardware stacks for @routine_addr */ /* Remark: We do not update psp.hi to reserve space for arguments, * since routine do not accepts any arguments. */ ctx-&gt;pcsp_hi |= SZ_OF_CR0_CR1 &lt;&lt; PCSP_IND; ctx-&gt;cr0_hi |= (routine_addr &gt;&gt; CR0_IP) &lt;&lt; CR0_IP; ctx-&gt;cr1_lo |= PSR_ALL_IRQ_ENABLED &lt;&lt; CR1_PSR; /* Divide on 16 because it field contains size in terms * of 128 bit values. */ ctx-&gt;cr1_hi |= (usd_size &gt;&gt; 4) &lt;&lt; CR1_USSZ; } void context_init(struct context *ctx, unsigned int flags, void (*routine_fn)(void), void *sp, unsigned int stack_size) { memset(ctx, 0, sizeof(*ctx)); e2k_calculate_stacks(ctx, sp, stack_size); e2k_calculate_crs(ctx, (uint64_t) routine_fn); if (!(flags &amp; CONTEXT_IRQDISABLE)) { ctx-&gt;upsr |= (UPSR_IE | UPSR_NMIE); } }</span></span></span></span></code> </pre> <br></div></div><br>  ุงุญุชูุช ุงูููุงูุฉ ุฃูุถูุง ุนูู ุนูู ูุน ุงูููุงุทุนุงุช ูุงูุงุณุชุซูุงุกุงุช ูุฃุฌูุฒุฉ ุถุจุท ุงูููุช ุ ูููู ูุธุฑูุง ูุฃู ุญุฌููุง ูุจูุฑ ุฌุฏูุง ุ ููุฏ ูุฑุฑูุง ุงูุชุญุฏุซ ุนูู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก ุงูุชุงูู</a> . <br><br>  ููุท ูู ุญุงูุฉ ุ ุฃูุฑุฑ ุ ูุฐู ุงูููุงุฏ ููุณุช ูุซุงุฆู ุฑุณููุฉ!  ููุญุตูู ุนูู ุงูุฏุนู ุงูุฑุณูู ูุงููุซุงุฆู ูุงูุจุงูู ุ ุชุญุชุงุฌ ุฅูู ุงูุงุชุตุงู ุจู ICST ูุจุงุดุฑุฉ.  ุงูููุฏ ุงูููุฌูุฏ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Embox</a> ุ ุจุทุจูุนุฉ ุงูุญุงู ุ ููุชูุญ ุ ููู ูู ุฃุฌู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุฌููุนู</a> ุ ุณุชุญุชุงุฌ ุฅูู ุจุฑูุงูุฌ ูุชุฑุฌู ูุดุชุฑู ุ ูุงูุฐู ุ ูุฑุฉ ุฃุฎุฑู ุ ูููู ุงูุญุตูู ุนููู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">MCST</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar447704/">https://habr.com/ru/post/ar447704/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar447694/index.html">ุชุฌููุน ุชูููู ุงููุธุงู ุงูููุฒุน</a></li>
<li><a href="../ar447696/index.html">ููุงุฐุง ุชุนุงุฑุถ ุงููุฏู Amazon Go ุ ุฃูู ูุชุงุฌุฑ ุบูุฑ ููุฏูุฉ</a></li>
<li><a href="../ar447698/index.html">ุฑูุฏ ููุฌูุฑุชุณ: ุฃูุงุฏููู ุจุฏูู ุฏุจููู</a></li>
<li><a href="../ar447700/index.html">ุงููุฑููุฉ ุงูุนุงุทููุฉ ูู ููุชุงุญ ุงูููู ุงูุดุฎุตู.</a></li>
<li><a href="../ar447702/index.html">ุงูุฏุงุฆุฑุฉ ุงูุฑูุงุถูุฉ ุงููุซุงููุฉ ุบูุฑ ููุฌูุฏุฉ</a></li>
<li><a href="../ar447706/index.html">ููุณ ORM ูุงุญุฏ</a></li>
<li><a href="../ar447708/index.html">ูุฏูุช ูุงูุฏูุณ ููุนููุงุก ุงูุดุจุงุจ ูุงููุงุฏุฉ ุงูุนููููู ุฃูู ุฌูุงุฆุฒ ุฅูููุง ุณูุฌุงููููุชุด</a></li>
<li><a href="../ar447712/index.html">ูุฑุญุจุง ุ ุงุฏุงุฑุฉ ุงูุนูุงูุงุช ูุน | ุงุฏุงุฑุฉ ุงูุนูุงูุงุช ุงูุฑูุณูุฉ 2018 - ุงููุชุงุฆุฌ</a></li>
<li><a href="../ar447714/index.html">ุญูู ุชุทุจูู ูุธุฑูุฉ ุนูููุงุช ARMA ูู ุงูููุงุฑุณุฉ ุงูููุฏุณูุฉ</a></li>
<li><a href="../ar447716/index.html">ุงููุญุฏุฉ: ุงุฑุณู ุงูุนุฏูุฏ ูู ุงูุญุงูุงุช ุงูุตุญูุฉ ูู ูุนุจุฉ ูุงุญุฏุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>