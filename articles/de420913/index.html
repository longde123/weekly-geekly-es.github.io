<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👼🏼 🌫️ ⚫️ Führen Sie Kubernetes in LXC aus 👩🏾‍🚀 👩🏻‍🎤 🚵🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel werde ich Ihnen erklären, wie Sie kubernetes master in einem LXC-Container ausführen. 
 Diese Methode funktioniert sehr gut mit Prox...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Führen Sie Kubernetes in LXC aus</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420913/"><p><img src="https://habrastorage.org/webt/ku/7d/fb/ku7dfbo93q4kk2a53rvhv-9p2qy.png"></p><br><p>  In diesem Artikel werde ich Ihnen erklären, wie Sie kubernetes master in einem LXC-Container ausführen. <br>  Diese Methode funktioniert sehr gut mit Proxmox und kann als Alternative zur klassischen Bereitstellung von Kubernetes mit mehreren Assistenten betrachtet werden. </p><a name="habracut"></a><br><h1 id="pochemu-proxmox">  Warum Proxmox? </h1><br><p>  Weil proxmox out of the box viele nützliche Funktionen bietet. <br>  Proxmox umfasst Hochverfügbarkeitsfunktionen, Migration, automatische Sicherungen, Zugriffskontrolle und all dies ist über eine einfache grafische Oberfläche zugänglich. </p><br><p> Sie können die einfachste Kubernet-Konfiguration auch mit einem einzigen Assistenten bereitstellen. Proxmox bietet hohe Verfügbarkeit. <br>  Diese Methode eignet sich hervorragend für die Bereitstellung von Test- oder kleinen Clustern. </p><br><p>  Für größere Bereitstellungen wird empfohlen, etcd in separaten Containern zu platzieren, die schnelle lokale Festplatten verwenden und diese zu einem Cluster kombinieren. <br>  Trotzdem kann kubernetes-master selbst ein gewöhnlicher ha-Container bleiben, es muss kein schneller Speicher vorhanden sein. </p><br><p>  Wenn Sie diesen Artikel lesen, gehe ich außerdem davon aus, dass Sie in den meisten Fällen bereits über eine Infrastruktur in Proxmox verfügen und möglicherweise eine einzige Schnittstelle für die Verwaltung Ihrer Dienste benötigen. </p><br><h1 id="pochemu-lxc">  Warum LXC? </h1><br><p>  Kubernetes startet problemlos in einer normalen virtuellen Maschine.  LXC-Container bieten jedoch die Flexibilität, die mit herkömmlichen virtuellen Maschinen nicht verfügbar ist. </p><br><p>  Tatsächlich bieten LXC-Container keine vollständige Isolierung von Containern vom Host. Im Gegenteil, alle Prozesse in den Containern beginnen als normale Host-Prozesse, nur in einem separaten Namespace. </p><br><p>  Diese Methode bietet Ihnen eine gute Leistung, unterliegt jedoch in unserem Fall einigen Einschränkungen. </p><br><p>  Ich werde diese Einschränkungen und den Umgang damit in diesem Artikel diskutieren. </p><br><h1 id="konfiguraciya">  Konfiguration </h1><br><p>  Da Container standardmäßig keine Kernelmodule selbst laden dürfen, müssen Sie sie so konfigurieren, dass sie direkt auf Hypervisoren geladen werden. </p><br><p> Wir werden den <code>overlay</code> Treiber für Docker verwenden, das ist also alles, was wir brauchen: </p><br><pre> <code class="plaintext hljs">echo overlay &gt;&gt; /etc/modules</code> </pre> <br><p>  Jetzt müssen wir weitere Berechtigungen für unseren Container hinzufügen, damit andere Container darin ausgeführt werden können. Fügen Sie diese Zeilen zur Konfiguration Ihres Containers hinzu: </p><br><pre> <code class="plaintext hljs">lxc.apparmor.profile: unconfined lxc.cap.drop: lxc.cgroup.devices.allow: a lxc.mount.auto: proc:rw sys:rw</code> </pre> <br><p>  Ab Version <strong>v11.0</strong> benötigt kubelet einen freigegebenen Modus für alle Bereitstellungen vom Host. </p><br><p>  Mit diesem schmutzigen Hack können Sie Folgendes erreichen: Führen Sie im LXC-Container Folgendes aus: </p><br><pre> <code class="plaintext hljs">echo '#!/bin/sh -e mount --make-rshared /' &gt; /etc/rc.local</code> </pre> <br><p>  Diese Aktion fügt den <code>mount --make-rshared /</code> zu <code>/etc/rc.local</code> und führt ihn jedes Mal aus, wenn der Container <code>/etc/rc.local</code> . </p><br><p>  Wenn Sie HA-Manager in proxmox verwenden möchten, beachten Sie außerdem, dass derzeit ein unangenehmer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fehler # 1842</a> vorliegt, der Containerprozesse während der Migration zwangsweise beendet, wodurch Zombie-Prozesse entstehen oder sogar Ihr Speicher blockiert werden kann. </p><br><p>  Das ist nicht gut, zum Glück gibt es eine einfache Lösung: </p><br><pre> <code class="plaintext hljs">sed -i 's/forceStop =&gt; 1/forceStop =&gt; 0/' /usr/share/perl5/PVE/HA/Resources/PVECT.pm</code> </pre> <br><p>  Darüber hinaus können Sie Ihrem Docker folgende Optionen hinzufügen: </p><br><pre> <code class="plaintext hljs">--storage-driver overlay2 --iptables=false --ip-masq=false</code> </pre> <br><p>  Kopieren Sie <code>docker.service</code> von <code>/lib</code> nach <code>/etc</code> , um die Optionen zu überschreiben: </p><br><pre> <code class="plaintext hljs">cp /{lib,etc}/systemd/system/docker.service</code> </pre> <br><p>  <code>ExecStart</code> Sie diese Optionen nun dem Abschnitt <code>ExecStart</code> . </p><br><p>  Das ist alles, nach diesen Schritten sollte die Standard- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kubeadm-Installation</a> ohne Probleme funktionieren. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de420913/">https://habr.com/ru/post/de420913/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de420901/index.html">Wie ich Spring Framework studiere (Hilfe für Anfänger ist die Arbeit der Anfänger selbst)</a></li>
<li><a href="../de420903/index.html">Implementierung von ERP: Wie man nicht versagt</a></li>
<li><a href="../de420905/index.html">Wie intelligente Beleuchtung in Russland eingeführt wird und wie lange es dauern wird</a></li>
<li><a href="../de420907/index.html">Von NOKLA bis Xiaomi: Die Entwicklung der chinesischen Mobiltelefone</a></li>
<li><a href="../de420909/index.html">Russische Fernsehunternehmen werfen Yandex Piraterie vor</a></li>
<li><a href="../de420915/index.html">RFM-Analyse mit einem Klick oder wie wir unseren Kunden das Leben leichter gemacht haben</a></li>
<li><a href="../de420919/index.html">Animierte Zahlen auf Android</a></li>
<li><a href="../de420923/index.html">Meta-Fähigkeiten von Softwareentwicklern</a></li>
<li><a href="../de420927/index.html">"Gummi-Host-Suche in der Alibaba Cloud": Host-Elasticsearch in Alibaba Cloud-Einrichtungen</a></li>
<li><a href="../de420929/index.html">Ausführen, testen, ausführen. Apropos Mobile Testing Meetup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>