<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ† ğŸš¶ğŸ» ğŸ§’ ä½¿ç”¨Node.jså’ŒOracleæ•°æ®åº“åˆ›å»ºREST APIã€‚ ç¬¬4éƒ¨åˆ† ğŸ“˜ ğŸ“˜ ğŸˆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¬¬4éƒ¨åˆ†ï¼šåˆ›å»ºREST APIï¼šå¤„ç†POSTï¼ŒPUTå’ŒDELETEè¯·æ±‚ 

 åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæ‚¨å‘ç”¨äºä»æ•°æ®åº“æ£€ç´¢æ•°æ®çš„GETè¯·æ±‚çš„APIæ·»åŠ äº†é€»è¾‘ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†é€šè¿‡æ·»åŠ å¤„ç†POSTï¼ŒPUTå’ŒDELETEè¯·æ±‚çš„é€»è¾‘æ¥å®ŒæˆCRUD APIçš„åŸºæœ¬åŠŸèƒ½ã€‚ 

 æ·»åŠ è·¯ç”±é€»è¾‘ 

 ä¸ºäº†ç®€åŒ–è·¯ç”±é€»è¾‘ï¼Œæ‚¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨Node.jså’ŒOracleæ•°æ®åº“åˆ›å»ºREST APIã€‚ ç¬¬4éƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473560/">  <b>ç¬¬4éƒ¨åˆ†ï¼šåˆ›å»ºREST APIï¼šå¤„ç†POSTï¼ŒPUTå’ŒDELETEè¯·æ±‚</b> <br><br> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ</a>æ‚¨å‘ç”¨äºä»æ•°æ®åº“æ£€ç´¢æ•°æ®çš„GETè¯·æ±‚çš„APIæ·»åŠ äº†é€»è¾‘ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†é€šè¿‡æ·»åŠ å¤„ç†POSTï¼ŒPUTå’ŒDELETEè¯·æ±‚çš„é€»è¾‘æ¥å®ŒæˆCRUD APIçš„åŸºæœ¬åŠŸèƒ½ã€‚ <br><a name="habracut"></a><br>  <b>æ·»åŠ è·¯ç”±é€»è¾‘</b> <br><br> ä¸ºäº†ç®€åŒ–è·¯ç”±é€»è¾‘ï¼Œæ‚¨å°†é€šè¿‡ç°æœ‰è·¯ç”±ï¼ˆå¸¦æœ‰å¯é€‰çš„idå‚æ•°ï¼‰é‡å®šå‘æ‰€æœ‰HTTPæ–¹æ³•ã€‚ æ‰“å¼€<b>services / router.jsæ–‡ä»¶ï¼Œ</b>å¹¶ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢å½“å‰çš„è·¯ç”±é€»è¾‘ï¼ˆç¬¬5-6è¡Œï¼‰ï¼š <br><br><pre><code class="javascript hljs">router.route(<span class="hljs-string"><span class="hljs-string">'/employees/:id?'</span></span>) .get(employees.get) .post(employees.post) .put(employees.put) .delete(employees.delete);</code> </pre> <br> æ›´æ–°åçš„è·¯ç”±é€»è¾‘å°†ç”¨äºåŸºæœ¬CRUDæ“ä½œçš„å››ç§æœ€å¸¸è§çš„HTTPæ–¹æ³•æ˜ å°„åˆ°æ­£ç¡®çš„æ§åˆ¶å™¨é€»è¾‘ã€‚ <br><br>  <b>POSTè¯·æ±‚å¤„ç†</b> <br><br>  HTTP POSTè¯·æ±‚ç”¨äºåˆ›å»ºæ–°èµ„æºï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºå‘˜å·¥è®°å½•ï¼‰ã€‚ ä¸»è¦æ€æƒ³æ˜¯ä»HTTPè¯·æ±‚çš„æ­£æ–‡ä¸­æå–æ•°æ®ï¼Œå¹¶ä½¿ç”¨å®ƒåœ¨æ•°æ®åº“ä¸­åˆ›å»ºæ–°è¡Œã€‚ è¦ä¸ºPOSTè¯·æ±‚æ·»åŠ æ§åˆ¶å™¨é€»è¾‘ï¼Œè¯·æ‰“å¼€<b>controllers / employee.js</b>æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEmployeeFromRec</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> employee = { <span class="hljs-attr"><span class="hljs-attr">first_name</span></span>: req.body.first_name, <span class="hljs-attr"><span class="hljs-attr">last_name</span></span>: req.body.last_name, <span class="hljs-attr"><span class="hljs-attr">email</span></span>: req.body.email, <span class="hljs-attr"><span class="hljs-attr">phone_number</span></span>: req.body.phone_number, <span class="hljs-attr"><span class="hljs-attr">hire_date</span></span>: req.body.hire_date, <span class="hljs-attr"><span class="hljs-attr">job_id</span></span>: req.body.job_id, <span class="hljs-attr"><span class="hljs-attr">salary</span></span>: req.body.salary, <span class="hljs-attr"><span class="hljs-attr">commission_pct</span></span>: req.body.commission_pct, <span class="hljs-attr"><span class="hljs-attr">manager_id</span></span>: req.body.manager_id, <span class="hljs-attr"><span class="hljs-attr">department_id</span></span>: req.body.department_id }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> employee; } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">post</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> employee = getEmployeeFromRec(req); employee = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> employees.create(employee); res.status(<span class="hljs-number"><span class="hljs-number">201</span></span>).json(employee); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { next(err); } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.post = post;</code> </pre> <br>  getEmployeeFromRecå‡½æ•°æ¥å—ä¸€ä¸ªè¯·æ±‚å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªå…·æœ‰åˆ›å»ºé›‡å‘˜è®°å½•æ‰€å¿…éœ€çš„å±æ€§çš„å¯¹è±¡ã€‚ è¯¥å‡½æ•°åœ¨postå‡½æ•°å¤–éƒ¨å£°æ˜ï¼Œå› æ­¤ä»¥åå¯ä»¥ç”¨äºPUTè¯·æ±‚ã€‚ <br><br>  postå‡½æ•°ä½¿ç”¨getEmployeeFromRecåˆå§‹åŒ–å˜é‡ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™å‘˜å·¥æ•°æ®åº“APIçš„createæ–¹æ³•ã€‚ åˆ›å»ºæ“ä½œä¹‹åï¼ŒçŠ¶æ€ä»£ç â€œ 201å·²åˆ›å»ºâ€ä¸å‘˜å·¥JSONï¼ˆåŒ…æ‹¬å‘˜å·¥æ ‡è¯†ç¬¦çš„æ–°å€¼ï¼‰ä¸€èµ·å‘é€åˆ°å®¢æˆ·ç«¯ã€‚ <br><br> ç°åœ¨ï¼Œæ‚¨å¯ä»¥æ³¨æ„æ•°æ®åº“APIä¸­çš„é€»è¾‘ã€‚ æ‰“å¼€<b>db_apis / employee.js</b>æ–‡ä»¶ï¼Œå¹¶åœ¨ä¸‹é¢æ·»åŠ ä»¥ä¸‹ä»£ç ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createSql = <span class="hljs-string"><span class="hljs-string">`insert into employees ( first_name, last_name, email, phone_number, hire_date, job_id, salary, commission_pct, manager_id, department_id ) values ( :first_name, :last_name, :email, :phone_number, :hire_date, :job_id, :salary, :commission_pct, :manager_id, :department_id ) returning employee_id into :employee_id`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> employee = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({}, emp); employee.employee_id = { <span class="hljs-attr"><span class="hljs-attr">dir</span></span>: oracledb.BIND_OUT, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: oracledb.NUMBER } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> database.simpleExecute(createSql, employee); employee.employee_id = result.outBinds.employee_id[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> employee; } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.create = create;</code> </pre> <br> ä¸Šé¢çš„é€»è¾‘é¦–å…ˆå£°æ˜ä¸€ä¸ªåä¸ºcreateSqlçš„å¸¸é‡æ¥å­˜å‚¨insertè¯­å¥ã€‚ è¯·æ³¨æ„ï¼Œå®ƒä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»‘å®šå˜é‡</a> ï¼ˆè€Œä¸æ˜¯å­—ç¬¦ä¸²è¿æ¥ï¼‰æ¥å¼•ç”¨è¦æ’å…¥çš„å€¼ã€‚ å‡ºäºå®‰å…¨å’Œæ€§èƒ½çš„åŸå› ï¼Œå€¼å¾—é‡å¤ç»‘å®šå˜é‡çš„é‡è¦æ€§ã€‚ å°½å¯èƒ½é¿å…ä½¿ç”¨å­—ç¬¦ä¸²è¿æ¥ã€‚ <br><br> åœ¨createå‡½æ•°å†…éƒ¨ï¼Œä½¿ç”¨Object.assignä¸ºempå‚æ•°çš„å‰¯æœ¬å®šä¹‰å¹¶åˆå§‹åŒ–äº†é›‡å‘˜å¸¸é‡ã€‚ è¿™æ ·å¯ä»¥é˜²æ­¢ç›´æ¥ä¿®æ”¹ä»æ§åˆ¶å™¨ä¼ é€æ¥çš„å¯¹è±¡ã€‚ <br><br> ç„¶åï¼Œå°†employee_idå±æ€§æ·»åŠ åˆ°employeeå¯¹è±¡ï¼ˆé…ç½®ä¸ºâ€œ out bindâ€ï¼‰ï¼Œä»¥ä¾¿å®ƒåŒ…å«æ‰§è¡ŒSQLè¯­å¥æ‰€éœ€çš„æ‰€æœ‰ç»‘å®šå˜é‡ã€‚ ç„¶åï¼Œä½¿ç”¨simpleExecuteå‡½æ•°æ‰§è¡Œinsertè¯­å¥ï¼Œå¹¶ä½¿ç”¨outBindså±æ€§åœ¨è¿”å›å¯¹è±¡ä¹‹å‰è¦†ç›–employee.employee_idå±æ€§ã€‚ <br><br> ç”±äºå­˜åœ¨æŒ‡å‘oracledbæ¨¡å—çš„é“¾æ¥ï¼Œå› æ­¤éœ€è¦åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹è¡Œã€‚ <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> oracledb = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'oracledb'</span></span>);</code> </pre> <br><br>  <b>PUTè¯·æ±‚å¤„ç†</b> <br><br>  PUTè¯·æ±‚å°†ç”¨äºæ›´æ–°ç°æœ‰èµ„æºã€‚ é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼ŒPUTç”¨äºæ›¿æ¢æ•´ä¸ªèµ„æº-å®ƒä¸ä¼šæ‰§è¡Œéƒ¨åˆ†æ›´æ–°ï¼ˆä»¥åæˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨PATCHè¿›è¡Œæ›´æ–°ï¼‰ã€‚ è¿”å›<b>controllers / employee.js</b>æ–‡ä»¶ï¼Œå¹¶åœ¨ä¸‹é¢æ·»åŠ ä»¥ä¸‹ä»£ç ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">put</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> employee = getEmployeeFromRec(req); employee.employee_id = <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(req.params.id, <span class="hljs-number"><span class="hljs-number">10</span></span>); employee = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> employees.update(employee); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (employee !== <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { res.status(<span class="hljs-number"><span class="hljs-number">200</span></span>).json(employee); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { res.status(<span class="hljs-number"><span class="hljs-number">404</span></span>).end(); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { next(err); } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.put = put;</code> </pre> <br>  putå‡½æ•°ä½¿ç”¨getEmployeeFromRecåˆå§‹åŒ–ä¸€ä¸ªåä¸ºemployeeçš„å¯¹è±¡ï¼Œç„¶åå°†idå‚æ•°ä¸­çš„employee_idå±æ€§æ·»åŠ åˆ°URLã€‚ ç„¶åå°†é›‡å‘˜å¯¹è±¡ä¼ é€’ç»™æ•°æ®åº“APIæ›´æ–°åŠŸèƒ½ï¼Œå¹¶æ ¹æ®ç»“æœå°†ç›¸åº”çš„å“åº”å‘é€ç»™å®¢æˆ·ç«¯ã€‚ <br><br> è¦å°†æ›´æ–°é€»è¾‘æ·»åŠ åˆ°æ•°æ®åº“APIï¼Œè¯·å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<b>db_apis / employee.js</b>æ–‡ä»¶ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> updateSql = <span class="hljs-string"><span class="hljs-string">`update employees set first_name = :first_name, last_name = :last_name, email = :email, phone_number = :phone_number, hire_date = :hire_date, job_id = :job_id, salary = :salary, commission_pct = :commission_pct, manager_id = :manager_id, department_id = :department_id where employee_id = :employee_id`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">emp</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> employee = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({}, emp); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> database.simpleExecute(updateSql, employee); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.rowsAffected &amp;&amp; result.rowsAffected === <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> employee; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.update = update;</code> </pre> <br> æ›´æ–°é€»è¾‘ä¸åˆ›å»ºé€»è¾‘éå¸¸ç›¸ä¼¼ã€‚ å£°æ˜ä¸€ä¸ªå˜é‡ä»¥å­˜å‚¨SQLè¯­å¥ï¼Œç„¶åä½¿ç”¨simpleExecuteæ¥æ‰§è¡Œå¸¦æœ‰å·²ä¼ è¾“åŠ¨æ€å€¼çš„è¯­å¥ï¼ˆå°†å®ƒä»¬å¤åˆ¶åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¹‹åï¼‰ã€‚  result.rowsAffectedç”¨äºç¡®å®šæ›´æ–°æ˜¯å¦æˆåŠŸå¹¶è¿”å›æ­£ç¡®çš„å€¼ã€‚ <br><br>  <b>åˆ é™¤è¯·æ±‚å¤„ç†</b> <br><br> æ‚¨éœ€è¦å®ç°çš„æœ€åä¸€ä¸ªæ–¹æ³•æ˜¯DELETEï¼Œæ¯«ä¸å¥‡æ€ªï¼Œå®ƒå°†ä»æ•°æ®åº“ä¸­åˆ é™¤èµ„æºã€‚ åœ¨<b>controllers / employee.js</b>æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹ä»£ç <b>ã€‚</b> <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">del</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(req.params.id, <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> success = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> employees.delete(id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (success) { res.status(<span class="hljs-number"><span class="hljs-number">204</span></span>).end(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { res.status(<span class="hljs-number"><span class="hljs-number">404</span></span>).end(); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { next(err); } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.delete = del;</code> </pre> <br> å¦‚æœæ‚¨å°è¯•ä½¿ç”¨å‡½æ•°è¿ç®—ç¬¦å£°æ˜ä¸€ä¸ªç§°ä¸ºâ€œåˆ é™¤â€çš„å‡½æ•°ï¼Œåˆ™JavaScriptå¼•æ“å°†å¼•å‘å¼‚å¸¸ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå£°æ˜äº†ä¸€ä¸ªåä¸ºâ€œ delâ€çš„å‡½æ•°ï¼Œç„¶åå°†å…¶å¯¼å‡ºä¸ºâ€œ deleteâ€ã€‚ <br><br> æ­¤æ—¶ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿé˜…è¯»å’Œç†è§£é€»è¾‘ã€‚ ä¸å‰é¢çš„ç¤ºä¾‹ä¸åŒï¼Œæ­¤HTTPè¯·æ±‚æ²¡æœ‰æ­£æ–‡ï¼›ä»…idå‚æ•°ç”¨äºè·¯ç”±è·¯å¾„ä¸­ã€‚ å½“æœªå‘é€å“åº”æ­£æ–‡æ—¶ï¼ŒçŠ¶æ€ä»£ç â€œ 204 No Contentâ€é€šå¸¸ç”¨äºDELETEè¯·æ±‚ã€‚ <br><br> è¦å®Œæˆæ•°æ®åº“é€»è¾‘ï¼Œè¯·è¿”å›<b>db_apis / employee.js</b>æ–‡ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°æœ«å°¾ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> deleteSql = <span class="hljs-string"><span class="hljs-string">`begin delete from job_history where employee_id = :employee_id; delete from employees where employee_id = :employee_id; :rowcount := sql%rowcount; end;`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">del</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> binds = { <span class="hljs-attr"><span class="hljs-attr">employee_id</span></span>: id, <span class="hljs-attr"><span class="hljs-attr">rowcount</span></span>: { <span class="hljs-attr"><span class="hljs-attr">dir</span></span>: oracledb.BIND_OUT, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: oracledb.NUMBER } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> database.simpleExecute(deleteSql, binds); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.outBinds.rowcount === <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.delete = del;</code> </pre> <br> å› ä¸ºJOB_HISTORYè¡¨å…·æœ‰å¼•ç”¨EMPLOYEESè¡¨çš„å¤–é”®çº¦æŸï¼Œæ‰€ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„PL / SQLå—å¯ä»¥åœ¨ä¸€ä¸ªå‘¨æœŸå†…ä»ä¸¤ä¸ªè¡¨ä¸­åˆ é™¤å¿…è¦çš„è¡Œã€‚ <br><br>  <b>è§£æJSONè¯·æ±‚</b> <br><br> å¦‚æœæŸ¥çœ‹controllers / employee.jsä¸­çš„getEmployeeFromRecå‡½æ•°ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°è¯·æ±‚æ­£æ–‡å±æ€§æ˜¯ä¸€ä¸ªJavaScriptå¯¹è±¡ã€‚ è¿™æä¾›äº†ä¸€ç§ä»è¯·æ±‚æ­£æ–‡è·å–å€¼çš„ç®€ä¾¿æ–¹æ³•ï¼Œä½†è¿™ä¸ä¼šè‡ªåŠ¨å‘ç”Ÿã€‚ <br><br> æ‚¨åˆ›å»ºçš„APIè¦æ±‚å®¢æˆ·ç«¯åœ¨POSTå’ŒPUTè¯·æ±‚çš„ä¸»ä½“ä¸­ä»¥JSONæ ¼å¼å‘é€æ•°æ®ã€‚ æ­¤å¤–ï¼Œå®¢æˆ·ç«¯åº”å°†è¯·æ±‚çš„Content-Typeæ ‡å¤´è®¾ç½®ä¸ºapplication / jsonï¼Œä»¥ä¾¿WebæœåŠ¡å™¨çŸ¥é“å‘é€çš„è¯·æ±‚ä¸»ä½“ç±»å‹ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨express.jsonå†…ç½®çš„ä¸­é—´ä»¶ï¼Œä»¥ä¾¿Expresså¯ä»¥è§£ææ­¤ç±»è¯·æ±‚ã€‚ <br><br> æ‰“å¼€<b>services / web-server.jsæ–‡ä»¶ï¼Œ</b>å¹¶åœ¨app.useè°ƒç”¨ä¸‹æ–¹æ·»åŠ ä»¥ä¸‹è¡Œï¼Œè¿™ä¼šå°†morganæ·»åŠ åˆ°è¯·æ±‚ç®¡é“ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Parse incoming JSON requests and revive JSON. app.use(express.json({ reviver: reviveJson }));</span></span></code> </pre> <br> å°†JSONæ•°æ®è§£æä¸ºæœ¬æœºJavaScriptå¯¹è±¡æ—¶ï¼Œåªæœ‰JSONæ”¯æŒçš„æ•°æ®ç±»å‹æ‰èƒ½æ­£ç¡®æ˜ å°„åˆ°JavaScriptç±»å‹ã€‚  JSONä¸æ”¯æŒæ—¥æœŸï¼Œé€šå¸¸ä»¥ISO 8601å­—ç¬¦ä¸²è¡¨ç¤ºæ—¥æœŸã€‚ä½¿ç”¨ä¼ é€’ç»™express.jsonä¸­é—´ä»¶çš„reviverå‡½æ•°ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œè½¬æ¢ã€‚ å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<b>services / web-server.jsæ–‡ä»¶çš„æœ«å°¾</b> ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> iso8601RegExp = <span class="hljs-regexp"><span class="hljs-regexp">/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$/</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reviveJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key, value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// revive ISO 8601 date strings to instances of Date if (typeof value === 'string' &amp;&amp; iso8601RegExp.test(value)) { return new Date(value); } else { return value; } }</span></span></code> </pre> <br>  <b>APIæµ‹è¯•</b> <br><br> ç°åœ¨æ˜¯æ—¶å€™æµ‹è¯•æ–°çš„CRUDåŠŸèƒ½äº†ï¼ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å·²ç»ä½¿ç”¨æµè§ˆå™¨æµ‹è¯•äº†APIï¼Œä½†è¿™ä¸é€‚ç”¨äºPOSTï¼ŒPUTå’ŒDELETEè¯·æ±‚ã€‚ æˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨curlå‘½ä»¤æµ‹è¯•APIï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨è™šæ‹Ÿæœºä¸­è½»æ¾è®¿é—®ã€‚ ä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨å›¾å½¢å·¥å…·ï¼Œä¾‹å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Postman</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Insomina</a> ï¼ˆå…è´¹ï¼‰ã€‚ <br><br> å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œç„¶åæ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯çª—å£å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥åˆ›å»ºæ–°å‘˜å·¥ã€‚ <br><br><pre> <code class="javascript hljs">curl -X <span class="hljs-string"><span class="hljs-string">"POST"</span></span> <span class="hljs-string"><span class="hljs-string">"http://localhost:3000/api/employees"</span></span> \ -i \ -H <span class="hljs-string"><span class="hljs-string">'Content-Type: application/json'</span></span> \ -d $<span class="hljs-string"><span class="hljs-string">'{ "first_name": "Dan", "last_name": "McGhan", "email": "dan@fakemail.com", "job_id": "IT_PROG", "hire_date": "2014-12-14T00:00:00.000Z", "phone_number": "123-321-1234" }'</span></span></code> </pre> <br> å¦‚æœè¯·æ±‚æˆåŠŸï¼Œåˆ™å“åº”å¿…é¡»åŒ…å«ä¸€ä¸ªå¸¦æœ‰employee_idå±æ€§çš„é›‡å‘˜å¯¹è±¡ã€‚ è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š <br><br><img src="https://habrastorage.org/webt/7w/au/vk/7wauvk6m-ypdscfrwsciifabg9m.png" alt="å›¾ç‰‡"><br><br> åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œemployee_idçš„å€¼ä¸º227-æ‚¨å°†éœ€è¦æ ¹æ®æ”¶åˆ°çš„employee_idçš„å€¼æ›´æ”¹ä»¥ä¸‹å‘½ä»¤ã€‚ <br><br> ä¾‹å¦‚ï¼Œè¦æ›´æ–°æ–°æ¡ç›®ï¼Œè¯·ä½¿ç”¨æ­¤æ ‡è¯†ç¬¦å€¼ä¸ºURLè¾“å…¥PUTã€‚ <br><br><pre> <code class="javascript hljs">curl -X <span class="hljs-string"><span class="hljs-string">"PUT"</span></span> <span class="hljs-string"><span class="hljs-string">"http://localhost:3000/api/employees/227"</span></span> \ -i \ -H <span class="hljs-string"><span class="hljs-string">'Content-Type: application/json'</span></span> \ -d $<span class="hljs-string"><span class="hljs-string">'{ "first_name": "Dan", "last_name": "McGhan", "email": "dan@fakemail.com", "job_id": "AD_PRES", "hire_date": "2014-12-14T00:00:00.000Z", "phone_number": "123-321-1234" }'</span></span></code> </pre> <br>  HRæ¨¡å¼ä¸­çš„UPDATE_JOB_HISTORYè§¦å‘å™¨å°†æ£€æµ‹åˆ°ä½œä¸šæ›´æ”¹å¹¶å°†è¡Œæ·»åŠ åˆ°JOB_HISTORYè¡¨ä¸­ã€‚ å¦‚æœæŸ¥çœ‹æ­¤è¡¨ï¼Œåº”è¯¥ä¼šçœ‹åˆ°æ–°å‘˜å·¥çš„è®°å½•ã€‚ è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥åˆ é™¤ä½œä¸šå†å²è®°å½•å’Œå‘˜å·¥è®°å½•ã€‚ <br><br><pre> <code class="javascript hljs">curl -i -X <span class="hljs-string"><span class="hljs-string">"DELETE"</span></span> <span class="hljs-string"><span class="hljs-string">"http://localhost:3000/api/employees/227"</span></span></code> </pre> <br><br> ç°åœ¨ï¼Œæ‚¨æ‹¥æœ‰äº†æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶ä¸”å…·æœ‰å®Œæ•´çš„CRUDåŠŸèƒ½ï¼ <br><br>  APIè¿›å±•é¡ºåˆ©ï¼Œä½†ä»æœ‰å·¥ä½œè¦åšã€‚ åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ</a>æˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åœ¨GETè¯·æ±‚ä¸­æ·»åŠ åˆ†é¡µï¼Œæ’åºå’Œè¿‡æ»¤åŠŸèƒ½ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN473560/">https://habr.com/ru/post/zh-CN473560/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN473544/index.html">JPEGå¤šæ¬¡é‡æ–°åŠ è½½ç ”ç©¶</a></li>
<li><a href="../zh-CN473546/index.html">åœ¨TSDä¸Šçš„åº”ç”¨ä»¥åŠé€šè¿‡HTTPæœåŠ¡ä¸1Cï¼šEnterprise 8.3çš„é€šä¿¡ã€‚ ç¬¬2éƒ¨åˆ†ï¼ˆ1Cç«¯çš„APIå®ç°ï¼‰</a></li>
<li><a href="../zh-CN473548/index.html">PKIæƒåŠ›ä¸‹æ”¾ï¼šæé«˜å®‰å…¨æ€§çš„å»ºè®®æ–¹æ³•</a></li>
<li><a href="../zh-CN473550/index.html">å°ä¸‘2019ï¼šå¹´åº¦èƒœåˆ©</a></li>
<li><a href="../zh-CN473552/index.html">é€šè¿‡Clickjackingåœ¨2019ä¸­è¿›è¡Œå»åŒ¿å</a></li>
<li><a href="../zh-CN473562/index.html">Androidä¸­çš„åŠ å¯†é¦–é€‰é¡¹</a></li>
<li><a href="../zh-CN473564/index.html">æœ‰èƒ½åŠ›ï¼Œä½†æ²¡æœ‰ç†ç”±ï¼šäººå·¥æ™ºèƒ½æ— æ³•åº”å¯¹çš„ä»»åŠ¡</a></li>
<li><a href="../zh-CN473568/index.html">ç°åœºæœåŠ¡ï¼Œåœ°å›¾ä¸Šçš„åº”ç”¨ç¨‹åºï¼Œåœ°ç†ä½ç½®ã€‚ é€‰æ‹©åˆ¶å›¾æœåŠ¡ã€‚ äº§å“ä¾§è§†å›¾</a></li>
<li><a href="../zh-CN473570/index.html">10å°æ—¶å†…æœå¯»314å¹³æ–¹å…¬é‡Œ-æœç´¢å·¥ç¨‹å¸ˆä¸æ£®æ—çš„æœ€åä¸€æˆ˜</a></li>
<li><a href="../zh-CN473572/index.html">å°†é‡è¿°â€œæ‰å…‹ç½—é©¬ç›Â·ç½—è¿ªå¨œâ€ï¼šå¾·å›½å°†é€šè¿‡æ–°æ–¹æ³•ç¡®å®šæˆ˜ç•¥å‚¨å¤‡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>