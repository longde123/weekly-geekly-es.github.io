<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∏ üë∞üèæ üåá Erstellen von VirtualBox f√ºr Windows üó£Ô∏è üëåüèª üë©üèª‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intro 
 Vielen Benutzern der Windows-Version von VirtualBox (von nun an VB ; nicht zu verwechseln mit Visual Basic) ist bekannt, dass die Entwickler a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen von VirtualBox f√ºr Windows</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447300/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f6/4c2/1ba/2f64c21bac5d7f0c050e7442bd08960e.png"></div><br><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Intro </h4><br>  Vielen Benutzern der Windows-Version von VirtualBox (von nun an <em>VB</em> ; nicht zu verwechseln mit Visual Basic) ist bekannt, dass die Entwickler ab 4.3.14 das sogenannte "Hardening" hinzugef√ºgt haben, um dies zu verhindern b√∂swillige Injektionen in VB.  Obwohl die Absichten gut waren, verursachte die Implementierung zahlreiche Konflikte mit v√∂llig legitimen Produkten wie Virenschutzprogrammen, kryptografischen Modulen und sogar einigen Updates von Windows selbst, und wenn ein solcher Konflikt auftritt, funktioniert VB einfach nicht mehr.  Benutzer m√ºssen mindestens einen Monat warten, bis die neue VB-Version mit den entsprechenden Ausschl√ºssen ver√∂ffentlicht wird.  Im schlimmsten Fall muss die in Konflikt stehende Anwendung oder das in Konflikt stehende Update deinstalliert werden, oder VB selbst muss auf die neueste Version 4.3.12 heruntergestuft werden, ohne zu verh√§rten.  Zahlreiche Anfragen zum Hinzuf√ºgen einer benutzergesteuerten Ausschlussliste oder eine Option zum Deaktivieren der Absicherung bleiben unbeantwortet.  Die einzige Antwort von Entwicklern lautet: "Wenn Sie nicht m√∂chten, dass es selbst aus dem Quellcode erstellt wird".  Sieht so aus, als m√ºssten wir. <br><br>  Obwohl die Build-Anweisungen im offiziellen Projekt-Wiki beschrieben sind, sind sie unvollst√§ndig und etwas veraltet, w√§hrend die Build-Prozedur h√§ufig mit vagen Fehlermeldungen fehlschl√§gt.  Als ich es am Ende zum Laufen brachte, dachte ich, es lohnt sich, es in einem separaten Artikel ausf√ºhrlich zu dokumentieren.  Diese Anweisung wird von Zeit zu Zeit aktualisiert und ist derzeit an die Erstellung von VB Version 6.0.4 angepasst.  Wenn Sie jedoch Informationen zum Erstellen fr√ºherer Versionen von VB oder Zusatzbibliotheken ben√∂tigen, k√∂nnen Sie diese jederzeit aus dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√Ñnderungsverlauf abrufen</a> . <br><br><a name="habracut"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Inhaltsverzeichnis </h4><blockquote>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Problemstellung</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ein Wort der Warnung</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vorbereitung der Build-Umgebung</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anwendungsinstallationsprobleme</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Letzte Ber√ºhrungen</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VirtualBox erstellen</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nachwort</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√Ñnderungen</a> <br></blockquote><br><a name="task"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Problemstellung </h4><br>  Zuerst wollte ich es einfach halten, indem ich nur die Bin√§rkomponenten neu erstellte und sie auf die von der offiziellen Distribution installierte Version kopierte.  Dies war jedoch alles andere als einfach, da die Installation auf einer undurchsichtigen System-API beruht und die Installation der Treiber und die Registrierung der COM-Komponenten erfordert.  Ich fragte mich, ob es sinnvoll war, zu lernen, wie das alles funktioniert, und ein Skript zur Automatisierung dieser Aufgaben zu schreiben, aber nach einiger √úberlegung entschied ich mich, eine vollst√§ndige Distribution zu erstellen, die der offiziellen so nahe wie m√∂glich kommt, nur ohne H√§rten. <br><br>  Ich muss sagen, dass sich diese Aufgabe als sehr schwierig erwiesen hat und ich sie nicht zu 100% erf√ºllt habe.  Worauf ich gesto√üen bin, waren die Guest Additions, die f√ºr Windows (32- und 64-Bit), OS / 2, Linux und einige andere * NIX-Systeme bereitgestellt werden.  In den Kommentaren im entsprechenden Makefile wird erw√§hnt, dass sie alle auf verschiedenen Remote-Computern erstellt wurden, und ich freute mich definitiv nicht darauf, eine solche Build-Factory zu verwalten.  Meine endg√ºltige L√∂sung bestand also darin, alles au√üer den Erg√§nzungen aus den Quellcodes zu erstellen, aber das offizielle ISO-Image mitzunehmen und es einfach so wie es ist in meine Distribution aufzunehmen.  Ich habe nicht √ºberpr√ºft, ob die Zus√§tze den gleichen H√§rtungsmechanismus haben, aber selbst wenn dies der Fall ist, habe ich noch nie Beschwerden dar√ºber geh√∂rt. <br><br><a name="warnings"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Ein Wort der Warnung </h4><br><h5>  ‚Ä¢ Sicherheits√ºberlegungen </h5><br>  Das H√§rten wurde nicht aus einer Laune heraus hinzugef√ºgt, sondern war eine L√∂sung zum Schlie√üen einer Sicherheitsanf√§lligkeit in VB.  Leider weigert sich Oracle, die detaillierte Beschreibung des Problems bereitzustellen, obwohl es vor vielen Jahren behoben wurde.  Im Allgemeinen hat dies etwas mit dem DLL-Injection-Mechanismus in Windows zu tun, der im Fall von VB zu einer nicht autorisierten Erh√∂hung von Berechtigungen auf dem Host-Computer f√ºhren kann, und es gibt funktionierende Exploits f√ºr diese Sicherheitsanf√§lligkeit.  Seien Sie also gewarnt, wenn Sie sich trotzdem f√ºr eine Version ohne H√§rtung entscheiden. <br><br><h5>  ‚Ä¢ Treiber signieren </h5><br>  Ab Vista k√∂nnen Benutzer in 64-Bit-Windows-Versionen keine beliebigen Treiber mehr laden.  Die Treiber m√ºssen von einem Zertifikat mit einer zertifikats√ºbergreifenden Kette signiert sein, die bis zur Microsoft-Stammzertifizierungsstelle reicht (und in Windows 10 mit aktiviertem Secure Boot m√ºssen die Treiber von Microsoft selbst signiert sein).  Bevor Sie sich auf den Weg zum Bau von VB machen, m√ºssen Sie entscheiden, wie Sie dieses Problem l√∂sen m√∂chten.  Sie k√∂nnen entweder etwas Geld ausgeben und Ihr eigenes Zertifikat kaufen oder versuchen, sich an Drittanbieter zu wenden, die Signaturdienste f√ºr Open Source-Projekte anbieten (sofern diese damit einverstanden sind, anf√§llige Treiber zu signieren), oder Ihr Windows in den Testmodus versetzen, in dem Treiber geladen werden k√∂nnen signiert mit einem lokal generierten Testzertifikat. <br><br>  In dem Artikel werde ich haupts√§chlich das letztere Szenario implizieren, aber ich werde erw√§hnen, wie sich das Verfahren √§ndert, wenn Sie ein "ausgewachsenes" Handelszertifikat haben. <br><br><a name="environment"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Vorbereitung der Build-Umgebung </h4><br>  Im offiziellen Handbuch wird empfohlen, Windows 7 bis 10 als Build-System zu verwenden.  Ich habe die ganze Arbeit in Windows 7 SP1 x64 erledigt und glaube nicht, dass die Betriebssystemversion das Verfahren sehr beeinflusst.  Beachten Sie bitte, dass die Maschine (real oder virtuell), die Sie zum Erstellen von VB verwenden m√∂chten, √ºber eine Internetverbindung verf√ºgen muss. <br><br>  Die Build-Umgebung erfordert eine ganze Reihe von Tools.  Wenn ein Programm eine tragbare Version hat, bevorzuge ich diese, anstatt das Installationsprogramm zu verwenden. <br><br>  Jetzt k√∂nnen die folgenden Programme nur als installierbare Distributionen (zumindest offiziell) bezogen werden.  F√ºr Visual Studio und SDK / WDK ist es wichtig, die unten angegebene Installationsreihenfolge einzuhalten.  Nachdem Sie mit ihnen fertig sind, empfehle ich dringend, Windows Update auszuf√ºhren und die neuesten Updates f√ºr alle Microsoft-Produkte abzurufen. <br><ul><li>  <b>Visual Studio 2010 Professional</b> <br>  Sie ben√∂tigen genau die Version 2010 und sie sollte Professional oder h√∂her sein.  In der Version 2010 Express fehlt ATL, die zum Erstellen der COM-API erforderlich ist und von allen Frontends f√ºr die Kommunikation verwendet wird.  Ich habe versucht, auf die Community Edition VS 2013 oder 2015 umzusteigen, damit kein kostenpflichtiges Programm erforderlich ist (das sogar nicht mehr verkauft wird), bin aber bisher gescheitert. </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Windows SDK v7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Visual Studio 2010 SP1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Visual C ++ 2010 SP1-Compiler-Update f√ºr SDK 7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Windows Driver Development Kit (WDK) v7.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Windows SDK v8.1</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Activeperl</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ActivePython 2.7</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cygwin</a></b> </li></ul><br>  Die anderen Programme werden als tragbare Archive oder Quellcodes heruntergeladen: <br><ul><li>  <b><a href="">Qt 5.6.3</a></b> (Quellcode) </li><li>  <b>MinGW-w64 4.5.4</b> : <ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">32-Bit-Version</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">64-Bit-Version</a></b> </li></ul></li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SDL v1.2.x</a></b> (Entwicklungsbibliothek f√ºr Visual C ++) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">cURL</a></b> (Quellcode) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OpenSSL 1.1.1</a></b> (Quellcode) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gSOAP 2.8.x</a></b> (Version 2.8.41 oder h√∂her wird empfohlen) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">libvpx 1.7.0</a></b> (Quellcode; neuere Versionen unterst√ºtzen VS 2010 nicht) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">libopus 1.3</a></b> (Quellcode) </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MiKTeX Portable</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NASM</a></b> <br>  Ich empfehle die Verwendung der tragbaren 64-Bit-Version. </li><li> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WiX</a></b> <br>  Ich empfehle die Verwendung eines tragbaren Archivs (mit dem Namen <code>wix311-binaries.zip</code> ). </li></ul><br>  Sie ben√∂tigen au√üerdem folgende Archive: <br><ul><li>  <b><a href="">DocBook XML DTD 4.5</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DocBook XSL Stylesheets 1.69.1</a></b> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Wof√ºr solltest du das alles wollen?</b> <div class="spoiler_text">  Wenn Sie nicht genau das gleiche Paket wie ich erstellen m√∂chten, k√∂nnen Sie m√∂glicherweise einige der oben genannten Tools entfernen.  Hier werde ich einige Details f√ºr ihren Zweck im Erstellungsprozess angeben. <br><br><ul><li>  <b>SDK 8.1</b> <br>  Der eigentliche Build wird mit SDK 7.1 ausgef√ºhrt, Sie ben√∂tigen jedoch das SignTool-Programm ab 8.1, da das Programm ab 7.1 keine SHA-1 / SHA-256-Doppelsignatur ausf√ºhren kann.  Wenn Sie SDK 8.1 an einer anderen Stelle installiert haben, k√∂nnen Sie einfach <code>signtool.exe</code> mit all seinen Abh√§ngigkeiten von dort kopieren und den Pfad dazu in der Datei <code>LocalConfig.kmk</code> (siehe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unten</a> ). </li><li>  <b>WiX</b> <br>  Dies ist das Framework zum Erstellen von MSI-Paketen.  Obwohl die endg√ºltige VB-Distribution eine EXE-Datei ist, enth√§lt sie zwei MSI-Dateien. Sie ben√∂tigen daher WiX, um sie zu erstellen.  Wenn Sie jedoch nur die VB-Bin√§rdateien erstellen m√∂chten, ohne sie zu packen, k√∂nnen Sie dies ohne WiX tun. </li><li>  <b>Sdl</b> <br>  Diese Bibliothek wird f√ºr eine zus√§tzliche vereinfachte Front-End- <code>VBoxSDL.exe</code> verwendet, die anstelle von <code>VirtualBox.exe</code> .  Wenn Sie diese Komponente nicht ben√∂tigen, sollten Sie theoretisch in der Lage sein, den Build ohne SDL auszuf√ºhren, aber ich habe dies nicht versucht. </li><li>  <b>gSOAP</b> <br>  Diese Bibliothek wird zum <code>VBoxWebSrv.exe</code> , VB- <code>VBoxWebSrv.exe</code> , verwendet.  Wenn Sie nicht √ºber gSOAP verf√ºgen, wird diese Komponente w√§hrend der Erstellung stillschweigend √ºbersprungen. </li><li>  <b>libvpx</b> , <b>libopus</b> <br>  Dies sind die Video- und Audio-Codecs, die zum Aufzeichnen des VM-Bildschirms verwendet werden.  Wenn Sie sie nicht haben, wird der Build weiterhin erfolgreich abgeschlossen und VB verf√ºgt weiterhin √ºber alle Optionen f√ºr die Videoaufnahme. Diese Optionen werden jedoch ignoriert (obwohl die Aufnahmeanimation abgespielt wird, wird keine tats√§chliche Aufnahme gespeichert). . </li><li>  <b>Cygwin</b> <br>  Erforderlich zum Erstellen von libvpx. </li><li>  <b>MiKTeX</b> <br>  MiKTeX wird zum Kompilieren der PDF-Dokumentation verwendet ( <code>doc\UserManual.pdf</code> ).  Ohne dieses Programm wird das PDF stillschweigend beim Erstellen und Verpacken weggelassen. </li><li>  <b>NASM</b> <br>  Der Assembler, der beim Erstellen von OpenSSL verwendet wird.  Sie k√∂nnen es auch ohne Verwendung des Assemblers erstellen, ich empfehle jedoch weiterhin, es zum Generieren eines optimierten Codes zu verwenden. </li></ul></div></div><br>  Hier finden Sie eine Zusammenfassung aller von mir verwendeten Tools und Bibliotheken, einschlie√ülich der genauen Versionen (sofern m√∂glich) und Installationspfade, die ich auf meinem Build-System ausgew√§hlt habe.  Die Bezeichnung " <code>{x32|x64}</code> " wird f√ºr separate Installationsorte f√ºr 32- und 64-Bit-Versionen verwendet. <table><tbody><tr><th>  Programm / Werkzeug </th><th>  Version </th><th>  Installationspfad </th></tr><tr><td>  Visuelles Studio </td><td>  2010 Professional </td><td> <code>C:\Program Files (x86)\Microsoft Visual Studio 10.0\</code> </td> </tr><tr><td>  SDK </td><td>  7.1 </td><td> <code>C:\Program Files\Microsoft SDKs\Windows\v7.1\</code> </td> </tr><tr><td>  SDK </td><td>  8.1 </td><td> <code>C:\Programs\DevKits\8.1\</code> </td> </tr><tr><td>  Wdk </td><td>  7.1.0 </td><td> <code>C:\WinDDK\7600.16385.1\</code> </td> </tr><tr><td>  Activeperl </td><td>  5.26.1 Build 2601 x64 </td><td> <code>C:\Programs\Perl\</code> </td> </tr><tr><td>  ActivePython </td><td>  2.7.14.2717 x64 </td><td> <code>C:\Programs\Python\</code> </td> </tr><tr><td>  WiX </td><td>  3.11.1.2318 </td><td> <code>C:\Programs\WiX\</code> </td> </tr><tr><td>  Qt </td><td>  5.6.3 </td><td> <code>C:\Programs\Qt\5.6.3-{x32|x64}\</code> </td> </tr><tr><td>  MinGW-32 </td><td>  4.5.4 </td><td> <code>C:\Programs\mingw32\</code> </td> </tr><tr><td>  MinGW-64 </td><td>  4.5.4 </td><td> <code>C:\Programs\mingw64\</code> </td> </tr><tr><td>  Cygwin </td><td>  - - </td><td> <code>C:\Programs\cygwin64\</code> </td> </tr><tr><td>  Sdl </td><td>  1.2.15 </td><td> <code>C:\Programs\SDL\{x32|x64}\</code> </td> </tr><tr><td>  cURL </td><td>  7.64.1 </td><td> <code>C:\Programs\curl\{x32|x64}\</code> </td> </tr><tr><td>  √ñffnet </td><td>  1.1.1b </td><td> <code>C:\Programs\OpenSSL\{x32|x64}\</code> </td> </tr><tr><td>  gSOAP </td><td>  2.8.82 </td><td> <code>C:\Programs\gSOAP\</code> </td> </tr><tr><td>  libvpx </td><td>  1.7.0 </td><td> <code>C:\Programs\libvpx\</code> </td> </tr><tr><td>  libopus </td><td>  1.3 </td><td> <code>C:\Programs\libopus\</code> </td> </tr><tr><td>  MiKTeX Portable </td><td>  2.9.6942 </td><td> <code>C:\Programs\MiKTeX\</code> </td> </tr><tr><td>  NASM </td><td>  2.14.02 x64 </td><td> <code>C:\Programs\nasm\</code> </td> </tr><tr><td>  DocBook XML DTD </td><td>  4.5 </td><td> <code>C:\Programs\DocBook\xml\</code> </td> </tr><tr><td>  DocBook XSL-Stylesheets </td><td>  1.69.1 </td><td> <code>C:\Programs\DocBook\xsl\</code> </td> </tr></tbody></table><a name="environment-inst"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Anwendungsinstallations-Macken </h4><br>  Hier gebe ich einige Anweisungen zur Installation einiger der oben genannten Tools, bei denen das Verfahren nicht offensichtlich ist oder zus√§tzliche Ma√ünahmen erfordert. <br><br><h5>  ‚Ä¢ Windows SDK v7.1 </h5>  Die Installation dieses SDK schl√§gt wahrscheinlich fehl, da es die veralteten Versionen der Compiler- und Laufzeitbibliotheken enth√§lt.  Nach der Installation von VS 2010 sind im System neuere Versionen vorhanden, sodass die √§lteren Versionen nicht installiert werden k√∂nnen. Das Hauptinstallationsprogramm betrachtet dies als kritischen Fehler.  Um dies zu umgehen, m√ºssen Sie entweder die entsprechenden Kontrollk√§stchen deaktivieren oder vor der Installation des SDK die Pakete mit dem Namen <i>"Microsoft Visual C ++ 2010 &lt;arch&gt; Redistributable"</i> , <i>"Microsoft Visual C ++ 2010 &lt;arch&gt; Runtime"</i> , <i>"Microsoft"</i> deinstallieren <i>Visual C ++ - Compiler ... ‚Äù</i>  Lassen Sie das SDK die √§lteren Versionen davon installieren und f√ºhren Sie dann Windows Update aus, um die neuesten verf√ºgbaren Versionen zu erhalten. <br><br>  Stellen Sie bei der Installation des SDK sicher, dass Sie die Programmbeispiele (Windows Native Code Development -&gt; Beispiele) √ºberpr√ºfen: Sie enthalten einige Skripts, die von den VB-Erstellungsregeln verwendet werden.  Ohne sie k√∂nnen Sie die MSI-Pakete nicht erstellen. <br><br><h5>  ‚Ä¢ Windows SDK v8.1 </h5>  Sie m√ºssen nur die Komponente "Windows Software Development Kit" installieren. <br><br><h5>  ‚Ä¢ WDK v7.1 </h5>  Sie m√ºssen nur die Komponente "Build Environments" installieren. <br><br><h5>  ‚Ä¢ Qt 5.6.3 </h5>  Ab Qt 5.7.0 ben√∂tigen Sie zum Erstellen Visual Studio 2012 oder h√∂her, sodass wir bei 5.6.x bleiben. <br>  Da es keine offiziellen Builds f√ºr Visual Studio 2010 gibt, m√ºssen wir Qt selbst aus dem Quellcode erstellen. <br><br><ol><li>  Entpacken Sie das Qt-Quellcodearchiv in <code>C:\Programs\Qt\</code> und benennen Sie das Verzeichnis <code>qt-everywhere-opensource-src-5.6.3</code> in <code>5.6.3-src</code> . </li><li>  Daneben erstellen Sie ein Verzeichnis <code>build-x32</code> in dem der Build stattfinden wird. </li><li>  √ñffnen Sie die Konsole und f√ºhren Sie die folgenden Befehle aus, um die Umgebung vorzubereiten: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\Qt\build-x32 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTVER=<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTDIR=C:\Programs\Qt\<span class="hljs-variable"><span class="hljs-variable">%QTVER%</span></span>-x32 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%QTDIR%</span></span>\bin;<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QMAKESPEC=win32-msvc2010</code> </pre>  Der <code>SetEnv.Cmd</code> ist optional. Er entfernt die gr√ºne Farbe, die vom Skript <code>SetEnv.Cmd</code> . </li><li>  Jetzt m√ºssen wir das Skript <code>configure.bat</code> von <code>5.6.3-src</code> .  VB verwendet nicht das meiste, was Qt enth√§lt, daher k√∂nnen wir die Erstellungszeit erheblich reduzieren, indem wir verschiedene Komponenten deaktivieren. Beachten Sie jedoch, dass einige Optionen f√ºr VB von entscheidender Bedeutung sind.  Insbesondere habe ich Folgendes entdeckt: <ul><li>  OpenGL ES 2 wird nicht unterst√ºtzt (beim Erstellen von VB findet der Compiler einige Header-Dateien nicht). </li><li>  Die FreeType-Unterst√ºtzung muss aktiviert sein (andernfalls wird das Plugin <code>qoffscreen</code> nicht erstellt und ist f√ºr VB erforderlich). </li></ul>  Dies ist die vollst√§ndige Befehlszeile, mit der ich am Ende fertig bin: <pre> <code class="dos hljs">..\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-src\configure.bat -prefix c:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x32 -mp -opensource -confirm-license -nomake tests -nomake examples -no-compile-examples -release -shared -pch -no-ltcg -accessibility -no-sql-sqlite -opengl desktop -no-openvg -no-nis -no-iconv -no-evdev -no-mtdev -no-inotify -no-eventfd -largefile -no-system-proxies -qt-zlib -qt-pcre -no-icu -qt-libpng -qt-libjpeg -qt-freetype -no-fontconfig -qt-harfbuzz -no-angle -incredibuild-xge -no-plugin-manifests -qmake -qreal double -rtti -strip -no-ssl -no-openssl -no-libproxy -no-dbus -no-audio-backend -no-wmf-backend -no-qml-debug -no-direct2d -directwrite -no-style-fusion -native-gestures -skip qt3d -skip qtactiveqt -skip qtandroidextras -skip qtcanvas3d -skip qtconnectivity -skip qtdeclarative -skip qtdoc -skip qtenginio -skip qtgraphicaleffects -skip qtlocation -skip qtmacextras -skip qtmultimedia -skip qtquickcontrols -skip qtquickcontrols2 -skip qtscript -skip qtsensors -skip qtserialbus -skip qtserialport -skip qtwayland -skip qtwebchannel -skip qtwebengine -skip qtwebsockets -skip qtwebview -skip qtx11extras -skip qtxmlpatterns</code> </pre> </li><li>  Der hier angegebene Qt-Installationspfad (in der Option <code>-prefix</code> ) wird vom Konfigurationsskript fest in die Zwischenquellcodedateien <code>-prefix</code> , sodass sich auch die Bin√§rdateien daran erinnern.  Jede Qt-basierte Anwendung, die mit dieser Bibliothek erstellt wurde, sucht zuerst nach den erforderlichen Plugins in diesem Pfad. Nur wenn sie nicht gefunden werden konnten, verwendet sie ihren eigenen aktuellen Speicherort.  In den meisten F√§llen ist dies in Ordnung. Angenommen, auf dem Computer, auf dem unser VB installiert ist, befindet sich unter <code>c:\Programs\Qt\5.6.3-x32</code> weiterer Build von Qt, der jedoch mit verschiedenen Optionen oder von einem anderen Compiler kompiliert wurde.  Dann wird VB versuchen, diese (inkompatiblen) Plugins zu laden und abst√ºrzen. <br>  Es gibt zwei M√∂glichkeiten, um dieses Problem zu vermeiden.  Zun√§chst wird der Installation eine zus√§tzliche Datei mit dem Namen <code>qt.conf</code> mit dem folgenden Text <code>qt.conf</code> : <pre> <code class="plaintext hljs">[Paths] Plugins=.</code> </pre>  Die andere M√∂glichkeit besteht darin, den gespeicherten Installationspfad vor dem Erstellen von Qt so zu korrigieren, dass er auf das Verzeichnis der Anwendung verweist.  Ich entschied mich f√ºr den letzteren Weg, ich mochte die Idee nicht, zus√§tzliche Dateien zu der Oracle VB-Distribution zu haben.  Sie m√ºssen die vom Konfigurationsskript erstellte Datei <code>C:\Programs\Qt\build-x32\qtbase\src\corelib\global\qconfig.cpp</code> Suchen Sie die folgende Zeile: <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> qt_configure_prefix_path_str [<span class="hljs-number"><span class="hljs-number">512</span></span> + <span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-string"><span class="hljs-string">"qt_prfxpath=c:/Programs/Qt/5.6.3-x32"</span></span>;</code> </pre>  und ersetzen Sie den Pfad durch einen einzelnen Punkt, sodass diese Linie folgenderma√üen aussieht: <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> qt_configure_prefix_path_str [<span class="hljs-number"><span class="hljs-number">512</span></span> + <span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-string"><span class="hljs-string">"qt_prfxpath=."</span></span>;</code> </pre>  Diese √Ñnderung wirkt sich nur auf das Laufzeitverhalten des VB aus.  Der Installationsschritt von Qt selbst verwendet den urspr√ºnglichen Pfad, da er jetzt in den Makefiles gespeichert ist, die wir nicht √§ndern. </li><li>  F√ºhren Sie als N√§chstes den Build mit dem Befehl <code>nmake</code> </li><li>  Und installieren Sie die erstellte Bibliothek mit <code>nmake install</code> </li></ol><br>  √ñffnen Sie nun ein neues Konsolenfenster und machen Sie dasselbe f√ºr die 64-Bit-Version.  Sie m√ºssen "x32" in allen Pfaden durch "x64" ersetzen, und die Befehle zur Umgebungsvorbereitung sehen folgenderma√üen aus: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\Qt\build-x64 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\Qt\build-x64 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTVER=<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QTDIR=C:\Programs\Qt\<span class="hljs-variable"><span class="hljs-variable">%QTVER%</span></span>-x64 <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%QTDIR%</span></span>\bin;<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SET</span></span> QMAKESPEC=win32-msvc2010</code> </pre> <br>  Nach Abschluss der Installation k√∂nnen die Verzeichnisse <code>build-x32</code> , <code>build-x64</code> und <code>5.6.3-src</code> gel√∂scht werden. <br><br><h5>  ‚Ä¢ MinGW </h5>  Entpacken Sie einfach die 32- und 64-Bit-Archive in die entsprechenden Installationsverzeichnisse. <br><br><h5>  ‚Ä¢ Cygwin </h5>  W√§hrend der Installation m√ºssen Sie die Pakete <code>make</code> und <code>yasm</code> . <br><br><h5>  ‚Ä¢ SDL </h5><ol><li>  Entpacken Sie das SDL-Archiv zweimal in separate Pfade: <code>C:\Programs\SDL\x32\</code> und <code>C:\Programs\SDL\x64\</code> . </li><li>  Verschieben Sie den gesamten Inhalt des Unterverzeichnisses <code>C:\Programs\SDL\x64\lib\x64\</code> in das √ºbergeordnete Verzeichnis ( <code>C:\Programs\SDL\x64\lib\x64\</code> in <code>C:\Programs\SDL\x64\lib\</code> ) und l√∂schen Sie dann die Unterverzeichnisse <code>C:\Programs\SDL\x64\lib\x86</code> und <code>x64</code> . </li><li>  Machen Sie dasselbe f√ºr die 32-Bit-Version: Verschieben Sie den Inhalt von <code>C:\Programs\SDL\x32\lib\x86\</code> nach <code>C:\Programs\SDL\x32\lib\</code> und l√∂schen Sie dann <code>C:\Programs\SDL\x64\lib\x86</code> und <code>x64</code> . </li></ol><br><h5>  ‚Ä¢ NASM </h5>  Entpacken Sie das Archiv <code>nasm-2.14.02-win64.zip</code> in <code>C:\Programs\</code> und benennen Sie das resultierende Verzeichnis <code>nasm-2.14.02</code> in <code>nasm</code> . <br><br><h5>  ‚Ä¢ OpenSSL </h5><ol><li>  Entpacken Sie das OpenSSL-Archiv zweimal in <code>C:\Programs\OpenSSL\</code> und <code>openssl-1.1.1b</code> die Kopien des Verzeichnisses <code>openssl-1.1.1b</code> <code>openssl-1.1.1b-x32</code> und <code>openssl-1.1.1b-x64</code> . </li><li>  √ñffnen Sie die Konsole, erstellen und installieren Sie die 32-Bit-Version, indem Sie Folgendes ausf√ºhren: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span>;C:\Programs\nasm <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\OpenSSL\openssl-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>b-x32\ perl Configure VC-WIN32 no-shared --prefix=C:\Programs\OpenSSL\x32 --openssldir=C:\Programs\OpenSSL\x32\ssl nmake nmake test nmake install</code> </pre>  Wenn der Konfigurationsschritt eine be√§ngstigende Warnung √ºber einen fehlenden Compiler ausgibt, ignorieren Sie diese Nachricht bitte, sie liegt unversch√§mt. <br>  Wenn Sie NASM nicht verwenden m√∂chten, √ºberspringen Sie einfach den Befehl mit <code>PATH</code> √Ñnderung und geben Sie f√ºr das <code>Configure</code> Skript den zus√§tzlichen Parameter <code>no-asm</code> . </li><li>  √ñffnen Sie nun ein neues Konsolenfenster und machen Sie dasselbe f√ºr die 64-Bit-Version: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span>;C:\Programs\nasm <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\OpenSSL\openssl-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>b-x64\ perl Configure VC-WIN64A no-shared --prefix=C:\Programs\OpenSSL\x64 --openssldir=C:\Programs\OpenSSL\x64\ssl nmake nmake test nmake install</code> </pre>  Das Deaktivieren von NASM ist dasselbe wie bei 32-Bit. </li><li>  Jetzt k√∂nnen Sie die Verzeichnisse <code>C:\Programs\OpenSSL\openssl-1.1.1b-x32</code> und <code>openssl-1.1.1b-x64</code> . </li></ol><br><h5>  ‚Ä¢ cURL </h5><ol><li>  Entpacken Sie das cURL-Archiv in <code>C:\Programs\curl\</code> und benennen Sie das resultierende Unterverzeichnis <code>curl-7.64.1</code> in <code>curl-7.64.1-x32</code> . </li><li>  √ñffnen Sie die Datei <code>C:\Programs\curl\curl-7.64.1-x32\winbuild\MakefileBuild.vc</code> in einem Texteditor und suchen Sie nach dem folgenden Codeblock (um die Zeilen Nr. 61‚Äì69): <pre> <code class="plaintext hljs">!IF "$(VC)"=="6" CC_NODEBUG = $(CC) /O2 /DNDEBUG CC_DEBUG = $(CC) /Od /Gm /Zi /D_DEBUG /GZ CFLAGS = /I. /I../lib /I../include /nologo /W4 /wd4127 /GX /DWIN32 /YX /FD /c /DBUILDING_LIBCURL !ELSE CC_NODEBUG = $(CC) /O2 /DNDEBUG CC_DEBUG = $(CC) /Od /D_DEBUG /RTC1 /Z7 /LDd CFLAGS = /I. /I ../lib /I../include /nologo /W4 /wd4127 /EHsc /DWIN32 /FD /c /DBUILDING_LIBCURL !ENDIF</code> </pre>  Nach diesen Zeilen f√ºgen Sie die neue Direktive hinzu: <pre> <code class="plaintext hljs">CFLAGS = $(CFLAGS) /DCURL_DISABLE_LDAP</code> </pre>  Wenn Sie dies nicht tun, schl√§gt der Build von VB mit Verbindungsfehlern fehl. </li><li>  √ñffnen Sie nun die Datei <code>C:\Programs\curl\curl-7.64.1-x32\winbuild\gen_resp_file.bat</code> und <code>C:\Programs\curl\curl-7.64.1-x32\winbuild\gen_resp_file.bat</code> nach der ersten Zeile ( <code>@echo OFF</code> ) diesen Befehl ein: <pre> <code class="plaintext hljs">cd .</code> </pre>  Es wird nichts anderes getan, als den <code>ERRORLEVEL</code> Code zur√ºckzusetzen.  Das Skript ist so einfach, dass es ausgef√ºhrt werden kann, ohne einen Befehl auszuf√ºhren, der den Fehlercode √§ndern w√ºrde.  Wenn dieser Code also vor dem Starten des Skripts ungleich Null war, beh√§lt er seinen Wert beim Beenden des Skripts bei, und <code>nmake</code> w√ºrde <code>nmake</code> , dass es das Skript war, das diesen Fehlercode zur√ºckgegeben hat, und den Build mit einem Fehler beenden.  Das Hinzuf√ºgen dieser gef√§lschten <code>cd</code> behebt das Problem. </li><li>  <code>curl-7.64.1-x32</code> nun eine vollst√§ndige Kopie von <code>curl-7.64.1-x32</code> unter dem Namen <code>curl-7.64.1-x64</code> . </li><li>  √ñffnen Sie die Konsole, erstellen Sie die 32-Bit-Version und kopieren Sie die ben√∂tigten Dateien: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\curl\curl-<span class="hljs-number"><span class="hljs-number">7</span></span>.<span class="hljs-number"><span class="hljs-number">64</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>-x32\winbuild <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\curl\x32 nmake /f Makefile.vc <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=static WITH_SSL=static DEBUG=no MACHINE=x86 SSL_PATH=C:\Programs\OpenSSL\x32 ENABLE_SSPI=no ENABLE_WINSSL=no ENABLE_IDN=no <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x86-release-static-ssl-static-ipv6\lib\libcurl_a.lib ..\..\x32\libcurl.lib <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /E ..\builds\libcurl-vc-x86-release-static-ssl-static-ipv6\include\curl ..\..\x32\include\curl\</code> </pre> </li><li>  √ñffnen Sie ein anderes Konsolenfenster und erstellen Sie die 64-Bit-Version: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\curl\curl-<span class="hljs-number"><span class="hljs-number">7</span></span>.<span class="hljs-number"><span class="hljs-number">64</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>-x64\winbuild <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\curl\x64 nmake /f Makefile.vc <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=static WITH_SSL=static DEBUG=no MACHINE=x64 SSL_PATH=C:\Programs\OpenSSL\x64 ENABLE_SSPI=no ENABLE_WINSSL=no ENABLE_IDN=no <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\lib\libcurl_a.lib ..\..\x64\libcurl.lib <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /E ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\include\curl ..\..\x64\include\curl\ <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> ..\builds\libcurl-vc-x64-release-static-ssl-static-ipv6\bin\curl.exe ..\..\x64\curl.exe</code> </pre>  Beachten Sie, dass wir hier zus√§tzlich zu dem, was wir f√ºr die 32-Bit-Version getan haben, auch die Datei <code>curl.exe</code> .  Wir werden es sp√§ter verwenden, um das Bild mit den Gastzugaben herunterzuladen. </li><li>  Die Verzeichnisse <code>C:\Programs\curl\curl-7.64.1-x32</code> und <code>curl-7.64.1-x64</code> werden nicht mehr ben√∂tigt und k√∂nnen entfernt werden. </li></ol><br><h5>  ‚Ä¢ libvpx </h5><ol><li>  Entpacken Sie das libvpx-Archiv in <code>C:\Programs\libvpx-build\</code> . </li><li>  Starten Sie das Cygwin-Terminal, der Build wird dort ausgef√ºhrt.  Unsere Zielplattform ist Visual Studio 2010;  Das Build-System unterst√ºtzt es nur teilweise: Es versucht, den eigentlichen Build mit <code>msbuild.exe</code> auszuf√ºhren, funktioniert jedoch aus irgendeinem Grund nicht.  Ich konnte nicht herausfinden warum.  Stattdessen k√∂nnen wir einfach Visual Studio selbst ausf√ºhren und es zum Erstellen des Projekts verwenden.  Gl√ºcklicherweise kann es √ºber die Befehlszeile verwendet werden, so dass es nicht erforderlich ist, die eigentliche IDE zu starten (obwohl Sie dies k√∂nnen, wenn Sie m√∂chten. In diesem Fall m√ºssen Sie die Variable <code>PATH</code> √§ndern und den Pfad <code>C:\Programs\cygwin64\bin</code> dazu oder erlauben Sie VS auf andere Weise, die dort befindliche und f√ºr den Build erforderliche <code>yasm.exe</code> zu finden.  F√ºhren Sie zum Ausf√ºhren beider Architekturen die folgenden Befehle im Cygwin-Terminal aus: <pre> <code class="bash hljs">mkdir -p /cygdrive/c/Programs/libvpx-build/build32 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /cygdrive/c/Programs/libvpx-build/build32 ../libvpx-1.7.0/configure --target=x86-win32-vs10 --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-install-bins --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-examples --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-tools --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-docs --prefix=../../libvpx make <span class="hljs-string"><span class="hljs-string">"/cygdrive/c/Program Files (x86)/Microsoft Visual Studio 10.0/Common7/IDE/devenv.com"</span></span> vpx.sln /Project vpx.vcxproj /Rebuild <span class="hljs-string"><span class="hljs-string">"Release|Win32"</span></span> make install mkdir -p /cygdrive/c/Programs/libvpx-build/build64 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /cygdrive/c/Programs/libvpx-build/build64 ../libvpx-1.7.0/configure --target=x86_64-win64-vs10 --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-install-bins --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-examples --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-tools --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-docs --prefix=../../libvpx make <span class="hljs-string"><span class="hljs-string">"/cygdrive/c/Program Files (x86)/Microsoft Visual Studio 10.0/Common7/IDE/devenv.com"</span></span> vpx.sln /Project vpx.vcxproj /Rebuild <span class="hljs-string"><span class="hljs-string">"Release|x64"</span></span> make install</code> </pre> </li><li>  Schlie√üen Sie Cygwin, wir werden es nicht mehr brauchen.  Das Verzeichnis <code>C:\Programs\libvpx-build</code> kann entfernt werden. </li></ol><br><h5>  ‚Ä¢ Libopus </h5><ol><li>  Entpacken Sie das Opus-Archiv in <code>C:\Programs\libopus-build\</code> und <code>C:\Programs\libopus-build\</code> Sie in das Unterverzeichnis <code>opus-1.3\win32\VS2015</code> . </li><li>  Dieses Projekt wurde f√ºr die neuere Visual Studio-Version entwickelt, daher m√ºssen wir es √§ndern, damit es in unserer Version 2010 erstellt wird. Sie k√∂nnen dies entweder mit der IDE oder einem Nur-Text-Editor tun.  Ich habe mich f√ºr Letzteres entschieden.  √ñffnen Sie die Datei <code>opus.vcxproj</code> und gehen Sie wie folgt vor: <ol><li>  Suchen Sie alle Zeilen, die den Text enthalten <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PlatformToolset</span></span></span><span class="hljs-tag">&gt;</span></span>v140<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PlatformToolset</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  und ersetzen Sie <code>v140</code> durch <code>v100</code> .  Wenn Sie IDE verwenden, ist dies die Konfigurationsoption "Platrofm Toolset" auf der Seite Konfigurationseigenschaften -&gt; Allgemein.  Vergessen Sie nicht die Konfigurations- und Plattform-Selektoren oben im Dialogfeld. </li><li>  Suchen Sie als N√§chstes nach diesem Codeblock: <pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemDefinitionGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ClCompile</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  und f√ºgen Sie ein neues Tag hinzu: <pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugInformationFormat</span></span></span><span class="hljs-tag">&gt;</span></span>ProgramDatabase<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DebugInformationFormat</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  In der IDE k√∂nnen Sie dies tun, indem Sie die Seite Konfigurationseigenschaften -&gt; C / C ++ -&gt; Allgemein √∂ffnen und "Debug Information Format" in "ProgramDatabase (/ Zi)" setzen.  Sie k√∂nnen es auf einen anderen g√ºltigen Wert setzen. Wir ben√∂tigen die Debugging-Datenbank √ºberhaupt nicht, aber mit einem ung√ºltigen Wert kann das Projekt nicht erstellt werden. </li></ol></li><li>  Erstellen wir nun die Release-Version f√ºr beide Plattformen (entweder √ºber die VS-IDE oder die Befehlszeile) und kopieren Sie die Bibliothek <code>opus.lib</code> und das Unterverzeichnis <code>include\</code> in unseren <code>opus.lib</code> : <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\libopus-build\opus-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>\win32\VS2015 <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\libopus\lib\x64 <span class="hljs-built_in"><span class="hljs-built_in">md</span></span> C:\Programs\libopus\lib\Win32 <span class="hljs-built_in"><span class="hljs-built_in">xcopy</span></span> /EC:\Programs\libopus-build\opus-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>\include C:\Programs\libopus\include\ "C:\Program Files (x86)\Microsoft Visual Studio <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>\Common7\IDE\devenv.com" opus.sln /Project opus.vcxproj /Rebuild "Release|x64" <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> x64\Release\opus.lib C:\Programs\libopus\lib\x64\ "C:\Program Files (x86)\Microsoft Visual Studio <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>\Common7\IDE\devenv.com" opus.sln /Project opus.vcxproj /Rebuild "Release|Win32" <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> Win32\Release\opus.lib C:\Programs\libopus\lib\Win32\</code> </pre> </li><li>  Das Verzeichnis <code>C:\Programs\libopus-build</code> kann entfernt werden. </li></ol><br><h5>  ‚Ä¢ gSOAP </h5>  √ñffnen Sie das Archiv, gehen Sie in das Unterverzeichnis <code>gsoap-2.8\gsoap</code> und entpacken Sie den Inhalt in <code>C:\Programs\gSOAP\</code> .  OpenSSL 1.1.x erfordert gSOAP Version 2.8.41 oder h√∂her.  Wenn Sie aus irgendeinem Grund eine √§ltere Version verwenden m√∂chten, m√ºssen Sie den von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mattias Ellert</a> erstellten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Patch</a> anwenden.  Das Anwenden eines Patches kann entweder manuell erfolgen (das Format ist einfach: √ñffnen Sie die genannten Dateien, l√∂schen Sie die mit Minus gekennzeichneten Zeilen, f√ºgen Sie mit Plus gekennzeichnete Zeilen hinzu; der Rest ist Kontext) oder lassen Sie das <code>patch</code> Tool f√ºr Windows portieren und verwenden Sie es. <br><br><h5>  ‚Ä¢ MiKTeX </h5><ol><li>  Entpacken Sie das Archiv in <code>C:\Programs\MiKTeX\</code> . </li><li>  √ñffnen Sie die Konsole und installieren Sie weitere Module: <pre> <code class="dos hljs">"C:\Programs\MiKTeX\texmfs\install\miktex\bin\mpm.exe" --verbose --install=koma-script --install=ucs --install=tabulary --install=url --install=fancybox --install=fancyvrb --install=bera --install=charter --install=mptopdf</code> </pre> </li></ol><br><h5>  ‚Ä¢ DocBook </h5>  F√ºr die XML-DTD m√ºssen Sie ein Verzeichnis erstellen und den Archivinhalt dort entpacken.  Bei XSL-Stylesheets befindet sich der gesamte Inhalt bereits in einem einzigen Verzeichnis. Sie m√ºssen ihn also extrahieren und anschlie√üend umbenennen. <br><br><a name="final-touches"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png">  Letzte Ber√ºhrungen </h4><br>  Die Build-Umgebung ist fast fertig, es sind nur noch wenige Schritte erforderlich.  Laden Sie das VirtualBox-Quellcodearchiv herunter (falls Sie es noch nicht getan haben) und entpacken Sie es an den Ort, an dem Sie arbeiten m√∂chten.  Zu diesem Zweck habe ich <code>C:\Devel\</code> , dort die entpackten Quellcodes abgelegt und das Unterverzeichnis in <code>VirtualBox-src</code> . <br><br><h5>  ‚Ä¢ Hinzuf√ºgen von Zertifikaten </h5><br>  Wenn Sie kein kostenpflichtiges Zertifikat haben, empfehle ich Ihnen, mindestens ein selbstsigniertes pers√∂nliches Zertifikat zu erstellen: Es ist einfacher, Windows dazu zu bringen, selbstsignierte Treiber zu laden als nicht signierte.  √ñffnen Sie dazu die Konsole mit erh√∂hten Berechtigungen und f√ºhren Sie die folgenden Befehle aus, mit denen zwei Zertifikate (SHA-1 und SHA-256) hinzugef√ºgt und in Ihren pers√∂nlichen Speicher importiert werden: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> makecert.exe -a sha1 -r -pe -ss my -n "CN=Roga and Kopyta Ltd" C:\Devel\testcert_1.cer makecert.exe -a sha256 -r -pe -ss my -n "CN=Roga and Kopyta Ltd" C:\Devel\testcert_256.cer certmgr.exe -add C:\Devel\testcert_1.cer -s -r localMachine root certmgr.exe -add C:\Devel\testcert_256.cer -s -r localMachine root</code> </pre>  Sie k√∂nnen nat√ºrlich Ihren eigenen Namen f√ºr die Zertifikate anstelle von "Roga and Kopyta Ltd" und den Pfad zum Speichern der Dateien w√§hlen.  Jetzt m√ºssen wir die Fingerabdr√ºcke der generierten Zertifikate abrufen.  √ñffnen Sie die Zertifikatsverwaltungskonsole (indem Sie <code>certmgr.msc</code> ) und navigieren Sie zum pers√∂nlichen Speicher.  Dort sehen Sie die beiden neuen Zertifikate mit dem Namen "Roga and Kopyta Ltd".  Doppelklicken Sie auf den ersten.  Wechseln Sie im angezeigten Dialogfeld zur Registerkarte <i>Details</i> .  Das Feld "Signaturalgorithmus" enth√§lt den Algorithmusnamen: sha256RSA oder sha1RSA.  Scrollen Sie nach unten zum Feld "Fingerabdruck", das die Folge von Hexadezimalzahlen enth√§lt.  Kopieren Sie diesen vollst√§ndigen Wert und schreiben Sie ihn irgendwo auf.  Machen Sie dasselbe f√ºr das zweite Zertifikat.  Vergessen Sie nicht zu markieren, welcher Fingerabdruck f√ºr SHA-1 und welcher f√ºr SHA-256 war. <br><br><h5>  ‚Ä¢ Erstellen von xmllint </h5><br>  F√ºr einen der Build-Schritte ist das Programm <code>xmllint</code> erforderlich.  Ich habe es nicht in die Liste der Build-Anforderungen aufgenommen, da seine Quellen im VirtualBox-Archiv geb√ºndelt sind.  Sie m√ºssen es jedoch weiterhin selbst erstellen, da die VB-Erstellungsregeln dies nicht tun.  Ich habe <code>C:\Programs\xmllint</code> als <code>C:\Programs\xmllint</code> . <ol><li>  Kopieren Sie das Verzeichnis <code>C:\Devel\VirtualBox-src\src\libs\libxml2-2.9.4</code> nach <code>C:\Programs\</code> , um sicherzustellen, dass der Build VB in keiner Weise beeinflusst. </li><li>  √ñffnen Sie die Konsole und f√ºhren Sie die folgenden Befehle aus: <pre> <code class="dos hljs">"C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Programs\libxml2-<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">9</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>\win32 cscript.exe configure.js cruntime=/MT prefix=C:\Programs\xmllint iconv=no nmake /f Makefile.msvc nmake /f Makefile.msvc install</code> </pre> </li><li>  Entfernen Sie das Verzeichnis <code>C:\Programs\libxml2-2.9.4</code> . </li></ol><br><h5>  ‚Ä¢ √Ñnderungen von VB-Dateien </h5><br>  Bevor wir mit dem Build beginnen, m√ºssen wir auch einige √Ñnderungen am VB-Quellcode vornehmen.  Der vollst√§ndige Satz davon wird hier als herunterladbare Patch-Datei dargestellt, die entweder manuell oder mithilfe des <code>patch</code> Tools (das Sie separat herunterladen m√ºssen) angewendet werden kann: <br><br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>Vbox_build.patch</b></a> <br><br>  Wenn beim Anwenden des Patches keine Probleme aufgetreten sind, k√∂nnen Sie mit dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">n√§chsten Schritt fortfahren</a> .  Wenn Sie jedoch Probleme hatten und weitere Informationen zu bestimmten √Ñnderungen ben√∂tigen oder einfach nur verstehen m√∂chten, was und warum ge√§ndert wird, k√∂nnen Sie die folgenden Details lesen.  Bitte beachten Sie, dass die √Ñnderungen hier in einer anderen Reihenfolge als in der Patch-Datei vorgenommen werden.  Pfade zu den Dateien werden relativ zum VB-Quellcodeverzeichnis <code>C:\Devel\VirtualBox-src</code> . <ol><li>  Datei <code>configure.vbs</code> : <ul><li>  Die Codezeile: <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathVC &amp; <span class="hljs-string"><span class="hljs-string">"/bin/cl.exe"</span></span>), <span class="hljs-literal"><span class="hljs-literal">True</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code> </pre>  wird ersetzt durch: <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathVC &amp; <span class="hljs-string"><span class="hljs-string">"/bin/cl.exe"</span></span>) &amp; <span class="hljs-string"><span class="hljs-string">" /?"</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>) &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span></code> </pre>  Diese Zeile f√ºhrt die Compilerpr√ºfung durch, vergisst jedoch, dass <code>cl.exe</code> ohne Argumente einen Fehler zur√ºckgibt und daher als ung√ºltiger Compiler betrachtet wird.  Hinzuf√ºgen des " <code>/?</code>  "Argument bewirkt, dass die Hilfe ausgegeben und mit dem fehlerfreien Code 0 beendet wird. </li><li>  Springen wir nun zur Funktion <code>CheckForMinGW32Sub</code> .  Wie der Name schon sagt, wird die G√ºltigkeit des 32-Bit-MinGW √ºberpr√ºft.  Es wurde jedoch f√ºr Version 3.3.3 entwickelt, w√§hrend ich 4.5.4 verwende, das eine andere Datei- / Verzeichnisstruktur aufweist. Daher habe ich die gesamte Funktion durch den folgenden Code ersetzt (der im Grunde nur eine Kopie von <code>CheckForMinGWw64Sub</code> die f√ºr die <code>CheckForMinGWw64Sub</code> angepasst wurde) 32-Bit-Variante): <pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> CheckForMinGW32Sub(strPathMingW32, strPathW32API) g_strSubOutput = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> strPathW32API = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> strPathW32API = strPathMingW32 LogPrint <span class="hljs-string"><span class="hljs-string">"trying: strPathMingW32="</span></span> &amp;strPathMingW32 &amp; <span class="hljs-string"><span class="hljs-string">" strPathW32API="</span></span> &amp; strPathW32API <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/gcc.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/ld.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/objdump.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/dllwrap.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/dlltool.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"bin/as.exe"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"include/bfd.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"lib32/libgcc_s.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/dllcrt1.o"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/dllcrt2.o"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/libmsvcrt.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/lib/libmsvcr100.a"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/_mingw.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/stdint.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFileExists(strPathMingW32, <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32/include/windows.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Shell(DosSlashes(strPathMingW32 &amp; <span class="hljs-string"><span class="hljs-string">"/bin/gcc.exe"</span></span>) &amp; <span class="hljs-string"><span class="hljs-string">" -dumpversion"</span></span>, <span class="hljs-literal"><span class="hljs-literal">True</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">dim</span></span> offVer, iMajor, iMinor, iPatch, strVer <span class="hljs-comment"><span class="hljs-comment">' extract the version. strVer = Trim(Replace(Replace(g_strShellOutput, vbCr, ""), vbLf, "")) if (Mid(strVer, 2, 1) = ".") _ And (Mid(strVer, 4, 1) = ".") then iMajor = Int(Left(strVer, 1)) ' Is Int() the right thing here? I want atoi()!!! iMinor = Int(Mid(strVer, 3, 1)) iPatch = Int(Mid(strVer, 5)) else LogPrint "Malformed version: '" &amp; strVer &amp; "'" strVer = "" end if if strVer &lt;&gt; "" then if (iMajor = 4) And (iMinor &gt;= 4) then CheckForMinGW32Sub = True g_strSubOutput = strVer else LogPrint "MinGW32 version '" &amp; iMajor &amp; "." &amp; iMinor &amp; "." &amp; iPatch &amp; "' is not supported (or configure.vbs failed to parse it correctly)." end if else LogPrint "Couldn't locate the GCC version in the output!" end if else LogPrint "Failed to run gcc.exe!" end if end if end function</span></span></code> </pre> </li><li>  Unsere n√§chste Funktion ist <code>CheckForCurlSub</code> zu bearbeitende Codeblock lautet: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathCurl, <span class="hljs-string"><span class="hljs-string">"include/curl/curl.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.dll"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.lib"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _</code> </pre>  Es √ºberpr√ºft die G√ºltigkeit von libcurl, erfordert jedoch eine dynamisch verkn√ºpfte Version und schl√§gt fehl, wenn keine DLL-Datei gefunden werden kann.  Wir verwenden eine statisch verkn√ºpfte Version, daher muss der Check f√ºr die DLL leider gehen und uns Folgendes hinterlassen: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> LogFileExists(strPathCurl, <span class="hljs-string"><span class="hljs-string">"include/curl/curl.h"</span></span>) _ <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> LogFindFile(strPathCurl, <span class="hljs-string"><span class="hljs-string">"libcurl.lib"</span></span>) &lt;&gt; <span class="hljs-string"><span class="hljs-string">""</span></span> _</code> </pre> </li><li>  Gehen Sie nun in die Funktion <code>CheckForPython</code> in der die Variable <code>VBOX_BLD_PYTHON</code> generiert wird: <pre> <code class="vbscript hljs"> CfgPrint <span class="hljs-string"><span class="hljs-string">"VBOX_BLD_PYTHON := "</span></span> &amp; strPathPython &amp; <span class="hljs-string"><span class="hljs-string">"\python.exe"</span></span></code> </pre>  Der Backslash vor <code>python.exe</code> sollte durch den Forward ersetzt werden: <code>"/python.exe"</code> (ohne dieses <code>"/python.exe"</code> einige √úberpr√ºfungen w√§hrend des Erstellungsvorgangs fehl; ich habe keine anderen negativen Auswirkungen bemerkt, aber es ist h√ºbscher ohne Fehlermeldungen und auf jeden Fall besser sicher als leid). </li><li>  Die Windows-Version des Konfigurationsskripts unterst√ºtzt libvpx und libopus nicht, daher habe ich sie selbst hinzugef√ºgt.  Der einfachste Weg bestand nat√ºrlich darin, die Pfade zu den Bibliotheken fest zu codieren, aber ich zog es vor, sie wie alle anderen Komponenten zu implementieren, indem der Pfad in der Befehlszeile √ºbergeben und die G√ºltigkeit √ºberpr√ºft wurde.  Der Hauptcode hierf√ºr besteht aus den beiden Pr√ºffunktionen: <pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'' ' Checks for libvpx sub CheckForVpx(strOptVpx) dim strPathVpx, str strVpx = "libvpx" PrintHdr strVpx if strOptVpx = "" then MsgError "Invalid path specified!" exit sub end if if g_strTargetArch = "amd64" then strVsBuildArch = "x64" else strVsBuildArch = "Win32" end if strLibPathVpx = "lib/" &amp; strVsBuildArch &amp; "/vpxmd.lib" strPathVpx = "" if LogFileExists(strOptVpx, "include/vpx/vpx_encoder.h") _ And LogFileExists(strOptVpx, strLibPathVpx) _ then strPathVpx = UnixSlashes(PathAbs(strOptVpx)) CfgPrint "SDK_VBOX_VPX_INCS := " &amp; strPathVpx &amp; "/include" CfgPrint "SDK_VBOX_VPX_LIBS := " &amp; strPathVpx &amp; "/" &amp; strLibPathVpx else MsgError "Can't locate " &amp; strVpx &amp; ". " _ &amp; "Please consult the configure.log and the build requirements." exit sub end if PrintResult strVpx, strPathVpx end sub '' ' Checks for libopus sub CheckForOpus(strOptOpus) dim strPathOpus, str strOpus = "libopus" PrintHdr strOpus if strOptOpus = "" then MsgError "Invalid path specified!" exit sub end if if g_strTargetArch = "amd64" then strVsBuildArch = "x64" else strVsBuildArch = "Win32" end if strLibPathOpus = "lib/" &amp; strVsBuildArch &amp; "/opus.lib" strPathOpus = "" if LogFileExists(strOptOpus, "include/opus.h") _ And LogFileExists(strOptOpus, strLibPathOpus) _ then strPathOpus = UnixSlashes(PathAbs(strOptOpus)) CfgPrint "SDK_VBOX_OPUS_INCS := " &amp; strPathOpus &amp; "/include" CfgPrint "SDK_VBOX_OPUS_LIBS := " &amp; strPathOpus &amp; "/" &amp; strLibPathOpus else MsgError "Can't locate " &amp; strOpus &amp; ". " _ &amp; "Please consult the configure.log and the build requirements." exit sub end if PrintResult strOpus, strPathOpus end sub</span></span></code> </pre>  Die Funktionsverwendung wird zum Drucken der Liste der Befehlszeilenargumente verwendet.  F√ºgen Sie dort unsere beiden neuen Argumente hinzu: <pre> <code class="vbscript hljs"> Print <span class="hljs-string"><span class="hljs-string">" --with-libvpx=PATH "</span></span> Print <span class="hljs-string"><span class="hljs-string">" --with-libopus=PATH "</span></span></code> </pre>  Zu Beginn der Funktion <code>Main</code> viele Variablen zum Speichern von Pfaden zu den Komponenten definiert. Dort m√ºssen zwei neue hinzugef√ºgt werden: <pre> <code class="vbscript hljs"> strOptVpx = <span class="hljs-string"><span class="hljs-string">""</span></span> strOptOpus = <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre>  Etwas weiter unten befindet sich der <code>select-case</code> Block, der die Argumente verarbeitet und die Variablen ausf√ºllt.  Hinzuf√ºgen unseres Beitrags: <pre> <code class="vbscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"--with-libvpx"</span></span> strOptVpx = strPath <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"--with-libopus"</span></span> strOptOpus = strPath</code> </pre>  Und schlie√ülich befindet sich fast ganz am Ende der Datei die Kette all dieser √úberpr√ºfungsfunktionsaufrufe. Hier f√ºgen wir den Aufruf unserer beiden neuen Funktionen hinzu: <pre> <code class="vbscript hljs"> CheckForVpx strOptVpx CheckForOpus strOptOpus</code> </pre> </li></ul></li><li>  Die n√§chste Datei ist <code>src\VBox\Runtime\Makefile.kmk</code> .  Wir m√ºssen die Definitionen der Variablen <code>VBoxRT_LIBS.win</code> und <code>VBoxRT-x86_LIBS.win</code> finden und ihnen zwei neue Bibliotheken hinzuf√ºgen, <code>crypt32.lib</code> und <code>bcrypt.lib</code> .  Also der folgende Code: <pre> <code class="plaintext hljs">VBoxRT_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL)_LIB)/delayimp.lib</code> </pre>  verwandelt sich in: <pre> <code class="plaintext hljs">VBoxRT_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL)_LIB)/delayimp.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB)/crypt32.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB)/bcrypt.lib</code> </pre>  (Verpassen Sie nicht den <code>delayimp.lib</code> Backslash nach <code>delayimp.lib</code> !);  bzw. dieser Block: <pre> <code class="plaintext hljs">VBoxRT-x86_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL_STEM)X86_LIB)/delayimp.lib</code> </pre>  wird: <pre> <code class="plaintext hljs">VBoxRT-x86_LIBS.win = \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/vccomsup.lib \ $(PATH_SDK_$(VBOX_WINDDK)_LIB.x86)/wbemuuid.lib \ $(PATH_TOOL_$(VBOX_VCC_TOOL_STEM)X86_LIB)/delayimp.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB.x86)/crypt32.lib \ $(PATH_SDK_$(VBOX_WINPSDK)_LIB.x86)/bcrypt.lib</code> </pre>  Diese √Ñnderung ist f√ºr eine erfolgreiche Verkn√ºpfung von <code>VBoxRT.dll</code> .  Ich bin mir nicht 100% sicher, warum das so ist. Die Oracle-Version hat nicht die Ladezeitabh√§ngigkeit von <code>crypt32.dll</code> , sie wird zur Laufzeit geladen, daher sollte die LIB-Datei nicht erforderlich sein.  Ohne sie kann der Linker jedoch einige Funktionen nicht finden und schl√§gt fehl.  Ich vermute, dass dies mit den OpenSSL-Build-Optionen zusammenh√§ngt, habe dies jedoch nicht √ºberpr√ºft. Das Hinzuf√ºgen der Abh√§ngigkeit ist einfacher.  Die zweite Abh√§ngigkeit, <code>bcrypt.dll</code> , ist eine Voraussetzung f√ºr das neue OpenSSL 1.1.1. </li><li>  Wenn Sie √ºber gSOAP der Version 2.8.79 oder h√∂her verf√ºgen, m√ºssen Sie die Datei <code>src\VBox\Runtime\r3\win\VBoxRT-openssl-1.1plus.def</code> und der <code>src\VBox\Runtime\r3\win\VBoxRT-openssl-1.1plus.def</code> die folgenden Zeilen hinzuf√ºgen: <pre> <code class="plaintext hljs"> OpenSSL_version_num DH_generate_parameters_ex DH_new ASN1_STRING_get0_data</code> </pre>  Diese Liste definiert, welche Funktionen von der Bibliothek <code>VBoxRT.dll</code> (die OpenSSL enth√§lt) exportiert werden.  Wenn das Tool <code>VBoxWebSrv.exe</code> verkn√ºpft wird, sind je nach gSOAP-Version m√∂glicherweise zus√§tzliche OpenSSL-Funktionen erforderlich.  Da sie in der Exportliste fehlen, f√ºgt der Linker OpenSSL selbst hinzu und beschwert sich sofort √ºber <code>VBoxRT</code> Konflikte zwischen dieser externen OpenSSL und ihrer eigenen Kopie, die bereits in <code>VBoxRT</code> .  Das Hinzuf√ºgen der oben genannten Exporte behebt das Problem. </li><li>  Wie eingangs erw√§hnt, erstelle ich keine Gastzugaben, aber ich muss das ISO-Image als Teil der Distribution haben.  Die Erstellungsregeln sind f√ºr dieses Szenario konzipiert, sie erwarten jedoch, dass das fertige ISO-Image zur richtigen Zeit auf magische Weise am richtigen Ort angezeigt wird.  Ich habe diese Magie in die Datei <code>src\VBox\Makefile.kmk</code> .  Suchen Sie nach folgendem Code: <pre> <code class="plaintext hljs"> ifdef VBOX_WITH_ADDITIONS include $(PATH_SUB_CURRENT)/Additions/Makefile.kmk endif</code> </pre>  und direkt darunter gilt die Regel f√ºr den automatischen Download der Bilddatei: <pre> <code class="plaintext hljs"> ifndef VBOX_WITHOUT_ADDITIONS_ISO $(VBOX_PATH_ADDITIONS_ISO)/VBoxGuestAdditions.iso: $(QUIET)$(MKDIR) -p $(@D) $(VBOX_RETRY) $(TOOL_CURL_FETCH) http://download.virtualbox.org/virtualbox/$(VBOX_VERSION_STRING_RAW)/VBoxGuestAdditions_$(VBOX_VERSION_STRING_RAW).iso -o $@ endif</code> </pre>  Wenn Sie die Dateien manuell bearbeiten, anstatt den Patch anzuwenden, beachten Sie bitte, dass die Regelbefehle mit dem Tabellierungszeichen beginnen m√ºssen. </li><li>  Vor der Version 6.0 war die Dokumentation eines der Subsysteme, die ohne √Ñnderungen erfolgreich erstellt wurden.  Ich wei√ü nicht, was daran falsch war, aber es wurde erheblich √ºberarbeitet, so dass es auf meinem Build-System nicht mehr funktioniert.  Ich habe keine Ahnung, wie Oracle die Dokumentation selbst erstellt (m√∂glicherweise auf einem * NIX-System), aber f√ºr mich haben die Erstellungsregeln immer wieder Schr√§gstriche in den Pfaden verloren oder einen √úberschuss hinzugef√ºgt, sodass die Zieldateien nicht gefunden wurden wegen Nicht√ºbereinstimmungen in Katalogdateien.  Ich habe es endlich geschafft, einige √Ñnderungen zu kombinieren, die es erm√∂glichten, die Dokumentation fehlerfrei zu erstellen.  Zun√§chst fehlte eines der Zielverzeichnisse, sodass einige der Zwischendateien nicht erstellt werden konnten.  Dieses Problem wurde in der Datei <code>doc\manual\Makefile.kmk</code> im folgenden Codeblock behoben: <pre> <code class="plaintext hljs">define def_vbox_refentry_to_user_sect1 $$(VBOX_PATH_MANUAL_OUTBASE)/$(1)/user_$(2): $(3) \ $$(VBOX_PATH_MANUAL_SRC)/docbook-refentry-to-manual-sect1.xsl \ $$(VBOX_XML_CATALOG) $$(VBOX_XML_CATALOG_DOCBOOK) $$(VBOX_XML_CATALOG_MANUAL) \ $$(VBOX_VERSION_STAMP) | $$(dir $$@) $$(call MSG_TOOL,xsltproc $$(notdir $$(filter %.xsl,$$^)),,$$(filter %.xml,$$^),$$@) $$(QUIET)$$(RM) -f "$$@" $$(QUIET)$$(call VBOX_XSLTPROC_WITH_CAT) --output $$@ $$(VBOX_PATH_MANUAL_SRC)/docbook-refentry-to-manual-sect1.xsl $$&lt; endef</code> </pre>  Kurz nach dem <code>$$(RM)</code> habe ich einen Befehl zum Erstellen des fehlenden Verzeichnisses hinzugef√ºgt: <pre> <code class="plaintext hljs"> $$(QUIET)$$(MKDIR) -p "$$(@D)"</code> </pre> <br>  Die Korrekturen f√ºr die Schr√§gstriche befinden sich in der Datei <code>doc\manual\Config.kmk</code> .  Ich konnte keine ‚Äûnormale‚Äú L√∂sung daf√ºr finden, aber es gibt eine Problemumgehung, die f√ºr praktische Zwecke gut genug ist und die das Duplizieren der Pfadsubstitutionsregeln f√ºr die falschen Pfade impliziert.  Erstens unter der Linie: <pre> <code class="plaintext hljs"> VBOX_FILE_URL_MAYBE_SLASH = $(if $(eq $(KBUILD_HOST),win),/,)</code> </pre> I've created two new variables which basically contain the same paths as their origins, but with triple slash after the disk letter instead of a single slash: <pre> <code class="plaintext hljs"> VBOX_PATH_MANUAL_SRC_SLASHED = $(subst :/,:///,$(VBOX_PATH_MANUAL_SRC)) VBOX_PATH_MANUAL_OUTBASE_SLASHED = $(subst :/,:///,$(VBOX_PATH_MANUAL_OUTBASE))</code> </pre> A little bit below that, there is a rule for creating the catalog file: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG): $(MAKEFILE_CURRENT) | $$(dir $$@) $(call MSG_L1,Creating catalog $@) $(QUIET)$(APPEND) -tn "$@" \ '&lt;?xml version="1.0"?&gt;' \ '&lt;!DOCTYPE catalog PUBLIC "-//OASIS//DTD Entity Resolution XML Catalog V1.0//EN" "http://www.oasis-open.org/committees/entity/release/1.0/catalog.dtd"&gt;' \ '&lt;catalog xmlns="urn:oasis:names:tc:entity:xmlns:xml:catalog"&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/ENTITIES DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/DTD DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateURI uriStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ '&lt;/catalog&gt;'</code> </pre> For each line which contains the variable <code>VBOX_PATH_MANUAL_SRC</code> or <code>VBOX_PATH_MANUAL_OUTBASE</code> (except for the line with the <code>file://</code> prefix), I've appended the copy of the whole line, but with the variable replaced with its triple-slash counterpart. The result looks like this: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG): $(MAKEFILE_CURRENT) | $$(dir $$@) $(call MSG_L1,Creating catalog $@) $(QUIET)$(APPEND) -tn "$@" \ '&lt;?xml version="1.0"?&gt;' \ '&lt;!DOCTYPE catalog PUBLIC "-//OASIS//DTD Entity Resolution XML Catalog V1.0//EN" "http://www.oasis-open.org/committees/entity/release/1.0/catalog.dtd"&gt;' \ '&lt;catalog xmlns="urn:oasis:names:tc:entity:xmlns:xml:catalog"&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/ENTITIES DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegatePublic publicIdStartString="-//OASIS/DTD DocBook XML" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateURI uriStartString="http://www.oasis-open.org/docbook/" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_DOCBOOK)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateSystem systemIdStartString="$(VBOX_PATH_MANUAL_SRC_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_SRC_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ ' &lt;delegateURI uriStartString="$(VBOX_PATH_MANUAL_OUTBASE_SLASHED)" catalog="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_XML_CATALOG_MANUAL)"/&gt;' \ '&lt;/catalog&gt;'</code> </pre> Even further down, there is another rule for creating an auxiliary catalog file; the starting line is: <pre> <code class="plaintext hljs"> $(VBOX_XML_CATALOG_MANUAL): $(MAKEFILE_CURRENT) | $$(dir $$@)</code> </pre> Here I'm doing the same operation as above. In addition, in the beginning of the generated file there are several lines defining the entries in the <code>common/</code> subdirectory: <pre> <code class="plaintext hljs"> ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-accessibility-en.xml" uri="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-support-en.xml" uri="file://$(VBOX_FILE_URL_MAYBE_SLASH)$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \</code> </pre> With these we have the opposite problem: triple slash after the <code>file</code> is replaced with a single slash. I worked this around by getting rid of the <code>file</code> protocol altogether and replacing those URIs with direct file system paths in the target address (the <code>uri</code> attribute). The result for these lines looks like this (including the aforementioned fix): <pre> <code class="plaintext hljs"> ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-accessibility-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC_SLASHED)/common/oracle-accessibility-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-accessibility-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC)/common/oracle-support-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \ ' &lt;system systemId="$(VBOX_PATH_MANUAL_SRC_SLASHED)/common/oracle-support-en.xml" uri="$(VBOX_PATH_MANUAL_SRC)/en_US/oracle-support-en.xml"/&gt;' \</code> </pre> </li><li> When VB is built with signing, most of its binaries receive the integrity check flag (the linker option <code>/IntegrityCheck</code> ) which forces Windows to check digital signatures and forbids launching applications which are signed incorrectly. If you have a valid paid certificate that's not a problem; however with a self-signed certificate VB will refuse to start, even if Windows is booted in the test mode. I've modified the file <code>Config.kmk</code> in such a way that this flag is only added when you have a full-grown certificate (the criterion of that is presence of a cross-certificate in <code>LocalConfig.kmk</code> ; see <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">below</a> ). The changes look like this: <ul><li> A new variable <code>VBOX_INTEGRITY_CHECK</code> is added, which contains the desired value of the option: <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE) VBOX_INTEGRITY_CHECK := /IntegrityCheck else VBOX_INTEGRITY_CHECK := /IntegrityCheck:NO endif</code> </pre> </li><li> Below that there is the <code>editbin</code> call: <pre> <code class="plaintext hljs"> $(VBOX_VCC_EDITBIN) /LargeAddressAware /DynamicBase /NxCompat /Release /IntegrityCheck \ /Version:$(VBOX_VERSION_MAJOR)0$(VBOX_VERSION_MINOR).$(VBOX_VERSION_BUILD) \ "$@"</code> </pre> Here I've replaced the unconditional <code>/IntegrityCheck</code> with the new variable <code>$(VBOX_INTEGRITY_CHECK)</code> . </li><li> Next, look for the blocks of the following kinds: <pre> <code class="plaintext hljs">ifdef VBOX_SIGNING_MODE TEMPLATE_XXXXXX_LDFLAGS += -IntegrityCheck endif</code> </pre>  oder <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_WITH_HARDENING) TEMPLATE_XXXXXX_LDFLAGS += -IntegrityCheck endif</code> </pre> where ¬´ <code>XXXXXX</code> ¬ª stands for various component names. There are 6 such blocks in total, 3 of each kind. Here I've modified the condition by adding a check for cross-certificate. The first line then turns into, respectively: <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE)</code> </pre>  oder <pre> <code class="plaintext hljs">if defined(VBOX_SIGNING_MODE) &amp;&amp; defined(VBOX_CROSS_CERTIFICATE_FILE) &amp;&amp; defined(VBOX_WITH_HARDENING)</code> </pre> </li></ul></li><li> Two more files modified by me do not take immediate part in building of VB: <code>src\VBox\Installer\win\Scripts\PackDriversForSubmission.cmd</code> and <code>UnpackBlessedDrivers.cmd</code> . These auxiliary scripts can be used if you intend to send the drivers into Microsoft for Windows 10 signing. The first script prepares a CAB archive for sending; the second one unpacks the resultant ZIP archive with the signed drivers and verifies the signatures. In the packing script all I did was just fixing several typos. In the unpacking script I added ability to specify path to the <code>signtool</code> program, and got rid of the <code>unzip</code> tool by replacing it with a small Perl script. The signing procedure is described below. If you don't plan to get the Microsoft signature you can simply ignore all these changes in the scripts. </li></ol><br><a name="final-touches-localconfig"></a><h5> ‚Ä¢ VB build configuration file </h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt m√ºssen wir die Datei </font></font><code>LocalConfig.kmk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im VB-Quellverzeichnis </font><font style="vertical-align: inherit;">erstellen </font><font style="vertical-align: inherit;">und dort alle Pfade und Erstellungsparameter schreiben. </font><font style="vertical-align: inherit;">Sie k√∂nnen den folgenden Text als Vorlage verwenden:</font></font><pre> <code class="plaintext hljs">VBOX_WITH_HARDENING := VBOX_PATH_WIX := C:\Programs\WiX VBOX_GSOAP_INSTALLED := 1 VBOX_PATH_GSOAP := C:\Programs\gSOAP VBOX_WITH_COMBINED_PACKAGE := 1 VBOX_WITH_QT_PAYLOAD := 1 VBOX_WITH_QTGUI_V5 := 1 VBOX_SIGNING_MODE := release VBOX_CERTIFICATE_SUBJECT_NAME := Roga and Kopyta Ltd VBOX_CERTIFICATE_FINGERPRINT := XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX VBOX_CERTIFICATE_SHA2_SUBJECT_NAME := Roga and Kopyta Ltd VBOX_CERTIFICATE_SHA2_FINGERPRINT := XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX XX VBOX_TSA_URL := http://timestamp.digicert.com VBOX_TSA_SHA2_URL := http://timestamp.digicert.com VBOX_TSA_URL_ARGS := /t "$(VBOX_TSA_URL)" VBOX_TSA_SHA2_URL_ARGS := /tr "$(VBOX_TSA_SHA2_URL)" /td sha256 VBOX_CROSS_CERTIFICATE_FILE := VBOX_CROSS_CERTIFICATE_FILE_ARGS := VBOX_CROSS_CERTIFICATE_SHA2_FILE := VBOX_CROSS_CERTIFICATE_SHA2_FILE_ARGS := VBOX_PATH_SIGN_TOOLS := C:\Programs\DevKits\8.1\bin\x64 VBOX_PATH_SELFSIGN := C:\WinDDK\7600.16385.1\bin\selfsign VBOX_PATH_WISUMINFO := "C:\Program Files\Microsoft SDKs\Windows\v7.1\Samples\sysmgmt\msi\scripts\WiSumInf.vbs" VBOX_PATH_WISUBSTG := "C:\Program Files\Microsoft SDKs\Windows\v7.1\Samples\sysmgmt\msi\scripts\WiSubStg.vbs" VBOX_WITH_DOCS := 1 VBOX_WITH_DOCS_CHM := 1 VBOX_WITH_DOCS_PACKING := 1 VBOX_WITH_ADDITIONS := VBOX_WITH_ADDITIONS_PACKING := 1 VBOX_HAVE_XMLLINT := 1 VBOX_XMLLINT := C:\Programs\xmllint\bin\xmllint.exe VBOX_PATH_DOCBOOK := C:/Programs/DocBook/xsl VBOX_PATH_DOCBOOK_DTD := C:/Programs/DocBook/xml VBOX_PATH_HTML_HELP_WORKSHOP := "C:\Program Files (x86)\HTML Help Workshop" VBOX_PDFLATEX := C:\Programs\MiKTeX\texmfs\install\miktex\bin\pdflatex.exe VBOX_PDFLATEX_CMD := $(VBOX_PDFLATEX) -halt-on-error -interaction batchmode TOOL_CURL_FETCH := C:\Programs\curl\x64\curl.exe PATH_TOOL_NASM := C:/Programs/nasm VBOX_INSTALLER_LANGUAGES := en_US VBOX_WITH_TESTCASES := VBOX_WITH_VALIDATIONKIT := VBOX_WITH_VBOX_IMG := 1 VBOX_WITH_RECORDING := 1 VBOX_WITH_AUDIO_RECORDING := 1 SDK_VBOX_VPX := 1 VBOX_WITH_LIBVPX := 1 SDK_VBOX_OPUS := 1 VBOX_WITH_LIBOPUS := 1 VBOX_BUILD_PUBLISHER := _OSE</code> </pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie m√ºssen diese Vorlage bearbeiten: </font></font><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Variablen </font></font><code>VBOX_CERTIFICATE_SUBJECT_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>VBOX_CERTIFICATE_SHA2_SUBJECT_NAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sollten die Namen der SHA-1- bzw. SHA-256-Zertifikate enthalten.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Variablen </font></font><code>VBOX_CERTIFICATE_FINGERPRINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und </font></font><code>VBOX_CERTIFICATE_SHA2_FINGERPRINT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sollten die Fingerabdr√ºcke dieser Zertifikate enthalten. </font><font style="vertical-align: inherit;">Sie haben sie zuvor von der Zertifikatsverwaltungskonsole kopiert.</font></font></li><li> If you have a paid certificate you should delete the lines defining the variables <code>VBOX_CROSS_CERTIFICATE_FILE_ARGS</code> and <code>VBOX_CROSS_CERTIFICATE_SHA2_FILE_ARGS</code> , then in the variables <code>VBOX_CROSS_CERTIFICATE_FILE</code> and <code>VBOX_CROSS_CERTIFICATE_SHA2_FILE</code> (without ¬´ <code>_ARGS</code> ¬ª) put the full path to the cross-certificate (without it the drivers will not be accepted). You can download it from the web site of the company that issued the certificate, or <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">from Microsoft</a> . </li><li> You can fine-tune the signing process using various additional variables and macros to redefine the certificate storage, timestamp server, or even construct a full command line for the <code>signtool</code> program. You can take a look into the file <code>Config.kmk</code> below the comment ¬´Code Signing¬ª, there you'll find which variables are defined and how they are used. </li><li> If you've installed some of the programs into paths different from mine, you need to fix those paths in the template. It's strongly recommended to keep the path style for each variable (forward/backward slashes), sometimes it's critical for successful build. </li><li> Fox WiX you need to specify the path to its binaries. With the portable version, it is just the directory where you unpacked it; if you used the installer, the binaries will be located in the subdirectory <code>bin</code> . Please, note, that the path must not contain spaces! If it does you have to convert it into the 8.3 format (you can use <code>dir /x</code> for that). Unfortunately, enclosing the path in quotes does not work with this variable. </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Variable </font></font><code>VBOX_BUILD_PUBLISHER</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gibt das Branding-Suffix in der Versionsnummer an. </font><font style="vertical-align: inherit;">Standardm√§√üig ist es "_OSE" (dh die vollst√§ndige Produktversion ist "6.0.4_OSE"). </font><font style="vertical-align: inherit;">Sie k√∂nnen hier ein beliebiges anderes Suffix angeben oder es auf leer setzen, um es vollst√§ndig zu entfernen. </font><font style="vertical-align: inherit;">Wenn Sie die Variable jedoch vollst√§ndig l√∂schen, wird die Standardeinstellung "_OSE" verwendet.</font></font></li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die restlichen Variablen werden meistens verwendet, um zu deklarieren, welche Komponenten erstellt werden sollen. </font><font style="vertical-align: inherit;">Und nat√ºrlich steht die Hauptdeklaration ganz oben: Schalten Sie die Aush√§rtung aus.</font></font><br><br><a name="build-vb"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Virtualbox erstellen </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schlie√ülich k√∂nnen wir jetzt mit dem Erstellen von VirtualBox selbst beginnen. </font><font style="vertical-align: inherit;">Wenn Sie normalerweise lieber parallel f√ºr verschiedene Plattformen erstellen m√∂chten, m√ºssen Sie zun√§chst darauf verzichten oder zwei separate Quellbaumkopien verwenden, da VB √ºber eine gemeinsame Konfigurationsdatei verf√ºgt, die vor dem Erstellen generiert wird und plattformabh√§ngige Daten enth√§lt. </font><font style="vertical-align: inherit;">Es w√§re f√ºr den Compiler nicht sch√∂n, ihn mitten im Erstellungsprozess pl√∂tzlich aus der 64-Bit-Build-Umgebung in die 32-Bit-Build-Umgebung zu werfen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie Windows 10-kompatible Treibersignaturen ben√∂tigen, lesen Sie bitte die Informationen nach der Beschreibung des Hauptverfahrens.</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginnen wir mit der 64-Bit-Version. </font><font style="vertical-align: inherit;">√ñffnen Sie die Konsole und f√ºhren Sie die folgenden Befehle aus:</font></font><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Devel\VirtualBox-src "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x64 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> BUILD_TARGET_ARCH=amd64 cscript configure.vbs --with-DDK=C:\WinDDK\<span class="hljs-number"><span class="hljs-number">7600</span></span>.<span class="hljs-number"><span class="hljs-number">16385</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> --with-MinGW-w64=C:\Programs\mingw64 --with-MinGW32=C:\Programs\mingw32 --with-libSDL=C:\Programs\SDL\x64 --with-openssl=C:\Programs\OpenSSL\x64 --with-openssl32=C:\Programs\OpenSSL\x32 --with-libcurl=C:\Programs\curl\x64 --with-libcurl32=C:\Programs\curl\x32 --with-Qt5=C:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x64 --with-libvpx=C:\Programs\libvpx --with-libopus=C:\Programs\libopus --with-python=C:/Programs/Python env.bat kmk kmk C:/Devel/VirtualBox-src/out/win.x86/release/obj/Installer/VirtualBox-<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>_OSE-r128164-MultiArch_amd64.msi</code> </pre> The <code>configure.vbs</code> script verifies the environment and generates configuration files ( <code>AutoConfig.kmk</code> and <code>env.bat</code> ). The first <code>kmk</code> command builds the binaries and collect them into <code>out\win.amd64\bin\</code> . And the last command packs them all into the intermediate MSI package. Important notes: <ul><li> You must use forward slashes in the last command. With backslashes, <code>kmk</code> would fail to find the build rules. </li><li> Even though we are building the 64-bit version, the target package is located in <code>out\win.x86\‚Ä¶</code> , because the final stage of the build will be performed from the 32-bit build environment. </li><li> If you've changed the branding suffix you need to change the name of the target package by replacing the ¬´_OSE¬ª with what you specified in the variable <code>VBOX_BUILD_PUBLISHER</code> . </li><li> The revision number in the MSI package name (128164) can be found in the file <code>Config.kmk</code> inside the <code>VBOX_SVN_REV_FALLBACK</code> variable definition. Please, note, that this value may be different from revisions of the official distribution (for instance, the version 6.0.4 has release number 128413). Unfortunately, I have no idea why. </li></ul></li><li> Now we need to build the 32-bit version and pack everything together. For that, open a new console window, and run the following commands: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /d C:\Devel\VirtualBox-src "C:\Program Files\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>\Bin\SetEnv.<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>" /Release /x86 /win7 <span class="hljs-built_in"><span class="hljs-built_in">COLOR</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> BUILD_TARGET_ARCH=x86 cscript configure.vbs --with-DDK=C:\WinDDK\<span class="hljs-number"><span class="hljs-number">7600</span></span>.<span class="hljs-number"><span class="hljs-number">16385</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> --with-MinGW-w64=C:\Programs\mingw64 --with-MinGW32=C:\Programs\mingw32 --with-libSDL=C:\Programs\SDL\x32 --with-openssl=C:\Programs\OpenSSL\x32 --with-libcurl=C:\Programs\curl\x32 --with-Qt5=C:\Programs\Qt\<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>-x32 --with-libvpx=C:\Programs\libvpx --with-libopus=C:\Programs\libopus --with-python=C:/Programs/Python env.bat kmk kmk C:/Devel/VirtualBox-src/out/win.x86/release/bin/VirtualBox-<span class="hljs-number"><span class="hljs-number">6</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>_OSE-r128164-MultiArch.exe</code> </pre> Same as with the 64-bit, you need to replace the ¬´_OSE¬ª suffix with what you have. <br> Notice how in the last command we are building an <code>EXE</code> , and not an <code>MSI</code> . This is the final installer which will cause the 32-bit package to be built automatically, from dependencies. </li><li> Even if you have a paid certificate you will find that you cannot install this distribution into Windows 10 booted with Secure Boot enabled. This OS has stricter requirements, and the drivers must be signed by none other than Microsoft themselves. The procedure is explained in details on various Internet resources and is unrelated to this article, so I'm not going to go deep into this topic. Instead I'll outline the main steps you need to take for integrating this task with the VB build procedure. <ul><li> The main requirement here is that you must have not just a normal code signing certificate, but an EV one (Extended Validation). Also you need to register an account at <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hardware Dev Center</a> and add your certificate there. </li><li> Now, during building the 64-bit version of VB, just after you've got all binary components (that is, after the first <code>kmk</code> run which was without arguments), you need to create a CAB archive with the drivers. There is a batch script template for that; the build system modifies it according to the current task and puts it into <code>out\win.amd64\release\repack\</code> . Go into this path and run the following command: <pre> <code class="dos hljs">PackDriversForSubmission.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> -x</code> </pre> When the script finishes, the file <code>VBoxDrivers-6.0.4r128164-amd64.cab</code> will appear in the same directory. </li><li> You need to sign this CAB archive with your EV certificate. Then go to the Microsoft Hardware Dev Center, create a new submission, upload your signed archive, select the desired target OS version (make sure it's 64-bit) and send the submission. </li><li> It will take several minutes to process, after which you will have a ZIP archive where all the drivers have been signed by Microsoft in addition to your signature, and all the CAT files generated anew. Download this archive and place it somewhere so that the build system had access to it. </li><li> Unpack the archive and put all the files from the subdirectories directly into <code>out\win.amd64\release\bin\</code> overwriting the existing files. You can do it either manually or using another script from the same path <code>out\win.amd64\release\repack\</code> by running the following commands: <pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> _MY_SIGNTOOL=C:\Programs\DevKits\<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>\bin\x64\signtool.exe UnpackBlessedDrivers.<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> -n -i <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>\to\signed.zip</code> </pre> Of course, you need to put here the correct paths to <code>signtool.exe</code> and the ZIP archive. </li><li> Now you can run the second <code>kmk</code> command which packs all the components into an MSI installer. If you were doing all this in the same console window, don't forget to switch back to the base directory of the VB project. </li><li> Finally, proceed with building of the 32-bit version of VB, and perform all the same additional steps: after the first <code>kmk</code> switch to <code>out\win.x86\release\repack\</code> , create the CAB archive, sign it, send to Microsoft (now choosing the 32-bit OS version), replace the drivers with their counter-signed versions, and run the final <code>kmk</code> for building the complete VB distribution. </li></ul></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn keiner von uns etwas durcheinander gebracht hat, sollte Ihnen diese lange Kette ein gl√§nzendes neues VirtualBox-Installationsprogramm bringen, das sich vom Oracle-Installationsprogramm nur durch das Symbol, das Info-Bild und nat√ºrlich den tiefgreifenden Mangel an H√§rtung unterscheidet. Es ist nicht schwer, auch das Symbol und das Bild zu ersetzen, aber ich werde hier nicht auf dieses Thema eingehen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Einfachheit halber habe ich eine </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">einzelne Batch-Datei erstellt,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die den vollst√§ndigen Build von VB automatisiert. Sie k√∂nnen es verwenden, wenn Sie das gesamte Installationsprogramm regelm√§√üig erstellen m√ºssen.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nur noch ein paar Worte zur Installation der resultierenden Distribution, wenn Sie ein selbstsigniertes Zertifikat verwenden. </font><font style="vertical-align: inherit;">Wie pl√∂tzlich festgestellt wurde, reicht es in Windows 8/10 nicht aus, in den Testmodus zu booten. Die Installation schl√§gt immer noch fehl und behauptet, die Treibersignaturen seien ung√ºltig. </font><font style="vertical-align: inherit;">Sie k√∂nnen dieses Problem umgehen, indem Sie die Zertifikate zu Ihrem CA-Stammspeicher hinzuf√ºgen:</font></font><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ñffnen Sie das Dialogfeld "Eigenschaften" des VB-Installationsprogramms, indem Sie mit der rechten Maustaste darauf klicken und " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eigenschaften"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ausw√§hlen. </font><i><font style="vertical-align: inherit;">Wechseln Sie</font></i><font style="vertical-align: inherit;"> dann zur </font><font style="vertical-align: inherit;">Registerkarte " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Digitale Signaturen"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dort finden Sie zwei Unterschriften mit dem Namen "Roga and Kopyta Ltd", eine ist sha1, die andere ist sha256. </font><font style="vertical-align: inherit;">W√§hlen Sie die erste aus und klicken Sie auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Details</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein weiteres Dialogfeld wird angezeigt, in dem Sie auf die </font><font style="vertical-align: inherit;">Schaltfl√§che </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zertifikat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anzeigen </font><font style="vertical-align: inherit;">klicken m√ºssen </font><font style="vertical-align: inherit;">.</font></font></li><li> One more dialog, click <i>Install Certificate</i> . </li><li> In the Import wizard, select the location ¬´Local Machine¬ª, click <i>Next</i> . After UAC confirmation (if needed), there's the certificate store selection. Select ¬´Place all certificates in the following store¬ª, then click <i>Browse</i> and choose the store named ¬´Trusted Root Certification Authorities¬ª. Then <i>Next</i> , <i>Finish</i> . You're done, the certificate is installed. </li><li> Close all the dialogs but the very first one, select the second signature (sha256) and repeat the steps 2 to 4 for it too. </li><li> Close all the dialogs, run the installer. Now it should work fine. </li></ol><br><a name="afterword"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"> Epilogue </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als ich mit dem Schreiben des Artikels fertig war, war ich selbst von seinem Umfang √ºberrascht. Zuerst wollte ich viele Details zu den Gr√ºnden f√ºr die Wahl dieser oder jener Art der L√∂sung jedes Problems erl√§utern, genau erkl√§ren, was das Problem ist und welche alternativen L√∂sungen anwendbar sein k√∂nnten. Aber sehr bald wurde klar, dass der Text, wenn er mit all diesen Einzelheiten beladen w√§re, ungeheuer gro√ü sein w√ºrde. Ich muss mich also f√ºr die Rezepte entschuldigen, die so aussehen: "Tu das einfach und stell keine Fragen." Ich habe eine starke Abneigung gegen diese selbst, aber ich konnte einfach keinen anderen Weg finden. Gelegentlich versuchte ich immer noch zu skizzieren, was los war, um den Eindruck zu mildern.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Viele Details √ºber das VB-Build-System mussten hinter den Kulissen bleiben. denn ich habe mich beide gez√∂gert, den Text aufzubl√§hen, und war manchmal zu faul, um nach einem anderen, effizienteren Ansatz zur L√∂sung eines Problems zu suchen. Schlie√ülich war mein Hauptziel zun√§chst, mir einen funktionierenden Build der aktuellen VirtualBox-Version zu verschaffen. 4.3.12 war zu diesem Zeitpunkt bereits weit veraltet, aber ich konnte nicht riskieren, eines meiner am aktivsten verwendeten Tools auf die geh√§rtete Version zu aktualisieren, die m√∂glicherweise einfach jeden Moment nicht mehr funktioniert. Obwohl ich von Zeit zu Zeit zur√ºckkomme und etwas Neues gefunden habe, f√ºge es diesem Artikel hinzu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich hoffe, dass dieser Artikel sein Publikum findet. Wenn Sie daran interessiert sind, das Endergebnis zu sehen und zu analysieren, aber nicht alle Programme einrichten m√∂chten, k√∂nnen Sie meine Version der Distribution hier herunterladen:</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Version 6.0.4</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Alle Treiber (und andere Dateien) sind mit einem nicht vertrauensw√ºrdigen selbstsignierten Zertifikat signiert. Um dieses Zertifikat in der 64-Bit-Windows-Version zu installieren, m√ºssen Sie im Testmodus neu starten. </font><font style="vertical-align: inherit;">Wenn Sie Fragen, Anregungen oder Empfehlungen haben, schreiben Sie mir bitte hier in Kommentaren oder per pers√∂nlicher Nachricht. </font><font style="vertical-align: inherit;">M√∂ge die Open Source mit Ihnen sein!</font></font><br><br><a name="history"></a><h4><img src="https://habrastorage.org/getpro/habr/post_images/1c4/b9c/64d/1c4b9c64d7dc3f83417ee1cbbd24820a.png"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √Ñnderungen </font></font></h4><br><div class="spoiler">  <b class="spoiler_title">Archiv</b> <div class="spoiler_text"><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Russischer Artikel ver√∂ffentlicht am 21.01.2016 </font></font></h5><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VirtualBox 5.0.12. </font></font></li></ol><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Update vom 24.05.2016 </font></font></h5><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Artikel wurde f√ºr VB 5.0.20 aktualisiert. Eine der wichtigsten √Ñnderungen ist die doppelte Signatur von SHA-1 / SHA-256. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Deaktivierung der erzwungenen Signaturpr√ºfungen hinzugef√ºgt, wenn selbstsignierte Zertifikate verwendet werden. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Informationen zur Problemumgehung f√ºr Installationsfehler der selbstsignierten Distribution hinzugef√ºgt. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bibliotheksversionen wurden aktualisiert. </font></font></li><li> Disabled some unused components for speeding up the build process. </li><li> Minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 29.07.2016 </h5><ol><li> The article is updated for VB 5.1.2; the most important change is upgrading to Qt5. The differences from VB 5.0.x procedure are specified where applicable. </li><li> Library versions were updated. </li><li> The full build batch was updated to check error codes after each operation. </li><li> Minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 15.09.2016 </h5><ol><li> The article is updated for VB 5.1.6. </li><li> Library versions were updated. </li><li> Added NASM for building OpenSSL. </li><li> Added OpenSSL into cURL; this fixes the broken function of checking for updates and downloading the Extension Pack. </li><li> The full build batch now reads the VB version automatically. </li><li> Various minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 30.11.2016 </h5><ol><li> The article is updated for VB 5.1.10. </li><li> Library versions were updated; particularly OpenSSL was upgraded to version 1.1.x. </li><li> Fixed some installation errors: <ul><li> path to the Qt plugins now points to the installation directory; </li><li> added forgotten OpenSSL libraries to the 32-bit components of the 64-bit VB version. </li></ul></li><li> The article no longer contains information about building older VB versions. If needed, the previous versions of it are available in the <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub project</a> . </li></ol><br><h5> ‚Ä¢ Update of 2.12.2016 </h5><ol><li> Switched to using statically linked OpenSSL. </li></ol><br><h5> ‚Ä¢ Update of 20.06.2017 </h5><ol><li> The article is updated for VB 5.1.22. </li><li> cURL, OpenSSL, and gSOAP were updated; adapted the build instructions for cURL, gSOAP and VB. </li></ol><br><h5> ‚Ä¢ Update of 1.12.2017 </h5><ol><li> The article is updated for VB 5.2.2. </li><li> Switched from MinGW-32 3.3.3 to 4.5.4. </li><li> Qt, cURL, OpenSSL, gSOAP, and some build tools were updated; adapted the build instructions for cURL, gSOAP and VB. </li><li> Switched to using local archives of DocBook XML/XSL instead of online versions. </li><li> Using cURL program instead of wget for downloading the Guest Additions ISO image. </li><li> Various minor fixes and improvements. </li></ol><br><h5> ‚Ä¢ Update of 4.12.2017 </h5><ol><li> The libxml version was fixed in the build instructions. </li></ol><br><h5> ‚Ä¢ Update of 4.09.2018 </h5><ol><li> The article is updated for VB 5.2.18. </li><li> cURL, OpenSSL, gSOAP and some build tools were updated; adapted the build instructions for cURL. </li></ol><br><h5> ‚Ä¢ Update of 12.12.2018 </h5><ol><li> The article is updated for VB 5.2.22. </li><li> Enabled screen recording functionality which is disabled in OSE version by default; added libraries libopus and libvpx for encoding. </li><li> cURL, OpenSSL, and gSOAP were updated. </li><li> The full set of VirtualBox source code changes is now published as a single patch file for easier application. </li></ol></div></div><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Aktualisierung vom 25.01.2019 </font></font></h5><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Artikel wurde f√ºr VB 6.0.2 aktualisiert. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verbessertes Deaktivieren der Erstellung von Gastzugaben. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cURL und gSOAP wurden aktualisiert; </font><font style="vertical-align: inherit;">DocBook XSL-Stylesheets wurden auf die Version 1.69.1 heruntergestuft (die Dokumentation ist besser f√ºr diese Version geeignet).</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der vollst√§ndige Build-Stapel wurde aus dem Artikeltext in eine herunterladbare Datei aufgeteilt. </font></font></li></ol><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Ä¢ Aktualisierung vom 08.04.2019 </font></font></h5><ol><li> The article has been translated into English for the first time. Also numerous minor changes were introduced into the Russian version. </li><li> Added information about drivers signing for Windows 10. </li><li> The article is updated for VB 6.0.4. </li><li> cURL, OpenSSL, gSOAP, and some tools were updated. </li><li> The full build batch no longer has to be placed at the specific path. Also, it now contains the basic template for automated Windows 10 drivers signing. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de447300/">https://habr.com/ru/post/de447300/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de447288/index.html">Top 5 Stallm√ºnzen. Alles was Sie wissen m√ºssen</a></li>
<li><a href="../de447290/index.html">Doktor reitet, reitet</a></li>
<li><a href="../de447292/index.html">14 neue Produkte in Visual Studio 2019</a></li>
<li><a href="../de447294/index.html">Live Share jetzt in Visual Studio 2019 enthalten</a></li>
<li><a href="../de447298/index.html">Wissensmanagement durch Kompetenzmodelle</a></li>
<li><a href="../de447302/index.html">Wochenendbetriebssystem</a></li>
<li><a href="../de447304/index.html">Avaricious zahlt nicht zweimal - wir richten Speicher auf der AMD B450-Plattform ein und erhalten kostenlose Leistung</a></li>
<li><a href="../de447306/index.html">Tesla Transformer auf einem Quadratzoll Board</a></li>
<li><a href="../de447308/index.html">Sofortiges Design</a></li>
<li><a href="../de447310/index.html">Wie wir von der Webentwicklung zur Spieleentwicklung gekommen sind</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>