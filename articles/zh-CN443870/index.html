<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥¨ ğŸ“€ ğŸ˜¯ Unityï¼šç¨‹åºç½‘æ ¼ç¼–è¾‘ ğŸ˜Š ğŸ‘¨ğŸ½â€ğŸš€ âš›ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æ¨¡æ‹Ÿå˜å½¢çš„ç‰©ç†è¿‡ç¨‹ä»¥åŠå…·æœ‰åŠ¨æ€ç”Ÿæˆä¸”å¯ä¿®æ”¹å†…å®¹çš„æ¸¸æˆä¸­ï¼ŒåŠ¨æ€è½¬æ¢æ¨¡å‹æ˜¯ä¸€ç§å¸¸è§çš„åšæ³•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åº”ç”¨è¿‡ç¨‹ç¼–è¾‘å’Œåˆ›å»ºå‡ ä½•çš„æ–¹æ³•ã€‚ åè€…é€šå¸¸å…è®¸åœ¨ä¼ è¾“ä»ç½‘ç»œä¸‹è½½çš„æ•°æ®æ—¶èŠ‚çœçè´µçš„å­—èŠ‚ã€‚ å¦å¤–ï¼Œè¿™å¾ˆæœ‰è¶£ï¼ 

 æœ¬æ–‡æ—¨åœ¨ä»‹ç»Unityä¸­ç½‘æ ¼çš„è¿‡ç¨‹å¤„ç†æŠ€èƒ½ã€‚ æˆ‘ä»¬å°†è®¨è®ºè½¬æ¢å’Œç”Ÿæˆç½‘æ ¼éƒ¨åˆ†çš„...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unityï¼šç¨‹åºç½‘æ ¼ç¼–è¾‘</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/plarium/blog/443870/">åœ¨æ¨¡æ‹Ÿå˜å½¢çš„ç‰©ç†è¿‡ç¨‹ä»¥åŠå…·æœ‰åŠ¨æ€ç”Ÿæˆä¸”å¯ä¿®æ”¹å†…å®¹çš„æ¸¸æˆä¸­ï¼ŒåŠ¨æ€è½¬æ¢æ¨¡å‹æ˜¯ä¸€ç§å¸¸è§çš„åšæ³•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åº”ç”¨è¿‡ç¨‹ç¼–è¾‘å’Œåˆ›å»ºå‡ ä½•çš„æ–¹æ³•ã€‚ åè€…é€šå¸¸å…è®¸åœ¨ä¼ è¾“ä»ç½‘ç»œä¸‹è½½çš„æ•°æ®æ—¶èŠ‚çœçè´µçš„å­—èŠ‚ã€‚ å¦å¤–ï¼Œè¿™å¾ˆæœ‰è¶£ï¼ <br><br> æœ¬æ–‡æ—¨åœ¨ä»‹ç»Unityä¸­ç½‘æ ¼çš„è¿‡ç¨‹å¤„ç†æŠ€èƒ½ã€‚ æˆ‘ä»¬å°†è®¨è®ºè½¬æ¢å’Œç”Ÿæˆç½‘æ ¼éƒ¨åˆ†çš„æ“ä½œã€‚ <br><br><img src="https://habrastorage.org/webt/if/ur/hv/ifurhvuqkiyhlqceodrpurzxjre.jpeg"><a name="habracut"></a><br><br> æˆ‘ä»¬ç”¨äº3Dæ¨¡å‹ç¨‹åºç¼–è¾‘çš„ç»…å£«å·¥å…·åŒ…åŒ…æ‹¬ä¸‰ä¸ªåŸºæœ¬æ“ä½œï¼šä¸‰è§’å‰–åˆ†ï¼Œç‚¹ç§»åŠ¨ï¼Œæ‹‰ä¼¸ã€‚ æˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºæœ€åä¸¤ä¸ªã€‚ é¦–å…ˆï¼Œè€ƒè™‘æœ€ç®€å•çš„è¿åŠ¨æ“ä½œ-ç§»åŠ¨é¡¶ç‚¹ï¼Œæ—‹è½¬å’Œç¼©æ”¾è¾¹ç¼˜å’Œä¸‰è§’å½¢ã€‚ ç„¶åï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€ç§ç”¨äºç”Ÿæˆæ–°å‡ ä½•çš„æ–¹æ³•-æ‹‰ä¼¸æ“ä½œã€‚ <br><br>  <i>åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»¥å‰çš„å‡ºç‰ˆç‰©ä¸­ï¼Œ</a>æˆ‘ä»¬æè¿°äº†ç”¨äºå¤„ç†3Dæ¨¡å‹æ•°æ®çš„ä¾¿æ·ç»“æ„ã€‚</i> <br><br><div class="spoiler">  <b class="spoiler_title">ç»“æ„ä»£å·</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomMeshPool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;CustomMesh&gt; Pool; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pointer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> CustomMesh </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMesh</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Pool[id]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Push</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CustomMesh customMesh</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Pool == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) Pool = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;CustomMesh&gt;(); pointer = GetAvailableIndex(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pointer &lt; Pool.Count) Pool[pointer] = customMesh; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Pool.Add(customMesh); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pointer; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Remove</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Pool == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = Pool[index] == <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Pool[index] = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAvailableIndex</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Pool == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> availableIndex = Pool.FindIndex(mesh =&gt; mesh == <span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> availableIndex != <span class="hljs-number"><span class="hljs-number">-1</span></span> ? availableIndex : Pool.Count; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Flush</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Pool != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) Pool.Clear(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomMesh</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Triangle[] Triangles; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3[] vertices; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3[] normals; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector2[] uv0, uv2; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Color[] colors; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomMesh</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3[] vertices, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] triangles, Vector3[] normals, Vector2[] uv0, Vector2[] uv2, Color[] colors</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vertices = vertices; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.normals = normals; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (normals != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.normals.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.normals[i] = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.normals[i].normalized; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.uv0 = uv0; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.uv2 = uv2; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.colors = colors; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ptr = CustomMeshPool.GetAvailableIndex(); CustomMeshPool.Push(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); Id = ptr; Triangles = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Triangle[triangles.Length / <span class="hljs-number"><span class="hljs-number">3</span></span>]; Triangles = Triangles .AsParallel() .Select((t, i) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Triangle(ptr, i, triangles[i * <span class="hljs-number"><span class="hljs-number">3</span></span>], triangles[i * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>], triangles[i * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>])) .ToArray(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Triangle { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _index; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Index { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _index; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _index = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_edges != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _edges[<span class="hljs-number"><span class="hljs-number">0</span></span>].TriangleIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; _edges[<span class="hljs-number"><span class="hljs-number">1</span></span>].TriangleIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; _edges[<span class="hljs-number"><span class="hljs-number">2</span></span>].TriangleIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _meshId; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MeshId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _meshId; } <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _meshId = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Edge[] _edges; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Edge[] Edges { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _edges; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Length == <span class="hljs-number"><span class="hljs-number">3</span></span>) { _edges = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; i++) { _edges[i].TriangleIndex = _index; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IndexOutOfRangeException(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vertex V0 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Edges[<span class="hljs-number"><span class="hljs-number">0</span></span>].v0; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.MeshId != MeshId) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Not the same mesh"</span></span>); Edges[<span class="hljs-number"><span class="hljs-number">0</span></span>].v0 = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Edges[<span class="hljs-number"><span class="hljs-number">2</span></span>].v1 = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vertex V1 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Edges[<span class="hljs-number"><span class="hljs-number">1</span></span>].v0; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.MeshId != MeshId) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Not the same mesh"</span></span>); Edges[<span class="hljs-number"><span class="hljs-number">1</span></span>].v0 = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Edges[<span class="hljs-number"><span class="hljs-number">0</span></span>].v1 = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vertex V2 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Edges[<span class="hljs-number"><span class="hljs-number">2</span></span>].v0; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.MeshId != MeshId) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Not the same mesh"</span></span>); Edges[<span class="hljs-number"><span class="hljs-number">2</span></span>].v0 = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Edges[<span class="hljs-number"><span class="hljs-number">1</span></span>].v1 = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> meshId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v0, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v2</span></span></span><span class="hljs-function">)</span></span> { _index = index; _meshId = meshId; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> edges = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Edge[<span class="hljs-number"><span class="hljs-number">3</span></span>]; edges[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Edge(meshId, index, v0, v1); edges[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Edge(meshId, index, v1, v2); edges[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Edge(meshId, index, v2, v0); _edges = edges; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Edge { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vertex v0; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vertex v1; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _meshId; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MeshId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _meshId; } <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _meshId = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _triangleIndex; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TriangleIndex { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _triangleIndex; } <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _triangleIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Edge</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> meshId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> triangleIndex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v0Index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v1Index</span></span></span><span class="hljs-function">)</span></span> { _meshId = meshId; _triangleIndex = triangleIndex; v0 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vertex() { MeshId = meshId, Index = v0Index }; v1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vertex() { MeshId = meshId, Index = v1Index }; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Vertex { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Index; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _meshId; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MeshId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _meshId; } <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _meshId = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 position { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CustomMeshPool.GetMesh(_meshId).vertices[Index]; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { CustomMeshPool.GetMesh(_meshId).vertices[Index] = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 normal { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CustomMeshPool.GetMesh(_meshId).normals[Index]; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { CustomMeshPool.GetMesh(_meshId).normals[Index] = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector2 uv0 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CustomMeshPool.GetMesh(_meshId).uv0[Index]; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { CustomMeshPool.GetMesh(_meshId).uv0[Index] = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector2 uv2 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CustomMeshPool.GetMesh(_meshId).uv2[Index]; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { CustomMeshPool.GetMesh(_meshId).uv2[Index] = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Color color { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CustomMeshPool.GetMesh(_meshId).colors[Index]; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { CustomMeshPool.GetMesh(_meshId).colors[Index] = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } }</code> </pre> <br></div></div><br>  <i>å¦‚æ‚¨æ‰€è§ï¼Œæ­¤å¤„ä½¿ç”¨äº†PLINQã€‚</i>  <i>è¿™æ˜¯å› ä¸ºè®¡ç®—å‡ ä½•ç®—æ³•é€šå¸¸å¯ä»¥é€šè¿‡å¤šçº¿ç¨‹è¿›è¡Œä¼˜åŒ–ã€‚</i> <i><br></i>  <i>å½“ç„¶ï¼Œä¸æ‰§è¡Œâ€œæ‰‹åŠ¨â€ä»£ç æ—¶ç›¸æ¯”ï¼Œåœ¨LINQæ„é€ æ‰§è¡ŒæœŸé—´åˆ›å»ºçš„LINQæ„é€ æ›´å¤šã€‚</i>  <i>ä½†æ˜¯ï¼Œè¿™ç§è®¾è®¡çš„ç®€æ´æ€§ä»¥åŠPLINQä¸­å†…ç½®çš„èµ„æºç®¡ç†å·¥å…·çš„å­˜åœ¨ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¼¥è¡¥äº†è¿™ä¸€ç¼ºç‚¹ã€‚</i>  <i>æ­¤å¤–ï¼Œå•çº¿ç¨‹å’Œå¤šçº¿ç¨‹å®ç°ä¹‹é—´çš„è½¬æ¢ä»…ç”¨ä¸€ä¸ªå‘½ä»¤å³å¯å®Œæˆï¼Œè¿™æå¤§åœ°ç®€åŒ–äº†è°ƒè¯•è¿‡ç¨‹ã€‚</i> <br><br><h3> æˆ‘æ‰­æ›²ï¼Œæ‰­æ›²ï¼Œæˆ‘æƒ³æ··æ·† </h3><br> æˆ‘ä»¬ç»§ç»­è¿åŠ¨çš„è¿ä½œã€‚ ç§»åŠ¨é¡¶ç‚¹æ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ã€‚ åªæ˜¯ä¸è¦å¿˜äº†åŒæ—¶å‡ºç°çš„é«˜å³°ï¼šå¦‚æœéœ€è¦ï¼Œå®ƒä»¬çš„ä½ç½®ä¹Ÿåº”è¯¥æ”¹å˜ã€‚ <br><br> è¯¥ç®—æ³•æ˜¯é€šè¿‡å°†è¿åŠ¨çŸ¢é‡æ·»åŠ åˆ°é¡¶ç‚¹ä½ç½®æ¥å®ç°çš„ã€‚ ç›¸å¯¹äºæ¨¡å‹çš„åŸç‚¹ï¼ˆ <b>æ¢è½´</b> ï¼‰å‘ç”Ÿåç§»ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™æ ·çš„å˜æ¢è¿‡ç¨‹ä¸­å¤šè¾¹å½¢çš„ä½ç½®å¯ä»¥æ”¹å˜ï¼Œä½†æ˜¯å…¶é¡¶ç‚¹çš„æ³•çº¿ä¸èƒ½æ”¹å˜ã€‚ ä½†æ˜¯ï¼Œä¸ºäº†ç®€åŒ–æ¼”ç¤ºï¼Œæˆ‘ä»¬å°†ä¸è€ƒè™‘è¿™ç§ç»†å¾®å·®åˆ«ã€‚ <br><br>  <i><b>CADå·¥å…·</b>å…·æœ‰é‡æ–°è®¡ç®—æ³•çº¿çš„åŠŸèƒ½ï¼Œé€šå¸¸åœ¨åº”ç”¨æ‰€éœ€çš„è½¬æ¢åä¼šè°ƒç”¨æ­¤åŠŸèƒ½ã€‚</i>  <i>æœ‰å¤šç§æ–¹æ³•å¯ä»¥è¿›è¡Œæ­¤åˆ†é…ã€‚</i>  <i>æœ€å¸¸è§çš„æ–¹æ³•æ˜¯è®¡ç®—æ¯ä¸ªä¸‰è§’å½¢çš„å¹³é¢çš„æ³•çº¿ï¼Œç„¶åä¸ºæ¯ä¸ªé¡¶ç‚¹åˆ†é…ä¸€ä¸ªæ³•çº¿ä½œä¸ºè¯¥é¡¶ç‚¹æ‰€å±ä¸‰è§’å½¢çš„æ³•çº¿çš„å¹³å‡å€¼ã€‚</i> <br><br> é€šå¸¸ï¼Œæ²¡æœ‰å……åˆ†çš„ç†ç”±ä½¿ä»£ç å¤æ‚åŒ–å¹¶åº”ç”¨è½¬æ¢çŸ©é˜µã€‚ å°†è¿åŠ¨çŸ¢é‡æ·»åŠ åˆ°é¡¶ç‚¹ä½ç½®çš„ç»“æœå¯¹åº”äºå…¶è¿åŠ¨çš„ç›´è§‚æ¦‚å¿µã€‚ <br><table><tbody><tr><td><img src="https://habrastorage.org/webt/cu/hn/l9/cuhnl9znzfmayguevbhrwr8c2lo.gif"><br></td><td><img src="https://habrastorage.org/webt/o0/st/e0/o0ste0gv_uhldid9h7jgca7a6ua.gif"><br></td></tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">åˆ—å‡ºç§»åŠ¨ä¸€ä¸ªé¡¶ç‚¹çš„æ–¹æ³•</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Vertex { ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Translate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 movement, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> withCoincident = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newPosition = position + movement; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (withCoincident) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vertices = CustomMeshPool.GetMesh(_meshId).vertices; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mask = CustomMeshPool.GetMesh(_meshId).GetVerticesInPosition(position); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; vertices.Length; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mask[i]) vertices[i] = newPosition; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { position = newPosition; } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomMesh</span></span> { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetVerticesInPosition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[] buffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[vertices.Length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; buffer.Length; i++) { buffer[i] = Mathf.Abs(position.x - vertices[i].x) &lt; Mathf.Epsilon &amp;&amp; Mathf.Abs(position.y - vertices[i].y) &lt; Mathf.Epsilon &amp;&amp; Mathf.Abs(position.z - vertices[i].z) &lt; Mathf.Epsilon; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buffer; } }</code> </pre><br></div></div><br> è¾¹ç¼˜å’Œä¸‰è§’å½¢çš„ç§»åŠ¨ä»¥ç›¸åŒçš„æ–¹å¼å®ç°-é€šè¿‡æ·»åŠ ä½ç§»çŸ¢é‡ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä»ç„¶æœ‰GIF</b> <div class="spoiler_text"><table><tbody><tr><td><img src="https://habrastorage.org/webt/mr/bo/wu/mrbowu8z94mgyhmjop8fawq1nu8.gif"><br></td><td><img src="https://habrastorage.org/webt/2x/6u/cn/2x6ucnuhg9jwftw9lbcc3vbk_ss.gif"><br></td></tr><tr><td><img src="https://habrastorage.org/webt/mf/cx/k5/mfcxk5fm7xq0ifpm03ofn4izurg.gif"><br></td><td><img src="https://habrastorage.org/webt/p8/ot/f-/p8otf-gbjezo3rtn57tf-yvvh9c.gif"><br></td></tr></tbody></table><br></div></div><br><div class="spoiler">  <b class="spoiler_title">åˆ—å‡ºç§»åŠ¨ä¸‰è§’å½¢å’Œè¾¹ç¼˜çš„æ–¹æ³•</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Edge { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Translate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 movement, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> withCoincident = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (withCoincident) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vertices = CustomMeshPool.GetMesh(MeshId).vertices; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV0Position = v0.position + movement; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV1Position = v1.position + movement; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV0 = CustomMeshPool.GetMesh(MeshId).GetVerticesInPosition(v0.position); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV1 = CustomMeshPool.GetMesh(MeshId).GetVerticesInPosition(v1.position); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; vertices.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV0[i]) vertices[i] = newV0Position; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV1[i]) vertices[i] = newV1Position; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { v0.Translate(movement); v1.Translate(movement); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Triangle { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Translate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 movement, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> withCoincident = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (withCoincident) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vertices = CustomMeshPool.GetMesh(_meshId).vertices; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV0Position = V0.position + movement; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV1Position = V1.position + movement; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV2Position = V2.position + movement; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV0 = CustomMeshPool.GetMesh(_meshId).GetVerticesInPosition(V0.position); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV1 = CustomMeshPool.GetMesh(_meshId).GetVerticesInPosition(V1.position); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV2 = CustomMeshPool.GetMesh(_meshId).GetVerticesInPosition(V2.position); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; vertices.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV0[i]) vertices[i] = newV0Position; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV1[i]) vertices[i] = newV1Position; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV2[i]) vertices[i] = newV2Position; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { V0.Translate(movement); V1.Translate(movement); V2.Translate(movement); } } }</code> </pre><br></div></div><br> ä½†æ˜¯ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è½¬æ¢çŸ©é˜µ</a>è¿›è¡Œæ—‹è½¬å’Œç¼©æ”¾æ›´æ–¹ä¾¿ã€‚ è¿™äº›æ“ä½œç›¸å¯¹äºæ¨¡å‹åæ ‡åŸç‚¹çš„ç»“æœå¾ˆå¯èƒ½ä¸æ˜¯æ‚¨æœŸæœ›æˆ–æƒ³è¦çœ‹åˆ°çš„ã€‚ æ—‹è½¬å’Œç¼©æ”¾çš„å‚è€ƒç‚¹é€šå¸¸è¢«è§†ä¸ºå¯¹è±¡çš„ä¸­é—´ï¼Œè¿™æ˜¯äººç±»æœ€å®¹æ˜“ç†è§£çš„ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">å¾ˆå¤šGIF</b> <div class="spoiler_text"><table><tbody><tr><td><img src="https://habrastorage.org/webt/ct/mo/26/ctmo26dwz_yjk7fshly8l-4q4v4.gif"><br></td><td><img src="https://habrastorage.org/webt/4w/by/ou/4wbyoul70b8-c9_yasiyxxgupqu.gif"><br></td><td><img src="https://habrastorage.org/webt/c_/pl/iy/c_pliy99pbhj8tjbgcdo0vi95i4.gif"><br></td><td><img src="https://habrastorage.org/webt/7g/eb/qa/7gebqanr-htgbvpjo4g1jza9yns.gif"><br></td></tr><tr><td><img src="https://habrastorage.org/webt/mm/fw/0g/mmfw0gazms88c0mslnsah4lynhk.gif"><br></td><td><img src="https://habrastorage.org/webt/nd/cl/a9/ndcla9f1f-lwdd69i-fxndyspg0.gif"><br></td><td><img src="https://habrastorage.org/webt/2c/on/sb/2consbni6vccpanjp80oya-ccow.gif"><br></td><td><img src="https://habrastorage.org/webt/ji/2b/rh/ji2brhm7pb7nrzuqva691l6c7rm.gif"><br></td></tr></tbody></table><br></div></div><br><div class="spoiler">  <b class="spoiler_title">åˆ—å‡ºæ—‹è½¬å’Œç¼©æ”¾ä¸‰è§’å½¢å’Œè¾¹çš„æ–¹æ³•</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Edge { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Rotate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Quaternion rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> withCoincident = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pivot = (v0.position + v1.position) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> matrix = Matrix4x4.TRS(pivot, rotation, Vector3.one); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV0Position = matrix.MultiplyPoint(v0.position - pivot); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV1Position = matrix.MultiplyPoint(v1.position - pivot); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (withCoincident) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vertices = CustomMeshPool.GetMesh(MeshId).vertices; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV0 = CustomMeshPool.GetMesh(MeshId).GetVerticesInPosition(v0.position); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV1 = CustomMeshPool.GetMesh(MeshId).GetVerticesInPosition(v1.position); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; vertices.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV0[i]) vertices[i] = newV0Position; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV1[i]) vertices[i] = newV1Position; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { v0.position = newV0Position; v1.position = newV1Position; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Scale</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 scale, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> withCoincident = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pivot = (v0.position + v1.position) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> matrix = Matrix4x4.TRS(pivot, Quaternion.identity, scale); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV0Position = matrix.MultiplyPoint(v0.position - pivot); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV1Position = matrix.MultiplyPoint(v1.position - pivot); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (withCoincident) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vertices = CustomMeshPool.GetMesh(MeshId).vertices; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV0 = CustomMeshPool.GetMesh(MeshId).GetVerticesInPosition(v0.position); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV1 = CustomMeshPool.GetMesh(MeshId).GetVerticesInPosition(v1.position); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; vertices.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV0[i]) vertices[i] = newV0Position; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV1[i]) vertices[i] = newV1Position; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { v0.position = newV0Position; v1.position = newV1Position; } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Triangle { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Rotate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Quaternion rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> withCoincident = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pivot = (V0.position + V1.position + V2.position) / <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> matrix = Matrix4x4.TRS(Vector3.zero, rotation, Vector3.one); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV0Position = matrix.MultiplyPoint(V0.position - pivot) + pivot; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV1Position = matrix.MultiplyPoint(V1.position - pivot) + pivot; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV2Position = matrix.MultiplyPoint(V2.position - pivot) + pivot; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (withCoincident) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vertices = CustomMeshPool.GetMesh(_meshId).vertices; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV0 = CustomMeshPool.GetMesh(_meshId).GetVerticesInPosition(V0.position); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV1 = CustomMeshPool.GetMesh(_meshId).GetVerticesInPosition(V1.position); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV2 = CustomMeshPool.GetMesh(_meshId).GetVerticesInPosition(V2.position); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; vertices.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV0[i]) vertices[i] = newV0Position; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV1[i]) vertices[i] = newV1Position; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV2[i]) vertices[i] = newV2Position; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Edges[<span class="hljs-number"><span class="hljs-number">0</span></span>].v0.position = newV0Position; Edges[<span class="hljs-number"><span class="hljs-number">1</span></span>].v0.position = newV1Position; Edges[<span class="hljs-number"><span class="hljs-number">2</span></span>].v0.position = newV2Position; } Edges[<span class="hljs-number"><span class="hljs-number">0</span></span>].v0.normal = matrix.MultiplyPoint(V0.normal); Edges[<span class="hljs-number"><span class="hljs-number">1</span></span>].v0.normal = matrix.MultiplyPoint(V1.normal); Edges[<span class="hljs-number"><span class="hljs-number">2</span></span>].v0.normal = matrix.MultiplyPoint(V2.normal); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Scale</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 scale, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> withCoincident = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pivot = (V0.position + V1.position + V2.position) / <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> matrix = Matrix4x4.TRS(pivot, Quaternion.identity, scale); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV0Position = matrix.MultiplyPoint(V0.position - pivot); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV1Position = matrix.MultiplyPoint(V1.position - pivot); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newV2Position = matrix.MultiplyPoint(V2.position - pivot); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (withCoincident) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vertices = CustomMeshPool.GetMesh(_meshId).vertices; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV0 = CustomMeshPool.GetMesh(_meshId).GetVerticesInPosition(V0.position); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV1 = CustomMeshPool.GetMesh(_meshId).GetVerticesInPosition(V1.position); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> maskV2 = CustomMeshPool.GetMesh(_meshId).GetVerticesInPosition(V2.position); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; vertices.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV0[i]) vertices[i] = newV0Position; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV1[i]) vertices[i] = newV1Position; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maskV2[i]) vertices[i] = newV2Position; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Edges[<span class="hljs-number"><span class="hljs-number">0</span></span>].v0.position = newV0Position; Edges[<span class="hljs-number"><span class="hljs-number">1</span></span>].v0.position = newV1Position; Edges[<span class="hljs-number"><span class="hljs-number">2</span></span>].v0.position = newV2Position; } } }</code> </pre><br></div></div><br><h3> ä¸ºè‡ªå·±é“ºä¸Šä¸€ä¸ªæ•´æ´çš„æ´ </h3><br> åœ¨3Då»ºæ¨¡ä¸­ï¼Œç»å¸¸ä½¿ç”¨æ‹‰ä¼¸æ“ä½œã€‚ å¯¹äºå…¶å®ç°ï¼Œå¿…é¡»çŸ¥é“è¿åŠ¨çŸ¢é‡ï¼ˆä½ç§»ï¼‰å’Œå¤šè¾¹å½¢é›†ã€‚ æŒ¤å‡ºè¿‡ç¨‹å¯ä»¥åˆ†è§£ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š <br><br>  1.å¤šè¾¹å½¢çš„åç§»é‡ä¸ºç»™å®šçš„è¿åŠ¨çŸ¢é‡ï¼ˆ <b>offset</b> ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»å¤åˆ¶ç”±è¾¹ç•Œå¤šè¾¹å½¢åˆ†éš”çš„é¡¶ç‚¹ï¼Œä»¥å…å¹²æ‰°é‚£äº›ä¸å±äºä½ç§»éƒ¨åˆ†çš„å…ƒç´ çš„ä½ç½®ã€‚ æ¢å¥è¯è¯´ï¼Œæ‚¨éœ€è¦æ’•å¼€å¹¶ç§»åŠ¨é€‰å®šçš„ç‰‡æ®µã€‚ å¦‚æœé¦–å…ˆå®Œæˆæ­¤æ­¥éª¤ï¼Œåˆ™æ¨¡å‹å¯èƒ½ä¼šåˆ†è§£ä¸ºå°†æ¥å¿…é¡»ç»“åˆçš„éƒ¨åˆ†ã€‚ <br><br><img src="https://habrastorage.org/webt/bb/cn/on/bbcnon5sqdhusvi-qqhqhk05vlu.jpeg"><br><br>  2.åœ¨ä½ç§»é›¶ä»¶çš„è¾¹ç•Œå’ŒæŒ¤å‹è¿‡ç¨‹ä¸­å½¢æˆçš„è¾¹ç•Œä¹‹é—´æ·»åŠ æ–°çš„å‡ ä½•å½¢çŠ¶ã€‚ æ¨¡å‹çš„ä¸»è¦éƒ¨åˆ†å’Œç§»åŠ¨éƒ¨åˆ†ä¹‹é—´çš„é—´éš™å¡«å……æœ‰å½¢æˆå¢™çš„å¤šè¾¹å½¢ã€‚ <br><br><img src="https://habrastorage.org/webt/rv/nx/ts/rvnxts5zhi2y05xd8ykqftgtniw.png"><br><br> åœ¨å®ç°ä¸­ï¼Œé¦–å…ˆæ„å»ºå¢™æ˜¯æ›´æ–¹ä¾¿çš„ï¼Œå› ä¸ºåœ¨ç§»ä½ä¹‹å‰ï¼Œæˆ‘ä»¬å…·æœ‰è¾¹ç•Œä¸Šè¾¹ç¼˜çš„åˆå§‹ä½ç½®ï¼Œå¹¶ä¸”å¯ä»¥ç«‹å³ä½¿ç”¨æ­¤æ•°æ®ã€‚ å¦åˆ™ï¼Œæ‚¨å°†ä¸å¾—ä¸åè½¬å‰ªåˆ‡çŸ¢é‡çš„æ–¹å‘ï¼Œæˆ–è€…ä¿å­˜ä¸€äº›æœ‰å…³ç½‘æ ¼åˆå§‹çŠ¶æ€çš„ä¿¡æ¯ã€‚ <br><br> æˆ‘ä»¬ä½¿ç”¨çš„æ¨¡å‹åŠå…¶é›¶ä»¶ç”±æˆå¯¹çš„ç›¸é‚»å¤šè¾¹å½¢ï¼ˆä¸‰è§’å½¢ï¼‰ç»„æˆã€‚ æˆ‘ä»¬ç§°æ¯ä¸ªè¿™æ ·çš„é›†åˆä¸º<b>ç°‡</b> ã€‚ <br><br><img src="https://habrastorage.org/webt/7q/y7/6h/7qy76hwucntbje_fcnbw8nznapc.png"><br>  <i><b>Blenderä¸­çš„</b>ä¸¤ä¸ªä¸“ç”¨é›†ç¾¤</i> <i><br></i> <br> é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è·å–é™åˆ¶æ‰€é€‰èšç±»çš„è½®å»“çš„æ‰€æœ‰è¾¹ç¼˜ã€‚ ä¸ºæ­¤ï¼Œåªéœ€å°†è¾¹ç¼˜é¡ºåºæ·»åŠ åˆ°åˆ—è¡¨ä¸­å³å¯ã€‚ å¦‚æœæ‰¾åˆ°åŒ¹é…çš„è¾¹ï¼Œåˆ™å¿…é¡»åœ¨ä¸æ·»åŠ å½“å‰è¾¹çš„æƒ…å†µä¸‹å°†å…¶åˆ é™¤ã€‚ ä¸ºäº†ä½¿è¿™ç§ç®—æ³•æ­£ç¡®è¿è¡Œï¼Œæœ‰å¿…è¦å¼•å…¥ä¸€ä¸ªé™åˆ¶ï¼šåœ¨æ‰€é€‰çš„ä¸‰è§’å½¢é›†åˆä¸Šï¼Œå­˜åœ¨ä¸è¶…è¿‡ä¸¤ä¸ªé‡åˆçš„è¾¹ã€‚ åœ¨ä½¿ç”¨<b>æ‹‰ä¼¸çš„</b>æƒ…å†µä¸‹ï¼Œæ¨¡å‹é€šå¸¸ä¼šæ»¡è¶³æ­¤æ¡ä»¶ï¼Œå¹¶ä¸”æ›´å¤æ‚çš„ç®—æ³•éœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">åˆ—å‡ºè·å–è½®å»“è½®å»“è¾¹çš„æ–¹æ³•</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LinkedListExtension</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IEnumerable&lt;LinkedListNode&lt;T&gt;&gt; Nodes&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> LinkedList&lt;T&gt; list) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> node = list.First; node != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; node = node.Next) { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> node; } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Vertex { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsInPosition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 other</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Mathf.Abs(position.x - other.x) &lt; Mathf.Epsilon &amp;&amp; Mathf.Abs(position.y - other.y) &lt; Mathf.Epsilon &amp;&amp; Mathf.Abs(position.z - other.z) &lt; Mathf.Epsilon; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Edge { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Coincides</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Edge other, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> includeDirection = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v0.IsInPosition(other.v0.position) &amp;&amp; v1.IsInPosition(other.v1.position) || !includeDirection &amp;&amp; v1.IsInPosition(other.v0.position) &amp;&amp; v0.IsInPosition(other.v1.position); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomMesh</span></span> { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> LinkedList&lt;Edge&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ObtainHullEdges</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] triIndices</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> edges = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinkedList&lt;Edge&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; triIndices.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> edge = edges.Nodes().FirstOrDefault(e =&gt; e.Value.Coincides(Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">0</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (edge != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) edges.Remove(edge); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> edges.AddFirst(Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">0</span></span>]); edge = edges.Nodes().FirstOrDefault(e =&gt; e.Value.Coincides(Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">1</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (edge != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) edges.Remove(edge); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> edges.AddFirst(Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">1</span></span>]); edge = edges.Nodes().FirstOrDefault(e =&gt; e.Value.Coincides(Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">2</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (edge != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) edges.Remove(edge); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> edges.AddFirst(Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">2</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> edges; } }</code> </pre><br></div></div><br> æ¥æ”¶è½®å»“çš„æ‰€æœ‰è¾¹ç¼˜åï¼Œæ‚¨éœ€è¦æ„å»ºç›¸åº”çš„å¢™ã€‚ æœ‰è®¸å¤šå®ç°æ–¹å¼ï¼Œä½†æ˜¯æˆ‘ä»¬å†³å®šé‡‡ç”¨é˜»åŠ›æœ€å°çš„è·¯å¾„-åˆ†åˆ«åŸºäºè¾¹ç¼˜åœ¨è¿åŠ¨çŸ¢é‡çš„æ–¹å‘ä¸Šç”Ÿæˆå¹³è¡Œå››è¾¹å½¢ã€‚ ç”±äºæˆ‘ä»¬æ‰€æœ‰äººéƒ½åªæœ‰ä¸€ä¸ªä½ç§»ï¼Œå› æ­¤ï¼Œå¹³è¡Œå››è¾¹å½¢å°†ä¸ºæ¯ä¸ªç°‡å½¢æˆä¸€ä¸ªåšå›ºçš„å°é—­å£ã€‚ ä»ç„¶éœ€è¦ç¡®å®šå£å•å…ƒçš„æ–¹å‘ã€‚ <br><br> å¢™åƒæ•´ä¸ªç½‘æ ¼ä¸€æ ·ï¼Œç”±ä¸‰è§’å½¢ç»„æˆã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ ¹æ®<b>OpenGL</b>çº¦å®šï¼Œ</a>å¦‚æœåœ¨å°†å…¶ç‚¹æŠ•å½±åˆ°å±å¹•å¹³é¢ä¸Šæ—¶æŒ‰é¡ºåºç»•åŠ¨å®ƒä»¬å¯¹åº”äºé¡ºæ—¶é’ˆè¡Œèµ°ï¼Œåˆ™ä¼šåœ¨å±å¹•ä¸Šå‘ˆç°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€ä¸ª</a>å•ç‹¬çš„ä¸‰è§’å½¢ï¼š <br><br><img src="https://habrastorage.org/webt/5l/a1/um/5la1umkwunfu0krizz83sz40nvs.jpeg"><br><br> å› æ­¤ï¼Œä¸‰è§’å½¢å¯¹åº”äºå®šä¹‰æ­£é¢çš„æŸä¸ªæ³•å‘çŸ¢é‡ã€‚ æ¯ä¸ªä¸‰è§’å½¢éƒ½ç”±åŒ…å«ä¸‰ä¸ªè¾¹çš„å‡¸è½®å»“çº¿ç•Œå®šã€‚ æ¯ä¸ªè¾¹éƒ½æœ‰ä¸¤ä¸ªåœ¨æˆ‘ä»¬çš„ç»“æ„ä¸­è¡¨ç¤ºä¸º<b>v0</b>å’Œ<b>v1çš„</b>é¡¶ç‚¹ã€‚ æˆ‘ä»¬å®šä¹‰è¾¹ç¼˜çš„æ–¹å‘ï¼Œä»¥ä½¿<b>v0</b>ä¸ºèµ·ç‚¹ï¼Œ <b>v1</b>ä¸ºç»ˆç‚¹ã€‚ ç°åœ¨ï¼Œå¦‚æœæ ¹æ®ä¸‰è§’å½¢çš„é¡¶ç‚¹çš„æ—é€šè®¾ç½®äº†ä¸‰è§’å½¢è¾¹ç¼˜çš„æ–¹å‘ï¼Œåˆ™ç¾¤é›†çš„ä»»ä½•å¤–éƒ¨è½®å»“éƒ½å¿…é¡»å…·æœ‰é¡ºæ—¶é’ˆæˆ–é€†æ—¶é’ˆçš„æ—é€šï¼Œè€Œå†…éƒ¨çš„ä»»ä½•è½®å»“éƒ½å¿…é¡»å…·æœ‰æ—é€šï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚ æˆ‘ä»¬å®ç°äº†<b>CustomMesh</b>å’Œ<b>Triangle</b>æ„é€ å‡½æ•°ï¼Œä»¥ä¾¿æ‰€æœ‰ä¸‰è§’å½¢çš„é¡¶ç‚¹çš„éå†ä¸é¡ºæ—¶é’ˆæ–¹å‘ç›¸å¯¹åº”ã€‚ <br><br><img src="https://habrastorage.org/webt/4a/ty/j_/4atyj_c-9-_bpgu3xphnvhgx690.jpeg"><br><br><img src="https://habrastorage.org/webt/6c/yw/so/6cywsooz53z8ytpuyb6y8t1rh7m.jpeg"><br><br> å…·æœ‰ç»•è¿‡è½®å»“çš„æ–¹å‘ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šåœ°è¯´è‚‹çš„å“ªä¸€ä¾§æ˜¯è½®å»“çš„å†…éƒ¨ï¼Œè€Œå“ªä¸€ä¾§æ˜¯è½®å»“çš„å¤–éƒ¨ã€‚ åŸºäºæ­¤ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†é€‰æ‹©å¢™çš„æ–¹å‘ã€‚ ä»¤ï¼ˆ <b>v0ï¼Œv1</b> ï¼‰ä¸ºè¾¹ç¼˜ï¼ŒåŸºäºè¯¥è¾¹ç¼˜åº”ç”Ÿæˆæ‰€éœ€çš„å¹³è¡Œå››è¾¹å½¢ã€‚ æˆ‘ä»¬å°†ä¸¤ä¸ªç‚¹<b>v2</b>å’Œ<b>v3</b>ä½œä¸ºåç§»ä½ç½®<b>v0</b>å’Œ<b>v1</b> ã€‚ ç„¶åæ ¹æ®ä»¥ä¸‹æ–¹æ¡ˆæ„é€ ä¸¤ä¸ªä¸‰è§’å½¢ï¼š <br><br><img src="https://habrastorage.org/webt/vv/ox/zl/vvoxzlj-mc7mu50fdolvczhdbf0.jpeg"><br><br> ç­‰é«˜çº¿çš„æ¯ä¸ªè¾¹ç¼˜ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">åˆ—å‡ºä½¿ç”¨è¾¹åˆ—è¡¨æ„é€ å¢™çš„æ–¹æ³•</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomMesh</span></span> { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtrudeEdgesSet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Edge[] edges, Vector3 offset</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (offset == Vector3.zero || edges == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || edges.Length == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initVerticesLength = vertices.Length; Array.Resize(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> vertices, initVerticesLength + edges.Length * <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (normals != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; normals.Length == initVerticesLength) { Array.Resize(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> normals, vertices.Length); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uv0 != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; uv0.Length == initVerticesLength) { Array.Resize(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> uv0, vertices.Length); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uv2 != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; uv2.Length == initVerticesLength) { Array.Resize(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> uv2, vertices.Length); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colors != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; colors.Length == initVerticesLength) { Array.Resize(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> colors, vertices.Length); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initTrianglesLength = Triangles.Length; Array.Resize(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> Triangles, initTrianglesLength + edges.Length * <span class="hljs-number"><span class="hljs-number">2</span></span>); edges .AsParallel() .Select((edge, i) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = initVerticesLength + i * <span class="hljs-number"><span class="hljs-number">4</span></span>; vertices[j] = edge.v0.position; vertices[j + <span class="hljs-number"><span class="hljs-number">1</span></span>] = edge.v1.position; vertices[j + <span class="hljs-number"><span class="hljs-number">2</span></span>] = edge.v0.position + offset; vertices[j + <span class="hljs-number"><span class="hljs-number">3</span></span>] = edge.v1.position + offset; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (normals != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; normals.Length == vertices.Length) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> normal = Vector3.Cross(vertices[j + <span class="hljs-number"><span class="hljs-number">1</span></span>] - vertices[j], offset); normals[j] = normals[j + <span class="hljs-number"><span class="hljs-number">1</span></span>] = normals[j + <span class="hljs-number"><span class="hljs-number">2</span></span>] = normals[j + <span class="hljs-number"><span class="hljs-number">3</span></span>] = normal; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uv0 != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; uv0.Length == vertices.Length) { uv0[j] = uv0[j + <span class="hljs-number"><span class="hljs-number">2</span></span>] = edge.v0.uv0; uv0[j + <span class="hljs-number"><span class="hljs-number">1</span></span>] = uv0[j + <span class="hljs-number"><span class="hljs-number">3</span></span>] = edge.v1.uv0; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uv2 != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; uv2.Length == vertices.Length) { uv2[j] = uv2[j + <span class="hljs-number"><span class="hljs-number">2</span></span>] = edge.v0.uv2; uv2[j + <span class="hljs-number"><span class="hljs-number">1</span></span>] = uv2[j + <span class="hljs-number"><span class="hljs-number">3</span></span>] = edge.v1.uv2; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colors != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; colors.Length == vertices.Length) { colors[j] = colors[j + <span class="hljs-number"><span class="hljs-number">2</span></span>] = edge.v0.color; colors[j + <span class="hljs-number"><span class="hljs-number">1</span></span>] = colors[j + <span class="hljs-number"><span class="hljs-number">3</span></span>] = edge.v1.color; } Triangles[initTrianglesLength + i * <span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Triangle( initTrianglesLength + i * <span class="hljs-number"><span class="hljs-number">2</span></span>, Id, j, j + <span class="hljs-number"><span class="hljs-number">1</span></span>, j + <span class="hljs-number"><span class="hljs-number">2</span></span> ); Triangles[initTrianglesLength + i * <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Triangle( initTrianglesLength + i * <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>, Id, j + <span class="hljs-number"><span class="hljs-number">3</span></span>, j + <span class="hljs-number"><span class="hljs-number">2</span></span>, j + <span class="hljs-number"><span class="hljs-number">1</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }).ToArray(); } }</code> </pre><br></div></div><br> é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œç”Ÿæˆçš„å¢™çš„å‰ä¾§å¯¹äºæ»‘é“å’Œå‡¹å‘å°†æ˜¯æ­£ç¡®çš„ã€‚ ä»…å­˜åœ¨ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šåœ¨å…¶ä¸Šæ‰§è¡Œ<b>æ‹‰ä¼¸</b>æ“ä½œçš„ä¸€ç»„ä¸‰è§’å½¢ä¸åº”è¯¥ç›¸å¯¹äºè¿åŠ¨çŸ¢é‡ç¼ ç»•åœ¨å…¶å‘¨å›´ã€‚ <br><br><img src="https://habrastorage.org/webt/4w/8v/te/4w8vtezc5p0mprdnzsmcgxk8htq.jpeg"><br>  <i>å…³äºåç§»é‡æ— æ•ˆçš„å¤šè¾¹å½¢å­é›†ã€‚</i>  <i>å³ä½¿åœ¨å…·æœ‰è¿™ç§æ‹‰ä¼¸çš„<b>Blenderä¸­</b> ï¼Œä¹Ÿæ— æ³•é¿å…å‡ ä½•æ›²çº¿</i> <br><br><img src="https://habrastorage.org/webt/ki/yh/5q/kiyh5qy9-uz1sqf27f_zls89f00.jpeg"><br>  <i>æœ‰æ•ˆçš„å¤šè¾¹å½¢å­é›†</i> <br><br> å¢™å·²ç»å‡†å¤‡å¥½äº†ï¼Œå®ƒä»ç„¶å¯ä»¥ç§»åŠ¨ä¸‰è§’å½¢ã€‚ ç®—æ³•çš„è¿™ä¸€æ­¥å¾ˆå®¹æ˜“ç†è§£ï¼Œå°½ç®¡å®ç°èµ·æ¥å¾ˆéº»çƒ¦ã€‚ <br><br> åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ç°‡çš„æ¯ä¸ªé¡¶ç‚¹ä»…å±äºå…¶ä¸‰è§’å½¢ã€‚ å¦‚æœä¸æ»¡è¶³è¯¥æ¡ä»¶ï¼Œåˆ™ä¸€äº›ç›¸é‚»çš„å¤šè¾¹å½¢å¯ä»¥åˆ°è¾¾è¯¥ç¾¤é›†ã€‚ è§£å†³è¿™ç§æƒ…å†µçš„æ–¹æ³•æ˜¯å¤åˆ¶å±äºç¾¤é›†å’Œæ¨¡å‹å…¶ä½™éƒ¨åˆ†çš„æ¯ä¸ªé¡¶ç‚¹ã€‚ ç„¶åï¼Œå¯¹äºç¾¤é›†ä¸­çš„æ‰€æœ‰å¤šè¾¹å½¢ï¼Œå°†æ­¤é¡¶ç‚¹çš„ç´¢å¼•æ›¿æ¢ä¸ºé‡å¤ç´¢å¼•ã€‚ å½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œæˆ‘ä»¬å°†ç¾¤é›†çš„æ‰€æœ‰é¡¶ç‚¹ç§»åˆ°è¿åŠ¨çŸ¢é‡ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">åˆ—å‡ºç§»åŠ¨å¤šè¾¹å½¢ç°‡çš„æ–¹æ³•</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomMesh</span></span> { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TranslateTrianglesHard</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] triIndices, Vector3 offset, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] hullVerts</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newVertexIndices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initVerticesCount = vertices.Length; Triangles.Where((t, i) =&gt; !triIndices.Contains(i)).Select(t =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hullVerts.Contains(t.V0.Index) &amp;&amp; !newVertexIndices.ContainsKey(t.V0.Index)) newVertexIndices.Add(t.V0.Index, initVerticesCount + newVertexIndices.Count); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hullVerts.Contains(t.V1.Index) &amp;&amp; !newVertexIndices.ContainsKey(t.V1.Index)) newVertexIndices.Add(t.V1.Index, initVerticesCount + newVertexIndices.Count); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hullVerts.Contains(t.V2.Index) &amp;&amp; !newVertexIndices.ContainsKey(t.V2.Index)) newVertexIndices.Add(t.V2.Index, initVerticesCount + newVertexIndices.Count); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }).ToArray(); Array.Resize(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> vertices, initVerticesCount + newVertexIndices.Count); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> newVertexIndices) vertices[pair.Value] = vertices[pair.Key] + offset; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (normals != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; normals.Length == initVerticesCount) { Array.Resize(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> normals, vertices.Length); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> newVertexIndices) normals[pair.Value] = normals[pair.Key]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uv0 != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; uv0.Length == initVerticesCount) { Array.Resize(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> uv0, vertices.Length); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> newVertexIndices) uv0[pair.Value] = uv0[pair.Key]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uv2 != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; uv2.Length == initVerticesCount) { Array.Resize(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> uv2, vertices.Length); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> newVertexIndices) uv2[pair.Value] = uv2[pair.Key]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colors != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; colors.Length == initVerticesCount) { Array.Resize(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> colors, vertices.Length); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> newVertexIndices) colors[pair.Value] = colors[pair.Key]; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> alreadyMoved = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; triIndices.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertexIndices.ContainsKey(Triangles[triIndices[i]].V0.Index)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = newVertexIndices[Triangles[triIndices[i]].V0.Index]; Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">0</span></span>].v0.Index = index; Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">2</span></span>].v1.Index = index; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!alreadyMoved.Contains(Triangles[triIndices[i]].V0.Index)) { vertices[Triangles[triIndices[i]].V0.Index] += offset; alreadyMoved.Add(Triangles[triIndices[i]].V0.Index); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertexIndices.ContainsKey(Triangles[triIndices[i]].V1.Index)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = newVertexIndices[Triangles[triIndices[i]].V1.Index]; Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">0</span></span>].v1.Index = index; Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">1</span></span>].v0.Index = index; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!alreadyMoved.Contains(Triangles[triIndices[i]].V1.Index)) { vertices[Triangles[triIndices[i]].V1.Index] += offset; alreadyMoved.Add(Triangles[triIndices[i]].V1.Index); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertexIndices.ContainsKey(Triangles[triIndices[i]].V2.Index)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = newVertexIndices[Triangles[triIndices[i]].V2.Index]; Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">1</span></span>].v1.Index = index; Triangles[triIndices[i]].Edges[<span class="hljs-number"><span class="hljs-number">2</span></span>].v0.Index = index; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!alreadyMoved.Contains(Triangles[triIndices[i]].V2.Index)) { vertices[Triangles[triIndices[i]].V2.Index] += offset; alreadyMoved.Add(Triangles[triIndices[i]].V2.Index); } } } }</code> </pre><br></div></div><br> åšå®Œäº† ç°åœ¨ï¼Œå°†æ‰€æœ‰æ­¥éª¤çš„ç»“æœåŠ èµ·æ¥ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªæ´æˆ–ä¸€ä¸ªå°å±±ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">åˆ—å‡ºæŒ¤å‡ºæ“ä½œçš„æœ€ç»ˆæ–¹æ³•</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomMesh</span></span> { â€¦ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExtrudeTriangles</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] triIndices, Vector3 offset</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> edges = ObtainHullEdges(triIndices); ExtrudeEdgesSet(edges.ToArray(), offset); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hullVertices = edges.Select(edge =&gt; edge.v0.Index).ToArray(); TranslateTrianglesHard(triIndices, offset, hullVertices); } }</code> </pre><br></div></div><br> ä½¿ç”¨çº¹ç†æ‰«æçš„åæ ‡å’Œè½®å»“ç‚¹çš„ä½ç§»ï¼Œæ‚¨å¯ä»¥å¾—åˆ°è¿™æ ·çš„å‡¹å£ï¼š <br><br><img src="https://habrastorage.org/webt/bw/at/oe/bwatoexbyvwkfjrztopbegi8uwi.png"><br><br><h3> è¿™è¿˜ä¸æ˜¯å…¨éƒ¨ </h3><br> é™¤äº†ä¸Šé¢è®¨è®ºçš„ç¼–è¾‘æ“ä½œä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨å…¶ä»–æ–¹ä¾¿çš„æ–¹æ³•æ¥å¤„ç†æ¨¡å‹ã€‚ <br><br> ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¦å¤–ç¼–å†™äº†<b>Combineï¼ˆï¼‰</b>æ–¹æ³•æ¥ç»„åˆä¸¤ä¸ª<b>CustomMesh</b> ã€‚ æˆ‘ä»¬çš„å®ç°ä¸<b>UnityEngine.Mesh.CombineMeshesï¼ˆï¼‰</b>ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå¦‚æœåœ¨åˆå¹¶ç½‘æ ¼æ—¶æŸäº›é¡¶ç‚¹æ˜¯å®Œå…¨ç­‰æ•ˆçš„ï¼Œåˆ™ä»…ä¿ç•™å…¶ä¸­ä¹‹ä¸€ï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„å‡ ä½•å½¢çŠ¶ã€‚ <br><br> åœ¨åŒä¸€æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬å®ç°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº†Delaunayå¹³é¢ä¸‰è§’å‰–åˆ†ç®—æ³•</a> ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œä½¿ç”¨å®ƒå¯ä»¥å…³é—­ä½¿ç”¨<b>æŒ¤å‹æˆå‹</b>çš„å¤§æ´ï¼Œè¯¥æ´å¸¦æœ‰å¸¦æ°´çº¹ç†çš„å¹³ç›–å¹¶å¾—åˆ°ä¸€ä¸ªæ¹–ï¼š <br><br><img src="https://habrastorage.org/webt/zx/d_/7a/zxd_7akztomgl6ccvb0nfofnha8.png"><br><br> å¥½å§ï¼Œæ•´ç†å‡ºæ¥ï¼ åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘å°†<b>.fbx</b>å¯¼å…¥<b>Unityçš„åŠŸèƒ½</b>ä»¥åŠé¡¹ç›®ä¸­æ¨¡å‹éªŒè¯çš„æ–¹æ³•ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">é›¶é£Ÿï¼ˆä»…é€‚ç”¨äºlulzï¼‰</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/x8/mk/wu/x8mkwuv2ose4mtecuzy3ph0m2bg.png"><br><img src="https://habrastorage.org/webt/cc/bu/lr/ccbulroovvqlk-jgmedg99jehfc.png"><br><img src="https://habrastorage.org/webt/ut/lr/2-/utlr2-kfdve0lkp6j97xcvaz6aa.png"><br><img src="https://habrastorage.org/webt/jk/km/pn/jkkmpnrhfhxdvxqxsp6sajwbxri.jpeg"><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN443870/">https://habr.com/ru/post/zh-CN443870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN443854/index.html">å››è½´RPGè®¾è®¡</a></li>
<li><a href="../zh-CN443856/index.html">CNCæœºæ¢°ä¸Šçš„é‡‘å±åŠ å·¥ï¼šå¦‚ä½•å¼€å§‹ç”Ÿäº§ä¸–ç•Œä¸€æµçš„äº§å“ï¼Ÿ</a></li>
<li><a href="../zh-CN443860/index.html">ç¨‹åºå‘˜ä¸ºå°å…¬å¸æä¾›æœåŠ¡ã€‚ å®ƒä¼šé£è¿˜æ˜¯ä¸ä¼šé£ï¼Ÿ</a></li>
<li><a href="../zh-CN443862/index.html">æ£€å¯Ÿå®˜çš„è½¦é”ã€‚ Bestchangeå†æ¬¡é”å®š</a></li>
<li><a href="../zh-CN443868/index.html">ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘å»äº†ä½“è‚²é¦†ï¼Œè¿™å¸¦æ¥äº†ä»€ä¹ˆ</a></li>
<li><a href="../zh-CN443872/index.html">nanoCAD SPDS Steelwork 1.2ç‰ˆçš„æ–°åŠŸèƒ½æ¦‚è¿°</a></li>
<li><a href="../zh-CN443874/index.html">æ·±åº¦å­¦ä¹ æ¡†æ¶çš„æ¯”è¾ƒï¼šTensorFlowï¼ŒPyTorchï¼ŒKerasï¼ŒMXNetï¼ŒMicrosoft Cognitive Toolkitï¼ŒCaffeç­‰</a></li>
<li><a href="../zh-CN443876/index.html">æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ç§Telegramæœºå™¨äººï¼Œç”¨äºåœ¨NodeJSå’ŒTypeScriptä¸Šè·Ÿè¸ªç”µå½±</a></li>
<li><a href="../zh-CN443878/index.html">DEV Labs2019ã€‚ç”¨äºè§£å†³éå¹³å‡¡ä»»åŠ¡çš„Pythonã€‚ åœ¨çº¿Mitap</a></li>
<li><a href="../zh-CN443882/index.html">MOSDROIDï¼ƒ15ç£·ï¼šè¡¨æ¼”è§†é¢‘</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>