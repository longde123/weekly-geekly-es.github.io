<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêß üåú üßò ESET: une analyse des nouveaux composants de Zebrocy üóº ü§≥üèª üïó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le cybergroupe Sednit fonctionne depuis au moins 2004 et appara√Æt r√©guli√®rement dans les actualit√©s. Sednit (mieux connu sous le nom de Fancy Bear) se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ESET: une analyse des nouveaux composants de Zebrocy</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/437236/">  Le cybergroupe Sednit fonctionne depuis au moins 2004 et appara√Æt r√©guli√®rement dans les actualit√©s.  Sednit (mieux connu sous le nom de Fancy Bear) serait √† l'origine de la fissure du Comit√© national d√©mocrate am√©ricain avant les √©lections de 2016, de l'Agence mondiale antidopage (AMA), de la cha√Æne de t√©l√©vision TV5Monde et d'autres attaques.  L'arsenal du groupe comprend un ensemble d'outils malveillants, dont certains ont √©t√© document√©s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans un rapport pr√©c√©dent</a> . <br><br>  Nous avons r√©cemment publi√© un rapport sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LoJax</a> , un rootkit UEFI qui est √©galement li√© √† Sednit et a √©t√© utilis√© dans des attaques dans les Balkans, en Europe centrale et orientale. <br><br>  En ao√ªt 2018, les op√©rateurs Sednit ont d√©ploy√© deux nouveaux composants Zebrocy, et nous avons d√©sormais constat√© une forte augmentation de l'utilisation de cet outil.  Zebrocy est une collection de chargeurs de d√©marrage, de compte-gouttes et de portes d√©rob√©es.  Les t√©l√©chargeurs et les droppers sont destin√©s √† l'intelligence, tandis que les backdoors fournissent la persistance et les logiciels espions.  Ces nouveaux composants ont une mani√®re inhabituelle d'exfiltrer les donn√©es collect√©es via les protocoles de service de messagerie SMTP et POP3. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fh/nc/qk/fhncqkih604tvkrg44vywz9uzum.jpeg"></div><a name="habracut"></a><br>  Les victimes des nouveaux outils ressemblent aux victimes mentionn√©es dans notre pr√©c√©dent article sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Zebrocy</a> , ainsi qu'au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kaspersky Lab</a> .  Les cibles des attaques se trouvent en Asie centrale, en Europe centrale et orientale, ce sont principalement des ambassades, des minist√®res des affaires √©trang√®res et des diplomates. <br><br><h3>  Revue </h3><br><img src="https://habrastorage.org/webt/-y/xq/ob/-yxqobqgv5jqqvti0t4zsnea5se.png"><br>  <i>Figure 1. Sch√©ma des composants anciens et nouveaux de Zebrocy</i> <br><br>  Pendant deux ans, le cybergroupe Sednit a utilis√© les e-mails de phishing comme vecteur d'infection pour Zebrocy (options 1 et 2 dans le tableau ci-dessus).  Apr√®s le compromis, les attaquants ont utilis√© divers bootloaders de la premi√®re √©tape pour collecter des informations sur la victime et, en cas d'int√©r√™t, apr√®s quelques heures ou jours, ont d√©ploy√© l'une des portes d√©rob√©es du deuxi√®me niveau. <br><br>  Le sch√©ma classique de la campagne Zebrocy consiste √† obtenir la victime sous forme d'archive dans la pi√®ce jointe √† la lettre.  L'archive contient deux fichiers, dont l'un est un document inoffensif, et le second est un fichier ex√©cutable.  Les attaquants tentent de tromper la victime en appelant le deuxi√®me fichier un nom typique du document ou de l'image et en utilisant la ¬´double extension¬ª. <br><br>  Dans la nouvelle campagne (option 3 dans le tableau), un sch√©ma plus compliqu√© est utilis√© - nous allons l'analyser ci-dessous. <br><br><h3>  Compte-gouttes Delphi </h3><br>  Le premier binaire est un compte-gouttes Delphi, ce qui est assez inhabituel pour la campagne Zebrocy.  Dans la plupart des cas, il s‚Äôagit plut√¥t d‚Äôun chargeur de d√©marrage install√© sur le syst√®me de la victime au premier stade de l‚Äôattaque. <br><br>  √Ä l'aide de plusieurs m√©thodes, dropper complique l'ing√©nierie inverse.  Dans les √©chantillons examin√©s, il utilise le mot-cl√© <i>foie</i> pour indiquer le d√©but et la fin des √©l√©ments cl√©s, comme indiqu√© ci-dessous. <br><br><pre><code class="plaintext hljs">$ yara -s tag_yara.yar SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe find_tag SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe 0x4c260:$tag: l\x00i\x00v\x00e\x00r\x00 0x6f000:$tag: liver 0x6f020:$tag: liver 0x13ab0c:$tag: liver</code> </pre> <br>  La r√®gle YARA ci-dessus recherche le <i>foie</i> de la cha√Æne.  La premi√®re ligne de <i>foie est</i> utilis√©e dans le code, mais elle ne s√©pare rien, tandis que les autres partagent le descripteur de cl√©, l'image (son hexdump est illustr√© ci-dessous) et le composant crypt√© dans le compte-gouttes. <br><br><pre> <code class="plaintext hljs">$ hexdump -Cn 48 -s 0x6f000 SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe 0006f000 6c 69 76 65 72 4f 70 65 6e 41 69 72 33 39 30 34 |liverOpenAir3904| 0006f010 35 5f 42 61 79 72 65 6e 5f 4d 75 6e 63 68 65 6e |5_Bayren_Munchen| 0006f020 6c 69 76 65 72 ff d8 ff e0 00 10 4a 46 49 46 00 |liver‚Ä¶‚Ä¶JFIF.|</code> </pre> <br>  Tout d'abord, les donn√©es sont enregistr√©es dans une image avec le nom de fichier <i>C: \ Users \ public \ Pictures \ scanPassport.jpg</i> , si un tel fichier n'existe pas. <br><br>  Fait int√©ressant, le fichier <i>dropper</i> s'appelle <i>SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe</i> , ce qui sugg√®re √©galement un sch√©ma de phishing li√© aux passeports et aux informations de voyage.  Cela peut signifier que l'op√©rateur peut conna√Ætre le but du message de phishing.  Le compte-gouttes ouvre l'image et, si le fichier existe d√©j√†, arr√™te l'ex√©cution.  Sinon, il l'ouvre et re√ßoit le handle de cl√© <i>OpenAir39045_Bayren_Munchen</i> .  L'image est manquante, bien que le format soit correct - voir la figure ci-dessous. <br><br><img src="https://habrastorage.org/webt/c9/_d/km/c9_dkmprdqv95bluopzc9ylq5ly.png"><br>  <i>Figure 2. ScanPassport.jpg</i> <br><br>  La ligne de descripteurs cl√©s contient <i>Bayren_Munchen</i> - tr√®s probablement une r√©f√©rence √† l'√©quipe de football du FC Bayern Munich.  Dans tous les cas, le contenu du descripteur n'est pas important, mais sa longueur, avec laquelle vous pouvez obtenir la cl√© XOR pour d√©crypter le composant. <br><br>  Pour obtenir la cl√© XOR, le compte-gouttes recherche le dernier mot-cl√© <i>liver</i> et l'indente de la longueur du descripteur.  La longueur de la cl√© XOR est de 27 (0x1b) octets (identique √† la longueur du descripteur de cl√©). <br><br>  √Ä l'aide de la cl√© XOR et d'une simple boucle, le compte-gouttes d√©chiffre la derni√®re partie - le composant chiffr√© situ√© imm√©diatement apr√®s la derni√®re balise √† la fin du fichier.  Veuillez noter que l'en-t√™te MZ du composant ex√©cutable commence imm√©diatement apr√®s le mot-cl√© <i>liver</i> , et la cl√© XOR est obtenue √† partir de la partie de l'en-t√™te PE, qui est g√©n√©ralement une s√©quence de 0x00 octets r√©cup√©r√©e apr√®s d√©chiffrement du composant, comme illustr√© dans la figure ci-dessous. <br><br><img src="https://habrastorage.org/webt/lm/lt/ty/lmlttyypf34eysahxyd0kplpuhu.png"><br>  <i>Figure 3. Composant chiffr√© (√† gauche) par rapport au composant d√©chiffr√© (√† droite)</i> <br><br>  Le composant est r√©initialis√© sur <i>C: \ Users \ Public \ Documents \ AcrobatReader.txt</i> et convertit le fichier en <i>C: \ Users \ Public \ Documents \ AcrobatReader.exe</i> . <br><br>  Il s'agit peut-√™tre d'une tentative de contourner la protection du PC, qui g√©n√®re un avertissement lorsque le fichier binaire vide le fichier avec l'extension .exe sur le disque. <br><br>  Une fois de plus, l'op√©rateur essaie de tromper la victime, et si elle fait attention au r√©pertoire, elle verra l'image comme dans la figure suivante: <br><br><img src="https://habrastorage.org/webt/ql/vj/q3/qlvjq3gqetpqgo5cgyo8-bc9nug.png"><br>  <i>Figure 4. Le composant ressemble √† un fichier PDF</i> <br><br>  Par d√©faut, Windows cache l'extension, et celle-ci est utilis√©e par un attaquant qui d√©charge le fichier ex√©cutable dans le dossier Documents et le d√©guise en PDF. <br><br>  Enfin, le dropper ex√©cute le composant h√©berg√© et se ferme. <br><br><h3>  MSIL Mail Loader </h3><br>  Le composant livr√© du compte-gouttes pr√©c√©dent est le chargeur MSIL emball√© avec UPX.  Pour une meilleure compr√©hension, la logique du processus est d√©crite ci-dessous, puis le code source est donn√© et le sch√©ma de contr√¥le est consid√©r√©. <br><br>  La m√©thode principale appelle <i>Ex√©cuter</i> pour lancer l'application, qui cr√©e ensuite <i>Form1</i> . <br><br><pre> <code class="plaintext hljs">{   Application.EnableVisualStyles();   Application.SetCompatibleTextRenderingDefault(false);   Application.Run((Form) new Form1()); }</code> </pre> <br>  <i>Form1</i> affecte de nombreuses variables, dont un nouveau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">temporisateur</a> pour sept d'entre elles. <br><br><pre> <code class="plaintext hljs">   this.start = new Timer(this.components);  this.inf = new Timer(this.components);   this.txt = new Timer(this.components);   this.subject = new Timer(this.components);   this.run = new Timer(this.components);   this.load = new Timer(this.components);   this.screen = new Timer(this.components);</code> </pre> <br>  L'objet Timer a trois champs importants: <br><br><ul><li>  Activ√©: indique l'√©tat de la minuterie activ√©e. </li><li>  Intervalle: temps entre les √©v√©nements en millisecondes </li><li>  Cochez: le rappel est ex√©cut√© apr√®s expiration du temporisateur et si le temporisateur est activ√© </li></ul><br>  Les champs sont indiqu√©s comme suit: <br><br><pre> <code class="plaintext hljs">  this.start.Enabled = true;   this.start.Interval = 120000;   this.start.Tick += new EventHandler(this.start_Tick);   this.inf.Interval = 10000;   this.inf.Tick += new EventHandler(this.inf_Tick);   this.txt.Interval = 120000;   this.txt.Tick += new EventHandler(this.txt_Tick);   this.subject.Interval = 120000;   this.subject.Tick += new EventHandler(this.subject_Tick);   this.run.Interval = 60000;   this.run.Tick += new EventHandler(this.run_Tick);   this.load.Interval = 120000;   this.load.Tick += new EventHandler(this.load_Tick);   this.screen.Interval = 8000;   this.screen.Tick += new EventHandler(this.screen_Tick);</code> </pre> <br>  Pour chaque objet, l' <i>intervalle d'</i> intervalle est d√©fini de 8 secondes √† 2 minutes.  Un rappel est ajout√© au gestionnaire d'√©v√©nements.  Notez que seul <i>start</i> d√©finit la valeur true pour <i>Enabled</i> , ce qui signifie qu'apr√®s 2 minutes (12 000 millisecondes = 120 secondes), <i>start_Tick</i> sera appel√© par le gestionnaire d'√©v√©nements. <br><br><pre> <code class="plaintext hljs">   private void start_Tick(object sender, EventArgs e)   {       try       {           this.start.Enabled = false;           Lenor lenor = new Lenor();           this.dir = !Directory.Exists(this.label15.Text.ToString()) ? this.label16.Text.ToString() + "\" : this.label15.Text.ToString() + "\";           this.att = this.dir + "audev.txt";           this._id = lenor.id(this.dir);           this.inf.Enabled = true;       }</code> </pre> <br>  En outre, chaque m√©thode pr√©sente un comportement identique - modifie la valeur <i>Enabled</i> sur <i>false</i> au d√©but.  La m√©thode est ex√©cut√©e, puis modifie la valeur <i>Enabled</i> de l'objet suivant sur <i>true</i> , ce qui active le temporisateur suivant.  La variable <i>Enabled</i> est utilis√©e par l'op√©rateur pour cr√©er quelque chose comme une machine d'√©tat - si la fonction ne fonctionne pas, le m√©canisme r√©p√®te son ex√©cution jusqu'√† ce qu'il re√ßoive un r√©sultat positif.  Le temps entre les ex√©cutions de deux fonctions peut √™tre utilis√© comme une tentative de contourner la protection antivirus en ajoutant un d√©lai. <br><br>  Maintenant, apr√®s avoir d√©crit la structure de chaque m√©thode, nous passons √† l'algorithme de contr√¥le.  Voici un aper√ßu des √©tapes sous forme d'√©change d'e-mails entre bo√Ætes aux lettres. <br><br><img src="https://habrastorage.org/webt/hd/zj/tl/hdzjtlq57qrzyht5k_lsydclpxm.png"><br>  <i>Figure 5. √âchange d'e-mails</i> <br><br>  Malvar v√©rifie l'existence d'un chemin d'acc√®s sp√©cifique utilis√© pour vider chacun des fichiers pendant l'ex√©cution.  Si possible, utilisez <i>C: \ Users \ Public \ Videos \</i> , sinon <i>C: \ Documents and Settings \ All Users \ Documents \</i> comme r√©pertoire par d√©faut.  Veuillez noter que le deuxi√®me chemin est sp√©cifique √† Windows XP, tandis que le premier chemin est sp√©cifique √† Vista et sup√©rieur. <br><br>  Un <i>identifiant de</i> 16 octets <i>est</i> g√©n√©r√© en concat√©nant le num√©ro de s√©rie du volume C: et le nom d'utilisateur;  il est stock√© dans le fichier <i>audev.txt</i> . <br><br>  Le chargeur de d√©marrage collecte les informations suivantes: <br>  - chemin d'application actuel <br>  - version du syst√®me d'exploitation <br>  - r√©pertoire syst√®me <br>  - domaine utilisateur <br>  - nom de la voiture <br>  - nom d'utilisateur <br>  - fuseau horaire actuel <br>  - date actuelle <br>  - une liste des disques logiques et des informations sur chacun d'eux (mod√®le, num√©ro de s√©rie, etc.) <br>  - r√©pertoriant les r√©pertoires <i>C: \ Program Files \</i> et <i>C: \ Program Files (x86) \</i> <br>  - liste des processus <br><br>  Ces donn√©es sont stock√©es dans le fichier <i>C: \ Users \ Public \ Videos \ si.ini</i> et envoy√©es par lettre dans la pi√®ce jointe via SMTPS en utilisant le port par d√©faut 465. Le corps du message contient la ligne <i>SI</i> (qui peut signifier les informations syst√®me), le destinataire du message est <i>sym777. g@post.cz</i> .  Pour l'ensemble de l'√©change d'informations, l'objet des lettres est indiqu√© comme <i>id</i> . <br><br>  L'op√©rateur a d√©cid√© de cr√©er plusieurs adresses de rechange et envoie la m√™me lettre √† deux autres destinataires, tr√®s probablement, au cas o√π l'adresse principale ne fonctionnerait pas.  Apr√®s l'envoi de la lettre, le chargeur supprime le fichier <i>si.ini</i> . <br><br>  Lors de la premi√®re ex√©cution du malware, un fichier <i>set.txt</i> est <i>cr√©√©</i> avec le texte <i>{System_Parametrs = 10} √† l'</i> int√©rieur et une entr√©e dans la cl√© de registre Windows. <br><br><img src="https://habrastorage.org/webt/hl/eh/ge/hlehgecuzoyjoygnnlt6c1q2l58.png"><br>  <i>Figure 6. Persistance dans le registre</i> <br><br>  Une capture d'√©cran est <i>prise</i> sous le nom <i>scx.bin</i> de l'ordinateur de la victime et envoy√©e par e-mail en pi√®ce jointe avec le texte <i>SC</i> (qui peut signifier Capture d'√©cran) dans le corps du message. <br><br>  Apr√®s l'envoi, le logiciel malveillant contacte la bo√Æte aux lettres <i>kae.mezhnosh@post.cz en</i> utilisant le protocole POP3 sur SSL (port 995) et recherche les messages dont le sujet correspond √† <i>id</i> .  Si un tel message existe et que le corps n'est pas vide, le malware le d√©chiffre et envoie un message avec <i>okey</i> dans le corps √† <i>sym777.g@post.cz</i> .  Le contenu d'un message re√ßu pr√©c√©demment est effac√© et analys√© comme suit: <br><br><pre> <code class="plaintext hljs">string[] strArray = this._adr.Replace("B&amp;", "").Replace("Db", "").Split('%');       string str1 = strArray[0];       string str2 = strArray[1];</code> </pre> <br>  Deux lignes sont obtenues: la premi√®re est le mot de passe et la seconde est le nom d'utilisateur de l'adresse e-mail. <br><br>  De nouvelles informations d'identification sont utilis√©es pour se connecter √† la bo√Æte aux lettres re√ßue, rechercher dans celle-ci un message avec une rubrique qui correspond √† l' <i>ID du</i> malvari et une application avec la cha√Æne <i>audev</i> dans le nom de fichier.  Si les deux conditions sont remplies, le malware stocke l'application et supprime le message du serveur. <br><br>  Un journal des messages est envoy√© √† <i>sym777.g@post.cz</i> et les messages re√ßus via POP3 proviennent du destinataire avec les donn√©es utilisateur r√©cemment re√ßues. <br><br>  Le plan d'attaque complique l'enqu√™te.  Premi√®rement, si vous avez un chargeur de d√©marrage avec des lettres, vous ne pouvez pas vous connecter √† la bo√Æte aux lettres contenant l'√©tape suivante. <br><br>  Deuxi√®mement, si vous recevez des informations d'identification pour le courrier, vous ne pouvez toujours pas obtenir la charge utile suivante car elle est supprim√©e apr√®s r√©ception. <br><br>  Lorsque le chargeur de d√©marrage √©crit avec succ√®s la pi√®ce jointe sur le disque, il envoie un message par courrier √©lectronique avec <i>okey2</i> dans le corps et la <i>pi√®ce</i> jointe <i>l.txt</i> contenant <i>090</i> .  Le m√™me fichier est remplac√© par des z√©ros et le malware essaie d'obtenir un autre message.  Si cela fonctionne, le fichier <i>l.txt</i> est <i>envoy√©</i> avec <i>okey3</i> dans le corps.  Le contenu de la pi√®ce jointe est le r√©pertoire et le nom du fichier.  Malvar d√©place le fichier audev vers cette adresse.  Enfin, le malware envoie un e-mail avec <i>okey4</i> dans le corps et <i>l.txt</i> dans la pi√®ce jointe.  Cela lance le fichier ex√©cutable, <i>audev.exe,</i> et v√©rifie la pr√©sence de la ligne <i>audev</i> dans la liste des processus. <br><br><pre> <code class="plaintext hljs">  Process.Start(this.rn);   foreach (Process process in Process.GetProcesses())   {       if (process.ProcessName.Contains("audev")) }</code> </pre> <br>  Si un tel nom est trouv√©, la derni√®re lettre sera envoy√©e, contenant dans le corps <i>okey5</i> et <i>l.txt</i> dans la pi√®ce jointe.  Enfin, <i>l.txt</i> et <i>set.txt</i> sont supprim√©s, la cl√© de registre Windows cr√©√©e est supprim√©e et le programme se termine. <br><br><h3>  Delphi Mail Downloader </h3><br>  Le r√¥le principal du chargeur de d√©marrage est d'√©valuer l'importance d'un syst√®me compromis et, s'il semble int√©ressant, de charger et d'ex√©cuter le dernier chargeur de d√©marrage Zebrocy. <br><br>  Le fichier binaire est √©crit en Delphi et empaquet√© en utilisant UPX.  Une d√©finition compl√®te de l'objet <i>TForm1</i> peut √™tre trouv√©e dans la section avec ses ressources, elle montre quelques param√®tres de configuration utilis√©s.  Les sections suivantes d√©crivent l'initialisation, les capacit√©s et le protocole r√©seau du chargeur de d√©marrage. <br><br><h3>  Initialisation </h3><br>  Tout d'abord, d√©chiffre l'ensemble des cha√Ænes qui sont des adresses e-mail et des mots de passe.  L'op√©rateur applique l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">algorithme de</a> chiffrement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AES ECB</a> .  Chaque ligne est d√©crypt√©e √† la place hexad√©cimale, o√π les quatre premiers octets correspondent √† la taille finale de la ligne d√©crypt√©e (les lignes d√©crypt√©es √† la fin peuvent contenir une indentation).  L'objet <i>TForm1</i> contient deux cl√©s AES: la premi√®re est utilis√©e pour chiffrer les donn√©es et la seconde est utilis√©e pour les d√©chiffrer. <br><br>  Les adresses e-mail et les mots de passe sont utilis√©s par l'op√©rateur pour envoyer des commandes aux malvari, ainsi que pour obtenir des informations collect√©es sur l'ordinateur de la victime.  Les protocoles de communication SMTP et POP3 sont appliqu√©s - tous deux via SSL.  Pour utiliser OpenSSL, le malware supprime et utilise deux biblioth√®ques dynamiques OpenSSL: <i>libeay32.dll (98c348cab0f835d6cf17c3a31cd5811f86c0388b)</i> et <i>ssleay32.dll (6d981d71895581dfb103170486b8614f7f203bdc)</i> . <br><br><img src="https://habrastorage.org/webt/fo/vl/_6/fovl_6evpu2kfxhr3b-4kcjeets.png"><br>  <i>Figure 7. Propri√©t√©s de la DLL OpenSSL</i> <br><br>  Veuillez noter que tous les fichiers sont sauvegard√©s dans le r√©pertoire de travail du malware <i>: C: \ Users \ Public \</i> . <br><br>  La persistance est fournie lors de la premi√®re ex√©cution du malvari gr√¢ce √† la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">technique de</a> script bien connue du script <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'</a> entr√©e.  Un fichier avec le script <i>registration.bat</i> est cr√©√© et plusieurs lignes sont √©crites √† partir de l'objet <i>TForm1</i> .  Le script final est le suivant: <br><br><pre> <code class="plaintext hljs">reg add HKCU\Environment /v "UserInitMprLogonScript" /t REG_EXPAND_SZ /d "C:\Users\Public\Videos\audev.exe" /f del C:\Users\Public\Videos\registr.bat exit</code> </pre> <br>  Enfin, le malware cr√©e un <i>identifiant</i> , de la m√™me mani√®re que dans les binaires Zebrocy d√©crits pr√©c√©demment.  Il obtient le nom d'utilisateur √† l'aide de l'API Windows <i>GetUserNameW</i> et ajoute le num√©ro de s√©rie du lecteur C: \ au d√©but. <br><br><h3>  Les possibilit√©s </h3><br>  √âtant donn√© qu'il existe plusieurs conditions et proc√©dures pour collecter des informations sur la victime, voici une description de ses diff√©rentes capacit√©s.  La configuration de l'analyse est stock√©e dans l'objet <i>TForm1</i> , o√π sept possibilit√©s diff√©rentes de collecte d'informations √† partir de l'ordinateur de la victime sont regroup√©es. <br><br>  En commen√ßant par une simple analyse, les premi√®res informations que le malware peut obtenir sont li√©es aux fichiers avec les extensions suivantes: <i>.docx, .xlsx, .pdf, .pptx, .rar, .zip, .jpg, .bmp, .tiff</i> .  Pour chacun des fichiers trouv√©s sur le disque, le malware re√ßoit le chemin complet et la derni√®re date de modification.  Ces informations sont crypt√©es √† l'aide de la cl√© AES, dont nous avons parl√© plus t√¥t, et stock√©es dans le fichier <i>0.txt</i> .  Une autre analyse vise les extensions <i>.dat, .json, .db</i> et, comme dans le cas pr√©c√©dent, obtient le chemin complet et la derni√®re date √† laquelle le fichier a √©t√© modifi√©.  Il les crypte ensuite et les stocke dans le fichier <i>57.txt</i> . <br><br>  La liste des processus en cours d'ex√©cution est une autre caract√©ristique de malvari qui vous permet de stocker des informations dans un fichier <i>08.txt</i> .  Cela ressemble √† ceci: <br><br><pre> <code class="plaintext hljs">======Listing_of_processes======= [System Process] System smss.exe csrss.exe wininit.exe csrss.exe winlogon.exe services.exe lsass.exe [‚Ä¶]</code> </pre> <br>  Le fichier <i>i.txt</i> recueille des informations g√©n√©rales sur l'ordinateur de la victime, ainsi que des informations sur le malvari (num√©ro de version et chemin le long duquel il est ex√©cut√©).  Voir l'exemple ci-dessous: <br><br><pre> <code class="plaintext hljs">v7.00 C:\Users\Public\Videos\audev.txt ============================================ Log_Drivers: C: fixed; size= 102297 Mb, free=83927 Mb S/N: [redacted] ================================================== OSV: Windows 7 WinType: 32 WinDir: C:\Windows Lang: English (United States) TZ: UTC1:0 Romance Standard Time HostN: [redacted]-PC User: [redacted] ===============S_LIST===================== C:\Program Files\Common Files C:\Program Files\desktop.ini C:\Program Files\DVD Maker C:\Program Files\Internet Explorer C:\Program Files\Microsoft.NET C:\Program Files\MSBuild C:\Program Files\Reference Assemblies C:\Program Files\Uninstall Information C:\Program Files\Windows Defender [‚Ä¶]</code> </pre> <br>  Les logiciels malveillants peuvent prendre des captures d'√©cran, qui sont enregistr√©es au format <i>2 \ [AAAA-mm-jj HH-MM-SS] -Image_001.jpg</i> , et g√©n√®rent un autre fichier <i>2 \ sa.bin</i> , rempli d'une liste de chemins d'acc√®s aux fichiers de toutes les captures d'√©cran captur√©es.  La derni√®re option consiste √† r√©pertorier les composants r√©seau et les donn√©es syst√®me, le r√©sultat est √©crit en <i>4.txt</i> . <br><br><h3>  Protocole r√©seau </h3><br>  Le chargeur de courrier Delphi est un ajout relativement nouveau √† la bo√Æte √† outils Zebrocy, il fournit une nouvelle fa√ßon d'exfiltrer les donn√©es et de recevoir des commandes de l'op√©rateur.  L'exfiltration est assez simple, mais elle fait beaucoup de bruit sur le r√©seau, car les fichiers chiffr√©s pr√©c√©demment collect√©s sont envoy√©s via SMTPS, chaque version du fichier est trois fois. <br><br><img src="https://habrastorage.org/webt/tw/xe/if/twxeif5sgovtnxjkuxhrcmcqyze.png"><br><br>  Le sujet du message est l' <i>ID de</i> la victime et le fichier est envoy√© en pi√®ce jointe avec un mot-cl√© correspondant au contenu du fichier.  Veuillez noter que pour chaque fichier, une version chiffr√©e est envoy√©e. <br><br><img src="https://habrastorage.org/webt/pn/pv/1m/pnpv1mmbkhhjs3qfrxa2uthwsky.png"><br><br>  Des captures d'√©cran et des fichiers pour les deux analyses sont √©galement envoy√©s, mais avec des mots cl√©s diff√©rents. <br><br><img src="https://habrastorage.org/webt/vu/s8/32/vus8328b9llia3xsyobiyqmnejw.png"><br><br><img src="https://habrastorage.org/webt/x9/ds/0h/x9ds0hckegel5ayp75d4nmkgtuc.png"><br>  <i>Figure 8. Exemple d'un message avec des donn√©es transmises</i> <br><br>  Alors que SMTP est utilis√© pour l'exfiltration des donn√©es, le fichier binaire est connect√© √† l' <i>adresse e-</i> mail <i>tomasso25@ambcomission.com</i> via POP3 et l'analyse des messages.  Le corps de la lettre contient divers mots cl√©s interpr√©t√©s par le malware comme des commandes. <br><br><img src="https://habrastorage.org/webt/wg/de/u7/wgdeu7jmqergcyp8lkyt4tk8ogs.png"><br><br>  Apr√®s l'ex√©cution, le journal du d√©bogueur et le r√©sultat des commandes (le cas √©ch√©ant) sont renvoy√©s √† l'op√©rateur.  Par exemple, apr√®s une commande de num√©risation, l'op√©rateur re√ßoit un fichier contenant une liste de fichiers avec les extensions correspondantes avec chacun de ces fichiers. <br><br>  Bien que ce chargeur de d√©marrage ait des fonctions de porte d√©rob√©e, il d√©charge dans le syst√®me un chargeur de d√©marrage sur Delphi, d√©j√† associ√© √† ce groupe, que nous avons d√©crit dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> pr√©c√©dent sur Zebrocy. <br><br><h3>  Conclusion </h3><br>  Dans le pass√©, nous avons d√©j√† vu l'intersection de Zebrocy et du malware traditionnel Sednit.  Nous avons surpris Zebrocy d√©versant la porte d√©rob√©e phare de Sednit dans le syst√®me XAgent, donc avec une grande certitude nous attribuons la paternit√© de Zebrocy √† ce cybergroupe. <br><br>  N√©anmoins, l'analyse des fichiers binaires a r√©v√©l√© des erreurs au niveau de la langue, ainsi que le d√©veloppement, indiquant un niveau de qualification diff√©rent des auteurs.  Les deux chargeurs de d√©marrage utilisent des protocoles de messagerie pour exfiltrer les donn√©es et disposent de m√©canismes identiques pour collecter les m√™mes informations.  Cependant, ils cr√©ent beaucoup de bruit sur le r√©seau et le syst√®me, cr√©ant de nombreux fichiers et les envoyant.  Dans le processus d'analyse du chargeur de messagerie sur Delphi, il nous a sembl√© que certaines fonctions avaient disparu, mais les lignes restaient toujours dans le fichier binaire.  Cette bo√Æte √† outils est utilis√©e par l'√©quipe Sednit, mais nous pensons qu'elle est d√©velopp√©e par une autre √©quipe - moins exp√©riment√©e par rapport aux cr√©ateurs des composants Sednit traditionnels. <br><br>  Les composants de Zebrocy sont un ajout √† la bo√Æte √† outils Sednit, et les √©v√©nements r√©cents peuvent expliquer l'utilisation active accrue des binaires Zebrocy au lieu des malvari traditionnels. <br><br><h3>  Indicateurs de compromis </h3><br><br>  <b>Noms de fichiers, SHA-1 et d√©tection par les produits ESET</b> <br><br>  1. SCANPASS_QXWEGRFGCVT_323803488900X_jpeg.exe - 7768fd2812ceff05db8f969a7bed1de5615bfc5a - <b>Win32 / Sednit.ORQ</b> <br>  2. C: \ Users \ public \ Pictures \ scanPassport.jpg - da70c54a8b9fd236793bb2ab3f8a50e6cd37e2df <br>  3. C: \ Users \ Public \ Documents \ AcrobatReader. {Exe, txt} - a225d457c3396e647ffc710cd1edd4c74dc57152 - <b>MSIL / Sednit.D</b> <br>  4. C: \ Users \ Public \ Videos \ audev.txt - a659a765536d2099ecbde988d6763028ff92752e - <b>Win32 / Sednit.CH</b> <br>  5.% TMP% \ Indy0037C632.tmp - 20954fe36388ae8b1174424c8e4996ea2689f747 - <b>Win32 / TrojanDownloader.Sednit.CMR</b> <br>  6.% TMP% \ Indy01863A21.tmp - e0d8829d2e76e9bb02e3b375981181ae02462c43 - <b>Win32 / TrojanDownloader.Sednit.CMQ</b> <br><br>  <b>Courriel</b> <br><br>  <i>carl.dolzhek17@post.cz</i> <i><br></i>  <i>shinina.lezh@post.cz</i> <i><br></i>  <i>P0tr4h4s7a@post.cz</i> <i><br></i>  <i>carl.dolzhek17@post.cz</i> <i><br></i>  <i>sym777.g@post.cz</i> <i><br></i>  <i>kae.mezhnosh@post.cz</i> <i><br></i>  <i>tomasso25@ambcomission.com</i> <i><br></i>  <i>kevin30@ambcomission.com</i> <i><br></i>  <i>salah444@ambcomission.com</i> <i><br></i>  <i>karakos3232@seznam.cz</i> <i><br></i>  <i>rishit333@ambcomission.com</i> <i><br></i>  <i>antony.miloshevich128@seznam.cz</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr437236/">https://habr.com/ru/post/fr437236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr437226/index.html">Ombre √† point Kelvin</a></li>
<li><a href="../fr437228/index.html">Le bitcoin, en tant que monnaie, entra√Ænera une crise √©conomique</a></li>
<li><a href="../fr437230/index.html">Une telle publicit√© en ligne diff√©rente. Trois axes vs AI, Ad Tech et DOOH</a></li>
<li><a href="../fr437232/index.html">Psto bon</a></li>
<li><a href="../fr437234/index.html">Nous commen√ßons √† √©tudier les microcontr√¥leurs en utilisant l'exemple de STM32F030f4p6</a></li>
<li><a href="../fr437238/index.html">Orange Pi 3 est sorti - un mini-pc complet √† 30 $ sous Linux</a></li>
<li><a href="../fr437240/index.html">Comment int√©grer Zimbra Collaboration Suite avec Active Directory</a></li>
<li><a href="../fr437242/index.html">Ma√Ætrise du chef de produit. Demandes de fonctionnalit√©s</a></li>
<li><a href="../fr437244/index.html">Google apprend aux utilisateurs √† reconna√Ætre les e-mails de phishing</a></li>
<li><a href="../fr437248/index.html">Mitap FPGA √† Saint-P√©tersbourg</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>