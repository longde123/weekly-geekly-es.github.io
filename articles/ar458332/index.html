<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐จ๐พโโ๏ธ ๐คฑ๐ผ ๐ ุงูุจุฑูุฌุฉ ุบูุฑ ุงููุชุฒุงููุฉ - ุงูุฃุฏุงุก ุบูุฑ ุงููุชุฒุงูู: ููู ุชูุงููู ุนุฏู ุงูุชุฒุงูู ูุงูุงูุชุธุงุฑ ๐จ๐ฝโ๐คโ๐จ๐ผ ๐ฅ ๐ฅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฐู ุงูููุงูุฉ ูุฏููุฉ ุฌุฏูุง ุ ููููุง ูู ุชููุฏ ุฃูููุชูุง. ุนูุฏูุง ูุชุนูู ุงูุฃูุฑ ุจุงูุชุฒุงูู / ุงูุงูุชุธุงุฑ ุ ูุธูุฑ ุฑุงุจุท ุฅูููุง ุนุงุฏุฉ. ูู ุฃุฌุฏ ุชุฑุฌูุฉ ุฅูู ุงููุบุฉ ุงูุฑูุณูุฉ ุ ูุฑุฑุช ูุณ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุจุฑูุฌุฉ ุบูุฑ ุงููุชุฒุงููุฉ - ุงูุฃุฏุงุก ุบูุฑ ุงููุชุฒุงูู: ููู ุชูุงููู ุนุฏู ุงูุชุฒุงูู ูุงูุงูุชุธุงุฑ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458332/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุฐู ุงูููุงูุฉ ูุฏููุฉ ุฌุฏูุง ุ ููููุง ูู ุชููุฏ ุฃูููุชูุง.  ุนูุฏูุง ูุชุนูู ุงูุฃูุฑ ุจุงูุชุฒุงูู / ุงูุงูุชุธุงุฑ ุ ูุธูุฑ ุฑุงุจุท ุฅูููุง ุนุงุฏุฉ.  ูู ุฃุฌุฏ ุชุฑุฌูุฉ ุฅูู ุงููุบุฉ ุงูุฑูุณูุฉ ุ ูุฑุฑุช ูุณุงุนุฏุฉ ุดุฎุต ูุง ูุฌูุฏ ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ. </p><br><hr><br><p style=";text-align:right;direction:rtl"> ูุงูุช ุงูุจุฑูุฌุฉ ุบูุฑ ุงููุชุฒุงููุฉ ููุฐ ูุชุฑุฉ ุทูููุฉ ููููุฉ ุงููุทูุฑูู ุงูุฃูุซุฑ ุฎุจุฑุฉ ูุน ุดุบู ุงููุงุณูุดูุฉ - ุฃููุฆู ุงูุฐูู ูุฏููู ููุช ูุฑุงุบ ูุงู ุ ูุงูููู ูุงููุฏุฑุฉ ุงูููุณูุฉ ุนูู ุงูุชูููุฑ ูู ุนูููุงุช ุงูุงุณุชุฑุฌุงุนุงุช ูู ุนูููุงุช ุงูุงุณุชุฑุฌุงุนุงุช ูู ุชุฏูู ุบูุฑ ุฎุทู ููุชูููุฐ.  ูุน ุธููุฑ Microsoft .NET Framework 4.5 ุ ุฌูุจุช C # ู Visual Basic ููุง ุฌููุนูุง ุจุดูู ุบูุฑ ูุชุฒุงูู ุ ูุฐูู ุฃุตุจุญ ุจููุฏูุฑ ูุฌุฑุฏ ุจุดุฑ ุฃู ููุชุจูุง ุทุฑููุง ุบูุฑ ูุชุฒุงููุฉ ุจููุณ ุงูุณูููุฉ ุชูุฑูุจูุง ูุซู ุชูู ุงููุชุฒุงููุฉ.  ูู ุชุนุฏ ููุงู ุญุงุฌุฉ ูุฑุฏูุฏ ุงููุนู.  ูุง ุฑูุฒ ุชูุธูู ุฃูุซุฑ ุตุฑุงุญุฉ ูู ุณูุงู ุงูุชุฒุงูู ูุงุญุฏ ุฅูู ุขุฎุฑ.  ูุง ูุฒูุฏ ูู ุงููุฎุงูู ุจุดุฃู ููููุฉ ุชูููุฐ ูุชุงุฆุฌ ุงูุชูููุฐ ุฃู ุงูุงุณุชุซูุงุกุงุช.  ููุณุช ููุงู ุญุงุฌุฉ ุฅูู ุงูุญูู ุงูุชู ุชุดูู ูุณุงุฆู ูุบุงุช ุงูุจุฑูุฌุฉ ูุฑุงุญุฉ ุชุทููุฑ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุบูุฑ ุงููุชุฒุงููุฉ.  ุจุงุฎุชุตุงุฑ ุ ูุง ููุฌุฏ ุงููุฒูุฏ ูู ุงููุชุงุนุจ ูุงูุตุฏุงุน. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ุจุงูุทุจุน ุ ุนูู ุงูุฑุบู ูู ุฃูู ูู ุงูุณูู ุงูุขู ุงูุจุฏุก ูู ูุชุงุจุฉ ุทุฑู ุบูุฑ ูุชุฒุงููุฉ (ุงูุธุฑ ููุงูุงุช ุฅุฑูู ููุจุฑุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงุฏุณ ุชูุฑุฌูุฑุณู</a> ูู <em>ูุฌูุฉ MSDN</em> ูุฐู <em>[OCTOBER 2011]</em> ) ุ ูุฅู ุงูููู ูุทููุจ ููููุงู ุจุฐูู ุจุดูู ุตุญูุญ. ูุงุฐุง ูุญุฏุซ ุชุญุช ุงูุบุทุงุก.  ูู ูู ูุฑุฉ ุชุฑูุน ูุบุฉ ุฃู ููุชุจุฉ ูุณุชูู ุงูุชุฌุฑูุฏ ุงูุฐู ูููู ูููุทูุฑ ุงุณุชุฎุฏุงูู ุ ูููู ูุฐุง ูุตุญูุจูุง ุญุชูุงู ุจุชูุงููู ุฎููุฉ ุชููู ุงูุฅูุชุงุฌูุฉ.  ูู ูุซูุฑ ูู ุงูุญุงูุงุช ุ ุชููู ูุฐู ุงูุชูุงููู ุถุฆููุฉ ุ ูุฐูู ูููู ุฅููุงููุง ูู ูุนุธู ุงูุญุงูุงุช ูู ูุจู ูุนุธู ุงููุจุฑูุฌูู.  ููุน ุฐูู ุ ูุฌุจ ุนูู ุงููุทูุฑูู ุงููุชูุฏููู ููู ุงูุชูุงููู ุงูุญุงููุฉ ุจุดูู ูุงูู ูู ุฃุฌู ุงุชุฎุงุฐ ุงูุชุฏุงุจูุฑ ุงููุงุฒูุฉ ูุญู ุงููุดููุงุช ุงููุญุชููุฉ ุฅุฐุง ูุงููุง ูุนุจุฑูู ุนู ุฃููุณูู.  ูุฐุง ูุทููุจ ุนูุฏ ุงุณุชุฎุฏุงู ุฃุฏูุงุช ุงูุจุฑูุฌุฉ ุบูุฑ ุงููุชุฒุงููุฉ ูู C # ู Visual Basic. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ุณูู ุฃุตู ูุฏุฎูุงุช ููุฎุฑุฌุงุช ุงูุทุฑู ุบูุฑ ุงููุชุฒุงููุฉ ุ ูุดุฑุญ ููููุฉ ุชูููุฐ ุงูุทุฑู ุบูุฑ ุงููุชุฒุงููุฉ ุ ูููุงูุดุฉ ุจุนุถ ุงูุชูุงููู ุงูุฃุตุบุฑ.  ูุงุญุธ ุฃู ูุฐู ููุณุช ุชูุตูุฉ ูุชุดููู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุงุจูุฉ ูููุฑุงุกุฉ ุฅูู ุดูุก ูุตุนุจ ุงูุญูุงุธ ุนููู ุ ุจุงุณู microoptimization ูุงูุฃุฏุงุก.  ูุฐู ููุท ุงููุนุฑูุฉ ุงูุชู ุณุชุณุงุนุฏ ูู ุชุดุฎูุต ุงููุดููุงุช ุงูุชู ูุฏ ุชูุงุฌููุง ุ ููุฌููุนุฉ ูู ุงูุฃุฏูุงุช ููุชุบูุจ ุนูู ูุฐู ุงููุดุงูู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุชุณุชูุฏ ูุฐู ุงูููุงูุฉ ุฅูู ูุนุงููุฉ ุงูุฅุตุฏุงุฑ 4.5 ูู .NET Framework ุ ูุฑุจูุง ุชุชุบูุฑ ุชูุงุตูู ุงูุชูููุฐ ุงููุญุฏุฏุฉ ูู ุงูุฅุตุฏุงุฑ ุงูููุงุฆู. </p><br><h4 id="poluchit-udobnuyu-model-myshleniya" style=";text-align:right;direction:rtl">  ุงุญุตู ุนูู ูููุฐุฌ ุชูููุฑ ูุฑูุญ </h4><br><p style=";text-align:right;direction:rtl">  ููุฐ ุนููุฏ ุ ูุณุชุฎุฏู ุงููุจุฑูุฌูู ูุบุงุช ุงูุจุฑูุฌุฉ ุนุงููุฉ ุงููุณุชูู C # ู Visual Basic ู F # ู C ++ ูุชุทููุฑ ุชุทุจููุงุช ูุซูุฑุฉ.  ุณูุญุช ูุฐู ุงูุชุฌุฑุจุฉ ูููุจุฑูุฌูู ุจุชูููู ุชูุงููู ุงูุนูููุงุช ุงููุฎุชููุฉ ูุงูุชุณุงุจ ุงููุนุฑูุฉ ุญูู ุฃูุถู ุชูููุงุช ุงูุชุทููุฑ.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ูุนุธู ุงูุญุงูุงุช ุ ูููู ุงุณุชุฏุนุงุก ุทุฑููุฉ ูุชุฒุงููุฉ ุฃูุฑูุง ุงูุชุตุงุฏููุง ูุณุจููุง ุ ุฎุงุตุฉู ุฅุฐุง ูุงู ุจุฅููุงู ุจุฑูุงูุฌ ุงูุชุญููู ุงูุจุฑูุฌู ุชุถููู ูุญุชููุงุช ุงูุทุฑููุฉ ุงูุชู ุชู ุงุณุชุฏุนุงุกูุง ูุจุงุดุฑุฉู ูู ููุทุฉ ุงูุงุชุตุงู.  ูุฐูู ุ ุงุนุชุงุฏ ุงููุทูุฑูู ุนูู ุชูุณูู ุงูุดูุฑุฉ ุฅูู ุทุฑู ุตุบูุฑุฉ ูุณูู ุตูุงูุชูุง ุ ุฏูู ุงูุญุงุฌุฉ ุฅูู ุงูููู ุจุดุฃู ุงูุนูุงูุจ ุงูุณูุจูุฉ ูุฒูุงุฏุฉ ุนุฏุฏ ุงูููุงููุงุช.  ุชู ุชุตููู ูููุฐุฌ ุงูุชูููุฑ ููุคูุงุก ุงููุจุฑูุฌูู ููุชุนุงูู ูุน ุงุณุชุฏุนุงุกุงุช ุงูุทุฑููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุน ุธููุฑ ุฃุณุงููุจ ุบูุฑ ูุชุฒุงููุฉ ุ ูุทููุจ ูููุฐุฌ ุฌุฏูุฏ ููุชูููุฑ.  ุจุฅููุงู C # ู Visual Basic ูุน ุจุฑุงูุฌ ุงูุชุญููู ุงูุจุฑูุฌู ุงูุฎุงุตุฉ ุจููุง ุฅูุดุงุก ููู ุจุฃู ุงูุทุฑููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ุชุนูู ููุธูุฑ ูุชุฒุงูู ููุง ุ ุนูู ุงูุฑุบู ูู ุฃู ูู ุดูุก ุฎุงุทุฆ ุชูุงููุง ูู ุงูุฏุงุฎู.  ููุดุฆ ุงููุญูู ุงูุจุฑูุฌู ููุฏุงุฑูุง ูุจูุฑูุง ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูููุจุฑูุฌ ุ ูุดุงุจููุง ุฌุฏูุง ูููุงูุจ ุงูููุงุณู ุงูุฐู ูุชุจู ุงููุทูุฑูู ูุฏุนู ุนุฏู ุงูุชุฒุงูู ุฎูุงู ุงูููุช ุงูุฐู ูุงู ูู ุงูุถุฑูุฑู ุงูููุงู ุจู ูุฏูููุง.  ุนูุงูุฉ ุนูู ุฐูู ุ ุชุญุชูู ุงูุชุนูููุฉ ุงูุจุฑูุฌูุฉ ุงูุชู ุฃูุดุฃูุง ุงููุชุฑุฌู ุนูู ุงุณุชุฏุนุงุกุงุช ููุธุงุฆู ููุชุจุฉ .NET Framework ุ ููุง ูููู ูู ุญุฌู ุงูุนูู ุงูุฐู ูุญุชุงุฌ ูุจุฑูุฌ ุฅูู ุงูููุงู ุจู.  ูู ุฃุฌู ุงูุญุตูู ุนูู ุงููููุฐุฌ ุงูุตุญูุญ ููุชูููุฑ ูุงุณุชุฎุฏุงูู ูุงุชุฎุงุฐ ูุฑุงุฑุงุช ูุณุชููุฑุฉ ุ ูู ุงูููู ุฃู ูููู ูุง ูููุฏู ุงููุชุฑุฌู ูู. </p><br><h4 id="bolshe-razmer-metodov-menshe-vyzovov" style=";text-align:right;direction:rtl">  ุงููุฒูุฏ ูู ุงูุทุฑู ุ ุนุฏุฏ ุฃูู ูู ุงูููุงููุงุช </h4><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงูุนูู ุจุฑูุฒ ูุชุฒุงูู ุ ูุฅู ุชุดุบูู ุงูุฃุณุงููุจ ุฐุงุช ุงููุญุชูู ุงููุงุฑุบ ูุง ูููุฉ ูู ุนูููุงู.  ุจุงููุณุจุฉ ููุทุฑู ุบูุฑ ุงููุชุฒุงููุฉ ุ ููุณุช ูุฐู ูู ุงูุญุงูุฉ.  ุถุน ูู ุงุนุชุจุงุฑู ูุฐู ุงูุทุฑููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ุ ุงูุชู ุชุชููู ูู ุชุนูููุฉ ูุงุญุฏุฉ (ูุงูุชู ุ ุจุณุจุจ ุนุฏู ูุฌูุฏ ุนุจุงุฑุงุช ุงูุชุธุงุฑ ุ ุณูุชู ุชูููุฐูุง ุจุดูู ูุชุฒุงูู): </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">public static async Task SimpleBodyAsync() { Console.WriteLine("Hello, Async World!"); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณููุดู ุฃุฏุงุฉ ูู ุดูุฑุฉ ุงููุบุฉ ุงููุณูุทุฉ (IL) ุนู ุงููุญุชููุงุช ุงูุญููููุฉ ููุฐู ุงููุธููุฉ ุจุนุฏ ุงูุชุญููู ุงูุจุฑูุฌู ุ ููุง ููุชุฌ ุนูู ุดูุก ูุดุงุจู ููุดูู 1. ูุง ุงูุฐู ุชู ุชุญูููู ุฅูู ุฎุท ูุงุญุฏ ุจุณูุท ุชู ุชุญูููู ุฅูู ุทุฑููุชูู ุ ุฃุญุฏููุง ููุชูู ุฅูู ุงููุฆุฉ ุงููุณุงุนุฏุฉ ูู ุขูุฉ ุงูุญุงูุฉ.  ุงูุฃูู ูู ุฃุณููุจ ูุนุจ ุฑููู ูู ุชูููุน ูุดุงุจู ูุฐูู ุงูููุชูุจ ูู ูุจู ุงููุจุฑูุฌ (ูุฐู ุงูุทุฑููุฉ ููุง ููุณ ุงูุงุณู ูููุณ ุงููุทุงู ุ ูุชุณุชุบุฑู ุงููุนููุงุช ููุณูุง ูุชูุฑุฌุน ููุณ ุงูููุน) ุ ูููููุง ูุง ุชุญุชูู ุนูู ุฑูุฒ ููุชูุจ ุจูุงุณุทุฉ ุงููุจุฑูุฌ.  ุฃูู ูุญุชูู ููุท ุนูู ูุนูุงุฑ ุงููุฑุฌู ููุฅุนุฏุงุฏ ุงูุฃููู.  ูููู ุฑูุฒ ุงูุฅุนุฏุงุฏ ุงูุฃููู ุจุชููุฆุฉ ุฌูุงุฒ ุงูุญุงูุฉ ุงููุทููุจ ูุชูุซูู ุงูุทุฑููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ุ ููุจุฏุฃ ุชุดุบููู ุจุงุณุชุฎุฏุงู ุงุณุชุฏุนุงุก ุฅูู ุฃุฏุงุฉ ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ MoveNext.  ูุญุชูู ููุน ูุงุฆู ุฌูุงุฒ ุงูุญุงูุฉ ุนูู ูุชุบูุฑ ูุน ุญุงูุฉ ุชูููุฐ ุงูุทุฑููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ุ ููุง ูุณูุญ ูู ุจุญูุธู ุนูุฏ ุงูุชุจุฏูู ุจูู ููุงุท ุงูุงูุชุธุงุฑ ุบูุฑ ุงููุชุฒุงููุฉ.  ููุง ุฃูู ูุญุชูู ุนูู ุฑูุฒ ููุชูุจ ุจูุงุณุทุฉ ูุจุฑูุฌ ุ ุชู ุชุนุฏููู ูุถูุงู ููู ูุชุงุฆุฌ ุงูุชูููุฐ ูุงูุงุณุชุซูุงุกุงุช ุฅูู ูุงุฆู ุงูููุงู ุงููุฑุชุฌุน ุ  ุงูุงุญุชูุงุธ ุจุงูููุถุน ุงูุญุงูู ูู ุงูุทุฑููุฉ ุจุญูุซ ูููู ุชูููุฐ ุงูุชูููุฐ ูู ูุฐุง ุงููููู ุจุนุฏ ุงูุงุณุชุฆูุงู ุ ุฅูุฎ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงูุดูู 1 ุงูุดูู 1.</strong> ุบูุฑ ูุชุฒุงูู ูุงูุจ ุงูุฃุณููุจ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[DebuggerStepThrough] public static Task SimpleBodyAsync() { &lt;SimpleBodyAsync&gt;d__0 d__ = new &lt;SimpleBodyAsync&gt;d__0(); d__.&lt;&gt;t__builder = AsyncTaskMethodBuilder.Create(); d__.MoveNext(); return d__.&lt;&gt;t__builder.Task; } [CompilerGenerated] [StructLayout(LayoutKind.Sequential)] private struct &lt;SimpleBodyAsync&gt;d__0 : &lt;&gt;t__IStateMachine { private int &lt;&gt;1__state; public AsyncTaskMethodBuilder &lt;&gt;t__builder; public Action &lt;&gt;t__MoveNextDelegate; public void MoveNext() { try { if (this.&lt;&gt;1__state == -1) return; Console.WriteLine("Hello, Async World!"); } catch (Exception e) { this.&lt;&gt;1__state = -1; this.&lt;&gt;t__builder.SetException(e); return; } this.&lt;&gt;1__state = -1; this.&lt;&gt;t__builder.SetResult(); } ... }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ุชุชุณุงุกู ุนู ุชูููุฉ ุงูููุงููุงุช ููุทุฑู ุบูุฑ ุงููุชุฒุงููุฉ ุ ุชุฐูุฑ ูุฐุง ุงูููุท.  ููุงู ุญุงุฌุฉ ุฅูู ูุชูุฉ try / catch ูู ุทุฑููุฉ MoveNext ูููุน ูุญุงููุฉ ูุญุชููุฉ ูุชุถููู JIT ุจูุงุณุทุฉ ูุฐู ุงูุทุฑููุฉ ุจูุงุณุทุฉ ุจุฑูุงูุฌ ุงูุชุญููู ุงูุจุฑูุฌู ุ ูุฐูู ุนูู ุงูุฃูู ูุญุตู ุนูู ุชูููุฉ ุงุณุชุฏุนุงุก ุงูุทุฑููุฉ ุ ุจูููุง ุนูุฏ ุงุณุชุฎุฏุงู ุงูุทุฑููุฉ ุงููุชุฒุงููุฉ ุ ูุฅู ูุฐู ุงูููุงููุฉ ุนูู ุงูุฃุฑุฌุญ ูู (ุจุดุฑุท ุฃู ูุญุชูู ุฃุถูู ุงูุญุฏูุฏ).  ุณูู ูุชููู ุนุฏุฉ ููุงููุงุช ูุฅุฌุฑุงุกุงุช Framework (ุนูู ุณุจูู ุงููุซุงู ุ SetResult).  ููุฐูู ุงูุนุฏูุฏ ูู ุนูููุงุช ุงููุชุงุจุฉ ูู ุญููู ูุงุฆู ุขูุฉ ุงูุฏููุฉ.  ุจุงูุทุจุน ุ ูุญู ุจุญุงุฌุฉ ุฅูู ููุงุฑูุฉ ูู ูุฐู ุงูุชูุงููู ุจุชูุงููู Console.WriteLine ุ ูุงูุชู ูู ุงููุญุชูู ุฃู ุชุณูุฏ (ุชุดูู ุชูุงููู ุงูููู ุ I / O ุ ุฅูุฎ.) ุงูุชุจู ุฅูู ุงูุชุญุณููุงุช ุงูุชู ุชุฌุนููุง ุงูุจูุฆุฉ ูู.  ุนูู ุณุจูู ุงููุซุงู ุ ูุชู ุชุทุจูู ูุงุฆู ูู ุขูุฉ ุงูุญุงูุฉ ููููู (ูููู).  ุณูุชู ุชุซุจูุช ูุฐู ุงูุจููุฉ ูู ูููุฉ ููุฏุงุฑุฉ ููุท ุฅุฐุง ูุงูุช ุงูุทุฑููุฉ ุชุญุชุงุฌ ุฅูู ุฅููุงู ุงูุชูููุฐ ุ ูู ุงูุชุธุงุฑ ุงูุชูุงุก ุงูุนูููุฉ ุ ููู ูุญุฏุซ ูุฐุง ุฃุจุฏูุง ูู ูุฐู ุงูุทุฑููุฉ ุงูุจุณูุทุฉ.  ูุฐูู ูู ูุชุทูุจ ููุท ูุฐู ุงูุทุฑููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ุชุฎุตูุต ุฐุงูุฑุฉ ูู ุงููููุฉ.  ุณูุญุงูู ุจุฑูุงูุฌ ุงูุชุญููู ุงูุจุฑูุฌู ูููุช ุงูุชุดุบูู ุชูููู ุนุฏุฏ ุนูููุงุช ุชุฎุตูุต ุงูุฐุงูุฑุฉ. </p><br><h4 id="kogda-ne-nuzhno-ispolzovat-async" style=";text-align:right;direction:rtl">  ุนูุฏูุง ูุง ุชุณุชุฎุฏู ุงููุชุฒุงูู </h4><br><p style=";text-align:right;direction:rtl">  ูุญุงูู .NET Framework ุฅูุดุงุก ุชุทุจููุงุช ูุนุงูุฉ ููุทุฑู ุบูุฑ ุงููุชุฒุงููุฉ ุจุงุณุชุฎุฏุงู ุฃุณุงููุจ ุงูุชุญุณูู ุงููุฎุชููุฉ.  ููุน ุฐูู ุ ูุฅู ุงููุทูุฑูู ุ ุงุณุชูุงุฏูุง ุฅูู ุฎุจุฑุชูู ุ ุบุงูุจูุง ูุง ูุทุจููู ุทุฑู ุงูุชุญุณูู ุงูุฎุงุตุฉ ุจูู ุ ูุงูุชู ูููู ุฃู ุชููู ูุญูููุฉ ุจุงููุฎุงุทุฑ ูุบูุฑ ุนูููุฉ ููุชุดุบูู ุงูุขูู ูู ูุจู ุงููุชุฑุฌู ูููุช ุงูุชุดุบูู ุ ุญูุซ ูุญุงูููู ุงุณุชุฎุฏุงู ุงูุฃุณุงููุจ ุงูุดุงููุฉ.  ุฅุฐุง ูู ุชูุณู ุฐูู ุ ูุณูููู ุฑูุถ ุงุณุชุฎุฏุงู ุทุฑู ุงููุฒุงููุฉ ูููุฏูุง ูู ุนุฏุฏ ูู ุงูุญุงูุงุช ุงููุญุฏุฏุฉ ุ ูููุทุจู ูุฐุง ุจุดูู ุฎุงุต ุนูู ุงูุฃุณุงููุจ ูู ุงูููุชุจุงุช ุงูุชู ูููู ุงุณุชุฎุฏุงููุง ูุน ุฅุนุฏุงุฏุงุช ุฃุฏู.  ูุญุฏุซ ูุฐุง ุนุงุฏุฉู ุนูุฏูุง ูููู ูุนุฑูููุง ุจุงูุชุฃููุฏ ุฃูู ูููู ุชูููุฐ ุงูุทุฑููุฉ ุจุดูู ูุชุฒุงูู ุ ูุฃู ุงูุจูุงูุงุช ุงูุชู ุชุนุชูุฏ ุนูููุง ุฌุงูุฒุฉ ุจุงููุนู. </p><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุฅูุดุงุก ุทุฑู ุบูุฑ ูุชุฒุงููุฉ ุ ูุถู ูุทูุฑู ุจุฑูุงูุฌ .NET Framework ุงููุซูุฑ ูู ุงูููุช ูู ุชุญุณูู ุนุฏุฏ ุนูููุงุช ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ.  ูุนุฏ ุฐูู ุถุฑูุฑููุง ูุฃู ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ ุชุชุญูู ุฃุนูู ุชูููุฉ ูู ุฃุฏุงุก ุจููุฉ ุฃุณุงุณูุฉ ุบูุฑ ูุชุฒุงููุฉ.  ุนูููุฉ ุชุฎุตูุต ุงูุฐุงูุฑุฉ ููุงุฆู ุนุงุฏุฉ ูุง ุชููู ุบูุฑ ููููุฉ ูุณุจูุง.  ูุดุจู ุชุฎุตูุต ุงูุฐุงูุฑุฉ ููุฃุดูุงุก ููุก ุงูุนุฑุจุฉ ุจููุชุฌุงุช ูู ุงูุณูุจุฑ ูุงุฑูุช - ูุง ุชููู ุฃู ุดูุก ุนูุฏูุง ุชุถุนูุง ูู ุงูุนุฑุจุฉ.  ูุญุฏุซ ุงูุฅููุงู ุนูุฏูุง ุชุฏูุน ุนูุฏ ุงูุฎุฑูุฌ ุ ูุชุฎุฑุฌ ูุญูุธุชู ูุชุนุทู ุฃููุงูุงู ููุงุณุจุฉ.  ูุฅุฐุง ูุงู ุชุฎุตูุต ุงูุฐุงูุฑุฉ ุฃูุฑูุง ุณููุงู ุ ูุฅู ุชุฌููุน ุงูุจูุงูุงุช ุงูููููุฉ ุงููุงุญูุฉ ูููู ุฃู ูุคุซุฑ ุจุดุฏุฉ ุนูู ุฃุฏุงุก ุงูุชุทุจูู.  ุนูุฏ ุจุฏุก ุชุฌููุน ุงูุจูุงูุงุช ุงูููููุฉ ุ ูุชู ุฅุฌุฑุงุก ูุณุญ ูุชุญุฏูุฏ ุงููุงุฆูุงุช ุงูููุฌูุฏุฉ ุญุงูููุง ูู ุงูุฐุงูุฑุฉ ูููู ููุณ ูุฏููุง ุฑูุงุจุท.  ูููุง ุชู ูุถุน ุงููุฒูุฏ ูู ุงููุงุฆูุงุช ุ ูููุง ุทุงู ุงูููุช ููุถุน ุนูุงูุงุช ุนูููุง.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููุง ุฒุงุฏ ุนุฏุฏ ุงููุงุฆูุงุช ูุจูุฑุฉ ุงูุญุฌู ุงูููุถูุนุฉ ุ ูููุง ุฒุงุฏุช ุงูุญุงุฌุฉ ุฅูู ุชุฌููุน ุงูุจูุงูุงุช ุงูููููุฉ.  ูุฐุง ุงูุฌุงูุจ ูู ุงูุนูู ูุน ุงูุฐุงูุฑุฉ ูู ุชุฃุซูุฑ ุนุงููู ุนูู ุงููุธุงู: ูููุง ุฒุงุฏ ุฅูุชุงุฌ ุงูููุงูุฉ ุจุทุฑู ุบูุฑ ูุชุฒุงููุฉ ุ ูููุง ูุงู ุงูุชุทุจูู ุฃุจุทุฃ ุ ุญุชู ูู ูู ุชุซุจุช microtests ุชูุงููู ูุจูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ููุทุฑู ุบูุฑ ุงููุชุฒุงููุฉ ุงูุชู ุชุนูู ุชูููุฐูุง (ูู ุงูุชุธุงุฑ ุงูุจูุงูุงุช ุบูุฑ ุงูุฌุงูุฒุฉ ุจุนุฏ) ุ ูุฌุจ ุนูู ุงูุจูุฆุฉ ุฅูุดุงุก ูุงุฆู ูู ุงูููุน Task ุ ุณูุชู ุฅุฑุฌุงุนู ูู ุงูุทุฑููุฉ ุ ูุฃู ูุฐุง ุงููุงุฆู ูุนูู ููุฑุฌุน ูุฑูุฏ ููููุงููุฉ.  ููุน ุฐูู ุ ูููู ุฅุฌุฑุงุก ููุงููุงุช ุบูุฑ ูุชุฒุงููุฉ ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุฏูู ุชุนููู.  ุซู ูููู ูููุช ุงูุชุดุบูู ุฅุฑุฌุงุน ูุงุฆู ุงูููุงู ุงูููุชูู ูุณุจููุง ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุ ูุงูุฐู ูุชู ุงุณุชุฎุฏุงูู ูุฑุงุฑูุง ูุชูุฑุงุฑูุง ุฏูู ุงูุญุงุฌุฉ ุฅูู ุฅูุดุงุก ูุงุฆูุงุช ูููุฉ ุฌุฏูุฏุฉ.  ุตุญูุญ ุ ูุง ููุณูุญ ุจุฐูู ุฅูุง ูู ุธู ุธุฑูู ูุนููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏูุง ุชูุฑุฌุน ุงูุทุฑููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ูุงุฆููุง ุบูุฑ ุนุงู (ุบูุฑ ุนุงู) ุงููููุฉ ุ ุฃู ุงููููุฉ ุ ุฃู ุนูุฏูุง ุชููู ุงููููุฉ ุงูุนุงูุฉ ูุญุฏุฏุฉ ุจูุงุณุทุฉ ููุน ูุฑุฌุน TResult ุ ููุชู ุฅุฑุฌุงุน ูุงุฑุบุฉ ูู ูุฐู ุงูุทุฑููุฉ.  ุนูู ุงูุฑุบู ูู ุฃู ูุงุฆูุฉ ูุฐู ุงูุดุฑูุท ุชุชูุณุน ุจูุฑูุฑ ุงูููุช ุ ุฅูุง ุฃููุง ูุง ุชุฒุงู ุฃูุถู ุฅุฐุง ููุช ุชุนุฑู ููููุฉ ุชูููุฐ ุงูุนูููุฉ. <br></p><p style=";text-align:right;direction:rtl">  ุงููุธุฑ ูู ุชูููุฐ ูุฐุง ุงูููุน ุจุงุนุชุจุงุฑู MemoryStream.  ูุฑุซ MemoryStream ูู Stream ุ ููุนูุฏ ุชุนุฑูู ุงูุฃุณุงููุจ ุงูุฌุฏูุฏุฉ ุงููุทุจูุฉ ูู .NET 4.5: ReadAsync ู WriteAsync ู FlushAsync ุ ูู ุฃุฌู ุชูููุฑ ุชุนูููุฉ ุจุฑูุฌูุฉ ุฎุงุตุฉ ุจุงูุฐุงูุฑุฉ.  ูุธุฑูุง ูุฅุฌุฑุงุก ุนูููุฉ ุงููุฑุงุกุฉ ูู ูุฎุฒู ูุคูุช ููุฌูุฏ ูู ุงูุฐุงูุฑุฉ ุ ุฃู ุฃููุง ูู ุงููุงูุน ูุณุฎุฉ ูู ููุทูุฉ ุงูุฐุงูุฑุฉ ุ ุณูููู ุฃูุถู ุฃุฏุงุก ุฅุฐุง ุชู ุชูููุฐ ReadAsync ูู ุงููุถุน ุงููุชุฒุงูู.  ูุฏ ูุจุฏู ุชูููุฐ ูุฐุง ุจุทุฑููุฉ ุบูุฑ ูุชุฒุงููุฉ ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public override async Task&lt;int&gt; ReadAsync(byte [] buffer, int offset, int count, CancellationToken cancellationToken) { cancellationToken.ThrowIfCancellationRequested(); return this.Read(buffer, offset, count); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุณูุทุฉ ุจูุง ููู ุงูููุงูุฉ.  ููุธุฑูุง ูุฃู Read ูู ููุงููุฉ ูุชุฒุงููุฉ ุ ููุง ุชุญุชูู ุงูุทุฑููุฉ ุนูู ุจูุงูุงุช ุงูุชุธุงุฑ ููุชุญูู ูู ุงูุชููุนุงุช ุ ูุณูุชู ุจุงููุนู ุชูููุฐ ุฌููุน ุงูููุงููุงุช ุฅูู ReadAsync ุจุดูู ูุชุฒุงูู.  ุงูุขู ููููู ูุธุฑุฉ ุนูู ุงูุญุงูุฉ ุงูููุงุณูุฉ ูุงุณุชุฎุฏุงู ุณูุงุณู ุงูุฑุณุงุฆู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุนูููุฉ ุงููุณุฎ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">byte [] buffer = new byte[0x1000]; int numRead; while((numRead = await source.ReadAsync(buffer, 0, buffer.Length)) &gt; 0) { await source.WriteAsync(buffer, 0, numRead); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฑุฌู ููุงุญุธุฉ ุฃูู ูู ูุซุงู ReadAsync ุงููุญุฏุฏ ุ ูุชู ุงุณุชุฏุนุงุก ุฏูู ุงููุตุฏุฑ ุฏุงุฆููุง ุจููุณ ูุนููุฉ ุทูู ุงููุฎุฒู ุงููุคูุช ุ ููุง ูุนูู ุฃูู ูู ุงููุญุชูู ุฌุฏูุง ุชูุฑุงุฑ ูููุฉ ุงูุฅุฑุฌุงุน (ุนุฏุฏ ูุญุฏุงุช ุงูุจุงูุช ุงูููุฑูุกุฉ).  ุจุงุณุชุซูุงุก ูู ุจุนุถ ุงูุญุงูุงุช ุงููุงุฏุฑุฉ ุ ูู ุบูุฑ ุงููุญุชูู ุฃู ูุณุชุฎุฏู ุชุทุจูู ReadAsync ูุงุฆู ุงูููุงู ุงููุฎุฒูุฉ ูุคูุชูุง ููููุฉ ุฅุฑุฌุงุน ุ ูููู ููููู ุงูููุงู ุจุฐูู. </p><br><p style=";text-align:right;direction:rtl">  ุงููุธุฑ ูู ุฎูุงุฑ ุชูููุฐ ุขุฎุฑ ููุฐู ุงูุทุฑููุฉ ุ ููุง ูู ููุถุญ ูู ุงูุดูู 2. ุจุงุณุชุฎุฏุงู ูุฒุงูุง ุงูุฌูุงูุจ ุงููุงููุฉ ูู ุงูุจุฑุงูุฌ ุงููุตูุฉ ุงูููุงุณูุฉ ููุฐู ุงูุทุฑููุฉ ุ ูููููุง ุชุญุณูู ุงูุชูููุฐ ูู ุฎูุงู ุงุณุชุจุนุงุฏ ุนูููุงุช ุชุฎุตูุต ุงูุฐุงูุฑุฉ ุ ูุงูุชู ูู ุบูุฑ ุงููุฑุฌุญ ุฃู ุชููู ูุชููุนุฉ ูู ููุช ุงูุชุดุบูู.  ูููููุง ุงููุถุงุก ุนูู ููุฏุงู ุงูุฐุงูุฑุฉ ุชูุงููุง ุนู ุทุฑูู ุฅุฑุฌุงุน ููุณ ูุงุฆู ุงููููุฉ ุงูุฐู ุชู ุงุณุชุฎุฏุงูู ูู ุงุณุชุฏุนุงุก ReadAsync ุงูุณุงุจู ุฅุฐุง ุชูุช ูุฑุงุกุฉ ููุณ ุนุฏุฏ ูุญุฏุงุช ุงูุจุงูุช.  ูุจุงููุณุจุฉ ููุซู ูุฐู ุงูุนูููุฉ ููุฎูุถุฉ ุงููุณุชูู ุ ูุงูุชู ูู ุงููุญุชูู ุฃู ุชููู ุณุฑูุนุฉ ุฌุฏูุง ูุณูุชู ุงุณุชุฏุนุงุคูุง ูุฑุงุฑูุง ูุชูุฑุงุฑูุง ุ ุณูููู ููุฐุง ุงูุชุญุณูู ุชุฃุซูุฑ ูุจูุฑ ุ ุฎุงุตุฉ ูู ุนุฏุฏ ูุฌููุนุงุช ุงูุจูุงูุงุช ุงูููููุฉ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงูุดูู 2 ุงูุดูู 2.</strong> ุงูุฃูุซู ูุฎูู ุงููููุฉ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">private Task&lt;int&gt; m_lastTask; public override Task&lt;int&gt; ReadAsync(byte [] buffer, int offset, int count, CancellationToken cancellationToken) { if (cancellationToken.IsCancellationRequested) { var tcs = new TaskCompletionSource&lt;int&gt;(); tcs.SetCanceled(); return tcs.Task; } try { int numRead = this.Read(buffer, offset, count); return m_lastTask != null &amp;&amp; numRead == m_lastTask.Result ? m_lastTask : (m_lastTask = Task.FromResult(numRead)); } catch(Exception e) { var tcs = new TaskCompletionSource&lt;int&gt;(); tcs.SetException(e); return tcs.Task; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุงุณุชุฎุฏุงู ุทุฑููุฉ ุฃูุซู ููุงุซูุฉ ุนู ุทุฑูู ุงูุชุฎูุต ูู ุงูุฅูุดุงุก ุบูุฑ ุงูุถุฑูุฑู ููุงุฆูุงุช ุงูููุงู ุฅุฐุง ูุงู ุงูุชุฎุฒูู ุงููุคูุช ุถุฑูุฑููุง.  ุถุน ูู ุงุนุชุจุงุฑู ุทุฑููุฉ ูุตููุฉ ูุงุณุชุฑุฏุงุฏ ูุญุชููุงุช ุตูุญุฉ ููุจ ูุชุฎุฒูููุง ูุคูุชูุง ููุฑุฌูุน ุฅูููุง ูุณุชูุจูุงู.  ูุฃุณููุจ ุบูุฑ ูุชุฒุงูู ุ ูููู ูุชุงุจุฉ ูุฐุง ูุงูุชุงูู (ุจุงุณุชุฎุฏุงู ููุชุจุฉ System.Net.Http.dll ุงูุฌุฏูุฏุฉ ูู .NET 4.5): </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">private static ConcurrentDictionary&lt;string,string&gt; s_urlToContents; public static async Task&lt;string&gt; GetContentsAsync(string url) { string contents; if (!s_urlToContents.TryGetValue(url, out contents)) { var response = await new HttpClient().GetAsync(url); contents = response.EnsureSuccessStatusCode().Content.ReadAsString(); s_urlToContents.TryAdd(url, contents); } return contents; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุชูููุฐ ุงูุฌุจูู.  ุจุงููุณุจุฉ ุฅูู ุงุณุชุฏุนุงุกุงุช GetContentsAsync ุงูุชู ูุง ุชุนุซุฑ ุนูู ุจูุงูุงุช ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุ ูููู ุฅููุงู ููุฏุงุฑ ุงูุญูู ูุฅูุดุงุก ูุงุฆู ูููุฉ ุฌุฏูุฏ ููุงุฑูุฉ ุจุชูููุฉ ุชููู ุงูุจูุงูุงุช ุนุจุฑ ุงูุดุจูุฉ.  ููุน ุฐูู ุ ูู ุญุงูุฉ ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุ ุชุตุจุญ ูุฐู ุงูุชูุงููู ูุจูุฑุฉ ุฅุฐุง ููุช ุจุจุณุงุทุฉ ุจูู ุงูุจูุงูุงุช ุงููุญููุฉ ูุฅุชุงุญุชูุง. <br></p><p style=";text-align:right;direction:rtl">  ููุชุฎูุต ูู ูุฐู ุงูุชูุงููู (ุฅุฐุง ูุฒู ุงูุฃูุฑ ูุชุญููู ุฃุฏุงุก ุนุงูู) ุ ููููู ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูุทุฑููุฉ ููุง ูู ููุถุญ ูู ุงูุดูู 3. ุงูุขู ูุฏููุง ุทุฑููุชุงู: ุทุฑููุฉ ุนุงูุฉ ูุชุฒุงููุฉ ูุทุฑููุฉ ุฎุงุตุฉ ุบูุฑ ูุชุฒุงููุฉ ุ ูููู ุงูููุฏูุจูู ุงูุนูููููู ุจุฅุตุฏุงุฑูุง.  ุชููู ูุฌููุนุฉ Dictionary ุงูุขู ุจุชุฎุฒูู ูุงุฆูุงุช ุงูููุงู ุงูุชู ุชู ุฅูุดุงุคูุง ูุคูุชูุง ุ ูููุณ ูุญุชููุงุชูุง ุ ูุฐูู ูููู ุฅุฌุฑุงุก ุงููุญุงููุงุช ุงููุณุชูุจููุฉ ูุงุณุชุฑุฏุงุฏ ูุญุชููุงุช ุงูุตูุญุฉ ุงูุชู ุชู ุงูุญุตูู ุนูููุง ุจูุฌุงุญ ูู ุฎูุงู ุงููุตูู ุจุจุณุงุทุฉ ุฅูู ุงููุฌููุนุฉ ูุฅุฑุฌุงุน ูุงุฆู ุงูููุงู ุงูุญุงูู.  ูู ุงูุฏุงุฎู ุ ููููู ุงูุงุณุชูุงุฏุฉ ูู ุงุณุชุฎุฏุงู ุฃุณุงููุจ ContinueWith ููุงุฆู ุงูููุงู ุ ููุง ูุณูุญ ููุง ุจุญูุธ ุงููุงุฆู ุงูุฐู ุชู ุชูููุฐู ูู ุงููุฌููุนุฉ - ูู ุญุงูุฉ ูุฌุงุญ ุชุญููู ุงูุตูุญุฉ.  ุจุงูุทุจุน ุ ูุฐุง ุงูุฑูุฒ ุฃูุซุฑ ุชุนููุฏูุง ููุชุทูุจ ุงููุซูุฑ ูู ุงูุชุทููุฑ ูุงูุฏุนู ุ ูุงููุนุชุงุฏ ุนูุฏ ุชุญุณูู ุงูุฃุฏุงุก: ูุง ุชุฑุบุจ ูู ูุถุงุก ุจุนุถ ุงูููุช ูู ูุชุงุจุชู ุญุชู ูุธูุฑ ุงุฎุชุจุงุฑ ุงูุฃุฏุงุก ุฃู ูุฐู ุงูุชุนููุฏุงุช ุชุคุฏู ุฅูู ุชุญุณูููุง ุ ููู ุฃูุฑ ูุซูุฑ ููุฅุนุฌุงุจ ููุงุถุญ.  ูุง ูู ุงูุชุญุณููุงุช ุงูุชู ุชุนุชูุฏ ูู ุงููุงูุน ุนูู ุทุฑููุฉ ุงูุชุทุจูู.  ููููู ุชุฌุฑุจุฉ ูุฌููุนุฉ ุงุฎุชุจุงุฑ ุชุญุงูู ุญุงูุงุช ุงูุงุณุชุฎุฏุงู ุงูุดุงุฆุนุฉ ูุชูููู ุงููุชุงุฆุฌ ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงูุช ุงููุนุจุฉ ุชุณุชุญู ุงูุดูุนุฉ ุฃู ูุง. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงูุดูู 3 ุงูุดูู 3.</strong> ุงูููุงู ุงูุชุฎุฒูู ุงููุคูุช ูุฏููุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">private static ConcurrentDictionary&lt;string,Task&lt;string&gt;&gt; s_urlToContents; public static Task&lt;string&gt; GetContentsAsync(string url) { Task&lt;string&gt; contents; if (!s_urlToContents.TryGetValue(url, out contents)) { contents = GetContentsInternalAsync(url); contents.ContinueWith(delegate { s_urlToContents.TryAdd(url, contents); }, CancellationToken.None, TaskContinuationOptions.OnlyOnRanToCompletion | TaskContinuatOptions.ExecuteSynchronously, TaskScheduler.Default); } return contents; } private static async Task&lt;string&gt; GetContentsInternalAsync(string url) { var response = await new HttpClient().GetAsync(url); return response.EnsureSuccessStatusCode().Content.ReadAsString(); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุชูุซู ุทุฑููุฉ ุงูุชุญุณูู ุงูุฃุฎุฑู ุงููุฑุชุจุทุฉ ุจูุงุฆูุงุช ุงูููุงู ูู ุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ูุฌุจ ุฅุฑุฌุงุน ูุซู ูุฐุง ุงููุงุฆู ูู ุงูุทุฑููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ุนูู ุงูุฅุทูุงู.  ูุฏุนู ูู ูู C # ู Visual Basic ุฃุณุงููุจ ุบูุฑ ูุชุฒุงููุฉ ุชูุฑุฌุน ูููุฉ ูุงุฑุบุฉ (ุฎุงููุฉ) ุ ููุง ุชูุดุฆ ูุงุฆูุงุช ูููุฉ ุนูู ุงูุฅุทูุงู.  ูุฌุจ ุฃู ุชูุฑุฌุน ุงูุทุฑู ุบูุฑ ุงููุชุฒุงููุฉ ูู ุงูููุชุจุงุช ุงูููุงู ูุงูููุงู ุฏุงุฆููุง ุ ูุฃูู ุนูุฏ ุชุตููู ููุชุจุฉ ูุง ููููู ูุนุฑูุฉ ุฃูู ูู ูุชู ุงุณุชุฎุฏุงููุง ูู ุงูุชุธุงุฑ ุงูุงูุชูุงุก.  ููุน ุฐูู ุ ุนูุฏ ุชุทููุฑ ุงูุชุทุจููุงุช ุ ูููู ุฃู ุชุฌุฏ ุงูุทุฑู ุงูุชู ุชูุฑุฌุน ุงููุฑุงุบ ููุงููุง.  ุงูุณุจุจ ุงูุฑุฆูุณู ููุฌูุฏ ูุซู ูุฐู ุงูุทุฑู ูู ุชูููุฑ ุงูุจูุฆุงุช ุงููุงุฆูุฉ ุนูู ุงูุฃุญุฏุงุซ ุงููุงุฆูุฉ ุ ูุซู ASP.NET ู Windows Presentation Foundation (WPF).  ุจุงุณุชุฎุฏุงู ุงููุฒุงููุฉ ูุงูุงูุชุธุงุฑ ุ ุชุณูู ูุฐู ุงูุทุฑู ุชูููุฐ ูุนุงูุฌุงุช ุงูุฃุฒุฑุงุฑ ูุฃุญุฏุงุซ ุชุญููู ุงูุตูุญุฉ ุ ุฅูุฎ.  ุฅุฐุง ููุช ุชููู ุงุณุชุฎุฏุงู ุทุฑููุฉ ุบูุฑ ูุชุฒุงููุฉ ูุน ุงููุฑุงุบ ุ ูุงุญุฑุต ุนูู ูุนุงูุฌุฉ ุงูุงุณุชุซูุงุกุงุช: ุณุชุธูุฑ ุงูุงุณุชุซูุงุกุงุช ููู ูู ุฃู SynchronizationContext ุงูุฐู ูุงู ูุดุทูุง ูู ููุช ุชู ุงุณุชุฏุนุงุก ุงูุทุฑููุฉ. <br></p><h4 id="ne-zabyvayte-o-kontekste" style=";text-align:right;direction:rtl">  ูุง ุชูุณ ุงูุณูุงู </h4><br><p style=";text-align:right;direction:rtl">  ููุงู ุงูุนุฏูุฏ ูู ุงูุณูุงูุงุช ุงููุฎุชููุฉ ูู .NET Framework: LogicalCallContext ู SynchronizationContext ู HostExecutionContext ู SecurityContext ู ExecutionContext ูุบูุฑูุง (ูุฏ ูุดูุฑ ุญุฌููุง ุงูุถุฎู ุฅูู ุฃู ููุดุฆู Framework ูุฏ ุชู ุชุญููุฒูู ูุงููุงู ูุฅูุดุงุก ุณูุงูุงุช ุฌุฏูุฏุฉ ุ ููููู ุฃุนุฑู ุจุงูุชุฃููุฏ ุฃู ูุฐุง ููุณ ูุฐูู).  ุชุคุซุฑ ุจุนุถ ูุฐู ุงูุณูุงูุงุช ุจุดุฏุฉ ุนูู ุงูุฃุณุงููุจ ุบูุฑ ุงููุชุฒุงููุฉ ุ ููุณ ููุท ูู ุญูุซ ุงูุฃุฏุงุก ุงููุธููู ุ ูููู ุฃูุถูุง ูู ุงูุฃุฏุงุก. </p><br><p style=";text-align:right;direction:rtl">  <strong>SynchronizationContext</strong> SynchronizationContext ููุนุจ ุฏูุฑูุง ูุงููุง ููุทุฑู ุบูุฑ ุงููุชุฒุงููุฉ.  "ุณูุงู ุงูุชุฒุงูู" ูู ูุฌุฑุฏ ุชุฌุฑูุฏ ูุถูุงู ุชูุธูู ุงูุงุญุชุฌุงุฌ ุงููููุถ ูุน ุชูุงุตูู ููุชุจุฉ ุฃู ุจูุฆุฉ ูุนููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุญุชูู WPF ุนูู DispatcherSynchronizationContext ูุชูุซูู ุฏูู ูุงุฌูุฉ ูุณุชุฎุฏู (UI) ูู Dispatcher: ูุคุฏู ุฅุฑุณุงู ูููุถ ุฅูู ุณูุงู ุงููุฒุงููุฉ ูุฐุง ุฅูู ูุถุน ูุฐุง ุงููููุถ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ููุชูููุฐ ูู ูุจู Dispatcher ูู ุฏููู.  ูููุฑ ASP.NET AspNetSynchronizationContext ููุณุชุฎุฏู ููุชุฃูุฏ ูู ุฃู ุงูุนูููุงุช ุบูุฑ ุงููุชุฒุงููุฉ ุงููุชุถููุฉ ูู ูุนุงูุฌุฉ ุทูุจ ASP.NET ูุถูููุฉ ููุชู ุชูููุฐูุง ุจุงูุชุณูุณู ูุชููู ูุฑุชุจุทุฉ ุจุญุงูุฉ HttpContext ุงูุตุญูุญุฉ.  ุญุณูุง ุ ุงูุฎ  ุจุดูู ุนุงู ุ ููุงู ุญูุงูู 10 ุชุฎุตุตุงุช ูู SynchronizationContext ูู .NET Framework ุ ุจุนุถูุง ููุชูุญ ุ ูุจุนุถู ุฏุงุฎูู. </p><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงูุชุธุงุฑ ููุงู ุฃู ูุงุฆูุงุช ูู ุงูุฃููุงุน ุงูุฃุฎุฑู ุงูุชู ูููู ูู .NET Framework ุชูููุฐ ุฐูู ุ ุชูุชูุท ุงููุงุฆูุงุช ุงูุชู ุชูุชุธุฑูุง (ุนูู ุณุจูู ุงููุซุงู ุ TaskAwaiter) SynchronizationContext ุงูุญุงูู ูู ุงูููุช ุงูุฐู ูุจุฏุฃ ููู ุงูุงูุชุธุงุฑ (ููุฏ ุงูุงูุชุธุงุฑ).  ุนูุฏ ุงูุงูุชูุงุก ูู ุงูุงูุชุธุงุฑ ุ ูู ุญุงูุฉ ุงูุชูุงุท SynchronizationContext ุ ูุชู ุฅุฑุณุงู ุงุณุชูุฑุงุฑ ุงูุฃุณููุจ ุบูุฑ ุงููุชุฒุงูู ุฅูู ุณูุงู ุงููุฒุงููุฉ ูุฐุง.  ููุฐุง ุงูุณุจุจ ุ ูุง ูุญุชุงุฌ ุงููุจุฑูุฌูู ุงูุฐูู ููุชุจูู ุฃุณุงููุจ ุบูุฑ ูุชุฒุงููุฉ ูุงูุชู ูุชู ุงุณุชุฏุนุงุคูุง ูู ุฏูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ุฅูู ุชูุธูู ุงูููุงููุงุช ูุฏูููุง ูุฑุฉ ุฃุฎุฑู ุฅูู ุฏูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ูู ุฃุฌู ุชุญุฏูุซ ุนูุงุตุฑ ุชุญูู ูุงุฌูุฉ ุงููุณุชุฎุฏู: ูููุฐ ุฅุทุงุฑ ุงูุนูู ูุฐุง ุงูุชูุธูู ุชููุงุฆููุง. </p><br><p style=";text-align:right;direction:rtl">  ูุณูุก ุงูุญุธ ุ ูุฅู ูุฐุง ุงูุชูุธูู ูุฃุชู ุจุณุนุฑ.  ููุทูุฑู ุงูุชุทุจููุงุช ุงูุฐูู ูุณุชุฎุฏููู ุงูุงูุชุธุงุฑ ูุชูููุฐ ุชุฏูู ุงูุชุญูู ุ ูุฅู ุงูุญุดุฏ ุงูุชููุงุฆู ูู ุงูุญู ุงูุตุญูุญ.  ุบุงูุจูุง ูุง ูููู ููููุชุจุงุช ูุตุฉ ูุฎุชููุฉ ุชูุงููุง.  ููุทูุฑู ุงูุชุทุจููุงุช ุ ูุนุฏ ูุฐุง ุงูุชูุธูู ุถุฑูุฑููุง ุจุดูู ุฃุณุงุณู ููุฑูุฒ ููุชุญูู ูู ุงูุณูุงู ุงูุฐู ูุชู ุชูููุฐู ููู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูููุตูู ุฅูู ุนูุงุตุฑ ุชุญูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ุฃู ูููุตูู ุฅูู HttpContext ุงููุทุงุจู ูุทูุจ ASP.NET ุงููุทููุจ.  ููุน ุฐูู ุ ูุง ููุทูุจ ูู ุงูููุชุจุงุช ุนููููุง ุชูุจูุฉ ูุฐุง ุงููุทูุจ.  ูุชูุฌุฉู ูุฐูู ุ ุบุงูุจุงู ูุง ูุฌูุจ ุงูุชูุธูู ุงูุชููุงุฆู ุชูุงููู ุฅุถุงููุฉ ุบูุฑ ุถุฑูุฑูุฉ ุชูุงููุง.  ุฏุนูุง ูููู ูุธุฑุฉ ุฃุฎุฑู ุนูู ุงูููุฏ ุงูุฐู ูููู ุจูุณุฎ ุงูุจูุงูุงุช ูู ุฏูู ุฅูู ุขุฎุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">byte [] buffer = new byte[0x1000]; int numRead; while((numRead = await source.ReadAsync(buffer, 0, buffer.Length)) &gt; 0) { await source.WriteAsync(buffer, 0, numRead); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุชู ุงุณุชุฏุนุงุก ูุฐู ุงููุณุฎุฉ ูู ุฏูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ุ ูุณุชุฌุจุฑ ูู ุนูููุฉ ูุฑุงุกุฉ ููุชุงุจุฉ ุงูุชูููุฐ ุนูู ุงูุนูุฏุฉ ุฅูู ุฏูู ูุงุฌูุฉ ุงููุณุชุฎุฏู.  ูู ุญุงูุฉ ูุฌูุฏ ููุบุง ุจุงูุช ูู ุงูุจูุงูุงุช ูู ุงููุตุฏุฑ ูุงูุชุฏููุงุช ุงูุชู ุชูุฑุฃ ูุชูุชุจ ุจุดูู ุบูุฑ ูุชุฒุงูู (ุฃู ูุนุธู ุชุทุจููุงุชูุง) ุ ูุฅู ูุฐุง ูุนูู ุฃู ุญูุงูู 500 ุงูุชุจุฏูู ูู ุฏูู ุงูุฎูููุฉ ุฅูู ุฏูู ูุงุฌูุฉ ุงููุณุชุฎุฏู.  ููุนุงูุฌุฉ ูุฐุง ุงูุณููู ูู ุฃููุงุน ุงูููุงู ูุงูููุงู ุ ูุชู ุฅูุดุงุก ุฃุณููุจ ConfigureAwait.  ููุจู ูุฐุง ุงูุฃุณููุจ ุงููุนููุฉ ContinueOnCapturedContext ูููุน ููุทูู ูุชุญูู ูู ุงูุชูุธูู.  ุฅุฐุง ูุงู ูุฐุง ุตุญูุญูุง (ุงูุงูุชุฑุงุถู) ุ ูุงูุชุธุฑ ุชููุงุฆููุง ุฅุฑุฌุงุน ุงูุชุญูู ุฅูู SynchronizationContext ุงูููุชูุทุฉ.  ุฅุฐุง ุชู ุงุณุชุฎุฏุงู false ุ ูุณูุชู ุชุฌุงูู ุณูุงู ุงูุชุฒุงูู ุ ูุณุชุณุชูุฑ ุงูุจูุฆุฉ ูู ุชูููุฐ ุงูุนูููุฉ ุบูุฑ ุงููุชุฒุงููุฉ ูู ุณูุณูุฉ ุงูุนูููุงุช ุญูุซ ุชูุช ููุงุทุนุฉ ุฐูู.  ุณูุคุฏู ุชุทุจูู ูุฐุง ุงูููุทู ุฅูู ุฅุตุฏุงุฑ ูุณุฎุฉ ุฃูุซุฑ ููุงุกุฉ ูู ุฑูุฒ ุงููุณุฎ ุจูู ุณูุงุณู ุงูุฑุณุงุฆู: <br></p><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">byte [] buffer = new byte[0x1000]; int numRead; while((numRead = await source.ReadAsync(buffer, 0, buffer.Length).ConfigureAwait(false)) &gt; 0) { await source.WriteAsync(buffer, 0, numRead).ConfigureAwait(false); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุทูุฑู ุงูููุชุจุงุช ุ ูุซู ูุฐุง ุงูุชุณุงุฑุน ูู ุญุฏ ุฐุงุชู ูููู ููุชูููุฑ ุฏุงุฆููุง ูู ุงุณุชุฎุฏุงู ConfigureAwait ุ ุจุงุณุชุซูุงุก ุงูุญุงูุงุช ุงููุงุฏุฑุฉ ุงูุชู ุชุนุฑู ูููุง ุงูููุชุจุฉ ูุง ูููู ุนู ููุช ุงูุชุดุบูู ูุณุชุญุชุงุฌ ุฅูู ุชูููุฐ ุงูุทุฑููุฉ ูุน ุงููุตูู ุฅูู ุงูุณูุงู ุงูุตุญูุญ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ุงูุฃุฏุงุก ุ ููุงู ุณุจุจ ุขุฎุฑ ุชุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงู ConfigureAwait ุนูุฏ ุชุทููุฑ ุงูููุชุจุงุช.  ุชุฎูู ุฃู ุฃุณููุจ CopyStreamToStreamAsync ุงููุทุจู ูุน ุฅุตุฏุงุฑ ุงูููุฏ ุจุฏูู ConfigureAwait ูุณูู ูู ุฏูู UI ูู WPF ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">private void button1_Click(object sender, EventArgs args) { Stream src = โฆ, dst = โฆ; Task t = CopyStreamToStreamAsync(src, dst); t.Wait(); // deadlock! }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูุญุงูุฉ ุ ูุงู ุนูู ุงููุจุฑูุฌ ุฃู ููุชุจ button1_Click ูุทุฑููุฉ ุบูุฑ ูุชุฒุงููุฉ ูุชููุน ูู ุฎูุงููุง ุฃู ููุชุธุฑ ูุดุบู ุงูุงูุชุธุงุฑ ุชูููุฐ ุงููููุฉ ุ ููุง ูุณุชุฎุฏู ุทุฑููุฉ ุงูุงูุชุธุงุฑ ุงููุชุฒุงูู ููุฐุง ุงููุงุฆู.  ูุฌุจ ุงุณุชุฎุฏุงู ุทุฑููุฉ ุงูุงูุชุธุงุฑ ูู ุงูุนุฏูุฏ ูู ุงูุญุงูุงุช ุงูุฃุฎุฑู ุ ูููู ุณูููู ูู ุงูุฎุทุฃ ุฏุงุฆููุง ุงุณุชุฎุฏุงููุง ูู ุงูุงูุชุธุงุฑ ูู ุฏูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ุ ููุง ูู ููุถุญ ููุง.  ูู ุชุฑุฌุน ุทุฑููุฉ ุงูุงูุชุธุงุฑ ุญุชู ุชูุชูู ุงููููุฉ.  ูู ุญุงูุฉ CopyStreamToStreamAsync ุ ูุญุงูู ุฏููู ุบูุฑ ุงููุชุฒุงูู ุฅุฑุฌุงุน ุงูุชูููุฐ ูุน ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู SynchronizationContext ุ ููุง ูููู ุฅููุงูู ุญุชู ุชูุชูู ุนูููุงุช ุงูููู ูุฐู (ูุฃููุง ุถุฑูุฑูุฉ ูููุงุตูุฉ ุชุดุบูููุง).  ููู ูุฐู ุงูุฅุฑุณุงููุงุช ุ ุจุฏูุฑูุง ุ ูุง ูููู ุชูููุฐูุง ุ ูุฃู ูุคุดุฑ ุชุฑุงุจุท ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูุฐู ูุฌุจ ูุนุงูุฌุชูุง ูุญุธูุฑ ุจูุงุณุทุฉ ููุงููุฉ ุงูุงูุชุธุงุฑ.  ูุฐุง ุชุจุนูุฉ ุฏูุฑูุฉ ุชุคุฏู ุฅูู ุทุฑูู ูุณุฏูุฏ.  ุฅุฐุง ุชู ุชุทุจูู CopyStreamToStreamAsync ุจุงุณุชุฎุฏุงู ConfigureAwait (false) ุ ููู ูููู ููุงู ุชุจุนูุฉ ุฃู ุญุธุฑ. </p><br><p style=";text-align:right;direction:rtl">  <strong>ExecutionContext</strong> ExecutionContext ูู ุฌุฒุก ููู ูู .NET Framework ุ ูููู ูุง ูุฒุงู ูุนุธู ุงููุจุฑูุฌูู ุบูุฑ ูุฏุฑููู ููุฌูุฏู. ExecutionContext โ  ,        SecurityContext  LogicalCallContext,   ,         .  ,    ThreadPool.QueueUserWorkItem, Task.Run, Delegate.BeginInvoke, Stream.BeginRead, WebClient.DownloadStringAsync      Framework,    ExecutionContext   ExecutionContext.Run ( ). ,  ,  ThreadPool.QueueUserWorkItem,  Windows  (identity),           WaitCallback.   ,   Task.Run    LogicalCallContext,         LogicalCallContext    Action. ExecutionContext     . </p><br><p style=";text-align:right;direction:rtl">  Framework    ,          ExecutionContext,     ,      .     Windows      LogicalCallContext     .     (WindowsIdentity.Impersonate  CallContext.LogicalSetData)               . </p><br><h4 id="osvobodites-ot-sborki-musora" style=";text-align:right;direction:rtl">     </h4><br><p style=";text-align:right;direction:rtl">        .    C#  Visual Basic     ,        .          await.  ,      ,    -   .   C#  Visual Basic  (ยซยป)      ,     await  (boxed)  ,     . </p><br><p style=";text-align:right;direction:rtl">                  .   ,     . ,       ,     ,     . </p><br><p style=";text-align:right;direction:rtl">       C#  Visual Basic      ,      . ,     </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public static async Task FooAsync() { var dto = DateTimeOffset.Now; var dt = dto.DateTime; await Task.Yield(); Console.WriteLine(dt); }</code> </pre> <br><p style=";text-align:right;direction:rtl">    dto      await,     .    ,  , -    dto: </p><br><p style=";text-align:right;direction:rtl"> <strong>Figure 4</strong>    </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[StructLayout(LayoutKind.Sequential), CompilerGenerated] private struct &lt;FooAsync&gt;d__0 : &lt;&gt;t__IStateMachine { private int &lt;&gt;1__state; public AsyncTaskMethodBuilder &lt;&gt;t__builder; public Action &lt;&gt;t__MoveNextDelegate; public DateTimeOffset &lt;dto&gt;5__1; public DateTime &lt;dt&gt;5__2; private object &lt;&gt;t__stack; private object &lt;&gt;t__awaiter; public void MoveNext(); [DebuggerHidden] public void &lt;&gt;t__SetMoveNextDelegate(Action param0); }</code> </pre> <br><p style=";text-align:right;direction:rtl">         ,     .   ,     ,  , ,        .       ,        : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public static async Task FooAsync() { var dt = DateTimeOffset.Now.DateTime; await Task.Yield(); Console.WriteLine(dt); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ,   .NET (GC)    ,  ,      ,  :      0,  ,    ,     (.NET GC    0, 1  2).      ,    GC        .     ,  ,   ,    ,     ,     ,   .     0,   ,    ,   .   ,     ,         ,    . </p><br><p style=";text-align:right;direction:rtl">                (        ,       ).    JIT   ,        ,               ,        ,      .          ,    ,        .   ,      ,  ,     ,     .   ,          ,     .  ,  C#  Visual Basic        ,       ,     . </p><br><h4 id="izbegayte-slozhnosti" style=";text-align:right;direction:rtl">   </h4><br><p style=";text-align:right;direction:rtl">  C#  Visual Basic  ,       awaits:  .   await      ,     Task  ,       ,  . ,   ,      : <br></p><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public static async Task&lt;int&gt; SumAsync(Task&lt;int&gt; a, Task&lt;int&gt; b, Task&lt;int&gt; c) { return Sum(await a, await b, await c); } private static int Sum(int a, int b, int c) { return a + b + c; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  C#     โawait bโ    Sum.      await,       Sum,  -       async ,   ยซยป     await.    ,       await       .   ,  ,       CLR,    ,      ,       .         ,                 &lt;&gt;t__stack.         ,   ,   Tuple&lt;int, int&gt;             &lt;&gt;__stack.  ,     ,    ,          . ,    SumAsync : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public static async Task&lt;int&gt; SumAsync(Task&lt;int&gt; a, Task&lt;int&gt; b, Task&lt;int&gt; c) { int ra = await a; int rb = await b; int rc = await c; return Sum(ra, rb, rc); }</code> </pre> <br><p style=";text-align:right;direction:rtl">            ,   ra, rb  rc,    .  ,    :                   .          ,           ,        ,    .  ,           ,    ,       ,          . </p><br><p style=";text-align:right;direction:rtl"> ,        ,        .      Sum   ,    await   ,       .     ,    await   ,  .      await  ,      Task.WhenAll: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public static async Task&lt;int&gt; SumAsync(Task&lt;int&gt; a, Task&lt;int&gt; b, Task&lt;int&gt; c) { int [] results = await Task.WhenAll(a, b, c); return Sum(results[0], results[1], results[2]); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  Task.WhenAll  Task&lt;TResult[]&gt;,    ,       ,     ,       .           .     ,         WhenAll,    Task  Task.        ,          ,    ,   ,   ,    WhenAll ,    .         WhenAll,     , ,   params,       .    ,  ,         .   Figure 5 <br></p><p style=";text-align:right;direction:rtl"> <strong>Figure 5</strong>     </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">public static Task&lt;int&gt; SumAsync(Task&lt;int&gt; a, Task&lt;int&gt; b, Task&lt;int&gt; c) { return (a.Status == TaskStatus.RanToCompletion &amp;&amp; b.Status == TaskStatus.RanToCompletion &amp;&amp; c.Status == TaskStatus.RanToCompletion) ? Task.FromResult(Sum(a.Result, b.Result, c.Result)) : SumAsyncInternal(a, b, c); } private static async Task&lt;int&gt; SumAsyncInternal(Task&lt;int&gt; a, Task&lt;int&gt; b, Task&lt;int&gt; c) { await Task.WhenAll((Task)a, b, c).ConfigureAwait(false); return Sum(a.Result, b.Result, c.Result); }</code> </pre> <br><h4 id="asinhronnost-i-proizvoditelnost" style=";text-align:right;direction:rtl">    </h4><br><p style=";text-align:right;direction:rtl">      ,           .  ,         .            ,            . ,      ,     :      ,      ,      /          ,       .     .NET Framework              ,       .   ,       .NET Framework,     .  ,  ,       Framework,   ,     ,  . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar458332/">https://habr.com/ru/post/ar458332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar458312/index.html">ุฃูุงุฏูููุฉ ุฃูุฏุฑููุฏ ูู ููุณูู: ุฏูุฑุฉ ูุชูุฏูุฉ</a></li>
<li><a href="../ar458316/index.html">Yandex Retro Games Battle 2019 - ุชุทููุฑ ุงูุฃูุนุงุจ ูู ZX Spectrum</a></li>
<li><a href="../ar458324/index.html">ูู ูุง ุชุญุชุงุฌู ูุจุฏุก ุงุณุชุฎุฏุงู Vue.js</a></li>
<li><a href="../ar458328/index.html">ููููุฉ ุชูุฑุงุฑ ุงูุฃูุฏุงู ูู Yandex.Metrica ูู ุชุญูููุงุช ุฌูุฌู</a></li>
<li><a href="../ar458330/index.html">ูุง ููุฌุฏ ุญุฏ ููููุงู: ููู ุชุณุงุนุฏ ุงููุตูุงุช ุงูุนุตุจูุฉ ุงูุจุดุฑูุฉ</a></li>
<li><a href="../ar458334/index.html">ุงููุณุฎ ุงููุชูุงุซู ุงููุณุชูุฑ ูู ุงููุฏูู ุฅูู ุงูุฌุฏูุฏ PostgreSQL ูุน Slony</a></li>
<li><a href="../ar458336/index.html">ุงูุฏูุฑุฉ ุงููุงููุฉ ูุชุทููุฑ ููุชุฌุงุช ุชูููููุฌูุง ุงููุนูููุงุช ุจุงุณุชุฎุฏุงู ูุซุงู ุงููุดุฑูุน: ุฃุฏูุงุฑ ุงููุฑูู ุ ูููุงู ุงูุนููุงุก ุ ูุงููุฑุงุญู</a></li>
<li><a href="../ar458338/index.html">ูุฏูุฑ ุชุทุจูู ุงูุฃูู. ุงููุทูุฑ ุฃู ุงูุฃููุ</a></li>
<li><a href="../ar458342/index.html">ุงูุชุฑููุจ ุ ุฃู ูุง ุชุญุชุงุฌ ุฅูู ูุนุฑูุชู ูุชุตุจุญ ููุงู ุงูุณุทุญ. ุงูุฌุฒุก 1. ุจูุณู</a></li>
<li><a href="../ar458344/index.html">ุงุณุชุฎุฏุงู ุงููุฑุงุณูุฉ ุบูุฑ ุงููุชุฒุงููุฉ ูุชุญุณูู ุงูุชููุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>