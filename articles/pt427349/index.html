<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§§ üí≠ üí™ Programador para a nova fam√≠lia tinyAVR baseada no conversor chin√™s CH340 barato ü§¥üèº üôãüèΩ üï∞Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A UPDI (Unified Program and Debug Interface) √© uma interface de um fio para programar / depurar os novos microcontroladores Atmel de 8 bits, substitui...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Programador para a nova fam√≠lia tinyAVR baseada no conversor chin√™s CH340 barato</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427349/">  <b>A UPDI (Unified Program and Debug Interface)</b> √© uma interface de um fio para programar / depurar os novos microcontroladores Atmel de 8 bits, substituindo a interface PDI de dois fios usada para programar os microcontroladores AVR XMEGA. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x1/v9/de/x1v9denhm5w_uof2zxytpawurka.png" alt="imagem"></div><a name="habracut"></a><br>  Assim, chegou o regimento de protocolos de Atmelovsk - ISP, JTAG, debugWIRE, TPI, aWire, PDI, agora aqui √© UPDI.  Ao mesmo tempo, a situa√ß√£o do ecossistema no AVR ainda √© muito desesperadora, ent√£o abandonar√≠amos completamente o uso deles, mas a √∫ltima tend√™ncia nos agradou um pouco, portanto, este artigo foi escrito. <br><br>  Somente os sortudos propriet√°rios do programador Atmel ICE podem usar o protocolo UPDI, que n√£o √© muito conveniente de usar devido √† escolha um tanto estranha do conector, e n√£o √© t√£o barato compr√°-lo em escala industrial.  Al√©m disso, requer a instala√ß√£o do Atmel Studio, que periodicamente se recusa a trabalhar com ele, porque, de acordo com a pol√≠tica de nossa empresa, a maioria dos computadores n√£o tem acesso √† Internet, e o est√∫dio o rastreia periodicamente para drivers ou para algumas bibliotecas, como resultado. momentos em que o programador estava vis√≠vel no sistema, ou seja, os drivers foram instalados corretamente, mas ele n√£o foi notado pelo pr√≥prio est√∫dio at√© obter acesso √† rede e n√£o ser atualizado √† for√ßa. <br><br>  Portanto, imediatamente depois que come√ßamos a usar o novo e bastante conveniente microcontrolador ATTiny1616 em nossos desenvolvimentos (sobre suas vantagens posteriormente), havia a necessidade de uma ferramenta que pud√©ssemos usar para gravar no controlador do gerenciador de inicializa√ß√£o em produ√ß√£o.  Claro, sem <s>SMS e registro de</s> acesso √† Internet. <br><br>  Ap√≥s algumas pesquisas, encontrei o projeto pyupdi no <b>Github</b> (https://github.com/mraardvark/pyupdi) - uma implementa√ß√£o do protocolo UPDI em Python, e essa implementa√ß√£o √© baseada no protocolo UART usual, exceto sem conversores de n√≠vel que, de fato, ainda mais conveniente, pois permite o uso de chips conversores FTDI padr√£o ou de seus equivalentes chineses CH340 / 341. <br><br>  O projeto foi baixado e testado, as coisas sa√≠ram bastante alegres.  Mas depois de alguns dias, ficou claro que ele ainda n√£o nos convinha.  Raz√µes: <br><br><ul><li>  Se for necess√°rio instalar o Python e um grupo inteiro de pacotes (lembro que estamos falando de computadores sem acesso √† Internet), tive que baixar e instalar manualmente quase uma d√∫zia de pacotes diferentes que dependiam um do outro.  Sim, em princ√≠pio, voc√™ pode criar um arquivo execut√°vel em outro computador a partir de um script Python, isso resolveu o problema, mas a lista de problemas n√£o terminou a√≠ </li><li>  quase n√£o h√° verifica√ß√£o de erro no script, qualquer erro termina com uma interrup√ß√£o indicando um monte de arquivos vinculados entre si, o que para a equipe comum n√£o parece muito claro </li><li>  √© imposs√≠vel ler o conte√∫do da mem√≥ria do controlador, o que impossibilita o teste final do processo de grava√ß√£o </li><li>  nenhuma maneira de ler fus√≠vel </li><li>  a velocidade do script deixa muito a desejar, 16 kb s√£o escritos por quase um minuto, devido √† aus√™ncia de otimiza√ß√£o durante a transfer√™ncia, tudo √© baseado em tempos apertados </li><li>  falta de indica√ß√£o do processo de grava√ß√£o </li><li>  o projeto n√£o suporta v√°rios processadores que poderiam suportar </li><li>  o projeto est√° meio morto e n√£o responde a solicita√ß√µes </li></ul><br>  Os problemas foram resolvidos por algum tempo dentro da estrutura do Python, mas ap√≥s qualquer corre√ß√£o, tive que remontar o projeto, testar, para que houvesse o desejo de reescrever o script em algo mais familiar e r√°pido, ou seja, em C.  Afinal, somos embedders! <br><br>  Agora, brevemente, sobre as vantagens da nova s√©rie tinyAVR 1: <br><br><ul><li>  unifica√ß√£o real de perif√©ricos e espa√ßo de endere√ßo entre 2 e 32 kb </li><li>  configura√ß√£o conveniente do gerenciador de inicializa√ß√£o (no in√≠cio da mem√≥ria!) </li><li>  simplifica√ß√£o significativa do algoritmo ISP (In-System-Programming) </li><li>  transi√ß√£o para a arquitetura von Neumann </li><li>  mem√≥ria flash de at√© 32 kb em um pacote pequeno (3x3 mm) com 24 pinos, dos quais at√© 22 (!) podem ser usados ‚Äã‚Äãcomo IO </li><li>  a presen√ßa de um oscilador interno a 16/20 MHz </li><li>  menor depend√™ncia de desempenho na configura√ß√£o de fus√≠veis (AVR perp√©tuo para dor de cabe√ßa) </li><li>  excelente parte anal√≥gica para um pequeno controlador (ADC / DAC / comparadores com a possibilidade de comuta√ß√£o interna e externa de entradas / sa√≠das) </li><li>  programa√ß√£o e depura√ß√£o de fio √∫nico </li><li>  pre√ßo de varejo extremamente baixo (de 0,6 ‚Ç¨ por 16 kb) </li></ul><br>  Como parte importante do programador, pegamos o conversor USB-UART TTL dispon√≠vel com base no chip chin√™s CH340, assim: <br><br><img src="https://habrastorage.org/webt/7m/am/in/7maminco5c_go8a5flcqu8ymqwu.png" alt="imagem"><br><br>  Para a programa√ß√£o, basta conectar as duas sa√≠das RX e TX, j√° que elas j√° est√£o equipadas com um resistor de sa√≠da de 1,5k, se n√£o houver resistor no modelo do seu conversor, ser√° necess√°rio adicion√°-lo.  A sa√≠da combinada √© conectada ao pino UPDI em um chip program√°vel; o aterramento do conversor tamb√©m deve ser conectado ao aterramento do controlador.  Se voc√™ tiver energia externa, preste aten√ß√£o apenas se corresponde √† energia que o conversor usa (3,3V ou 5V).  Se houver necessidade, voc√™ pode alimentar o circuito com o controlador e com o pr√≥prio conversor, o que pode ser muito conveniente para a programa√ß√£o inicial. <br><br><img src="https://habrastorage.org/webt/er/bn/i0/erbni00rpywptgdcpytjrovbf90.png" alt="imagem"><br><br>  <b>Aten√ß√£o!</b>  O resistor √© opcional, ele precisa ser soldado apenas se o seu conversor n√£o tiver resistores de prote√ß√£o na sa√≠da. <br><br>  O √∫nico problema associado ao chip CH340 √© que ele n√£o funcionou na minha vers√£o Linux do programa, porque o bit de paridade √© usado no protocolo de programa√ß√£o e o driver CH340 na vers√£o do kernel n√£o funciona corretamente com esse bit.  Talvez o problema seja resolvido em um futuro pr√≥ximo, at√© agora n√£o tive paci√™ncia para fazer isso. <br><br>  Como resultado de trabalho e experimentos, o programa <b>updiprog</b> foi gravado e depurado no IDE Code :: Blocks, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cujos c√≥digos-fonte foram postados no Github</a> . <br><br>  O que foi implementado nesta vers√£o do programa: <br><br><ul><li>  Adicionada a capacidade de ler o conte√∫do da mem√≥ria flash do controlador em um arquivo hexadecimal </li><li>  Capacidade adicional de ler o status de todos os fus√≠veis do controlador </li><li>  sempre que poss√≠vel, adicionado tratamento de erros com mensagens correspondentes </li><li>  indica√ß√£o adicional do processo de escrita / leitura </li><li>  velocidade significativamente aumentada (cerca de 6 segundos para ler 16 kb) </li><li>  Adicionado suporte para todos os microcontroladores da s√©rie 1 </li></ul><br>  O tamanho inicial do programa √© de cerca de 25 kb, comparado com 5 kopecks para o script Python de origem compilado. <br><br>  Espero que o trabalho realizado seja √∫til para algu√©m.  Eu ficaria feliz em coment√°rios e sugest√µes. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt427349/">https://habr.com/ru/post/pt427349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt427339/index.html">Por que o teorema da incompletude de G√∂del √© dif√≠cil de provar: o assunto est√° nas formula√ß√µes, e n√£o apenas na ess√™ncia</a></li>
<li><a href="../pt427341/index.html">Aprenda a agradecer: √© o melhor que voc√™ pode dar aos outros e a melhor maneira de desenvolver "conex√µes sociais √∫teis"</a></li>
<li><a href="../pt427343/index.html">VK Mobile Challenge 2018</a></li>
<li><a href="../pt427345/index.html">Problemas da escrita moderna de textos matem√°ticos</a></li>
<li><a href="../pt427347/index.html">Migrando para o Google Cloud Platform (Google Cloud Platform - GCP)</a></li>
<li><a href="../pt427351/index.html">Semana 40 de seguran√ßa: Vulnerabilidades no CMS Drupal e mais</a></li>
<li><a href="../pt427353/index.html">Drones mostram: como coordenamos um enxame de helic√≥pteros dan√ßantes</a></li>
<li><a href="../pt427355/index.html">Compila√ß√£o CJM, principais habilidades do diretor de arte e compreens√£o do usu√°rio</a></li>
<li><a href="../pt427357/index.html">Escrevendo shaders no Unity. GrabPass, PerRendererData</a></li>
<li><a href="../pt427359/index.html">Como ECS, C # Job System e SRP alteram a arquitetura</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>