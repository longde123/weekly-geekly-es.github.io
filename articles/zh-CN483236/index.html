<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚸 🍚 👩🏽‍🔬 虚拟化的魔力：Proxmox VE入门课程 🖕🏿 🔸 🖕🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今天，我们将讨论如何在一个物理服务器上快速而简单地部署具有不同操作系统的多个虚拟服务器。 这将使任何系统管理员都可以集中管理公司的整个IT基础架构，并节省大量资源。 使用虚拟化有助于从物理服务器设备中尽可能多地抽象出来，保护关键服务，即使在发生严重故障时也可以轻松地恢复其工作。 

 毫无疑问，大多...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>虚拟化的魔力：Proxmox VE入门课程</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/483236/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/m1/lf/fe/m1lffehgq2u1iu5ivku1nqh-ktk.png"></div><br> 今天，我们将讨论如何在一个物理服务器上快速而简单地部署具有不同操作系统的多个虚拟服务器。 这将使任何系统管理员都可以集中管理公司的整个IT基础架构，并节省大量资源。 使用虚拟化有助于从物理服务器设备中尽可能多地抽象出来，保护关键服务，即使在发生严重故障时也可以轻松地恢复其工作。 <br><br> 毫无疑问，大多数系统管理员都熟悉使用虚拟环境的方法，对他们而言，本文并不是一个发现。 尽管如此，由于缺乏有关虚拟解决方案的准确信息，仍有一些公司没有使用虚拟解决方案的灵活性和速度。 我们希望我们的文章将通过示例帮助您理解，一次开始使用虚拟化要比体验物理基础架构的不便和缺点容易得多。 <br><a name="habracut"></a><br> 幸运的是，尝试虚拟化的工作原理非常简单。 我们将展示如何在虚拟环境中创建服务器，例如，转移公司使用的CRM系统。 几乎任何物理服务器都可以变成虚拟服务器，但是首先您需要掌握基本的工作方法。 这将在下面讨论。 <br><br><h2> 如何运作 </h2><br> 当涉及虚拟化时，许多新手专家很难理解术语，因此我们将解释一些基本概念： <br><br><ul><li>  <b>系统管理程序</b> -专用软件，可让您创建和管理虚拟机； </li><li>  <b>虚拟机</b> （以下称为VM）是一种系统，它是物理服务器内部的逻辑服务器，具有自己的特性，驱动器和操作系统。 </li><li>  <b>虚拟化主机</b>是一台运行管理程序的物理服务器。 </li></ul><br> 为了使服务器充当完整的虚拟化主机，其处理器必须支持以下两种技术之一：Intel®VT或AMD-V™。 两种技术都执行最重要的任务-为虚拟机提供服务器硬件资源。 <br><br> 关键功能是任何虚拟机操作都直接在硬件级别执行。 而且，它们彼此隔离，这很容易单独管理。 虚拟机管理程序本身扮演着控制机构的角色，在它们之间分配资源，角色和优先级。 系统管理程序还模拟了操作系统正确运行所必需的硬件部分。 <br><br> 虚拟化的实施使一台服务器可以具有多个运行副本。 对此类副本进行更改的过程中出现严重故障或错误，不会影响当前服务或应用程序的运行。 同时，还解决了两个主要问题-缩放和将不同操作系统的“ zoo”保留在同一设备上的能力。 这是合并各种服务的理想机会，而无需为每个服务购买单独的设备。 <br><br> 虚拟化可增强服务和已部署应用程序的弹性。 即使物理服务器发生故障并需要用另一台物理服务器替换，只要保留存储介质，整个虚拟基础架构将保持完全运行。 在这种情况下，物理服务器可能完全是另一个制造商的。 对于使用已经停产并且需要切换到其他型号的服务器的公司而言，尤其如此。 <br><br> 现在我们列出当今最流行的虚拟机管理程序： <br><br><ul><li>  VMware ESXi的 </li><li>  Microsoft Hyper-V </li><li> 开放虚拟化联盟KVM </li><li>  Oracle VM VirtualBox </li></ul><br> 它们都是相当通用的，但是，它们每个都具有某些功能，在选择阶段应始终予以考虑：部署/维护成本和技术规格。  VMware和Hyper-V的商业许可证非常昂贵，如果出现故障，很难自行解决这些系统的问题。 <br><br> 另一方面，KVM完全免费且易于使用，尤其是作为基于Debian Linux的解决方案Proxmox Virtual Environment的一部分时。 我们可以向初次接触虚拟基础架构的人推荐该系统。 <br><br><h2> 如何快速部署Proxmox VE虚拟机管理程序 </h2><br> 安装通常不会引起任何问题。  <a href="https://www.proxmox.com/en/downloads/category/iso-images-pve">从官方站点</a>下载映像的当前版本，并使用<a href="https://sourceforge.net/projects/win32diskimager/">Win32DiskImager</a>实用程序（在Linux中使用dd命令）将其写入任何外部介质，然后直接从该介质加载服务器。 从我们那里租用专用服务器的客户可以使用两种甚至更简单的方法-只需直接从KVM控制台挂载所需的映像，或使用<a href="https://kb.selectel.ru/27821594.html">我们的PXE服务器</a> 。 <br><br> 安装程序具有图形界面，只会询问几个问题。 <br><br><ol><li> 选择将在其上执行安装的磁盘。 在“ <b>选项”</b>部分中，您还可以设置其他标记选项。 <br><br><img src="https://habrastorage.org/webt/fu/vp/9c/fuvp9cnlk_uvab0f6aolqkkan8k.png"></li><li> 指定区域设置。 <br><br><img src="https://habrastorage.org/webt/2b/f4/7m/2bf47mbfxronbczbgvvhkzjapos.png"></li><li> 指定将用于授权根超级用户和管理员的电子邮件地址的密码。 <br><br><img src="https://habrastorage.org/webt/zv/so/0_/zvso0_gcmdnpwllpdv1pin2cllc.png"></li><li> 指定网络设置。  FQDN代表完全限定的域名，例如<b>node01.yourcompany.com</b> 。 <br><br><img src="https://habrastorage.org/webt/dz/qr/rp/dzqrrprwwr1_w4e7q4zd33rkczi.png"></li><li> 安装完成后，可以使用“重新启动”按钮发送服务器以重新启动。 <br><br><img src="https://habrastorage.org/webt/uw/km/n2/uwkmn2yotd1owpja0jpfr4ihmsk.png"><br><br> 基于Web的管理界面将在以下位置提供 <br><br><pre><code class="bash hljs">https://IP__:8006</code> </pre> </li></ol><br><h2> 安装后该怎么办 </h2><br> 安装Proxmox之后，有几件事要做。 让我们更详细地讨论它们中的每一个。 <br><br><h3> 将系统更新到当前版本 </h3><br> 为此，请转到我们服务器的控制台并禁用付费存储库（仅适用于购买付费支持的用户）。 如果不这样做，则apt将在更新软件包源时报告错误。 <br><br><ol><li> 打开控制台并编辑apt配置文件： <br><br><pre> <code class="bash hljs">nano /etc/apt/sources.list.d/pve-enterprise.list</code> </pre> </li><li> 该文件中只有一行。 我们在其前面放置<b>＃号</b>以禁用从付费存储库接收更新： <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#deb https://enterprise.proxmox.com/debian/pve stretch pve-enterprise</span></span></code> </pre> </li><li> 使用键盘快捷键<b>Ctrl + X，</b>我们退出编辑器，对系统有关保存文件的问题回答<b>Y。</b> </li><li> 我们执行以下命令来更新软件包源和更新系统： <br><br><pre> <code class="bash hljs">apt update &amp;&amp; apt -y upgrade</code> </pre> </li></ol><br><h3> 注意安全 </h3><br> 我们建议您安装最受欢迎的实用程序<b>Fail2Ban</b> ，该实用程序可以防止受到密码暴力破解（蛮力攻击）的攻击。 其操作原理是，如果攻击者在指定时间内使用错误的用户名/密码超过了一定次数的登录尝试，则其IP地址将被阻止。 可以在配置文件中指定阻止时间和尝试次数。 <br><blockquote> 根据实际经验，在运行具有开放ssh端口22和外部静态IPv4地址的服务器的一周中，进行了超过5000次尝试查找密码的尝试。 约有1500个地址成功实用程序被阻止。 </blockquote> 为了完成安装，我们给出了一个简短的说明： <br><br><ol><li> 我们通过Web界面或SSH打开服务器控制台。 </li><li> 更新软件包来源： <br><br><pre> <code class="bash hljs">apt update</code> </pre> </li><li> 安装Fail2Ban： <br><br><pre> <code class="bash hljs">apt install fail2ban</code> </pre> </li><li> 打开配置实用程序进行编辑： <br><br><pre> <code class="bash hljs">nano /etc/fail2ban/jail.conf</code> </pre> </li><li> 我们更改每个服务的<b>bantime</b>变量（将阻止攻击者的秒数）和<b>maxretry</b> （尝试登录/密码的次数）。 </li><li> 使用键盘快捷键<b>Ctrl + X，</b>我们退出编辑器，对系统有关保存文件的问题回答<b>Y。</b> </li><li> 重新启动服务： <br><br><pre> <code class="bash hljs">systemctl restart fail2ban</code> </pre> </li></ol><br> 您可以检查该实用程序的状态，例如，使用一个简单的命令来删除尝试从中搜索SSH密码的被阻止IP地址的统计信息： <br><br><pre> <code class="bash hljs">fail2ban-client -v status sshd</code> </pre> <br> 实用程序响应将如下所示： <br><br><pre> <code class="plaintext hljs">root@hypervisor:~# fail2ban-client -v status sshd INFO Loading configs for fail2ban under /etc/fail2ban INFO Loading files: ['/etc/fail2ban/fail2ban.conf'] INFO Loading files: ['/etc/fail2ban/fail2ban.conf'] INFO Using socket file /var/run/fail2ban/fail2ban.sock Status for the jail: sshd |- Filter | |- Currently failed: 3 | |- Total failed: 4249 | `- File list: /var/log/auth.log `- Actions |- Currently banned: 0 |- Total banned: 410 `- Banned IP list:</code> </pre> <br> 以类似的方式，您可以通过创建适当的规则来关闭Web界面以防止此类攻击。 可以在<a href="https://pve.proxmox.com/wiki/Fail2ban">官方指南中</a>找到有关Fail2Ban的此类规则的示例。 <br><br><h2> 开始使用 </h2><br> 我想提请大家注意，Proxmox准备在安装后立即创建新计算机。 但是，我们建议您进行初步设置，以便将来可以轻松控制系统。 实践表明，虚拟机管理程序和虚拟机应划分为不同的物理介质。 关于如何执行此操作，将在下面进行讨论。 <br><br><h3> 配置磁盘驱动器 </h3><br> 下一步是配置存储，该存储可用于保存虚拟机数据和备份。 <br><blockquote>  <b>注意！</b>  <b>以下磁盘分区示例只能用于测试目的。</b>  <b>对于实际操作，我们强烈建议使用软件或硬件RAID阵列，以防止驱动器发生故障时数据丢失。</b>  <b>关于如何正确准备磁盘阵列以进行工作以及在紧急情况下如何采取行动，我们将在以下文章之一中进行介绍</b> </blockquote> 假设物理服务器有两个磁盘- <b>/ dev / sda</b> （安装了管理程序）和一个空<b>/ dev / sdb</b>磁盘，计划将其用于存储虚拟机数据。 为了使系统可以看到新的存储，可以使用最简单，最有效的方法-将其作为普通目录进行连接。 但在此之前，应执行一些准备工作。 作为示例，让我们看看如何通过将其格式化为<b>ext4</b>文件系统来连接任何大小的新驱动器<b>/ dev / sdb</b> 。 <br><br><ol><li> 我们标记磁盘，创建一个新分区： <br><br><pre> <code class="bash hljs">fdisk /dev/sdb</code> </pre> </li><li> 按<b>o</b>或<b>g</b> （在MBR或GPT中标记磁盘）。 </li><li> 接下来，按<b>n</b>键（创建一个新分区）。 </li><li> 最后是<b>w</b> （以保存更改）。 </li><li> 创建ext4文件系统： <br><br><pre> <code class="bash hljs">mkfs.ext4 /dev/sdb1</code> </pre> </li><li> 创建一个目录，我们将在其中挂载分区： <br><br><pre> <code class="bash hljs">mkdir /mnt/storage</code> </pre> </li><li> 打开配置文件进行编辑： <br><br><pre> <code class="bash hljs">nano /etc/fstab</code> </pre> </li><li> 在此处添加新行： <br><br><pre> <code class="bash hljs">/dev/sdb1 /mnt/storage ext4 defaults 0 0</code> </pre> </li><li> 进行更改后，请按<b>Ctrl + X进行</b>保存，然后在编辑器的问题上回答<b>Y。</b> </li><li> 要验证一切正常，请发送服务器以重新引导： <br><br><pre> <code class="bash hljs">shutdown -r now</code> </pre> </li><li> 重新启动后，我们检查已安装的分区： <br><br><pre> <code class="bash hljs">df -H</code> </pre> </li></ol><br> 命令的输出应显示<b>/ dev / sdb1已</b>安装在<b>/ mnt / storage</b>目录中。 这意味着我们的驱动器已准备就绪。 <br><br><h3> 向Proxmox添加新存储 </h3><br> 登录到控制面板，然后转到<b>数据中心</b> ➝ <b>存储</b> ➝ <b>添加</b> ➝ <b>目录</b> 。 <br><br> 在打开的窗口中，填写以下字段： <br><br><ul><li>  <b>ID-</b>将来的存储名称； </li><li>  <b>目录</b> -/ mnt /存储； </li><li>  <b>内容</b> -选择所有选项（逐个单击每个选项）。 <br><br><img src="https://habrastorage.org/webt/jq/z6/xr/jqz6xrfw-ruewv0nx1owtccvqck.png"></li></ul><br> 之后，单击<b>添加</b>按钮。 这样就完成了设置。 <br><br><h3> 创建虚拟机 </h3><br> 要创建虚拟机，请执行以下操作序列： <br><br><ol><li> 我们确定操作系统的版本。 </li><li> 预先下载ISO映像。 </li><li> 在<b>存储</b>菜单中，选择新创建的存储。 </li><li> 单击<b>内容</b> ➝ <b>下载</b> 。 </li><li> 从列表中选择一个ISO映像，然后单击“ <b>下载”</b>按钮确认选择。 </li></ol><br> 操作完成后，图像将显示在可用图像列表中。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pj/ig/rc/pjigrctmgj7nxfr0vp6kcme14ik.png"></div><br> 我们创建第一个虚拟机： <br><br><ol><li> 点击<b>创建虚拟机</b> 。 </li><li> 我们填写以下参数： <b>名称</b> ➝ISO <b>映像</b> ➝ <b>硬盘的大小和类型</b> ➝ <b>处理器数量</b> ➝RAM <b>大小</b> ➝ <b>网络适​​配器</b> 。 </li><li> 选择了所有需要的参数后，点击<b>Finish</b> 。 创建的机器将显示在控制面板菜单中。 </li><li> 选择它，然后单击<b>“运行”</b> 。 </li><li> 转到“ <b>控制台”</b>项，然后以与在常规物理服务器上相同的方式安装操作系统。 </li></ol><br> 如果需要创建另一台计算机，请重复上述操作。 它们准备就绪后，您可以同时使用它们，打开几个控制台窗口。 <br><br><h3> 配置自动运行 </h3><br> 默认情况下，Proxmox不会自动启动计算机，但是只需单击两次即可轻松解决： <br><br><ol><li> 我们单击所需汽车的名称。 </li><li> 选择选项卡<b>选项</b> ➝ <b>引导启动</b> 。 </li><li> 我们在同名题词前打勾。 </li></ol><br> 现在，如果物理服务器重新启动，则VM将自动启动。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j-/sm/os/j-smostpyifrmleudi_tf8bchhu.png"></div><br> 对于高级管理员，还有机会在“ <b>开始/关闭顺序”</b>部分中指定其他启动参数。 您可以明确指示应按哪些顺序启动计算机。 您还可以指定在启动下一个VM之前应该经过的时间以及关闭延迟时间（如果操作系统没有时间完成工作，系统管理程序将在一定秒数后强制关闭它）。 <br><br><h2> 结论 </h2><br> 本文概述了Proxmox VE入门的基础知识，我们希望它可以帮助新手专业人员迈出第一步，并尝试实施虚拟化。 <br><br> 对于任何系统管理员来说，Proxmox VE都是一个非常强大且便捷的工具。 最主要的是不要害怕尝试并了解其真正的工作原理。 <br><br> 如有任何疑问，欢迎发表评论。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483236/">https://habr.com/ru/post/zh-CN483236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483210/index.html">在家工作的主要弊端</a></li>
<li><a href="../zh-CN483218/index.html">10个迹象表明一个好的程序员不会让你失望</a></li>
<li><a href="../zh-CN483226/index.html">Apollo Flight Controller：所有控制台的详细说明</a></li>
<li><a href="../zh-CN483230/index.html">JH雨水“如何放牧猫”：不要，或指南中的负面模式</a></li>
<li><a href="../zh-CN483234/index.html">Node.JS与PHP：哪种是更好的编程语言？</a></li>
<li><a href="../zh-CN483238/index.html">我如何看待Okko Sport的潜水艇</a></li>
<li><a href="../zh-CN483242/index.html">使用TeamCity在Maven项目中实现自动化HotFix</a></li>
<li><a href="../zh-CN483244/index.html">如何通过老化机制选择生物技术股票</a></li>
<li><a href="../zh-CN483246/index.html">编程和圣诞树，可以结合使用吗？</a></li>
<li><a href="../zh-CN483252/index.html">从神经病学的角度看青少年的极大主义与青少年的矛盾精神</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>