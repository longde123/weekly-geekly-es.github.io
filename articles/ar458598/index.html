<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐พโ๐ค ๐ ๐คน๐ผ ุงูุชุนุฑู ุนูู ูุตุงุฏุฑ ุงูุถูุก ุนูู ุฎุฑุงุฆุท ุงูุจูุฆุฉ ๐ ๐น ๐คน๐พ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุชูุฏู ูุฐู ุงูููุงูุฉ ุชุทุจูู Python ููุฎูุงุฑุฒููุฉ ููุชุนุฑู ุนูู ูุตุงุฏุฑ ุงูุถูุก ุนูู ุฎุฑุงุฆุท ุงูุจูุฆุฉ (LDR ุฃู HDR) ุจุงุณุชุฎุฏุงู ุงูุฅุณูุงุท ุงููุชูุงุซู. ููุน ุฐูู ุ ุจุนุฏ ุฅุฌุฑุงุก ุชุบููุฑุงุช ุท...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุชุนุฑู ุนูู ูุตุงุฏุฑ ุงูุถูุก ุนูู ุฎุฑุงุฆุท ุงูุจูุฆุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458598/" style=";text-align:right;direction:rtl"><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a44/e48/451/a44e484510a596be61f83f9c303f25fc.png" alt="ุตูุฑุฉ"></div><br>  ุชูุฏู ูุฐู ุงูููุงูุฉ ุชุทุจูู Python ููุฎูุงุฑุฒููุฉ ููุชุนุฑู ุนูู ูุตุงุฏุฑ ุงูุถูุก ุนูู ุฎุฑุงุฆุท ุงูุจูุฆุฉ (LDR ุฃู HDR) ุจุงุณุชุฎุฏุงู ุงูุฅุณูุงุท ุงููุชูุงุซู.  ููุน ุฐูู ุ ุจุนุฏ ุฅุฌุฑุงุก ุชุบููุฑุงุช ุทูููุฉ ุ ูููู ุงุณุชุฎุฏุงูู ุฃูุถูุง ูุน ุตูุฑ ุฎูููุฉ ุจุณูุทุฉ ุฃู ุฎุฑุงุฆุท ููุนุจุฉ.  ุฃูุซูุฉ ุนูู ุงูุชุทุจูู ุงููุญุชูู ููุฎูุงุฑุฒููุฉ: ุจุฑุงูุฌ ุชุชุจุน ุงูุดุนุงุน ุงูุชู ูู ุงูุถุฑูุฑู ูููุง ุงูุชุนุฑู ุนูู ูุตุงุฏุฑ ุงูุถูุก ุงูุฃุณุงุณูุฉ ูู ุฃุฌู ุฅุตุฏุงุฑ ุฃุดุนุฉ ูููุง ุ  ูู ุนุงุฑุถ ุงูุจูุงูุงุช ุงููููุทุฉ ุ ูููู ุงุณุชุฎุฏุงูู ูุฅููุงุก ุงูุธูุงู ุจุงุณุชุฎุฏุงู ุฎุฑูุทุฉ ุจูุฆุฉ ุ  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููู ุฃูุถูุง ุงุณุชุฎุฏุงู ุงูุฎูุงุฑุฒููุฉ ูู ุจุฑุงูุฌ ุฅุฒุงูุฉ ุงูุฃุถูุงุก ุ ุนูู ุณุจูู ุงููุซุงู ูู AR. <br><br>  ุชุชููู ุงูุฎูุงุฑุฒููุฉ ูู ุงูุฎุทูุงุช ุงูุชุงููุฉ: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅููุงุต ุฏูุฉ ุงูุตูุฑุฉ ุงูุฃุตููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฅูู 1024. </li><li style=";text-align:right;direction:rtl">  ุชุญููู ุงูุตูุฑุฉ ุฅูู ุณุทูุน (ุงููุตูุน) ุ ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ูุน ุทูุณ ุงูุตูุฑุฉ. </li><li style=";text-align:right;direction:rtl">  ุชุทุจูู ุทุฑููุฉ ุดุจู ูููุช ูุงุฑูู. </li><li style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุงูุฅุญุฏุงุซูุงุช ุงููุฑููุฉ ุฅูู ุงูุฅุญุฏุงุซูุงุช ูุชุณุงููุฉ. </li><li style=";text-align:right;direction:rtl">  ุชุตููุฉ ุงูุนููุงุช ุจูุงุกู ุนูู ุณุทูุน ุฃุญุฏ ุงูุฌูุฑุงู. </li><li style=";text-align:right;direction:rtl">  ูุฑุฒ ุงูุนููุงุช ุจูุงุก ุนูู ุณุทูุนูุง. </li><li style=";text-align:right;direction:rtl">  ุชุตููุฉ ุงูุนููุงุช ุนูู ุฃุณุงุณ ูุชุฑู ุงูุฅูููุฏูุฉ. </li><li style=";text-align:right;direction:rtl">  ุฏูุฌ ุงูุนููุงุช ุจุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุฉ Bresenham. </li><li style=";text-align:right;direction:rtl">  ุญุณุงุจ ูููุน ูุฌููุนุฉ ุงูุฅุถุงุกุฉ ุนูู ุฃุณุงุณ ุณุทูุนูุง. </li></ol><br>  ููุงู ุงูุนุฏูุฏ ูู ุงูุฎูุงุฑุฒููุงุช ูุชูููู ุฏูุฉ ุงูุตูุฑ.  ุชุนุฏ ุชุตููุฉ Bilinear ูู ุงูุฃุณุฑุน ุฃู ุงูุฃุณูู ูู ุงูุชูููุฐ ุ ุฅูู ุฌุงูุจ ุฐูู ุ ุชููู ุงูุฃูุณุจ ูู ูุนุธู ุงูุญุงูุงุช.  ูุชุญููู ุงูุณุทูุน ูู ูู ูู ุตูุฑ LDR ู HDR ุ ููููู ุงุณุชุฎุฏุงู ุงูุตูุบุฉ ุงูููุงุณูุฉ: <br><br><pre style=";text-align:right;direction:rtl"><code class="python hljs">lum = img[:, :, <span class="hljs-number"><span class="hljs-number">0</span></span>] * <span class="hljs-number"><span class="hljs-number">0.2126</span></span> + img[:, :, <span class="hljs-number"><span class="hljs-number">1</span></span>] * <span class="hljs-number"><span class="hljs-number">0.7152</span></span> + img[:, :, <span class="hljs-number"><span class="hljs-number">2</span></span>] * <span class="hljs-number"><span class="hljs-number">0.0722</span></span></code> </pre> <br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููููู ุชุทุจูู ุชูููู ุจุณูุท ุนูู ุตูุฑุฉ ุงูุณุทูุน ุ ุนูู ุณุจูู ุงููุซุงู ุ 1-2 ุจูุณู ูุตูุฑุฉ ุจุฏูุฉ 1024 ุ ูุฅุฒุงูุฉ ุฌููุน ุชูุงุตูู ุงูุชุฑุฏุฏ ุงูุนุงูู (ุนูู ูุฌู ุงูุฎุตูุต ุ ุจุณุจุจ ุงูุฎูุงุถ ุงูุฏูุฉ). <br><a name="habracut"></a><br><h3 style=";text-align:right;direction:rtl">  ุงูุฅุณูุงุท ูุชุณุงููุฉ </h3><br>  ุงูุฅุณูุงุท ุงูุฃูุซุฑ ุดููุนูุง ูู ุฎุฑุงุฆุท ุงูุจูุฆุฉ ูู ุงูุฅุณูุงุท ุงููุชุณุงูู <sup>3</sup> .  ูููู ุฃู ุชุนูู ุงูุฎูุงุฑุฒููุฉ ุงูุฎุงุตุฉ ุจู ูุน ุงูุฅุณูุงุทุงุช ุงูุฃุฎุฑู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุน ุงูุฎุฑุงุฆุท ุงูุจุงููุฑุงููุฉ ูุงูููุนุจุงุช ุ ููุน ุฐูู ุ ูู ุงูููุงูุฉ ุณููุธุฑ ููุท ูู ุฅุณูุงุท ูุชุจุงุนุฏ ูุชุณุงููุฉ.  ุชุญุชุงุฌ ุฃููุงู ุฅูู ุชุทุจูุน ุฅุญุฏุงุซูุงุช ุงูุตูุฑุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = x / width pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = y / height</code> </pre> <br>  ุซู ูุญุชุงุฌ ุฅูู ุงูุชุญููู ูู ูุฅูู ุงูุฅุญุฏุงุซูุงุช ุงูุฏููุงุฑุชูุฉ ุจุงุณุชุฎุฏุงู ุงูุฅุญุฏุงุซูุงุช ุงููุฑููุฉ ุ ุฃู  ฮธ ู ฯ ุ ุญูุซ ฮธ = x * 2ฯ ุ ู ฯ = y * ฯ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sphereToEquirectangular</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pos)</span></span></span><span class="hljs-function">:</span></span> invAngles = (<span class="hljs-number"><span class="hljs-number">0.1591</span></span>, <span class="hljs-number"><span class="hljs-number">0.3183</span></span>) xy = (math.atan2(pos[<span class="hljs-number"><span class="hljs-number">1</span></span>], pos[<span class="hljs-number"><span class="hljs-number">0</span></span>]), math.asin(pos[<span class="hljs-number"><span class="hljs-number">2</span></span>])) xy = (xy[<span class="hljs-number"><span class="hljs-number">0</span></span>] * invAngles[<span class="hljs-number"><span class="hljs-number">0</span></span>], xy[<span class="hljs-number"><span class="hljs-number">1</span></span>] * invAngles[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (xy[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-number"><span class="hljs-number">0.5</span></span>, xy[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equirectangularToSphere</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pos)</span></span></span><span class="hljs-function">:</span></span> angles = (<span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-number"><span class="hljs-number">0.1591</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> / <span class="hljs-number"><span class="hljs-number">0.3183</span></span>) thetaPhi = (pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - <span class="hljs-number"><span class="hljs-number">0.5</span></span>, pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - <span class="hljs-number"><span class="hljs-number">0.5</span></span>) thetaPhi = (thetaPhi[<span class="hljs-number"><span class="hljs-number">0</span></span>] * angles[<span class="hljs-number"><span class="hljs-number">0</span></span>], thetaPhi[<span class="hljs-number"><span class="hljs-number">1</span></span>] * angles[<span class="hljs-number"><span class="hljs-number">1</span></span>]) length = math.cos(thetaPhi[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (math.cos(thetaPhi[<span class="hljs-number"><span class="hljs-number">0</span></span>]) * length, math.sin(thetaPhi[<span class="hljs-number"><span class="hljs-number">0</span></span>]) * length, math.sin(thetaPhi[<span class="hljs-number"><span class="hljs-number">1</span></span>]))</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ูุงูุฑุณูู ุฃุฎุฐ ุงูุนููุงุช </h3><br>  ุณุชููู ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุชุทุจูู ุทุฑููุฉ ุดุจู ูููุช ูุงุฑูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฃุฎุฐ ุนููุงุช Hammersley <sup>2</sup> : <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/4f9/b07/70f/4f9b0770f72e69ede59e56a25258343d.png"></div><br>  ููููู ุงุณุชุฎุฏุงู ุทุฑู ุฃุฎุฐ ุงูุนููุงุช ุงูุฃุฎุฑู ุ ูุซู Holton <sup>4</sup> ุ ูููู ูุงูุฑุณูู ุฃุณุฑุน ููููุฑ ุชูุฒูุนูุง ุฌูุฏูุง ููุนููุงุช ุนุจุฑ ุงููุฑุฉ.  ุณูููู Holton ุงุฎุชูุงุฑูุง ุฌูุฏูุง ูุนููุงุช ุงููุณุชูู ุฅุฐุง ุชู ุงุณุชุฎุฏุงู ุตูุฑุฉ ุจุณูุทุฉ ุจุฏูุงู ูู ุฎุฑูุทุฉ ุงูุจูุฆุฉ.  ูู ุงููุชุทูุจุงุช ุงูุฅูุฒุงููุฉ ูุฃุฎุฐ ุนููุงุช Hammersley ูู ููุจ ุฌุฐุฑ van der Corpute (ุตู) ุ ููุฒูุฏ ูู ุงูุชูุงุตูู ุ ุงูุธุฑ ุงูุฑูุงุจุท <sup>2</sup> .  ููุง ูู ุงูุชูููุฐ ุงูุณุฑูุน: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vdcSequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bits)</span></span></span><span class="hljs-function">:</span></span> bits = (bits &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) | (bits &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x55555555</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xAAAAAAAA</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x33333333</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xCCCCCCCC</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x0F0F0F0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xF0F0F0F0</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) bits = ((bits &amp; <span class="hljs-number"><span class="hljs-number">0x00FF00FF</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) | ((bits &amp; <span class="hljs-number"><span class="hljs-number">0xFF00FF00</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(bits) * <span class="hljs-number"><span class="hljs-number">2.3283064365386963e-10</span></span> <span class="hljs-comment"><span class="hljs-comment"># / 0x100000000 def hammersleySequence(i, N): return (float(i) / float(N), vdcSequence(i))</span></span></code> </pre> <br>  ุซู ูุณุชุฎุฏู ุชุฑุงูุจ ููุญุฏ ุนูู ุงููุฑุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sphereSample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(u, v)</span></span></span><span class="hljs-function">:</span></span> PI = <span class="hljs-number"><span class="hljs-number">3.14159265358979</span></span> phi = v * <span class="hljs-number"><span class="hljs-number">2.0</span></span> * PI cosTheta = <span class="hljs-number"><span class="hljs-number">2.0</span></span> * u - <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-comment"><span class="hljs-comment"># map to -1,1 sinTheta = math.sqrt(1.0 - cosTheta * cosTheta); return (math.cos(phi) * sinTheta, math.sin(phi) * sinTheta, cosTheta)</span></span></code> </pre> <br>  ูุฃุฎุฐ ุนููุงุช ูู Hammersley ุ ูุณุชุฎุฏู ุนุฏุฏูุง ุซุงุจุชูุง ูู ุงูุนููุงุช ุ ุงุณุชูุงุฏูุง ุฅูู ุฏูุฉ ุงูุตูุฑุฉ ุ ููุชุญูู ูู ุงูุฅุญุฏุงุซูุงุช ุงููุฑููุฉ ุฅูู ุงูุฏููุงุฑุชูุฉ ุ ููู ุซู ุฅูู equidistant: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> samplesMultiplier = <span class="hljs-number"><span class="hljs-number">0.006</span></span> samples = int(samplesMultiplier * width * height) samplesList = [] <span class="hljs-comment"><span class="hljs-comment"># apply hammersley sampling for i in range(0, samples): xi = hammersleySequence(i, samples) xyz = sphereSample(xi[0], xi[1]) # to cartesian imagePos = sphereToEquirectangular(xyz) luminance = lum[imagePos[0] * width, imagePos[1] * height]</span></span></code> </pre> <br>  ูุฐุง ุณูู ูุนุทููุง ุชูุฒูุน ุฌูุฏ ููุนููุงุช ุงูุชู ุณูุชู ูุญุตูุง ููุฌูุฏ ูุตุงุฏุฑ ุงูุถูุก: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/aa8/0a6/470/aa80a64703ef6e38cd0b73f9b02a5852.png"></div><br><h3 style=";text-align:right;direction:rtl">  ุชุตููุฉ ูุตุงุฏุฑ ุงูุถูุก </h3><br>  ูู ุฃูู ุนูููุฉ ุชุตููุฉ ุ ูุชุฌุงูู ุฌููุน ุงูุนููุงุช ุงูุชู ูุง ุชุชุฌุงูุฒ ุนุชุจุฉ ุงูุณุทูุน (ูุจุทุงูุงุช HDR ุ ูุฏ ุชููู ุฃุนูู) ุ ุซู ูุฑุฒ ุฌููุน ุงูุนููุงุช ุญุณุจ ุณุทูุนูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> localSize = int(float(<span class="hljs-number"><span class="hljs-number">12</span></span>) * (width / <span class="hljs-number"><span class="hljs-number">1024.0</span></span>)) + <span class="hljs-number"><span class="hljs-number">1</span></span> samplesList = [] <span class="hljs-comment"><span class="hljs-comment"># apply hammersley sampling for i in range(0, samples): xi = hammersleySequence(i, samples) xyz = sphereSample(xi[0], xi[1]) # to cartesian imagePos = sphereToEquirectangular(xyz) luminance = lum[imagePos [0] * width, imagePos [1] * height] sample = Sample(luminance, imagePos , xyz) luminanceThreshold = 0.8 #do a neighbour search for the maximum luminance nLum = computeNeighborLuminance(lum, width, height, sample.imagePos, localSize) if nLum &gt; luminanceThreshold: samplesList.append(sample) samplesList = sorted(samplesList, key=lambda obj: obj.luminance, reverse=True)</span></span></code> </pre> <br>  ุณูุคุฏู ุงูุชูุฑูุฑ ุงูุชุงูู ุฅูู ุงูุชุตููุฉ ุงุณุชูุงุฏูุง ุฅูู ูููุงุณ Euclidean ูุงููุณุงูุฉ ุจูู ุงูุจููุณูุงุช (ุงุนุชูุงุฏูุง ุนูู ุฏูุฉ ุงูุตูุฑุฉ) - ููู ุจููุฉ ุจูุงูุงุช ููุงููุฉ ูููู ุงุณุชุฎุฏุงููุง ููุชุฎูุต ูู ุงูุชุนููุฏ O (N <sup>2</sup> ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> euclideanThreshold = int(float(euclideanThresholdPixel) * (width / <span class="hljs-number"><span class="hljs-number">2048.0</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># filter based euclidian distance filteredCount = len(samplesList) localIndices = np.empty(filteredCount); localIndices.fill(-1) for i in range(0, filteredCount): cpos = samplesList[i].pos if localIndices[i] == -1: localIndices[i] = i for j in range(0, filteredCount): if i != j and localIndices[j] == -1 and distance2d(cpos, samplesList[j].pos) &lt; euclideanThreshold: localIndices[j] = i</span></span></code> </pre> <br>  ุชูุฑ ุงูุนููุงุช ุงููุงุชุฌุฉ ุจูุฑุญูุฉ ุงูุฏูุฌ ูุชูููู ุนุฏุฏ ูุตุงุฏุฑ ุงูุถูุก ุจุดูู ุฃูุจุฑ: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/d39/152/e1e/d39152e1e587c40c3ed29888faf02120.png"></div><br><h3 style=";text-align:right;direction:rtl">  ุฏูุฌ ูุตุงุฏุฑ ุงูุถูุก </h3><br>  ูู ุงููุฑุญูุฉ ุงูุฃุฎูุฑุฉ ุ ูุชู ุชูููุฐ ุฏูุฌ ุงูุนููุงุช ุงูุชู ุชูุชูู ุฅูู ููุณ ูุฌููุนุฉ ุงูุฅุถุงุกุฉ.  ููููุงู ุจุฐูู ุ ูููููุง ุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุฉ Bresenham ููุจุฏุฃ ูุน ุงูุนููุงุช ุจุฃุนูู ุณุทูุน ุ ูุฃููุง ูุฑุชุจุฉ ุจุงููุนู.  ุนูุฏูุง ูุนุซุฑ ุนูู ูุตุฏุฑ ุฅุถุงุกุฉ ูุฑุถู ุงุฎุชุจุงุฑ Bresenham ุ ูุฅููุง ูุณุชุฎุฏู ูููุนู ูุชุบููุฑ ููุถุน ุงููุตุฏุฑ ุจูุงุกู ุนูู ูุฒู ุงูุชุดุบูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-comment"><span class="hljs-comment"># apply bresenham check and compute position of the light clusters lights = [] finalIndices = np.empty(filteredCount); finalIndices.fill(-1) for i in localIndices: sample = samplesList[i] startPos = sample.pos if finalIndices[i] == -1: finalIndices[i] = i light = Light() light.originalPos = np.array(sample.pos) # position of the local maxima light.worldPos = np.array(sample.worldPos) light.pos = np.array(sample.pos) light.luminance = sample.luminance for j in localIndices: if i != j and finalIndices[j] == -1: endPos = samplesList[j].pos if bresenhamCheck(lum, width, height, startPos[0], startPos[1], endPos[0], endPos[1]): finalIndices[j] = i # compute final position of the light source sampleWeight = samplesList[j].luminance / sample.luminance light.pos = light.pos + np.array(endPos) * sampleWeight light.pos = light.pos / (1.0 + sampleWeight) imagePos = light.pos * np.array([1.0 / width, 1.0 / height) light.worldPos = equirectangularToSphere(imagePos) lights.append(light)</span></span></code> </pre> <br>  ุชููู ูุธููุฉ Bresenham ุจุงูุชุญูู ูู ูุฌูุฏ ุฎุท ูุชูุงุตู ูู ููุณ ุงูุณุทูุน.  ุฅุฐุง ุชุฌุงูุฒุช ุฏูุชุง ุงูุจููุณู ุงูุญุงูู ุญุฏูุง ูุนูููุง ุ ูุณูู ููุดู ุงููุญุต: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bresenhamCheck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lum, imageSize, x0, y0, x1, y1)</span></span></span><span class="hljs-function">:</span></span> dX = int(x1 - x0) stepX = int((dX &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) - (dX &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>)) dX = abs(dX) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> dY = int(y1 - y0) stepY = int((dY &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) - (dY &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>)) dY = abs(dY) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> luminanceThreshold = <span class="hljs-number"><span class="hljs-number">0.15</span></span> prevLum = lum[x0][y0] sumLum = <span class="hljs-number"><span class="hljs-number">0.0</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dX &gt;= dY): <span class="hljs-comment"><span class="hljs-comment"># delta may go below zero delta = int (dY - (dX &gt;&gt; 1)) while (x0 != x1): # reduce delta, while taking into account the corner case of delta == 0 if ((delta &gt; 0) or (delta == 0 and (stepX &gt; 0))): delta -= dX y0 += stepY delta += dY x0 += stepX sumLum = sumLum + min(lum[x0][y0], 1.25) c = c + 1 if(abs(sumLum / c - prevLum) &gt; luminanceThreshold and (sumLum / c) &lt; 1.0): return 0 else: # delta may go below zero delta = int(dX - (dY &gt;&gt; 1)) while (y0 != y1): # reduce delta, while taking into account the corner case of delta == 0 if ((delta &gt; 0) or (delta == 0 and (stepY &gt; 0))): delta -= dY x0 += stepX delta += dX y0 += stepY sumLum = sumLum + min(lum[x0][y0], 1.25) c = c + 1 if(abs(sumLum / c - prevLum) &gt; luminanceThreshold and (sumLum / c) &lt; 1.0): return 0 return 1</span></span></code> </pre> <br>  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃูู ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ูููู ุฅุฌุฑุงุก ุชุญุณููุงุช ุนูู ุงุฎุชุจุงุฑ Bresenham ุ ุงูุฃูุฑ ุงูุฐู ุณูุคุฏู ุฅูู ุฏูุฌ ุฃูุถู ููุนููุงุช ุ ุนูู ุณุจูู ุงููุซุงู ุ ูููู ุฃู ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุงูููู ุงูุฃููู ููุตุงุฏุฑ ุงูุถูุก ุงูููุฌูุฏุฉ ุนูู ุญูุงู ุงูุตูุฑุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููู ุชูุณูุน ุงููุธููุฉ ุจุณูููุฉ ูุชูุฑูุจ ูุณุงุญุฉ ูุตุงุฏุฑ ุงูุถูุก.  ุชุญุณูู ุขุฎุฑ: ููููู ุฅุถุงูุฉ ุญุฏ ุงููุณุงูุฉ ุญุชู ูุง ุชุฌูุน ุงูุนููุงุช ุงูุจุนูุฏุฉ.  ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/422/4a8/fd9/4224a8fd98cec4203235bb4678ee6826.png"></div><br>  ูุดูุฑ ุงูููู ุงูุฃุฒุฑู ุฅูู ุงูุญุฏ ุงูุฃูุตู ุงููุญูู ููุฌููุนุงุช ุงูุฅุถุงุกุฉ ุ ุจูููุง ูุดูุฑ ุงูููู ุงูุฃุฒุฑู ุฅูู ุงูููุงุถุน ุงูููุงุฆูุฉ ููุตุงุฏุฑ ุงูุฅุถุงุกุฉ ุ ุจูููุง ูุดูุฑ ุงูููู ุงูุฃุญูุฑ ุฅูู ุงูุนููุงุช ุงูุชู ุชุดูู ุฌุฒุกูุง ูู ูุฌููุนุฉ ุงูุฅุถุงุกุฉ ููุณูุง ูุชุชุตู ุจุฎุทูุท. <br><br>  ุฃูุซูุฉ ุฃุฎุฑู ูููุชุงุฆุฌ: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a44/e48/451/a44e484510a596be61f83f9c303f25fc.png"></div><br><hr><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุดู ุนู ูุตุงุฏุฑ ุงูุถูุก ูู ุงูุตูุฑ ุงูุฑูููุฉ ุจูุงุณุทุฉ ูุงุณูุฌ ูุงุณูููุณูู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุฑุณูู ููุงุท ุนูู ูุตู ุงููุฑุฉ ุงูุชู ูุชุจูุง ูููุฌุฑ Dammertz</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฅุณูุงุท ุงููุชุณุงูู ุจูุงุณุทุฉ ุจูู ุฑูุฏ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃุฎุฐ ุงูุนููุงุช ูุน ูุงูุฑุณูู ููุงูุชูู ุจูููุชุณ ูู ุชูุงู ุชุณูู ูููุบ</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar458598/">https://habr.com/ru/post/ar458598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar458576/index.html">ุฅุฏุงุฑุฉ ุงููุตูุต ูุงูุชุนุฑูุจ ูู ุชุทุจูู ุงูููุจ</a></li>
<li><a href="../ar458582/index.html">ุงุจุชูุฑ ูููุฏุณ ุงูุฃูุงุฒูู ุฌูุงุฒ ุญุฌุจ ูููุธูุฉ ุงูุนูู ุงูุฏูููุฉ ูุจูู ุงููุทุท ุฎุงุฑุฌ ุงูุดุงุฑุน</a></li>
<li><a href="../ar458584/index.html">11 ุชููุฒ (ููููู) ุ Group-IB Webinar "ุชุญููู ุงูุจุฑุงูุฌ ุงูุถุงุฑุฉ ูููุจุชุฏุฆูู: ุงูุฃุณุงููุจ ุงูุฃุณุงุณูุฉ"</a></li>
<li><a href="../ar458592/index.html">ูู ุงุฑุชูุงุน ุฒูู ุงูุงูุชูุงู ุฅูู ุชุตุญูุญ Kernel ุจุงุณุชุฎุฏุงู eBPF / BCC</a></li>
<li><a href="../ar458594/index.html">ูุง ุชูุณ ุฒูุงุฏุฉ ูุฑุตุฉ ุงุณุชุฌุงุจุฉ ุงูุนููู ุจุงุณุชุฎุฏุงู ุทูุจ ูุชูุฑุฑ ูู ููุงุฒูุฉ L7</a></li>
<li><a href="../ar458600/index.html">ูุง ูู ุงูุฏุฑุงุฌุงุช ุงูููุฑุจุงุฆูุฉ (ุงุณุชุนุฑุงุถ ุงููุฌููุนุฉ ูู ุฌุฒุฃูู ูู ุฎูุณุฉ ููุงุฐุฌ ูู ุงุซููู ูู ุงูุดุฑูุงุช ุงููุตูุนุฉ) ุ ุงูุฌุฒุก 1</a></li>
<li><a href="../ar458604/index.html">ููุงุฐุง ุงูุถู ุฃูุจุฑ ูุตูุนู ุฅููุชุฑูููุงุช ุฅูู ูุดุฑูุน GPU ุฌุฏูุฏ</a></li>
<li><a href="../ar458606/index.html">ุดุบูู OpenVPN ูู Docker ุฎูุงู ุซุงููุชูู</a></li>
<li><a href="../ar458608/index.html">ุฃุฏูุงุช ูุทูุฑ Node.js ุทุงุจูุฑ ุงููุธููุฉ</a></li>
<li><a href="../ar458612/index.html">COSMIC. 7 ุณููุงุช</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>