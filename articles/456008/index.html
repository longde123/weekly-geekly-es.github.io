<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∑üèº üéå üåä Desarrollo de programas para el procesador central Redd sobre el ejemplo de acceso a FPGA üíô üíÉüèæ ‚Ü©Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En un art√≠culo anterior, dije que es hora de que pasemos a los protocolos de transmisi√≥n. Pero despu√©s de comenzar a preparar una historia sobre ellos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desarrollo de programas para el procesador central Redd sobre el ejemplo de acceso a FPGA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456008/">  En un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo anterior,</a> dije que es hora de que pasemos a los protocolos de transmisi√≥n.  Pero despu√©s de comenzar a preparar una historia sobre ellos, me di cuenta de que yo mismo estoy nadando en un tema muy importante.  Como ya se se√±al√≥, mi relaci√≥n con Linux es bastante peculiar.  En general, me di cuenta de que yo mismo no puedo crear desde cero una aplicaci√≥n C ++ que satisfaga todos los principios de programaci√≥n para Redd.  Podr√≠as pedirle a alguien que haga esto y luego usar la plantilla ya preparada, pero la serie de art√≠culos est√° dise√±ada para ense√±ar a todos c√≥mo desarrollarse bajo Redd desde cero.  Por lo tanto, le pregunt√© a mi jefe (un gran especialista en Linux), y √©l me explic√≥ en qu√© hacer clic.  Luego pens√© un poco en sus palabras y ahora considero necesario arreglar todo el conocimiento por escrito.  Esto salvar√° a las personas como yo de pensamientos dolorosos: "Entonces ... Lo que hizo es comprensible, pero ¬øc√≥mo puedo repetir esto?"  En general, cualquier persona que trabaje con Linux puede ejecutar las siguientes dos secciones en diagonal.  Es poco probable que encuentre algo nuevo all√≠ (encontrar√° m√°s).  Y por lo dem√°s, ofrezco una opci√≥n de dos m√©todos de desarrollo que corresponden a los principios declarados de trabajar bajo Redd: bajos costos laborales para el desarrollo y depuraci√≥n remota. <br><br><img src="https://habrastorage.org/webt/kb/sk/5c/kbsk5cbh98eftndkgneifjnzgao.jpeg"><br><a name="habracut"></a><br>  Todos los art√≠culos del ciclo: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Desarrollo del "firmware" m√°s simple para FPGAs instalados en Redd, y depuraci√≥n utilizando la prueba de memoria como ejemplo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Desarrollo del "firmware" m√°s simple para FPGAs instalados en Redd.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2. C√≥digo del programa</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Desarrollo de su propio n√∫cleo para incrustar en un sistema de procesador basado en FPGA</a> </li></ol><br><h2>  Trabajar con herramientas de Visual Studio </h2><br>  Resulta que puede llevar a cabo el desarrollo para Linux remoto, sin tenerlo en su m√°quina local y sin instalar ninguna herramienta de software que no sea de Microsoft.  Aqu√≠ se muestra c√≥mo se coloca en Visual Studio (lo instal√© en la versi√≥n 2019, pero parece que apareci√≥ en 2015) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">docs.microsoft.com/ru-ru/cpp/linux/download-install-and-setup- the-linux-development-workload? view = vs-2019</a> <br><br>  Y aqu√≠ est√° la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">teor√≠a del trabajo</a> . <br><br>  Bueno, all√≠ puedes caminar por las pesta√±as, mucha teor√≠a y todo en ruso. <br><br>  Genial  Intentemos utilizar los conocimientos adquiridos para acceder al chip FT2232H, a trav√©s del cual el procesador central Redd se conecta al FPGA.  Es este canal en el futuro el que formar√° la base de nuestro trabajo de transmisi√≥n.  Abra Visual Studio, seleccione "Crear proyecto".  En los filtros, seleccione "Lenguaje - C ++", "Plataforma - Linux", "Tipo de proyecto - Consola".  Mostrar√© d√≥nde se encuentra esto para el tipo de proyecto.  De lo que hemos filtrado, seleccionamos la "Aplicaci√≥n de consola": <br><br><img src="https://habrastorage.org/webt/ao/5x/h4/ao5xh4h5fwoldpjdn_-rpx8ay2a.png"><br><br>  Llam√©moslo, digamos, SimpleConsole.  Hemos creado un c√≥digo fuente tan espartano: <br><br><pre><code class="plaintext hljs">#include &lt;cstdio&gt; int main() { printf("hello from SimpleConsole!\n"); return 0; }</code> </pre> <br>  Intentemos recogerlo.  Y se nos hace una pregunta muy interesante sobre el establecimiento de una conexi√≥n.  Esta es una caracter√≠stica del desarrollo en Visual Studio.  El entorno no contiene un compilador cruzado y ninguna biblioteca.  Simplemente crea un directorio de origen en la m√°quina remota, despu√©s de lo cual para cada compilaci√≥n copia los archivos actualizados y comienza la compilaci√≥n all√≠.  Es por eso que la conexi√≥n con la m√°quina remota no debe establecerse para comenzar, sino ya para el ensamblaje normal del proyecto. <br><br>  Completamos los par√°metros para el usuario de Redd, en nombre de qui√©n se realizar√° el trabajo en el proyecto. <br><br><img src="https://habrastorage.org/webt/jd/sx/hk/jdsxhkvvklw29zjoecvrr1svvda.png"><br><br>  En todo caso, los par√°metros se pueden cambiar aqu√≠ en este lugar secreto (no intente cambiar las propiedades del proyecto, no dar√° lugar a nada bueno): <br><br><img src="https://habrastorage.org/webt/dn/xe/yd/dnxeydmzx11e50rtxzjayuleto0.png"><br><br><img src="https://habrastorage.org/webt/ow/k-/le/owk-leapmriognn1l-kk4tavvyc.png"><br><br>  En realidad, puede poner un punto de interrupci√≥n en una sola l√≠nea y verificar que el proyecto comience y funcione.  Pero esto es trivial.  Por lo tanto, pasamos a una tarea m√°s interesante: trabajar con FT2232.  Surge la pregunta: ¬ød√≥nde obtener las bibliotecas necesarias?  Para Linux, todo est√° incluido en el paquete del controlador.  Existe el controlador en s√≠, las bibliotecas y ejemplos de aplicaciones para trabajar con ellos, e incluso una breve instrucci√≥n.  En general, conducimos al motor de b√∫squeda: <br><br><pre> <code class="plaintext hljs">FTDI D2XX drivers</code> </pre> <br>  √âl mostrar√° d√≥nde se pueden descargar.  Es cierto, espec√≠ficamente, todo fue malo para m√≠.  Mi proveedor bloquea el sitio web de FTDI (as√≠ como reprap, 7zip e incluso osronline), refiri√©ndose a RosKomNadzor.  ILV, en respuesta a declaraciones, env√≠a cancelaciones de suscripciones, diciendo que no estamos bloqueando nada, sino que trata con el proveedor usted mismo.  Donde solo en estas bajas no me ofrecieron recurrir, incluso a la polic√≠a.  Son muy bajas.  Los intentos de quejarse por la inacci√≥n de ILV terminan siendo enviados a ILV, de donde provienen las siguientes bajas.  En general, puede resultar que su proveedor tambi√©n bloquee el acceso.  No se alarme, solo busque otras formas de descargar, pasando tiempo en esto.  Y luego se sorprenden de que el desarrollo de los misiles se haya retrasado durante d√©cadas ... Comenc√© a mantener correspondencia con ILV en noviembre pasado, ahora es junio, excepto por las bajas, ninguna acci√≥n ... Pero me distraje. <br><br>  Puede encontrar c√≥mo usar los controladores en el archivo L√©ame, en el paquete mismo.  Tambi√©n puede encontrar el documento <b>AN_220 FTDI Drivers Installation Guide for Linux</b> .  Finalmente, puede encontrar en YouTube un video de la <b>Gu√≠a de instalaci√≥n del controlador Linux d2xx</b> de FTDI Chips.  Tambi√©n hay un enlace a √©l en la p√°gina de descarga del controlador.  En general, FTDI no escatim√≥ en opciones para informar a los usuarios.  En realidad, si recibi√≥ un paquete Redd listo, los controladores ya est√°n instalados y configurados en √©l.  Y nos interesar√°n los archivos de encabezado y ejemplos. <br><br>  Insertemos un ejemplo slice <b>\ release \ examples \ EEPROM \ read</b> .  El comienzo de la funci√≥n <b>principal</b> , donde se abre el dispositivo y se toma su tipo.  Esto ser√° suficiente para asegurarse de que todo funcione.  Odio las etiquetas, pero como arrastramos y soltamos r√°pidamente el c√≥digo que dura 10 minutos, arrastrar√© la etiqueta que estaba en el ejemplo original para ahorrar tiempo.  Resulta as√≠: <br><br><pre> <code class="plaintext hljs">#include &lt;cstdio&gt; #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/time.h&gt; #include "ftd2xx.h" int main(int argc, char* argv[]) { printf("hello from ConsoleApplication1!\n"); FT_STATUS ftStatus; FT_HANDLE ftHandle0; int iport; static FT_PROGRAM_DATA Data; static FT_DEVICE ftDevice; DWORD libraryVersion = 0; int retCode = 0; ftStatus = FT_GetLibraryVersion(&amp;libraryVersion); if (ftStatus == FT_OK) { printf("Library version = 0x%x\n", (unsigned int)libraryVersion); } else { printf("Error reading library version.\n"); return 1; } if (argc &gt; 1) { sscanf(argv[1], "%d", &amp;iport); } else { iport = 0; } printf("Opening port %d\n", iport); ftStatus = FT_Open(iport, &amp;ftHandle0); if (ftStatus != FT_OK) { /* This can fail if the ftdi_sio driver is loaded use lsmod to check this and rmmod ftdi_sio to remove also rmmod usbserial */ printf("FT_Open(%d) failed\n", iport); return 1; } printf("FT_Open succeeded. Handle is %p\n", ftHandle0); ftStatus = FT_GetDeviceInfo(ftHandle0, &amp;ftDevice, NULL, NULL, NULL, NULL); if (ftStatus != FT_OK) { printf("FT_GetDeviceType FAILED!\n"); retCode = 1; goto exit; } printf("FT_GetDeviceInfo succeeded. Device is type %d.\n", (int)ftDevice); exit: return 0; }</code> </pre><br>  Tratando de recolectar, no voy a hacerlo.  No hay suficientes archivos de encabezado. <br><br><pre> <code class="plaintext hljs">1&gt;main.cpp 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : ftd2xx.h:      1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : #include "ftd2xx.h" 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : ^ 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(5,20): error : compilation terminated.</code> </pre><br>  ¬°Pero los puse a continuaci√≥n!  Todo es simple  A nivel local, est√°n cerca, pero el montaje se realiza de forma remota.  Para que Studio los transfiera a una m√°quina remota, debe agregarlos al proyecto.  Adem√°s, desde el archivo <b>main.cpp</b> agrego solo <b>ftd2xx.h</b> , pero a√∫n <b>extrae WinTypes.h en tr√°nsito</b> .  Tienes que agregar ambos. <br><br><img src="https://habrastorage.org/webt/gy/-2/-j/gy-2-jt8ej_mbavcpupdsphb5g8.png"><br><br><img src="https://habrastorage.org/webt/kp/ye/l1/kpyel11pdcxgnd5ojt39rhkkslk.png"><br><br>  Ahora el enlazador jura. <br><br><pre> <code class="plaintext hljs">1&gt;  1&gt;D:\Work\SimpleConsole\SimpleConsole\obj\x64\Debug\main.o : error : In function `main': 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(18): error : undefined reference to `FT_GetLibraryVersion' 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(37): error : undefined reference to `FT_Open' 1&gt;D:\Work\SimpleConsole\SimpleConsole\main.cpp(55): error : undefined reference to `FT_GetDeviceInfo' 1&gt;collect2 : error : ld returned 1 exit status</code> </pre><br>  Est√° claro que no hay suficiente biblioteca.  Al inspeccionar los <b>archivos MAKE del</b> ejemplo, me di cuenta de que necesitaba agregar un par de par√°metros a la configuraci√≥n del enlazador: <br><br><img src="https://habrastorage.org/webt/xy/zm/2i/xyzm2igciaxlmevvppuug4vk2go.png"><br><br><img src="https://habrastorage.org/webt/xd/p2/f1/xdp2f1nxqd3bue69dqx8m-dgabc.png"><br><br>  Ahora el proyecto va con √©xito.  Ponemos un punto de interrupci√≥n en la √∫ltima l√≠nea, intentamos correr.  Vemos el siguiente texto: <br><br><pre> <code class="plaintext hljs">hello from ConsoleApplication1! Library version = 0x10408 Opening port 0 FT_Open succeeded. Handle is 0x555555768540 FT_GetDeviceInfo succeeded. Device is type 10.</code> </pre><br>  En general, no est√° mal.  Algo abierto, incluso se encontr√≥ alg√∫n dispositivo.  ¬øQu√© es el tipo 10?  En el archivo de encabezado de FTDI encontramos: <br><br><pre> <code class="plaintext hljs">enum { FT_DEVICE_BM, FT_DEVICE_AM, FT_DEVICE_100AX, FT_DEVICE_UNKNOWN, FT_DEVICE_2232C, FT_DEVICE_232R, FT_DEVICE_2232H, FT_DEVICE_4232H, FT_DEVICE_232H, FT_DEVICE_X_SERIES, FT_DEVICE_4222H_0, FT_DEVICE_4222H_1_2, FT_DEVICE_4222H_3, FT_DEVICE_4222_PROG, };</code> </pre><br>  Contamos el dedo de arriba a abajo: delante de nosotros est√° FT4222H.  S√≠, Redd tiene muchos dispositivos FTDI.  Ahora solo dir√© brevemente que necesitamos clasificar el n√∫mero del dispositivo pasado a la funci√≥n <b>FT_Open ()</b> , este n√∫mero se pasa a la funci√≥n <b>main ()</b> como argumento.  Se puede establecer en las propiedades de depuraci√≥n del proyecto. <br><br>  Es √∫til colocar un plato con problemas t√≠picos.  En general, dice "configurar Redd" en todas partes sin detalles.  El hecho es que los complejos se distribuir√°n de manera personalizada, por lo que todos los lectores no necesitan reglas de configuraci√≥n.  En caso de problemas, los administradores generalmente se encargar√°n de la configuraci√≥n.  Resulta que, por supuesto, puede describir las reglas de configuraci√≥n, pero ocupar√° mucho espacio.  Tiene sentido gastar energ√≠a en esto solo si alguien realmente lo necesita.  As√≠ que aqu√≠ me limitar√© solo a indicar problemas, y c√≥mo solucionarlos describir√© si hay aplicaciones en los comentarios. <br><br><div class="scrollable-table"><table><tbody><tr><th>  S√≠ntoma </th><th>  Raz√≥n </th></tr><tr><td>  No se abre un solo dispositivo. </td><td>  De forma predeterminada, Linux requiere derechos de administrador para abrir dispositivos USB, pero el usuario que inicia sesi√≥n para la depuraci√≥n no los tiene.  Debe configurar los puertos para que puedan ser utilizados por un usuario normal. </td></tr><tr><td>  Solo se abren un par de dispositivos, ambos FT4222H. </td><td>  De manera predeterminada, se instala un controlador de puerto COM virtual est√°ndar en el controlador FT2232H.  Deber√≠a decirle al sistema operativo que no haga esto. </td></tr><tr><td>  No se encontraron bibliotecas. </td><td>  Los controladores D2XX no est√°n instalados en el sistema operativo del dispositivo Redd. </td></tr></tbody></table></div><br>  Genial  Estamos listos para los logros utilizando exclusivamente herramientas de Microsoft.  En general, esto puede ser suficiente, pero por si acaso, te contar√© sobre una alternativa que mi jefe me ense√±√≥. <br><br><h2>  Trabajando con Linux corriendo en una m√°quina virtual </h2><br>  La principal desventaja del m√©todo anterior es el ensamblaje remoto.  Puede pensar en mil y una razones por las cuales el ensamblaje debe hacerse localmente, y solo el archivo binario terminado se transferir√° a la m√°quina remota.  Estos son todo tipo de restricciones paranoicas (aunque los archivos se transfieren utilizando un protocolo seguro y puede separar su almacenamiento de otros usuarios con pol√≠ticas de seguridad), esto es solo el cuidado de que la unidad Redd no se desborde de todo tipo de bibliotecas, esta es tambi√©n la renuencia a registrar cada archivo de encabezado, si hay miles de ellos ... Bueno, y mucho, mucho m√°s.  En general, la t√©cnica de ensamblaje local puede ser √∫til, as√≠ que consid√©relo. <br><br>  En primer lugar, colocamos el programa VirtualBox de Oracle en la m√°quina local.  Si hay alg√∫n problema de licencia (lo uso de forma gratuita, como individuo, pero no s√© exactamente qu√© est√° sucediendo con las entidades legales), seleccione una m√°quina f√≠sica separada y coloque Linux all√≠.  Cual?  Es m√°s f√°cil para m√≠, los entiendo a todos por igual.  Quiero decir, casi no entiendo uno.  Por lo tanto, el jefe me dijo que necesita usar Debian, instal√© Debian.  Puede seguir el mismo camino (use el principio "¬øPor qu√© no?").  Al menos en el futuro confiar√© en trabajar con √©l. <br><br>  Al trabajar con Linux, debe cumplir con dos reglas que facilitan enormemente la vida: <br><br><ol><li>  Si, en respuesta a un comando, nos dicen que no hay suficientes derechos, vale la pena repetirlo, agregando el hechizo m√°gico <b>sudo</b> al principio. </li><li>  Si en respuesta a un comando se nos dice que no existe, vale la pena intentar instalarlo lanzando el hechizo m√°gico <b>apt-get install &lt;cosa perdida&gt;</b> . </li></ol><br>  Entonces  Acabamos de instalar el sistema operativo.  Inmediatamente agregue soporte C ++ all√≠ instalando el compilador g ++, as√≠ como el depurador gdb.  Como?  Entonces, usando la regla 2: <br><br>  <b>apt-get install g ++</b> <b><br></b>  <b>apt-get install gdb</b> <br><br>  ¬øNo dio?  Genial  Repita usando la regla 1: <br><br>  <b>sudo apt-get install g ++</b> <b><br></b>  <b>sudo apt-get install gdb</b> <br><br>  Ahora vamos a Internet, en el motor de b√∫squeda escribimos: <br><br>  <b>Eclipse IDE</b> <br><br>  Encontramos un enlace a eclipse.org, donde las primeras opciones son para Java, encontramos y descargamos una opci√≥n para C / C ++: <br><br><img src="https://habrastorage.org/webt/96/qw/qk/96qwqkb0litad1r1tujou2a9bae.png"><br><br>  Descargar y descomprimir, digamos, en casa. <br><br>  En realidad, no se requiere instalaci√≥n.  Simplemente vaya al directorio donde acaba de desempaquetar todo y ejecute el archivo eclipse: <br><br><img src="https://habrastorage.org/webt/ir/70/5r/ir705r0y6iwxnnixuxatl8ajg5m.png"><br><br>  Estamos en un entorno de desarrollo.  Bueno, si ya ha trabajado con microcontroladores e incluso n√∫cleos de procesador para FPGA, entonces probablemente ya sepa qu√© es Eclipse.  Entonces las cosas desconocidas est√°n casi completas.  Comenzamos a mirar alrededor en cosas m√°s o menos familiares.  Creamos el proyecto C ++.  Debo decir de inmediato que hay dos formas.  Uno conducir√° al √©xito, el segundo a un callej√≥n sin salida.  Por lo tanto, sigue cuidadosamente el camino que camino: <br><br><img src="https://habrastorage.org/webt/pn/p2/am/pnp2amrhevvek40jz7nqsocol5g.png"><br><br><img src="https://habrastorage.org/webt/a_/ge/sx/a_gesxu9d6u_hhbocj0mqah5xik.png"><br><br><img src="https://habrastorage.org/webt/14/zg/b0/14zgb0day-st8r8cyejyvxahtsk.png"><br><br>  Hemos creado un proyecto que va bien.  Para configurar su depuraci√≥n, vaya a las propiedades de GDB: <br><br><img src="https://habrastorage.org/webt/zd/zf/tz/zdzftzvpbfwkbs1mphkqdyrfv1a.png"><br><br>  Cree una configuraci√≥n de aplicaci√≥n remota tipo C / C ++, en el grupo Conexi√≥n, haga clic en Nuevo: <br><br><img src="https://habrastorage.org/webt/u1/dy/wb/u1dywbnrislxi82tujf7k3crbks.png"><br><br>  Elija una conexi√≥n como SSH: <br><br><img src="https://habrastorage.org/webt/j8/nt/td/j8nttddgczes40njsbis01oamzi.png"><br><br>  Completamos las propiedades de conexi√≥n cambiando el bot√≥n de opci√≥n del tipo de autorizaci√≥n a autorizaci√≥n de contrase√±a: <br><br><img src="https://habrastorage.org/webt/i_/we/l1/i_wel1jpfgrjiale5pgsh7un8mg.png"><br><br>  En realidad, el sistema est√° listo para la depuraci√≥n.  Despu√©s de asegurarnos de que el texto de bienvenida se muestra realmente, intentamos transferir el c√≥digo del ejemplo anterior (que estaba en Visual Studio) aqu√≠.  Para registrar bibliotecas adicionales, seleccione las propiedades del proyecto: <br><br><img src="https://habrastorage.org/webt/9i/b0/7r/9ib07rvhf55tqf7hvkewqsqbqau.png"><br><br>  Adem√°s, dado que el ensamblaje se realiza localmente, las bibliotecas tambi√©n deben estar en el directorio local usr / local / lib.  Le recuerdo que las bibliotecas se descargan con el controlador y que la forma de instalarlas es el archivo L√©ame, as√≠ como los videos de AN220 y YouTube. Para obtener detalles, consulte la secci√≥n sobre Visual Studio. <br><br>  Despu√©s de toda esta preparaci√≥n, obtenemos las l√≠neas familiares.  Es decir, el c√≥digo completamente id√©ntico al considerado en la secci√≥n anterior se ejecuta no menos id√©nticamente. <br><br>  Eso es todo.  Ahora, dependiendo de la situaci√≥n, podemos ejecutar el c√≥digo tanto a trav√©s de Visual Studio como a trav√©s de una m√°quina virtual.  Como puede ver, puramente en t√©rminos de configuraci√≥n, Visual Studio es m√°s simple, por lo tanto, ceteris paribus, lo elegir√©.  Pero es mejor tener ambas tecnolog√≠as, ya que trabajar a trav√©s de Studio tiene sus inconvenientes relacionados con el hecho de que no solo la depuraci√≥n, sino tambi√©n el ensamblaje son remotos all√≠. <br><br><h2>  Medici√≥n de velocidad de escritura FPGA a trav√©s de FT2232H </h2><br>  Pues que.  Arreglemos las habilidades adquiridas en un proyecto m√°s o menos real.  Por supuesto, comenzar algo muy serio ya no es posible; todos ya est√°n cansados.  Pero obtenemos un resultado m√°s o menos pr√°ctico.  Por ejemplo, medimos con qu√© velocidad m√°xima podemos transferir datos al FPGA a trav√©s del chip FT2232H.  El protocolo no es el m√°s f√°cil, por lo que no lo transmitiremos por ambos lados, sino que nos limitaremos a transmitir desde nosotros al canal, en el otro extremo del cual est√° instalado el FPGA.  El documento <b>AN_130 FT2232H utilizado en un modo FIFO s√≠ncrono estilo FT245</b> nos ayudar√° con esto, ya que en el complejo el controlador se enciende precisamente en este modo (FIFO s√≠ncrono).  Este documento tambi√©n contiene una descripci√≥n de las conclusiones, en la forma en que se utilizan en este modo, y diagramas de tiempo, e incluso ejemplos de c√≥digo, de los cuales nos inspiraremos. <br><br>  Entonces  Queremos grabar en FIFO usando el controlador.  ¬øQu√© vendr√° de nosotros?  Lo intent√©, lo s√©.  Tomar√° 1 kilobyte de datos, despu√©s de lo cual el controlador se bloquear√°.  Se negar√° a aceptar datos adicionales.  El caso es que un kilobyte es el tama√±o de su b√∫fer interno.  Si bien es posible, los datos se tomar√°n de USB y se almacenar√°n en este espacio.  Pero para que puedan ir al canal sincr√≥nico, debe informar sobre la disposici√≥n para recibirlos.  Nos fijamos en el improvisado correspondiente. <br><br><img src="https://habrastorage.org/webt/qq/9x/lj/qq9xljp4ma4jlpcprp5emofdraa.png"><br><br>  Entonces  Cuando el controlador tiene datos en FIFO, deja caer la se√±al RXF.  En respuesta a esto, primero debemos soltar la se√±al OE y mantenerla en cero durante al menos un ciclo de reloj (esto se deduce m√°s de la descripci√≥n del diagrama que del diagrama en s√≠).  Se nos dar√°n datos en el bus, debemos confirmar su recepci√≥n con un bajo nivel de se√±al RD.  Y as√≠, para todo el marco.  Cuando el controlador eleva la l√≠nea RXF, debemos eliminar el OE y el RD.  No usaremos los datos hoy.  Para medir la velocidad, simplemente simule la recepci√≥n de datos en el FPGA desde FT2232H.  Pues bien.  Para una operaci√≥n tan simple, no se necesita un sistema de procesador.  Es suficiente para hacer un aut√≥mata degenerado, cuyo desarrollo llevar√° mucho menos tiempo que simplemente preocuparse por la preparaci√≥n del procesador y el programa.  Por lo tanto, creamos un proyecto que contiene solo un archivo SystemVerilog con los siguientes contenidos: <br><br><pre> <code class="plaintext hljs">module JustRead( input logic clk, input logic rxf_n, output logic oe_n, output logic rd_n ); enum {IDLE,TRANSFER} state = IDLE; always @ (posedge clk) begin oe_n &lt;= 1; rd_n &lt;= 1; case (state) IDLE: begin if (rxf_n == 0) begin oe_n &lt;= 0; state &lt;= TRANSFER; end end TRANSFER: begin if (rxf_n == 0) begin oe_n &lt;= 0; rd_n &lt;= 0; end else begin state &lt;= IDLE; end end endcase end endmodule</code> </pre><br>  La m√°quina tiene dos estados.  En este caso, la duraci√≥n de la se√±al OE est√° determinada por el hecho de que se activa inmediatamente despu√©s del pulso del reloj y se mantiene hasta el siguiente.  Esto se puede verificar utilizando el siguiente modelo: <br><br><pre> <code class="plaintext hljs">module JustReadTB( output logic clk, output logic rxf_n, input logic oe_n, input logic rd_n ); JustRead dut ( .clk, .rxf_n, .oe_n, .rd_n ); always begin clk = 1; #16; clk = 0; #16; end initial begin rxf_n = 1; #120; rxf_n = 0; #120; rxf_n = 1; end endmodule</code> </pre><br>  El tiempo que tom√© es el primero disponible, lo importante es la secuencia de conmutaci√≥n que se adjunta a la se√±al del reloj.  Obtenemos el siguiente diagrama de tiempo: <br><br> <a href=""><img src="https://habrastorage.org/webt/ps/kw/jw/pskwjww-komvozbyogvdndsukq8.png"></a> <br><br>  En una primera aproximaci√≥n, esto corresponde a lo que requiere el documento.  Pero no procesaremos los datos reales de todos modos. <br><br>  La asignaci√≥n de piernas FPGA en este proyecto tampoco causa dificultades incluso para editar a trav√©s de una tabla (llevar√° m√°s tiempo transferir las asignaciones del archivo * .QSF, y constantemente enfatizo que cuando se desarrollan sistemas de un d√≠a en Redd, ahorrar tiempo es una prioridad). <br><br><img src="https://habrastorage.org/webt/kp/8s/wq/kp8swq3ni8n0x02znmnexvjpfsk.png"><br><br>  Recolectamos, llenamos, antes de apagar el complejo, puede trabajar con el programa, ya no se bloquear√° despu√©s de un desbordamiento del b√∫fer. <br><br>  En el programa, hice dos funciones.  El primero busca y abre el dispositivo.  Tom√© algo de la √∫ltima prueba, tom√© prestado algo de <b>AN130</b> : <br><br><pre> <code class="plaintext hljs">FT_HANDLE OpenFT2232H() { FT_HANDLE ftHandle0; static FT_DEVICE ftDevice; //      int nDevice = 0; while (true) { //     if (FT_Open(nDevice, &amp;ftHandle0) != FT_OK) { //  ,      return 0; } //     ? if (FT_GetDeviceInfo(ftHandle0, &amp;ftDevice, NULL, NULL, NULL, NULL) == FT_OK) { // ,    if (ftDevice == FT_DEVICE_2232H) { // ,     AN130 FT_SetBitMode(ftHandle0, 0xff, 0x00); usleep(1000000); //Sync FIFO mode FT_SetBitMode(ftHandle0, 0xff, 0x40); FT_SetLatencyTimer(ftHandle0, 2); FT_SetUSBParameters(ftHandle0, maxBlockSize, maxBlockSize); return ftHandle0; } } //    FT_Close(ftHandle0); //    nDevice += 1; } }</code> </pre><br>  Como fan√°tico de Windows, tuve que escribir la funci√≥n de medici√≥n de velocidad, revisando constantemente Internet, ya que generalmente uso los temporizadores cl√°sicos de alta resoluci√≥n de la API WIN32.  Quiz√°s pueda escribir de manera m√°s eficiente, pero este es un programa de un d√≠a. <br><br><pre> <code class="plaintext hljs">const int maxBlockSize = 0x100000; uint8_t buf[maxBlockSize]; ‚Ä¶ //   BlockSize ,  1 double TestSpeed(FT_HANDLE ftHandle0,int totalSize, int blockSize) { if (blockSize &gt; maxBlockSize) { return -1; } DWORD dwWrittenTotal = 0; timespec before; clock_gettime(CLOCK_REALTIME, &amp;before); for (int i = 0; i &lt; totalSize; i += blockSize) { DWORD dwWritten; FT_Write(ftHandle0, buf, blockSize, &amp;dwWritten); //     dwWrittenTotal += dwWritten; } timespec after; clock_gettime(CLOCK_REALTIME, &amp;after); if (dwWrittenTotal &lt; (DWORD)totalSize) { return -2; } //     uint64_t nsBefore = before.tv_nsec; uint64_t nsAfter = after.tv_nsec; //      nsAfter += (after.tv_sec - before.tv_sec) * 1000000000; //   nsAfter -= nsBefore; //      double res = ((double)nsAfter)/((double)1000000000); //   -    return ((double)dwWrittenTotal) / res; }</code> </pre><br>  Bueno, el c√≥digo que realiza la funcionalidad b√°sica result√≥ as√≠: <br><br><pre> <code class="plaintext hljs">int main(int argc, char* argv[]) { FT_HANDLE ftHandle0 = OpenFT2232H(); if (ftHandle0 == 0) { printf("Cannot open device\n"); return -1; } const int totalSize = 0x100000; static const int blockSizes[] = { 0x10,0x20,0x40,0x80,0x100,0x200,0x400,0x800,0x1000,0x2000, 0x4000,0x8000,0x10000,0x20000,0x40000,0x80000,0 }; for (int i = 0; blockSizes[i] != 0; i++) { double speed = TestSpeed(ftHandle0, totalSize, blockSizes[i]); printf("%d,%d\n", blockSizes[i], (int)(speed/1000.)); int stop = 0; } // ,    FT_Close(ftHandle0); return 0; }</code> </pre><br>  S√© que en USB, la velocidad depende en gran medida del tama√±o del bloque que se env√≠a, por lo que compruebo la velocidad para varias opciones.  La enumeraci√≥n lineal apenas es necesaria.  Acabo de presentar una lista de tama√±os t√≠picos.  Saco los datos en kilobytes por segundo.  Los bytes son inc√≥modos para los ojos, los megabytes tienen baja resoluci√≥n con un tama√±o de bloque peque√±o.  Kilobytes por segundo es un compromiso razonable.  Obtenemos los siguientes resultados: <br><pre> <code class="plaintext hljs">16,59 32,110 64,237 128,490 256,932 512,1974 1024,3760 2048,5594 4096,10729 8192,16109 16384,20170 32768,24248 65536,26664 131072,28583 262144,29370 524288,29832</code> </pre><br>  Los guardamos en un archivo * .csv, los cargamos en Excel, construimos un gr√°fico de la velocidad versus el tama√±o del bloque. <br><br><img src="https://habrastorage.org/webt/_o/ep/xe/_oepxe_wz65g7otcfeo3qete8xa.png"><br><br>  El l√≠mite es de 30 megabytes por segundo.  Hasta un m√°ximo te√≥rico de 52 MB / s lejos.  Quiz√°s pueda acelerar de alguna manera, pero dejarlo a los lectores en forma de trabajo pr√°ctico.  Lo principal es que hemos dominado todos los pasos para trabajar con el canal y estamos listos para conectar la FPGA con el procesador central en un solo sistema. <br><br>  Mientras se <b>compilaba</b> el art√≠culo, se encontr√≥ el documento <b>AN_165</b> , que dec√≠a que la velocidad m√°xima en modo FIFO s√≠ncrono es de 35 MB / s.  Es decir, espacio para el crecimiento, hasta un tama√±o determinado.  Pero todav√≠a est√° ah√≠. <br><br><h2>  Conclusi√≥n </h2><br>  Conocimos dos estrategias para desarrollar y depurar c√≥digo de programa ejecutado en el procesador central del complejo Redd (usando las herramientas de Microsoft Visual Studio y en una m√°quina virtual con sistema operativo Linux).  Tambi√©n adquirimos habilidades pr√°cticas al trabajar con el canal a trav√©s del cual el procesador central del complejo se comunica con el FPGA. <br><br>  Aparentemente, ahora nada nos impide transmitir datos significativos de la CPU a la FPGA y viceversa (aunque en el √∫ltimo art√≠culo escrib√≠ estas palabras). <br><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> se puede </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">descargar</font></a><font style="vertical-align: inherit;"> un ejemplo que contiene el "firmware" m√°s simple para FPGA y un programa que mide la velocidad de escritura en USB </font><font style="vertical-align: inherit;">.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/456008/">https://habr.com/ru/post/456008/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455996/index.html">Transformaci√≥n digital de la publicidad en la red minorista. Siguiendo los pasos de Video Analytics en Retail</a></li>
<li><a href="../456000/index.html">Crear un juego Tic-Tac-Toe con TypeScript, React y Mocha</a></li>
<li><a href="../456002/index.html">Memoria de hogar dedicada e intervenci√≥n OOM Killer</a></li>
<li><a href="../456004/index.html">Te invitamos a una reuni√≥n de desarrollo front-end en servicios muy cargados</a></li>
<li><a href="../456006/index.html">Aumente sus ingresos utilizando compras en la aplicaci√≥n</a></li>
<li><a href="../456010/index.html">C√≥mo Java 10 cambia la forma en que usas clases internas an√≥nimas</a></li>
<li><a href="../456014/index.html">Sobre la localizaci√≥n de productos. Parte 2: ¬øc√≥mo se forma el precio?</a></li>
<li><a href="../456016/index.html">Protocolo de comunicaci√≥n entre iframe y la ventana principal.</a></li>
<li><a href="../456018/index.html">C√≥mo implementar una implementaci√≥n desde GitHub a un servidor de producci√≥n usando Webhook</a></li>
<li><a href="../456020/index.html">Prepar√°ndose para dominar el mundo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>