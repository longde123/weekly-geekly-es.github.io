<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì∞ üë®üèª‚ÄçüöÄ üôåüèº Compilaci√≥n cruzada de OpenCV 4 para Raspberry Pi y BeagleBone Black üêøÔ∏è üå∞ üëéüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos 

 Cuando quise instalar OpenCV en mi frambuesa para un proyecto, me decepcion√≥ mucho el resultado. Result√≥ que para las nuevas versiones...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Compilaci√≥n cruzada de OpenCV 4 para Raspberry Pi y BeagleBone Black</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461693/">  Hola a todos <br><br>  Cuando quise instalar OpenCV en mi frambuesa para un proyecto, me decepcion√≥ mucho el resultado.  Result√≥ que para las nuevas versiones de im√°genes Raspbian con soporte para Python3.7, es imposible instalar la biblioteca desde el repositorio con el conocido comando de instalaci√≥n pip. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Razones</b> <div class="spoiler_text">  pip install opencv-python me dio un resultado inesperado: "No se pudo encontrar una versi√≥n que satisfaga el requisito ...".  Recientemente, de esta manera instal√© esta biblioteca en mi computadora principal, y el resultado fue positivo. <br><br>  Cuando volv√≠ a comprobar la curvatura y me asegur√© de que todav√≠a pod√≠a escribir correctamente un comando de 25 caracteres sin errores tipogr√°ficos, era hora de averiguar qu√© m√°s podr√≠a afectar el resultado. <br><br>  La p√°gina oficial de opencv-python en pypi.org ha aclarado mucho: <br><blockquote>  ... Tenga en cuenta que el formato de la rueda (especialmente muchoslinux) no admite actualmente la arquitectura ARM adecuada, por lo que no hay paquetes para plataformas basadas en ARM en PyPI.  Sin embargo, los paquetes opencv-python para Raspberry Pi se pueden encontrar en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.piwheels.org</a> . <br><br>  <i>... Tenga en cuenta que el formato de rueda (especialmente manylinux) no admite actualmente la arquitectura ARM, por lo que PyPI no tiene paquetes para plataformas basadas en ARM.</i>  <i>Sin embargo, los paquetes opencv-python para Raspberry Pi se pueden encontrar en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.piwheels.org</a> .</i> <br></blockquote>  Ok ... <br><br>  Verifiqu√© que la frambuesa extra√≠a paquetes de la fuente correcta, pero el √∫ltimo bloque del sitio puso todo en su lugar: <br><blockquote>  Wheels proporcion√≥ soporte para todos los modelos de Raspberry Pi (Pi 3, Pi 2, Pi 1 y Pi Zero).  Se proporcionan ruedas para Raspbian Jessie (Python 3.4) y Raspbian Stretch (Python 3.5).  Planeamos agregar soporte para Raspbian Buster (Python 3.7) a su debido tiempo. <br><br>  <i>Las ruedas proporcionadas son compatibles con todos los modelos de Raspberry Pi (Pi 3, Pi 2, Pi 1 y Pi Zero. Las ruedas son compatibles con Raspbian Jessie (Python 3.4) y Raspbian Stretch (Python 3.5). Planeamos agregar soporte para Raspbian Buster (Python 3.7) a su debido tiempo.</i> <br></blockquote>  Ya estaba listo para una noche de insomnio con la compilaci√≥n de OpenCV en una frambuesa, pero record√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un art√≠culo</a> sobre la compilaci√≥n cruzada de una biblioteca (no fue por nada que los maestros del instituto sugirieron que hici√©ramos un laboratorio en lugar de manuales).  Habiendo cambiado ligeramente los par√°metros del art√≠culo (era necesario agregar importaci√≥n para python3 y verificar si todas las bibliotecas son para OpenCV 4.1.0), pude lograr el resultado que deseaba. <br><br>  Sin embargo, la pereza se intensific√≥ y comenc√© a buscar soluciones listas para tal problema.  Entonces me encontr√© con este art√≠culo.  Sigui√©ndola, coleccion√© todo la primera vez sin bailar con panderetas y otros rituales cham√°nicos.  Creo que este art√≠culo ser√° √∫til para otros. <br></div></div><br>  Presento mi traducci√≥n gratuita del art√≠culo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Compilaci√≥n cruzada de OpenCV 4 para Raspberry Pi y BeagleBone Black</a> " de Paul Silisteanu.  Quiz√°s alguien ahorrar√° minutos u horas que se pueden dedicar a una lecci√≥n m√°s interesante que jugar una historia de detectives. <br><br>  Por mi parte, agregu√© algunas notas a la traducci√≥n, que consider√© importantes: [ <i>est√°n resaltadas en el texto</i> ]. <br><br>  ¬°Disfruta leyendo! <br><br><h3>  Compilaci√≥n cruzada de OpenCV 4 para Raspberry Pi y BeagleBone Black </h3><br>  En este art√≠culo, le mostrar√© c√≥mo instalar la √∫ltima versi√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OpenCV</a> para Raspberry Pi y BeagleBone Black utilizando la compilaci√≥n cruzada.  En el momento de escribir este art√≠culo [ <i>su actualizaci√≥n en el momento de la traducci√≥n es el 17 de julio de 2019</i> ], la √∫ltima versi√≥n de OpenCV es 4.1.0, y la versi√≥n incluida con los sistemas operativos est√°ndar era 3.2.0.  Por supuesto, es posible compilar OpenCV desde la fuente directamente a Raspberry o BeagleBone Black, pero esto puede llevar varias horas.  Y la compilaci√≥n cruzada de OpenCV para armhf es un proceso que dura 20-30 minutos.  Y, dependiendo de la velocidad de su computadora, puede ser a√∫n m√°s r√°pido. <br><br>  Recomiendo construir en una m√°quina virtual <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Debian Buster</a> o en un contenedor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Docker</a> , para no saturar su sistema operativo principal.  Si decide instalar Buster en una m√°quina virtual, aseg√∫rese de utilizar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">compilaci√≥n m√≠nima</a> [ <i>Recomiendo hacer eso, lo comprob√© en mi propia m√°scara</i> ].  Es muy importante comenzar con un sistema simple, porque necesitamos instalar los ejecutables y las bibliotecas de armhf.  Usando un sistema m√≠nimo, evitamos posibles conflictos con las versiones nativas x86-64. <br><br>  El art√≠culo describe trabajar solo en Raspberry PI con el sistema Raspbian, pero si usa BeagleBone Black, todo deber√≠a funcionar exactamente igual. <br><br>  Supongo que ya tienes un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Raspbian</a> limpio instalado.  Us√© la imagen de la √∫ltima versi√≥n de escritorio disponible.  De hecho, puedes seguir el art√≠culo sobre Raspbian Lite, pero hice todas mis pruebas usando la versi√≥n GUI. <br><br>  Primero, asegur√©monos de que nuestra m√°quina virtual o contenedor est√© actualizado: <br><br><pre><code class="bash hljs">sudo apt update sudo apt upgrade</code> </pre> <br>  A continuaci√≥n, debe conectar la arquitectura armhf. <br><br><pre> <code class="bash hljs">sudo dpkg --add-architecture armhf sudo apt update sudo apt install qemu-user-static</code> </pre><br>  En este punto, puede instalar bibliotecas y aplicaciones para armhf en su sistema y ejecutarlas. <br><br>  Vamos a construir OpenCV con soporte para Python y C ++.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instalemos Python2 y Python3</a> , as√≠ como el pacto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NumPy</a> para ellos: <br><br><pre> <code class="bash hljs">sudo apt-get install python3-dev sudo apt-get install python3-numpy sudo apt-get install python-dev sudo apt-get install python-numpy</code> </pre><br>  Tambi√©n necesitaremos libpython para la arquitectura armhf: <br><br><pre> <code class="bash hljs">sudo apt-get install libpython2-dev:armhf sudo apt-get install libpython3-dev:armhf</code> </pre><br>  A continuaci√≥n, instalaremos libgtk-3 para poder escribir programas simples con una interfaz gr√°fica.  Si planea usar OpenCV exclusivamente en modo fuera de l√≠nea, puede ignorar las dos bibliotecas siguientes: <br><br><pre> <code class="bash hljs">$ sudo apt install libgtk-3-dev:armhf libcanberra-gtk3-dev:armhf</code> </pre><br>  Tambi√©n necesitamos instalar varias otras bibliotecas necesarias para OpenCV (soporte para varios formatos de imagen y video): <br><br><pre> <code class="bash hljs">sudo apt install libtiff-dev:armhf zlib1g-dev:armhf sudo apt install libjpeg-dev:armhf libpng-dev:armhf sudo apt install libavcodec-dev:armhf libavformat-dev:armhf libswscale-dev:armhf libv4l-dev:armhf sudo apt-get install libxvidcore-dev:armhf libx264-dev:armhf</code> </pre><br>  A continuaci√≥n, vamos a instalar compiladores cruzados para Debian, que se pueden usar para crear binarios armhf para Raspberry Pi: <br><br><pre> <code class="bash hljs">sudo apt install crossbuild-essential-armhf sudo apt install gfortran-arm-linux-gnueabihf</code> </pre><br>  En el momento de escribir este art√≠culo, el kit de herramientas anterior se basa en la versi√≥n 8.3 de GCC, que es la misma que en Raspbian. <br><br>  Finalmente, instalaremos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cmake</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">git</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pkg-config</a> y wget: <br><br><pre> <code class="bash hljs">sudo apt install cmake git pkg-config wget</code> </pre><br>  A continuaci√≥n, podemos descargar la versi√≥n actual de OpenCV.  Le mostrar√© c√≥mo instalar la versi√≥n completa de OpenCV (bibliotecas predeterminadas y contrib): <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ mkdir opencv_all &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> opencv_all wget -O opencv.tar.gz https://github.com/opencv/opencv/archive/4.1.0.tar.gz tar xf opencv.tar.gz wget -O opencv_contrib.tar.gz https://github.com/opencv/opencv_contrib/archive/4.1.0.tar.gz tar xf opencv_contrib.tar.gz rm *.tar.gz</code> </pre><br>  Necesitamos cambiar temporalmente dos variables del sistema necesarias para construir con √©xito el soporte GTK +: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PKG_CONFIG_PATH=/usr/lib/arm-linux-gnueabihf/pkgconfig:/usr/share/pkgconfig <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PKG_CONFIG_LIBDIR=/usr/lib/arm-linux-gnueabihf/pkgconfig:/usr/share/pkgconfig</code> </pre><br>  Por el momento, podemos usar Cmake para generar scripts de compilaci√≥n de OpenCV: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> opencv-4.1.0 mkdir build &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> build cmake -D CMAKE_BUILD_TYPE=RELEASE \ -D CMAKE_INSTALL_PREFIX=/opt/opencv-4.1.0 \ -D CMAKE_TOOLCHAIN_FILE=../platforms/linux/arm-gnueabi.toolchain.cmake \ -D OPENCV_EXTRA_MODULES_PATH=~/opencv_all/opencv_contrib-4.1.0/modules \ -D OPENCV_ENABLE_NONFREE=ON \ -D ENABLE_NEON=ON \ -D ENABLE_VFPV3=ON \ -D BUILD_TESTS=OFF \ -D BUILD_DOCS=OFF \ -D PYTHON2_INCLUDE_PATH=/usr/include/python2.7 \ -D PYTHON2_LIBRARIES=/usr/lib/arm-linux-gnueabihf/libpython2.7.so \ -D PYTHON2_NUMPY_INCLUDE_DIRS=/usr/lib/python2/dist-packages/numpy/core/include \ -D PYTHON3_INCLUDE_PATH=/usr/include/python3.7m \ -D PYTHON3_LIBRARIES=/usr/lib/arm-linux-gnueabihf/libpython3.7m.so \ -D PYTHON3_NUMPY_INCLUDE_DIRS=/usr/lib/python3/dist-packages/numpy/core/include \ -D BUILD_OPENCV_PYTHON2=ON \ -D BUILD_OPENCV_PYTHON3=ON \ -D BUILD_EXAMPLES=OFF ..</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Descripci√≥n de los par√°metros.</b> <div class="spoiler_text">  CMAKE_INSTALL_PREFIX - Directorio donde se ubicar√°n los datos recopilados <br>  CMAKE_TOOLCHAIN_FILE: par√°metro que muestra a Cmake qu√© ser√° la compilaci√≥n cruzada <br>  OPENCV_EXTRA_MODULES_PATH - Ruta a m√≥dulos adicionales de OpenCV <br>  OPENCV_ENABLE_NONFREE = ON - Incluye algoritmos patentados en el ensamblaje <br>  Tenga en cuenta que se aplican restricciones de patentes al uso de los algoritmos SIFT y SURF.  Y si planea ensamblar para uso comercial, piense si los necesita y verifique las limitaciones. <br>  ENABLE_NEON = ON - Habilita las instrucciones NEON para la optimizaci√≥n de ARM <br>  ENABLE_VFPV3 = ON - Habilita las instrucciones VFPv3-D32 para la optimizaci√≥n de ARM <br>  BUILD_TESTS = OFF - Desactiva las reglas para crear pruebas (ser√° m√°s r√°pido) <br>  BUILD_DOCS = OFF - Desactivar reglas para la documentaci√≥n de construcci√≥n <br>  PYTHON2_INCLUDE_PATH - Ruta a python2.7 <br>  PYTHON2_LIBRARIES: ruta a la biblioteca libpython2 descargada previamente <br>  PYTHON2_NUMPY_INCLUDE_DIRS - Ruta a NumPy para python2.7 <br>  PYTHON3_INCLUDE_PATH - Ruta a python3 <br>  PYTHON3_LIBRARIES: ruta a la biblioteca libpython3 descargada anteriormente <br>  PYTHON3_NUMPY_INCLUDE_DIRS - Ruta de acceso a NumPy para python3 <br>  BUILD_OPENCV_PYTHON2 = ON - Incluye reglas para python2 en el ensamblaje <br>  BUILD_OPENCV_PYTHON3 = ON - Incluye reglas para python4 en el ensamblaje <br>  BUILD_EXAMPLES = OFF - Desactiva las reglas para ensamblar todos los ejemplos <br></div></div><br>  Si no tuvo errores, como resultado recibir√° un Makefile en la carpeta de ensamblaje.  Ahora podemos comenzar la compilaci√≥n real: <br><br><pre> <code class="bash hljs">make -j16</code> </pre><br>  [ <i>El art√≠culo indica 16 procesos paralelos durante el ensamblaje, pero este par√°metro deber√° seleccionarse para su sistema operativo host</i> ] <br><br>  Una vez completada la fase de compilaci√≥n, podemos instalar la biblioteca: <br><br><pre> <code class="bash hljs">sudo make install/strip</code> </pre><br>  Luego, necesitamos cambiar el nombre de la biblioteca, que el instalador llam√≥ err√≥neamente la biblioteca x86_64, aunque en realidad es armhf: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /opt/opencv-4.1.0/lib/python3.7/dist-packages/cv2/python-3.7/ sudo cp cv2.cpython-37m-x86_64-linux-gnu.so cv2.so</code> </pre><br>  Comprimamos la carpeta de instalaci√≥n y guardemos el archivo en el directorio de inicio: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /opt tar -cjvf ~/opencv-4.1.0-armhf.tar.bz2 opencv-4.1.0 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~</code> </pre><br>  Para facilitarnos la vida, tambi√©n prepar√© un archivo de configuraci√≥n simple pkg-config llamado opencv.pc.  Puedes descargarlo de esta manera: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://gist.github.com/sol-prog/ed383474872958081985de733eaf352d opencv_cpp_compile_settings <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> opencv_cpp_compile_settings cp opencv.pc ~ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~</code> </pre><br>  [ <i>En realidad, no es necesario hacer esto en la m√°quina host.</i>  <i>Puede descargar el archivo directamente a Raspberry.</i>  <i>Pero el autor deseaba hacerlo en este orden</i> ] <br><br><div class="spoiler">  <b class="spoiler_title">opencv.pc</b> <div class="spoiler_text">  <i>Como el archivo es relativamente peque√±o, perm√≠teme insertarlo en el texto del art√≠culo:</i> <br><br><pre> <code class="plaintext hljs">libdir = /opt/opencv-4.1.0/lib includedir = /opt/opencv-4.1.0/include/opencv4 Name: OpenCV Description: OpenCV (Open Source Computer Vision Library) is an open source computer vision and machine learning software library. Version: 4.1.0 Libs: -L${libdir} -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_calib3d -lopencv_ccalib -lopencv_core -lopencv_datasets -lopencv_dnn_objdetect -lopencv_dnn -lopencv_dpm -lopencv_face -lopencv_features2d -lopencv_flann -lopencv_freetype -lopencv_fuzzy -lopencv_gapi -lopencv_hfs -lopencv_highgui -lopencv_imgcodecs -lopencv_img_hash -lopencv_imgproc -lopencv_line_descriptor -lopencv_ml -lopencv_objdetect -lopencv_optflow -lopencv_phase_unwrapping -lopencv_photo -lopencv_plot -lopencv_quality -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_shape -lopencv_stereo -lopencv_stitching -lopencv_structured_light -lopencv_superres -lopencv_surface_matching -lopencv_text -lopencv_tracking -lopencv_videoio -lopencv_video -lopencv_videostab -lopencv_xfeatures2d -lopencv_ximgproc -lopencv_xobjdetect -lopencv_xphoto Cflags: -I${includedir}</code> -lopencv_bgsegm -lopencv_bioinspired -lopencv_calib3d -lopencv_ccalib -lopencv_core -lopencv_datasets -lopencv_dnn_objdetect -lopencv_dnn -lopencv_dpm -lopencv_face -lopencv_features2d -lopencv_flann -lopencv_freetype -lopencv_fuzzy -lopencv_gapi -lopencv_hfs -lopencv_highgui -lopencv_imgcodecs -lopencv_img_hash -lopencv_imgproc <code class="plaintext hljs">libdir = /opt/opencv-4.1.0/lib includedir = /opt/opencv-4.1.0/include/opencv4 Name: OpenCV Description: OpenCV (Open Source Computer Vision Library) is an open source computer vision and machine learning software library. Version: 4.1.0 Libs: -L${libdir} -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_calib3d -lopencv_ccalib -lopencv_core -lopencv_datasets -lopencv_dnn_objdetect -lopencv_dnn -lopencv_dpm -lopencv_face -lopencv_features2d -lopencv_flann -lopencv_freetype -lopencv_fuzzy -lopencv_gapi -lopencv_hfs -lopencv_highgui -lopencv_imgcodecs -lopencv_img_hash -lopencv_imgproc -lopencv_line_descriptor -lopencv_ml -lopencv_objdetect -lopencv_optflow -lopencv_phase_unwrapping -lopencv_photo -lopencv_plot -lopencv_quality -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_shape -lopencv_stereo -lopencv_stitching -lopencv_structured_light -lopencv_superres -lopencv_surface_matching -lopencv_text -lopencv_tracking -lopencv_videoio -lopencv_video -lopencv_videostab -lopencv_xfeatures2d -lopencv_ximgproc -lopencv_xobjdetect -lopencv_xphoto Cflags: -I${includedir}</code> -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_shape -lopencv_stereo -lopencv_stitching -lopencv_structured_light -lopencv_superres -lopencv_surface_matching -lopencv_text -lopencv_tracking -lopencv_videoio -lopencv_video -lopencv_videostab -lopencv_xfeatures2d -lopencv_ximgproc -lopencv_xobjdetect <code class="plaintext hljs">libdir = /opt/opencv-4.1.0/lib includedir = /opt/opencv-4.1.0/include/opencv4 Name: OpenCV Description: OpenCV (Open Source Computer Vision Library) is an open source computer vision and machine learning software library. Version: 4.1.0 Libs: -L${libdir} -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_calib3d -lopencv_ccalib -lopencv_core -lopencv_datasets -lopencv_dnn_objdetect -lopencv_dnn -lopencv_dpm -lopencv_face -lopencv_features2d -lopencv_flann -lopencv_freetype -lopencv_fuzzy -lopencv_gapi -lopencv_hfs -lopencv_highgui -lopencv_imgcodecs -lopencv_img_hash -lopencv_imgproc -lopencv_line_descriptor -lopencv_ml -lopencv_objdetect -lopencv_optflow -lopencv_phase_unwrapping -lopencv_photo -lopencv_plot -lopencv_quality -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_shape -lopencv_stereo -lopencv_stitching -lopencv_structured_light -lopencv_superres -lopencv_surface_matching -lopencv_text -lopencv_tracking -lopencv_videoio -lopencv_video -lopencv_videostab -lopencv_xfeatures2d -lopencv_ximgproc -lopencv_xobjdetect -lopencv_xphoto Cflags: -I${includedir}</code> </pre><br></div></div><br>  Copie opencv-4.1.0-armhf.tar.bz2 y opencv.pc de su carpeta de inicio en RPi. <br><br>  En la siguiente parte del art√≠culo, supongo que ya <b>est√° haciendo</b> todo <b>en su Raspberry Pi</b> . <br><br>  Aseg√∫rese de que su RPi tenga todas las bibliotecas de desarrollo que utilizamos.  Como antes, si no planea usar GTK +, ignore la primera l√≠nea de los siguientes comandos.  La mayor√≠a de estas bibliotecas ya deber√≠an estar instaladas si est√° utilizando la versi√≥n completa de Raspbian: <br><br><pre> <code class="bash hljs">sudo apt install libgtk-3-dev libcanberra-gtk3-dev sudo apt install libtiff-dev zlib1g-dev sudo apt install libjpeg-dev libpng-dev sudo apt install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev sudo apt-get install libxvidcore-dev libx264-dev</code> </pre><br>  Descomprima y mueva la biblioteca a la carpeta / opt de su RPi: <br><br><pre> <code class="bash hljs">tar xfv opencv-4.1.0-armhf.tar.bz2 sudo mv opencv-4.1.0 /opt</code> </pre><br>  Si lo desea, puede eliminar el archivo: <br><br><pre> <code class="bash hljs">rm opencv-4.1.0-armhf.tar.bz2</code> </pre><br>  A continuaci√≥n, tambi√©n vamos a mover opencv.pc a una carpeta donde pkg-config pueda encontrarlo: <br><br><pre> <code class="bash hljs">sudo mv opencv.pc /usr/lib/arm-linux-gnueabihf/pkgconfig</code> </pre><br>  Para que el sistema operativo pueda encontrar las bibliotecas de OpenCV, debemos agregarlas a la ruta de la biblioteca: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'export LD_LIBRARY_PATH=/opt/opencv-4.1.0/lib:$LD_LIBRARY_PATH'</span></span> &gt;&gt; .bashrc <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> .bashrc</code> </pre><br>  Cierre sesi√≥n e inicie sesi√≥n o reinicie la Terminal. <br><br>  A continuaci√≥n, cree algunos enlaces simb√≥licos que permitir√°n a Python cargar las bibliotecas reci√©n creadas: <br><br><pre> <code class="bash hljs">sudo ln -s /opt/opencv-4.1.0/lib/python2.7/dist-packages/cv2 /usr/lib/python2.7/dist-packages/cv2 sudo ln -s /opt/opencv-4.1.0/lib/python3.7/dist-packages/cv2 /usr/lib/python3/dist-packages/cv2</code> </pre><br>  En este punto, puede usar la biblioteca OpenCV de C ++ o Python. <br>  En el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio</a> de este art√≠culo, puede encontrar varios programas de prueba en C ++ y Python.  Puede descargar el c√≥digo en su Pi usando los comandos: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/sol-prog/raspberry-pi-opencv.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> raspberry-pi-opencv/tests</code> </pre><br>  Hay dos pruebas independientes que puede usar incluso si no tiene una pantalla conectada a su RPi: cli_cpp_test.cpp y cli_python_test.py.  Tambi√©n inclu√≠ dos pruebas de gr√°ficos que requieren visualizaci√≥n: gui_cpp_test.cpp y gui_python_test.py. <br><br>  Puede crear y ejecutar pruebas de C ++ de la siguiente manera: <br><br><pre> <code class="bash hljs">g++ cli_cpp_test.cpp -o cli_cpp_test `pkg-config --cflags --libs opencv` ./cli_cpp_test</code> </pre><br>  Y, si tiene una pantalla conectada a su RPi: <br><br><pre> <code class="bash hljs">g++ gui_cpp_test.cpp -o gui_cpp_test `pkg-config --cflags --libs opencv` ./gui_cpp_test</code> </pre><br>  Aqu√≠ hay una captura de pantalla de la prueba de GUI de C ++ que se ejecuta en mi Pi: <br><br><img src="https://habrastorage.org/webt/wu/fx/jt/wufxjtxgrqa-mymc6evbxj1jbx4.jpeg"><br><br>  Para las pruebas de Python, use: <br><br><pre> <code class="bash hljs">python3 cli_python_test.py</code> </pre><br>  o <br><br><pre> <code class="bash hljs">python3 gui_python_test.py</code> </pre><br>  Como nota, tambi√©n es posible realizar una compilaci√≥n cruzada de programas C ++ usando OpenCV en su sistema Debian x86-64 y ejecutar c√≥digo binario en su RPi. <br><br>  [ <i>M√°s adelante en el art√≠culo, el autor recomienda leer el libro de Derek Molloy sobre programaci√≥n para RaspberryPi.</i>  <i>Puede encontrar el enlace de referencia al libro en el art√≠culo original</i> ]. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace al art√≠culo original</a> <br><br><div class="spoiler">  <b class="spoiler_title">Una peque√±a adici√≥n de mi parte</b> <div class="spoiler_text">  Prepar√© un Dockerfile que le permitir√° realizar todos los pasos del art√≠culo sin tener que implementar una m√°quina virtual. <br><br>  Proceso de instalaci√≥n: <br>  Crea un Dockerfile. <br><br><pre> <code class="bash hljs">mkdir opencv &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> opencv &amp;&amp; mkdir armhf_opencv touch armhf_opencv/Dockerfile nano armhf_opencv/Dockerfile</code> </pre><br>  Luego, inserte el c√≥digo en el Dockerfile y luego comenzamos el ensamblaje de la imagen. <br><br><pre> <code class="bash hljs">docker image build armhf_opencv/</code> </pre><br>  Una vez completada la compilaci√≥n, deber√≠a ver el identificador de la imagen ensamblada: <br><br><pre> <code class="bash hljs">&gt;&gt;&gt; Successfully built babdc99ba2d8</code> </pre><br>  Usamos este identificador para establecer la etiqueta para la imagen y ejecutarla: <br><br><pre> <code class="bash hljs">docker tag babdc99ba2d8 armhf_opencv:latest docker run armhf_opencv</code> </pre><br>  Despu√©s de iniciar el contenedor, es necesario extraer el archivo recopilado y el archivo opencv.pc del mismo.  Para hacer esto, necesitamos su identificador: <br><br><pre> <code class="bash hljs">docker container ls --all &gt;&gt;&gt; CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES &gt;&gt;&gt; 369dff5a0a9b armhf_opencv <span class="hljs-string"><span class="hljs-string">"bash"</span></span> 9 seconds ago Exited (0) 7 seconds ago affectionate_wu</code> </pre><br>  Copie los archivos que necesitamos en el directorio actual: <br><br><pre> <code class="bash hljs">docker cp 369dff5a0a9b:/root/opencv-4.1.0-armhf.tar.bz2 ./ docker cp 369dff5a0a9b:/root/opencv.pc ./</code> </pre><br>  Despu√©s de eso, recomiendo eliminar la imagen, ya que ocupa 2.5GB de espacio. <br><br>  Construir a trav√©s de Docker en mi i59600K con 16GB tom√≥ aproximadamente 30-40 minutos, y pas√© mucho tiempo descargando datos del repositorio. <br><br>  Adem√°s, el proceso de instalaci√≥n en Raspberry Pi no es diferente del descrito en el art√≠culo. <br><br>  Dockerfile en s√≠: <br><br><pre> <code class="plaintext hljs">FROM debian:buster USER root RUN apt update &amp;&amp; apt upgrade RUN dpkg --add-architecture armhf &amp;&amp; \ apt update &amp;&amp; apt install -y qemu-user-static RUN apt install -y python3-dev python3-numpy python-dev python-numpy RUN apt install -y libpython2-dev:armhf libpython3-dev:armhf \ libgtk-3-dev:armhf libcanberra-gtk3-dev:armhf \ libtiff-dev:armhf zlib1g-dev:armhf \ libjpeg-dev:armhf libpng-dev:armhf \ libavcodec-dev:armhf libavformat-dev:armhf \ libswscale-dev:armhf libv4l-dev:armhf \ libxvidcore-dev:armhf libx264-dev:armhf RUN apt install -y crossbuild-essential-armhf gfortran-arm-linux-gnueabihf RUN apt install -y cmake git pkg-config wget RUN mkdir opencv_all &amp;&amp; cd opencv_all &amp;&amp; \ wget -O opencv.tar.gz https://github.com/opencv/opencv/archive/4.1.0.tar.gz &amp;&amp; \ tar -xf opencv.tar.gz -C /tmp &amp;&amp; \ wget -O opencv_contrib.tar.gz https://github.com/opencv/opencv_contrib/archive/4.1.0.tar.gz &amp;&amp; \ tar -xf opencv_contrib.tar.gz -C /tmp &amp;&amp; \ rm *.tar.gz &amp;&amp; \ export PKG_CONFIG_PATH=/usr/lib/arm-linux-gnueabihf/pkgconfig:/usr/share/pkgconfig &amp;&amp; \ export PKG_CONFIG_LIBDIR=/usr/lib/arm-linux-gnueabihf/pkgconfig:/usr/share/pkgconfig &amp;&amp; \ cd /tmp/opencv-4.1.0 &amp;&amp; mkdir build &amp;&amp; cd build &amp;&amp; \ cmake -D CMAKE_BUILD_TYPE=RELEASE \ -D CMAKE_INSTALL_PREFIX=/opt/opencv-4.1.0 \ -D CMAKE_TOOLCHAIN_FILE=../platforms/linux/arm-gnueabi.toolchain.cmake \ -D OPENCV_EXTRA_MODULES_PATH=/tmp/opencv_contrib-4.1.0/modules \ -D OPENCV_ENABLE_NONFREE=ON \ -D ENABLE_NEON=ON \ -D ENABLE_VFPV3=ON \ -D BUILD_TESTS=OFF \ -D BUILD_DOCS=OFF \ -D PYTHON2_INCLUDE_PATH=/usr/include/python2.7 \ -D PYTHON2_LIBRARIES=/usr/lib/arm-linux-gnueabihf/libpython2.7.so \ -D PYTHON2_NUMPY_INCLUDE_DIRS=/usr/lib/python2/dist-packages/numpy/core/include \ -D PYTHON3_INCLUDE_PATH=/usr/include/python3.7m \ -D PYTHON3_LIBRARIES=/usr/lib/arm-linux-gnueabihf/libpython3.7m.so \ -D PYTHON3_NUMPY_INCLUDE_DIRS=/usr/lib/python3/dist-packages/numpy/core/include \ -D BUILD_OPENCV_PYTHON2=ON \ -D BUILD_OPENCV_PYTHON3=ON \ -D BUILD_EXAMPLES=OFF .. &amp;&amp; \ make -j6 &amp;&amp; make install/strip RUN cd /opt/opencv-4.1.0/lib/python3.7/dist-packages/cv2/python-3.7/ &amp;&amp; \ cp cv2.cpython-37m-x86_64-linux-gnu.so cv2.so RUN cd /opt &amp;&amp; tar -cjvf /root/opencv-4.1.0-armhf.tar.bz2 opencv-4.1.0 RUN git clone https://gist.github.com/sol-prog/ed383474872958081985de733eaf352d opencv_cpp_compile_settings &amp;&amp; \ cd opencv_cpp_compile_settings &amp;&amp; \ cp opencv.pc /root/</code> </pre><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/461693/">https://habr.com/ru/post/461693/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461679/index.html">Bibliotecas de arte electr√≥nico de casi buena calidad</a></li>
<li><a href="../461685/index.html">Terapia con LED, o "manzanas juveniles" del siglo XXI</a></li>
<li><a href="../461687/index.html">Docker + Laravel + RoadRunner = ‚ù§</a></li>
<li><a href="../461689/index.html">Identificaci√≥n de desarrollador de IoT</a></li>
<li><a href="../461691/index.html">C√≥mo cerramos las vulnerabilidades en el sistema operativo Astra Linux Special Edition</a></li>
<li><a href="../461695/index.html">Pasant√≠a VFX</a></li>
<li><a href="../461697/index.html">Cerveza inteligencia</a></li>
<li><a href="../461699/index.html">Volcanic Piglet, o SQL de bricolaje</a></li>
<li><a href="../461703/index.html">Informes de micropasos en el trabajo de un programador</a></li>
<li><a href="../461707/index.html">Las aventuras de los esquivos Malvari, Parte V: m√°s scripts de DDE y COM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>