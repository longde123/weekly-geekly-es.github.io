<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💣 🕟 🕕 Eine Möglichkeit, das Workload-Profil abzurufen und den Verlauf in PostgreSQL zu warten ☎️ 🚠 👩🏾‍🤝‍👨🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fortsetzung des Artikels " Versuch, ein Analogon von ASH für PostgreSQL zu erstellen ". 

 Der Artikel wird in bestimmten Abfragen und Beispielen betr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eine Möglichkeit, das Workload-Profil abzurufen und den Verlauf in PostgreSQL zu warten</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467575/"> Fortsetzung des Artikels " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Versuch, ein Analogon von ASH für PostgreSQL zu erstellen</a> ". <br><br>  Der Artikel wird in bestimmten Abfragen und Beispielen betrachtet und angezeigt. Welche nützlichen Informationen können mithilfe des Präsentationsverlaufs pg_stat_activity abgerufen werden? <br><blockquote>  Warnung <br>  Aufgrund der Neuheit des Themas und des unvollständigen Testzeitraums kann der Artikel Fehler enthalten.  Kritik und Kommentare werden nachdrücklich ermutigt und erwartet. </blockquote><a name="habracut"></a><h2>  Daten eingeben </h2><br><h3>  Verlauf anzeigen pg_stat_statements </h3><br><div class="spoiler">  <b class="spoiler_title">pg_stat_history</b> <div class="spoiler_text"><pre><code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> pg_stat_history ( id <span class="hljs-type"><span class="hljs-type">SERIAL</span></span>, snapshot_timestamp <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, database_id <span class="hljs-type"><span class="hljs-type">integer</span></span>, dbid <span class="hljs-type"><span class="hljs-type">oid</span></span>, userid <span class="hljs-type"><span class="hljs-type">oid</span></span>, queryid <span class="hljs-type"><span class="hljs-type">bigint</span></span>, query <span class="hljs-type"><span class="hljs-type">text</span></span>, calls <span class="hljs-type"><span class="hljs-type">bigint</span></span>, total_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, min_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, max_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, mean_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, stddev_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span> <span class="hljs-type"><span class="hljs-type">bigint</span></span>, shared_blks_hit <span class="hljs-type"><span class="hljs-type">bigint</span></span>, shared_blks_read <span class="hljs-type"><span class="hljs-type">bigint</span></span>, shared_blks_dirtied <span class="hljs-type"><span class="hljs-type">bigint</span></span>, shared_blks_written <span class="hljs-type"><span class="hljs-type">bigint</span></span>, local_blks_hit <span class="hljs-type"><span class="hljs-type">bigint</span></span>, local_blks_read <span class="hljs-type"><span class="hljs-type">bigint</span></span>, local_blks_dirtied <span class="hljs-type"><span class="hljs-type">bigint</span></span>, local_blks_written <span class="hljs-type"><span class="hljs-type">bigint</span></span>, temp_blks_read <span class="hljs-type"><span class="hljs-type">bigint</span></span>, temp_blks_written <span class="hljs-type"><span class="hljs-type">bigint</span></span>, blk_read_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, blk_write_time <span class="hljs-type"><span class="hljs-type">double</span></span> <span class="hljs-type"><span class="hljs-type">precision</span></span>, baseline_id <span class="hljs-type"><span class="hljs-type">integer</span></span> );</code> </pre> </div></div><br>  Die Tabelle wird stündlich mit dblink zur Zieldatenbank gefüllt.  Die interessanteste und nützlichste Spalte in der Tabelle ist natürlich <b>queryid</b> . <br><br><h3>  Verlauf der Pg_stat_activity-Ansicht </h3><br><div class="spoiler">  <b class="spoiler_title">archive_pg_stat_activity</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> archive_pg_stat_activity ( timepoint <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, datid <span class="hljs-type"><span class="hljs-type">oid</span></span>, datname <span class="hljs-type"><span class="hljs-type">name</span></span>, pid <span class="hljs-type"><span class="hljs-type">integer</span></span>, usesysid <span class="hljs-type"><span class="hljs-type">oid</span></span>, usename <span class="hljs-type"><span class="hljs-type">name</span></span>, application_name <span class="hljs-type"><span class="hljs-type">text</span></span>, client_addr <span class="hljs-type"><span class="hljs-type">inet</span></span>, client_hostname <span class="hljs-type"><span class="hljs-type">text</span></span>, client_port <span class="hljs-type"><span class="hljs-type">integer</span></span>, backend_start <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, xact_start <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, query_start <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, state_change <span class="hljs-type"><span class="hljs-type">timestamp</span></span> <span class="hljs-type"><span class="hljs-type">without time zone</span></span>, wait_event_type <span class="hljs-type"><span class="hljs-type">text</span></span>, wait_event <span class="hljs-type"><span class="hljs-type">text</span></span>, state <span class="hljs-type"><span class="hljs-type">text</span></span>, backend_xid xid, backend_xmin xid, query <span class="hljs-type"><span class="hljs-type">text</span></span>, backend_type <span class="hljs-type"><span class="hljs-type">text</span></span>, queryid <span class="hljs-type"><span class="hljs-type">bigint</span></span> );</code> </pre> </div></div><br>  Die Tabelle ist eine uhrpartitionierte history_pg_stat_activity-Tabelle (Weitere Informationen finden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie unter pg_stat_statements + pg_stat_activity + loq_query = pg_ash?</a> Und hier ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Versuch, ein Analogon von ASH für PostgreSQL zu erstellen.)</a> <br><br><h2>  Impressum </h2><br><h3>  CLUSTER-CPU-ZEIT (SYSTEM + KUNDEN) </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> date_trunc(<span class="hljs-string"><span class="hljs-string">'second'</span></span>, timepoint) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ( aa.wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> aa.state = <span class="hljs-string"><span class="hljs-string">'active'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> cpu_total <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t ;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">CLUSTER CPU TIME (SYSTEM + CLIENTS ) : 28:37:46</code> </pre> </div></div><br><h3>  CLUSTER WARTET ZEIT </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> date_trunc(<span class="hljs-string"><span class="hljs-string">'second'</span></span>, timepoint) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ( aa.wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> aa.state = <span class="hljs-string"><span class="hljs-string">'active'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> cpu_total <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t ;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">CLUSTER WAITINGS TIME : 30:12:49</code> </pre> </div></div><br><h3>  Summe der pg_stat_statements-Werte </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"> <span class="hljs-comment"><span class="hljs-comment">--TOTAL pg_stat SELECT SUM(calls) AS calls, SUM(total_time) AS total_time, SUM(rows) AS rows , SUM(shared_blks_hit) AS shared_blks_hit,SUM(shared_blks_read) AS shared_blks_read , SUM(shared_blks_dirtied) AS shared_blks_dirtied,SUM(shared_blks_written) AS shared_blks_written , SUM(local_blks_hit) AS local_blks_hit , SUM(local_blks_read) AS local_blks_read , SUM(local_blks_dirtied) AS local_blks_dirtied , SUM(local_blks_written) AS local_blks_written, SUM(temp_blks_read) AS temp_blks_read, SUM(temp_blks_written) temp_blks_written , SUM(blk_read_time) AS blk_read_time , SUM(blk_write_time) AS blk_write_time INTO pg_total_stat_history_rec FROM pg_stat_history WHERE snapshot_timestamp BETWEEN pg_stat_history_begin AND pg_stat_history_end AND queryid IS NULL;</span></span></code> </pre> </div></div><br><h3>  SQL DBTIME - Total Query Runtime </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs">dbtime_total = <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 millisecond'</span></span> * pg_total_stat_history_rec.total_time ;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">SQL DBTIME : 136:49:36</code> </pre> </div></div><br><h3>  SQL CPU TIME Zeit der CPU, die für die Ausführung von Abfragen aufgewendet wurde </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> date_trunc(<span class="hljs-string"><span class="hljs-string">'second'</span></span>, timepoint) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ( aa.wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type = <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> aa.state = <span class="hljs-string"><span class="hljs-string">'active'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> cpu_total <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t ;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">SQL CPU TIME : 27:40:15</code> </pre> </div></div><br><h3>  SQL WAITINGS TIME - Gesamtwartezeit für Abfragen </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> date_trunc(<span class="hljs-string"><span class="hljs-string">'second'</span></span>, timepoint) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ( aa.wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> aa.state = <span class="hljs-string"><span class="hljs-string">'active'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type = <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> waiting_total <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t ;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">SQL WAITINGS TIME : 30:04:09</code> </pre> </div></div><br>  Die folgenden Abfragen sind trivial und um Platz zu sparen, werden Implementierungsdetails weggelassen: <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">| SQL IOTIME : 19:44:50 | SQL READ TIME : 19:44:32 | SQL WRITE TIME : 00:00:17 | | SQL CALLS : 12188248 ------------------------------------------------------------- | SQL SHARED BLOCKS READS : 7997039120 | SQL SHARED BLOCKS HITS : 8868286092 | SQL SHARED BLOCKS HITS/READS % : 110.89 | SQL SHARED BLOCKS DIRTED : 419945 | SQL SHARED BLOCKS WRITTEN : 19857 | | SQL TEMPORARY BLOCKS READS : 7836169 | SQL TEMPORARY BLOCKS WRITTEN : 10683938</code> </pre></div></div><br>  Wir kommen zum interessantesten Abschnitt <br><br><h2>  WARTUNGSSTATIK </h2><br><h3>  TOP 10 WARTUNGEN NACH GESAMTWARTUNG FÜR KUNDENPROZESSE </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wait_event_type , wait_event , get_system_waiting_duration( wait_event_type , wait_event ,pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ,pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type != <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> wait_event_type, wait_event <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre>  + --------------------------------------------- -----------------------------------
 |  TOP 10 WARTUNGEN NACH GESAMTWARTUNG FÜR SYSTEMPROZESSE
 + ----- + ------------------------------ + ------------ -------- + --------------------
 |  # |  wait_event_type |  wait_event |  Dauer
 + ----- + ------------------------------ + ------------ -------- + --------------------
 |  1 |  Aktivität |  LogicalLauncherMain |  10:43:28
 |  2 |  Aktivität |  AutoVacuumMain |  10:42:49
 |  3 |  Aktivität |  WalWriterMain |  10:28:53
 |  4 |  Aktivität |  CheckpointerMain |  10:23:50
 |  5 |  Aktivität |  BgWriterMain |  09:11:59
 |  6 |  Aktivität |  BgWriterHibernate |  01:37:46
 |  7 |  IO |  BufFileWrite |  00:02:35
 |  8 |  LWLock |  buffer_mapping |  00:01:54
 |  9 |  IO |  DataFileRead |  00:01:23
 |  10 |  IO |  WALWrite |  00:00:59
 + ----- + ------------------------------ + ------------ -------- + --------------------
</pre></div></div><br><h3>  TOP 10 WARTUNGEN NACH GESAMTWARTUNG FÜR KUNDENPROZESSE </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wait_event_type , wait_event , get_clients_waiting_duration( wait_event_type , wait_event , pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) , pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type = <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> wait_event_type, wait_event <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre>  + ----- + ------------------------------ + ------------ -------- + -------------------- + ----------
 |  # |  wait_event_type |  wait_event |  Dauer |  % dbtime
 + ----- + ------------------------------ + ------------ -------- + -------------------- + ----------
 |  1 |  Sperre |  Transaktions-ID |  08: 16: 47 |  6.05
 |  2 |  IO |  DataFileRead |  06: 13: 41 |  4.55
 |  3 |  Zeitüberschreitung |  PgSleep |  02: 53: 21 |  2.11
 |  4 |  LWLock |  buffer_mapping |  00: 40: 42 |  0,5
 |  5 |  LWLock |  buffer_io |  00: 17: 17 |  0,21
 |  6 |  IO |  BufFileWrite |  00: 01: 34 |  0,02
 |  7 |  Sperre |  Tupel |  00: 01: 32 |  0,02
 |  8 |  Client |  ClientRead |  00: 01: 19 |  0,02
 |  9 |  IO |  BufFileRead |  00: 00: 37 |  0,01
 |  10 |  LWLock |  buffer_content |  00: 00: 08 |  0
 + ----- + ------------------------------ + ------------ -------- + -------------------- + ----------
</pre></div></div><br><h3>  WARTETYPEN NACH GESAMTWARTZEIT FÜR SYSTEMPROZESSE </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wait_event_type , get_system_waiting_type_duration( wait_event_type , pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) , pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type != <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre>  + ----- + ------------------------------ + ------------ --------
 |  # |  wait_event_type |  Dauer
 + ----- + ------------------------------ + ------------ --------
 |  1 |  Aktivität |  53:08:45
 |  2 |  IO |  00:06:24
 |  3 |  LWLock |  00:03:02
 + ----- + ------------------------------ + ------------ --------
</pre></div></div><br><h3>  WARTETYPEN NACH GESAMTWARTUNG FÜR KUNDENPROZESSE </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> wait_event_type , get_clients_waiting_type_duration( wait_event_type , pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) , pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type = <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre>  + ----- + ------------------------------ + ------------ -------- + --------------------
 |  # |  wait_event_type |  Dauer |  % dbtime
 + ----- + ------------------------------ + ------------ -------- + --------------------
 |  1 |  Sperre |  08: 18: 19 |  6.07
 |  2 |  IO |  06: 16: 01 |  4.58
 |  3 |  Zeitüberschreitung |  02: 53: 21 |  2.11
 |  4 |  LWLock |  00: 58: 12 |  0,71
 |  5 |  Client |  00: 01: 19 |  0,02
 |  6 |  IPC |  00: 00: 04 |  0
 + ----- + ------------------------------ + ------------ -------- + --------------------
</pre></div></div><br>  Dauer der Erwartungen, für Systemprozesse und individuelle Anforderungen. <br><br><h3>  WARTEN AUF SYSTEMPROZESSE </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> backend_type , datname , wait_event_type , wait_event , get_backend_type_waiting_duration( backend_type , wait_event_type , wait_event , pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) , pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type != <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> backend_type , datname , wait_event_type , wait_event <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre>  + ----- + ----------------------------- + ---------- + - ------------------ + ---------------------- + -------- ------------
 |  # |  backend_type |  Datenbankname |  wait_event_type |  wait_event |  Dauer
 + ----- + ----------------------------- + ---------- + - ------------------ + ---------------------- + -------- ------------
 |  1 |  logischer Replikationsstarter |  |  Aktivität |  LogicalLauncherMain |  10:43:28
 |  2 |  Autovakuum-Starter |  |  Aktivität |  AutoVacuumMain |  10:42:49
 |  3 |  Walwriter |  |  Aktivität |  WalWriterMain |  10:28:53
 |  4 |  Checkpointer |  |  Aktivität |  CheckpointerMain |  10:23:50
 |  5 |  Hintergrundschreiber |  |  Aktivität |  BgWriterMain |  09:11:59
 |  6 |  Hintergrundschreiber |  |  Aktivität |  BgWriterHibernate |  01:37:46
 |  7 |  Parallelarbeiter |  tdb1 |  IO |  BufFileWrite |  00:02:35
 |  8 |  Parallelarbeiter |  tdb1 |  LWLock |  buffer_mapping |  00:01:41
 |  9 |  Parallelarbeiter |  tdb1 |  IO |  DataFileRead |  00:01:22
 |  10 |  Parallelarbeiter |  tdb1 |  IO |  BufFileRead |  00:00:59
 |  11 |  Walwriter |  |  IO |  WALWrite |  00:00:57
 |  12 |  Parallelarbeiter |  tdb1 |  LWLock |  buffer_io |  00:00:47
 |  13 |  Autovakuumarbeiter |  tdb1 |  LWLock |  buffer_mapping |  00:00:13
 |  14 |  Hintergrundschreiber |  |  IO |  DataFileWrite |  00:00:12
 |  15 |  Checkpointer |  |  IO |  DataFileWrite |  00:00:11
 |  16 |  Walwriter |  |  LWLock |  WALWriteLock |  00:00:09
 |  17 |  Checkpointer |  |  LWLock |  WALWriteLock |  00:00:06
 |  18 |  Hintergrundschreiber |  |  LWLock |  WALWriteLock |  00:00:06
 |  19 |  Walwriter |  |  IO |  WALInitWrite |  00:00:02
 |  20 |  Autovakuumarbeiter |  tdb1 |  LWLock |  WALWriteLock |  00:00:02
 |  21 |  Walwriter |  |  IO |  WALInitSync |  00:00:02
 |  22 |  Autovakuumarbeiter |  tdb1 |  IO |  DataFileRead |  00:00:01
 |  23 |  Checkpointer |  |  IO |  ControlFileSyncUpdate |  00:00:01
 |  24 |  Hintergrundschreiber |  |  IO |  WALWrite |  00:00:01
 |  25 |  Hintergrundschreiber |  |  IO |  DataFileFlush |  00:00:01
 |  26 |  Checkpointer |  |  IO |  SLRUFlushSync |  00:00:01
 |  27 |  Autovakuumarbeiter |  tdb1 |  IO |  WALWrite |  00:00:01
 |  28 |  Checkpointer |  |  IO |  DataFileSync |  00:00:01
 + ----- + ----------------------------- + ---------- + - ------------------ + ---------------------- + -------- ------------ </pre></div></div><br><h3>  WARTEN AUF SQL - Erwartungen für einzelne Abfragen von queryid </h3><br><div class="spoiler">  <b class="spoiler_title">Anfrage</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> queryid , datname , wait_event_type , wait_event , get_query_waiting_duration( queryid , wait_event_type , wait_event , pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) , pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> duration <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> activity_hist.archive_pg_stat_activity aa <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> timepoint <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> pg_stat_history_begin+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pg_stat_history_end+(current_hour_diff * <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 hour'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> backend_type = <span class="hljs-string"><span class="hljs-string">'client backend'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> wait_event_type <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> queryid <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> queryid , datname , wait_event_type , wait_event <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> , <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Beispiel</b> <div class="spoiler_text"><pre>  + ----- + ------------------------- + ---------- + ------ -------------- + -------------------- + -------------- ------ + --------------------
 |  # |  queryid |  Datenbankname |  wait_event_type |  wait_event |  Wartezeiten |  insgesamt
 |  |  |  |  |  |  Dauer |  Dauer
 + ----- + ------------------------- + ---------- + ------ -------------- + -------------------- + -------------- ------ + --------------------
 |  1 |  -8247416849404883188 |  tdb1 |  Client |  ClientRead |  00: 00: 02 |
 |  2 |  -6572922443698419129 |  tdb1 |  Client |  ClientRead |  00: 00: 05 |
 |  3 |  -6572922443698419129 |  tdb1 |  IO |  DataFileRead |  00: 00: 01 |
 |  4 |  -5917408132400665328 |  tdb1 |  Client |  ClientRead |  00: 00: 04 |
 |  5 |  -4091009262735781873 |  tdb1 |  Client |  ClientRead |  00: 00: 03 |
 |  6 |  -1473395109729441239 |  tdb1 |  Client |  ClientRead |  00: 00: 01 |
 |  7 |  28942442626229688 |  tdb1 |  IO |  BufFileWrite |  00: 01: 34 |  00:46:06
 |  8 |  28942442626229688 |  tdb1 |  LWLock |  buffer_mapping |  00: 01: 05 |  00:46:06
 |  9 |  28942442626229688 |  tdb1 |  IO |  DataFileRead |  00: 00: 44 |  00:46:06
 |  10 |  28942442626229688 |  tdb1 |  IO |  BufFileRead |  00: 00: 37 |  00:46:06
 |  11 |  28942442626229688 |  tdb1 |  LWLock |  buffer_io |  00: 00: 35 |  00:46:06
 |  12 |  28942442626229688 |  tdb1 |  Client |  ClientRead |  00: 00: 05 |  00:46:06
 |  13 |  28942442626229688 |  tdb1 |  IPC |  MessageQueueReceive |  00: 00: 03 |  00:46:06
 |  14 |  28942442626229688 |  tdb1 |  IPC |  BgWorkerShutdown |  00: 00: 01 |  00:46:06
 |  15 |  389015618226997618 |  tdb1 |  Sperre |  Transaktions-ID |  03: 55: 09 |  04:14:15
 |  16 |  389015618226997618 |  tdb1 |  IO |  DataFileRead |  03: 23: 09 |  04:14:15
 |  17 |  389015618226997618 |  tdb1 |  LWLock |  buffer_mapping |  00: 12: 09 |  04:14:15
 |  18 |  389015618226997618 |  tdb1 |  LWLock |  buffer_io |  00: 10: 18 |  04:14:15
 |  19 |  389015618226997618 |  tdb1 |  Sperre |  Tupel |  00: 00: 35 |  04:14:15
 |  20 |  389015618226997618 |  tdb1 |  LWLock |  WALWriteLock |  00: 00: 02 |  04:14:15
 |  21 |  389015618226997618 |  tdb1 |  IO |  DataFileWrite |  00: 00: 01 |  04:14:15
 |  22 |  389015618226997618 |  tdb1 |  LWLock |  SyncScanLock |  00: 00: 01 |  04:14:15
 |  23 |  389015618226997618 |  tdb1 |  Client |  ClientRead |  00: 00: 01 |  04:14:15
 |  24 |  734234407411547467 |  tdb1 |  Client |  ClientRead |  00: 00: 11 |
 |  25 |  734234407411547467 |  tdb1 |  LWLock |  buffer_mapping |  00: 00: 05 |
 |  26 |  734234407411547467 |  tdb1 |  IO |  DataFileRead |  00: 00: 02 |
 |  27 |  1237430309438971376 |  tdb1 |  LWLock |  buffer_mapping |  00: 02: 18 |  02:45:40
 |  28 |  1237430309438971376 |  tdb1 |  IO |  DataFileRead |  00: 00: 27 |  02:45:40
 |  29 |  1237430309438971376 |  tdb1 |  Client |  ClientRead |  00: 00: 02 |  02:45:40
 |  30 |  2404820632950544954 |  tdb1 |  Client |  ClientRead |  00: 00: 01 |
 |  31 |  2515308626622579467 |  tdb1 |  Client |  ClientRead |  00: 00: 02 |
 |  32 |  4710212362688288619 |  tdb1 |  LWLock |  buffer_mapping |  00: 03: 08 |  02:18:21
 |  33 |  4710212362688288619 |  tdb1 |  IO |  DataFileRead |  00: 00: 22 |  02:18:21
 |  34 |  4710212362688288619 |  tdb1 |  Client |  ClientRead |  00: 00: 06 |  02:18:21
 |  35 |  4710212362688288619 |  tdb1 |  LWLock |  buffer_io |  00: 00: 02 |  02:18:21
 |  36 |  9150846928388977274 |  tdb1 |  IO |  DataFileRead |  00: 01: 19 |
 |  37 |  9150846928388977274 |  tdb1 |  LWLock |  buffer_mapping |  00: 00: 34 |
 |  38 |  9150846928388977274 |  tdb1 |  Client |  ClientRead |  00: 00: 10 |
 |  39 |  9150846928388977274 |  tdb1 |  LWLock |  buffer_io |  00: 00: 01 |
 + ----- + ------------------------- + ---------- + ------ -------------- + -------------------- + -------------- ------ + -------------------- </pre></div></div><br><h3>  CLIENT SQL STATICTICS - TOP-Abfragen </h3><br>  Anfragen für einen erneuten Empfang sind jedoch trivial und aus Platzgründen nicht gegeben. <br><br><div class="spoiler">  <b class="spoiler_title">Beispiele</b> <div class="spoiler_text"><pre>  + --------------------------------------------- -----------------------------------
 |  CLIENT SQL sortiert nach verstrichener Zeit
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + --------------------
 |  verstrichene Zeit |  Anrufe |  % dbtime |  % CPU |  % IO |  Datenbankname |  queryid
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + --------------------
 |  04: 14: 15 |  19 |  3.1 |  10,83 |  11,52 |  tdb1 |  389015618226997618
 |  02: 45: 40 |  746 |  2,02 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 |  02: 18: 21 |  749 |  1,69 |  3,39 |  0,1 |  tdb1 |  4710212362688288619
 |  00: 46: 06 |  375 |  0,56 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + --------------------
 |  CLIENT SQL geordnet nach CPU-Zeit
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  CPU-Zeit |  Anrufe |  % dbtime | total_time |  % CPU |  % IO |  Datenbankname |  queryid
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  02: 59: 49 |  19 |  3.1 |  04: 14: 15 |  10,83 |  11,52 |  tdb1 |  389015618226997618
 |  01: 10: 12 |  746 |  2,02 |  02: 45: 40 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 |  00: 56: 15 |  749 |  1,69 |  02: 18: 21 |  3,39 |  0,1 |  tdb1 |  4710212362688288619
 |  00: 15: 35 |  375 |  0,56 |  00: 46: 06 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  CLIENT SQL sortiert nach Benutzer-E / A-Wartezeit
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  io_wait time |  Anrufe |  % dbtime | total_time |  % CPU |  % IO |  Datenbankname |  queryid
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  03: 23: 10 |  19 |  3.1 |  04: 14: 15 |  10,83 |  11,52 |  tdb1 |  389015618226997618
 |  00: 02: 54 |  375 |  0,56 |  00: 46: 06 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 |  00: 00: 27 |  746 |  2,02 |  02: 45: 40 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 |  00: 00: 22 |  749 |  1,69 |  02: 18: 21 |  3,39 |  0,1 |  tdb1 |  4710212362688288619
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  CLIENT SQL sortiert nach Shared Buffers Reads
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  Puffer liest |  Anrufe |  % dbtime | total_time |  % CPU |  % IO |  Datenbankname |  queryid
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  1056388566 |  19 |  3.1 |  04: 14: 15 |  10,83 |  11,52 |  tdb1 |  389015618226997618
 |  11709251 |  375 |  0,56 |  00: 46: 06 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 |  3439004 |  746 |  2,02 |  02: 45: 40 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 |  3373330 |  749 |  1,69 |  02: 18: 21 |  3,39 |  0,1 |  tdb1 |  4710212362688288619
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  CLIENT SQL sortiert nach Disk Reads Time
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  Lesezeit |  Anrufe |  % dbtime | total_time |  % CPU |  % IO |  Datenbankname |  queryid
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  02: 16: 30 |  19 |  3.1 |  04: 14: 15 |  10,83 |  11,52 |  tdb1 |  389015618226997618
 |  00: 04: 50 |  375 |  0,56 |  00: 46: 06 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 |  00: 01: 10 |  749 |  1,69 |  02: 18: 21 |  3,39 |  0,1 |  tdb1 |  4710212362688288619
 |  00: 00: 57 |  746 |  2,02 |  02: 45: 40 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  CLIENT SQL sortiert nach Ausführungen
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  Anrufe |  Zeilen |  % dbtime | total_time |  % CPU |  % IO |  Datenbankname |  queryid
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ --------
 |  749 |  749 |  1,69 |  02: 18: 21 |  3,39 |  0,1 |  tdb1 |  4710212362688288619
 |  746 |  746 |  2,02 |  02: 45: 40 |  4.23 |  0,08 |  tdb1 |  1237430309438971376
 |  375 |  0 |  0,56 |  00: 46: 06 |  0,94 |  0,41 |  tdb1 |  28942442626229688
 |  19 |  19 |  3.1 |  04: 14: 15 |  10,83 |  11,52 |  tdb1 |  389015618226997618
 + -------------------- + ---------- + ---------- + ------ ---- + ---------- + ---------- + ---------- + ------------ -------- </pre></div></div><br><h2>  Zusammenfassung </h2><br>  Mithilfe der übermittelten Anforderungen und der daraus resultierenden Berichterstellung erhalten Sie ein vollständigeres Bild zur Analyse und Lösung der Probleme einer Leistungsminderung für einzelne Anforderungen und den gesamten Cluster als Ganzes. <br><br><h2>  Entwicklung </h2><br>  Bisher sind die Entwicklungspläne wie folgt: <br><br><ul><li>  Ergänzen Sie die Berichterstellung mit einem Sperrverlauf.  Anfragen werden getestet und in Kürze eingereicht. </li><li>  Verwenden Sie die Erweiterung TimescaleDB, um den Verlauf von pg_stat_activity und pg_locks zu speichern. </li><li>  Bereiten Sie eine Batch-Lösung auf Github für den Masseneinsatz auf Produktionsbasis vor. </li></ul><br>  Fortsetzung folgt… </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de467575/">https://habr.com/ru/post/de467575/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de467559/index.html">Digitale Veranstaltungen in Moskau vom 16. bis 22. September</a></li>
<li><a href="../de467561/index.html">Ein Tag vom PVS-Studio User Support</a></li>
<li><a href="../de467563/index.html">Ein Tag von der PVS-Studio-Benutzerunterstützung</a></li>
<li><a href="../de467567/index.html">Unterstützung für 24-Bit-Farben im Terminal in einer Reihe von ssh + tmux + neovim</a></li>
<li><a href="../de467573/index.html">Top 8 nützliche Analytics-Filter</a></li>
<li><a href="../de467577/index.html">Mono-Test: Das beste Playme P600SG-Combo-Gerät</a></li>
<li><a href="../de467581/index.html">Korrekte Farbwiedergabe von Retroconsolen in Emulatoren</a></li>
<li><a href="../de467583/index.html">LMTOOLS Lizenzmanager. Auflisten von Lizenzen für Autodesk-Produktbenutzer</a></li>
<li><a href="../de467587/index.html">Alle nützlichen Wi-Fi-Inhalte an einem Ort</a></li>
<li><a href="../de467589/index.html">Was Sie über die DSGVO im Jahr 2019 wissen müssen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>