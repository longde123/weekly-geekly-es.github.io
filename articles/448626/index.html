<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§® üïö üòå DDoS para ayudar: c√≥mo realizamos pruebas de estr√©s y estr√©s üöö ‚ùå ü§¶üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Variti desarrolla protecci√≥n contra bots y ataques DDoS, y tambi√©n realiza pruebas de estr√©s y carga. En la conferencia HighLoad ++ 2018, hablamos sob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DDoS para ayudar: c√≥mo realizamos pruebas de estr√©s y estr√©s</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/variti/blog/448626/"><img src="https://habrastorage.org/webt/ze/th/rb/zethrbwkfxc_3voyzfevkonnzao.png"><br><br>  <i>Variti desarrolla protecci√≥n contra bots y ataques DDoS, y tambi√©n realiza pruebas de estr√©s y carga.</i>  <i>En la conferencia HighLoad ++ 2018, hablamos sobre c√≥mo proteger los recursos de varios tipos de ataques.</i>  <i>En resumen: a√≠sle partes del sistema, use servicios en la nube y CDN y actualice regularmente.</i>  <i>Pero sin empresas especializadas, la protecci√≥n a√∫n no se puede hacer :)</i> <br><a name="habracut"></a><br>  Antes de leer el texto, puede familiarizarse con breves res√∫menes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en el sitio web de la conferencia</a> . <br>  Y si no le gusta leer o simplemente quiere ver un video, la grabaci√≥n de nuestro informe se encuentra debajo del spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Informar video</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/Lu4tsUvfYRc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  Muchas compa√±√≠as ya saben c√≥mo hacer pruebas de estr√©s, pero no todas lo hacen.  Algunos de nuestros clientes piensan que su sitio es invulnerable porque tienen un sistema de alta carga y protege contra ataques.  Mostramos que esto no es del todo cierto. <br><br>  Por supuesto, antes de realizar las pruebas, obtenemos el permiso del cliente, firmado y sellado, y con nuestra ayuda no podemos hacer un ataque DDoS a nadie.  Las pruebas se llevan a cabo en el momento elegido por el cliente, cuando la asistencia de su recurso es m√≠nima y los problemas de acceso no afectar√°n a los clientes.  Adem√°s, dado que algo siempre puede salir mal durante el proceso de prueba, tenemos contacto constante con el cliente.  Esto permite no solo informar sobre los resultados alcanzados, sino tambi√©n cambiar algo durante la prueba.  Al final de las pruebas, siempre elaboramos un informe en el que se√±alamos los defectos descubiertos y damos recomendaciones para eliminar las debilidades del sitio. <br><br><h3>  Como trabajamos </h3><br>  Durante las pruebas, emulamos una botnet.  Dado que trabajamos con clientes que no est√°n ubicados en nuestras redes, para evitar que la prueba finalice en el primer minuto debido a la activaci√≥n de l√≠mites o protecci√≥n, cargamos la carga no desde una IP, sino desde nuestra propia subred.  Adem√°s, para crear una carga significativa, tenemos nuestro propio servidor de prueba bastante potente. <br><br><h3>  Postulados </h3><br><blockquote>  <b>Mucho no es bueno</b> <br><br>  Cuanta menos carga podamos llevar al recurso al fracaso, mejor.  Si logra que el sitio deje de funcionar desde una solicitud por segundo, o incluso desde una solicitud por minuto, est√° bien.  Porque de acuerdo con la ley de la mezquindad, los usuarios o atacantes caen accidentalmente en esta vulnerabilidad. </blockquote><blockquote> <b>La falla parcial es mejor que la falla completa</b> <br><br>  Siempre aconsejamos que los sistemas sean heterog√©neos.  Adem√°s, vale la pena separarlos a nivel f√≠sico, y no solo en contenedores.  En el caso de la separaci√≥n f√≠sica, incluso si algo falla en el sitio, es probable que no deje de funcionar por completo, y los usuarios a√∫n tendr√°n acceso a al menos parte de la funcionalidad. </blockquote><blockquote>  <b>La arquitectura adecuada es la base de la sostenibilidad.</b> <br><br>  La tolerancia a fallas de un recurso y su capacidad para resistir ataques y cargas deben establecerse en la etapa de dise√±o, de hecho, en la etapa de dibujar los primeros diagramas de bloques en un cuaderno.  Porque si aparecen errores fatales, puedes corregirlos en el futuro, pero es muy dif√≠cil. </blockquote><blockquote>  <b>No solo el c√≥digo debe ser bueno, sino tambi√©n una configuraci√≥n</b> <br><br>  Mucha gente piensa que un buen equipo de desarrollo es una garant√≠a de resistencia de servicio.  Es realmente necesario un buen equipo de desarrollo, pero tambi√©n debe haber una buena operaci√≥n, buenos DevOps.  Es decir, necesitamos especialistas que configuren correctamente Linux y la red, escriban correctamente las configuraciones en nginx, configuren l√≠mites y m√°s.  De lo contrario, el recurso funcionar√° bien solo en la prueba, y en la producci√≥n en alg√∫n momento todo se romper√°. </blockquote><blockquote>  <b>Diferencias entre estr√©s y pruebas de estr√©s</b> <br><br>  La prueba de carga le permite identificar los l√≠mites del sistema.  La prueba de esfuerzo tiene como objetivo encontrar las debilidades del sistema y se utiliza para romper este sistema y ver c√≥mo se comportar√° en el proceso de falla de ciertas partes.  Al mismo tiempo, la naturaleza de la carga generalmente permanece desconocida para el cliente hasta el comienzo de las pruebas de tensi√≥n. </blockquote><h3>  Caracter√≠sticas distintivas de los ataques L7 </h3><br>  Por lo general, dividimos los tipos de carga en cargas a nivel de L7 y L3 y 4.  L7 es una carga a nivel de aplicaci√≥n, la mayor√≠a de las veces se entiende solo como HTTP, pero nos referimos a cualquier carga a nivel de protocolo TCP. <br><br>  Los ataques L7 tienen ciertas caracter√≠sticas distintivas.  En primer lugar, llegan directamente a la aplicaci√≥n, es decir, es poco probable que puedan reflejarse por medios de red.  Tales ataques usan l√≥gica, y debido a esto consumen CPU, memoria, disco, base de datos y otros recursos de manera muy eficiente y con poco tr√°fico. <br><br><h3>  Inundaci√≥n HTTP </h3><br>  En el caso de cualquier ataque, la carga es m√°s f√°cil de crear que de manejar, y en el caso de L7 esto tambi√©n es cierto.  El tr√°fico de ataque no siempre es f√°cil de distinguir del leg√≠timo, y la mayor√≠a de las veces se puede hacer por frecuencia, pero si todo se planifica correctamente, entonces es imposible entender d√≥nde est√° el ataque y d√≥nde est√°n las solicitudes leg√≠timas de los registros. <br><br>  Como primer ejemplo, considere un ataque de inundaci√≥n HTTP.  El gr√°fico muestra que, por lo general, tales ataques son muy potentes, en el ejemplo a continuaci√≥n, el n√∫mero m√°ximo de solicitudes super√≥ los 600 mil por minuto. <br><br><img src="https://habrastorage.org/webt/rl/-i/qz/rl-iqze06e8bg4epyzgcsfpwddu.png"><br><br>  HTTP Flood es la forma m√°s f√°cil de crear una carga.  Por lo general, se toma alg√∫n tipo de herramienta de prueba de carga, por ejemplo, ApacheBench, y se establecen la solicitud y el prop√≥sito.  Con un enfoque tan simple, es probable que se encuentre con el almacenamiento en cach√© del servidor, pero es f√°cil moverse.  Por ejemplo, agregar l√≠neas aleatorias a la consulta, lo que obliga al servidor a proporcionar constantemente una nueva p√°gina. <br>  Adem√°s, no se olvide del agente de usuario en el proceso de creaci√≥n de una carga.  Los administradores del sistema filtran muchos agentes de usuario de herramientas de prueba populares y, en este caso, la carga simplemente no llega al backend.  Puede mejorar significativamente el resultado insertando un encabezado m√°s o menos v√°lido del navegador en la solicitud. <br>  Para toda su simplicidad, los ataques HTTP Flood tienen sus inconvenientes.  En primer lugar, se requieren grandes capacidades para crear una carga.  En segundo lugar, tales ataques son muy f√°ciles de detectar, especialmente si provienen de la misma direcci√≥n.  Como resultado, las solicitudes comienzan a ser filtradas inmediatamente por los administradores del sistema o incluso a nivel de proveedor. <br><br><h3>  Que buscar </h3><br>  Para reducir la cantidad de solicitudes por segundo y a√∫n as√≠ no perder eficiencia, debe mostrar un poco de imaginaci√≥n y explorar el sitio.  Por lo tanto, puede cargar no solo el canal o el servidor, sino tambi√©n partes individuales de la aplicaci√≥n, por ejemplo, bases de datos o sistemas de archivos.  Tambi√©n puede buscar lugares en el sitio que hagan grandes c√°lculos: calculadoras, p√°ginas de selecci√≥n de productos y m√°s.  Finalmente, a menudo sucede que hay un script php en el sitio que genera una p√°gina de varios cientos de miles de l√≠neas.  Tal script tambi√©n carga mucho el servidor y puede convertirse en un objetivo para el ataque. <br><br><h3>  Donde mirar </h3><br>  Cuando escaneamos un recurso antes de probarlo, primero miramos, por supuesto, el sitio mismo.  Estamos buscando todo tipo de campos de entrada, archivos pesados, en general, todo lo que puede crear problemas para un recurso y ralentiza su funcionamiento.  Aqu√≠, las herramientas de desarrollo comunes en Google Chrome y Firefox ayudan a mostrar el tiempo de respuesta de la p√°gina. <br><br>  Tambi√©n escaneamos subdominios.  Por ejemplo, hay una cierta tienda en l√≠nea, abc.com, y tiene un subdominio admin.abc.com.  Lo m√°s probable es que este sea el panel de administraci√≥n con autorizaci√≥n, pero si le aplica una carga, puede crear problemas para el recurso principal. <br><br>  El sitio puede tener un subdominio api.abc.com.  Lo m√°s probable es que este sea un recurso para aplicaciones m√≥viles.  La aplicaci√≥n se puede encontrar en la App Store o Google Play, poner un punto de acceso especial, diseccionar la API y registrar cuentas de prueba.  El problema es que a menudo las personas piensan que todo lo que est√° protegido por autorizaci√≥n es inmune a los ataques de denegaci√≥n de servicio.  Supuestamente, la autorizaci√≥n es el mejor CAPTCHA, pero no lo es.  Hacer 10-20 cuentas de prueba es simple, y al crearlas, tenemos acceso a funciones complejas y sin disfraz. <br><br>  Naturalmente, miramos el historial, en robots.txt y WebArchive, ViewDNS, estamos buscando versiones antiguas del recurso.  A veces sucede que los desarrolladores implementaron, digamos, mail2.yandex.net, pero la versi√≥n anterior, mail.yandex.net, permaneci√≥.  Este mail.yandex.net ya no es compatible, no se le asignan recursos de desarrollo, pero contin√∫a consumiendo la base de datos.  En consecuencia, al usar la versi√≥n anterior, puede usar efectivamente los recursos del backend y todo lo que est√° detr√°s del dise√±o.  Por supuesto, esto no siempre sucede, pero todav√≠a encontramos algo como esto con bastante frecuencia. <br><br>  Naturalmente, diseccionamos todos los par√°metros de solicitud, estructura de cookies.  Puede, por ejemplo, insertar alg√∫n valor en la matriz JSON dentro de la cookie, crear m√°s anidamiento y hacer que el recurso funcione de manera irrazonablemente larga. <br><br><h3>  Buscar carga </h3><br>  Lo primero que viene a la mente cuando se investiga un sitio es cargar la base de datos, ya que casi todos tienen una b√∫squeda, y desafortunadamente casi todos la tienen, est√° pobremente protegida.  Por alguna raz√≥n, los desarrolladores no prestan suficiente atenci√≥n a la b√∫squeda.  Pero hay una recomendaci√≥n: no haga el mismo tipo de solicitudes, ya que puede encontrar el almacenamiento en cach√©, como es el caso de la inundaci√≥n HTTP. <br><br>  Hacer consultas aleatorias en la base de datos tampoco es siempre eficiente.  Es mucho mejor crear una lista de palabras clave que sean relevantes para la b√∫squeda.  Si vuelve al ejemplo de una tienda en l√≠nea: supongamos que el sitio vende neum√°ticos para autom√≥viles y le permite establecer el radio de los neum√°ticos, el tipo de autom√≥vil y otros par√°metros.  En consecuencia, las combinaciones de palabras relevantes har√°n que la base de datos funcione en condiciones mucho m√°s complejas. <br><br>  Adem√°s, vale la pena usar la paginaci√≥n: es mucho m√°s dif√≠cil para una b√∫squeda devolver la pen√∫ltima p√°gina de un problema que la primera.  Es decir, con la ayuda de la paginaci√≥n, puede diversificar un poco la carga. <br><br>  En el siguiente ejemplo, mostramos la carga en la b√∫squeda.  Se puede ver que desde el primer segundo de la prueba a una velocidad de diez solicitudes por segundo, el sitio se cay√≥ y no respondi√≥. <br><br><img src="https://habrastorage.org/webt/dg/bu/oa/dgbuoarg4u2ufo9_jw1w2nxkurq.png"><br><br><h3>  Si no hay b√∫squeda? </h3><br>  Si no hay b√∫squeda, esto no significa que el sitio no contenga otros campos de entrada vulnerables.  Este campo puede ser una autorizaci√≥n.  Ahora a los desarrolladores les gusta crear hashes complejos para proteger la base de datos de inicio de sesi√≥n de los ataques a las tablas del arco iris.  Esto es bueno, pero estos hashes consumen grandes recursos de CPU.  Una gran cantidad de autorizaciones falsas conduce a una falla del procesador y, como resultado, el sitio deja de funcionar en la salida. <br><br>  La presencia en el sitio de todo tipo de formularios para comentarios y comentarios es una ocasi√≥n para enviar textos muy grandes all√≠ o simplemente crear una inundaci√≥n masiva.  A veces, los sitios aceptan archivos adjuntos, incluso en formato gzip.  En este caso, tomamos un archivo de 1TB, usando gzip lo comprimimos a unos pocos bytes o kilobytes y lo enviamos al sitio.  Luego se descomprime y se obtiene un efecto muy interesante. <br><br><h3>  API de descanso </h3><br>  Me gustar√≠a prestar un poco de atenci√≥n a servicios tan populares como la API Rest.  Proteger la API Rest es mucho m√°s dif√≠cil que un sitio normal.  Para la API Rest, incluso los m√©todos triviales de protecci√≥n contra el descifrado de contrase√±as y otras actividades ileg√≠timas no funcionan. <br><br>  La API Rest es muy f√°cil de romper porque accede a la base de datos directamente.  Al mismo tiempo, la falla de dicho servicio conlleva consecuencias bastante serias para el negocio.  El hecho es que la API Rest generalmente involucra no solo el sitio principal, sino tambi√©n la aplicaci√≥n m√≥vil, algunos recursos comerciales internos.  Y si todo esto cae, entonces el efecto es mucho m√°s fuerte que en el caso del fallo de un sitio simple. <br><br><h3>  Carga de contenido pesado </h3><br>  Si se nos ofrece probar alguna aplicaci√≥n normal de una p√°gina, p√°gina de inicio, sitio web de tarjetas de visita, que no tiene una funcionalidad compleja, estamos buscando contenido pesado.  Por ejemplo, im√°genes grandes que proporciona el servidor, archivos binarios, documentaci√≥n en pdf: estamos tratando de extraerlo todo.  Tales pruebas cargan bien el sistema de archivos y obstruyen los canales, y por lo tanto son efectivas.  Es decir, incluso si no apaga el servidor, descargando un archivo grande a bajas velocidades, simplemente obstruir√° el canal del servidor de destino y luego se producir√° una denegaci√≥n de servicio. <br>  Un ejemplo de tal prueba muestra que a una velocidad de 30 RPS el sitio dej√≥ de responder o gener√≥ 500 errores de servidor. <br><br><img src="https://habrastorage.org/webt/qc/wt/o-/qcwto-1m01beyofdf9vwgov8a6g.png"><br><br>  No te olvides de configurar servidores.  A menudo puede encontrar que una persona compr√≥ una m√°quina virtual, instal√≥ Apache all√≠, configur√≥ todo de manera predeterminada, ubic√≥ una aplicaci√≥n php y, a continuaci√≥n, puede ver el resultado. <br><br><img src="https://habrastorage.org/webt/js/ji/xj/jsjixjh1afv4981burqrqtopx8i.png"><br><br>  Aqu√≠ la carga fue a la ra√≠z y ascendi√≥ a solo 10 RPS.  Esperamos 5 minutos y el servidor se bloque√≥.  Hasta el final, sin embargo, no se sabe por qu√© cay√≥, pero se supone que simplemente estaba lleno de memoria y, por lo tanto, dej√≥ de responder. <br><br><h3>  Basado en olas </h3><br>  En el √∫ltimo a√±o o dos, los ataques de olas se han vuelto bastante populares.  Esto se debe al hecho de que muchas organizaciones compran ciertas piezas de hardware para protecci√≥n contra DDoS, que requieren una cierta cantidad de estad√≠sticas para comenzar a filtrar los ataques.  Es decir, no filtran el ataque en los primeros 30-40 segundos, porque acumulan datos y aprenden.  En consecuencia, en estos 30-40 segundos, puede iniciar tanto que el recurso permanecer√° durante mucho tiempo hasta que todas las solicitudes se clasifiquen. <br><br>  En el caso del ataque, hubo un intervalo de 10 minutos a continuaci√≥n, despu√©s del cual lleg√≥ una parte nueva y modificada del ataque. <br><br><img src="https://habrastorage.org/webt/tx/b4/l7/txb4l7l3s0yneaz0dn5__jzozmu.png"><br><br>  Es decir, la defensa entrenada, comenz√≥ a filtrar, pero lleg√≥ una parte nueva y completamente diferente del ataque, y la defensa comenz√≥ a entrenar nuevamente.  De hecho, el filtrado deja de funcionar, la protecci√≥n se vuelve ineficaz y el sitio es inaccesible. <br><br>  Los ataques de olas se caracterizan por valores muy altos en el pico, puede alcanzar cien mil o un mill√≥n de solicitudes por segundo, en el caso de L7.  Si hablamos de L3 y 4, entonces puede haber cientos de gigabits de tr√°fico o, en consecuencia, cientos de mpps, si cuenta en paquetes. <br><br>  El problema con tales ataques es la sincronizaci√≥n.  Los ataques provienen de una botnet, y para crear un pico √∫nico muy grande, se requiere un alto grado de sincronizaci√≥n.  Y esta coordinaci√≥n no siempre funciona: a veces la salida es una especie de pico parab√≥lico, que parece bastante pat√©tico. <br><br><h3>  No HTTP unificado </h3><br>  Adem√°s de HTTP en el nivel L7, nos encanta explotar otros protocolos.  Como regla general, un sitio web normal, especialmente un alojamiento regular, tiene protocolos de correo y MySQL sobresaliendo.  Los protocolos de correo se ven menos afectados que las bases de datos, pero tambi√©n se pueden cargar de manera bastante eficiente y obtener una CPU sobrecargada en el servidor en la salida. <br><br>  Con la ayuda de la vulnerabilidad SSH 2016, tuvimos bastante √©xito.  Ahora esta vulnerabilidad se ha solucionado para casi todos, pero esto no significa que SSH no se pueda cargar.  Usted puede  Solo se sirve una gran cantidad de autorizaciones, SSH consume casi toda la CPU en el servidor, y luego el sitio web ya est√° compuesto de una o dos solicitudes por segundo. <br><br>  En consecuencia, estas una o dos consultas de registro no se pueden distinguir de una carga leg√≠tima. <br>  Las muchas conexiones que abrimos en los servidores siguen siendo relevantes.  Anteriormente, Apache pecaba, ahora nginx realmente pec√≥, ya que a menudo se configura de manera predeterminada.  El n√∫mero de conexiones que nginx puede mantener abiertas es limitado, por lo que abrimos este n√∫mero de conexiones, la nueva conexi√≥n nginx ya no acepta y el sitio no funciona en la salida. <br><br>  Nuestro cl√∫ster de prueba tiene suficiente CPU para atacar el protocolo de enlace SSL.  En principio, como muestra la pr√°ctica, a las botnets tambi√©n les gusta hacer esto a veces.  Por un lado, est√° claro que no puedes prescindir de SSL, debido a la emisi√≥n, clasificaci√≥n y seguridad de Google.  SSL, por otro lado, desafortunadamente tiene un problema de CPU. <br><br><h3>  L3 y 4 </h3><br>  Cuando hablamos de un ataque en los niveles L3 y 4, generalmente hablamos de un ataque en el nivel del canal.  Tal carga es casi siempre distinguible de leg√≠tima si no es un ataque de inundaci√≥n SYN.  El problema de los ataques de inundaci√≥n SYN para las caracter√≠sticas de seguridad es grande.  El valor m√°ximo de L3 y 4 fue 1.5-2 Tb / s.  Este tr√°fico es muy dif√≠cil de manejar incluso para grandes empresas, incluidas Oracle y Google. <br><br>  SYN y SYN-ACK son los paquetes que se utilizan para establecer la conexi√≥n.  Por lo tanto, es dif√≠cil distinguir SYN-flood de una carga leg√≠tima: no est√° claro que esto sea SYN, que vino a establecer la conexi√≥n, o parte de la inundaci√≥n. <br><br><h3>  Inundaci√≥n UDP </h3><br>  Por lo general, los atacantes no tienen las capacidades que tenemos nosotros, por lo que la amplificaci√≥n se puede utilizar para organizar ataques.  Es decir, un atacante escanea Internet y encuentra servidores vulnerables o configurados incorrectamente, que, por ejemplo, en respuesta a un paquete SYN, responden con tres SYN-ACK.  Al falsificar la direcci√≥n de origen de la direcci√≥n del servidor de destino, puede usar un paquete para aumentar la capacidad, por ejemplo, tres veces, y redirigir el tr√°fico a la v√≠ctima. <br><br><img src="https://habrastorage.org/webt/nd/yu/qz/ndyuqzpld7k2bu58rqqmbriass4.png"><br><br>  El problema con las amplificaciones es su detecci√≥n compleja.  A partir de los √∫ltimos ejemplos, podemos citar el caso sensacional con la memoria cach√© vulnerable.  Adem√°s, ahora hay muchos dispositivos IoT, c√°maras IP, que tambi√©n est√°n configurados en su mayor√≠a de manera predeterminada, y por defecto est√°n configurados incorrectamente, por lo tanto, a trav√©s de dichos dispositivos, los atacantes suelen realizar ataques. <br><br><img src="https://habrastorage.org/webt/h-/si/2n/h-si2n6jf8q84xzuzbfgwgwnd6o.png"><br><br><h3>  Inundaci√≥n SYN dif√≠cil </h3><br>  SYN-flood es probablemente la vista m√°s interesante de todos los ataques desde el punto de vista del desarrollador.  El problema es que a menudo los administradores del sistema usan el bloqueo de IP para protecci√≥n.  Adem√°s, el bloqueo de IP afecta no solo a los administradores de sistemas que operan de acuerdo con los scripts, sino que, desafortunadamente, a algunos sistemas de seguridad que se compran por mucho dinero. <br><br>  Este m√©todo puede convertirse en una cat√°strofe, porque si los atacantes cambian sus direcciones IP, la compa√±√≠a bloquear√° su propia subred.  Cuando Firewall bloquea su propio cl√∫ster, las interacciones externas se bloquear√°n en la salida y el recurso se romper√°. <br><br>  Y lograr bloquear su propia red es f√°cil.  Si la oficina del cliente tiene una red Wi-Fi, o si el estado de los recursos se mide usando varios monitores, entonces tomamos la direcci√≥n IP de este sistema de monitoreo o cliente de Wi-Fi de la oficina y la usamos como fuente.  En la salida, el recurso parece estar disponible, pero las direcciones IP de destino est√°n bloqueadas.  Por lo tanto, la red Wi-Fi de la conferencia HighLoad, donde se presenta un nuevo producto de la compa√±√≠a, puede bloquearse, y esto conlleva ciertos costos comerciales y econ√≥micos. <br><br>  Durante las pruebas, no podemos usar la amplificaci√≥n a trav√©s de la memoria cach√© de algunos recursos externos, porque existen acuerdos para suministrar tr√°fico solo a las direcciones IP permitidas.  En consecuencia, usamos la amplificaci√≥n a trav√©s de SYN y SYN-ACK, cuando el sistema responde enviando dos o tres SYN-ACK para enviar un SYN, y la salida se multiplica por dos o tres veces. <br><br><h3>  Las herramientas </h3><br>  Una de las principales herramientas que utilizamos para la carga en el nivel L7 es Yandex-tank.  En particular, se utiliza un fantasma como arma, adem√°s hay varios scripts para generar cartuchos y analizar los resultados. <br><br>  Tcpdump se usa para analizar el tr√°fico de red, y Nmap se usa para analizar el tr√°fico del servidor.  Para crear una carga en el nivel L3 y 4, se utiliza OpenSSL y un poco de su propia magia con la biblioteca DPDK.  DPDK es una biblioteca de Intel que le permite trabajar con una interfaz de red, evitando la pila de Linux y, por lo tanto, aumentando la eficiencia.  Naturalmente, utilizamos DPDK no solo en el nivel L3 y 4, sino tambi√©n en el nivel L7, porque le permite crear un flujo de carga muy alto, en unos pocos millones de solicitudes por segundo desde una m√°quina. <br>  Tambi√©n utilizamos ciertos generadores de tr√°fico y herramientas especiales que escribimos para pruebas espec√≠ficas.  Si recordamos la vulnerabilidad bajo SSH, entonces con el conjunto anterior, no se puede escapar.  Si atacamos el protocolo de correo, tomamos utilidades de correo o simplemente escribimos scripts en ellos. <br><br><blockquote><h3>  Conclusiones </h3><br>  Como resultado, me gustar√≠a decir: <br><br><ul><li>  Adem√°s de la prueba de carga cl√°sica, tambi√©n se deben realizar pruebas de tensi√≥n.  Tenemos un ejemplo del mundo real en el que un subcontratista asociado realiz√≥ solo pruebas de carga.  Mostr√≥ que el recurso soporta la carga est√°ndar.  Pero luego apareci√≥ una carga anormal, los visitantes del sitio comenzaron a usar el recurso de manera un poco diferente, y en la salida el subcontratista estableci√≥.  Por lo tanto, vale la pena buscar vulnerabilidades incluso si ya est√° protegido de los ataques DDoS. </li><li>  Es necesario aislar algunas partes del sistema de otras.     ,      ,      .       ,    -  .    -      ,   , ,    ,    OAuth2. </li><li>      . </li><li>  CDN      ,               . </li><li>     .  L3&amp;4        ,    ,  ,    .  L7      ,     . ,     -   ,  . </li><li>  .     ,   SSH daemon,       .  ,    ,            . </li></ul></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448626/">https://habr.com/ru/post/448626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448610/index.html">Bricolaje: c√≥mo hicimos un calendario en vivo para Codefest X</a></li>
<li><a href="../448612/index.html">Lo que se congel√≥ en Feature Freeze 2019. Parte I. JSONPath</a></li>
<li><a href="../448618/index.html">Algoritmo Douglas-Pecker</a></li>
<li><a href="../448622/index.html">PHP GR8: JIT mejorar√° el rendimiento de PHP 8</a></li>
<li><a href="../448624/index.html">Ver los datos? No Entonces no lo veo, pero lo son. Destruimos datos en unidades SSD e incluso restauramos la velocidad</a></li>
<li><a href="../448628/index.html">Est√©tica t√©cnica y tecnolog√≠a sovi√©ticas</a></li>
<li><a href="../448632/index.html">¬øJava ya est√° pagado? Desacreditando rumores (¬øo no?)</a></li>
<li><a href="../448634/index.html">Lecciones ucranianas</a></li>
<li><a href="../448636/index.html">Hackaday Retro Computer Case</a></li>
<li><a href="../448638/index.html">Buildroot - Parte 1. Informaci√≥n general, construcci√≥n de un sistema m√≠nimo, configuraci√≥n a trav√©s del men√∫</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>