<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêé üé© üöÄ Ciclo de vida do c√≥digo Python - CPython Runtime Model ‚ö∞Ô∏è üç≠ üë®‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! A primavera chegou, o que significa que resta menos de um m√™s antes do in√≠cio do curso Python Developer . √â a este curso que a publica√ß√£o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ciclo de vida do c√≥digo Python - CPython Runtime Model</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/442252/">  Ol√° pessoal!  A primavera chegou, o que significa que resta menos de um m√™s antes do in√≠cio do curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Python Developer</a> .  √â a este curso que a publica√ß√£o de hoje ser√° dedicada. <br><br><img src="https://habrastorage.org/webt/8-/3n/pk/8-3npkdv_2mpp742_k0zytidc_k.png"><br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/9g/fe/cn/9gfecnorojbyoxcczknx1pyf--g.png"><br><br>  <i><b>Tarefas:</b></i> <br><br>  - Aprenda sobre a estrutura interna do Python; <br>  - Compreender os princ√≠pios de constru√ß√£o de uma √°rvore de sintaxe abstrata (AST); <br>  - Escreva c√≥digo mais eficiente em tempo e mem√≥ria. <br><br>  <i><b>Recomenda√ß√µes preliminares:</b></i> <br><br>  - Compreens√£o b√°sica do int√©rprete (AST, fichas, etc.). <br>  - Conhecimento de Python. <br>  - Conhecimentos b√°sicos de C. <br><br><pre><code class="python hljs">batuhan@arch-pc ÓÇ∞ ~/blogs/cpython/exec_model ÓÇ∞ python --version Python <span class="hljs-number"><span class="hljs-number">3.7</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br>  <b>Modelo de Execu√ß√£o do CPython</b> <br><br>  Python √© uma linguagem compilada e interpretada.  Assim, o compilador Python gera bytecodes e o int√©rprete os executa.  Durante o artigo, consideraremos os seguintes problemas: <br><br><ul><li>  An√°lise e tokeniza√ß√£o: </li><li>  Transforma√ß√£o em AST; </li><li>  Gr√°fico de Fluxo de Controle (CFG); </li><li>  Bytecode </li><li>  Executando em uma m√°quina virtual CPython. </li></ul><br>  <b>An√°lise e tokeniza√ß√£o.</b> <b><br></b>  <b>Gram√°tica.</b> <br><br>  A gram√°tica define a sem√¢ntica da linguagem Python.  Tamb√©m √© √∫til para indicar a maneira como o analisador deve interpretar o idioma.  A gram√°tica Python usa sintaxe semelhante √† forma estendida de Backus-Naur.  Possui gram√°tica pr√≥pria para um tradutor do idioma de origem.  Voc√™ pode encontrar o arquivo de gram√°tica no diret√≥rio "cpython / Grammar / Grammar". <br><br>  A seguir, um exemplo de gram√°tica, <br><br><pre> <code class="python hljs">batuhan@arch-pc ÓÇ∞ ~/cpython/Grammar ÓÇ∞ ÓÇ† master ÓÇ∞ grep <span class="hljs-string"><span class="hljs-string">"simple_stmt"</span></span> Grammar | head -n3 | tail -n1 simple_stmt: small_stmt (<span class="hljs-string"><span class="hljs-string">';'</span></span> small_stmt)* [<span class="hljs-string"><span class="hljs-string">';'</span></span>] NEWLINE</code> </pre> <br>  Express√µes simples cont√™m pequenas express√µes e colchetes, e o comando termina com uma nova linha.  Express√µes pequenas parecem uma lista de express√µes que importam ... <br>  Algumas outras express√µes :) <br><br><pre> <code class="python hljs">small_stmt: (expr_stmt | del_stmt | pass_stmt | flow_stmt | import_stmt | global_stmt | nonlocal_stmt | assert_stmt) ... del_stmt: <span class="hljs-string"><span class="hljs-string">'del'</span></span> exprlist pass_stmt: <span class="hljs-string"><span class="hljs-string">'pass'</span></span> flow_stmt: break_stmt | continue_stmt | return_stmt | raise_stmt | yield_stmt break_stmt: <span class="hljs-string"><span class="hljs-string">'break'</span></span> continue_stmt: <span class="hljs-string"><span class="hljs-string">'continue'</span></span></code> </pre> <br>  <b>Tokeniza√ß√£o (Lexing)</b> <br><br>  Tokeniza√ß√£o √© o processo de obter um fluxo de dados de texto e dividir em tokens de palavras significativas (para o int√©rprete) com metadados adicionais (por exemplo, onde o token come√ßa e termina e qual √© o valor da string desse token). <br><br>  <b>Tokens</b> <br><br>  Um token √© um arquivo de cabe√ßalho que cont√©m defini√ß√µes de todos os tokens.  Existem 59 tipos de tokens no Python (Include / token.h). <br><br>  Abaixo est√° um exemplo de alguns deles, <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#define NAME 1 #define NUMBER 2 #define STRING 3 #define NEWLINE 4 #define INDENT 5 #define DEDENT 6</span></span></code> </pre> <br>  Voc√™ os ver√° se voc√™ dividir algum c√≥digo Python em tokens. <br><br>  <b>Tokeniza√ß√£o com CLI</b> <br><br>  Aqui est√° o arquivo tests.py <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">greetings</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name: str)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">f"Hello </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string">"</span></span>) greetings(<span class="hljs-string"><span class="hljs-string">"Batuhan"</span></span>)</code> </pre> <br>  Em seguida, o tokenizamos usando o comando python -m tokenize e o seguinte √© gerado: <br><br><pre> <code class="python hljs">batuhan@arch-pc ÓÇ∞ ~/blogs/cpython/exec_model ÓÇ∞ python -m tokenize tests.py <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>: ENCODING <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span> ... <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>: INDENT <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>: NAME <span class="hljs-string"><span class="hljs-string">'print'</span></span> ... <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-4</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>: DEDENT <span class="hljs-string"><span class="hljs-string">''</span></span> ... <span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-5</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>: ENDMARKER <span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre><br>  Aqui, os n√∫meros (por exemplo, 1.4-1.13) mostram onde o token come√ßou e onde terminou.  Um token de codifica√ß√£o √© sempre o primeiro token que recebemos.  Ele fornece informa√ß√µes sobre a codifica√ß√£o do arquivo de origem e, se houver algum problema, o int√©rprete gera uma exce√ß√£o. <br><br>  <b>Tokeniza√ß√£o com <i>tokenize.tokenize</i></b> <br><br>  Se voc√™ precisar tokenizar o arquivo a partir do seu c√≥digo, poder√° usar o m√≥dulo <i><b>tokenize</b></i> no <i>stdlib</i> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'tests.py'</span></span>, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> token <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tokenize.tokenize(f.readline): ... print(token) ... TokenInfo(type=<span class="hljs-number"><span class="hljs-number">57</span></span> (ENCODING), string=<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>, start=(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), end=(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), line=<span class="hljs-string"><span class="hljs-string">''</span></span>) ... TokenInfo(type=<span class="hljs-number"><span class="hljs-number">1</span></span> (NAME), string=<span class="hljs-string"><span class="hljs-string">'greetings'</span></span>, start=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), end=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>), line=<span class="hljs-string"><span class="hljs-string">'def greetings(name: str):\n'</span></span>) ... TokenInfo(type=<span class="hljs-number"><span class="hljs-number">53</span></span> (OP), string=<span class="hljs-string"><span class="hljs-string">':'</span></span>, start=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>), end=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>), line=<span class="hljs-string"><span class="hljs-string">'def greetings(name: str):\n'</span></span>) ...</code> </pre> <br>  O tipo de token √© seu ID no arquivo de cabe√ßalho <i>token.h.</i>  String √© o valor do token.  In√≠cio e Fim mostram onde o token come√ßa e termina, respectivamente. <br><br>  Em outros idiomas, os blocos s√£o indicados entre colchetes ou instru√ß√µes de in√≠cio / fim, mas o Python usa recuos e n√≠veis diferentes.  Indent e DEDENT tokens e indicam recuo.  Esses tokens s√£o necess√°rios para criar √°rvores de an√°lise relacional e / ou √°rvores de sintaxe abstrata. <br><br>  <b>Gera√ß√£o de analisador</b> <br><br>  Gera√ß√£o de analisador - um processo que gera um analisador de acordo com uma determinada gram√°tica.  Os geradores de analisadores s√£o conhecidos como PGen.  O Cpython possui dois geradores de analisador.  Um √© o original ( <code>Parser/pgen</code> ) e um reescrito em python ( <code>/Lib/lib2to3/pgen2</code> ). <br><br>  <i>"O gerador original foi o primeiro c√≥digo que escrevi para Python"</i> <i><br></i>  <i>-Guido</i> <br><br>  A partir da cita√ß√£o acima, fica claro que <i>pgen</i> √© a coisa mais importante em uma linguagem de programa√ß√£o.  Quando voc√™ chama pgen (no <i>Analisador / pgen</i> ), ele gera um arquivo de cabe√ßalho e um arquivo C (o pr√≥prio analisador).  Se voc√™ olhar para o c√≥digo C gerado, pode parecer in√∫til, pois sua apar√™ncia significativa √© opcional.  Ele cont√©m muitos dados e estruturas est√°ticos.  A seguir, tentaremos explicar seus principais componentes. <br><br>  <b>DFA (M√°quina de Estado Definido)</b> <br><br>  O analisador define um DFA para cada n√£o-terminal.  Cada DFA √© definido como uma matriz de estados. <br><br><pre> <code class="bash hljs">static dfa dfas[87] = { {256, <span class="hljs-string"><span class="hljs-string">"single_input"</span></span>, 0, 3, states_0, <span class="hljs-string"><span class="hljs-string">"\004\050\340\000\002\000\000\000\012\076\011\007\262\004\020\002\000\300\220\050\037\202\000"</span></span>}, ... {342, <span class="hljs-string"><span class="hljs-string">"yield_arg"</span></span>, 0, 3, states_86, <span class="hljs-string"><span class="hljs-string">"\000\040\200\000\002\000\000\000\000\040\010\000\000\000\020\002\000\300\220\050\037\000\000"</span></span>}, };</code> </pre> <br>  Para cada DFA, h√° um kit inicial que mostra com quais tokens um terminal n√£o terminal especial pode come√ßar. <br><br>  <b>Condi√ß√£o</b> <br><br>  Cada estado √© definido por uma matriz de transi√ß√µes / arestas (arcos). <br><br><pre> <code class="python hljs">static state states_86[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">2</span></span>, arcs_86_0}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_86_1}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_86_2}, };</code> </pre> <br>  <b>Transi√ß√µes (arcos)</b> <br><br>  Cada matriz de transi√ß√£o possui dois n√∫meros.  O primeiro n√∫mero √© o nome da transi√ß√£o (etiqueta do arco), refere-se ao n√∫mero do s√≠mbolo.  O segundo n√∫mero √© o destino. <br><br><pre> <code class="python hljs">static arc arcs_86_0[<span class="hljs-number"><span class="hljs-number">2</span></span>] = { {<span class="hljs-number"><span class="hljs-number">77</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">47</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_86_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_86_2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, };</code> </pre><br>  <b>Nomes (etiquetas)</b> <br><br>  Esta √© uma tabela especial que mapeia o ID do caractere para o nome da transi√ß√£o. <br><br><pre> <code class="python hljs">static label labels[<span class="hljs-number"><span class="hljs-number">177</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"EMPTY"</span></span>}, {<span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, ... {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"async"</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"def"</span></span>}, ... {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"yield"</span></span>}, {<span class="hljs-number"><span class="hljs-number">342</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, };</code> </pre> <br>  O n√∫mero 1 corresponde a todos os identificadores.  Assim, cada um deles obt√©m nomes de transi√ß√£o diferentes, mesmo que todos tenham o mesmo ID de caractere. <br><br>  <i><b>Um exemplo simples:</b></i> <br><br>  Suponha que tenhamos um c√≥digo que emita "Hi" se 1 - true: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: print(<span class="hljs-string"><span class="hljs-string">'Hi'</span></span>)</code> </pre> <br>  O analisador considera esse c√≥digo como single_input. <br><br><pre> <code class="python hljs">single_input: NEWLINE | simple_stmt | compound_stmt NEWLINE</code> </pre> <br>  Em seguida, nossa √°rvore de an√°lise come√ßa no n√≥ raiz de uma entrada √∫nica. <br><br><img src="https://habrastorage.org/webt/xm/nl/r2/xmnlr287d0_vdkigdsqvtvpwhmi.png"><br><br>  E o valor do nosso DFA (single_input) √© 0. <br><br><pre> <code class="python hljs">static dfa dfas[<span class="hljs-number"><span class="hljs-number">87</span></span>] = { {<span class="hljs-number"><span class="hljs-number">256</span></span>, <span class="hljs-string"><span class="hljs-string">"single_input"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, states_0, <span class="hljs-string"><span class="hljs-string">"\004\050\340\000\002\000\000\000\012\076\011\007\262\004\020\002\000\300\220\050\037\202\000"</span></span>} ... }</code> </pre><br>  Ficar√° assim: <br><br><pre> <code class="python hljs">static arc arcs_0_0[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_0_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static arc arcs_0_2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static state states_0[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">3</span></span>, arcs_0_0}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_0_1}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,</code> </pre>  arcs_0_2}, <br>  }; <br><br>  Aqui <code>arc_0_0</code> consiste em tr√™s elementos.  O primeiro √© <code>NEWLINE</code> , o segundo √© <code>simple_stmt</code> e o √∫ltimo √© <code>compound_stmt</code> . <br><br>  Dado o conjunto inicial de <code>simple_stmt</code> podemos concluir que <code>simple_stmt</code> n√£o pode come√ßar com <code>if</code> .  No entanto, mesmo se n√£o for uma nova linha, o <code>compound_stmt</code> ainda poder√° come√ßar com <code>if</code> .  Portanto, passamos para o √∫ltimo <code>arc ({4;2})</code> e adicionamos o n√≥ composite_stmt √† √°rvore de an√°lise e mudamos para o novo DFA antes de prosseguir para o n√∫mero 2.  Temos uma √°rvore de an√°lise atualizada: <br><br><img src="https://habrastorage.org/webt/fv/lc/ac/fvlcacpcaci0gacypn7mwu7ldkm.png"><br><br>  O novo DFA analisa instru√ß√µes compostas. <br><br><pre> <code class="python hljs">compound_stmt: if_stmt | while_stmt | for_stmt | try_stmt | with_stmt | funcdef | classdef | decorated | async_stmt</code> </pre> <br>  E temos o seguinte: <br><br><pre> <code class="python hljs">static arc arcs_39_0[<span class="hljs-number"><span class="hljs-number">9</span></span>] = { {<span class="hljs-number"><span class="hljs-number">91</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">92</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">93</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">94</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">95</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">96</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static arc arcs_39_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static state states_39[<span class="hljs-number"><span class="hljs-number">2</span></span>] = { {<span class="hljs-number"><span class="hljs-number">9</span></span>, arcs_39_0}, {<span class="hljs-number"><span class="hljs-number">1</span></span>, arcs_39_1}, };</code> </pre><br>  Somente o primeiro salto pode come√ßar com <code>if</code> .  Temos uma √°rvore de an√°lise atualizada. <br><br><img src="https://habrastorage.org/webt/kh/q2/ru/khq2rutapnl3op6estdsfaznvwo.png"><br><br>  Em seguida, alteramos novamente o DFA e os pr√≥ximos ifs do DFA. <br><br><pre> <code class="python hljs">if_stmt: <span class="hljs-string"><span class="hljs-string">'if'</span></span> test <span class="hljs-string"><span class="hljs-string">':'</span></span> suite (<span class="hljs-string"><span class="hljs-string">'elif'</span></span> test <span class="hljs-string"><span class="hljs-string">':'</span></span> suite)* [<span class="hljs-string"><span class="hljs-string">'else'</span></span> <span class="hljs-string"><span class="hljs-string">':'</span></span> suite]</code> </pre> <br>  Como resultado, obtemos a √∫nica transi√ß√£o com a designa√ß√£o 97. Ela coincide com o token <code>if</code> . <br><br><pre> <code class="python hljs">static arc arcs_41_0[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">97</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, }; static arc arcs_41_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, }; static arc arcs_41_2[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>}, }; static arc arcs_41_3[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, }; static arc arcs_41_4[<span class="hljs-number"><span class="hljs-number">3</span></span>] = { {<span class="hljs-number"><span class="hljs-number">98</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">99</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>}, }; static arc arcs_41_5[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>}, }; static arc arcs_41_6[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { {<span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>}, }; ...</code> </pre> <br>  Quando passamos para o pr√≥ximo estado, permanecendo no mesmo DFA, o pr√≥ximo arcs_41_1 tamb√©m possui apenas uma transi√ß√£o.  Isso √© verdade para o terminal de teste.  Ele deve come√ßar com um n√∫mero (por exemplo, 1). <br><br><img src="https://habrastorage.org/webt/f9/my/mh/f9mymh7fay4vovofermpmyfxegi.png"><br><br>  Existe apenas uma transi√ß√£o no arc_41_2 que obt√©m o token de dois pontos (:). <br><br><img src="https://habrastorage.org/webt/-f/qf/gn/-fqfgnvebdfvjez63wlbowzihdm.png"><br><br>  Portanto, temos um conjunto que pode come√ßar com um valor de impress√£o.  Por fim, v√° para arcs_41_4.  A primeira transi√ß√£o no conjunto √© uma express√£o elif, a segunda √© outra, e a terceira √© para o √∫ltimo estado.  E temos a vis√£o final da √°rvore de an√°lise. <br><br><img src="https://habrastorage.org/webt/oj/_l/ye/oj_lyeqesfzsqv_iohr2yiunnqq.png"><br><br>  <b>Interface Python para analisador.</b> <b><br></b> <br><br>  O Python permite editar a √°rvore de an√°lise de express√µes usando um m√≥dulo chamado analisador. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> parser &gt;&gt;&gt; code = <span class="hljs-string"><span class="hljs-string">"if 1: print('Hi')"</span></span></code> </pre> <br>  Voc√™ pode gerar uma √°rvore de sintaxe espec√≠fica (√Årvore de sintaxe concreta, CST) usando o parser.suite. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>parser.suite(code).tolist() [<span class="hljs-number"><span class="hljs-number">257</span></span>, [<span class="hljs-number"><span class="hljs-number">269</span></span>, [<span class="hljs-number"><span class="hljs-number">295</span></span>, [<span class="hljs-number"><span class="hljs-number">297</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'if'</span></span>], [<span class="hljs-number"><span class="hljs-number">305</span></span>, [<span class="hljs-number"><span class="hljs-number">309</span></span>, [<span class="hljs-number"><span class="hljs-number">310</span></span>, [<span class="hljs-number"><span class="hljs-number">311</span></span>, [<span class="hljs-number"><span class="hljs-number">312</span></span>, [<span class="hljs-number"><span class="hljs-number">315</span></span>, [<span class="hljs-number"><span class="hljs-number">316</span></span>, [<span class="hljs-number"><span class="hljs-number">317</span></span>, [<span class="hljs-number"><span class="hljs-number">318</span></span>, [<span class="hljs-number"><span class="hljs-number">319</span></span>, [<span class="hljs-number"><span class="hljs-number">320</span></span>, [<span class="hljs-number"><span class="hljs-number">321</span></span>, [<span class="hljs-number"><span class="hljs-number">322</span></span>, [<span class="hljs-number"><span class="hljs-number">323</span></span>, [<span class="hljs-number"><span class="hljs-number">324</span></span>, [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>]]]]]]]]]]]]]]]], [<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-string"><span class="hljs-string">':'</span></span>], [<span class="hljs-number"><span class="hljs-number">304</span></span>, [<span class="hljs-number"><span class="hljs-number">270</span></span>, [<span class="hljs-number"><span class="hljs-number">271</span></span>, [<span class="hljs-number"><span class="hljs-number">272</span></span>, [<span class="hljs-number"><span class="hljs-number">274</span></span>, [<span class="hljs-number"><span class="hljs-number">305</span></span>, [<span class="hljs-number"><span class="hljs-number">309</span></span>, [<span class="hljs-number"><span class="hljs-number">310</span></span>, [<span class="hljs-number"><span class="hljs-number">311</span></span>, [<span class="hljs-number"><span class="hljs-number">312</span></span>, [<span class="hljs-number"><span class="hljs-number">315</span></span>, [<span class="hljs-number"><span class="hljs-number">316</span></span>, [<span class="hljs-number"><span class="hljs-number">317</span></span>, [<span class="hljs-number"><span class="hljs-number">318</span></span>, [<span class="hljs-number"><span class="hljs-number">319</span></span>, [<span class="hljs-number"><span class="hljs-number">320</span></span>, [<span class="hljs-number"><span class="hljs-number">321</span></span>, [<span class="hljs-number"><span class="hljs-number">322</span></span>, [<span class="hljs-number"><span class="hljs-number">323</span></span>, [<span class="hljs-number"><span class="hljs-number">324</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'print'</span></span>]], [<span class="hljs-number"><span class="hljs-number">326</span></span>, [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'('</span></span>], [<span class="hljs-number"><span class="hljs-number">334</span></span>, [<span class="hljs-number"><span class="hljs-number">335</span></span>, [<span class="hljs-number"><span class="hljs-number">305</span></span>, [<span class="hljs-number"><span class="hljs-number">309</span></span>, [<span class="hljs-number"><span class="hljs-number">310</span></span>, [<span class="hljs-number"><span class="hljs-number">311</span></span>, [<span class="hljs-number"><span class="hljs-number">312</span></span>, [<span class="hljs-number"><span class="hljs-number">315</span></span>, [<span class="hljs-number"><span class="hljs-number">316</span></span>, [<span class="hljs-number"><span class="hljs-number">317</span></span>, [<span class="hljs-number"><span class="hljs-number">318</span></span>, [<span class="hljs-number"><span class="hljs-number">319</span></span>, [<span class="hljs-number"><span class="hljs-number">320</span></span>, [<span class="hljs-number"><span class="hljs-number">321</span></span>, [<span class="hljs-number"><span class="hljs-number">322</span></span>, [<span class="hljs-number"><span class="hljs-number">323</span></span>, [<span class="hljs-number"><span class="hljs-number">324</span></span>, [<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"'Hi'"</span></span>]]]]]]]]]]]]]]]]]], [<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">')'</span></span>]]]]]]]]]]]]]]]]]]], [<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>]]]]]], [<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>], [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>]]</code> </pre> <br>  O valor de sa√≠da ser√° uma lista aninhada.  Cada lista na estrutura possui 2 elementos.  O primeiro √© o ID do caractere (0-256 - terminais, 256+ - n√£o terminais) e o segundo √© a sequ√™ncia de tokens para o terminal. <br><br>  <b>√Årvore de sintaxe abstrata</b> <br><br>  De fato, uma √°rvore de sintaxe abstrata (AST) √© uma representa√ß√£o estrutural do c√≥digo-fonte na forma de uma √°rvore, em que cada v√©rtice denota tipos diferentes de constru√ß√µes de linguagem (express√£o, vari√°vel, operador, etc.) <br><br>  <b>O que √© uma √°rvore?</b> <br><br>  Uma √°rvore √© uma estrutura de dados que possui um v√©rtice raiz como ponto de partida.  O v√©rtice raiz √© abaixado por ramos (transi√ß√µes) at√© outros v√©rtices.  Cada v√©rtice, exceto a raiz, possui um v√©rtice pai exclusivo. <br><br>  H√° uma certa diferen√ßa entre a √°rvore de sintaxe abstrata e a √°rvore de an√°lise. <br><br><img src="https://habrastorage.org/webt/2o/ws/eb/2owsebsx9fqewbfmyxexaid5hm8.png"><br><br>  √Ä direita, h√° uma √°rvore de an√°lise para a express√£o 2 * 7 + 3.  Esta √© literalmente uma imagem de origem individual sob a forma de uma √°rvore.  Todas as express√µes, termos e valores s√£o vis√≠veis nele.  No entanto, essa imagem √© muito complicada para um simples trecho de c√≥digo; portanto, podemos simplesmente remover todas as express√µes sint√°ticas que tivemos que definir no c√≥digo para os c√°lculos. <br><br>  Essa √°rvore simplificada √© chamada de √°rvore de sintaxe abstrata (AST).  √Ä esquerda na figura, √© mostrado exatamente para o mesmo c√≥digo.  Todas as express√µes de sintaxe foram descartadas para facilitar o entendimento, mas lembre-se de que determinadas informa√ß√µes foram perdidas. <br><br>  <b>Exemplo</b> <b><br></b> <br>  O Python oferece um m√≥dulo AST embutido para trabalhar com o AST.  Para gerar c√≥digo a partir de √°rvores AST, voc√™ pode usar m√≥dulos de terceiros, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Astor</a> . <br><br>  Por exemplo, considere o mesmo c√≥digo de antes. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ast &gt;&gt;&gt; code = <span class="hljs-string"><span class="hljs-string">"if 1: print('Hi')"</span></span></code> </pre> <br>  Para obter o AST, usamos o m√©todo ast.parse. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>tree = ast.parse(code) &gt;&gt;&gt; tree &lt;_ast.Module object at <span class="hljs-number"><span class="hljs-number">0x7f37651d76d8</span></span>&gt;</code> </pre> <br>  Tente usar o m√©todo <code>ast.dump</code> para obter uma √°rvore de sintaxe abstrata mais leg√≠vel. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>ast.dump(tree) <span class="hljs-string"><span class="hljs-string">"Module(body=[If(test=Num(n=1), body=[Expr(value=Call(func=Name(id='print', ctx=Load()), args=[Str(s='Hi')], keywords=[]))], orelse=[])])"</span></span></code> </pre> <br>  O AST √© geralmente considerado mais visual e f√°cil de entender do que a √°rvore de an√°lise. <br><br>  <b>Graf de fluxo de controle (CFG)</b> <br><br>  Os gr√°ficos de fluxo de controle s√£o gr√°ficos direcionais que modelam o fluxo de um programa usando blocos base que cont√™m uma representa√ß√£o intermedi√°ria. <br><br>  Normalmente, CFG √© a etapa anterior antes de obter os valores do c√≥digo de sa√≠da.  O c√≥digo √© gerado diretamente a partir dos blocos de base usando uma pesquisa de profundidade para tr√°s no CFG, come√ßando pelos topos. <br><br>  <b>Bytecode</b> <br><br>  O bytecode do Python √© um conjunto intermedi√°rio de instru√ß√µes que funcionam em uma m√°quina virtual Python.  Quando voc√™ executa o c√≥digo-fonte, o Python cria um diret√≥rio chamado __pycache__.  Ele armazena o c√≥digo compilado para economizar tempo em caso de reiniciar a compila√ß√£o. <br><br>  Considere uma fun√ß√£o Python simples em func.py. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">say_hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name: str)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"Hello"</span></span>, name) print(<span class="hljs-string"><span class="hljs-string">f"How are you </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string">?"</span></span>)</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> func <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> say_hello &gt;&gt;&gt; say_hello(<span class="hljs-string"><span class="hljs-string">"Batuhan"</span></span>) Hello Batuhan How are you Batuhan?</code> </pre> <br>  O <code>say_hello</code> objeto <code>say_hello</code> √© uma fun√ß√£o. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>type(say_hello) &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class">'&gt;</span></span></code> </pre> <br>  Possui o atributo <code>__code__</code> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>say_hello.__code__ &lt;code object say_hello at <span class="hljs-number"><span class="hljs-number">0x7f13777d9150</span></span>, file <span class="hljs-string"><span class="hljs-string">"/home/batuhan/blogs/cpython/exec_model/func.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>&gt;</code> </pre> <br>  <b>Objetos de c√≥digo</b> <br><br>  Objetos de c√≥digo s√£o estruturas de dados imut√°veis ‚Äã‚Äãque cont√™m as instru√ß√µes ou metadados necess√°rios para executar o c√≥digo.  Simplificando, essas s√£o representa√ß√µes do c√≥digo Python.  Voc√™ tamb√©m pode obter objetos de c√≥digo compilando √°rvores de sintaxe abstrata usando o m√©todo <i>compile</i> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ast &gt;&gt;&gt; code = <span class="hljs-string"><span class="hljs-string">""" ... def say_hello(name: str): ... print("Hello", name) ... print(f"How are you {name}?") ... say_hello("Batuhan") ... """</span></span> &gt;&gt;&gt; tree = ast.parse(code, mode=<span class="hljs-string"><span class="hljs-string">'exec'</span></span>) &gt;&gt;&gt; code = compile(tree, <span class="hljs-string"><span class="hljs-string">'&lt;string&gt;'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'exec'</span></span>) &gt;&gt;&gt; type(code) &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">code</span></span></span><span class="hljs-class">'&gt;</span></span></code> </pre> <br>  Cada objeto de c√≥digo possui atributos que cont√™m determinadas informa√ß√µes (prefixadas com co_).  Aqui mencionamos apenas alguns deles. <br><br>  <i><b>co_name</b></i> <br><br>  Para come√ßar - um nome.  Se uma fun√ß√£o existe, ela deve ter um nome, respectivamente, esse nome ser√° o nome da fun√ß√£o, uma situa√ß√£o semelhante √† da classe.  No exemplo AST, usamos m√≥dulos e podemos dizer exatamente ao compilador como queremos cham√°-los.  Deixe que sejam apenas um <code>module</code> . <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>code.co_name <span class="hljs-string"><span class="hljs-string">'&lt;module&gt;'</span></span> &gt;&gt;&gt; say_hello.__code__.co_name <span class="hljs-string"><span class="hljs-string">'say_hello'</span></span></code> </pre> <br>  <i><b>co_varnames</b></i> <br><br>  Esta √© uma tupla que cont√©m todas as vari√°veis ‚Äã‚Äãlocais, incluindo argumentos. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>say_hello.__code__.co_varnames (<span class="hljs-string"><span class="hljs-string">'name'</span></span>,)</code> </pre> <br>  <i><b>co_conts</b></i> <br><br>  Uma tupla contendo todos os literais e valores constantes que acessamos no corpo da fun√ß√£o.  Aqui vale a pena notar o valor de Nenhum.  N√£o inclu√≠mos None no corpo da fun√ß√£o, no entanto, o Python indicou, porque se a fun√ß√£o come√ßar a executar e terminar sem receber nenhum valor de retorno, ela retornar√° None. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>say_hello.__code__.co_consts (<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'Hello'</span></span>, <span class="hljs-string"><span class="hljs-string">'How are you '</span></span>, <span class="hljs-string"><span class="hljs-string">'?'</span></span>)</code> </pre> <br>  <b>C√≥digo de bytes (co_code)</b> <br><br>  A seguir, √© apresentado o bytecode de nossa fun√ß√£o. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>bytecode = say_hello.__code__.co_code &gt;&gt;&gt; bytecode <span class="hljs-string"><span class="hljs-string">b't\x00d\x01|\x00\x83\x02\x01\x00t\x00d\x02|\x00\x9b\x00d\x03\x9d\x03\x83\x01\x01\x00d\x00S\x00'</span></span></code> </pre> <br>  Isso n√£o √© uma string, √© um objeto de byte, ou seja, uma sequ√™ncia de bytes. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>type(bytecode) &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bytes</span></span></span><span class="hljs-class">'&gt;</span></span></code> </pre> <br>  O primeiro caractere impresso √© "t".  Se pedirmos seu valor num√©rico, obteremos o seguinte. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>ord(<span class="hljs-string"><span class="hljs-string">'t'</span></span>) <span class="hljs-number"><span class="hljs-number">116</span></span></code> </pre> <br>  116 √© o mesmo que bytecode [0]. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> bytecode[<span class="hljs-number"><span class="hljs-number">0</span></span>] == ord(<span class="hljs-string"><span class="hljs-string">'t'</span></span>)</code> </pre><br>  Para n√≥s, um valor de 116 n√£o significa nada.  Felizmente, o Python fornece uma biblioteca padr√£o chamada dis (da desmontagem).  √â √∫til ao trabalhar com a lista opname.  Esta √© uma lista de todas as instru√ß√µes de bytecode, em que cada √≠ndice √© o nome da instru√ß√£o. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.opname[ord(<span class="hljs-string"><span class="hljs-string">'t'</span></span>)] <span class="hljs-string"><span class="hljs-string">'LOAD_GLOBAL'</span></span></code> </pre> <br>  Vamos criar outra fun√ß√£o mais complexa. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">multiple_it</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a: int)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>: ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a * <span class="hljs-number"><span class="hljs-number">2</span></span> ... &gt;&gt;&gt; multiple_it(<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span> &gt;&gt;&gt; multiple_it(<span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-number"><span class="hljs-number">14</span></span> &gt;&gt;&gt; bytecode = multiple_it.__code__.co_code</code> </pre> <br>  E descobrimos a primeira instru√ß√£o em bytecode. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.opname[bytecode[<span class="hljs-number"><span class="hljs-number">0</span></span>]] <span class="hljs-string"><span class="hljs-string">'LOAD_FAST</span></span></code> </pre> <br>  A instru√ß√£o LOAD_FAST consiste em dois elementos. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.opname[bytecode[<span class="hljs-number"><span class="hljs-number">0</span></span>]] + <span class="hljs-string"><span class="hljs-string">' '</span></span> + dis.opname[bytecode[<span class="hljs-number"><span class="hljs-number">1</span></span>]] <span class="hljs-string"><span class="hljs-string">'LOAD_FAST &lt;0&gt;'</span></span></code> </pre> <br>  A instru√ß√£o Loadfast 0 procura por nomes de vari√°veis ‚Äã‚Äãem uma tupla e envia um elemento com um √≠ndice zero para uma tupla na pilha de execu√ß√£o. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>multiple_it.__code__.co_varnames[bytecode[<span class="hljs-number"><span class="hljs-number">1</span></span>]] <span class="hljs-string"><span class="hljs-string">'a'</span></span></code> </pre> <br>  Nosso c√≥digo pode ser desmontado usando dis.dis e converter o bytecode em uma visualiza√ß√£o familiar.  Aqui os n√∫meros (2,3,4) s√£o os n√∫meros de linha.  Cada linha de c√≥digo no Python √© expandida como um conjunto de instru√ß√µes. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dis.dis(multiple_it) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> LOAD_FAST <span class="hljs-number"><span class="hljs-number">0</span></span> (a) <span class="hljs-number"><span class="hljs-number">2</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">4</span></span> BINARY_MODULO <span class="hljs-number"><span class="hljs-number">6</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">8</span></span> COMPARE_OP <span class="hljs-number"><span class="hljs-number">2</span></span> (==) <span class="hljs-number"><span class="hljs-number">10</span></span> POP_JUMP_IF_FALSE <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">14</span></span> RETURN_VALUE <span class="hljs-number"><span class="hljs-number">4</span></span> &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span> LOAD_FAST <span class="hljs-number"><span class="hljs-number">0</span></span> (a) <span class="hljs-number"><span class="hljs-number">18</span></span> LOAD_CONST <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">20</span></span> BINARY_MULTIPLY <span class="hljs-number"><span class="hljs-number">22</span></span> RETURN_VALUE</code> </pre> <br>  <b>Prazo de execu√ß√£o</b> <br><br>  CPython √© uma m√°quina virtual orientada a pilha, n√£o uma cole√ß√£o de registros.  Isso significa que o c√≥digo Python √© compilado para uma m√°quina virtual com uma arquitetura de pilha. <br><br>  Ao chamar uma fun√ß√£o, o Python usa duas pilhas juntas.  O primeiro √© a pilha de execu√ß√£o e o segundo √© a pilha de blocos.  A maioria das chamadas ocorre na pilha de execu√ß√£o;  a pilha de blocos controla quantos blocos est√£o ativos no momento, bem como outros par√¢metros relacionados a blocos e escopos. <br><br>  Aguardamos seus coment√°rios sobre o material e convidamos voc√™ para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um semin√°rio</a> on- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">line aberto</a> sobre o tema: ‚ÄúSolte-o: aspectos pr√°ticos da libera√ß√£o de software confi√°vel‚Äù, que ser√° conduzido por nosso professor, programador do sistema de publicidade no Mail.Ru, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Stanislav Stupnikov</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt442252/">https://habr.com/ru/post/pt442252/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt442238/index.html">Usando contas inteligentes Waves: de leil√µes a programas de b√¥nus</a></li>
<li><a href="../pt442242/index.html">Not√≠cias recentes: Lan√ßada a maior planta de c√©lulas solares do Hemisf√©rio Ocidental</a></li>
<li><a href="../pt442244/index.html">Rust 1.33 Release</a></li>
<li><a href="../pt442248/index.html">NASA aprovou o lan√ßamento de teste n√£o tripulado do Dragon-2</a></li>
<li><a href="../pt442250/index.html">Reagir e Vue: Pontos fortes</a></li>
<li><a href="../pt442256/index.html">Defesa digital do mundo pl√°stico dos reguladores dom√©sticos da Internet</a></li>
<li><a href="../pt442258/index.html">Raspagem da Web para desenvolvedores da Web: um breve resumo</a></li>
<li><a href="../pt442260/index.html">10 comandos Git que um desenvolvedor deve saber</a></li>
<li><a href="../pt442262/index.html">Segredo do firmware</a></li>
<li><a href="../pt442264/index.html">Eliminando oportunidades de seq√ºestro de tr√°fego</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>