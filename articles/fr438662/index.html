<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>↙️ 🙅🏽 🕵️ Le jour où je suis tombé amoureux du fuzzing 🐌 👩‍👦 🙇🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2007, j'ai écrit quelques outils de modding pour le simulateur d'espace Freelancer . Les ressources du jeu sont stockées au format «binaire INI» ou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Le jour où je suis tombé amoureux du fuzzing</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438662/"> En 2007, j'ai écrit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">quelques outils de</a> modding pour le simulateur d'espace <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Freelancer</a> .  Les ressources du jeu sont stockées au format «binaire INI» ou «BINI».  Le format binaire a probablement été choisi pour des raisons de performances: ces fichiers sont plus rapides à charger et à lire qu'un texte arbitraire au format INI. <br><br>  La plupart du contenu du jeu peut être modifié directement à partir de ces fichiers, en changeant les noms, les prix des produits, les statistiques des vaisseaux spatiaux ou même en ajoutant de nouveaux navires.  Les fichiers binaires sont difficiles à modifier directement, donc l'approche naturelle est de les convertir en texte INI, d'apporter des modifications dans un éditeur de texte, puis de les reconvertir au format BINI et de remplacer les fichiers dans le répertoire du jeu. <br><a name="habracut"></a><br>  Je n'ai pas analysé le format BINI, et je ne suis pas le premier à apprendre à les éditer.  Mais je n'aimais pas les outils existants et j'avais ma propre vision de la façon dont ils devraient fonctionner.  Je préfère une interface de style Unix, bien que le jeu lui-même fonctionne sous Windows. <br><br>  A cette époque, je venais juste de me familiariser avec les outils <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">yacc</a> (en fait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bison</a> ) et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lex</a> (en fait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">flex</a> ), ainsi qu'avec Autoconf, donc je les ai utilisés exactement.  C'était intéressant d'essayer ces utilitaires dans la pratique, bien que j'imite servilement d'autres projets open source, ne comprenant pas pourquoi tout a été fait de cette façon, en aucune autre manière.  En raison de l'utilisation de yacc / lex et de la création de scripts de configuration, un système complet de type Unix était requis.  Tout cela est visible dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">version originale des programmes</a> . <br><br>  Le projet s'est avéré être un succès: j'ai moi-même utilisé avec succès ces outils, et ils sont apparus dans différentes collections pour le modding Freelancer. <br><br><h1>  Refactoring </h1><br>  Mi-2018, je suis revenu sur ce projet.  Avez-vous déjà regardé votre ancien code avec la pensée: qu'avez-vous même pensé?  Mon format INI s'est avéré être beaucoup plus rigide et strict que nécessaire, les binaires ont été enregistrés de manière douteuse et l'assemblage n'a même pas fonctionné normalement. <br><br>  Grâce à dix ans d'expérience supplémentaire, je savais avec certitude que j'écrirais beaucoup mieux ces outils maintenant.  Et je l'ai fait en quelques jours, en les réécrivant à partir de zéro.  Ce nouveau code est maintenant dans le thread principal sur Github. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">J'aime rendre tout aussi simple que possible</a> , alors je me suis débarrassé de l'autoconf au profit d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Makefile plus simple et plus portable</a> .  Plus de yacc ou de lex, mais l'analyseur est écrit à la main.  Seul le C portable approprié est utilisé. Le résultat est si simple que j'assemble le projet avec une courte commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de Visual Studio</a> , donc le Makefile n'est pas vraiment nécessaire.  Si vous remplacez <code>stdint.h</code> par <code>typedef</code> , vous pouvez même <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">créer et exécuter binitools sous DOS</a> . <br><br>  La nouvelle version est plus rapide, plus compacte, plus propre et plus facile.  Il est beaucoup plus flexible en ce qui concerne l'entrée INI, il est donc plus facile à utiliser.  Mais est-ce vraiment correct? <br><br><h1>  Fuzzing </h1><br>  Je m'intéresse au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fuzz depuis de</a> nombreuses années, en particulier l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">af</a> (american fuzzy lop).  Mais il ne l'a jamais maîtrisé, bien qu'il ait testé certains des outils que j'utilise régulièrement.  Mais le fuzzing n'a rien trouvé de remarquable, du moins avant que j'abandonne.  J'ai testé ma bibliothèque JSON et pour une raison quelconque, je n'ai rien trouvé non plus.  Il est clair que mon analyseur JSON ne pouvait pas être <i>aussi</i> fiable, non?  Mais le flou ne montre rien.  (Il s'est avéré que ma bibliothèque JSON est assez fiable, grâce en grande partie aux efforts de la communauté!) <br><br>  Mais maintenant, j'ai un analyseur INI relativement nouveau.  Bien qu'il puisse analyser et assembler correctement l'ensemble original de fichiers BINI dans le jeu, sa fonctionnalité <i>n'a</i> pas <i>vraiment</i> été testée.  Ici, le fuzzing trouvera sûrement quelque chose.  De plus, vous n'avez pas besoin d'écrire une seule ligne pour exécuter afl sur ce code.  Les outils par défaut fonctionnent avec une entrée standard, ce qui est idéal. <br><br>  En supposant que vous ayez installé les outils nécessaires (make, gcc, afl), voici comment le fuzzing binitools démarre facilement: <br><br><pre> <code class="bash hljs">$ make CC=afl-gcc $ mkdir <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> out $ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'[x]'</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>/empty $ afl-fuzz -i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> -o out -- ./bini</code> </pre> <br>  L'utilitaire <code>bini</code> accepte INI en entrée et émet BINI, il est donc beaucoup plus intéressant de le vérifier que la procédure <code>unbini</code> inverse.  Comme <code>unbini</code> analyse des données binaires relativement simples, le (probablement) fuzzer n'a rien à rechercher.  Cependant, juste au cas où, je l'ai quand même vérifié. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/483/089/6dc/4830896dc68da2e5559c899429235f95.png"><br><br>  Dans cet exemple, j'ai changé le compilateur par défaut en shell GCC pour afl ( <code>CC=afl-gcc</code> ).  Ici, afl appelle GCC en arrière-plan, mais il ajoute sa propre boîte à outils au binaire.  Lors du fuzzing, <code>afl-fuzz</code> utilise cette boîte à outils pour surveiller le chemin d'exécution d'un programme.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La documentation afl</a> explique les détails techniques. <br><br>  J'ai également créé les répertoires d'entrée et de sortie en mettant dans le répertoire d'entrée un exemple de travail minimal qui donne à afl un point de départ.  Lorsqu'il démarre, il mute la file d'attente de données d'entrée et surveille les modifications pendant l'exécution du programme.  Le répertoire de sortie contient les résultats et, plus important encore, le corps des données d'entrée qui provoquent des chemins d'exécution uniques.  En d'autres termes, de nombreuses entrées sont traitées à la sortie floue, vérifiant de nombreux scénarios de bordure différents. <br><br>  Le résultat le plus intéressant et le plus effrayant est un plantage complet du programme.  Lorsque j'ai démarré pour la première fois le fuzzer pour binitools, <code>bini</code> montré de <i>nombreux</i> plantages de ce type.  En quelques minutes, afl a découvert un certain nombre d'erreurs subtiles et intéressantes dans mon programme, ce qui était incroyablement utile.  Fazzer a même trouvé un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bug</a> improbable <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'un pointeur obsolète</a> , vérifiant l'ordre différent des différentes allocations de mémoire.  Ce bug particulier a été un tournant qui m'a fait prendre conscience de la valeur du fuzzing. <br><br>  Toutes les erreurs trouvées n'ont pas conduit à des échecs.  J'ai également étudié la sortie et regardé quelle entrée a donné un résultat positif et qui ne l'a pas fait, et j'ai regardé comment le programme a géré divers cas extrêmes.  Elle a rejeté certaines entrées que je pensais qu'elle traiterait.  Et vice versa, elle a traité certaines données que je considérais incorrectes et a interprété certaines données de manière inattendue pour moi.  Donc, même après avoir corrigé des bogues avec des plantages de programmes, j'ai toujours changé les paramètres de l'analyseur pour corriger chacun de ces cas désagréables. <br><br><h1>  Créer une suite de tests </h1><br>  Dès que j'ai corrigé toutes les erreurs détectées par le fuzzer et ajusté l'analyseur dans toutes les situations de frontière, j'ai fait un ensemble de tests à partir du paquet de données du fuzzer - mais pas directement. <br><br>  Tout d'abord, j'ai exécuté le fuzzer en parallèle - ce processus est expliqué dans la documentation afl - j'ai donc eu beaucoup d'entrées redondantes.  Par redondance, je veux dire que l'entrée est différente mais a le même chemin d'exécution.  Heureusement, afl dispose d'un outil pour y faire face: <code>afl-cmin</code> , un outil pour minimiser le shell.  Il élimine les entrées inutiles. <br><br>  Deuxièmement, beaucoup de ces entrées étaient plus longues que nécessaire pour invoquer leur chemin d'exécution unique.  <code>afl-tmin</code> , un minimiseur de cas de test qui a réduit le cas de test, a aidé <code>afl-tmin</code> . <br><br>  J'ai séparé les entrées valides et invalides - et les ai vérifiées dans le référentiel.  Jetez un œil à toutes ces entrées stupides <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">inventées par le fuzzer</a> basé sur une seule entrée minimale: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">entrée valide</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">entrée invalide</a> </li></ul><br>  En fait, ici, l'analyseur est figé dans un état, et un ensemble de tests garantit qu'un build particulier se comporte d'une manière <i>très</i> spécifique.  Cela est particulièrement utile pour garantir que les assemblages créés par d'autres compilateurs sur d'autres plates-formes se comportent de la même manière en ce qui concerne leur sortie.  Ma suite de tests a même détecté une erreur dans la bibliothèque dietlibc car binitools n'a pas réussi les tests après y avoir établi un lien.  Si vous deviez apporter des modifications non triviales à l'analyseur syntaxique, alors vous devriez essentiellement abandonner l'ensemble actuel de tests et recommencer à nouveau pour que afl génère un tout nouveau corps pour le nouvel analyseur. <br><br>  Bien sûr, le fuzzing s'est imposé comme une technique puissante.  Il a trouvé un certain nombre d'erreurs que je n'aurais jamais pu découvrir par moi-même.  Depuis lors, j'ai commencé à l'utiliser avec plus de compétence pour tester d'autres programmes - pas seulement le mien - et j'ai trouvé de nombreux nouveaux bugs.  Maintenant, Fuzzer a pris une place permanente parmi les outils de mon kit de développement. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438662/">https://habr.com/ru/post/fr438662/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438648/index.html">Comparaison des systèmes de BI (Tableau, Power BI, Oracle, Qlik)</a></li>
<li><a href="../fr438650/index.html">Rocket 9M729. Quelques mots sur le «violateur» du traité INF</a></li>
<li><a href="../fr438652/index.html">IDA de portabelization</a></li>
<li><a href="../fr438654/index.html">OpenSceneGraph: intégration avec Qt Framework</a></li>
<li><a href="../fr438658/index.html">Comment apprendre à apprendre</a></li>
<li><a href="../fr438664/index.html">Dispositif de compilateur Swift. 2e partie</a></li>
<li><a href="../fr438666/index.html">Manager vs Programmer</a></li>
<li><a href="../fr438668/index.html">«Cherchez des histoires qui conduisent»: un podcast sur les podcasts, le travail éditorial et les carrières médiatiques</a></li>
<li><a href="../fr438670/index.html">Les attaquants utilisent les avertissements pour atteinte aux droits d'auteur sur YouTube pour extorquer de l'argent aux auteurs</a></li>
<li><a href="../fr438672/index.html">Encodage UTF-8 dans les noms et mots de passe Wi-Fi (Emoji)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>