<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüç≥ ‚òùÔ∏è üîº [Admin-Zusammenfassung] Wie man sich mit DHCP anfreundet und keine Angst vor APIPA hat üå∏ üêÉ üèñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der Dienst, der IP-Adressen an Ger√§te im lokalen Netzwerk vergibt, scheint einer der einfachsten und bekanntesten zu sein. Trotzdem haben meine j√ºnger...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>[Admin-Zusammenfassung] Wie man sich mit DHCP anfreundet und keine Angst vor APIPA hat</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pc-administrator/blog/467333/"><p><img src="https://habrastorage.org/getpro/habr/post_images/9c9/795/e15/9c9795e155e62808327ad29e2e964e7a.jpg"></p><br><p>  Der Dienst, der IP-Adressen an Ger√§te im lokalen Netzwerk vergibt, scheint einer der einfachsten und bekanntesten zu sein.  Trotzdem haben meine j√ºngeren Kollegen gelegentlich noch Fragen wie ‚ÄûDer Computer erh√§lt eine seltsame Adresse‚Äú, und das Erscheinen eines zweiten DHCP-Servers in einem Netzwerksegment verursacht Nervenkitzel oder Netzwerkprobleme. </p><br><p>  Damit diejenigen, die dieses Material lesen, keine solchen Fragen haben, m√∂chte ich eine Reihe grundlegender Informationen zum Betrieb von Mechanismen, Funktionen und Konfigurationsbeispielen f√ºr fehlertolerante und gesch√ºtzte Konfigurationen zur Ausgabe von IP-Adressen zusammenstellen.  Ja, und vielleicht sind unerfahrene Spezialisten daran interessiert, neuronale Verbindungen aufzufrischen. </p><br><p>  Ein wenig Theorie und L√∂sungen f√ºr interessante und nicht sehr praktische Probleme - unter dem Schnitt. </p><a name="habracut"></a><br><p>  In einem modernen lokalen Netzwerk erfolgt die Ausgabe von Adressen normalerweise durch spezialisierte Dienste mit Protokollunterst√ºtzung.  Am beliebtesten ist DHCP (Dynamic Host Configuration Protocol). </p><br><h1 id="zeroconf-ili-zachem-nam-voobsche-kakoy-to-dhcp">  Zeroconf oder warum brauchen wir eine Art DHCP </h1><br><p> Im Prinzip wurde ein Technologie-Stack namens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zeroconf</a> speziell f√ºr kleine Netzwerke erstellt.  Sie k√∂nnen auf zentralisierte Dienste und Server verzichten, einschlie√ülich, aber nicht beschr√§nkt auf die Ausgabe von IP-Adressen.  Sie schlie√üen (gut oder fast) die folgenden Fragen: </p><br><p>  <strong>Abrufen einer IP-Adresse</strong> (Automatic Private IP Addressing oder APIPA).  Das System selbst weist eine IP aus dem Netzwerk 169.254.0.0/16 (mit Ausnahme der / 24-Gitter am Anfang und Ende des Bereichs) basierend auf der MAC-Adresse und dem Pseudozufallszahlengenerator zu.  Mit diesem System k√∂nnen Sie Konflikte vermeiden, und die Adresse aus diesem Netzwerk wird als verbindungslokal bezeichnet - auch weil diese Adressen nicht weitergeleitet werden. </p><br><p>  <strong>Suche nach Namen</strong> .  Das System gibt seinen Netzwerknamen bekannt und jeder Computer arbeitet mit ihm wie mit DNS und speichert Eintr√§ge in seinem Cache.  Apple verwendet die mDNS-Technologie (Multicast DNS) und Microsoft die LLMNR-Technologie (Link-Local Multicast Name Resolution), die im Artikel ‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dom√§nen, Adressen und Windows: Mischen, aber nicht sch√ºtteln</a> ‚Äú erw√§hnt wird. </p><br><p>  <strong>Suchen Sie nach Netzwerkdiensten</strong> .  Zum Beispiel Drucker.  Das vielleicht bekannteste Protokoll ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">UPnP</a> , das unter anderem Ports auf Routern selbst √∂ffnen kann.  Das Protokoll ist ziemlich kompliziert, es verwendet eine ganze Reihe von Add-Ons wie http, im Gegensatz zum zweiten bekannten Protokoll - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DNS-SD</a> (DNS Service Discovery), das einfach SRV-Eintr√§ge verwendet, auch bei der Arbeit mit mDNS. </p><br><p>  Mit all den Vorteilen von Zeroconf - ohne heiliges Wissen k√∂nnen Sie ein funktionierendes Netzwerk aufbauen, indem Sie einfach Computer auf physischer Ebene verbinden - kann es sogar IT-Spezialisten st√∂ren. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d5b/71d/a7e/d5b71da7ea5fe5493e9881ee71272394.jpg"></p><br><p>  <em>Ein bisschen nervig, nicht wahr?</em> </p><br><p>  Um die <em>automatische</em> Optimierung auf allen Netzwerkadaptern zu deaktivieren, m√ºssen Sie auf Windows-Systemen einen DWORD-Parameter mit dem Namen <em>IPAutoconfigurationEnabled</em> im <em>Abschnitt HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ Tcpip \ Parameters erstellen</em> und auf 0 setzen. </p><br><p>  Nat√ºrlich ist Zeroconf nur f√ºr kleine isolierte Netzwerke geeignet (Sie haben beispielsweise einen Freund mit Laptops getroffen, diese √ºber WLAN verbunden und Diablo II gespielt, ohne Zeit auf Servern zu verschwenden), und ich m√∂chte auch ein lokales Netzwerk mit dem Internet verbinden .  Um nicht unter den statischen Einstellungen jedes Computers zu leiden, wurden spezielle Protokolle erstellt, einschlie√ülich des Helden des Tages - DHCP. </p><br><h1 id="dhcp-i-ego-praroditeli">  DHCP und seine Vorl√§ufer </h1><br><p>  Eine der ersten Implementierungen des Protokolls zur Ausgabe von IP-Adressen erschien vor mehr als 30 Jahren und wurde als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RARP</a> (Reverse Address Resolution Protocol) bezeichnet.  Wenn wir das Funktionsprinzip ein wenig vereinfachen, sah es so aus: Der Client stellte eine Anfrage an die Broadcast-Adresse des Netzwerks, der Server akzeptierte sie, fand die Bindung der MAC-Adresse und IP des Clients in seiner Datenbank und sendete eine IP-Antwort. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6a/53f/109/e6a53f1099a79a913500b6dea05b1dfd.jpg"></p><br><p>  <em>Schema des RARP-Protokolls.</em> </p><br><p>  Und alles schien zu funktionieren.  Das Protokoll hatte jedoch seine Nachteile: Es war erforderlich, den Server in jedem Segment des lokalen Netzwerks zu konfigurieren, die MAC-Adressen auf diesem Server zu registrieren und es gab keine M√∂glichkeit, zus√§tzliche Informationen an den Client zu √ºbertragen.  Um es zu ersetzen, wurde daher das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BOOTP-</a> Protokoll (Bootstrap Protocol) erstellt. </p><br><p>  Urspr√ºnglich wurde es f√ºr plattenlose Workstations verwendet, die nicht nur eine IP-Adresse angeben, sondern auch zus√§tzliche Informationen an den Client √ºbertragen mussten, z. B. die Adresse des TFTP-Servers und den Namen der Download-Datei.  Im Gegensatz zu RARP unterst√ºtzte das Protokoll bereits Relay - kleine Dienste, die Anforderungen an den ‚ÄûHauptserver‚Äú weiterleiteten.  Dies erm√∂glichte die gleichzeitige Verwendung eines Servers in mehreren Netzwerken.  Es blieb nur die Notwendigkeit, die Tabellen und die Gr√∂√üenbeschr√§nkung f√ºr zus√§tzliche Informationen manuell zu konfigurieren.  Infolgedessen ist das moderne DHCP-Protokoll in die Szene eingetreten, eine kompatible Erweiterung von BOOTP (der DHCP-Server unterst√ºtzt Legacy-Clients, aber nicht umgekehrt). </p><br><p>  Ein wichtiger Unterschied zu veralteten Protokollen besteht in der M√∂glichkeit, vor√ºbergehend eine Adresse (Lease) auszugeben und eine gro√üe Menge unterschiedlicher Informationen an den Client zu √ºbertragen.  Dies wird aufgrund des weniger trivialen Verfahrens zum Erhalten der Adresse erreicht.  Wenn in den alten Protokollen das Schema in der Form Anfrage-Antwort einfach war, lautet das Schema jetzt wie folgt: </p><br><ul><li>  Der Client sucht mit einer Broadcast-Anforderung nach dem Server und fordert zus√§tzliche Einstellungen an. </li><li>  Der Server antwortet dem Client mit einer IP-Adresse und anderen Einstellungen. </li><li>  Der Client best√§tigt die empfangenen Informationen per Broadcast-Anfrage und gibt in der Best√§tigung die IP-Adresse des ausgew√§hlten Servers an. </li><li>  Der Server stimmt dem Client zu, indem er ihm eine Anfrage sendet, nach deren Erhalt der Client die Netzwerkschnittstelle bereits konfiguriert oder ablehnt. </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b55/510/aa5/b55510aa54fa43c6b42e109826ec02a5.jpg"></p><br><p>  <em>Das Kommunikationsschema des Clients mit dem Weiterleitungsserver und dem Server.</em> </p><br><p>  Weitere Informationen zum Server-Client-Interaktionsschema und zur Struktur von Anforderungen und Antworten finden Sie beispielsweise im Material ‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Struktur, Format und Zweck von DHCP-Paketen</a> ‚Äú. </p><br><blockquote>  Bei mehreren Interviews fragten sie mich: "Welchen Transport und Hafen nutzt DHCP?"  F√ºr alle F√§lle antworten wir: "UDP-Server: 67, UDP-Client: 68". </blockquote><p>  Viele Implementierungen eines DHCP-Servers sind von vielen angetroffen worden, selbst beim Einrichten eines Heimnetzwerks.  In der Tat ist der Server jetzt: </p><br><ul><li>  Auf fast jedem Router, besonders auf SOHO. </li><li>  Auf Windows Server-Systemen.  Informationen zum Server und seiner Konfiguration finden Sie in der offiziellen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> . </li><li>  Auf * nix-Systemen.  Die vielleicht beliebteste Software ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ISC DHCP Server</a> (dhcpd) und der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dnsmasq</a> ‚ÄûHarvester‚Äú. </li></ul><br><p>  Es gibt viele spezifische Implementierungen, aber beispielsweise sind die Servereinstellungen auf SOHO-Routern beschr√§nkt.  Dies betrifft haupts√§chlich zus√§tzliche Einstellungen zus√§tzlich zu der klassischen "IP-Adresse, Maske, Gateway, DNS-Server".  Und genau diese zus√§tzlichen Optionen verursachen das gr√∂√üte Interesse an der Funktionsweise des Protokolls.  Die vollst√§ndige Liste finden Sie im entsprechenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC</a> , aber ich werde einige interessante Beispiele analysieren. </p><br><h1 id="udivitelnye-opcii-dhcp">  Erstaunliche DHCP-Optionen </h1><br><p>  In diesem Abschnitt werde ich die praktische Verwendung von DHCP-Optionen auf MikroTik-Ger√§ten erl√§utern.  Ich werde sofort darauf aufmerksam machen, dass nicht alle Optionen offensichtlich festgelegt sind. Das Format der Parameter wird im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wiki beschrieben</a> .  Es ist auch zu beachten, dass der Kunde die Optionen nur anwendet, wenn er danach fragt.  Auf einigen Servern k√∂nnen Sie das Senden der Einstellungen erzwingen: In ISC DHCP Server ist beispielsweise die <strong><em>Anweisung dhcp-parameter-request-list</em></strong> daf√ºr verantwortlich, und in Dnsmasq - * * <strong><em>--dhcp-option-force</em></strong> .  MikroTik und Windows wissen nicht wie. </p><br><p>  <strong>Option 6</strong> und <strong>Option 15.</strong> Beginnen wir mit einer einfachen.  Die Einstellungsnummer 6 sind die den Clients zugewiesenen DNS-Server, 15 ist das DNS-Suffix.  Das Zuweisen eines DNS-Suffix kann hilfreich sein, wenn Sie mit Dom√§nenressourcen in einem Nicht-Dom√§nennetzwerk arbeiten, wie im Artikel ‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wie wir das Personal durch Wi-Fi reduziert haben</a> ‚Äú beschrieben.  Konfigurieren Sie MikroTik unter dem Spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">MikroTik einrichten, Option 15</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  15.  ‚Äî   HEX . /ip dhcp-server option add code=15 name=dns-suffix value=0x57687920616c6c207468697320736869743f #   /ip dhcp-server option sets add name=dns option=dns-suffix #   DHCP-  . /ip dhcp-server network set [find comment="wi-fi client dhcp"] dhcp-option-set=dns</span></span></code> </pre> </div></div><br><p>  Zu wissen, dass ein DNS-Server auch eine Option ist, hat sich in letzter Zeit als n√ºtzlich erwiesen, wenn verschiedene Clients unterschiedliche DNS-Server ausstellen mussten.  Die Entscheidung des Formulars ‚Äûeinen Server ausstellen und unterschiedliche dst-nat-Regeln f√ºr Port 53 festlegen‚Äú passte aus mehreren Gr√ºnden nicht.  Ein Teil der Konfiguration befindet sich wieder unter dem Spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">MikroTik einrichten, Option 6</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ,  ,  ip    /ip dhcp-server option add code=6 name=google value="'8.8.8.8'" add code=6 name=cloudflare value="'1.1.1.1'" #  /ip dhcp-server lease add address=10.0.0.2 dhcp-option=google mac-address=11:11:11:11:11:11 server=dhcp add address=10.0.0.3 dhcp-option=cloudflare mac-address=22:22:22:22:22:22 server=dhcp</span></span></code> </pre></div></div><br><p>  <strong>Option 66</strong> und <strong>Option 67</strong> .  Diese Einstellungen stammen von BOOTP und erm√∂glichen es Ihnen, den TFTP-Server und das Image f√ºr den Netzwerkstart anzugeben.  F√ºr einen kleinen Zweig ist es sehr praktisch, dort Mikrotik- und plattenlose Workstations zu installieren und ein vorbereitetes Image einer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ThinStation auf den Router zu</a> werfen.  Beispiel f√ºr eine DHCP-Konfiguration: </p><br><pre> <code class="bash hljs">/ip dhcp-server option add name=<span class="hljs-string"><span class="hljs-string">"option66"</span></span> code=66 value=<span class="hljs-string"><span class="hljs-string">"s'192.168.88.1'"</span></span> add name=<span class="hljs-string"><span class="hljs-string">"option67"</span></span> code=67 value=<span class="hljs-string"><span class="hljs-string">"'pxelinux.0'"</span></span> /ip dhcp-server option sets add name=<span class="hljs-string"><span class="hljs-string">"set-pxe"</span></span> options=option66,option67</code> </pre><br><p>  <strong>Option 121</strong> und <strong>Option 249</strong> .  Sie werden verwendet, um zus√§tzliche Routen an den Client zu √ºbertragen. Dies ist in einigen F√§llen m√∂glicherweise bequemer als das Registrieren von Routen auf dem Standard-Gateway.  Die Einstellungen sind nahezu identisch, au√üer dass Windows-Clients letztere bevorzugen.  Um den Parameter zu konfigurieren, m√ºssen die Routen hexadezimal konvertiert werden, wobei die Zielnetzwerkmaske, die Netzwerkadresse und das Gateway in einer Zeile erfasst werden.  Au√üerdem m√ºssen Sie per RFC eine Standardroute hinzuf√ºgen.  Die Tuning-Option befindet sich unter dem Spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Routeneinrichtung</b> <div class="spoiler_text"><p>  Angenommen, wir m√ºssen Clients eine Route wie dst-address = 10.0.0.0 / 24 gateway = 192.168.88.2 hinzuf√ºgen, und das Hauptgateway lautet 192.168.88.1.  Lassen Sie uns alles in HEX bringen: </p><br><div class="scrollable-table"><table><tbody><tr><td>  Einstellungsdaten </td><td>  Dez. </td><td>  Hex </td></tr><tr><td>  Maske </td><td>  24 </td><td>  0x18 </td></tr><tr><td>  Zielnetzwerk </td><td>  10.0.0.0 </td><td>  0x0A 00 00 </td></tr><tr><td>  Gateway </td><td>  192.168.88.2 </td><td>  0xc0 a8 58 02 </td></tr><tr><td>  Standardnetzwerk </td><td>  0.0.0.0/0 </td><td>  0x00 </td></tr><tr><td>  Standard-Gateway </td><td>  192.168.88.1 </td><td>  0xc0 a8 58 01 </td></tr></tbody></table></div><br><p>  Lassen Sie uns all dieses Gl√ºck in einer Zeile sammeln und die Einstellung erhalten: </p><br><pre> <code class="bash hljs">/ip dhcp-server option add code=121 name=classless value=0x0A0000c0a8580200c0a85801</code> </pre></div></div><br><p>  Lesen Sie mehr im Artikel ‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mikrotik, DHCP Classless Route</a> ‚Äú. </p><br><p>  <strong>Option 252.</strong> Automatische Proxy-Server-Konfiguration.  Wenn die Organisation aus irgendeinem Grund einen undurchsichtigen Proxy verwendet, ist es zweckm√§√üig, ihn mit Clients √ºber eine spezielle wpad (pac) -Datei zu konfigurieren.  Ein Beispiel f√ºr das Einrichten einer solchen Datei ist im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PAC-</a> Material <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">(Proxy Auto Configuration) beschrieben</a> .  Leider verf√ºgt MiroTik nicht √ºber einen integrierten Webserver zum Hosten dieser Datei.  Sie k√∂nnen hierf√ºr das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hotspot-</a> Paket oder die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Metarouter-</a> Funktionen verwenden. Es ist jedoch besser, die Datei an einer anderen Stelle abzulegen. </p><br><p>  <strong>Option 82</strong> .  Eine der n√ºtzlichsten Optionen ist nicht nur f√ºr den Client, sondern auch f√ºr das DHCP-Relay.  Erm√∂glicht die √úbertragung von Informationen √ºber den Switch-Port, mit dem der Client verbunden ist, und die ID des Switch selbst.  Basierend auf diesen Informationen kann der Server wiederum bereits bestimmte Einstellungen f√ºr den Client vornehmen oder diese einfach protokollieren. Um den Verbindungsport des Clients zu finden, mussten nicht alle Switches hintereinander aufgerufen werden (insbesondere, wenn sie sich nicht auf dem Stapel befinden). </p><br><p>  Nachdem DHCP-Relay auf dem Router konfiguriert wurde, werden die Felder <strong>Agent Circuit ID</strong> und <strong>Agent Remote ID</strong> in den Clientinformationen angezeigt, wobei das erste die Switch-Port- <strong>ID</strong> und das zweite die Switch- <strong>ID</strong> ist. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9c3/350/fb7/9c3350fb7d11ac6f57f28c21eb58489f.jpg"></p><br><p>  <em>Adressen mit Option 82 ausgeben.</em> </p><br><p>  Die Informationen werden im Hexadezimalformat angegeben.  Zur Vereinfachung k√∂nnen Sie das DHCP-Protokoll mithilfe von Skripten analysieren.  Beispielsweise wird in der Technet-Skriptgalerie eine L√∂sung f√ºr eine L√∂sung von Microsoft mit dem Namen ‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dekorieren von DHCP-Optionen 82</a> ‚Äú ver√∂ffentlicht. </p><br><p>  <strong>Option 82 wird auch</strong> aktiv im Abrechnungssystem von Anbietern und zum Schutz des Netzwerks vor St√∂rungen von au√üen verwendet.  Dies ist etwas detaillierter. </p><br><h1 id="dobavim-seti-nadezhnosti-i-bezopasnosti">  F√ºgen Sie Zuverl√§ssigkeits- und Sicherheitsnetzwerke hinzu </h1><br><p>  Aufgrund der Einfachheit des Protokolls und des Vorhandenseins von Broadcast-Anforderungen kommt es zu effektiven Angriffen auf die Infrastruktur - haupts√§chlich vom Typ MITM (‚ÄûMann in der Mitte‚Äú).  Angriffe werden durch Erh√∂hen Ihres DHCP-Servers oder -Relais ausgef√ºhrt. Wenn Sie die Ausgabe von Netzwerkeinstellungen steuern, k√∂nnen Sie den Datenverkehr problemlos auf ein gef√§hrdetes Gateway umleiten.  Um den Angriff zu erleichtern, wird DHCP-Hunger verwendet (der Angreifer gibt vor, ein Client oder ein Relay zu sein, und zwingt den "nativen" DHCP-Server, seine IP-Adressen zu ersch√∂pfen).  Weitere Informationen zur Implementierung des Angriffs finden Sie im Artikel ‚Äû <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Angriff auf DHCP</a> ‚Äú, w√§hrend <strong>DHCP-Snooping</strong> die Schutzmethode ist. </p><br><p>  Dies ist eine Switch-Funktion, mit der Sie einen DHCP-Server an einen bestimmten Port "binden" k√∂nnen.  DHCP-Antworten an anderen Ports werden blockiert.  Bei einigen Switches k√∂nnen Sie die Arbeit mit Option 82 konfigurieren, wenn sie im Paket erkannt wird (was auf das Vorhandensein eines Relais hinweist): Verwerfen, ersetzen, unver√§ndert lassen. </p><br><p>  In MikroTik-Switches ist DHCP-Snooping in den Bridge-Einstellungen aktiviert: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># dhcp-snooping  option 82 /interface bridge add name=bridge set [find where name="bridge"] dhcp-snooping=yes add-dhcp-option82=yes #    /interface bridge port add bridge=bridge interface=ether1 add bridge=bridge interface=ether2 trusted=yes</span></span></code> </pre><br><p>  Die Konfiguration in anderen Switches ist √§hnlich. </p><br><blockquote>  Es ist erw√§hnenswert, dass nicht alle MikroTik-Modelle vollst√§ndige Hardware-Unterst√ºtzung f√ºr DHCP-Snooping bieten - nur CRS3xx. </blockquote><p>  Zus√§tzlich zum Schutz vor b√∂swilligen Hackern lindert diese Funktion Kopfschmerzen, wenn ein anderer DHCP-Server im Netzwerk angezeigt wird - beispielsweise wenn ein SOHO-Router, der als Switch mit einem Zugriffspunkt verwendet wird, seine Einstellungen zur√ºcksetzt.  Leider gibt es in Netzwerken, in denen SOHO-Ger√§te vorhanden sind, nicht immer eine kompetente Kabelnetzwerkstruktur mit verwalteten Routern.  Aber das ist eine andere Frage. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/058/801/3c3/0588013c3a7595d350ee0f207dcd7b83.jpg"></p><br><p>  <em>Sch√∂nes Schalten ist der Schl√ºssel zur Gesundheit.</em> </p><br><p>  Andere Schutzmethoden umfassen die <strong>Port-Sicherheit</strong> ("Binden" einer bestimmten MAC-Adresse an den Router-Port, der Port wird blockiert, wenn Datenverkehr von anderen Adressen erkannt wird), die Verkehrsanalyse f√ºr die Anzahl der DHCP-Anforderungen und -Antworten oder die Begrenzung ihrer Anzahl und nat√ºrlich die Anzahl verschiedene <strong>IPS \ IDS-</strong> Systeme. </p><br><p>  Wenn wir nicht nur √ºber den Netzwerkschutz, sondern auch √ºber die Zuverl√§ssigkeit sprechen, ist es nicht unangebracht, die Funktionen von ausfallsicherem DHCP zu erw√§hnen.  In der Tat ist DHCP aufgrund seiner Einfachheit h√§ufig einer der Schl√ºsseldienste. Wenn dies fehlschl√§gt, kann die Arbeit des Unternehmens gel√§hmt werden.  Wenn Sie jedoch nur zwei Server mit identischen Einstellungen installieren, f√ºhrt nur ein Konflikt von IP-Adressen dazu. </p><br><p>  Es scheint, dass Sie den Verteilungsbereich auf zwei Server aufteilen k√∂nnen und einen die eine H√§lfte der Adressen und den anderen die andere geben lassen.  Hier ist nur eine gel√§hmte H√§lfte der Infrastruktur etwas besser als die ganze. </p><br><p>  Wir werden weitere praktische Optionen analysieren. </p><br><p>  Auf <strong>Windows Server-</strong> Systemen ab 2012 funktioniert das DHCP-Redundanzsystem sofort im Lastausgleichsmodus (Aktiv-Aktiv) oder im Fehlertoleranzmodus (Aktiv-Passiv).  Eine detaillierte Beschreibung der Technologie und der Einstellungen finden Sie in der offiziellen <a href="">Dokumentation</a> .  Ich stelle fest, dass die Fehlertoleranz auf Zonenebene konfiguriert ist, sodass verschiedene Zonen in verschiedenen Modi arbeiten k√∂nnen. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ced/b26/26d/cedb2626dd463700eed59152438a6a60.jpg"></p><br><p>  <em>Konfigurieren des DHCP-Server-Failovers unter Windows.</em> </p><br><p>  <strong>ISC DHCP Server</strong> verwendet die <strong><em>Failover-Peer-</em></strong> Direktive zum Konfigurieren der Fehlertoleranz. Es wird vorgeschlagen, Daten unabh√§ngig voneinander zu synchronisieren, z. B. mithilfe von rsync.  Lesen Sie mehr im Artikel " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zwei DHCP-Server unter Centos7 ...</a> " </p><br><p>  Wenn Sie eine fehlertolerante L√∂sung auf Basis von MikroTik erstellen, k√∂nnen Sie nicht auf Tricks verzichten.  Eine der Optionen zur L√∂sung des Problems wurde bei MUM RU 18 angek√ºndigt und dann <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im</a> Blog des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Autors ver√∂ffentlicht</a> .  Kurz gesagt: Zwei Server sind konfiguriert, jedoch mit einem anderen Parameter f√ºr den Verz√∂gerungsschwellenwert (Antwortverz√∂gerung).  Dann gibt der Server die Adresse mit weniger Verz√∂gerung und mit einer l√§ngeren Verz√∂gerung aus - nur wenn die erste ausf√§llt.  Die Informationssynchronisation muss erneut mit Skripten erfolgen. </p><br><p>  Pers√∂nlich habe ich einmal ziemlich nerv√∂s gemacht, als ein Router ‚Äûversehentlich‚Äú im Netzwerk auftauchte und sowohl mit der WAN- als auch mit der LAN-Schnittstelle mit dem lokalen Netzwerk verbunden war. </p><br><p>  <strong>Sag mir, musstest du dich mit DHCP-Lepra auseinandersetzen?</strong> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de467333/">https://habr.com/ru/post/de467333/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de467317/index.html">Wie SoftBank die Welt verschluckte</a></li>
<li><a href="../de467323/index.html">√úbersicht √ºber die Programmierfunktionen von Qt Creator 4.10 und QBS 1.14 Microcontroller</a></li>
<li><a href="../de467327/index.html">Wie ich im Alter von 35 Jahren Programmierer wurde</a></li>
<li><a href="../de467329/index.html">Die besten Produkte gehen von echten Problemen aus: Gegensprechanlage √ºber zu erledigende Jobs. Teil 1</a></li>
<li><a href="../de467331/index.html">Verkauf + ein wundersch√∂ner Online-Shop auf WordPress f√ºr $ 269 "von Grund auf neu" - unsere Erfahrung</a></li>
<li><a href="../de467335/index.html">So aktualisieren Sie Node.js √ºber Visual Studio, NPM, Windows / Mac</a></li>
<li><a href="../de467337/index.html">Das beliebteste Handyspiel: Wie die "Schlange" f√ºr Nokia-Handys entwickelt wurde</a></li>
<li><a href="../de467339/index.html">Und wieder der 256. Tag des Jahres</a></li>
<li><a href="../de467343/index.html">Warum ich freiberuflich k√ºndige: Eindr√ºcke des Backend-Entwicklers nach 2 Jahren ‚ÄûFreiheit‚Äú</a></li>
<li><a href="../de467345/index.html">Hit IT-Blogs und 4 Trainingsebenen: ein Interview mit Sergei Abdulmanov aus Mosigra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>