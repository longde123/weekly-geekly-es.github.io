<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÖ üë£ üßïüèø Localisation du marqueur Aruco üëàüèª üë®‚Äçüåæ üò°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans le dernier article, nous avons expliqu√© comment passer d'un point A √† un point B sans rien toucher. Mais pour contourner quelque chose, il faut c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Localisation du marqueur Aruco</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482220/">  <a href="https://habr.com/ru/post/479636/">Dans le dernier article,</a> nous avons expliqu√© comment passer d'un point A √† un point B sans rien toucher.  Mais pour contourner quelque chose, il faut comprendre o√π nous en sommes et o√π il y a des obstacles dynamiques (nos adversaires et pas seulement). <br><br>  Une personne a des yeux, des oreilles et un logiciel d√©finis par la nature et l'exp√©rience personnelle pour pouvoir se d√©placer et naviguer facilement dans l'espace.  Le syst√®me de localisation est presque l'≈ìil et l'oreille des robots.  Il est n√©cessaire pour que le robot puisse naviguer dans l'espace et, en s'adaptant √† l'environnement, s'y d√©placer. <br><br>  Aujourd'hui, nous allons parler de la fa√ßon dont nous avons r√©solu le probl√®me de la d√©termination de la position des robots sur le champ Eurobot, comment faire tout cela, lancer et configurer par vous-m√™me. <br><br><img src="https://habrastorage.org/webt/wd/ob/7l/wdob7lxsj1x5z0ubs94tyz5hf08.png"><br><a name="habracut"></a><br><h2>  Conditions cibles du syst√®me de localisation </h2><br>  L'un des principes d'Eurobot Open est l'autonomie.  Autonomie par rapport √† tout ce qui se trouve derri√®re le terrain de jeu.  Tous les calculs, la prise de d√©cision et la localisation doivent √™tre effectu√©s soit sur des robots, soit sur des sites sp√©ciaux sur le terrain. <br><br>  La taille du champ est de 2x3 m√®tres, et l'erreur dans la taille et la position des √©l√©ments sur celui-ci d'un champ √† l'autre est g√©n√©ralement de 3 √† 5 mm. <br><br>  Dans l'image ci-dessous est un diagramme du champ Eurobot 2019 avec des zones marqu√©es sur lesquelles nous pouvons placer autre chose que des robots. <br><br><img src="https://habrastorage.org/webt/ed/sn/nr/edsnnr36r2ksmv9sr7pzjz1khhk.png"><br><br><ul><li>  6 - Zone d'exp√©rimentation (l'une des t√¢ches suppl√©mentaires) </li><li>  10 - Zones du phare </li><li>  11 - Une tour sp√©ciale pour l'installation d'un dispositif de rep√©rage central (ci-apr√®s d√©nomm√© CCC).  Situ√© au-dessus du champ √† une hauteur de 1 m√®tre </li><li>  Sur les robots eux-m√™mes, nous pouvons √©galement installer des balises. </li></ul><br>  Pour toutes ces zones et les dimensions des robots eux-m√™mes, il existe des restrictions strictes sur le poids et la taille, car il est impossible de fabriquer un grand supermodule productif dans lequel tout rentre.  Et il y a aussi une limite de 3 minutes pour la pr√©paration au lancement.  Pendant ce temps, une ou deux personnes de l'√©quipe doivent retirer les robots et tout ce qui les concerne, organiser, configurer et pr√©parer le lancement.  De toute √©vidence, moins vous avez besoin de r√©gler et de r√©gler les d√©chets, moins vous risquez de faire une erreur ou d'√™tre condamn√© √† une amende avant le d√©but de la bataille. <br><br><img src="https://habrastorage.org/webt/73/ic/e7/73ice79-lmosmu6rt-gi5gdz744.jpeg"><br>  <i>et une autre deuxi√®me bo√Æte pleine</i> <br><br><h3>  Nous analysons les options </h3><br>  Conscients de nos capacit√©s et d√©sireux d'obtenir une pr√©cision de positionnement d'au moins quelques millim√®tres, voyons ce que nous pouvons utiliser en g√©n√©ral pour r√©soudre ce probl√®me: <br><br><ul><li>  <b>L'odom√©trie des roues √† l'</b> aide d'encodeurs situ√©s directement sur l'entra√Ænement ou de roues de mesure suppl√©mentaires vous permet de lire la distance parcourue par le robot et de d√©terminer sa position par rapport au point de d√©part.  De nombreuses √©quipes d'Eurobot l'utilisent comme m√©thode de localisation principale.  C'est l'une des sources d'informations de mouvement les plus rapides pour le robot.  Cependant, dans la pratique, en particulier lors de la conduite sur des roues omnidirectionnelles (une zone de contact plus petite que les roues classiques, le jeu des rouleaux et des erreurs de fabrication plus importantes), l'odom√©trie est sensible au probl√®me des erreurs cumulatives, qui doivent √™tre corrig√©es d'une certaine mani√®re.  Vous pouvez vous aligner avec la surface avec des coordonn√©es connues, ou vous pouvez complexer avec un syst√®me suppl√©mentaire.  De plus, si vous utilisez des encodeurs sur les roues motrices, il y a un probl√®me de patinage des roues lors de man≈ìuvres brusques et lors de collisions du robot.  Les roues de mesure peuvent √©liminer ce probl√®me, mais elles sont difficiles √† placer dans un petit robot. <br><br><img src="https://habrastorage.org/webt/v0/8u/bd/v08ubdzodh5zpr8kr7ee3fhbo5y.png"><br>  <i>roue omnidirectionnelle de mesure avec suspension ind√©pendante et avec encodeur magn√©tique, que nous avons utilis√©e en 2018</i> <br></li><li>  <b>Les lidars</b> ont des avantages importants: nous obtenons une vue presque circulaire et des distances aux obstacles.  Parmi les inconv√©nients, il convient de noter le prix √©lev√©, la difficult√© √† distinguer les petits objets √©loign√©s des ordures et un algorithme de localisation relativement compliqu√©.  Les lidars bon march√© (tels que rplidar) ont un taux de rafra√Æchissement et une r√©solution angulaire assez bas, et sont √©galement soumis √† la lumi√®re d'autres lidars, t√©l√©m√®tres, etc. Dans les robots, il est difficile de trouver un lidar au niveau lat√©ral pour utiliser les algorithmes SLAM classiques, mais sur le fourni les r√®gles d'√©l√©vation pour les syst√®mes de localisation ont peu d'objets statiques pour la liaison.  Cependant, l'√©quipe Skoltech patine avec succ√®s depuis plusieurs ann√©es avec le hokuyo ust-10lx et a pris l'an dernier la deuxi√®me place de la finale europ√©enne de la comp√©tition Eurobot en France. </li><li>  Nous avons √©galement consid√©r√© <b>les syst√®mes inertiels</b> , mais dans notre cas, ils ne correspondaient pas bien.  L'acc√©l√©rom√®tre est bruyant, le gyroscope flotte, vous pouvez oublier d'utiliser la boussole √† l'int√©rieur.  M√™me l'utilisation d'un filtre de Kalman n'atteint pas la pr√©cision souhait√©e.  Il s'av√®re que l'IMU ne peut √™tre utilis√© efficacement pour la correction que dans un tr√®s court laps de temps.  Le maximum d'informations utiles que nous avons pu obtenir avec pixhawk2 est l'angle lors d'un virage serr√© (d'une collision, par exemple). </li><li>  <b>Le GPS</b> ne fonctionne pas √† l'int√©rieur et la pr√©cision sans RTK est de m√®tres. </li><li>  <b>Localisation ultrasonique</b> .  L'une des impl√©mentations peut √™tre trouv√©e ici: <a href="https://m.habr.com/ru/post/451408/">m.habr.com/en/post/451408</a> .  H√©las, la pr√©cision de nos t√¢ches n'est pas tr√®s √©lev√©e (+ -2cm), la diaphonie affecte fortement, ou, si vous utilisez des capteurs avec protection contre cela, une fr√©quence d'interrogation basse est obtenue.  L'une des √©quipes en Russie utilise cette solution avec plus ou moins de succ√®s, et l'√©quipe allemande de Turag utilise avec succ√®s une technologie similaire d√©velopp√©e √† l'int√©rieur du laboratoire. </li><li>  <b>L'odom√©trie visuelle</b> ne renseigne pas sur la position des adversaires car il n'y a pas beaucoup de points sur le terrain sur lesquels il sera possible de s'accrocher de mani√®re fiable. </li><li>  <b>\ Les cam√©ras st√©r√©o Tof</b> ont un angle √©troit, ce qui ne permet ni de couvrir le champ lorsqu'elles sont situ√©es sur le dispositif de rep√©rage central, ni d'obtenir une vue circulaire ou au moins une vue acceptable lorsqu'elles sont install√©es sur un robot. </li><li>  <b>Les rep√®res fiduciaires</b> que nous avons choisis et que nous examinerons plus en d√©tail. </li></ul><br><h3>  Marqueurs fiduciaires </h3><br>  La navigation par marqueur existe depuis longtemps.  En th√©orie, le soi-disant marqueur peut √™tre n'importe quel objet.  Mais il y a beaucoup de probl√®mes lors de l'utilisation: <br><br><ul><li>  restrictions dues √† la r√©solution de la cam√©ra; </li><li>  manque de fiabilit√© de la d√©tection lors de l'utilisation de la couleur comme principale source d'information; </li><li>  la n√©cessit√© de d√©terminer l'orientation du marqueur; </li><li>  les marques √† faible contraste ne fonctionnent bien que sous un bon √©clairage; </li><li>  une puissance de traitement √©lev√©e de l'√©quipement est requise (traitement en temps r√©el des trames entrantes). </li></ul><br>  Pour contourner les probl√®mes ci-dessus, vous devez g√©n√©ralement utiliser quelque chose de simple et sans ambigu√Øt√© pour la reconnaissance, par exemple, un cercle color√© ou un carr√© (et je voudrais un canard jaune). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/636/59e/f61/63659ef613cf69454b7b3b9d788d934e.png" alt="image"><br>  <i>diff√©rents types de marqueurs</i> <br><br>  En fait, en plus de d√©terminer la position d'un marqueur, il est souvent n√©cessaire de d√©terminer son caract√®re unique, par exemple, afin de d√©tecter plusieurs objets √† la fois.  Pour ce faire, vous pouvez changer la couleur ou la forme, mais nous serons rapidement confront√©s √† une diminution de la fiabilit√© de la d√©tection. <br>  Ce probl√®me est assez courant et il existe de nombreuses normes de marqueurs.  Le plus c√©l√®bre d'entre eux est le code qr, mais il est rarement utilis√© pour des probl√®mes de localisation en raison de la redondance et du besoin de haute r√©solution.  En r√®gle g√©n√©rale, tous les marqueurs sont bicolores (le plus souvent en noir et blanc), de forme simple (le plus souvent un carr√©) et codent en quelque sorte l'identifiant en eux-m√™mes.  Les marqueurs de localisation les plus connus sont Aruco, April Tag, ARToolKit. <br><br>  Quiconque souhaite en savoir plus sur eux est un <a href="https://www.researchgate.net/publication/303752217_An_evaluation_of_artificial_fiducial_markers_in_underwater_environments">article</a> int√©ressant qui compare √©galement la fiabilit√© de leur d√©tection. <br><br><div class="spoiler">  <b class="spoiler_title">Marqueurs fractaux</b> <div class="spoiler_text">  Il y a des moments o√π nous devons d√©tecter un objet √† la fois de loin et √† bout portant.  L'utilisation de plusieurs marqueurs de diff√©rentes tailles est un moyen, mais vous pouvez le faire de mani√®re plus astucieuse et utiliser des marqueurs ¬´fractals¬ª, dont diff√©rentes parties fonctionnent √† diff√©rentes √©chelles de l'image. <br><br>  <a href="https://docs.google.com/document/u/1/d/1SdsOTjGdu5o8gy2Ot2FDqYDS9ALgyhOBJcJHOZBR7B4/mobilebasic">docs.google.com/document/u/1/d/1SdsOTjGdu5o8gy2Ot2FDqYDS9ALgyhOBJcJHOZBR7B4/mobilebasic</a> <br></div></div><br>  Dans notre cas, l'utilisation de marqueurs pr√©sente de nombreux aspects positifs: <br><br><ul><li>  avec la possibilit√© d'installer une cam√©ra statique avec un bon angle de vue et un bon marquage, cela ne n√©cessite pas d'√©quipement difficile √† trouver et n'est potentiellement pas tr√®s difficile √† mettre en ≈ìuvre; </li><li>  la cam√©ra distante peut √©valuer la position de tous les objets sur lesquels nous pouvons placer des marqueurs; </li><li>  les calculs ne sont pas effectu√©s sur l'appareil embarqu√© du robot, mais sont effectu√©s sur un ordinateur s√©par√© (mais il y a un probl√®me de fiabilit√© et des retards dans le transfert des donn√©es); </li><li>  la capacit√© de r√©soudre tout autre probl√®me associ√© √† la vision. </li></ul><br>  Apr√®s avoir analys√© les syst√®mes ci-dessus, nous avons opt√© pour la d√©tection de marqueurs.  Cela nous a permis non seulement de lib√©rer nos odro√Ødes sur des robots, mais aussi de leur permettre de voir toute la situation sur le terrain √† vol d'oiseau. <br><br><h3>  Comment √ßa marche hors de la bo√Æte </h3><br>  La ¬´fiabilit√©¬ª de la d√©tection des marqueurs est un terme relatif.  Diff√©rentes t√¢ches n√©cessitent diff√©rents niveaux de pr√©cision et de stabilit√©.  L'inclusion de ces param√®tres d√©pend du capteur vid√©o, des objectifs, des conditions d'√©clairage, etc. <br><br><img src="https://habrastorage.org/webt/yi/xs/5m/yixs5m5g6pv5xya8axbd-zqov-4.png"><br>  Dans notre cas, avec une taille de champ de 2x3 m√®tres et une cam√©ra juste un m√®tre au-dessus, il est n√©cessaire d'utiliser une optique ultra grand angle avec un champ de vision d'au moins 120-140 degr√©s pour assurer la visibilit√© de l'ensemble de l'espace de jeu, ce qui affecte n√©gativement la d√©tection (et sa pr√©cision) de petits marqueurs √† l'extr√™me coin du terrain de jeu, et dans des conditions d'√©clairage arbitraires rendent cette t√¢che encore plus difficile. <br>  Comme la pratique l'a montr√©, m√™me dans des conditions d'√©clairage normales, compl√®tement naturelles, des d√©finitions erron√©es de la position du marqueur peuvent se produire. <br><br><img src="https://habrastorage.org/webt/km/-n/cl/km-nclpq-m4g3jcgvwxls4eixb0.png"><br><br>  Ainsi, les images suivantes montrent deux images cons√©cutives avec des r√©sultats de d√©tection de marqueur: la direction de l'axe Z (bleu) est modifi√©e de 180 degr√©s. <br><br><img src="https://habrastorage.org/webt/sd/a5/ha/sda5haouwemxqiobswwckpb8dhw.png"><br><br><img src="https://habrastorage.org/webt/tu/gj/ii/tugjiiiol9ts2m4laiexh7nwnue.png"><br>  <i><a href="https://www.youtube.com/watch%3Fv%3DxzG2jQfxLlY">www.youtube.com/watch?v=xzG2jQfxLlY</a></i> <br><br><h3>  Passer √† un √©tat concurrentiel </h3><br><h4>  Changer l'algorithme </h4><br>  Afin de d√©terminer avec pr√©cision l'emplacement du robot sur le terrain, vous devez conna√Ætre la position angulaire de la cam√©ra, la transformation g√©n√©rale du syst√®me de coordonn√©es et la position de la cam√©ra par rapport √† la position du champ.  Pour effectuer cette conversion, nous avons d√©velopp√© notre propre algorithme.  √âtant donn√© qu'une personne suspend le centre de contr√¥le central manuellement, et que les champs sont l√©g√®rement diff√©rents les uns des autres, il n'est pas possible d'obtenir toujours la m√™me position de cam√©ra.  Le d√©placement angulaire de la cam√©ra par rapport au champ a un effet tr√®s n√©gatif sur la d√©tection de la position des robots.  La solution fondamentale consiste √† d√©terminer plusieurs marqueurs statiques que nous pouvons d√©finir avant la correspondance pour l'√©talonnage. <br><br>  La biblioth√®que Aruco en opencv permet de d√©terminer la position du marqueur 6dof par rapport √† la cam√©ra.  Au d√©but, nous avons essay√© de l'utiliser, mais il s'est av√©r√© tr√®s instable et inexact.  Dans notre cas, lorsque la position de la cam√©ra est connue, elle est fixe et les robots (et les marqueurs associ√©s) se d√©placent sur un plan qui ne passe pas par le point d'attache de la cam√©ra, il est rationnel de se limiter √† la t√¢che de d√©tecter la position 3dof (z-const, x-y, + rotation autour un axe z) √† travers la triangulation d'un point sur un plan √† un angle visible. <br><br>  On s'attend √† ce qu'une diminution de dimension et une augmentation de la base de triangulation (la taille du marqueur par rapport √† la distance du plan des marqueurs √† la cam√©ra) du probl√®me √† r√©soudre r√©duisent le niveau d'incertitude et de bruit des r√©sultats de d√©tection. <br>  Pour ce faire, au lieu de la fonction standard <br><br><pre><code class="cpp hljs">cv::aruco::estimatePoseSingleMarkers(markerCorners, <span class="hljs-number"><span class="hljs-number">0.05</span></span>, cameraMatrix, distCoeffs, rvecs, tvecs);</code> </pre> <br><br>  qui, sur la base des coins trouv√©s des marqueurs, d√©termine la position 6dof du marqueur, nous avons √©crit notre estimateur de position, en travaillant selon les principes suivants: <br><br><ul><li>  La position de la cam√©ra 3D est connue √† l'avance; </li><li>  la hauteur du marqueur est connue √† l'avance; </li><li>  √† la suite de la d√©tection, des pixels (v, u) de 4 coins de marqueur sont connus; </li><li>  √† la suite de l'√©talonnage de la cam√©ra, une matrice de cam√©ra 4x4 est d√©finie; </li><li>  connaissant la `` matrice de la cam√©ra '', la position et l'orientation de la cam√©ra, la position des angles de pixels du marqueur, vous pouvez obtenir la projection de la position des angles dans l'espace 3D sur le plan z sur lequel se trouvent les sommets du marqueur (la hauteur du marqueur est d√©termin√©e par son nombre); </li><li>  en effectuant l'√©tape pr√©c√©dente pour les 4 coins de marqueur et en faisant la moyenne des donn√©es obtenues, il est possible d'obtenir les coordonn√©es 3D des sommets de marqueur dans le syst√®me de coordonn√©es de la cam√©ra; </li><li>  en appliquant la transformation de la cam√©ra SK au SK du terrain de jeu, les coordonn√©es du marqueur dans le champ SK sont obtenues. </li></ul><br><h4>  R√©solution des probl√®mes d'√©clairage et de performances </h4><br>  La stabilit√© et la vitesse de d√©tection des marqueurs d√©pendent fortement des conditions d'√©clairage ambiant et de la structure de l'arri√®re-plan, plus il y a d'objets diff√©rents dans le cadre, plus le traitement est long.  √âtant donn√© que les r√®gles d'√©clairage et d'arri√®re-plan d'Eurobot ne sont en aucun cas r√©glement√©es, elles peuvent changer consid√©rablement de temps en temps, il peut y avoir d'autres domaines, des personnes en arri√®re-plan.  En particulier, des expositions suppl√©mentaires de robots ennemis, de flashs de cam√©ra ou de projecteurs tombant dans le champ de vision de la cam√©ra peuvent √™tre attendues. <br><br>  Pour r√©duire l'influence de l'√©clairage environnemental sur la stabilit√© de d√©tection des marqueurs, une ¬´conception¬ª sp√©ciale a √©t√© d√©velopp√©e dans laquelle des marqueurs aruco invers√©s ont √©t√© utilis√©s.  La partie sombre est remplac√©e par un film r√©tror√©fl√©chissant et un r√©tro√©clairage LED actif est install√© directement sur la cam√©ra.  Le traitement d'image est effectu√© en n√©gatif, tandis que le contraste de l'arri√®re-plan est beaucoup plus faible que le contraste de leurs propres marqueurs. <br><br>  L'augmentation du contraste du marqueur vous permet de s√©lectionner efficacement les r√©gions d'int√©r√™t sur le cadre et de rechercher des marqueurs uniquement √† l'int√©rieur, et non sur l'ensemble du cadre, ce qui am√©liore consid√©rablement la productivit√©. <br><br><img src="https://habrastorage.org/webt/fz/p0/4n/fzp04n01ugkpz4b8yuqrasmv2qy.png"><br>  <i>Comparaison des diff√©rences de contraste entre un marqueur standard et un marqueur √† surface r√©fl√©chissante</i> <br><br><h3>  Nous s√©lectionnons le fer </h3><br>  Les conditions d'√©clairage n'√©tant pas d√©finies et la vitesse des robots pouvant √™tre assez importante, nous recherchions depuis le d√©but une cam√©ra avec un obturateur global, et non pas avec un obturateur roulant.  La diff√©rence est que le global collecte des informations sur la luminosit√© des pixels en m√™me temps, et en roulant ligne par ligne, √† cause de laquelle il peut y avoir des distorsions dans la forme g√©om√©trique des objets en mouvement. <br>  L'appareil photo le plus abordable est oCam-1mgn, que nous avons utilis√© pendant 2 ans.  Cependant, il est en noir et blanc et a une r√©solution de seulement 1Mpx, qui est situ√© au bord inf√©rieur d'une r√©solution acceptable (le nombre de pixels dans l'image, pour 1 "pixel" du marqueur). <br>  Initialement, le d√©tecteur √©tait consid√©r√© sur la m√™me carte unique que les robots eux-m√™mes - odroid xu4, et la vitesse de travail √©tait d'environ 20 images par seconde, cependant, le d√©sir d'accrocher des fonctionnalit√©s suppl√©mentaires au centre de contr√¥le central et la compr√©hension qu'un meilleur appareil photo √©tait n√©cessaire ont conduit √† remplacer le PC par un Intel plus vigoureux. Nuc, et la cam√©ra ... la cam√©ra que nous prenons toujours pour la nouvelle saison. <br><br><h3>  Nous commen√ßons le projet </h3><br>  Il est en outre suppos√© que vous avez d√©j√† configur√© ROS Kinetic ou Melodic. <br><br>  La premi√®re chose √† faire est de t√©l√©charger et d'installer OpenCV 3, Eigen3 et le projet <a href="https://bitbucket.org/eurobot1718/ocam_usb_cam">https://bitbucket.org/eurobot1718/ocam_usb_cam</a> (pour la cam√©ra Ocam), ou d'utiliser un autre projet dont la structure est similaire √† la publication de donn√©es dans les rubriques. <br><br>  Nous clonons le r√©f√©rentiel avec le projet de d√©tecteur arude: <a href="https://gitlab.com/eurobot2019/aruco_detector">https://gitlab.com/eurobot2019/aruco_detector</a> et gui pour celui-ci <a href="https://github.com/alexpostnikov/aruco-gui">https://github.com/alexpostnikov/aruco-gui</a> <br>  Apr√®s avoir install√© les projets, vous devez calibrer la cam√©ra et obtenir la matrice de dispersion et la matrice de distorsion de la cam√©ra, puis envelopper le tout dans le fichier yaml "camera_params.yml".  Un exemple simple est l'utilisation d'un √©chiquier.  <a href="https://github.com/sourishg/fisheye-stereo-calibration">Lien</a> vers l'impl√©mentation en C ++, o√π il vous suffit de collecter et de sp√©cifier les param√®tres de la carte et de la cam√©ra, ainsi que le nom du fichier de sortie. <br><br>  Les param√®tres principaux se trouvent dans le fichier aruco_detector_params.yml: <br><br><ul><li>  <b>len_of_cube_markers</b> et <b>width_marker la</b> longueur et la largeur des marqueurs en m√®tres; </li><li>  <b>markers_height</b> - comparaison du marqueur et de sa hauteur; </li><li>  <b>marqueurs</b> - un tableau qui d√©crit si un marqueur particulier appartient √† un robot sp√©cifique.  Il indique les marqueurs dans le sens horaire.  Et dans le cas des adversaires, puisque leur direction n'est pas importante pour nous, l'ordre des marqueurs en config n'est pas important non plus.  Il vous suffit de sp√©cifier le code marqueur.  Nous avons √©galement des marqueurs sur la couverture sup√©rieure, leurs num√©ros sont mis en √©vidence s√©par√©ment; </li><li>  <b>static_markers_ids</b> - marqueurs qui sont recherch√©s pendant le processus d'√©talonnage; </li><li>  <b>markers_position</b> - un dictionnaire avec le d√©calage et la rotation de chaque marqueur par rapport au centre du robot; </li><li>  <b>luminosit√©_seuil</b> ne peut pas √™tre touch√© - ceci est utilis√© dans l'√©talonnage automatique initial de la lumi√®re; </li><li>  <b>camera_position_yellow</b> et un param√®tre similaire servent de param√®tres par d√©faut en cas d'√©chec de l'√©talonnage. </li></ul><br>  La matrice de transformation du syst√®me de coordonn√©es de la cam√©ra vers le syst√®me de coordonn√©es du champ se trouve dans le fichier transform_from_cam_to_map.xml <br><br>  Apr√®s tous les param√®tres, vous devez enfin l'ex√©cuter.  Les chemins d'acc√®s au fichier avec les param√®tres, le c√¥t√© par d√©faut et le chemin d'acc√®s au p√©riph√©rique vid√©o sont d√©finis dans aruco_detector_debug.launch, que nous lancerons.  Mais pour un lancement complet, il est pr√©f√©rable d'utiliser le script bash aruco.bash, qui, en plus du d√©tecteur, lance gui (127.0.0.1‚ñ∫000).  Ici, nous pouvons choisir le c√¥t√©, d√©marrer l'√©talonnage et contr√¥ler le syst√®me.  Dans la deuxi√®me fen√™tre, les zones d'int√©r√™t et les marqueurs trouv√©s sont visibles. <br><br><img src="https://habrastorage.org/webt/qe/ch/qf/qechqfeowcgq9xevhj8fplpmjqc.gif"><br><br>  Maintenant dans les rubriques: "/emy_robot1 / aruco", "/emy_robot2 / aruco", "/ big_robot / aruco", "/ small_robot / aruco" la position des robots trouv√©s sera publi√©e. <br><br>  Hourra!  Nous avons pu obtenir les coordonn√©es des robots.  C'est juste, comme vous pouvez le voir, ils ont tort.  En effet, avant utilisation, il est n√©cessaire de calibrer la position de la cam√©ra par rapport au champ.  Pour cela, il est n√©cessaire <br><br><ul><li>  placez les cubes dans les coins du champ, alors qu'il est important qu'ils soient tourn√©s par les c√¥t√©s sp√©cifi√©s dans la config </li><li>  ajustez l'inclinaison de la cam√©ra pour que tout l'espace requis tombe dans le cadre </li><li>  r√©gler la luminosit√© du r√©tro√©clairage jusqu'√† une d√©tection fiable du marqueur </li><li>  dans gui, s√©lectionnez le c√¥t√© souhait√© et cliquez sur "calibrer" </li><li>  alors l'√©tat de "recherche de cubes statiques" devrait changer en "recherche de cubes" </li></ul><br><h2>  Nous fabriquons des marqueurs et TsUS </h2><br>  Selon les r√®gles, nous pouvons colorer nos robots comme nous le voulons et, en outre, utiliser une place sp√©ciale sur nos robots et ceux d'autres personnes, sur laquelle vous pouvez mettre quelque chose jusqu'√† 10x10x8cm.  Un endroit sp√©cial est situ√© sur le couvercle du robot, a une hauteur fixe et une meilleure visibilit√© pour le centre de contr√¥le central, sauf lorsque le robot est sous la cam√©ra. <br><br><img src="https://habrastorage.org/webt/mm/_a/zu/mm_azulfvnfcqxm869zluovaq9e.png"><br>  <i>hauteur et dimensions des phares du robot</i> <br><br>  Par cons√©quent, en tant que principaux marqueurs de nos robots, nous utilisons des parall√©l√©pip√®des de 10x10x108 cm coll√©s sur 4 c√¥t√©s d'aruco, ainsi que des marqueurs suppl√©mentaires sur le c√¥t√© sup√©rieur de nos robots pour la localisation dans une zone complexe sous la cam√©ra. <br><br>  Comme nous ne pouvons rien coller au couvercle de l'ennemi, nous avons d√©cid√© de cr√©er des marqueurs sous la forme d'une pyramide tronqu√©e pour √©largir la plage de visibilit√©.  Et comme vous pouvez le voir - le marqueur est devenu bien mieux visible. <br><br><img src="https://habrastorage.org/webt/9_/xo/re/9_xoreh7phv_pp5ci_u7utyw5cm.png"><br><br>  Nous imprimons la base du cube \ pyramide sur une imprimante 3D afin qu'il soit suffisamment solide et dispose d'un support pratique et fiable. <br><br><img src="https://habrastorage.org/webt/r9/-l/ek/r9-lekwcd5xkzs_lys0hkrkjw4m.png"><br><br>  Les mod√®les pour imprimer un cube, une pyramide et une monture correspondante se trouvent <a href="https://yadi.sk/d/swUJUwxTnTVYFw">ici.</a> <br><br>  Ce cube est coll√© avec un r√©flecteur (nous utilisons AVERY blanc <br>  DENNISON V6700B de 50 mm de large, bien qu'il soit plus cher, il fonctionne beaucoup mieux que les chinois bon march√©), et les marqueurs eux-m√™mes sont coll√©s dessus.  La fa√ßon la plus simple de le faire est de couper les marqueurs sur le traceur, bien que vous puissiez les d√©couper dans du papier ou du film en quelques heures de pacification (un ensemble se compose de 16 marqueurs). <br><br>  <a href="https://yadi.sk/d/0E5ajh4pumiahA">Voici</a> notre kit de l'ann√©e derni√®re. <br><br><img src="https://habrastorage.org/webt/2h/1b/9w/2h1b9wwkizem2k9ptbwmwc64spm.png"><br>  <i>diff√©rentes ¬´g√©n√©rations¬ª de nos marqueurs</i> <br><br>  Ils peuvent √©galement √™tre utilis√©s comme marqueurs statiques pour l'√©talonnage.  Pour ce faire, placez-les dans les coins les plus √©loign√©s du champ et cliquez sur - calibrer. <br><br><h3>  Assemblage d'un dispositif de rep√©rage central </h3><br><h4>  Ce qui est n√©cessaire: </h4><br>  <b>Ordinateur monocarte.</b>  Ces dessins sont faits pour l'emplacement d'Intel NUC, mais vous pourriez penser √† placer dans le bo√Ætier, par exemple, odroid xu4 ou raspberry pi4. <br><br>  <b>oCam</b> .  En fait la cam√©ra, pour laquelle tout se passe.  Nous avons chang√© l'objectif standard √† <a href="https://air-hobby.ru/katalog/product/2262-linza-runcam-rc25g-fpv-lens-25mm-fov140-wide-angle.html">2,5 mm</a> pour un angle de vision large <br>  <b>√âcran (LCD HDMI 7 pouces √† partage d'onde (B))</b> . Avec son aide, l'√©talonnage et un certain nombre d'autres op√©rations sont effectu√©s. <br><br>  <b>Bande LED.</b>  Utilis√© pour √©clairer la surface r√©fl√©chissante des marqueurs.  Il vaut mieux utiliser le plus brillant disponible. <br><br>  <b>Batterie 16.8v LiPo.</b>  Nous utilisons 4s5200mAh.  Ce sont les m√™mes batteries que sur le robot, car elles sont pratiques et durent longtemps. <br><br>  <b>Convertisseur DC-DC abaisseur.</b>  Pour alimenter la bande LED.  Nuc et le routeur sont aliment√©s directement par la batterie, car tous les faisceaux d'alimentation sont d√©j√† sur eux. <br><br>  Pi√®ces imprim√©es.  Ceci, en particulier, un support de cam√©ra, un √©cran et des coins pour assembler le bo√Ætier: <a href="https://yadi.sk/d/swUJUwxTnTVYFw">https://yadi.sk/d/swUJUwxTnTVYFw</a> <br><br>  <b>D√©tails du logement.</b>  Dans notre cas, c'√©tait une feuille de carbone de 2 mm.  Mais ce n'est pas la meilleure option, car conductrice de carbone, difficile √† traiter et pas aussi l√©g√®re que, par exemple, le plexiglas - peut-√™tre l'option la plus simple.  Bien que beaucoup plus difficile.  Trouvez le lien ci-dessus. <br><br>  <b>Routeur (Zyxel keenetic extra).</b>  Nous avons d√ª le retirer de l'√©tui afin de l'adapter √† la taille et au poids.  Mais dans le cas g√©n√©ral, nous ne le recommandons pas fortement. <br>  Beaucoup de petites choses.  Vis M3 * 8 ~ 40pcs, racks pour circuits imprim√©s 3x10 ~ 12pcs, fils, tournevis, wago, etc. <br><br><h4>  Assemblage </h4><br>  Vous devez d'abord pr√©parer les coins imprim√©s en appuyant sur les √©crous.  Il se peut qu'il y ait quelques ajustements serr√©s et qu'ils devront √™tre l√©g√®rement coll√©s ou utiliser <a href="http://www.dart.moscow/index.php%3Fproductcode%3D160923">des √©crous fondus</a> <br>  Ensuite, vous devez installer cette pi√®ce dans la base.  Il fournit un positionnement clair du centre de contr√¥le central √† sa place. <br><br><img src="https://habrastorage.org/webt/cv/0u/vr/cv0uvrzekp09qx2typzni7gzmm4.png"><br><br>  Maintenant, nous assemblons le support de la cam√©ra, y ins√©rons oCam, collons le r√©tro-√©clairage de la bande LED aussi pr√®s que possible de l'objectif et fixons le module √† la base. <br><br><img src="https://habrastorage.org/webt/x8/c5/sz/x8c5szf7llbkchzglqbbrz22yas.png"><br><br><img src="https://habrastorage.org/webt/k1/oj/w5/k1ojw5cbuwtnireb0axfynlffrk.png"><br><br>  Apr√®s cela, vous pouvez installer toutes les parois lat√©rales, en les fixant aux coins d√©crits pr√©c√©demment.  Les trous pour eux sont mieux √† contrer √† l'avance. <br><br><img src="https://habrastorage.org/webt/ne/mo/v0/nemov0qtrzitlompmpymxhm9npw.png"><br><br>  Nous avons mis un ordinateur monocarte et un routeur.  Dans notre cas, il s'agit de NUC et Zyxel keenetic extra. <br><br><img src="https://habrastorage.org/webt/7l/vc/85/7lvc85rwy0gzifdg9w7a9-n0k8a.png"><br><br><img src="https://habrastorage.org/webt/er/t9/8t/ert98t1wicsogrkpabregc60o2e.png"><br><br><img src="https://habrastorage.org/webt/7y/hk/rc/7yhkrcmukr6oyrgqqyeoiwwz_io.png"><br>  <i>Et nous obtenons le syst√®me de suivi assembl√©.</i>  <i>Il ne reste plus qu'√† r√©gler l'inclinaison de la cam√©ra.</i> <br><br><img src="https://habrastorage.org/webt/zm/lp/zr/zmlpzrgcfrd68o_xnoaw69sdgeg.png"><br>  <i>d√©bogage de localisation en 2018</i> <br><br><h3>  Quel est le r√©sultat </h3><br>  Nous avons donc racont√© tous les secrets qui nous permettent de r√©p√©ter notre syst√®me de nos propres mains.  En l'utilisant, vous pouvez rapidement et sans aucune modification rendre votre syst√®me de localisation du robot sur le champ Eurobot.  Et avec un minimum de modifications, cr√©ez un syst√®me de suivi assez universel et fiable pour quelque chose.  Cependant, il convient de noter que lors de l'utilisation d'aruco 8x8, d'une taille de marqueur de 10x8cm et d'une cam√©ra en 1Mpx, il n'est pas particuli√®rement possible d'augmenter le rayon de d√©tection, cependant, si nous avons des limitations strictes sur la taille et les performances, alors en g√©n√©ral, nous utilisons simplement un √©quipement plus int√©ressant. <br><br>  Cette ann√©e, le r√®glement a fait mention de l'utilisation d'aruco 4x4, ainsi que de leurs port√©es non entrecrois√©es pour chaque c√¥t√© du terrain.  Dans un avenir proche, nous pr√©voyons d'int√©grer cela dans notre solution afin qu'√† l'avenir nous n'ayons pas peur de l'intersection des num√©ros de marqueur.  Un autre incontournable, mais ce qui n'a pas encore √©t√© fait, c'est l'√©talonnage manuel sur le terrain. <br>  Dans le prochain article, nous parlerons du niveau inf√©rieur des robots, de la fa√ßon dont la cin√©matique des robots est consid√©r√©e, de la fa√ßon dont nous contr√¥lons les serveurs, les moteurs et les c√¥nes lorsque nous travaillons avec freertos. <br><br>  Je veux dire merci: <br><br>  <a href="https://github.com/alexpostnikov/aruco-gui">Alexey Postnikov</a> (au nom de qui cela valait probablement la peine de tout publier) - pour, en g√©n√©ral, tout le code de cet article et une assistance directe pour la r√©daction de l'article. <br>  <a href="https://habr.com/ru/users/eppy/">Egor Alexandrov</a> - pour tous les dessins et mod√®les, aide √† la r√©daction de l'article et 34 virgules. <br>  <a href="https://habr.com/ru/users/toma_sin/">Tamara Sinelnikova</a> - pour avoir aid√© √† la r√©daction de l'article. <br><br>  Et le reste de l'√©quipe! <br><br>  Il reste moins de 4 mois avant le d√©but de la comp√©tition, mais l'√©quipe Sberbank Eurobot reste ouverte aux nouveaux participants.  Notre t√©l√©gramme: <a href="https://t.me/SetUpSber">https://t.me/SetUpSber</a> <br><br>  Articles pr√©c√©dents: <br><br>  <a href="https://habr.com/ru/post/478836/">Ce qui est commun entre un revolver, des rondelles et un robot autonome</a> <br>  <a href="https://habr.com/ru/post/479636/">Propre pile de navigation.</a>  <a href="https://habr.com/ru/post/479636/">Mieux que ROS?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482220/">https://habr.com/ru/post/fr482220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482206/index.html">Comment rendre la production 3D de pi√®ces d'avion plus √©conomique</a></li>
<li><a href="../fr482208/index.html">Cadeaux qui vous font manquer le Nouvel An</a></li>
<li><a href="../fr482210/index.html">Bot pour Tetris et animation d'ing√©nierie inverse. Analyse de la piste mobile du deuxi√®me championnat de programmation</a></li>
<li><a href="../fr482212/index.html">Tu parles de ... fromage?</a></li>
<li><a href="../fr482216/index.html">23 r√©ponses √† la d√©pression d'un psychiatre professionnel Maxim Malyavin (dpmmax)</a></li>
<li><a href="../fr482222/index.html">Application Web sur Kotlin + Spring Boot + Vue.js (module compl√©mentaire)</a></li>
<li><a href="../fr482224/index.html">Quand un designer doit √™tre un petit programmeur</a></li>
<li><a href="../fr482228/index.html">Nous √©crivons une ¬´calculatrice¬ª en C #. Partie I. Calcul de la valeur, d√©riv√©, simplification et autres oies</a></li>
<li><a href="../fr482230/index.html">La bataille des serveurs WEB. Partie 2 - Sc√©nario HTTPS r√©aliste:</a></li>
<li><a href="../fr482232/index.html">StackOverflow est plus qu'un simple r√©f√©rentiel de r√©ponses √† des questions stupides</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>