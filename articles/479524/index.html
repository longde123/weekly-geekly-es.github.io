<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üó£Ô∏è ‚öΩÔ∏è üé• Servicio de restauraci√≥n activa o la historia de un proyecto industrial en Innopolis ü§üüèº üßñüèª ü§≥üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! Mi nombre es Roman, y quiero hablar hoy sobre c√≥mo nosotros, en la Universidad de Innopolis, desarrollamos un banco de pruebas y un servici...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servicio de restauraci√≥n activa o la historia de un proyecto industrial en Innopolis</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acronis/blog/479524/">  Hola Habr!  Mi nombre es Roman, y quiero hablar hoy sobre c√≥mo nosotros, en la Universidad de Innopolis, desarrollamos un banco de pruebas y un servicio para el sistema Acronis Active Restore, que pronto deber√≠a formar parte de la l√≠nea de productos de la compa√±√≠a.  Todos los que est√©n interesados ‚Äã‚Äãen c√≥mo la universidad est√° construyendo relaciones con socios industriales, los invito a continuar con Cat. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b9e/2e6/1c8/b9e2e61c86c5b53a43ed3ee998d7db0f.jpg" alt="imagen"><br><a name="habracut"></a><br>  El desarrollo de Active Restore comenz√≥ dentro de Acronis, pero nosotros, como estudiantes de la Universidad de Innopolis, participamos en este proceso como parte de un proyecto de capacitaci√≥n industrial.  Mi curador (y ahora colega) Daulet Tumbaev ya escribi√≥ sobre la idea, as√≠ como la arquitectura, <a href="https://habr.com/ru/company/acronis/blog/477658/">en su publicaci√≥n</a> .  Hoy hablar√© sobre c√≥mo preparamos el servicio desde Innopolis. <br><br>  Todo comenz√≥ en el verano, cuando se nos inform√≥ que en el primer semestre, las empresas de TI vendr√≠an a nosotros y nos ofrecer√≠an sus ideas para el trabajo pr√°ctico.  Y as√≠, en diciembre de 2018, se nos presentaron 15 proyectos diferentes, y al final del mes establecimos prioridades, descubrimos a qui√©n le gusta m√°s. <br><br>  Todos los estudiantes de pregrado completaron un formulario en el que era necesario elegir cuatro proyectos en los que quer√≠amos participar.  Era necesario motivar por qu√© yo, y por qu√© precisamente estos proyectos.  Por ejemplo, se√±al√© que ya tengo experiencia en programaci√≥n y desarrollo de sistemas en C / C ++.  Pero lo m√°s importante, el proyecto me permiti√≥ desarrollar mis habilidades y seguir creciendo. <br><br>  Dos semanas despu√©s, nos asignaron, y desde el comienzo del segundo semestre, comenz√≥ el trabajo en los proyectos.  El equipo se form√≥, en la primera reuni√≥n evaluamos las fortalezas y debilidades de cada uno y los roles asignados. <br><br><ul><li>  Roman Rybkin es un desarrollador de Python / C ++. </li><li>  Eugene Ishutin - Desarrollador de Python / C ++, responsable de interactuar con la empresa. </li><li>  Anastasia Rodionova es una desarrolladora de Python / C ++ responsable de escribir documentaci√≥n. </li><li>  Brandon Acosta: configuraci√≥n del entorno, preparaci√≥n del stand para experimentos y pruebas. </li></ul><br>  Las primeras dos semanas tuvimos que comenzar el proceso.  Establecimos contactos con el cliente, formalizamos los requisitos para el proyecto, lanzamos un proceso iterativo y configuramos el entorno para el trabajo. <br><br>  Por cierto, nuestro trabajo con el cliente realmente comenz√≥ a hervir cuando comenzamos las asignaturas optativas.  El hecho es que Acronis lidera en la Universidad de Innopolis (y no solo) temas de elecci√≥n.  Y Alexey Kostyushko, desarrollador l√≠der del equipo Kernel, imparte dos cursos de manera continua: Ingenier√≠a inversa y Arquitectura y controladores de kernel de Windows.  Hasta donde yo s√©, un curso sobre programaci√≥n de sistemas y computaci√≥n multiproceso tambi√©n est√° planeado en el futuro.  Pero lo principal es que todos estos cursos est√°n dise√±ados para ayudar a los estudiantes a hacer frente a proyectos industriales.  Impulsan seriamente la comprensi√≥n del √°rea tem√°tica y por lo tanto simplifican el trabajo en el proyecto. <br><br>  Debido a esto, comenzamos m√°s vigorosamente que otros equipos, y la interacci√≥n con Acronis se volvi√≥ m√°s densa.  Alexey Kostyushko actu√≥ para nosotros en el papel de propietario del producto, de √©l recibimos los conocimientos necesarios en el √°rea tem√°tica.  Gracias a sus cursos electivos, nuestras habilidades y competencias duras se impulsaron con mucha fuerza, nos preparamos realmente para cumplir con la tarea que nos enfrentaba. <br><br><h2>  Del pensamiento al proyecto </h2><br>  El primer mes para todos los equipos fue lo m√°s dif√≠cil posible.  Todos estaban perdidos, no sab√≠an por d√≥nde empezar, tal vez con documentos o, por el contrario, sumergi√©ndose en el c√≥digo.  Al principio, comentarios contradictorios vinieron de curadores y mentores de la universidad y representantes de la compa√±√≠a. <br><br>  Cuando todo encaj√≥ (al menos en mi cabeza), qued√≥ claro que los mentores de la universidad nos ayudaron a construir relaciones internas en el equipo y preparar documentos.  Pero el verdadero avance fue la llegada de Daulet en marzo.  Nos sentamos y trabajamos en el proyecto todo el fin de semana.  Luego repensamos la esencia del proyecto, reiniciamos, redistribuimos las prioridades de las tareas y volamos r√°pidamente.  Entendimos lo que se debe hacer para comenzar el experimento (un poco m√°s adelante) y desarrollar el servicio.  A partir de ese momento, la idea general se convirti√≥ en un plan claro.  Comenz√≥ el desarrollo real del c√≥digo, y en 2 semanas desarrollamos la primera versi√≥n del banco de pruebas, incluidas las m√°quinas virtuales, los servicios necesarios y el c√≥digo para automatizar el experimento y recopilar datos. <br><br>  Vale la pena se√±alar que, paralelamente al proyecto industrial, hubo cursos de capacitaci√≥n que nos ayudaron a construir una arquitectura competente para nuestros proyectos y organizar la Gesti√≥n de Calidad.  Al principio, estas tareas llevaban entre el 70 y el 90% del tiempo por semana, pero result√≥ que era necesario tiempo para evitar problemas en el proceso de desarrollo.  El objetivo de la universidad era que aprendi√©ramos a construir de manera competente el proceso de desarrollo, y las empresas, como clientes, estaban m√°s interesadas en el resultado.  Esto, por supuesto, trajo mucha confusi√≥n, pero ayud√≥ a combinar habilidades te√≥ricas y pr√°cticas.  Suficiente complejidad y carga aseguraron la presencia de motivaci√≥n, lo que result√≥ en un proyecto exitoso. <br><br>  Inicialmente, dos personas de nuestro equipo se dedicaron al desarrollo puro, una persona se hizo cargo de los documentos y otra se sum√≥ a la creaci√≥n del entorno.  Sin embargo, m√°s tarde se nos unieron tres solteros m√°s, con quienes nos convertimos en un solo equipo.  La universidad decidi√≥ lanzar un proyecto industrial de prueba para estudiantes del tercer a√±o de estudio.  Ampliar el equipo de 4 a 7 personas aceler√≥ enormemente el proceso, porque nuestros solteros pod√≠an realizar f√°cilmente tareas relacionadas con el desarrollo.  Ekaterina Levchenko ayud√≥ a escribir c√≥digo python y scripts por lotes para el banco de pruebas.  Ansat Abirov y Ruslan Kim actuaron como desarrolladores, se dedicaron a la selecci√≥n y optimizaci√≥n de algoritmos. <br><br>  Trabajamos en este formato hasta finales de mayo, cuando se lanz√≥ el experimento.  En este momento, el proyecto industrial para solteros termin√≥.  Dos de ellos comenzaron una pasant√≠a en Acronis y continuaron trabajando con nosotros.  Por lo tanto, despu√©s de mayo, ya trabajamos como un equipo de 6 personas. <br><br>  Antes de nosotros estaba el tercer semestre, que en Innopolis est√° libre de actividades acad√©micas.  Ten√≠amos solo 2 asignaturas optativas, y el resto del tiempo lo dedicamos a un proyecto industrial.  Fue en el tercer semestre que el trabajo en el servicio fue intensivo.  El proceso de desarrollo cay√≥ completamente en los rieles, demostraciones e informes se hicieron regulares.  En este formato, trabajamos durante 1,5 meses y, a fines de julio, casi terminamos la parte de desarrollo del trabajo. <br><br><h2>  Detalles t√©cnicos </h2><br>  Primero, se formularon los requisitos para un servicio, que deber√≠a interactuar adecuadamente con el controlador del minifiltro del sistema de archivos (que es lo que puede leer <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ifs/file-system-minifilter-drivers">aqu√≠</a> ) y se pens√≥ su arquitectura.  Con la vista puesta en la simplicidad del soporte de c√≥digo adicional, de inmediato proporcionamos un enfoque modular.  Nuestro servicio incluye varios gerentes, agentes y manejadores, e incluso antes del inicio de la codificaci√≥n, se estableci√≥ la capacidad de trabajar en modo paralelo. <br><br>  Sin embargo, despu√©s de discutir la arquitectura en una reuni√≥n con los chicos de Acronis, se decidi√≥ realizar un experimento primero y luego asumir el servicio en s√≠.  Como resultado, el desarrollo tom√≥ solo 2.5 meses.  El resto del tiempo, realizamos un experimento para encontrar la lista m√≠nima suficiente de archivos en los que Windows podr√≠a ejecutarse.  En un sistema real, este conjunto de archivos se genera utilizando el controlador, sin embargo, decidimos encontrar este conjunto de forma heur√≠stica, utilizando el m√©todo de media divisi√≥n, para verificar el funcionamiento del controlador. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a5/fd5/6b1/6a5fd56b1bb52d7b30e356735defba4a.png" alt="imagen"><br>  <i>El soporte del experimento.</i> <i><br></i> <br><br>  Para hacer esto, armamos un stand en Python desde dos m√°quinas virtuales.  Uno de ellos trabaj√≥ en Linux, y el segundo carg√≥ Windows.  Se configuraron dos discos para ellos: Virtual HD1 y Virtual HD2.  Ambas unidades se conectaron a VM1 en el que se instal√≥ Linux.  En esta m√°quina virtual en HD1, se instal√≥ la aplicaci√≥n Killer, que "da√±√≥" HD2.  El da√±o se refiere a la eliminaci√≥n de algunos archivos del disco.  HD2 era un disco de arranque para VM2 que funcionaba en Windows.  Despu√©s del "da√±o" en el disco, intentamos iniciar VM2.  Si fue posible hacer esto, los archivos eliminados del disco se consideraron innecesarios de ejecutar. <br><br>  Para automatizar este proceso, intentamos eliminar archivos no al azar, sino como parte de un enfoque previamente pensado.  El algoritmo consisti√≥ en 3 pasos: <br><br><ol><li>  Divide la lista de archivos a la mitad. </li><li>  Eliminar uno de los medios archivos. </li><li>  Intenta iniciar el sistema.  Si el sistema se inici√≥, agregue los archivos eliminados a la lista de innecesarios.  De lo contrario, volvemos al paso 1. </li></ol><br>  Primero, decidimos simular el algoritmo.  Supongamos que hay 1,000,000 de archivos en el sistema de archivos.  En este caso, la b√∫squeda m√°s efectiva de archivos cr√≠ticos se produjo en los casos en que los archivos cr√≠ticos representaban aproximadamente el 15% del total. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f1/2eb/726/8f12eb72679d42f14095fbd92b81674d.png" alt="imagen"><br>  <i>M√©todo de media divisi√≥n.</i> <br><br>  Al principio, hubo muchos problemas con el experimento.  Durante 2-3 semanas estuvo listo un banco de pruebas.  Y otros 1-1.5 meses tuve que atrapar errores, agregar el c√≥digo y aplicar varios trucos para que el soporte funcione. <br><br>  Lo m√°s dif√≠cil fue detectar un error asociado con las operaciones de almacenamiento en cach√© del disco.  El experimento funcion√≥ durante 2 d√≠as y produjo resultados muy optimistas que fueron varias veces m√°s r√°pidos que las simulaciones.  Sin embargo, la prueba de archivo cr√≠tico fall√≥, el sistema no se inici√≥.  Result√≥ que durante el apagado forzado de la m√°quina virtual, no se realizaron las operaciones de borrado que el sistema de archivos almacen√≥ en cach√© y, en consecuencia, el disco no se borr√≥ por completo.  Como resultado, el algoritmo recibi√≥ resultados incorrectos, y durante un par de d√≠as forzamos todas nuestras circunvoluciones para resolverlo todo. <br><br>  En cierto momento, notamos que durante la operaci√≥n continua el algoritmo estaba enterrado en uno de los segmentos del sistema de archivos y comenzamos a tratar de eliminar los mismos archivos (con la esperanza de un nuevo resultado).  Esto sucedi√≥ en momentos en que el algoritmo descansaba en regiones donde la mayor√≠a era necesaria, mientras se eleg√≠a el intervalo incorrecto para la eliminaci√≥n.  En este punto, decidimos agregar una lista de reorganizaci√≥n de archivos.  Es decir, una vez que algunas iteraciones, la lista de archivos fue barajada.  Esto ayud√≥ a eliminar el algoritmo de tales palos. <br><br>  Cuando todo estuvo listo, lanzamos estas dos m√°quinas virtuales durante 3 d√≠as.  En total, pasaron alrededor de 600 iteraciones, entre las cuales hubo m√°s de 20 lanzamientos exitosos.  Qued√≥ claro que este experimento se puede ejecutar durante mucho tiempo, as√≠ como en m√°quinas m√°s potentes, para encontrar el tama√±o de archivo √≥ptimo para ejecutar Windows.  Adem√°s, el algoritmo se puede distribuir en varias m√°quinas para acelerar a√∫n m√°s este proceso. <br><br>  En nuestro caso, adem√°s de Windows, solo hab√≠a Python y nuestro servicio en el disco.  En tres d√≠as logramos reducir el n√∫mero de archivos de 70 mil a 50 mil.  La lista de archivos se redujo solo en un 28%, pero qued√≥ claro que este enfoque est√° funcionando y le permite determinar el conjunto m√≠nimo de archivos necesarios para cargar el sistema operativo. <br><br><h2>  Estructura de servicio </h2><br>  Veamos una peque√±a estructura de servicio.  El m√≥dulo de servicio principal es un gestor de colas.  Como obtenemos una lista de archivos del controlador, necesitamos restaurar los archivos de esta lista.  Para hacer esto, creamos un giro con prioridades. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/848/c8b/f16/848c8bf16ea00fa05474ead1a278b045.jpg" alt="imagen"><br><br>  Tenemos una lista de archivos que se restauran a su vez.  Y si aparecen nuevas solicitudes de acceso, los archivos que se necesitan con urgencia se restauran con prioridad.  Gracias a esto, al comienzo de la cola habr√° aquellos archivos que el usuario realmente necesita ahora, y al final de la cola habr√° aquellos archivos que puedan ser necesarios en el futuro.  Pero con el trabajo activo del usuario, se puede formar una "cola de objetos extraordinarios", as√≠ como una lista de archivos que se est√°n restaurando en este momento.  Adem√°s, la operaci√≥n de b√∫squeda deber√≠a haberse aplicado a todas estas colas a la vez.  Por desgracia, no encontramos una implementaci√≥n de la cola que pudiera establecer varias prioridades de archivo, al tiempo que admit√≠a la b√∫squeda, as√≠ como cambiar las prioridades sobre la marcha.  No quer√≠amos adaptarnos a las estructuras de datos existentes y, por lo tanto, tuvimos que escribir las nuestras y configurar la capacidad de trabajar con ellas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/30b/f65/b91/30bf65b91099cca8fd21f077d7c670f3.jpg" alt="imagen"><br><br>  Nuestro servicio deber√° comunicarse primero con el controlador en el que Daulet trabaj√≥, y luego con los componentes responsables de restaurar los archivos ... Por lo tanto, para empezar, decidimos crear nuestro propio peque√±o emulador del sistema de recuperaci√≥n, que podr√≠a emitir archivos desde una unidad externa para que puedan ser restaurar y probar el servicio. <br><br>  En total, se proporcionaron dos modos de funcionamiento: el modo normal y el modo de recuperaci√≥n.  En modo normal, el controlador nos env√≠a una lista de archivos afectados por el inicio del sistema operativo.  Luego, mientras el sistema se est√° ejecutando, el controlador monitorea todas las operaciones de archivos y env√≠a notificaciones a nuestro servicio y, a su vez, cambia la lista de archivos.  En modo de recuperaci√≥n, el controlador notifica al servicio que la recuperaci√≥n del sistema es necesaria.  El servicio pone en cola los archivos, ejecuta agentes de software que solicitan archivos de la copia de seguridad y comienza el proceso de recuperaci√≥n. <br><br><h2>  Diploma, invitaci√≥n al trabajo y nuevos proyectos. </h2><br>  Cuando el servicio estuvo listo y probado, tuvimos la √∫ltima actividad en el proyecto.  Era necesario actualizar y estructurar todos los artefactos que hab√≠amos acumulado, as√≠ como presentar nuestros resultados al cliente y a la universidad.  Para la empresa, este fue otro paso hacia la implementaci√≥n del proyecto, para la universidad con nuestra tesis de graduaci√≥n. <br><br>  Despu√©s de la presentaci√≥n, se hizo una propuesta a los estudiantes.  Y despu√©s de unas semanas voy a trabajar a Acronis.  Los resultados del proyecto llevaron a los desarrolladores a pensar que es posible hacer que el servicio sea m√°s eficiente al reducirlo al nivel de la aplicaci√≥n nativa de Windows.  Pero m√°s sobre eso en el pr√≥ximo art√≠culo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/479524/">https://habr.com/ru/post/479524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../479464/index.html">Pipes & Filters. Example application and implementation using Spring</a></li>
<li><a href="../479466/index.html">Habraiting 2019: statistics and ranking of the best articles for 2019</a></li>
<li><a href="../479468/index.html">Edge of Honesty and John Doe</a></li>
<li><a href="../479474/index.html">Why is self-organization of teams so important in Scrum and why there cannot be managers in it</a></li>
<li><a href="../479522/index.html">Editorial Peter. Venta de invierno</a></li>
<li><a href="../479530/index.html">Sistema de coordenadas ultras√≥nicas 2.0</a></li>
<li><a href="../479534/index.html">Kubernetes 1.17: c√≥mo actualizar y no gastar todo el presupuesto de error</a></li>
<li><a href="../479536/index.html">Equilibrio de carga en Zimbra Open-Source Edition con HAProxy</a></li>
<li><a href="../479538/index.html">La tecnolog√≠a est√° llevando a la humanidad al declive. Es hora de cambiar algo</a></li>
<li><a href="../479540/index.html">Uso de passwordstore.org: administrador de contrase√±as estilo KISS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>