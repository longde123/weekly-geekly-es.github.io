<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõåüèø üëêüèø üë©üèø‚Äçüöí Vereinfachen Sie die Arbeit mit Datenbanken in Qt mit QSqlRelationalTableModel üë©üèæ‚Äçüéì üå¶Ô∏è üèà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guten Tag, Chabrowsk! In diesem Artikel m√∂chte ich √ºber meine Erfahrungen mit der Vereinfachung der Interaktion mit SQL-Datenbanken bei der Entwicklun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vereinfachen Sie die Arbeit mit Datenbanken in Qt mit QSqlRelationalTableModel</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435134/">  Guten Tag, Chabrowsk!  In diesem Artikel m√∂chte ich √ºber meine Erfahrungen mit der Vereinfachung der Interaktion mit SQL-Datenbanken bei der Entwicklung einer Desktopanwendung mithilfe der QSqlRelationalTableModel-Klasse der plattform√ºbergreifenden Qt-Bibliothek sprechen. <br><br><h3>  Prolog </h3><br>  Ich habe Qt kennengelernt, als ich im ersten Jahr war und gerade angefangen habe, in C ++ zu programmieren. Gleichzeitig habe ich mich ernsthaft f√ºr die Bibliothek interessiert und verfolge seitdem deren Aktualisierungen.  Vor einigen Monaten gaben sie mir bei der Arbeit eine TOR, in der es notwendig war, eine Anwendung zu entwickeln, die mit der SQLite-Datenbank interagiert.  Die Struktur der Basis ist fest und mir von TK im Voraus bekannt. <br><br>  Die Anwendung sollte es dem Bediener erm√∂glichen, die in der Datenbank gespeicherten Daten bequem darzustellen, neue Datens√§tze hinzuzuf√ºgen, vorhandene zu l√∂schen und zu √§ndern. <br><br>  Als n√§chstes werde ich den Entwicklungsprozess kurz mit Codefragmenten beschreiben und versuchen zu erkl√§ren, warum in diesem Fall die Wahl zugunsten von <b>QSqlRelationalTableModel getroffen wurde</b> . <br><a name="habracut"></a><br><h3>  Entwicklungsstart </h3><br>  Zun√§chst wurde beschlossen, eine Interaktion mit der Datenbank unter Verwendung einfacher Datenbankabfragen herzustellen, d. H.  <b>SELECT</b> , <b>INSERT</b> , <b>DELETE</b> , mit denen Sie alle erforderlichen Funktionen der Anwendung implementieren k√∂nnen. <br><br>  Dazu ben√∂tigen wir die <b>Klassen</b> <b>QSqlDatabase</b> und <b>QSQlQuery</b> : <br><br><pre><code class="cpp hljs">QSqlDatabase db; <span class="hljs-comment"><span class="hljs-comment">//    db = QSqlDatabase::addDatabase("QSQLITE"); //    db.setHostName("localhost"); //  ,    db.setDatabaseName(path); //QString path -    //   if(db.open()){ qDebug() &lt;&lt; "db opened OK..."; }else{ qDebug() &lt;&lt; " db opening failed..."; } }else{ qDebug() &lt;&lt; "file doesnot exist"; exit(0); // ,     , //   }</span></span></code> </pre> <br>  Danach werden alle Vorg√§nge in der Datenbank wie folgt ausgef√ºhrt: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ,    &lt;b&gt;QLineEdit&lt;/b&gt;' QString query = "INSERT INTO Table (column) VALUES ('" + ui-&gt;Input-&gt;text() + "')"; QSqlQuery sqlQuery(db); //c   qDebug() &lt;&lt; "QUERY: " &lt;&lt; query; // //   if(sqlQuery.exec(query)){ qDebug() &lt;&lt; "query failed..."; } else{ qDebug() &lt;&lt; "query failed..."; }</span></span></code> </pre> <br>  <b>Select-Anweisungen</b> werden √§hnlich ausgef√ºhrt, au√üer dass die Daten noch empfangen und irgendwo abgelegt werden m√ºssen: <br><br><pre> <code class="cpp hljs">QString query = <span class="hljs-string"><span class="hljs-string">"SELECT id, ka FROM Table"</span></span>; <span class="hljs-function"><span class="hljs-function">QSqlQuery </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqlQ</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(db)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!sqlQ.exec(query)) { qDebug() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"query failed..."</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//     // ,        while (sqlQ.next()){ //           ui-&gt;ComboBox-&gt;addItem(sqlQ.value(1).toString(),sqlQ.value(0).toInt()); }</span></span></code> </pre><br>  <b>Delete-Anweisungen</b> werden genauso ausgef√ºhrt wie Insert, da sie nichts zur√ºckgeben. <br><br><h3>  Alles klar, was ist das Problem? </h3><br>  Und die Wahrheit ist, Sie k√∂nnen alles durch diese Ausdr√ºcke und Abfragen implementieren. <b>Warum brauchen wir Modelle?</b> <br><br>  Wenn wir eine nicht verwandte Tabelle haben, scheint alles sehr einfach zu sein und erfordert keine Einf√ºhrung zus√§tzlicher Tools.  Stellen Sie sich nun vor, wir haben solche Tabellen, zum Beispiel 5 mit jeweils 5 Spalten, ohne ID.  Und jeder hat eine Verbindung mit dem vorherigen unter Verwendung eines <b>Fremdschl√ºssels</b> √ºber eine <b>ID</b> , d. H.  Beim L√∂schen muss eine Kaskade erstellt werden, um alle "untergeordneten" Datens√§tze zu l√∂schen.  Dies f√ºhrt zu einer gro√üen Anzahl von Anforderungen, die Arbeit der Anwendung wird erheblich verlangsamt. Dar√ºber hinaus m√ºssen die Tabelle und ihre Darstellung jedes Mal in der Benutzeroberfl√§che aktualisiert werden. Dies f√ºhrt dazu, dass zus√§tzliche Funktionen f√ºr die Aktualisierung, das Auftreten von Fehlern oder das Risiko ihres Auftretens geschrieben und im Allgemeinen die Lesbarkeit verringert werden Code. <br><br>  Aus diesem Grund musste ich w√§hrend des Entwicklungsprozesses das Konzept der Verwendung von Bare- <b>SQL-</b> Abfragen aufgeben. <br><br>  Weitere Entscheidungen wurden zugunsten von <b>QSqlRelationalTableModel</b> in Verbindung mit <b>QTableView getroffen</b> .  Es gibt eine noch einfachere Version der <b>Modellimplementierung</b> : <b>QSqlTableModel</b> , das erste wird von ihm geerbt, verf√ºgt √ºber dieselben Methoden, bietet jedoch die M√∂glichkeit, eine <b>QSqlRelation-</b> Verbindung zu erstellen. <b>Dies</b> ist sehr praktisch, wenn der Benutzer nicht die Datensatz-ID, sondern den Namen des Datensatzes "√ºbergeordnet" <b>anzeigen</b> muss, mit dem es versehen ist verbunden. <br><br><h3>  Schauen wir uns die Implementierung mit Modellen an </h3><br>  Hier sind einige Pod-Ausz√ºge, die die Implementierung von Modell / Ansicht zeigen. <br><br>  In der Header-Datei: <br><br><pre> <code class="cpp hljs">QSqlRelationalTableModel *model;</code> </pre><br>  Im Konstruktor: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,    //  QTableView  ,    //QModelIndex     ,      connect(ui-&gt;tableView, SIGNAL(clicked(const QModelIndex &amp;)), this, SLOT(onTableClicked(const QModelIndex &amp;))); model = new QSqlRelationalTableModel(parent, db); // , QSqlDatabase    model-&gt;setTable("Table"); //   </span></span></code> </pre><br>  Die folgende Zeile enth√§lt eine der bequemsten Funktionen und Vorteile des Modells gegen√ºber SQL-Abfragen: Je nach Kontext werden die Daten in der SQL-Tabelle beim Wechsel von zu QTableView bearbeitet, hinzugef√ºgt und gel√∂scht.  Der Vorteil ist, dass Sie nicht mehr die Richtigkeit des kaskadierenden L√∂schens und Aktualisierens von Daten in einer einzigen QTableView kontrollieren m√ºssen. <br><br><pre> <code class="cpp hljs">model-&gt;setEditStrategy(QSqlRelationalTableModel::OnFieldChange);</code> </pre><br>  Als n√§chstes kommt eine weitere praktische Funktion dieser Klasse: Es wird eine Verbindung zwischen zwei Spalten verschiedener Tabellen hergestellt: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//ParentTable - ,      //id - ,         //name - ,        model-&gt;setRelation(1,QSqlRelation("ParentTable", "id", "name"));</span></span></code> </pre><br>  Au√üerdem ist alles Standard: select () f√ºhrt eine SELECT-Anweisung aus und setHeaderData () setzt den Text in den QTableView-Headern: <br><br><pre> <code class="cpp hljs">model-&gt;select(); model-&gt;setHeaderData(<span class="hljs-number"><span class="hljs-number">0</span></span>, Qt::Horizontal, tr(<span class="hljs-string"><span class="hljs-string">"id"</span></span>)); model-&gt;setHeaderData(<span class="hljs-number"><span class="hljs-number">1</span></span>, Qt::Horizontal, tr(<span class="hljs-string"><span class="hljs-string">"id_sub"</span></span>)); model-&gt;setHeaderData(<span class="hljs-number"><span class="hljs-number">2</span></span>, Qt::Horizontal, tr(<span class="hljs-string"><span class="hljs-string">"count"</span></span>)); model-&gt;setHeaderData(<span class="hljs-number"><span class="hljs-number">3</span></span>, Qt::Horizontal, tr(<span class="hljs-string"><span class="hljs-string">"number"</span></span>)); model-&gt;setHeaderData(<span class="hljs-number"><span class="hljs-number">4</span></span>, Qt::Horizontal, tr(<span class="hljs-string"><span class="hljs-string">"data_word"</span></span>)); model-&gt;setHeaderData(<span class="hljs-number"><span class="hljs-number">5</span></span>, Qt::Horizontal, tr(<span class="hljs-string"><span class="hljs-string">"time"</span></span>)); model-&gt;setHeaderData(<span class="hljs-number"><span class="hljs-number">6</span></span>, Qt::Horizontal, tr(<span class="hljs-string"><span class="hljs-string">"name"</span></span>)); model-&gt;setHeaderData(<span class="hljs-number"><span class="hljs-number">7</span></span>, Qt::Horizontal, tr(<span class="hljs-string"><span class="hljs-string">"description"</span></span>)); ui-&gt;tableView-&gt;setModel(model); <span class="hljs-comment"><span class="hljs-comment">//     QTableView</span></span></code> </pre><br>  Jetzt arbeiten model und tableView zusammen und f√ºhren ihre Funktionen aus.  Ein Link zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> hinterl√§sst alle Quellen. In diesen habe ich einen Eintrag zum Modell hinzugef√ºgt, ihn gel√∂scht sowie Filter. <br><br><h3>  Fazit </h3><br>  In diesem Artikel wollte ich alle, die bereits mit der Datenbank in Qt arbeiten, ermutigen, reine SQL-Abfragen f√ºr Projekte mit mindestens mittlerer Komplexit√§t aufzugeben und auf die Arbeit mit Modellen umzusteigen, um ihr Leben zu vereinfachen, den Code lesbarer und universeller zu machen. Mach einfach etwas Gutes und Neues. <br><br>  Das ist alles!  Ich hoffe, dass meine Erfahrung mit diesen Kursen den Lesern hilft, ein √§hnliches Problem erfolgreich zu l√∂sen! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de435134/">https://habr.com/ru/post/de435134/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de435122/index.html">Wie die Flamme in Doom auf der Playstation implementiert wurde</a></li>
<li><a href="../de435124/index.html">Meisterwerke der Welts√§ulenkonstruktion: ein Studiomonitor-Transformator mit variabler Anzahl von B√§ndern</a></li>
<li><a href="../de435126/index.html">Erfahrung in der Organisation und Durchf√ºhrung von Unternehmenskonferenzen f√ºr Analysten</a></li>
<li><a href="../de435128/index.html">Pi-Sonos: ein au√üer Kontrolle geratenes Hobby</a></li>
<li><a href="../de435132/index.html">Nomad: Probleme und L√∂sungen</a></li>
<li><a href="../de435136/index.html">Sergey und die wissenschaftliche Methode</a></li>
<li><a href="../de435138/index.html">So √ºbernehmen Sie die Kontrolle √ºber Ihre Netzwerkinfrastruktur. Kapitel Drei Netzwerksicherheit. Teil eins</a></li>
<li><a href="../de435142/index.html">Trace mit eBPF lernen: Ein Leitfaden und Beispiele</a></li>
<li><a href="../de435144/index.html">Einf√ºhrung in Spring Boot: Erstellen einer einfachen REST-API in Java</a></li>
<li><a href="../de435148/index.html">Native DHCP-Server mit Bash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>