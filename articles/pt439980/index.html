<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üß¢ üöô üïØÔ∏è Docker de aprendizagem, parte 3: arquivos do Dockerfile üå´Ô∏è ‚è±Ô∏è üí£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na tradu√ß√£o da terceira parte da s√©rie Docker, continuaremos a ser inspirados por doces, ou seja, bagels. Nosso principal t√≥pico hoje estar√° trabalhan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Docker de aprendizagem, parte 3: arquivos do Dockerfile</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/439980/">  Na tradu√ß√£o da terceira parte da s√©rie Docker, continuaremos a ser inspirados por doces, ou seja, bagels.  Nosso principal t√≥pico hoje estar√° trabalhando com Dockerfiles.  Analisaremos as instru√ß√µes usadas nesses arquivos. <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1: o b√°sico</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2: termos e conceitos</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3: arquivos Dockerfile</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 4: reduzindo o tamanho das imagens e acelerando sua montagem</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 5: equipes</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 6: trabalhando com dados</a> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29b/15a/6bf/29b15a6bfff06c617017301b30ed95c2.jpg"></div><br>  <i><font color="#999999">Bagels s√£o instru√ß√µes em um Dockerfile.</font></i> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Imagens do Docker</font> </h2><br>  Lembre-se de que um cont√™iner do Docker √© uma imagem do Docker criada.  Este √© um sistema operacional independente no qual existe apenas o c√≥digo de aplicativo e mais necess√°rio. <br><br>  Imagens do Docker s√£o o resultado do processo de cria√ß√£o e os cont√™ineres do Docker est√£o executando imagens.  No cora√ß√£o do Docker est√£o os Dockerfiles.  Arquivos como este informam ao Docker como montar as imagens a partir das quais os cont√™ineres s√£o criados. <br><br>  Cada imagem do Docker possui um arquivo chamado Dockerfile.  Seu nome est√° escrito assim - sem extens√£o.  Quando voc√™ executa o <code>docker build</code> para criar uma nova imagem, sup√µe-se que o Dockerfile esteja no diret√≥rio de trabalho atual.  Se esse arquivo estiver localizado em outro local, sua localiza√ß√£o poder√° ser especificada usando o sinalizador <code>-f</code> . <br><br>  Os cont√™ineres, como descobrimos no primeiro material desta s√©rie, consistem em camadas.  Cada camada, exceto a √∫ltima, localizada em cima de todas as outras, √© somente leitura.  O Dockerfile informa ao sistema Docker quais camadas e em que ordem adicionar √† imagem. <br><br>  Cada camada, de fato, √© apenas um arquivo que descreve a altera√ß√£o no estado da imagem em compara√ß√£o com o estado em que estava ap√≥s adicionar a camada anterior.  No Unix, a prop√≥sito, quase tudo √© um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquivo</a> . <br><br>  Uma imagem b√°sica √© o que √© a camada de origem (ou camadas) da imagem que est√° sendo criada.  A imagem base tamb√©m √© chamada de imagem pai. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a0/b89/6aa/6a0b896aa35c1f735103ae8924d5371d.jpg"></div><br>  <i><font color="#999999">A imagem b√°sica √© onde a imagem do Docker come√ßa.</font></i> <br><br>  Quando uma imagem √© baixada de um reposit√≥rio remoto para um computador local, apenas as camadas que n√£o est√£o dispon√≠veis neste computador s√£o baixadas fisicamente.  O Docker visa economizar espa√ßo e tempo reutilizando as camadas existentes. <br><br><h2>  <font color="#3AC1EF">Arquivos Dockerfile</font> </h2><br>  Os arquivos de encaixe cont√™m instru√ß√µes para criar uma imagem.  Em letras mai√∫sculas, as linhas deste arquivo come√ßam.  Seguindo as instru√ß√µes est√£o seus argumentos.  As instru√ß√µes, ao criar a imagem, s√£o processadas de cima para baixo.  Aqui est√° o que parece: <br><br><pre> <code class="plaintext hljs">FROM ubuntu:18.04 COPY . /app</code> </pre> <br>  As camadas na imagem final s√£o criadas apenas pelas instru√ß√µes <code>FROM</code> , <code>RUN</code> , <code>COPY</code> e <code>ADD</code> .  Outras instru√ß√µes configuram algo, descrevem metadados ou informam ao Docker que voc√™ precisa fazer algo durante a execu√ß√£o do cont√™iner, por exemplo, abrir alguma porta ou executar algum comando. <br><br>  Aqui partimos da suposi√ß√£o de que uma imagem do Docker baseada em um sistema operacional tipo Unix √© usada.  Obviamente, aqui voc√™ tamb√©m pode usar uma imagem baseada no Windows, mas usar o Windows √© uma pr√°tica menos comum, trabalhar com essas imagens √© mais dif√≠cil.  Como resultado, se voc√™ tiver a oportunidade, use o Unix. <br><br>  Para come√ßar, aqui est√° uma lista de instru√ß√µes do Dockerfile com breves coment√°rios. <br><br><h2>  <font color="#3AC1EF">D√∫zia Dockerfile Instru√ß√µes</font> </h2><br><ol><li>  <code>FROM</code> - define a imagem base (principal). </li><li>  <code>LABEL</code> - descreve metadados.  Por exemplo, informa√ß√µes sobre quem criou e mant√©m a imagem. </li><li>  <code>ENV</code> - define vari√°veis ‚Äã‚Äãde ambiente persistentes. </li><li>  <code>RUN</code> - executa um comando e cria uma camada de imagem.  Usado para instalar pacotes em um cont√™iner. </li><li>  <code>COPY</code> - copia arquivos e pastas para o cont√™iner. </li><li>  <code>ADD</code> - copia arquivos e pastas para um cont√™iner, pode descompactar arquivos .tar locais. </li><li>  <code>CMD</code> - descreve um comando com argumentos que precisam ser executados quando o cont√™iner √© iniciado.  Os argumentos podem ser substitu√≠dos quando o cont√™iner √© iniciado.  Um arquivo pode conter apenas uma instru√ß√£o <code>CMD</code> . </li><li>  <code>WORKDIR</code> - define o diret√≥rio de trabalho para a pr√≥xima instru√ß√£o. </li><li>  <code>ARG</code> - define vari√°veis ‚Äã‚Äãpara passar o Docker durante a cria√ß√£o da imagem. </li><li>  <code>ENTRYPOINT</code> - fornece um comando com argumentos para chamar durante a execu√ß√£o do cont√™iner.  Argumentos n√£o s√£o substitu√≠dos. </li><li>  <code>EXPOSE</code> - indica a necessidade de abrir a porta. </li><li>  <code>VOLUME</code> - cria um ponto de montagem para trabalhar com armazenamento persistente. </li></ol><br>  Agora vamos falar sobre essas instru√ß√µes. <br><br><h2>  <font color="#3AC1EF">Instru√ß√µes e exemplos de uso</font> </h2><br><h3>  <font color="#3AC1EF">‚ñçDockerfile simples</font> </h3><br>  O Dockerfile pode ser extremamente simples e curto.  Por exemplo - assim: <br><br><pre> <code class="plaintext hljs">FROM ubuntu:18.04</code> </pre> <br><h3>  <font color="#3AC1EF">RomDe instru√ß√µes</font> </h3><br>  O Dockerfile deve come√ßar com uma instru√ß√£o <code>FROM</code> ou com uma instru√ß√£o <code>ARG</code> seguida por uma instru√ß√£o <code>FROM</code> . <br><br>  A palavra-chave <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">FROM</a> diz ao Docker para usar uma imagem base que corresponda ao nome e √† tag fornecidos ao criar a imagem.  Al√©m disso, a imagem b√°sica tamb√©m √© chamada de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">imagem pai</a> . <br><br>  Neste exemplo, a imagem base √© armazenada no reposit√≥rio do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ubuntu</a> .  Ubuntu √© o nome do reposit√≥rio oficial do Docker, que fornece a vers√£o base da popular fam√≠lia de sistemas operacionais Linux chamada Ubuntu. <br><br>  Observe que o Dockerfile em quest√£o inclui uma marca <code>18.04</code> que especifica qual imagem base precisamos.  √â essa imagem que ser√° carregada ao criar nossa imagem.  Se a tag n√£o estiver inclu√≠da na instru√ß√£o, o Docker continuar√° assumindo que a imagem mais recente do reposit√≥rio √© necess√°ria.  Para expressar mais claramente suas inten√ß√µes, √© recomend√°vel que o autor do Dockerfile indique qual imagem ele precisa. <br><br>  Quando o Dockerfile acima √© usado na m√°quina local para criar a imagem pela primeira vez, o Docker carrega as camadas definidas pela imagem do <code>ubuntu</code> .  Eles podem ser imaginados sobrepostos um ao outro.  Cada camada seguinte √© um arquivo que descreve as diferen√ßas da imagem em compara√ß√£o com o estado em que estava ap√≥s adicionar a camada anterior. <br><br>  Quando voc√™ cria um cont√™iner, uma camada na qual voc√™ pode fazer altera√ß√µes √© adicionada sobre todas as outras camadas.  Os dados nas camadas restantes s√≥ podem ser lidos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/912/530/d4f/912530d4f3468f0bff2a064d58d62caf.jpg"></div><br>  <i><font color="#999999">Estrutura de cont√™iner (retirada da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> )</font></i> <br><br>  O Docker, por uma quest√£o de efici√™ncia, usa uma estrat√©gia de copiar na grava√ß√£o.  Se a camada da imagem existir no n√≠vel anterior e alguma camada precisar ler dados dela, o Docker usar√° o arquivo existente.  Voc√™ n√£o precisa baixar nada. <br><br>  Quando a imagem √© executada, se a camada precisar ser modificada por meio do cont√™iner, o arquivo correspondente ser√° copiado para a camada superior mut√°vel.  Para saber mais sobre a estrat√©gia de copiar na grava√ß√£o, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este</a> material na documenta√ß√£o do Docker. <br><br>  Continuamos a discuss√£o das instru√ß√µes usadas no Dockerfile, fornecendo um exemplo de um arquivo com uma estrutura mais complexa. <br><br><h3>  <font color="#3AC1EF">Arquivo docker mais sofisticado</font> </h3><br>  Embora o arquivo Docker que acabamos de revisar tenha sido limpo e compreens√≠vel, √© muito simples, ele usa apenas uma instru√ß√£o.  Al√©m disso, n√£o h√° instru√ß√µes chamadas durante a execu√ß√£o do cont√™iner.  D√™ uma olhada em outro arquivo que coleta uma imagem pequena.  Possui mecanismos que determinam os comandos que s√£o chamados durante a execu√ß√£o do cont√™iner. <br><br><pre> <code class="plaintext hljs">FROM python:3.7.2-alpine3.8 LABEL maintainer="jeffmshale@gmail.com" ENV ADMIN="jeff" RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash COPY . ./app ADD https://raw.githubusercontent.com/discdiver/pachy-vid/master/sample_vids/vid1.mp4 \ /my_app_directory RUN ["mkdir", "/a_directory"] CMD ["python", "./my_script.py"]</code> </pre> <br>  Talvez, √† primeira vista, esse arquivo possa parecer bastante complicado.  Portanto, vamos lidar com ele. <br><br>  A base desta imagem √© a imagem oficial do Python com a tag 3.7.2-alpine3.8.  Ap√≥s analisar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esse</a> c√≥digo, voc√™ pode ver que essa imagem b√°sica inclui Linux, Python e, em geral, isso √© limitado √† sua composi√ß√£o.  As imagens do sistema operacional Alpine s√£o muito populares no mundo do Docker.  O fato de serem pequenos em tamanho, alta velocidade e seguran√ßa.  No entanto, as imagens alpinas n√£o diferem nos amplos recursos t√≠picos dos sistemas operacionais convencionais.  Portanto, para coletar algo √∫til com base nessa imagem, o criador da imagem precisa instalar os pacotes de que precisa. <br><br><h3>  <font color="#3AC1EF">‚ñçInstru√ß√£o LABEL</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/839/d5d/720/839d5d7205849f8dee228dcd7a42eaf7.jpg"></div><br>  <i><font color="#999999">Tags</font></i> <br><br>  A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instru√ß√£o LABEL</a> (etiqueta) permite adicionar metadados √† imagem.  No caso do arquivo em considera√ß√£o agora, ele inclui as informa√ß√µes de contato do criador da imagem.  Declarar etiquetas n√£o atrasa o processo de montagem da imagem nem aumenta seu tamanho.  Eles cont√™m apenas informa√ß√µes √∫teis sobre a imagem do Docker, portanto, √© recomend√°vel que eles sejam inclu√≠dos no arquivo.  Detalhes sobre como trabalhar com metadados no Dockerfile podem ser encontrados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><h3>  <font color="#3AC1EF">InstructionInv instru√ß√£o</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d85/1a1/4d7/d851a14d7b7f4db671afe3b375cb4596.jpg"></div><br>  <i><font color="#999999">Meio ambiente</font></i> <br><br>  A instru√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ENV</a> permite definir vari√°veis ‚Äã‚Äãde ambiente constantes que estar√£o dispon√≠veis no cont√™iner durante sua execu√ß√£o.  No exemplo anterior, depois de criar o cont√™iner, voc√™ pode usar a vari√°vel <code>ADMIN</code> . <br><br>  A instru√ß√£o <code>ENV</code> √© adequada para definir constantes.  Se voc√™ usar um determinado valor no Dockerfile v√°rias vezes, por exemplo, ao descrever os comandos que s√£o executados no cont√™iner, e suspeitar que algum dia precise alter√°-lo para outro, faz sentido escrev√™-lo em uma constante semelhante. <br><br>  Note-se que nos arquivos do Dockerfile geralmente existem maneiras diferentes de resolver os mesmos problemas.  O que exatamente usar √© uma pergunta cuja decis√£o √© influenciada pelo desejo de cumprir os m√©todos de trabalho adotados no ambiente do Docker, para garantir a transpar√™ncia da solu√ß√£o e seu alto desempenho.  Por exemplo, as <code>ENTRYPOINT</code> <code>RUN</code> , <code>CMD</code> e <code>ENTRYPOINT</code> servem a prop√≥sitos diferentes, mas todas s√£o usadas para executar comandos. <br><br><h3>  <font color="#3AC1EF">Instru√ß√£o UNRUN</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/910/a89/72b/910a8972b92a69418d859a1fbd550ae5.jpg"></div><br>  <i><font color="#999999">Instru√ß√£o RUN</font></i> <br><br>  A instru√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RUN</a> permite criar uma camada durante a cria√ß√£o da imagem.  Ap√≥s sua execu√ß√£o, uma nova camada √© adicionada √† imagem, seu estado √© fixo.  A instru√ß√£o <code>RUN</code> √© frequentemente usada para instalar pacotes adicionais em imagens.  No exemplo anterior, a instru√ß√£o <code>RUN apk update &amp;&amp; apk upgrade</code> informa ao Docker que o sistema precisa atualizar pacotes a partir da imagem base.  Ap√≥s esses dois comandos, est√° o comando <code>&amp;&amp; apk add bash</code> , indicando que o bash precisa ser instalado na imagem. <br><br>  O que parece ser <code>apk</code> em equipes √© uma abrevia√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Alpine Linux package manager</a> .  Se voc√™ estiver usando a imagem base de outro sistema operacional da fam√≠lia Linux, por exemplo, ao usar o Ubuntu, pode ser necess√°rio um comando no formato <code>RUN apt-get</code> para instalar pacotes.  Mais tarde, falaremos sobre outras maneiras de instalar pacotes. <br><br>  A instru√ß√£o <code>RUN</code> e instru√ß√µes semelhantes, como <code>CMD</code> e <code>ENTRYPOINT</code> , podem ser usadas no formato exec ou no formato shell.  O formul√°rio exec usa uma sintaxe semelhante √† descri√ß√£o de uma matriz JSON.  Por exemplo, pode ser assim: <code>RUN ["my_executable", "my_first_param1", "my_second_param2"]</code> . <br><br>  No exemplo anterior, usamos a forma de shell da instru√ß√£o RUN da seguinte maneira: <code>RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash</code> . <br><br>  Posteriormente em nosso Dockerfile, usamos a forma exec da instru√ß√£o <code>RUN</code> , na forma de <code>RUN ["mkdir", "/a_directory"]</code> para criar um diret√≥rio.  Ao mesmo tempo, usando as instru√ß√µes neste formul√°rio, √© necess√°rio lembrar a necessidade de formatar cadeias de caracteres com aspas duplas, como √© habitual no formato JSON. <br><br><h3>  <font color="#3AC1EF">‚ñçInstru√ß√£o C√ìPIA</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ba/8b7/b82/5ba8b7b82e09854f7ba3ac1d2ad5b404.jpg"></div><br>  <i><font color="#999999">Instru√ß√£o COPY</font></i> <br><br>  A instru√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">COPY</a> √© apresentada em nosso arquivo assim: <code>COPY . ./app</code>  <code>COPY . ./app</code> .  Ela diz ao Docker que precisa pegar arquivos e pastas do contexto local da montagem e adicion√°-los ao diret√≥rio de trabalho atual da imagem.  Se o diret√≥rio de destino n√£o existir, esta instru√ß√£o o criar√°. <br><br><h3>  <font color="#3AC1EF">‚ñçInstru√ß√£o ADICIONAR</font> </h3><br>  A instru√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ADD</a> permite resolver os mesmos problemas que <code>COPY</code> , mas mais alguns <code>COPY</code> uso est√£o associados a ela.  Portanto, usando esta instru√ß√£o, voc√™ pode adicionar arquivos baixados de fontes remotas ao cont√™iner, al√©m de descompactar arquivos .tar locais. <br><br>  Neste exemplo, a instru√ß√£o <code>ADD</code> foi usada para copiar um arquivo acess√≠vel por URL para o <code>my_app_directory</code> cont√™iner <code>my_app_directory</code> .  Note-se, no entanto, que a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Docker</a> n√£o recomenda o uso desses arquivos obtidos pela URL, pois eles n√£o podem ser exclu√≠dos e aumentam o tamanho da imagem. <br><br>  Al√©m disso, a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> sugere, sempre que poss√≠vel, que voc√™ use a instru√ß√£o <code>COPY</code> vez da instru√ß√£o <code>ADD</code> para facilitar a compreens√£o do Dockerfile.  Acredito que a equipe de desenvolvimento do Docker deve combinar <code>ADD</code> e <code>COPY</code> em uma instru√ß√£o para que aqueles que criam as imagens n√£o precisem se lembrar de muitas instru√ß√µes. <br><br>  Observe que a instru√ß√£o <code>ADD</code> cont√©m o caractere de quebra de linha - <code>\</code> .  Esses caracteres s√£o usados ‚Äã‚Äãpara melhorar a legibilidade de comandos longos, dividindo-os em v√°rias linhas. <br><br><h3>  <font color="#3AC1EF">Instruction instru√ß√£o CMD</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/505/835/d13/505835d13cd3c9300f0d95681b3dbf93.jpg"></div><br>  <i><font color="#999999">Instru√ß√£o CMD</font></i> <br><br>  A instru√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CMD</a> fornece ao Docker um comando para executar quando o cont√™iner for iniciado.  Os resultados deste comando n√£o s√£o adicionados √† imagem durante sua montagem.  Em nosso exemplo, este comando inicia o script <code>my_script.py</code> em tempo de execu√ß√£o. <br><br>  Aqui est√° outra coisa que voc√™ precisa saber sobre a instru√ß√£o <code>CMD</code> : <br><br><ul><li>  Somente uma instru√ß√£o <code>CMD</code> pode estar presente em um Dockerfile.  Se houver v√°rias instru√ß√µes no arquivo, o sistema ignorar√° tudo, exceto a √∫ltima. </li><li>  Uma instru√ß√£o <code>CMD</code> pode ter um formul√°rio exec.  Se a instru√ß√£o n√£o incluir a refer√™ncia ao arquivo execut√°vel, a instru√ß√£o <code>ENTRYPOINT</code> dever√° estar presente no arquivo.  Nesse caso, essas duas instru√ß√µes devem estar no <code>JSON</code> . </li><li>  Os argumentos da linha de comando transmitidos para a <code>docker run</code> substituem os argumentos fornecidos pela instru√ß√£o <code>CMD</code> no Dockerfile. </li></ul><br><h3>  <font color="#3AC1EF">DUm Dockerfile ainda mais complexo</font> </h3><br>  Considere outro Dockerfile, no qual alguns novos comandos ser√£o usados. <br><br><pre> <code class="plaintext hljs">FROM python:3.7.2-alpine3.8 LABEL maintainer="jeffmshale@gmail.com" #   RUN apk add --update git #     WORKDIR /usr/src/my_app_directory #          COPY . . #       ARG my_var=my_default_value #  ,           ENTRYPOINT ["python", "./app/my_script.py", "my_var"] #   EXPOSE 8000 #      VOLUME /my_volume</code> </pre> <br>  Neste exemplo, entre outras coisas, voc√™ pode ver coment√°rios que come√ßam com o caractere <code>#</code> . <br>  Uma das principais coisas que o Dockerfile faz √© instalar pacotes.  Como j√° mencionado, existem v√°rias maneiras de instalar pacotes usando a instru√ß√£o <code>RUN</code> . <br><br>  Os pacotes na imagem do Alpine Docker podem ser instalados usando o <code>apk</code> .  Para isso, como j√° dissemos, <code>RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash</code> um comando do formul√°rio <code>RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash</code> . <br><br>  Al√©m disso, os pacotes Python na imagem podem ser instalados usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pip</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wheel</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conda</a> .  Se n√£o estamos falando sobre Python, mas sobre outras linguagens de programa√ß√£o, outros gerenciadores de pacotes podem ser usados ‚Äã‚Äãpara preparar as imagens correspondentes. <br><br>  Ao mesmo tempo, para que a instala√ß√£o seja poss√≠vel, a camada subjacente deve fornecer ao gerenciador de pacotes um gerenciador de pacotes adequado.  Portanto, se voc√™ encontrar problemas para instalar pacotes, verifique se o gerenciador de pacotes est√° instalado antes de tentar us√°-lo. <br><br>  Por exemplo, voc√™ pode usar a instru√ß√£o <code>RUN</code> em um Dockerfile para instalar uma lista de pacotes usando o <code>pip</code> .  Se voc√™ fizer isso, combine todos os comandos em uma instru√ß√£o e separe-os com caracteres de quebra de linha usando o caractere <code>\</code> .  Gra√ßas a essa abordagem, os arquivos ficar√£o bem arrumados e isso levar√° √† adi√ß√£o de menos camadas √† imagem do que seria adicionado usando v√°rias instru√ß√µes <code>RUN</code> . <br><br>  Al√©m disso, voc√™ pode fazer coisas diferentes para instalar v√°rios pacotes.  Voc√™ pode list√°-los em um arquivo e transferi-lo para o gerenciador de pacotes usando <code>RUN</code> .  Normalmente, esses arquivos s√£o chamados <code>requirements.txt</code> . <br><br><h3>  <font color="#3AC1EF">‚ñç Instru√ß√£o WORDDIR</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/528/9ef/88f/5289ef88f3bc5fc7e4856fdc13d9872e.jpg"></div><br>  <i><font color="#999999">Diret√≥rios de trabalho</font></i> <br><br>  A instru√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">WORKDIR</a> permite alterar o diret√≥rio de trabalho do cont√™iner.  As <code>ENTRYPOINT</code> <code>COPY</code> , <code>ADD</code> , <code>RUN</code> , <code>CMD</code> e <code>ENTRYPOINT</code> que seguem <code>WORKDIR</code> funcionam com este diret√≥rio.  Aqui est√£o alguns recursos relacionados a esta instru√ß√£o: <br><br><ul><li>  √â melhor definir caminhos absolutos para pastas com <code>WORKDIR</code> vez de navegar no sistema de arquivos usando os comandos <code>cd</code> no Dockerfile. </li><li>  A instru√ß√£o <code>WORKDIR</code> cria automaticamente um diret√≥rio se ele n√£o existir. </li><li>  Voc√™ pode usar v√°rias instru√ß√µes do <code>WORKDIR</code> .  Se forem fornecidas instru√ß√µes relativas a essas instru√ß√µes, cada uma delas mudar√° o diret√≥rio de trabalho atual. </li></ul><br><h3>  <font color="#3AC1EF">‚ñçGuia ARG</font> </h3><br>  A instru√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ARG</a> permite definir uma vari√°vel cujo valor pode ser passado da linha de comando para a imagem durante sua montagem.  O valor da vari√°vel padr√£o pode ser representado no Dockerfile.  Por exemplo: <code>ARG my_var=my_default_value</code> . <br><br>  Diferente das vari√°veis <code>ENV</code> , as vari√°veis <code>ARG</code> n√£o est√£o dispon√≠veis no tempo de execu√ß√£o.  No entanto, as vari√°veis <code>ARG</code> podem ser usadas para definir valores padr√£o para vari√°veis <code>ENV</code> na linha de comando durante a cria√ß√£o da imagem.  E as vari√°veis <code>ENV</code> j√° estar√£o dispon√≠veis no cont√™iner durante sua execu√ß√£o.  Detalhes sobre essa t√©cnica de trabalhar com vari√°veis ‚Äã‚Äãpodem ser encontrados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><h3>  <font color="#3AC1EF">‚ñçInstru√ß√£o ENTRYPOINT</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2f/8b8/e95/c2f8b8e95436c097571b44810ac97a7a.jpg"></div><br>  <i><font color="#999999">Ponto de transi√ß√£o para algum lugar</font></i> <br><br>  A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instru√ß√£o ENTRYPOINT</a> permite especificar um comando com argumentos que devem ser executados quando o cont√™iner for iniciado.  √â semelhante ao comando <code>CMD</code> , mas os par√¢metros especificados em <code>ENTRYPOINT</code> n√£o ser√£o substitu√≠dos se o cont√™iner for iniciado com par√¢metros de linha de comando. <br><br>  Em vez disso, os argumentos da linha de comando passados ‚Äã‚Äãnas constru√ß√µes da <code>docker run my_image_name</code> formul√°rio <code>docker run my_image_name</code> s√£o adicionados aos argumentos especificados pela <code>ENTRYPOINT</code> .  Por exemplo, depois de executar um comando da <code>docker run my_image bash</code> formul√°rios e <code>docker run my_image bash</code> argumento <code>docker run my_image bash</code> ser√° adicionado ao final da lista de argumentos especificados por <code>ENTRYPOINT</code> .  Ao preparar o Dockerfile, n√£o esque√ßa as <code>ENTRYPOINT</code> <code>CMD</code> ou <code>ENTRYPOINT</code> . <br><br>  Existem v√°rias recomenda√ß√µes na documenta√ß√£o do Docker sobre quais instru√ß√µes, <code>CMD</code> ou <code>ENTRYPOINT</code> , devem ser escolhidas como uma ferramenta para executar comandos quando o cont√™iner √© iniciado: <br><br><ul><li>  Se voc√™ precisar executar o mesmo comando sempre que iniciar o cont√™iner, use <code>ENTRYPOINT</code> . </li><li>  Se o cont√™iner for usado como um aplicativo, use <code>ENTRYPOINT</code> . </li><li>  Se voc√™ souber que, ao iniciar o cont√™iner, precisar√° passar argumentos que possam substituir os argumentos especificados no Dockerfile, use o <code>CMD</code> . </li></ul><br>  Em nosso exemplo, o uso da instru√ß√£o <code>ENTRYPOINT ["python", "my_script.py", "my_var"]</code> faz com que o cont√™iner, quando iniciado, execute o script Python <code>my_script.py</code> com o argumento <code>my_var</code> .  O valor representado por <code>my_var</code> pode ser usado no script usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">argparse</a> .    ,   Dockerfile  <code>my_var</code> ,   ,       <code>ARG</code> .  ,         ,     . <br><br>  Docker   exec- <code>ENTRYPOINT</code> : <code>ENTRYPOINT ["executable", "param1", "param2"]</code> . <br><br><h3> <font color="#3AC1EF">‚ñç EXPOSE</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee1/cca/45e/ee1cca45e3fd7e9be988556536fb1633.jpg"></div><br> <i><font color="#999999"> EXPOSE</font></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">EXPOSE</a>   ,      ,          .     . , ,     ,   ,   ,  ,   . <br><br>      ( )    ,    <code>docker run</code>   <code>-p</code> .      <code>-P</code> (   <code>P</code> ),     ,    <code>EXPOSE</code> . <br><br><h3> <font color="#3AC1EF">‚ñç VOLUME</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c1/ff6/a57/7c1ff6a5765f28cbd3d68cbf60d6b4aa.jpg"></div><br> <i><font color="#999999"> VOLUME</font></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">VOLUME</a>   ,              .     . <br><br><h2>  <font color="#3AC1EF">Sum√°rio</font> </h2><br>     ,       Dockerfile.      .  ,      ,  <code>USER</code> , <code>ONBUILD</code> , <code>STOPSIGNAL</code> , <code>SHELL</code>  <code>HEALTHCHECK</code> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>     Dockerfile. <br><br> ,  Dockerfile ‚Äî     Docker,      ,        .          ,       . <br><br>  <b>Caros leitores!</b>    Docker  ,    ,    Docker-. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt439980/">https://habr.com/ru/post/pt439980/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt439970/index.html">Relat√≥rio sobre problemas e acessibilidade da Internet em 2018-2019</a></li>
<li><a href="../pt439972/index.html">io_submit: uma alternativa ao epoll de que voc√™ nunca ouviu falar</a></li>
<li><a href="../pt439974/index.html">Transforma√ß√£o √°gil pessoal: uma jornada flex√≠vel para a produtividade</a></li>
<li><a href="../pt439976/index.html">O Node.js sempre ser√° mais lento que o Golang?</a></li>
<li><a href="../pt439978/index.html">Docker de aprendizagem, parte 2: termos e conceitos</a></li>
<li><a href="../pt439982/index.html">Tutorial Reagir, Parte 16: A quarta fase do trabalho em um aplicativo TODO, processamento de eventos</a></li>
<li><a href="../pt439984/index.html">Tutorial Reagir, parte 17: O quinto est√°gio do trabalho em um aplicativo TODO, modificando o estado do componente</a></li>
<li><a href="../pt439986/index.html">Chips contra amea√ßas √† tecnologia de cont√™iner</a></li>
<li><a href="../pt439988/index.html">Tecnosfera cinco anos</a></li>
<li><a href="../pt439990/index.html">O livro ‚ÄúPragmatic AI. Aprendizado de m√°quina e tecnologia em nuvem</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>