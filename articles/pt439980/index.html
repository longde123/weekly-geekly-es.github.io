<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧢 🚙 🕯️ Docker de aprendizagem, parte 3: arquivos do Dockerfile 🌫️ ⏱️ 💣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na tradução da terceira parte da série Docker, continuaremos a ser inspirados por doces, ou seja, bagels. Nosso principal tópico hoje estará trabalhan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Docker de aprendizagem, parte 3: arquivos do Dockerfile</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/439980/">  Na tradução da terceira parte da série Docker, continuaremos a ser inspirados por doces, ou seja, bagels.  Nosso principal tópico hoje estará trabalhando com Dockerfiles.  Analisaremos as instruções usadas nesses arquivos. <br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1: o básico</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2: termos e conceitos</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 3: arquivos Dockerfile</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 4: reduzindo o tamanho das imagens e acelerando sua montagem</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 5: equipes</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 6: trabalhando com dados</a> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29b/15a/6bf/29b15a6bfff06c617017301b30ed95c2.jpg"></div><br>  <i><font color="#999999">Bagels são instruções em um Dockerfile.</font></i> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Imagens do Docker</font> </h2><br>  Lembre-se de que um contêiner do Docker é uma imagem do Docker criada.  Este é um sistema operacional independente no qual existe apenas o código de aplicativo e mais necessário. <br><br>  Imagens do Docker são o resultado do processo de criação e os contêineres do Docker estão executando imagens.  No coração do Docker estão os Dockerfiles.  Arquivos como este informam ao Docker como montar as imagens a partir das quais os contêineres são criados. <br><br>  Cada imagem do Docker possui um arquivo chamado Dockerfile.  Seu nome está escrito assim - sem extensão.  Quando você executa o <code>docker build</code> para criar uma nova imagem, supõe-se que o Dockerfile esteja no diretório de trabalho atual.  Se esse arquivo estiver localizado em outro local, sua localização poderá ser especificada usando o sinalizador <code>-f</code> . <br><br>  Os contêineres, como descobrimos no primeiro material desta série, consistem em camadas.  Cada camada, exceto a última, localizada em cima de todas as outras, é somente leitura.  O Dockerfile informa ao sistema Docker quais camadas e em que ordem adicionar à imagem. <br><br>  Cada camada, de fato, é apenas um arquivo que descreve a alteração no estado da imagem em comparação com o estado em que estava após adicionar a camada anterior.  No Unix, a propósito, quase tudo é um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquivo</a> . <br><br>  Uma imagem básica é o que é a camada de origem (ou camadas) da imagem que está sendo criada.  A imagem base também é chamada de imagem pai. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a0/b89/6aa/6a0b896aa35c1f735103ae8924d5371d.jpg"></div><br>  <i><font color="#999999">A imagem básica é onde a imagem do Docker começa.</font></i> <br><br>  Quando uma imagem é baixada de um repositório remoto para um computador local, apenas as camadas que não estão disponíveis neste computador são baixadas fisicamente.  O Docker visa economizar espaço e tempo reutilizando as camadas existentes. <br><br><h2>  <font color="#3AC1EF">Arquivos Dockerfile</font> </h2><br>  Os arquivos de encaixe contêm instruções para criar uma imagem.  Em letras maiúsculas, as linhas deste arquivo começam.  Seguindo as instruções estão seus argumentos.  As instruções, ao criar a imagem, são processadas de cima para baixo.  Aqui está o que parece: <br><br><pre> <code class="plaintext hljs">FROM ubuntu:18.04 COPY . /app</code> </pre> <br>  As camadas na imagem final são criadas apenas pelas instruções <code>FROM</code> , <code>RUN</code> , <code>COPY</code> e <code>ADD</code> .  Outras instruções configuram algo, descrevem metadados ou informam ao Docker que você precisa fazer algo durante a execução do contêiner, por exemplo, abrir alguma porta ou executar algum comando. <br><br>  Aqui partimos da suposição de que uma imagem do Docker baseada em um sistema operacional tipo Unix é usada.  Obviamente, aqui você também pode usar uma imagem baseada no Windows, mas usar o Windows é uma prática menos comum, trabalhar com essas imagens é mais difícil.  Como resultado, se você tiver a oportunidade, use o Unix. <br><br>  Para começar, aqui está uma lista de instruções do Dockerfile com breves comentários. <br><br><h2>  <font color="#3AC1EF">Dúzia Dockerfile Instruções</font> </h2><br><ol><li>  <code>FROM</code> - define a imagem base (principal). </li><li>  <code>LABEL</code> - descreve metadados.  Por exemplo, informações sobre quem criou e mantém a imagem. </li><li>  <code>ENV</code> - define variáveis ​​de ambiente persistentes. </li><li>  <code>RUN</code> - executa um comando e cria uma camada de imagem.  Usado para instalar pacotes em um contêiner. </li><li>  <code>COPY</code> - copia arquivos e pastas para o contêiner. </li><li>  <code>ADD</code> - copia arquivos e pastas para um contêiner, pode descompactar arquivos .tar locais. </li><li>  <code>CMD</code> - descreve um comando com argumentos que precisam ser executados quando o contêiner é iniciado.  Os argumentos podem ser substituídos quando o contêiner é iniciado.  Um arquivo pode conter apenas uma instrução <code>CMD</code> . </li><li>  <code>WORKDIR</code> - define o diretório de trabalho para a próxima instrução. </li><li>  <code>ARG</code> - define variáveis ​​para passar o Docker durante a criação da imagem. </li><li>  <code>ENTRYPOINT</code> - fornece um comando com argumentos para chamar durante a execução do contêiner.  Argumentos não são substituídos. </li><li>  <code>EXPOSE</code> - indica a necessidade de abrir a porta. </li><li>  <code>VOLUME</code> - cria um ponto de montagem para trabalhar com armazenamento persistente. </li></ol><br>  Agora vamos falar sobre essas instruções. <br><br><h2>  <font color="#3AC1EF">Instruções e exemplos de uso</font> </h2><br><h3>  <font color="#3AC1EF">▍Dockerfile simples</font> </h3><br>  O Dockerfile pode ser extremamente simples e curto.  Por exemplo - assim: <br><br><pre> <code class="plaintext hljs">FROM ubuntu:18.04</code> </pre> <br><h3>  <font color="#3AC1EF">RomDe instruções</font> </h3><br>  O Dockerfile deve começar com uma instrução <code>FROM</code> ou com uma instrução <code>ARG</code> seguida por uma instrução <code>FROM</code> . <br><br>  A palavra-chave <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">FROM</a> diz ao Docker para usar uma imagem base que corresponda ao nome e à tag fornecidos ao criar a imagem.  Além disso, a imagem básica também é chamada de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">imagem pai</a> . <br><br>  Neste exemplo, a imagem base é armazenada no repositório do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ubuntu</a> .  Ubuntu é o nome do repositório oficial do Docker, que fornece a versão base da popular família de sistemas operacionais Linux chamada Ubuntu. <br><br>  Observe que o Dockerfile em questão inclui uma marca <code>18.04</code> que especifica qual imagem base precisamos.  É essa imagem que será carregada ao criar nossa imagem.  Se a tag não estiver incluída na instrução, o Docker continuará assumindo que a imagem mais recente do repositório é necessária.  Para expressar mais claramente suas intenções, é recomendável que o autor do Dockerfile indique qual imagem ele precisa. <br><br>  Quando o Dockerfile acima é usado na máquina local para criar a imagem pela primeira vez, o Docker carrega as camadas definidas pela imagem do <code>ubuntu</code> .  Eles podem ser imaginados sobrepostos um ao outro.  Cada camada seguinte é um arquivo que descreve as diferenças da imagem em comparação com o estado em que estava após adicionar a camada anterior. <br><br>  Quando você cria um contêiner, uma camada na qual você pode fazer alterações é adicionada sobre todas as outras camadas.  Os dados nas camadas restantes só podem ser lidos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/912/530/d4f/912530d4f3468f0bff2a064d58d62caf.jpg"></div><br>  <i><font color="#999999">Estrutura de contêiner (retirada da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentação</a> )</font></i> <br><br>  O Docker, por uma questão de eficiência, usa uma estratégia de copiar na gravação.  Se a camada da imagem existir no nível anterior e alguma camada precisar ler dados dela, o Docker usará o arquivo existente.  Você não precisa baixar nada. <br><br>  Quando a imagem é executada, se a camada precisar ser modificada por meio do contêiner, o arquivo correspondente será copiado para a camada superior mutável.  Para saber mais sobre a estratégia de copiar na gravação, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este</a> material na documentação do Docker. <br><br>  Continuamos a discussão das instruções usadas no Dockerfile, fornecendo um exemplo de um arquivo com uma estrutura mais complexa. <br><br><h3>  <font color="#3AC1EF">Arquivo docker mais sofisticado</font> </h3><br>  Embora o arquivo Docker que acabamos de revisar tenha sido limpo e compreensível, é muito simples, ele usa apenas uma instrução.  Além disso, não há instruções chamadas durante a execução do contêiner.  Dê uma olhada em outro arquivo que coleta uma imagem pequena.  Possui mecanismos que determinam os comandos que são chamados durante a execução do contêiner. <br><br><pre> <code class="plaintext hljs">FROM python:3.7.2-alpine3.8 LABEL maintainer="jeffmshale@gmail.com" ENV ADMIN="jeff" RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash COPY . ./app ADD https://raw.githubusercontent.com/discdiver/pachy-vid/master/sample_vids/vid1.mp4 \ /my_app_directory RUN ["mkdir", "/a_directory"] CMD ["python", "./my_script.py"]</code> </pre> <br>  Talvez, à primeira vista, esse arquivo possa parecer bastante complicado.  Portanto, vamos lidar com ele. <br><br>  A base desta imagem é a imagem oficial do Python com a tag 3.7.2-alpine3.8.  Após analisar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esse</a> código, você pode ver que essa imagem básica inclui Linux, Python e, em geral, isso é limitado à sua composição.  As imagens do sistema operacional Alpine são muito populares no mundo do Docker.  O fato de serem pequenos em tamanho, alta velocidade e segurança.  No entanto, as imagens alpinas não diferem nos amplos recursos típicos dos sistemas operacionais convencionais.  Portanto, para coletar algo útil com base nessa imagem, o criador da imagem precisa instalar os pacotes de que precisa. <br><br><h3>  <font color="#3AC1EF">▍Instrução LABEL</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/839/d5d/720/839d5d7205849f8dee228dcd7a42eaf7.jpg"></div><br>  <i><font color="#999999">Tags</font></i> <br><br>  A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instrução LABEL</a> (etiqueta) permite adicionar metadados à imagem.  No caso do arquivo em consideração agora, ele inclui as informações de contato do criador da imagem.  Declarar etiquetas não atrasa o processo de montagem da imagem nem aumenta seu tamanho.  Eles contêm apenas informações úteis sobre a imagem do Docker, portanto, é recomendável que eles sejam incluídos no arquivo.  Detalhes sobre como trabalhar com metadados no Dockerfile podem ser encontrados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><h3>  <font color="#3AC1EF">InstructionInv instrução</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d85/1a1/4d7/d851a14d7b7f4db671afe3b375cb4596.jpg"></div><br>  <i><font color="#999999">Meio ambiente</font></i> <br><br>  A instrução <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ENV</a> permite definir variáveis ​​de ambiente constantes que estarão disponíveis no contêiner durante sua execução.  No exemplo anterior, depois de criar o contêiner, você pode usar a variável <code>ADMIN</code> . <br><br>  A instrução <code>ENV</code> é adequada para definir constantes.  Se você usar um determinado valor no Dockerfile várias vezes, por exemplo, ao descrever os comandos que são executados no contêiner, e suspeitar que algum dia precise alterá-lo para outro, faz sentido escrevê-lo em uma constante semelhante. <br><br>  Note-se que nos arquivos do Dockerfile geralmente existem maneiras diferentes de resolver os mesmos problemas.  O que exatamente usar é uma pergunta cuja decisão é influenciada pelo desejo de cumprir os métodos de trabalho adotados no ambiente do Docker, para garantir a transparência da solução e seu alto desempenho.  Por exemplo, as <code>ENTRYPOINT</code> <code>RUN</code> , <code>CMD</code> e <code>ENTRYPOINT</code> servem a propósitos diferentes, mas todas são usadas para executar comandos. <br><br><h3>  <font color="#3AC1EF">Instrução UNRUN</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/910/a89/72b/910a8972b92a69418d859a1fbd550ae5.jpg"></div><br>  <i><font color="#999999">Instrução RUN</font></i> <br><br>  A instrução <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RUN</a> permite criar uma camada durante a criação da imagem.  Após sua execução, uma nova camada é adicionada à imagem, seu estado é fixo.  A instrução <code>RUN</code> é frequentemente usada para instalar pacotes adicionais em imagens.  No exemplo anterior, a instrução <code>RUN apk update &amp;&amp; apk upgrade</code> informa ao Docker que o sistema precisa atualizar pacotes a partir da imagem base.  Após esses dois comandos, está o comando <code>&amp;&amp; apk add bash</code> , indicando que o bash precisa ser instalado na imagem. <br><br>  O que parece ser <code>apk</code> em equipes é uma abreviação de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Alpine Linux package manager</a> .  Se você estiver usando a imagem base de outro sistema operacional da família Linux, por exemplo, ao usar o Ubuntu, pode ser necessário um comando no formato <code>RUN apt-get</code> para instalar pacotes.  Mais tarde, falaremos sobre outras maneiras de instalar pacotes. <br><br>  A instrução <code>RUN</code> e instruções semelhantes, como <code>CMD</code> e <code>ENTRYPOINT</code> , podem ser usadas no formato exec ou no formato shell.  O formulário exec usa uma sintaxe semelhante à descrição de uma matriz JSON.  Por exemplo, pode ser assim: <code>RUN ["my_executable", "my_first_param1", "my_second_param2"]</code> . <br><br>  No exemplo anterior, usamos a forma de shell da instrução RUN da seguinte maneira: <code>RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash</code> . <br><br>  Posteriormente em nosso Dockerfile, usamos a forma exec da instrução <code>RUN</code> , na forma de <code>RUN ["mkdir", "/a_directory"]</code> para criar um diretório.  Ao mesmo tempo, usando as instruções neste formulário, é necessário lembrar a necessidade de formatar cadeias de caracteres com aspas duplas, como é habitual no formato JSON. <br><br><h3>  <font color="#3AC1EF">▍Instrução CÓPIA</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ba/8b7/b82/5ba8b7b82e09854f7ba3ac1d2ad5b404.jpg"></div><br>  <i><font color="#999999">Instrução COPY</font></i> <br><br>  A instrução <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">COPY</a> é apresentada em nosso arquivo assim: <code>COPY . ./app</code>  <code>COPY . ./app</code> .  Ela diz ao Docker que precisa pegar arquivos e pastas do contexto local da montagem e adicioná-los ao diretório de trabalho atual da imagem.  Se o diretório de destino não existir, esta instrução o criará. <br><br><h3>  <font color="#3AC1EF">▍Instrução ADICIONAR</font> </h3><br>  A instrução <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ADD</a> permite resolver os mesmos problemas que <code>COPY</code> , mas mais alguns <code>COPY</code> uso estão associados a ela.  Portanto, usando esta instrução, você pode adicionar arquivos baixados de fontes remotas ao contêiner, além de descompactar arquivos .tar locais. <br><br>  Neste exemplo, a instrução <code>ADD</code> foi usada para copiar um arquivo acessível por URL para o <code>my_app_directory</code> contêiner <code>my_app_directory</code> .  Note-se, no entanto, que a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentação</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Docker</a> não recomenda o uso desses arquivos obtidos pela URL, pois eles não podem ser excluídos e aumentam o tamanho da imagem. <br><br>  Além disso, a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentação</a> sugere, sempre que possível, que você use a instrução <code>COPY</code> vez da instrução <code>ADD</code> para facilitar a compreensão do Dockerfile.  Acredito que a equipe de desenvolvimento do Docker deve combinar <code>ADD</code> e <code>COPY</code> em uma instrução para que aqueles que criam as imagens não precisem se lembrar de muitas instruções. <br><br>  Observe que a instrução <code>ADD</code> contém o caractere de quebra de linha - <code>\</code> .  Esses caracteres são usados ​​para melhorar a legibilidade de comandos longos, dividindo-os em várias linhas. <br><br><h3>  <font color="#3AC1EF">Instruction instrução CMD</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/505/835/d13/505835d13cd3c9300f0d95681b3dbf93.jpg"></div><br>  <i><font color="#999999">Instrução CMD</font></i> <br><br>  A instrução <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CMD</a> fornece ao Docker um comando para executar quando o contêiner for iniciado.  Os resultados deste comando não são adicionados à imagem durante sua montagem.  Em nosso exemplo, este comando inicia o script <code>my_script.py</code> em tempo de execução. <br><br>  Aqui está outra coisa que você precisa saber sobre a instrução <code>CMD</code> : <br><br><ul><li>  Somente uma instrução <code>CMD</code> pode estar presente em um Dockerfile.  Se houver várias instruções no arquivo, o sistema ignorará tudo, exceto a última. </li><li>  Uma instrução <code>CMD</code> pode ter um formulário exec.  Se a instrução não incluir a referência ao arquivo executável, a instrução <code>ENTRYPOINT</code> deverá estar presente no arquivo.  Nesse caso, essas duas instruções devem estar no <code>JSON</code> . </li><li>  Os argumentos da linha de comando transmitidos para a <code>docker run</code> substituem os argumentos fornecidos pela instrução <code>CMD</code> no Dockerfile. </li></ul><br><h3>  <font color="#3AC1EF">DUm Dockerfile ainda mais complexo</font> </h3><br>  Considere outro Dockerfile, no qual alguns novos comandos serão usados. <br><br><pre> <code class="plaintext hljs">FROM python:3.7.2-alpine3.8 LABEL maintainer="jeffmshale@gmail.com" #   RUN apk add --update git #     WORKDIR /usr/src/my_app_directory #          COPY . . #       ARG my_var=my_default_value #  ,           ENTRYPOINT ["python", "./app/my_script.py", "my_var"] #   EXPOSE 8000 #      VOLUME /my_volume</code> </pre> <br>  Neste exemplo, entre outras coisas, você pode ver comentários que começam com o caractere <code>#</code> . <br>  Uma das principais coisas que o Dockerfile faz é instalar pacotes.  Como já mencionado, existem várias maneiras de instalar pacotes usando a instrução <code>RUN</code> . <br><br>  Os pacotes na imagem do Alpine Docker podem ser instalados usando o <code>apk</code> .  Para isso, como já dissemos, <code>RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash</code> um comando do formulário <code>RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash</code> . <br><br>  Além disso, os pacotes Python na imagem podem ser instalados usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pip</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wheel</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conda</a> .  Se não estamos falando sobre Python, mas sobre outras linguagens de programação, outros gerenciadores de pacotes podem ser usados ​​para preparar as imagens correspondentes. <br><br>  Ao mesmo tempo, para que a instalação seja possível, a camada subjacente deve fornecer ao gerenciador de pacotes um gerenciador de pacotes adequado.  Portanto, se você encontrar problemas para instalar pacotes, verifique se o gerenciador de pacotes está instalado antes de tentar usá-lo. <br><br>  Por exemplo, você pode usar a instrução <code>RUN</code> em um Dockerfile para instalar uma lista de pacotes usando o <code>pip</code> .  Se você fizer isso, combine todos os comandos em uma instrução e separe-os com caracteres de quebra de linha usando o caractere <code>\</code> .  Graças a essa abordagem, os arquivos ficarão bem arrumados e isso levará à adição de menos camadas à imagem do que seria adicionado usando várias instruções <code>RUN</code> . <br><br>  Além disso, você pode fazer coisas diferentes para instalar vários pacotes.  Você pode listá-los em um arquivo e transferi-lo para o gerenciador de pacotes usando <code>RUN</code> .  Normalmente, esses arquivos são chamados <code>requirements.txt</code> . <br><br><h3>  <font color="#3AC1EF">▍ Instrução WORDDIR</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/528/9ef/88f/5289ef88f3bc5fc7e4856fdc13d9872e.jpg"></div><br>  <i><font color="#999999">Diretórios de trabalho</font></i> <br><br>  A instrução <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">WORKDIR</a> permite alterar o diretório de trabalho do contêiner.  As <code>ENTRYPOINT</code> <code>COPY</code> , <code>ADD</code> , <code>RUN</code> , <code>CMD</code> e <code>ENTRYPOINT</code> que seguem <code>WORKDIR</code> funcionam com este diretório.  Aqui estão alguns recursos relacionados a esta instrução: <br><br><ul><li>  É melhor definir caminhos absolutos para pastas com <code>WORKDIR</code> vez de navegar no sistema de arquivos usando os comandos <code>cd</code> no Dockerfile. </li><li>  A instrução <code>WORKDIR</code> cria automaticamente um diretório se ele não existir. </li><li>  Você pode usar várias instruções do <code>WORKDIR</code> .  Se forem fornecidas instruções relativas a essas instruções, cada uma delas mudará o diretório de trabalho atual. </li></ul><br><h3>  <font color="#3AC1EF">▍Guia ARG</font> </h3><br>  A instrução <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ARG</a> permite definir uma variável cujo valor pode ser passado da linha de comando para a imagem durante sua montagem.  O valor da variável padrão pode ser representado no Dockerfile.  Por exemplo: <code>ARG my_var=my_default_value</code> . <br><br>  Diferente das variáveis <code>ENV</code> , as variáveis <code>ARG</code> não estão disponíveis no tempo de execução.  No entanto, as variáveis <code>ARG</code> podem ser usadas para definir valores padrão para variáveis <code>ENV</code> na linha de comando durante a criação da imagem.  E as variáveis <code>ENV</code> já estarão disponíveis no contêiner durante sua execução.  Detalhes sobre essa técnica de trabalhar com variáveis ​​podem ser encontrados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><h3>  <font color="#3AC1EF">▍Instrução ENTRYPOINT</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2f/8b8/e95/c2f8b8e95436c097571b44810ac97a7a.jpg"></div><br>  <i><font color="#999999">Ponto de transição para algum lugar</font></i> <br><br>  A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instrução ENTRYPOINT</a> permite especificar um comando com argumentos que devem ser executados quando o contêiner for iniciado.  É semelhante ao comando <code>CMD</code> , mas os parâmetros especificados em <code>ENTRYPOINT</code> não serão substituídos se o contêiner for iniciado com parâmetros de linha de comando. <br><br>  Em vez disso, os argumentos da linha de comando passados ​​nas construções da <code>docker run my_image_name</code> formulário <code>docker run my_image_name</code> são adicionados aos argumentos especificados pela <code>ENTRYPOINT</code> .  Por exemplo, depois de executar um comando da <code>docker run my_image bash</code> formulários e <code>docker run my_image bash</code> argumento <code>docker run my_image bash</code> será adicionado ao final da lista de argumentos especificados por <code>ENTRYPOINT</code> .  Ao preparar o Dockerfile, não esqueça as <code>ENTRYPOINT</code> <code>CMD</code> ou <code>ENTRYPOINT</code> . <br><br>  Existem várias recomendações na documentação do Docker sobre quais instruções, <code>CMD</code> ou <code>ENTRYPOINT</code> , devem ser escolhidas como uma ferramenta para executar comandos quando o contêiner é iniciado: <br><br><ul><li>  Se você precisar executar o mesmo comando sempre que iniciar o contêiner, use <code>ENTRYPOINT</code> . </li><li>  Se o contêiner for usado como um aplicativo, use <code>ENTRYPOINT</code> . </li><li>  Se você souber que, ao iniciar o contêiner, precisará passar argumentos que possam substituir os argumentos especificados no Dockerfile, use o <code>CMD</code> . </li></ul><br>  Em nosso exemplo, o uso da instrução <code>ENTRYPOINT ["python", "my_script.py", "my_var"]</code> faz com que o contêiner, quando iniciado, execute o script Python <code>my_script.py</code> com o argumento <code>my_var</code> .  O valor representado por <code>my_var</code> pode ser usado no script usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">argparse</a> .    ,   Dockerfile  <code>my_var</code> ,   ,       <code>ARG</code> .  ,         ,     . <br><br>  Docker   exec- <code>ENTRYPOINT</code> : <code>ENTRYPOINT ["executable", "param1", "param2"]</code> . <br><br><h3> <font color="#3AC1EF">▍ EXPOSE</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee1/cca/45e/ee1cca45e3fd7e9be988556536fb1633.jpg"></div><br> <i><font color="#999999"> EXPOSE</font></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">EXPOSE</a>   ,      ,          .     . , ,     ,   ,   ,  ,   . <br><br>      ( )    ,    <code>docker run</code>   <code>-p</code> .      <code>-P</code> (   <code>P</code> ),     ,    <code>EXPOSE</code> . <br><br><h3> <font color="#3AC1EF">▍ VOLUME</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c1/ff6/a57/7c1ff6a5765f28cbd3d68cbf60d6b4aa.jpg"></div><br> <i><font color="#999999"> VOLUME</font></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">VOLUME</a>   ,              .     . <br><br><h2>  <font color="#3AC1EF">Sumário</font> </h2><br>     ,       Dockerfile.      .  ,      ,  <code>USER</code> , <code>ONBUILD</code> , <code>STOPSIGNAL</code> , <code>SHELL</code>  <code>HEALTHCHECK</code> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>     Dockerfile. <br><br> ,  Dockerfile —     Docker,      ,        .          ,       . <br><br>  <b>Caros leitores!</b>    Docker  ,    ,    Docker-. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt439980/">https://habr.com/ru/post/pt439980/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt439970/index.html">Relatório sobre problemas e acessibilidade da Internet em 2018-2019</a></li>
<li><a href="../pt439972/index.html">io_submit: uma alternativa ao epoll de que você nunca ouviu falar</a></li>
<li><a href="../pt439974/index.html">Transformação ágil pessoal: uma jornada flexível para a produtividade</a></li>
<li><a href="../pt439976/index.html">O Node.js sempre será mais lento que o Golang?</a></li>
<li><a href="../pt439978/index.html">Docker de aprendizagem, parte 2: termos e conceitos</a></li>
<li><a href="../pt439982/index.html">Tutorial Reagir, Parte 16: A quarta fase do trabalho em um aplicativo TODO, processamento de eventos</a></li>
<li><a href="../pt439984/index.html">Tutorial Reagir, parte 17: O quinto estágio do trabalho em um aplicativo TODO, modificando o estado do componente</a></li>
<li><a href="../pt439986/index.html">Chips contra ameaças à tecnologia de contêiner</a></li>
<li><a href="../pt439988/index.html">Tecnosfera cinco anos</a></li>
<li><a href="../pt439990/index.html">O livro “Pragmatic AI. Aprendizado de máquina e tecnologia em nuvem</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>