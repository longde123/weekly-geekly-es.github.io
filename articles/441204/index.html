<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå† üö∑ üë®‚Äçüç≥ Un enfoque avanzado para detectar l√≠mites utilizando paredes de vasos como ejemplo üçá üî£ ü§ûüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Informacion interesante 
 La siguiente figura muestra una reconstrucci√≥n tridimensional del coraz√≥n, obtenida como resultado del trabajo de un tom√≥gra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un enfoque avanzado para detectar l√≠mites utilizando paredes de vasos como ejemplo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/inobitec/blog/441204/"><h2>  Informacion interesante </h2><br>  La siguiente figura muestra una reconstrucci√≥n tridimensional del coraz√≥n, obtenida como resultado del trabajo de un tom√≥grafo moderno: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uy/7v/fc/uy7vfcx7nzqfq_kqcnmu7xhzipq.png"></div><br>  Para la escala, el grosor del bulbo a√≥rtico es de 3.2 cm, ¬°solo piense!  Sin embargo, cuando las personas tienen problemas card√≠acos debido a los vasos sangu√≠neos, por lo general, no estamos hablando de problemas tan grandes.  La imagen muestra que el coraz√≥n est√° rodeado de vasos m√°s peque√±os, y algunos de ellos se ramifican directamente desde las arterias grandes.  Estas son las llamadas arterias coronarias que alimentan el coraz√≥n directamente con sangre.  Si se produce un estrechamiento de la luz (estenosis) en ellos, por ejemplo, debido a la formaci√≥n de calcio, entonces el flujo sangu√≠neo disminuye.  Cuando se pronuncia la estenosis, se produce necrosis tisular, en otras palabras, un ataque card√≠aco.  A continuaci√≥n, hablar√© sobre nuestro enfoque para calcular los l√≠mites de los vasos sangu√≠neos, que como resultado le permite encontrar autom√°ticamente el estrechamiento y darles una estimaci√≥n. <br><a name="habracut"></a><br>  Para comprender el material, debe tener una comprensi√≥n superficial del volumen, los v√≥xeles y sus intensidades.  Puede averiguarlo leyendo el comienzo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este art√≠culo</a> . <br><br>  Para evaluar el estrechamiento de un vaso, necesitamos conocer la luz del vaso o su borde interno.  Para hacer esto, al menos detecta todo el calcio.  Tambi√©n encontramos el l√≠mite exterior, porque permite estimar el grosor de la pared, lo que tambi√©n es √∫til.  Para comenzar, echemos un vistazo al esquema completo de detecci√≥n de l√≠mites, y luego analizaremos cada etapa en detalle: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/cw/va/blcwvavrk6rpr7dncjp0ydgtxfo.png"></div><br><h2>  Trazando la l√≠nea central </h2><br>  La etapa m√°s dif√≠cil en t√©rminos de implementaci√≥n (al menos tom√≥ m√°s tiempo).  El m√©todo se basa en el uso de una matriz de Hesse (Segmentaci√≥n de embarcaciones de m√∫ltiples escalas utilizando la mejora de la matriz de Hesse).  M√°s detalles en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> ya mencionado. <br><br><h2>  Rebanar </h2><br>  Tenemos solo una l√≠nea central y necesitamos intensidades de voxels espacialmente dependientes con las que se pueda trabajar convenientemente.  Para conseguirlos, se va una "pila" de rebanadas.  Para empezar, los puntos se establecen en distancias fijas en la l√≠nea central.  Luego se construye una perpendicular a partir de cada punto <img src="https://habrastorage.org/getpro/habr/post_images/629/d90/498/629d904983c27d11c1874e959481ac0e.svg">  .  Despu√©s es la segunda perpendicular <img src="https://habrastorage.org/getpro/habr/post_images/c49/6e6/18d/c496e618db88f915ed3d3fe3e8ffebf5.svg">  .  Donde <img src="https://habrastorage.org/getpro/habr/post_images/715/6f4/21f/7156f421f73f84d8f74072c47d8feb40.svg">  - la direcci√≥n de la l√≠nea central en un punto.  Ambas perpendiculares est√°n normalizadas.  En cada punto <img src="https://habrastorage.org/getpro/habr/post_images/d76/c4d/c2b/d76c4dc2b17f00a09c864bf2d24ab365.svg">  vector de l√≠nea central <img src="https://habrastorage.org/getpro/habr/post_images/ccc/5f9/fa9/ccc5f9fa9ba4fd68b9d82f5f64c964a5.svg">  Forme un sistema de coordenadas 2D.  Por lo tanto, se forman rodajas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1i/u3/fy/1iu3fy_dalyttcp8pm_5tbmvblu.png"></div><br>  La posici√≥n del v√≥xel se define como <img src="https://habrastorage.org/getpro/habr/post_images/61a/d30/8c1/61ad308c13008a755317c1e29b64d2c5.svg">  donde <img src="https://habrastorage.org/getpro/habr/post_images/038/a72/de3/038a72de3b3aa84f6df45501491024e0.svg">  aqui <img src="https://habrastorage.org/getpro/habr/post_images/c85/e97/693/c85e97693d356905ea98d6f6cbacc674.svg">  Son las coordenadas reales del v√≥xel, k es el n√∫mero de corte.  F√≥rmula inversa para coordenadas reales: <img src="https://habrastorage.org/getpro/habr/post_images/797/f2e/fae/797f2efaeb13453aa8d76293b288bd73.svg">  .  Al pasar a un nuevo sistema de coordenadas, el espacio formado por los cortes se simplifica: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pj/c3/cq/pjc3cqpbmjzhvsb2ioyumlgilam.png"></div><br>  Lo que necesitamos! <br><br><h2>  Construcci√≥n del borde exterior del buque. </h2><br>  Echemos un vistazo al diagrama: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gm/ii/i2/gmiii2tsk4iqtvaolp9y3fhvd9c.png"></div><br>  Cortamos nuestra pila de rebanadas obtenidas en la etapa anterior en ocho planos (similar a cortar un pastel) y realizamos todos los c√°lculos en el espacio de planos: <br><br><div class="spoiler">  <b class="spoiler_title">Cortar</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ov/jd/db/ovjddbzkgm-vdtrv6gcwzzuao1o.png"></div><br></div></div><br>  Si muestra los valores normalizados de las intensidades de los v√≥xeles que golpean el plano de corte, obtenemos la siguiente imagen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/nf/km/uenfkmqzel_cvnooctxzi9cl-3m.png"></div><br>  Para detectar los l√≠mites de la embarcaci√≥n, el enfoque cl√°sico (detecci√≥n de bordes por gradiente) se utiliza junto con la b√∫squeda de la ruta.  Esquema: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kw/tu/ox/kwtuox6hip2d3cu0t65wj_z4fqc.png"></div><br>  1. Aplicar suavizado gaussiano con un valor peque√±o <img src="https://habrastorage.org/getpro/habr/post_images/77c/f13/7bb/77cf137bb0d151fa8fc5a4eb4a7f21e0.svg">  para suprimir el ruido: <br>  Para un punto con coordenadas <img src="https://habrastorage.org/getpro/habr/post_images/733/058/d18/733058d18a17c8fcbb58bb5b1879082a.svg">  : <br><img src="https://habrastorage.org/getpro/habr/post_images/2a4/722/67f/2a472267fd4f70baed2798401c41edd6.svg">  donde <img src="https://habrastorage.org/getpro/habr/post_images/7ec/a6c/c6a/7eca6cc6aeb64ba5e76063f0019d9542.svg">  devuelve el valor de intensidad en un punto <img src="https://habrastorage.org/getpro/habr/post_images/65c/c1e/d7f/65cc1ed7f6ce98859b0f80176a24fc08.svg">  ;  r generalmente toma el valor <img src="https://habrastorage.org/getpro/habr/post_images/d02/f53/56b/d02f5356b7b9c5234d7c2975efd6a994.svg">  ( <img src="https://habrastorage.org/getpro/habr/post_images/1b6/903/f11/1b6903f1101a871ba3ba64fe1924f873.svg">  - redondeo); <img src="https://habrastorage.org/getpro/habr/post_images/77c/f13/7bb/77cf137bb0d151fa8fc5a4eb4a7f21e0.svg">  - coeficiente de suavizado. <br><br>  2. En cada punto encontramos el gradiente y su valor, los c√°lculos se llevan a cabo con valores de intensidad suavizados: <br><img src="https://habrastorage.org/getpro/habr/post_images/9d3/c90/939/9d3c9093937e8aff5520ded5071984ac.svg">  , <br>  donde <img src="https://habrastorage.org/getpro/habr/post_images/698/280/401/6982804016ef30ecdc8ac8fddeb72c4e.svg">  - derivados privados.  Se encuentran por el m√©todo de diferencia finita: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/791/209/8dc/7912098dc806f588c1458ad8b9faabdc.svg">  , <br>  donde <img src="https://habrastorage.org/getpro/habr/post_images/b20/94b/690/b2094b69077bfe82f7dca9f140480d0b.svg">  - intensidad en un punto <img src="https://habrastorage.org/getpro/habr/post_images/65c/c1e/d7f/65cc1ed7f6ce98859b0f80176a24fc08.svg">  Despu√©s de alisar. <br>  Luego necesitamos la direcci√≥n del gradiente <img src="https://habrastorage.org/getpro/habr/post_images/341/0a9/910/3410a9910584413131b3320a186f314b.svg">  ( <img src="https://habrastorage.org/getpro/habr/post_images/64b/66b/58e/64b66b58e46e62b07ecb6e7b86851d21.svg">  Es la normalizaci√≥n del vector) y el valor del gradiente. <img src="https://habrastorage.org/getpro/habr/post_images/e64/fb2/3c8/e64fb23c8f2225d8f538813e1fe4cbb3.svg">  ( <img src="https://habrastorage.org/getpro/habr/post_images/06d/0ad/537/06d0ad537ee5254e1af0392adeb5008d.svg">  Es la longitud del vector) <br><br>  3. La direcci√≥n del gradiente se traduce en grados o radianes: <br><img src="https://habrastorage.org/getpro/habr/post_images/89d/fd2/c8a/89dfd2c8ab531ad40fd223765fac9596.svg">  (atan2 () es la funci√≥n de la tangente del arco en C ++, que no debe confundirse con atan ()), luego redondeamos el √°ngulo para que pueda tener 4 valores en incrementos de 45 grados, es decir  arriba y abajo se consideran la misma direcci√≥n: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/t3/tq/jx/t3tqjxxfdgjsdqubxdputqzbh8w.jpeg"></div><br>  4. Realizar la supresi√≥n de no m√°ximos.  Si el valor del gradiente <img src="https://habrastorage.org/getpro/habr/post_images/e64/fb2/3c8/e64fb23c8f2225d8f538813e1fe4cbb3.svg">  al menos en uno de los dos puntos vecinos (de acuerdo con la direcci√≥n del gradiente) es mayor o igual que el valor del gradiente en el punto actual, entonces dicho punto no puede pertenecer al l√≠mite: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bf/0d/tf/bf0dtfvisx3vymgm2fjjpj7cbxe.png"></div><br>  5. Todos los v√≥xeles restantes se consideran l√≠mites.  Seg√∫n el valor del gradiente, el umbral de calcio (que no est√° disponible de inmediato) y la proximidad al centro "vertical", a cada punto se le asigna un costo determinado (cuanto m√°s brillante es el v√≥xel, mayor es su prioridad al buscar una ruta): <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ad/wn/ng/adwnng9jtvu5knuetwbngyhubq8.png"></div><br>  De esta forma, los l√≠mites de la embarcaci√≥n se definen de manera casi √∫nica. <br><br>  6, 7. Para construir l√≠mites, usamos la b√∫squeda del camino.  Los puntos extremos m√°s cercanos con el menor costo se toman como inicial y final.  Para buscar una ruta, utilice una b√∫squeda simple de amplitud, que selecciona los puntos l√≠mite de menor costo.  Los saltos tambi√©n est√°n disponibles, pero su precio es alto.  Los l√≠mites superior e inferior del recipiente se buscan por separado, y luego se les aplica el suavizado: <br><br><div class="spoiler">  <b class="spoiler_title">Resultado</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/t_/67/_u/t_67_u6vbtpbn5nthgj1uzfglle.png"></div><br></div></div><br>  Este procedimiento se realiza para cada plano, lo que da como resultado anillos de diecis√©is segmentos para cada corte en la pila.  Estos anillos forman los bordes exteriores del vaso. <br><br>  Como puede ver en la imagen, hay √°reas en las que los bordes se detectan incorrectamente.  Esto se debe a la presencia de calcio, que da como resultado la detecci√≥n de l√≠mites de calcio en lugar de l√≠mites de vasos.  Para evitar que esto suceda despu√©s de la primera detecci√≥n de l√≠mites, es necesario determinar el umbral de calcio (m√°s sobre esto m√°s adelante), y luego realizar una segunda detecci√≥n de l√≠mites, ignorando los v√≥xeles relacionados con el calcio.  Entonces obtenemos: <br><br><div class="spoiler">  <b class="spoiler_title">Buen resultado</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/7p/we/tz/7pwetz2lmrhzbikdhjpjmwsc7rw.png"></div><br><h2>  Detecci√≥n de umbrales de bordes internos, externos y umbral de calcio. </h2><br>  Una vez que se conoce el l√≠mite externo, necesitamos recopilar informaci√≥n estad√≠stica.  A saber, las intensidades de todos los v√≥xeles que est√°n dentro del recipiente. <br></div></div><br><h2>  Detecci√≥n de umbral </h2><br>  Ahora considere la maximizaci√≥n de la expectativa del algoritmo de agrupamiento (en lo sucesivo, EM).  Comencemos con la funci√≥n de distribuci√≥n normal: se caracteriza por una expectativa matem√°tica <img src="https://habrastorage.org/getpro/habr/post_images/849/a42/16c/849a4216c1bc55877bc86f4a97513f7a.svg">  y desviaci√≥n est√°ndar <img src="https://habrastorage.org/getpro/habr/post_images/77c/f13/7bb/77cf137bb0d151fa8fc5a4eb4a7f21e0.svg">  .  As√≠ es como afectan el tipo de distribuci√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1f/vg/gj/1fvggjfo2r_nz87bzdb3kngomri.gif"></div><br><br>  Supongamos que tenemos datos (puntos) que provienen de una fuente "amarilla" y de una fuente "azul": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rw/9q/er/rw9qern6glz7e696mx7k1sviuom.png"></div><br>  Luego, usando f√≥rmulas est√°ndar, encontramos f√°cilmente la media y la desviaci√≥n est√°ndar para cada fuente.  F√≥rmulas para la fuente "a": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c13/a5b/94d/c13a5b94d8d81bc4353b884bc8970aeb.svg"><br><img src="https://habrastorage.org/getpro/habr/post_images/154/906/8ae/1549068ae55c21dcb6e7efa2d3185f56.svg"><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4x/js/jx/4xjsjxajyvozdnueljew75whnyg.png"></div><br>  Pero, ¬øqu√© sucede si conocemos la cantidad de fuentes, pero no sabemos qu√© puntos pertenecen a qu√© fuente?  ¬øQu√© pasa si tenemos una imagen as√≠? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ei/cb/9a/eicb9atkan-akjv2zgp9rodyow0.png"></div><br>  Si alguien vino y nos dijo los par√°metros de distribuci√≥n, entonces podr√≠amos calcular f√°cilmente la probabilidad de que cada punto pertenezca a cada una de las fuentes.  La probabilidad de que el punto pertenezca a la fuente "a": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c24/2eb/8d9/c242eb8d94d7b7a7ad237c8509b54d65.svg">  donde <br><br><img src="https://habrastorage.org/getpro/habr/post_images/75c/129/b81/75c129b8112508e711b04727e48b05d3.svg"><br><img src="https://habrastorage.org/getpro/habr/post_images/7b0/a47/b22/7b0a47b2227447f62daaf67a8fc519b0.svg"><br><br>  Y si necesitamos calcular los par√°metros de origen, conociendo las probabilidades: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb6/eee/7f9/cb6eee7f9578ca134c470c445f69bdd6.svg"><br><img src="https://habrastorage.org/getpro/habr/post_images/bf3/2e7/ed5/bf32e7ed508e6dcd536ee3fe6ab63f32.svg"><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ws/ok/gf/wsokgf4bevva43d9cxzhktmzzws.png"></div>  Por lo tanto, se obtiene un c√≠rculo vicioso: si supi√©ramos los par√°metros de las fuentes, calcular√≠amos qu√© punto pertenece a qu√© fuente, pero no conocemos los par√°metros.  Y si supi√©ramos qu√© punto pertenece a qu√© fuente, calcular√≠amos sus par√°metros, pero no sabemos qu√© punto pertenece a qu√© fuente.  El equilibrio entre estos hechos es exactamente lo que hace el algoritmo EM. <br><br>  Al inicio, EM recibe algunos par√°metros predefinidos para las fuentes, que simplemente se pueden seleccionar al azar.  Obviamente, si los par√°metros son conocidos, entonces podemos calcular la probabilidad de que cada punto pertenezca a cada una de las fuentes.  Ahora que se conocen las probabilidades, podemos calcular nuevos par√°metros m√°s precisos.  Luego comienza de nuevo, pero con nuevos par√°metros.  Despu√©s de cada ciclo, los par√°metros de las fuentes son cada vez m√°s precisos. <br><br>  ¬øC√≥mo podemos usar este conocimiento en relaci√≥n con los vasos?  Echemos un vistazo a la estructura de uno de ellos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/il/st/gqilstduy1jpu4f_e7wiu0hns2g.png"></div>  En los diagramas, este punto generalmente se omite, pero las formaciones de grasa y calcio tambi√©n pueden estar presentes en el vaso.  Por lo tanto, cada v√≥xel pertenecer√° a uno de los tejidos.  Despu√©s de los experimentos result√≥ que es suficiente hacer las siguientes divisiones: <br><br>  - gordo <br>  - pared # 1 <br>  - pared # 2 <br>  - medio de contraste <br>  - calcio <br><br>  La distribuci√≥n de las intensidades de v√≥xel en cada caso es normal.  Es decir  Tenemos todo lo que necesitamos para usar EM para encontrar los par√°metros de cada fuente. <br><br><div class="spoiler">  <b class="spoiler_title">Los resultados son lo suficientemente buenos</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/f3/ht/_o/f3ht_obxm187_gnzmu8aue4sbbg.png"></div><br>  La l√≠nea verde es un histograma de intensidades, la l√≠nea roja es el modelo matem√°tico resultante. <br></div></div><br>  Ahora que conocemos los par√°metros de cada fuente, podemos calcular los umbrales: los valores de las intensidades, en cuya intersecci√≥n, la membres√≠a de v√≥xel cambia de una fuente a otra.  Estamos interesados ‚Äã‚Äãen: <br><br>  1. El umbral del l√≠mite exterior de la embarcaci√≥n.  Si la intensidad del v√≥xel est√° por debajo de este valor, se considera que no pertenece al vaso en absoluto; <br><br>  2. El umbral del l√≠mite interior de la embarcaci√≥n.  Si la intensidad del v√≥xel es mayor que este valor, entonces <br>  se refiere a la luz del vaso, es decir  a una mezcla de sangre y medio de contraste; <br><br>  3. El umbral de calcio.  Si el valor de la intensidad del v√≥xel es mayor que este valor, se refiere al calcio. <br><br><h2>  Construcci√≥n del borde interior de la embarcaci√≥n. </h2><br>  Como siempre, comencemos con el diagrama; los c√°lculos se realizan para cada segmento. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8a/-m/9v/8a-m9vgz6e1vywymf8xsnckgm4m.png"></div><br><br>  Si visualiza los datos de acuerdo con los umbrales obtenidos en el paso anterior, obtenemos la siguiente imagen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gi/qr/uf/giqrufs9lrd7j1rup_-8ckjkpww.png"></div><br><br>  El color rojo es la pared del recipiente.  Color verde - aclaramiento.  El blanco es calcio. <br><br>  Lo primero que llama la atenci√≥n es el calcio "colgado", que no est√° junto a ninguna de las paredes.  Esto se considera normal y surge debido al suavizado aplicado por el tom√≥grafo en s√≠. <br><br>  Primero necesita obtener los l√≠mites de acuerdo con los umbrales, y para esto se utiliza el algoritmo de cuadrados de marcha.  Se puede decir, pasa en dos etapas.  Primero, el √°rea se divide por una cuadr√≠cula discreta, y los cuadrados en los que los valores de intensidad son mayores o iguales al umbral se consideran "positivos", el resto se considera "negativo". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3q/4f/rq/3q4frqwpj7hnj5nu-mu2fintttq.png"></div>  Cada vez estaremos en alg√∫n tipo de nodo, y necesitamos dibujar un contorno alrededor de los cuadrados "positivos".  Para tomar una decisi√≥n, consideraremos los signos de cuatro cuadrados vecinos: superior izquierdo, inferior izquierdo, superior derecho, inferior derecho.  Excluyendo la simetr√≠a, estamos interesados ‚Äã‚Äãen tres casos. <br><br>  1. Tres cuadrados de un signo y uno opuesto, el movimiento del contorno se produce en diagonal: <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j7/si/y_/j7siy_5nyv_vu-zjkt6lrxwtgwi.png"><br></div></div><br>  2. Dos cuadrados del mismo signo y dos opuestos, y los cuadrados con el mismo signo est√°n en un lado, el movimiento del contorno es vertical u horizontal: <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ky/4u/0c/ky4u0chgxifkj8cbmysyygdmcwg.png"><br></div></div><br>  3. Dos cuadrados del mismo signo y dos cuadrados opuestos con los mismos signos se colocan en lados opuestos: <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ak/jc/fn/akjcfnqk3ekjhnynsk8gaqlpgu0.png"><br></div></div><br>  Este es un caso excepcional, para tomar una decisi√≥n, se toma el valor promedio de intensidad en los cuatro cuadrados, y si es mayor o igual al umbral, entonces el centro es positivo, en otros casos es negativo.  Tambi√©n es importante qu√© nodo es actual en este momento: <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8r/qd/5m/8rqd5mrjzqmdivmw_dpyxpqbkbu.png"><img src="https://habrastorage.org/webt/tp/uf/y9/tpufy92j4dfe3vtindh4blsi-su.png"><br></div></div><br>  El algoritmo de cuadrados de marcha construye con precisi√≥n y sin ambig√ºedades un contorno.  En el siguiente ejemplo, mov√≠ deliberadamente la l√≠nea desde el centro del costado para que cada paso fuera claramente visible. <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gg/41/ld/gg41ldwyplhod11zpgqblopf7ho.png"></div>  Espec√≠ficamente, el primer y el segundo caso: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fa/wq/oy/fawqoy8amtn9paiodwj6jowzql8.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ra/1l/md/ra1lmdd4wobzgjt9tgyp7rzxznc.png"></div><br></div></div><br>  Para cada secci√≥n del recipiente, encontramos dos contornos principales: este es el contorno del borde exterior y el contorno del borde interior.  Inmediatamente "cortamos" el contorno exterior con nuestro otro contorno exterior, que encontramos al comienzo del art√≠culo al encontrar caminos.  Esto se hace para ignorar las ramas de la embarcaci√≥n.  Ignoramos los contornos de calcio que est√°n demasiado lejos de la pared interna, como si no existieran en absoluto, encontramos el resto y los usamos en el futuro.  Si el centro del vaso est√° dentro del calcio, entonces lo cambiamos en la direcci√≥n m√°s cercana al circuito de calcio hasta que el centro est√© en la luz (en la regi√≥n verde).  Tal centro actualizado, llamar√© la posici√≥n inicial. <br><br>  Seg√∫n el esquema, puede haber dos casos: simple y complejo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ac/qq/1c/acqq1c5bc1mqei30gplmu2z2gok.png"></div><br>  Si la posici√≥n inicial es dentro de un circuito cerrado de calcio (por ejemplo, si se instala un stent), entonces igualamos inmediatamente el borde interno de este circuito.  Las cosas son m√°s complicadas cuando el centro est√° fuera del calcio.  En este caso, necesitamos expandir el circuito de arranque para que fluya suavemente alrededor del calcio y el borde interno: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mz/ds/5w/mzds5whlkw7e3tffnl5crfvd-vk.gif"></div><br>  Para lograr el resultado deseado, se desarroll√≥ un algoritmo especial basado en ideas utilizadas en motores f√≠sicos 2D, en particular la resoluci√≥n de colisiones de pol√≠gonos y el teorema de ejes separados. <br><br>  Dos conceptos b√°sicos que no se pueden prescindir: para intersectar pol√≠gonos convexos, el vector mtv (vector de traducci√≥n m√≠nima) es el desplazamiento m√°s peque√±o de uno de los pol√≠gonos, despu√©s de lo cual se detiene la intersecci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ns/yh/_9/nsyh_9qufvxdkohpt_fsjejwdx8.png"></div>  Tambi√©n necesitamos los pol√≠gonos normales: en 2D son perpendiculares a las caras e indican "fuera": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/y3/fc/fi/y3fcfiywkig3dbgrxkhw9twh1gk.png"></div>  Para no hacer que el art√≠culo sea extenso, omitir√© el resto de los detalles con respecto a los motores f√≠sicos.  Lo √∫nico que noto es que durante cada iteraci√≥n, cada punto en el contorno acumula la influencia de las fuerzas sobre s√≠ mismo en forma de un vector, y al final de cada iteraci√≥n se desplaza por la longitud de este vector en su direcci√≥n.  Considere las fuerzas: <br><br>  1. Dos fuerzas act√∫an sobre cada v√©rtice del contorno inicial en la direcci√≥n de los v√©rtices vecinos, y las fuerzas son directamente proporcionales a la distancia a estos v√©rtices.  Esto hace que el contorno se contraiga y se esfuerce por mantener una forma redondeada; <br><br>  2. Si el v√©rtice del contorno lateral cay√≥ dentro del contorno inicial, entonces el desplazamiento proporcional al vector vt mtv del v√©rtice se aplica a la cara m√°s cercana del contorno inicial; <br><br>  3. Si la parte superior del contorno inicial est√° dentro del contorno lateral, entonces se aplica un desplazamiento proporcional al v√©rtice del vector mtv del v√©rtice a la parte superior del contorno inicial.  Esto, junto con el p√°rrafo anterior, no permite que el circuito vaya m√°s all√° de los l√≠mites de otros circuitos; <br><br>  4. Si los casos 2 y 3 no funcionaron para el v√©rtice, entonces se le aplica una fuerza en la direcci√≥n promedio de las dos normales de las caras adyacentes.  Esto asegura el crecimiento del contorno "en amplitud". <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lz/by/zx/lzbyzx2rujiluinvtom2jj6tana.png"></div>  Importante: no puede desplazar un v√©rtice o una cara completamente por la longitud del vector mtv; se multiplica por un cierto coeficiente en el rango de 0.2 a 0.8.  Los coeficientes para cada fuerza en los casos restantes se seleccionan experimentalmente. <br><br>  Gracias a este enfoque, encontramos la luz del vaso, teniendo en cuenta el hecho de que el calcio no se adhiere cerca de las paredes.  Ahora solo combine los resultados de todas las secciones y obtenga los bordes interno y externo del recipiente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gv/4z/z7/gv4zz7jnpkx4jdrb1ojm8xojcce.png"></div><br>  La aparente inexactitud del borde despu√©s del stent es causada por una bifurcaci√≥n an√≥mala: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ub/i-/cx/ubi-cxfe-hfuys8ufibs97o8xes.png"></div><br>  El √°rea del borde interior en el corte caracterizar√° el espacio libre que nos interesa en √∫ltima instancia.  Uso adicional de estos datos considero trivial y no requiere consideraci√≥n.  Finalmente, dejar√© la imagen del borde interno exportado en 3D: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bl/cv/g4/blcvg4klqzx9imn2qcgw6cizyay.png"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/441204/">https://habr.com/ru/post/441204/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../441192/index.html">Usando el poder de c√≥mputo de R para probar la hip√≥tesis de igualdad de medias</a></li>
<li><a href="../441194/index.html">Libro "GraphQL: lenguaje de consulta para aplicaciones web modernas"</a></li>
<li><a href="../441196/index.html">¬øSobre qui√©n y para qu√© mensajeros "tocar√°n"?</a></li>
<li><a href="../441198/index.html">Din√°mica espiral de Scrum y Graves: c√≥mo no toparse con los arrecifes</a></li>
<li><a href="../441202/index.html">¬øLas empresas de servicios sue√±an con sus productos? Conversaci√≥n con Maxilect</a></li>
<li><a href="../441206/index.html">Wolfensteiny 3D - ingenier√≠a inversa 251 bytes de JavaScript</a></li>
<li><a href="../441208/index.html">C√≥mo redujimos la emisi√≥n de pr√©stamos a 2 clics</a></li>
<li><a href="../441210/index.html">Cluster Storage Pacemaker + DRBD (Dual primario) + samba</a></li>
<li><a href="../441212/index.html">Trabaje con protecci√≥n de informaci√≥n criptogr√°fica y portadores de claves de hardware en Linux</a></li>
<li><a href="../441214/index.html">Gu√≠a del usuario de Kibana. Visualizaci√≥n. Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>