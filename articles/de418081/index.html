<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🏭 🤰🏼 🕐 Organisation sicherer Tests in der Produktion. Teil 1 🤦🏾 🗻 😽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel beschreibt verschiedene Arten von Tests in der Produktion und die Bedingungen, unter denen jede von ihnen am nützlichsten ist, und besc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Organisation sicherer Tests in der Produktion. Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/418081/"><img src="https://habrastorage.org/webt/0q/az/yt/0qazyteu8a-cel_dnpcbmyckzsk.jpeg"><br><br>  Dieser Artikel beschreibt verschiedene Arten von Tests in der Produktion und die Bedingungen, unter denen jede von ihnen am nützlichsten ist, und beschreibt auch, wie sichere Tests verschiedener Dienstleistungen in der Produktion organisiert werden. <a name="habracut"></a><br><br>  Es ist anzumerken, dass der Inhalt dieses Artikels nur für die <b>Dienste gilt</b> , deren Bereitstellung von den Entwicklern gesteuert wird.  Darüber hinaus sollten Sie sofort warnen, dass die Verwendung einer der hier beschriebenen Testarten keine leichte Aufgabe ist, die häufig schwerwiegende Änderungen am Design, der Entwicklung und dem Testen von Systemen erfordert.  Und trotz des Titels des Artikels denke ich nicht, dass eine der Arten von Tests in der Produktion absolut zuverlässig ist.  Es gibt nur eine Meinung, dass solche Tests das Risiko in Zukunft erheblich reduzieren können und die Investitionskosten gerechtfertigt sind. <br><br>  <i><b>(Hinweis: Da der Originalartikel Longrid ist, ist er der Einfachheit halber in zwei Teile unterteilt.)</b></i> <br><br><h2>  Warum sind Tests in der Produktion erforderlich, wenn sie in der Inszenierung durchgeführt werden können? </h2><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="974530841190608897"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Die Bedeutung des Staging-Clusters (oder der Staging-Umgebung) durch verschiedene Personen wird unterschiedlich wahrgenommen.  Für viele Unternehmen ist die Bereitstellung und das Testen eines Produkts in Staging ein wesentlicher Schritt vor seiner endgültigen Veröffentlichung. <br><br>  Viele bekannte Organisationen betrachten die Bereitstellung als Miniaturkopie der Arbeitsumgebung.  In solchen Fällen muss die maximale Synchronisation sichergestellt werden.  In diesem Fall ist es normalerweise erforderlich, den Betrieb verschiedener Instanzen von Stateful-Systemen wie Datenbanken sicherzustellen und Daten aus der Produktionsumgebung regelmäßig mit Staging zu synchronisieren.  Die Ausnahme bilden nur vertrauliche Informationen, mit denen Sie die Identität des Benutzers feststellen können (dies ist erforderlich, um die Anforderungen von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GDPR</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PCI</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HIPAA</a> und anderen Vorschriften zu erfüllen). <br><br>  Das Problem bei diesem Ansatz (meiner Erfahrung nach) besteht darin, dass der Unterschied nicht nur in der Verwendung einer separaten Instanz der Datenbank besteht, die die tatsächlichen Produktionsumgebungsdaten enthält.  Oft erstreckt sich der Unterschied auf folgende Aspekte: <br><br><ul><li>  Die Größe des Staging-Clusters (wenn Sie es als "Cluster" bezeichnen können - manchmal ist es nur ein Server, der als Cluster getarnt ist); </li><li>  Die Tatsache, dass beim Staging normalerweise ein viel kleinerer Cluster verwendet wird, bedeutet auch, dass die Konfigurationseinstellungen für fast <i>jeden</i> Dienst variieren.  Dies gilt für Konfigurationen von Load Balancern, Datenbanken und Warteschlangen, z. B. die Anzahl der offenen Dateideskriptoren, die Anzahl der offenen Datenbankverbindungen, die Größe des Thread-Pools usw. Wenn die Konfiguration in einer Datenbank oder einem Schlüsselwert-Datenspeicher gespeichert ist (z. Zookeeper oder Consul) müssen diese Hilfssysteme auch in der Staging-Umgebung vorhanden sein. </li><li>  Die Anzahl der vom zustandslosen Dienst verarbeiteten Online-Verbindungen oder die Methode zur Wiederverwendung von TCP-Verbindungen durch einen Proxyserver (sofern dieses Verfahren überhaupt ausgeführt wird). </li><li>  Fehlende Überwachung bei der Inszenierung.  Aber selbst wenn eine Überwachung durchgeführt wird, können sich einige Signale als völlig ungenau herausstellen, da eine andere Umgebung als die Arbeitsumgebung überwacht wird.  Selbst wenn Sie beispielsweise die Latenz oder Antwortzeit von MySQL-Abfragen überwachen, ist es schwierig zu bestimmen, ob der neue Code eine Abfrage enthält, die einen vollständigen Tabellenscan in MySQL initiieren kann, da es <i>viel</i> schneller (und manchmal sogar vorzuziehen) ist, einen vollständigen Scan der im Test verwendeten kleinen Tabelle durchzuführen Eine Datenbank anstelle einer Produktionsdatenbank, in der eine Abfrage ein völlig anderes Leistungsprofil haben kann. </li></ul><br>  Obwohl anzunehmen ist, dass alle oben genannten Unterschiede keine ernsthaften Argumente gegen die Verwendung der Inszenierung als solche sind, im Gegensatz zu Antimustern, die vermieden werden sollten.  Gleichzeitig erfordert der Wunsch, alles richtig zu machen, häufig die enormen Arbeitskosten der Ingenieure, um ein einheitliches Umfeld zu gewährleisten.  Die Produktion ändert sich ständig und wird von verschiedenen Faktoren beeinflusst. Der Versuch, dieses Match zu erreichen, ist also wie ein Nirgendwo. <br><br>  Selbst wenn die Bedingungen für die Bereitstellung der Arbeitsumgebung so ähnlich wie möglich sind, gibt es andere Arten von Tests, die auf der Grundlage realer Produktionsinformationen besser zu verwenden sind.  Ein gutes Beispiel wäre ein Tränktest, bei dem die Zuverlässigkeit und Stabilität eines Dienstes über einen längeren Zeitraum bei realen Multitasking- und Lastniveaus getestet wird.  Es wird verwendet, um Speicherlecks zu erkennen, die Dauer von Pausen im GC, die Prozessorauslastung und andere Indikatoren für einen bestimmten Zeitraum zu bestimmen. <br><br>  Keiner der oben genannten Punkte deutet darauf hin, dass Staging <i>völlig</i> nutzlos ist (dies wird deutlich, wenn Sie den Abschnitt über die Schattenverdoppelung von Daten beim Testen von Diensten lesen).  Dies weist nur darauf hin, dass sie häufig stärker als erforderlich auf die Bereitstellung angewiesen sind, und in vielen Organisationen bleibt dies die <i>einzige</i> Art von Tests, die vor der vollständigen Veröffentlichung des Produkts durchgeführt werden. <br><br><h2>  Die Kunst des Testens in der Produktion </h2><br>  Historisch gesehen ist das Konzept des „Testens in der Produktion“ mit bestimmten Stereotypen und negativen Konnotationen verbunden („Guerilla-Programmierung“, Fehlen oder Fehlen von Unit- und Integrationstests, Nachlässigkeit oder Unaufmerksamkeit für die Wahrnehmung des Produkts durch den Endbenutzer). <br><br>  Tests in der Produktion verdienen sicherlich einen solchen Ruf, wenn sie nachlässig und schlecht durchgeführt werden.  Es ersetzt in keiner Weise <i>das</i> Testen in der Vorproduktionsphase und ist unter keinen Umständen eine <i>einfache Aufgabe</i> .  Darüber hinaus argumentiere ich, dass <i>erfolgreiche</i> und <i>sichere</i> Tests in der Produktion einen erheblichen Automatisierungsgrad, ein gutes Verständnis der etablierten Praktiken und den Entwurf von Systemen erfordern, die sich zunächst an dieser Art von Tests orientieren. <br><br>  Um einen umfassenden und sicheren Prozess zum effektiven Testen von Dienstleistungen in der Produktion zu organisieren, ist es wichtig, ihn nicht als verallgemeinernden Begriff zu betrachten, der eine Reihe verschiedener Werkzeuge und Techniken bezeichnet.  Leider wurde dieser Fehler auch von mir gemacht - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in meinem vorherigen Artikel wurde</a> keine ganz wissenschaftliche Klassifizierung von Testmethoden vorgestellt, und im Abschnitt "Testen in der Produktion" wurden verschiedene Methoden und Werkzeuge gruppiert. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2h/bo/od/2hboodum_vrej99d2xm911ifecw.png"></div><br>  <i>Aus dem Hinweis Testen von Microservices auf vernünftige Weise ("Ein intelligenter Ansatz zum Testen von Microservices")</i> <br><br>  Seit der Veröffentlichung des Hinweises Ende Dezember 2017 habe ich seinen Inhalt und allgemein das Thema des Testens in der Produktion mit mehreren Personen diskutiert. <br><br>  Im Verlauf dieser Diskussionen und auch nach einer Reihe getrennter Gespräche wurde mir klar, dass das Thema Testen in der Produktion nicht auf mehrere oben aufgeführte Punkte reduziert werden kann. <br><br>  Das Konzept des „Testens in der Produktion“ umfasst eine ganze Reihe von Techniken, die <i>in drei verschiedenen Phasen</i> angewendet werden.  Welche - lass uns verstehen. <br><br><img src="https://habrastorage.org/webt/6a/wc/5-/6awc5-yiregc_-2pzrk4i7gjxx0.jpeg"><br><br><h2>  Drei Produktionsstufen </h2><br>  In der Regel werden Diskussionen über die Produktion nur im Zusammenhang mit der Bereitstellung von Code in der Produktion, Überwachung oder in Notsituationen geführt, in denen ein Fehler aufgetreten ist. <br><br>  Ich selbst habe bisher Begriffe wie "Bereitstellung", "Freigabe", "Lieferung" usw. als Synonyme verwendet, ohne über deren Bedeutung nachzudenken.  Vor einigen Monaten wurden alle Versuche, zwischen diesen Begriffen zu unterscheiden, von mir als etwas Unbedeutendes abgelehnt. <br>  Nachdem ich darüber nachgedacht hatte, kam ich auf die Idee, dass <i>es</i> wirklich notwendig ist, zwischen den verschiedenen Produktionsstufen zu unterscheiden. <br><br><h3>  Phase 1. Bereitstellung </h3><br>  Wenn das Testen (auch in der Produktion) eine Überprüfung der Erreichung der <i>bestmöglichen Indikatoren ist</i> , wird die Genauigkeit des Testens (und tatsächlich aller Überprüfungen) nur unter der Bedingung sichergestellt, dass die Methode zur Durchführung von Tests so nah wie möglich an der Art und Weise ist, wie der Service tatsächlich in der Produktion verwendet wird. <br><br>  Mit anderen Worten, Tests müssen in einer Umgebung ausgeführt werden, <i>die eine Arbeitsumgebung am besten simuliert</i> . <br><br>  Und die <i>beste Nachahmung des</i> Arbeitsumfelds ist ... das Arbeitsumfeld selbst.  Um die maximal mögliche Anzahl von Tests in einer Produktionsumgebung durchzuführen, muss das erfolglose Ergebnis eines dieser Tests den Endbenutzer nicht beeinträchtigen. <br><br>  Dies ist wiederum nur möglich, <b>wenn Benutzer beim Bereitstellen des Dienstes in einer Produktionsumgebung keinen direkten Zugriff auf diesen Dienst erhalten</b> . <br><br>  In diesem Artikel habe ich mich für die Terminologie aus dem Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Deploy! = Release</a> von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Turbine Labs entschieden</a> .  Es definiert den Begriff "Bereitstellung" wie folgt: <br><br>  „Die Bereitstellung ist die Installation einer neuen Version des Serviceprogrammcodes in der Produktionsinfrastruktur durch eine Arbeitsgruppe.  Wenn wir sagen, dass eine neue Version der Software <b>bereitgestellt wurde</b> , bedeutet dies, dass sie irgendwo im Rahmen der funktionierenden Infrastruktur ausgeführt wird.  Dies kann eine neue EC2-Instanz in AWS oder ein Docker-Container sein, der im Herd eines Kubernetes-Clusters ausgeführt wird.  Der Dienst wurde erfolgreich gestartet, hat eine Integritätsprüfung bestanden und ist bereit (Sie hoffen!), Produktionsumgebungsdaten zu verarbeiten, empfängt jedoch möglicherweise keine Daten.  Dies ist ein wichtiger Punkt, ich betone ihn noch einmal: <b>Für die Bereitstellung ist es nicht erforderlich, dass Benutzer Zugriff auf die neue Version Ihres Dienstes erhalten</b> .  In Anbetracht dieser Definition kann die Bereitstellung als Prozess mit nahezu null Risiko bezeichnet werden. “ <br><br>  Die Worte „Null-Risiko-Prozess“ sind einfach ein Balsam für die Seele vieler Menschen, die unter erfolglosen Einsätzen gelitten haben.  Die Möglichkeit, Software <i>in einer realen Umgebung</i> zu installieren, ohne dass Benutzer dies zulassen, bietet beim Testen eine Reihe von Vorteilen. <br>  Erstens wird die Notwendigkeit, separate Umgebungen für Entwicklung, Test und Staging zu unterhalten, die zwangsläufig mit der Produktion synchronisiert werden müssen, minimiert (und kann sogar vollständig verschwinden). <br><br>  Darüber hinaus ist es in der Phase des Entwurfs von Diensten erforderlich, diese voneinander zu isolieren, damit das Versäumnis, eine bestimmte Instanz des Dienstes in der Produktion zu testen, <i>nicht dazu</i> führt, dass Benutzer den Ausfall anderer Dienste kaskadieren oder beeinträchtigen.  Eine Lösung hierfür kann der Entwurf eines Datenmodells und eines Datenbankschemas sein, in denen nicht idempotente Abfragen (hauptsächlich <i>Schreibvorgänge</i> ) Folgendes können: <br><br><ul><li>  Wird in Bezug auf die Produktionsumgebungsdatenbank während eines Teststarts des Dienstes in der Produktion durchgeführt (ich bevorzuge diesen Ansatz); </li><li>  Auf Anwendungsebene sicher abgelehnt werden, bis sie die Schreib- oder Speicherebene erreicht haben; </li><li>  Auf Datensatz- oder Speicherebene zugewiesen oder isoliert werden (z. B. durch Speichern zusätzlicher Metadaten). </li></ul><br><h3>  Stufe 2. Freigabe </h3><br>  Hinweis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Deploy! = Release</a> definiert den Begriff Release wie folgt: <br><br>  „Wenn wir sagen, dass die <b>Veröffentlichung</b> der Serviceversion stattgefunden hat, bedeutet dies, dass die Datenverarbeitung in der Produktionsumgebung erfolgt.  Mit anderen Worten, eine <b>Version</b> ist ein Prozess, der Produktionsumgebungsdaten an eine neue Softwareversion weiterleitet.  In Anbetracht dieser Definition beziehen sich alle Risiken, die mit dem Senden neuer Datenströme verbunden sind (Unterbrechungen, Unzufriedenheit der Kunden, giftige Notizen im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Register</a> ), auf die <b>Veröffentlichung</b> neuer Software und nicht auf deren Bereitstellung (in einigen Unternehmen wird diese Phase auch als <b>Veröffentlichung bezeichnet)</b> . In diesem Artikel verwenden wir den Begriff " <b>Release</b> ". " <br><br>  In Googles Buch über SRE wird der Begriff "Release" im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kapitel zum Organisieren eines Software-Releases verwendet, um es zu beschreiben</a> . <br><br>  „Ein <b>Problem ist ein logisches Element der Arbeit, das aus einer oder mehreren separaten Aufgaben besteht.</b>  <b>Unser Ziel ist es, den Bereitstellungsprozess mit dem Risikoprofil dieses Dienstes zu koordinieren</b> . <br><br>  In Entwicklungs- oder Vorproduktionsumgebungen können wir jede Stunde erstellen und Releases automatisch verteilen, nachdem wir alle Tests bestanden haben.  Bei großen benutzerorientierten Diensten können wir die Version mit einem Cluster starten und dann die Skalierung erhöhen, bis alle Cluster aktualisiert sind.  <b>Für wichtige Infrastrukturelemente können wir den Implementierungszeitraum auf mehrere Tage verlängern und ihn wiederum in verschiedenen geografischen Regionen ausführen. “</b> <br><br>  In dieser Terminologie bedeuten die Wörter "Release" und "Release", was sich das allgemeine Vokabular auf "Deployment" bezieht, und die Begriffe, die häufig zur Beschreibung verschiedener <i>Deployment-</i> Strategien verwendet werden (z. B. blau-grüne Deployment oder kanarische Deployment), beziehen sich auf die <i>Freigabe eines</i> neuen Software. <br><br>  Darüber hinaus kann eine erfolglose <i>Freigabe von</i> Anwendungen zu teilweisen oder erheblichen Arbeitsunterbrechungen führen.  Zu diesem Zeitpunkt wird auch ein <i>Rollback</i> oder <i>Hotfix</i> durchgeführt, wenn sich herausstellt, dass die <i>veröffentlichte</i> neue Version des Dienstes instabil ist. <br><br>  Der <i>Freigabeprozess</i> funktioniert am besten, wenn er automatisiert ist und <i>schrittweise ausgeführt wird</i> .  Ebenso ist ein <i>Rollback</i> oder <i>Hotfix eines</i> Dienstes nützlicher, wenn die Fehlerrate und die Anforderungshäufigkeit automatisch mit der Basislinie korreliert werden. <br><br><h3>  Stufe 3. Nach der Veröffentlichung </h3><br>  Wenn die Veröffentlichung <i>reibungslos verlief</i> und die neue Version des Dienstes die Daten der Produktionsumgebung ohne offensichtliche Probleme verarbeitet, können wir dies als erfolgreich betrachten.  Auf eine erfolgreiche Veröffentlichung folgt eine Phase, die als "nach der Veröffentlichung" bezeichnet werden kann. <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="961811607759159296"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Jedes ausreichend komplexe System befindet sich <i>immer</i> in einem Zustand allmählichen Leistungsverlusts.  Dies bedeutet nicht, dass ein <i>Rollback</i> oder <i>Hotfix erforderlich ist</i> .  Stattdessen ist es notwendig, eine solche Verschlechterung (für verschiedene betriebliche und betriebliche Zwecke) zu überwachen und gegebenenfalls zu debuggen.  Aus diesem Grund ähnelt das Testen nach der Veröffentlichung nicht mehr den Routinen, sondern dem <i>Debuggen</i> oder Sammeln von Analysedaten. <br><br>  Generell bin ich der Meinung, dass jede Komponente des Systems unter Berücksichtigung der Tatsache erstellt werden sollte, dass kein einziges großes System zu 100% einwandfrei funktioniert und dass Fehlfunktionen in den Phasen Design, Entwicklung, Test, Bereitstellung und Überwachung der Software erkannt und berücksichtigt werden sollten Bereitstellung. <br><br><hr><br>  Nachdem wir die drei Produktionsstufen identifiziert haben, schauen wir uns die verschiedenen Testmechanismen an, die für jede von ihnen verfügbar sind.  Nicht jeder hat die Möglichkeit, an neuen Projekten zu arbeiten oder Code von Grund auf neu zu schreiben.  In diesem Artikel habe ich versucht, die Methoden zu identifizieren, die bei der Entwicklung neuer Projekte am besten funktionieren, und darüber zu sprechen, was wir sonst noch tun können, um die vorgeschlagenen Methoden zu nutzen, ohne wesentliche Änderungen an Arbeitsprojekten vorzunehmen. <br><br><h2>  Bereitstellungstests </h2><br>  Wir haben die Bereitstellungs- und Freigabestufen voneinander getrennt und betrachten nun einige Arten von Tests, die nach der Bereitstellung des Codes in der Produktionsumgebung angewendet werden können. <br><br><h3>  Integrationstests </h3><br>  In der Regel werden Integrationstests von einem kontinuierlichen Integrationsserver in einer isolierten Testumgebung für jeden Git-Zweig durchgeführt.  Eine Kopie der <i>gesamten</i> Diensttopologie (einschließlich Datenbanken, Warteschlangen, Proxys usw.) wird für Testsuiten <i>aller</i> Dienste bereitgestellt, die zusammenarbeiten. <br><br>  Ich glaube, dass dies aus mehreren Gründen nicht besonders effektiv ist.  Erstens kann die Testumgebung wie die Staging-Umgebung nicht so bereitgestellt werden, dass sie <i>mit der</i> tatsächlichen Produktionsumgebung <i>identisch</i> ist, <i>selbst wenn die</i> Tests in demselben Docker-Container ausgeführt werden, der in der Produktion verwendet wird.  Dies gilt insbesondere dann, wenn in einer Testumgebung nur die Tests selbst ausgeführt werden. <br><br>  Unabhängig davon, ob der Test als Docker-Container oder als POSIX-Prozess ausgeführt wird, stellt er höchstwahrscheinlich <i>eine</i> oder mehrere Verbindungen zu einem überlegenen Dienst, einer Datenbank oder einem Cache her. Dies ist selten, wenn sich der Dienst in einer Produktionsumgebung befindet, in der er gleichzeitig ausgeführt werden kann mehrere gleichzeitige Verbindungen verarbeiten und häufig inaktive TCP-Verbindungen wiederverwenden (dies wird als Wiederverwendung von HTTP-Verbindungen bezeichnet). <br><br>  Das Problem wird auch durch die Tatsache verursacht, dass die meisten Tests bei jedem Start eine neue Datenbanktabelle oder einen neuen Cache-Schlüsselbereich auf <i>demselben Knoten</i> erstellen, auf <i>dem</i> dieser Test durchgeführt wird (auf diese Weise werden die Tests von Netzwerkfehlern isoliert).  Diese Art des Testens kann bestenfalls zeigen, dass das System mit einer ganz bestimmten Anforderung korrekt funktioniert.  Es ist selten effektiv bei der Simulation schwerwiegender, gut verteilter Arten von Fehlern, ganz zu schweigen von den verschiedenen Arten von Teilfehlern.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=http://">Es gibt umfassende</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Studien</a> , die bestätigen, dass verteilte Systeme häufig ein <i>unvorhersehbares Verhalten aufweisen</i> , das durch eine Analyse, die anders als für das gesamte System durchgeführt wird, nicht vorhergesehen werden kann. <br><br>  Dies bedeutet jedoch nicht, dass Integrationstests <i>grundsätzlich</i> nutzlos sind.  Wir können nur sagen, dass die Durchführung von Integrationstests in einer <i>künstlichen, vollständig isolierten Umgebung</i> in der Regel keinen Sinn ergibt.  Integrationstests sollten weiterhin durchgeführt werden, um sicherzustellen, dass die neue Version des Dienstes: <br><br><ul><li>  Beeinträchtigt nicht die Interaktion mit vor- oder nachgelagerten Diensten; </li><li>  Beeinträchtigt nicht die Ziele höherer oder niedrigerer Dienstleistungen. </li></ul><br>  Die erste kann bis zu einem gewissen Grad durch Vertragstests bereitgestellt werden.  <i>Aufgrund</i> der Tatsache, dass die <i>Schnittstellen</i> zwischen den Diensten ordnungsgemäß funktionieren, ist das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Testen von Verträgen</a> eine effektive Methode zum Entwickeln und Testen einzelner Dienste in <i>der Vorproduktionsphase</i> , für die nicht die gesamte Diensttopologie bereitgestellt werden muss. <br><br>  Clientorientierte Vertragstestplattformen wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pact</a> unterstützen derzeit nur die Interoperabilität zwischen Diensten über RESTful JSON RPC, obwohl wahrscheinlich daran <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gearbeitet wird, die asynchrone Interaktion über Web-Sockets, Nicht-Server-Anwendungen und Nachrichtenwarteschlangen zu unterstützen</a> .  Die Unterstützung für die gRPC- und GraphQL-Protokolle wird voraussichtlich in Zukunft hinzugefügt, ist jedoch noch nicht verfügbar. <br><br>  Vor der <i>Veröffentlichung einer</i> neuen Version muss jedoch möglicherweise nicht nur die ordnungsgemäße Funktion der <i>Schnittstellen</i> überprüft <i>werden</i> . , , ,   RPC-            .    ,       , ,       . <br><br>  ,     <i></i> ,   — ,       <i>,  </i>    (  ,    ). <br>      :  <i></i>     ? <br><br>     .    – ,       :    -   - ( C)   MySQL ( D)       memcache ( B). <br><br>   ,      (    ),  stateful-  stateless-        . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xl/nc/4e/xlnc4eni3elyx3huaw3trxs5uyc.jpeg"></div><br>  <i></i>  <i></i> ,     <i></i>      . <br><br>  service discovery        <i></i> ( ),      <i></i>  <i></i>        .         <i></i>   . <br><br> ,   <i></i>    C  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ze/8y/yp/ze8yypuxevqszd_krd3cls4hrqc.jpeg"></div><br>  ,  <i></i>   ,        ,       .      ,       ,       .  ,     <i></i> ,        . <br><br>   Google     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Just Say No to More End-to-End Tests</a> («      »),      : <br><br> « <i>       ( )      .       ,    ?           ,      </i> . <b>     ,     ,      ,     ».</b> <br><br>    ,          :       <i></i>       .               ,       A        . <br><br>     ,     <i></i>   C     MySQL,     . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/c4/bu/qc/c4buqc8zz2dt4e3pyr6svjnyguc.jpeg"></div><br>  <i> </i>       (   ,   ,         «» ,  <i></i> ).     <i></i>   MySQL   ,    ,      . <br><br>   —        -.      ,      .              -,          . <br><br>    ,   -     <i></i>     ,   /: <br><br><ul><li>       C     /   ; </li><li>         ,   «»   . </li></ul><br>       <i>  </i>    ,             (,   ). <br><br>           ,    ,   <i></i>  .      IP- ,   ,    ,    ,       , ,  ,    ,    . <br><br> ,   ,     ,    ,       .      .     Facebook,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kraken</a> ,  : <br><br> « <i>   —     ,         .   -      ,    .        ,        .</i> <b>           -     ,     ,     ,       ».</b> <br><br>   ,      ,       ,     ,         ,  . <br><br>     -     .    service mesh             .        -.        -,  ,  ,    : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uk/kv/cj/ukkvcjxlzn3hdcpt-mxsep3pojm.jpeg"></div><br>  Wenn wir Service B testen, kann sein ausgehender Proxyserver so konfiguriert werden, dass jeder <code>X-ServiceB-Test</code> ein spezieller <code>X-ServiceB-Test</code> Header hinzugefügt wird.  In diesem Fall kann der eingehende Proxyserver des übergeordneten Dienstes C: <br><br><ul><li>  Erkennen Sie diesen Header und senden Sie eine Standardantwort an Service B; </li><li>  Teilen Sie Service C mit, dass die Anforderung ein <i>Test ist</i> . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3s/mr/-n/3smr-n7k-_87j3jjpirb02hkaja.jpeg"></div><br>  <i>Integrationstests der Interaktion der bereitgestellten Version von Dienst B mit der freigegebenen Version von Dienst C, bei der Schreibvorgänge niemals die Datenbank erreichen</i> <br><br>  <i>Wenn Sie</i> Integrationstests auf diese Weise durchführen, können Sie auch die Interaktion von Service B mit höheren Services testen, <i>wenn diese normale Produktionsumgebungsdaten verarbeiten.</i> Dies ist wahrscheinlich eine genauere Nachahmung des Verhaltens von Service B bei der <i>Freigabe</i> in die Produktion. <br><br>  Es wäre auch schön, wenn jeder Dienst in dieser Architektur echte API-Aufrufe im Test- oder Mock-Modus unterstützen würde, sodass Sie die Ausführung von Dienstverträgen mit nachgeschalteten Diensten testen können, ohne die realen Daten zu ändern.  Dies wäre gleichbedeutend mit Vertragstests, jedoch auf Netzwerkebene. <br><br><h3>  Duplizierung von Schattendaten (Testen des dunklen Datenstroms oder Spiegeln) </h3><br>  Die Duplizierung von Schatten (in dem Artikel im Google-Blog heißt sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dark Launch</a> , und der Begriff <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Spiegelung</a> wird in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Istio verwendet</a> ) hat in vielen Fällen mehr Vorteile als Integrationstests. <br><br>  Die <a href="http://">Prinzipien der Chaos-Technik</a> besagen Folgendes: <br><br>  „ <i>Systeme verhalten sich je nach Umgebung und Datenübertragungsschema unterschiedlich.</i>  <i>Da sich der Nutzungsmodus jederzeit ändern kann</i> , ist das <b>Abtasten realer Daten der einzig zuverlässige Weg, um den Anforderungspfad festzulegen. “</b> <br><br>  Die Duplizierung von Schattendaten ist eine Methode, mit der der Datenstrom der Produktionsumgebung, der in einen bestimmten Dienst eingeht, erfasst und in einer neuen <i>bereitgestellten</i> Version des Dienstes reproduziert wird.  Dieser Vorgang kann entweder in Echtzeit ausgeführt werden, wenn der eingehende Datenstrom aufgeteilt und sowohl an die <i>freigegebene</i> als auch an die <i>bereitgestellte</i> Version des Dienstes gesendet wird, oder asynchron, wenn eine Kopie zuvor erfasster Daten im <i>bereitgestellten</i> Dienst wiedergegeben wird. <br><br>  Als ich bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">imgix arbeitete</a> (einem Startup mit 7 Ingenieuren, von denen nur vier Systemingenieure waren), wurden dunkle Datenströme aktiv verwendet, um Änderungen in unserer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bildvisualisierungsinfrastruktur</a> zu testen.  Wir haben einen bestimmten Prozentsatz aller eingehenden Anforderungen registriert und an den Kafka-Cluster gesendet. Wir haben die HAProxy-Zugriffsprotokolle an die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Heka-</a> Pipeline übergeben, die wiederum den analysierten Anforderungsfluss an den Kafka-Cluster weitergeleitet hat.  Vor der <i>Release-</i> Phase <i>wurde eine</i> neue Version unserer Bildverarbeitungsanwendung in einem erfassten dunklen Datenstrom getestet. Auf diese Weise konnte überprüft werden, ob die Anforderungen korrekt verarbeitet wurden.  Unser Bildvisualisierungssystem war jedoch im Großen und Ganzen ein zustandsloser Dienst, der für diese Art von Tests besonders gut geeignet war. <br><br>  Einige Unternehmen ziehen es vor, nicht einen Teil des Datenstroms zu erfassen, sondern eine <i>vollständige Kopie</i> dieses Datenstroms an die neue Version der Anwendung zu übertragen.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der McRouter</a> (memcached Proxy) von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Facebook</a> unterstützt diese Art der Schattenverdoppelung des Memcache-Datenstroms. <br><br>  „ <i>Beim Testen einer neuen Installation für den Cache fanden wir es sehr praktisch, eine vollständige Kopie des Datenstroms von Clients umleiten zu können.</i>  <i>McRouter unterstützt flexible Einstellungen für die Schattenverdopplung.</i>  <i>Es ist möglich, eine Schattenkopie eines Pools verschiedener Größen durchzuführen (durch erneutes Zwischenspeichern des Schlüsselraums), nur einen Teil des Schlüsselraums zu kopieren oder Parameter während des Betriebs dynamisch zu ändern</i> . “ <br><br>  Der negative Aspekt der Schattenverdoppelung des gesamten Datenstroms für einen <i>bereitgestellten</i> Dienst in einer Produktionsumgebung besteht darin, dass bei Ausführung im Moment maximaler Datenübertragungsintensität möglicherweise doppelt so viel Strom benötigt wird. <br>  Proxys wie Envoy unterstützen die Schatten-Duplizierung des Datenflusses zu einem anderen Cluster im Fire-and-Forget-Modus.  Die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> lautet: <br><br>  „ <i>Ein Router kann den Datenfluss von einem Cluster zum anderen im Schatten duplizieren.</i>  <i>Derzeit ist der Fire-and-Forget-Modus implementiert, bei dem der Envoy-Proxyserver nicht auf eine Antwort vom Schattencluster wartet, bevor er eine Antwort vom Hauptcluster zurückgibt.</i>  <i>Für den Schattencluster werden alle üblichen Statistiken gesammelt, was zu Testzwecken nützlich ist.</i>  <i>Bei der Schattenverdoppelung wird die Option <code>-shadow</code> zum Host- / Berechtigungsheader hinzugefügt.</i>  <i>Dies ist nützlich für die Protokollierung.</i>  <i>Zum Beispiel verwandelt sich <code>cluster1-shadow</code> in <code>cluster1-shadow</code></i> . " <br><br>  Es ist jedoch häufig unpraktisch oder unmöglich, eine Replik eines mit der Produktion synchronisierten Clusters zum Testen zu erstellen (aus dem gleichen Grund, aus dem es problematisch ist, einen synchronisierten Staging-Cluster zu organisieren).  Wenn zum Testen eines neuen <i>bereitgestellten</i> Dienstes mit vielen Abhängigkeiten eine Schatten-Duplizierung verwendet wird, kann dies zu unvorhergesehenen Änderungen des Status übergeordneter Dienste in Bezug auf den getesteten Dienst führen.  Eine Schatten-Duplizierung des täglichen Volumens von Benutzerregistrierungen in der <i>bereitgestellten</i> Version des Dienstes mit Aufzeichnung in der Produktionsdatenbank kann zu einer Erhöhung der Fehlerrate um bis zu 100% führen, da der Schattendatenstrom als wiederholte Registrierungsversuche wahrgenommen und abgelehnt wird. <br><br>  Meine persönliche Erfahrung zeigt, dass die Duplizierung von Schatten am besten zum Testen nicht idempotenter Anforderungen oder zustandsloser Dienste mit serverseitigen Stubs geeignet ist.  In diesem Fall wird die Schattenverdoppelung von Daten häufiger zum Testen von Last, Stabilität und Konfigurationen verwendet.  Gleichzeitig können Sie mithilfe von Integrationstests oder Staging testen, wie der Dienst mit einem statusbehafteten Server interagiert, wenn Sie mit nicht idempotenten Anforderungen arbeiten. <br><br><h3>  TAP-Vergleich </h3><br>  Die einzige Erwähnung dieses Begriffs findet sich in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> aus dem Twitter-Blog, der sich mit der Einführung von Diensten mit hoher Servicequalität befasst. <br><br>  <i>„Um die Richtigkeit der neuen Implementierung des vorhandenen Systems zu überprüfen, haben wir eine Methode namens <b>Tap-Vergleich verwendet</b> .</i>  <i>Unser Tap-Vergleichstool reproduziert die Probenproduktionsdaten im neuen System und vergleicht die empfangenen Antworten mit den Ergebnissen des alten.</i>  <i>Die erzielten Ergebnisse haben uns geholfen, Fehler im System zu finden und zu beheben, noch bevor Endbenutzer auf sie gestoßen sind. “</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ein anderer</a> Twitter-Blog-Beitrag definiert Tap-Vergleiche wie folgt: <br><br>  <i>"Senden von Anforderungen an Service-Instanzen sowohl in der Produktion als auch in Staging-Umgebungen mit <b>Überprüfung der Ergebnisse</b> und Bewertung der Leistungsmerkmale."</i> <br><br>  Der Unterschied zwischen Tap-Vergleich und Schatten-Duplizierung besteht darin, dass im ersten Fall die von der <i>freigegebenen</i> Version zurückgegebene Antwort mit der von der <i>bereitgestellten</i> Version zurückgegebenen Antwort verglichen wird und im zweiten Fall die Anforderung im Offline-Modus wie Fire-and-Forget auf die <i>bereitgestellte</i> Version dupliziert wird. <br><br>  Ein weiteres Werkzeug für die Arbeit in diesem Bereich ist die auf GitHub verfügbare <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wissenschaftlerbibliothek</a> .  Dieses Tool wurde zum Testen von Ruby-Code entwickelt, dann aber in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mehrere andere Sprachen</a> portiert.  Es ist für einige Arten von Tests nützlich, weist jedoch eine Reihe ungelöster Probleme auf.  Folgendes hat ein GitHub-Entwickler in einer professionellen Slack-Community geschrieben: <br><br>  <i>„Dieses Tool führt einfach zwei Codezweige aus und vergleicht die Ergebnisse.</i>  <i>Sie sollten mit dem Code dieser Zweige vorsichtig sein.</i>  <i>Es muss sichergestellt werden, dass Datenbankabfragen nicht dupliziert werden, wenn dies zu Problemen führt.</i>  <i>Ich denke, dass dies nicht nur für einen Wissenschaftler gilt, sondern auch für jede Situation, in der Sie zweimal etwas tun und dann die Ergebnisse vergleichen.</i>  <i>Das Wissenschaftler-Tool wurde erstellt, um zu überprüfen, ob das neue Berechtigungssystem genauso funktioniert wie das alte. Zu bestimmten Zeiten wurde es verwendet, um die Daten zu vergleichen, die für praktisch jede Rails-Anforderung typisch sind.</i>  <i>Ich denke, dass der Prozess mehr Zeit in Anspruch nehmen wird, da die Verarbeitung nacheinander ausgeführt wird, aber dies ist ein Ruby-Problem, bei dem keine Threads verwendet werden.</i> <i><br><br></i>  <i>In den meisten mir bekannten Fällen wurde das Wissenschaftler-Tool verwendet, um mit Lese- und nicht mit Schreiboperationen zu arbeiten, um beispielsweise herauszufinden, ob neue, verbesserte Abfragen und Berechtigungsschemata dieselbe Antwort erhalten wie alte.</i>  <i>Beide Optionen werden in einer Produktionsumgebung (auf Replikaten) ausgeführt.</i>  <i>Wenn die getesteten Ressourcen Nebenwirkungen haben, müssen die Tests meiner Meinung nach auf Anwendungsebene durchgeführt werden. “</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Diffy</a> ist ein von Scala geschriebenes Open Source-Tool, das 2015 von Twitter eingeführt wurde.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ein Artikel</a> aus dem Twitter-Blog mit dem Titel <b>Testen ohne Tests zu schreiben</b> ist wahrscheinlich die beste Quelle, um zu verstehen, wie Tap-Vergleiche in der Praxis funktionieren. <br><br>  <i>„Diffy erkennt potenzielle Fehler im Dienst, indem gleichzeitig eine neue und eine alte Version des Codes gestartet werden.</i>  <i>Dieses Tool fungiert als Proxyserver und sendet alle empfangenen Anforderungen an jede der ausgeführten Instanzen.</i>  <i>Anschließend vergleicht er die Antworten der Instanzen und meldet alle beim Vergleich festgestellten Abweichungen.</i>  <i>Diffy basiert auf der folgenden Idee:</i> <b>Wenn zwei Implementierungen eines Dienstes dieselben Antworten mit einem ausreichend großen und unterschiedlichen Satz von Anforderungen zurückgeben, können diese beiden Implementierungen als gleichwertig angesehen werden, und die neuere von ihnen ohne Leistungseinbußen.</b>  <i>Die innovative Rauschunterdrückungstechnik von Diffy unterscheidet es von anderen Tools zur vergleichenden Regressionsanalyse. “</i> <br><br>  Der Tap-Vergleich ist großartig, wenn Sie überprüfen müssen, ob zwei Versionen die gleichen Ergebnisse liefern.  Laut Mark McBride <br><br>  <i>„Das Diffy-Tool wurde häufig bei der Neugestaltung von Systemen verwendet.</i>  <i>In unserem Fall haben wir die Rails-Quellcodebasis in mehrere mit Scala erstellte Dienste unterteilt, und eine große Anzahl von API-Clients hat Funktionen verwendet, die anders waren als erwartet.</i>  <i>Funktionen wie die Datumsformatierung waren besonders gefährlich. “</i> <br><br>  Der Tap-Vergleich ist nicht die beste Option zum Testen der Benutzeraktivität oder der Identität des Verhaltens von zwei Versionen des Dienstes bei maximaler Auslastung.  Wie bei der Schattenverdoppelung bleiben Nebenwirkungen ein ungelöstes Problem, insbesondere wenn sowohl die bereitgestellte Version als auch die Produktionsversion Daten in dieselbe Datenbank schreiben.  Wie bei Integrationstests besteht eine Möglichkeit, dieses Problem zu umgehen, darin, Vergleichstests mit nur einer begrenzten Anzahl von Konten zu verwenden. <br><br><h3>  Lasttest </h3><br>  Für diejenigen, die mit Stresstests nicht vertraut sind, kann <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dieser Artikel</a> als guter Ausgangspunkt dienen.  An Tools und Plattformen für Open Source-Lasttests mangelt es nicht.  Die beliebtesten von ihnen sind <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=http://">Apache Bench</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gatling</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wrk2</a> , <a href="http://">Tsung</a> , geschrieben in Erlang, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Siege</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Iago</a> von Twitter, geschrieben in Scala (das die Protokolle eines HTTP-Servers, Proxyservers oder Netzwerkpaketanalysators in einer Testinstanz reproduziert).  Einige Experten glauben, dass das beste Tool zum Generieren von Last <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mzbench ist</a> , das eine Vielzahl von Protokollen unterstützt, darunter MySQL, Postgres, Cassandra, MongoDB, TCP usw. Die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NDBench von</a> Netflix ist ein weiteres Open-Source-Tool zum Testen von Last-Data-Warehouses. , die die meisten bekannten Protokolle unterstützt. <br><br>  Der offizielle Twitter-Blog von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Iago</a> beschreibt detaillierter, welche Funktionen ein guter Lastgenerator haben sollte: <br><br>  <i>„Nicht blockierende Anforderungen werden mit einer bestimmten Häufigkeit basierend auf einer internen benutzerdefinierten statistischen Verteilung generiert ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der Poisson-Prozess wird</a> standardmäßig modelliert).</i>  <i>Die Häufigkeit von Anforderungen kann nach Bedarf geändert werden, um beispielsweise den Cache vor der Arbeit unter Volllast vorzubereiten.</i> <i><br><br></i>  <i>Im Allgemeinen liegt der Schwerpunkt auf der Häufigkeit von Anfragen gemäß <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dem Gesetz von Little</a> und nicht auf der Anzahl gleichzeitiger Benutzer, die je nach Verzögerung dieses Dienstes variieren können.</i>  <i>Aus diesem Grund ergeben sich neue Möglichkeiten, die Ergebnisse mehrerer Tests zu vergleichen und eine Verschlechterung des Betriebs zu verhindern, wodurch der Betrieb des Lastgenerators verlangsamt wird.</i> <i><br><br></i>  <i>Mit anderen Worten, das Iago-Tool versucht, ein System zu simulieren, in dem Anforderungen empfangen werden, unabhängig von der Fähigkeit Ihres Dienstes, diese zu verarbeiten.</i>  <i>Dies unterscheidet sich von Lastgeneratoren, die geschlossene Systeme simulieren, in denen Benutzer geduldig mit der vorhandenen Verzögerung arbeiten.</i>  <i>Dieser Unterschied ermöglicht es uns, die Fehlermodi, die in der Produktion auftreten können, ziemlich genau zu modellieren. "</i> <br><br>  Eine andere Art der Lastprüfung ist die Belastungsprüfung durch Umverteilung des Datenflusses.  Das Wesentliche ist: Der gesamte Datenfluss aus der Produktionsumgebung wird an einen kleineren Cluster geleitet als den für den Service vorbereiteten.  Bei Problemen wird der Datenstrom zurück zum größeren Cluster übertragen.  Diese Technik wird von Facebook verwendet, wie in einem der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel in seinem offiziellen Blog beschrieben</a> : <br><br>  <i>„Wir leiten speziell einen größeren Datenfluss an einzelne Cluster oder Knoten um, messen den Ressourcenverbrauch auf diesen Knoten und bestimmen die Grenzen der Servicestabilität.</i>  <i>Diese Art des Testens ist insbesondere nützlich, um die CPU-Ressourcen zu ermitteln, die zur Unterstützung der maximalen Anzahl gleichzeitiger Übertragungen von Facebook Live erforderlich sind. “</i> <br><br>  Folgendes schreibt ein ehemaliger LinkedIn-Ingenieur in der professionellen Slack-Community: <br><br>  <i>"LinkedIn verwendete auch Redline-Tests in der Produktion - Server wurden aus dem Load Balancer entfernt, bis die Last Schwellenwerte erreichte oder Fehler auftraten."</i> <br><br>  In der Tat bietet eine Google-Suche einen Link zu einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vollständigen Whitepaper</a> und einem LinkedIn-Blogartikel zu diesem Thema: <br><br>  <i>„Die Redliner-Lösung für Messungen verwendet einen realen Datenstrom der Produktionsumgebung, wodurch Fehler vermieden werden, die genaue Leistungsmessungen im Labor verhindern.</i> <i><br><br></i>  <i>Redliner leitet einen Teil des Datenstroms an den zu testenden Dienst weiter und analysiert dessen Leistung in Echtzeit.</i>  <i>Diese Lösung wurde in Hunderten von internen LinkedIn-Diensten implementiert und wird täglich für verschiedene Arten von Leistungsanalysen verwendet.</i> <i><br><br></i>  <i>Redliner unterstützt die parallele Testausführung für kanarische und Produktionsinstanzen.</i>  <b>Auf diese Weise können Ingenieure dieselbe Datenmenge auf zwei verschiedene Dienstinstanzen übertragen: 1) eine Dienstinstanz, die Innovationen wie neue Konfigurationen, Eigenschaften oder neuen Code enthält;</b>  <b>2) eine Dienstinstanz der aktuellen Arbeitsversion.</b> <br><br>  <i>"Die Ergebnisse von Lasttests werden bei Entscheidungen berücksichtigt und verhindern die Bereitstellung von Code, was zu einer schlechten Leistung führen kann."</i> <br><br>  Facebook hat dank des Kraken-Systems Lasttests mit realen Datenströmen auf ein völlig neues Niveau gebracht, und auch die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beschreibung ist</a> lesenswert. <br>  Das Testen wird implementiert, indem der Datenstrom neu verteilt wird, wenn Gewichtswerte (aus dem verteilten Konfigurationsspeicher gelesen) für <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Grenzgeräte</a> und Cluster in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Proxygen-</a> Konfiguration (Facebook Load Balancer) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">geändert werden</a> .  Diese Werte bestimmen das Volumen der realen Daten, die an einem bestimmten Anwesenheitspunkt an jeden Cluster und jede Region gesendet werden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wk/0e/by/wk0ebyvdpznpgdgqcc_6zbu1g6g.png"></div><br>  <i>Daten aus dem Kraken White Paper</i> <br><br>  Das Überwachungssystem ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gorilla</a> ) zeigt Indikatoren für verschiedene Dienste an (wie in der obigen Tabelle gezeigt).  Basierend auf den Überwachungsdaten und Schwellenwerten wird entschieden, ob Daten gemäß den Gewichtswerten weiter gesendet werden sollen oder ob die Übertragung von Daten an einen bestimmten Cluster reduziert oder sogar vollständig gestoppt werden muss. <br><br><h2>  Konfigurationstests </h2><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-2" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="916383043933192192"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Eine neue Welle von Open-Source-Infrastruktur-Tools hat es möglich gemacht, alle Änderungen in der Infrastruktur in Form von Code zu erfassen, aber auch relativ <i>einfach</i> .  Es ist auch in unterschiedlichem Maße möglich geworden, diese Änderungen zu <i>testen</i> , obwohl die meisten Infrastruktur-als-Code-Tests in der Vorproduktionsphase nur die korrekten Spezifikationen und Syntax bestätigen können. <br><br>  Darüber hinaus wurde die Weigerung, die neue Konfiguration vor der <i>Veröffentlichung des</i> Codes zu testen, zu einer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erheblichen Anzahl von Unterbrechungen</a> . <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-3" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="963093541575581696"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  Für das ganzheitliche Testen von Konfigurationsänderungen ist es wichtig, zwischen verschiedenen Arten von Konfigurationen zu unterscheiden.  Fred Hebert schlug einmal vor, den folgenden Quadranten zu verwenden: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yv/fi/4i/yvfi4ioub6pkvt1mtzxvz2xuvnk.png"></div><br>  Diese Option ist natürlich nicht universell, aber mit dieser Unterscheidung können Sie entscheiden, wie und zu welchem ​​Zeitpunkt die einzelnen Konfigurationen am besten getestet werden sollen.  Die Konfiguration der Erstellungszeit ist sinnvoll, wenn Sie die tatsächliche Wiederholbarkeit von Baugruppen sicherstellen können.  Nicht alle Konfigurationen sind statisch, aber auf modernen Plattformen ist eine dynamische Konfigurationsänderung unvermeidlich (selbst wenn es sich um eine „permanente Infrastruktur“ handelt). <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-4" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1005924617981005824"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>       ,   ,       blue-green ,        .   ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jamie Wilkinson</a> ),  Google  , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> : <br><br> <i>«        ,   ,   ,  -     .    .</i> <b>    -  ,         —  ,       ,   .        .</b> <br><br> <i>            ,  .     ,    , —    ».</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  Facebook</a>             : <br><br> <i>«           .    —  ,              .             .        ,      .</i> <br><br><ul><li> <b>   </b> <br><br>             .  Facebook ,          .             ,     . </li><li> <b>   </b> <br><br>         (,  JSON).           ,           .          . <br><br>   (,  Facebook  Thrift)      .   ,           . </li><li> <b> </b> <br><br>         ,     ,    - .       .   — A/B-,        1 % .     A/B-,        .      A/B-    . ,  ,                 ,       ,     .  , A/B-    .      ,    A/B-.     Facebook        . <br><br> ,     A/B-  1% ,   1%     ,          (   «  »).          ,         .               ,      . </li><li> <b>  </b> <br><br>   Facebook            .       ,        .    ,              ,     .   ,  ,           . </li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einfache und bequeme Stornierung von Änderungen</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In einigen Fällen wird trotz aller vorbeugenden Maßnahmen die Bereitstellung einer nicht funktionsfähigen Konfiguration durchgeführt. </font><font style="vertical-align: inherit;">Das schnelle Auffinden und Zurücksetzen von Änderungen ist entscheidend, um ein solches Problem anzugehen. </font><font style="vertical-align: inherit;">"In unserem Konfigurationssystem sind Tools zur Versionskontrolle verfügbar, die das Rückgängigmachen von Änderungen erheblich vereinfachen."</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortsetzung folgt! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fortgesetzt </font><font style="vertical-align: inherit;">.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de418081/">https://habr.com/ru/post/de418081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de418069/index.html">Lösen japanischer Farbkreuzworträtsel mit Lichtgeschwindigkeit</a></li>
<li><a href="../de418071/index.html">IT-Branche für die Menschen: TechTrain Festival in St. Petersburg</a></li>
<li><a href="../de418075/index.html">TOP 5 Dinge, die auf einem 3D-Drucker gedruckt werden können [Video]</a></li>
<li><a href="../de418077/index.html">Unfälle mit „Nicht beobachten“: eine statistische Begründung für die Betriebsart des technischen Supports rund um die Uhr</a></li>
<li><a href="../de418079/index.html">Die beliebtesten Programmiersprachen - 2018</a></li>
<li><a href="../de418083/index.html">Einfacher Server mit GraphQL anstelle von REST, Implementierung in Java</a></li>
<li><a href="../de418085/index.html">Versprechen in JavaScript verwenden</a></li>
<li><a href="../de418087/index.html">80% der Selbstbedienungskassen sind gefährdet</a></li>
<li><a href="../de418089/index.html">SolidCraft CNC-Fräsmaschine Übersicht</a></li>
<li><a href="../de418091/index.html">Liste der Artikel und Literatur zu NAS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>