<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì≤ ‚õèÔ∏è üå§Ô∏è Servidor de World of Tanks de fiabilidad üçö üë©üèø‚Äçüè´ ü§≤üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El tema de hoy, la confiabilidad del servidor de World of Tanks, es bastante resbaladizo. La confiabilidad del juego es una soluci√≥n de compromiso, po...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servidor de World of Tanks de fiabilidad</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/418977/"><p>  El tema de hoy, la confiabilidad del servidor de World of Tanks, es bastante resbaladizo.  La confiabilidad del juego es una soluci√≥n de compromiso, por lo tanto, todo debe hacerse de manera r√°pida y r√°pida en el desarrollo del juego.  La carga en los servidores es grande, y los usuarios tienden a romper algo simplemente por inter√©s.  <strong>Levon Avakyan</strong> en RIT ++ dijo lo que Wargaming est√° haciendo para garantizar la confiabilidad. </p><br><p>  Por lo general, cuando se habla de confiabilidad, el monitoreo, las pruebas de estr√©s, etc. se mencionan todo el tiempo.  No hay nada sobrenatural en esto, y el informe se dedic√≥ a momentos espec√≠ficos de los tanques. </p><br><img src="https://habrastorage.org/webt/x6/id/gr/x6idgr4r-xse32m9p4kqkps8ndi.jpeg"><br><br><p>  <strong>Sobre el orador:</strong> Levon Avakyan trabaja para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Wargaming</a> como Jefe de Servicios de Juego y Confiabilidad de WoT y se ocupa de los problemas de confiabilidad del servidor de tanque. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/x-Uk5xBsstA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  Hoy hablar√© sobre c√≥mo hacemos esto, incluido de qu√© se trata el servidor de World Of Tanks, en qu√© consiste, en qu√© se basa, para que entienda el tema de la conversaci√≥n.  Adem√°s, consideraremos qu√© puede salir mal dentro del servidor y a su alrededor, porque el juego ya es m√°s que el servidor.  Y tambi√©n hablaremos un poco sobre los procesos, porque muchos olvidan que un proceso bien establecido en la producci√≥n es parte del √©xito no solo en t√©rminos de ahorro de recursos (muchas pr√°cticas provienen de la producci√≥n real), sino que afecta la calidad y la confiabilidad de la soluci√≥n. <br><br><img src="https://habrastorage.org/webt/qa/oj/17/qaoj17globztvoj2lxan-yry9-a.jpeg"><br>  Por lo general, cuando se habla de confiabilidad, el monitoreo, las pruebas de estr√©s, etc., se mencionan todo el tiempo.  No lo inclu√≠ aqu√≠ porque creo que es aburrido.  No hemos descubierto nada sobrenatural en esto.  S√≠, tambi√©n tenemos un sistema de monitoreo, hacemos pruebas de estr√©s con pruebas de estr√©s para aumentar la confiabilidad del sistema y saber d√≥nde puede caerse.  Pero hoy hablar√© sobre lo que es m√°s espec√≠fico para los tanques. <br><br>
<h2>  BigWorld Technology <br></h2><br>  Este es un motor de back-end, as√≠ como un kit de herramientas para crear MMO. <br><br>  Este motor bastante antiguo de BigWorld Server (creado a finales de los 90 y principios de los 2000) es un conjunto de procesos diferentes que admiten el juego.  Los procesos se inician en un cl√∫ster, interconectados en una red de m√°quinas.  Al interactuar entre s√≠, los procesos muestran al usuario alg√∫n tipo de mec√°nica de juego. <br><br>  El motor se llama BigWorld, porque es muy bueno hacer juegos en √©l, en el que hay un gran campo (espacio), en el que tienen lugar operaciones militares (batallas).  Para los tanques, esto encaja perfectamente. <br><br>  En t√©rminos de confiabilidad, las siguientes caracter√≠sticas clave se invirtieron en BigWorld: <br><br><ul><li>  <strong>Equilibrio de carga.</strong>  El motor asigna recursos, tratando de lograr dos objetivos: <br><ol><li>  use la menor cantidad de m√°quinas posible; </li><li>  al mismo tiempo, no cargue sus aplicaciones para que su carga exceda un cierto l√≠mite. </li></ol></li><li>  <strong>Escalabilidad.</strong>  Agregamos el auto al cl√∫ster, iniciamos procesos en √©l, lo que significa que puedes contar m√°s batallas y aceptar jugadores. <br></li><li>  <strong>Alta disponibilidad</strong>  Si, por ejemplo, un autom√≥vil se cay√≥ o algo sali√≥ mal con uno de los procesos del juego que sirve al juego en s√≠, no hay nada de qu√© preocuparse: el juego no se dar√° cuenta, se restaurar√° en otro lugar y funcionar√°. </li><li>  <strong>Mantener la integridad y la coherencia de los datos.</strong>  Este es el segundo nivel de tolerancia a fallas.  Si hay varios grupos, como en Tanques, y hubo alg√∫n tipo de desastre en el centro de datos o en el canal principal, esto no significa que perderemos por completo los datos del juego que la persona ha jugado.  Nos recuperaremos, la consistencia ser√°. </li></ul><br>  <strong>Los procesos que est√°n en nuestro sistema y sus funciones.</strong> <br><br><ul><li>  <strong>CellApp</strong> es el proceso responsable de procesar el espacio del juego o parte de √©l. <br></li></ul>  Como dije, BigWorld trabaja con ciertos espacios que dividimos en celdas.  Cada celda espec√≠fica de nuestro espacio de juego se calcula mediante una aplicaci√≥n espec√≠fica. <br><br><ul><li>  <strong>CellAppMgr</strong> : el proceso que coordina el trabajo de CellApp, el equilibrio de carga. <br></li></ul>  CellApp puede ser muchos, por lo tanto, debe haber un proceso que los controle. <br><br><ul><li>  <strong>BaseApp</strong> gestiona entidades, a√≠sla a los clientes de trabajar con CellApp. </li></ul>  Una de las cosas fundamentales en BigWorld es el concepto de entidad, por ejemplo, la cuenta de un jugador.  Todo lo que hacemos en el campo de batalla, lo hacemos con esta entidad.  CellApps calcula la f√≠sica y la mec√°nica del juego, como disparar.  BaseApp funciona con entidades.  Sirve la cuenta, tanque, etc. <br><br><ul><li>  <strong>ServiceApp</strong> es una BaseApp especializada que implementa alg√∫n tipo de servicio. </li></ul>  Esta es una versi√≥n simplificada de BaseApp, un proceso que realiza varias tareas de servicio.  Por ejemplo, alguien deber√≠a poder leer desde RabbitMQ.  No se trata de entidades de juego, sino que tambi√©n es necesario. <br><br><ul><li>  <strong>BaseAppMgr</strong> administra BaseApp y ServiceApp, porque tambi√©n hay muchos de ellos. </li><li>  <strong>LoginApp</strong> crea nuevas conexiones de clientes, y tambi√©n representa a los usuarios en BaseApp. </li><li>  <strong>DBApp</strong> implementa una interfaz de acceso al almacenamiento (bases de datos).  Trabajamos con Percona, pero puede ser otra base de datos. </li><li>  <strong>DBAppMgr</strong> coordina el trabajo de DBApp. </li><li>  <strong>InterClusterMgr</strong> gestiona la comunicaci√≥n entre <strong>cl√∫steres</strong> . </li><li>  <strong>El revisor</strong> es un inspector de procesos que puede reiniciar los procesos. </li><li>  <strong>Bwmachined</strong> <strong>&nbsp;</strong>  - un demonio que se ejecuta en cada m√°quina del cl√∫ster para coordinar su trabajo.  Permite que todos los administradores de BaseApp se comuniquen entre s√≠. </li></ul><br><img src="https://habrastorage.org/webt/z9/dq/he/z9dqhes39d5hjaah6aq4igy6kzg.jpeg"><br><br>  As√≠ es como se ven los tanques desde adentro, aunque sea muy brevemente: <br><br><ul><li>  Los clientes se conectan a trav√©s de Internet, acceden a LoginApp. </li><li>  LoginApp los autoriza utilizando DBApp y emite una direcci√≥n de BaseApp. </li><li>  Otros clientes juegan con ellos. </li></ul><br>  Todo esto est√° disperso en muchas m√°quinas, cada una de las cuales tiene un BWMachineD, que puede gestionar todo esto, orquestar, etc. <br><br><h2>  Ecosistema de World of Tanks <br></h2><br>  Que hay alrededor  Parecer√≠a que hay un servidor de juego y jugadores: eligieron un tanque y fueron a jugar.  Pero, desafortunadamente (o con alegr√≠a), el juego se est√° desarrollando y la mec√°nica del juego de "solo disparar" ya no es suficiente.  En consecuencia, el servidor del juego comenz√≥ a cubrirse con varios servicios, algunos de los cuales generalmente eran imposibles de hacer dentro del servidor, mientras que comenzamos a eliminar otros especialmente para aumentar la velocidad de entrega de contenido al jugador.  Es decir, es m√°s r√°pido escribir un peque√±o servicio en Python que haga alg√∫n tipo de mec√°nica de juego que hacerlo dentro del servidor en todos los BaseAPP, grupos de soporte, etc. <br><br>  Algunas cosas, por ejemplo, los sistemas de pago se emitieron originalmente.  Soportamos a otros, porque Wargaming desarrolla m√°s de un juego, despu√©s de todo.  Esta es una trilog√≠a: tanques, aviones, barcos, y hay Blitz y planes para nuevos juegos.  Si estuvieran dentro de BigWorld, entonces no podr√≠an usarse convenientemente en otros productos. <br><br>  Todo fue bastante r√°pido y ca√≥tico, lo que result√≥ en algunas tecnolog√≠as de zool√≥gico que se utilizan en nuestro ecosistema de tanques. <br><br>  Tecnolog√≠as y protocolos clave: <br><br>  1. Python 2.7, 3.5; <br><br>  2. Erlang <br><br>  3. Scala; <br><br>  4. JavaScript; <br><br>  Marcos <br><br>  5. Django; <br><br>  6. halc√≥n; <br><br>  7. asincio; <br><br>  Almacenamiento: <br><br>  8. Postgres; <br><br>  9. Percona. <br><br>  10. Memcached y Redis para el almacenamiento en cach√©. <br><br>  Todo junto para el jugador, este es el servidor del tanque: <br><br><ul><li>  Punto √∫nico de autorizaci√≥n; </li><li>  Chatear </li><li>  Clanes; </li><li>  Sistema de pago; </li><li>  Sistema de torneo; </li><li>  Meta juegos (mapa global, √°reas fortificadas); </li><li>  Portal del tanque, portal del clan; </li><li>  Gesti√≥n de contenidos, etc. </li></ul><br>  Pero si nos fijamos, estas son cosas ligeramente diferentes escritas en diferentes tecnolog√≠as.  Esto causa algunos problemas de confiabilidad. <br><br><img src="https://habrastorage.org/webt/oi/-o/ax/oi-oaxdx4eek4e5omtpwlyp5ism.jpeg"><br><br>  El diagrama muestra nuestro servidor de tanque junto con su ecosistema.  Hay un servidor de juegos, servicios web (internos y externos), que incluyen servicios completamente especiales que se encuentran en la red de fondo y realizan funciones de servicio, y servicio a ellos, que realmente implementan las interfaces.  Por ejemplo, hay un servicio de clan con su propio portal de clan, que le permite administrar este clan, hay un portal del juego en s√≠, etc. <br><br>  Esta separaci√≥n nos permite preocuparnos menos por la seguridad, porque nadie tiene acceso a la red interna, menos problemas.  Pero esto lleva a esfuerzos adicionales, porque necesitamos representantes que nos den acceso si necesitamos empujarlo hacia afuera. <br><br>  Ya dije que tomamos la decisi√≥n de eliminar parte del juego y la l√≥gica del juego.  Hab√≠a una tarea de alguna manera incluir todo en el cliente.  Tenemos un maravilloso Client Gateway que permite que un cliente tanque acceda directamente a un servidor desde algunas de las API de estos Servicios internos, los mismos clanes o API de nuestros metajuegos. <br><br>  Adem√°s, introdujimos Chromium Embedded Framework (CEF) dentro del cliente de tanque.  Ahora tenemos el mismo navegador.  El jugador no lo distingue de la ventana del juego.  Esto le permite trabajar con toda la infraestructura, evitando el trabajo con el servidor del juego. <br><br>  Tenemos muchos grupos, sucedi√≥, te dir√© por qu√©.  As√≠ es como se ve la regi√≥n de la CEI. <br><br><img src="https://habrastorage.org/webt/rc/w4/ri/rcw4rignlicjgsjz8oeepp9cipa.jpeg"><br><br>  Todo est√° disperso por los centros de datos.  Los jugadores, dependiendo de d√≥nde sea mejor el ping, se conectan a la ubicaci√≥n.  Pero todo el ecosistema no se escala de esta manera, principalmente en Europa y Mosc√∫, lo que tambi√©n nos agrega algunos problemas de confiabilidad: latencia y reenv√≠o adicionales. <br><br>  As√≠ es como se ve el ecosistema de World of Tanks. <br><br>  ¬øQu√© puede salir mal con toda esta econom√≠a?  Lo que quieras!  Y va J. Pero desarmemoslo. <br><br><h2>  Puntos clave de falla dentro de un cl√∫ster <br></h2><br><h4>  Falla de una sola m√°quina o proceso <br></h4><br>  La opci√≥n m√°s simple que podemos predecir es la falla de una m√°quina o proceso dentro de un cl√∫ster.  Tenemos grupos de 10 a 100 autos, algo puede volar.  Como dije, BigWorld proporciona mecanismos listos para usar que nos permiten ser m√°s confiables. <br><br><img src="https://habrastorage.org/webt/-3/tl/-q/-3tl-qfzv-9slfdcdbymwl--s3a.jpeg"><br><br>  Esquema est√°ndar: hay BaseApps que se distribuyen en diferentes m√°quinas.  En estas BaseApp hay entidades que contienen entidades estatales.  Cada BaseApp se respalda con Round Robin en otros. <br><br>  Supongamos que tenemos un archivo y algo de BaseApp muri√≥, o la m√°quina entera muri√≥, ¬°est√° bien!  Las BaseApps restantes dejaron estas entidades, se restaurar√°n y el juego para el jugador no sufrir√°. <br><br><img src="https://habrastorage.org/webt/mm/ix/tp/mmixtp-1r1cmzro9zznc1o76a2g.jpeg"><br><br>  Los CellAPP hacen exactamente lo mismo, lo √∫nico es que tambi√©n almacenan sus estados en BaseApps, y no en otros CellAPP. <br><br>  Parece ser un mecanismo confiable, pero ... <br><br><h5>  Tienes que pagar por todo <br></h5><br>  Con el tiempo, comenzamos a observar lo siguiente. <br><br>  ‚Ä¢ La creaci√≥n de copias de seguridad de entidades comienza a ocupar m√°s y m√°s recursos del sistema y tr√°fico de red. <br><br>  De hecho, el proceso de copia de seguridad comienza a afectar la estabilidad del sistema cuando, dentro del cl√∫ster, la mayor parte de la red est√° ocupada transmitiendo copias a Round Robins. <br><br>  ‚Ä¢ El tama√±o de las entidades crece con el tiempo, a medida que se agregan nuevos atributos y mec√°nicas de juego. <br><br>  Pero lo m√°s desagradable es que los tama√±os de estas entidades crecen como una avalancha.  Por ejemplo, un jugador realiza alguna acci√≥n (compra la propiedad del juego), y esta operaci√≥n comenz√≥ a ralentizarse.  Todav√≠a no lo hemos completado, pero hemos guardado los cambios en estos atributos.  Es decir, el sistema es tan malo y todav√≠a estamos empezando a aumentar el tama√±o de la copia de seguridad que debe hacerse.  Hay un efecto de bola de nieve. <br><br>  ‚Ä¢ La estabilidad general del sistema disminuye <br><br>  Debido al hecho de que estamos tratando de escapar de la ca√≠da de una m√°quina o proceso, dejamos caer la estabilidad de todo el sistema. <br><br>  <strong>¬øQu√© hemos hecho para lidiar con esto</strong> ?  Decidimos que cada entidad resalte lo que realmente necesita ser respaldado.  Dividimos los atributos en mutables e inmutables, y no copiamos toda la entidad, pero solo respaldamos sus atributos mutables.  De esta manera, simplemente redujimos la cantidad de informaci√≥n que realmente necesita mantenerse en hierro.  Ahora, al agregar un nuevo atributo, quien lo haga deber√≠a ver m√°s claramente d√≥nde atribuirlo.  Pero en general, esto nos salv√≥ la situaci√≥n. <br><br>  Para ser completamente franco, este mecanismo se estableci√≥ en BigWorld, pero en Tanks en alg√∫n momento ya no fue compatible hasta el final, y no todas las entidades pueden recuperarse de su respaldo.  En Ships, por ejemplo, los chicos apoyan esto.  All√≠ puede apagar las m√°quinas de forma segura: la informaci√≥n simplemente se restaurar√° en otras m√°quinas y el cliente no notar√° nada.  Desafortunadamente, este no es siempre el caso en Tanks, pero lograremos el retorno de toda esta funcionalidad para que funcione como deber√≠a. <br><br><h4>  Falla del centro de datos.  Multi-cluster <br></h4><br>  Si de repente no caen 1-2 autos, y comenzamos a perder todo el centro de datos, es decir, el cl√∫ster por completo, ¬øqu√© propiedades debe tener el sistema para que el juego no caiga en tal situaci√≥n? <br><br><ul><li>  Cada grupo debe ser independiente, es decir: <br><ol><li>  debe tener su propia base de datos; </li><li>  el grupo procesa solo sus espacios (arenas de batalla). </li></ol>  Por lo tanto, si algunas arenas golpean, otras a√∫n funcionan. </li><li>  Los grupos deben comunicarse entre s√≠ para que uno pueda decir al segundo: "¬°Me ca√≠!"  Cuando aumenta, los datos se restaurar√°n a partir de las copias guardadas. </li><li>  Tambi√©n es deseable que pueda transferir al usuario de un cl√∫ster a otro. </li></ul><br>  Por el momento, el esquema de nuestro multi-cluster se ve as√≠. <br><br><img src="https://habrastorage.org/webt/ov/qd/2u/ovqd2ufkauofi1ybo1wduomewtu.jpeg"><br><br>  Tenemos un grupo central y lo que llamamos perif√©ricos en los que se libran las batallas reales.  CellApp no ‚Äã‚Äãse ejecuta en el cl√∫ster central; de lo contrario, es exactamente igual que todos los dem√°s.  Es el punto central del procesamiento de cuentas: se elevan all√≠, se env√≠an a la periferia y en la periferia ya est√° jugando una persona.  Es decir, el fracaso de cualquiera de los grupos no conduce a una p√©rdida de operatividad de todo el juego.  Incluso la falla del grupo central simplemente no permite que los nuevos jugadores inicien sesi√≥n, pero aquellos que ya est√°n jugando en la periferia pueden continuar el juego. <br><br>  El hecho de que todo funciona para nosotros a trav√©s del cl√∫ster central ha resultado porque, en general, la tecnolog√≠a BigWorld en s√≠ misma supone que existe un proceso de gesti√≥n especial entre los gestores entre clasificadores.  De hecho, tales gerentes entre clasificadores pueden ser criados de alguna manera. <br><br>  Hist√≥ricamente, los tanques necesitaban un cl√∫ster m√∫ltiple, porque comenz√≥ a crecer la avalancha en l√≠nea.  Cuando llegamos al pico de 200 mil jugadores, el tr√°fico entrante de ellos simplemente dej√≥ de ser colocado en el centro de datos a trav√©s de la red.  Tuvimos que arrodillarnos literalmente alg√∫n tipo de soluci√≥n para que los jugadores pudieran lanzarse a varios centros de datos. <br><br>  De hecho, solo ganamos, porque ahora tenemos un multi-cluster.  Tambi√©n se ha vuelto √∫til para los jugadores, porque el ping, es decir, la accesibilidad a trav√©s de la red, afecta en gran medida el juego.  Si el retraso es m√°s de 50-70 ms, esto ya comienza a afectar la calidad del juego en s√≠, porque en Tanks absolutamente todo se calcula en el servidor.  No hay c√°lculos sobre el cliente.  Por lo tanto, tenga en cuenta que pr√°cticamente no hay nada que hacer.  Por supuesto, algunas modificaciones se realizan all√≠, pero no afectan el proceso en s√≠.  Puedes intentar adivinar lo que suceder√°, pero afectar la mec√°nica del juego en s√≠, no. <br><br>  Debido a este enfoque, nuestro <strong>grupo central se ha convertido en un punto de falla</strong> .  Todo estaba cerrado para √©l.  Decidimos: dado que estas m√°quinas y una gran base de guarida de juego est√°n parados all√≠, dejemos que nuestros perif√©ricos se ocupen exclusivamente de la lucha.  Entonces, realmente no hay necesidad de almacenar grandes cantidades de informaci√≥n: las batallas se juegan y se juegan, guardemos todo all√≠. <br><br>  Para reescribir absolutamente todo para alejarse del concepto de un grupo central, ahora no hay tiempo, no hay un deseo especial.  Pero decidimos, en primer lugar, ense√±ar a los grupos perif√©ricos a comunicarse entre s√≠.  Luego, abrimos un agujero en ellos para que fuera posible influir en ellos utilizando servicios de terceros. <br><br>  Por ejemplo, para crear una batalla antes, era necesario decirle al grupo central que era necesario crear una batalla en alguna parte de la periferia.  Adem√°s, por mecanismos internos, las entidades se movieron, se cre√≥ la esencia de la arena, etc. <br><br>  <strong>Ahora es posible contactar directamente con la periferia, sin pasar por el grupo central.</strong>  Entonces le quitamos el trabajo extra.  Pero hasta ahora no existe el deseo de cambiar completamente a un esquema en el que todos los grupos sean casi iguales, y todo esto est√° controlado por algunos procesos, pero no por el grupo. <br><br>  Les recuerdo que adem√°s del grupo de juegos con sus BaseApps, CellApps y otros, tenemos un ecosistema. <br><br><img src="https://habrastorage.org/webt/oi/-o/ax/oi-oaxdx4eek4e5omtpwlyp5ism.jpeg"><br><br>  Intentamos asegurarnos de que el rendimiento del ecosistema no afecte la jugabilidad.  En el peor de los casos, por ejemplo, el sistema de torneo no funciona, pero puedes jugar al azar; de todos modos, la mayor√≠a de las personas juegan al azar.  S√≠, bajamos la calidad, pero en general, puedes sobrevivir varias horas sin torneos. <br><br>  Esto no siempre sucede.  En primer lugar, ya existen servicios web que est√°n profundamente integrados en el juego.  Por ejemplo, un √∫nico punto de autorizaci√≥n es un servicio que le permite iniciar sesi√≥n en la web o en alg√∫n lugar en un lugar, y en realidad iniciar sesi√≥n en todo el universo Wargaming. <br><br>  El segundo ejemplo es un servicio que sirve compras y transacciones de juegos.  Tambi√©n tuvo que incorporarse al juego solo porque necesit√°bamos un rastro de las compras del jugador.  El hecho es que en algunas regiones estamos obligados a mostrar informaci√≥n al cliente sobre qu√© propiedad del juego se compr√≥ con dinero real y cu√°l para el dinero del juego.  Inicialmente, el sistema no asum√≠a esto, nadie lo present√≥ hace 5 a√±os, pero la <strong>ley es dura: debe hacerlo, h√°galo</strong> . <br><br><h2>  Puntos de falla del ecosistema de World of Tanks <br></h2><br><h3>  Problema n√∫mero 1. Mayor carga <br></h3><br>  Tenemos un cl√∫ster m√∫ltiple en el que 10 cl√∫steres con una gran cantidad de m√°quinas.  Los jugadores los juegan, y la web es peque√±a.  Nadie compra cinco m√°quinas m√°s en cada centro de datos.  Pero al mismo tiempo, brindamos la misma funcionalidad y todo lo que se necesita dentro del cliente.  Este es el principal problema. <br><br><blockquote>  La interactividad y la reactividad de la interfaz son la fuente principal del aumento de la carga del ecosistema. <br></blockquote><br>  Dar√© dos ejemplos del servicio del clan: <br><br><ol><li>  Quieres invitar a otro jugador al clan.  Por supuesto, quiero que el invitado reciba de inmediato una notificaci√≥n y que pueda unirse a usted.  Para implementar esto, es necesario hacer que el servicio del clan notifique de alguna manera al cliente, o dejar que el cliente pregunte al servicio web de vez en cuando: ‚Äú¬øHa cambiado algo?  ¬øTengo alguna nueva invitaci√≥n?  Esta es la primera opci√≥n de donde puede venir la carga extra. </li><li>  Los tanques tienen un r√©gimen fortificado.  Supongamos que lo juega no una persona, sino varias.  Todos los jugadores tienen una ventana abierta con √°reas fortificadas.  El comandante construy√≥ el edificio.  Es aconsejable que para todos los que tengan esta ventana abierta, el edificio aparezca de inmediato. </li></ol><br>  La decisi√≥n en la frente con la encuesta no es muy buena.  De hecho, est√° funcionando, es solo que necesita asignar tantas capacidades para esto que esta caracter√≠stica no generar√° ning√∫n beneficio para la empresa.  Y si la funci√≥n no genera ganancias, entonces no es necesario que lo haga. <br><br><blockquote>  Mi consejo personal sobre c√≥mo manejar esto: la mejor manera de hacer que el sistema sea m√°s confiable bajo carga es generalmente reducir la carga de alguna manera l√≥gica. </blockquote><br>  No deber√≠as quedarte acostado con hierro, idear sistemas novedosos, optimizar algo; de todos modos, cuanto mayor sea la carga, m√°s artefactos aparecer√°n de los que no puedes escapar.  Adem√°s, los artefactos ocurrir√°n incluso en niveles de abstracci√≥n cada vez m√°s bajos: primero con las aplicaciones, luego con diferentes servicios web, luego acceder√° a la red (Cisco, etc.).  En alg√∫n nivel, simplemente no puede resolver los problemas. <br><br>  Si piensa con cuidado, simplemente se pueden evitar. <br><br>  Lo primero que hicimos fue <strong>aprender a notificar a los clientes a trav√©s de un servidor de juegos</strong> utilizando su infraestructura.  Por ejemplo, cuando llega una invitaci√≥n al clan, le decimos al servidor: "Invitamos a tal o cual gente", y luego el cl√∫ster del cl√∫ster mismo encuentra a qui√©n debe enviarse la notificaci√≥n, especialmente porque tienen una conexi√≥n.  Es decir, empujamos desde el servicio, y no alguien nos vierte constantemente.    ,          ,       .   ,   ,    . <br><br>  ‚Äî  <strong>Web-sockets (nginx-pushstream)</strong> . ,      Web-sockets.   ,      Chromium Embedded Framework ‚Äî  ,   , Web-sockets   Nginx.   pushstream,     Web-sockets       . <br><br><h3>  ‚Ññ 2.    <br></h3><br>  ,    ,   ,  <strong> ‚Äî  </strong> .    ,    ,    ‚Äî    . <strong>    ,    </strong> ,   . <br><br>   ?  : -  , - ,             ,    .   - , , .    . <br><br>        . <br><br><img src="https://habrastorage.org/webt/ul/8f/6m/ul8f6mjlivwkgkswzl-cwtxlx-o.jpeg"><br><br>  ,      <strong>120      </strong> <strong>Game Play</strong> .    .         ,     ,      .      ,          .    . <br><br> <strong> </strong> <br><br>  3  ,   : <br><br><ol><li> HTTP API; </li><li> RabbitMQ ‚Äî  ; </li><li> Apache Kafka     . </li></ol><br>     ,    ,  ,  ,      ,    .     ,  -  ‚Äî ,    .          ,      . <br><br> <strong> </strong> <br><br> <strong>1. HTTP</strong> <br><br>    ‚Äî  HTTP.   ,  ,   -,      .      : <br><br><ul><li>      (  ,     ). <br></li></ul><br> ,    ,       .    ,   , ,  Django,    100  200 ,    API,  .    ,   ,   - 30-40 ,     ,   .   ,   ‚Äî     . <br><br><ul><li>      . <br></li></ul><br>  ,    ,   HTTP, ‚Äî       .      .   ‚Äî  ‚Äî  .   , <strong> ,  , ,  </strong> . <br><br><ul><li>     . <br></li></ul><br>     .   .  - ,   - API ‚Äî    API,        . <br><br>      ‚Äî      ,      . ,   ,      . ,      10 ,  -     100    500. ,    HTTP     .    nginx'   ,       ‚Äî  . <br><br>  ,    HTTP  ,         . <br><br> <strong>2. RabbitMQ</strong> <br><br>    RabbitMQ     BigWord     . <br><br><ul><li>     . <br></li></ul><br>         ‚Äî -  ,   ,  , . <br><br><ul><li>   ¬´¬ª,    ,        . <br></li></ul><br>    :      .    ,     API: ¬´      N    ‚Äî    ¬ª.    ,      , , ,  ‚Äî          .      ,      . <br><br>  ¬´¬ª,   ¬´¬ª,    ‚Äî       . <br><br><ul><li>     . <br></li></ul><br> RabbitMQ  ,      , ,      ,      ,   ,      ,   . <br><br><blockquote>   ‚Äî    RabbitMQ     . </blockquote><br> <strong>3. Kafka</strong> <br><br>     ,    ,     ‚Äî   Kafka.   ,   RabbitMQ   -     . <br><br><ul><li>     . <br></li></ul><br>     ,       ,    ,    .  ,  ,        .      .   Kafka. ,    ‚Äî    ,    . <br><br><ul><li>     . <br></li></ul><br>    ,     .        ,    ,     -  ‚Äî     . <br><br>  Kafka   ,    ,        ,    -   ,       .      . <br><br><h2>    <br></h2><br>      ‚Äî    . <br><br><img src="https://habrastorage.org/webt/ke/ty/oc/ketyocondz4qhsiguntwchhmonq.jpeg"><br><br> : <br><br><ul><li>   <strong> </strong> .         ,   - ,   .. </li><li>   <strong> </strong> ‚Äî  , , , . </li><li>      ‚Äî <strong>      </strong> ,    .       ,    ,   . </li></ul><br>     .     , , ,   entity.   .    ,     ,       . <br><br><h2> DLC <br></h2><br>    ,   DLC (Development Lifecycle) ‚Äî ,  ,   . <br><br><img src="https://habrastorage.org/webt/3c/5t/c2/3c5tc2hlxbrgpdtjts88yxrcp3e.jpeg"><br><br>     ,  ,   . DLC   ,        ,          .       ,  . ,      ,       ,     . <br><br>           DLC,       .     ,        ,    ,  . <br><br>     DLC,   ,    : <br><br> ‚Ä¢ <strong>   (      ).</strong> <br><br>     ,    ,    ¬´- ,   ¬ª,   .     ,       , ,    ,    . <br><br> ‚Ä¢        :   SRE. <br><br>    ,  solution-, technical-owner, reability- ‚Äî       ,   -  ,    game-    .    , ,     ,       .   - ,      ,    ,      ,   .    ,     . <br><br> ‚Ä¢ <strong>SRE    .</strong> <br><br>        ‚Äî  -   .          ,        .    ,  SRE     -.    SRE  ,     : ¬´    ,       ,    ,     ‚Äî   !¬ª      ,   . <br><br>        QA ,    , -  , ,    ‚Äî    . <br><br><h2>  <br></h2><br> BigWorld Technology  ¬´¬ª       .      ,  .         .  ¬´ ¬ª,    . <br><br>  ¬´  ¬ª     ,     ,    .   ‚Äî ¬´¬ª (, ) ‚Äî     .      ,        . , -  . <br><br> <i>:         ++.    ,    40        ,    .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">al final del informe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y escucha, quiz√°s te interesaron algunos aspectos.</font></font></i> <br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La conferencia RootConf est√° cambiando de marca, ahora es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DevOpsConf Rusia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Decidimos organizar una conferencia profesional por separado sobre DevOps el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 y 2 de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> octubre </font><b><font style="vertical-align: inherit;">en Mosc√∫</font></b><font style="vertical-align: inherit;"> , en Infospace. </font><font style="vertical-align: inherit;">Planeamos discutir todos los </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">temas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que son relevantes para los especialistas en sistemas de informaci√≥n. </font><font style="vertical-align: inherit;">Vea qu√© tipo de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solicitudes de informes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recibi√≥ el Comit√© </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">del</font></a><font style="vertical-align: inherit;"> Programa: ¬°hay mucho para elegir!</font></font><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418977/">https://habr.com/ru/post/es418977/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418963/index.html">Revisi√≥n del robot de escritorio DoBot Magician</a></li>
<li><a href="../es418969/index.html">¬øC√≥mo son los √∫ltimos d√≠as de la carrera a $ 1 bill√≥n? (UPD.: Apple gan√≥)</a></li>
<li><a href="../es418971/index.html">Los mapas de radiaci√≥n de J√∫piter son la clave para una nueva exploraci√≥n en Europa</a></li>
<li><a href="../es418973/index.html">Conozca DevOpsConf Rusia</a></li>
<li><a href="../es418975/index.html">C√≥mo medir el √©xito Estrategias de monitoreo y su relaci√≥n con los problemas del negocio.</a></li>
<li><a href="../es418979/index.html">Mientras volaba por todo el pa√≠s, implementando un proyecto para varios miles de empleos</a></li>
<li><a href="../es418981/index.html">M√©todos num√©ricos para resolver ecuaciones el√≠pticas.</a></li>
<li><a href="../es418985/index.html">An√°lisis y dise√±o en su conjunto.</a></li>
<li><a href="../es418987/index.html">Firefox evita f√°cilmente la protecci√≥n en la nueva interfaz de Gmail</a></li>
<li><a href="../es418991/index.html">El microfilm existir√° durante medio milenio.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>