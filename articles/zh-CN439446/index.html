<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍯 🏜️ 👵 您需要了解的JavaScript Engine Switcher 3.0 🤛🏽 👋🏻 👨🏾‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="JavaScript Engine Switcher最初是作为辅助库创建的，其开发很大程度上取决于使用它的库的需求。 实际上，每个主要版本都解决了进一步开发其他库所需的一项或多项主要任务： 


1. 在第一个版本中，此任务是为支持.NET平台的流行JS引擎添加尽可能多的适配器模块。 这为Bundl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>您需要了解的JavaScript Engine Switcher 3.0</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439446/"><p><img src="https://habrastorage.org/webt/qo/zx/ss/qozxssedwxgcrteo4wnodfixdmy.png" alt="JavaScript Engine Switcher第三版的徽标"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JavaScript Engine Switcher</a>最初是作为辅助库创建的，其开发很大程度上取决于使用它的库的需求。 实际上，每个主要版本都解决了进一步开发其他库所需的一项或多项主要任务： </p><br><ol><li>在第一个版本中，此任务是为支持.NET平台的流行JS引擎添加尽可能多的适配器模块。 这为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Bundle Transformer</a>用户提供了一定的灵活性：在开发人员的计算机上，他们可以使用支持使用Visual Studio调试JS代码的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MSIE</a>模块，在没有现代版本Internet Explorer或根本没有安装Internet Explorer的服务器上，他们可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V8</a>模块。 一些人甚至设法使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Jurassic</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Jint</a>模块在Linux和Mac上的Mono中运行Bundle Transformer。 </li><li> 第二个版本的主要任务是实现.NET Core支持，这是新版本的<a href="">ReactJS.NET</a>库所<a href="">必需的</a> 。 另一个重要任务是创建一个跨平台模块，该模块可以快速处理大量JS代码（Jurassic和Jint模块不适合此功能），经过大量改进， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ChakraCore</a>模块成为了这样的模块。 </li><li> 在第三个版本中，主要重点是改善与ReactJS.NET库的集成并提高生产率。 </li></ol><br><p>在本文中，我们将考虑第三版的一些创新，即使阅读了<a href="">发行文本</a>和文档部分<a href="">“如何将应用程序升级到3.X</a>版”，对于许多人来说，这些创新仍然是显而易见的： <code>JsEngineSwitcher</code>类的更改，异常的重组，更多有用的错误消息，中断以及脚本的初步编译，更改ChakraCore和MSIE模块以及基于NiL.JS的新模块的最大堆栈大小的功能。 </p><a name="habracut"></a><br><h2> 对JsEngineSwitcher类的更改 </h2><br><p> 在新版本中， <code>JsEngineSwitcher</code>类实现了<code>IJsEngineSwitcher</code>接口，并且不再是单例（您可以使用<code>new</code>运算符实例化它）。 若要获取全局实例，请使用<code>Current</code>属性而不是<code>Instance</code>属性。 与不推荐使用的<code>Instance</code>属性不同， <code>Current</code>属性的返回类型为<code>IJsEngineSwitcher</code> 。 另外， <code>Current</code>属性具有一个setter，您可以使用该setter替换标准实现： </p><br><pre> <code class="cs hljs">JsEngineSwitcher.Current = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyJsEngineSwitcher();</code> </pre> <br><p> 在安装了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JavaScriptEngineSwitcher.Extensions.MsDependencyInjection</a>程序包的ASP.NET Core Web应用程序中，使用<code>AddJsEngineSwitcher</code>扩展<code>AddJsEngineSwitcher</code>替换实现： </p><br><pre> <code class="cs hljs">… <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Extensions.MsDependencyInjection; … <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { … <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceCollection services</span></span></span><span class="hljs-function">)</span></span> { … services.AddJsEngineSwitcher(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyJsEngineSwitcher(), options =&gt; … ) … ; … } … } …</code> </pre> <br><p> 这些更改几乎总是“破坏”使用旧版JavaScript Engine Switcher的应用程序或库。 因此，您需要对代码进行以下更改： </p><br><ol><li> 将变量，参数或属性的类型从<code>JsEngineSwitcher</code>为<code>IJsEngineSwitcher</code> 。 </li><li> 代替<code>Instance</code>属性，在任何地方使用<code>Current</code>属性。 </li></ol><br><p> 值得注意的是，对于大多数开发人员而言，这些更改不会带来什么好处，因为它们的主要目的是简化单元测试（例如，以前，在ReactJS.NET库的单元测试中，使用了锁，但是现在可以<a href="">不用它们了</a> ）。 </p><br><h2> 重组例外 </h2><br><p> 在第三个版本之前，大多数JS引擎错误都变成了<code>JsRuntimeException</code>类型的<code>JsRuntimeException</code> ，只有引擎初始化过程中发生的错误才变成了<code>JsEngineLoadException</code> 。 还有一个基类<code>JsException</code> ，从中继承了上述两种异常类型，这使得绝对可以截获JS引擎运行期间发生的所有错误。 尽管存在明显的缺点，但这种异常组织方式非常适合用于访问JS引擎基本功能的统一接口的概念。 </p><br><p> 但是随着脚本的中断和预编译的实现（我将在以下各节中讨论它们），需要一种新的组织异常的方法。 首先要做的是添加一种新的异常类型<code>JsInterruptedException</code> ，该异常是通知用户脚本执行中断所必需的。 然后，有必要将脚本处理期间发生的所有错误明确地分为两类：编译错误（分析）和运行时错误。 还需要分离出Chakra和V8的各种特定错误，这些错误与脚本的处理无关。 还必须考虑到Jint引擎中存在异常，该异常是在执行脚本的超时时间（超时）到期时发生的。 结果，形成了一种新的组织异常的方法，可以将其表示为以下层次结构： </p><br><ul><li> <code>JsException</code> <br> <ul><li> <code>JsEngineException</code> <br> <ul><li> <code>JsEngineLoadException</code> </li> </ul></li><li> <code>JsFatalException</code> </li> <li> <code>JsScriptException</code> <br> <ul><li> <code>JsCompilationException</code> </li> <li> <code>JsRuntimeException</code> <br> <ul><li> <code>JsInterruptedException</code> </li> <li> <code>JsTimeoutException</code> </li> </ul></li></ul></li><li> <code>JsUsageException</code> </li> </ul></li><li>  <code>JsEngineNotFoundException</code> <sup>*</sup> </li></ul><br><p>  *-此异常不会在JS引擎级别发生，而是在JavaScript引擎切换器级别发生。 </p><br><p> 我认为上述异常的层次结构不需要注释，因为异常的名称可以说明一切。 通过这种方法，我们不仅可以获得有关错误原因的更多信息，而且可以更灵活地处理某些类型的异常。 </p><br><h2> 统一错误消息格式 </h2><br><p> 以前版本的JavaScript Engine Switcher的另一个问题是难以定位在处理脚本时发生的错误。 从<code>Message</code>异常属性中，很难准确了解代码中错误的发生位置，因此我不得不分析其他异常属性，这并不总是很方便。 此外，现有属性集还不够。 </p><br><p> 因此，向<code>JsScriptException</code>类添加了2个新属性： </p><br><ol><li>  <strong>Type</strong> -JavaScript错误的类型（例如， <code>SyntaxError</code>或<code>TypeError</code> ）； </li><li>  <strong>DocumentName-文档</strong>的名称（通常从以下参数的值中提取： <code>Execute</code>和<code>Evaluate</code>方法的<code>ExecuteFile</code> ， <code>ExecuteFile</code>方法的<code>path</code> <code>ExecuteResource</code>方法的<code>resourceName</code>等）； </li></ol><br><p> 一个新属性也已添加到<code>JsRuntimeException</code>类<strong>-CallStack中</strong> ，该属性包含调用堆栈的字符串表示形式。 </p><br><p> 以前，来自原始.NET异常的相似属性的值或JavaScript错误的字符串表示形式只是被复制到<code>Message</code>属性中。 通常，不同JS引擎中的错误消息不仅在格式上有所不同，而且在其中呈现的有用信息量也有所不同。 例如，由于某些错误消息中缺少行号和列号信息，因此ReactJS.NET库的开发人员被迫<a href="">重新抛出</a>从JavaScript Engine Switcher接收到的<a href="">异常</a> 。 </p><br><p> 因此，我决定在适配器模块级别生成自己的错误消息，该消息将具有单一（统一）格式。 这种格式使用所有可用的错误信息：类型，描述，文档名称，行号，列号，代码片段和调用堆栈。 作为新格式的基础，我从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Microsoft ClearScript</a>库中获取了错误格式。 </p><br><p> 以下是有关由不同适配器模块生成的相同编译错误的消息： </p><br><pre> <code class="plaintext hljs">ChakraCore ========== SyntaxError: Unexpected identifier after numeric literal at declinationOfSeconds.js:12:23 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; Jint ==== SyntaxError: Unexpected token ILLEGAL at declinationOfSeconds.js:12:25 Jurassic ======== SyntaxError: Expected operator but found 'O' at declinationOfSeconds.js:12 MSIE   Classic ===================== SyntaxError: Expected ';' at declinationOfSeconds.js:12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra ActiveScript ================================= SyntaxError: Expected ';' at declinationOfSeconds.js:12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra IE JsRT ============================ SyntaxError: Expected ';' at 12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra Edge JsRT ============================== SyntaxError: Unexpected identifier after numeric literal at declinationOfSeconds.js:12:23 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; NiL === SyntaxError: Unexpected token 'O' at 12:25 V8 == SyntaxError: Invalid or unexpected token at declinationOfSeconds.js:12:24 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; Vroom ===== SyntaxError: Unexpected token ILLEGAL at declinationOfSeconds.js:12:24</code> </pre> <br><p> 运行时错误的类似示例： </p><br><pre> <code class="plaintext hljs">ChakraCore ========== TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) -&gt; newCharValue = typeof charMapping[charValue] !== 'undefined' ? at Global code (Script Document:1:1) Jint ==== TypeError: charMapping is undefined at russian-translit.js:929:26 Jurassic ======== TypeError: undefined cannot be converted to an object at transliterate (russian-translit.js:929) at Global code (Script Document:1) MSIE   Classic ===================== TypeError: 'undefined' is null or not an object at russian-translit.js:929:4 MSIE   Chakra ActiveScript ================================= TypeError: Unable to get property '' of undefined or null reference at russian-translit.js:929:4 MSIE   Chakra IE JsRT ============================ TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) at Global code (Script Document:1:1) MSIE   Chakra Edge JsRT ============================== TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) at Global code (Script Document:1:1) NiL === TypeError: Can't get property "" of "undefined" V8 == TypeError: Cannot read property '' of undefined at transliterate (russian-translit.js:929:37) -&gt; newCharValue = typeof charMapping[charValue] !== 'undefined' ? at Script Document:1:1 Vroom ===== TypeError: Cannot read property '' of undefined at russian-translit.js:929:37</code> </pre> <br><p> 从示例中可以看到，某些JS引擎为我们提供了完全不同的错误描述和列号，我们有时无法始终获得完整的错误数据集，但是尽管有这些缺点，但统一格式为我们提供了有关错误位置的更多信息，而不仅仅是原始错误消息。 </p><br><h2> 本机程序集部署技巧 </h2><br><p> 使用第二版JavaScript Engine Switcher时导致错误的主要原因是，许多开发人员忘记安装包含ChakraCore和V8模块本机程序集的NuGet程序包。 有一次， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ReactJS.NET bugtracker中的帖子</a>也专门讨论了这个问题（也提供<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">俄语翻译</a> ）。 现在，这样的错误主要仅发生于由于某种原因而没有阅读文档的初学者。 </p><br><p>  ReactJS.NET的作者试图使用错误消息中的提示来最小化此类错误的数量，但是这种方法的<a href="">实施不是很成功，</a>这导致了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">更多的混乱</a> 。 提示的想法很好，但是它需要一个根本不同的实现，即在JS引擎的适配器模块级别实现。 在新版本的JavaScript Engine Switcher中，将<code>DllNotFoundException</code>和<code>TypeLoadException</code>异常包装<code>JsEngineLoadException</code>时，此类提示会添加到错误消息中（请参阅<a href="">ChakraCore</a> ， <a href="">V8</a>和<a href="">Vroom</a>模块的实现示例）。 而且，这些技巧很聪明，因为 它们的生成考虑了许多因素：操作系统类型，处理器体系结构和运行时（.NET Framework，.NET Core或Mono）。 </p><br><p> 例如，在Windows操作系统上的64位进程中使用不带本地程序集的ChakraCore模块时，错误消息将如下所示： </p><br><blockquote> 无法创建ChakraCoreJsEngine的实例。 最有可能发生这种情况，因为未找到“ ChakraCore.dll”程序集或其依赖项之一。 尝试通过NuGet安装JavaScriptEngineSwitcher.ChakraCore.Native.win-x64软件包。 此外，您仍然需要安装适用于Visual Studio 2017的Microsoft Visual C ++ Redistributable（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://www.visualstudio.com/downloads/#microsoft-visual-c-redistributable-for-visual-studio-2017</a> ）。 </blockquote><br><p> 该错误消息提示您需要安装JavaScript NuGet程序包EngineSwitcher.ChakraCore.Native.win-x64，并且还提到Windows的ChakraCore需要Microsoft Visual C ++可再发行组件才能使Visual Studio 2017正常工作。如果发生在32位进程中，则将要求用户安装JavaScriptEngineSwitcher.ChakraCore.Native.win-x86软件包。 </p><br><p> 在.NET Core中的Linux上，类似的错误消息如下所示： </p><br><blockquote> 无法创建ChakraCoreJsEngine的实例。 最有可能发生这种情况，因为未找到“ libChakraCore.so”程序集或其依赖项之一。 尝试通过NuGet安装JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64软件包。 </blockquote><br><p> 在这种情况下，建议安装JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64软件包。 </p><br><p> 在Mono中启动时，将显示另一个提示： </p><br><blockquote>  ... JavaScriptEngineSwitcher.ChakraCore.Native.linux- *软件包不支持在Mono下安装，但是您可以手动安装本机程序集（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/Taritsyn/JavaScriptEngineSwitcher/wiki/ChakraCore#linux</a> ）。 </blockquote><br><p> 由于JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64软件包仅与.NET Core兼容，因此工具提示将提供指向有关在Linux上手动部署本机程序集的说明的链接。 </p><br><p> 可以给出更多示例，但这没有任何意义。 </p><br><h2> 中止脚本执行 </h2><br><p> 当我们为用户提供在服务器上执行任意JS代码的机会时，我们面临一个非常严重的问题-我们不知道执行此代码需要花费多长时间。 这可能是大量的非最佳代码或运行无限循环的代码。 无论如何，它将是不受控制的代码，它将无限期地消耗我们服务器的资源。 为了以某种方式控制此过程，我们需要能够中断脚本的执行。 使用纯.NET编写的引擎（例如Jint，Jurassic或NiL.JS）时，我们始终可以将具有取消功能的JS代码作为一个任务开始执行，但是这种方法不适用于其他引擎。 对我们来说幸运的是，C ++引擎具有用于中断脚本的内置机制。 </p><br><p> 为了提供对这些机制的访问，将<code>SupportsScriptInterruption</code>属性和<code>Interrupt</code>方法添加到了<code>IJsEngine</code>接口。 由于并非所有引擎都支持此功能，因此在调用<code>Interrupt</code>方法之前，应始终检查<code>SupportsScriptInterruption</code>属性的值（如果在JavaScript Engine Switcher的早期版本中必须手动运行垃圾收集器，您将立即了解我在说什么）： </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (engine.SupportsScriptInterruption) { engine.Interrupt(); }</code> </pre> <br><p> 并且您需要在与执行脚本的线程不同的单独线程中调用此方法。 调用<code>Interrupt</code>方法后，所有先前运行的<code>Evaluate</code> ， <code>Execute*</code>和<code>CallFunction</code>都将以<code>JsInterruptedException</code> 。 </p><br><p> 由于此API是低级的，因此对于本节开头所述的任务，建议使用以下扩展方法： </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> !NET40 using System.Runtime.ExceptionServices; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> using System.Threading; using System.Threading.Tasks; using JavaScriptEngineSwitcher.Core; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 using JavaScriptEngineSwitcher.Core.Extensions; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> using JavaScriptEngineSwitcher.Core.Resources; … /// &lt;summary&gt; /// Extension methods for &lt;see cref="IJsEngine"/&gt; /// &lt;/summary&gt; public static class JsEngineExtensions { /// &lt;summary&gt; /// Evaluates an expression within a specified time interval /// &lt;/summary&gt; /// &lt;typeparam name="T"&gt;Type of result&lt;/typeparam&gt; /// &lt;param name="engine"&gt;JS engine&lt;/param&gt; /// &lt;param name="expression"&gt;JS expression&lt;/param&gt; /// &lt;param name="timeoutInterval"&gt;Interval to wait before the /// script execution times out&lt;/param&gt; /// &lt;param name="documentName"&gt;Document name&lt;/param&gt; /// &lt;returns&gt;Result of the expression&lt;/returns&gt; /// &lt;exception cref="ObjectDisposedException"/&gt; /// &lt;exception cref="ArgumentNullException"/&gt; /// &lt;exception cref="ArgumentException"/&gt; /// &lt;exception cref="JsCompilationException"/&gt; /// &lt;exception cref="JsTimeoutException"/&gt; /// &lt;exception cref="JsRuntimeException"/&gt; /// &lt;exception cref="JsException"/&gt; public static T Evaluate&lt;T&gt;(this IJsEngine engine, string expression, TimeSpan timeoutInterval, string documentName) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (engine == null) { throw new ArgumentNullException(nameof(engine)); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (engine.SupportsScriptInterruption) { using (var timer = new Timer(state =&gt; engine.Interrupt(), null, timeoutInterval, #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 new TimeSpan(0, 0, 0, 0, -1))) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> Timeout.InfiniteTimeSpan)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> { try { return engine.Evaluate&lt;T&gt;(expression, documentName); } catch (JsInterruptedException e) { throw new JsTimeoutException( Strings.Runtime_ScriptTimeoutExceeded, e.EngineName, e.EngineVersion, e ); } } } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 Task&lt;T&gt; task = Task.Factory.StartNew(() =&gt; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> Task&lt;T&gt; task = Task.Run(() =&gt; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> { return engine.Evaluate&lt;T&gt;(expression, documentName); }); bool isCompletedSuccessfully = false; try { isCompletedSuccessfully = task.Wait(timeoutInterval); } catch (AggregateException e) { Exception innerException = e.InnerException; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (innerException != null) { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 innerException.PreserveStackTrace(); throw innerException; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> ExceptionDispatchInfo.Capture(innerException).Throw(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { throw; } } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (isCompletedSuccessfully) { return task.Result; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { throw new JsTimeoutException( Strings.Runtime_ScriptTimeoutExceeded, engine.Name, engine.Version ); } } } … } …</span></span></code> </pre> <br><p> 此方法是引擎方法<code>Evaluate&lt;T&gt;</code>的附加组件，该方法允许使用<code>timeoutInterval</code>参数设置等待脚本执行的超时。 这种扩展方法的操作原理非常简单。 首先，我们检查引擎是否支持内置的中断机制。 如果是<code>timeoutInterval</code> ，我们将创建一个<code>Timer</code>类的实例，该实例在<code>timeoutInterval</code>参数指定的<code>timeoutInterval</code>间隔后启动<code>Interrupt</code>方法，然后调用<code>Evaluate&lt;T&gt;</code>引擎方法，如果发生错误，则捕获<code>JsInterruptedException</code>并将其包装在<code>JsTimeoutException</code> 。 如果引擎不支持中断，则创建运行引擎的<code>Evaluate&lt;T&gt;</code>方法的<code>Task</code>类的实例，然后将要执行的任务的等待间隔设置为与<code>timeoutInterval</code>参数中的值相等，如果任务在超时之前完成，则抛出<code>JsTimeoutException</code>类型<code>JsTimeoutException</code> 。 以下是使用此扩展方法的示例： </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; … <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core.Helpers; … <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { … <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> expression = <span class="hljs-string"><span class="hljs-string">@"function getRandomInt(minValue, maxValue) { minValue = Math.ceil(minValue); maxValue = Math.floor(maxValue); return Math.floor(Math.random() * (maxValue - minValue + 1)) + minValue; } function sleep(millisecondsTimeout) { var totalMilliseconds = new Date().getTime() + millisecondsTimeout; while (new Date().getTime() &lt; totalMilliseconds) { } } var randomNumber = getRandomInt(1, 10); sleep(randomNumber * 1000); randomNumber;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (IJsEngine engine = JsEngineSwitcher.Current.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = engine.Evaluate&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(expression, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-string"><span class="hljs-string">"randomNumber.js"</span></span>); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">" = {0}"</span></span>, result); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsTimeoutException) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"    JavaScript "</span></span> + <span class="hljs-string"><span class="hljs-string">"   !"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript-  "</span></span> + <span class="hljs-string"><span class="hljs-string">"!"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); } } } … } …</code> </pre> <br><p> 使用扩展方法，我们计算JS表达式的结果。 表达式的结果是一个随机整数，该数字也是该表达式延迟的秒数。 另外，在调用扩展方法时，我们指定3秒的等待间隔。 由于计算表达式的时间在1到10秒之间变化，因此在一种情况下，表达式的结果将显示在控制台上，而在另一种情况下，则显示有关超时的消息。 </p><br><p> 重新<code>CallFunction</code>此扩展方法以调用其他引擎方法（例如，对<code>Execute*</code> ， <code>CallFunction</code>或<code>Evaluate</code>方法的其他重载版本）应该并不困难。 到目前为止，我尚未决定是否将此类扩展方法添加到库本身，因为目前尚不清楚它们将需要多少。 </p><br><h2> 脚本预编译 </h2><br><p> 我被<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">要求在2015年</a>增加对脚本的初步编译的支持。 当时还不清楚这种功能如何适合统一接口的概念。 但是随着时间的流逝，JavaScript引擎切换器开始逐渐出现了对诸如垃圾收集和脚本中断之类的可访问性功能的支持。 在第三版工作的最后阶段，转向初步编译。 </p><br><p> 使用预编译，您可以编译一次脚本，然后多次使用它来初始化JS引擎。 由于预编译脚本不需要解析，因此引擎的初始化会更快。 </p><br><p> 当前，预编译由5个适配器模块支持：ChakraCore，Jint，Jurassic，MSIE（仅在JsRT模式下）和V8。 为了提供对相应引擎机制的访问，在<code>IJsEngine</code>接口中添加了<code>SupportsScriptPrecompilation</code>属性和3个新方法： <code>Precompile</code> ， <code>PrecompileFile</code>和<code>PrecompileResource</code> 。  <code>Precompile*</code>方法返回实现<code>IPrecompiledScript</code>接口的对象的实例。 该对象是可以由引擎的不同实例使用的预编译脚本（为此目的， <code>Execute</code>方法的重载版本）。 考虑一个使用此API的简单示例： </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; … <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core.Helpers; … <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { … <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> sourceCode = <span class="hljs-string"><span class="hljs-string">@"function declinationOfSeconds(number) { var result, titles = ['', '', ''], titleIndex, cases = [2, 0, 1, 1, 1, 2], caseIndex ; if (number % 100 &gt; 4 &amp;&amp; number % 100 &lt; 20) { titleIndex = 2; } else { caseIndex = number % 10 &lt; 5 ? number % 10 : 5; titleIndex = cases[caseIndex]; } result = number + ' ' + titles[titleIndex]; return result; }"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> functionName = <span class="hljs-string"><span class="hljs-string">"declinationOfSeconds"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemCount = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] inputSeconds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[itemCount] { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] outputStrings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[itemCount]; IJsEngineSwitcher engineSwitcher = JsEngineSwitcher.Current; IPrecompiledScript precompiledCode = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> engine = engineSwitcher.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!engine.SupportsScriptPrecompilation) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"{0}  {1}   "</span></span> + <span class="hljs-string"><span class="hljs-string">"  !"</span></span>, engine.Name, engine.Version); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { precompiledCode = engine.Precompile(sourceCode, <span class="hljs-string"><span class="hljs-string">"declinationOfSeconds.js"</span></span>); engine.Execute(precompiledCode); outputStrings[<span class="hljs-number"><span class="hljs-number">0</span></span>] = engine.CallFunction&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(functionName, inputSeconds[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsCompilationException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"     "</span></span> + <span class="hljs-string"><span class="hljs-string">" !"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript-  "</span></span> + <span class="hljs-string"><span class="hljs-string">"!"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; itemIndex &lt; itemCount; itemIndex++) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> engine = engineSwitcher.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { engine.Execute(precompiledCode); outputStrings[itemIndex] = engine.CallFunction&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;( functionName, inputSeconds[itemIndex]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript- "</span></span> + <span class="hljs-string"><span class="hljs-string">" !"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; itemIndex &lt; itemCount; itemIndex++) { Console.WriteLine(outputStrings[itemIndex]); } } … } …</code> </pre> <br><p>    ,         .     <code>SupportsScriptPrecompilation</code>  ,       ,  ,     .     <code>Precompile</code>  ,      ,      <code>JsCompilationException</code> . C   <code>Execute</code>      , ..   .     <code>CallFunction</code>   <code>declinationOfSeconds</code>      .     .   ,    ,           .     3        .  ,        ,        .         ,    ,      . </p><br><p>      ,     ,    .   ,  ,           .       ReactJS.NET.        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JSPool</a> ,         ( <code>System.Runtime.Caching.MemoryCache</code>  .NET Framework 4.X, <code>System.Web.Caching.Cache</code>  ASP.NET 4.X  <code>Microsoft.Extensions.Caching.Memory.IMemoryCache</code>  ASP.NET Core).      ,        (       <a href=""> </a> ).    ,       ReactJS.NET. </p><br><p>      ReactJS.NET .              .        <code>AllowJavaScriptPrecompilation</code>   <code>true</code> . </p><br><p>  ASP.NET 4.X       <code>App_Start/ReactConfig.cs</code> : </p><br><pre> <code class="cs hljs">… <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ReactConfig</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ReactSiteConfiguration.Configuration … .SetAllowJavaScriptPrecompilation(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) … ; … } } …</code> </pre> <br><p>  ASP.NET Core      <code>Startup.cs</code> : </p><br><pre> <code class="cs hljs">… <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { … <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IApplicationBuilder app, IHostingEnvironment env</span></span></span><span class="hljs-function">)</span></span> { … app.UseReact(config =&gt; { config … .SetAllowJavaScriptPrecompilation(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) … ; }); app.UseStaticFiles(); … } } …</code> </pre> <br><p>       ,      .       <a href="">JsExecutionBenchmark</a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">BenchmarkDotNet</a> .        JS-     .    14,9 ,     ,       .          JavaScript Engine Switcher ( 3.0.4). </p><br><p>   ,      .NET Framework 4.7.2: </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup>. </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td rowspan="2"> <sup>ChakraCore</sup> </td><td> <sup></sup> </td><td align="right"> <sup>41,72 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>74,46 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>35,07 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>91,79 </sup> </td></tr><tr><td rowspan="2"> <sup>Jint</sup> </td><td> <sup></sup> </td><td align="right"> <sup>27,19 </sup> </td><td align="right"> <sup>2 812,50</sup> </td><td align="right"> <sup>1 343,75</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 374,58 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>15,54 </sup> </td><td align="right"> <sup>1 296,88</sup> </td><td align="right"> <sup>640,63</sup> </td><td align="right"> <sup>31,25</sup> </td><td align="right"> <sup>7 521,49 </sup> </td></tr><tr><td rowspan="2"> <sup>Jurassic</sup> </td><td> <sup></sup> </td><td align="right"> <sup>455,70 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 575,28 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>78,70 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>7 892,94 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra IE JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>30,97 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>77,75 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>24,40 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>90,58 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra Edge JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>33,14 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>78,40 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>32,86 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>95,48 </sup> </td></tr><tr><td rowspan="2"> <sup>V8</sup> </td><td> <sup></sup> </td><td align="right"> <sup>41,10 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>79,33 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>39,25 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>96,17 </sup> </td></tr></tbody></table><br><p>         ,    .NET —     Jurassic  5,79 ,   Jint  1,75 a.      2     ,      2       .                .      Jurassic,          : Jurassic   JS-  IL-  Reflection.Emit,    .        ,          ,      . Jint           .NET-,    .    Jint      ,             .      ,  Jint    ,    ,            .  Jint  Jurassic        . </p><br><p>      ,   C++,  MSIE   Chakra IE JsRT —     26,93%.    ChakraCore (18,96%),  V8 (4,71%)  MSIE   Chakra Edge JsRT    (0,85%).           Internet Explorer    Edge.            .          (   )      .   ,      -         12-17  (       ).         .       .         . </p><br><p>     .NET Core 2.0    ( V8 ,    Microsoft ClearScript,    ,   .NET Core): </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup>. </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td rowspan="2"> <sup>ChakraCore</sup> </td><td> <sup></sup> </td><td align="right"> <sup>43,65 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,07 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>36,37 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16,59 </sup> </td></tr><tr><td rowspan="2"> <sup>Jint</sup> </td><td> <sup></sup> </td><td align="right"> <sup>24,87 </sup> </td><td align="right"> <sup>2 750,00</sup> </td><td align="right"> <sup>1 375,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 300,25 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>15,25 </sup> </td><td align="right"> <sup>1 281,25</sup> </td><td align="right"> <sup>593,75</sup> </td><td align="right"> <sup>62,50</sup> </td><td align="right"> <sup>7 447,44 </sup> </td></tr><tr><td rowspan="2"> <sup>Jurassic</sup> </td><td> <sup></sup> </td><td align="right"> <sup>469,97 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 511,70 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>80,72 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>7 845,98 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra IE JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>31,50 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>20,28 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>24,52 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,78 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra Edge JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>35,54 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>20,45 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>31,44 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,99 </sup> </td></tr></tbody></table><br><p>      . ,     —  MSIE   Chakra Edge JsRT  (7,69%).           Chakra    . </p><br><h2>        ChakraCore  MSIE </h2><br><p>    ,  Microsoft,    ,    .     IIS    (256   32-   512   64-),     ASP.NET  JS- (,  TypeScript)   .       JavaScript Engine Switcher        .             ,        Node.js (492   32-   984   64-).   ,      ,  -    .        ChakraCore  MSIE    <code>MaxStackSize</code> ,          .         Node.js.       ,             . </p><br><h2>     NiL.JS </h2><br><p>      - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NiL</a> ,      <a href="">NiL.JS</a> . NiL.JS —    JS-,    .NET.      2014 ,        Jurassic  Jint.    —  .         ,       . </p><br><p>     .NET Framework 4.7.2    : </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td> <sup>Jint</sup> </td><td align="right"> <sup>27,19 </sup> </td><td align="right"> <sup>2 812,50</sup> </td><td align="right"> <sup>1 343,75</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 374,58 </sup> </td></tr><tr><td> <sup>Jurassic</sup> </td><td align="right"> <sup>455,70 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 575,28 </sup> </td></tr><tr><td> <sup>NiL</sup> </td><td align="right"> <sup>17,80 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>4 424,09 </sup> </td></tr></tbody></table><br><p>     .NET Core 2.0  : </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td> <sup>Jint</sup> </td><td align="right"> <sup>24,87 </sup> </td><td align="right"> <sup>2 750,00</sup> </td><td align="right"> <sup>1 375,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 300,25 </sup> </td></tr><tr><td> <sup>Jurassic</sup> </td><td align="right"> <sup>469,97 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 511,70 </sup> </td></tr><tr><td> <sup>NiL</sup> </td><td align="right"> <sup>19,67 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>4 419,95 </sup> </td></tr></tbody></table><br><p>       .        ,     (     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   </a> ).   ,   Jint        2016       ,       .   <a href="">   3.0.0 Beta 1353</a> ,    Jint    2,4  ,  NiL.JS  2.5.1200,        . </p><br><p>   NiL.JS  .         -  ,      -  ,    .    Bundle Transformer,  JavaScript Engine Switcher,     Hogan  Handlebars,      ReactJS.NET.              NiL.JS. </p><br><h2> 参考文献 </h2><br><ol><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JavaScript Engine Switcher</a>  GitHub </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> JavaScript Engine Switcher</a> </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">«  JavaScript Engine Switcher 2.X»</a> </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JSPool</a>  GitHub </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  ReactJS.NET</a> </li><li>   <a href="">ReactJS.NET</a>  GitHub </li></ol><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN439446/">https://habr.com/ru/post/zh-CN439446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN439432/index.html">如何在1.5年内成为一名Java开发人员</a></li>
<li><a href="../zh-CN439434/index.html">NestJS-Node.js上的真实后端</a></li>
<li><a href="../zh-CN439436/index.html">在俄罗斯减少小批量电子产品的成本。 WOLNA网络广播案例</a></li>
<li><a href="../zh-CN439440/index.html">实施Zimbra协作开源，通过AD授权，并自动创建邮箱</a></li>
<li><a href="../zh-CN439442/index.html">朱莉娅 报告和文件生成器</a></li>
<li><a href="../zh-CN439448/index.html">您希望毕业生对虚拟化有何疑问？</a></li>
<li><a href="../zh-CN439450/index.html">Milander公司的家用微控制器上的RS-485</a></li>
<li><a href="../zh-CN439454/index.html">程序即艺术-一种新的软件管理范例</a></li>
<li><a href="../zh-CN439456/index.html">时髦播客＃2</a></li>
<li><a href="../zh-CN439458/index.html">我们如何将Republic网站翻译成Kubernetes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>