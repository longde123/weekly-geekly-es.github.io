<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüîß üà∑Ô∏è üîÉ Hacer que el contenido receptivo se cargue en el sitio üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üòÄ üòí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! 

 Estoy haciendo un sitio web para mi proyecto. En el sitio, debe mostrar muchos gifs al mismo tiempo, cada uno pesa bastante bien. Si mue...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hacer que el contenido receptivo se cargue en el sitio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480704/">  Hola Habr! <br><br>  Estoy haciendo un sitio web para mi proyecto.  En el sitio, debe mostrar muchos gifs al mismo tiempo, cada uno pesa bastante bien.  Si muestra todo a la vez, la p√°gina se carga durante mucho tiempo.  Al mismo tiempo, tambi√©n es imposible dar la p√°gina sin GIF (para que puedan descargarse all√≠). <br><br>  A cualquiera que est√© interesado en c√≥mo me ocup√© de este problema, le pido un gato. <br><a name="habracut"></a><br><h2>  En realidad, el problema </h2><br>  Como dije, hay MUCHOS gifs en el sitio, buenos y diferentes.  Puedes ver por ti mismo cu√°ntos de ellos: <a href="https://reface.tech/">reface.tech</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/468/0e4/bb9/4680e4bb9c37c109cfbb02929ac29633.jpg" alt="imagen"><br><br>  Tan pronto como vi la versi√≥n beta del aterrizaje, inmediatamente tuve un problema con la carga: para algunos usuarios, las p√°ginas se estaban cargando durante mucho tiempo.  Para un negocio serio, este, por supuesto, no es el caso. <br><br>  Era necesario resolver esto de alguna manera.  Era imposible sobrevivir con una simple compresi√≥n sin p√©rdidas, ya que en ese momento todo el contenido de los medios ya hab√≠a sido conducido a trav√©s de <a href="https://compressor.io/">compressor.io</a> .  Por lo tanto, era necesario comprimir con p√©rdidas y dar GIF con peor calidad. <br><br>  Pero distribuir contenido multimedia malo a usuarios con buena Internet es una especie de sacrilegio.  Por lo tanto, se decidi√≥ determinar de alguna manera la velocidad de estos de su Internet, y dependiendo de la velocidad para obtener la calidad adecuada. <br><br><h2>  Hacemos un bosquejo aproximado </h2><br>  Tendremos una matriz con una descripci√≥n del contenido multimedia a cargar. <br><br>  Un ejemplo: <br><br><pre><code class="json hljs">[ { <span class="hljs-attr"><span class="hljs-attr">"large"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0.6211118698120117</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"gifs/control/large/control_1.gif"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"middle"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0.5330495834350586</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"gifs/control/middle/control_1.gif"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"small"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0.4901447296142578</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"gifs/control/small/control_1.gif"</span></span> } } ]</code> </pre> <br>  Aqu√≠ en los elementos para el grado apropiado de calidad se encuentra la url y el tama√±o del archivo. <br><br>  Nosotros simplemente: <br><br><ol><li>  Ir a trav√©s de la matriz (al cargar la p√°gina) </li><li>  Lea el tama√±o total cargado para cada grado de calidad </li><li>  Determine si se cargar√° todo en 4 segundos (este es el per√≠odo que personalmente me molesta) </li></ol><br>  En consecuencia, es necesario: <br><br><ol><li>  Vi alg√∫n tipo de cosa que har√° una matriz de este tipo para que todo no cuente con bol√≠grafos (en python) </li><li>  Vio la velocidad de internet </li></ol><br><h2>  Aserrar el medidor de velocidad </h2><br>  Ser√° relativamente simple.  Escribimos en la barra de direcciones de su navegador <a href="httpbin.org/stream-bytes/51200">eu.httpbin.org/stream-bytes/51200</a> .  Se descarga un archivo con una longitud de 51200 bytes.  Lo empujamos a nosotros mismos en p√∫blico (para medir la velocidad de un hosting). <br><br>  Ahora tenemos que verificar cu√°nto oscila el archivo.  Archivaremos una funci√≥n simple para esto, que nos devolver√° la velocidad en megabytes por segundo. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> checkDownloadSpeed(baseUrl, fileSizeInBytes) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, _</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> startTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> axios.get(baseUrl).then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> endTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> duration = (endTime - startTime) / <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bytesPerSecond = (fileSizeInBytes / duration); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> megabytesPerSecond = (bytesPerSecond / <span class="hljs-number"><span class="hljs-number">1000</span></span> / <span class="hljs-number"><span class="hljs-number">1000</span></span>); resolve(megabytesPerSecond); }); }).catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(error); }); }</code> </pre><br>  Es decir, registramos el tiempo de inicio de la descarga, el tiempo de finalizaci√≥n, medimos la diferencia y, dado que conocemos el tama√±o del archivo, simplemente lo dividimos. <br><br>  Ahora escribiremos una funci√≥n que har√° algo a esta velocidad particular: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> getNetworkDownloadSpeed() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> baseUrl = process.env.PUBLIC_URL + <span class="hljs-string"><span class="hljs-string">'/51200'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fileSize = <span class="hljs-number"><span class="hljs-number">51200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> speed = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkDownloadSpeed(baseUrl, fileSize); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Network speed: "</span></span> + speed); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (speed.mbps === <span class="hljs-string"><span class="hljs-string">"Infinity"</span></span>) { SpeedMeasure.speed = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { SpeedMeasure.speed = speed * <span class="hljs-number"><span class="hljs-number">5</span></span>; } }</code> </pre><br>  En general, hay un problema con este c√≥digo: es que la velocidad de conexi√≥n exacta no se determina debido al peque√±o tama√±o del archivo.  Pero descargar algo m√°s es demasiado costoso para nosotros, por lo que simplemente multiplicamos la velocidad resultante por 5. Incluso con un margen, lo tomamos, porque en realidad la velocidad ser√° a√∫n mayor. <br><br>  Ahora archivaremos una funci√≥n que, dependiendo de la velocidad, generar√° la calidad correspondiente: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> getResolution(gifsArray) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> totalSizeLevel1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> totalSizeLevel2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> totalSizeLevel3 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; gifsArray.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; a &lt; gifsArray[i].length; a++) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> element = gifsArray[i][a]; totalSizeLevel1 += element.small.size; totalSizeLevel2 += element.middle.size; totalSizeLevel3 += element.large.size; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">isNaN</span></span>(SpeedMeasure.speed)) { SpeedMeasure.speed = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> timeLevel1 = totalSizeLevel1 / SpeedMeasure.speed; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> timeLevel2 = totalSizeLevel2 / SpeedMeasure.speed; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> timeLevel3 = totalSizeLevel3 / SpeedMeasure.speed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timeLevel3 &lt; APPROPRIATE_TIME_LIMIT) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"large"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timeLevel2 &lt; APPROPRIATE_TIME_LIMIT) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"middle"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"small"</span></span>; } }</code> </pre><br>  Dado que la funci√≥n que cuenta la velocidad es as√≠ncrona para nosotros, SpeedMeasure.speed puede ser cero.  Por defecto, creemos que la velocidad de conexi√≥n es de 1 megabyte por segundo.  Cuando la funci√≥n calcula la velocidad, simplemente volvemos a renderizar el contenedor. <br><br>  Pasamos una matriz de matrices a la funci√≥n getResolution.  Por qu√©  Porque si tenemos varios contenedores en la p√°gina, es m√°s conveniente para nosotros transferir el contenido correspondiente a cada uno de ellos en una matriz, pero debemos considerar la velocidad de descarga de una vez. <br><br><h2>  Ejemplo de uso </h2><br>  Aqu√≠ hay un ejemplo de uso (en React): <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> runFunction() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> speedMeasure = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpeedMeasure(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> speedMeasure.getNetworkDownloadSpeed(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.forceUpdate() } componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.runFunction(); } render() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quality = SpeedMeasure.getResolution([ Control.getControlArray(), Health.getHealthArray() ]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div className="app"&gt; &lt;Presentation /&gt; &lt;Control quality={quality} /&gt; &lt;Health quality={quality} /&gt; &lt;/div&gt; ); }</code> </pre><br>  En consecuencia, cuando se carga nuestra determinaci√≥n de velocidad, el contenedor se procesar√° nuevamente. <br>  Dentro del contenedor (por ejemplo, dentro de Control), simplemente toma el GIF correspondiente de la matriz (por √≠ndice), luego obtiene un objeto por calidad y obtiene una referencia por url.  Todo es simple <br><br><h2>  Escribir un script de Python </h2><br>  Ahora tenemos que comprimir autom√°ticamente los gifs y generar la matriz con la descripci√≥n del contenido. <br><br>  Para comenzar, escribamos un script para la compresi√≥n.  Usaremos gifsicle.  Para contenido de compresi√≥n media, el nivel de compresi√≥n ser√° 80 (de 200), para una caracter√≠stica muy poderosa ser√° 160. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os GIFS_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//Landingv2/"</span></span> COMPRESSOR_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//gifsicle-static"</span></span> NOT_OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"not_optimized"</span></span> OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"optimized"</span></span> GIF_RESIZED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_not_optimized_resized"</span></span> GIF_COMPRESSED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_compressed"</span></span> COMPRESSION_TYPE = [<span class="hljs-string"><span class="hljs-string">"middle"</span></span>, <span class="hljs-string"><span class="hljs-string">"small"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (root, dirs, files) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(GIFS_DIR, topdown=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(files) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> GIF_RESIZED_DIR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: path = root + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + file <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> compression <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> COMPRESSION_TYPE: final_path = path.replace(GIF_RESIZED_DIR, GIF_COMPRESSED_DIR + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + compression + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + OPTIMIZED_DIR) print(path, final_path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> compression == COMPRESSION_TYPE[<span class="hljs-number"><span class="hljs-number">0</span></span>]: rate = <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: rate = <span class="hljs-number"><span class="hljs-number">160</span></span> os.system(<span class="hljs-string"><span class="hljs-string">"echo 0 &gt; "</span></span> + final_path) os.system(COMPRESSOR_DIR + <span class="hljs-string"><span class="hljs-string">" -O3 --lossy={} -o {} {}"</span></span>.format(rate, final_path, path))</code> </pre><br>  Para que las rutas a los archivos sean comprensibles, aqu√≠ est√° la descripci√≥n del directorio de archivos con gifs: <br><br><ol><li>  NOT_OPTIMIZED_DIR - GIF no optimizados </li><li>  GIF_RESIZED_DIR: GIF no optimizados, pero redimensionados de acuerdo con el tama√±o del contenedor para ellos </li><li>  GIF_COMPRESSED_DIR - GIF comprimidos </li></ol><br>  Dentro de las carpetas hay carpetas con nombres de categor√≠a GIF.  Dentro de una carpeta con una carpeta espec√≠fica contiene "grande", "medio" y "peque√±o" (debajo de los tipos de archivos comprimidos). <br><br>  En el script, revisamos el directorio con gifs y para cada archivo hacemos dos tipos de compresi√≥n, llamando al comando de l√≠nea de comando correspondiente. <br><br>  Ahora pasemos al script para crear una matriz con informaci√≥n. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os GIFS_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//Landingv2/"</span></span> COMPRESSOR_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//gifsicle-static"</span></span> NOT_OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"not_optimized"</span></span> OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"optimized"</span></span> GIF_RESIZED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_not_optimized_resized"</span></span> GIF_COMPRESSED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_compressed"</span></span> COMPRESSION_TYPE = [<span class="hljs-string"><span class="hljs-string">"large"</span></span>, <span class="hljs-string"><span class="hljs-string">"middle"</span></span>, <span class="hljs-string"><span class="hljs-string">"small"</span></span>] OUTPUT = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (root, dirs, files) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(GIFS_DIR, topdown=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(files) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> GIF_COMPRESSED_DIR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> NOT_OPTIMIZED_DIR <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root: files.sort() type = root.split(GIFS_DIR)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(GIF_COMPRESSED_DIR)[<span class="hljs-number"><span class="hljs-number">0</span></span>].replace(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) print(type) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> OUTPUT: OUTPUT[type] = [] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(OUTPUT[type]) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: OUTPUT[type].append( { <span class="hljs-string"><span class="hljs-string">"large"</span></span>: { <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">"middle"</span></span>: { <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">"small"</span></span>: { <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } }) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: full_path = root + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + file bytes_size = os.path.getsize(full_path) kilobytes_size = bytes_size / <span class="hljs-number"><span class="hljs-number">1000</span></span> megabytes_size = kilobytes_size / <span class="hljs-number"><span class="hljs-number">1000</span></span> index = int(file.split(<span class="hljs-string"><span class="hljs-string">"_"</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].replace(<span class="hljs-string"><span class="hljs-string">".gif"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> typer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> COMPRESSION_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> typer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root: local_type = typer new_url = <span class="hljs-string"><span class="hljs-string">"gifs/"</span></span> + full_path.replace(GIFS_DIR, <span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"/"</span></span> + GIF_COMPRESSED_DIR, <span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"/"</span></span> + OPTIMIZED_DIR, <span class="hljs-string"><span class="hljs-string">""</span></span>) OUTPUT[type][index][local_type][<span class="hljs-string"><span class="hljs-string">'url'</span></span>] = new_url OUTPUT[type][index][local_type][<span class="hljs-string"><span class="hljs-string">'size'</span></span>] = megabytes_size print(OUTPUT) print(json.dumps(OUTPUT, indent=<span class="hljs-number"><span class="hljs-number">4</span></span>, sort_keys=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>))</code> </pre><br>  Aqu√≠ revisamos las carpetas con los archivos, determinamos el tama√±o del archivo, descubrimos el tipo de compresi√≥n y colocamos la informaci√≥n general en la matriz de SALIDA.  Y luego enviamos esta matriz a la consola para copiarla. <br><br><h2>  Conclusi√≥n </h2><br>  Espero que este art√≠culo te ayude con algo.  Que tengan una buena codificaci√≥n, muchachos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/480704/">https://habr.com/ru/post/480704/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../480690/index.html">Administramos persianas de pulgadas a bajo costo</a></li>
<li><a href="../480692/index.html">MobX o Redux: ¬øcu√°l es mejor para la gesti√≥n del estado de reacci√≥n?</a></li>
<li><a href="../480694/index.html">¬øPodemos dejar de llamar a la accesibilidad y usabilidad de UX?</a></li>
<li><a href="../480700/index.html">Usamos console.log () en Chrome al m√°ximo</a></li>
<li><a href="../480702/index.html">Recursos humanos y talentos, expertos y creativos: c√≥mo fue el octavo Seminario Habrase</a></li>
<li><a href="../480708/index.html">Las d√©cadas est√°n llegando a su fin. ¬øQu√© aplicaciones en Google Play fueron las m√°s descargadas en los √∫ltimos 10 a√±os?</a></li>
<li><a href="../480710/index.html">Refactorizando juegos SFML</a></li>
<li><a href="../480712/index.html">El vuelo con un dos√≠metro en el bolsillo</a></li>
<li><a href="../480714/index.html">C√≥mo agregar c√≥dec a FFmpeg</a></li>
<li><a href="../480716/index.html">Matlab vs. Julia vs. Pit√≥n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>