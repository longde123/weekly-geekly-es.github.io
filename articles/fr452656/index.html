<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÉüèΩ üéë üêä D√©veloppement du ¬´firmware¬ª le plus simple pour les FPGA install√©s dans Redd, et d√©bogage en utilisant le test de m√©moire comme exemple üòª üéûÔ∏è üëå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D'une certaine mani√®re, je ne peux pas exprimer bri√®vement mes pens√©es. L'automne dernier, il y avait un d√©sir de parler plus en d√©tail de l'architect...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppement du ¬´firmware¬ª le plus simple pour les FPGA install√©s dans Redd, et d√©bogage en utilisant le test de m√©moire comme exemple</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452656/">  D'une certaine mani√®re, je ne peux pas exprimer bri√®vement mes pens√©es.  L'automne dernier, il y avait un d√©sir de parler plus en d√©tail de l'architecture PSoC que je ma√Ætrisais, ce qui a donn√© lieu √† une s√©rie d'articles √† ce sujet.  Maintenant, je participe √† la pr√©paration du mat√©riel pour notre complexe de d√©bogage √† distance Redd, qui a √©t√© d√©crit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , et je veux jeter l'exp√©rience accumul√©e sous forme de texte.  Je ne suis pas encore s√ªr, mais il me semble que ce n'est pas encore un article, mais un cycle.  Premi√®rement, c'est ainsi que je vais documenter les m√©thodes de d√©veloppement d√©velopp√©es qui peuvent √™tre utiles √† quelqu'un √† la fois lorsqu'il travaille avec le complexe et en g√©n√©ral, et deuxi√®mement, le concept est encore nouveau, pas tout √† fait √©tabli.  Peut-√™tre, au cours de la discussion des articles, certains commentaires appara√Ætront, dont on peut tirer quelque chose pour l'√©tendre (ou m√™me le modifier).  Par cons√©quent, nous proc√©dons. <br><img src="https://habrastorage.org/webt/lk/xe/c9/lkxec9ijefezvvydvjbmi49ahny.jpeg"><br><a name="habracut"></a><br><br><h2>  Introduction longue </h2><br>  Je n'aime pas vraiment th√©oriser, pr√©f√©rant pr√©senter des choses pratiques √† la fois.  Mais au d√©but du premier article, sans une longue introduction nulle part.  J'y justifie l'approche actuelle du d√©veloppement.  Et tout tourne autour d'une chose: l'heure-homme est une ressource tr√®s co√ªteuse.  Et la question n'est pas seulement dans les termes attribu√©s au projet.  Il est physiquement cher.  S'il est d√©pens√© pour le d√©veloppement du produit final, eh bien, que pouvez-vous faire sans lui nulle part.  Mais quand il est consacr√© √† des travaux auxiliaires, cela, √† mon avis, est mauvais.  Je me souviens que j'avais eu un diff√©rend avec un d√©veloppeur qui avait dit qu'ayant fait des prototypes par lui-m√™me, il √©conomiserait de l'argent pour son entreprise natale.  J'ai fait valoir qu'il passerait environ 3 jours sur la fabrication.  C'est 24 heures-homme.  Nous prenons son salaire pour ces heures, ajoutons la taxe sociale que "l'employeur paie", ainsi que la location du bureau pour ces heures.  Et nous sommes surpris de voir qu'en commandant des planches sur le c√¥t√©, vous pouvez obtenir des co√ªts inf√©rieurs.  Mais c'est moi, j'exag√®re.  En g√©n√©ral, si les co√ªts de main-d'≈ìuvre peuvent √™tre √©vit√©s, ils doivent √™tre √©vit√©s. <br><br>  Quel est le d√©veloppement du ¬´firmware¬ª pour le complexe Redd?  Il s'agit d'un travail auxiliaire.  Le projet principal vivra heureux pour toujours; il doit √™tre r√©alis√© le plus efficacement possible, avec une excellente optimisation, etc.  Mais consacrer du temps et de l'√©nergie √† des choses auxiliaires qui iront aux archives apr√®s le d√©veloppement est un gaspillage.  C'est sur ce principe que le d√©veloppement des √©quipements Redd a √©t√© r√©alis√©.  Toutes les fonctions, si possible, sont impl√©ment√©es comme des choses standard.  Les bus SPI, I2C et UART sont impl√©ment√©s sur des microcircuits FTDI standard et sont programm√©s via des pilotes standard, sans fioritures.  La gestion des bobines est impl√©ment√©e au format d'un port COM virtuel.  Il peut √™tre modifi√©, mais au moins tout a √©t√© fait pour qu'un tel d√©sir ne se manifeste pas.  En g√©n√©ral, tout ce qui est standard, si possible, est impl√©ment√© de mani√®re standard.  De projet en projet, les d√©veloppeurs ont simplement besoin d'√©crire rapidement du code typique pour que le PC acc√®de √† ces bus.  La technique de d√©veloppement en C ++ devrait √™tre √©vidente pour ceux qui d√©veloppent des programmes pour microcontr√¥leurs (nous parlerons de quelques d√©tails techniques dans un autre article). <br><br>  Mais FPGA est seul dans le complexe.  Il est ajout√© au syst√®me pour les cas o√π il est n√©cessaire de mettre en ≈ìuvre des protocoles non standard avec une exigence de performance √©lev√©e.  Si ceux-ci sont n√©cessaires, vous devrez faire le ¬´firmware¬ª pour cela.  Cela concerne la programmation FPGA et je veux parler sp√©cifiquement, juste dans le m√™me but - pour r√©duire le temps de d√©veloppement des choses auxiliaires. <br><br>  Afin de ne pas d√©router le lecteur, je formulerai la pens√©e dans un cadre: <br><blockquote>  Il n'est pas n√©cessaire de r√©aliser le d√©veloppement des FPGA dans chaque projet.  S'il y a suffisamment de contr√¥leurs de bus connect√©s directement au processeur central pour fonctionner avec le p√©riph√©rique cible, vous devez les utiliser. <br>  FPGA a ajout√© au complexe pour la mise en ≈ìuvre de protocoles non standard. </blockquote><br><br><h2>  Sch√©ma fonctionnel du complexe </h2><br>  Regardons le sch√©ma de principe du complexe <br><br><img src="https://habrastorage.org/webt/vf/hv/da/vfhvda1kmsax-zkxaue4xu_ysmk.png"><br><br>  Au bas du circuit se trouve une ¬´calculatrice¬ª.  En fait, c'est un PC standard avec Linux.  Les d√©veloppeurs peuvent √©crire des programmes r√©guliers en C, C ++, Python, etc., qui seront ex√©cut√©s par l'ordinateur.  Dans la partie sup√©rieure droite se trouvent les ports standard des pneus standard.  Sur la gauche se trouve un commutateur pour les appareils standard (Flash SPI, carte SD et plusieurs relais statiques √† faible courant, qui peuvent, par exemple, simuler des pressions de bouton).  Et au centre se trouve pr√©cis√©ment cette partie, dont le travail devrait √™tre envisag√© dans cette s√©rie d'articles.  Son c≈ìur est un FPGA de classe FPGA, √† partir duquel des lignes droites sortent (peuvent √™tre utilis√©es comme paires diff√©rentielles ou lignes ordinaires sans tampon), des lignes GPIO avec un niveau logique configurable, ainsi qu'un bus USB 2.0 impl√©ment√© via une puce ULPI. <br><br><h2>  Poursuite de l'introduction sur l'approche de programmation FPGA </h2><br>  Lors du d√©veloppement d'une logique de contr√¥le hautes performances pour les FPGA, g√©n√©ralement Sa Majest√© est jou√© le premier violon par une machine d'√©tat.  C'est sur les machines qu'il est possible d'impl√©menter une logique rapide mais complexe.  Mais d'un autre c√¥t√©, un automate se d√©veloppe plus lentement qu'un programme pour un processeur, et sa modification est un autre processus.  Il existe des syst√®mes qui simplifient le d√©veloppement et la maintenance des machines.  L'un d'eux a m√™me √©t√© d√©velopp√© par notre entreprise, mais le processus de conception de tout type de logique complexe n'est pas rapide.  Lorsque le syst√®me d√©velopp√© est le produit final, il est logique de pr√©parer, de concevoir une bonne machine de contr√¥le et de consacrer du temps √† sa mise en ≈ìuvre.  Mais comme d√©j√† indiqu√©, le d√©veloppement de Redd est un travail auxiliaire.  Il est con√ßu pour faciliter le processus, pas pour le compliquer.  Par cons√©quent, il a √©t√© d√©cid√© que le d√©veloppement ne serait pas automatique, mais des syst√®mes de processeur. <br><br>  Mais d'un autre c√¥t√©, lors du d√©veloppement du mat√©riel, l'option la plus en vogue √† ce jour, le FPGA avec noyau ARM, a √©t√© rejet√©e.  Tout d'abord, pour des raisons de prix.  Une carte prototype bas√©e sur SoC Cyclone V est mod√©r√©ment ch√®re, mais curieusement, un FPGA s√©par√© est beaucoup plus cher.  Tr√®s probablement, le prix des cartes de prototypage est sous-√©valu√© afin d'inciter les d√©veloppeurs √† utiliser les donn√©es FPGA, et les cartes sont vendues individuellement.  La s√©rie devra prendre des jetons individuels.  Mais en plus, il y a aussi une "seconde".  Deuxi√®mement, lorsque j'exp√©rimentais avec Cyclone V SoC, il s'est av√©r√© que ce syst√®me de processeur n'est pas le cas et est productif en ce qui concerne l'acc√®s unique aux ports.  Lot - oui, le travail est rapide.  Et dans le cas des acc√®s uniques √† une fr√©quence d'horloge du c≈ìur du processeur de 925 MHz, vous pouvez acc√©der aux ports √† une fr√©quence de quelques m√©gahertz.  √Ä tout le monde, je propose d'appeler la fonction standard de saisie de donn√©es dans le FIFO du bloc UART, qui v√©rifie le d√©bordement de la file d'attente, mais en l'appelant lorsque la file d'attente est √©videmment vide, c'est-√†-dire que rien n'interf√®re avec les op√©rations.  Ma productivit√© est pass√©e d'un million √† cinq cent mille appels par seconde (bien s√ªr, travailler avec la m√©moire est all√© √† vitesse normale, tous les caches ont √©t√© r√©gl√©s, m√™me la variante de fonction qui n'a pas v√©rifi√© FIFO pour le d√©bordement a fonctionn√© plus rapidement, seule la fonction en discussion a abondamment m√©lang√© √©crire et lire √† partir des ports).  C'est FIFO!  En fait, FIFO a √©t√© invent√© pour y d√©poser des donn√©es et oublier!  Quittez vite!  Et pas avec des performances, moins d'une m√©ga-op√©ration par seconde √† une fr√©quence processeur de 925 MHz ... <br><br>  La latence est √† bl√¢mer.  Entre le c≈ìur du processeur et l'√©quipement se trouve √† partir de trois ponts ou plus.  De plus, la vitesse d'acc√®s aux ports d√©pend du contexte (plusieurs enregistrements cons√©cutifs iront rapidement, mais la premi√®re lecture arr√™tera le processus jusqu'√† ce que les donn√©es mises en cache soient compl√®tement d√©charg√©es, trop d'enregistrements cons√©cutifs ralentiront √©galement, car les tampons d'√©criture sont √©puis√©s).  Enfin, l'examen des traces accumul√©es dans le tampon de d√©bogage a montr√© que l'architecture <b>Cortex A</b> peut ex√©cuter la m√™me partie pour un nombre diff√©rent de cycles d'horloge en raison du syst√®me de cache complexe.  En somme, en consid√©rant tous ces facteurs (prix, baisse des performances lors du travail avec les √©quipements, instabilit√© de la vitesse d'acc√®s aux √©quipements, d√©pendance g√©n√©rale au contexte), il a √©t√© d√©cid√© de ne pas mettre une telle puce dans le complexe. <br><br>  Les exp√©riences avec le PSoC de Cypress ont montr√© que le noyau <b>Cortex M</b> donne des r√©sultats plus pr√©visibles et reproductibles, mais la capacit√© logique et la fr√©quence de fonctionnement maximale de ces contr√¥leurs ne correspondaient pas aux sp√©cifications techniques, ils ont donc √©galement √©t√© jet√©s. <br><br>  Il a √©t√© d√©cid√© d'installer un FPGA Cyclone IV typique peu co√ªteux et de recommander l'utilisation d'un c≈ìur de processeur NIOS II synth√©tis√©.  Eh bien, et si n√©cessaire - pour effectuer le d√©veloppement en utilisant d'autres m√©thodes (machines automatiques, logique dure, etc.). <br><br><blockquote>  Je mentionnerai s√©par√©ment (et m√™me soulignerai ce paragraphe) que le processeur principal du complexe est x86 (x64).  C'est lui qui est le processeur central du syst√®me.  C'est sur lui que s'ex√©cute la logique principale du complexe.  Le syst√®me de processeur, qui sera discut√© ci-dessous, est con√ßu pour fournir simplement la logique du fonctionnement de l'√©quipement "flash√©" dans le FPGA.  De plus, cet √©quipement n'est vendu que si les d√©veloppeurs n'ont pas suffisamment de modules √† temps plein connect√©s directement au processeur central. </blockquote><br><br><h2>  Le processus de d√©veloppement et de d√©bogage du "firmware" </h2><br>  Si le complexe Redd ex√©cute Linux, cela ne signifie pas que le d√©veloppement doit √™tre effectu√© dans ce syst√®me d'exploitation.  Redd est un ex√©cuteur distant, et le d√©veloppement doit √™tre effectu√© sur votre ordinateur, quel que soit le syst√®me d'exploitation.  Celui qui a Linux est d'autant plus facile, mais qui est habitu√© √† Windows (j'aimais beaucoup WIN 3.1, mais j'ai √©t√© forc√© de travailler, mais quelque part au moment de WIN95 OSR2, je m'y suis habitu√©, et maintenant il est inutile de le g√©rer, il est plus facile d'accepter) , ceux-ci peuvent continuer √† en diriger le d√©veloppement. <br><br>  √âtant donn√© que mon amiti√© avec Linux n'a pas fonctionn√©, je ne donnerai pas d'instructions √©tape par √©tape pour configurer l'environnement sous celui-ci, mais je me limiterai √† des mots g√©n√©raux.  Qui travaille avec ce syst√®me d'exploitation sera suffisant pour cela, et pour le reste ... Croyez-moi, il est plus facile de contacter les administrateurs syst√®me.  Au final, c'est exactement ce que j'ai fait.  Mais n√©anmoins. <br><br>  Vous devez t√©l√©charger et installer Quartus Prime Programmer et Tools de la m√™me version que votre environnement de d√©veloppement.  Si les versions ne correspondent pas, il peut y avoir des surprises.  J'ai pass√© toute la soir√©e √† comprendre ce fait.  Par cons√©quent, t√©l√©chargez simplement l'outil de la m√™me version que l'environnement de d√©veloppement. <br><br>  Apr√®s l'installation, entrez le r√©pertoire dans lequel le programme a √©t√© install√©, le sous-r√©pertoire bin.  En g√©n√©ral, le fichier le plus important doit √™tre jtagconfig.  Si vous l'ex√©cutez sans arguments (au fait, j'ai constamment demand√© √† entrer ./jtagconfig et seulement ainsi), alors une liste des programmeurs disponibles dans le syst√®me et des FPGA connect√©s √† eux sera affich√©e.  Il devrait y avoir un USB Blaster.  Et le premier probl√®me que le syst√®me lance n'est pas assez de droits d'acc√®s pour fonctionner avec USB.  Comment le r√©soudre sans recourir √† sudo est d√©crit ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">radiotech.kz/threads/nastrojka-altera-usb-blaster-v-ubuntu-16-04.1244</a> <br><br>  Mais voici une liste des appareils affich√©s.  Vous devez maintenant √©crire: <br><pre><code class="plaintext hljs">./jtagconfig --enableremote &lt;password&gt;</code> </pre> <br>  apr√®s quoi le serveur est lanc√©, accessible de n'importe o√π sur le r√©seau. <br><br>  Tout irait bien, mais le pare-feu du syst√®me ne permettra √† personne de voir ce serveur.  Une v√©rification sur Google a montr√© que pour chaque type de Linux (dont il y en a beaucoup), les ports du pare-feu s'ouvrent √† leur mani√®re, et autant de sorts doivent √™tre lanc√©s que je pr√©f√®re contacter les administrateurs. <br>  Il convient √©galement de consid√©rer que si jtagd n'√©tait pas enregistr√© en ex√©cution automatique, alors lorsque vous ouvrirez l'acc√®s √† distance, vous serez inform√© qu'il est impossible de d√©finir un mot de passe.  Pour √©viter que cela ne se produise, jtagd doit √™tre d√©marr√© non pas au moyen de jtagconfig lui-m√™me, mais avant lui. <br><br>  En g√©n√©ral, le chamanisme est sur le chamanisme.  Permettez-moi de corriger la th√®se: <br><ul><li>  le port entrant 1309 doit √™tre ouvert dans le syst√®me. Quel protocole, je n'ai pas bien compris, pour plus de fiabilit√©, vous pouvez ouvrir √† la fois tcp et udp; </li><li>  lors du d√©marrage de jtagconfig sans argument, l'USB Blaster et le FPGA connect√© doivent √™tre affich√©s, et non un message d'erreur; </li><li>  Avant d'ouvrir un travail √† distance, jtagd avec des droits suffisants doit √™tre en cours d'ex√©cution.  Si jtagd avec des droits insuffisants a d√©j√† √©t√© lanc√©, son processus doit √™tre termin√© avant un nouveau d√©marrage, sinon un nouveau d√©marrage n'aura pas lieu; </li><li>  en fait, l'acc√®s √† distance est ouvert avec la ligne <pre> <code class="plaintext hljs">jtagconfig --enableremote &lt;password&gt;</code> </pre> </li></ul><br>  Il existe bien s√ªr un chemin similaire qui passe par l'interface graphique, mais il est plus logique de tout faire en batch.  Par cons√©quent, j'ai d√©crit une version batch.  Lorsque toutes ces th√®ses sont termin√©es (et que les administrateurs syst√®me les ont termin√©es), nous lan√ßons le programmateur sur notre machine, nous voyons un message sur le manque d'√©quipement.  Cliquez sur Configuration mat√©rielle: <br><img src="https://habrastorage.org/webt/cj/bq/jh/cjbqjhzydanq__godqnyhq8_ah8.png"><br><br>  Acc√©dez √† l'onglet Param√®tres JTAG et cliquez sur Ajouter un serveur: <br><img src="https://habrastorage.org/webt/xn/36/8a/xn368ajq_d5kjx-nxyyvculmpus.png"><br><br>  Nous entrons l'adresse r√©seau de Redd (pour moi c'est 192.168.1.100) et le mot de passe: <br><img src="https://habrastorage.org/webt/kd/ro/7y/kdro7ya9kr8od0uwvcv6hycn0eu.png"><br><br>  Nous nous assurons que la connexion a r√©ussi. <br><br>  J'ai pass√© trois vacances en mai pour y parvenir, puis les administrateurs ont tout d√©cid√©. <br><img src="https://habrastorage.org/webt/8h/gp/x0/8hgpx0r19klfwbp7fqd0atfesvq.png"><br><br>  Basculez vers l'onglet Param√®tres du mat√©riel, ouvrez la liste d√©roulante et s√©lectionnez le programmeur √† distance: <br><img src="https://habrastorage.org/webt/-2/cf/te/-2cfteubqycs6lr1h8bniz92epi.png"><br><br>  Tout, maintenant il peut √™tre utilis√©.  Le bouton D√©marrer est d√©verrouill√©. <br><img src="https://habrastorage.org/webt/a_/9m/t9/a_9mt9509lhs8muotyfcxh9wwtw.png"><br><br><h2>  Le premier "firmware" </h2><br>  Eh bien.  Pour que l'article ait une r√©elle valeur pratique, analysons le ¬´firmware¬ª le plus simple r√©alis√© √† l'aide des m√©thodes ci-dessus.  La chose la plus simple que j'ai vraiment r√©ussi √† impl√©menter pour le complexe est un test de la puce SDRAM.  Ici sur cet exemple et pratique. <br><br>  Il existe un certain nombre de c≈ìurs amateurs pour prendre en charge la SDRAM, mais ils fonctionnent tous de mani√®re d√©licate.  Et rendre compte de toutes les astuces est le travail.  Nous allons essayer d'utiliser des solutions pr√™tes √† l'emploi qui peuvent √™tre ins√©r√©es dans le syst√®me informatique NIOS II, nous allons donc utiliser le noyau de contr√¥leur SDRAM standard.  Le c≈ìur lui-m√™me est d√©crit dans le document <b>Embedded Peripherals IP User Guide</b> , et beaucoup d'espace dans la description est consacr√© au d√©calage d'horloge pour la SDRAM par rapport √† l'horloge du c≈ìur.  Des calculs th√©oriques complexes et des formules sont donn√©s, mais ce qu'il faut faire n'est pas particuli√®rement rapport√©.  Que faire peut √™tre trouv√© dans le document <b>Utilisation de la SDRAM sur la carte DE0 d'Altera avec Verilog Designs</b> .  Au cours de l'analyse, j'appliquerai les connaissances de ce document. <br><br>  Je d√©velopperai la version gratuite de Quartus Prime 17.0.  Je me concentre sur cela, car lors de l'assemblage, ils me disent qu'√† l'avenir, le noyau du <b>contr√¥leur SDRAM</b> sera expuls√© de la version gratuite.  Si cela s'est d√©j√† produit dans votre environnement de d√©veloppement, personne ne se soucie de t√©l√©charger la 17e version gratuite et de l'installer sur une machine virtuelle.  Le travail principal se fait o√π que vous soyez, et le firmware pour Redd avec SDRAM est dans la 17e version.  Eh bien, c'est si vous utilisez les options gratuites.  Personne n'a encore menac√© de le jeter de ceux pay√©s.  Mais j'√©tais distrait.  Cr√©ez un nouveau projet: <br><img src="https://habrastorage.org/webt/qv/sw/eq/qvsweqv-lktrkcs5keaxu8q_5se.png"><br><br>  Appelons-le SDRAM_DEMO.  Le nom doit √™tre rappel√©: je vais effectuer un d√©veloppement ultra-rapide, donc le syst√®me de processeur lui-m√™me devrait √™tre au niveau sup√©rieur, sans aucune couche Verilog.  Et pour que cela se produise, le nom du syst√®me de processeur doit correspondre au nom du projet.  Alors souviens-toi. <br><img src="https://habrastorage.org/webt/fv/yf/-p/fvyf-p3vwrjspjlvvd5tqdm2ndi.png"><br><br>  En accord avec les valeurs par d√©faut en quelques √©tapes, nous arrivons au choix d'un cristal.  Nous s√©lectionnons l'EP4CE10E22C7 utilis√© dans le complexe. <br><img src="https://habrastorage.org/webt/n6/du/8e/n6du8ejpw_xysdx7dui4f_rc2qi.png"><br><br>  Dans l'√©tape suivante, par habitude, je choisis la mod√©lisation dans ModelSim-Altera.  Aujourd'hui, nous ne mod√©liserons rien, mais tout peut √™tre utile.  Il vaut mieux d√©velopper une telle habitude et la suivre: <br><img src="https://habrastorage.org/webt/ym/on/v2/ymonv28mmot9o4frulumjznujk8.png"><br><br>  Le projet est cr√©√©.  Passez imm√©diatement √† la cr√©ation du syst√®me de processeur (Tools-&gt; Platform Designer): <br><img src="https://habrastorage.org/webt/qv/tb/t8/qvtbt8vbulg78qybfcpdb1jqaja.png"><br><br>  Nous avons cr√©√© un syst√®me contenant une horloge et un module de r√©initialisation: <br><img src="https://habrastorage.org/webt/xg/bz/o3/xgbzo3yoi-jrtmaiqhd_fz1vp_q.png"><br><br>  Mais comme je l'ai d√©j√† mentionn√©, une synchronisation sp√©ciale est requise pour le noyau SDRAM.  Par cons√©quent, le module standard est jet√© sans piti√© <br><img src="https://habrastorage.org/webt/2e/yv/_0/2eyv_0ufhrwtnap8vdyryftspus.png"><br><br>  Et √† la place, ajoutez le bloc University Program-&gt; System et SDRAM Clock for DE-series boards: <br><img src="https://habrastorage.org/webt/ho/tf/nd/hotfndwnreutxuoycv3rh-lhz_m.png"><br><br>  Dans les propri√©t√©s, s√©lectionnez DE0-Nano, car l'inspiration pour le circuit de commutation SDRAM a √©t√© tir√©e de cette planche √† pain: <br><img src="https://habrastorage.org/webt/lc/0f/tl/lc0ftl82cyh0yjpj4baklxmyddc.png"><br><br>  Nous commen√ßons √† bourrer notre syst√®me de processeur.  Bien s√ªr, la premi√®re chose √† ajouter est le c≈ìur du processeur lui-m√™me.  Que ce soit Processeur et p√©riph√©riques-&gt; Processeurs int√©gr√©s-&gt; Processeur NIOS II. <br><img src="https://habrastorage.org/webt/28/sl/n4/28sln4t0khej0gnfh9v9honohu4.png"><br><br>  Pour lui, nous ne remplissons pas encore de propri√©t√©s.  Cliquez simplement sur Terminer, m√™me si nous avons form√© une s√©rie de messages d'erreur.  Jusqu'√† pr√©sent, aucun √©quipement ne permet d'√©liminer ces erreurs. <br><br>  Ajoutez maintenant la SDRAM r√©elle.  Interfaces et contr√¥leurs de m√©moire-&gt; SDRAM-&gt; Contr√¥leur SDRAM. <br><img src="https://habrastorage.org/webt/ov/ro/fk/ovrofkityrsnw3vcttpjnwcwhzw.png"><br><br>  Ici, nous devons nous accrocher au remplissage des propri√©t√©s.  S√©lectionnez le microcircuit le plus proche dans l'organisation similaire dans la liste et cliquez sur Apppy.  Ses propri√©t√©s tombent dans les champs Memory Profile: <br><img src="https://habrastorage.org/webt/de/hv/e_/dehve_t_smpdsm3ailji3mhf0u8.png"><br><br>  Maintenant, nous modifions la largeur du bus de donn√©es √† 16, le nombre de lignes d'adresse √† 13 et les colonnes √† 9. <br><img src="https://habrastorage.org/webt/2m/7h/0o/2m7h0otrg1pjp_jchcdmfa1uzvg.png"><br><br>  Je ne corrige pas encore l'heure, peut-√™tre qu'√† l'avenir, cette recommandation sera modifi√©e. <br>  Le syst√®me processeur implique un programme.  Le programme doit √™tre stock√© quelque part.  Nous allons tester la puce SDRAM.  Pour le moment, nous ne pouvons pas lui faire confiance.  Par cons√©quent, pour stocker le programme, ajoutez de la m√©moire bas√©e sur le bloc RAM FPGA.  Fonctions de base -&gt; M√©moire sur puce -&gt; M√©moire sur puce (RAM ou ROM): <br><img src="https://habrastorage.org/webt/ry/ot/-e/ryot-emahnalpamwnkyn1xwcihc.png"><br><br>  Volume ... Eh bien, que ce soit 32 kilo-octets. <br><img src="https://habrastorage.org/webt/mk/jc/gb/mkjcgbjb57ibhy0xeob8mg84nfo.png"><br><br>  Cette m√©moire doit √™tre charg√©e quelque part.  Pour cela, cochez la case Activer le fichier d'initialisation non par d√©faut et entrez un nom de fichier significatif.  Disons firmware.hex: <br><img src="https://habrastorage.org/webt/bh/mf/7a/bhmf7ajkwxp8gixms4bgvy9cp08.png"><br><br>  L'article est d√©j√† compliqu√©, nous ne le surchargerons donc pas.  Nous afficherons simplement le r√©sultat physique du test sous la forme de lignes PASS / FAIL (et nous verrons le r√©sultat logique avec mon d√©bogage JTAG pr√©f√©r√©).  Pour ce faire, ajoutez le port GPIO.  Processeurs et p√©riph√©riques-&gt; P√©riph√©riques-&gt; PIO (Parallel IO): <br><img src="https://habrastorage.org/webt/_p/qn/tw/_pqntwmv-ivkyl3zkrwnxcb5wum.png"><br><br>  Dans les propri√©t√©s que nous d√©finissons 2 bits, j'aime aussi cocher la case pour le contr√¥le individuel des bits.  Aussi juste une habitude. <br><img src="https://habrastorage.org/webt/a7/bk/j4/a7bkj4ophwwlkeog2laba81emds.png"><br><br>  Nous avons un tel syst√®me avec un tas d'erreurs: <br><img src="https://habrastorage.org/webt/w_/4p/o2/w_4po2omowqkf35ge_6-ygmdpl4.png"><br><br>  Nous commen√ßons √† les √©liminer.  Pour commencer, nous allons casser l'horloge et r√©initialiser.  Au niveau de l'unit√© d'horloge et de r√©initialisation, les entr√©es doivent √™tre supprim√©es.  Pour ce faire, il existe des champs qui disent "Double-cliquez pour exporter": <br><img src="https://habrastorage.org/webt/bw/gx/w1/bwgxw1cczmqvwzfy3iruazvzzn8.png"><br><br>  On clique, mais on donne des noms plus ou moins courts. <br><img src="https://habrastorage.org/webt/be/xc/id/bexcidwci8wqdctpttm_uqnsgwo.png"><br><br>  Vous devez √©galement supprimer la sortie d'horloge SDRAM: <br><img src="https://habrastorage.org/webt/bs/bp/6j/bsbp6j_uz7vlmsnpwvg17cbcqko.png"><br><br>  Nous s√©parons maintenant sys_clk √† toutes les entr√©es d'horloge et reset_source √† toutes les lignes de r√©initialisation.  Vous pouvez frapper doucement les points reliant les lignes correspondantes avec la ¬´souris¬ª, ou vous pouvez aller √† la sortie correspondante, appuyer sur le bouton droit de la souris, puis aller dans le sous-menu Connexions dans le menu d√©roulant et s√©lectionner les connexions l√†-bas. <br><img src="https://habrastorage.org/webt/8t/2q/v4/8t2qv4btxo3ygqw6q3bjqa23hae.png"><br><br><img src="https://habrastorage.org/webt/ag/as/sz/agasszsc45aobhbaephagupfwja.png"><br><br>  Ensuite, nous connectons les pneus ensemble.  Nous connectons Data Master √† tous les bus de tous les appareils, et Inctruction Master - √† presque tous.  Il n'est pas n√©cessaire de le connecter au bus PIO_0.  √Ä partir de l√†, les instructions ne seront certainement pas lues. <br><img src="https://habrastorage.org/webt/rb/fl/av/rbflavgwws5gsdpmtqrrqlp-v0s.png"><br><br>  Vous pouvez maintenant r√©soudre les conflits d'adresses.  Pour ce faire, s√©lectionnez l'√©l√©ment de menu Syst√®me-&gt; Attribuer des adresses de base: <br><img src="https://habrastorage.org/webt/ri/pk/te/ripkteta-ftnbrdgjtyj8cabtq8.png"><br><br>  Et lorsque nous avons des adresses, nous pouvons √©galement attribuer des vecteurs.  Pour ce faire, acc√©dez aux propri√©t√©s du c≈ìur du processeur (pointez-le, appuyez sur le bouton droit de la souris et s√©lectionnez l'√©l√©ment de menu Modifier) ‚Äã‚Äãet configurez-y les vecteurs sur la m√©moire Onchip.  S√©lectionnez simplement ce type de m√©moire dans les listes d√©roulantes, les num√©ros seront eux-m√™mes substitu√©s. <br><img src="https://habrastorage.org/webt/aj/om/nn/ajomnnjye5kuskwbtquacdxqbkw.png"><br><br>  Il ne reste aucune erreur.  Mais deux avertissements demeurent.  J'ai oubli√© d'exporter les lignes SDRAM et PIO. <br><img src="https://habrastorage.org/webt/gn/ux/2m/gnux2mk6ikcgsuzin6xbpmyoiwe.png"><br><br>  Comme nous l'avons d√©j√† fait pour la r√©initialisation et le bloc d'horloge, double-cliquez sur les jambes requises et donnez-leur les noms les plus courts (mais compr√©hensibles): <br><img src="https://habrastorage.org/webt/ea/bp/pq/eabppqnnarmd3fqbtytqbfoxteg.png"><br><br>  Tout, il n'y a plus d'erreurs ou d'avertissements.  Enregistrez le syst√®me.  De plus, le nom doit co√Øncider avec le nom du projet, afin que le syst√®me de processeur devienne un √©l√©ment de niveau sup√©rieur dans le projet.  N'avez-vous pas oubli√© ce que nous l'appelions? <br><img src="https://habrastorage.org/webt/hc/gh/7v/hcgh7vmhtfvsziy7idu7pdgbbuo.png"><br><br><img src="https://habrastorage.org/webt/3w/pl/rr/3wplrrqclfbkfquzndakoonrmdw.png"><br><br>  Eh bien, nous appuyons sur le bouton le plus important - g√©n√©rer du HDL. <br><img src="https://habrastorage.org/webt/1t/hm/im/1thmimhmf_xc3taykvi8ct1t6ae.png"><br><br>  Tout, la partie processeur est cr√©√©e.  Cliquez sur Terminer.  On nous rappelle qu'il serait bien d'ajouter ce syst√®me de processeur au projet: <br><img src="https://habrastorage.org/webt/d1/cf/lv/d1cflvqskri1-jrh1ybgflbmglg.png"><br><br>  Ajouter: <br><img src="https://habrastorage.org/webt/3n/yj/gl/3nyjglrcg5dxdngcghpufpgmot8.png"><br><br>  Et l√†, en utilisant le bouton Ajouter, nous obtenons l'image suivante: <br><img src="https://habrastorage.org/webt/wm/jl/p8/wmjlp82jua7ilcvlosa65g98iqy.png"><br><br>  Le fichier SIP n'a pas encore √©t√© cr√©√©.  Oui, et nous n'en avons pas besoin dans le cadre de cet article. <br><br>  Uhhhh  La premi√®re √©tape a √©t√© franchie.  Nous r√©digeons le projet afin que le syst√®me d√©couvre la hi√©rarchie du projet et les √©tapes utilis√©es.  Les erreurs de compilation ne sont pas effrayantes.  Juste dans la version gratuite de l'environnement, des noyaux ont √©t√© cr√©√©s qui ne fonctionnent que lorsque l'adaptateur JTAG est connect√©.  Mais dans le complexe Redd, il est toujours connect√©, car il est divorc√© sur un tableau commun, c'est-√†-dire que nous n'avons rien √† craindre.  Nous ignorons donc ces erreurs. <br><img src="https://habrastorage.org/webt/0b/hk/jo/0bhkjo904iqlqnjcpaf-iinssba.png"><br><br>  Revenons maintenant √† la description du noyau SDRAM.  Il indique que la ligne CKE n'est pas utilis√©e et est toujours connect√©e √† l'unit√©.  En effet, dans le cadre du complexe, les jambes FPGA ne sont pas seulement ch√®res, mais une ressource pr√©cieuse.  Et il serait idiot d'√©carter la jambe, qui est toujours dans l'unit√© (et sur la carte DE0-NANO elle n'est pas non plus divorc√©e).  Il y aurait un calque Verilog, la cha√Æne correspondante pourrait y √™tre coup√©e, mais je gagne du temps (rires nerveux, en regardant le volume du document d√©j√† obtenu, mais sans le sauvegarder il se serait av√©r√© encore plus).  Par cons√©quent, il n'y a pas de couche.  Comment √™tre  Acc√©dez √† l'√©diteur d'affectation.  Il y est, car dans Pin Planner, √† en juger par les descriptions, il n'y a pas de fonctionnalit√© similaire. <br><img src="https://habrastorage.org/webt/wa/mn/li/wamnlimpfzqz8n4xguihx3jciwe.png"><br><br>  Il n'y a toujours pas de ligne.  Bon.  Cr√©ez-en un nouveau <br><img src="https://habrastorage.org/webt/nd/hr/b_/ndhrb_1xgzvlhllnqj2zjrrq50i.png"><br><br>  Nous s√©lectionnons l'ic√¥ne suivante: <br><img src="https://habrastorage.org/webt/_c/mg/o5/_cmgo53jkcsq4z4i5lzfdvn_s-a.png"><br><br>  Dans le syst√®me de recherche que nous avons d√©fini, cliquez sur Liste et dans les r√©sultats de recherche, nous trouvons notre CKE: <br><img src="https://habrastorage.org/webt/s2/r8/9t/s2r89tiymksz4ohpxv_6mudnqoy.png"><br><br>  Ajoutez-le √† la colonne de droite, cliquez sur OK. <br><img src="https://habrastorage.org/webt/xv/fd/jy/xvfdjyxtnasndf8a_xara0wzpom.png"><br><br>  Nous obtenons la liste suivante: <br><img src="https://habrastorage.org/webt/g7/qn/-k/g7qn-kbokf172_5s4o0gvyjk2fk.png"><br><br>  Dans le champ jaune, cliquez sur la liste d√©roulante et recherchez Virtual Pin.  Nous choisissons.  Le jaune s'est d√©plac√© vers une autre cellule: <br><img src="https://habrastorage.org/webt/x0/1h/4a/x01h4aaksdrgol8_wyoe3cnwaji.png"><br><br>  L√†, nous s√©lectionnons On: <br><img src="https://habrastorage.org/webt/qw/5b/bl/qw5bblpjq2fswujalhmvlcgpew0.png"><br><br>  Tout jaunissement a disparu.  Et la cha√Æne est d√©sormais marqu√©e comme virtuelle, ce qui signifie qu'elle ne n√©cessite pas de jambe physique.  Par cons√©quent, nous ne pouvons pas l'assigner √† la conclusion physique du FPGA.  Fermez l'√©diteur d'affectation, ouvrez le planificateur de broches.  Vous pouvez attribuer les jambes, en vous r√©f√©rant √† la figure, ou vous pouvez prendre la liste du fichier * .qsf, qui fait partie du projet, que je joindrai √† l'article. <br><br><img src="https://habrastorage.org/webt/wn/aj/kc/wnajkcjd97ko1cd7hmasi67ifq0.png"><br><br>  √áa y est, fermez Pin Planner, nous r√©alisons la compilation finale du projet.  Le mat√©riel est pr√™t, nous proc√©dons au d√©veloppement du logiciel pour le syst√®me de processeur r√©sultant.  Mais l'article s'est av√©r√© si √©norme que nous le ferons la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prochaine fois</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452656/">https://habr.com/ru/post/fr452656/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452642/index.html">La force de la foule. Comment Chicago a d√©velopp√© un robot poubelle - un nettoyeur de rivi√®re</a></li>
<li><a href="../fr452644/index.html">Conf√©rence des d√©veloppeurs Web DevConf X - 21 juin</a></li>
<li><a href="../fr452646/index.html">Ce que le r√©seau neuronal a vu dans la premi√®re photographie d'un trou noir</a></li>
<li><a href="../fr452648/index.html">PHP: Comment analyser un fichier XML complexe et ne pas se noyer dans le code natif</a></li>
<li><a href="../fr452652/index.html">Security Week 21: un trou dans Whatsapp, une nouvelle vuln√©rabilit√© dans les processeurs Intel, Zero-Day dans Windows</a></li>
<li><a href="../fr452662/index.html">Serveurs HPE √† Selectel</a></li>
<li><a href="../fr452664/index.html">J'ai factur√© 18 000 $ pour une page Web statique ... et je m'en suis sorti</a></li>
<li><a href="../fr452666/index.html">Comment effectuer des micro-paiements possibles dans votre application</a></li>
<li><a href="../fr452668/index.html">Comment v√©rifier la conformit√© des cookies au RGPD - un nouvel outil ouvert vous aidera</a></li>
<li><a href="../fr452670/index.html">Qui sont les ing√©nieurs de donn√©es et comment deviennent-ils?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>