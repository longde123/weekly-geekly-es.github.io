<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏸 😟 🧑🏼 Reaktionsfähiges Laden von Inhalten auf der Website 👦🏽 🙍🏽 👦🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo habr 

 Ich mache eine Website für mein Projekt. Auf der Seite muss man viele Gifs gleichzeitig zeigen, jedes wiegt ziemlich gut. Wenn Sie alles...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reaktionsfähiges Laden von Inhalten auf der Website</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480704/">  Hallo habr <br><br>  Ich mache eine Website für mein Projekt.  Auf der Seite muss man viele Gifs gleichzeitig zeigen, jedes wiegt ziemlich gut.  Wenn Sie alles auf einmal anzeigen, wird die Seite sehr lange geladen.  Gleichzeitig ist es auch unmöglich, die Seite ohne GIFs zu versehen (damit sie dort heruntergeladen werden können). <br><br>  Wer sich dafür interessiert, wie ich mit diesem Problem umgegangen bin, frage ich nach einer Katze. <br><a name="habracut"></a><br><h2>  Eigentlich das Problem </h2><br>  Wie gesagt, es gibt SEHR viele GIFs auf der Website, gut und anders.  Sie können selbst sehen, wie viele es sind: <a href="https://reface.tech/">reface.tech</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/468/0e4/bb9/4680e4bb9c37c109cfbb02929ac29633.jpg" alt="Bild"><br><br>  Sobald ich die Beta-Version der Landung sah, hatte ich sofort ein Problem mit dem Laden: Für einige Benutzer wurden die Seiten für eine lange Zeit geladen.  Für ein ernstes Geschäft ist dies natürlich nicht der Fall. <br><br>  Es war notwendig, das irgendwie zu lösen.  Mit einer einfachen verlustfreien Komprimierung war es unmöglich auszukommen, da bereits zu diesem Zeitpunkt alle Medieninhalte über <a href="https://compressor.io/">compressor.io</a> gesteuert wurden.  Daher war es notwendig, mit Verlusten zu komprimieren und GIFs mit schlechterer Qualität zu erhalten. <br><br>  Schlechte Medieninhalte an Nutzer mit gutem Internet weiterzugeben, ist jedoch eine Art Sakrileg.  Aus diesem Grund wurde beschlossen, die Geschwindigkeit Ihres Internets zu bestimmen und abhängig von der Geschwindigkeit die entsprechende Qualität auszuschalten. <br><br><h2>  Wir machen eine grobe Skizze </h2><br>  Wir werden ein Array mit einer Beschreibung des zu ladenden Medieninhalts haben. <br><br>  Ein Beispiel: <br><br><pre><code class="json hljs">[ { <span class="hljs-attr"><span class="hljs-attr">"large"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0.6211118698120117</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"gifs/control/large/control_1.gif"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"middle"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0.5330495834350586</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"gifs/control/middle/control_1.gif"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"small"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0.4901447296142578</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"gifs/control/small/control_1.gif"</span></span> } } ]</code> </pre> <br>  Hier in der Elementik liegt für den entsprechenden Qualitätsgrad URL und Dateigröße. <br><br>  Wir werden einfach: <br><br><ol><li>  Gehen Sie das Array durch (beim Laden der Seite) </li><li>  Lesen Sie die Gesamtgröße, die für jeden Qualitätsgrad geladen wurde </li><li>  Bestimmen Sie, ob in 4 Sekunden alles geladen wird (das ist der Zeitraum, der mich persönlich stört) </li></ol><br>  Dementsprechend ist es notwendig: <br><br><ol><li>  Habe so etwas gesehen, das so ein Array erstellt, dass bei Stiften nicht alles zählt (in Python) </li><li>  Sah Internet-Geschwindigkeit </li></ol><br><h2>  Geschwindigkeitsmesser sägen </h2><br>  Es wird relativ einfach sein.  Wir geben die Adresszeile Ihres Browsers ein <a href="httpbin.org/stream-bytes/51200">eu.httpbin.org/stream-bytes/51200</a> .  Eine Datei mit einer Länge von 51200 Bytes wird heruntergeladen.  Wir schieben es uns in der Öffentlichkeit vor (um die Geschwindigkeit eines Hostings zu messen). <br><br>  Jetzt müssen wir überprüfen, wie viel die Datei schwingt.  Wir werden hierfür eine einfache Funktion einreichen, die die Geschwindigkeit in Megabyte pro Sekunde an uns zurückgibt. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> checkDownloadSpeed(baseUrl, fileSizeInBytes) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, _</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> startTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> axios.get(baseUrl).then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> endTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> duration = (endTime - startTime) / <span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bytesPerSecond = (fileSizeInBytes / duration); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> megabytesPerSecond = (bytesPerSecond / <span class="hljs-number"><span class="hljs-number">1000</span></span> / <span class="hljs-number"><span class="hljs-number">1000</span></span>); resolve(megabytesPerSecond); }); }).catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(error); }); }</code> </pre><br>  Das heißt, wir haben die Startzeit des Downloads und die Endzeit aufgezeichnet und die Differenz gemessen. Da wir die Dateigröße kennen, haben wir sie einfach aufgeteilt. <br><br>  Jetzt schreiben wir eine Funktion, die in dieser Geschwindigkeit etwas bewirkt: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> getNetworkDownloadSpeed() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> baseUrl = process.env.PUBLIC_URL + <span class="hljs-string"><span class="hljs-string">'/51200'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fileSize = <span class="hljs-number"><span class="hljs-number">51200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> speed = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.checkDownloadSpeed(baseUrl, fileSize); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Network speed: "</span></span> + speed); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (speed.mbps === <span class="hljs-string"><span class="hljs-string">"Infinity"</span></span>) { SpeedMeasure.speed = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { SpeedMeasure.speed = speed * <span class="hljs-number"><span class="hljs-number">5</span></span>; } }</code> </pre><br>  Im Allgemeinen liegt ein Problem mit diesem Code vor: Die genaue Verbindungsgeschwindigkeit wird aufgrund der geringen Dateigröße nicht bestimmt.  Das Herunterladen von etwas mehr ist für uns jedoch zu teuer, sodass wir die resultierende Geschwindigkeit einfach mit 5 multiplizieren. Selbst mit einer Marge nehmen wir an, dass die Geschwindigkeit in Wirklichkeit sogar noch höher sein wird. <br><br>  Jetzt legen wir eine Funktion ab, die abhängig von der Geschwindigkeit die entsprechende Qualität reduziert: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> getResolution(gifsArray) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> totalSizeLevel1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> totalSizeLevel2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> totalSizeLevel3 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; gifsArray.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; a &lt; gifsArray[i].length; a++) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> element = gifsArray[i][a]; totalSizeLevel1 += element.small.size; totalSizeLevel2 += element.middle.size; totalSizeLevel3 += element.large.size; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">isNaN</span></span>(SpeedMeasure.speed)) { SpeedMeasure.speed = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> timeLevel1 = totalSizeLevel1 / SpeedMeasure.speed; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> timeLevel2 = totalSizeLevel2 / SpeedMeasure.speed; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> timeLevel3 = totalSizeLevel3 / SpeedMeasure.speed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timeLevel3 &lt; APPROPRIATE_TIME_LIMIT) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"large"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timeLevel2 &lt; APPROPRIATE_TIME_LIMIT) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"middle"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"small"</span></span>; } }</code> </pre><br>  Da die Funktion, die die Geschwindigkeit zählt, asynchron zu uns ist, kann SpeedMeasure.speed Null sein.  Standardmäßig glauben wir, dass die Verbindungsgeschwindigkeit 1 Megabyte pro Sekunde beträgt.  Wenn die Funktion die Geschwindigkeit berechnet, rendern wir den Container einfach neu. <br><br>  Wir übergeben ein Array von Arrays an die Funktion getResolution.  Warum?  Wenn wir mehrere Container auf der Seite haben, ist es für uns bequemer, den entsprechenden Inhalt auf jeden in einem Array zu übertragen, aber wir müssen die Download-Geschwindigkeit für alle gleichzeitig berücksichtigen. <br><br><h2>  Anwendungsbeispiel </h2><br>  Hier ist ein Anwendungsbeispiel (auf Reagieren): <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> runFunction() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> speedMeasure = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpeedMeasure(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> speedMeasure.getNetworkDownloadSpeed(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.forceUpdate() } componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.runFunction(); } render() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quality = SpeedMeasure.getResolution([ Control.getControlArray(), Health.getHealthArray() ]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div className="app"&gt; &lt;Presentation /&gt; &lt;Control quality={quality} /&gt; &lt;Health quality={quality} /&gt; &lt;/div&gt; ); }</code> </pre><br>  Dementsprechend wird der Container beim Laden unserer Geschwindigkeitsbestimmung erneut gerendert. <br>  Innerhalb des Containers (z. B. innerhalb von Control) entnehmen Sie einfach das entsprechende GIF aus dem Array (nach Index). Anschließend erhalten Sie ein Objekt nach Qualität und eine Referenz nach URL.  Alles ist einfach. <br><br><h2>  Schreiben eines Python-Skripts </h2><br>  Jetzt müssen wir die Gifs irgendwie automatisch komprimieren und das Array mit der Beschreibung des Inhalts ausgeben. <br><br>  Schreiben wir zunächst ein Skript für die Komprimierung.  Wir werden Gifsicle verwenden.  Bei Inhalten mit mittlerer Komprimierung beträgt die Komprimierungsstufe 80 (von 200), bei einer sehr leistungsstarken Funktion 160. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os GIFS_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//Landingv2/"</span></span> COMPRESSOR_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//gifsicle-static"</span></span> NOT_OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"not_optimized"</span></span> OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"optimized"</span></span> GIF_RESIZED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_not_optimized_resized"</span></span> GIF_COMPRESSED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_compressed"</span></span> COMPRESSION_TYPE = [<span class="hljs-string"><span class="hljs-string">"middle"</span></span>, <span class="hljs-string"><span class="hljs-string">"small"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (root, dirs, files) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(GIFS_DIR, topdown=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(files) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> GIF_RESIZED_DIR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: path = root + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + file <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> compression <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> COMPRESSION_TYPE: final_path = path.replace(GIF_RESIZED_DIR, GIF_COMPRESSED_DIR + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + compression + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + OPTIMIZED_DIR) print(path, final_path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> compression == COMPRESSION_TYPE[<span class="hljs-number"><span class="hljs-number">0</span></span>]: rate = <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: rate = <span class="hljs-number"><span class="hljs-number">160</span></span> os.system(<span class="hljs-string"><span class="hljs-string">"echo 0 &gt; "</span></span> + final_path) os.system(COMPRESSOR_DIR + <span class="hljs-string"><span class="hljs-string">" -O3 --lossy={} -o {} {}"</span></span>.format(rate, final_path, path))</code> </pre><br>  Um die Pfade zu den Dateien verständlich zu machen, folgt hier die Beschreibung des Dateiverzeichnisses mit GIFs: <br><br><ol><li>  NOT_OPTIMIZED_DIR - nicht optimierte GIFs </li><li>  GIF_RESIZED_DIR - Nicht optimierte GIFs, deren Größe jedoch der Größe des Containers für sie entspricht </li><li>  GIF_COMPRESSED_DIR - komprimierte GIFs </li></ol><br>  In den Ordnern befinden sich Ordner mit GIF-Kategorienamen.  In einem Ordner mit einem bestimmten Ordner enthält "groß", "mittel" und "klein" (unter den Arten von komprimierten Dateien). <br><br>  Im Skript durchlaufen wir das Verzeichnis mit GIFs und führen für jede Datei zwei Komprimierungstypen durch, wobei der entsprechende Befehlszeilenbefehl aufgerufen wird. <br><br>  Gehen wir nun zum Skript über, um ein Array mit Informationen zu erstellen. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os GIFS_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//Landingv2/"</span></span> COMPRESSOR_DIR = <span class="hljs-string"><span class="hljs-string">"/home/mixeden//gifsicle-static"</span></span> NOT_OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"not_optimized"</span></span> OPTIMIZED_DIR = <span class="hljs-string"><span class="hljs-string">"optimized"</span></span> GIF_RESIZED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_not_optimized_resized"</span></span> GIF_COMPRESSED_DIR = <span class="hljs-string"><span class="hljs-string">"gif_compressed"</span></span> COMPRESSION_TYPE = [<span class="hljs-string"><span class="hljs-string">"large"</span></span>, <span class="hljs-string"><span class="hljs-string">"middle"</span></span>, <span class="hljs-string"><span class="hljs-string">"small"</span></span>] OUTPUT = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (root, dirs, files) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(GIFS_DIR, topdown=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(files) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> GIF_COMPRESSED_DIR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> NOT_OPTIMIZED_DIR <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root: files.sort() type = root.split(GIFS_DIR)[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(GIF_COMPRESSED_DIR)[<span class="hljs-number"><span class="hljs-number">0</span></span>].replace(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) print(type) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> OUTPUT: OUTPUT[type] = [] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(OUTPUT[type]) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: OUTPUT[type].append( { <span class="hljs-string"><span class="hljs-string">"large"</span></span>: { <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">"middle"</span></span>: { <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">"small"</span></span>: { <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } }) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: full_path = root + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + file bytes_size = os.path.getsize(full_path) kilobytes_size = bytes_size / <span class="hljs-number"><span class="hljs-number">1000</span></span> megabytes_size = kilobytes_size / <span class="hljs-number"><span class="hljs-number">1000</span></span> index = int(file.split(<span class="hljs-string"><span class="hljs-string">"_"</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].replace(<span class="hljs-string"><span class="hljs-string">".gif"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)) - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> typer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> COMPRESSION_TYPE: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> typer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> root: local_type = typer new_url = <span class="hljs-string"><span class="hljs-string">"gifs/"</span></span> + full_path.replace(GIFS_DIR, <span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"/"</span></span> + GIF_COMPRESSED_DIR, <span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"/"</span></span> + OPTIMIZED_DIR, <span class="hljs-string"><span class="hljs-string">""</span></span>) OUTPUT[type][index][local_type][<span class="hljs-string"><span class="hljs-string">'url'</span></span>] = new_url OUTPUT[type][index][local_type][<span class="hljs-string"><span class="hljs-string">'size'</span></span>] = megabytes_size print(OUTPUT) print(json.dumps(OUTPUT, indent=<span class="hljs-number"><span class="hljs-number">4</span></span>, sort_keys=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>))</code> </pre><br>  Hier gehen wir die Ordner mit den Dateien durch, bestimmen die Dateigröße, ermitteln die Art der Komprimierung und geben die allgemeinen Informationen in das OUTPUT-Array ein.  Und dann haben wir dieses Array wunderschön auf die Konsole ausgegeben, um es zu kopieren. <br><br><h2>  Fazit </h2><br>  Ich hoffe dieser Artikel hilft dir bei etwas.  Habt eine nette Kodierung, Jungs. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de480704/">https://habr.com/ru/post/de480704/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de480690/index.html">Zoll-Jalousien verwalten wir günstig</a></li>
<li><a href="../de480692/index.html">MobX oder Redux: Was ist besser für das React State Management?</a></li>
<li><a href="../de480694/index.html">Können wir aufhören, UX-Barrierefreiheit und -Bedienbarkeit anzurufen?</a></li>
<li><a href="../de480700/index.html">Wir verwenden console.log () in Chrome vollständig</a></li>
<li><a href="../de480702/index.html">HR und Talente, Experten und Kreative: Wie war das achte Habraseminar?</a></li>
<li><a href="../de480710/index.html">Refactoring von SFML-Spielen</a></li>
<li><a href="../de480712/index.html">Der Flug mit einem Dosimeter in der Tasche</a></li>
<li><a href="../de480714/index.html">So fügen Sie FFmpeg einen Codec hinzu</a></li>
<li><a href="../de480716/index.html">Matlab vs. Julia vs. Python</a></li>
<li><a href="../de480718/index.html">6 Tipps für eine erfolgreiche Codeüberprüfung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>