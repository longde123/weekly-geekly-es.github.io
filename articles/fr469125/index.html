<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüëß üë®‚Äç‚úàÔ∏è ü§±üèª Th√®me sombre de Thunderbird comme raison d'ex√©cuter un analyseur de code üëéüèΩ ü§¥üèº üßîüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les aventures avec le client de messagerie Mozilla Thunderbird ont commenc√© avec la mise √† jour automatique vers la version 68.0. Plus de texte dans l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Th√®me sombre de Thunderbird comme raison d'ex√©cuter un analyseur de code</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/469125/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d19/1b4/7c9/d191b47c96eca6289545e03035589513.png" alt="Image 3"></div>  Les aventures avec le client de messagerie Mozilla Thunderbird ont commenc√© avec la mise √† jour automatique vers la version 68.0.  Plus de texte dans les notifications contextuelles et le th√®me sombre par d√©faut sont les caract√©ristiques notables de cette version.  Parfois, j'ai trouv√© une erreur que j'avais imm√©diatement envie de d√©tecter avec une analyse statique.  C'est devenu la raison d'aller pour une autre v√©rification du code source du projet en utilisant PVS-Studio.  Il se trouve qu'au moment de l'analyse, le bogue avait d√©j√† √©t√© corrig√©.  Cependant, puisque nous avons pr√™t√© attention au projet, il n'y a aucune raison de ne pas √©crire sur d'autres d√©fauts trouv√©s. <br><br><h2>  Pr√©sentation </h2><br>  Le th√®me sombre de la nouvelle version de Thunderbird est joli.  J'aime les th√®mes sombres.  Je les ai d√©j√† pass√©s dans des messagers, Windows, macOS.  Bient√¥t, l'iPhone sera mis √† jour vers iOS 13 avec un th√®me sombre.  Pour cette raison, j'ai m√™me d√ª changer mon iPhone 5S pour un mod√®le plus r√©cent.  Dans la pratique, il s'est av√©r√© qu'un th√®me sombre n√©cessite plus d'efforts pour que les d√©veloppeurs choisissent les couleurs de l'interface.  Tout le monde ne peut pas le g√©rer la premi√®re fois. <a name="habracut"></a>  Voici √† quoi ressemblaient les balises standard dans Thunderbird apr√®s la mise √† jour: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83c/bb0/4a9/83cbb04a9a598452726509f326cffb1a.png" alt="Image 1"></div><br><br>  J'utilise normalement 6 balises (5 standard +1 personnalis√©es) pour baliser les e-mails.  La moiti√© d'entre eux est devenu impossible √† regarder apr√®s la mise √† jour, j'ai donc d√©cid√© de changer la couleur des param√®tres pour une plus lumineuse.  √Ä ce stade, je suis rest√© coinc√© avec un bug: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ea/b5e/91e/0eab5e91e9f6da7b1b1ac7d66c414947.png" alt="Image 2"></div><br><br>  Vous ne pouvez pas changer la couleur d'une √©tiquette !!!  Plus vrai, vous le pouvez, mais l'√©diteur ne vous laissera pas l'enregistrer, se r√©f√©rant √† un nom d√©j√† existant (WTF ???). <br><br>  Un autre sympt√¥me de ce bogue est un bouton OK inactif.  Comme je ne pouvais pas apporter de modifications dans la m√™me √©tiquette de nom, j'ai essay√© de changer son nom.  Eh bien, il s'av√®re que vous ne pouvez pas le renommer non plus. <br><br>  Enfin, vous avez peut-√™tre remarqu√© que le th√®me sombre ne fonctionnait pas pour les param√®tres, ce qui n'est pas tr√®s agr√©able non plus. <br><br>  Apr√®s une longue lutte avec le syst√®me de construction de Windows, j'ai finalement construit Thunderbird √† partir des fichiers source.  La derni√®re version du client de messagerie s'est av√©r√©e bien meilleure que la nouvelle version.  Dans ce document, le th√®me sombre est √©galement entr√© dans les param√®tres, et ce bug avec l'√©diteur de balises a disparu.  N√©anmoins, pour s'assurer que la construction du projet ne soit pas seulement une perte de temps, l'analyseur de code statique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PVS-Studio</a> s'est mis au travail. <br><br>  <b>Remarque</b>  Le code source de Thunderbird recoupe la base de code de Firefox par certains moyens.  Par cons√©quent, l'analyse inclut des erreurs de diff√©rents composants, qui m√©ritent d'√™tre examin√©es de pr√®s par les d√©veloppeurs de ces √©quipes. <br><br>  <b>Note 2.</b> Pendant que j'√©crivais l'article, Thunderbird 68.1 est sorti et ce bug a √©t√© corrig√©: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4a5/20f/0eb/4a520f0eb68eb4061bcedfdc74c94e5f.png" alt="Image 5"></div><br><br><h2>  comm </h2><br>  comm-central est un r√©f√©rentiel Mercurial du code d'extension Thunderbird, SeaMonkey et Lightning. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V501</a> Il existe des sous-expressions identiques '(! Strcmp (en-t√™te, "Reply-To"))' √† gauche et √† droite de '||'  op√©rateur.  nsEmitterUtils.cpp 28 <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmitThisHeaderForPrefSetting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dispType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *header)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nsMimeHeaderDisplayTypes::NormalHeaders == dispType) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_DATE)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_TO)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_SUBJECT)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_SENDER)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_RESENT_TO)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_RESENT_SENDER)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_RESENT_FROM)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_RESENT_CC)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_REPLY_TO)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_REFERENCES)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_NEWSGROUPS)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_MESSAGE_ID)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_FROM)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_FOLLOWUP_TO)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_CC)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_ORGANIZATION)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_REPLY_TO)) || (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(header, HEADER_BCC))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; .... }</code> </pre> <br>  La cha√Æne d'en- <i>t√™te a</i> √©t√© compar√©e deux fois avec la constante <i>HEADER_REPLY_TO</i> .  Peut-√™tre qu'il aurait d√ª y avoir une autre constante √† sa place. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V501</a> Il existe des sous-expressions identiques ¬´obj-&gt; options-&gt; headers! = MimeHeadersCitation¬ª √† gauche et √† droite de l'op√©rateur ¬´&amp;&amp;¬ª.  mimemsig.cpp 536 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MimeMultipartSigned_emit_child</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MimeObject *obj)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj-&gt;options &amp;&amp; obj-&gt;options-&gt;headers != MimeHeadersCitation &amp;&amp; obj-&gt;options-&gt;write_html_p &amp;&amp; obj-&gt;options-&gt;output_fn &amp;&amp; obj-&gt;options-&gt;headers != MimeHeadersCitation &amp;&amp; sig-&gt;crypto_closure) { .... } .... }</code> </pre> <br>  Une autre comparaison √©trange d'une variable avec un nom similaire - <i>en</i> - <i>t√™tes</i> .  Comme toujours, il y a deux explications possibles: une v√©rification inutile ou une faute de frappe. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V517</a> L'utilisation du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le</a> 'if (A) {...} else if (A) {...}' a √©t√© d√©tect√©e.  Il y a une probabilit√© de pr√©sence d'erreur logique.  V√©rifier les lignes: 1306, 1308. MapiApi.cpp 1306 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CMapiApi::ReportLongProp(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *pTag, LPSPropValue pVal) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_LONG)) { nsCString num; nsCString num2; num.AppendInt((<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span>)pVal-&gt;Value.l); num2.AppendInt((<span class="hljs-keyword"><span class="hljs-keyword">int32_t</span></span>)pVal-&gt;Value.l, <span class="hljs-number"><span class="hljs-number">16</span></span>); MAPI_TRACE3(<span class="hljs-string"><span class="hljs-string">"%s %s, 0x%s\n"</span></span>, pTag, num, num2); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_NULL)) { MAPI_TRACE1(<span class="hljs-string"><span class="hljs-string">"%s {NULL}\n"</span></span>, pTag); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_ERROR)) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= MAPI_TRACE1("%s {Error retrieving property}\n", pTag); } else if (pVal &amp;&amp; (PROP_TYPE(pVal-&gt;ulPropTag) == PT_ERROR)) { // &lt;= MAPI_TRACE1("%s {Error retrieving property}\n", pTag); } else { MAPI_TRACE1("%s invalid value, expecting long\n", pTag); } if (pVal) MAPIFreeBuffer(pVal); }</span></span></code> </pre> <br>  Les touches Ctrl + C et Ctrl + V ont certainement contribu√© √† acc√©l√©rer l'√©criture de cette cascade d'expressions conditionnelles.  Par cons√©quent, l'une des branches ne sera jamais ex√©cut√©e. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V517</a> L'utilisation du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le</a> 'if (A) {...} else if (A) {...}' a √©t√© d√©tect√©e.  Il y a une probabilit√© de pr√©sence d'erreur logique.  V√©rifiez les lignes: 777, 816. nsRDFContentSink.cpp 777 <br><br><pre> <code class="cpp hljs">nsresult RDFContentSinkImpl::GetIdAboutAttribute(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char16_t</span></span>** aAttributes, nsIRDFResource** aResource, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>* aIsAnonymous) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (localName == nsGkAtoms::about) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (localName == nsGkAtoms::ID) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (localName == nsGkAtoms::nodeID) { nodeID.Assign(aAttributes[<span class="hljs-number"><span class="hljs-number">1</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (localName == nsGkAtoms::about) { <span class="hljs-comment"><span class="hljs-comment">// XXX we don't deal with aboutEach... //MOZ_LOG(gLog, LogLevel::Warning, // ("rdfxml: ignoring aboutEach at line %d", // aNode.GetSourceLineNumber())); } .... }</span></span></code> </pre> <br>  La premi√®re et la derni√®re condition sont les m√™mes.  Le code montre qu'il est toujours en cours d'√©criture.  On peut dire en toute s√©curit√© que l'erreur appara√Ætra une fois le code raffin√©.  Un programmeur peut changer le code comment√©, mais n'en aura jamais le contr√¥le.  Soyez tr√®s prudent et attentif avec ce code. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V522 Le</a> d√©r√©f√©rencement de la ¬´ligne¬ª du pointeur nul peut avoir lieu.  morkRowCellCursor.cpp 175 <br><br><pre> <code class="cpp hljs">NS_IMETHODIMP morkRowCellCursor::MakeCell( <span class="hljs-comment"><span class="hljs-comment">// get cell at current pos in the row nsIMdbEnv* mev, // context mdb_column* outColumn, // column for this particular cell mdb_pos* outPos, // position of cell in row sequence nsIMdbCell** acqCell) { nsresult outErr = NS_OK; nsIMdbCell* outCell = 0; mdb_pos pos = 0; mdb_column col = 0; morkRow* row = 0; morkEnv* ev = morkEnv::FromMdbEnv(mev); if (ev) { pos = mCursor_Pos; morkCell* cell = row-&gt;CellAt(ev, pos); if (cell) { col = cell-&gt;GetColumn(); outCell = row-&gt;AcquireCellHandle(ev, cell, col, pos); } outErr = ev-&gt;AsErr(); } if (acqCell) *acqCell = outCell; if (outPos) *outPos = pos; if (outColumn) *outColumn = col; return outErr; }</span></span></code> </pre> <br>  D√©r√©f√©rencement possible du pointeur null de <i>ligne</i> dans la ligne suivante: <br><br><pre> <code class="cpp hljs">morkCell* cell = row-&gt;CellAt(ev, pos);</code> </pre> <br>  Tr√®s probablement, un pointeur n'a pas √©t√© initialis√©, par exemple, par la m√©thode <i>GetRow</i> , etc. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V543</a> Il est √©trange que la valeur '-1' soit affect√©e √† la variable 'm_lastError' de type HRESULT.  MapiApi.cpp 1050 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CMapiApi</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> HRESULT m_lastError; .... }; CMsgStore *CMapiApi::FindMessageStore(ULONG cbEid, LPENTRYID lpEid) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!m_lpSession) { MAPI_TRACE0(<span class="hljs-string"><span class="hljs-string">"FindMessageStore called before session is open\n"</span></span>); m_lastError = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } .... }</code> </pre> <br>  Le type <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><i>HRESULT</i></a> est un type de donn√©es complexe.  Ses diff√©rents bits repr√©sentent diff√©rents champs d'une description d'erreur.  Vous devez d√©finir le code d'erreur √† l'aide de constantes sp√©ciales des fichiers d'en-t√™te syst√®me. <br><br>  Quelques fragments comme celui-ci: <br><br><ul><li>  V543 Il est √©trange que la valeur '-1' soit affect√©e √† la variable 'm_lastError' de type HRESULT.  MapiApi.cpp 817 </li><li>  V543 Il est √©trange que la valeur '-1' soit affect√©e √† la variable 'm_lastError' de type HRESULT.  MapiApi.cpp 1749 </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V579</a> La fonction memset re√ßoit le pointeur et sa taille comme arguments.  C'est peut-√™tre une erreur.  Inspectez le troisi√®me argument.  icalmime.c 195 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">icalcomponent* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">icalmime_parse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sspm_part</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parts</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i, last_level=<span class="hljs-number"><span class="hljs-number">0</span></span>; icalcomponent *root=<span class="hljs-number"><span class="hljs-number">0</span></span>, *parent=<span class="hljs-number"><span class="hljs-number">0</span></span>, *comp=<span class="hljs-number"><span class="hljs-number">0</span></span>, *last = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (parts = (struct sspm_part *) <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(NUM_PARTS*<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(struct sspm_part)))==<span class="hljs-number"><span class="hljs-number">0</span></span>) { icalerror_set_errno(ICAL_NEWFAILED_ERROR); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(parts,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(parts)); sspm_parse_mime(parts, NUM_PARTS, <span class="hljs-comment"><span class="hljs-comment">/* Max parts */</span></span> icalmime_local_action_map, <span class="hljs-comment"><span class="hljs-comment">/* Actions */</span></span> get_string, data, <span class="hljs-comment"><span class="hljs-comment">/* data for get_string*/</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">/* First header */</span></span>); .... }</code> </pre> <br>  La variable <i>parts</i> est un pointeur sur un tableau de structures.  Afin de r√©initialiser les valeurs des structures, les auteurs ont utilis√© la fonction <i>memset</i> , mais ont transmis la taille du pointeur comme taille de l'espace m√©moire. <br><br>  Fragments suspects similaires: <br><br><ul><li>  V579 La fonction memset re√ßoit le pointeur et sa taille comme arguments.  C'est peut-√™tre une erreur.  Inspectez le troisi√®me argument.  icalmime.c 385 </li><li>  V579 La fonction memset re√ßoit le pointeur et sa taille comme arguments.  C'est peut-√™tre une erreur.  Inspectez le troisi√®me argument.  icalparameter.c 114 </li><li>  V579 La fonction snprintf re√ßoit le pointeur et sa taille comme arguments.  C'est peut-√™tre une erreur.  Inspectez le deuxi√®me argument.  icaltimezone.c 1908 </li><li>  V579 La fonction snprintf re√ßoit le pointeur et sa taille comme arguments.  C'est peut-√™tre une erreur.  Inspectez le deuxi√®me argument.  icaltimezone.c 1910 </li><li>  V579 La fonction strncmp re√ßoit le pointeur et sa taille comme arguments.  C'est peut-√™tre une erreur.  Inspectez le troisi√®me argument.  sspm.c 707 </li><li>  V579 La fonction strncmp re√ßoit le pointeur et sa taille comme arguments.  C'est peut-√™tre une erreur.  Inspectez le troisi√®me argument.  sspm.c 813 </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V595</a> Le pointeur 'aValues' a √©t√© utilis√© avant d'√™tre v√©rifi√© par rapport √† nullptr.  V√©rifiez les lignes: 553, 555. nsLDAPMessage.cpp 553 <br><br><pre> <code class="cpp hljs">NS_IMETHODIMP nsLDAPMessage::GetBinaryValues(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *aAttr, <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *aCount, nsILDAPBERValue ***aValues) { .... *aValues = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;nsILDAPBERValue **&gt;( moz_xmalloc(numVals * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(nsILDAPBERValue))); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!aValues) { ldap_value_free_len(values); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NS_ERROR_OUT_OF_MEMORY; } .... }</code> </pre> <br>  Le diagnostic <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V595</a> d√©tecte g√©n√©ralement les erreurs typiques de d√©r√©f√©rencement de pointeur nul.  Dans ce cas, nous avons un exemple extr√™mement int√©ressant, qui m√©rite une attention particuli√®re. <br><br>  Techniquement, l'analyseur a raison de dire que le pointeur <i>aValues</i> est d'abord d√©r√©f√©renc√© puis v√©rifi√©, mais l'erreur r√©elle est diff√©rente.  C'est un double pointeur, donc le code correct devrait ressembler √† ceci: <br><br><pre> <code class="cpp hljs">*aValues = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;nsILDAPBERValue **&gt;( moz_xmalloc(numVals * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(nsILDAPBERValue))); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!*aValues) { ldap_value_free_len(values); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NS_ERROR_OUT_OF_MEMORY; }</code> </pre> <br>  Un autre fragment similaire: <br><br><ul><li>  V595 Le pointeur '_retval' a √©t√© utilis√© avant d'√™tre v√©rifi√© par rapport √† nullptr.  V√©rifiez les lignes: 357, 358. nsLDAPSyncQuery.cpp 357 </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V1044</a> Les conditions d'interruption de boucle ne d√©pendent pas du nombre d'it√©rations.  mimemoz2.cpp 1795 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResetChannelCharset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MimeObject *obj)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cSet) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *ptr2 = cSet; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((*cSet) &amp;&amp; (*cSet != <span class="hljs-string"><span class="hljs-string">' '</span></span>) &amp;&amp; (*cSet != <span class="hljs-string"><span class="hljs-string">';'</span></span>) &amp;&amp; (*cSet != <span class="hljs-string"><span class="hljs-string">'\r'</span></span>) &amp;&amp; (*cSet != <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) &amp;&amp; (*cSet != <span class="hljs-string"><span class="hljs-string">'"'</span></span>)) ptr2++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*cSet) { PR_FREEIF(obj-&gt;options-&gt;default_charset); obj-&gt;options-&gt;default_charset = strdup(cSet); obj-&gt;options-&gt;override_charset = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } PR_FREEIF(cSet); } .... }</code> </pre> <br>  Cette erreur est d√©tect√©e √† l'aide d'un nouveau diagnostic qui sera disponible dans la prochaine version de l'analyseur.  Toutes les variables utilis√©es dans la condition de la boucle while ne changent pas, car les variables <i>ptr2</i> et <i>cSet</i> sont confondues dans le corps de la fonction. <br><br><h2>  netwerk </h2><br>  netwerk contient des interfaces C et du code pour un acc√®s de bas niveau au r√©seau (en utilisant des sockets et des caches de fichiers et de m√©moire) ainsi qu'un acc√®s de plus haut niveau (en utilisant divers protocoles tels que http, ftp, gopher, castanet).  Ce code est √©galement connu sous les noms de "netlib" et "Necko". <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V501</a> Il existe des sous-expressions identiques ¬´connectStarted¬ª √† gauche et √† droite de l'op√©rateur ¬´&amp;&amp;¬ª.  nsSocketTransport2.cpp 1693 <br><br><pre> <code class="cpp hljs">nsresult nsSocketTransport::InitiateSocket() { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gSocketTransportService-&gt;IsTelemetryEnabledAndNotSleepPhase() &amp;&amp; connectStarted &amp;&amp; connectCalled) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= good, line 1630 SendPRBlockingTelemetry( connectStarted, Telemetry::PRCONNECT_BLOCKING_TIME_NORMAL, Telemetry::PRCONNECT_BLOCKING_TIME_SHUTDOWN, Telemetry::PRCONNECT_BLOCKING_TIME_CONNECTIVITY_CHANGE, Telemetry::PRCONNECT_BLOCKING_TIME_LINK_CHANGE, Telemetry::PRCONNECT_BLOCKING_TIME_OFFLINE); } .... if (gSocketTransportService-&gt;IsTelemetryEnabledAndNotSleepPhase() &amp;&amp; connectStarted &amp;&amp; connectStarted) { // &lt;= fail, line 1694 SendPRBlockingTelemetry( connectStarted, Telemetry::PRCONNECT_FAIL_BLOCKING_TIME_NORMAL, Telemetry::PRCONNECT_FAIL_BLOCKING_TIME_SHUTDOWN, Telemetry::PRCONNECT_FAIL_BLOCKING_TIME_CONNECTIVITY_CHANGE, Telemetry::PRCONNECT_FAIL_BLOCKING_TIME_LINK_CHANGE, Telemetry::PRCONNECT_FAIL_BLOCKING_TIME_OFFLINE); } .... }</span></span></code> </pre> <br>  J'ai d'abord pens√© que la duplication de la variable <i>connectStarted n'√©tait</i> qu'un code redondant.  Mais j'ai ensuite parcouru toute la fonction assez longue et trouv√© un fragment similaire.  Tr√®s probablement, la variable <i>connectCalled</i> doit √™tre ici au lieu de la variable <i>connectStarted</i> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V611</a> La m√©moire a √©t√© allou√©e √† l'aide de l'op√©rateur 'new T []' mais a √©t√© lib√©r√©e √† l'aide de l'op√©rateur 'delete'.  Pensez √† inspecter ce code.  Il vaut probablement mieux utiliser 'delete [] mData;'.  V√©rifiez les lignes: 233, 222. DataChannel.cpp 233 <br><br><pre> <code class="cpp hljs">BufferedOutgoingMsg::BufferedOutgoingMsg(OutgoingMsg&amp; msg) { <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> length = msg.GetLeft(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>* tmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>[length]; <span class="hljs-comment"><span class="hljs-comment">// infallible malloc! memcpy(tmp, msg.GetData(), length); mLength = length; mData = tmp; mInfo = new sctp_sendv_spa; *mInfo = msg.GetInfo(); mPos = 0; } BufferedOutgoingMsg::~BufferedOutgoingMsg() { delete mInfo; delete mData; }</span></span></code> </pre> <br>  Le pointeur <i>mData</i> pointe sur un tableau, pas sur un seul objet.  Une erreur a √©t√© commise dans le destructeur de classe en raison de crochets manquants pour l'op√©rateur de <i>suppression</i> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V1044</a> Les conditions d'interruption de boucle ne d√©pendent pas du nombre d'it√©rations.  ParseFTPList.cpp 691 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParseFTPList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... pos = toklen[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (pos &gt; (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(result-&gt;fe_size) - <span class="hljs-number"><span class="hljs-number">1</span></span>)) pos = (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(result-&gt;fe_size) - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(result-&gt;fe_size, tokens[<span class="hljs-number"><span class="hljs-number">2</span></span>], pos); result-&gt;fe_size[pos] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; .... }</code> </pre> <br>  La valeur de la variable <i>pos</i> est r√©√©crite dans la boucle pour la m√™me valeur.  Il semble que le nouveau diagnostic ait trouv√© une autre erreur. <br><br><h2>  gfx </h2><br>  gfx contient des interfaces C et du code pour le dessin et l'imagerie ind√©pendants de la plateforme.  Il peut √™tre utilis√© pour dessiner des rectangles, des lignes, des images, etc.  Il s'agit essentiellement d'un ensemble d'interfaces pour un contexte de p√©riph√©rique (dessin) ind√©pendant de la plate-forme.  Il ne g√®re pas les widgets ou les routines de dessin sp√©cifiques;  il fournit simplement les op√©rations primitives de dessin. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V501</a> Il existe des sous-expressions identiques √† gauche et √† droite de '||'  op√©rateur: mVRSystem ||  mVRCompositor ||  mVRSystem OpenVRSession.cpp 876 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> OpenVRSession::Shutdown() { StopHapticTimer(); StopHapticThread(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mVRSystem || mVRCompositor || mVRSystem) { ::vr::VR_Shutdown(); mVRCompositor = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; mVRChaperone = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; mVRSystem = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; } }</code> </pre> <br>  La variable <i>mVRSystem</i> appara√Æt deux fois dans la condition <i>.</i>  De toute √©vidence, l'une de ses occurrences devrait √™tre remplac√©e par <i>mVRChaperone.</i> <br><br><h2>  dom </h2><br>  dom contient des interfaces C et du code pour impl√©menter et suivre les objets DOM (Document Object Model) en Javascript.  Il forme la sous-structure C qui cr√©e, d√©truit et manipule des objets int√©gr√©s et d√©finis par l'utilisateur selon le script Javascript. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V570</a> La variable 'clonedDoc-&gt; mPreloadReferrerInfo' est assign√©e √† elle-m√™me.  Document.cpp 12049 <br><br><pre> <code class="cpp hljs">already_AddRefed&lt;Document&gt; Document::CreateStaticClone( nsIDocShell* aCloneContainer) { .... clonedDoc-&gt;mReferrerInfo = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;dom::ReferrerInfo*&gt;(mReferrerInfo.get())-&gt;Clone(); clonedDoc-&gt;mPreloadReferrerInfo = clonedDoc-&gt;mPreloadReferrerInfo; .... }</code> </pre> <br>  L'analyseur a trouv√© l'affectation de la variable √† lui-m√™me. <br><br><h2>  xpcom </h2><br>  xpcom contient les interfaces C de bas niveau, le code C, le code C, un peu de code d'assemblage et des outils de ligne de commande pour impl√©menter la machinerie de base des composants XPCOM (qui signifie "Cross Platform Component Object Model").  XPCOM est le m√©canisme qui permet √† Mozilla d'exporter des interfaces et de les mettre automatiquement √† la disposition des scripts JavaScript, de Microsoft COM et du code Mozilla C normal. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V611</a> La m√©moire a √©t√© allou√©e √† l'aide de la fonction 'malloc / realloc' mais a √©t√© lib√©r√©e √† l'aide de l'op√©rateur 'delete'.  Envisagez d'inspecter les logiques d'op√©ration derri√®re la variable ¬´cl√©¬ª.  V√©rifiez les lignes: 143, 140. nsINIParser.h 143 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">INIValue</span></span></span><span class="hljs-class"> {</span></span> INIValue(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* aKey, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* aValue) : key(strdup(aKey)), value(strdup(aValue)) {} ~INIValue() { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> key; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* aValue)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> value; value = strdup(aValue); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* key; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* value; mozilla::UniquePtr&lt;INIValue&gt; next; };</code> </pre> <br>  Apr√®s avoir appel√© la fonction <i>strdup</i> , il faut lib√©rer la m√©moire en utilisant la fonction <i>libre</i> , pas l'op√©rateur de <i>suppression</i> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V716</a> Conversion de type suspect lors de l'initialisation: 'HRESULT var = BOOL'.  SpecialSystemDirectory.cpp 73 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">BOOL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SHGetSpecialFolderPathW</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( HWND hwnd, LPWSTR pszPath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> csidl, BOOL fCreate )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> nsresult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWindowsFolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aFolder, nsIFile** aFile)</span></span></span><span class="hljs-function"> </span></span>{ WCHAR path_orig[MAX_PATH + <span class="hljs-number"><span class="hljs-number">3</span></span>]; WCHAR* path = path_orig + <span class="hljs-number"><span class="hljs-number">1</span></span>; HRESULT result = SHGetSpecialFolderPathW(<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>, path, aFolder, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!SUCCEEDED(result)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NS_ERROR_FAILURE; } .... }</code> </pre> <br>  <i>SHGetSpecialFolderPathW</i> La fonction WinAPI renvoie la valeur du type <i>BOOL</i> , pas <i>HRESULT</i> .  Il faut r√©√©crire la v√©rification du r√©sultat de la fonction sur la bonne. <br><br><h2>  nsprpub </h2><br>  nsprpub contient le code C pour la biblioth√®que d'ex√©cution multiplateforme "C".  La biblioth√®que d'ex√©cution ¬´C¬ª contient des fonctions C non visuelles de base pour allouer et d√©sallouer la m√©moire, obtenir l'heure et la date, lire et √©crire des fichiers, g√©rer les threads et g√©rer et comparer les cha√Ænes sur toutes les plateformes <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V647</a> La valeur de type "int" est affect√©e au pointeur de type "court".  Pensez √† inspecter l'affectation: 'out_flags = 0x2'.  prsocket.c 1220 <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PR_POLL_WRITE 0x2 static PRInt16 PR_CALLBACK SocketPoll( PRFileDesc *fd, PRInt16 in_flags, PRInt16 *out_flags) { *out_flags = 0; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(_WIN64) </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (in_flags &amp; PR_POLL_WRITE) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (fd-&gt;secret-&gt;alreadyConnected) { out_flags = PR_POLL_WRITE; return PR_POLL_WRITE; } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> return in_flags; } </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* SocketPoll */</span></span></span></span></code> </pre> <br>  L'analyseur a d√©tect√© l'attribution d'une constante num√©rique au pointeur <i>out_flags</i> .  Tr√®s probablement, on a juste oubli√© de le d√©r√©f√©rencer: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fd-&gt;secret-&gt;alreadyConnected) { *out_flags = PR_POLL_WRITE; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PR_POLL_WRITE; }</code> </pre> <br><h2>  Conclusion </h2><br>  Ce n'est pas encore la fin.  Que les nouvelles r√©visions de code soient!  Code Thunderbird et Firefox comprenant deux grandes biblioth√®ques: Network Security Services (NSS) et WebRTC (Web Real Time Communications).  J'y ai trouv√© des erreurs convaincantes.  Dans cette revue, je vais en montrer un de chaque projet. <br><br>  <b>Nss</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V597</a> Le compilateur pourrait supprimer l'appel de fonction 'memset', qui est utilis√© pour vider le tampon 'newdeskey'.  La fonction RtlSecureZeroMemory () doit √™tre utilis√©e pour effacer les donn√©es priv√©es.  pkcs11c.c 1033 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> CK_RV </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sftk_CryptInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> newdeskey[<span class="hljs-number"><span class="hljs-number">24</span></span>]; .... context-&gt;cipherInfo = DES_CreateContext( useNewKey ? newdeskey : (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)att-&gt;attrib.pValue, (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)pMechanism-&gt;pParameter, t, isEncrypt); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useNewKey) <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(newdeskey, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> newdeskey); sftk_FreeAttribute(att); .... }</code> </pre> <br>  NSS est une biblioth√®que pour d√©velopper des applications client et serveur s√©curis√©es.  Alors que DES Key n'est pas effac√© ici.  Le compilateur supprimera l'appel <i>memset</i> du code, car le tableau <i>newdeskey</i> n'est plus utilis√© nulle part dans le code. <br><br>  <b>WebRTC</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V519</a> La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">variable</a> 'state [state_length - x_length + i]' re√ßoit des valeurs successives deux fois.  C'est peut-√™tre une erreur.  V√©rifiez les lignes: 83, 84. filter_ar.c 84 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> WebRtcSpl_FilterAR(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; state_length - x_length; i++) { state[i] = state[i + x_length]; state_low[i] = state_low[i + x_length]; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; x_length; i++) { state[state_length - x_length + i] = filtered[i]; state[state_length - x_length + i] = filtered_low[i]; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } .... }</span></span></code> </pre> <br>  Dans la deuxi√®me boucle, les donn√©es sont √©crites dans le mauvais tableau, car l'auteur a copi√© le code et a oubli√© de modifier le nom du tableau d' <i>√©tat</i> pour <i>state_low</i> . <br><br>  Probablement, il y a encore des bogues int√©ressants dans ces projets, dont il faut parler.  Et nous le ferons bient√¥t.  En attendant, essayez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PVS-Studio</a> sur votre projet. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr469125/">https://habr.com/ru/post/fr469125/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr469109/index.html">Jouets en bois, troisi√®me partie - 1989</a></li>
<li><a href="../fr469111/index.html">Remplacer l'objet par var: qu'est-ce qui pourrait mal tourner?</a></li>
<li><a href="../fr469115/index.html">Guide Discovery.js: D√©marrage rapide</a></li>
<li><a href="../fr469117/index.html">Programmation sous BC 0010 en 2019</a></li>
<li><a href="../fr469119/index.html">Les adresses IPv4 dans RIPE sont termin√©es. Compl√®tement termin√© ...</a></li>
<li><a href="../fr469127/index.html">Optimisation ou comment ne pas se tirer une balle dans le pied</a></li>
<li><a href="../fr469129/index.html">En raison du th√®me sombre, Thunderbird a d√ª ex√©cuter un analyseur de code</a></li>
<li><a href="../fr469131/index.html">G√©nie</a></li>
<li><a href="../fr469133/index.html">Quels gadgets Amazon a-t-il introduits lors de son Hardware Event 2019</a></li>
<li><a href="../fr469135/index.html">Id√©es fausses courantes sur la POO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>