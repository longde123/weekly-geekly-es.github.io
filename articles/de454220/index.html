<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÑ üëµüèº üëâüèª Zweistelliges Thermometer ü¶ñ üîÖ üë©üèø‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der Autor machte dieses zweistellige LED-Thermometer als Geburtstagsgeschenk f√ºr den Sohn seines Freundes. Er ist erst zwei Jahre alt und liest bereit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zweistelliges Thermometer</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454220/"><img src="https://habrastorage.org/webt/i0/jr/au/i0jrauutpm6rrsutydyvv7hxb_c.jpeg"><br><br>  Der Autor machte dieses zweistellige LED-Thermometer als Geburtstagsgeschenk f√ºr den Sohn seines Freundes.  Er ist erst zwei Jahre alt und liest bereits die Zahlen, die Buchstaben jedoch nicht.  Jetzt kann er die Temperatur au√üerhalb des Fensters selbst herausfinden.  Der Sensor im Thermometer ist ein DS18B20-Chip, der gem√§√ü dem 1-Draht-Protokoll arbeitet, und der Mikrocontroller ist vom Typ ATtiny84.  Das Brett ist quadratisch mit einer Seite von 25 mm, in der Gr√∂√üe vergleichbar mit einer 50-Pence-M√ºnze.  Der Autor plant, die Tafel in eine wasserdichte H√ºlle zu legen und au√üerhalb des Fensters zu platzieren.  Die Anzeige leuchtet alle 24 Sekunden kurz auf und die CR2032-Batterien halten etwa ein Jahr lang. <a name="habracut"></a><br>  Das Thermometer arbeitet im Bereich von -19 bis +99 ¬∞ C.  Bei Bedarf werden das Minus und das Eins gleichzeitig in der h√∂heren Reihenfolge angezeigt.  Au√üerhalb des Bereichs werden die Buchstaben Lo oder Hi angezeigt.  Sie k√∂nnen dem Ger√§t ‚Äûbeibringen‚Äú, Temperaturen unter -19 ¬∞ C anzuzeigen, indem Sie ein Segment mit einem Punkt als Minus verwenden. <br><br>  Nach diesem Schema wurde das Ger√§t zuvor auf einem Steckbrett montiert: <br><br><img src="https://habrastorage.org/webt/1u/e7/aj/1ue7aju6otdv_qjhwdjabjxejf8.gif"><br><br>  Alle Ausg√§nge des Mikrocontrollers sind beteiligt, der eingebaute 8 MHz Taktgenerator wird verwendet.  Der Prototyp war wie folgt: <br><br><img src="https://habrastorage.org/webt/qf/91/nd/qf91ndinrn_16xfcxellk_lxzuq.jpeg"><br><br>  Der Prototyp verwendete DS18B20 im TO-92-Paket, ATtiny84 im PDIP-Paket und einen 3,6-Zoll-3621AS-Indikator.  Dann entwickelte der Autor das Board in Eagle und bestellte es in PCBway.  Hier befindet sich der Mikrocontroller bereits im SOIC-Geh√§use, der Sensor im ¬µSOP-Geh√§use und die Widerst√§nde, Kondensatoren und das Display haben die Gr√∂√üe 0805. Alles au√üer dem Display wird mit einem Youyue 858D + Haartrockner bei einer Temperatur von 250 ¬∞ C verl√∂tet. <br><br>  Sowohl der Prototyp als auch die Leiterplatte haben Anzeigen mit einer gemeinsamen Anode.  Das Ger√§t ist in zwei Versionen mit roten und gelben Anzeigen erh√§ltlich.  Rot - auf KDPV, gelb - hier: <br><br><img src="https://habrastorage.org/webt/qc/i9/wv/qci9wvs7mdqulra36wldskfg6sc.jpeg"><br><br>  Ein Halter f√ºr eine 20 mm Lithiumzelle (eine mit einer Bezeichnung beginnend mit 20, d. H. 2016, 2025 oder 2032) ist auf der R√ºckseite verl√∂tet: <br><br><img src="https://habrastorage.org/webt/3i/ic/kx/3iickx0nahv0rh325lvawiebzdq.jpeg"><br><br>  Die Firmware ist so geschrieben, dass sich der Mikrocontroller die meiste Zeit im Ruhemodus befindet und bei Unterbrechung des Watchdog-Timers aufwacht.  Bei der Implementierung der 1-Wire-Schnittstelle ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diese Betriebszeit</a> desselben Autors beteiligt.  Der 16-Bit-Zeitz√§hler des Mikrocontrollers, der mit einer Frequenz von 1 MHz arbeitet, ist zeitaufw√§ndig: <br><br><pre><code class="plaintext hljs">void OneWireSetup () { TCCR1A = 0&lt;&lt;WGM10; // Normal mode TCCR1B = 0&lt;&lt;WGM12 | 2&lt;&lt;CS10; // Normal mode, divide clock by 8 }</code> </pre> <br>  Die Routine DelayMicros () liefert eine Verz√∂gerung von einer bestimmten Anzahl von Mikrosekunden, basierend auf dem OCR0A-Ausgangsvergleichsregister: <br><br><pre> <code class="plaintext hljs">void DelayMicros (unsigned int micro) { TCNT1 = 0; TIFR1 = 1&lt;&lt;OCF1A; OCR1A = micro; while ((TIFR1 &amp; 1&lt;&lt;OCF1A) == 0); }</code> </pre> <br>  Die Routine DisplayTemperature () liest den Temperaturwert vom Sensor und zeigt ihn an.  Da sich nur ein Sensor am Bus befindet, k√∂nnen Sie nicht auf die Seriennummer achten und nur den Befehl ROM √ºberspringen eingeben. Danach werden alle nachfolgenden Befehle an ein beliebiges Ger√§t gesendet: <br><br><pre> <code class="plaintext hljs">void DisplayTemperature () { cli(); // No interrupts if (OneWireReset() != 0) { sei(); DisplayError(0); // Device not found } else { OneWireWrite(SkipROM); OneWireWrite(ConvertT); while (OneWireRead() != 0xFF); OneWireReset(); OneWireWrite(SkipROM); OneWireWrite(ReadScratchpad); OneWireReadBytes(9); sei(); // Interrupts if (OneWireCRC(9) == 0) { int temp = DataWords[0]; Display((temp+8)&gt;&gt;4); // Round to nearest degree } else DisplayError(1); // CRC error } }</code> </pre> <br>  Als Antwort auf die Anforderung gibt der Sensor den Temperaturwert in Form einer 16-Bit-Ganzzahl mit Vorzeichen in Einheiten von 1/16 Grad zur√ºck.  Die Zahl wird auf den n√§chsten ganzzahligen Grad gerundet und durch Aufrufen der Routine Display () angezeigt. <br><br>  Die Unterroutine DisplayError () zeigt Fehler in der Interaktion des Mikrocontrollers mit dem Sensor am 1-Draht-Bus an: <br><br><pre> <code class="plaintext hljs">void DisplayError (int no) { Buffer[0] = Error; Buffer[1] = no; }</code> </pre> <br>  E0 - Sensor nicht erkannt, E1 - CRC Fehler. <br><br>  Daten f√ºr die dynamische Anzeige werden aus dem Array Buffer [] entnommen.  Um beispielsweise die Nummer 20 anzuzeigen, m√ºssen Sie Folgendes tun: <br><br><pre> <code class="plaintext hljs">Buffer[0]=2; Buffer[1]=0;</code> </pre> <br>  Der Timer-Z√§hler 0 erzeugt Interrupts mit einer Frequenz von 125 Hz, was ausreicht, um Flimmern zu beseitigen.  Zun√§chst wird der Timer in setup () konfiguriert. " <br><br><pre> <code class="plaintext hljs">TCCR0A = 2&lt;&lt;WGM00; // CTC mode; count up to OCR0A TCCR0B = 0&lt;&lt;WGM02 | 4&lt;&lt;CS00; // Divide by 256 OCR0A = 250-1; // Compare match at 125Hz TIMSK0 = 0; // Interrupts initially off</code> </pre> <br>  Die passende Interrupt-Behandlungsroutine w√§hrend des Vergleichs ruft die Routine DisplayNextDigit () auf und z√§hlt dann in die entgegengesetzte Richtung: <br><br><pre> <code class="plaintext hljs">ISR(TIM0_COMPA_vect) { DisplayNextDigit(); Ticks--; }</code> </pre> <br>  Die Unterroutine DisplayNextDigit () liest Daten aus der entsprechenden Zelle im Buffer [] -Array und enth√§lt die gew√ºnschten Segmente im entsprechenden Anzeigebit.  Das Programm verwendet #define, um zwischen einem Indikator mit einer gemeinsamen Kathode oder Anode zu w√§hlen.  Wenn alle Segmente beim Einschalten sofort leuchten, stimmt der Anzeigetyp nicht mit dem in der Firmware angegebenen √ºberein.  F√ºr eine gemeinsame Kathode muss das Unterprogramm durch Folgendes ersetzt werden: <br><br><pre> <code class="plaintext hljs">void DisplayNextDigit () { PORTB = PORTB | 1&lt;&lt;digit; // Turn old digit off digit = digit ^ 1; // Toggle between 0 and 1 char segs = charArray[Buffer[digit]]; PORTA = segs; // Lit segments high PORTB = PORTB &amp; ~(1&lt;&lt;digit); // Turn new digit on }</code> </pre> <br>  Schlie√ülich erzeugt die Routine Display () eine zweistellige Zahl zum Schreiben in das Array Buffer []: <br><br><pre> <code class="plaintext hljs">void Display (int n) { int units = n % 10; int tens = n / 10; int temp0 = tens; int temp1 = abs(units); if (tens &lt; -1) {temp0 = Lo; temp1 = Lo+1; } else if (tens &gt; 9) {temp0 = Hi; temp1 = Hi+1; } else if (tens == -1) temp0 = Minus1; else if ((tens == 0) &amp;&amp; (units &gt;= 0)) temp0 = Blank; else if ((tens == 0) &amp;&amp; (units &lt; 0)) temp0 = Minus; Buffer[0] = temp0; Buffer[1] = temp1; }</code> </pre> <br>  Es ber√ºcksichtigt auch die F√§lle, in denen das Minus zusammen mit dem Ger√§t in der hohen Ordnung angezeigt wird, sowie Meldungen √ºber die Temperatur au√üerhalb des Bereichs. <br><br>  Um die gr√∂√ütm√∂gliche Energieeinsparung zu erzielen, sind die Taktgeneratoren ADC, USI und ADC deaktiviert und der Schlafmodus PWR_DOWN ist aktiviert: <br><br><pre> <code class="plaintext hljs"> ADCSRA &amp;= ~(1&lt;&lt;ADEN); // Disable ADC to save power PRR = 1&lt;&lt;PRUSI | 1&lt;&lt;PRADC; // Turn off clocks to USI &amp; ADC to save power set_sleep_mode(SLEEP_MODE_PWR_DOWN);</code> </pre> <br>  Das Hauptprogramm zeigt die Temperatur f√ºr Zehntelsekunden an und schaltet dann den Schlafmodus ein.  Es stellte sich heraus, dass dies die minimale Anzeigezeit ist, die zum Lesen geeignet ist.  Zwei Sekunden bevor die Temperatur angezeigt wird, blinkt der Punkt kurz: <br><br><pre> <code class="plaintext hljs">void loop () { Buffer[0] = DP; Buffer[1] = Blank; DisplayOn(12); WDDelay(6); // Sleep for 1 second Buffer[0] = Blank; Buffer[1] = DP; DisplayOn(12); WDDelay(6); // Sleep for 1 second DisplayTemperature(); DisplayOn(12); WDDelay(9); // Sleep for 8 seconds WDDelay(9); // Sleep for 16 seconds WDDelay(9); // Sleep for 24 seconds }</code> </pre> <br>  Die Anzeige bleibt aufgrund von drei Watchdog-Anrufen f√ºr jeweils 8 Sekunden f√ºr 24 Sekunden ausgeschaltet.  Bei laufender Anzeige betr√§gt die Stromaufnahme 6,6 mA, im Ruhemodus - 4,7 ŒºA betr√§gt die durchschnittliche Stromaufnahme 1/240 * 6,6 mA.  Die typische Kapazit√§t der CR2032-Zelle betr√§gt 225 mAh, sodass sie f√ºr (225 / 6,6) x 240/24 = 340 Tage ausreicht - etwas weniger als ein Jahr. <br><br>  Die Temperaturbereiche der Komponenten sind wie folgt: Mikrocontroller und Anzeige - von -40 bis + 85 ¬∞ C, Widerst√§nde und Kondensator - von -55 bis +125 ¬∞ C, Batterien - von -20 bis +70 ¬∞ C.  Ein Element mit einem erweiterten Temperaturbereich BR2032 arbeitet im Bereich von -30 bis +85 ¬∞ C. <br><br>  Der Mikrocontroller ist mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dieser</a> Spence Konde-Entwicklung Arduino-kompatibel.  W√§hlen Sie in der IDE im Abschnitt ATTinyCore des Board-Men√ºs ATtiny24 / 44/84 aus.  Dann m√ºssen Sie die folgenden Optionen festlegen, ohne auf den Rest zu achten: <br><br><pre> <code class="plaintext hljs">Chip: "ATtiny84" Clock: "8 MHz (internal)" BOD: "BOD Disabled" Pin Mapping: "Clockwise (like damellis core)"</code> </pre> <br>  Das Programm wird mit dem Pomona-Testclip hochgeladen, auf den Mikrocontroller gelegt und mit dem SparkFun Tiny AVR-Programmierer verbunden.  Zuerst m√ºssen Sie Burn Bootloader ausw√§hlen und dann Hochladen ausw√§hlen. <br><br>  Links: Der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vollst√§ndige Text des Programms</a> , des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Boards und des Programms auf GitHub</a> , das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Board auf OSHpark</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de454220/">https://habr.com/ru/post/de454220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de454206/index.html">PHDays 9: AI CTF-Analyse</a></li>
<li><a href="../de454208/index.html">RISC-V von Grund auf neu</a></li>
<li><a href="../de454210/index.html">Vergessene Verzauberungen + neues 1C-Bitrix = Spiel zur Kundenmotivation</a></li>
<li><a href="../de454214/index.html">Ich hasse fast alle Software</a></li>
<li><a href="../de454216/index.html">Es wurden Beweise daf√ºr gefunden, dass alle √Ñnderungen eine Mischung aus Ordnung und Zufall sind</a></li>
<li><a href="../de454222/index.html">Aktualisieren Sie das Festplattensubsystem des alten Servers mit dem PCIe 1.0 - 2.0-Bus</a></li>
<li><a href="../de454224/index.html">Empfehlungen in Okko: Wie man Hunderte von Millionen verdient, indem man ein paar Matrizen multipliziert</a></li>
<li><a href="../de454226/index.html">Speicher auf zylindrischen magnetischen Dom√§nen. Teil 1. Arbeitsprinzip</a></li>
<li><a href="../de454232/index.html">OOP in grafischen Programmiersprachen. Teil 2 MOS und OOP</a></li>
<li><a href="../de454236/index.html">Zwei Geschichten dar√ºber, wie ANKI Ihnen helfen kann, eine Fremdsprache zu lernen und sich auf ein Interview vorzubereiten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>