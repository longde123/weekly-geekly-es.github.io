<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐰 🐩 😜 Zabbix - memantau tetangga OSPF menggunakan SNMPv3 TRAP, rasa sakit dan keputusasaan 🚻 🖍️ 👨🏼‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kerangka Acuan 
 Ada jaringan pusat data yang tersebar secara geografis dengan mobil VRF dan daftar tetangga OSPF yang selalu berubah. Anda perlu mela...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix - memantau tetangga OSPF menggunakan SNMPv3 TRAP, rasa sakit dan keputusasaan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417813/"><h2>  Kerangka Acuan </h2><br>  Ada jaringan pusat data yang tersebar secara geografis dengan mobil VRF dan daftar tetangga OSPF yang selalu berubah.  Anda perlu melacaknya: <br><br><ol><li>  Nyatakan, lakukan alarm jika keadaan tetangga tidak LENGKAP </li><li>  Kuantitas, yaitu, jika tetangga hilang, Anda juga harus melakukan alarm </li></ol><br>  Sistem pemantauan sudah ada - Zabbix 3.4, diinginkan untuk menggunakannya, Linux OS Debian 9.x <br><a name="habracut"></a><br><h2>  Kami mencoba dengan cepat </h2><br>  Protokolnya tersebar luas, sistem pemantauannya diketahui, saya mungkin bukan yang pertama yang ingin menyelesaikan masalah ini, dan kemungkinan besar sudah diselesaikan. <br><br>  Kami masuk ke pencarian untuk "zabbix ospf" dan tautan pertama mengarah ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">templat</a> .  Kebahagiaan adalah apa - sekarang saya mengimpornya, menyisirnya untuk kebutuhan saya dan semuanya akan menjadi dermaga yang baik. <br>  Kami memeriksa cara kerjanya - semuanya tampak baik-baik saja, negara dimonitor, tetapi ketika tetangga masuk ke kondisi BAWAH, kami mendapatkan pesan "sangat" informatif dari Zabbix <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">No</span></span> Such Instance currently <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> at this <span class="hljs-type"><span class="hljs-type">OID</span></span></code> </pre> <br>  dan info <br><br><pre> <code class="hljs pgsql">The item <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> discovered anymore <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> will be deleted <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">29</span></span>d <span class="hljs-number"><span class="hljs-number">23</span></span>h <span class="hljs-number"><span class="hljs-number">57</span></span>m (<span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-19</span></span> at <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>)</code> </pre> <br>  Apa yang terjadi - masalahnya sudah lama dan dikenal di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://www.opennet.ru/openforum/vsluhforumID3/109102.html)%2520%255B%25D0%25B4%25D0%25B2%25D0%25B0%255D(">forum</a> - ketika tetangga OSPF menghilang, maka semua OID yang terkait dengannya hanya dihapus pada perangkat keras jaringan. <br><br>  Ya, ada solusi - buat pemicu nodata, ok buat: <br><br><pre> <code class="hljs objectivec">{Template - SNMPv3 - OSPF Discovery:ospfNbrState[{<span class="hljs-meta"><span class="hljs-meta">#SNMPVALUE}].nodata(120)}=0</span></span></code> </pre> <br>  Kita lihat di dashboard: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">missing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">data</span></span></code> </pre> <br>  Pada dasarnya ... dapat digunakan <br><br>  Tapi di luar kotak, LLD hanya mendeteksi tetangga dari VRF default.  Tentu saja, ini dapat diatasi dengan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">konteks SNMP</a> , tetapi entah bagaimana saya tidak ingin pergi dengan cara ini sama sekali - kami harus melalui semua bagian besi, menyuntikkan konteks ke setiap proses OSPF atau VRF, kemudian membuat salinan Discovery untuk setiap konteks dalam template kami, secara umum itu sedikit banyak Repotnya dan saat menambahkan proses OSPF baru, Anda perlu mengubah sesuatu di beberapa tempat.  Anda dapat, tentu saja, dikelilingi oleh skrip dan melalui Zabbix API semua ini dapat diubah, tetapi saya tidak ingin kebiasaan khusus, tetapi saya hanya ingin menggunakan fungsi yang dibangun ke dalam Zabbix secara maksimal.  Ada yang menyebutkan tentang CISCO-CONTEXT-MAPPING-MIB, dari mana Anda dapat menarik semua korespondensi antara konteks dan OSPF / VRF, tapi saya tidak tahu bagaimana cara mempercepat desain ini ke LLD.  Jika seseorang tahu cara memasak Zabbix dengan sangat keren, maka selamat datang di komentar, dan lebih baik untuk artikel terpisah yang lengkap. <br><br><h2>  Kami mencoba dari serangan kedua </h2><br>  Setelah beberapa jam mencari di Internet untuk mendapatkan petunjuk di forum dan keluar dari tempat memori, sebuah topik muncul tentang SNMP TRAP - ini adalah saat kami tidak menginterogasi sepotong besi, tetapi sepotong besi mengirimkan informasi tentang mengubah sesuatu.  Ya, dan dukungan kampanye untuk hal ini ada di sistem pemantauan kami di luar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kotak</a> , peralatan juga dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">segera</a> dan hanya untuk kasus saya. <br><br>  Dari baris pertama, dokumentasi pemantauan dikacaukan oleh daftar panjang: <br><br><pre> <code class="hljs pgsql">The workflow <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> receiving a trap: <span class="hljs-number"><span class="hljs-number">1.</span></span> snmptrapd receives a trap <span class="hljs-number"><span class="hljs-number">2.</span></span> snmptrapd passes the trap <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> SNMPTT <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> calls Perl trap receiver <span class="hljs-number"><span class="hljs-number">3.</span></span> SNMPTT <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Perl trap receiver parses, formats <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> writes the trap <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> a file <span class="hljs-number"><span class="hljs-number">4.</span></span> Zabbix SNMP trapper reads <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> parses the trap file <span class="hljs-number"><span class="hljs-number">5.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> trap Zabbix finds <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> “SNMP trapper” items <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> host interfaces matching the received trap address. Note that <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> the selected “IP” <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> “DNS” <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> host interface <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> used during the matching. <span class="hljs-number"><span class="hljs-number">6.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> item, the trap <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> compared <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> regexp <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> “snmptrap[regexp]”. The trap <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> matched items. <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> matching item <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> there <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> an “snmptrap.fallback” item, the trap <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> that. <span class="hljs-number"><span class="hljs-number">7.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> the trap was <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> item, Zabbix <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> logs the unmatched trap. (This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> configured <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> “<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> unmatched SNMP traps” <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Administration → General → Other.)</code> </pre> <br>  Yaitu, satu daemon menerima TRAP, meneruskannya ke daemon lain, mem-parsingnya, meletakkannya di log dengan format yang diinginkan, dan zabix sudah membaca log dan memutuskan apa yang harus dilakukan selanjutnya.  Entah bagaimana itu sudah terlihat tidak pernah lebih mudah daripada berjalan dengan tangan Anda dan menggambar konteks SNMP di mana-mana, tapi oh well, mari kita coba.  Kami dengan hati-hati membaca dokumen pemantauan dan memahami bahwa hanya dengan bantuannya tidak ada yang dapat dikonfigurasikan, secara umum Zabbix memiliki lelucon seperti itu - dokumentasi menggambarkan kemampuan dan nuansa sistem sehingga minimal sehingga lebih membingungkan daripada diajarkan.  Meskipun mereka dapat dipahami - perangkat lunak ini gratis, tetapi entah bagaimana Anda perlu mendapatkan uang, tetapi mereka mendapatkan uang dengan dukungan.  Ada artikel di Internet dengan deskripsi tentang cara mengatur ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sekali atau</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dua kali</a> , tetapi saya tidak dapat mengatur dari satu artikel ke yang berikutnya, saya harus mengumpulkan informasi dari berbagai sumber sedikit demi sedikit.  Ini semua lirik, mereka melaju untuk melakukan hardcore. <br><br><h2>  Kami mengkonfigurasi sepotong jaringan besi </h2><br>  Sebelum Anda memutar sesuatu pada host dengan pemantauan, saya sangat menyarankan Anda mengkonfigurasi perangkat keras jaringan terlebih dahulu dan memastikan bahwa TRAP benar-benar datang dari perangkat keras ke server - pada awalnya saya tidak memeriksa bahwa ia minum banyak saraf, darah dan waktu.  Saya memiliki mobil Cisco Nexus, jadi saya akan memberikan contoh untuk seri ini.  Siapa pun yang memiliki Catalyst, ASR, ASA, dan sebagainya - maaf, saya bukan matahari, saya tidak akan memanaskan semuanya, membaca dok tentang cara mengonfigurasikannya sendiri, sintaksisnya akan serupa, tetapi dengan nuansa tersendiri. <br><br><pre> <code class="hljs pgsql">snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> contact noc@example.com snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">location</span></span> Room1 snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> source-interface traps loopback1</code> </pre> <br>  Adalah penting di masa depan, ketika mengkonfigurasi TRAP di Zabbix, bahwa alamat dari mana TRAP dikirim sama dengan alamat SNMP dari antarmuka di pengaturan host di Zabbix. <br><br><pre> <code class="hljs cs">snmp-server user Zabbix network-<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> auth sha <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> priv aes<span class="hljs-number"><span class="hljs-number">-128</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span></code> </pre> <br>  Gunakan versi 3 protokol sedapat mungkin, dalam mode authPriv (enkripsi dan otentikasi), tidak sesulit untuk dikonfigurasikan.  Lupakan versi 1 dan versi 2 protokol - ketika orang tak terduga tiba karena kurangnya enkripsi dan pada dasarnya otentikasi dalam versi protokol ini - itu hanya masalah waktu (string komunitas ditransmisikan dalam bentuk yang jelas, apalagi, saya secara teratur melihat bahwa itu dikonfigurasi publik / pribadi).  Parameter operator jaringan memungkinkan Anda memberikan izin hanya-baca bagi pengguna. <br><br><pre> <code class="hljs sql">snmp-server host 192.168.192.168 traps version 3 priv Zabbix snmp-server host 192.168.192.168 <span class="hljs-keyword"><span class="hljs-keyword">use</span></span>-vrf <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> host <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.192</span></span><span class="hljs-number"><span class="hljs-number">.168</span></span> <span class="hljs-keyword"><span class="hljs-keyword">source</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> loopback1 <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps ospf lsa snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps ospf <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_mib_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_module_status_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_power_status_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_module_inserted <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_module_removed <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_unrecognised_module <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_fan_status_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_power_out_change <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> linkDown <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> linkUp <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extended</span></span>-linkDown <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extended</span></span>-linkUp <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> cieLinkDown <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> cieLinkUp <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> connUnitPortStatusChange <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps bfd <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>-up <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">link</span></span> <span class="hljs-keyword"><span class="hljs-keyword">delayed</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">link</span></span>-state-<span class="hljs-keyword"><span class="hljs-keyword">change</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps bfd <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>-down <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rf redundancy_framework <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-license-expiry <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-<span class="hljs-keyword"><span class="hljs-keyword">no</span></span>-license-<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>-feature <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-licensefile-<span class="hljs-keyword"><span class="hljs-keyword">missing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps license notify-license-expiry-<span class="hljs-keyword"><span class="hljs-keyword">warning</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span> UpgradeOpNotifyOnCompletion <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span> UpgradeJobStatusNotify <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon risingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon fallingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon hcRisingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps rmon hcFallingAlarm <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps entity entity_sensor <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps generic coldStart <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> snmp-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> traps generic warmStart</code> </pre> <br>  Saya secara khusus menonaktifkan semua TRAP kecuali OSPF, sehingga ketika mendiagnosis mengapa sesuatu tidak berfungsi, saya tidak perlu membaca banyak informasi yang tidak perlu dari debug. <br><br>  Cara memeriksa apakah TRAP berfungsi sangat sederhana - Anda perlu memecahkan sesuatu.  Kami memulai sniffer pada host dengan memonitor: <br><br><pre> <code class="hljs pgsql">root@dc-zbx:~# tcpdump -i bond0 udp port <span class="hljs-number"><span class="hljs-number">162</span></span> tcpdump: <span class="hljs-keyword"><span class="hljs-keyword">verbose</span></span> output suppressed, use -v <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> -vv <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">full</span></span> protocol decode listening <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> bond0, link-<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> EN10MB (Ethernet), capture size <span class="hljs-number"><span class="hljs-number">262144</span></span> bytes</code> </pre> <br>  Kami menemukan pada sepotong tetangga besi hidup: <br><br><pre> <code class="hljs pgsql">SW# <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip ospf neighbors vrf <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> OSPF Process ID <span class="hljs-number"><span class="hljs-number">10</span></span> VRF <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">4</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.242</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">47</span></span>:<span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> Vlan1427 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.222</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">18</span></span>w1d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span> Vlan1426 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.149</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">5</span></span>w0d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.30</span></span> Vlan1473 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.146</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">3</span></span>d00h <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.58</span></span> Vlan1404 OSPF Process ID <span class="hljs-number"><span class="hljs-number">100</span></span> VRF OSPF100 Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">4</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.149</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">5</span></span>w0d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.34</span></span> Vlan1474 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.220</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">13</span></span>w3d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.54</span></span> Vlan1479 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.240</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">13</span></span>w3d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.46</span></span> Vlan1477 <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.146</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">3</span></span>d00h <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.62</span></span> Vlan1405 OSPF Process ID <span class="hljs-number"><span class="hljs-number">200</span></span> VRF Dia Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">2</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">10.65</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.252</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">17</span></span>w2d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.18</span></span> Vlan1450 <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.26</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">17</span></span>w0d <span class="hljs-number"><span class="hljs-number">172.17</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.26</span></span> Vlan1452 OSPF Process ID <span class="hljs-number"><span class="hljs-number">216</span></span> VRF Dev Total number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> neighbors: <span class="hljs-number"><span class="hljs-number">2</span></span> Neighbor ID Pri State Up <span class="hljs-type"><span class="hljs-type">Time</span></span> Address Interface <span class="hljs-number"><span class="hljs-number">10.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.94</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span> <span class="hljs-number"><span class="hljs-number">10.216</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.73</span></span> Vlan1641 <span class="hljs-number"><span class="hljs-number">10.216</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.82</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>/ - <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">10.216</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.82</span></span> Vlan1643</code> </pre><br>  Dan jatuhkan seseorang <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vlan</span></span></span><span class="hljs-class"> 1643 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shutdown</span></span></span></span></code> </pre> <br>  Kita melihat di sniffer: <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">20.001942</span></span> IP <span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.169</span></span>.<span class="hljs-number"><span class="hljs-number">22095</span></span> &gt; dc<span class="hljs-literal"><span class="hljs-literal">-zbx</span></span>.example.com.snmp<span class="hljs-literal"><span class="hljs-literal">-trap</span></span>: F=ap U=<span class="hljs-string"><span class="hljs-string">"Zabbix"</span></span> [!<span class="hljs-type"><span class="hljs-type">scoped</span></span> <span class="hljs-type"><span class="hljs-type">PDU</span></span>]<span class="hljs-number"><span class="hljs-number">39</span></span>_d1_7c_19_b3_d9_f8_31_32_8e_c9_39_c2_3a_db_d8_28_26_c6_0b_01_55_b6_fa_5e_f5_38_66_f9_6f_3f_c0_98_cb_57_93_5a_50_8e_50_90_79_f3_9b_ec_ec_d7_9f_e8_ac_f6_fd_79_ac_95_ff_71_73_32_70_52_66_a5_7d_b3_c4_39_d0_1c_7f_a6_38_ea_d7_61_c0_2f_12_ee_db_d9_07_40_8c_a8_48_57_e9_e5_56_12_3f_ec_f9_34_65_09_96_86_f6_d2_93_06_45_fa_95_ea_36_5a_82_2f_30_8f_02_03_59_07_5f_d8_a6_1c_f2_5a_be_7d_09_15_ef_05_00_83_fd_ea_ac_2a_3b_86_0f_86_e5_3b_93_3a_68_6d_33_99_e2_46_2b_9d_6a_1e_5d_9e_d9_93_56_51_5e_ff_9e_77_4c_cb</code> </pre> <br>  Jika Anda tidak melihat apa pun di sniffer, lakukan diagnosa, karena jika tidak, tidak ada alasan untuk melanjutkan, Anda tidak akan mengerti pada tahap mana sesuatu tidak bekerja untuk Anda. <br>  Jika tidak ada sepotong besi di tangan atau produksi tidak dapat disentuh, maka TRAP dapat dihasilkan dari mobil lain, misalnya, seperti ini: <br><br><pre> <code class="hljs powershell">snmptrap <span class="hljs-literal"><span class="hljs-literal">-v</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-literal"><span class="hljs-literal">-c</span></span> neveruseme <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-string"><span class="hljs-string">'.1.3.6.1.6.3.1.1.5.3'</span></span> <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-string"><span class="hljs-string">'55'</span></span> .<span class="hljs-number"><span class="hljs-number">1.3</span></span>.<span class="hljs-number"><span class="hljs-number">6.1</span></span>.<span class="hljs-number"><span class="hljs-number">6.3</span></span>.<span class="hljs-number"><span class="hljs-number">1.1</span></span>.<span class="hljs-number"><span class="hljs-number">5.3</span></span> s <span class="hljs-string"><span class="hljs-string">"teststring000"</span></span> snmptrap <span class="hljs-literal"><span class="hljs-literal">-v3</span></span> <span class="hljs-literal"><span class="hljs-literal">-l</span></span> authPriv <span class="hljs-literal"><span class="hljs-literal">-u</span></span> Zabbix <span class="hljs-literal"><span class="hljs-literal">-a</span></span> SHA <span class="hljs-literal"><span class="hljs-literal">-A</span></span> abyrvalg <span class="hljs-literal"><span class="hljs-literal">-x</span></span> AES <span class="hljs-literal"><span class="hljs-literal">-X</span></span> pechka <span class="hljs-literal"><span class="hljs-literal">-e</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>x8000000001020305 <span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.168</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> linkUp.<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><h2>  Konfigurasikan SNMPd, SNMPTRAPd, SNMPTT </h2><br>  Kami akan membutuhkan paket dalam sistem: <br><br><pre> <code class="hljs powershell">apt install snmp snmp<span class="hljs-literal"><span class="hljs-literal">-mibs</span></span><span class="hljs-literal"><span class="hljs-literal">-downloader</span></span> snmpd snmptrapd snmptt</code> </pre> <br>  Saya tidak fokus pada receiver perangkap Per, tetapi memilih SNMPTT untuk alasan pribadi dan subyektif.  Jadi, dermaga berkata: <br><br><pre> <code class="hljs markdown"><span class="hljs-bullet"><span class="hljs-bullet">1. </span></span>snmptrapd receives a trap</code> </pre> <br>  Kita perlu memulai dengan konfigurasinya, dan tidak segera naik untuk membuat Item di wajah Zabbix.  Mengapa begitu - Anda harus naik ke langkah yang sama dengan TRAP.  Pada bagian sebelumnya, kami memastikan bahwa TRAP pada dasarnya berasal dari sepotong besi, sekarang kami akan memastikan bahwa itu paling tidak diterima oleh daemon pertama - snmptrapd.  &lt;lyric&gt; Saya ingat mengatur postfix + dovecot + sesuatu yang lain di sana sejak lama.  Dan saya merajuk selama sekitar dua minggu - di sana juga, satu iblis menerima koneksi, yang lain mem-parsing surat itu, yang ketiga memasukkannya ke dalam antrian, yang keempat di folder ke pengguna, dan seterusnya, dan saya tidak berhasil.  Dan semua karena saya menyetel dari tengah, dari akhir, dari awal, tapi saya harus mulai dengan telnet ke port 25 dan melihat debugger the foxer &lt;/ lyric&gt; <br><br>  Kami naik ke /etc/snmp/snmptrapd.conf dan menghapusnya, tetapi kami mengomentari segala sesuatu yang kami tidak mengerti dan tidak tertarik, kami meninggalkan satu baris <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">disableAuthorization</span></span> <span class="hljs-literal"><span class="hljs-literal">yes</span></span></code> </pre> <br>  Hentikan layanan <br><br><pre> <code class="hljs sql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> snmptrapd.service</code> </pre> <br>  Jalankan dalam mode manual <br><br><pre> <code class="hljs pgsql">root@dc-zbx:~# snmptrapd -f -Lo NET-SNMP <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">5.7</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> AgentX subagent connected NET-SNMP <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">5.7</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span></code> </pre> <br>  Sekali lagi, coba hancurkan OSPF seperti pada contoh di atas dan lihat: <br><br><pre> <code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-literal"><span class="hljs-literal">-07</span></span><span class="hljs-literal"><span class="hljs-literal">-20</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span>:<span class="hljs-number"><span class="hljs-number">38</span></span> UNKNOWN [<span class="hljs-type"><span class="hljs-type">UDP</span></span>: [<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-type"><span class="hljs-type">.192.169</span></span>]:<span class="hljs-number"><span class="hljs-number">22095</span></span>-&gt;[<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-type"><span class="hljs-type">.192.168</span></span>]:<span class="hljs-number"><span class="hljs-number">162</span></span>]: DISMAN<span class="hljs-literal"><span class="hljs-literal">-EVENT</span></span><span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::sysUpTimeInstance = Timeticks: (<span class="hljs-number"><span class="hljs-number">1355817272</span></span>) <span class="hljs-number"><span class="hljs-number">156</span></span> days, <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">32.72</span></span> SNMPv2<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::snmpTrapOID.<span class="hljs-number"><span class="hljs-number">0</span></span> = OID: OSPF<span class="hljs-literal"><span class="hljs-literal">-TRAP</span></span><span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrStateChange OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfRouterId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.74</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrIpAddr = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrAddressLessIndex = INTEGER: <span class="hljs-number"><span class="hljs-number">0</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrRtrId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span>::ospfNbrState = INTEGER: down(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Jika kita tidak melihat, maka kita mencari alasannya.  Jika Anda ingin memiliki catatan indah yang sama, dan bukan satu set OID dari formulir 1.3.6.1.2.1.14.10.1.6, kemudian tambahkan yang berikut ke /etc/snmp/snmp.conf: <br><br><pre> <code class="hljs powershell">mibs +OSPF<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span> mibs +OSPF<span class="hljs-literal"><span class="hljs-literal">-TRAP</span></span><span class="hljs-literal"><span class="hljs-literal">-MIB</span></span> mibs +OSPFV3<span class="hljs-literal"><span class="hljs-literal">-MIB</span></span> mibdirs +/usr/share/snmp/mibs/ietf/</code> </pre><br>  Dan mendistorsi SNMPd <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> snmpd.service</code> </pre> <br>  Secara lebih rinci cara mengunduh file MIB dengan sedikit rasa sakit dan memberi mereka ke SNMPd Anda dapat dibaca [di sini] (https://wiki.debian.org/SNMP). <br><br>  Sekarang kita kencangkan otentikasi, kita naik lagi di /etc/snmp/snmptrapd.conf <br><br><pre> <code class="hljs vbscript">traphandle <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> snmptthandler #disableAuthorization yes # <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.192</span></span><span class="hljs-number"><span class="hljs-number">.169</span></span> createUser -e <span class="hljs-number"><span class="hljs-number">0x80000009038d604a6a82a3</span></span> Zabbix SHA <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> AES authuser <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">execute</span></span>,net Zabbix</code> </pre> <br>  -e 0x80000009038d604a6a82a3 adalah engineID, dapat dilihat pada perangkat keras jaringan: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">SW</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">sh</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">snmp</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">engineID</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Local</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SNMP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">engineID</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Hex]</span></span> 80000009038<span class="hljs-selector-tag"><span class="hljs-selector-tag">F604D6A82A1</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Dec]</span></span> 128<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:040</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:000</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:109</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:003</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:140</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:096</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:079</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:106</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:131</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:160</span></span></code> </pre> <br>  Kami mengulangi percobaan lagi, tetapi sekarang kami masih menangkap debug tentang USM: <br><br><pre> <code class="hljs rust">root@dc-zbx:~# snmptrapd -f -Lo -Dusm registered debug token usm, <span class="hljs-number"><span class="hljs-number">1</span></span> usmUser: created a new user Zabbix at <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>F <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>F <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">82</span></span> A5 NET-SNMP version <span class="hljs-number"><span class="hljs-number">5.7</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> AgentX subagent connected NET-SNMP version <span class="hljs-number"><span class="hljs-number">5.7</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> usm: USM processing begun... usm: <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> on user Zabbix usm: no <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> on engineID (<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>F <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>F <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">82</span></span> A5 ) usm: <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> on user Zabbix usm: Verification succeeded. usm: USM processing completed. <span class="hljs-number"><span class="hljs-number">2018</span></span>-<span class="hljs-number"><span class="hljs-number">07</span></span>-<span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span> UNKNOWN [UDP: [<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.169</span></span>]:<span class="hljs-number"><span class="hljs-number">22095</span></span>-&gt;[<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">192.168</span></span>]:<span class="hljs-number"><span class="hljs-number">162</span></span>]: DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (<span class="hljs-number"><span class="hljs-number">1355886163</span></span>) <span class="hljs-number"><span class="hljs-number">156</span></span> days, <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">01.63</span></span> SNMPv2-MIB::snmpTrapOID.<span class="hljs-number"><span class="hljs-number">0</span></span> = OID: OSPF-TRAP-MIB::ospfNbrStateChange OSPF-MIB::ospfRouterId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.74</span></span> OSPF-MIB::ospfNbrIpAddr = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF-MIB::ospfNbrAddressLessIndex = INTEGER: <span class="hljs-number"><span class="hljs-number">0</span></span> OSPF-MIB::ospfNbrRtrId = IpAddress: <span class="hljs-number"><span class="hljs-number">10.216</span></span>.<span class="hljs-number"><span class="hljs-number">0.82</span></span> OSPF-MIB::ospfNbrState = INTEGER: down(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Jika pada tahap ini Anda melihat kesalahan otorisasi dalam debug, periksa engineID dengan hati-hati dan bahwa pengguna yang dibuat pada perangkat keras cocok dengan yang kami gambar di konfigurasi /etc/snmp/snmptrapd.conf.  Ngomong-ngomong, ya, untuk setiap bagian dari besi Anda harus membuat pengguna Anda sendiri dengan engineID-nya, atau membuatnya sama pada semua bagian besi dengan tangan Anda, jika potongan-potongan besi memungkinkan ini dilakukan. <br><br>  Saya dapat melihat baris di debug: <br><br><pre> <code class="hljs pgsql">usm: <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> match <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> engineID (<span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>F <span class="hljs-number"><span class="hljs-number">60</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>F <span class="hljs-number"><span class="hljs-number">6</span></span>B <span class="hljs-number"><span class="hljs-number">82</span></span> A5 )</code> </pre> <br>  Mengapa saya tidak mengerti, meskipun dengan semua ini, TRAP diterima dan dapat diproses lebih lanjut.  Jika Anda tahu apa yang saya lakukan salah, silakan komentar. <br><br>  Sekarang kita mengambil SNMPTT - ia memiliki dua ini dan conf config.  Di bagian pertama kita tentukan parameter daemon itu sendiri, di bagian kedua kita tentukan parameter untuk menerima dan memproses setiap tangga tertentu. <br><br>  Kami naik ke file /etc/snmp/snmptt.ini dan menggambar hal-hal berikut: <br><br><pre> <code class="hljs perl">mode = daemon net_snmp_perl_enable = <span class="hljs-number"><span class="hljs-number">1</span></span> date_time_format = %Y %m %d %H:%M:%S</code> </pre> <br>  Format tanggal dan waktu adalah urusan bisnis, yang paling penting, gunakan yang sama di mana-mana. <br><br><pre> <code class="hljs pgsql">log_file = /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/snmptt/snmptt.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> log_system_file = /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/snmptt/snmpttsystem.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> unknown_trap_log_enable = <span class="hljs-number"><span class="hljs-number">1</span></span> unknown_trap_log_file = /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/snmptt/snmpttunknown.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span></code> </pre> <br>  Mengapa log tidak sama dengan banyak artikel di Internet?  Karena <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dok</a> berkata, "Jika parameter systemd PrivateTmp digunakan, file ini tidak mungkin berfungsi di / tmp.", Saya tidak ingin masuk lagi ke rake jika diperingatkan sebelumnya, jadi saya akan segera beralih ke jalur normal ke file. <br><br>  Selanjutnya, buka /etc/snmp/snmptt.conf, hapus semua yang tidak kita butuhkan dan / atau tidak mengerti, kita hanya menyisakan ini: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">EVENT</span></span> ospfNbrStateChange .<span class="hljs-number"><span class="hljs-number">1.3.6.1</span></span>.<span class="hljs-number"><span class="hljs-number">2.1.14.16</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-string"><span class="hljs-string">"OSPF"</span></span> Normal FORMAT ZBXTRAP <span class="hljs-variable"><span class="hljs-variable">$aA</span></span> OSPF neighbor with IP addr <span class="hljs-variable"><span class="hljs-variable">$2</span></span> changed state to <span class="hljs-variable"><span class="hljs-variable">$5</span></span></code> </pre> <br>  Dalam formulir ini, karena Zabbix akan mengharapkan format seperti itu di log.  Dari mana $ 2 dan $ 5 berasal, Anda dapat mengetahui apakah Anda melihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">format pesan TRAP</a> , lihat: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Object</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrStateChange</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OID</span></span> 1<span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MIB</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF-TRAP-MIB</span></span> ; <span class="hljs-selector-tag"><span class="hljs-selector-tag">Trap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Components</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfRouterId</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrIpAddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrAddressLessIndex</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrRtrId</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ospfNbrState</span></span></code> </pre> <br>  Komponen Perangkap ini adalah parameter yang dapat dimasukkan ke dalam format log dalam urutan $ 1, $ 2 ... <br><br>  Selama showdown dengan semua hal ini, saya perhatikan bahwa setelah mengubah pengaturan SNMPTT, seolah-olah perubahan itu tidak diterapkan.  Ternyata setelah perubahan mereka perlu me-restart bukan snmptt.serivce, tetapi snmpd.service - nuansa ini layak meminum darah saya dan meminum saraf saya selama debug. <br><br>  Pastikan Anda menjalankan semua daemon: <br><br><pre> <code class="hljs lua">systemctl <span class="hljs-built_in"><span class="hljs-built_in">status</span></span> snmpd snmptrapd snmptt</code> </pre> <br>  Jika semuanya baik-baik saja, coba lagi untuk memecah OSPF dan pergi ke log /var/log/snmptt/snmptt.log, akan terlihat seperti ini: <br><br><pre> <code class="hljs css">2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:52</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">down</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:28</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:12</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">full</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:22</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:41</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">down</span></span> 2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:25</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:38</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span></code> </pre> <br>  TRAP yang tidak kami konfigurasikan di config /etc/snmp/snmptt.conf akan masuk ke log /var/log/snmptt/snmpttunknown.log, tetapi hanya dari perangkat keras yang pengguna dan engineID yang benar dikonfigurasi dalam konfigurasi yang sama.  Artinya, dari kelenjar kiri, TRAP hanya akan diam-diam dijatuhkan, jika Anda ingin matan dan tanya jawab, maka di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> Anda memiliki dok waras yang tidak biasa di net-snmp, perbedaan antara TRAP dan INFORM masih dijelaskan dengan baik di sana, melihat ke depan, lebih baik menggunakan INFORM, dll. ada beberapa jenis kontrol pengiriman di sana, tetapi berfungsi melalui UDP melalui UDP. <br><br>  Dan baru sekarang kita naik untuk mengkonfigurasi monitor kita. <br><br><h2>  Pengaturan Zabbix </h2><br><br>  Pertama-tama, pastikan bahwa dalam konfigurasi /etc/zabbix/zabbix_server.conf, pemantauan diatur ke log SNMPTT yang benar dan Zabbix sendiri memulai setidaknya satu Trapper SNMP: <br><br> <code>SNMPTrapperFile=/var/log/snmptt/snmptt.log <br> StartSNMPTrapper=1</code> <br> <br>  Sebagai permulaan, saya membuat Item langsung pada host, sehingga lebih cepat dan lebih mudah untuk menangkap efek khusus, di sini saya akan segera menulis cara membuat Template, karena itu adalah template yang harus digunakan kapan pun memungkinkan.  Saya akan menunjukkan gambar-gambarnya, freebie salin-tempel sudah selesai, tetapi saya akan mengecat tempat-tempat yang perlu Anda perhatikan. <br><br>  Buat templat: <br><br><img src="https://habrastorage.org/webt/h_/ne/mw/h_nemwwcsrjzr1dvlqimgrmsq5e.png" alt="gambar"><br><br>  Di sini kita hanya memberikan nama yang waras <br><br>  Buat Barang <br><br><img src="https://habrastorage.org/webt/-c/hz/8k/-chz8klwqft17k391xp7epqusfs.png" alt="gambar"><br><br>  Penting - kuncinya harus seperti itu, apa yang ditunjukkan dalam tanda kurung adalah apa yang akan dicari Zabbix di log, kami mengonfigurasi format log di /etc/snmp/snmptt.conf dan menulis di sana: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">EVENT</span></span> ospfNbrStateChange .<span class="hljs-number"><span class="hljs-number">1.3.6.1</span></span>.<span class="hljs-number"><span class="hljs-number">2.1.14.16</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-string"><span class="hljs-string">"OSPF"</span></span> Normal FORMAT ZBXTRAP <span class="hljs-variable"><span class="hljs-variable">$aA</span></span> OSPF neighbor with IP addr <span class="hljs-variable"><span class="hljs-variable">$2</span></span> changed state to <span class="hljs-variable"><span class="hljs-variable">$5</span></span></code> </pre> <br>  Sebenarnya dalam log, ini adalah kata ajaib "OSPF" dan muncul: <br><br><pre> <code class="hljs css">2018 07 19 15<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:25</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:38</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ZBXTRAP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.216</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.82</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span></code> </pre> <br>  Format tanggal yang kami tentukan dalam konfigurasi /etc/snmp/snmptt.ini: <br><br><pre> <code class="hljs perl">date_time_format = %Y %m %d %H:%M:%S</code> </pre> <br>  Apa yang saya tulis di atas - gunakan format apa pun yang nyaman bagi Anda, hal utama adalah bahwa itu cocok di tempat yang tepat. <br><br>  Buat Pemicu <br><br><img src="https://habrastorage.org/webt/7q/ci/b4/7qcib4j6sxnym61nykigci8gyac.png" alt="gambar"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Seorang</a> tetangga mungkin memiliki beberapa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">negara</a> : <br><br><pre> <code class="hljs swift"><span class="hljs-number"><span class="hljs-number">1</span></span> : down <span class="hljs-number"><span class="hljs-number">2</span></span> : attempt <span class="hljs-number"><span class="hljs-number">3</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> : twoWay <span class="hljs-number"><span class="hljs-number">5</span></span> : exchangeStart <span class="hljs-number"><span class="hljs-number">6</span></span> : exchange <span class="hljs-number"><span class="hljs-number">7</span></span> : loading <span class="hljs-number"><span class="hljs-number">8</span></span> : full</code> </pre> <br>  Tidak masalah apa pun keadaan negara tetangga itu, jika keadaan ini tidak LENGKAP, karena untuk mendiagnosis ini, Anda masih harus pergi ke sepotong besi, membaca log, memasukkan beberapa perintah.  Jadi pemicunya akan menjadi satu dan akan bersemangat hanya ketika di TRAP keadaan tetangga tidak FULL. <br><br>  Sebelum menggantung templat pada host tertentu, pastikan host dikonfigurasikan dengan antarmuka SNMP yang benar dengan alamat IP yang benar, jika tidak tangga akan berada di log /var/log/snmptt/snmptt.log, tetapi Zabbix tidak akan "mengikat" mereka ke host.  Dalam hal ini, dalam log Zabbix dari server /var/log/zabbix/zabbix_server.log akan ada pesan berupa: <br><br><pre> <code class="hljs css">19972<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20180720</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:091722.896</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">unmatched</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">trap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">received</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> "192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span>": 2018 07 20 09<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:17</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:21</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Normal</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span>" 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.192</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.169</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OSPF</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">neighbor</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">with</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.64</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">changed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">state</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">exchangeStart</span></span></code> </pre> <br><br>  Pergi ke Data terbaru, lihat <br><br><img src="https://habrastorage.org/webt/pu/gj/w9/pugjw9j9ccjdnkj6x50trsfqeoc.png" alt="gambar"><br><br>  Pemicu juga berhasil <br><br><img src="https://habrastorage.org/webt/fm/wc/gp/fmwcgp5pjammodrcqjsrj3zpebe.png" alt="gambar"><br><br>  Sekarang taruh dua tetangga <br><br><img src="https://habrastorage.org/webt/7e/uh/d5/7euhd5pegn-7b_6ofpxmbctzt8c.png" alt="gambar"><br><br>  Di dasbor, kami melihat bahwa dua masalah terjadi, ini bagus, dan bahkan dua huruf akan tiba pada topik ini dengan pemberitahuan yang dikonfigurasi. <br><br>  Semuanya bagus, semuanya bekerja, dan inilah ceri pada kue di akhir. <br><br><div class="spoiler">  <b class="spoiler_title">Keputusasaan</b> <div class="spoiler_text">  Sekarang kita mengambil dan membesarkan satu tetangga.  Pada saat yang sama, kedua masalah akan hilang di dasbor sekaligus.  Ini bukan bug, ini fitur.  Saya tidak sengaja melihat nuansa seperti itu ketika saya menguji templat.  Akibatnya, ternyata jika beberapa tetangga jatuh, dan kemudian salah satu dari mereka naik, atau bahkan jika tetangga naik, yang tidak ada sebelumnya, maka pemantauan akan berubah menjadi hijau. <br>  Tentu saja, Anda dapat mengonfigurasi Item dengan tangan Anda untuk melacak tetangga tertentu, Anda masih dapat membuat skrip sesuatu, Anda dapat kembali ke konteks SNMP dari awal artikel.  Masih ada ide untuk menggambar skrip yang akan pergi SSH / API ke kelenjar jaringan, mengumpulkan informasi tentang semua tetangga, membuat gips "bekerja", menganalisis perbedaan antara cek dan menulis apa yang salah dalam log, maka log dapat diumpankan ke monitor ... sulit.  Saya ingin kruk dan kebiasaan minimum.  Jika Anda tahu cara yang masuk akal untuk menyelesaikan masalah ini atau berpikir bahwa saya melakukan semuanya dengan salah, sekali lagi saya bertanya dalam komentar, tetapi lebih pada artikel tanggapan. <br></div></div><br><br>  UPD: kolega kami menyarankan kami untuk mengatasinya dan mencoba menerapkan rencana kami menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">konteks SNMP</a> .  Ada permintaan, akan ada pasokan.  Ke depan bisa saya katakan - iblis tidak begitu mengerikan, ayo pergi. <br>  Pada sepotong jaringan besi kita menggambar perintah ajaib: <br><br> <code>snmp-server context {snmp context name} instance {protocol instance} vrf {vrf name}</code> <br> <br>  Nama parameter perlu klarifikasi <br>  {snmp context name} - nama konteks SNMP yang akan digunakan dalam permintaan. <br>  {protocol instance} dan {vrf name} yang kami ambil dari konfigurasi proses OSPF yang dikonfigurasi: <br><br> <code>router ospf {protocol instance} <br> .. <br> vrf {vrf name} <br> ..</code> <br> <br>  Ada ketakutan bahwa setelah pengaturan seperti itu kita akan menghancurkan Item yang sudah dikonfigurasi melalui SNMP dengan konteks kosong, tapi saya memeriksa bahwa pengaturan hanya mempengaruhi output data melalui OSPF-MIB, sedangkan misalnya dari bagian IF-MIB semuanya terus dikembalikan seperti sebelumnya dengan konteks kosong.  Jika Anda tidak memiliki Nexus, saya sarankan memeriksa titik ini sekali lagi - kemungkinan perilakunya akan berbeda. <br><br>  Sekarang putar template di Zabbix. <br>  Anda harus membuat aturan Discovery baru dengan konteks: <br><br><img src="https://habrastorage.org/webt/by/xd/ph/byxdpha64kwdstjxoipfjr3avl0.png" alt="gambar"><br><br>  Prototipe Item Baru juga dengan konteks <br><br><img src="https://habrastorage.org/webt/oy/e1/2x/oye12xxe-ec-ohifymjb-zizpom.png" alt="gambar"><br><br>  Dan dua pemicu - yang pertama - untuk alarm jika tetangga dalam keadaan apa pun kecuali LENGKAP: <br><br><img src="https://habrastorage.org/webt/rj/gs/os/rjgsosmcwivhwhxjtnjheyymhza.png" alt="gambar"><br><br>  dan yang kedua - jika tetangga hilang: <br><br><img src="https://habrastorage.org/webt/sb/cx/i3/sbcxi3qrz-d-c82vyk_khmaw6im.png" alt="gambar"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id417813/">https://habr.com/ru/post/id417813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id417793/index.html">Lupakan tentang megastruktur alien: pengamatan baru menjelaskan perilaku bintang Tabby hanya debu</a></li>
<li><a href="../id417795/index.html">Obsesi saya dengan video game di masa remaja saya bukanlah "gangguan game"</a></li>
<li><a href="../id417801/index.html">Bagaimana saya pindah ke Israel setelah memblokir Telegram</a></li>
<li><a href="../id417803/index.html">Pemrosesan foto batch dalam Blender</a></li>
<li><a href="../id417809/index.html">AI, tentu saja praktis. Arsitektur jaringan saraf dalam modern untuk klasifikasi gambar</a></li>
<li><a href="../id417821/index.html">Network Digest: 20 bahan ahli tentang protokol, standar, dan keamanan informasi</a></li>
<li><a href="../id417823/index.html">Generasi Baru: Jaringan 5G komersial pertama di dunia diluncurkan</a></li>
<li><a href="../id417825/index.html">"Memperluas batas": rentang 6 GHz akan diberikan untuk kebutuhan Wi-Fi</a></li>
<li><a href="../id417827/index.html">Wi-Fi gratis: Pengadilan Jerman menghapus hukuman untuk kedai kopi untuk pelanggaran hak cipta pelanggan</a></li>
<li><a href="../id417829/index.html">Kurangi jumlah lapisan arsitektur dari 5 menjadi 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>