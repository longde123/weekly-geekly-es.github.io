<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçü§ù‚Äçüë©üèΩ üíó ‚ôíÔ∏è Niveaux d'abonnement renouvelables automatiquement dans l'application iOS ü§¶üèæ üå´Ô∏è ü•ô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut, c'est Renat d' Apphud . Dans cet article, nous vous dirons quels sont les niveaux d'abonnements auto-renouvelables, comment les configurer corr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Niveaux d'abonnement renouvelables automatiquement dans l'application iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/apphud/blog/475758/"><p><img src="https://habrastorage.org/webt/ak/pz/18/akpz184-wzln3efdt6el6whs19o.png" alt="image"></p><br><p> Salut, c'est Renat d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Apphud</a> .  Dans cet article, nous vous dirons quels sont les niveaux d'abonnements auto-renouvelables, comment les configurer correctement et dans quels cas l'utilisateur est rembours√© pour une p√©riode pay√©e non utilis√©e. <a name="habracut"></a></p><br><h2 id="chto-takoe-uroven-podpiski">  Quel est le niveau d'abonnement? </h2><br><p>  Il s'agit de la d√©signation de la classe d'abonnement, en fonction du niveau de service qu'elle propose.  L'abonnement √† la premi√®re classe signifie le niveau de service le plus √©lev√©, la deuxi√®me classe - inf√©rieure, etc.  En fait, rarement dans quelle application pouvez-vous trouver deux niveaux d'abonnement, sans parler de trois ou plus. </p><br><img src="https://habrastorage.org/webt/ek/ow/4r/ekow4rj6bw6nunu1yi078dzat1c.png"><br><p>  <em>Deux niveaux d'abonnement dans l'application du journal The New York Times.</em> </p><br><h2 id="kak-nastroit-urovni-podpiski">  Comment configurer les niveaux d'abonnement? </h2><br><p>  Pour configurer vos niveaux d'abonnement, acc√©dez √† l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">App Store Connect</a> , s√©lectionnez votre application et acc√©dez √† l'onglet <em>Fonctionnalit√©s</em> .  Dans la section des achats int√©gr√©s, d√©placez votre abonnement d'un niveau vers le haut ou vers le bas.  Pour ce faire, s√©lectionnez l'abonnement souhait√© en appuyant longuement sur l'ic√¥ne glisser-d√©poser et d√©placez l'abonnement au niveau souhait√©. </p><br><img src="https://habrastorage.org/webt/mq/aq/8v/mqaq8vvrm_z0hkqsn8gvqso9fdc.gif"><br><p>  <em>Faites glisser et d√©posez un abonnement √† un niveau sup√©rieur.</em> </p><br><p>  L'abonnement num√©ro 1 devrait offrir le plus haut niveau de service, par exemple, l'abonnement √† toutes les cat√©gories de magazines.  Il n'y a aucune d√©pendance entre la dur√©e de l'abonnement et son niveau.  Ainsi, l'abonnement le plus √©lev√© peut √™tre annuel et un abonnement √† un niveau inf√©rieur √† un mois. </p><br><h2 id="izmenenie-podpiski">  Modifier l'abonnement </h2><br><p>  L'utilisateur peut modifier l'abonnement dans l'application App Store apr√®s son inscription.  Il peut augmenter (mettre √† niveau), abaisser (r√©trograder) un niveau ou modifier un abonnement au sein du m√™me niveau (cross-grade). </p><br><h4 id="povyshenie-urovnya-podpiski-apgreyd">  Mise √† niveau du niveau d'abonnement (mise √† niveau) </h4><br><p>  Si l'abonnement actuel de l'utilisateur est actif, il passera imm√©diatement √† un nouveau tarif et la partie inutilis√©e de la p√©riode pay√©e sera retourn√©e √† la carte. </p><br><img src="https://habrastorage.org/webt/y-/fl/7d/y-fl7dwabjscib2zi6wwkwnwmdq.png"><br><p>  <em>Notification qu'une partie des fonds sera rembours√©e lors de la mise √† niveau de l'abonnement.</em> </p><br><p>  √Ä la fin de l'article, nous verrons comment rattraper l'augmentation du niveau d'abonnement et calculer le montant du retour. </p><br><h4 id="ponizhenie-urovnya-podpiski-daungreyd">  Abaissement de l'abonnement (d√©classement) </h4><br><p>  En abaissant le niveau, l'utilisateur passe √† un nouveau √† la fin de la p√©riode pay√©e en cours.  Les fonds ne sont pas rembours√©s et le co√ªt d'un nouvel abonnement est d√©bit√© lors de l'activation. </p><br><h4 id="smena-podpiski-v-ramkah-odnogo-urovnya-krossgreyd">  Changement d'abonnement au m√™me niveau (cross-grade) </h4><br><p>  Il s'agit d'une situation courante, elle est divis√©e en deux types: un changement d'abonnement d'une dur√©e et diff√©rent.  Lors du changement d'un abonnement d'une dur√©e diff√©rente, la m√™me chose se produira qu'avec une r√©trogradation: l'abonnement sera appliqu√© √† la fin de la p√©riode pay√©e en cours. </p><br><p>  Si les dur√©es correspondent, l'abonnement en cours sera annul√© et un nouveau commencera imm√©diatement.  L'argent sera d√©bit√© pour le nouvel abonnement et la partie inutilis√©e de l'ancien abonnement sera retourn√©e √† l'utilisateur. </p><br><h2 id="kak-uznat-o-smene-podpiski-na-servere">  Comment s'informer sur la modification de l'abonnement sur le serveur? </h2><br><p>  Vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">valider la v√©rification de l'App Store</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©couter</a> les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notifications du serveur</a> Apple. </p><br><p>  Lors de la v√©rification de chaque nouvelle transaction, vous devez v√©rifier si <em>product_id</em> a chang√©.  La modification de <em>product_id</em> signifie que l'utilisateur a modifi√© son abonnement dans les param√®tres de l'App Store. </p><br><p> De plus, vous pouvez consulter la valeur de <code>auto_renew_product_id</code> dans <code>pending_renewal_info</code> .  Il vous aidera √† en savoir plus sur une modification de <em>product_id</em> avant qu'un nouvel abonnement ne prenne effet. </p><br><p>  Si vous avez configur√© des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notifications de serveur</a> , √©coutez la notification <em>DID_CHANGE_RENEWAL_PREF</em> qui est appel√©e lorsqu'un produit est <em>modifi√©</em> .  Vous pouvez vous limiter √† cette notification et obtenir le nouveau <em>product_id √†</em> partir des param√®tres de demande, ou vous pouvez rev√©rifier le re√ßu de l'App Store.  Dans ce dernier cas, les notifications du serveur Apple ne serviront que de d√©clencheur pour une v√©rification non planifi√©e. </p><br><h2 id="kak-vychislit-summu-vozvrata-pri-apgreydah">  Comment calculer le montant du retour pour les mises √† niveau? </h2><br><p>  Pour savoir s'il y a eu une mise √† niveau, vous devez v√©rifier la valeur du champ <code>is_upgraded</code> .  Une valeur <code>true</code> signifie que la prochaine transaction est d√©j√† dans le nouvel abonnement. </p><br><p>  Notez que <code>is_upgraded</code> sera <code>true</code> m√™me lors de la modification d'un abonnement de m√™me dur√©e dans le m√™me niveau.  Autrement dit, <code>is_upgraded = true</code> ne signifie pas une augmentation de niveau, mais le fait qu'un changement d'abonnement a √©t√© effectu√© avec un remboursement. </p><br><p>  En plus du champ <code>is_upgraded</code> , le champ <code>is_upgraded</code> appara√Ætra dans cette transaction, ce qui indique l'heure de l'annulation.  Elle est √©gale ou co√Øncide presque avec la date de d√©but de la prochaine transaction. </p><br><p>  Il s'av√®re que le champ <code>cancellation_date</code> appara√Æt <strong>non seulement lorsque l'abonnement est renvoy√©</strong> , mais √©galement lors de la mise √† niveau. </p><br><p>  Notez que <strong>lors de la mise √† niveau des abonnements Sandbox, le champ <code>cancellation_date</code> est manquant</strong> .  Par cons√©quent, lors des tests dans Sandbox, vous devez utiliser la date d' <code>purchase_date</code> prochaine transaction au lieu de la date d' <code>cancellation_date</code> .  En savoir plus sur la date d'annulation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans la documentation Apple</a> . </p><br><p>  Pour calculer le montant qui doit √™tre retourn√© √† l'utilisateur, vous devez diviser la p√©riode inutilis√©e par la p√©riode compl√®te de l'abonnement pr√©c√©dent et multiplier par son co√ªt: </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># upgrade_date is `cancellation_date` in prodiction or `purchase_date` of new transaction in sandbox # to_f converts date to float timestamp value prorate_amount = price * (upgrade_date.to_f - cancellation_date.to_f) / (expires_date.to_f - purchase_date.to_f)</span></span></code> </pre> <br><h2 id="kak-eto-realizovano-v-apphud">  Comment est-ce mis en ≈ìuvre dans Apphud? </h2><br><p>  Apphud suit automatiquement les modifications des abonnements et calcule le retour des pi√®ces non utilis√©es. </p><br><img src="https://habrastorage.org/webt/i-/ni/wk/i-niwkapdw5jjoaztapmznegq-c.png"><br><p>  <em>Un exemple de changement de souscription au m√™me niveau avec le retour d'une partie des fonds en Apphud.</em> </p><br><p>  Un d√©veloppeur iOS n'est pas tenu de g√©rer lui-m√™me ces situations.  Il vous suffit d'int√©grer le SDK, le reste sera fait par Apphud. </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Il s'av√®re que la simple mise √† jour de la valeur de <code>product_id</code> ne suffit pas: vous devez √©galement envisager le remboursement des mises √† niveau.  Travailler avec des abonnements n√©cessite de g√©rer de nombreuses situations limites.  Nous faisons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Apphud</a> - un service qui simplifie consid√©rablement le travail avec les abonnements.  Vous pouvez commencer √† l'utiliser gratuitement.  Inscription - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur ce lien</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr475758/">https://habr.com/ru/post/fr475758/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr475744/index.html">Mod√®le d'administrateur syst√®me √† quatre niveaux</a></li>
<li><a href="../fr475746/index.html">Anatomie des syst√®mes acoustiques: Cermets et composites - √Ä propos des diffuseurs audio de moniteur</a></li>
<li><a href="../fr475750/index.html">Transfert de connaissances et traduction automatique de neurones en pratique</a></li>
<li><a href="../fr475754/index.html">Short sur Scrum</a></li>
<li><a href="../fr475756/index.html">Food Design Digest octobre 2019</a></li>
<li><a href="../fr475760/index.html">D√©veloppeurs juniors - pourquoi nous les embauchons et comment nous travaillons avec eux</a></li>
<li><a href="../fr475762/index.html">Un curriculum vitae avec une photo vole dans une urne. Caract√©ristiques de la recherche d'emploi aux √âtats-Unis</a></li>
<li><a href="../fr475764/index.html">Cha√Ænes de Markov pour la g√©n√©ration de b√¢timents proc√©duraux</a></li>
<li><a href="../fr475768/index.html">Kotlin: En quoi est-ce un excellent choix pour le d√©veloppement d'applications Android?</a></li>
<li><a href="../fr475770/index.html">Universit√© de Stanford - Visite et examen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>