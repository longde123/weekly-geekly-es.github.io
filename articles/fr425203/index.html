<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéæ ü§πüèª üë∏üèº Ancienne vuln√©rabilit√© UPnP d'une nouvelle fa√ßon üè¥‚Äç‚ò†Ô∏è üë≤üèΩ üßîüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tout ce qui est nouveau est un ancien bien oubli√© (ou mieux, un ancien tr√®s bien oubli√©). Bien s√ªr, il est correct de surveiller les nouvelles vuln√©ra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ancienne vuln√©rabilit√© UPnP d'une nouvelle fa√ßon</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425203/">  Tout ce qui est nouveau est un ancien bien oubli√© (ou mieux, un ancien tr√®s bien oubli√©).  Bien s√ªr, il est correct de surveiller les nouvelles vuln√©rabilit√©s, mais il ne faut pas oublier les anciennes.  Surtout quand le constructeur se permet de les ¬´oublier¬ª.  Quelqu'un doit se souvenir.  Sinon, nous marcherons sur le m√™me r√¢teau encore et encore. <br><br>  L'article se concentrera sur un ancien, mais il s'est av√©r√© qu'il n'a jamais perdu sa pertinence √† ce jour, le trou UPnP. <br><br><img src="https://habrastorage.org/webt/n8/oe/yl/n8oeyllfk_t6lcecxmgt5jfakuw.jpeg"><br><br>  PS Je n'appellerai pas le fournisseur, il n'est pas coupable de cela, mais d'un autre c√¥t√© il y a une claire surveillance des politiques de s√©curit√© qui, coupl√©e √† l'architecture r√©seau, a permis d'exploiter cette vuln√©rabilit√©.  Comme toujours, les √©toiles convergent.  Le fournisseur a install√© des routeurs sur son r√©seau aux clients avec les puces n√©cessaires et l'a connect√© avec une adresse IP externe.  Oui, la plupart des ports ont √©t√© filtr√©s, mais pour une raison quelconque, pas 52869. <br><br>  PPS Tous les √©v√©nements se sont produits fin 2018.  Les h√©ros sont fictifs et les co√Øncidences avec de vraies personnalit√©s sont al√©atoires. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Bref programme √©ducatif:</b> <div class="spoiler_text">  Il existe une biblioth√®que libupnp pour le d√©veloppement qui "est utilis√©e sur des milliers de p√©riph√©riques et s'appelle le SDK Intel pour les p√©riph√©riques UPnP ou le SDK portable pour les p√©riph√©riques UPnP". <br><br>  En anglais: <br><blockquote>  "Le SDK portable pour les p√©riph√©riques UPnP (libupnp) fournit aux d√©veloppeurs une API et un code open source pour la cr√©ation de points de contr√¥le, de p√©riph√©riques et de ponts qui sont conformes √† la version 1.0 de la sp√©cification Universal Plug and Play Device Architecture et prennent en charge plusieurs syst√®mes d'exploitation comme Linux , * BSD, Solaris et autres. ‚Äù </blockquote><br></div></div><br>  La premi√®re mention de la vuln√©rabilit√© remonte √† 2014: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">tyk</a> <br>  Les tentatives de contacter le fabricant n'ont pas √©t√© couronn√©es de succ√®s et la vuln√©rabilit√© a √©t√© publi√©e.  La seule recommandation de contre-r√©action √©tait: <br><blockquote>  "... restreindre l'interaction avec le service ... Seuls les clients et les serveurs qui ont une relation proc√©durale l√©gale ... devraient pouvoir communiquer avec lui." </blockquote>  Une faille existe dans le service SOAP miniigd.  Le probl√®me est le traitement des demandes NewInternalClient en raison de l'impossibilit√© d'effacer les donn√©es utilisateur avant d'effectuer un appel syst√®me.  Un attaquant pourrait utiliser cette vuln√©rabilit√© pour ex√©cuter du code avec les privil√®ges root. <br><br>  C'est-√†-dire  Sur tous les routeurs avec UPnP version 1.0, vous pouvez ex√©cuter du code √† distance arbitraire. <br>  Sans autorisation.  De la racine.  Super, non? <br><br>  Tout le monde peut trouver un plugin pr√™t √† l'emploi pour le m√©tasplit sur github, dont les performances ont √©t√© test√©es par les chaises br√ªl√©es de nos ing√©nieurs de service. <br>  C'√©tait inattendu et pas du tout amusant. <br><br><h3>  Une br√®ve chronologie des √©v√©nements de cette journ√©e: </h3><br>  <b>14:00</b> Dans le support technique, les abonn√©s commencent √† recevoir des appels vers Internet qui fonctionne mal. <br><br><ul><li>  <u>Sympt√¥mes c√¥t√© client:</u> "√ßa marche lentement, apr√®s un red√©marrage √ßa marche bien pendant un moment, puis encore lentement." </li><li>  <u>Sympt√¥mes de la part de l'√©quipement: une</u> petite augmentation du trafic et des charges CPU ont √©t√© annul√©es sur la charge g√©n√©r√©e par le client. </li></ul><br>  Les applications individuelles sont enregistr√©es pour v√©rifier la ligne pour les administrateurs ou pour le d√©part de l'installateur.  Il n'y a pas de mod√®le d'action commun.  Rien n'est clair. <br><br>  <b>15:00 Le</b> nombre d'applications commence √† d√©passer la temp√©rature moyenne √† l'h√¥pital et les applications individuelles commencent √† sculpter en applications pour plus avec le type d '"Accident".  Les demandes sont soumises aux administrateurs sup√©rieurs pour v√©rifier les segments de r√©seau. <br><br>  <b>15:20 Les administrateurs</b> arr√™tent les accidents de masse, car  Il n'y a aucun probl√®me sur le r√©seau, toutes les demandes des clients provenant de diff√©rents points de connexion sont uniques.  (Par exemple: le commutateur est plein d'abonn√©s actifs, mais il ne fonctionne pas bien pour un).  En ce moment, les appels tombent et tout se calme.  Quelqu'un fait attention (enfin) que toutes les applications pour mauvais travail √©taient avec le m√™me mod√®le de routeur, tout le monde pr√©tend que tout va bien. <br><br>  <b>15h30</b> Encore une fois l'afflux de candidatures d'abonn√©s, encore une fois l'enregistrement d'un accident de masse et le transfert aux admins.  En ce moment, il devient clair que quelque chose <b>ne</b> va <b>vraiment</b> pas et que quelque chose doit √™tre fait (qui a travaill√© avec le service client comprendra √† quel point il est parfois difficile de le faire. Les clients mentent <s>toujours</s> , et parfois la premi√®re ligne se trouve pour intensifier la t√¢che) . <br><br>  <b>15:35 L'</b> ing√©nieur de service re√ßoit une demande de probl√®me avec le service client.  Obtient une liste de tous les clients, leur type de connexion et le mod√®le de p√©riph√©rique.  Et puis un peu de magie commence. <br><br><img src="https://habrastorage.org/webt/m9/hj/ba/m9hjbaxp9s7onm3ba8nykkcymwe.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">spoiler</b> <div class="spoiler_text">  Ce qui, en passant, n'a pas fonctionn√©, puis le magicien principal a √©t√© licenci√© (mais ils disent que ce n'est pas pour √ßa). <br></div></div><br>  <b>15:40 L'</b> ing√©nieur ex√©cute la liste des clients √† travers tous les diagnostics qui sont, chaque routeur a √©t√© v√©rifi√© selon toutes les m√©triques standard et ... rien n'a √©t√© trouv√©.  Un routeur est comme un routeur.  Oui, le CPU a augment√©, mais les indicateurs ne sont pas critiques, mais il verse du trafic quelque part, ce qui signifie que cela fonctionne. <br><br>  Oui, le service UPnP tourne sur le port 52869.  Oui, il y a encore un tas de ports ouverts, ouverts signifie qu'ils sont n√©cessaires (logique de fer), et cela s'est toujours retourn√© et il n'y a pas eu de probl√®mes (autre argument de logique de fer).  La connexion directe √† ce mod√®le de routeur n'est pas possible (franchement, c'est possible, mais √† l'int√©rieur de la bo√Æte occup√©e et des politiques de l'entreprise fortement all√©g√©es, une telle promenade autour des appareils clients √©tait fortement d√©conseill√©e).  Tout s'est √† nouveau lev√©. <br><br>  <b>16:00</b> Ce n'est que maintenant que nous d√©couvrons qu'il y a des probl√®mes.  L'ing√©nieur en service rend compte √† son superviseur, et le superviseur nous appelle au sujet de ses suppositions concernant le port 52869 et demande de l'aide. <br><br>  <b>16:05</b> Ensuite, tout s'est pass√© tr√®s rapidement.  Le m√™me mod√®le de routeur est inclus sur le banc de test, l'adresse IP est prise du client probl√©matique et accroch√©e sur celui de test.  Le Wirehark est activ√©.  C'est pour intercepter les requ√™tes sur l'appareil. <br><br>  Afin d'intercepter les demandes du routeur (√† cette √©poque, le sch√©ma g√©n√©ral de la fa√ßon dont l'interaction √©tait encore inconnue), le client est isol√© dans le segment de test et tout son trafic est mis en miroir vers la machine de test la plus proche o√π un autre wirehark est lev√©. <br><br>  On attend plus loin, on regarde l'√©cran. <br><br>  Les hacks √©taient d√©j√† pris de cette fa√ßon - assez efficacement et ont donc d√©cid√© de ne pas changer leurs habitudes. <br><br>  <b>16:10</b> Alors que wirehark bruit, Google pr√©sente une vuln√©rabilit√© CVE-2014-8361 √† propos de laquelle elle est signal√©e aux ing√©nieurs.  L'ing√©nieur, sans l'√©couter, prend une d√©cision (et, en principe, logique) - le filtre de ce port √† la fronti√®re.  Aussit√¥t dit, aussit√¥t fait. <br><br><div class="spoiler">  <b class="spoiler_title">spoiler</b> <div class="spoiler_text">  Cela n'a pas fonctionn√©. <br></div></div><br>  <b>16:25</b> On nous dit que <s>tout remake de merde Misha</s> n'a pas fonctionn√©.  Et nous savions d√©j√† que cela ne fonctionnerait pas.  √Ä ce moment-l√†, ils avaient d√©j√† frapp√© sur le routeur de test, lev√© l'inverse sur <b>un autre</b> port et commenc√© √† l'utiliser pour le port DDOS-a √† 1900 (!) En utilisant une autre vuln√©rabilit√©.  <s>Seigneur, quelle poubelle qui fuit</s> <br><br><div class="spoiler">  <b class="spoiler_title">programme encore √©ducatif</b> <div class="spoiler_text">  Utilisation dans les attaques DDoS <br><br>  En 2014, ils ont d√©couvert de mani√®re inattendue que SSDP √©tait utilis√© dans des attaques DDoS telles que ¬´attaque par r√©flexion SSDP avec amplification¬ª.  De nombreux appareils, y compris les routeurs domestiques, pr√©sentaient une faille dans le logiciel UPnP, qui permettait √† un attaquant d'envoyer des r√©ponses du port 1900 √† une adresse arbitraire sur Internet.  Dans le cas de l'utilisation d'un botnet √† partir de plusieurs milliers de ces appareils, l'attaquant pourrait cr√©er un grand flux de paquets suffisant pour occuper la bande passante et saturer les canaux de donn√©es du site attaqu√©, ce qui conduirait √† un d√©ni de service pour les utilisateurs ordinaires. <br></div></div><br>  La chose la plus int√©ressante est que les r√®gles de pare-feu sur l'appareil ont √©t√© modifi√©es et que nmap n'affiche plus les ports ouverts de l'ext√©rieur.  Ce n'est que lors d'un vidage du trafic qu'il a √©t√© possible de d√©tecter des demandes sur ces ports.  C'est-√†-dire  un attaquant apr√®s piratage a bloqu√© l'acc√®s aux autres.  Pas une approche hi-tech, mais bravo quand m√™me. <br><br>  <b>16:30</b> Une conf√©rence se r√©unit avec les questions "qui est √† bl√¢mer et quoi faire."  Les ports 1900 et 52869 ont √©t√© interdits. Des tentatives sont en cours pour r√©parer quelque chose sur des appareils pirat√©s.  Red√©marrer - n'a pas aid√©, l'id√©e de reflasher a √©t√© imm√©diatement rejet√©e.  Oui, il existe une telle fonctionnalit√©, il √©tait possible de r√©organiser √† distance le logiciel via TR069 avec un bouton sur tous les appareils.  Mais depuis  l'appareil n'√©tait pas la premi√®re fra√Æcheur, mais le nombre de clients √©tait important - un certain pourcentage d'appareils briqu√©s cr√©erait des probl√®mes. <br><br>  <b>16:40 Pour</b> r√©sumer: les appareils sont pirat√©s, participent au minimum aux ddos ‚Äã‚Äãet transmettent quelque chose quelque part sur le canal crypt√©.  (Tous sur <b>diff√©rents</b> ports).  Il n'est pas possible d'entrer √† l'int√©rieur, le vendeur a refus√© l'acc√®s complet via ssh √† l'appareil et voir ce qu'il √©tait impossible d'y arriver.  La console est prot√©g√©e par mot de passe. <br><br>  <b>Quelque part vers 17h00, il a</b> √©t√© d√©cid√© de coudre l'appareil comme le moyen le plus rapide.  Apr√®s avoir clignot√© et red√©marr√©, tout est revenu √† la normale. <br><br><h3>  Au lieu de totaux </h3><br>  Malheureusement, nous n'avons pas pu r√©soudre compl√®tement ce probl√®me. <br><br>  Par ¬´d√©cider¬ª, j'entends obtenir des informations de piratage compl√®tes et mettre √† jour nos politiques pour contrer cela √† l'avenir.  Oui, toutes les t√¢ches ne sont pas r√©solues avec succ√®s et comme nous le souhaiterions.  C'est normal.  Bien qu'insultant. <br><br>  <i>S'il est bon de chercher sur le shodan,</i> <i><br></i>  <i>vous pouvez trouver quelque chose</i> <i><br></i>  <i>pour les exp√©riences:</i> <i><br></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">d'une mani√®re</a> ou d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">une autre</a></i> <i><br></i>  <i>mais je ne vous l'ai pas dit.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr425203/">https://habr.com/ru/post/fr425203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr425191/index.html">Fastware</a></li>
<li><a href="../fr425195/index.html">Les listes noire, blanche et grise prot√®gent la s√©curit√© de l'entreprise</a></li>
<li><a href="../fr425197/index.html">Estimation des co√ªts d'un projet de mise en ≈ìuvre IdM - Comment anticiper les surprises</a></li>
<li><a href="../fr425199/index.html">Ce qui prot√®ge les acheteurs contre la fraude au paiement sans contact</a></li>
<li><a href="../fr425201/index.html">¬´Je lutte contre le syndrome des imposteurs depuis trois ans¬ª - 10 questions pour un programmeur, num√©ro 7</a></li>
<li><a href="../fr425205/index.html">Comp√©tences g√©n√©rales en gestion de projet: concept, objectifs et conseils pour une utilisation commerciale r√©ussie</a></li>
<li><a href="../fr425207/index.html">Test de conception: Top 10 Heisenbug 2018 Piter Talks</a></li>
<li><a href="../fr425209/index.html">Sunrise Manually # 2: Hardcore pour IDE, Cmake et ma d√©ception chez les animaux</a></li>
<li><a href="../fr425211/index.html">286 et r√©seau</a></li>
<li><a href="../fr425213/index.html">Plans pour la prochaine version de Vue.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>