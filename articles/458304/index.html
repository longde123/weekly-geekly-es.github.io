<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôæ ‚ô¶Ô∏è üôèüèΩ Pesadilla del "Caballero": una historia instructiva sobre DevOps üõãÔ∏è üö¥ ‚òùüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1066, han pasado m√°s de 200 a√±os desde el comienzo de la invasi√≥n vikinga de Inglaterra. El rey Harold, reuniendo un destacamento de caballeros, march...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pesadilla del "Caballero": una historia instructiva sobre DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/moex/blog/458304/"><img src="https://habrastorage.org/webt/im/2a/ct/im2actpwxzvrz1_j4k-2easujdy.jpeg"><br><br>  1066, han pasado m√°s de 200 a√±os desde el comienzo de la invasi√≥n vikinga de Inglaterra.  El rey Harold, reuniendo un destacamento de caballeros, march√≥ hacia el r√≠o Derwent para una batalla decisiva con las tropas de su hom√≥nimo: el rey noruego Harald.  Los armeros trabajaron durante un mes para forjar suficiente armadura de nueva generaci√≥n que pudiera proteger al caballero de ser golpeado por un hacha escandinava.  ¬°Y cu√°ntos experimentos y pruebas en torneos hab√≠an tenido antes!  Pero se supon√≠a que la expectativa se justificaba a s√≠ misma: un equipo liviano pero confiable permit√≠a incluso a pie, sin grandes p√©rdidas, barrer el vikingo.  Y finalmente, se encontraron en Stamford Bridge.  El destacamento principal de caballeros, dirigido por un comandante con una armadura brillante, choc√≥ en medio de un puente con enemigos.  S√≠, el acero de los maestros podgorny tiene el golpe! <br><br>  Lento pero seguro, los vikingos se est√°n moviendo a una defensa de todos contra todos.  La victoria parece estar cerca.  Y finalmente, en el campo de batalla, el comandante caballero y el jarl noruego se encuentran. <br><a name="habracut"></a><br>  El hacha de dos manos de Jarl ya est√° rota y se ve obligado a defenderse con un saj√≥n com√∫n, que no se puede comparar con un caballero y media espada.  Una ola con una daga: para la armadura del comandante es como una navaja, pero atraviesa la armadura y ... parece que la magia ha entrado en juego: ¬°la armadura de los caballeros vecinos est√° dispersa!  Otra ola, otra vez en el blanco, y ahora en los caballeros del flanco izquierdo, la armadura de repente brilla al rojo vivo.  El tercer golpe: los caballeros nadan ante sus ojos, tropiezan, caen y nunca m√°s se levantan. <br><br>  "*** ** **** ****!"  Grit√≥ Petrovich, despertando a las 5 de la ma√±ana del lunes sudando fr√≠o.  Todo sali√≥ completamente mal: a las 11 de la noche se subi√≥ a Wikipedia en busca de materiales para el informe del ni√±o sobre la naturaleza de la tundra, pero a la hora de la noche de alguna manera se encontr√≥ con la descripci√≥n de la invasi√≥n vikinga de Inglaterra.  Y tambi√©n, el fin de semana pusieron en la batalla el pr√≥ximo lanzamiento, que deber√≠a comenzar hoy.  Como siempre, lo probamos durante mucho tiempo y a fondo, lo manejamos a trav√©s de sistemas de integraci√≥n continua un mill√≥n de veces, ya sea que todo salga bien ... <br><br>  Afortunadamente para algunos, pero desafortunadamente para las v√≠ctimas, siempre existe la oportunidad de aprender de los errores de los dem√°s, mejorar algo en casa y obtener una porci√≥n extra de confianza.  Con este art√≠culo traducido, queremos recordar una vez m√°s, con m√°s detalle, uno de los casos en "nuestra" industria. <br><br><hr><br>  El a√±o pasado en la conferencia habl√© sobre DevOps, la configuraci√≥n como c√≥digo y la entrega continua.  Usando la siguiente historia, expliqu√© la importancia de crear implementaciones totalmente automatizadas y reproducibles como parte de la iniciativa DevOps / Continuous Delivery.  Despu√©s de la conferencia, varias personas me pidieron que compartiera una historia en un blog.  Esta es una historia absolutamente verdadera.  Esto es un recuento de lo que le√≠, yo mismo no particip√© en esto. <br><br>  Entonces, la historia de c√≥mo una empresa con activos de casi $ 400 millones quebr√≥ en 45 minutos debido a un despliegue fallido. <br><br><h1>  Un poco de historia </h1><br>  Knight Capital Group ("Knight" en ingl√©s significa "caballero") es una compa√±√≠a financiera global estadounidense dedicada a la creaci√≥n de mercado, la ejecuci√≥n electr√≥nica, las ventas institucionales y el comercio.  En 2012, Knight fue el mayor operador burs√°til de EE. UU. Con una participaci√≥n de mercado de aproximadamente el 17% en NYSE y NASDAQ.  Knight's Electronic Trading Group (ETG) gestion√≥ un volumen de negociaci√≥n diario promedio de m√°s de 3,3 mil millones de transacciones por d√≠a, negociando m√°s de $ 21 mil millones ... por d√≠a.  ¬°Esto no es una broma! <br><br>  Al 31 de julio de 2012, Knight ten√≠a aproximadamente $ 365 millones en efectivo y equivalentes de efectivo. <br><br>  El 1 de agosto de 2012, la NYSE plane√≥ lanzar un nuevo programa de liquidez minorista, el Programa de liquidez minorista (un programa dise√±ado para mejorar los precios para los inversores minoristas a trav√©s de corredores minoristas como Knight).  En preparaci√≥n para este evento, Knight actualiz√≥ su enrutador algor√≠tmico automatizado de alta velocidad SMARS, que env√≠a las aplicaciones al mercado para su ejecuci√≥n.  Una de las funciones principales de SMARS es recibir aplicaciones de otros componentes de la plataforma de negociaci√≥n de Knights (aplicaciones "principales"), seguidas de enviar una o m√°s aplicaciones "secundarias" para su ejecuci√≥n.  En otras palabras, SMARS recibir√° grandes pedidos de la plataforma de negociaci√≥n y los dividir√° en varios peque√±os para encontrar un comprador / vendedor de acciones.  Cuanto m√°s grande sea la aplicaci√≥n principal, se crear√°n m√°s aplicaciones secundarias. <br><br>  Se supon√≠a que la actualizaci√≥n SMARS reemplazar√≠a el antiguo c√≥digo no utilizado llamado "Power Peg", esta funcionalidad que Knight no hab√≠a utilizado durante 8 a√±os (por qu√© el c√≥digo que estuvo muerto durante tanto tiempo todav√≠a estaba en la base del c√≥digo es un misterio, pero esto no es lo principal).  El c√≥digo actualizado reasign√≥ la antigua bandera que se utiliz√≥ para activar la funcionalidad de Power Peg.  El c√≥digo fue probado exhaustivamente, funcion√≥ correctamente y fue confiable.  ¬øQu√© pudo haber salido mal? <br><br><h1>  ¬øQu√© pudo haber salido mal?  Y de verdad! </h1><br>  Entre el 27 de julio de 2012 y el 31 de julio de 2012, Knight implement√≥ manualmente un nuevo software en un n√∫mero limitado de servidores por d√≠a, un total de ocho (8) servidores.  Esto es lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">que</a> dice el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documento de</a> la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SEC</a> sobre el despliegue manual (SEC es la Comisi√≥n de Valores e Intercambios, el regulador del mercado de valores estadounidense). <br><br><blockquote>  ‚ÄúDurante el despliegue del nuevo c√≥digo, uno de los empleados de Knight no copi√≥ el nuevo c√≥digo en uno de los ocho servidores SMARS.  Knight no realiz√≥ una segunda revisi√≥n t√©cnica de esta implementaci√≥n, por lo que el c√≥digo Power Peg no se elimin√≥ del octavo servidor y no se agreg√≥ el nuevo c√≥digo RLP.  La compa√±√≠a no ten√≠a procedimientos establecidos que requer√≠an un nuevo examen ".  Release No. 70694, 16 de octubre de 2013 </blockquote><br>  El 1 de agosto de 2012 a las 9:30 a.m. EST, se abrieron los mercados y Knight comenz√≥ a procesar las solicitudes de los corredores de bolsa en nombre de sus clientes en el nuevo Programa de Liquidez Minorista.  Siete (7) servidores que se implementaron correctamente comenzaron a procesar las aplicaciones correctamente.  Y esas aplicaciones que fueron al octavo servidor probablemente activaron la bandera cambiada y resucitaron Power Peg. <br><br><h1>  Ataque zombi: c√≥digo asesino </h1><br>  Aqu√≠ debe explicar por qu√© se necesitaba el c√≥digo Power Peg "muerto".  Esta funcionalidad estaba destinada a contar acciones compradas / vendidas a pedido de un padre a medida que se completan los pedidos del ni√±o.  Despu√©s de ejecutar la aplicaci√≥n principal, Power Peg proh√≠be el env√≠o de aplicaciones secundarias.  En principio, Power Peg rastrear√° las √≥rdenes secundarias y detendr√° su ejecuci√≥n despu√©s del procesamiento de la solicitud principal.  En 2005, Knight retir√≥ esta funcionalidad de seguimiento acumulativo a una etapa anterior de ejecuci√≥n del c√≥digo (eliminando as√≠ el seguimiento de cantidad de Power Peg). <br><br>  Cuando se activ√≥ el indicador de Power Peg en el octavo servidor, Power Peg comenz√≥ a enrutar las √≥rdenes secundarias para su ejecuci√≥n, pero no las correlacion√≥ con el n√∫mero de acciones en la orden principal; surgi√≥ una especie de circuito cerrado <br><br><h1>  Infernal 45 minutos </h1><br>  Imag√≠nese: tiene un sistema que puede enviar aplicaciones autom√°ticas de alta velocidad al mercado sin ning√∫n seguimiento y la capacidad de ver si se han completado suficientes aplicaciones.  S√≠, todo sali√≥ tan mal. <br><br>  Cuando el mercado abri√≥ a las 9:30 a.m., la gente r√°pidamente se dio cuenta de que algo andaba mal.  A las 9:31 a.m., muchos en Wall Street se hab√≠an dado cuenta de que algo grave estaba sucediendo.  El mercado se inund√≥ de ofertas con un volumen de negociaci√≥n inusual, en comparaci√≥n con la situaci√≥n normal, para ciertas acciones.  A las 9:32 en Wall Street, se preguntaban por qu√© esta desgracia no se detiene.  Casi para siempre en el comercio de alta velocidad.  ¬øPor qu√© alguien no hizo clic en el bot√≥n de matar en el sistema que lo hizo?  Al final result√≥ que, no hab√≠a interruptor.  Durante los primeros 45 minutos de negociaci√≥n, la ejecuci√≥n de transacciones de Knight ascendi√≥ a m√°s del 50% del volumen de negociaci√≥n, elevando ciertas acciones en m√°s del 10% de su valor.  Como resultado, otras acciones cayeron en valor debido a transacciones err√≥neas. <br><br>  Y para empeorar las cosas, el sistema Knight comenz√≥ a enviar correos electr√≥nicos autom√°ticos incluso antes de estos eventos, ya a las 8:01 a.m. (cuando SMARS proces√≥ los pedidos adecuados para el comercio previo a la comercializaci√≥n).  En los mensajes, el sistema hizo referencia a SMARS y mostr√≥ el error "Power Peg no est√° disponible".  Entre las 8:01 a.m. y las 9:30 a.m., se enviaron 97 cartas a los empleados de Knight.  Por supuesto, estas cartas no parec√≠an advertencias del sistema, por lo que nadie las mir√≥ de inmediato.  Ouch <br><br>  Durante 45 minutos infernales, Knight intent√≥ detener la transacci√≥n err√≥nea.  No fue posible apagar el sistema (ya que no hab√≠a procedimientos documentados para responder a tal situaci√≥n), por lo tanto, tratando de lidiar con el problema en condiciones comerciales en vivo, permanecieron en el mercado, donde se vendieron 8 millones de acciones por minuto.  Como los empleados de la compa√±√≠a no pod√≠an determinar de d√≥nde proven√≠an las aplicaciones err√≥neas, eliminaron el nuevo c√≥digo de los servidores donde se implement√≥ correctamente.  En otras palabras, eliminaron el c√≥digo de trabajo y lo dejaron roto.  Esto solo exacerb√≥ los problemas que causaron solicitudes parentales adicionales para activar el c√≥digo Power Peg en todos los servidores, y no solo donde el c√≥digo se implement√≥ originalmente de forma incorrecta.  Al final, logr√© detener el sistema, despu√©s de 45 minutos de negociaci√≥n. <br><br>  Mientras se negociaba, el c√≥digo Power Peg recibi√≥ y proces√≥ 212 solicitudes de los padres.  Como resultado, SMARS envi√≥ millones de subsidiarias al mercado, complet√≥ 4 millones de transacciones en 154 transacciones con m√°s de 397 millones de acciones.  Para los entendidos del mercado de valores, esto signific√≥ que Knight compr√≥ acciones de 80 compa√±√≠as diferentes por $ 3.5 mil millones y vendi√≥ acciones de 74 compa√±√≠as por $ 3.15 mil millones. Desde el punto de vista de los no profesionales, Knight Capital Group perdi√≥ $ 460 millones en 45 minutos.  Pero Knight solo tiene $ 365 millones en efectivo y equivalentes de efectivo.  En 45 minutos, Knight se ha transformado del mayor comerciante de acciones estadounidenses y un importante creador de mercado en NYSE y NASDAQ en bancarrota.  Ten√≠an 48 horas para recaudar la cantidad necesaria para cubrir las p√©rdidas (lo que pudieron hacer gracias a una inversi√≥n de $ 400 millones de aproximadamente media docena de inversores).  Finalmente, el Grupo Knight Capital fue adquirido por Getco LLC (en diciembre de 2012), y ahora la compa√±√≠a combinada se llama KCG Holdings. <br><br><h1>  ¬øQu√© conclusiones necesitas sacar? </h1><br>  Los eventos del 1 de agosto de 2012 deber√≠an ser una lecci√≥n para todos los equipos de desarrollo y equipos de proyecto.  No es suficiente crear un excelente software y probarlo;  Tambi√©n debe asegurarse de que se entregue correctamente al mercado para que sus clientes reciban exactamente el valor que usted proporciona (y que no quiebre a su empresa).  Los ingenieros que implementaron SMARS no solo tienen la culpa del hecho de que el procedimiento seguido en Knight no tuvo en cuenta los riesgos.  El procedimiento (o su ausencia) fue obviamente err√≥neo.  Cada vez que el proceso de implementaci√≥n depende de c√≥mo las personas leen y siguen las instrucciones, usted se pone en riesgo.  La gente comete errores.  Los errores pueden estar en las instrucciones, en la interpretaci√≥n de las instrucciones o en su implementaci√≥n. <br><br>  El dise√±o debe ser automatizado, reproducible y lo m√°s libre posible de posibles errores humanos.  Si Knight hubiera implementado un sistema de implementaci√≥n automatizado, un conjunto de configuraci√≥n, implementaci√≥n autom√°tica y pruebas, entonces el error que se convirti√≥ en la pesadilla de Knight podr√≠a haberse evitado. <br><br>  Aqu√≠ hay un par de principios de entrega continua (incluso si no implementa el proceso completo de entrega continua): <br><br><ul><li>  El lanzamiento del software debe ser un proceso repetible y confiable. <br></li><li>  Automatiza todo lo que puedas. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/458304/">https://habr.com/ru/post/458304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458290/index.html">Computadora biosint√©tica de doble n√∫cleo en una c√©lula viva</a></li>
<li><a href="../458292/index.html">PHP Digest No. 159 (17 de junio - 1 de julio de 2019)</a></li>
<li><a href="../458298/index.html">Hice un medio engranaje grande en paneles solares por 250,000 rublos (2 partes)</a></li>
<li><a href="../458300/index.html">Evoluci√≥n de la herramienta m√°s popular de cada desarrollador (en Visual Studio)</a></li>
<li><a href="../458302/index.html">Frontend Weekly Digest (24-30 de junio de 2019)</a></li>
<li><a href="../458306/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 371 (24 y 30 de junio de 2019)</a></li>
<li><a href="../458308/index.html">Resumen: ¬øCu√°l ser√° el futuro de Tesla y qu√© factores lo afectar√°n?</a></li>
<li><a href="../458310/index.html">Recopile m√©tricas de aplicaciones .NET usando Telegraf</a></li>
<li><a href="../458312/index.html">Academia de Android en Mosc√∫: curso avanzado</a></li>
<li><a href="../458316/index.html">Yandex Retro Games Battle 2019 - desarrollo de juegos para ZX Spectrum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>