<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐คผ โ๏ธ ๐ ุฃุตูุงู ูู SIMD ๐ด๐พ ๐ ๐ฉ๐ผ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฃุซูุงุก ุชุทููุฑ meshoptimizer ุ ูุทุฑุญ ุงูุณุคุงู ุบุงูุจูุง: "ูู ูููู ููุฐู ุงูุฎูุงุฑุฒููุฉ ุงุณุชุฎุฏุงู SIMDุ" 

 ุงูููุชุจุฉ ููุฌูุฉ ูุญู ุงูุฃุฏุงุก ุ ููู SIMD ูุง ุชููุฑ ุฏุงุฆููุง ูุฒุงูุง ูุจ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฃุตูุงู ูู SIMD</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441536/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a9d/05e/c84/a9d05ec8466285f12b0a33e5978a0c00.png" align="left" width="270">  ุฃุซูุงุก ุชุทููุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">meshoptimizer</a> ุ ูุทุฑุญ ุงูุณุคุงู ุบุงูุจูุง: "ูู ูููู ููุฐู ุงูุฎูุงุฑุฒููุฉ ุงุณุชุฎุฏุงู SIMDุ" <br><br>  ุงูููุชุจุฉ ููุฌูุฉ ูุญู ุงูุฃุฏุงุก ุ ููู SIMD ูุง ุชููุฑ ุฏุงุฆููุง ูุฒุงูุง ูุจูุฑุฉ ููุณุฑุนุฉ.  ูุณูุก ุงูุญุธ ุ ูููู ุฃู ุชุฌุนู SIMD ุงูุดูุฑุฉ ุฃูู ูุฏุฑุฉ ุนูู ุงูุญุฑูุฉ ูุฃูู ูุงุจููุฉ ููุตูุงูุฉ.  ูุฐูู ุ ูู ูู ุญุงูุฉ ุ ูู ุงูุถุฑูุฑู ุงูุจุญุซ ุนู ุญู ูุณุท.  ุนูุฏูุง ูููู ุงูุฃุฏุงุก ูุตูู ุ ูุฌุจ ุนููู ุชุทููุฑ ูุตูุงูุฉ ุชุทุจููุงุช SIMD ูููุตูุฉ ููุฌููุนุงุช ุชุนูููุงุช SSE ู NEON.  ูู ุญุงูุงุช ุฃุฎุฑู ุ ุชุญุชุงุฌ ุฅูู ููู ุชุฃุซูุฑ ุงุณุชุฎุฏุงู SIMD.  ุณูุญุงูู ุงูููู ุชุณุฑูุน ุดุจูุฉ ุงููุจุณุทุฉ ุ ููู ุฎูุงุฑุฒููุฉ ุฌุฏูุฏุฉ ุชูุช ุฅุถุงูุชูุง ูุคุฎุฑูุง ุฅูู ุงูููุชุจุฉ ุ ุจุงุณุชุฎุฏุงู ูุฌููุนุงุช ุงูุชุนูููุงุช SSEn / AVXn. <br><a name="habracut"></a><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/068/8c9/887/0688c9887f9cb61c268383cb4b6621b7.jpg"></div><br><br>  ุจุงููุณุจุฉ ููุนูุงุฑูุง ุ ูููู ุจุชุจุณูุท ูููุฐุฌ ุจูุฐุง ุงูุชุงููุงูุฏู ูู 6 ููุงููู ูุซูุซ ุฅูู 0.1ูช ูู ูุฐุง ุงูุฑูู.  ูุณุชุฎุฏู ุจุฑูุงูุฌ ุงูุชุญููู ุงูุจุฑูุฌู Microsoft Visual Studio 2019 ูุจููุฉ x64 ุงููุฏู.  ูููู ููุฎูุงุฑุฒููุฉ ุงูุนุฏุฏูุฉ ุฅุฌุฑุงุก ูุซู ูุฐุง ุงูุชุฑุดูุฏ ูู ุญูุงูู 210 ูููู ุซุงููุฉ ูู ูุคุดุฑ ุชุฑุงุจุท Intel Core i7-8700K ูุงุญุฏ (ุนูุฏ ุญูุงูู 4.4 ุฌูุฌุงูุฑุชุฒ).  ูุฐุง ูุชูุงูู ูุน ุญูุงูู 28.5 ููููู ูุซูุซ ูู ุงูุซุงููุฉ.  ุฑุจูุง ูุฐุง ูููู ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ููููู ููุช ูุถููู ูุงุณุชูุดุงู ุฃูุตู ูุฏุฑุงุช ุงูุฌูุงุฒ. <br><br>  ูู ุจุนุถ ุงูุญุงูุงุช ุ ูููู ูุฒุงููุฉ ุงูุฅุฌุฑุงุก ุจุชูุณูู ุงูุดุจูุฉ ุฅูู ุฃุฌุฒุงุก ุ ูููู ูู ุงูุถุฑูุฑู ุฅุฌุฑุงุก ุชุญููู ุฅุถุงูู ููุชูุตูู ูู ุฃุฌู ุงูุญูุงุธ ุนูู ุงูุญุฏูุฏ ุ ูุฐูู ุณูููู ูู ุงูููุช ุงูุญุงูู ุจุชูููุฏ ุฃููุณูุง ุจุชุญุณููุงุช SIMD ุงูุจุญุชุฉ. <br><br><h1 style=";text-align:right;direction:rtl">  ุณุจุนุฉ ููุงุณุงุช </h1><br>  ูููู ุฅููุงูุงุช ุงูุชุญุณูู ุ ุณูููู ุจุฅุฌุฑุงุก ุงูุชูุตูู ุจุงุณุชุฎุฏุงู Intel VTune.  ูู ุจุชุดุบูู ุงูุฅุฌุฑุงุก 100 ูุฑุฉ ููุชุฃูุฏ ูู ูุฌูุฏ ุจูุงูุงุช ูุงููุฉ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a7/6f0/cea/1a76f0ceaf9dc88617c5296d6ee73467.png"><br><br>  ููุช ููุง ุจุชุดุบูู ูุถุน microarchitecture ูุฅุตูุงุญ ููุช ุชูููุฐ ูู ูุธููุฉ ุ ููุฐูู ุงูุนุซูุฑ ุนูู ุงูุงุฎุชูุงูุงุช.  ูุฑู ุฃู ุงูุชุฑุดูุฏ ูุชู ุชูููุฐู ุจุงุณุชุฎุฏุงู ูุฌููุนุฉ ูู ุงููุธุงุฆู ุ ูู ูููุง ูุชุทูุจ ุนุฏุฏูุง ูุนูููุง ูู ุงูุฏูุฑุงุช.  ูุชู ูุฑุฒ ูุงุฆูุฉ ุงููุธุงุฆู ุญุณุจ ุงูููุช.  ูุง ูู ูู ุฃุฌู ุงูุชูููุฐ ูุฌุนู ุงูุฎูุงุฑุฒููุฉ ุฃุณูู ููููู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <code>rescalePositions</code> ููุงุถุน ูู ุงูููู ูู ููุนุจ ูุงุญุฏ ููุชุญุถูุฑ <code>computeVertexIds</code> ุจุงุณุชุฎุฏุงู <code>computeVertexIds</code> </li><li style=";text-align:right;direction:rtl">  <code>computeVertexIds</code> ูุญุณุจ ูุนุฑูู ููู 30 ุจุช ููู ุฑุฃุณ ุนูู ุดุจูุฉ ููุญุฏุฉ ุจุญุฌู ูุนูู ุ ุญูุซ ูุชู ููุงุณ ูู ูุญูุฑ ุนูู ุดุจูุฉ (ุญุฌู ุงูุดุจูุฉ 10 ุจุช ุ ูุจุงูุชุงูู ูุฅู ุงููุนุฑู ูู 30) </li><li style=";text-align:right;direction:rtl">  <code>countTriangles</code> ุจุญุณุงุจ ุงูุนุฏุฏ ุงูุชูุฑูุจู ูููุซูุซุงุช ุงูุชู ุณูููู ุงููุจุชูุฑ ุจุฅูุดุงุฆูุง ุจุญุฌู ุดุจูุฉ ูุนูู ุ ูุน ุงูุชุฑุงุถ ุงุชุญุงุฏ ูู ุงูููู ูู ุฎููุฉ ุดุจูุฉ ูุงุญุฏุฉ </li><li style=";text-align:right;direction:rtl">  <code>fillVertexCells</code> ุชููุฃ ุฌุฏูููุง <code>fillVertexCells</code> ูู ุงูุฑุคูุณ ููุฎูุงูุง ุงูููุงุจูุฉ ุ  ุฌููุน ุงูููู ุฐุงุช ุงููุนุฑู ููุณู ุชุชูุงูู ูุน ุฎููุฉ ูุงุญุฏุฉ </li><li style=";text-align:right;direction:rtl">  <code>fillCellQuadrics</code> ุชููุฃ ูููู <code>Quadric</code> (ูุตูููุฉ ูุชูุงุซูุฉ <code>Quadric</code> ) ููู ุฎููุฉ ูุชุนูุณ ุงููุนูููุงุช ุงูุฅุฌูุงููุฉ ุนู ุงูููุฏุณุฉ ุงูููุงุจูุฉ </li><li style=";text-align:right;direction:rtl">  <code>fillCellRemap</code> ุจุญุณุงุจ ูุคุดุฑ ููุฉ ุงูุฑุฃุณ ููู ุฎููุฉ ุ ูุงุฎุชูุงุฑ ูุงุญุฏ ูู ุงูููู ูู ูุฐู ุงูุฎููุฉ ุ ููููู ูู ุงูุชุดูู ุงูููุฏุณู </li><li style=";text-align:right;direction:rtl">  ูุนุฑุถ <code>filterTriangles</code> ุงููุฌููุนุฉ ุงูููุงุฆูุฉ ูู ุงููุซูุซุงุช ููููุง ูุฌุฏุงูู vertex-cell-vertex ุงูุชู ุชู ุฅูุดุงุคูุง ูุณุจููุง ุ  ูููู ุฃู ููุชุฌ ุนู ุงูุชุฑุฌูุฉ ุงูุณุงุฐุฌุฉ ูุนุฏู ูุซูุซุงุช ููุฑุฑุฉ ุจูุณุจุฉ 5ูช ุชูุฑูุจูุง ุ ูุจุงูุชุงูู ุชููู ุงูุฏุงูุฉ ุจุชุตููุฉ ุงูุชูุฑุงุฑุงุช. </li></ul><br>  ูุชู ุชูููุฐ <code>computeVertexIds</code> ู <code>countTriangles</code> ุนุฏุฉ ูุฑุงุช: ุชุญุฏุฏ ุงูุฎูุงุฑุฒููุฉ ุญุฌู ุงูุดุจูุฉ ูุฏูุฌ ุงูููู ุ ูุฅุฌุฑุงุก ุจุญุซ ุซูุงุฆู ูุนุฌู ูุชุญููู ุงูุนุฏุฏ ุงููุณุชูุฏู ูู ุงููุซูุซุงุช (ูู ุงูุญุงูุฉ 6000 ูุฏููุง) ูุญุณุงุจ ุนุฏุฏ ุงููุซูุซุงุช ุงูุชู ุณุชูุดุฆูุง ูู ุญุฌู ุดุจูุฉ ูู ูู ุชูุฑุงุฑ.  ูุชู ุฅุทูุงู ูุธุงุฆู ุฃุฎุฑู ูุฑุฉ ูุงุญุฏุฉ.  ูู ููููุง ุ ุชุนุทู ุฎูุณ ููุฑุงุช ุจุญุซ ุญุฌู ุดุจูุฉ ูุณุชูุฏู ูุฏุฑู 40 <sup>3</sup> . <br><br>  ุชููุฏ VTune ุจุดูู ูููุฏ ุฃู ุงููุธููุฉ ุงูุฃูุซุฑ ูุซุงูุฉ ููููุงุฑุฏ ูู ุชูู ุงูุชู ุชููู ุจุญุณุงุจ ุงูุชุฑููุฒุงุช: ููู ุชุณุชุบุฑู ูุง ููุฑุจ ูู ูุตู ุฅุฌูุงูู ููุช ุงูุชูููุฐ ุงูุจุงูุบ 21 ุซุงููุฉ.  ูุฐุง ูู ุงููุฏู ุงูุฃูู ูุชุญุณูู SIMD. <br><br><h1 style=";text-align:right;direction:rtl">  SIMD ูุทุนุฉ ูุทุนุฉ </h1><br>  ุฏุนูุง ูููู ูุธุฑุฉ ุนูู ุงูููุฏ ุงููุตุฏุฑู ูู <code>fillCellQuadrics</code> ูููู ูุง ูุญุณุจู ุจุงูุถุจุท: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fillCellQuadrics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Quadric* cell_quadrics, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* indices, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vector3* vertex_positions, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* vertex_cells)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; index_count; i += <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i0 = indices[i + <span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i1 = indices[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i2 = indices[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c0 = vertex_cells[i0]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c1 = vertex_cells[i1]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c2 = vertex_cells[i2]; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> single_cell = (c0 == c1) &amp; (c0 == c2); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> weight = single_cell ? <span class="hljs-number"><span class="hljs-number">3.f</span></span> : <span class="hljs-number"><span class="hljs-number">1.f</span></span>; Quadric Q; quadricFromTriangle(Q, vertex_positions[i0], vertex_positions[i1], vertex_positions[i2], weight); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (single_cell) { quadricAdd(cell_quadrics[c0], Q); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { quadricAdd(cell_quadrics[c0], Q); quadricAdd(cell_quadrics[c1], Q); quadricAdd(cell_quadrics[c2], Q); } } }</code> </pre> <br>  ุชุชูุฑุฑ ุงููุธููุฉ ุนูู ูู ุงููุซูุซุงุช ุ ูุชุญุณุจ ุงููุฑุจุนู ููู ูููุง ุ ูุชุถูููุง ุฅูู ูุฑุจุนุงุช ูู ุฎููุฉ.  ุงููุฑุจุนู - ูุตูููุฉ ูุชูุงุซูุฉ 4 ร 4 ุ ูุนุฑูุถุฉ ูู 10 ุฃุฑูุงู ูุงุตูุฉ ุนุงุฆูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quadric</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a00; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a10, a11; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a20, a21, a22; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b0, b1, b2, c; };</code> </pre> <br>  ูุชุทูุจ ุญุณุงุจ ุงููุฑุจุนู ุญู ูุนุงุฏูุฉ ุงููุณุชูู ูููุซูุซ ุ ูุฅูุดุงุก ูุตูููุฉ ูู ุงูุฏุฑุฌุฉ ุงูุซุงููุฉ ููุฒููุง ุจุงุณุชุฎุฏุงู ููุทูุฉ ุงููุซูุซ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quadricFromPlane</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Quadric&amp; Q, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> d)</span></span></span><span class="hljs-function"> </span></span>{ Q.a00 = a * a; Q.a10 = b * a; Q.a11 = b * b; Q.a20 = c * a; Q.a21 = c * b; Q.a22 = c * c; Q.b0 = d * a; Q.b1 = d * b; Q.b2 = d * c; Qc = d * d; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quadricFromTriangle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Quadric&amp; Q, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vector3&amp; p0, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vector3&amp; p1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vector3&amp; p2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> weight)</span></span></span><span class="hljs-function"> </span></span>{ Vector3 p10 = {p1.x - p0.x, p1.y - p0.y, p1.z - p0.z}; Vector3 p20 = {p2.x - p0.x, p2.y - p0.y, p2.z - p0.z}; Vector3 normal = { p10.y * p20.z - p10.z * p20.y, p10.z * p20.x - p10.x * p20.z, p10.x * p20.y - p10.y * p20.x }; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> area = normalize(normal); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = normal.x*p0.x + normal.y*p0.y + normal.z*p0.z; quadricFromPlane(Q, normal.x, normal.y, normal.z, -distance); quadricMul(Q, area * weight); }</code> </pre> <br>  ูุจุฏู ุฃู ููุงู ุงููุซูุฑ ูู ุนูููุงุช ุงููุงุตูุฉ ุงูุนุงุฆูุฉ ุ ุจุญูุซ ูููู ููุงุฒูุชูุง ุจุงุณุชุฎุฏุงู SIMD.  ุฃููุงู ุ ูุญู ููุซู ูู ูุชุฌู ุจุงุนุชุจุงุฑู ูุชุฌู SIMD ุนุฑูุถ ุงููุทุงู ุ <code>Quadric</code> ุฃูุถูุง ูููู <code>Quadric</code> ุฅูู 12 ุฑูููุง ุนุงุฆููุง ุจุฏูุงู ูู 10 ุจุญูุซ ูุชูุงุณุจ ุชูุงููุง ูุน ุซูุงุซ ุณุฌูุงุช SIMD (ุฒูุงุฏุฉ ุงูุญุฌู ูุง ูุคุซุฑ ุนูู ุงูุฃุฏุงุก) ูุชุบููุฑ ุชุฑุชูุจ ุงูุญููู ุจุญูุซ ุงูุญุณุงุจุงุช ุฃุตุจุญ <code>quadricFromPlane</code> ุฃูุซุฑ ุงุชุณุงูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quadric</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a00, a11, a22; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pad0; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a10, a21, a20; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pad1; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b0, b1, b2, c; };</code> </pre> <br>  ููุง ุ ูุง ุชุชุณู ุจุนุถ ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ุ ููุง ุณููุง ุงูููุชุฌ ุงูููุงุณู ุ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ ูู SSE.  ูุญุณู ุงูุญุธ ุ ุธูุฑุช ุชุนูููุงุช ูููุชุฌ ุนุฏุฏู ูู SSE4.1 ุ ููู ุฃูุฑ ูููุฏ ููุบุงูุฉ ุจุงููุณุจุฉ ููุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fillCellQuadrics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Quadric* cell_quadrics, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* indices, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vector3* vertex_positions, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* vertex_cells)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> yzx = _MM_SHUFFLE(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> zxy = _MM_SHUFFLE(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> dp_xyz = <span class="hljs-number"><span class="hljs-number">0x7f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; index_count; i += <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i0 = indices[i + <span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i1 = indices[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i2 = indices[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c0 = vertex_cells[i0]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c1 = vertex_cells[i1]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c2 = vertex_cells[i2]; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> single_cell = (c0 == c1) &amp; (c0 == c2); __m128 p0 = _mm_loadu_ps(&amp;vertex_positions[i0].x); __m128 p1 = _mm_loadu_ps(&amp;vertex_positions[i1].x); __m128 p2 = _mm_loadu_ps(&amp;vertex_positions[i2].x); __m128 p10 = _mm_sub_ps(p1, p0); __m128 p20 = _mm_sub_ps(p2, p0); __m128 normal = _mm_sub_ps( _mm_mul_ps( _mm_shuffle_ps(p10, p10, yzx), _mm_shuffle_ps(p20, p20, zxy)), _mm_mul_ps( _mm_shuffle_ps(p10, p10, zxy), _mm_shuffle_ps(p20, p20, yzx))); __m128 areasq = _mm_dp_ps(normal, normal, dp_xyz); <span class="hljs-comment"><span class="hljs-comment">// SSE4.1 __m128 area = _mm_sqrt_ps(areasq); // masks the result of the division when area==0 // scalar version does this in normalize() normal = _mm_and_ps( _mm_div_ps(normal, area), _mm_cmpneq_ps(area, _mm_setzero_ps())); __m128 distance = _mm_dp_ps(normal, p0, dp_xyz); // SSE4.1 __m128 negdistance = _mm_sub_ps(_mm_setzero_ps(), distance); __m128 normalnegdist = _mm_blend_ps(normal, negdistance, 8); __m128 Qx = _mm_mul_ps(normal, normal); __m128 Qy = _mm_mul_ps( _mm_shuffle_ps(normal, normal, _MM_SHUFFLE(3, 2, 2, 1)), _mm_shuffle_ps(normal, normal, _MM_SHUFFLE(3, 0, 1, 0))); __m128 Qz = _mm_mul_ps(negdistance, normalnegdist); if (single_cell) { area = _mm_mul_ps(area, _mm_set1_ps(3.f)); Qx = _mm_mul_ps(Qx, area); Qy = _mm_mul_ps(Qy, area); Qz = _mm_mul_ps(Qz, area); Quadric&amp; q0 = cell_quadrics[c0]; __m128 q0x = _mm_loadu_ps(&amp;q0.a00); __m128 q0y = _mm_loadu_ps(&amp;q0.a10); __m128 q0z = _mm_loadu_ps(&amp;q0.b0); _mm_storeu_ps(&amp;q0.a00, _mm_add_ps(q0x, Qx)); _mm_storeu_ps(&amp;q0.a10, _mm_add_ps(q0y, Qy)); _mm_storeu_ps(&amp;q0.b0, _mm_add_ps(q0z, Qz)); } else { // omitted for brevity, repeats the if() body // three times for c0/c1/c2 } } }</span></span></code> </pre> <br>  ูุง ููุฌุฏ ุดูุก ูุซูุฑ ููุงูุชูุงู ุจุดูู ุฎุงุต ูู ูุฐุง ุงูุฑูุฒ ุ  ูุญู ูุณุชุฎุฏู ุจูุซุฑุฉ ุชุนูููุงุช ุงูุชุญููู / ุงููุชุฌุฑ ุบูุฑ ุงููุญุงุฐุงุฉ.  ุนูู ุงูุฑุบู ูู ุฃูู ูููู ูุญุงุฐุงุฉ ูุฏุฎูุงุช Vector3 ุ ูุจุฏู ุฃูู ูุง ุชูุฌุฏ ุนููุจุฉ ููุญูุธุฉ ูููุฑุงุกุงุช ุบูุฑ ุงููุญุงุฐุงุฉ.  ูุฑุฌู ููุงุญุธุฉ ุฃูู ูู ุงููุตู ุงูุฃูู ูู ูุงููุงุช ุงููุธุงุฆู ูุง ูุชู ุงุณุชุฎุฏุงููุง ุ ููู ุฃูุฑ ุฌูุฏ - ุชุญุชูู ูุงููุงุชูุง ุนูู ุซูุงุซุฉ ููููุงุช ุ ููู ุจุนุถ ุงูุญุงูุงุช ูุงุญุฏ ููุท (ุฑุงุฌุน ุญุณุงุจ ุงููุณุงุญุงุช / ุงููุณุงุญุฉ / ุงููุณุงูุฉ) ุ ุจูููุง ูููู ุงููุนุงูุฌ ุจุฅุฌุฑุงุก 4 ุนูููุงุช ุนูู ุงูุชูุงุฒู.  ูู ุฃู ุญุงู ุ ุฏุนููุง ูุฑู ููู ุณุงุนุฏ ุงูุชูุงุฒู. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/193/b7c/4a0/193b7c4a0e52429831e1d6feb7999c6f.png"><br><br>  ูุชู ุชุดุบูู ูุงุฆุฉ ุจุฏุงูุฉ ูู <code>fillCellQuadrics</code> ูู 5.3 ุซูุงูู ุจุฏูุงู ูู 9.8 ุซุงููุฉ ุ ููุง ูููุฑ ุญูุงูู 45 ูููู ุซุงููุฉ ูู ูู ุนูููุฉ - ููุณ ุณูุฆูุง ุ ูููู ููุณ ูุคุซุฑูุง ุฌุฏูุง.  ูู ุงูุนุฏูุฏ ูู ุงูุฅุฑุดุงุฏุงุช ุ ูุณุชุฎุฏู ุซูุงุซุฉ ููููุงุช ุจุฏูุงู ูู ุฃุฑุจุนุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุถุฑุจ ุงูุฏููู ุ ููุง ูุนุทู ุชุฃุฎูุฑูุง ูุจูุฑูุง ุฅูู ุญุฏ ูุง.  ุฅุฐุง ุณุจู ูู ุฃู ูุชุจุช ุชุนูููุงุช SIMD ุ ูุฃูุช ุชุนูู ููููุฉ ุงูููุงู ุจุงูููุชุฌ ุงูููุงุณู ุจุดูู ุตุญูุญ. <br><br>  ููููุงู ุจุฐูู ุ ูุฌุจ ุนููู ุงูููุงู ุจุฃุฑุจุนุฉ ูุชุฌูุงุช ูู ููุช ูุงุญุฏ.  ุจุฏูุงู ูู ุชุฎุฒูู ูุชุฌู ูุงุญุฏ ูุงูู ูู ุณุฌู SIMD ูุงุญุฏ ุ ูุณุชุฎุฏู ุซูุงุซ ุณุฌูุงุช - ูู ุฃุญุฏูุง ูุฎุฒู ุฃุฑุจุนุฉ ููููุงุช ูู <code>x</code> ุ ูุงูุขุฎุฑ ุณูุฎุฒู <code></code> ุ ููู <code>z</code> ุงูุซุงูุซ.  ููุงู ุญุงุฌุฉ ุฅูู ุฃุฑุจุนุฉ ูุชุฌูุงุช ููุนูู ูู ุขู ูุงุญุฏ: ูุฐุง ูุนูู ุฃููุง ุณูููู ุจูุนุงูุฌุฉ ุฃุฑุจุนุฉ ูุซูุซุงุช ูู ููุช ูุงุญุฏ. <br><br>  ูุฏููุง ุงูุนุฏูุฏ ูู ุงููุตูููุงุช ูุน ููุฑุณุฉ ุฏููุงููููุฉ.  ุนุงุฏุฉู ูุง ูุณุงุนุฏ ุนูู ููู ุงูุจูุงูุงุช ุฅูู ุตูุงุฆู ูุญุถุฑุฉ ูู ููููุงุช <code>x</code> / <code>y</code> / <code>z</code> (ุฃู ุจุงูุฃุญุฑู ุ ุนุงุฏุฉู ูุง ูุชู ุงุณุชุฎุฏุงู ุณุฌูุงุช SIMD ุงูุตุบูุฑุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ <code>float x[8], y[8], z[8]</code> ุ ููู ูู ุงูุฑุคูุณ ุงูุซูุงููุฉ ูู ุงูุฅุฏุฎุงู ุงูุจูุงูุงุช: ูุทูู ุนูููุง AoSoA (ุตูุงุฆู ุจููุงุช ุงูุตููู) ูุชุนุทู ุชูุงุฒููุง ุฌูุฏูุง ุจูู ููุงู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูุณูููุฉ ุงูุชุญููู ูู ุณุฌูุงุช SIMD) ุ ููู ุงูููุฑุณุฉ ุงูุฏููุงููููุฉ ููุง ูู ุชุนูู ุจุดูู ุฌูุฏ ููุบุงูุฉ ุ ูุฐุง ูู ุจุชุญููู ุงูุจูุงูุงุช ูุฃุฑุจุนุฉ ูุซูุซุงุช ูุงููุนุชุงุฏ ุ ููู ุจููู ุงููุชุฌูุงุช ุจุงุณุชุฎุฏุงู ุทุฑููุฉ ููุงุฆูุฉ ุงููุงูุฑู <code>_MM_TRANSPOSE</code> . <br><br>  ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ุชุญุชุงุฌ ุฅูู ุญุณุงุจ ูู ูููู ูู ุฃุฑุจุนุฉ ูุญุงุฑู ููุชููุฉ ูู ุณุฌู SIMD ุงูุฎุงุต ุจู (ุนูู ุณุจูู ุงููุซุงู ุ ุณูููู ูุฏููุง <code>__m128 Q_a00</code> ูุน ุฃุฑุจุนุฉ ููููุงุช ูู <code>a00</code> ุงููุญุฏุฏุฉ).  ูู ูุฐู ุงูุญุงูุฉ ุ ุชุชูุงุกู ุงูุนูููุงุช ุนูู ุงูููุงุฏุงุฑุงุช ุชูุงููุง ูุน ุชุนูููุงุช SIMD ุนุฑูุถุฉ ุงููุทุงู ุ ููุจุทุฆ ุงูุชุญููู ูุนูููุง ูู ุงูููุฏ - ูุจุงูุชุงูู ุ ูุฅููุง ูุบูุฑ ุงููุชุฌูุงุช ุงูุฃูููุฉ ููุท ุ ุซู ูุนูุฏ ูุนุงุฏูุงุช ุงููุณุชูู ุฅูู ุงููุฑุงุก ููุนูู ููุณ ุงูููุฏ ุงูุฐู ุงุณุชุฎุฏููุงู ูุญุณุงุจ ุงูููุงุฏุงุฑููุงุช ุ ููู ููุฑุฑูุง ุงุฑุจุน ูุฑุงุช  ูููุง ููู ุงูููุฏ ุงูุฐู ูุญุณุจ ุจุนุฏ ุฐูู ูุนุงุฏูุงุช ุงููุณุชูู (ูุชู ุญุฐู ุงูุฃุฌุฒุงุก ุงููุชุจููุฉ ููุฅูุฌุงุฒ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i00 = indices[(i + <span class="hljs-number"><span class="hljs-number">0</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i01 = indices[(i + <span class="hljs-number"><span class="hljs-number">0</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i02 = indices[(i + <span class="hljs-number"><span class="hljs-number">0</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i10 = indices[(i + <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i11 = indices[(i + <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i12 = indices[(i + <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i20 = indices[(i + <span class="hljs-number"><span class="hljs-number">2</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i21 = indices[(i + <span class="hljs-number"><span class="hljs-number">2</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i22 = indices[(i + <span class="hljs-number"><span class="hljs-number">2</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i30 = indices[(i + <span class="hljs-number"><span class="hljs-number">3</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i31 = indices[(i + <span class="hljs-number"><span class="hljs-number">3</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i32 = indices[(i + <span class="hljs-number"><span class="hljs-number">3</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// load first vertex of each triangle and transpose into vectors with components (pw0 isn't used later) __m128 px0 = _mm_loadu_ps(&amp;vertex_positions[i00].x); __m128 py0 = _mm_loadu_ps(&amp;vertex_positions[i10].x); __m128 pz0 = _mm_loadu_ps(&amp;vertex_positions[i20].x); __m128 pw0 = _mm_loadu_ps(&amp;vertex_positions[i30].x); _MM_TRANSPOSE4_PS(px0, py0, pz0, pw0); // load second vertex of each triangle and transpose into vectors with components __m128 px1 = _mm_loadu_ps(&amp;vertex_positions[i01].x); __m128 py1 = _mm_loadu_ps(&amp;vertex_positions[i11].x); __m128 pz1 = _mm_loadu_ps(&amp;vertex_positions[i21].x); __m128 pw1 = _mm_loadu_ps(&amp;vertex_positions[i31].x); _MM_TRANSPOSE4_PS(px1, py1, pz1, pw1); // load third vertex of each triangle and transpose into vectors with components __m128 px2 = _mm_loadu_ps(&amp;vertex_positions[i02].x); __m128 py2 = _mm_loadu_ps(&amp;vertex_positions[i12].x); __m128 pz2 = _mm_loadu_ps(&amp;vertex_positions[i22].x); __m128 pw2 = _mm_loadu_ps(&amp;vertex_positions[i32].x); _MM_TRANSPOSE4_PS(px2, py2, pz2, pw2); // p1 - p0 __m128 px10 = _mm_sub_ps(px1, px0); __m128 py10 = _mm_sub_ps(py1, py0); __m128 pz10 = _mm_sub_ps(pz1, pz0); // p2 - p0 __m128 px20 = _mm_sub_ps(px2, px0); __m128 py20 = _mm_sub_ps(py2, py0); __m128 pz20 = _mm_sub_ps(pz2, pz0); // cross(p10, p20) __m128 normalx = _mm_sub_ps( _mm_mul_ps(py10, pz20), _mm_mul_ps(pz10, py20)); __m128 normaly = _mm_sub_ps( _mm_mul_ps(pz10, px20), _mm_mul_ps(px10, pz20)); __m128 normalz = _mm_sub_ps( _mm_mul_ps(px10, py20), _mm_mul_ps(py10, px20)); // normalize; note that areasq/area now contain 4 values, not just one __m128 areasq = _mm_add_ps( _mm_mul_ps(normalx, normalx), _mm_add_ps( _mm_mul_ps(normaly, normaly), _mm_mul_ps(normalz, normalz))); __m128 area = _mm_sqrt_ps(areasq); __m128 areanz = _mm_cmpneq_ps(area, _mm_setzero_ps()); normalx = _mm_and_ps(_mm_div_ps(normalx, area), areanz); normaly = _mm_and_ps(_mm_div_ps(normaly, area), areanz); normalz = _mm_and_ps(_mm_div_ps(normalz, area), areanz); __m128 distance = _mm_add_ps( _mm_mul_ps(normalx, px0), _mm_add_ps( _mm_mul_ps(normaly, py0), _mm_mul_ps(normalz, pz0))); __m128 negdistance = _mm_sub_ps(_mm_setzero_ps(), distance); // this computes the plane equations (a, b, c, d) for each of the 4 triangles __m128 plane0 = normalx; __m128 plane1 = normaly; __m128 plane2 = normalz; __m128 plane3 = negdistance; _MM_TRANSPOSE4_PS(plane0, plane1, plane2, plane3);</span></span></code> </pre> <br>  ุฃุตุจุญ ุงูููุฏ ุฃุทูู ููููุงู: ูุญู ุงูุขู ูุนุงูุฌ ุฃุฑุจุนุฉ ูุซูุซุงุช ูู ูู ุชูุฑุงุฑ ุ ููู ูุนุฏ ุจุญุงุฌุฉ ุฅูู ุชุนูููุงุช SSE4.1 ููุฐุง ุงูุบุฑุถ.  ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ููุจุบู ุงุณุชุฎุฏุงู ูุญุฏุงุช SIMD ุจุดูู ุฃูุซุฑ ููุงุกุฉ.  ุฏุนููุง ูุฑู ููู ุณุงุนุฏ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ca/735/f51/2ca735f51bf3aa28bbf7c28f50489c15.png"><br><br>  ุญุณูุง ุ ูุฐุง ุฌูุฏ.  ุชุณุงุฑุนุช ุงูุดูุฑุฉ ุจุดูู ุทููู ููุบุงูุฉ ุ ุนูู ุงูุฑุบู ูู ุฃู ูุธููุฉ <code>fillCellQuadrics</code> ุชุนูู ุงูุขู ุจูุนุฏู ุฃุณุฑุน ูุฑุชูู ุชูุฑูุจูุง ูู ุงููุธููุฉ ุงูุฃุตููุฉ ุจุฏูู SIMD ุ ููู ูู ุบูุฑ ุงููุงุถุญ ูุง ุฅุฐุง ูุงู ูุฐุง ูุจุฑุฑ ุฒูุงุฏุฉ ูุจูุฑุฉ ูู ุงูุชุนููุฏ.  ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ููููู ุงุณุชุฎุฏุงู AVX2 ููุนุงูุฌุฉ 8 ูุซูุซุงุช ููู ุชูุฑุงุฑ ุ ูููู ููุง ุณุชุญุชุงุฌ ุฅูู ุฒูุงุฏุฉ ุฏูุฑุงู ุงูุญููุฉ ูุฏูููุง (ูู ุงููุงุญูุฉ ุงููุซุงููุฉ ุ ูุชู ุฅูุดุงุก ูู ูุฐุง ุงูุฑูุฒ ุจุงุณุชุฎุฏุงู ISPC ุ ูููู ูุญุงููุงุชู ุงูุณุงุฐุฌุฉ ููุญุตูู ุนููู ูุฅูุดุงุก ุฑูุฒ ุฌูุฏ ูู ุชูุฌุญ: ุจุฏูุงู ูู ุชุณูุณู ุงูุชุญููู / ุงูุชุฎุฒูู ุฃุตุฏุฑ ุจุฅุตุฑุงุฑ ูุฌููุนุฉ / ูุจุนุซุฑ ุ ููุง ูุคุฏู ุฅูู ุฅุจุทุงุก ุงูุชูููุฐ ุจุดูู ูุจูุฑ).  ููุฌุฑุจ ุดูุฆูุง ุขุฎุฑ. <br><br><h1 style=";text-align:right;direction:rtl">  AVX2 = SSE2 + SSE2 </h1><br>  AVX2 ุนุจุงุฑุฉ ุนู ูุฌููุนุฉ ูู ุงูุชุนูููุงุช.  ูุฏููุง ุณุฌูุงุช ุนุงุฆูุฉ ุจูุทุงู ุนุฑูุถ 8 ุ ูุชุนูููุงุช ูุงุญุฏุฉ ูููู ุฃู ุชุคุฏู 8 ุนูููุงุช ุ  ููู ูู ุฌููุฑูุง ุ ูุง ูุฎุชูู ูุซู ูุฐุง ุงูุชุนููู ุนู ุฅุฑุดุงุฏุงุช SSE2 ุงูุชู ูุชู ุชูููุฐูุง ุนูู ูุตููู ูู ุงูุณุฌู (ุนูู ุญุฏ ุนููู ุ ูู ุดูุฑุฉ ุงููุนุงูุฌุงุช ุงูุฃููู ุงูุชู ุชุฏุนู AVX2 ูู ุชุนูููุฉ ูู ุงุซููู ุฃู ุฃูุซุฑ ูู ุนูููุงุช ุงูุชุดุบูู ุงููุตุบุฑุฉ ุ ูุจุงูุชุงูู ูุฅู ุฃุฏุงุก ุงูุฃุฏุงุก ูุงู ูุญุฏูุฏูุง ุจูุฑุญูุฉ ุงุณุชุฎุฑุงุฌ ุงูุชุนูููุงุช).  ุนูู ุณุจูู ุงููุซุงู ุ ูููุฐ <code>_mm_dp_ps</code> ููุชุฌูุง ุนุฏุฏููุง ุจูู <code>_mm256_dp_ps</code> SSE2 ุ ูููุชุฌ ุนู <code>_mm256_dp_ps</code> ุจูู ูุตูู <code>_mm256_dp_ps</code> ุ ูุจุงูุชุงูู ููู ููุชุตุฑ ุนูู 4 ุนุฑุถ ููู ูุตู. <br><br>  ููุฐุง ุงูุณุจุจ ุ ุบุงูุจูุง ูุง ูุฎุชูู ุฑูุฒ AVX2 ุนู "SIMD ุนุฑูุถ ุงููุทุงู" ุงูุดุงูู ุ ูููู ููุง ูุนูู ูุตุงูุญูุง: ุจุฏูุงู ูู ูุญุงููุฉ ุชุญุณูู ุงูุชูุงุฒู ุนู ุทุฑูู ููู ุงููุชุฌูุงุช ุฐุงุช ุงูุฃุฑุจุนุฉ ุฃุญุฌุงู ุ ูุนูุฏ ุฅูู ุงูุฅุตุฏุงุฑ ุงูุฃูู ูู SIMD ููุถุงุนู ุงูุญููุฉ ุจุงุณุชุฎุฏุงู ุชุนูููุงุช AVX2 ุจุฏูุงู ูู SSE2 / SSE4.  ูุง ุฒููุง ุจุญุงุฌุฉ ุฅูู ุชุญููู ูุชุฎุฒูู ุงููุชุฌูุงุช ุฐุงุช 4 <code>__m128</code> ุ ูููู ุจุดูู ุนุงู ุ ูููู ููุท ุจุชุบููุฑ <code>__m128</code> ุฅูู <code>__m256</code> ู <code>_mm_</code> ุฅูู <code>_mm256</code> ูู <code>_mm256</code> ูุน ุงูุนุฏูุฏ ูู ุงูุฅุนุฏุงุฏุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i00 = indices[(i + <span class="hljs-number"><span class="hljs-number">0</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i01 = indices[(i + <span class="hljs-number"><span class="hljs-number">0</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i02 = indices[(i + <span class="hljs-number"><span class="hljs-number">0</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i10 = indices[(i + <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i11 = indices[(i + <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i12 = indices[(i + <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>]; __m256 p0 = _mm256_loadu2_m128( &amp;vertex_positions[i10].x, &amp;vertex_positions[i00].x); __m256 p1 = _mm256_loadu2_m128( &amp;vertex_positions[i11].x, &amp;vertex_positions[i01].x); __m256 p2 = _mm256_loadu2_m128( &amp;vertex_positions[i12].x, &amp;vertex_positions[i02].x); __m256 p10 = _mm256_sub_ps(p1, p0); __m256 p20 = _mm256_sub_ps(p2, p0); __m256 normal = _mm256_sub_ps( _mm256_mul_ps( _mm256_shuffle_ps(p10, p10, yzx), _mm256_shuffle_ps(p20, p20, zxy)), _mm256_mul_ps( _mm256_shuffle_ps(p10, p10, zxy), _mm256_shuffle_ps(p20, p20, yzx))); __m256 areasq = _mm256_dp_ps(normal, normal, dp_xyz); __m256 area = _mm256_sqrt_ps(areasq); __m256 areanz = _mm256_cmp_ps(area, _mm256_setzero_ps(), _CMP_NEQ_OQ); normal = _mm256_and_ps(_mm256_div_ps(normal, area), areanz); __m256 distance = _mm256_dp_ps(normal, p0, dp_xyz); __m256 negdistance = _mm256_sub_ps(_mm256_setzero_ps(), distance); __m256 normalnegdist = _mm256_blend_ps(normal, negdistance, <span class="hljs-number"><span class="hljs-number">0x88</span></span>); __m256 Qx = _mm256_mul_ps(normal, normal); __m256 Qy = _mm256_mul_ps( _mm256_shuffle_ps(normal, normal, _MM_SHUFFLE(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)), _mm256_shuffle_ps(normal, normal, _MM_SHUFFLE(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>))); __m256 Qz = _mm256_mul_ps(negdistance, normalnegdist);</code> </pre> <br>  ููุง ููููู ุฃู ุชุฃุฎุฐ ูู ูุตู 128-bit ูู <code>Qz</code> Qx / Qy / Qz ุงููุณุชููุฉ ูุชุดุบูู ููุณ ุงูููุฏ ุงูุฐู ุงุณุชุฎุฏููุงู ูุฅุถุงูุฉ ุงูููุงุฏุงููู.  ุจุฏูุงู ูู ุฐูู ุ ููุชุฑุถ ุฃูู ุฅุฐุง ูุงู ูููุซูุซ ุซูุงุซุฉ ุฑุคูุณ ูู ุฎููุฉ ูุงุญุฏุฉ ( <code>single_cell == true</code> ) ุ ููู ุงููุญุชูู ุฌุฏูุง ุฃู ูููู ูุฏู ูุซูุซ ุขุฎุฑ ุซูุงุซุฉ ุฑุคูุณ ูู ุฎููุฉ ุฃุฎุฑู ุ ููููู ุจุฅุฌุฑุงุก ุงูุชุฌููุน ุงูููุงุฆู ููุฑุจุงุนู ุจุงุณุชุฎุฏุงู AVX2 ุฃูุถูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c00 = vertex_cells[i00]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c01 = vertex_cells[i01]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c02 = vertex_cells[i02]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c10 = vertex_cells[i10]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c11 = vertex_cells[i11]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c12 = vertex_cells[i12]; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> single_cell = (c00 == c01) &amp; (c00 == c02) &amp; (c10 == c11) &amp; (c10 == c12); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (single_cell) { area = _mm256_mul_ps(area, _mm256_set1_ps(<span class="hljs-number"><span class="hljs-number">3.f</span></span>)); Qx = _mm256_mul_ps(Qx, area); Qy = _mm256_mul_ps(Qy, area); Qz = _mm256_mul_ps(Qz, area); Quadric&amp; q00 = cell_quadrics[c00]; Quadric&amp; q10 = cell_quadrics[c10]; __m256 q0x = _mm256_loadu2_m128(&amp;q10.a00, &amp;q00.a00); __m256 q0y = _mm256_loadu2_m128(&amp;q10.a10, &amp;q00.a10); __m256 q0z = _mm256_loadu2_m128(&amp;q10.b0, &amp;q00.b0); _mm256_storeu2_m128(&amp;q10.a00, &amp;q00.a00, _mm256_add_ps(q0x, Qx)); _mm256_storeu2_m128(&amp;q10.a10, &amp;q00.a10, _mm256_add_ps(q0y, Qy)); _mm256_storeu2_m128(&amp;q10.b0, &amp;q00.b0, _mm256_add_ps(q0z, Qz)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// omitted for brevity }</span></span></code> </pre> <br>  ุงูุดูุฑุฉ ุงููุงุชุฌุฉ ุฃุจุณุท ูููุฌุฒุฉ ูุฃุณุฑุน ูู ุทุฑููุฉ SSE2 ุบูุฑ ุงููุงุฌุญุฉ: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/124/788/954/1247889540c5aab18d1f38738fb46fea.png"><br><br>  ุจุงูุทุจุน ุ ูู ูุญูู ุชุณุงุฑุน 8 ูุฑุงุช ุ ูููู 2.45 ูุฑุฉ ููุท.  ูุง ุชุฒุงู ุนูููุงุช ุงูุชุญููู ูุงูุชุฎุฒูู ูุงุณุนุฉ ุงููุทุงู ุ ุญูุซ ุฅููุง ูุถุทุฑูู ููุนูู ูุน ุชุตููู ุฐุงูุฑุฉ ุบูุฑ ูุฑูุญ ุจุณุจุจ ุงูููุฑุณุฉ ุงูุฏููุงููููุฉ ุ ูุงูุญุณุงุจุงุช ููุณุช ูุซุงููุฉ ูู SIMD.  ูููู ุงูุขู ูู ุชุนุฏ <code>fillCellQuadrics</code> ุนูู ุงูุฒุฌุงุฌุฉ ูู ุฎุท ุฃูุงุจูุจ ุงูููู ุงูุดุฎุตู ูุฏููุง ุ ูููููู ุงูุชุฑููุฒ ุนูู ูุธุงุฆู ุฃุฎุฑู. <br><br><h1 style=";text-align:right;direction:rtl">  ุฌูุน ุญูููุง ุ ูุงูุฃุทูุงู </h1><br>  ููุฏ ุฃููุฐูุง 4.8 ุซุงููุฉ ูู ุงูุชุดุบูู ุงูุชุฌุฑูุจู (48 ูููู ุซุงููุฉ ูู ูู ุชุดุบูู) ุ ูุงูุขู ุฃุตุจุญ ุงูุฏุฎูู ุงูุฑุฆูุณู ูู <code>countTriangles</code> .  ูุจุฏู ุฃู ูุฐู ูุธููุฉ ุจุณูุทุฉ ุ ูููููุง ูุง ุชููุฐ ูุฑุฉ ูุงุญุฏุฉ ุ ุจู ุฎูุณ ูุฑุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> size_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countTriangles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* vertex_ids, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* indices, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index_count)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; index_count; i += <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id0 = vertex_ids[indices[i + <span class="hljs-number"><span class="hljs-number">0</span></span>]]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id1 = vertex_ids[indices[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id2 = vertex_ids[indices[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]]; result += (id0 != id1) &amp; (id0 != id2) &amp; (id1 != id2); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  ุชุชูุฑุฑ ุงููุธููุฉ ุนูู ูู ุงููุซูุซุงุช ุงููุตุฏุฑ ูุชุญุณุจ ุนุฏุฏ ุงููุซูุซุงุช ุบูุฑ ุงูููุญุทุฉ ูู ุฎูุงู ููุงุฑูุฉ ูุนุฑูุงุช ุงูุฑุคูุณ.  ููุณ ูู ุงููุงุถุญ ุนูู ุงูููุฑ ููููุฉ ููุงุฒุงุฉ ุฐูู ุจุงุณุชุฎุฏุงู SIMD ... ุฅูุง ุฅุฐุง ููุช ุชุณุชุฎุฏู ุฅุฑุดุงุฏุงุช ุงูุชุฌููุน. <br><br>  ุฃุถุงูุช ูุฌููุนุฉ ุชุนูููุงุช AVX2 ุนุงุฆูุฉ ุฅุฑุดุงุฏุงุช ุงูุชุฌููุน / ุงูุงูุชุซุงุฑ ุฅูู x64 SIMD ุ  ูุฃุฎุฐ ูู ูููู ุณุฌููุง ูุชุฌููุง ูุญุชูู ุนูู 4 ุฃู 8 ููู - ููู ููุณ ุงูููุช ูููุฐ ุนูููุงุช ุชุญููู ุฃู ุญูุธ 4 ุฃู 8.  ุฅุฐุง ููุช ุชุณุชุฎุฏู ุงูุชุฌููุน ููุง ุ ูููููู ุชูุฒูู ุซูุงุซุฉ ููุงุฑุณ ูุชุดุบูู ุงูุชุฌููุน ููุฌููุน ูุฑุฉ ูุงุญุฏุฉ (ุฃู ูู ูุฌููุนุงุช ูู 4 ุฃู 8) ูููุงุฑูุฉ ุงููุชุงุฆุฌ.  ููุฏ ูุงู ุชุฌููุน ูุนุงูุฌุงุช Intel ุจุทูุฆูุง ูู ุงููุงุญูุฉ ุงูุชุงุฑูุฎูุฉ ุ ูููู ุฏุนููุง ูุฌุฑุจูุง.  ููุจุณุงุทุฉ ุ ูููู ุจุชุญููู ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจู 8 ูุซูุซุงุช ุ ููุญูู ุงููุชุฌูุงุช ุจุดูู ูุดุงุจู ููุญุงููุชูุง ุงูุณุงุจูุฉ ุ ูููุงุฑู ุงูุนูุงุตุฑ ุงูููุงุจูุฉ ููู ูุชุฌู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (triangle_count &amp; ~<span class="hljs-number"><span class="hljs-number">7</span></span>); i += <span class="hljs-number"><span class="hljs-number">8</span></span>) { __m256 tri0 = _mm256_loadu2_m128( (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>*)&amp;indices[(i + <span class="hljs-number"><span class="hljs-number">4</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>], (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>*)&amp;indices[(i + <span class="hljs-number"><span class="hljs-number">0</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>]); __m256 tri1 = _mm256_loadu2_m128( (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>*)&amp;indices[(i + <span class="hljs-number"><span class="hljs-number">5</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>], (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>*)&amp;indices[(i + <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>]); __m256 tri2 = _mm256_loadu2_m128( (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>*)&amp;indices[(i + <span class="hljs-number"><span class="hljs-number">6</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>], (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>*)&amp;indices[(i + <span class="hljs-number"><span class="hljs-number">2</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>]); __m256 tri3 = _mm256_loadu2_m128( (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>*)&amp;indices[(i + <span class="hljs-number"><span class="hljs-number">7</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>], (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>*)&amp;indices[(i + <span class="hljs-number"><span class="hljs-number">3</span></span>) * <span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">0</span></span>]); _MM_TRANSPOSE8_LANE4_PS(tri0, tri1, tri2, tri3); __m256i i0 = _mm256_castps_si256(tri0); __m256i i1 = _mm256_castps_si256(tri1); __m256i i2 = _mm256_castps_si256(tri2); __m256i id0 = _mm256_i32gather_epi32((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*)vertex_ids, i0, <span class="hljs-number"><span class="hljs-number">4</span></span>); __m256i id1 = _mm256_i32gather_epi32((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*)vertex_ids, i1, <span class="hljs-number"><span class="hljs-number">4</span></span>); __m256i id2 = _mm256_i32gather_epi32((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*)vertex_ids, i2, <span class="hljs-number"><span class="hljs-number">4</span></span>); __m256i deg = _mm256_or_si256( _mm256_cmpeq_epi32(id1, id2), _mm256_or_si256( _mm256_cmpeq_epi32(id0, id1), _mm256_cmpeq_epi32(id0, id2))); result += <span class="hljs-number"><span class="hljs-number">8</span></span> - _mm_popcnt_u32(_mm256_movemask_epi8(deg)) / <span class="hljs-number"><span class="hljs-number">4</span></span>; }</code> </pre> <br>  ูุงูุฑู <code>_MM_TRANSPOSE8_LANE4_PS</code> ูู <code>_MM_TRANSPOSE8_LANE4_PS</code> ูู ูุง ูุนุงุฏู <code>_MM_TRANSPOSE4_PS</code> ุ ููู ุบูุฑ ููุฌูุฏ ูู ุงูุฑุฃุณ ุงูููุงุณู ุ ูููู ูููู ุนุฑุถู ุจุณูููุฉ.  ูุณุชุบุฑู ุฃุฑุจุนุฉ ูุงููุงุช AVX2 ููููู ุงุซููู ูู ุงููุตูููุงุช 4 ร 4 ุจุดูู ูุณุชูู ุนู ุจุนุถูุง ุงูุจุนุถ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MM_TRANSPOSE8_LANE4_PS(row0, row1, row2, row3) \ do { \ __m256 __t0, __t1, __t2, __t3; \ __t0 = _mm256_unpacklo_ps(row0, row1); \ __t1 = _mm256_unpackhi_ps(row0, row1); \ __t2 = _mm256_unpacklo_ps(row2, row3); \ __t3 = _mm256_unpackhi_ps(row2, row3); \ row0 = _mm256_shuffle_ps(__t0, __t2, _MM_SHUFFLE(1, 0, 1, 0)); \ row1 = _mm256_shuffle_ps(__t0, __t2, _MM_SHUFFLE(3, 2, 3, 2)); \ row2 = _mm256_shuffle_ps(__t1, __t3, _MM_SHUFFLE(1, 0, 1, 0)); \ row3 = _mm256_shuffle_ps(__t1, __t3, _MM_SHUFFLE(3, 2, 3, 2)); \ } while (0)</span></span></code> </pre> <br>  ูุธุฑูุง ูุจุนุถ ุงูููุฒุงุช ุงูููุฌูุฏุฉ ูู ูุฌููุนุงุช ุงูุชุนูููุงุช SSE2 / AVX2 ุ ูุฌุจ ุนูููุง ุงุณุชุฎุฏุงู ุนูููุงุช ุชุณุฌูู ุงููุงุตูุฉ ุงูุนุงุฆูุฉ ุนูุฏ ููู ุงููุชุฌูุงุช.  ูุญู ูููู ุจุชุญููู ุงูุจูุงูุงุช ููููุงู ุจูุง ูุจุงูุงุฉ ุ  ูููู ูุฐุง ูุง ููู ูู ุงูุฃุณุงุณ ุ ูุฃู ุชุฌููุน ุงูุฃุฏุงุก ูุญุฏูุง: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ef/602/0e0/1ef6020e0d5b0c4bbf962335d77c653a.png"><br><br>  <code>countTriangles</code> ุงูุขู ุญูุงูู 27ูช ูููุงุญุธ ูุคุดุฑ ุฃุณุนุงุฑ ุงููุณุชููู ุงูุฑููุจ (ุฏูุฑุงุช ููู ุชุนูููุฉ): ูููู ุจุฅุฑุณุงู ุชุนูููุงุช ุฃูู ุจููุฏุงุฑ ุฃุฑุจุนุฉ ุฃุถุนุงู ุ ููู ุงูุชุฌููุน ูุณุชุบุฑู ุงููุซูุฑ ูู ุงูููุช.  ูู ุงูุฑุงุฆุน ุชุณุฑูุน ุงูุนูู ุจุดูู ุนุงู ุ ูููู ุจุงูุทุจุน ุ ูุฅู ุงูุชุณุงุจ ุงูุฃุฏุงุก ูุญุจุท ุฅูู ุญุฏ ูุง.  ููุฏ ูุฌุญูุง ูู ุชุฌุงูุฒ <code>fillCellQuadrics</code> ูู ุงูููู ุงูุดุฎุตู ุ ููู ูุง ูููุฏูุง ุฅูู ุงููุธููุฉ ุงูุฃุฎูุฑุฉ ูู ุฃุนูู ุงููุงุฆูุฉ ุ ูุงูุชู ูู ูุทูุน ุนูููุง ุจุนุฏ. <br><br><h1 style=";text-align:right;direction:rtl">  ุงููุตู 6 ุ ุญูุซ ูุจุฏุฃ ูู ุดูุก ูู ุงูุนูู ููุง ููุจุบู </h1><br>  ุขุฎุฑ ูุธููุฉ ูู <code>computeVertexIds</code> .  ูู ุงูุฎูุงุฑุฒููุฉ ุ ูุชู ุชูููุฐูุง 6 ูุฑุงุช ุ ูุจุงูุชุงูู ููู ุชูุซู ุฃูุถูุง ูุฏููุง ููุชุงุฒูุง ููุชุญุณูู.  ูุฃูู ูุฑุฉ ุ ูุฑู ูุธููุฉ ูุจุฏู ุฃููุง ุชู ุฅูุดุงุคูุง ูุชุญุณูู ูุงุถุญ ูู SIMD: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">computeVertexIds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* vertex_ids, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vector3* vertex_positions, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vertex_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> grid_size)</span></span></span><span class="hljs-function"> </span></span>{ assert(grid_size &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; grid_size &lt;= <span class="hljs-number"><span class="hljs-number">1024</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cell_scale = <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(grid_size - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; vertex_count; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Vector3&amp; v = vertex_positions[i]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> xi = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(vx * cell_scale + <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> yi = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(vy * cell_scale + <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> zi = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(vz * cell_scale + <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); vertex_ids[i] = (xi &lt;&lt; <span class="hljs-number"><span class="hljs-number">20</span></span>) | (yi &lt;&lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) | zi; } }</code> </pre> <br>  ุจุนุฏ ุงูุชุญุณููุงุช ุงูุณุงุจูุฉ ุ ูุนุฑู ูุง ูุฌุจ ุงูููุงู ุจู: ุงุณุชุฑุฎ ุงูุฏูุฑุฉ 4 ุฃู 8 ูุฑุงุช ุ ุญูุซ ูุง ููุฌุฏ ุฃู ูุงุฆุฏุฉ ูู ูุญุงููุฉ ุชุณุฑูุน ุชูุฑุงุฑ ูุงุญุฏ ููุท ุ ูููู ููููุงุช ุงููุชุฌู ูุชุดุบูู ุงูุญุณุงุจุงุช ุจุงูุชูุงุฒู.  ูููู ุจุฐูู ุจุงุณุชุฎุฏุงู AVX2 ุ ููููู ุจูุนุงูุฌุฉ 8 ุฑุคูุณ ูู ูู ูุฑุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">__m256 scale = _mm256_set1_ps(cell_scale); __m256 half = _mm256_set1_ps(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (vertex_count &amp; ~<span class="hljs-number"><span class="hljs-number">7</span></span>); i += <span class="hljs-number"><span class="hljs-number">8</span></span>) { __m256 vx = _mm256_loadu2_m128( &amp;vertex_positions[i + <span class="hljs-number"><span class="hljs-number">4</span></span>].x, &amp;vertex_positions[i + <span class="hljs-number"><span class="hljs-number">0</span></span>].x); __m256 vy = _mm256_loadu2_m128( &amp;vertex_positions[i + <span class="hljs-number"><span class="hljs-number">5</span></span>].x, &amp;vertex_positions[i + <span class="hljs-number"><span class="hljs-number">1</span></span>].x); __m256 vz = _mm256_loadu2_m128( &amp;vertex_positions[i + <span class="hljs-number"><span class="hljs-number">6</span></span>].x, &amp;vertex_positions[i + <span class="hljs-number"><span class="hljs-number">2</span></span>].x); __m256 vw = _mm256_loadu2_m128( &amp;vertex_positions[i + <span class="hljs-number"><span class="hljs-number">7</span></span>].x, &amp;vertex_positions[i + <span class="hljs-number"><span class="hljs-number">3</span></span>].x); _MM_TRANSPOSE8_LANE4_PS(vx, vy, vz, vw); __m256i xi = _mm256_cvttps_epi32( _mm256_add_ps(_mm256_mul_ps(vx, scale), half)); __m256i yi = _mm256_cvttps_epi32( _mm256_add_ps(_mm256_mul_ps(vy, scale), half)); __m256i zi = _mm256_cvttps_epi32( _mm256_add_ps(_mm256_mul_ps(vz, scale), half)); __m256i id = _mm256_or_si256( zi, _mm256_or_si256( _mm256_slli_epi32(xi, <span class="hljs-number"><span class="hljs-number">20</span></span>), _mm256_slli_epi32(yi, <span class="hljs-number"><span class="hljs-number">10</span></span>))); _mm256_storeu_si256((__m256i*)&amp;vertex_ids[i], id); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅููุงุก ูุธุฑุฉ ุนูู ุงููุชุงุฆุฌ: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/895/365/9c9/8953659c9ee67385751dae656e244dbb.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุณุงุฑุนูุง </font></font><code>computeVertexIds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฑุชูู. ูุน ุงูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุฌููุน ุงูุชุญุณููุงุช ุ ุชู ุชุฎููุถ ุฅุฌูุงูู ููุช ุชูููุฐ ุงูุจุฑูุงูุฌ ุฅูู ุญูุงูู 120 ูููู ุซุงููุฉ ุ ููู ูุง ูุชูุงูู ูุน ุญุณุงุจ 50 ููููู ูุซูุซ ูู ุงูุซุงููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏ ูุจุฏู ุฃููุง ูู ูุญูู ูุฑุฉ ุฃุฎุฑู ููู ุงูุฅูุชุงุฌูุฉ ุงููุชููุน: </font></font><code>computeVertexIds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุง </font><font style="vertical-align: inherit;">ููุจุบู </font><font style="vertical-align: inherit;">ุฃู ูุชุณุงุฑุน ุฃูุซุฑ ูู ูุฑุชูู ุจุนุฏ ุงูููุงุฒุงุฉุ ููุฅุฌุงุจุฉ ุนูู ูุฐุง ุงูุณุคุงู ุ ุฏุนููุง ูุญุงูู ูุนุฑูุฉ ููุฏุงุฑ ุงูุนูู ุงูุฐู ุชุคุฏูู ูุฐู ุงููุธููุฉ. </font></font><br><br> <code>computeVertexIds</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ุชูููุฐู ุณุช ูุฑุงุช ูุจุฏุก ุจุฑูุงูุฌ ูุงุญุฏ: ุฎูุณ ูุฑุงุช ุฃุซูุงุก ุงูุจุญุซ ุงูุซูุงุฆู ููุฑุฉ โโูุงุญุฏุฉ ูู ุงูููุงูุฉ ูุญุณุงุจ ุงููุนุฑูุงุช ุงูููุงุฆูุฉ ุงูุชู ูุชู ุงุณุชุฎุฏุงููุง ูููุนุงูุฌุฉ ุงูุฅุถุงููุฉ. ูู ูู ูุฑุฉ ุชููู ูุฐู ุงููุธููุฉ ุจูุนุงูุฌุฉ 3 ููุงููู ุฑุฃุณ ุ ููุฑุงุกุฉ 12 ุจุงูุช ููู ููุฉ ููุชุงุจุฉ 4 ุจุงูุช.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงููุฌููุน ุ ุฃูุซุฑ ูู 100 ูุฏูุฑ ุงููุจุชูุฑ ุ ูุฐู ุงููุธููุฉ ูุนุงูุฌุฉ 1.8 ูููุงุฑ ุฑุฃุณ ุ ููุฑุงุกุฉ 21 ุบูุบุงุจุงูุช ูุฅุนุงุฏุฉ ูุชุงุจุฉ 7 ุบูุบุงุจุงูุช. </font><font style="vertical-align: inherit;">ุชุชุทูุจ ูุนุงูุฌุฉ 28 ุฌูุฌุงุจุงูุช ูู 1.46 ุซุงููุฉ ุนุฑุถ ูุทุงู ุชุฑุฏุฏู ููุญุงููุฉ ูุจูุบ 19 ุฌูุฌุงุจุงูุช / ุซุงููุฉ. </font><font style="vertical-align: inherit;">ูููููุง ุงูุชุญูู ูู ุนุฑุถ ุงููุทุงู ุงูุชุฑุฏุฏู ุงูุฐุงูุฑุฉ ุนู ุทุฑูู ุชุดุบูู </font></font><code>memcmp(block1, block2, 512 MB)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุงููุชูุฌุฉ ูู 45 ูููู ุซุงููุฉ ุ ุฃู ุญูุงูู 22 ุฌูุฌุงุจุงูุช / ุซุงููุฉ ุนูู ูุจ ูุงุญุฏ (ุนูู ุงูุฑุบู ูู ุฃู ูุนูุงุฑ AIDA64 ููุธูุฑ ุณุฑุนุงุช ูุฑุงุกุฉ ุนูู ูุธุงูู ูุตู ุฅูู 31 ุฌูุฌุงุจุงูุช / ุซุงููุฉ ุ ูููู ูุณุชุฎุฏู ุนุฏุฉ ูุฑุงูุฒ). </font><font style="vertical-align: inherit;">ูู ุงููุงูุน ุ ููุฏ ุงูุชุฑุจูุง ูู ุงูุญุฏ ุงูุฃูุตู ุงููููู ุชุญูููู ูู ุงูุฐุงูุฑุฉ ุ ูุณุชุชุทูุจ ุฒูุงุฏุฉ ุฃุฎุฑู ูู ุงูุฃุฏุงุก ุชุนุจุฆุฉ ุฃูุซู ููุฐู ุงูููู ุจุญูุซ ุชุดุบู ุฃูู ูู 12 ุจุงูุช.</font></font><br><br><h1 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฎุงุชูุฉ </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏ ุงุชุฎุฐูุง ุฎูุงุฑุฒููุฉ ูุญุณูุฉ ุจุดูู ุฌูุฏ ููุบุงูุฉ ุชุนูู ุนูู ุชุจุณูุท ุงูุดุจูุงุช ุงููุจูุฑุฉ ุจุณุฑุนุฉ 28 ููููู ูุซูุซ ูู ุงูุซุงููุฉ ุ ูุงุณุชุฎุฏููุง ูุฌููุนุงุช ุงูุชุนูููุงุช SSE ู AVX ูุชุณุฑูุนูุง ูุฑุชูู ุชูุฑูุจูุง ุ ุฅูู 50 ููููู ูุซูุซ ูู ุงูุซุงููุฉ. ุฎูุงู ูุฐู ุงูุฑุญูุฉ ุ ูุงู ุนูููุง ุฃู ูุชุนูู ุทุฑููุง ูุฎุชููุฉ ูุงุณุชุฎุฏุงู SIMD: ุณุฌูุงุช ูุชุฎุฒูู ุงููุชุฌูุงุช 3 - ูุงุณุนุฉ ุ ูุชุนูููุงุช SoA ุ ู AVX2 ูุชุฎุฒูู ูุชุฌููู ุนุฑูุถูู - 3 ุ ูุฌูุน ุงูุฅุฑุดุงุฏุงุช ูุชุณุฑูุน ุชุญููู ุงูุจูุงูุงุช ููุงุฑูุฉ ุจุงูุชุนูููุงุช ุงูุนุฏุฏูุฉ ุ ูุฃุฎูุฑุงู ูููุง ุจุชุทุจูู AVX2 ูุจุงุดุฑุฉ ููุนุงูุฌุฉ ุงูุฏูู.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุบุงูุจูุง ูุง ูุง ูููู SIMD ูู ุฃูุถู ููุทุฉ ุจุฏุงูุฉ ููุชุญุณูู: ููุฏ ูุฑ ุนููุงูู ุงูุดุจูุงุช ุจุนุฏุฉ ุชูุฑุงุฑุงุช ูู ุงูุชุญุณูู ุงูุฎูุงุฑุฒูู ู microoptimization ุฏูู ุงุณุชุฎุฏุงู ุฅุฑุดุงุฏุงุช ุฎุงุตุฉ ุจุงูููุตุฉ. ูููู ูู ูุฑุญูุฉ ูุง ุ ูุชู ุงุณุชููุงุฏ ูุฐู ุงูุงุญุชูุงูุงุช ุ ูุฅุฐุง ูุงู ุงูุฃุฏุงุก ุญุงุณููุง ุ ูุฅู SIMD ุฃุฏุงุฉ ุฑุงุฆุนุฉ ูููู ุงุณุชุฎุฏุงููุง ุฅุฐุง ูุฒู ุงูุฃูุฑ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุช ูุชุฃูุฏูุง ูู ุฃู ูู ูุฐู ุงูุชุญุณููุงุช ุณุชูุฏุฑุฌ ูู ุงููุฑุน ุงูุฑุฆูุณู </font></font><code>meshoptimizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: ูู ุงูููุงูุฉ ุ ูุฐู ูุฌุฑุฏ ุชุฌุฑุจุฉ ููุนุฑูุฉ ูุฏู ูููุฑูููููุฏ ุงูุดูุฑุฉ ุฏูู ุชุบููุฑ ุฌุฐุฑู ูู ุงูุฎูุงุฑุฒููุงุช. ุขูู ุฃู ูููู ูุฐุง ุงูููุงู ูููุฏูุง ูุฃู ููุฏู ูู ุฃููุงุฑูุง ูุชุญุณูู ุงูุดูุฑุฉ. ุงููุตุงุฏุฑ ุงูููุงุฆูุฉ ููุฐุง ุงูููุงู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุณุชูุฏ ูุฐุง ุงูุนูู ุฅูู ุฅุตุฏุงุฑ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meshoptimizer 99ab49</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููุชู ูุดุฑ ูููุฐุฌ ุจูุฐุง ุงูุชุงููุงูุฏู </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู Sketchfab</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar441536/">https://habr.com/ru/post/ar441536/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar441526/index.html">ุนูุงูู ูููุฉ ุงูุจูุชูููู</a></li>
<li><a href="../ar441528/index.html">ููู ุชุญููุช ุญูุงุชู ุฅูู ูุชุงุจ ูุงููุง</a></li>
<li><a href="../ar441530/index.html">ุณูุชู ุฅุทูุงู SDN ูู ุงููุถุงุก: ููุงุฐุง ูุฐุง ูุทููุจ</a></li>
<li><a href="../ar441532/index.html">ุณูู ุงูุณููุฑ ููุฏูุฉ</a></li>
<li><a href="../ar441534/index.html">ููุงุฒู ุงูุชุญููู ูุฃูุธูุฉ ุงูุฃูุฑูุณุชุฑุง</a></li>
<li><a href="../ar441538/index.html">ูุนูุงุฑูุฉ ูุณุชูุฏุน ุงูุจูุงูุงุช: ุงูุชูููุฏูุฉ ูุงูุณุญุงุจุฉ</a></li>
<li><a href="../ar441540/index.html">Vue mixins ุ ุงูุทุฑููุฉ ุงูุตุฑูุญุฉ (ุนูู ุณุจูู ุงููุซุงู ูู ุงูุจุฑูุงูุฌ ุงููุณุงุนุฏ ููุนุฏูุงุช BEM)</a></li>
<li><a href="../ar441546/index.html">Hayabusa-2 "ุชุทุฑู ูุฃูู ูุฑุฉ ุงูููููุจ</a></li>
<li><a href="../ar441550/index.html">ุญูุงุฉ ูุจุฑูุฌ ุจุณูุท ุตุนุจ ูุณูู</a></li>
<li><a href="../ar441554/index.html">ุชุงุฑูุฎ ููููุณ ุจุฃูููู. ุงูุฌุฒุก ุงูุฃูู: ููู ุจุฏุฃ ูู ุดูุก</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>