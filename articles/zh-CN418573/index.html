<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⛅️ 🛅 👦🏾 Waterius：通过Wi-Fi将水读数传输至手机（电池续航4年） ⏪ ⚓️ 🛠️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="有一次我厌倦了读取水表的读数。 可以在柜台附近安放一块磁铁，然后对此平静下来，但是我发现这条路不像运动手。 

 我的道路艰难而华丽。 但是结果是，该设备通过Wi-Fi将水的读数传输到手机。 简单直观地使用和配置至少适用于一名学生，至少适用于老年人。 并且熟悉单词“ Arduino”-也很容易制造。...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Waterius：通过Wi-Fi将水读数传输至手机（电池续航4年）</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418573/"><img src="https://habrastorage.org/webt/cu/cm/id/cucmidscnzwyjeto65obezfzjgw.jpeg"><br><br> 有一次我厌倦了读取水表的读数。 可以在柜台附近安放一块磁铁，然后对此平静下来，但是我发现这条路不像运动手。 <br><br> 我的道路艰难而华丽。 但是结果是，该设备通过Wi-Fi将水的读数传输到手机。 简单直观地使用和配置至少适用于一名学生，至少<s>适用于</s>老年人。 并且熟悉单词“ Arduino”-也很容易制造。 该设备可以使用电池运行四年（比起与您的持久关系更长）。 这也是具有此类特征的第一个开放项目。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我写出了</a>工厂的类似物，它们很少，还可以。 <br><br> 因此，我们有一些钱，但有一个很大而诚实的愿望，即在不违反《刑法》的情况下简化我们的生活。 这样一来，您的220V，服务器和一堆按钮都不会出现！ 我们在Blynk应用程序或类似服务中查看智能手机上的读数。 <br><br> 现在坐在椅子上，多吃些这些柔软的法国面包，喝点茶。 欣赏美丽的照片，并听听我关于创建独立设备时应考虑的事项的故事。 但首先，简要介绍一下Waterius。 <br><a name="habracut"></a><br><h3> 要求条件 </h3><br><ul><li> 带线计数器（UPD2：任何<s>输出“干触点”</s> ） </li><li> 带有网络的Wi-Fi路由器 </li></ul><br><h3> 特点 </h3><br><ul><li> 电源：3节AA电池 </li><li> 工作时间4年以上 </li><li>  2水表 </li><li> 一个按钮即可配置 </li><li> 非易失性存储器，用于指示和网络设置 </li></ul><br><h3>  Wi-Fi每日传输 </h3><br><ul><li> 当前读数 </li><li> 每天耗水量 </li><li> 电源电压 </li><li> 电邮 字母（正文和标题可以更改） </li></ul><br><br> 实现了对TCP服务器和Blynk应用程序的支持。 添加<s>HTTP</s> ， <s>MQTT</s> ，Modbus TCP，Cayenne，IFTTT等  （这里是展示您的创意天才的地方）。 <br><br>  UPD2：富有创造力的天才亮相，但HTTPS，MQTT <br><br><h2> 客制化 </h2><br> 单击“ Waterius”按钮后，它将打开Wi-Fi接入点。 连接，填写表格，向东鞠躬三遍，并向<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">WiFiManager</a>开发人员说“谢谢”。 你可以在精神上。 <br><br><img width="750" src="https://habrastorage.org/webt/du/9k/jn/du9kjni_1m0qlxthmhvagpl1fvg.jpeg" alt="使用Wifimanager设置Waterius"><br><br><h2> 娱乐电子 </h2><br> 无线电元素的散射，用于Waterius的组装 <br><br><img src="https://habrastorage.org/webt/g3/or/q4/g3orq43vvb6jmy2ow3m04n1dldg.jpeg"><br><br> 在计数脉冲时达到微安消耗单位的唯一方法是使用经济的微控制器，而不是您想的那样。  Waterius心脏-Attiny85微控制器（模拟-MSP430，STM8L）。 双手放在腰部上方时，任何Arduino板的缝合都没有问题。  Attiny85从内部发生器以1 MHz的频率运行并计数脉冲，并定期检查2个输入是否短路和按钮。 休眠电流<a href="">在3V时为4μA</a> 。 一个童话。 <br><br> 作为Wi-Fi，我使用ESP8266-01。 工作期间消耗75mA，脉冲高达250mA。 两个微控制器在i2c总线上进行通信。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">气象站</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">项目</a>证实了选择的正确性。  ESP8266一直在做梦：EN引脚通过一个电阻拉至GND。 消耗电流小于10μA（我遇到的实例为0μA）。 每天一次，Attiny85发出HIGH信号，ESP8266唤醒，从Attiny85接收读数，连接到家庭Wi-Fi并在约4秒钟内发送数据-根据英国科学家的研究，这比您通常手动访问这些计数器要快得多。 <br><br><img align="right" src="https://habrastorage.org/webt/y6/ov/aa/y6ovaaeka77kd0inlhivxv3cd_k.jpeg">  <i>图为良好的ESP，功耗跃升7-11μA。</i>  <i>通常数字为19-23μA。</i> <br><br> 其他类型的睡眠对Waterius无效，至少在褪黑激素的声音上撒上褪黑激素：通过外部复位立即唤醒的无限深度睡眠消耗20μA电流，适合频繁数据发送。 最经济的选择：完全关闭ESP8266，但您需要的是害怕静电的场效应晶体管。 <br><br> 设置按钮位于SCL线上。 所有Attiny85引脚都忙！ 因此，Waterius不支持那慕尔仪表的输出，也没有泄漏传感器。 <br>  LED连接到ESP的TX引脚，并在ESP运行时点亮。 插入TTL-USB适配器以查看日志（尽管有趣！）。 在开发之初，我认为要指示错误，您需要使LED闪烁，但是您可以进行管理-这只会使代码复杂化。 <br> 如果在3到10秒钟后成功连接到Wi-Fi路由器，则LED指示灯将熄灭，并且如果继续点亮，请重新将手机重新连接至Waterius。 先进的技术，纳米技术，NASA的成就，中国古代的教s。 <br><br> 我们每个人都知道：低功率设备的一个特点是它们容易受到电磁干扰。 因此，我求助于熟悉的电子工程师，并学习了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文学</a> （+最美丽的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">村田</a>课程）。  ESP和Attiny上的所有引脚均被拉至电源或GND。 已安装功率电容器。 仪表的“脏”地通过一个300欧姆的电阻连接到“干净的”地，而输出本身通过3k3电阻连接。 每个人都会如此！ <br><br><h3> 房屋 </h3><br> 我们拿一个塑料瓶...一个玩笑。 我为4节AA电池使用了一个隔层。 在连接器的盖子上的LED和按钮侧面开了一个孔。 <br><br><img src="https://habrastorage.org/webt/yl/dt/e2/yldte2s4juxluytorqdld8eumrs.jpeg"><br><br> 您可以使用接线盒（如果是3D打印机和其他萨满教，请尝试一下）。 <br><br> 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github中</a>是用于LUT的单层板和用于工厂生产的两层板。  Waterius甚至可以由小学生制成！ 是的，如果他没有悬浮滑板并且从不旋转微调器。 <br><br> 理想的板不能立即工作。 第一个原型如下所示： <br><br><img src="https://habrastorage.org/webt/wd/3c/tw/wd3ctw183ioynjkuqnxhszttjee.jpeg"><br><br> 但是构建的第四个版本几乎“完美”： <br><br><img src="https://habrastorage.org/webt/t3/uw/m4/t3uwm48xqxlcuef8u1nrgq3clkm.jpeg"><br><br> 我无法抗拒，并订购了一包Resonite的木板。 太高了！ <br><br><img src="https://habrastorage.org/webt/ok/hm/-n/okhm-nnvs0vnjlpdqiiezw_tts0.jpeg"><br><br><h3> 营养学 </h3><br> 在Waterius中，有一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3V MCP1700</a>稳定器，其最低消耗非常低（几微安）。 三节AA 1.5V碱性电池几乎可以完全<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">放电</a>至3.2V。此外，Attiny85将具有稳定的电压（并且<a href="">频率</a>不会<a href="">浮动</a> ，这很嗡嗡，尽管在这个项目中这并不重要）。 <br><br> 该电路将在没有两节AA电池稳定器的情况下工作。  Attiny85应该购买V版本（功率高达1.8V）。  ESP可在高达2.5V的电压下“在Internet上”工作。 我们将能够使用40％的电池电量（不要相信，请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">A. Nadezhin的</a>测试）。 如果您购买两节AA 1.5V 3 Ah锂电池，Waterius将在低温下工作长达10年，在那里-您看-我们将建立共产主义。 <br><br> 缺少工具使我无法准确地衡量Waterius的消耗量。 他在家里工作了45天，每30分钟发送一次读数（以加快放电速度）。 电源电压从4.68V降至4.51V下降了0.17V（UPD：100天4.38V，UPD2：313天3.9V）。 如果这种情况继续下去，电池将持续1.5年。 每天发送一次读数的经济性是原来的3倍，因此需要4年的工作。 是的，我了解自放电电池。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">劲量数据表</a>和包装上的保存期限称其不牢固。 <br><br> 这是最好奇的电池消耗和组件成本的计算（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google表格</a> ）。 <br><br><h2> 程序员详细信息（针对那些不累的人） </h2><br> 不适合在中断上执行脉冲计数，因为 簧片开关关闭时（区域〜3L），水可以关闭，电流将流过上拉电阻。 需要防止接触反弹：微电路或代码延迟。 我每250毫秒执行一次定期轮询，并仅通过反复关闭来增加（一个漂亮的词，对吗？）值。 无需焊接，尽管如果您确实愿意，也可以。 <br><br> 为了防止Attiny重载，我将所有值存储在其EEPROM存储器中。 为了超过100k条目的限制，我为当前单元格编写了一个带有环形标记的<a href="">环形缓冲区</a> 。 现在，我安静地入睡，这就是我希望您能得到的。 该代码提供了用于调试的日志记录。 将TTL-USB连接到第二个仪表连接器。 <br><br><h2> 资料汇出 </h2><br> 起初我写了Telegram机器人，但是Roskomnadzor阻止了Telegram。 我不得不放弃这个决定，以免启动代理服务器而不是一帆风顺。 事实证明，使用Blynk是最佳选择（无所畏惧的开发人员正在努力使用锁）。 这是<a href="">项目</a>的<a href="">QR码</a> 。 除了他之外，Cayenne项目还有一个电话应用程序。 <br><br> 未实施自动发送到Mosvodokanal的操作，因为 非营利项目，但我们的工作年限是多少？ 还是你的。 我没有办法维护服务器并“合法化”发送程序，但是您突然向朋友询问...我将很高兴您的帮助和自由的想法。 <br><br> 莫斯科人通过SMS发送证词，这意味着Web服务器足以接收Waterius数据和带有SMS的页面（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github</a> ）。 使用莫斯科国家服务的Fiddler计划的莫斯科专家应该对我<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a>发送水读数的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Python脚本</a>感兴趣。 <br><br><h2> 发展历程 </h2><br> 众所周知，创建新产品的主要障碍之一就是完美主义。 无需检查消费者是否需要就无需进行新功能。 简单的代码更易于开发。 <br><br> 通往完美主义的道路在于 <br><br><ul><li> 通过Internet升级ESP和Attiny固件 </li><li>  UPD2： <s>支持HTTPS或加密</s> </li><li> 一个服务器，用户可以在其中下载其脚本以发送水读数。 </li><li> 使用STM8L / MSP430（它们更经济，引脚更多） </li><li>  UPD2：连接后<s>可视检查是否与电表接触</s> </li><li> 电子邮件发送期限的指示 字母 </li><li>  UPD2： <s>对</s> Namur <s>输出的</s>计数器<s>支持</s> </li><li> 泄漏传感器（UPD2：复位后完成） </li><li> 起重机控制 </li><li> 电表支持 </li></ul><br><h2> 致谢 </h2><br> 感谢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ivan Kovalenko</a>和Ivan Ganzha在Aigul，E。Lapin的电气工程方面的建议 为了正确的生活和父亲的方法，因为我不仅可以编程，还可以焊接，还可以给您-请注意！ <br><br><img src="https://habrastorage.org/webt/bi/rs/dg/birsdgh0skpa69dhb-q2mltxffs.jpeg"><br><br> 我将很高兴收到任何建议，请求和批评！ <br><br> 预热烙铁！  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Github项目</a> <br><br>  UPD2 05/07/2019：感谢所有为项目提供帮助的人！ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN418573/">https://habr.com/ru/post/zh-CN418573/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN418561/index.html">MVP服务中的状态机。 Yandex讲座</a></li>
<li><a href="../zh-CN418563/index.html">263号移动开发人员的有趣材料摘要（7月23日至7月29日）</a></li>
<li><a href="../zh-CN418565/index.html">以sql-dumper为例在Go中进行测试以达到100％代码覆盖率的方式</a></li>
<li><a href="../zh-CN418567/index.html">戴尔将不再是一家私人公司，这将是5年以来的首次</a></li>
<li><a href="../zh-CN418569/index.html">新卫星-新错误：GOES-17卫星红外传感器不能很好地冷却</a></li>
<li><a href="../zh-CN418575/index.html">“请勿起飞”：6个不常见的音频小工具</a></li>
<li><a href="../zh-CN418577/index.html">使用标签管理您的书签-使您自己和您的同事高兴</a></li>
<li><a href="../zh-CN418579/index.html">虚拟环境库如何工作</a></li>
<li><a href="../zh-CN418581/index.html">React Basics（教科书，第二版）</a></li>
<li><a href="../zh-CN418585/index.html">制作机器人的本地越野地图</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>