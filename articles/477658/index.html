<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚶🏿 💳 🤾🏻 Restauración activa: ¿puede la recuperación ante desastres ser más rápida? Mucho mas rapido? 👮 🤙🏻 🤷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Respaldar datos importantes es bueno. Pero, ¿qué pasa si el trabajo necesita continuar de inmediato y cada minuto cuenta? Nosotros en Acronis decidimo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Restauración activa: ¿puede la recuperación ante desastres ser más rápida? Mucho mas rapido?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acronis/blog/477658/">  Respaldar datos importantes es bueno.  Pero, ¿qué pasa si el trabajo necesita continuar de inmediato y cada minuto cuenta?  Nosotros en Acronis decidimos verificar qué tan posible es resolver la tarea de iniciar el sistema lo más rápido posible.  Y esta es la primera publicación de la serie Active Restore en la que les contaré cómo comenzamos el proyecto con la Universidad de Innopolis, qué solución encontramos y en qué estamos trabajando hoy.  Detalles - debajo del corte. <br><br><img src="https://shydyrond.ru/backend/uploads/Kak%20uvelichit%27%20skorost%27%20raboty%20komp%27yutera/kak-uvelichit-skorost-raboty-kompyutera.jpg" alt="imagen"><br><a name="habracut"></a><br>  Hola  Mi nombre es Daulet Tumbaev, y hoy quiero compartir con ustedes mi experiencia en el desarrollo de un sistema que acelere la recuperación ante desastres.  Para hablar sobre todo el camino de desarrollo del proyecto, comencemos un poco desde lejos.  Actualmente trabajo en Acronis, pero también me gradué de la Universidad de Innopolis, quien me gradué en el Programa de Maestría en Gestión del Desarrollo de Software (conocido como MSIT-SE).  Innopolis es una universidad joven, y el plan de estudios es aún más joven.  Pero luego se basa en el plan de estudios de la Universidad Carnegie Mellon (Universidad Carnegie Mellon), en cuyos logros existe un tema como los proyectos industriales. <br><br>  El propósito del proyecto industrial es sumergir al estudiante en un desarrollo real y consolidar el conocimiento adquirido en la práctica.  Para hacer esto, la universidad coopera con empresas como Yandex, Acronis, MTC y docenas de otras (en total, la universidad tenía 144 socios para 2018).  En el curso de la cooperación, las empresas ofrecen sus direcciones de trabajo a la universidad, y los estudiantes eligen uno de los proyectos más cercanos a ellos en sus intereses y nivel de capacitación.  Hace solo dos años, todavía estaba "al otro lado de las barricadas" y trabajaba como estudiante en otro proyecto de Acronis.  Pero esta vez, me convertí en consultor técnico para estudiantes de la compañía y propuse el proyecto Restauración activa a Innopolis.  La idea de Restauración activa fue formulada por el equipo de Kernel en Acronis, pero el desarrollo de la solución comenzó con la Universidad de Innopolis. <br><br><h3>  Restauración activa: ¿por qué es necesario? </h3> <br>  Tradicionalmente, la recuperación ante desastres funciona de acuerdo con un esquema estándar.  Después de problemas con la computadora, vaya a la interfaz web de algún sistema de respaldo, por ejemplo, Acronis True Image, y haga clic en el botón grande "restaurar".  A continuación, debe esperar N minutos, y solo después de eso puede continuar trabajando. <br><br><img src="https://habrastorage.org/webt/lr/qz/at/lrqzata7ct47-wrmeeiqxvrnoq8.jpeg"><br><br>  El problema es que este número N, también conocido como RTO (objetivo de tiempo de recuperación), el tiempo de recuperación permitido, puede ser bastante impresionante, lo que depende de la velocidad de conexión (si se produce la recuperación de la nube), del volumen del disco duro de su computadora y Una serie de otros factores.  ¿Se puede reducir?  Sí, puede, porque para reanudar el trabajo no siempre necesita un disco de computadora completo.  Las mismas fotos y videos no afectan la funcionalidad del dispositivo y se pueden extraer más adelante en segundo plano. <br><br><h3>  Conductor necesario ... </h3><br>  El sistema operativo espera comenzar con un disco completamente terminado.  Por lo tanto, Windows realiza una serie de comprobaciones de integridad del disco.  El sistema no permitirá un inicio normal en ausencia o daño de algunos archivos que el sistema operativo espera encontrar.  Para resolver este problema, se decidió colocar en el disco los llamados archivos redirectores que creamos, que reemplazan los archivos faltantes o dañados, pero en realidad son tontos.  Crear tales redirectores no es largo, porque de hecho no tienen contenido. <br><br>  La recuperación adicional ocurre de la siguiente manera.  Proceso de fondo, en paralelo con la operación del sistema operativo, los "dummies" se llenan de datos.  El proceso de recuperación en segundo plano tiene en cuenta la carga en el disco y no supera el límite establecido.  Sin embargo, el usuario o el propio sistema operativo pueden solicitar de repente un archivo que aún no existe.  Aquí es donde entra en juego el segundo modo de recuperación.  La prioridad del archivo solicitado se incrementa al máximo, y el proceso de recuperación carga urgentemente el archivo en el disco.  El sistema operativo recibe el archivo deseado, aunque con un ligero retraso. <br><br>  Se ve como una imagen perfecta.  Sin embargo, en el mundo real, hay una gran cantidad de trampas y posibles puntos muertos.  Junto con los estudiantes universitarios de Innopolis, decidimos investigar este escenario de recuperación, evaluar la ganancia en RTO y entender si este enfoque es factible.  De hecho, tales decisiones en el mercado simplemente no existían en ese momento. <br><br>  Y si decidí renunciar al componente de servicio a los chicos de Innopolis, entonces, dentro de Acronis, el trabajo comenzó en un <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ifs/file-system-minifilter-drivers">controlador de sistema de archivos con mini filtro</a> .  Esto fue hecho por el equipo de Windows Kernel.  El plan era este: <br><br><ul><li>  Ejecute el controlador en una etapa temprana de inicio del sistema operativo, </li><li>  Durante la operación, cuando <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode">el espacio del usuario</a> esté completamente listo, descargue el servicio </li><li>  El servicio procesa las solicitudes de los conductores y coordina su trabajo posterior. </li></ul><br><img src="https://habrastorage.org/webt/2a/vl/qf/2avlqfvl30ekh3xdix5xjwjggdu.jpeg"><br><h3>  Las sutilezas de la ingeniería del conductor. </h3><br>  Si mis colegas hablarán sobre el servicio en otra publicación, en este texto revelaremos las sutilezas del desarrollo de controladores.  El mini filtro de controlador ya desarrollado tiene dos modos de funcionamiento: cuando el sistema se inició en modo normal y cuando el sistema acaba de experimentar una falla y se produce su recuperación.  Antes de cargar las bibliotecas y aplicaciones de usuario, y por lo tanto nuestro servicio, el controlador se comporta igual.  Él no sabe en qué estado se encuentra el sistema ahora.  Como resultado, cada creación, lectura y escritura se registra, se registran todos los metadatos.  Y cuando el servicio está en línea, el controlador proporciona esta información al servicio. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x4/x0/0c/x4x00ccpfivzeboam8r6zdvx4re.png"></div><br>  En el caso de un inicio normal, el servicio transmite una señal de "Relax" al conductor para que "se relaje" y deje de registrar escrupulosamente todos los datos.  En este caso, el controlador cambia al registro solo los cambios en el disco y los informa al servicio, que con la ayuda de otras herramientas de Acronis mantiene la copia de seguridad del disco en el estado más actualizado en el medio que definió el usuario.  Puede ser una copia de seguridad en la nube, remota, gradual o nocturna. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/34/he/x1/34hex17zyywzzuv7rlivamn46e0.png"></div><br>  Si el modo de recuperación está habilitado, el servicio informa al controlador que necesita trabajar en el modo "Recuperación".  El sistema se acaba de recuperar después de una falla y, tan pronto como solicita que se abra un archivo en el disco, el mini filtro debe interceptar esta operación, realizar esta solicitud, verificar si existe dicho archivo en el disco y si se puede abrir. <br><br>  Si no hay ningún archivo, el mini filtro transfiere esta información al servicio, lo que aumenta la prioridad de la recuperación de archivos (todo este tiempo, la recuperación está en progreso).  Resulta que este archivo simplemente salta al comienzo de la cola.  Después de eso, el servicio en sí (o por otras herramientas de Acronis) restaura este archivo y le dice al controlador que todo está bien, ahora el sistema operativo puede acceder a él y el controlador "libera" la solicitud original, del sistema al disco. <br><br>  Si la recuperación no es posible, el servicio informa al controlador que tampoco hay ningún archivo en la copia de seguridad.  Nuestro controlador de mini-filtro simplemente omite la solicitud del sistema y el solicitante original (el sistema operativo o la aplicación) recibe un error de "archivo no encontrado".  Sin embargo, esto es bastante normal si el archivo realmente no estaba en el disco y en la copia de seguridad. <br><br><img src="https://habrastorage.org/webt/yv/8w/qe/yv8wqetbjrg3kq2hkr2vosj8dve.png"><br><br>  Por supuesto, el sistema operativo funcionará mucho más lento, porque la lectura de cualquier archivo o biblioteca ocurre en varias etapas, y posiblemente con acceso a recursos remotos.  Pero entonces el usuario puede comenzar a trabajar lo antes posible mientras la recuperación aún está teniendo lugar. <br><br><h3>  Necesita más bajo, incluso más bajo ... </h3><br>  El prototipo ha demostrado su valía.  Pero también encontramos la necesidad de seguir adelante, porque en algunos casos todavía se producen puntos muertos.  Por ejemplo, el sistema operativo puede solicitar varias bibliotecas en varios subprocesos, lo que conduce al cierre de nuestro servicio. <br><br>  El problema en el que estoy trabajando ahora es aumentar la velocidad de Restauración activa y aumentar el nivel de seguridad del sistema.  Supongamos que el sistema no necesita un archivo completo, solo se necesita una parte.  Para esto, se desarrolló otro controlador: un controlador de filtro de disco.  Ya no funciona en el archivo, sino en el nivel de bloque.  El principio de funcionamiento es similar: en funcionamiento normal, el controlador simplemente registra los bloques modificados en el disco y, en modo de recuperación, intenta leer el bloque por sí solo; en caso de falla, solicita al servicio que aumente la prioridad.  Sin embargo, todas las demás partes del sistema siguen siendo las mismas.  Por ejemplo, un servicio a nivel del sistema operativo ni siquiera sospecha que se le está ofreciendo comunicarse con otro controlador, porque la tarea principal es proporcionar al sistema operativo exactamente los datos necesarios para su funcionamiento.  Esta dirección requiere mejoras significativas, aunque solo sea porque el servicio aún no sabe cómo pensar a nivel de bloque. <br><br>  El siguiente paso, decidí ejecutar el controlador más profundo y antes, cayendo al nivel de los controladores UEFI y las aplicaciones nativas de Windows en lugar del servicio.  Para esto, se desarrolló un <a href="https://edk2-docs.gitbooks.io/edk-ii-uefi-driver-writer-s-guide/3_foundation/37_uefi_images/372_drivers.html">controlador de arranque UEFI</a> (o controlador DXE), que se inicia y muere antes de que se inicie el sistema operativo.  Pero la "historia" de los controladores UEFI, los detalles sobre el ensamblaje y la instalación, así como los detalles de las aplicaciones nativas de Windows, los consideraremos en la próxima publicación.  Suscríbete a nuestro blog y por ahora prepararé una historia sobre la próxima etapa del trabajo.  Estaría feliz por sus comentarios y consejos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/477658/">https://habr.com/ru/post/477658/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../477646/index.html">Los matemáticos cortan formas en busca de partes de ecuaciones</a></li>
<li><a href="../477648/index.html">MVCC en PostgreSQL-3. Versiones de fila</a></li>
<li><a href="../477650/index.html">Cifrado del tráfico TLS según los algoritmos GOST-2012 con Stunnel</a></li>
<li><a href="../477654/index.html">Probar el operador mejorado instanceof en Java 14</a></li>
<li><a href="../477656/index.html">Aún así, ¿por qué necesitas hacer?</a></li>
<li><a href="../477662/index.html">Acceso a neumáticos Redd en puentes FTDI</a></li>
<li><a href="../477668/index.html">29 de noviembre, 6 p.m. - devleads-mitap</a></li>
<li><a href="../477670/index.html">Lo que da la automatización de prueba</a></li>
<li><a href="../477672/index.html">Derechos y obligaciones de los miembros del equipo: aspectos legales y culturales.</a></li>
<li><a href="../477674/index.html">¿AI significa amor?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>