<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>❣️ 👵🏼 🧑🏻‍🤝‍🧑🏻 NestJS: el mismo backend real en nodejs 👩‍👩‍👧 🧝🏿 📯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="NestJS es un marco diseñado para facilitar la vida de un desarrollador, utilizando los enfoques arquitectónicos correctos y dictando sus propias regla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>NestJS: el mismo backend real en nodejs</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439434/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d11/98b/ac8/d1198bac8e4ced0d89d5e5983061f418.png" alt="imagen" width="400"></div><br>  NestJS es un marco diseñado para facilitar la vida de un desarrollador, utilizando los enfoques arquitectónicos correctos y dictando sus propias reglas. <br><br>  Por lo tanto, NestJS no es solo un marco de back-end, sino también la oportunidad de ingresar al mundo de los conceptos avanzados, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DDD</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">abastecimiento de eventos</a> y arquitectura de microservicios.  Todo está empaquetado de una manera simple y fácil, por lo que la elección es suya, ya sea que decida usar toda la plataforma o simplemente usar sus componentes. <br><a name="habracut"></a><br>  Primero, te contaré sobre mi experiencia.  Durante mucho tiempo escribí en ASP.NET, luego hubo una interfaz en AngularJS.  En octubre de 2016, hubo un cambio a angular y mecanografiado.  ¡Y aquí está!  Al escribir en la interfaz, puede hacer cosas complejas con bastante facilidad.  Antes de esto (desarrollo en nestjs) en el nodo, lo desarrollé solo por diversión, y de alguna manera incluso hubo un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">intento de introducir buenas prácticas y mecanografía en el popular Koa</a> .  Pero NestJS sigue siendo un poco diferente. <br><br>  NestJS, un marco que está completamente escrito en TypeScript (también es compatible con JS, pero los tipos son muy buenos), es fácil de probar y contiene todo lo que necesita. <br><br>  <b>¿Cómo crear una aplicación simple en NestJS?</b> <br><br>  NestJS tiene expreso debajo del capó.  Cualquier extensión para express es fácil de implementar en Nest.  Pero este no es el punto aquí, con un fuerte deseo expreso se puede tomar y cambiar. <br><br>  Primero, puede copiar un pequeño kit de inicio para usted: <br><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/nestjs/typescript-starter.git project</code> </pre> <br>  Server.ts incluye una función asincrónica que se encarga de cargar nuestra aplicación: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { NestFactory } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ApplicationModule } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./modules/app.module'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> NestFactory.create(ApplicationModule); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> app.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>); } bootstrap();</code> </pre><br>  Bueno, entonces inicie npm run start y vea la aplicación en el puerto 3000. <br><br>  <b>¿De qué está hecho NestJS?</b> <br><br>  El autor del marco se inspiró en las ideas de Angular, y NestJS resultó ser muy similar a Angular, especialmente en versiones anteriores. <br><br>  <b>Controladores</b> <br><br>  La capa de controlador es responsable de procesar las solicitudes entrantes y devolver una respuesta al cliente.  Un ejemplo simple de controlador: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Controller, Get } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; @Controller(<span class="hljs-string"><span class="hljs-string">'cats'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsController</span></span></span><span class="hljs-class"> </span></span>{ @Get() findAll() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> []; } }</code> </pre><br>  <b>Proveedores</b> <br><br>  Casi todo son proveedores: servicio, repositorio, fábrica, ayudante, etc.  Se pueden implementar en controladores y otros proveedores.  Si dices el idioma de Angular, todo es `@Injectables <br><br>  Por ejemplo, un servicio regular: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Injectable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Cat } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./interfaces/cat.interface'</span></span>; @Injectable() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsService</span></span></span><span class="hljs-class"> </span></span>{ private readonly cats: Cat[] = []; create(cat: Cat) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cats.push(cat); } findAll(): Cat[] { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cats; } }</code> </pre><br>  <b>Módulos</b> <br><br>  Un módulo es una clase con el decorador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Module</a> ().  El decorador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Module</a> () proporciona metadatos que Nest usa para organizar la estructura de la aplicación.  Cada aplicación Nest tiene al menos un módulo, el módulo raíz.  El módulo raíz es donde Nest comienza a organizar el árbol de aplicaciones.  De hecho, el módulo raíz puede ser el único módulo en su aplicación, especialmente cuando la aplicación es pequeña, pero eso no tiene sentido.  En la mayoría de los casos, tendrá varios módulos, cada uno de los cuales tiene un conjunto de características estrechamente relacionadas.  En Nest, los módulos son singleton de forma predeterminada, por lo que puede compartir fácilmente la misma instancia de componente entre dos o más módulos. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Module } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { CatsController } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./cats.controller'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { CatsService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./cats.service'</span></span>; @Module({ <span class="hljs-attr"><span class="hljs-attr">controllers</span></span>: [CatsController], <span class="hljs-attr"><span class="hljs-attr">components</span></span>: [CatsService], }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatsModule</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre><br>  <b>Un poco sobre módulos dinámicos</b> <br><br>  El sistema modular Nest viene con función de módulo dinámico.  Esto le permite crear módulos personalizados sin ningún esfuerzo.  Echemos un vistazo a DatabaseModule: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Module, DynamicModule } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createDatabaseProviders } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./database.providers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Connection } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./connection.component'</span></span>; @Module({ <span class="hljs-attr"><span class="hljs-attr">components</span></span>: [Connection], }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DatabaseModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> forRoot(entities = [], options?): DynamicModule { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> providers = createDatabaseProviders(options, entities); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">module</span></span>: DatabaseModule, <span class="hljs-attr"><span class="hljs-attr">components</span></span>: providers, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: providers, }; } }</code> </pre><br>  Define el componente de conexión de forma predeterminada, pero adicionalmente, dependiendo de las opciones y entidades transferidas, crea una colección de proveedores, por ejemplo, componentes de repositorio.  De hecho, el módulo dinámico expande los metadatos del módulo.  Esta característica esencial es útil cuando necesita registrar componentes dinámicamente.  Luego puede importar el DatabaseModule de la siguiente manera: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Module } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { DatabaseModule } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./database/database.module'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { User } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./users/entities/user.entity'</span></span>; @Module({ <span class="hljs-attr"><span class="hljs-attr">imports</span></span>: [ DatabaseModule.forRoot([User]), ], }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationModule</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre><br>  Por cierto, para trabajar con la base de datos hay un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TypeORM</a> genial que puede funcionar con la mayoría de las bases de datos. <br><br>  <b>Middlewares</b> <br><br>  Middlewares es una función que se llama antes del controlador de ruta.  Tienen acceso a solicitud y respuesta.  De hecho, son lo mismo que en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">express</a> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Injectable, NestMiddleware, MiddlewareFunction } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; @Injectable() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoggerMiddleware</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NestMiddleware</span></span></span><span class="hljs-class"> </span></span>{ resolve(...args: any[]): MiddlewareFunction { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Request...'</span></span>); next(); }; } }</code> </pre><br>  <b>Filtros de excepción</b> <br><br>  Nest tiene una capa de excepción, que es responsable de detectar las excepciones no controladas y devolver la respuesta adecuada al usuario final. <br><br>  Cada excepción es manejada por el filtro de excepción global, y cuando no se reconoce (no es una HttpException o una clase que hereda una HttpException), el usuario recibe la siguiente respuesta JSON: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Internal server error"</span></span> }</code> </pre><br>  <b>Tubos</b> <br><br>  La tubería debe implementar la interfaz PipeTransform. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { PipeTransform, Injectable, ArgumentMetadata } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; @Injectable() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValidationPipe</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PipeTransform</span></span></span><span class="hljs-class"> </span></span>{ transform(value: any, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: ArgumentMetadata) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } }</code> </pre><br>  La tubería convierte la entrada al resultado deseado. <br><br>  Además, esto puede pasar para la validación, ya que también es posible que arrojen una excepción si los datos son incorrectos.  Por ejemplo: <br><br><pre> <code class="javascript hljs">@Post() @UsePipes(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationPipe(createCatSchema)) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> create(@Body() createCatDto: CreateCatDto) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.catsService.create(createCatDto); }</code> </pre><br>  O puede declarar una tubería global: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> NestFactory.create(ApplicationModule); app.useGlobalPipes(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationPipe()); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> app.listen(<span class="hljs-number"><span class="hljs-number">3000</span></span>); } bootstrap();</code> </pre><br>  <b>Guardias</b> <br><br>  Los guardias deben implementar la interfaz CanActivate.  Los guardias tienen la responsabilidad exclusiva.  Determinan si la solicitud debe ser procesada por el controlador de ruta o no. <br><br><pre> <code class="javascript hljs">@Injectable() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RolesGuard</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CanActivate</span></span></span><span class="hljs-class"> </span></span>{ canActivate( context: ExecutionContext, ): boolean | <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>&lt;boolean&gt; | Observable&lt;boolean&gt; { <span class="hljs-comment"><span class="hljs-comment">// const request = context.switchToHttp().getRequest(); // const data = context.switchToWs().getData(); return true; } } : &lt;source lang="javascript"&gt; @Controller('cats') @UseGuards(RolesGuard) export class CatsController {}</span></span></code> </pre><br>  <b>Interceptores</b> <br><br>  Los interceptores tienen algunas características útiles que están inspiradas en la técnica de Programación Orientada a Aspectos (AOP).  Te permiten: <br><br><ul><li>  enlazar lógica adicional antes / después de ejecutar el método; </li><li>  convierte el resultado devuelto por la función; </li><li>  Convertir una excepción lanzada desde una función </li><li>  redefinir completamente la función en función de las condiciones seleccionadas (por ejemplo, para el almacenamiento en caché). </li></ul><br>  <b>Microservicios</b> <br><br>  Nest Microservice es solo una aplicación que usa una capa de transporte diferente (no HTTP). <br><br>  Nest admite dos tipos de comunicación: TCP y Redis pub / sub, pero la nueva estrategia de transporte es fácil de implementar mediante la implementación de la interfaz CustomTransportStrategy. <br><br>  Puede crear fácilmente un microservicio desde su aplicación: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { NestFactory } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ApplicationModule } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./modules/app.module'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Transport } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/microservices'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> NestFactory.createMicroservice(ApplicationModule, { <span class="hljs-attr"><span class="hljs-attr">transport</span></span>: Transport.TCP, }); app.listen(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Microservice is listening'</span></span>)); } bootstrap();</code> </pre><br>  Nest Microservice reconoce los mensajes por patrones.  Un patrón es un valor simple, un objeto, una cadena o incluso un número. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Controller } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/common'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { MessagePattern } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@nestjs/microservices'</span></span>; @Controller() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MathController</span></span></span><span class="hljs-class"> </span></span>{ @MessagePattern({ <span class="hljs-attr"><span class="hljs-attr">cmd</span></span>: <span class="hljs-string"><span class="hljs-string">'sum'</span></span> }) sum(data: number[]): number { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data || []</span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reduce</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b</span></span></span><span class="hljs-function">) =&gt;</span></span> a + b); } }</code> </pre><br>  Y para la comunicación entre microservicios, debe usar el cliente: <br><br><pre> <code class="javascript hljs">@Client({ <span class="hljs-attr"><span class="hljs-attr">transport</span></span>: Transport.TCP, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-number"><span class="hljs-number">5667</span></span> }) client: ClientProxy;</code> </pre><br>  Y aquí estará el envío del mensaje: <br><br><pre> <code class="javascript hljs">@Get() call(): Observable&lt;number&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pattern = { <span class="hljs-attr"><span class="hljs-attr">cmd</span></span>: <span class="hljs-string"><span class="hljs-string">'sum'</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client.send&lt;number&gt;(pattern, data); }</code> </pre><br>  NestJS y Angular están tan estrechamente conectados que el autor del marco puede verse fácilmente en conferencias y reuniones.  Por ejemplo, el equipo nrwl recientemente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">incluyó la</a> plantilla nestjs en su nx. <br><br><pre> <code class="bash hljs">ng g node-app nestjs-app -framework nestjs</code> </pre> <br>  NestJS ya es lo suficientemente maduro, y muchas compañías ya lo están utilizando. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¿Quién está usando NestJS en producción en este momento?</a> <br><br>  El marco en sí: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/nestjs/nest</a> <br><br>  Muchos enlaces <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">relacionados</a> interesantes aquí: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Awesome-nestjs</a> <br>  Comunidad de habla rusa de NestJS en un telegrama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://t.me/nest_ru</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Informe en ruso sobre NestJS.</a> <br><br>  Y, por supuesto, suscríbase al canal en el telegrama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@ngFanatic</a> donde hay noticias sobre NestJS y Angular. <br><br>  PD: Esto es solo una parte de las capacidades de NestJS, sobre una experiencia personal de un año, habrá un artículo separado. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439434/">https://habr.com/ru/post/439434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439424/index.html">Cómo luché con el alojamiento gratuito y el compositor</a></li>
<li><a href="../439426/index.html">Situación: una nueva ola de ataques con la intercepción de consultas DNS: analizamos los métodos básicos de protección</a></li>
<li><a href="../439428/index.html">¿Cómo prevenir los ataques cibernéticos dirigidos? 10 mejores entornos limitados de red</a></li>
<li><a href="../439430/index.html">Créeme si puedes. Medidores de agua. parte 1</a></li>
<li><a href="../439432/index.html">Cómo convertirse en un desarrollador de Java en 1.5 años</a></li>
<li><a href="../439436/index.html">Reducción de costos de pequeñas series de productos electrónicos en Rusia. Estuche de radio por internet WOLNA</a></li>
<li><a href="../439440/index.html">Implemente Zimbra Collaboration Open Source, autorice a través de AD y cree automáticamente buzones</a></li>
<li><a href="../439442/index.html">Julia Generadores de informes y documentos</a></li>
<li><a href="../439446/index.html">Lo que necesita saber sobre JavaScript Engine Switcher 3.0</a></li>
<li><a href="../439448/index.html">¿Qué preguntas sobre virtualización espera una respuesta de un graduado?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>