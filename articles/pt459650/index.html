<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöµüèΩ üõ†Ô∏è üéê Como n√£o perder dinheiro na caixa preta: m√©todos de teste de cobran√ßa ü¶î üñ§ ‚úãüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A valida√ß√£o de servi√ßos pagos √© um dos principais problemas de engenharia no teste do Badoo. Nosso aplicativo √© integrado a 70 provedores de pagamento...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como n√£o perder dinheiro na caixa preta: m√©todos de teste de cobran√ßa</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/459650/">  A valida√ß√£o de servi√ßos pagos √© um dos principais problemas de engenharia no teste do Badoo.  Nosso aplicativo √© integrado a 70 provedores de pagamento em 250 pa√≠ses do mundo, e um bug em pelo menos um deles pode levar a conseq√º√™ncias imprevis√≠veis. <br><br>  Neste artigo, falarei sobre os m√©todos de teste que usamos no Badoo e os limites de aplicabilidade desses m√©todos - os est√°gios dos testes nos quais eles s√£o mais eficazes. <br><br>  Este artigo ser√° √∫til para testadores, desenvolvedores e gerentes de produto, cujos projetos j√° est√£o integrados aos provedores de pagamento ou o processo de integra√ß√£o est√° apenas come√ßando.  Se no seu trabalho voc√™ se deparar com o problema de escolher m√©todos de teste para essas integra√ß√µes, seja bem-vindo ao gato! <br><br><img src="https://habrastorage.org/webt/u0/dg/6k/u0dg6kdremnwjnqjqiabc_wq1m8.jpeg"><br><br><a name="habracut"></a><br>  <i>Meu nome √© Vladimir Solodov, sou engenheiro de controle de qualidade no Badoo: estou envolvido na verifica√ß√£o de integra√ß√µes de teste e processamento de pagamentos.</i>  <i>Meu colega Viktor Koronevich me ajudou na prepara√ß√£o do texto: juntamente com ele, fizemos uma reportagem na confer√™ncia Heisenbug ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√≠deo</a> ).</i>  <i>No artigo, expandimos a √°rea de descri√ß√£o para todas as integra√ß√µes com provedores de pagamento usados ‚Äã‚Äãno Badoo, classificamos e descrevemos a pr√°tica de remover depend√™ncias externas com mais detalhes.</i> <br><br>  Usando estudos de caso de neg√≥cios como exemplo, explicarei por que voc√™ deve prestar mais aten√ß√£o ao teste de servi√ßos pagos e como n√£o agravar problemas se eles surgirem.  Depois, descreveremos os problemas t√©cnicos da integra√ß√£o de testes e as formas de resolv√™-los. <br><br>  A segunda parte do artigo, na qual falamos mais sobre a automa√ß√£o de teste de servi√ßos pagos em aplicativos iOS, est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  Vamos l√°! <br><br><h2>  Detalhes do teste de faturamento </h2><br>  Normalmente, o objetivo de um neg√≥cio √© gerar renda.  No Badoo, uma rede social de namoro, a renda √© obtida por empr√©stimos e assinaturas premium.  Empr√©stimos s√£o a moeda interna do Badoo.  Com a ajuda deles, por exemplo, voc√™ pode aumentar seu perfil nos resultados da pesquisa em primeiro lugar, fazer um presente para outro usu√°rio e muito mais.  A assinatura premium √© v√°lida por um certo per√≠odo de tempo e oferece v√°rias op√ß√µes ao mesmo tempo: ativar o modo "invis√≠vel", ver pessoas que demonstraram interesse em voc√™, confirmar a autenticidade da sua conta e muito mais. <br><br>  Para que esses servi√ßos pagos funcionem, usamos integra√ß√µes com mais de 70 provedores de pagamento.  A escolha do provedor depende da plataforma, pa√≠s, dispositivo, operadora de celular e outros fatores.  Portanto, a quest√£o de testar servi√ßos pagos √© muito urgente. <br><br>  Para come√ßar, considere por que o teste de servi√ßos pagos deve ser abordado com aten√ß√£o especial.  Existem duas raz√µes. <br><br><h4>  1. Erros de cobran√ßa s√£o cr√≠ticos para os neg√≥cios. </h4><br>  O primeiro problema √© de reputa√ß√£o.  O usu√°rio que pagou pelo servi√ßo se torna mais sens√≠vel (e menos tolerante) a erros no aplicativo.  Qualquer coment√°rio no espa√ßo p√∫blico, seja uma revis√£o de um aplicativo de blog ou um coment√°rio na App Store ou no Google Play, de um usu√°rio que encontra um bug em um servi√ßo pago, ser√° mais emocional - esse √© um fator que leva √† perda de reputa√ß√£o. <br><br>  O segundo problema √© que, assim que voc√™ come√ßa a receber dinheiro de um usu√°rio por um servi√ßo, voc√™ se torna objeto de uma lei que protege o consumidor do servi√ßo.  E as perdas de reputa√ß√£o podem facilmente se transformar em financeiras. <br><br>  As empresas perdem dinheiro de tr√™s maneiras. <br><br>  A primeira maneira √© <b>restitui√ß√µes</b> .  Suponha que um usu√°rio descubra que voc√™ lhe vendeu um servi√ßo que n√£o atende exatamente √†s expectativas dele.  Nesse caso, ele entrar√° em contato com sua equipe de suporte.  Seus funcion√°rios conduzem uma investiga√ß√£o e descobrem que as expectativas do usu√°rio realmente n√£o se concretizaram devido a um bug no aplicativo.  Voc√™ inicia um reembolso.  Nesse caso, h√° um reembolso: como resultado, a empresa se depara com lucros perdidos e essa √© a maneira mais inofensiva de perder dinheiro. <br><br>  A segunda maneira s√£o os <b>estornos</b> .  Suponha que a mesma situa√ß√£o ocorreu, apenas o usu√°rio n√£o entrou em contato com o servi√ßo de suporte, mas o banco que emitiu o cart√£o ou o provedor de pagamento.  O banco / provedor inicia um reembolso.  Nesse caso, estamos lidando com um estorno.  O perigo para os neg√≥cios aqui n√£o est√° apenas nos lucros perdidos.  Ap√≥s um certo n√∫mero de estornos, a empresa recebe uma multa e sua classifica√ß√£o de risco diminui.  O rebaixamento, por sua vez, leva a um aumento no custo dos servi√ßos dos provedores de pagamento. <br><br>  A terceira via - <b>a√ß√µes judiciais (reivindica√ß√µes)</b> .  Nos casos mais negligenciados, a√ß√µes judiciais (inclusive coletivas) podem ocorrer, levando √†s conseq√º√™ncias mais graves.  Portanto, em 2015, ap√≥s uma a√ß√£o judicial do regulador da Ofgem, a British Gas foi for√ßada a pagar uma compensa√ß√£o multimilion√°ria aos usu√°rios que cobravam uma taxa mais alta devido a um erro no sistema de cobran√ßa.  Leia mais sobre isso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><h4>  2. Para testar integra√ß√µes, s√£o necess√°rios conhecimento e experi√™ncia. </h4><br>  As equipes que est√£o iniciando o processo de integra√ß√£o com os provedores de pagamento geralmente enfrentam esse problema.  Sem conhecer todos os casos de cobran√ßa poss√≠veis, eles perdem nuances importantes quando percebem a rea√ß√£o do sistema √†s notifica√ß√µes dos provedores de pagamento. <br><br>  Isso pode levar a consequ√™ncias imprevis√≠veis - de lucros perdidos a usu√°rios insatisfeitos. <br><br>  Vamos examinar o esquema que lista os tipos de servi√ßos pagos e considerar o problema com mais cuidado. <br><br><img src="https://habrastorage.org/webt/k0/qu/he/k0quhers6cgrorlijjpdjb8pex4.jpeg"><br>  <i><font color="gray">Figura 1. Poss√≠veis casos de cobran√ßa</font></i> <br><br>  Existem tr√™s casos principais: um erro, um pagamento bem-sucedido e um reembolso ao usu√°rio.  Mas cada caso tem detalhes, cada caso que seu sistema precisa lidar de maneira diferente. <br><br>  <b>Os erros</b> podem ser cr√≠ticos e n√£o cr√≠ticos.  O erro de notifica√ß√£o pode ser atribu√≠do ao bloqueio n√£o cr√≠tico - quando o provedor de pagamento informa sobre a falta de fundos na conta do usu√°rio e o bloqueio cr√≠tico do m√©todo de pagamento do usu√°rio.  E se, no primeiro caso, voc√™ pode tentar pagar mais tarde, no segundo - seria bom descobrir por que o m√©todo est√° bloqueado.  Talvez o usu√°rio tenha sido notado em fraude e voc√™ deva ter mais cuidado com as transa√ß√µes dele. <br><br>  <b>Reembolsos</b> .  Voc√™ j√° sabe que existem dois tipos de devolu√ß√µes: reembolsos e estornos.  Seu sistema deve responder de maneira diferente a eles.  Por exemplo, ap√≥s um estorno, faz sentido pensar em bloquear algumas fun√ß√µes do seu aplicativo para o usu√°rio, porque o estorno √© um dos m√©todos de fraude mais populares. <br><br>  <b>Um pagamento bem-sucedido</b> pode ser um <b>pagamento</b> √∫nico ou uma assinatura. <br><br>  Os pagamentos √∫nicos podem ser consum√≠veis e n√£o consum√≠veis.  Um exemplo de pagamento gasto que examinamos no in√≠cio do artigo - esses s√£o empr√©stimos no Badoo.  Um exemplo de pagamento n√£o dispens√°vel pode ser dado em jogos.  Suponha que voc√™ tenha um personagem que interpreta.  Voc√™ quer comprar para ele superpot√™ncias que j√° existem h√° algum tempo.  Nesse caso, a compra pertence √† classe de pagamentos n√£o dispens√°veis. <br><br>  <b>Assinaturas</b>  Aqui est√° a maior variedade de casos.  Al√©m da compra inicial de uma assinatura, voc√™ pode ter: <br><br><ul><li>  renova√ß√£o de uma assinatura (renovar); <br></li><li>  fechar assinatura (cancelar assinatura); <br></li><li>  assinatura de avalia√ß√£o (avalia√ß√£o); <br></li><li>  assinatura do per√≠odo de car√™ncia: quando n√£o podemos renovar a assinatura e tentar pagar novamente por um per√≠odo chamado per√≠odo de car√™ncia.  Para o usu√°rio, o per√≠odo de cortesia √© assim.  Suponha que voc√™ comprou uma assinatura mensal de jornal.  A empresa que envia jornais est√° tentando cancelar o pagamento para o pr√≥ximo m√™s de assinatura ap√≥s o final do primeiro m√™s, mas n√£o pode fazer isso (devido a um bloqueio do cart√£o, falta de fundos na conta etc.).  Se o per√≠odo de validade do per√≠odo de car√™ncia for de dez dias, durante esse per√≠odo, a empresa tentar√° cancelar o pagamento, enquanto a assinatura permanecer√° v√°lida.  Se a empresa n√£o puder amortizar o dinheiro, a assinatura ser√° cancelada.  Se for, a assinatura √© renovada a partir da data do √∫ltimo pagamento; <br></li><li>  pagamento parcial (faturamento parcial).  Por exemplo, o PayPal permite que voc√™ fa√ßa pagamentos parciais se a conta do usu√°rio n√£o tiver fundos suficientes (pagamento parcial) ou quebre o pagamento em partes (fatura parcial). <br></li></ul><br>  Voc√™ tamb√©m precisa levar em considera√ß√£o duas caracter√≠sticas totalmente dependentes do provedor de pagamento: a assinatura pode ser controlada pelo seu aplicativo ou gerenciada externamente. <br><br><ul><li>  Uma assinatura gerenciada internamente √©, por exemplo, uma assinatura usando cart√µes de cr√©dito ou PayPal, quando, ap√≥s o primeiro pagamento, voc√™ recebe um token com o qual se aplica novamente ao provedor, sem os detalhes de pagamento do usu√°rio. <br></li><li>  Uma assinatura gerenciada externamente √© quando o agregador de pagamento assume o controle total de suas assinaturas e simplesmente envia notifica√ß√µes sobre seus status atuais. <br></li></ul><br>  Na figura, as √°reas mais √≥bvias, cuja rea√ß√£o geralmente √© realizada em primeiro lugar, s√£o destacadas em roxo.  Todos os outros come√ßam a ser levados em considera√ß√£o muito mais tarde, como o ac√∫mulo de conhecimentos.  Isso √© amplamente facilitado pela aplica√ß√£o incorreta de metodologias de desenvolvimento iterativas no campo do faturamento. <br><br><img src="https://habrastorage.org/webt/7x/kf/bj/7xkfbjf-z3shfhzuftrl3p0tms4.jpeg"><br>  <i><font color="gray">Figura 2. Casos de cobran√ßa que s√£o implementados principalmente em sistemas</font></i> <br><br>  Essa implementa√ß√£o em fases pode levar a consequ√™ncias imprevis√≠veis.  Por exemplo, em um dos projetos em que trabalhei antes do Badoo, a possibilidade de fazer um reembolso n√£o foi levada em considera√ß√£o.  Como resultado, todos os retornos foram feitos n√£o atrav√©s de reembolsos, mas atrav√©s de estornos, que afetaram negativamente a classifica√ß√£o de risco da empresa e levaram a falhas na coleta de estat√≠sticas de renda.  A ignor√¢ncia de toda a variedade de casos de cobran√ßa pode levar √† perda de lucros ou √† vulnerabilidade da empresa aos usu√°rios que se sentem enganados. <br><br>  Portanto, por um lado, erros no processamento de pagamentos devem ser encontrados antes do lan√ßamento, pois podem levar √†s consequ√™ncias mais negativas.  Se n√£o foi poss√≠vel fazer isso, √© importante perceber rapidamente que o bug entrou na vers√£o de lan√ßamento do aplicativo, corrigi-lo e, o mais importante, o que muitas pessoas esquecem, "tranquilizar" os usu√°rios que encontrarem esse bug. <br><br>  Por outro lado, a situa√ß√£o √© complicada pelo fato de a integra√ß√£o com os provedores de pagamento sempre interagir com a caixa preta, o que adiciona muitas vari√°veis ‚Äã‚Äãao processo de teste. <br><br><h2>  Problemas t√©cnicos durante o teste de cobran√ßa </h2><br>  Vamos consider√°-los no exemplo de integra√ß√£o do Badoo com a App Store. <br><br>  As assinaturas na App Store pertencem √† classe de gerenciadas externamente, ou seja, s√£o totalmente gerenciadas pelo lado do provedor, e nosso sistema pode solicitar apenas o status atual ou receber uma notifica√ß√£o de sua altera√ß√£o. <br><br>  Escolhemos especificamente essa integra√ß√£o, pois √© a mais complexa e cont√©m toda a variedade de casos que podem ser encontrados no processo de integra√ß√£o do servi√ßo com outros provedores de pagamento. <br><br>  Para come√ßar, passamos a uma compra descart√°vel √∫nica. <br><br><img src="https://habrastorage.org/webt/ob/xi/rd/obxirdlzjhofj6uvioqwixp-r2k.png"><br>  <i><font color="gray">Figura 3. O processo de efetuar um pagamento descart√°vel √∫nico</font></i> <br><br>  Na etapa 1, o usu√°rio solicita a compra do servi√ßo.  O aplicativo decide que o pagamento deve ser feito e, na etapa 2, o controle √© transferido para o provedor de pagamento (App Store).  Etapa 3: o usu√°rio recebe um formul√°rio para efetuar um pagamento.  Etapa 4: o usu√°rio fornece dados para pagamento.  Etapa 5: o provedor conclui a transa√ß√£o e reporta o resultado ao aplicativo, retornando um recibo contendo informa√ß√µes completas sobre a compra (data, servi√ßo, status etc.).  Etapa 6: a verifica√ß√£o, complementada com os dados do usu√°rio, √© enviada ao servidor para processamento.  O servidor processa os dados de verifica√ß√£o e gera uma notifica√ß√£o por push para o aplicativo na s√©tima etapa.  Na oitava etapa, a notifica√ß√£o √© mostrada ao usu√°rio. <br><br>  O problema √© que as etapas 3, 4 e 5 s√£o executadas no lado do provedor de pagamento, praticamente n√£o s√£o controladas por n√≥s e podem ter v√°rias varia√ß√µes.  Portanto, o processo n√£o possui uma estrutura linear, como mostra a Figura 2, mas uma ramifica√ß√£o (veja a Figura 4), e cada ramifica√ß√£o deve ser tratada de maneira diferente pelo aplicativo. <br><br><img src="https://habrastorage.org/webt/8h/ur/mv/8hurmv5_d6mact7vy90jcdb9s_i.png"><br>  <i><font color="gray">Figura 4. Ramificando um diagrama de estado de pagamento √∫nico</font></i> <br><br>  A compra de assinaturas come√ßa da mesma maneira que um pagamento √∫nico, mas √© dif√≠cil controlar mais o processo. <br><br><img src="https://habrastorage.org/webt/lj/di/eb/ljdiebqce8tfo236xv8gir0jaa4.png"><br>  <i><font color="gray">Figura 5. Estados de assinatura gerenciados externamente</font></i> <br><br>  Deixe-me lembr√°-lo de que a assinatura da Apple, que consideramos como exemplo, √© gerenciada externamente.  Isso significa que o usu√°rio ap√≥s a compra pode gerenci√°-lo de forma ass√≠ncrona: feche, altere a data de validade, solicite um reembolso.  Vemos isso na etapa 9. Como a a√ß√£o ocorre fora do nosso sistema, na figura eu a marquei com uma linha pontilhada. <br><br>  Na etapa 10, a App Store pode alterar o status da assinatura: renove, feche, digite o per√≠odo de car√™ncia na janela. <br><br>  Para descobrir em que estado est√° a assinatura, h√° a etapa 11, que √© espec√≠fica para agregadores, como a App Store e a Google Wallet.  Nesta etapa, o sistema envia um token, que √© usado como um recibo recebido no in√≠cio da compra de uma assinatura ou ap√≥s sua renova√ß√£o anterior. <br><br>  Etapa 12 √© a resposta do provedor.  Recebemos um cheque com o status atual da assinatura.  O resultado nesta etapa depende das etapas ass√≠ncronas 9 e 10. <br><br>  No outono de 2018, a Apple para todos implementou um mecanismo de <b>notifica√ß√µes</b> de <b>servidor para servidor</b> , que permite notificar sobre as mudan√ßas que ocorreram com uma assinatura.  O recebimento dessa notifica√ß√£o √© mostrado na etapa 13. Para a maioria dos outros provedores, o mecanismo de notifica√ß√£o de servidor para servidor √© o √∫nico, portanto, pode-se argumentar que o exemplo da Apple abrange toda a variedade de casos.  No caso de outros provedores, a etapa 13 permite excluir as etapas 11 e 12 do esquema. <br><br>  Na etapa 14, o servidor gera uma resposta para o aplicativo alterar o status da assinatura. <br><br>  Assim, obtivemos um gr√°fico completo dos estados que devem ser passados ‚Äã‚Äãpara verificar os servi√ßos pagos. <br><br><img src="https://habrastorage.org/webt/tg/he/vx/tghevxtlppxvc9xuqt4wczbav0s.png"><br>  <i><font color="gray">Figura 6. O processo completo de altera√ß√£o dos estados de pagamento (usando uma assinatura gerenciada externamente como exemplo)</font></i> <br><br>  As partes que n√£o controlamos em nosso sistema s√£o coloridas em laranja e s√£o caixas pretas para n√≥s. <br><br><h2>  M√©todos de teste de cobran√ßa </h2><br>  Portanto, o principal problema t√©cnico ao testar servi√ßos pagos √© a presen√ßa de ‚Äúcaixas pretas‚Äù, cujos estados temos muito pouco controle.  Isso define um conjunto de m√©todos que podem cobrir toda a variedade de casos. <br><br>  N√£o existem muitos desses m√©todos, e os dividimos em tr√™s categorias: pagamentos reais, caixas de prote√ß√£o e elimina√ß√£o de depend√™ncias externas das "caixas pretas". <br><br><h3>  Pagamentos reais </h3><br>  Os pagamentos reais como m√©todo de teste s√£o bons, pois fornecem uma id√©ia clara do estado da integra√ß√£o.  Um erro ao efetuar um pagamento real √© uma evid√™ncia incondicional de um bug. <br><br>  Caso contr√°rio, os pagamentos reais s√£o ruins.  Em primeiro lugar, √© caro: √© √≥bvio que, para fazer um pagamento real, voc√™ precisa gastar dinheiro real.  Voc√™ se engana se pensa que, no final, todo o valor ser√° devolvido √† empresa: primeiro, os provedores cobram uma taxa por cada transa√ß√£o, cujo tamanho, conforme descrito acima, depende da classifica√ß√£o de risco da organiza√ß√£o e pode chegar a 40% (e at√© mais) ;  em segundo lugar, voc√™ pode perder dinheiro ao testar pagamentos em outros pa√≠ses devido ao spread da moeda - a diferen√ßa entre as taxas de compra e venda da moeda (voc√™ far√° a compra √† taxa de venda do banco em moeda estrangeira e o retorno ocorrer√° √† taxa de compra). <br><br>  Al√©m disso, esse m√©todo pode levar um longo tempo, pois √© necess√°rio aguardar o final do per√≠odo de renova√ß√£o da assinatura, a conclus√£o dos per√≠odos de car√™ncia e esses podem ser meses. <br><br><h3>  Sandboxes </h3><br>  Caixas de areia s√£o lindas.  Essa √©, de fato, a mesma funcionalidade que um provedor de pagamentos nos fornece no caso de um pagamento real, mas sem gastar dinheiro real.  √â totalmente suportado pelo provedor, o que significa que a integra√ß√£o com a sandbox √© barata. <br><br>  O problema da dura√ß√£o dos testes ao longo do tempo √© resolvido, em regra, usando v√°rios truques.  Por exemplo, a caixa de prote√ß√£o da App Store usa a seguinte convers√£o de expira√ß√£o de assinatura. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Assinatura em tempo real <br></td><td>  Hor√°rio de assinatura do Apple Sandbox <br></td></tr><tr><td>  1 semana <br></td><td>  3 minutos <br></td></tr><tr><td>  1 m√™s <br></td><td>  5 minutos <br></td></tr><tr><td>  2 meses <br></td><td>  10 minutos <br></td></tr><tr><td>  3 meses <br></td><td>  15 minutos <br></td></tr><tr><td>  6 meses <br></td><td>  30 minutos <br></td></tr><tr><td>  1 ano <br></td><td>  1 hora <br></td></tr></tbody></table></div>  <i><font color="gray">Tabela 1. A propor√ß√£o do per√≠odo de validade de uma assinatura real e uma assinatura na sandbox da Apple</font></i> <br><br>  As assinaturas padr√£o da sandbox da Google Wallet est√£o listadas na tabela 2 e podem ser configuradas no console do vendedor. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Assinatura em tempo real <br></td><td>  Hor√°rio da assinatura do Google Sandbox <br></td></tr><tr><td>  1 semana <br></td><td>  5 minutos <br></td></tr><tr><td>  1 m√™s <br></td><td>  5 minutos <br></td></tr><tr><td>  3 meses <br></td><td>  10 minutos <br></td></tr><tr><td>  6 meses <br></td><td>  15 minutos <br></td></tr><tr><td>  1 ano <br></td><td>  30 minutos <br></td></tr></tbody></table></div>  <i><font color="gray">Tabela 2. Configurando a dura√ß√£o de uma assinatura na sandbox do Google</font></i> <br><br>  Ao contr√°rio da sandbox da Apple, voc√™ tamb√©m pode verificar a avalia√ß√£o, per√≠odo de cortesia etc. na sandbox do Google, usando a propor√ß√£o da Tabela 3. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Assinatura em tempo real <br></td><td>  Hor√°rio da assinatura do Google Sandbox <br></td></tr><tr><td>  Per√≠odo experimental <br></td><td>  3 minutos <br></td></tr><tr><td>  Per√≠odo experimental (introdut√≥rio) <br></td><td>  Igual ao hor√°rio da assinatura correspondente <br></td></tr><tr><td>  Per√≠odo de car√™ncia (3/7 dias) <br></td><td>  5 minutos <br></td></tr><tr><td>  Bloqueio tempor√°rio da conta (em espera) <br></td><td>  10 minutos <br></td></tr><tr><td>  Pausa (1/2/3 meses) <br></td><td>  5/10/15 minutos (respectivamente) <br></td></tr></tbody></table></div>  <i><font color="gray">Tabela 3. Validade de recursos adicionais de assinatura na sandbox do Google</font></i> <br><br>  O fechamento de uma assinatura tamb√©m pode ser implementado de diferentes maneiras: na caixa de prote√ß√£o da App Store, o fechamento √© feito ap√≥s a quinta renova√ß√£o e, na Google Wallet, no console do vendedor ou no dispositivo da Play Store. <br><br>  O problema das sandboxes √© que os fornecedores t√™m uma atitude diferente em rela√ß√£o √† sua qualidade.  Nossa experi√™ncia mostra que dos mais de 70 provedores de pagamento integrados ao Badoo, apenas duas caixas de prote√ß√£o possuem funcionalidade completa e opera√ß√£o est√°vel.  Essas s√£o as caixas de areia do Adyen e do PayPal.  Outros provedores s√£o est√°veis, mas truncados em termos de caixas de prote√ß√£o de funcionalidade (como Google Wallet) ou inst√°veis ‚Äã‚Äãe extremamente truncados em funcionalidade (como App Store e Fortumo).  E existem provedores que n√£o possuem e nem ter√£o uma caixa de areia. <br><br><img src="https://habrastorage.org/webt/iz/as/im/izasimha0d95e0w214ym9kyfhcy.png"><br>  <i><font color="gray">Figura 7. Classifica√ß√£o de sandboxes por estabilidade e funcionalidade</font></i> <br><br><h3>  Removendo depend√™ncias externas </h3><br>  Se convencemos voc√™ de que o teste usando pagamentos reais √© caro e ineficiente, e os provedores de pagamento n√£o fornecem caixas de prote√ß√£o com qualidade adequada, resta ainda recorrer a v√°rias maneiras de eliminar depend√™ncias externas.  Existem apenas tr√™s deles: moki, falsifica√ß√µes e tocos. <br><br>  Moki no faturamento √© a forma√ß√£o das rea√ß√µes do seu sistema a solicita√ß√µes com par√¢metros pr√©-determinados, sem uma chamada real para o provedor de pagamento (veja a Fig. 8).  Por exemplo, uma solicita√ß√£o para um provedor de pagamento SMS para o n√∫mero + 7111-111-11-11 √© interceptada no est√°gio de envio de uma solicita√ß√£o ao provedor e gera uma resposta do sistema na forma de um pagamento bem-sucedido.  A solicita√ß√£o para o n√∫mero + 7111-111-11-12 tamb√©m √© interceptada, mas leva a uma rea√ß√£o a um erro com o c√≥digo "N√£o h√° dinheiro suficiente para concluir a transa√ß√£o". <br><br><img width="340" src="https://habrastorage.org/webt/cb/zi/xy/cbzixy8v5c16-fjdnobzksxoij4.png"><br>  <i><font color="gray">Figura 8. Diagrama de simula√ß√£o</font></i> <br><br>  Falhas na cobran√ßa s√£o falsas nas notifica√ß√µes (como se fossem de um provedor real) (veja a Fig. 9).  A integra√ß√£o com cada provedor implica um conjunto limitado de rea√ß√µes do sistema a um conjunto limitado de tipos de notifica√ß√µes ou redefini√ß√µes.             (      ),          . <br><br><img width="340" src="https://habrastorage.org/webt/t5/nz/_h/t5nz_hwuq-49im9ow_csqennjh4.png"><br> <i><font color="gray"> 9.  </font></i> <br><br>    ‚Äî               (. . 10),                        . <br><br><img width="340" src="https://habrastorage.org/webt/-z/3p/f8/-z3pf8attjz-fiitaqbanlhmbbe.png"><br> <i><font color="gray"> 10.  </font></i> <br><br>          ,      ,                     .      (, , )      .  ,      , ,             ,   . <br><br>      .  3, 4, 5    :    ,      .             -   :          ,    ‚Äî   ,    ‚Äî  .     ¬´  ¬ª. <br><br><img src="https://habrastorage.org/webt/2p/cu/w-/2pcuw-rvhju4ngyzr3ez7rqlhco.png"><br> <i><font color="gray"> 11.            (     App Store)</font></i> <br><br>   ,       (,      ).   ‚Äî      ,     .       . ,   ,           ,            .    ,          . ,              . <br><br><h2>     </h2><br>      .   ,          ?        : <br><br><ul><li>    ‚Äî          ? <br></li><li>   end-to-end ‚Äî    :             -  ? <br></li><li>  ‚Äî   :     ,        . <br></li></ul><br>      . <br><br><img src="https://habrastorage.org/webt/ck/sn/re/cksnrehqrplo3q14juwsyrar31m.png"><br> <i><font color="gray"> 4.     </font></i> <br><br> <b> .</b>    .     .     ,      .   :     ,   . <br><br> <b>.</b> , ,  Apple  Google, .        (   ).      end-to-end :           .  , ,   . <br><br> <b>, , </b> ‚Äî   .      .            .  :         . <br><br><h2>    </h2><br>    ,       ,     . <br><br>      ,        .         . <br><br>      :     .  ,     , ‚Äî            . <br><br>         ,    :     ‚Äî , , ;     ‚Äî    :    . <br><br><img src="https://habrastorage.org/webt/hc/rg/ka/hcrgka-jxqtj6rftvexttwrlvqw.jpeg"><br> <i><font color="gray"> 12.        </font></i> <br><br><h2>     </h2><br>   ,  ,       ,      ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> . <br><br>      ,      12,      Badoo. <br><br><h4>     </h4><br>          .       .    QA-      .   ,    . ,  -   ,              ,   .   ,         . <br><br>  :      . <br><br><h4>      </h4><br>  ,      , ‚Äî     . ,    Apple      .         .   ,     .       :            -  . <br><br>   ‚Äî ,   . -,       . -,    ,  -,   ,          . <br><br>      ‚Äî    :                    ,   Apple   .       1  ‚Äî ,         . <br><br><h4>      </h4><br>            .          ,       .        ,     -    . <br><br>          ,             (       ). <br><br><h2>  Conclus√µes </h2><br><ol><li>      ,          . <br></li><li>       (     )         .           ,          . <br></li><li>     ¬´ ¬ª  ,     .     -         ‚Äî     .     ,  : ,    ‚Äî  ,     ‚Äî     . <br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao usar falsifica√ß√µes, mokas e stubs, √© importante lembrar que esses s√£o modelos de pagamento real e, como qualquer modelo, eles t√™m um grau de aproxima√ß√£o √† realidade e aos riscos. </font><font style="vertical-align: inherit;">Esses riscos devem ser avaliados e cobertos por pagamentos reais ou por verifica√ß√µes adicionais.</font></font><br></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre como conseguimos obter uma automa√ß√£o est√°vel e barata de testar servi√ßos pagos em um aplicativo iOS, falaremos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no pr√≥ximo artigo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obrigado pela aten√ß√£o! </font><font style="vertical-align: inherit;">Todos os grandes lucros e menos bugs!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt459650/">https://habr.com/ru/post/pt459650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt459638/index.html">Criando uma base global de conhecimento sobre baterias</a></li>
<li><a href="../pt459640/index.html">Documentos como c√≥digo. Parte 1: automatize a atualiza√ß√£o</a></li>
<li><a href="../pt459642/index.html">Acesso seguro para registrar campos em C ++ sem sacrificar a efici√™ncia (usando o CortexM como exemplo)</a></li>
<li><a href="../pt459644/index.html">Dimmers LED</a></li>
<li><a href="../pt459648/index.html">Tudo deve estar bem no analisador: funcionalidade e interface ... Estamos explorando a nova interface Solar appScreener 3.1</a></li>
<li><a href="../pt459652/index.html">Abordagem de teste de regress√£o automatizada</a></li>
<li><a href="../pt459656/index.html">Servi√ßo OData sem escrever c√≥digo</a></li>
<li><a href="../pt459658/index.html">O PVS-Studio queria, mas n√£o conseguiu encontrar erros no robots.txt</a></li>
<li><a href="../pt459662/index.html">O PVS-Studio queria, mas n√£o conseguiu encontrar erros no robots.txt</a></li>
<li><a href="../pt459668/index.html">Como reconhecer texto de uma foto: novos recursos da estrutura Vision</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>