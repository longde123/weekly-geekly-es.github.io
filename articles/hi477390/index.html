<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЖЧ ЁЯУМ ЁЯСЖЁЯП╝ рдбрд┐рдмрдЧрд┐рдВрдЧ рдиреЗрдЯрд╡рд░реНрдХ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдореЗрдВ рджреЗрд░реА рдХрд░рддрд╛ рд╣реИ ЁЯСитАНЁЯН│ ЁЯЙР ЁЯСРЁЯП┐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдХреБрдЫ рд╕рд╛рд▓ рдкрд╣рд▓реЗ, рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреА рдЪрд░реНрдЪрд╛ рдкрд╣рд▓реЗ рд╣реА рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдЧреАрдерд╣рдм рдмреНрд▓реЙрдЧ рдкрд░ рдХреА рдЧрдИ рдереАред рддрдм рд╕реЗ, рдпрд╣ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рддрдХрдиреАрдХ рдмрди рдЧрдпрд╛ рд╣реИред рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдЕрдм ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдбрд┐рдмрдЧрд┐рдВрдЧ рдиреЗрдЯрд╡рд░реНрдХ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдореЗрдВ рджреЗрд░реА рдХрд░рддрд╛ рд╣реИ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/477390/"><img src="https://habrastorage.org/getpro/habr/post_images/c82/5b1/413/c825b1413d9c59cf78c51e6e2c8f8049.png"><br><br>  рдХреБрдЫ рд╕рд╛рд▓ рдкрд╣рд▓реЗ, рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреА <a href="https://github.blog/2017-08-16-kubernetes-at-github/">рдЪрд░реНрдЪрд╛ рдкрд╣рд▓реЗ рд╣реА</a> рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдЧреАрдерд╣рдм рдмреНрд▓реЙрдЧ рдкрд░ рдХреА <a href="https://github.blog/2017-08-16-kubernetes-at-github/">рдЧрдИ</a> рдереАред  рддрдм рд╕реЗ, рдпрд╣ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рддрдХрдиреАрдХ рдмрди рдЧрдпрд╛ рд╣реИред  рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдЕрдм рдЖрдВрддрд░рд┐рдХ рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣рд┐рд╕реНрд╕реЗ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИред  рдЬреИрд╕реЗ-рдЬреИрд╕реЗ рд╣рдорд╛рд░реЗ рдХреНрд▓рд╕реНрдЯрд░ рдмрдврд╝рддреЗ рдЧрдП рдФрд░ рдкреНрд░рджрд░реНрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ рдФрд░ рдЕрдзрд┐рдХ рд╕рдЦреНрдд рд╣реЛрддреА рдЧрдИрдВ, рд╣рдордиреЗ рдзреНрдпрд╛рди рджреЗрдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ рдХрд┐ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдкрд░ рдХреБрдЫ рд╕реЗрд╡рд╛рдПрдВ рдЫрд┐рдЯрдкреБрдЯ рд░реВрдк рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрддреА рд╣реИрдВ, рдЬреЛ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рднрд╛рд░ рд╕реЗ рдирд╣реАрдВ рдмрддрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред <br><br>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ, 100 рдПрдордПрд╕ рдпрд╛ рдЕрдзрд┐рдХ рддрдХ рдХрд╛ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рд╡рд┐рд▓рдВрдм рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдЯрд╛рдЗрдордЖрдЙрдЯ рдпрд╛ рд░рд┐рдЯреНрд░реАрдЯ рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рдЙрдореНрдореАрдж рдХреА рдЧрдИ рдереА рдХрд┐ рд╕реЗрд╡рд╛рдПрдВ 100 рдПрдордПрд╕ рд╕реЗ рдЕрдзрд┐рдХ рддреЗрдЬреА рд╕реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдЬрд╡рд╛рдм рджреЗрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреАред  рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ рдпрджрд┐ рдХрдиреЗрдХреНрд╢рди рдЦреБрдж рдХреЛ рдЗрддрдирд╛ рд╕рдордп рд▓реЗрддрд╛ рд╣реИред  рдЕрд▓рдЧ-рдЕрд▓рдЧ, рд╣рдордиреЗ рдмрд╣реБрдд рддреЗрдЬреА рд╕реЗ MySQL рдкреНрд░рд╢реНрдиреЛрдВ рдХрд╛ рдЕрд╡рд▓реЛрдХрди рдХрд┐рдпрд╛, рдЬреЛ рдХрд┐ рдорд┐рд▓реАрд╕реЗрдХрдВрдб рд▓реЗрдиреЗ рд╡рд╛рд▓реЗ рдереЗ, рдФрд░ MySQL рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдорд┐рд▓реАрд╕реЗрдХрдВрдб рдореЗрдВ рдХрд╛рдордпрд╛рдм рд░рд╣рд╛, рд▓реЗрдХрд┐рди рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЖрд╡реЗрджрди рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ 100 рдПрдордПрд╕ рдпрд╛ рдЕрдзрд┐рдХ рд▓рд┐рдпрд╛ рдЧрдпрд╛ред <br><a name="habracut"></a><br>  рдпрд╣ рддреБрд░рдВрдд рд╕реНрдкрд╖реНрдЯ рд╣реЛ рдЧрдпрд╛ рдХрд┐ рд╕рдорд╕реНрдпрд╛ рдХреЗрд╡рд▓ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╣реЛрд╕реНрдЯ рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрдиреЗ рдкрд░ рд╣реЛрддреА рд╣реИ, рднрд▓реЗ рд╣реА рдХреЙрд▓ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ рдмрд╛рд╣рд░ рд╕реЗ рдЖрдпрд╛ рд╣реЛред  рд╕рдорд╕реНрдпрд╛ рдХрд╛ рдкреБрдирд░реБрддреНрдкрд╛рджрди рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ рд╡реЗрдЬрд╛ рдЯреЗрд╕реНрдЯ, рдЬреЛ рдХрд┐рд╕реА рднреА рдЖрдВрддрд░рд┐рдХ рдореЗрдЬрдмрд╛рди рд╕реЗ рдЪрд▓рддрд╛ рд╣реИ, рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреЛрд░реНрдЯ рдкрд░ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╕реЗрд╡рд╛ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЫрд┐рдЯрдкреБрдЯ рд░реВрдк рд╕реЗ рдПрдХ рдмрдбрд╝реА рджреЗрд░реА рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░рддрд╛ рд╣реИред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рд╣рдо рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЗ рдХрд╛рд░рдг рдХреЛ рдХреИрд╕реЗ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдореЗрдВ рдХрд╛рдордпрд╛рдм рд░рд╣реЗред <br><br><h1>  рд╡рд┐рдлрд▓рддрд╛ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рдЕрдирд╛рд╡рд╢реНрдпрдХ рдЬрдЯрд┐рд▓рддрд╛ рдХреЛ рд╣рдЯрд╛ рджреЗрдВ </h1><br>  рдЙрд╕реА рдЙрджрд╛рд╣рд░рдг рдХреЛ рдкреБрди: рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рд╕рдорд╕реНрдпрд╛ рдХреЗ рдлреЛрдХрд╕ рдХреЛ рдХрдо рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рдереЗ рдФрд░ рдЬрдЯрд┐рд▓рддрд╛ рдХреА рдЕрддрд┐рд░рд┐рдХреНрдд рдкрд░рддреЛрдВ рдХреЛ рд╣рдЯрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рдереЗред  рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдкрд░ рд╕рдмреНрдЬрд┐рдпреЛрдВ рдФрд░ рдлрд▓реА рдХреЗ рдмреАрдЪ рдХреА рдзрд╛рд░рд╛ рдореЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реЗ рддрддреНрд╡ рдереЗред  рдПрдХ рдЧрд╣рд░реА рдиреЗрдЯрд╡рд░реНрдХ рд╕рдорд╕реНрдпрд╛ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдХреЛ рдмрд╛рд╣рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><img src="https://habrastorage.org/getpro/habr/post_images/488/8c1/d29/4888c1d29a8fc1b4a1194c4c3a14c9ff.png"><br><br>  рдХреНрд▓рд╛рдЗрдВрдЯ (рд╕рдмреНрдЬрд┐рдпреЛрдВ) рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдХрд┐рд╕реА рднреА рдиреЛрдб рдХреЗ рд╕рд╛рде рдПрдХ рдЯреАрд╕реАрдкреА рдХрдиреЗрдХреНрд╢рди рдмрдирд╛рддрд╛ рд╣реИред  рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдПрдХ рдУрд╡рд░рд▓реЗ рдиреЗрдЯрд╡рд░реНрдХ (рдореМрдЬреВрджрд╛ рдбреЗрдЯрд╛ рд╕реЗрдВрдЯрд░ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░) рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рдЬреЛ <a href="https://en.wikipedia.org/wiki/IP_in_IP">рдЖрдИрдкреАрдЖрдИрдкреА</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, <a href="https://en.wikipedia.org/wiki/IP_in_IP">рдЕрд░реНрдерд╛рдд</a> , рдбреЗрдЯрд╛ рдХреЗрдВрджреНрд░ рдХреЗ рдЖрдИрдкреА рдкреИрдХреЗрдЯ рдХреЗ рдЕрдВрджрд░ рдУрд╡рд░рд▓реЗ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЖрдИрдкреА рдкреИрдХреЗрдЯ рдХреЛ <a href="https://en.wikipedia.org/wiki/IP_in_IP">рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ</a> рдХрд░рддрд╛ рд╣реИред  рдЬрдм рдкрд╣рд▓реЗ рдиреЛрдб рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ <a href="https://en.wikipedia.org/wiki/Network_address_translation">рдиреЗрдЯрд╡рд░реНрдХ рдПрдбреНрд░реЗрд╕ рдЯреНрд░рд╛рдВрд╕рд▓реЗрд╢рди</a> (NAT) <a href="https://en.wikipedia.org/wiki/Network_address_translation">рдиреЗрдЯрд╡рд░реНрдХ рдПрдбреНрд░реЗрд╕ рдЯреНрд░рд╛рдВрд╕рд▓реЗрд╢рди</a> рдХреЛ IP рдореЙрдирд┐рдЯрд░ рдФрд░ рдЖрдИрдкреА рдПрдбреНрд░реЗрд╕ рдХреЗ рдкреЛрд░реНрдЯ рдХреЛ IP рдПрдбреНрд░реЗрд╕ рдФрд░ рдкреЛрд░реНрдЯ рдХреЛ рдУрд╡рд░рд▓реЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдкреЛрд░реНрдЯ (рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде рдкреЙрдб) рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдЯреЗрдЯ рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдкреНрд░рд╛рдкреНрдд рдкреИрдХреЗрдЯреЛрдВ рдХреЗ рд▓рд┐рдП, рд░рд┐рд╡рд░реНрд╕ рдЕрдиреБрдХреНрд░рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рдХрдИ рд░рд╛рдЬреНрдпреЛрдВ рдФрд░ рдХрдИ рддрддреНрд╡реЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдЬрдЯрд┐рд▓ рдкреНрд░рдгрд╛рд▓реА рд╣реИ рдЬрд┐рд╕реЗ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рддреИрдирд╛рдд рдФрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд░реВрдк рдореЗрдВ рд▓рдЧрд╛рддрд╛рд░ рдЕрджреНрдпрддрди рдФрд░ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рд╕рдмреНрдЬрд┐рдпреЛрдВ рдХреЗ рдкрд░реАрдХреНрд╖рдг рдореЗрдВ <code>tcpdump</code> рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдЯреАрд╕реАрдкреА рд╣реИрдВрдбрд╢реЗрдХ (SYN рдФрд░ SYN-ACK рдХреЗ рдмреАрдЪ) рдХреЗ рджреМрд░рд╛рди рджреЗрд░реА рдХрд░рддреА рд╣реИред  рдЗрд╕ рдЕрдирд╛рд╡рд╢реНрдпрдХ рдЬрдЯрд┐рд▓рддрд╛ рдХреЛ рджреВрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк SYN рд╕рдВрдХреБрд▓ рдХреЗ рд╕рд╛рде рд╕рд░рд▓ "рдкрд┐рдВрдЧреНрд╕" рдХреЗ рд▓рд┐рдП <code>hping3</code> рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдХрд┐ рдХреНрдпрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреИрдХреЗрдЯ рдореЗрдВ рджреЗрд░реА рд╣реИ, рдФрд░ рдлрд┐рд░ рдХрдиреЗрдХреНрд╢рди рд░реАрд╕реЗрдЯ рдХрд░реЗрдВред  рд╣рдо 100 рдПрдордмреА рд╕реЗ рдЕрдзрд┐рдХ рдХреЗрд╡рд▓ рдкреИрдХреЗрдЯ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╕рдмреНрдЬрд┐рдпреЛрдВ рдореЗрдВ рдкреВрд░реНрдг рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрддрд░ 7 рдкрд░реАрдХреНрд╖рдг рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдкреБрди: рдкреЗрд╢ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рд╕рд░рд▓ рд╡рд┐рдХрд▓реНрдк рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╕рдмрд╕реЗ рдзреАрдореА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд┐рдП рдЧрдП 10 рдПрдордПрд╕ рдХреЗ рдЕрдВрддрд░рд╛рд▓ рдХреЗ рд╕рд╛рде рд╕реЗрд╡рд╛ (30927) рдХреЗ рдореЗрдЬрдмрд╛рди "рдкреЛрд░реНрдЯ" рдкрд░ рдЯреАрд╕реАрдкреА SYN / SYN-ACK рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдореЗрдЬрдмрд╛рди рдХреЗ "рдкрд┐рдВрдЧ" рд╣реИрдВ: <br><br> <code>theojulienne@shell ~ $ sudo hping3 172.16.47.27 -S -p 30927 -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=1485 win=29200 rtt=127.1 ms <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=1486 win=29200 rtt=117.0 ms <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=1487 win=29200 rtt=106.2 ms <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=1488 win=29200 rtt=104.1 ms <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=5024 win=29200 rtt=109.2 ms <br> <br> len=46 ip=172.16.47.27 ttl=59 DF id=0 sport=30927 flags=SA seq=5231 win=29200 rtt=109.2 ms</code> <br> <br>  рддреБрд░рдВрдд рдкрд╣рд▓рд╛ рдЕрд╡рд▓реЛрдХрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╕реАрд░рд┐рдпрд▓ рдирдВрдмрд░ рдФрд░ рд╕рдордп рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдпреЗ рдПрдХ рдмрд╛рд░ рдХреА рднреАрдбрд╝ рдирд╣реАрдВ рд╣реИрдВред  рджреЗрд░реА рдЕрдХреНрд╕рд░ рдЬрдорд╛ рд╣реЛрддреА рд╣реИ, рдФрд░ рдЕрдВрддрддрдГ рд╕рдВрд╕рд╛рдзрд┐рдд рд╣реЛрддреА рд╣реИред <br><br>  рдЕрдЧрд▓рд╛, рд╣рдо рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕реЗ рдШрдЯрдХ рднреАрдбрд╝ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рд╢рд╛рдпрдж рдпреЗ NAT рдореЗрдВ рд╕реИрдХрдбрд╝реЛрдВ iptables рдирд┐рдпрдореЛрдВ рдореЗрдВ рд╕реЗ рдХреБрдЫ рд╣реИрдВ?  рдпрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдЖрдИрдкреАрдЖрдИрдкреА рдЯрдирд▓рд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдХреБрдЫ рд╕рдорд╕реНрдпрд╛рдПрдВ?  рдЗрд╕реЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рдг рдХреЛ рдЫреЛрдбрд╝рдХрд░ рдЗрд╕реЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдирд╛ рд╣реИред  рдпрджрд┐ рдЖрдк NAT рдФрд░ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рд▓реЙрдЬрд┐рдХ рдХреЛ рд╣рдЯрд╛рддреЗ рд╣реИрдВ, рддреЛ IPIP рдХрд╛ рдХреЗрд╡рд▓ рдПрдХ рднрд╛рдЧ рдЫреЛрдбрд╝рдХрд░ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b3/e2a/cff/5b3e2acff2ef9f1f8c7c527356741d92.png"><br><br>  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдпрджрд┐ рдорд╢реАрди рдПрдХ рд╣реА рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рд╣реИ, рддреЛ рд▓рд┐рдирдХреНрд╕ рд╕реАрдзреЗ рдЖрдИрдкреА рдУрд╡рд░рд▓реЗ рдкрд░рдд рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рдЖрд╕рд╛рди рдмрдирд╛рддрд╛ рд╣реИ: <br><br> <code>theojulienne@kube-node-client ~ $ sudo hping3 10.125.20.64 -S -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> <br> len=40 ip=10.125.20.64 ttl=64 DF id=0 sport=0 flags=RA seq=7346 win=0 rtt=127.3 ms <br> <br> len=40 ip=10.125.20.64 ttl=64 DF id=0 sport=0 flags=RA seq=7347 win=0 rtt=117.3 ms <br> <br> len=40 ip=10.125.20.64 ttl=64 DF id=0 sport=0 flags=RA seq=7348 win=0 rtt=107.2 ms</code> <br> <br>  рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рд╕рдорд╕реНрдпрд╛ рдЕрднреА рднреА рдмрдиреА рд╣реБрдИ рд╣реИ!  рдпрд╣ iptables рдФрд░ NAT рдХреЛ рдмрд╛рд╣рд░ рдХрд░рддрд╛ рд╣реИред  рддреЛ рд╕рдорд╕реНрдпрд╛ рдЯреАрд╕реАрдкреА рдореЗрдВ рд╣реИ?  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ ICMP рдкрд┐рдВрдЧ рдХрд┐рддрдирд╛ рдирд┐рдпрдорд┐рдд рдЬрд╛рддрд╛ рд╣реИ: <br><br> <code>theojulienne@kube-node-client ~ $ sudo hping3 10.125.20.64 --icmp -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> <br> len=28 ip=10.125.20.64 ttl=64 id=42594 icmp_seq=104 rtt=110.0 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=49448 icmp_seq=4022 rtt=141.3 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=49449 icmp_seq=4023 rtt=131.3 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=49450 icmp_seq=4024 rtt=121.2 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=49451 icmp_seq=4025 rtt=111.2 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=49452 icmp_seq=4026 rtt=101.1 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=50023 icmp_seq=4343 rtt=126.8 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=50024 icmp_seq=4344 rtt=116.8 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=50025 icmp_seq=4345 rtt=106.8 ms <br> <br> len=28 ip=10.125.20.64 ttl=64 id=59727 icmp_seq=9836 rtt=106.1 ms</code> <br> <br>  рдкрд░рд┐рдгрд╛рдо рдмрддрд╛рддреЗ рд╣реИрдВ рдХрд┐ рд╕рдорд╕реНрдпрд╛ рдЧрд╛рдпрдм рдирд╣реАрдВ рд╣реБрдИ рд╣реИред  рд╢рд╛рдпрдж рдпрд╣ рдПрдХ рдЖрдИрдкреАрдЖрдИрдкреА рд╕реБрд░рдВрдЧ рд╣реИ?  рдЖрдЗрдП рдкрд░реАрдХреНрд╖рдг рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдПрдВ: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/267/ff6/137/267ff613754b99f8cc1bb1d89119206e.png"><br><br>  рдХреНрдпрд╛ рд╕рднреА рдкреИрдХреЗрдЯ рдЗрди рджреЛрдиреЛрдВ рдореЗрдЬрдмрд╛рдиреЛрдВ рдХреЗ рдмреАрдЪ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ? <br><br> <code>theojulienne@kube-node-client ~ $ sudo hping3 172.16.47.27 --icmp -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> <br> len=46 ip=172.16.47.27 ttl=61 id=41127 icmp_seq=12564 rtt=140.9 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=41128 icmp_seq=12565 rtt=130.9 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=41129 icmp_seq=12566 rtt=120.8 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=41130 icmp_seq=12567 rtt=110.8 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=41131 icmp_seq=12568 rtt=100.7 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=9062 icmp_seq=31443 rtt=134.2 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=9063 icmp_seq=31444 rtt=124.2 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=9064 icmp_seq=31445 rtt=114.2 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 id=9065 icmp_seq=31446 rtt=104.2 ms</code> <br> <br>  рд╣рдордиреЗ рджреЛ рдХреБрдмреЗрд░рдиреЗрдЯ рдореЗрдЬрдмрд╛рдиреЛрдВ рдХреЛ рдПрдХ-рджреВрд╕рд░реЗ рдХреЛ рдкреИрдХреЗрдЯ рднреЗрдЬрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдпрд╛, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЖрдИрд╕реАрдПрдордкреА рдкрд┐рдВрдЧ рднреАред  рдпрджрд┐ рд▓рдХреНрд╖реНрдп рд╣реЛрд╕реНрдЯ "рдЦрд░рд╛рдм" (рджреВрд╕рд░реЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХреБрдЫ рдЦрд░рд╛рдм) рд╣реИ, рддреЛ рднреА рдЙрдиреНрд╣реЗрдВ рджреЗрд░реА рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИред <br><br>  рдЕрдм рдЖрдЦрд┐рд░реА рд╕рд╡рд╛рд▓: рдХреНрдпреВрдм-рдиреЛрдб рд╕рд░реНрд╡рд░ рдкрд░ рдХреЗрд╡рд▓ рджреЗрд░реА рдХреНрдпреЛрдВ рд╣реЛрддреА рд╣реИ?  рдФрд░ рдХреНрдпрд╛ рдпрд╣ рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдХреНрдпреВрдм-рдиреЛрдб рдкреНрд░реЗрд╖рдХ рдпрд╛ рд░рд┐рд╕реАрд╡рд░ рд╣реИ?  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ рдмрд╛рд╣рд░ рдПрдХ рдореЗрдЬрдмрд╛рди рд╕реЗ рдПрдХ рдкреИрдХреЗрдЯ рднреЗрдЬрдХрд░ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рдЙрд╕реА "рдЬреНрдЮрд╛рдд рдЦрд░рд╛рдм" рдкреНрд░рд╛рдкреНрддрдХрд░реНрддрд╛ рдХреЗ рд╕рд╛рдеред  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рдорд╕реНрдпрд╛ рдЧрд╛рдпрдм рдирд╣реАрдВ рд╣реБрдИ рд╣реИ: <br><br> <code>theojulienne@shell ~ $ sudo hping3 172.16.47.27 -p 9876 -S -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> <br> len=46 ip=172.16.47.27 ttl=61 DF id=0 sport=9876 flags=RA seq=312 win=0 rtt=108.5 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 DF id=0 sport=9876 flags=RA seq=5903 win=0 rtt=119.4 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 DF id=0 sport=9876 flags=RA seq=6227 win=0 rtt=139.9 ms <br> <br> len=46 ip=172.16.47.27 ttl=61 DF id=0 sport=9876 flags=RA seq=7929 win=0 rtt=131.2 ms</code> <br> <br>  рддрдм рд╣рдо рдкрд┐рдЫрд▓реЗ рд╕реНрд░реЛрдд рдХреЗ рдХреНрдпреВрдм-рдиреЛрдб рд╕реЗ рдмрд╛рд╣рд░реА рд╣реЛрд╕реНрдЯ (рдЬреЛ рдореВрд▓ рд╣реЛрд╕реНрдЯ рдХреЛ рдмрд╛рд╣рд░ рдХрд░рддрд╛ рд╣реИ, рдХреЗ рдмрд╛рдж рд╕реЗ рдПрдХ рд╣реА рдЕрдиреБрд░реЛрдз рдХрд░рддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдкрд┐рдВрдЧ рдореЗрдВ RX рдФрд░ TX рджреЛрдиреЛрдВ рдШрдЯрдХ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ): <br><br> <code>theojulienne@kube-node-client ~ $ sudo hping3 172.16.33.44 -p 9876 -S -i u10000 | egrep --line-buffered 'rtt=[0-9]{3}\.' <br> ^C <br> --- 172.16.33.44 hping statistic --- <br> 22352 packets transmitted, 22350 packets received, 1% packet loss <br> round-trip min/avg/max = 0.2/7.6/1010.6 ms</code> <br> <br>  рд╡рд┐рд▓рдВрдмрд┐рдд рдкреИрдХреЗрдЯ рдХреИрдкреНрдЪрд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдХреБрдЫ рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реАред  рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдХрд┐ рдкреНрд░реЗрд╖рдХ (рдиреАрдЪреЗ) рдЗрд╕ рдЯрд╛рдЗрдордЖрдЙрдЯ рдХреЛ рджреЗрдЦрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд░рд┐рд╕реАрд╡рд░ (рдКрдкрд░) рдЗрд╕реЗ рдирд╣реАрдВ рджреЗрдЦрддрд╛ рд╣реИ - рдбреЗрд▓реНрдЯрд╛ рдХреЙрд▓рдо (рд╕реЗрдХрдВрдб рдореЗрдВ) рджреЗрдЦреЗрдВ: <br><br> <a href=""><img src="https://habrastorage.org/webt/4m/-t/dj/4m-tdjzws9lrhnva3xcxijel7eg.png"></a> <br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрдк рдкреНрд░рд╛рдкреНрддрдХрд░реНрддрд╛ рдХреА рдУрд░ рд╕реЗ рдЯреАрд╕реАрдкреА рдФрд░ рдЖрдИрд╕реАрдПрдордкреА рдкреИрдХреЗрдЯ (рдЕрдиреБрдХреНрд░рдо рд╕рдВрдЦреНрдпрд╛ рджреНрд╡рд╛рд░рд╛) рдХреЗ рдХреНрд░рдо рдореЗрдВ рдЕрдВрддрд░ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рдЖрдИрд╕реАрдПрдордкреА рдкреИрдХреЗрдЯ рд╣рдореЗрд╢рд╛ рдЙрд╕реА рдХреНрд░рдо рдореЗрдВ рдЖрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рднреЗрдЬрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕рдордп рдХреЗ рд╕рд╛рдеред  рдЗрд╕реА рд╕рдордп, рдЯреАрд╕реАрдкреА рдкреИрдХреЗрдЯ рдХрднреА-рдХрднреА рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдЕрдЯрдХ рдЬрд╛рддреЗ рд╣реИрдВред  рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдпрджрд┐ рд╣рдо SYN рдкреИрдХреЗрдЯ рдХреЗ рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдкреНрд░реЗрд╖рдХ рдкрдХреНрд╖ рдкрд░ рд╡реЗ рдХреНрд░рдо рдореЗрдВ рдЬрд╛рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдкреНрд░рд╛рдкреНрддрдХрд░реНрддрд╛ рдкрдХреНрд╖ рдкрд░ рдРрд╕рд╛ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред <br><br>  рдЯреАрд╕реАрдкреА рдпрд╛ рдЖрдИрд╕реАрдПрдордкреА рд╡рд╛рд▓реЗ рдЖрдзреБрдирд┐рдХ рдкреИрдХреЗрдЯ (рд╣рдорд╛рд░реЗ рдбреЗрдЯрд╛ рд╕реЗрдВрдЯрд░ рдореЗрдВ) рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреИрдХреЗрдЯ рдХреЗ <a href="https://en.wikipedia.org/wiki/Network_address_translation">рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛рд░реНрдб</a> рдХреИрд╕реЗ рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рдореЗрдВ рдПрдХ рд╕реВрдХреНрд╖реНрдо рдЕрдВрддрд░ рд╣реИред  рдЬрдм рдПрдХ рдкреИрдХреЗрдЯ рдЖрддрд╛ рд╣реИ, рддреЛ рдиреЗрдЯрд╡рд░реНрдХ рдЕрдбреИрдкреНрдЯрд░ "рдЗрд╕реЗ рдХрдиреЗрдХреНрд╢рди рдкрд░ рд╣реИрд╢ рдХрд░рддрд╛ рд╣реИ", рдЕрд░реНрдерд╛рдд рдпрд╣ рдореБрдбрд╝реЗрдВ рдореЗрдВ рдХрдиреЗрдХреНрд╢рди рдХреЛ рддреЛрдбрд╝рдиреЗ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдХрддрд╛рд░ рдХреЛ рдПрдХ рдЕрд▓рдЧ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЛрд░ рдореЗрдВ рднреЗрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИред  рдЯреАрд╕реАрдкреА рдХреЗ рд▓рд┐рдП, рдЗрд╕ рд╣реИрд╢ рдореЗрдВ рд╕реНрд░реЛрдд рдФрд░ рдЧрдВрддрд╡реНрдп рдЖрдИрдкреА рдкрддрд╛ рдФрд░ рдкреЛрд░реНрдЯ рджреЛрдиреЛрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред  рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рдХрдиреЗрдХреНрд╢рди рдЕрд▓рдЧ рд╕реЗ рд╣реИрд╢ (рд╕рдВрднрд╛рд╡рд┐рдд) рд╣реИред  ICMP рдХреЗ рд▓рд┐рдП, рдХреЗрд╡рд▓ IP рдкрддреЗ рд╣реАрд╢реЗрдб рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдИ рдкреЛрд░реНрдЯ рдирд╣реАрдВ рд╣реИрдВред <br><br>  рдПрдХ рдФрд░ рдирдпрд╛ рдЕрд╡рд▓реЛрдХрди: рдЗрд╕ рдЕрд╡рдзрд┐ рдХреЗ рджреМрд░рд╛рди рд╣рдо рджреЛ рдореЗрдЬрдмрд╛рдиреЛрдВ рдХреЗ рдмреАрдЪ рд╕рднреА рд╕рдВрдЪрд╛рд░реЛрдВ рдкрд░ рдЖрдИрд╕реАрдПрдордкреА рджреЗрд░реА рджреЗрдЦрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЯреАрд╕реАрдкреА рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рд╣рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рд╕рдВрднрд╡рддрдГ рдЖрд░рдПрдХреНрд╕ рдХрддрд╛рд░реЛрдВ рдХреЗ рд╣реИрд╢рд┐рдВрдЧ рдХреЗ рдХрд╛рд░рдг рд╣реИ: рдпрд╣ рд▓рдЧрднрдЧ рдирд┐рд╢реНрдЪрд┐рдд рд╣реИ рдХрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдВ рднреЗрдЬрдиреЗ рдХреЗ рдмрдЬрд╛рдп рдЖрд░рдПрдХреНрд╕ рдкреИрдХреЗрдЯ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рднреАрдбрд╝рднрд╛рдбрд╝ рд╣реЛрддреА рд╣реИред <br><br>  рдпрд╣ рд╕рдВрднрд╛рд╡рд┐рдд рдХрд╛рд░рдгреЛрдВ рдХреА рд╕реВрдЪреА рд╕реЗ рдкреИрдХреЗрдЯ рднреЗрдЬрдиреЗ рдХреЛ рдмрд╛рд╣рд░ рдХрд░рддрд╛ рд╣реИред  рдЕрдм рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдкреИрдХреЗрдЯ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛ рдХреБрдЫ рдХреНрдпреВрдм-рдиреЛрдб рд╕рд░реНрд╡рд░ рдкрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдУрд░ рд╣реИред <br><br><h1>  рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдкреИрдХреЗрдЬ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЛ рд╕рдордЭрдирд╛ </h1><br>  рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреБрдЫ рдХреНрдпреВрдм-рдиреЛрдб рд╕рд░реНрд╡рд░ рдкрд░ рдкреНрд░рд╛рдкреНрддрдХрд░реНрддрд╛ рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛ рдХреНрдпреЛрдВ рд╣реЛрддреА рд╣реИ, рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рд╕рдВрдХреБрд▓ рдХреЛ рдХреИрд╕реЗ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИред <br><br>  рд╕рдмрд╕реЗ рд╕рд░рд▓ рдкрд╛рд░рдВрдкрд░рд┐рдХ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкрд░ рд▓реМрдЯрдиреЗ рдкрд░, рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛рд░реНрдб рдкреИрдХреЗрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ <a href="https://en.wikipedia.org/wiki/Interrupt">рдмрд╛рдзрд╛</a> рднреЗрдЬрддрд╛ рд╣реИ, рдЬреЛ рдХрд┐ рдкреИрдХреЗрдЯ рд╣реИ рдЬрд┐рд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдХрд░реНрдиреЗрд▓ рдПрдХ рдЕрдиреНрдп рдСрдкрд░реЗрд╢рди рдХреЛ рд░реЛрдХрддрд╛ рд╣реИ, рд╕рдВрджрд░реНрдн рдХреЛ рд╣реИрдВрдбрд▓рд░ рдореЗрдВ рдмрджрд▓рддрд╛ рд╣реИ, рдкреИрдХреЗрдЬ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рд╡рд░реНрддрдорд╛рди рдХрд╛рд░реНрдпреЛрдВ рдкрд░ рд▓реМрдЯрддрд╛ рд╣реИред <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a2/3c3/4ee/1a23c34eea2236294913fd09a25aa1e4.png"><br><br>  рдпрд╣ рд╕рдВрджрд░реНрдн рд╕реНрд╡рд┐рдЪ рдзреАрдорд╛ рд╣реИ: 90 рдХреЗ рджрд╢рдХ рдореЗрдВ 10-рдореЗрдЧрд╛рдмрд╛рдЗрдЯ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛рд░реНрдб рдкрд░ рд╢рд╛рдпрдж рджреЗрд░реА рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рдирд╣реАрдВ рдереА, рд▓реЗрдХрд┐рди рдЖрдзреБрдирд┐рдХ 10G рдХрд╛рд░реНрдб рдкрд░ рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб 15 рдорд┐рд▓рд┐рдпрди рдкреИрдХреЗрдЯ рдХреА рдЕрдзрд┐рдХрддрдо рдереНрд░реВрдкреБрдЯ рдХреЗ рд╕рд╛рде, рдПрдХ рдЫреЛрдЯреЗ рдЖрда-рдХреЛрд░ рд╕рд░реНрд╡рд░ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЛрд░ рдХреЛ рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб рд▓рд╛рдЦреЛрдВ рдмрд╛рд░ рдмрд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br>  рд▓рдЧрд╛рддрд╛рд░ рд╡реНрдпрд╡рдзрд╛рди рд╕реЗ рдирд┐рдкрдЯрдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ, рдХрдИ рд╕рд╛рд▓ рдкрд╣рд▓реЗ рд▓рд┐рдирдХреНрд╕ рдиреЗ <a href="https://en.wikipedia.org/wiki/New_API">NAPI рдХреЛ</a> рдЬреЛрдбрд╝рд╛: рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рдПрдкреАрдЖрдИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рднреА рдЖрдзреБрдирд┐рдХ рдЪрд╛рд▓рдХ рдЙрдЪреНрдЪ рдЧрддрд┐ рдкрд░ рдкреНрд░рджрд░реНрд╢рди рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВред  рдХрдо рдЧрддрд┐ рдкрд░, рдХрд░реНрдиреЗрд▓ рдЕрднреА рднреА рдкреБрд░рд╛рдиреЗ рддрд░реАрдХреЗ рд╕реЗ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛рд░реНрдб рд╕реЗ рд╡реНрдпрд╡рдзрд╛рди рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рдЬреИрд╕реЗ рд╣реА рдкрд░реНрдпрд╛рдкреНрдд рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдкреИрдХреЗрдЯ рдЖрддреЗ рд╣реИрдВ рдХрд┐ рд╕реАрдорд╛ рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдХрд░реНрдиреЗрд▓ рдмрд╛рдзрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рдмрдЬрд╛рдп рдиреЗрдЯрд╡рд░реНрдХ рдПрдбреЙрдкреНрдЯрд░ рд╕реЗ рдорддрджрд╛рди рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрддрд╛ рд╣реИ рдФрд░ рдкреИрдХреЗрдЯ рдХреЛ рдмреИрдЪреЛрдВ рдореЗрдВ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИред  рд╕реЙрдлреНрдЯрд░рд┐рдХ рдореЗрдВ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рддреН, <a href="https://www.kernel.org/doc/htmldocs/kernel-hacking/basics-softirqs.html">рд╕реЙрдлреНрдЯрд╡реЗрдпрд░</a> рдХреЙрд▓ рдХреЗ <a href="https://www.kernel.org/doc/htmldocs/kernel-hacking/basics-softirqs.html">рд╕рдВрджрд░реНрдн рдореЗрдВ</a> рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдФрд░ рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рдмрд╛рдзрд┐рдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдЬрдм рдХрд░реНрдиреЗрд▓ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЪрд▓ рд░рд╣рд╛ рд╣реЛрддрд╛ рд╣реИред <br><br><img src="https://habrastorage.org/getpro/habr/post_images/22a/50d/ee1/22a50dee1fffdbc20614db2b1db28fc4.png"><br><br>  рдпрд╣ рдмрд╣реБрдд рддреЗрдЬ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдЕрд▓рдЧ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рдХрд╛рд░рдг рдмрдирддрд╛ рд╣реИред  рдпрджрд┐ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдкреИрдХреЗрдЯ рд╣реИрдВ, рддреЛ рд╣рд░ рд╕рдордп рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛рд░реНрдб рд╕реЗ рдкреИрдХреЗрдЯ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдордп рд▓рдЧрддрд╛ рд╣реИ, рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдкрд╛рд╕ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрди рдХрддрд╛рд░реЛрдВ (рдЯреАрд╕реАрдкреА рдХрдиреЗрдХреНрд╢рди рдЖрджрд┐ рд╕реЗ рдкрдврд╝рдирд╛) рдХреЛ рдЦрд╛рд▓реА рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдирд╣реАрдВ рд╣реИред  рдЕрдВрдд рдореЗрдВ, рдХрддрд╛рд░реЗрдВ рднрд░ рдЬрд╛рддреА рд╣реИрдВ рдФрд░ рд╣рдо рдкреИрдХреЗрдЯ рдЫреЛрдбрд╝рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрддреЗ рд╣реИрдВред  рдПрдХ рд╕рдВрддреБрд▓рди рдЦреЛрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реБрдП, рдХрд░реНрдиреЗрд▓ рд╕реЙрдлреНрдЯрд░рд┐рдХ рд╕рдВрджрд░реНрдн рдореЗрдВ рд╕рдВрд╕рд╛рдзрд┐рдд рдЕрдзрд┐рдХрддрдо рдкреИрдХреЗрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдЬрдЯ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдПрдХ рдмрд╛рд░ рдЬрдм рдпрд╣ рдмрдЬрдЯ рдкрд╛рд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдПрдХ рдЕрд▓рдЧ <code>ksoftirqd</code> рдереНрд░реЗрдб <code>ksoftirqd</code> (рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рдХреЛрд░ рдХреЗ рд▓рд┐рдП <code>ps</code> рдореЗрдВ рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рджреЗрдЦреЗрдВрдЧреЗ), рдЬреЛ рдЗрди рд╕реЙрдлреНрдЯрд░рд┐рдХ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рд╕реАрд╕реНрдХреЙрд▓ / рдЗрдВрдЯрд░рдкреНрдЯ рдкрде рдХреЗ рдмрд╛рд╣рд░ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рдзрд╛рдЧрд╛ рдПрдХ рдорд╛рдирдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрдиреБрд╕реВрдЪрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпреЛрдЬрдирд╛рдмрджреНрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрдХреНрд╖ рд░реВрдк рд╕реЗ рд╡рд┐рддрд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИред <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d0f/1e6/f0c/d0f1e6f0c54d45c24d62cb2bcf90c674.png"><br><br>  рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рдмрд╛рдж рдХрд┐ рдХрд░реНрдиреЗрд▓ рдкреИрдХреЗрдЯ рдХреИрд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рднреАрдбрд╝рднрд╛рдбрд╝ рдХреА рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИред  рдпрджрд┐ рд╕реЙрдлреНрдЯрд░реИрдХ рдХреЙрд▓ рдХрдо рдмрд╛рд░ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛рд░реНрдб рдкрд░ рдЖрд░рдПрдХреНрд╕ рдХрддрд╛рд░ рдореЗрдВ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдкреИрдХреЗрдЯ рдХреЛ рдереЛрдбрд╝реА рджреЗрд░ рдЗрдВрддрдЬрд╛рд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рд╢рд╛рдпрдж рдпрд╣ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЛрд░ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреБрдЫ рдХрд╛рд░реНрдп рдХреЗ рдХрд╛рд░рдг рд╣реИ, рдпрд╛ рдХреБрдЫ рдФрд░ рдХрд░реНрдиреЗрд▓ рдХреЛ рд╕реЙрдлреНрдЯрд░рд┐рдХ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИред <br><br><h1>  рд╣рдо рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдХрд░реНрдиреЗрд▓ рдпрд╛ рд╡рд┐рдзрд┐ рддрдХ рд╕реАрдорд┐рдд рдХрд░рддреЗ рд╣реИрдВ </h1><br>  рд╕реЙрдлреНрдЯрд░рд┐рдХ рд╡рд┐рд▓рдВрдм рдХреЗрд╡рд▓ рдПрдХ рдзрд╛рд░рдгрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ, рдФрд░ рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдХреБрдЫ рд╕рдорд╛рди рджреЗрдЦ рд░рд╣реЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рд╕рд┐рджреНрдзрд╛рдВрдд рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдЧрд▓рд╛ рдХрджрдо рд╣реИред  рдФрд░ рдЕрдЧрд░ рдЗрд╕рдХреА рдкреБрд╖реНрдЯрд┐ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рджреЗрд░реА рдХрд╛ рдХрд╛рд░рдг рдвреВрдВрдвреЗрдВред <br><br>  рд╣рдорд╛рд░реЗ рдзреАрдореЗ рдкреИрдХреЗрдЬреЛрдВ рдкрд░ рд╡рд╛рдкрд╕: <br><br> <code>len=46 ip=172.16.53.32 ttl=61 id=29573 icmp_seq=1953 rtt=99.3 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29574 icmp_seq=1954 rtt=89.3 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29575 icmp_seq=1955 rtt=79.2 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29576 icmp_seq=1956 rtt=69.1 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29577 icmp_seq=1957 rtt=59.1 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29790 icmp_seq=2070 rtt=75.7 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29791 icmp_seq=2071 rtt=65.6 ms <br> <br> len=46 ip=172.16.53.32 ttl=61 id=29792 icmp_seq=2072 rtt=55.5 ms</code> <br> <br>  рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдЪрд░реНрдЪрд╛ рдХреА рдЧрдИ рд╣реИ, рдЗрди ICMP рдкреИрдХреЗрдЯреЛрдВ рдХреЛ рдПрдХ рдПрдХрд▓ NIC RX рдХрддрд╛рд░ рдореЗрдВ рд╣реИрд╢ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдПрдХрд▓ CPU рдХреЛрд░ рджреНрд╡рд╛рд░рд╛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рд╣рдо рдпрд╣ рд╕рдордЭрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рд▓рд┐рдирдХреНрд╕ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рдЙрдкрдпреЛрдЧреА рд╣реИ рдХрд┐ рдХрд╣рд╛рдВ (рдХрд┐рд╕ рд╕реАрдкреАрдпреВ рдХреЛрд░ рдкрд░) рдФрд░ рдХреИрд╕реЗ (рд╕реЙрдлреНрдЯрд░реИрдХ, рдХреНрд╕реЛрдлреНрдЯрд┐рд░рдХрдб) рдЗрди рдкреИрдХреЗрдЬреЛрдВ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдЕрдм рдЙрди рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИ рдЬреЛ рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдХреА рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред  рдпрд╣рд╛рдВ рд╣рдордиреЗ <a href="https://github.com/iovisor/bcc">рдмреАрд╕реАрд╕реА рдХрд╛</a> рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ред  рдпрд╣ рдЯреВрд▓рдХрд┐рдЯ рдЖрдкрдХреЛ рдЫреЛрдЯреЗ рд╕реА рдкреНрд░реЛрдЧреНрд░рд╛рдо рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдХрд░реНрдиреЗрд▓ рдФрд░ рдмрдлрд░ рдИрд╡реЗрдВрдЯреНрд╕ рдореЗрдВ рдордирдорд╛рдиреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдПрдХ рдпреВрдЬрд░-рд╕реНрдкреЗрд╕ рдкрд╛рдпрдерди рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЖрдкрдХреЛ рдкрд░рд┐рдгрд╛рдо рд▓реМрдЯрд╛ рд╕рдХрддрд╛ рд╣реИред  рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдордирдорд╛рдиреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╣реБрдХ рдЬрдЯрд┐рд▓ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдХреЛ рдЕрдзрд┐рдХрддрдо рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдпрд╣ рд╕рдЯреАрдХ рд░реВрдк рд╕реЗ рдРрд╕реА рдЙрддреНрдкрд╛рджрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ рдкрд░реАрдХреНрд╖рдг рдпрд╛ рд╡рд┐рдХрд╛рд╕ рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдкреБрди: рдкреЗрд╢ рдХрд░рдирд╛ рдЖрд╕рд╛рди рдирд╣реАрдВ рд╣реИред <br><br>  рдпрд╣рд╛рдВ рдпреЛрдЬрдирд╛ рд╕рд░рд▓ рд╣реИ: рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдХрд░реНрдиреЗрд▓ рдЗрди ICMP рдкрд┐рдВрдЧ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо <a href="">icmp_echo</a> рдХрд░реНрдиреЗрд▓ <a href="">рдлрд╝рдВрдХреНрд╢рди</a> рдкрд░ рдПрдХ рд╣реБрдХ <a href="">рд▓рдЧрд╛рддреЗ рд╣реИрдВ</a> , рдЬреЛ рдЖрдиреЗ рд╡рд╛рд▓реЗ ICMP рдкреИрдХреЗрдЯ "рдЗрдХреЛ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ" рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ <a href="">ICCC</a> рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ "рдЗрдХреЛ рд░рд┐рд╕реНрдкрд╛рдВрд╕" рднреЗрдЬрдиреЗ рдХреА рдкрд╣рд▓ рдХрд░рддрд╛ рд╣реИред  рд╣рдо icmp_seq рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдмрдврд╝рд╛рдХрд░ рдкреИрдХреЗрдЬ рдХреА рдкрд╣рдЪрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдКрдкрд░ <code>hping3</code> рджрд┐рдЦрд╛рддрд╛ рд╣реИред <br><br>  <a href="https://gist.github.com/theojulienne/9d78a0cb68dbe56f19a2ae6316bc6846">Bcc рд╕реНрдХреНрд░рд┐рдкреНрдЯ</a> рдХреЛрдб рдЬрдЯрд┐рд▓ рд▓рдЧрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЙрддрдирд╛ рдбрд░рд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реИ рдЬрд┐рддрдирд╛ рд▓рдЧрддрд╛ рд╣реИред  <code>icmp_echo</code> рдлрд╝рдВрдХреНрд╢рди <code>struct sk_buff *skb</code> рдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИ: рдпрд╣ "рдЗрдХреЛ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ" рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде рдкреИрдХреЗрдЯ рд╣реИред  рд╣рдо рдЗрд╕реЗ рдЯреНрд░реИрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, <code>echo.sequence</code> рдЕрдиреБрдХреНрд░рдо (рдЬреЛ <code></code> <code>icmp_seq</code> рд╕реЗ icmp_seq рдХреЗ рд▓рд┐рдП <code>icmp_seq</code> рдХрд░рддреЗ <code></code> ) рдХреЛ рдЦреАрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрдерд╛рди рдкрд░ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред  рд╡рд░реНрддрдорд╛рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд╛рдо / рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░рдирд╛ рднреА рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред  рдиреАрдЪреЗ рд╡реЗ рдкрд░рд┐рдгрд╛рдо рд╣реИрдВ рдЬреЛ рд╣рдо рд╕реАрдзреЗ рдХрд░реНрдиреЗрд▓ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдХреБрд▓ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рджреМрд░рд╛рди рджреЗрдЦрддреЗ рд╣реИрдВ: <br><br><pre>  TGID PID рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдирд╛рдо ICMP_SEQ рд╣реИ
 0 0 рд╕реНрд╡реИрдкрд░ / 11,770
 0 0 рд╕реНрд╡реИрдкрд░ / 11,771
 0 0 рд╕реНрд╡реИрдкрд░ / 11 772
 0 0 рд╕реНрд╡реИрдкрд░ / 11 773
 0 0 рд╕реНрд╡реИрдкрд░ / 11,774
 20041 20086 рдкреНрд░реЛрдореЗрдерд┐рдпрд╕ 775
 0 0 рд╕реНрд╡реИрдкрд░ / 11,776
 0 0 рд╕реНрд╡реИрдкрд░ / 11,777
 0 0 рд╕реНрд╡реИрдкрд░ / 11 778
 4512 4542 рдкреНрд░рд╡рдХреНрддрд╛-рд░рд┐рдкреЛрд░реНрдЯ-рдПрд╕ 779 </pre><br>  рдпрд╣рд╛рдВ рдпрд╣ рдзреНрдпрд╛рди рджрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ <code>softirq</code> рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ <code>softirq</code> рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ "рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ" рдХреЗ рд░реВрдк рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рдХрд░реНрдиреЗрд▓ рдХрд░реНрдиреЗрд▓ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдкреИрдХреЗрдЯ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИред <br><br>  рдЗрд╕ рдЙрдкрдХрд░рдг рдХреЗ рд╕рд╛рде рд╣рдо рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреИрдХреЗрдЬреЛрдВ рдХреЗ рд╕рд╛рде рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ <code>hping3</code> рдореЗрдВ рджреЗрд░реА <code>hping3</code> ред  рд╣рдо рд╡рд┐рд╢рд┐рд╖реНрдЯ <code>icmp_seq</code> рдореВрд▓реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдХреИрдкреНрдЪрд░ рдкрд░ рдПрдХ рд╕рд╛рдзрд╛рд░рдг <code>grep</code> <code>icmp_seq</code> рд╣реИрдВред  рдЙрдкрд░реЛрдХреНрдд icmp_seq рдореВрд▓реНрдпреЛрдВ рдХреЗ рдЕрдиреБрд░реВрдк рдкреИрдХреЗрдЯ рдХреЛ рдЙрдирдХреЗ RTT рдХреЗ рд╕рд╛рде рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдКрдкрд░ рджреЗрдЦрд╛ (рдХреЛрд╖реНрдардХ рдореЗрдВ рдкреИрдХреЗрдЯ рдХреЗ рд▓рд┐рдП рдЕрдкреЗрдХреНрд╖рд┐рдд RTT рдорд╛рди рдЬреЛ рд╣рдордиреЗ RTT рдорд╛рдиреЛрдВ рдХреЛ 50 ms рд╕реЗ рдХрдо рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд┐рдпрд╛ рд╣реИ): <br><br><pre>  TGID PID рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдирд╛рдо ICMP_SEQ ** RTT рд╣реИ
 -
 10137 10436 рдХреИрдбрд╡рд╛рдЗрдЬрд░ 1951
 10137 10436 рдХреИрдбрд╡рд╛рдЗрдЬрд░ 1952
 76 76 ksoftirqd / 11 1953 ** 99ms
 76 76 ksoftirqd / 11 1954 ** 89ms
 76 76 ksoftirqd / 11 1955 ** 79ms
 76 76 ksoftirqd / 11 1956 ** 69ms
 76 76 ksoftirqd / 11 1957 ** 59ms
 76 76 ksoftirqd / 11 1958 ** (49ms)
 76 76 ksoftirqd / 11 1959 ** (39ms)
 76 76 ksoftirqd / 11 1960 ** (29 рд╕реЗрдореА)
 76 76 ksoftirqd / 11 1961 ** (19ms)
 76 76 ksoftirqd / 11 1962 ** (9ms)
 -
 10137 10436 рдХреИрдбрд╡рд╛рдЗрдЬрд░ 2068
 10137 10436 рдХреИрдбрд╡рд╛рдЗрдЬрд░ 2069
 76 76 ksoftirqd / 11 2070 ** 75ms
 76 76 ksoftirqd / 11 2071 ** 65ms
 76 76 ksoftirqd / 11 2072 ** 55ms
 76 76 ksoftirqd / 11 2073 ** (45 рд╕реЗрдореА)
 76 76 ksoftirqd / 11 2074 ** (35 рд╕реЗрдореА)
 76 76 ksoftirqd / 11 2075 ** (25ms)
 76 76 ksoftirqd / 11 2076 ** (15ms)
 76 76 ksoftirqd / 11 2077 ** (5ms) </pre><br>  рдкрд░рд┐рдгрд╛рдо рд╣рдореЗрдВ рдХреБрдЫ рдЪреАрдЬреЗрдВ рдмрддрд╛рддреЗ рд╣реИрдВред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, <code>ksoftirqd/11</code> рд╕рдВрджрд░реНрдн рдЗрди рд╕рднреА рдкреИрдХреЗрдЬреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдорд╢реАрдиреЛрдВ рдХреА рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рдЬреЛрдбрд╝реА рдХреЗ рд▓рд┐рдП, ICMP рдкреИрдХреЗрдЯ рдХреЛ 11 рдХреЛрд░ рдкрд░ рдкреНрд░рд╛рдкреНрдд рдЕрдВрдд рдореЗрдВ рд╣реИрд╢реЗрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рд╣рдо рдпрд╣ рднреА рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдЯреНрд░реИрдлрд╝рд┐рдХ рдЬрд╛рдо рдореЗрдВ рдРрд╕реЗ рдкреИрдХреЗрдЯ рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ <code>cadvisor</code> рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рддрдм <code>ksoftirqd</code> рдХрд╛рд░реНрдп рдХреЛ рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕рдВрдЪрд┐рдд рдХрддрд╛рд░ рдХреЛ рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИ: рдареАрдХ рдЙрд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рдкреИрдХреЗрдЯ рдЬреЛ <code>cadvisor</code> рдмрд╛рдж рд╕рдВрдЪрд┐рдд <code>cadvisor</code> ред <br><br>  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдПрдХ <code>cadvisor</code> рд╣рдореЗрд╢рд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдпрд╣ рд╕рдорд╕реНрдпрд╛ рдореЗрдВ рдЙрд╕рдХреА рднрд╛рдЧреАрджрд╛рд░реА рдХрд╛ рдорддрд▓рдм рд╣реИред  рд╡рд┐рдбрдВрдмрдирд╛ рдпрд╣ рд╣реИ рдХрд┐ <a href="https://github.com/google/cadvisor">рдХреИрдбрд╡рд╛рдЗрдЬрд░</a> рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЗрд╕ рдкреНрд░рджрд░реНрд╢рди рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЗ рдХрд╛рд░рдг "рд╕рдВрд╕рд╛рдзрди рдЙрдкрдпреЛрдЧ рдФрд░ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреА рдкреНрд░рджрд░реНрд╢рди рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдирд╛" рд╣реИред <br><br>  рдХрдВрдЯреЗрдирд░ рд╣реИрдВрдбрд▓рд┐рдВрдЧ рдХреЗ рдЕрдиреНрдп рдкрд╣рд▓реБрдУрдВ рдХреЗ рд╕рд╛рде, рдпреЗ рд╕рднреА рдмреЗрд╣рдж рдЙрдиреНрдирдд рдЙрдкрдХрд░рдг рд╣реИрдВ рдЬрд┐рдирд╕реЗ рдХреБрдЫ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдкреНрд░рджрд░реНрд╢рди рдХреА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреА рдЙрдореНрдореАрдж рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред <br><br><h1>  рдХреИрдбрд╡рд┐рд╕рд░ рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдкреИрдХреЗрдЯ рдХреА рдХрддрд╛рд░ рдХреЛ рдзреАрдорд╛ рдХрд░ рджреЗрддрд╛ рд╣реИ? </h1><br>  рдЕрдм рд╣рдореЗрдВ рдмрд╣реБрдд рдЕрдЪреНрдЫреА рд╕рдордЭ рд╣реИ рдХрд┐ рд╡рд┐рдлрд▓рддрд╛ рдХреИрд╕реЗ рд╣реЛрддреА рд╣реИ, рдХреМрди рд╕реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдмрдирддреА рд╣реИ, рдФрд░ рдХрд┐рд╕ рд╕реАрдкреАрдпреВ рдкрд░ред  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╣рд╛рд░реНрдб рд▓реЙрдХрд┐рдВрдЧ рдХреЗ рдХрд╛рд░рдг, рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдХреЗ рдкрд╛рд╕ рд╕рдордп <code>ksoftirqd</code> рдХреЛ рд╢реЗрдбреНрдпреВрд▓ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдирд╣реАрдВ рд╣реИред  рдФрд░ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдкреИрдХреЗрдЬ <code>cadvisor</code> рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдпрд╣ рдорд╛рдирдирд╛ тАЛтАЛрддрд░реНрдХрд╕рдВрдЧрдд рд╣реИ рдХрд┐ <code>cadvisor</code> рдПрдХ рдзреАрдореА рдЧрддрд┐ рд╕реЗ <code>cadvisor</code> рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдЗрд╕ рд╕рдордп рдЬрдорд╛ рдХрд┐рдП рдЧрдП рд╕рднреА рдкреИрдХреЗрдЯ рд╕рдВрд╕рд╛рдзрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6fd/6fb/970/6fd6fb970f2d27943039910db9b41743.png"><br><br>  рдпрд╣ рдПрдХ рд╕рд┐рджреНрдзрд╛рдВрдд рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдП?  рд╣рдо рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рд╕реАрдкреАрдпреВ рдХреЛрд░ рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╡рд╣ рдмрд┐рдВрджреБ рдвреВрдВрдвреЗрдВ рдЬрд╣рд╛рдВ рдмрдЬрдЯ рдкреИрдХреЗрдЯ рдФрд░ ksoftirqd рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рдФрд░ рдлрд┐рд░ рдереЛрдбрд╝рд╛ рдкрд╣рд▓реЗ рджреЗрдЦреЗрдВ - рдЙрд╕ рдкрд▓ рд╕реЗ рдкрд╣рд▓реЗ рд╕реАрдкреАрдпреВ рдХреЛрд░ рдкрд░ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреНрдпрд╛ рдХрд╛рдо рдХрд┐рдпрд╛ред  рдпрд╣ рд╣рд░ рдХреБрдЫ рдорд┐рд▓реАрд╕реЗрдХрдВрдб рдХреЗ рд╕реАрдкреАрдпреВ рдХреЗ рдПрдХреНрд╕-рд░реЗ рдХреА рддрд░рд╣ рд╣реИред  рдпрд╣ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/44a/954/6e8/44a9546e8de19e43cb125eb8a03a8f47.png"><br><br>  рдЖрд╕рд╛рдиреА рд╕реЗ, рдпрд╣ рд╕рдм рдореМрдЬреВрджрд╛ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреВрд░реНрдг <a href="https://perf.wiki.kernel.org/index.php/Tutorial">рд░рд┐рдХреЙрд░реНрдб</a> рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЖрд╡реГрддреНрддрд┐ рдХреЗ рд╕рд╛рде рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕реАрдкреАрдпреВ рдХреЛрд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЕрдВрддрд░рд┐рдХреНрд╖ рдФрд░ рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рджреЛрдиреЛрдВ рд╕рд╣рд┐рдд рдПрдХ рдЪрд▓ рд░рд╣реЗ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдХреЙрд▓ рдХреА рдПрдХ рдЕрдиреБрд╕реВрдЪреА рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдЖрдк рдЗрд╕ рд░рд┐рдХреЙрд░реНрдб рдХреЛ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдмреНрд░реЗрдВрдбрди рдЧреНрд░реЗрдЧ рд╕реЗ <a href="https://github.com/brendangregg/FlameGraph">рдлреНрд▓реЗрдордЧреНрд░рд╛рдл</a> рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЗ рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдХрд╛рдВрдЯреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рд╕реНрдЯреИрдХ рдЯреНрд░реЗрд╕ рдСрд░реНрдбрд░ рдХреЛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред  рд╣рдо рд╣рд░ 1 ms рдореЗрдВ рдПрдХ-рдкрдВрдХреНрддрд┐ рд╕реНрдЯреИрдХ рдХреЗ рдирд┐рд╢рд╛рди рдмрдЪрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ <code>ksoftirqd</code> рдЯреНрд░реЗрд╕ рдореЗрдВ рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ 100 рдорд┐рд▓реАрд╕реЗрдХреЗрдВрдб рдХреЗ рд▓рд┐рдП рдирдореВрдиреЗ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ рд╕рд╣реЗрдЬреЗрдВ: <br><br> <code># record 999 times a second, or every 1ms with some offset so not to align exactly with timers <br> sudo perf record -C 11 -g -F 999 <br> # take that recording and make a simpler stack trace. <br> sudo perf script 2&gt;/dev/null | ./FlameGraph/stackcollapse-perf-ordered.pl | grep ksoftir -B 100</code> <br> <br>  рдпрд╣рд╛рдБ рдкрд░рд┐рдгрд╛рдо рд╣реИрдВ: <br><br> <code>( ,   ) <br> <br> cadvisor;[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];entry_SYSCALL_64_after_swapgs;do_syscall_64;sys_read;vfs_read;seq_read;memcg_stat_show;mem_cgroup_nr_lru_pages;mem_cgroup_node_nr_lru_pages cadvisor;[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];entry_SYSCALL_64_after_swapgs;do_syscall_64;sys_read;vfs_read;seq_read;memcg_stat_show;mem_cgroup_nr_lru_pages;mem_cgroup_node_nr_lru_pages cadvisor;[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];entry_SYSCALL_64_after_swapgs;do_syscall_64;sys_read;vfs_read;seq_read;memcg_stat_show;mem_cgroup_iter cadvisor;[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];entry_SYSCALL_64_after_swapgs;do_syscall_64;sys_read;vfs_read;seq_read;memcg_stat_show;mem_cgroup_nr_lru_pages;mem_cgroup_node_nr_lru_pages cadvisor;[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];[cadvisor];entry_SYSCALL_64_after_swapgs;do_syscall_64;sys_read;vfs_read;seq_read;memcg_stat_show;mem_cgroup_nr_lru_pages;mem_cgroup_node_nr_lru_pages ksoftirqd/11;ret_from_fork;kthread;kthread;smpboot_thread_fn;smpboot_thread_fn;run_ksoftirqd;__do_softirq;net_rx_action;ixgbe_poll;ixgbe_clean_rx_irq;napi_gro_receive;netif_receive_skb_internal;inet_gro_receive;bond_handle_frame;__netif_receive_skb_core;ip_rcv_finish;ip_rcv;ip_forward_finish;ip_forward;ip_finish_output;nf_iterate;ip_output;ip_finish_output2;__dev_queue_xmit;dev_hard_start_xmit;ipip_tunnel_xmit;ip_tunnel_xmit;iptunnel_xmit;ip_local_out;dst_output;__ip_local_out;nf_hook_slow;nf_iterate;nf_conntrack_in;generic_packet;ipt_do_table;set_match_v4;ip_set_test;hash_net4_kadt;ixgbe_xmit_frame_ring;swiotlb_dma_mapping_error;hash_net4_test ksoftirqd/11;ret_from_fork;kthread;kthread;smpboot_thread_fn;smpboot_thread_fn;run_ksoftirqd;__do_softirq;net_rx_action;gro_cell_poll;napi_gro_receive;netif_receive_skb_internal;inet_gro_receive;__netif_receive_skb_core;ip_rcv_finish;ip_rcv;ip_forward_finish;ip_forward;ip_finish_output;nf_iterate;ip_output;ip_finish_output2;__dev_queue_xmit;dev_hard_start_xmit;dev_queue_xmit_nit;packet_rcv;tpacket_rcv;sch_direct_xmit;validate_xmit_skb_list;validate_xmit_skb;netif_skb_features;ixgbe_xmit_frame_ring;swiotlb_dma_mapping_error;__dev_queue_xmit;dev_hard_start_xmit;__bpf_prog_run;__bpf_prog_run</code> <br> <br>  рдпрд╣рд╛рдВ рдмрд╣реБрдд рд╕реА рдЪреАрдЬреЗрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдореБрдЦреНрдп рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо "рдХреИрдбрдлреЛрд░реНрд╕ рд╕реЗ рдкрд╣рд▓реЗ ksoftirqd" рдЯреЗрдореНрдкрд▓реЗрдЯ рдкрд╛рддреЗ рд╣реИрдВ рдЬреЛ рд╣рдордиреЗ рдкрд╣рд▓реЗ ICMP рдЯреНрд░реЗрд╕рд░ рдореЗрдВ рджреЗрдЦрд╛ рдерд╛ред  рдЗрд╕рдХрд╛ рдХреНрдпрд╛ рдорддрд▓рдм рд╣реИ? <br><br>  рдкреНрд░рддреНрдпреЗрдХ рдкрдВрдХреНрддрд┐ рд╕рдордп рдореЗрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдмрд┐рдВрджреБ рдкрд░ рд╕реАрдкреАрдпреВ рдХрд╛ рдПрдХ рдирд┐рд╢рд╛рди рд╣реИред  рдПрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рд╕реНрдЯреИрдХ рдХреЗ рдиреАрдЪреЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓ рдХреЛ рдЕрд░реНрдзрд╡рд┐рд░рд╛рдо рджреНрд╡рд╛рд░рд╛ рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд░реЗрдЦрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдореЗрдВ рд╣рдо syscall рдХрд╣рддреЗ рд╣реИрдВ: <code>read(): .... ;do_syscall_64;sys_read; ...</code>  <code>read(): .... ;do_syscall_64;sys_read; ...</code> ред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдХреИрдбрд╡рд╛рдЗрдЬрд░ <code>read()</code> рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдкрд░ рдмрд╣реБрдд рд╕рдордп рдмрд┐рддрд╛рддрд╛ рд╣реИ, <code>mem_cgroup_*</code> рдлрд╝рдВрдХреНрд╢рдВрд╕ (рдХреЙрд▓ рд╕реНрдЯреИрдХ / рдкрдВрдХреНрддрд┐ рдХреЗ рдЕрдВрдд рдХреЗ рдКрдкрд░) рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИред <br><br>  рдХреЙрд▓ рдЯреНрд░реЗрд╕ рдореЗрдВ, рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ рдХрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреНрдпрд╛ рдкрдврд╝рд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕реНрдЯреНрд░реЗрд╕ рдЪрд▓рд╛рдПрдВ рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рдХреИрдбрд╡рд┐рд╕рд░ рдХреНрдпрд╛ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ 100 рдПрдордПрд╕ рд╕реЗ рдЕрдзрд┐рдХ рд╕рдордп рддрдХ рдвреВрдВрдвреЗрдВ: <br><br> <code>theojulienne@kube-node-bad ~ $ sudo strace -p 10137 -T -ff 2&gt;&amp;1 | egrep '&lt;0\.[1-9]' <br> [pid 10436] &lt;... futex resumed&gt; ) = 0 &lt;0.156784&gt; <br> [pid 10432] &lt;... futex resumed&gt; ) = 0 &lt;0.258285&gt; <br> [pid 10137] &lt;... futex resumed&gt; ) = 0 &lt;0.678382&gt; <br> [pid 10384] &lt;... futex resumed&gt; ) = 0 &lt;0.762328&gt; <br> [pid 10436] &lt;... read resumed&gt; "cache 154234880\nrss 507904\nrss_h"..., 4096) = 658 &lt;0.179438&gt; <br> [pid 10384] &lt;... futex resumed&gt; ) = 0 &lt;0.104614&gt; <br> [pid 10436] &lt;... futex resumed&gt; ) = 0 &lt;0.175936&gt; <br> [pid 10436] &lt;... read resumed&gt; "cache 0\nrss 0\nrss_huge 0\nmapped_"..., 4096) = 577 &lt;0.228091&gt; <br> [pid 10427] &lt;... read resumed&gt; "cache 0\nrss 0\nrss_huge 0\nmapped_"..., 4096) = 577 &lt;0.207334&gt; <br> [pid 10411] &lt;... epoll_ctl resumed&gt; ) = 0 &lt;0.118113&gt; <br> [pid 10382] &lt;... pselect6 resumed&gt; ) = 0 (Timeout) &lt;0.117717&gt; <br> [pid 10436] &lt;... read resumed&gt; "cache 154234880\nrss 507904\nrss_h"..., 4096) = 660 &lt;0.159891&gt; <br> [pid 10417] &lt;... futex resumed&gt; ) = 0 &lt;0.917495&gt; <br> [pid 10436] &lt;... futex resumed&gt; ) = 0 &lt;0.208172&gt; <br> [pid 10417] &lt;... futex resumed&gt; ) = 0 &lt;0.190763&gt; <br> [pid 10417] &lt;... read resumed&gt; "cache 0\nrss 0\nrss_huge 0\nmapped_"..., 4096) = 576 &lt;0.154442&gt;</code> <br> <br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЙрдореНрдореАрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣рд╛рдБ рд╣рдо рдзреАрдореА рдЧрддрд┐ рд╕реЗ <code>read()</code> рдХреЙрд▓ рджреЗрдЦрддреЗ рд╣реИрдВред  рд░реАрдб рдСрдкрд░реЗрд╢рди рдФрд░ <code>mem_cgroup</code> рд╕рдВрджрд░реНрдн рдХреА рд╕рд╛рдордЧреНрд░реА рд╕реЗ, <code>mem_cgroup</code> рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдпреЗ <code>read()</code> рдХреЙрд▓ <code>memory.stat</code> рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд <code>memory.stat</code> рд╣реИрдВ, рдЬреЛ рдореЗрдореЛрд░реА рдЙрдкрдпреЛрдЧ рдФрд░ рд╕реАрдЧреНрд░реБрдк рд╕реАрдорд╛рдУрдВ (рдбреЙрдХрд░ рд╕рдВрд╕рд╛рдзрди рдЕрд▓рдЧрд╛рд╡ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА) рдХреЛ рджрд┐рдЦрд╛рддреА рд╣реИред  рдХреИрдбрд╡рд╛рдЗрдЬрд░ рдЯреВрд▓ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрд╕рд╛рдзрди рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рдлрд╛рдЗрд▓ рдХреЛ рдкреЛрд▓ рдХрд░рддрд╛ рд╣реИред  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдХреЛрд░ рдпрд╛ рдХреИрдбрд╡рд╛рдЗрдЬрд░ рдХреБрдЫ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ: <br><br> <code>theojulienne@kube-node-bad ~ $ time cat /sys/fs/cgroup/memory/memory.stat &gt;/dev/null <br> <br> real 0m0.153s <br> user 0m0.000s <br> sys 0m0.152s <br> theojulienne@kube-node-bad ~ $</code> <br> <br>  рдЕрдм рд╣рдо рдмрдЧ рдХреЛ рдкреБрди: рдкреЗрд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рдордЭ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдкреИрдереЛрд▓реЙрдЬреА рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░ рд░рд╣рд╛ рд╣реИред <br><br><h1>  рдЗрддрдирд╛ рдзреАрдорд╛ рдкрдврд╝рдиреЗ рд╕реЗ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ? </h1><br>  рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░, рд╕рдорд╛рди рдореБрджреНрджреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рд╕реЗ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ, рдХреИрдбрд╡рд╛рдЗрдЬрд░ рдЯреНрд░реИрдХрд░ рдореЗрдВ рдЗрд╕ рдмрдЧ рдХреЛ <a href="https://github.com/google/cadvisor/issues/1774">рдЕрддреНрдпрдзрд┐рдХ рд╕реАрдкреАрдпреВ рдЙрдкрдпреЛрдЧ рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЗ</a> рд░реВрдк рдореЗрдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рдерд╛, рдмрд╕ рдХрд┐рд╕реА рдиреЗ рдзреНрдпрд╛рди рдирд╣реАрдВ рджрд┐рдпрд╛ рдХрд┐ рджреЗрд░реА рднреА рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдЯреИрдХ рдореЗрдВ рдмреЗрддрд░рддреАрдм рдврдВрдЧ рд╕реЗ рдкрд░рд┐рд▓рдХреНрд╖рд┐рдд рд╣реБрдИ рдереАред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рджреЗрдЦрд╛ рдЧрдпрд╛ рдХрд┐ рдХреИрдбрд╡рд┐рд╕рд░ рдЙрдореНрдореАрдж рд╕реЗ рдЕрдзрд┐рдХ рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕рдордп рдХрд╛ рдЙрдкрднреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдмрд╣реБрдд рдорд╣рддреНрд╡ рдирд╣реАрдВ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░реЗ рд╕рд░реНрд╡рд░ рдореЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕рдВрд╕рд╛рдзрди рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдордиреЗ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рдЕрдзреНрдпрдпрди рдирд╣реАрдВ рдХрд┐рдпрд╛ред <br><br>  рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдирд┐рдпрдВрддреНрд░рдг рд╕рдореВрд╣ (cgroups) рдиреЗрдорд╕реНрдкреЗрд╕ (рдХрдВрдЯреЗрдирд░) рдХреЗ рдЕрдВрджрд░ рдореЗрдореЛрд░реА рдЙрдкрдпреЛрдЧ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реИрдВред  рдЬрдм рдЗрд╕ cgroup рдореЗрдВ рд╕рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддреА рд╣реИрдВ, рддреЛ Docker рдореЗрдореЛрд░реА рдХреЗ рдПрдХ рдирд┐рдпрдВрддреНрд░рдг рд╕рдореВрд╣ рдХреЛ рдореБрдХреНрдд рдХрд░ рджреЗрддрд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдБрдХрд┐, "рдореЗрдореЛрд░реА" рдХреЗрд╡рд▓ рдПрдХ рдкреНрд░реЛрд╕реЗрд╕ рдореЗрдореЛрд░реА рдирд╣реАрдВ рд╣реИред  рд╣рд╛рд▓рд╛рдБрдХрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдореЛрд░реА рд╕реНрд╡рдпрдВ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рд╣реИ, рдлрд┐рд░ рднреА рдпрд╣ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдХрд░реНрдиреЗрд▓ рдХреИрд╢реНрдб рд╕рд╛рдордЧреНрд░реА, рдЬреИрд╕реЗ рдбреЗрдВрдЯреНрд░реА рдФрд░ рдЗрдиреЛрдбреЗрд╕ (рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдФрд░ рдлрд╝рд╛рдЗрд▓ рдореЗрдЯрд╛рдбреЗрдЯрд╛) рднреА рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдХрд┐ рдореЗрдореЛрд░реА рдХреЙрдЧреНрд░реБрдк рдореЗрдВ рдХреИрд╢реНрдб рд╣реЛрддреЗ рд╣реИрдВред  рд╕рдорд╕реНрдпрд╛ рдХреЗ рд╡рд░реНрдгрди рд╕реЗ: <br><br><blockquote>  cgroups рд▓рд╛рд╢: рдЙрди рд╕рдореВрд╣реЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдирдореЗрдВ рдХреЛрдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдореЗрдореЛрд░реА рдЕрднреА рднреА рдЖрдмрдВрдЯрд┐рдд рд╣реИ (рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдбреЗрдВрдЯреНрд░реА рдХреИрд╢ рд╕реЗ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдкреЗрдЬ рдХреИрд╢ рдпрд╛ tmpfs рд╕реЗ рднреА рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)ред </blockquote><br>  рдХреИрд╢ рдореЗрдВ рд╕рднреА рдкреЗрдЬреЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░рддреЗ рд╕рдордп рдЬрдм cgroup рдХреЛ рдореБрдХреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдмрд╣реБрдд рдзреАрдорд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрд▓рд╕реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЪреБрдирд╛ рдЬрд╛рддрд╛ рд╣реИ: рдЗрди рдкреЗрдЬреЛрдВ рдХреЗ рджреЛрдмрд╛рд░рд╛ рдЕрдиреБрд░реЛрдз рдХрд┐рдП рдЬрд╛рдиреЗ рддрдХ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ, рдФрд░ рдЬрдм рдореЗрдореЛрд░реА рдХреА рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ, рддрдм рднреА рдЕрдВрдд рдореЗрдВ cgroup рдХреЛ рд╕рд╛рдлрд╝ рдХрд░реЗрдВред  рдЕрдм рддрдХ, рдЖрдБрдХрдбрд╝реЗ рдПрдХрддреНрд░ рдХрд░рддреЗ рд╕рдордп cgroup рдХреЛ рдЕрднреА рднреА рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рдЙрдиреНрд╣реЛрдВрдиреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рд╕реНрдореГрддрд┐ рдХрд╛ рдмрд▓рд┐рджрд╛рди рдХрд┐рдпрд╛: рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕рдлрд╛рдИ рдореЗрдВ рддреЗрдЬреА рдЖрдИ рдХрд┐ рдереЛрдбрд╝реА рд╕реА рд╕реНрдореГрддрд┐ рдмрдиреА рд╣реБрдИ рд╣реИред  рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╣реИред  рдЬрдм рдХрд░реНрдиреЗрд▓ рдХреИрд╢реНрдб рдореЗрдореЛрд░реА рдХреЗ рдЕрдВрддрд┐рдо рднрд╛рдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддреЛ cgroup рдЕрдВрддрддрдГ рд╕рд╛рдлрд╝ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ "рд▓реАрдХ" рдирд╣реАрдВ рдХрд╣рд╛ рдЬрд╛ рд╕рдХрддрд╛ред  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдЗрд╕ рдХрд░реНрдиреЗрд▓ рд╕рдВрд╕реНрдХрд░рдг (4.9) рдореЗрдВ <code>memory.stat</code> рдЦреЛрдЬ рддрдВрддреНрд░ рдХрд╛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди, рд╣рдорд╛рд░реЗ рд╕рд░реНрд╡рд░ рдкрд░ рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рдореЗрдореЛрд░реА рдХреЗ рд╕рд╛рде рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕ рддрдереНрдп рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдирд╡реАрдирддрдо рдХреИрд╢реНрдб рдбреЗрдЯрд╛ рдФрд░ рд╕реНрдкрд╖реНрдЯ cgroup рд▓рд╛рд╢ рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╕рдордп рд▓рдЧрддрд╛ рд╣реИред <br><br>  рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реЗ рдХреБрдЫ рдиреЛрдбреНрд╕ рдкрд░ рдЗрддрдиреЗ рд╕рд╛рд░реЗ cgroup рд▓рд╛рд╢ рдереЗ рдХрд┐ рдкрдврд╝рдирд╛ рдФрд░ рд╡рд┐рд▓рдВрдмрддрд╛ рдПрдХ рд╕реЗрдХрдВрдб рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ рдЧрдИред <br><br>  рдХреИрдбрд╡рд┐рд╕рд░ рд╕рдорд╕реНрдпрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдорд╛рдзрд╛рди рд╣реИ рдХрд┐ рдкреВрд░реЗ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдбреЗрдВрдЯреНрд░реА / рдЗрдиреЛрдбреЗрд╕ рдХреИрд╢ рдХреЛ рддреБрд░рдВрдд рд╕рд╛рдлрд╝ рдХрд░реЗрдВ, рдЬреЛ рд╣реЛрд╕реНрдЯ рдкрд░ рдиреЗрдЯрд╡рд░реНрдХ рд╡рд┐рд▓рдВрдмрддрд╛ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рд░реАрдб рд▓реЗрдЯреЗрдВрд╕реА рдХреЛ рддреБрд░рдВрдд рд╕рдорд╛рдкреНрдд рдХрд░ рджреЗрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХреИрд╢ рдХреЛ рд╣рдЯрд╛рдиреЗ рд╕реЗ cgroup рдЬрд╝реЛрдВрдмреА рдХреИрд╢реНрдб рдкреЗрдЬ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдФрд░ рд╡реЗ рднреА рдореБрдХреНрдд рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред  рдпрд╣ рдПрдХ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рд╕рдорд╕реНрдпрд╛ рдХреЗ рдХрд╛рд░рдг рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддрд╛ рд╣реИред <br><br>  рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рдХрд░реНрдиреЗрд▓ рдХреЗ рдирдП рд╕рдВрд╕реНрдХрд░рдгреЛрдВ (4.19+) рдиреЗ <code>memory.stat</code> рдХреЙрд▓ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд┐рдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рдХрд░реНрдиреЗрд▓ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рд╕реЗ рд╕рдорд╕реНрдпрд╛ рдареАрдХ рд╣реЛ рдЧрдИред  рдЙрд╕реА рд╕рдордп, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рд╕рдореВрд╣реЛрдВ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ рдиреЛрдбреНрд╕ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг рдереЗ, рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд╕реВрдЦрд╛ рдФрд░ рд░рд┐рдмреВрдЯ рдХрд░ рд░рд╣реЗ рдереЗред  рд╣рдордиреЗ рд╕рднреА рд╕рдореВрд╣реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдВрдШреА рдХреА, рдиреЛрдбреНрд╕ рдХреЛ рдкрд░реНрдпрд╛рдкреНрдд рдЙрдЪреНрдЪ рд╡рд┐рд▓рдВрдм рдХреЗ рд╕рд╛рде рдкрд╛рдпрд╛ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд░рд┐рдмреВрдЯ рдХрд┐рдпрд╛ред  рдЗрд╕рд╕реЗ рд╣рдореЗрдВ рдмрд╛рдХреА рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ OS рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдорд┐рд▓ рдЧрдпрд╛ред <br><br><h1>  рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рджреЗрдирд╛ </h1><br>  рдЪреВрдВрдХрд┐ рдЗрд╕ рдмрдЧ рдиреЗ рд╕реИрдХрдбрд╝реЛрдВ рдорд┐рд▓реАрд╕реЗрдХрдВрдб рдХреЗ рд▓рд┐рдП рдПрдирдЖрдИрд╕реА рдЖрд░рдПрдХреНрд╕ рдХрддрд╛рд░реЛрдВ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд░реЛрдХ рджрд┐рдпрд╛, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдиреЗ рдЫреЛрдЯреЗ рдХрдиреЗрдХреНрд╢рди рдкрд░ рдПрдХ рдмрдбрд╝реА рджреЗрд░реА рдФрд░ рдХрдиреЗрдХреНрд╢рди рдХреЗ рдмреАрдЪ рдореЗрдВ рджреЗрд░реА, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, MySQL рдкреНрд░рд╢реНрдиреЛрдВ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреИрдХреЗрдЯ рдХреЗ рдмреАрдЪред <br><br>       ,   Kubernetes,            .    Kubernetes    . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi477390/">https://habr.com/ru/post/hi477390/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi477378/index.html">рдорд┐рд╢реНрд░рд┐рдд рдЪреБрд╕реНрдд - рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╕рдордп рдЭрд░рдирд╛ рджреГрд╖реНрдЯрд┐рдХреЛрдг (рдЙрд░реНрдл рдЪрдВрдЪрд▓ рдХреА рддрд░рд╣)</a></li>
<li><a href="../hi477382/index.html">рдПрд╕реНрдкреЛрд░реНрдЯреНрд╕ - рд▓рд╛рдн рдХрдорд╛рдирд╛: рдорд░реНрд╕рд┐рдбреАрдЬ, рдореЗрдЧрд╛рдлреЛрди, рдПрд╕реНрдкреЛрд░реНрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рд╕рдЯреНрдЯреЗрдмрд╛рдЬреА рдФрд░ рдмреНрд░рд╛рдВрдбрд┐рдВрдЧ</a></li>
<li><a href="../hi477384/index.html">рд╕рдореНрдореЗрд▓рди тАЬрд╕реВрдЪрдирд╛ рд╕реБрд░рдХреНрд╖рд╛ред рд╡рд░реНрддрдорд╛рди рдФрд░ рднрд╡рд┐рд╖реНрдп рдХреЗ рдЦрддрд░реЗ тАЭ</a></li>
<li><a href="../hi477386/index.html">рд╕реБрд░рдХреНрд╖рд╛ рд╕рдкреНрддрд╛рд╣ 48: рд╡рд┐рд╢рд╛рд▓ рдбреЗрдЯрд╛ рд▓реАрдХ рдФрд░ рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк рдХрдордЬреЛрд░рддрд╛</a></li>
<li><a href="../hi477388/index.html">NILFS2 - рдмреБрд▓реЗрдЯрдкреНрд░реВрдл рдлрд╝рд╛рдЗрд▓ рдкреНрд░рдгрд╛рд▓реА / рдШрд░ рдХреЗ рд▓рд┐рдП</a></li>
<li><a href="../hi477392/index.html">рдУрдкрди рдорд╛рдЗрдХреНрд░реЛрдлреЛрди: рдмреИрдХрдПрдВрдбред рд╣рдо рд╡рдХреНрддрд╛рдУрдВ рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi477396/index.html">рдПрдХ рдХреЛрд░реНрд╕ рдореЗрдВ рдирд╛рдорд╛рдВрдХрди рдХреИрд╕реЗ рдХрд░реЗрдВ рдФрд░ ... рдЕрдВрдд рдореЗрдВ рдЬрд╛рдПрдВ</a></li>
<li><a href="../hi477400/index.html">рдЙрддреНрдкрд╛рдж рдкреНрд░рдмрдВрдзрдХ рдХреЗ рдкреЗрд╢реЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ: рдЖрджрд░реНрд╢ рдХреИрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ?</a></li>
<li><a href="../hi477402/index.html">рдкрд╛рдпрд╕ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рдХреЗрд░рд╕ рдбреАрдк рд▓рд░реНрдирд┐рдВрдЧ рдореЙрдбрд▓ рдХреА рддреИрдирд╛рддреА</a></li>
<li><a href="../hi477404/index.html">C ++ рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдЕрдХреНрд╕рд░ рдмрдирд╛рдиреЗ рдФрд░ рд╣рдЯрд╛рдиреЗ рдХреА рд╕рдорд╕реНрдпрд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>