<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∞üèæ üëÜüèº ‚úíÔ∏è Como transformar um hub USB ‚Äúcenten√°rio‚Äù em um gerenciado de forma inteligente e economizar US $ 300 ü§∂üèæ ‚òòÔ∏è ‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De alguma forma, eu precisava de um hub por um longo tempo, de prefer√™ncia com um grande n√∫mero de portas e com um formato bastante conveniente, adequ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como transformar um hub USB ‚Äúcenten√°rio‚Äù em um gerenciado de forma inteligente e economizar US $ 300</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430220/"><p>  De alguma forma, eu precisava de um hub por um longo tempo, de prefer√™ncia com um grande n√∫mero de portas e com um formato bastante conveniente, adequado para incorpora√ß√£o em vez de uma unidade de disquete no compartimento de 3,5 ''.  Uma r√°pida olhada no mercado de pulgas lan√ßou o modelo D-link DUB-H7, e mesmo na combina√ß√£o de "2 pelo pre√ßo de 1".  A inspe√ß√£o externa n√£o deu nada de especial, o hub como um hub foi feito de maneira s√≥lida, a principal "impressora" USB AM-BM na parte traseira e uma fonte de alimenta√ß√£o 3 A.  Como sempre, a primeira coisa que resolvi foi o prazer de um pequeno n√∫mero de lugares vazios em vez de elementos, juntamente com solda de alta qualidade e acalmados.  √â verdade que, por via das d√∫vidas, fui √† Internet para ver que tipo de hub era e se havia algum projeto interessante com sua participa√ß√£o.  N√£o houve projetos, an√°lises de usu√°rios 50/50, em geral, nenhuma din√¢mica.  O hub por 5-7 anos funcionou razoavelmente bem e executou sua tarefa, depois foi movido suavemente para a lixeira eletr√¥nica e, possivelmente, teria desaparecido como resultado, juntamente com adaptadores, adaptadores etc. desconhecidos. Mas aconteceu um evento na minha vida que me fez remexer em sacos com lixo velho, encontrar esse, como se viu, um D-link √∫nico e sacudir a poeira para extra√≠-lo para a luz de Deus.  Se voc√™ estiver interessado em ouvir o porqu√™, ent√£o seja bem-vindo ao corte. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/3a7/fdf/977/3a7fdf977a4d085c2fcb08c4491a000f.gif" alt="piscar piscar"><a name="habracut"></a><br><h4>  Introdu√ß√£o ou choro sobre os fabricantes gananciosos de hubs usb </h4><br><p>  Com o advento de roteadores SoC pequenos e convenientes (como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Guia para modificar o clone do popular mini-roteador chin√™s Hame A15, que tamb√©m √© ‚ÄúA5-V11 sem marca‚Äù</a> ), e a introdu√ß√£o generalizada de openwrt para gerenciar dispositivos host (na grande maioria) casos, s√£o dispositivos conectados via USB), a tarefa de controlar a fonte de alimenta√ß√£o de todos os tipos de modems, leitores de cart√µes, conversores usb-rs232 etc. torna-se uma tarefa muito urgente.A necessidade de controlar a porta ao trabalhar com o GSM-mo √© mais comum  emami (para reiniciar, por exemplo).  Em princ√≠pio, o povo j√° tomou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">decis√µes</a> suficientes.  Para esses fins, desde o uso de pinos GPIO gratuitos no roteador at√© rel√©s prontos.  Existem solu√ß√µes de fabricantes de terceiros.  Este √©, por exemplo, um hub USB program√°vel para 4 portas do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Acroname</a> , rico em software e hardware, mas custa cerca de US $ 300. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5cb/cdd/540/5cbcdd5404d816d47e2a6917b9639f98.jpg" alt="imagem"></div><br><p>  Existe uma op√ß√£o mais barata, um hub inteligente selecion√°vel com o belo nome <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Yupkit YKUSH</a> por apenas 35 ‚Ç¨: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f0d/7f4/44d/f0d7f444dbf40fd96967cd8a4900d783.png" alt="imagem"></div><br><p>  Os mais econ√¥micos podem usar um monte de hub usb mais barato, rel√© de 5V normalmente fechado, e qualquer um do Arduino-k para desconectar a energia da porta usb, se necess√°rio.  O custo dessa solu√ß√£o √© &lt;$ 10, excluindo o tempo gasto na soldagem e programa√ß√£o do Arduino. </p><br><p>  Parece um beco sem sa√≠da.  Caro e bonito, ou simplesmente liso e <s>arrogante</s> .  Mas aconteceu que existe uma terceira op√ß√£o.  Al√©m disso, a solu√ß√£o √© antiga, como a <a href="https://web.archive.org/web/20120207112406/" rel="nofollow">especifica√ß√£o USB 2.0</a> para hubs nos quais √© descrita. </p><br><div class="spoiler">  <b class="spoiler_title">Trechos das especifica√ß√µes relacionadas ao gerenciamento de energia USB</b> <div class="spoiler_text"><p>  Os hubs de alimenta√ß√£o autom√°tica podem ter interruptores de energia que controlam a entrega de energia a jusante nas portas, mas isso n√£o √© necess√°rio.  Os hubs alimentados por barramento precisam ter interruptores de energia.  Um hub com comutadores de energia pode alternar energia para todas as portas como um grupo / grupo, para cada porta individualmente ou ter um n√∫mero arbitr√°rio de grupos de uma ou mais portas.  Um hub indica se ele suporta ou n√£o a comuta√ß√£o de energia pela configura√ß√£o do campo Logical Power Switching Mode em wHubCharacteristics.  Se um hub suportar comuta√ß√£o de energia por porta, a energia de uma porta ser√° ligada quando uma solicita√ß√£o SetPortFeature (PORT_POWER) for recebida para a porta.  A energia da porta √© desligada quando a porta est√° nos estados Desligado ou N√£o configurado.  Se um hub suportar comuta√ß√£o de energia em grupo, a energia de todas as portas em um grupo ser√° ativada quando qualquer porta em um grupo receber uma solicita√ß√£o SetPortFeature (PORT_POWER).  A energia para um grupo n√£o √© desligada, a menos que todas as portas de um grupo estejam nos estados Desligado ou N√£o configurado. <br>  ... <br>  Embora um hub com alimenta√ß√£o pr√≥pria n√£o seja necess√°rio para implementar a comuta√ß√£o de energia, o hub deve suportar o estado Desligado para todas as portas.  Al√©m disso, o hub deve implementar o PortPwrCtrlMask (todos os bits configurados para 1B), mesmo que o hub n√£o possua interruptores de energia que possam ser controlados pelo USB System Software. </p></div></div><br><p>  Traduzindo para o russo, verifica-se que o padr√£o USB j√° define a capacidade de controlar a energia da porta usando o chamado  <b>Comuta√ß√£o de energia por porta (PPPS)</b> , mas atender a um dispositivo compat√≠vel com esse recurso n√£o √© apenas dif√≠cil, mas muito dif√≠cil.  Para implementar o PPPS-funcional, s√£o necess√°rios componentes adicionais (transistores de efeito de campo e fia√ß√£o), que n√£o s√£o instalados nos hubs para economizar dinheiro. </p><br><p>  Reagindo sensivelmente √†s demandas do mercado, alguns fabricantes indicam a fun√ß√£o PPPS nas especifica√ß√µes dos hubs, mas, na realidade, isso n√£o vai al√©m da inscri√ß√£o na caixa.  E, basicamente, √© dif√≠cil encontrar falhas, porque muitos chips dentro dos hubs suportam essa fun√ß√£o, mas √© imposs√≠vel implement√°-la sem comutadores adicionais (transistores) (na maioria das vezes as portas USB est√£o diretamente conectadas √† linha + 5V). </p><br><p>  At√© desmontei v√°rios pequenos hubs USB que planejava usar junto com o roteador A5-V11.  Dentro estavam: o chip <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">GL850G</a> e o amado pelos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">FE1.1s</a> chineses.  Naturalmente, apenas os pr√≥prios controladores com um m√≠nimo de detalhes foram encontrados no interior.  Devido ao tamanho miniatura da placa, √© dif√≠cil colocar um transistor e as pe√ßas que se uniram a ela, mesmo com uma instala√ß√£o articulada.  Eu tive que me acalmar.  Embora, dependendo do chip, se na folha de dados houver uma men√ß√£o <i>√† detec√ß√£o de sobrecorrente e controle de pot√™ncia individual ou agrupado</i> , √© poss√≠vel realizar uma opera√ß√£o inteligente de um dispositivo desse tipo, de acordo com o m√©todo descrito no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">artigo</a> .  Um amigo usou uma combina√ß√£o de transistor e v√°rios resistores para ativar a fun√ß√£o PPPS em seu hub. </p><br><div class="spoiler">  <b class="spoiler_title">Esquema de altera√ß√£o e apar√™ncia do dispositivo</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/0b1/202/831/0b1202831fd6a456a90f8ab01c9ed48e.jpg" alt="imagem"><br><img src="https://habrastorage.org/getpro/habr/post_images/a5d/e65/b11/a5de65b1118b764b9fda1d32a1fb47f9.jpg" alt="imagem"></div></div><br><p>  Al√©m disso, lendo a documenta√ß√£o, voc√™ se surpreende com o fato de que n√£o h√°, n√£o, e h√° uma men√ß√£o de que o modo de controle de porta pode ser implementado adicionando-se ao circuito algumas AIC1526-0 ou MIC2026 (comutador de distribui√ß√£o de energia de canal duplo). </p><br><div class="spoiler">  <b class="spoiler_title">Esquemas de folhas de dados n√£o deixar√£o de mentir</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vn/vy/ar/vnvyarpe24tec4a6skp0irp8grk.jpeg"><br><img src="https://habrastorage.org/webt/wc/s5/yd/wcs5ydopgtt5n8xwwovr1vbdld8.jpeg"></div></div><br><h4>  Parte do principal ou chegar ao ponto </h4><br><p>  Oprimido por pensamentos sombrios sobre a compra de hubs chineses com funcionalidades desconhecidas ("um porco na hora") e a impossibilidade de verific√°-los preliminarmente, encontrei inadvertidamente um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">artigo</a> sobre como configurar o openwrt para controlar o poder de um hub USB; al√©m disso, o mesmo, abandonado e esquecido <b>D-Link DUB-H7</b> em uma caixa cinza. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b9/3o/hv/b93ohvaf-wfvgk0hy2qltlxldlk.jpeg"></div><br><p>  Depois de estudar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">material,</a> ficou claro que a bordo do hub, al√©m do controlador Philips ISP1521BE bastante avan√ßado, h√° um monte desses mesmos <i>comutadores de distribui√ß√£o de energia de canal duplo</i> AIC1528-0 para comuta√ß√£o de pot√™ncia total.  Embora a julgar pela folha de dados, um chip com um kit m√≠nimo de corpo possa controlar a pot√™ncia das portas downstream (e tamb√©m h√° muitas coisas que n√£o foram implementadas l√°, por exemplo, indicando a atividade da porta upstream usando a tecnologia GoodLink ou um host USB 1.1 para suportar corretamente uma mistura de 2.0 e 1.1 em portas a jusante, etc. etc.). </p><br><p>  A prop√≥sito, para quem decide repetir meu caminho, direi imediatamente que as vers√µes modernas do D-Link DUB-H7 (em um estojo preto brilhante) n√£o s√£o mais t√£o √∫teis quanto as antigas em cinza. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/o8/ll/uc/o8llucurzvykxpwzgd9d9shxh88.jpeg"></div><br><p>  De acordo com as informa√ß√µes do wikidevi.com ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">3</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">4</a> ), h√° v√°rias revis√µes deste hub, com um conjunto diferente de componentes a bordo e de acordo com diferentes funcionalidades (A1 / A5 - ISP1521BE 7 portas, B1-2xGL854G 4 portas, C1 - 2xGL850Z de 4 portas). </p><br><p>  Tamb√©m √© dada aten√ß√£o ao D-Link DUB-H7 porque, al√©m de sua boa funcionalidade, √© tamb√©m a op√ß√£o mais acess√≠vel (em termos de pre√ßo e preval√™ncia) em nossa √°rea.  Dos modelos que podem ser mencionados ao longo do caminho com "comuta√ß√£o de energia por porta", tamb√©m podemos observar, por exemplo, o seguinte: </p><br><ul><li>  Linksys USB2HUB4 Hub USB 2.0. </li><li>  Hub D-Link DFB-H7 Combo </li><li>  Elecom U2H-G4S </li><li>  Sanwa Supply USB-HUB14GPH </li><li>  Targus Inc.  PAUH212 </li><li>  Hawking Technology UH214 </li></ul><br><p>  N√£o tive a chance de procurar os dispositivos mencionados, porque tive sorte com a vers√£o de revis√£o A5.  A verdade √© que agora, se eu tivesse que comprar um hub desse tipo, tentaria encontrar a revis√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">B1</a> , porque, al√©m de controlar a pot√™ncia das portas, o chip no qual ele √© constru√≠do (GL854G) tem algo como o <b>Multi Transaction Translator</b> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bn/cc/bu/bnccbuuo1tpqxp7bq7eob8lloq0.jpeg"></div><br><h4>  A import√¢ncia de ter o MTT (Multi Transaction Translator) em um hub USB </h4><br><p>  Uma pequena digress√£o para explicar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">que √©</a> esse Multi Transaction Translator (MTT) e por que √© t√£o importante e necess√°rio.  Um transmissor de transa√ß√µes (TT) √© um componente importante de qualquer hub de alta velocidade que fornece comunica√ß√£o entre as portas upstream e downstream de um hub, especialmente quando essas portas operam com taxas de dados diferentes.  De fato, o TT separa os dispositivos de baixa e m√©dia velocidade dos de alta velocidade (puramente USB 2.0, por exemplo) e √© respons√°vel por trabalhar nas velocidades USB 1.1. </p><br><p>  O transmissor de opera√ß√£o pode ser de dois tipos - √∫nico (tradutor de transa√ß√£o √∫nica, STT) ou m√∫ltiplo (tradutor de transa√ß√£o m√∫ltipla, MTT).  No caso do STT, um transmissor √© usado para todas as portas e, no caso do MTT, cada porta possui seu pr√≥prio transmissor.  √â claro que a primeira op√ß√£o √© mais barata e mais simples, de onde vem a principal desvantagem dessa op√ß√£o - se v√°rias portas USB 1.1 estiverem conectadas ao hub, todas elas funcionar√£o com um √∫nico gargalo.  Eu acho que voc√™ pode imaginar o que acontecer√° com a velocidade da troca. </p><br><img src="https://habrastorage.org/webt/g7/ei/ba/g7eibabozthfur42lw3je15r_tk.jpeg"><br><p>  Em termos simples, os hubs STT t√™m um limite no n√∫mero de dispositivos que podem ser usados ‚Äã‚Äãsimultaneamente.  Caso contr√°rio, ele estar√° repleto de perda de pacotes devido a conflitos no planejamento da transfer√™ncia de dados, sobrecarregando o hub (especialmente no caso de dispositivos que trocam dados ativamente, como placas de som), etc.  Portanto, √© melhor escolher um hub para focar imediatamente nos dispositivos com MTT e n√£o procurar a causa da instabilidade no trabalho.  Se voc√™ j√° possui um hub, e infelizmente o mesmo aconteceu com o STT, basta verificar cuidadosamente os padr√µes dos dispositivos conectados ao hub e, se poss√≠vel, reduzir o n√∫mero de USB 1.1 conectado a um. </p><br><p>  Infelizmente, a grande maioria dos hubs de baixo custo constru√≠dos com chips de or√ßamento (fe1.1s, GL850G e ISP1521BE do meu hub A5) possui STTs a bordo, mais caros e avan√ßados (GL852G, GL854G (revis√£o B1 do D-link DUB-H7 em discuss√£o), GL3520, VL812, VL813, SMSC USB2514) est√£o executando o MTT. </p><br><p>  Voc√™ pode verificar o tipo de transmissor de opera√ß√£o lendo a folha de dados no chip (mas geralmente os chineses n√£o podem ou n√£o querem dizer a marca do chip) ou conectando o hub ao computador * nix e executando o comando lsusb -v e localizando informa√ß√µes de um servi√ßo relacionado ao hub em estudo (por nome).  A linha <b>DeviceProtocol</b> indicar√° <i>TT simples</i> ou <i>Multi TT</i> .  √â claro que comprar √© melhor apenas com o Multi :) </p><br><div class="spoiler">  <b class="spoiler_title">Descri√ß√£o das caracter√≠sticas do hub emitidas pela equipe lsusb</b> <div class="spoiler_text"><p>  Dispositivo 005 do barramento 001: ID 2001: f103 D-Link Corp.  Hub DUB-H7 USB 2.0 de 7 portas <br>  N√£o foi poss√≠vel abrir o dispositivo, algumas informa√ß√µes estar√£o ausentes <br>  Descritor de dispositivo: <br>  bComprimento 18 <br>  bDescriptorType 1 <br>  bcdUSB 2.00 <br>  Hub bDeviceClass 9 <br>  bDeviceSubClass 0 N√£o utilizado <br>  bDeviceProtocol 1 Single TT <br>  bMaxPacketSize0 64 <br>  idVendor 0x2001 D-Link Corp. <br>  idProduct 0xf103 Hub DUB-H7 USB 2.0 de 7 portas <br>  bcdDevice 1.00 <br>  iManufacturer 0 <br>  iProduct 0 <br>  iSerial 0 <br>  bNumConfigurations 1 <br>  Descritor de configura√ß√£o: <br>  bComprimento 9 <br>  bDescriptorType 2 <br>  wTotalLength 25 <br>  bNumInterfaces 1 <br>  bConfigurationValue 1 <br>  iConfiguration 0 <br>  bmAttributes 0xe0 <br>  Auto-alimentado <br>  Ativa√ß√£o remota <br>  MaxPower 0mA <br>  Descritor de Interface: <br>  bComprimento 9 <br>  bDescriptorType 4 <br>  bInterfaceNumber 0 <br>  bAlternateSetting 0 <br>  bNumEndpoints 1 <br>  Hub bInterfaceClass 9 <br>  bInterfaceSubClass 0 N√£o utilizado <br>  bInterfaceProtocol 0 Hub de velocidade total (ou raiz) <br>  iInterface 0 <br>  Descritor de ponto final: <br>  bComprimento 7 <br>  bDescriptorType 5 <br>  bEndpointAddress 0x81 EP 1 IN <br>  bmAttributes 3 <br>  Interrup√ß√£o do tipo de transfer√™ncia <br>  Tipo de sincroniza√ß√£o nenhum <br>  Dados do tipo de uso <br>  wMaxPacketSize 0x0001 1x 1 bytes <br>  bInterval 12 </p></div></div><br><p>  Quando voc√™ executa o comando <i>lsusb -v -t</i> , pode ver uma estrutura hier√°rquica bastante dos dispositivos usb conectados. </p><br><img src="https://habrastorage.org/webt/qq/yv/7h/qqyv7hfnj27vnwtux7eebnwadia.jpeg"><br><p>  Em vez de lsusb, voc√™ pode usar o utilit√°rio <i>hwinfo</i> com a <i>op√ß√£o --usb</i> (√© aconselh√°vel pr√© <i>-instal√°-</i> lo atrav√©s do <i>sudo apt-get install hwinfo</i> ).  Em seguida, a sa√≠da de informa√ß√µes sobre dispositivos USB ser√° um pouco diferente: </p><br><div class="spoiler">  <b class="spoiler_title">Informa√ß√µes emitidas por hwinfo</b> <div class="spoiler_text"><p>  lab @ lab-G: ~ $ hwinfo --usb <br>  Hub 23: USB 00.0: 10a00 <br>  [Criado em usb.122] <br>  ID exclusivo: zFuK.sOcBcpBDhs4 <br>  ID do pai: k4bc.9T1GDCLyFd9 <br>  ID do SysFS: /devices/pci0000:00/0000:00:1d.7/usb1/1-8/1-8:1.0 <br>  SysFS BusID: 1-8: 1.0 <br>  Classe de hardware: hub <br>  Modelo: "Hub USB 2.0 D-Link DUB-H7 de 7 portas" <br>  Hotplug: USB <br>  Fornecedor: usb 0x2001 "D-Link" <br>  Dispositivo: usb 0xf103 "DUB-H7 7 portas USB 2.0 hub" <br>  Revis√£o: "1.00" <br>  Driver: "hub" <br>  M√≥dulos de driver: "usbcore" <br>  Velocidade: 480 Mbps <br>  Alias ‚Äã‚Äãdo m√≥dulo: "usb: v2001pF103d0100dc09dsc00dp01ic09isc00ip00in00" <br>  Status da configura√ß√£o: cfg = new, avail = yes, need = no, active = unknown <br>  Anexado a: # 21 (Hub) </p></div></div><br><p>  Em geral, descobrimos brevemente os recursos dos dispositivos de baixa velocidade e agora √© hora de passar para a parte do software. </p><br><h4>  Gerenciar a energia da porta USB </h4><br><p>  Direi imediatamente que n√£o consegui encontrar uma maneira de implementar a funcionalidade PPPS em um ambiente Windows (pelo menos por interesse inativo).  O m√°ximo √© ativar / desativar o dispositivo usando o utilit√°rio <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">devcon</a></i> .  Ficarei feliz se um dos leitores corrigir e suplementar.  Enquanto isso, todos os procedimentos s√£o executados no exemplo do Ubuntu (no caso do openwrt - o algoritmo √© semelhante, embora no √∫ltimo tronco j√° deva ser inclu√≠do na "distribui√ß√£o"). </p><br><p>  Portanto, a possibilidade de <i>comuta√ß√£o de energia por porta (PPPS)</i> ou "comuta√ß√£o de energia de porta" √© implementada em hubs <u>com suporte de hardware para</u> essa fun√ß√£o usando o programa <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">hub-ctrl</a></b> ou seu <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">uhubctrl</a></b> descendente.  Vou consider√°-los por sua vez. </p><br><h4>  Hub-ctrl </h4><br><p>  O programa foi escrito pelo engenheiro de <s>combate da independ√™ncia</s> japonesa <b>Niibe Yutaka</b> em 2006.  Mas funciona sem problemas agora.  Para instala√ß√£o, precisamos de qualquer biblioteca * nix e <i>libusb-dev</i> .  Para o Ubuntu 16.04 LTS, o algoritmo √© o seguinte: </p><br><blockquote><pre>  Instale add.  pacotes: sudo apt-get update &amp;&amp; sudo apt-get install libusb-dev git gcc
 Fonte do download: git clone https://github.com/codazoda/hub-ctrl.c
 Compilado com o gcc: cd hub-ctrl.c &amp;&amp; gcc -o hub-ctrl hub-ctrl.c -lusb </pre></blockquote><p>  Se o endere√ßo n√£o estiver dispon√≠vel, voc√™ poder√° baixar manualmente as fontes <a href="" rel="nofollow">daqui</a> ou <a href="" rel="nofollow">daqui</a> e compilar com o comando descrito acima. </p><br><p>  O programa possui uma sintaxe de linha de comando bastante simples que se encaixa na seguinte descri√ß√£o: </p><br><p>  ./ <b>hub-ctrl</b> [{-h HUBNUM |  -b BUSNUM -d DEVNUM}] \ [-P PORT] [{-p [VALUE] |  -l [VALUE]}] <br>  em que HUBNUM - n√∫mero do hub, n√∫mero do barramento BUSNUM, n√∫mero do dispositivo DEVNUM, n√∫mero da porta PORT </p><br><p>  Para descobrir esses par√¢metros, basta executar o comando <i>lsusb</i> : </p><br><img src="https://habrastorage.org/webt/pp/ob/tz/ppobtz0tg81cjzgnvla8ej1vw5s.jpeg"><br><p>  A prop√≥sito, o programa hub-ctrl pode atuar como uma esp√©cie de "sonda" do hub usb pelo fato de ter a capacidade de gerenciar a energia da porta.  √â suficiente execut√°-lo com a op√ß√£o -v.  Temos uma lista de hubs suportados dispon√≠veis no sistema (linha INFO) e o status da porta (no meu caso, todas as portas est√£o desativadas). </p><br><blockquote>  lab @ lab-G: ~ / hub $ sudo ./hub-ctrl -v <br>  Eixo # 0 √†s 00: 006 <br>  INFO: comuta√ß√£o de energia individual. <br>  AVISO: Os indicadores de porta N√ÉO s√£o suportados. <br>  Status da porta do hub: <br>  Porta 1: 0000.0000 <br>  Porta 2: 0000.0000 <br>  Porta 3: 0000.0000 <br>  Porta 4: 0000.0000 <br>  Porta 5: 0000.0000 <br>  Porta 6: 0000.0000 <br>  Porta 7: 0000.0000 </blockquote><p>  E √© assim que a configura√ß√£o ficar√° quando todas as portas estiverem ativadas: </p><br><blockquote>  lab @ lab-G: ~ / hub $ sudo ./hub-ctrl -v <br>  Eixo # 0 √†s 00: 006 <br>  INFO: comuta√ß√£o de energia individual. <br>  AVISO: Os indicadores de porta N√ÉO s√£o suportados. <br>  Status da porta do hub: <br>  Porta 1: energia 0000.0100 <br>  Porta 2: energia 0000.0100 <br>  Porta 3: energia 0000.0100 <br>  Porta 4: energia 0000.0100 <br>  Porta 5: energia 0000.0100 <br>  Porta 6: energia 0000.0100 <br>  Porta 7: energia 0000.0100 </blockquote><p>  Para habilitar qualquer uma das portas, √© necess√°rio executar o <i>comando sudo ./hub-ctrl -h 0 -P 1 -p 1</i> , em que -h indica qual hub estamos usando (o 0¬∫ no meu caso), -P diz qual porta (1- porta no meu caso) e -p indica o status (0 desativado, 1 ativado). </p><br><img src="https://habrastorage.org/webt/ko/4r/wl/ko4rwlpq2_uxinhoukzh-xltvfc.jpeg"><br><p>  Para obter a configura√ß√£o como na figura acima, foi necess√°rio executar os seguintes comandos sequencialmente (para portas inicialmente desativadas): </p><br><p>  sudo ./hub-ctrl -h 0 -P 2 -p 1 <br>  sudo ./hub-ctrl -h 0 -P 4 -p 1 <br>  sudo ./hub-ctrl -h 0 -P 6 -p 1 </p><br><p>  Portanto, n√£o √© dif√≠cil escrever um script que fa√ßa com que os LEDs pisquem por divers√£o na sequ√™ncia desejada.  Exemplos de tais coisas j√° existem e funcionam com sucesso: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">C√≥digo Morse</a> em um hub USB, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">guirlandas de Natal</a> , etc.  etc.  Para mim, pelos recursos do hub-ctrl, a fun√ß√£o de comuta√ß√£o c√≠clica n√£o foi suficiente para realizar minhas fantasias moment√¢neas de ilumina√ß√£o (para n√£o perder tempo escrevendo um script etc.).  Essa falha irritante √© eliminada no sucessor - uhubctl. </p><br><h4>  UHUBCTL </h4><br><p>  O programa uhubctl √© um anal√≥gico hub-ctrl otimizado e possui algumas diferen√ßas est√©ticas (e, √© claro, suporta mais dispositivos). </p><br><div class="spoiler">  <b class="spoiler_title">Com o trabalho uhubctl:</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pn/qg/dw/pnqgdwes-bvg0n35yepl4pjjsp0.jpeg"></div></div><br><p>  Teoricamente, o utilit√°rio pode ser compilado para ser executado em um ambiente Windows, mas ... Mas, por enquanto, ele interage com os utilit√°rios por meio do driver winusb.sys, que n√£o pode acessar o hub diretamente.  O programa tamb√©m reivindica suporte para USB 3.0 (hubs USB 3.0 que suportam comuta√ß√£o de energia por porta, a prop√≥sito, s√£o muito mais que hubs USB 2.0 com funcionalidade semelhante).  Ao trabalhar com um hub USB 3.0 conectado a uma porta upstream USB 3.0, o programa o define como dois hubs virtuais independentes: USB 2.0 e USB 3.0, e os pr√≥prios dispositivos USB ser√£o conectados a um deles, dependendo de seus recursos e velocidade de conex√£o .  Assim, para gerenciar esses dispositivos, o programa habilita / desabilita a energia de hubs virtuais por padr√£o (voc√™ pode alternar o utilit√°rio para o modo manual adicionando a op√ß√£o -e ao comando start). </p><br><p>  <u>Importante: o</u> sistema de endere√ßamento para portas USB pode causar alguma confus√£o (√© semelhante para hub-ctrl e uhubctl).  Ao trabalhar, ele usa o mesmo m√©todo de endere√ßamento semelhante ao do kernel do Linux: bx.yz, em que b √© o n√∫mero do barramento USB e x, y, z s√£o os n√∫meros de porta da cadeia de hosts, come√ßando no hub USB raiz desse barramento.  Se houver mais de um hub USB gerenciado, voc√™ poder√° determinar as op√ß√µes corretas executando uhubctl com a op√ß√£o -l (local).  Observo que esse endere√ßamento √© semi-est√°vel - n√£o ser√° alterado se voc√™ desconectar e reconectar dispositivos USB novamente √† mesma porta f√≠sica. </p><br><p>  O algoritmo de compila√ß√£o do programa √© semelhante ao algoritmo para hub-ctrl.  A √∫nica exce√ß√£o √© que voc√™ precisa instalar a biblioteca libusb-1.0 (vers√£o 1.0.12 ou posterior) com o <i>comando</i> usual <i>sudo apt-get install libusb-1.0-0-dev</i> e compilar o bin√°rio com o comando <i>make</i> . </p><br><p>  A sintaxe para iniciar o programa √© a seguinte. </p><br><p>  uhubctl -a off -p 2 </p><br><p>  Este comando desliga a energia (-a off ou -a 0) na porta 2 (-p 2).  Comandos off / on / cycle suportados (ou 0/1/2).  O interruptor de <i>ciclo</i> desliga a energia, aguarda um pouco (determinado pelo interruptor -d) e liga-o novamente.  I.e.  Agora, o hub pode substituir facilmente o microcontrolador por piscar. </p><br><h4>  O que se segue de tudo isso, ou Conclus√µes </h4><br><p>  E da√≠ resulta que o "segredo" no antigo hub da D-Link est√° l√°.  O uso da tecnologia descrita (PPPS) √© justificado se voc√™ precisar controlar remotamente uma matriz de dispositivos conectados ao barramento USB.  Al√©m disso, esse m√©todo j√° √© usado para desativar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">discos r√≠gidos</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">webcams</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">modems GSM</a> (como na figura): </p><br><img src="https://habrastorage.org/getpro/habr/post_images/d29/99a/e9b/d2999ae9b1938357484853650973e9b0.png" alt="imagem"><br><p>  Embora, como nos modems e no D-link DUB-H7 que mencionei, h√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">pessoas</a> que questionam a operacionalidade de um pacote desse tipo (ao trabalhar com o programa hub-ctrl). </p><br><div class="spoiler">  <b class="spoiler_title">A raz√£o √© que ...</b> <div class="spoiler_text"><p>  "... experimentos usando o Dlink DUB H-7 mostraram que o hub-ctrl -p 0 reduz a tens√£o apenas para 1,47V. No entanto, ap√≥s inserir o modem em uma" porta desativada ", o LED n√£o pisca, mas os arquivos / dev / ttyUSBx para isso    .     .            ." </p></div></div><br><p>     (lsusb, hwinfo, hub-ctrl)        USB-, ,       .           usb- ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> ).     ,   ,       .   , ,    (D-link DUB-H7 ver. A5)           .  , ,  :) </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/s3/5l/vm/s35lvmfuuc9jd67i9gvfk5s67n0.jpeg"></div><br> <b>PS</b>     -,            D-link DUB-H7   . <p></p><br><img src="https://habrastorage.org/webt/_j/jb/pk/_jjbpk6wn6mj9ftl9m2i8wscjgo.jpeg"><br><p>        (   -   )?    RP1...RP2 (     0- c). </p><br><p> <u></u> :   -     EEPROM 24C02,     : </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/67/_w/zm/67_wzmql8dpwcrzyjeybmwvvxaa.jpeg"></div><br><p>  <u>Importante!</u>  Todas as atualiza√ß√µes e notas provis√≥rias a partir das quais os artigos de habr s√£o formados sem problemas podem agora ser vistas no meu <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">laborat√≥rio de</a></b> canais de telegrama66.  Assine para n√£o esperar o pr√≥ximo artigo, mas para saber imediatamente sobre toda a pesquisa :) </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">http://simple-is-beauty.blogspot.com/2017/12/usb-port-control.html</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://askubuntu.com/questions/149242/is-it-possible-to-power-up-ports-on-a-usb-hub-from-ubuntu</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">http://www.ibuyopenwrt.com/index.php/15-yun-compatible/hardware-yun/36-usb-hub-per-port-power-switching-2</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://www.joeldare.com/wiki/usb_powered_animated_christmas_lights</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://michaelbluejay.com/batteries/dc-christmas-lights.html</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://forum.archive.openwrt.org/viewtopic.php?id=49012</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">http://atotto.hatenadiary.jp/entry/linux-sugoi-usb-hub-power-ctrl</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://hant.helplib.com/GitHub/article_111870</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://www.quaxio.com/hub_ctrl/</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://forum.ixbt.com/topic.cgi?id=13:40305-4</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">http://www.cypress.com/file/124006/download</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://github.com/mvp/uhubctl</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">https://github.com/crazystick/py-hub-ctrl</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">http://atc-ip.ru/info/29/1.html</a> </li></ol></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt430220/">https://habr.com/ru/post/pt430220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt430208/index.html">Curso MIT "Seguran√ßa de sistemas de computadores". Palestra 18: ‚ÄúNavega√ß√£o Privada na Internet‚Äù, parte 3</a></li>
<li><a href="../pt430210/index.html">Teste minha paci√™ncia pela Academia de Seguran√ßa Check Point</a></li>
<li><a href="../pt430212/index.html">OpenSceneGraph: No√ß√µes b√°sicas de geometria de cena</a></li>
<li><a href="../pt430216/index.html">Pelo que entendi, como muitos doces ou a classifica√ß√£o de mercadorias, verificando o aplicativo</a></li>
<li><a href="../pt430218/index.html">Otimiza√ß√£o de energia STM32: um guia pr√°tico</a></li>
<li><a href="../pt430222/index.html">Engenheiro S√™nior em busca de trabalho. Como passei por 20 entrevistas com RH e o que penso sobre isso</a></li>
<li><a href="../pt430224/index.html">Transtorno esquizot√≠pico: um olhar por dentro</a></li>
<li><a href="../pt430226/index.html">Da var b √† entrevista</a></li>
<li><a href="../pt430228/index.html">Marcas em forma de X como m√©todo de identifica√ß√£o de radar usando an√°lise de dados abertos de dois sat√©lites cient√≠ficos SENTINEL-1</a></li>
<li><a href="../pt430230/index.html">Como manter seu lugar em uma startup em crescimento</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>