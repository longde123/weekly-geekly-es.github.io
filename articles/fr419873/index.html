<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜  ğŸ˜ ğŸ’« Tester uniquement par des mÃ©thodes publiques est mauvais ğŸ‘¨ğŸ½â€ğŸ’¼ ğŸš ğŸš®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En programmation et en TDD en particulier, il y a de bons principes auxquels il est utile de se conformer: SEC et test par des mÃ©thodes publiques. Ils...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tester uniquement par des mÃ©thodes publiques est mauvais</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419873/">  En programmation et en TDD en particulier, il y a de bons principes auxquels il est utile de se conformer: SEC et test par des mÃ©thodes publiques.  Ils ont fait leurs preuves Ã  plusieurs reprises dans la pratique, mais dans les projets avec un grand code hÃ©ritÃ©, ils peuvent avoir un "cÃ´tÃ© obscur".  Par exemple, vous pouvez Ã©crire du code guidÃ© par ces principes, puis vous retrouver Ã  dÃ©monter des tests couvrant un tas de 20+ abstractions avec une configuration qui est incomparablement plus grande que la logique testÃ©e.  Ce Â«cÃ´tÃ© obscurÂ» fait peur aux gens et empÃªche l'utilisation du TDD dans les projets.  Sous la coupe, je discute pourquoi les tests par des mÃ©thodes publiques sont mauvais et comment rÃ©duire les problÃ¨mes qui se posent en raison de ce principe. <a name="habracut"></a><br><br><div class="spoiler">  <b class="spoiler_title">Clause de non-responsabilitÃ©</b> <div class="spoiler_text"> ImmÃ©diatement, je veux dissiper l'impression possible.  Certains peuvent mÃªme ne pas ressentir les inconvÃ©nients qui seront discutÃ©s, en raison, par exemple, de la taille de leurs projets.  De plus, ces lacunes, Ã  mon avis, font partie de la dette technique et ont les mÃªmes caractÃ©ristiques: le problÃ¨me s'aggravera s'il n'est pas pris en compte.  Par consÃ©quent, il est nÃ©cessaire de dÃ©cider en fonction de la situation. <br></div></div><br>  L'idÃ©e sous-jacente au principe sonne bien: vous devez tester le comportement, pas la mise en Å“uvre.  Cela signifie que vous n'avez qu'Ã  tester l'interface de classe.  En pratique, ce n'est pas toujours le cas.  Pour prÃ©senter l'essence du problÃ¨me, imaginez que vous disposez d'une mÃ©thode qui calcule le coÃ»t des travailleurs engagÃ©s dans le travail postÃ©.  Il sâ€™agit dâ€™une tÃ¢che non triviale en ce qui concerne le travail postÃ©,  ils ont des pourboires, des bonus, des week-ends, des vacances, des rÃ¨gles d'entreprise, etc., etc. Cette mÃ©thode effectue en interne de nombreuses opÃ©rations et utilise d'autres services qui lui donnent des informations sur les vacances, les pourboires, etc.  lors de l'Ã©criture d'un test unitaire pour celui-ci, il est nÃ©cessaire de crÃ©er une configuration pour tous les services utilisÃ©s, si le code testÃ© se situe quelque part Ã  la fin de la mÃ©thode.  Dans le mÃªme temps, le code testÃ© lui-mÃªme ne peut utiliser que partiellement ou pas du tout les services configurables.  Et il y a dÃ©jÃ  des tests unitaires Ã©crits de cette faÃ§on. <br><br><h2>  Moins 1: Surconfiguration du test unitaire </h2><br>  Vous voulez maintenant ajouter une rÃ©action Ã  une nouvelle fonctionnalitÃ© qui a une logique non triviale et qui est Ã©galement utilisÃ©e quelque part Ã  la fin de la mÃ©thode.  La nature de l'indicateur est telle qu'il fait partie de la logique de service et, en mÃªme temps, ne fait pas partie de l'interface de service.  Dans le cas ci-dessus, ce code n'est pertinent que pour cette mÃ©thode publique et peut gÃ©nÃ©ralement Ãªtre inscrit Ã  l'intÃ©rieur de l'ancienne mÃ©thode. <br><br>  Si le projet a adoptÃ© la rÃ¨gle pour tout tester uniquement via des mÃ©thodes publiques, le dÃ©veloppeur peut trÃ¨s probablement simplement copier un test unitaire existant et le modifier un peu.  Dans le nouveau test, il y aura toujours une configuration de tous les services pour exÃ©cuter la mÃ©thode.  D'une part, nous avons respectÃ© le principe, mais, d'autre part, nous avons obtenu un test unitaire avec surconfiguration.  Ã€ l'avenir, si quelque chose se casse ou nÃ©cessite un changement de configuration, vous devrez faire le travail de singe pour ajuster les tests.  Elle est fastidieuse, longue et n'apporte ni joie ni bÃ©nÃ©fice apparent au client.  Il semblerait que nous suivions le bon principe, mais nous sommes dans la mÃªme situation que nous voulions nous Ã©loigner, refusant de tester des mÃ©thodes privÃ©es. <br><br><h2>  Moins 2: Couverture incomplÃ¨te </h2><br>  En outre, un facteur humain tel que la paresse peut intervenir.  Par exemple, une mÃ©thode privÃ©e avec une logique de drapeau non triviale peut ressembler Ã  cet exemple. <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasShifts</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DateTime date, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tolerance, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> clockIn, Shift[] shifts, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] locationIds</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isInLimit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DateTime date1, DateTime date2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit</span></span></span><span class="hljs-function">)</span></span> =&gt; Math.Abs(date2.Subtract(date1).TotalMinutes) &lt;= limit; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shiftsOfLocations = shifts.Where(x =&gt; locationIds.Contains(x.LocationId)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clockIn ? shiftsOfLocations.Any(x =&gt; isInLimit(date, x.StartDate, tolerance)) : shiftsOfLocations.Any(x =&gt; isInLimit(date, x.EndDate, tolerance)); }</code> </pre> <br>  Cette mÃ©thode nÃ©cessite 10 contrÃ´les pour couvrir tous les cas, dont 8 sont significatifs. <br><br><div class="spoiler">  <b class="spoiler_title">DÃ©codage de 8 cas importants</b> <div class="spoiler_text"><ul><li>  shiftsOfLocations - 2 valeurs - que ce soit ou non </li><li>  clockIn - 2 valeurs - vrai ou faux </li><li>  tolÃ©rance - 2 significations diffÃ©rentes </li></ul><br>  Total: 2 x 2 x 2 = 8 <br></div></div><br>  Lors de l'Ã©criture de tests unitaires pour tester cette logique, un dÃ©veloppeur devra Ã©crire au moins 8 grands tests unitaires.  Je suis tombÃ© sur des cas oÃ¹ la configuration de test unitaire a pris plus de 50 lignes de code, avec 4 lignes d'appel direct.  C'est-Ã -dire  seulement environ 10% du code porte une charge utile.  Dans ce cas, la tentation est grande de rÃ©duire la quantitÃ© de travail en Ã©crivant moins de tests unitaires.  Par consÃ©quent, sur 8, par exemple, il ne reste que deux tests unitaires, pour chaque valeur de clockIn.  Cette situation conduit au fait que, encore une fois, il est fastidieux et long d'Ã©crire tous les tests nÃ©cessaires, de crÃ©er la configuration (Ctrl + C, V fonctionne, oÃ¹ serait-il sans), ou la mÃ©thode ne reste que partiellement couverte.  Chaque option a ses consÃ©quences dÃ©sagrÃ©ables. <br><br><h2>  Solutions possibles </h2><br>  En plus du principe "comportement de test", il existe toujours l'OCP (principe ouvert / fermÃ©).  En l'appliquant correctement, vous pouvez oublier ce que sont les Â«tests fragilesÂ», en testant le comportement interne du module.  Si vous avez besoin d'un nouveau comportement de module, vous Ã©crirez de nouveaux tests unitaires pour la nouvelle classe successeur dans laquelle le comportement dont vous avez besoin sera modifiÃ©.  Vous n'aurez alors pas Ã  passer du temps Ã  revÃ©rifier et Ã  mettre Ã  jour les tests existants.  Dans ce cas, cette mÃ©thode peut Ãªtre dÃ©clarÃ©e comme interne ou interne protÃ©gÃ©e et testÃ©e en ajoutant InternalsVisibleTo Ã  l'assembly.  Dans ce cas, votre interface IClass ne souffrira pas, et les tests seront les plus laconiques, non sujets Ã  des changements frÃ©quents. <br><br>  Une autre alternative serait de dÃ©clarer une classe auxiliaire supplÃ©mentaire dans laquelle notre mÃ©thode peut Ãªtre tirÃ©e en la dÃ©clarant publique.  Ensuite, le principe sera observÃ© et le test sera concis.  Ã€ mon avis, cette approche n'est pas toujours payante.  Par exemple, certains peuvent dÃ©cider de tirer mÃªme une mÃ©thode dans une classe, ce qui conduit Ã  la crÃ©ation d'un groupe de classes avec une seule mÃ©thode.  L'autre extrÃªme peut Ãªtre de vider ces mÃ©thodes dans une classe d'assistance, qui se transforme en classe d'assistance GOD.  Mais cette option avec un assistant peut Ãªtre la seule si l'assembly de travail est signÃ© avec un nom fort, et vous ne pouvez pas signer l'assembly de test, pour une raison quelconque.  InternalsVisibleTo fonctionnera lorsque les deux assemblys seront signÃ©s ou pas en mÃªme temps. <br><br><h2>  RÃ©sumÃ© </h2><br>  Et Ã  la fin, en raison d'une combinaison de ces problÃ¨mes, l'idÃ©e de TDD et de tests unitaires souffre, car  personne n'a le dÃ©sir d'Ã©crire des tests volumÃ©triques et de les soutenir.  Je serai heureux de voir des exemples de la faÃ§on dont le strict respect de ce principe a conduit Ã  des problÃ¨mes et Ã  une motivation rÃ©duite pour Ã©crire des tests de l'Ã©quipe de dÃ©veloppement. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419873/">https://habr.com/ru/post/fr419873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419863/index.html">Concours hebdomadaire OpenGift Developer</a></li>
<li><a href="../fr419865/index.html">Comment Ã©crire accidentellement une interface graphique Web pour Haproxy</a></li>
<li><a href="../fr419867/index.html">Six autres mythes sur la blockchain, oÃ¹ sera-t-elle toujours appliquÃ©e</a></li>
<li><a href="../fr419869/index.html">La rÃ©volution de l'IA ne sera pas faite par des droÃ¯des, mais par des grille-pain</a></li>
<li><a href="../fr419871/index.html">Comment Google essaie de dÃ©velopper un moteur de recherche censurÃ© pour la Chine</a></li>
<li><a href="../fr419875/index.html">Encore une fois sur les retards dans le code source du projet FPGA ou une simple question pour un entretien pour un job de dÃ©veloppeur FPGA</a></li>
<li><a href="../fr419877/index.html">Comment nous avons rÃ©inventÃ© la Â«maison intelligenteÂ»</a></li>
<li><a href="../fr419879/index.html">PWA est facile. Bonjour joomla</a></li>
<li><a href="../fr419883/index.html">Obtenez la diffÃ©rence entre les fichiers binaires en utilisant vcdiff</a></li>
<li><a href="../fr419885/index.html">Traduction du livre d'Andrew Un, Passion for Machine Learning, Chapitres 15-19</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>