<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🈯️ 👎🏻 🙅🏼 Vous n'avez peut-être pas besoin de Kubernetes 👱🏿 💴 🥂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fille sur un scooter. Illustration de freepik , logo Nomad par HashiCorp 

 Kubernetes est un gorille de 300 kg pour l'orchestration de conteneurs. Il...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vous n'avez peut-être pas besoin de Kubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445030/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75f/28e/6ba/75f28e6baaf8ddc3293a35e9ba31c9e2.svg"></div><br>  <i><font color="gray">Fille sur un scooter.</font></i>  <i><font color="gray">Illustration de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">freepik</a> , logo Nomad par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HashiCorp</a></font></i> <br><br>  Kubernetes est un gorille de 300 kg pour l'orchestration de conteneurs.  Il fonctionne dans certains des plus grands systèmes de conteneurs au monde, mais coûte cher. <br><br>  Particulièrement cher pour les petites équipes qui doivent consacrer beaucoup de temps au support et à une courbe d'apprentissage abrupte.  Pour notre équipe de quatre, c'est trop de frais généraux.  Nous avons donc commencé à chercher des alternatives - et sommes tombés amoureux de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nomad</a> . <br><a name="habracut"></a><br><h1>  Que veux tu </h1><br>  Notre équipe prend en charge un certain nombre de services typiques de surveillance et d'analyse des performances: points de terminaison API pour les mesures Go, exportation de Prometheus, analyseurs de journaux tels que Logstash et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gollum</a> , ainsi que des bases de données telles que InfluxDB ou Elasticsearch.  Chacun de ces services s'exécute dans son propre conteneur.  Nous avons besoin d'un système simple pour maintenir tout cela opérationnel. <br><br>  Nous avons commencé avec une liste d'exigences pour l'orchestration de conteneurs: <br><br><ul><li>  Lancer un ensemble de services sur de nombreuses machines. <br></li><li>  Présentation des services en cours d'exécution. <br></li><li>  Communication entre services. <br></li><li>  Redémarrage automatique en cas de panne du service. <br></li><li>  Maintenance des infrastructures par une petite équipe. </li></ul><br>  De plus, les éléments suivants seront intéressants, mais pas obligatoires: <br><br><ul><li>  Marquage des machines en fonction de leurs capacités (par exemple, marquage des machines à disques rapides pour les services d'E / S lourds). <br></li><li>  La capacité d'exécuter des services indépendamment de l'orchestre (par exemple, pendant le développement) <br></li><li>  Un lieu commun pour partager des configurations et des secrets. <br></li><li>  Point de terminaison pour les métriques et les journaux. </li></ul><br><h1>  Pourquoi Kubernetes ne nous convient pas </h1><br>  Lors de la création d'un prototype avec Kubernetes, nous avons remarqué que nous commencions à ajouter des couches de logique de plus en plus complexes, sur lesquelles nous nous appuyions inconditionnellement. <br><br>  Par exemple, Kubernetes prend en charge les configurations de service <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">intégrées</a> via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ConfigMaps</a> .  Vous pouvez vous perdre rapidement, en particulier lors de la fusion de plusieurs fichiers de configuration ou de l'ajout de services supplémentaires au module.  Kubernetes (ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">barre</a> dans ce cas) vous permet d'implémenter dynamiquement des configurations externes pour séparer les intérêts.  Mais cela conduit à une connexion secrète entre votre projet et Kubernetes.  Cependant, Helm et ConfigMaps sont des options supplémentaires, vous n'avez donc pas à les utiliser.  Vous pouvez simplement copier la configuration dans l'image Docker.  Néanmoins, il est tentant de suivre cette voie et de construire des abstractions inutiles, que vous pouvez regretter plus tard. <br><br>  De plus, l'écosystème Kubernetes se développe rapidement.  Il faut beaucoup de temps et d'énergie pour rester à jour avec les meilleures pratiques et les derniers outils.  Kubectl, minikube, kubeadm, helm, tiller, kops, oc - la liste s'allonge encore et encore.  Au début du travail, tous ces outils ne sont pas nécessaires, mais vous ne savez pas ce qui est nécessaire, vous devez donc être au courant de tout.  Pour cette raison, la courbe d'apprentissage est assez abrupte. <br><br><h1>  Quand utiliser Kubernetes </h1><br>  Dans notre entreprise, beaucoup utilisent Kubernetes et en sont très satisfaits.  Ces instances sont gérées par Google ou Amazon, qui disposent de ressources d'assistance suffisantes. <br><br>  Kubernetes est livré avec des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctionnalités incroyables</a> qui le rendent plus gérable et une orchestration de conteneurs à grande échelle: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gestion</a> détaillée des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">droits</a> . <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les contrôleurs personnalisés</a> ajoutent une logique au cluster.  Ce ne sont que des programmes qui communiquent avec l'API Kubernetes. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Autoscaling</a> !  Kubernetes peut faire évoluer les services à la demande à l'aide de mesures de service sans nécessiter d'intervention manuelle. </li></ul><br>  La question est de savoir si vous avez vraiment besoin de toutes ces fonctionnalités.  Vous ne pouvez pas simplement compter sur l’abstraction;  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous devez savoir ce qui se passe sous le capot</a> . <br><br>  Notre équipe fournit la plupart des services à distance (en raison de la connexion étroite avec l'infrastructure principale), nous ne voulions donc pas développer notre propre cluster Kubernetes.  Nous voulions simplement fournir des services. <br><br><h1>  Piles non incluses </h1><br>  Nomad représente 20% de l'orchestration, ce qui donne 80% du nécessaire.  Tout ce qu'il fait, c'est gérer les déploiements.  Nomad s'occupe des déploiements, redémarre les conteneurs en cas d'erreur ... et c'est tout. <br><br>  L'intérêt de Nomad est qu'il fait un <i>minimum</i> : aucune gestion détaillée des droits ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">politiques réseau avancées</a> n'est conçue de manière si spéciale.  Ces composants sont fournis par ou pas du tout fournis. <br><br>  Je pense que Nomad a trouvé le compromis parfait entre facilité d'utilisation et utilité.  Il convient aux petits services indépendants.  Si vous avez besoin de plus de contrôle, vous devrez les augmenter vous-même ou utiliser une approche différente.  Nomad n'est <i>qu'un</i> orchestre. <br><br>  La meilleure chose à propos de Nomad est qu'il est facile <i>à remplacer</i> .  Il n'y a pratiquement pas de lien avec le fournisseur, car ses fonctions sont facilement intégrées dans tout autre système qui gère les services.  Cela fonctionne comme un binaire ordinaire sur chaque machine d'un cluster, c'est tout! <br><br><h1>  Écosystème nomade de composants faiblement couplés </h1><br>  La vraie puissance de Nomad dans son écosystème.  Il s'intègre très bien avec d'autres produits - complètement facultatifs - tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Consul</a> (stockage de valeurs-clés) ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vault</a> (traitement des secrets).  À l'intérieur du fichier Nomad, il existe des sections pour extraire des données de ces services: <br><br><pre><code class="plaintext hljs">template { data = &lt;&lt;EOH LOG_LEVEL="{{key "service/geo-api/log-verbosity"}}" API_KEY="{{with secret "secret/geo-api-key"}}{{.Data.value}}{{end}}" EOH destination = "secrets/file.env" env = true }</code> </pre> <br>  Ici, nous lisons la clé de <code>service/geo-api/log-verbosity</code> de Consul et dans le processus, nous la représentons avec la variable d'environnement <code>LOG_LEVEL</code> .  Nous représentons également la <code>secret/geo-api-key</code> de Vault en tant que <code>API_KEY</code> .  Simple mais puissant! <br><br>  En raison de sa simplicité, Nomad est facilement extensible via d'autres services via l'API.  Par exemple, les balises des tâches sont prises en charge.  Nous marquons tous les services avec des métriques avec la <code>trv-metrics</code> .  Ainsi, Prometheus trouve facilement ces services via Consul et vérifie périodiquement le point final <code>/metrics</code> pour de nouvelles données.  La même chose peut être faite, par exemple, pour les journaux utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Loki</a> . <br><br>  Il existe de nombreux autres exemples d'extensibilité: <br><br><ul><li>  Exécution du travail Jenkins avec un hook, et Consul suit le redéploiement du travail Nomad lorsque la configuration du service change. <br></li><li>  Ceph ajoute un système de fichiers distribué à Nomad. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fabio</a> pour l'équilibrage de charge. </li></ul><br>  Tout cela vous permet de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">développer organiquement l'infrastructure</a> sans aucune obligation particulière pour le vendeur. <br><br><h1>  Avertissement honnête </h1><br>  Aucun système n'est parfait.  Je ne recommande pas d'introduire immédiatement les dernières fonctionnalités en production.  Bien sûr, il y a des bugs et des fonctionnalités manquantes, mais il en va de même pour Kubernetes. <br><br>  Comparée à Kubernetes, la communauté Nomade n'est pas si grande.  Kubernetes compte déjà environ 75 000 commits et 2 000 contributeurs, tandis que Nomad a environ 14 000 commits et 300 contributeurs.  Nomad aura du mal à suivre la vitesse de Kubernetes, mais ce n'est peut-être pas nécessaire!  Il s'agit d'un système plus spécialisé, et une communauté plus petite signifie également que votre demande d'extraction est plus susceptible d'être remarquée et acceptée que Kubernetes. <br><br><h1>  Résumé </h1><br>  Conclusion: n'utilisez pas Kubernetes simplement parce que tout le monde le fait.  Évaluez soigneusement vos besoins et vérifiez quel outil est le plus rentable. <br><br>  Si vous prévoyez de déployer une tonne de services homogènes sur une infrastructure à grande échelle, alors Kubernetes est une bonne option.  N'oubliez pas la complexité et les coûts de maintenance supplémentaires.  Certains coûts peuvent être évités en utilisant un environnement Kubernetes géré tel que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Google Kubernetes Engine</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Amazon EKS</a> . <br><br>  Si vous cherchez juste un orchestrateur fiable, facile à prendre en charge et extensible, pourquoi ne pas essayer Nomad?  Vous vous demandez peut-être jusqu'où cela vous mènera. <br><br>  Si vous comparez Kubernetes avec une voiture, Nomad sera un scooter.  Parfois, vous en avez besoin, et parfois un autre.  Les deux ont le droit d'exister. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr445030/">https://habr.com/ru/post/fr445030/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr445020/index.html">Des scientifiques polonais ont imprimé le premier pancréas bionique au monde avec des vaisseaux</a></li>
<li><a href="../fr445022/index.html">Comment je me suis fait des amis PlayStation 2 et PlayStation Portable (spoiler - combiné en un seul émulateur)</a></li>
<li><a href="../fr445024/index.html">Transformez DSLogic Basic en DSLogic Plus</a></li>
<li><a href="../fr445026/index.html">Modèle de la connexion des atomes en molécules</a></li>
<li><a href="../fr445028/index.html">Stéthoscope intelligent - un projet de démarrage de l'accélérateur de l'Université ITMO</a></li>
<li><a href="../fr445034/index.html">LockerGoga: que s'est-il passé exactement avec Norsk Hydro</a></li>
<li><a href="../fr445036/index.html">Quel a été le premier iPhone?</a></li>
<li><a href="../fr445038/index.html">Fuites d'informations classifiées trouvées dans 100 000 référentiels sur GitHub</a></li>
<li><a href="../fr445040/index.html">Nous construisons des modèles, «vendons» la gestion des connaissances à la direction et corrige l'erreur du survivant</a></li>
<li><a href="../fr445042/index.html">Succès Delphic d'un programmeur d'Ulan-Ude</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>