<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ»â€ğŸš’ ğŸ‡ğŸ¾ ğŸ”± Beralih dari mesin virtual ke wadah LXC: alasan, keunggulan, dan instruksi yang siap digunakan ğŸ’¤ ğŸ˜¥ ğŸŒŠ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apa yang akan kita bicarakan: 

 - Mengapa kami memutuskan untuk beralih ke wadah LXC? 
 - Bagaimana cara membuat wadah dan menjalankan host berbasis ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Beralih dari mesin virtual ke wadah LXC: alasan, keunggulan, dan instruksi yang siap digunakan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458658/">  <b>Apa yang akan kita bicarakan:</b> <br><br>  - Mengapa kami memutuskan untuk beralih ke wadah LXC? <br>  - Bagaimana cara membuat wadah dan menjalankan host berbasis Bitrix di atasnya? <br><br>  <b>Untuk siapa ini akan bermanfaat:</b> <br><br>  Untuk semua orang yang ingin mencoba solusi baru, sambil menggunakan lebih sedikit sumber daya. <br><a name="habracut"></a><br><h2>  Manfaat LXC Dibandingkan Mesin Virtual </h2><br>  Kami beralih ke wadah ketika kami mengalami kekurangan sumber daya server, kesulitan membedakan hak akses untuk proyek yang berbeda, dan konflik perangkat lunak dalam satu mesin virtual.  Berikut adalah beberapa manfaat utama LXC dibandingkan mesin virtual: <br><br><ol><li>  Lebih sedikit kehilangan kinerja CPU, operasi disk, dan RAM.  Hampir semua yang tersedia di wadah berfungsi dengan kecepatan server. </li><li>  Tidak perlu mengalokasikan RAM untuk kernel OS, memori video, buffer disk, dll. </li><li>  Mulai cepat.  Bahkan, hanya aplikasi yang diluncurkan yang diperlukan agar wadah berfungsi. </li><li>  Ini mendukung peluncuran aplikasi individual dalam wadah, bukan sistem lengkap.  Lebih mudah bahwa akses dapat diberikan hanya dengan menambahkan pengguna (daripada chroot), karena kami hanya memiliki satu proyek dalam wadah (ada beberapa di mesin virtual). </li><li>  Kemampuan untuk mengelola sumber daya dari setiap wadah. </li><li>  Pindahkan kontainer antar server dengan cepat dan mudah. </li></ol><br>  Kami menggunakan rsync.  Cukup buat wadah dengan nama yang sama di server baru dan salin: <br><br><pre><code class="plaintext hljs">rsync -alvz :/var/lib/lxd/container/test/ /var/lib/lxd/container/test/</code> </pre> <br>  Kita perlu menguraikan paragraf kelima dan berbicara tentang manajemen sumber daya.  Kita harus menyediakan wadah dengan jumlah sumber daya yang cukup untuk pekerjaan, dan pada saat yang sama memastikan bahwa wadah tidak akan mengkonsumsi sumber daya yang tidak perlu, sehingga mengganggu pekerjaan seluruh sistem. <br><br>  Anda dapat melihat statistik konsumsi sumber daya dengan perintah: lxc info test <br><br><pre> <code class="plaintext hljs">Remote: unix:// : x86_64 : 2018/12/04 14:27 UTC Status: Running Type: persistent : default Pid: 28317 IPs: eth0: inet 172.27.2.204 vethF91F2U Resources: : 56 CPU usage:   ( ): 20583 Memory usage: Memory (current): 1.03GB Memory (peak): 3.11GB Network usage: eth0:  : 17.45GB  : 9.93GB</code> </pre><br>  Menurut statistik ini, Anda dapat melacak berapa banyak sumber daya yang dikonsumsi sebuah wadah dan, jika perlu, membatasi konsumsinya menggunakan perintah khusus: <br><br><ul><li>  lxc config atur batas tes.memory 2048M # atur batas memori. </li><li>  lxc config atur batas tes.cpu 1,2,3,8 # ikat wadah ke inti CPU. </li><li>  lxc config atur cpu.allowance 10% # batas konsumsi CPU. </li><li>  config lxc set ukuran root tes 50GB # membatasi jumlah ruang disk yang digunakan oleh kontainer (hanya bekerja dengan ZFS atau btrfs). </li><li>  konfigurasi lxc dapatkan batas pengujian.memory - lihat nilai batas yang ditetapkan </li></ul><br>  Hasilnya, wadah memungkinkan Anda mengambil lusinan wadah di desktop yang sangat standar, sambil mempertahankan kinerja yang memadai. <br><br><h2>  Kami mengkonfigurasi server dan mentransfer host standar dengan Bitrix dari mesin virtual ke wadah </h2><br>  <b>1. Pengaturan server</b> <br><br>  1.1 Instal versi terbaru dari server Ubuntu 18.04 di server.  Sudah memiliki LXD.  LXD adalah tambahan untuk LXC, sebuah hypervisor yang menyederhanakan interaksi dengan sistem containerisasi. <br>  1.2 <b>apt install bridge-utils</b> # install bridge-utils <br>  1,3 <b>lxd init</b> # menginisialisasi lxd <br>  1.4 <b>lxc edit profil default</b> # edit file profil: <br><br><pre> <code class="plaintext hljs">devices: eth0: name: eth0 nictype: bridged parent: br0 type: nic root: path: / pool: default type: disk name: default</code> </pre><br>  <b>1,5 lxc launch ubuntu: 04/18 test #</b> buat sebuah wadah bernama test.  Dia akan mengunduh gambar, membuat dan meluncurkannya.  Ini menyelesaikan konfigurasi dan pembuatan wadah, kemudian lanjutkan untuk mengkonfigurasi wadah dan mentransfer host ke dalamnya. <br><br>  <b>2. Host kontainer konfigurasi dan migrasi situs</b> <br><br>  2.1 <b>lxc exec test / bin / bash #</b> Pergi ke wadah yang dibuat. <br>  2.2 <b>add-apt-repository ppa: ondrej / php #</b> Add a repository. <br>  2.3 <b>pembaruan tepat #</b> Perbarui repositori. <br>  2,4 <b>apt install</b> <br>  <b>php7.1 {fpm, bcmath, bz2, cli, umum, curl, dev, enchant, fpm, gd, gmp, imap, intl, json,</b> <b><br></b>  <b>ldap, mbstring, mcrypt, mysql, odbc, opcache, phpdbg, pspell, readline, recode, sabun,</b> <b><br></b>  <b>rapi, xml, xmlrpc, xsl, zip} #</b> Instal php dan semua modul yang diperlukan untuk bitrix. <br>  2,5 <b>apt install nginx #</b> Instal nginx. <br>  2,6 <b>vim /etc/netplan/50-cloud-init.yaml #</b> Jadikan ip statis: <br><br><pre> <code class="plaintext hljs">network: version: 2 ethernets: eth0: addresses: [172.27.2.108/16] gateway4: 172.27.0.1 nameservers: addresses: [172.27.1.1] dhcp4: false</code> </pre> <br>  2.7 Salin konfigurasi php dan nginx dari mesin virtual kami, periksa apakah semuanya dimulai dan berfungsi. <br>  2.8 Kami mentransfer seluruh situs dari mesin virtual kami.  Sebagai contoh: <br><br>  <b>rsync -alvz Virtual lama: / var / www / / var / www /</b> <br><br>  <b>3. Membuat wadah terpisah untuk basis data</b> <br><br>  3.1 Ulangi langkah 1 <b>.5, 2.1 dan 2.6</b> , beri nama wadah misalnya test-db. <br>  3,2 <b>apt install mysql-server #</b> instal database <br>  3,3 <b>apt install pv #</b> Instal PV untuk melihat kemajuan ketika kami mengunggah database. <br><br>  <b>4. Menyiapkan server database baru</b> <br><br>  Untuk memulai, kami mengumpulkan informasi dari server lama: <br><br>  4.1 Kami membutuhkan pengguna dan lulus dari database yang diinginkan. <br>  4.2 <b>mysql -u test -p'test '-e "tampilkan buat database testDB;"</b>  <b>#</b> Cari tahu bagaimana database dibuat (apa yang perlu kita sorot): <br><br><pre> <code class="plaintext hljs">mysql: [Warning] Using a password on the command line interface can be insecure. +----------+--------------------------------------------------------------------------+ | Database | Create Database | +----------+--------------------------------------------------------------------------+ | demoshop | &lt;b&gt;CREATE DATABASE `demoshop` /*!40100 DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci */ |&lt;/b&gt; +----------+--------------------------------------------------------------------------+</code> </pre> <br>  4.3 <b>mysqldump -ER --single-transaction --quick testDB |</b>  <b>gzip&gt; testDB.sql.gz #</b> Jalankan perintah ini di server tempat database kami berada.  Dia akan membuang dan mengompresnya ke arsip. <br><br>  Kami akan pergi ke database baru kami dan melakukan tindakan berikut: <br><br>  4.4 <b>rsync -alvz DB lama: / root / testDB.sql.gz / root / #</b> transfer arsip dengan dump ke kontainer kami. <br>  4.5 <b>mysql #</b> Ayo pergi ke database kami <br>  4.5.1 <b>BUAT PENGGUNA 'pengguna' @ '%' DIIDENTIFIKASI OLEH 'pass';</b>  <b>#</b> buat pengguna dan kata sandi yang sama. <br>  4.5.2 Dari paragraf 4.2, kita memasukkan perintah: <b>CREATE DATABASE `DBName` / *! 40100 SET KARAKTER DEFAULT utf8 COLLATE utf8_unicode_ci * /</b> ; <br>  4.5.3 <b>PEMBERI SEMUA HAK ISTIMEWA PADA nama DB. * UNTUK 'pengguna' @ '%' DIIDENTIFIKASI oleh 'lulus';</b>  <b>#</b> Kami akan memberikan hak ke database kami. <br>  4.6 Kami keluar dari database dan menjalankan konsol wadah: <b>pv testDB.sql.gz | zcat |</b>  <b>mysql testDB # Isi</b> dump ke database kami <br><br>  <b>5. Verifikasi</b> <br><br>  5.1 Ubah parameter menghubungkan ke database, tunjukkan IP baru dari database kami. <br>  5.2 Setelah itu, situs harus terbuka melalui IP atau DNS, tergantung pada konfigurasi Anda. <br><br><h2>  Kesimpulan </h2><br>  Dengan demikian, wadah LXC membantu kami mengurangi konsumsi sumber daya server uji dan menyesuaikan lebih banyak host pada satu server, sambil mempertahankan kemampuan mengelola sumber daya yang dikonsumsi masing-masing host dengan nyaman.  Sekarang Anda memiliki instruksi siap pakai yang menunjukkan betapa mudahnya mengimplementasikannya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id458658/">https://habr.com/ru/post/id458658/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id458646/index.html">Atom Swap Singkatnya</a></li>
<li><a href="../id458648/index.html">CI / CD dengan AWS dan Bambu</a></li>
<li><a href="../id458650/index.html">Tantangan Dunia Maya. Tingkat baru. Persaingan online dari Rostelecom Solar</a></li>
<li><a href="../id458652/index.html">RamblerFront & Meetup # 7</a></li>
<li><a href="../id458654/index.html">Virus Lurk meretas bank ketika ditulis oleh pekerja sewaan biasa</a></li>
<li><a href="../id458660/index.html">Gangguan Penggunaan Perangkat Lunak Gangguan Layanan Cloudflare</a></li>
<li><a href="../id458662/index.html">EMI berencana untuk memperkenalkan tes drone pesawat</a></li>
<li><a href="../id458666/index.html">Otak bodoh, emosi tersembunyi, algoritma berbahaya: evolusi pengenalan wajah</a></li>
<li><a href="../id458670/index.html">Bagaimana prosesor dirancang dan diproduksi: masa depan arsitektur komputer</a></li>
<li><a href="../id458672/index.html">20 pertanyaan untuk ditanyakan perusahaan IT sebelum berganti pekerjaan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>