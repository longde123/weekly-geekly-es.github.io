<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüî¨ üêÖ üôåüèæ Argumentar: depois de ler at√© o fim, voc√™ entender√° como e por que exatamente o GC funciona üë¥üèæ ü¶ó üßóüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eu direi imediatamente: nunca espero uma resposta detalhada a esta pergunta sobre seguran√ßa social. Isso √© est√∫pido e, no meu caso, ego√≠sta. No entant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Argumentar: depois de ler at√© o fim, voc√™ entender√° como e por que exatamente o GC funciona</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/clrium/blog/464169/"><p> Eu direi imediatamente: nunca espero uma resposta detalhada a esta pergunta sobre seguran√ßa social.  Isso √© est√∫pido e, no meu caso, ego√≠sta.  No entanto, na minha opini√£o, al√©m do interesse geral na plataforma, √© muito √∫til saber como ela funciona, porque  isso remove uma s√©rie de problemas.  Por exemplo, exclui a op√ß√£o quando o desenvolvedor acredita que <code>Dispose</code> √© chamado automaticamente e voc√™ n√£o precisa cham√°-lo.  Ou, se o desenvolvedor √© mais experiente, ajuda-o automaticamente, no n√≠vel da mem√≥ria muscular, a escrever um c√≥digo que leve ao menor n√∫mero de problemas. </p><br><p>  Outra quest√£o que eu realmente n√£o gosto subjetivamente √© como o trabalho dele √© explicado.  Portanto, proponho uma abordagem alternativa descrita em meu livro, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">.NET Platform Architecture</a> . </p><br><p>  Se quisermos entender completamente por que esses dois algoritmos de gerenciamento de mem√≥ria foram escolhidos: Sweep e Compact, teremos que considerar dezenas de algoritmos de gerenciamento de mem√≥ria existentes no mundo: come√ßando com dicion√°rios comuns e terminando com estruturas livres de bloqueios muito complexas.  Em vez disso, deixando nossos pensamentos sobre o que √© √∫til, simplesmente <em>justificamos a</em> escolha e, assim, <em>entendemos</em> por que a escolha foi feita dessa maneira.  N√£o olhamos mais para o livreto de lan√ßamento do booster: temos em nossas m√£os um conjunto completo de documenta√ß√£o. </p><br><p>  A disputa √© mutuamente ben√©fica: se n√£o estiver claro, corrigirei os pontos pouco claros do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">livro</a> , uma pequena parte do qual √© o texto fornecido. </p><br><p><img src="https://habrastorage.org/webt/sv/sw/_g/svsw_gfzggr2i1wk94ah_itbmqi.jpeg"></p><a name="habracut"></a><br><blockquote>  Escolhi o formato do racioc√≠nio para que voc√™ sinta que os arquitetos da plataforma e eu chegamos √†s mesmas conclus√µes que os arquitetos reais chegaram na sede da Microsoft em Redmond. </blockquote><p>  Com base na classifica√ß√£o de objetos alocados com base em seu tamanho, √© poss√≠vel dividir o espa√ßo para aloca√ß√£o de mem√≥ria em duas se√ß√µes grandes: um local com objetos dimensionados abaixo de um determinado limite e um local com um tamanho acima desse limite e ver que diferen√ßa pode ser feita no gerenciamento desses grupos (com base em tamanho) e o que resulta disso. </p><br><p>  Se considerarmos o gerenciamento de objetos " <em>pequenos</em> " convencionalmente, podemos ver que, se aderirmos √† id√©ia de armazenar informa√ß√µes sobre cada objeto, ser√° muito caro mantermos estruturas de dados de gerenciamento de mem√≥ria que armazenar√£o links para cada um desses objetos.  No final, pode acontecer que, para armazenar informa√ß√µes sobre um objeto, voc√™ precise de tanta mem√≥ria quanto o pr√≥prio objeto.  Em vez disso, voc√™ deve considerar: se durante a coleta de lixo dan√ßamos desde as ra√≠zes, aprofundando o gr√°fico nos campos de sa√≠da do objeto, e precisamos de uma passagem linear ao longo da pilha apenas para identificar objetos de lixo, precisamos armazenar informa√ß√µes sobre cada objeto nos algoritmos de gerenciamento de mem√≥ria?  A resposta √© √≥bvia: n√£o h√° necessidade disso.  Portanto, podemos tentar prosseguir com o fato de que n√£o devemos armazenar essas informa√ß√µes: podemos passar por um monte linearmente, conhecendo o tamanho de cada objeto e movendo o ponteiro a cada vez pelo tamanho do pr√≥ximo objeto. </p><br><blockquote>  N√£o h√° estruturas de dados adicionais no heap que cont√™m ponteiros para cada objeto que o heap controla. </blockquote><p>  No entanto, quando n√£o precisamos mais de mem√≥ria, devemos liber√°-la.  E ao liberar mem√≥ria, torna-se dif√≠cil confiar na passagem linear da pilha: ela √© longa e n√£o √© eficaz.  Como resultado, chegamos √† conclus√£o de que precisamos armazenar informa√ß√µes de alguma forma sobre √°reas de mem√≥ria livre. </p><br><blockquote>  A pilha possui listas de mem√≥ria livre. </blockquote><p>  Se, como decidimos, armazenar informa√ß√µes sobre √°reas livres e, ao liberar mem√≥ria, essas √°reas eram muito pequenas, primeiro chegamos ao mesmo problema de armazenar informa√ß√µes sobre √°reas livres que encontramos ao considerar √°reas ocupadas (se nas laterais do objeto ocupado foi liberado, para armazenar informa√ß√µes sobre ele, √© necess√°rio, na pior das hip√≥teses, 2/3 do seu tamanho. Ponteiro + tamanho versus SyncBlockIndex + VMT + algum campo - no caso do objeto).  Isso novamente parece um desperd√≠cio, voc√™ deve admitir: nem sempre √© boa sorte liberar um grupo de objetos que se seguem.  Geralmente, eles s√£o liberados de maneira ca√≥tica.  Mas, diferentemente dos sites ocupados, que n√£o precisamos pesquisar linearmente, precisamos procurar sites gratuitos porque, quando alocamos mem√≥ria, podemos precisar deles novamente.  Portanto, surge um desejo completamente natural de reduzir a fragmenta√ß√£o e espremer a pilha, movendo todas as √°reas ocupadas para locais livres, formando assim uma grande √°rea da √°rea livre onde a mem√≥ria pode ser alocada. </p><br><blockquote>  √â da√≠ que surge a id√©ia do algoritmo de compacta√ß√£o. </blockquote><p>  Mas espere, voc√™ diz.  Afinal, esta opera√ß√£o pode ser muito dif√≠cil.  Imagine que voc√™ liberou um objeto no in√≠cio do heap.  E o que, voc√™ diz, voc√™ precisa mover tudo?  Bem, √© claro, voc√™ pode sonhar com o assunto de instru√ß√µes vetoriais da CPU, que voc√™ pode usar para copiar uma enorme √°rea ocupada de mem√≥ria.  Mas este √© apenas o come√ßo do trabalho.  Tamb√©m devemos corrigir todos os ponteiros dos campos de objetos para objetos que foram submetidos a movimentos.  Esta opera√ß√£o pode demorar muito tempo.  N√£o, devemos proceder de outra coisa.  Por exemplo, dividindo todo o segmento da mem√≥ria heap em setores e trabalhando com eles separadamente.  Se trabalharmos separadamente em cada setor (para previsibilidade e escalabilidade dessa previsibilidade - de prefer√™ncia tamanhos fixos), a ideia de compacta√ß√£o n√£o parece t√£o pesada: basta compactar um √∫nico setor e voc√™ pode come√ßar a falar sobre o tempo necess√°rio para compactar um desses setores . </p><br><p>  Agora resta entender em que base se dividir em setores.  Aqui devemos nos voltar para a segunda classifica√ß√£o, que √© introduzida na plataforma: compartilhamento de mem√≥ria, com base no tempo de vida de seus elementos individuais. </p><br><p>  A divis√£o √© simples: se considerarmos que alocaremos mem√≥ria √† medida que os endere√ßos aumentarem, os primeiros objetos selecionados se tornar√£o os mais antigos e aqueles que estiverem nos endere√ßos seniores se tornar√£o os mais jovens.  Al√©m disso, sendo inteligente, voc√™ pode concluir que, nos aplicativos, os objetos s√£o divididos em dois grupos: aqueles criados para vida longa e aqueles criados para viver muito pouco.  Por exemplo, para armazenar temporariamente ponteiros para outros objetos na forma de uma cole√ß√£o.  Ou os mesmos objetos DTO.  Consequentemente, de tempos em tempos, espremendo um monte, obtemos v√°rios objetos de vida longa - nos endere√ßos mais baixos e v√°rios de vida curta - nos idosos. </p><br><blockquote>  Assim, recebemos <em>gera√ß√µes</em> . </blockquote><p>  Dividindo a mem√≥ria em gera√ß√µes, temos a oportunidade de observar com menos frequ√™ncia os objetos da gera√ß√£o mais velha, que est√£o se tornando cada vez mais. </p><br><p>  Mas surge outra quest√£o: se tivermos apenas duas gera√ß√µes, teremos problemas.  Ou tentaremos fazer o GC funcionar sem m√°scara rapidamente: depois do tamanho da gera√ß√£o mais jovem, tentaremos fazer o tamanho m√≠nimo.  Como resultado, os objetos falhar√£o acidentalmente na gera√ß√£o mais antiga (se o GC funcionasse "no momento, durante uma furiosa aloca√ß√£o de mem√≥ria para muitos objetos").  Ou, para minimizar falhas acidentais, aumentaremos o tamanho da gera√ß√£o mais jovem.  Em seguida, o GC da gera√ß√£o mais jovem funcionar√° por tempo suficiente, desacelerando e desacelerando o aplicativo. </p><br><p>  A sa√≠da √© a introdu√ß√£o da gera√ß√£o "intermedi√°ria".  Adolescente.  Em outras palavras, se voc√™ vive at√© a adolesc√™ncia, √© mais prov√°vel que viva at√© a velhice.  A ess√™ncia de sua introdu√ß√£o √© alcan√ßar um equil√≠brio entre <em>obter a menor gera√ß√£o mais jovem</em> e a <em>gera√ß√£o</em> <em>mais est√°vel</em> , onde √© melhor n√£o tocar em nada.  Esta √© uma zona em que o destino dos objetos ainda n√£o foi decidido.  A primeira gera√ß√£o (n√£o esque√ßa o que pensamos do zero) tamb√©m √© criada pequena e o GC parece menos frequente l√°.  O GC permite, assim, que os objetos que est√£o na primeira gera√ß√£o tempor√°ria n√£o entrem na gera√ß√£o mais antiga, que √© extremamente dif√≠cil de coletar. </p><br><blockquote>  Ent√£o, tivemos a ideia de tr√™s gera√ß√µes. </blockquote><p>  A pr√≥xima camada de otimiza√ß√£o √© uma tentativa de recusar a compacta√ß√£o.  Afinal, se voc√™ n√£o fizer isso, nos livraremos de uma enorme camada de trabalho.  Vamos voltar √† quest√£o dos sites gratuitos. </p><br><p>  Se depois de termos usado toda a mem√≥ria dispon√≠vel no heap e o GC tiver sido chamado, existe um desejo natural de recusar a compacta√ß√£o em favor da aloca√ß√£o de mem√≥ria adicional nas se√ß√µes liberadas, se o tamanho delas for suficiente para acomodar um certo n√∫mero de objetos.  Aqui chegamos √† id√©ia de um segundo algoritmo para liberar mem√≥ria no GC, chamado <code>Sweep</code> : n√£o compactamos mem√≥ria, usamos vazios de objetos liberados para colocar novos objetos </p><br><blockquote>  Ent√£o, descrevemos e justificamos todos os conceitos b√°sicos dos algoritmos de GC. </blockquote><p>  Ent√£o, depois de dois dias, podemos tirar algumas conclus√µes.  Pelo que entendi, a maioria das pessoas entende a maior parte do texto, ou mesmo o todo.  Algumas pessoas responderam que n√£o entendiam, outras, respectivamente, entendiam parcialmente.  A disputa foi vencida por uma equipe de leitores, embora com uma ligeira margem, como eles dizem.  Mas, como eu disse, todos ser√£o beneficiados com isso: o texto ser√° alterado e complementado.  Al√©m disso, atualizado nos dois lugares: no livro e aqui, no artigo. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/97f/1d3/cf0/97f1d3cf0e2a6bf007066eb60a789c31.png"></a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt464169/">https://habr.com/ru/post/pt464169/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt464151/index.html">Victor Vyalichkin: ‚ÄúLiberdade, igualdade, fraternidade est√£o apenas no OpenStreetMap, onde tudo est√° sempre √† vista‚Äù</a></li>
<li><a href="../pt464155/index.html">IA ajuda a estudar animais na √Åfrica</a></li>
<li><a href="../pt464161/index.html">SPAM e GDRP - como fazer listas de discuss√£o "l√°"?</a></li>
<li><a href="../pt464163/index.html">Esta palavra-chave em JavaScript. Manual completo *</a></li>
<li><a href="../pt464165/index.html">Habr Weekly # 14 / Sobre as regras de comunica√ß√£o em bate-papos em grupo, monop√≥lios e a prote√ß√£o de crian√ßas contra informa√ß√µes perigosas</a></li>
<li><a href="../pt464171/index.html">Seguran√ßa de atualiza√ß√£o de software</a></li>
<li><a href="../pt464173/index.html">"Galera amaldi√ßoada", ou onde as pernas crescem do escrit√≥rio choramingando</a></li>
<li><a href="../pt464177/index.html">O livro "Kotlin. Programa√ß√£o para profissionais "</a></li>
<li><a href="../pt464179/index.html">Um standup no Yandex.Taxi ou O que voc√™ precisa ensinar ao desenvolvedor de back-end</a></li>
<li><a href="../pt464181/index.html">Poco - Automa√ß√£o da interface do usu√°rio baseada em Python para jogos para celular como parte do AirTest IDE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>