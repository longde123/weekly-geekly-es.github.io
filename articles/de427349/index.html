<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé± üî´ üöî Programmierer f√ºr die neue tinyAVR-Familie basierend auf dem billigen chinesischen Konverter CH340 üåû üåÉ üë©üèº‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Unified Program and Debug Interface (UPDI) ist eine Ein-Draht-Schnittstelle zum Programmieren / Debuggen der neuen 8-Bit-Atmel-Mikrocontroller und...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Programmierer f√ºr die neue tinyAVR-Familie basierend auf dem billigen chinesischen Konverter CH340</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427349/">  <b>Die Unified Program and Debug Interface (UPDI)</b> ist eine Ein-Draht-Schnittstelle zum Programmieren / Debuggen der neuen 8-Bit-Atmel-Mikrocontroller und ersetzt die Zwei-Draht-PDI-Schnittstelle, die zum Programmieren der AVR XMEGA-Mikrocontroller verwendet wird. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x1/v9/de/x1v9denhm5w_uof2zxytpawurka.png" alt="Bild"></div><a name="habracut"></a><br>  Also kam das Regiment der Atmelovsk-Protokolle - ISP, JTAG, debugWIRE, TPI, aWire, PDI, jetzt ist hier UPDI.  Gleichzeitig ist die √ñkosystemsituation bei AVR immer noch sehr hoffnungslos, so dass wir ihre Verwendung vollst√§ndig aufgeben wollten, aber der neueste Trend hat uns ein wenig erfreut, weshalb dieser Artikel geschrieben wurde. <br><br>  Nur die gl√ºcklichen Besitzer des Atmel ICE-Programmierger√§ts k√∂nnen das UPDI-Protokoll verwenden, das aufgrund der ziemlich seltsamen Wahl des Steckverbinders nicht sehr bequem zu verwenden ist und dessen Kauf im industriellen Ma√üstab nicht so billig ist.  Dar√ºber hinaus ist die Installation von Atmel Studio erforderlich, das sich regelm√§√üig weigert, damit zu arbeiten, da gem√§√ü den Richtlinien unseres Unternehmens die meisten Computer keinen Zugang zum Internet haben und das Studio daher regelm√§√üig entweder nach Treibern oder nach einigen Bibliotheken durchsucht Momente, in denen der Programmierer im System sichtbar war, dh die Treiber wurden korrekt installiert, aber er wurde vom Studio selbst erst bemerkt, als es Zugriff auf das Netzwerk erhielt und nicht gewaltsam aktualisiert wurde. <br><br>  Unmittelbar nachdem wir begonnen hatten, den neuen und recht praktischen ATTiny1616-Mikrocontroller in unseren Entwicklungen zu verwenden (√ºber seine Vorteile sp√§ter), bestand daher ein Bedarf an einem Tool, mit dem wir in der Produktion auf den Bootloader-Controller schreiben konnten.  Nat√ºrlich ohne <s>SMS und Registrierung des</s> Internetzugangs. <br><br>  Nach einigem Suchen entdeckte ich das pyupdi-Projekt auf <b>Github</b> (https://github.com/mraardvark/pyupdi) - eine Implementierung des UPDI-Protokolls in Python, und diese Implementierung basiert auf dem √ºblichen UART-Protokoll, au√üer ohne Pegelkonverter, die tats√§chlich Noch praktischer, da Sie damit Standard-FTDI-Konverterchips oder deren chinesische Gegenst√ºcke CH340 / 341 verwenden k√∂nnen. <br><br>  Das Projekt wurde heruntergeladen und getestet, die Dinge liefen recht fr√∂hlich.  Aber nach ein paar Tagen wurde klar, dass er immer noch nicht ganz zu uns passte.  Gr√ºnde: <br><br><ul><li>  Die Installation von Python und einer ganzen Gruppe von Paketen ist erforderlich (ich erinnere Sie daran, dass es sich um Computer ohne Internetzugang handelt). Ich musste fast ein Dutzend verschiedener Pakete herunterladen und manuell installieren, die sich gegenseitig mit Abh√§ngigkeiten verbunden haben.  Ja, im Prinzip k√∂nnen Sie aus einem Python-Skript eine ausf√ºhrbare Datei auf einem anderen Computer erstellen. Dadurch wurde das Problem irgendwie gel√∂st, aber die Liste der Probleme endete nicht dort </li><li>  Es gibt fast keine Fehlerpr√ºfung im Skript. Jeder Fehler endet mit einem Interrupt, der auf eine Reihe von Dateien hinweist, die miteinander verkn√ºpft sind, was f√ºr normale Mitarbeiter nicht sehr klar aussieht </li><li>  Es ist unm√∂glich, den Inhalt des Speichers der Steuerung zu lesen, was es unm√∂glich macht, den Schreibvorgang zu beenden </li><li>  Sicherung kann nicht gelesen werden </li><li>  Die Geschwindigkeit des Skripts l√§sst zu w√ºnschen √ºbrig, 16 kb werden fast eine Minute lang geschrieben, dies ist auf das Fehlen jeglicher Optimierung w√§hrend der √úbertragung zur√ºckzuf√ºhren, alles basiert auf engen Timings </li><li>  fehlende Angabe des Aufnahmevorgangs </li><li>  Das Projekt unterst√ºtzt keine Reihe von Prozessoren, die dies unterst√ºtzen k√∂nnten </li><li>  Das Projekt ist halb tot und reagiert nicht auf Anfragen </li></ul><br>  Die Probleme wurden f√ºr einige Zeit im Rahmen von Python gel√∂st, aber nach jeder Korrektur musste ich das Projekt neu zusammensetzen, testen, damit der Wunsch bestand, das Skript auf etwas Vertrauteres und Schnelleres, dh in C, umzuschreiben.  Wir sind schlie√ülich Einbetter! <br><br>  Nun kurz zu den Vorteilen der neuen tinyAVR 1-Serie: <br><br><ul><li>  echte Vereinheitlichung von Peripherieger√§ten und Adressraum innerhalb von 2 kb bis 32 kb </li><li>  bequeme Bootloader-Konfiguration (am Anfang des Speichers!) </li><li>  signifikante Vereinfachung des ISP-Algorithmus (In-System-Programming) </li><li>  √úbergang zur von Neumann-Architektur </li><li>  Bis zu 32 kb Flash-Speicher in einem kleinen Geh√§use (3 x 3 mm) mit 24 Pins, von denen bis zu 22 (!) als E / A verwendet werden k√∂nnen </li><li>  das Vorhandensein eines internen Oszillators bei 16/20 MHz </li><li>  geringere Abh√§ngigkeit der Leistung von der Konfiguration der Sicherungen (Perpetual Headache AVR) </li><li>  ausgezeichneter analoger Teil f√ºr einen kleinen Controller (ADC / DAC / Komparatoren mit der M√∂glichkeit der internen und externen Umschaltung von Ein- / Ausg√§ngen) </li><li>  Single-Wire-Programmierung und Debugging </li><li>  extrem niedriger Verkaufspreis (ab 0,6 ‚Ç¨ f√ºr 16 kb) </li></ul><br>  Als eisernen Teil des Programmierger√§ts haben wir den verf√ºgbaren USB-UART TTL-Konverter auf Basis des chinesischen CH340-Chips wie folgt verwendet: <br><br><img src="https://habrastorage.org/webt/7m/am/in/7maminco5c_go8a5flcqu8ymqwu.png" alt="Bild"><br><br>  F√ºr die Programmierung reicht es aus, die beiden Ausg√§nge RX und TX zu verbinden, da sie bereits mit einem Ausgangswiderstand von 1,5 k ausgestattet sind. Wenn Ihr Konvertermodell keinen Widerstand enth√§lt, m√ºssen Sie ihn hinzuf√ºgen.  Der kombinierte Ausgang ist mit dem UPDI-Pin eines programmierbaren Chips verbunden, die Wandlermasse muss auch mit der Controller-Masse verbunden sein.  Wenn Sie √ºber eine externe Stromversorgung verf√ºgen, m√ºssen Sie nur darauf achten, ob diese der vom Konverter verwendeten Leistung entspricht (3,3 V oder 5 V).  Wenn es n√∂tig ist, k√∂nnen Sie die Schaltung mit der Steuerung und vom Wandler selbst mit Strom versorgen, was f√ºr die anf√§ngliche Programmierung sehr praktisch sein kann. <br><br><img src="https://habrastorage.org/webt/er/bn/i0/erbni00rpywptgdcpytjrovbf90.png" alt="Bild"><br><br>  <b>Achtung!</b>  Der Widerstand ist optional und muss nur gel√∂tet werden, wenn Ihr Konverter keine Schutzwiderst√§nde am Ausgang hat. <br><br>  Das einzige Problem, das mit dem CH340-Chip verbunden ist, ist, dass es in meiner Linux-Version des Programms nicht funktioniert hat, da das Parit√§tsbit im Programmierprotokoll verwendet wird und der CH340-Treiber in meiner Kernel-Version mit diesem Bit nicht richtig funktioniert.  Vielleicht wird das Problem in naher Zukunft behoben, bisher hatte ich nicht die Geduld, dies zu tun. <br><br>  Als Ergebnis von Arbeiten und Experimenten wurde das <b>Updiprog-</b> Programm in den IDE Code :: Blocks geschrieben und debuggt, deren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quellcodes auf dem Github ver√∂ffentlicht wurden</a> . <br><br>  Was wurde in dieser Version des Programms implementiert: <br><br><ul><li>  Es wurde die M√∂glichkeit hinzugef√ºgt, den Inhalt des Flash-Speichers des Controllers in eine Hex-Datei einzulesen </li><li>  Es wurde die M√∂glichkeit hinzugef√ºgt, den Status aller Controller-Sicherungen zu lesen </li><li>  wann immer m√∂glich Fehlerbehandlung mit entsprechenden Meldungen hinzugef√ºgt </li><li>  Hinweis auf den Prozess des Schreibens / Lesens hinzugef√ºgt </li><li>  deutlich erh√∂hte Geschwindigkeit (ca. 6 Sekunden zum Lesen von 16 kb) </li><li>  Unterst√ºtzung f√ºr alle Mikrocontroller der 1er-Serie hinzugef√ºgt </li></ul><br>  Die anf√§ngliche Gr√∂√üe des Programms betr√§gt ca. 25 KB, verglichen mit 5 Kopeken f√ºr das kompilierte Python-Quellenskript. <br><br>  Ich hoffe, dass die geleistete Arbeit jemandem n√ºtzlich sein wird.  Ich w√ºrde mich √ºber Bewertungen und Vorschl√§ge freuen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de427349/">https://habr.com/ru/post/de427349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de427339/index.html">Warum G√∂dels Unvollst√§ndigkeitssatz schwer zu beweisen ist: Die Sache liegt in den Formulierungen und nicht nur im Wesentlichen</a></li>
<li><a href="../de427341/index.html">Lernen Sie, sich zu bedanken: Dies ist das Beste, was Sie anderen geben k√∂nnen, und der beste Weg, um ‚Äûn√ºtzliche soziale Verbindungen‚Äú aufzubauen.</a></li>
<li><a href="../de427343/index.html">VK Mobile Challenge 2018</a></li>
<li><a href="../de427345/index.html">Probleme des modernen Schreibens mathematischer Texte</a></li>
<li><a href="../de427347/index.html">Migration auf die Google Cloud Platform (Google Cloud Platform - GCP)</a></li>
<li><a href="../de427351/index.html">Sicherheitswoche 40: Sicherheitsl√ºcken in CMS Drupal und mehr</a></li>
<li><a href="../de427353/index.html">Drohnen zeigen: wie wir einen Schwarm tanzender Hubschrauber koordiniert haben</a></li>
<li><a href="../de427355/index.html">CJM-Zusammenstellung, wichtige Art Director-F√§higkeiten und Benutzerverst√§ndnis</a></li>
<li><a href="../de427357/index.html">Shader in Unity schreiben. GrabPass, PerRendererData</a></li>
<li><a href="../de427359/index.html">Wie ECS, C # Job System und SRP die Architektur √§ndern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>