<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÅ üôÜüèª ü•ù C√≥mo hacer que las corutinas en Unity sean un poco m√°s convenientes ü§úüèæ üé¶ ü§úüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cada desarrollador encuentra sus ventajas y desventajas de usar la rutina en Unity. Y decide en qu√© escenarios aplicarlos y en qu√© dar preferencia a l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo hacer que las corutinas en Unity sean un poco m√°s convenientes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442622/"><p>  Cada desarrollador encuentra sus ventajas y desventajas de usar la rutina en Unity.  Y decide en qu√© escenarios aplicarlos y en qu√© dar preferencia a las alternativas. </p><br><p>  En la pr√°ctica diaria, a menudo uso corutinas para varios tipos de tareas.  Una vez, me di cuenta de que era yo quien molestaba y rechazaba a muchos reci√©n llegados en ellos. </p><a name="habracut"></a><br><h2 id="koshmarnyy-interfeys">  Interfaz de pesadilla </h2><br><p>  El motor proporciona solo un par de m√©todos y varias de sus sobrecargas para trabajar con corutinas: </p><br><p>  <strong>Lanzamiento</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">docs</a> ) </p><br><ul><li><code>StartCoroutine(string name, object value = null)</code> </li> <li> <code>StartCoroutine(IEnumerator routine)</code> </li> </ul><br><p>  <strong>Stop</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">docs</a> ) </p><br><ul><li> <code>StopCoroutine(string methodName)</code> </li> <li> <code>StopCoroutine(IEnumerator routine)</code> </li> <li> <code>StopCoroutine(Coroutine routine)</code> </li> </ul><br><p>  Las sobrecargas con par√°metros de cadena (a pesar de su conveniencia enga√±osa) pueden inmediatamente <del>  enviar a la basura </del>  olvidar por al menos tres razones. </p><br><ul><li>  El uso expl√≠cito de los nombres de m√©todos de cadena complicar√° el an√°lisis de c√≥digo futuro, la depuraci√≥n y m√°s. </li><li>  Seg√∫n la documentaci√≥n, las sobrecargas de cadenas tardan m√°s y permiten pasar solo un par√°metro adicional. </li><li>  En mi pr√°ctica, a menudo result√≥ que no suced√≠a nada cuando se <code>StopCoroutine</code> una sobrecarga de cadena <code>StopCoroutine</code> .  Corutin continu√≥ siendo ejecutado. </li></ul><br><p>  Por un lado, los m√©todos proporcionados son suficientes para cubrir las necesidades b√°sicas.  Pero con el tiempo, comenc√© a notar que con el uso activo tengo que escribir una gran cantidad de c√≥digo repetitivo; esto es agotador y perjudica su legibilidad. </p><br><h2 id="blizhe-k-suti">  M√°s cerca del punto </h2><br><p>  En este art√≠culo quiero describir un peque√±o contenedor que he estado usando durante mucho tiempo.  Gracias a ella, pensando en las corutinas, ya no aparecen en mi cabeza fragmentos del c√≥digo de la plantilla con los que tuve que bailar alrededor.  Adem√°s, todo el equipo se ha vuelto m√°s f√°cil de leer y comprender los componentes donde se usan las rutinas. </p><br><p>  Supongamos que tenemos la siguiente tarea: escribir un componente que le permita mover un objeto a un punto dado. </p><br><p>  En este momento, no importa qu√© m√©todo se utilizar√° para moverse y en qu√© coordenadas.  Solo seleccionar√© una de las muchas opciones: la interpolaci√≥n y las coordenadas globales. </p><br><p>  Tenga en cuenta que no se recomienda mover el objeto cambiando sus coordenadas "frente", es decir, la construcci√≥n <code>transform.position = newPosition</code> si el componente <code>RigidBody</code> se usa con √©l (especialmente en el m√©todo <code>Update</code> ) ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">docs</a> ). </p><br><h3 id="standartnaya-realizaciya">  Implementaci√≥n est√°ndar </h3><br><p>  Propongo la siguiente implementaci√≥n del componente necesario: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) StartCoroutine(MoveRoutine()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Un poco sobre el c√≥digo</b> <div class="spoiler_text"><p>  En el m√©todo <code>Move</code> , es muy importante ejecutar la rutina solo cuando a√∫n no se est√° ejecutando.  De lo contrario, se pueden lanzar tantos como se desee y cada uno de ellos mover√° el objeto. </p><br><p>  <code>threshold</code> - tolerancia.  En otras palabras, la distancia al punto, acerc√°ndose a la cual asumiremos que hemos alcanzado la meta. </p><br><p>  <strong>Para que sirve</strong> </p><br><p>  Dado que todos los componentes ( <code>x</code> , <code>y</code> , <code>z</code> ) de la estructura <code>Vector3</code> son de tipo <code>float</code> , es una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mala idea</a> usar el resultado de verificar la igualdad de distancia al objetivo y la tolerancia como condici√≥n de bucle. </p><br><p>  Verificamos la distancia al objetivo para m√°s / menos, lo que nos permite evitar este problema. </p><br><p>  Adem√°s, si lo desea, puede usar el <code>Mathf.Approximately</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">docs</a> ) para una verificaci√≥n <em>aproximada</em> de la igualdad.  Vale la pena se√±alar que con algunos m√©todos de movimiento, la velocidad puede llegar a ser lo suficientemente grande como para que el objeto "salte" al objetivo en un cuadro.  Entonces el ciclo nunca terminar√°.  Por ejemplo, si usa el m√©todo <code>Vector3.MoveTowards</code> . </p><br><p>  Hasta donde s√©, en el motor de Unity para la estructura <code>Vector3</code> , el operador <code>Vector3</code> ya est√° redefinido de tal manera que <code>Mathf.Approximately</code> Se llama <code>Mathf.Approximately</code> para verificar la igualdad de componentes. </p></div></div><br><p>  Eso es todo por ahora, nuestro componente es bastante simple.  Y por el momento no hay problemas.  Pero, ¬øqu√© es este componente que le permite mover un objeto a un punto, pero no brinda la oportunidad de detenerlo?  Arreglemos esta injusticia. </p><br><p>  Dado que usted y yo decidimos no pasar al lado malo, y no usar sobrecargas con par√°metros de cadena, ahora tenemos que guardar en alg√∫n lugar un enlace a la rutina en ejecuci√≥n.  De lo contrario, ¬øc√≥mo detenerla? </p><br><p>  A√±adir un campo: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Coroutine moveRoutine;</code> </pre> <br><p>  Fix <code>Move</code> : </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) moveRoutine = StartCoroutine(MoveRoutine()); }</code> </pre> <br><p>  Agregue un m√©todo de stop motion: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) StopCoroutine(moveRoutine); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">C√≥digo completo</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Coroutine moveRoutine; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) moveRoutine = StartCoroutine(MoveRoutine()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) StopCoroutine(moveRoutine); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> </div></div><br><p>  ¬°Un asunto completamente diferente! <del>  Al menos aplicar a la herida. </del></p><br><p>  Entonces  Tenemos un peque√±o componente que realiza la tarea.  ¬øCu√°l es mi indignaci√≥n? </p><br><h3 id="problemy-i-ih-reshenie">  Problemas y su soluci√≥n. </h3><br><p>  Con el tiempo, el proyecto crece y, con √©l, la cantidad de componentes, incluidos los que usan corutinas.  Y cada vez, estas cosas me persiguen cada vez m√°s: </p><br><ul><li>  Llamadas continuas de emparedado </li></ul><br><pre> <code class="cs hljs">StartCoroutine(MoveRoutine());</code> </pre> <br><pre> <code class="cs hljs">StopCoroutine(moveRoutine);</code> </pre> <br><p>  Solo mirarlos hace que mi ojo se contraiga, y leer ese c√≥digo es un placer dudoso (estoy de acuerdo, puede ser peor).  Pero ser√≠a mucho m√°s agradable y visual tener algo as√≠: </p><br><pre> <code class="cs hljs">moveRoutine.Start();</code> </pre> <br><pre> <code class="cs hljs">moveRoutine.Stop();</code> </pre> <br><ul><li>  Cada vez que llame a <code>StartCoroutine</code> debe recordar guardar el valor de retorno: </li></ul><br><pre> <code class="cs hljs">moveRoutine = StartCoroutine(MoveRoutine());</code> </pre> <br><p>  De lo contrario, debido a la falta de referencia a la rutina, simplemente no puede detenerla. </p><br><ul><li>  Comprobaciones constantes: </li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine == <span class="hljs-literal"><span class="hljs-literal">null</span></span>)</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>)</code> </pre> <br><ul><li>  Y otra cosa malvada que siempre debes recordar (y que yo <del>  olvid√© de nuevo </del>  especialmente perdido).  Al final de la rutina y antes de cada salida (por ejemplo, usando el <code>yield break</code> ), es necesario restablecer el valor del campo. <br><pre> <code class="cs hljs">moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre> </li></ul><br><p>  Si olvida, recibir√° una rutina de una sola vez.  Despu√©s de la primera ejecuci√≥n en <code>moveRoutine</code> , el enlace a la rutina continuar√° y la nueva ejecuci√≥n no funcionar√°. </p><br><p>  De la misma manera, debe hacerlo en el caso de una parada forzada: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { StopCoroutine(moveRoutine); moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">C√≥digo con todos los cambios</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Coroutine moveRoutine; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { moveRoutine = StartCoroutine(MoveRoutine()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (moveRoutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { StopCoroutine(moveRoutine); moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.localPosition = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> </div></div><br><p>  En un momento, realmente quiero sacar una vez toda esta mascarada en alg√∫n lugar, y dejarme solo los m√©todos necesarios: <code>Start</code> , <code>Stop</code> y un par de eventos y propiedades m√°s. </p><br><p>  <strong>¬°Hag√°moslo finalmente!</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Owner { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Coroutine Coroutine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Func&lt;IEnumerator&gt; Routine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsProcessing =&gt; Coroutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CoroutineObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour owner, Func&lt;IEnumerator&gt; routine</span></span></span><span class="hljs-function">)</span></span> { Owner = owner; Routine = routine; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Stop(); Coroutine = Owner.StartCoroutine(Process()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsProcessing) { Owner.StopCoroutine(Coroutine); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Debriefing</b> <div class="spoiler_text"><p>  <code>Owner</code> : un enlace a la instancia de <code>MonoBehaviour</code> a la que se adjuntar√° la rutina.  Como sabe, debe ejecutarse en el contexto de un componente particular, ya que es a √©l a quien <code>StopCoroutine</code> m√©todos <code>StartCoroutine</code> y <code>StopCoroutine</code> .  En consecuencia, necesitamos un enlace al componente que ser√° el propietario de la rutina. </p><br><p>  <code>Coroutine</code> : un an√°logo del campo <code>moveRoutine</code> en el componente <code>MoveToPoint</code> , contiene un enlace a la corutina actual. </p><br><p>  <code>Routine</code> : el delegado con quien se comunicar√° el m√©todo que act√∫a como la rutina. </p><br><p>  <code>Process()</code> es un peque√±o contenedor sobre el m√©todo de <code>Routine</code> principal.  Es necesario para poder rastrear cuando se completa la ejecuci√≥n de la rutina, restablecer el enlace y ejecutar otro c√≥digo en ese momento (si es necesario). </p><br><p>  <code>IsProcessing</code> : le permite saber si la corutina se est√° ejecutando actualmente. </p></div></div><br><p>  Por lo tanto, nos deshacemos de una gran cantidad de dolor de cabeza y nuestro componente adquiere un aspecto completamente diferente: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 target; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CoroutineObject moveRoutine; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { moveRoutine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CoroutineObject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, MoveRoutine); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; moveRoutine.Start(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; moveRoutine.Stop(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><p>  Todo lo que queda es la propia rutina y algunas l√≠neas de c√≥digo para trabajar con ella.  Significativamente mejor. </p><br><p>  Supongamos que ha llegado una nueva tarea: debe agregar la capacidad de ejecutar cualquier c√≥digo despu√©s de que el objeto haya alcanzado su objetivo. </p><br><p>  En la versi√≥n original, tendr√≠amos que agregar un par√°metro delegado adicional a cada corutina que se pueda extraer despu√©s de su finalizaci√≥n. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">System.Action callback</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.position = Vector3.Lerp(transform.position, target, speed * Time.deltaTime); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } moveRoutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span> callback?.Invoke(); }</code> </pre> <br><p>  Y llame de la siguiente manera: </p><br><pre> <code class="cs hljs">moveRoutine = StartCoroutine(moveRoutine(CallbackHandler)); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CallbackHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// do something }</span></span></code> </pre> <br><p>  Y si hay algo de lambda como manejador, entonces se ve a√∫n peor. </p><br><p>  Con nuestro contenedor, es suficiente agregar este evento solo una vez. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action Finish;</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Finish?.Invoke(); }</code> </pre> <br><p>  Y luego, si es necesario, suscr√≠base. </p><br><pre> <code class="cs hljs">moveRoutine.Finished += OnFinish; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnFinish</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// do something }</span></span></code> </pre> <br><p>  Creo que ya ha notado que la versi√≥n actual del contenedor proporciona la capacidad de trabajar solo con corutinas sin par√°metros.  Por lo tanto, podemos escribir un contenedor generalizado para la rutina con un par√°metro.  El resto se hace por analog√≠a. </p><br><p>  Pero, para bien, ser√≠a bueno poner primero el c√≥digo, que ser√° el mismo para todos los contenedores, en alguna clase base, para no escribir lo mismo.  Estamos luchando contra esto. </p><br><p>  Lo quitamos: </p><br><ul><li>  <code>Owner</code> , <code>Coroutine</code> , <code>IsProcessing</code> </li><li>  Evento <code>Finished</code> </li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Action = System.Action; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObjectBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MonoBehaviour Owner { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Coroutine Coroutine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsProcessing =&gt; Coroutine != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action Finished; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Contenedor sin par√°metros despu√©s de refactorizar</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObject</span></span> : <span class="hljs-title"><span class="hljs-title">CoroutineObjectBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Func&lt;IEnumerator&gt; Routine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action Finished; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CoroutineObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour owner, Func&lt;IEnumerator&gt; routine</span></span></span><span class="hljs-function">)</span></span> { Owner = owner; Routine = routine; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Finished?.Invoke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Stop(); Coroutine = Owner.StartCoroutine(Process()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(IsProcessing) { Owner.StopCoroutine(Coroutine); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> </div></div><br><p>  Y ahora, de hecho, una envoltura para la rutina con un par√°metro: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineObject</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">CoroutineObjectBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Func&lt;T, IEnumerator&gt; Routine { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action Finished; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CoroutineObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MonoBehaviour owner, Func&lt;T, IEnumerator&gt; routine</span></span></span><span class="hljs-function">)</span></span> { Owner = owner; Routine = routine; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T arg</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Routine.Invoke(arg); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Finished?.Invoke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T arg</span></span></span><span class="hljs-function">)</span></span> { Stop(); Coroutine = Owner.StartCoroutine(Process(arg)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(IsProcessing) { Owner.StopCoroutine(Coroutine); Coroutine = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><p>  Como puede ver, el c√≥digo es casi el mismo.  Solo en algunos lugares se agregaron fragmentos, dependiendo del n√∫mero de argumentos. </p><br><p>  Supongamos que se nos pide que actualicemos el componente MoveToPoint para que el punto se pueda establecer no a trav√©s de la ventana del <code>Inspector</code> en el editor, sino por c√≥digo cuando se llam√≥ al m√©todo <code>Move</code> . </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> IEnumerator = System.Collections.IEnumerator; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MoveToPoint</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> threshold; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CoroutineObject&lt;Vector3&gt; moveRoutine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsMoving =&gt; moveRoutine.IsProcessing; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { moveRoutine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CoroutineObject&lt;Vector3&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, MoveRoutine); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 target</span></span></span><span class="hljs-function">)</span></span> =&gt; moveRoutine.Start(target); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; moveRoutine.Stop(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveRoutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 target</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (Vector3.Distance(transform.position, target) &gt; threshold) { transform.localPosition = Vector3.Lerp(transform.position, target, speed); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br><p>  Hay muchas opciones para expandir la funcionalidad de este contenedor tanto como sea posible: agregue un lanzamiento retrasado, eventos con par√°metros, posible seguimiento del progreso de la rutina y m√°s.  Pero sugiero detenerse en esta etapa. </p><br><p>  El prop√≥sito de este art√≠culo es el deseo de compartir los problemas apremiantes que encontr√© y proponerles una soluci√≥n, y no cubrir las posibles necesidades de todos los desarrolladores. </p><br><p>  Espero que tanto los camaradas principiantes como los experimentados se beneficien de mi experiencia.  Quiz√°s compartir√°n sus comentarios o se√±alar√°n errores que podr√≠a haber cometido. </p><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/442622/">https://habr.com/ru/post/442622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442612/index.html">Motor de cart√≥n para un juego de mesa el√©ctrico. C√≥mo lo acercamos a la realidad</a></li>
<li><a href="../442614/index.html">CI / CD usando Jenkins en Kubernetes</a></li>
<li><a href="../442616/index.html">Aceleramos el procesamiento de eventos a 1.6 millones por segundo</a></li>
<li><a href="../442618/index.html">No apto para selfies: ensayo inmunosorbente digital ligado a enzimas utilizando un nuevo chip integrado en un tel√©fono inteligente</a></li>
<li><a href="../442620/index.html">Aprendizaje autom√°tico en monitoreo de TI</a></li>
<li><a href="../442624/index.html">El libro "Algoritmo perfecto. Los fundamentos</a></li>
<li><a href="../442626/index.html">Habraiting: construyendo una nube de palabras de habla rusa en el ejemplo de los encabezados de Habra</a></li>
<li><a href="../442630/index.html">Durabilidad de la l√°mpara LED y salida de luz reducida</a></li>
<li><a href="../442632/index.html">Energ√≠a geot√©rmica: c√≥mo el calor de la Tierra se convirti√≥ en un recurso energ√©tico eficiente</a></li>
<li><a href="../442636/index.html">¬øTraes malas noticias a la gerencia?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>