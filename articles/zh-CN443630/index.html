<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘ âœï¸ ğŸ†™ å¦‚ä½•åœ¨JavaScriptä¸­å®ç°ç¼–ç¨‹è¯­è¨€ã€‚ ç¬¬1éƒ¨åˆ†ï¼šè§£æå™¨ ğŸ¤¦ğŸ¿ ğŸ¤  ğŸ¥¡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä½ å¥½ æˆ‘å‘æ‚¨ä»‹ç»äº†ç”¨äºå®æ–½JavaScriptç¼–ç¨‹è¯­è¨€çš„æŒ‡å—çš„ä¸šä½™ç¿»è¯‘-PLæ•™ç¨‹ ã€‚ 
 æ¥è‡ªç¿»è¯‘ 


 æˆ‘ä»¬å°†åˆ›å»ºè‡ªå·±çš„ç¼–ç¨‹è¯­è¨€-Î»è¯­è¨€ ï¼ˆåŸå§‹è¯­è¨€ -Î»anguageï¼‰ã€‚ åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è®¸å¤šæœ‰è¶£çš„æŠ€æœ¯ï¼Œä¾‹å¦‚é€’å½’ä¸‹é™ï¼Œæ§ä»¶ä¼ é€’æ ·å¼å’ŒåŸºæœ¬çš„ä¼˜åŒ–æŠ€æœ¯ã€‚ å°†åˆ›å»ºä¸¤ä¸ªç‰ˆæœ¬çš„è§£é‡Šå™¨-å¸¸è§„å’ŒCPS...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¦‚ä½•åœ¨JavaScriptä¸­å®ç°ç¼–ç¨‹è¯­è¨€ã€‚ ç¬¬1éƒ¨åˆ†ï¼šè§£æå™¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443630/"><p> ä½ å¥½ æˆ‘å‘æ‚¨ä»‹ç»äº†ç”¨äºå®æ–½JavaScriptç¼–ç¨‹è¯­è¨€çš„æŒ‡å—çš„ä¸šä½™ç¿»è¯‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-PLæ•™ç¨‹</a> ã€‚ </p><br><h1 id="ot-perevodchika"> æ¥è‡ªç¿»è¯‘ </h1><br><p> æˆ‘ä»¬å°†åˆ›å»ºè‡ªå·±çš„ç¼–ç¨‹è¯­è¨€<strong>-Î»è¯­è¨€</strong> ï¼ˆåŸå§‹<strong>è¯­è¨€</strong> -Î»anguageï¼‰ã€‚ åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è®¸å¤šæœ‰è¶£çš„æŠ€æœ¯ï¼Œä¾‹å¦‚é€’å½’ä¸‹é™ï¼Œæ§ä»¶ä¼ é€’æ ·å¼å’ŒåŸºæœ¬çš„ä¼˜åŒ–æŠ€æœ¯ã€‚ å°†åˆ›å»ºä¸¤ä¸ªç‰ˆæœ¬çš„è§£é‡Šå™¨-å¸¸è§„å’ŒCPSè§£é‡Šå™¨ï¼Œå³JavaScriptä¸­çš„åç¼–è¯‘å™¨ã€‚ </p><br><p> åŸè‘—çš„ä½œè€…æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Mihai Bazon</a> ï¼Œè‘—åçš„UglifyJSåº“ï¼ˆä¸€ç§ç”¨äºæœ€å°åŒ–å’Œæ ¼å¼åŒ–JSä»£ç çš„å·¥å…·ï¼‰çš„ä½œè€…ã€‚ </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">ç›®å½•å†…å®¹</b> <div class="spoiler_text"><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¦‚ä½•åœ¨JavaScriptä¸­å®ç°ç¼–ç¨‹è¯­è¨€ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬1éƒ¨åˆ†ï¼šè§£æå™¨</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¦‚ä½•åœ¨JavaScriptä¸­å®ç°ç¼–ç¨‹è¯­è¨€ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬2éƒ¨åˆ†ï¼šç¿»è¯‘</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¦‚ä½•åœ¨JavaScriptä¸­å®ç°ç¼–ç¨‹è¯­è¨€ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬3éƒ¨åˆ†ï¼šCPSè§£é‡Šå™¨</a> </li><li> å¦‚ä½•åœ¨JavaScriptä¸­å®ç°ç¼–ç¨‹è¯­è¨€ã€‚ ç¬¬4éƒ¨åˆ†ï¼šJSä¸­çš„åç¼–è¯‘ </li></ol></div></div><br><h1 id="vstuplenie"> å‚èµ›ä½œå“ </h1><br><p>å¦‚æœæ‚¨æ›¾ç»ç¼–å†™è¿‡ç¼–è¯‘å™¨æˆ–è§£é‡Šå™¨ï¼Œé‚£ä¹ˆå¯¹æ‚¨æ¥è¯´å°±æ²¡æœ‰ä»€ä¹ˆæ–°é²œçš„äº†ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥<a href="">è§£æ</a>ç±»ä¼¼äºç¼–ç¨‹è¯­è¨€çš„å†…å®¹ï¼Œé‚£ä¹ˆè¯·é˜…è¯»æœ‰å…³<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è§£æ</a>çš„éƒ¨åˆ†ã€‚ è®©æˆ‘ä»¬ç¼–å†™æ›´å°‘é”™è¯¯çš„ä»£ç ï¼ </p><br><p> æœ¬æ–‡æŒ‰â€œä»ç®€å•åˆ°å¤æ‚â€çš„é¡ºåºåˆ†ä¸ºå‡ éƒ¨åˆ†ã€‚ æˆ‘ä¸å»ºè®®æ‚¨è·³è¿‡æœ¬æ–‡çš„æŸäº›éƒ¨åˆ†ï¼Œé™¤éæ‚¨å¯¹ä¸»é¢˜éå¸¸äº†è§£ã€‚ å¦‚æœæ‚¨ä¸äº†è§£æŸäº›å†…å®¹ï¼Œå¯ä»¥éšæ—¶è¿”å›ã€‚ </p><br><p> æˆ‘ä»¬è¦å­¦ä¹ ä»€ä¹ˆï¼š </p><br><ul><li> ä»€ä¹ˆæ˜¯è§£æå™¨ï¼Œä»¥åŠå¦‚ä½•ç¼–å†™å®ƒã€‚ </li><li> å¦‚ä½•ç¼–å†™å£è¯‘å‘˜ã€‚ </li><li> è½¬ç§»çš„ç»­é›†åŠå…¶é‡è¦æ€§ã€‚ </li><li> ç¼–å†™ä¸€ä¸ªï¼ˆtransï¼‰ç¼–è¯‘å™¨ã€‚ </li><li> å»¶ç»­è½¬ç§»é£æ ¼ã€‚ </li><li> ä¸€äº›åŸºæœ¬çš„ä»£ç ä¼˜åŒ–æŠ€æœ¯ã€‚ </li><li> ä¸JavaScriptç›¸æ¯”ï¼Œæˆ‘ä»¬çš„Î»è¯­è¨€æ–°åŠŸèƒ½ç¤ºä¾‹ã€‚ </li></ul><br><p> ä¸æ­¤åŒæ—¶ï¼Œæˆ‘å°†å±•ç¤ºä¸ºä»€ä¹ˆLispæ˜¯ä¸€ç§å¾ˆæ£’çš„ç¼–ç¨‹è¯­è¨€ã€‚  <strong>ä½†æ˜¯ï¼Œæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„è¯­è¨€ä¸æ˜¯Lispã€‚</strong> å®ƒå…·æœ‰æ›´ä¸°å¯Œçš„è¯­æ³•ï¼ˆæ¯ä¸ªäººéƒ½çŸ¥é“çš„ç»å…¸åç¼€è¡¨ç¤ºæ³•ï¼‰ï¼Œç±»ä¼¼äºSchemeï¼ˆå®é™¤å¤–ï¼‰ã€‚ å¥½çš„ä¸å¦ï¼Œä½†æ˜¯å®æ˜¯Lispçš„ä¸»è¦åŠŸèƒ½-å…¶ä»–è¯­è¨€ï¼ˆé™¤äº†Lispçš„æ–¹è¨€ï¼‰æ— æ³•åšåˆ°çš„å’Œå®ƒä¸€æ ·ã€‚  ï¼ˆæ˜¯çš„ï¼Œæˆ‘çŸ¥é“SweetJS ...å…³é—­ï¼Œä½†ä¸æ˜¯ã€‚ï¼‰ </p><br><p> ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»‹ç»ä¸€ä¸‹æˆ‘ä»¬çš„ç¼–ç¨‹è¯­è¨€ã€‚ </p><br><a name="Language"></a><br><h1 id="zyk">  Î»è¯­è¨€ </h1><br><p> åœ¨åšä»»ä½•äº‹æƒ…ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»æ¸…æ¥šåœ°çŸ¥é“æˆ‘ä»¬æƒ³åšä»€ä¹ˆã€‚ ç¼–å†™è¯­è¨€è¯­æ³•çš„æè¿°ä¼šå¾ˆå¥½ï¼Œä½†æ˜¯æˆ‘å°†ä½¿å…¶å˜å¾—æ›´å®¹æ˜“-ç¼–å†™ä¸€ä¸ªç®€å•ç¨‹åºçš„ç¤ºä¾‹ï¼Œå› æ­¤è¿™é‡Œæ˜¯Î»è¯­è¨€çš„ä¸€äº›ç¤ºä¾‹ï¼š </p><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   println("Hello World!"); println(2 + 3 * 4); #       `lambda`  `Î»` fib = lambda (n) if n &lt; 2 then n else fib(n - 1) + fib(n - 2); println(fib(15)); print-range = Î»(a, b) # `Î»`     ,   `lambda` if a &lt;= b then { # `then`  ,      print(a); if a + 1 &lt;= b { print(", "); print-range(a + 1, b); } else println(""); #   }; print-range(1, 5);</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å…³äºå˜é‡åçš„æ³¨æ„</b> <div class="spoiler_text"><p> è¯·æ³¨æ„ï¼Œæ ‡è¯†ç¬¦å¯èƒ½åŒ…å«å‡å·ï¼ˆ <code>print-range</code> ï¼‰ã€‚ è¿™æ˜¯ä¸€ä¸ªå“å‘³é—®é¢˜ã€‚ æˆ‘æ€»æ˜¯åœ¨è¿ç®—ç¬¦å‘¨å›´æ”¾ç½®ç©ºæ ¼ã€‚ æˆ‘çœŸçš„ä¸å–œæ¬¢camelRegisterå’Œç ´æŠ˜å·èƒœè¿‡ä¸å¯è§çš„ç©ºæ ¼ï¼ˆâ€œ _â€ï¼‰ã€‚ è‡ªå·±åšæŸäº‹æ—¶ï¼Œæ‚¨å¯ä»¥åšçš„å¤šä¹ˆé…·ã€‚ </p></div></div><br><p> ç»“è®ºï¼š </p><br><pre> <code class="plaintext hljs">Hello World! 14 610 1, 2, 3, 4, 5</code> </pre> <br><p> è¯¥è¯­è¨€çœ‹èµ·æ¥ä¸JavaScriptç±»ä¼¼ï¼Œä½†æ€»ä½“è€Œè¨€å¹¶éå¦‚æ­¤ã€‚ é¦–å…ˆï¼Œæ²¡æœ‰è¯­å¥ï¼Œåªæœ‰è¡¨è¾¾å¼ã€‚ ä¸€ä¸ªè¡¨è¾¾å¼å¿…é¡»è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å¦ä¸€ä¸ªè¡¨è¾¾å¼çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ã€‚ éœ€è¦åˆ†å·æ¥åˆ†éš”è¡¨è¾¾å¼çš„â€œåºåˆ—â€ä¸­çš„è¡¨è¾¾å¼ã€‚ èŠ±æ‹¬å·<code>{</code>å’Œ<code>}</code>åˆ›å»ºä¸€ä¸ªåºåˆ—ï¼Œè¯¥åºåˆ—æœ¬èº«å°±æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå…¶å€¼æ˜¯è¯¥åºåˆ—ä¸­çš„æœ€åä¸€ä¸ªå€¼ã€‚ ä»¥ä¸‹ç¨‹åºæ˜¯æ­£ç¡®çš„ï¼š </p><br><pre> <code class="python hljs">a = { fib(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">#    ,      fib(15) #        }; print(a); #  610</span></span></code> </pre> <br><p> ä½¿ç”¨<code>lambda</code>æˆ–<code>Î»</code>å…³é”®å­—åˆ›å»ºå‡½æ•°ã€‚ ä¹‹åï¼Œæ‹¬å·ä¸­æ˜¯å‚æ•°åç§°ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰åˆ—è¡¨ï¼Œä»¥é€—å·åˆ†éš”ã€‚ å‡½æ•°çš„ä¸»ä½“æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä½†å¯ä»¥åŒ…å«åœ¨åºåˆ—<code>{...}</code> ã€‚ è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ²¡æœ‰<code>return</code>å…³é”®å­—ã€‚ è¯¥å‡½æ•°è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚ </p><br><p> å¦å¤–ï¼Œæ²¡æœ‰<code>var</code> ã€‚ ä¸ºäº†æ·»åŠ å˜é‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨JavaScriptç¨‹åºå‘˜ç§°ä¸º<code>IIFE</code> ã€‚ ä½¿ç”¨<code>lambda</code> ï¼Œå°†å˜é‡å£°æ˜ä¸ºå‚æ•°ã€‚ å¯¹äºå˜é‡ï¼Œä½œç”¨åŸŸæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°æ˜¯é—­åŒ…ï¼Œå¦‚JavaScript [ ç¿»è¯‘ï¼šç›´è‡³ES6ã€‚]ã€‚ </p><br><p> å³ä½¿æ˜¯ä¸€ä¸ªè¡¨è¾¾ã€‚  JavaScriptä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦æ‰§è¡Œæ­¤æ“ä½œï¼š </p><br><pre> <code class="python hljs">a = foo() ? bar() : baz(); // JavaScript a = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> foo() then bar() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> baz(); <span class="hljs-comment"><span class="hljs-comment"># Î»</span></span></code> </pre> <br><p> å¦‚ä¸Šæ‰€ç¤ºï¼Œå¦‚æœåˆ†æ”¯æ˜¯åºåˆ—ï¼ˆ <code>{...}</code> ï¼‰ï¼Œ <code>then</code>å…³é”®å­—æ˜¯å¯é€‰çš„ã€‚ åœ¨å¦ä¸€ç§æƒ…å†µä¸‹ï¼Œè¿™æ˜¯å¿…è¦çš„ã€‚ å¦‚æœå­˜åœ¨æ›¿ä»£åˆ†æ”¯ï¼Œåˆ™ä½¿ç”¨<code>else</code> ã€‚ å†ä¸€æ¬¡ï¼Œ <code>then</code>è¡¨è¾¾å¼ä½œä¸ºä¸»ä½“ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨<code>{...}</code>å°†å¤šä¸ªè¡¨è¾¾å¼ç»„åˆä¸ºä¸€ä¸ªã€‚ å¦‚æœä¸å­˜åœ¨<code>else</code>å¹¶ä¸”æ¡ä»¶ä¸º<code>false</code> ï¼Œåˆ™æ‰€æœ‰<code>if</code>çš„ç»“æœä¸º<code>false</code> ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ <code>false</code>æ˜¯è¡¨ç¤ºå€¼çš„å…³é”®å­—ï¼Œè¯¥å€¼æ˜¯Î»è¯­è¨€ä¸­å”¯ä¸€çš„é”™è¯¯å€¼ï¼š </p><br><pre> <code class="plaintext hljs">if foo() then print("OK");</code> </pre> <br><p> ä»…å½“<code>foo()</code>çš„ç»“æœ<strong>ä¸ä¸º</strong> <code>false</code>æ‰ä¼šè¾“å‡º<code>OK</code> ã€‚ å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå…³é”®å­—<code>true</code> ï¼Œä½†æ˜¯ç»å¯¹ä¸æ˜¯<code>false</code>æ‰€æœ‰å†…å®¹ï¼ˆåœ¨JavaScriptä¸­ï¼Œè¿ç®—ç¬¦<code>===</code> ï¼‰åœ¨åˆ†æ”¯ä¸­éƒ½å°†è§†ä¸º<code>true</code> ï¼ˆåŒ…æ‹¬æ•°å­—<code>0</code>å’Œç©ºå­—ç¬¦ä¸²<code>""</code> ï¼‰ã€‚ </p><br><p> è¯·æ³¨æ„ï¼Œåœ¨<code>if</code> ï¼Œè¡¨è¾¾å¼ä¹‹é—´ä¸éœ€è¦æ‹¬å·ã€‚ å¦‚æœæ·»åŠ å®ƒä»¬ï¼Œé‚£å°†ä¸æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸º<code>(</code>è¡¨è¾¾å¼å¼€å§‹ï¼Œä½†æ˜¯å®ƒä»¬åªæ˜¯å¤šä½™çš„ã€‚ </p><br><p> å³ä½¿ç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œä¹Ÿå¯ä»¥è§£ææ•´ä¸ªç¨‹åºï¼Œå› æ­¤åº”æ·»åŠ <code>;</code> åœ¨æ¯ä¸ªè¡¨è¾¾å¼ä¹‹åã€‚ æœ€åä¸€ä¸ªè¡¨è¾¾å¼æ˜¯ä¸€ä¸ªä¾‹å¤–ã€‚ </p><br><p> å¤ªå¥½äº†ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„å°Î»è¯­è¨€ã€‚ ä»–å¹¶ä¸å®Œç¾ã€‚ è¯­æ³•çœ‹èµ·æ¥å¾ˆæ¼‚äº®ï¼Œä½†æ˜¯æœ‰ç¼ºé™·ã€‚ æœ‰è®¸å¤šç¼ºå°‘çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å¯¹è±¡å’Œæ•°ç»„ã€‚ æˆ‘ä»¬ä¸å…³æ³¨å®ƒä»¬ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯æˆ‘ä»¬ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€ã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„è¯­è¨€ç¼–å†™ä¸€ä¸ªè§£æå™¨ã€‚ </p><br><a name="Parsing"></a><br><h1 id="prevraschenie-koda-v-ast"> ä»£ç è½¬æ¢ä¸ºAST </h1><br><p> åˆ›å»ºè§£æå™¨æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ æœ¬è´¨ä¸Šï¼Œå®ƒåº”è¯¥èŠ±è´¹ä¸€æ®µä»£ç å¹¶å°†å…¶è½¬æ¢ä¸ºASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ã€‚  ASTæ˜¯å†…å­˜ä¸­ç¨‹åºçš„ç»“æ„åŒ–è¡¨ç¤ºï¼Œæ˜¯æŠ½è±¡çš„ï¼Œå› ä¸ºå®ƒä¸åŒ…å«æœ‰å…³ä»£ç çš„å®Œæ•´ä¿¡æ¯ï¼Œè€Œä»…åŒ…å«è¯­ä¹‰ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯´æ˜AST</a>åœ¨å•ç‹¬çš„éƒ¨åˆ†ä¸­ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ä»£ç ï¼š </p><br><pre> <code class="python hljs">sum = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>(a, b) { a + b; }; print(sum(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>));</code> </pre> <br><p> æˆ‘ä»¬çš„è§£æå™¨å°†ç”Ÿæˆä¸€æ£µæ ‘ä½œä¸ºJavaScriptå¯¹è±¡ï¼š </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">//  : { type: "assign", operator: "=", left: { type: "var", value: "sum" }, right: { type: "lambda", vars: [ "a", "b" ], body: { //     "prog",  ,  //     ,  //     . type: "binary", operator: "+", left: { type: "var", value: "a" }, right: { type: "var", value: "b" } } } }, //  : { type: "call", func: { type: "var", value: "print" }, args: [{ type: "call", func: { type: "var", value: "sum" }, args: [ { type: "num", value: 1 }, { type: "num", value: 2 } ] }] } ] }</span></span></code> </pre> <br><p> åˆ›å»ºè§£æå™¨çš„ä¸»è¦å›°éš¾æ˜¯æ­£ç¡®ç»„ç»‡ä»£ç çš„å›°éš¾ã€‚ ä¸ä»å­—ç¬¦ä¸²ä¸­è¯»å–å­—ç¬¦ç›¸æ¯”ï¼Œè§£æå™¨åº”è¯¥åœ¨æ›´é«˜çš„å±‚æ¬¡ä¸Šå·¥ä½œã€‚ ä¸€äº›é™ä½ä»£ç å¤æ‚æ€§çš„å‡†åˆ™ï¼š </p><br><ul><li> ç¼–å†™å¾ˆå¤šå°åŠŸèƒ½ã€‚ åœ¨æ¯ä¸ªåŠŸèƒ½ä¸­ï¼Œéƒ½è¦åšä¸€ä»¶äº‹å¹¶åšå¥½ã€‚ </li><li> ä¸è¦å°è¯•ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œè§£æã€‚ ä»–ä»¬åªæ˜¯ä¸å·¥ä½œã€‚ å®ƒä»¬åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯æ³•åˆ†æå™¨ä¸­</a>å¯èƒ½å¾ˆæœ‰ç”¨ï¼Œä½†ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ä¸ä½¿ç”¨å®ƒä»¬ã€‚ </li><li> ä¸è¦è¯•å›¾çŒœæµ‹ã€‚ å¦‚æœä¸ç¡®å®šå¦‚ä½•è§£ææŸäº›å†…å®¹ï¼Œè¯·å¼•å‘ä¸€ä¸ªåŒ…å«é”™è¯¯ä½ç½®ï¼ˆè¡Œå’Œåˆ—ï¼‰çš„å¼‚å¸¸ã€‚ </li></ul><br><p> ä¸ºäº†ä½¿ä»£ç æ›´ç®€å•ï¼Œæˆ‘ä»¬å°†å…¶åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œç„¶ååˆåˆ†ä¸ºè®¸å¤šå°åŠŸèƒ½ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­—ç¬¦æµ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»¤ç‰Œæµï¼ˆä»¤ç‰Œï¼‰</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è§£æå™¨</a> </li></ul><br><a name="InputStream"></a><br><h1 id="potok-simvolov"> å­—ç¬¦æµ </h1><br><p> è¿™æ˜¯æœ€ç®€å•çš„éƒ¨åˆ†ã€‚ æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæµå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°†è¡¨ç¤ºä»å­—ç¬¦ä¸²ä¸­é¡ºåºè¯»å–å­—ç¬¦çš„æ“ä½œã€‚ å®ƒåŒ…å«å››ä¸ªåŠŸèƒ½ï¼š </p><br><ul><li>  <code>peek()</code> -è¿”å›ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œä¸ä»æµä¸­æå–å®ƒã€‚ </li><li>  <code>next()</code> -è¿”å›ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œå°†å…¶ä»æµä¸­æå–å‡ºæ¥ã€‚ </li><li>  <code>eof()</code> -å¦‚æœæµä¸­æ²¡æœ‰æ›´å¤šå­—ç¬¦ï¼Œåˆ™è¿”å›<code>true</code> ã€‚ </li><li>  <code>croak(msg)</code> -å¼•å‘åŒ…å«æ¶ˆæ¯ï¼ˆ <code>msg</code> ï¼‰å’Œæµä¸­å½“å‰ä½ç½®çš„å¼‚å¸¸ã€‚ </li></ul><br><p> éœ€è¦æœ€åä¸€ä¸ªå‡½æ•°ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ç®€å•åœ°å¼•å‘ä¸€ä¸ªåŒ…å«é”™è¯¯ä½ç½®çš„å¼‚å¸¸ã€‚ </p><br><p> è¿™æ˜¯æ­¤å¯¹è±¡çš„å®Œæ•´ä»£ç ï¼ˆæˆ‘ä»¬ç§°å…¶ä¸º<code>InputStream</code> ï¼‰ã€‚ å®ƒè¶³å¤Ÿå°ï¼Œå› æ­¤æ‚¨ä¸ä¼šé‡åˆ°ä»»ä½•é—®é¢˜ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pos = <span class="hljs-number"><span class="hljs-number">0</span></span>, line = <span class="hljs-number"><span class="hljs-number">1</span></span>, col = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">next</span></span> : next, <span class="hljs-attr"><span class="hljs-attr">peek</span></span> : peek, <span class="hljs-attr"><span class="hljs-attr">eof</span></span> : eof, <span class="hljs-attr"><span class="hljs-attr">croak</span></span> : croak, }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.charAt(pos++); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) line++, col = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> col++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ch; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">peek</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> input.charAt(pos); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eof</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> peek() == <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">croak</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">msg</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(msg + <span class="hljs-string"><span class="hljs-string">" ("</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + col + <span class="hljs-string"><span class="hljs-string">")"</span></span>); } }</code> </pre> <br><p> è¯·æ³¨æ„ï¼Œè¿™ä¸æ˜¯æ™®é€šå¯¹è±¡ï¼ˆé€šè¿‡<code>new</code>åˆ›å»ºï¼‰ã€‚ è¦è·å¾—æ­¤å¯¹è±¡ï¼Œæ‚¨éœ€è¦ï¼š <code>var stream = InputStream(string)</code> ã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä»¥ä¸‹æŠ½è±¡çº§åˆ«ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»¤ç‰Œæµï¼ˆä»¤ç‰Œï¼‰</a> ã€‚ </p><br><a name="TokenStream"></a><br><h1 id="potok-tokenov-leksem"> ä»¤ç‰Œæµï¼ˆä»¤ç‰Œï¼‰ </h1><br><p> æ ‡è®°å™¨ï¼ˆlexerï¼‰ä½¿ç”¨å­—ç¬¦æµå¹¶è¿”å›å…·æœ‰ç›¸åŒæ¥å£çš„å¯¹è±¡ï¼Œä½†æ˜¯<code>peek()</code> / <code>next()</code>å‡½æ•°çš„è¿”å›å€¼å°†æ˜¯æ ‡è®°ã€‚ ä»¤ç‰Œæ˜¯å…·æœ‰ä¸¤ä¸ªå±æ€§çš„<code>type</code> ï¼š <code>type</code> ï¼Œ <code>value</code> ã€‚ ä»¥ä¸‹æ˜¯ä»¤ç‰Œçš„ä¸€äº›ç¤ºä¾‹ï¼š </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"punc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">"("</span></span> } <span class="hljs-comment"><span class="hljs-comment">// . : , ,     . . { type: "num", value: 5 } //  { type: "str", value: "Hello World!" } //  { type: "kw", value: "lambda" } //   { type: "var", value: "a" } //  { type: "op", value: "!=" } // </span></span></code> </pre> <br><p> åªéœ€è·³è¿‡ç©ºæ ¼ï¼ˆç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼Œæ¢è¡Œç¬¦ï¼‰å’Œæ³¨é‡Šã€‚ </p><br><p> è¦ç¼–å†™ä»¤ç‰Œç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬éœ€è¦ä»”ç»†ç ”ç©¶ä¸€ä¸‹æˆ‘ä»¬çš„è¯­è¨€ã€‚ è¿™ä¸ªæƒ³æ³•æ˜¯è¦æ³¨æ„ï¼Œæ ¹æ®å½“å‰å­—ç¬¦ï¼ˆ <code>input.peek()</code> ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šè¯»å–å“ªä¸ªæ ‡è®°ï¼š </p><br><ul><li> é¦–å…ˆï¼Œè·³è¿‡ç©ºæ ¼ã€‚ </li><li> å¦‚æœä¸º<code>input.eof()</code> ï¼Œåˆ™è¿”å›<code>null</code> ã€‚ </li><li> å¦‚æœå®ƒæ˜¯<code>#</code>å­—ç¬¦ï¼Œåˆ™å°†æ‰€æœ‰å­—ç¬¦è·³è¿‡åˆ°è¯¥è¡Œçš„æœ«å°¾ï¼ˆå¹¶è¿”å›ä¸‹ä¸€ä¸ªæ ‡è®°ï¼‰ã€‚ </li><li> å¦‚æœè¿™æ˜¯å¼•å·ï¼Œåˆ™è¯»å–å­—ç¬¦ä¸²ã€‚ </li><li> å¦‚æœè¿™æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¯·é˜…è¯»è¯¥æ•°å­—ã€‚ </li><li> å¦‚æœæ˜¯å­—æ¯ï¼Œåˆ™æˆ‘ä»¬è¯»å–å•è¯ï¼Œç„¶åè¿”å›æ ‡è¯†ç¬¦æˆ–å…³é”®å­—ã€‚ </li><li> å¦‚æœè¿™æ˜¯ç‰¹æ®Šå­—ç¬¦ä¹‹ä¸€ï¼Œåˆ™è¿”å›ç›¸åº”çš„æ ‡è®°ã€‚ </li><li> å¦‚æœè¿™æ˜¯è¿ç®—ç¬¦çš„ç¬¦å·ä¹‹ä¸€ï¼Œåˆ™æˆ‘ä»¬è¿”å›ç›¸åº”çš„ä»¤ç‰Œã€‚ </li><li> å¦‚æœä»¥ä¸Šéƒ½ä¸é€‚ç”¨ï¼Œåˆ™ä½¿ç”¨<code>input.croak()</code>å¼•å‘å¼‚å¸¸ã€‚ </li></ul><br><p> æˆ‘ä»¬å°†æ‹¥æœ‰<code>read_next</code>å‡½æ•°ï¼Œè¿™æ˜¯åˆ†è¯å™¨çš„ä¸»è¦åŠŸèƒ½ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ read_while(is_whitespace); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (input.eof()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"#"</span></span>) { skip_comment(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_next(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">'"'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_string(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_digit(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_number(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_id_start(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_ident(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"punc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : input.next() }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_op_char(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"op"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : read_while(is_op_char) }; input.croak(<span class="hljs-string"><span class="hljs-string">"Can't handle character: "</span></span> + ch); }</code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°è®¸å¤šå…¶ä»–å‡½æ•°ï¼Œå®ƒä»¬è¿”å›ä¸åŒç±»å‹çš„ä»¤ç‰Œï¼Œä¾‹å¦‚<code>read_string()</code> ï¼Œ <code>read_number()</code>ç­‰ã€‚...å®ƒä»¬è¢«æ”¾ç½®åœ¨å•ç‹¬çš„å‡½æ•°ä¸­ï¼Œå› æ­¤ä»£ç çœ‹èµ·æ¥æ›´ç®€å•ï¼Œæ›´æ¼‚äº®ã€‚ </p><br><p> å¦å¤–ï¼Œæœ‰è¶£çš„æ˜¯æˆ‘ä»¬ä¸ä¼šä¸€æ¬¡åˆ é™¤æ‰€æœ‰ç¬¦å·ï¼šæ¯æ¬¡è§£æå™¨è¦æ±‚ä¸‹ä¸€ä¸ªä»¤ç‰Œæ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šè¯»å–ä¸€ä¸ªä»¤ç‰Œã€‚ å¦‚æœå‘ç”ŸæŸç§é”™è¯¯ï¼Œæˆ‘ä»¬ç”šè‡³ä¸ä¼šé˜…è¯»æ‰€æœ‰å­—ç¬¦ã€‚ </p><br><p>  <code>read_ident()</code>å°†è¯»å–å¯èƒ½æ˜¯æ ‡è¯†ç¬¦ï¼ˆ <code>is_id()</code> ï¼‰ä¸€éƒ¨åˆ†çš„æ‰€æœ‰å­—ç¬¦ã€‚ æ ‡è¯†ç¬¦å¿…é¡»ä»¥å­—æ¯<code>Î»</code>æˆ–<code>_</code>å¼€å¤´ï¼Œå¹¶ä¸”å¯ä»¥åŒ…å«ç›¸åŒçš„å­—ç¬¦ï¼Œæ•°å­—æˆ–ä»¥ä¸‹ä»»æ„ä¸€é¡¹ï¼š <code>?!-&lt;&gt;=</code> ã€‚ å› æ­¤ï¼Œ <code>foo-bar</code>ä¸ä¼šè¢«è¯»å–ä¸ºä¸‰ä¸ªä»¤ç‰Œï¼Œè€Œå°†è¢«è¯»å–ä¸ºä¸€ä¸ªï¼ˆ <code>var</code> tokenï¼‰ã€‚ ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨<code>is-pair?</code>åç§°å®šä¹‰å‡½æ•°ï¼Œè¿™æ˜¯å¦å¿…è¦<code>is-pair?</code> æˆ–<code>string&gt;=</code> ï¼ˆå¯¹ä¸èµ·ï¼Œæˆ‘æ˜¯Lisperï¼‰ã€‚ </p><br><p> å¦å¤–ï¼Œ <code>read_ident()</code>å°†æ£€æŸ¥å·²çŸ¥å…³é”®å­—åˆ—è¡¨ä¸­æ˜¯å¦å­˜åœ¨æ ‡è¯†ç¬¦ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å°†è¿”å›<code>kw</code>ä»¤ç‰Œè€Œä¸æ˜¯<code>var</code>ä»¤ç‰Œã€‚ </p><br><p> æˆ‘è®¤ä¸ºä»£ç è¯´æ˜äº†ä¸€åˆ‡ï¼Œå› æ­¤è¿™æ˜¯æˆ‘ä»¬è¯­è¨€çš„ç°æˆæ ‡è®°å™¨ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">æ•´ä¸ªä»£ç </b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TokenStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keywords = <span class="hljs-string"><span class="hljs-string">" if then else lambda Î» true false "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">next</span></span> : next, <span class="hljs-attr"><span class="hljs-attr">peek</span></span> : peek, <span class="hljs-attr"><span class="hljs-attr">eof</span></span> : eof, <span class="hljs-attr"><span class="hljs-attr">croak</span></span> : input.croak }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_keyword</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keywords.indexOf(<span class="hljs-string"><span class="hljs-string">" "</span></span> + x + <span class="hljs-string"><span class="hljs-string">" "</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_digit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-regexp"><span class="hljs-regexp">/[0-9]/i</span></span>.test(ch); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_id_start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-regexp"><span class="hljs-regexp">/[a-zÎ»_]/i</span></span>.test(ch); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_id</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_id_start(ch) || <span class="hljs-string"><span class="hljs-string">"?!-&lt;&gt;=0123456789"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_op_char</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"+-*/%=&amp;|&lt;&gt;!"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_punc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">",;(){}[]"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_whitespace</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">" \t\n"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_while</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">predicate</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> str = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof() &amp;&amp; predicate(input.peek())) str += input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_number</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> has_dot = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> number = read_while(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"."</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (has_dot) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; has_dot = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_digit(ch); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">parseFloat</span></span>(number) }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_ident</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = read_while(is_id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : is_keyword(id) ? <span class="hljs-string"><span class="hljs-string">"kw"</span></span> : <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : id }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_escaped</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">end</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> escaped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, str = <span class="hljs-string"><span class="hljs-string">""</span></span>; input.next(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (escaped) { str += ch; escaped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"\\"</span></span>) { escaped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == end) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { str += ch; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_string</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"str"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: read_escaped(<span class="hljs-string"><span class="hljs-string">'"'</span></span>) }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_comment</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ read_while(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ch != <span class="hljs-string"><span class="hljs-string">"\n"</span></span> }); input.next(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ read_while(is_whitespace); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (input.eof()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"#"</span></span>) { skip_comment(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_next(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">'"'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_string(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_digit(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_number(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_id_start(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_ident(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"punc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : input.next() }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_op_char(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"op"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : read_while(is_op_char) }; input.croak(<span class="hljs-string"><span class="hljs-string">"Can't handle character: "</span></span> + ch); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">peek</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> current || (current = read_next()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = current; current = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok || read_next(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eof</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> peek() == <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> </div></div><br><ul><li>  <code>next()</code>å‡½æ•°å¹¶ä¸æ€»æ˜¯è°ƒç”¨<code>read_next()</code> ï¼Œå› ä¸ºä»¥å‰å¯èƒ½å·²ç»è¯»å–äº†ä¸€ä¸ªä»¤ç‰Œï¼ˆä½¿ç”¨<code>peek()</code>å‡½æ•°ï¼‰ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«å½“å‰æ ‡è®°çš„<code>current</code>å˜é‡ã€‚ </li><li> å¸¸è§„è¡¨ç¤ºæ³•ä»…æ”¯æŒåè¿›åˆ¶æ•°å­—ï¼ˆä¸æ”¯æŒ1E5ã€0xç­‰ï¼‰ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å¢åŠ ä»–ä»¬çš„æ”¯æŒï¼Œæˆ‘ä»¬åªä¼šæ›´æ”¹<code>read_number()</code> ã€‚ </li><li> ä¸JavaScriptä¸åŒï¼Œå”¯ä¸€ä¸èƒ½åœ¨å­—ç¬¦ä¸²ä¸­è½¬ä¹‰çš„å­—ç¬¦æ˜¯å¼•å·å’Œåæ–œæ ã€‚ è¡Œå¯ä»¥åŒ…å«æ¢è¡Œç¬¦ï¼Œåˆ¶è¡¨ç¬¦å’Œå…¶ä»–ä»»ä½•å†…å®¹ã€‚ æˆ‘ä»¬ä¸è§£é‡Šè¯¸å¦‚<code>\n</code> ï¼Œ <code>\t</code>ç­‰æ ‡å‡†ç»„åˆã€‚...é‡åšï¼ˆ <code>read_string()</code> ï¼‰éå¸¸å®¹æ˜“ã€‚ </li></ul><br><p> ç°åœ¨æˆ‘ä»¬æœ‰äº†åŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥è½»æ¾ç¼–å†™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è§£æå™¨</a> ï¼Œä½†æ˜¯é¦–å…ˆï¼Œæˆ‘å»ºè®®æ‚¨æŸ¥çœ‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ASTæè¿°</a> ã€‚ </p><br><a name="AST"></a><br><h1 id="opisanie-ast">  ASTè¯´æ˜ </h1><br><p> å¦‚ä¸Šæ‰€è¿°ï¼Œè§£æå™¨å°†æ„å»ºä¸€ä¸ªç»“æ„ï¼Œä»¥æ˜¾ç¤ºç¨‹åºçš„è¯­ä¹‰ã€‚  ASTç”±èŠ‚ç‚¹ç»„æˆã€‚ æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªå¸¸è§„JavaScriptå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…·æœ‰<code>type</code>å±æ€§ï¼Œè¯¥å±æ€§ç¡®å®šèŠ‚ç‚¹çš„ç±»å‹ä»¥åŠå–å†³äºè¯¥ç±»å‹çš„å…¶ä»–ä¿¡æ¯ã€‚ </p><br><table><thead><tr><th> å‹å¼ </th><th> ç»“æ„å½¢å¼ </th></tr></thead><tbody><tr><td> æ•° </td><td> <code>{ type: "num", value: NUMBER }</code> </td> </tr><tr><td> åŠ›é‡ </td><td> <code>{ type: "str", value: STRING }</code> </td> </tr><tr><td> å¸ƒå°” </td><td> <code>{ type: "bool", value: true or false }</code> </td> </tr><tr><td> å˜ç§ </td><td> <code>{ type: "var", value: NAME }</code> </td> </tr><tr><td> æ‹‰å§†è¾¾ </td><td> <code>{ type: "lambda", vars: [ NAME... ], body: AST }</code> </td> </tr><tr><td> å« </td><td> <code>{ type: "call", func: AST, args: [ AST... ] }</code> </td> </tr><tr><td> å¦‚æœ </td><td> <code>{ type: "if", cond: AST, then: AST, else: AST }</code> </td> </tr><tr><td> åˆ†é… </td><td> <code>{ type: "assign", operator: "=", left: AST, right: AST }</code> </td> </tr><tr><td> äºŒå…ƒ </td><td> <code>{ type: "binary", operator: OPERATOR, left: AST, right: AST }</code> </td> </tr><tr><td> ç¼– </td><td> <code>{ type: "prog", prog: [ AST... ] }</code> </td> </tr><tr><td> è®© </td><td> <code>{ type: "let", vars: [ VARS... ], body: AST }</code> </td> </tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">ä¾‹å­</b> <div class="spoiler_text"><h5 id="chisla-num"> æ•°å­—ï¼ˆ <code>num</code> ï¼‰ï¼š </h5><br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">123.5</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">123.5</span></span> }</code> </pre> <br><h5 id="stroki-str"> è¡Œï¼ˆ <code>str</code> ï¼‰ï¼š </h5><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"Hello World"</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"str"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span> }</code> </pre> <br><h5 id="true-i-false-bool">  <code>true</code>ä¸<code>false</code> ï¼ˆ <code>bool</code> ï¼‰ï¼š </h5><br><pre> <code class="python hljs">true false</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><h5 id="identifikatory-var"> æ ‡è¯†ç¬¦ï¼ˆ <code>var</code> ï¼‰ï¼š </h5><br><pre> <code class="python hljs">foo</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }</code> </pre> <br><h5 id="funkcii-lambda"> å‡½æ•°ï¼ˆ <code>lambda</code> ï¼‰ï¼š </h5><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> (x) <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">#  Î» (x) 10</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>, <span class="hljs-attr"><span class="hljs-attr">vars</span></span>: [ <span class="hljs-string"><span class="hljs-string">"x"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">body</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } }</code> </pre> <br><p> ç¨åï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªå¯é€‰çš„å‚æ•°<code>name</code>ä»¥æ”¯æŒå¸¦æœ‰åç§°çš„å‡½æ•°ï¼Œä½†è§£æå™¨çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬å°†ä¸æ”¯æŒå®ƒä»¬ã€‚ </p><br><h5 id="vyzovy-funkciy-call"> å‡½æ•°è°ƒç”¨ï¼ˆ <code>call</code> ï¼‰ï¼š </h5><br><pre> <code class="python hljs">foo(a, <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"call"</span></span>, <span class="hljs-string"><span class="hljs-string">"func"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }, <span class="hljs-string"><span class="hljs-string">"args"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ] }</code> </pre> <br><h5 id="vetvleniya-if"> åˆ†æ”¯ï¼ˆ <code>if</code> ï¼‰ï¼š </h5><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> foo then bar <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> baz</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-string"><span class="hljs-string">"cond"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }, <span class="hljs-string"><span class="hljs-string">"then"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"bar"</span></span> }, <span class="hljs-string"><span class="hljs-string">"else"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"baz"</span></span> } }</code> </pre> <br><h6 id="bez-else"> æ²¡æœ‰<code>else</code> ï¼š </h6><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> foo then bar</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-string"><span class="hljs-string">"cond"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }, <span class="hljs-string"><span class="hljs-string">"then"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"bar"</span></span> } }</code> </pre> <br><h5 id="prisvaivanie-assign"> ä½œä¸šï¼š </h5><br><pre> <code class="python hljs">a = <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"assign"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"="</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } }</code> </pre> <br><h5 id="binarnye-operatory-binary"> äºŒè¿›åˆ¶è¿ç®—ç¬¦ï¼ˆ <code>binary</code> ï¼‰ï¼š </h5><br><pre> <code class="python hljs">x + y * z</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"x"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"y"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"z"</span></span> } } }</code> </pre> <br><h5 id="posledovtelnosti-prog"> åºåˆ—ï¼ˆ <code>prog</code> ï¼‰ï¼š </h5><br><pre> <code class="python hljs">{ a = <span class="hljs-number"><span class="hljs-number">5</span></span>; b = a * <span class="hljs-number"><span class="hljs-number">2</span></span>; a + b; }</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-string"><span class="hljs-string">"prog"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"assign"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"="</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"assign"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"="</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } } }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> } } ] }</code> </pre> <br><h5 id="peremennye-zaklyuchennye-v-bloki-let"> åŒ…å«åœ¨å—ä¸­çš„å˜é‡ï¼ˆ <code>let</code> ï¼‰ï¼š </h5><br><pre> <code class="python hljs">let (a = <span class="hljs-number"><span class="hljs-number">10</span></span>, b = a * <span class="hljs-number"><span class="hljs-number">10</span></span>) { a + b; }</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"let"</span></span>, <span class="hljs-string"><span class="hljs-string">"vars"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-string"><span class="hljs-string">"def"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span>, <span class="hljs-string"><span class="hljs-string">"def"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } } } ], <span class="hljs-string"><span class="hljs-string">"body"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> } } }</code> </pre> <br><p> è§£æå™¨çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸æ”¯æŒè¿™ç§ç±»å‹çš„èŠ‚ç‚¹ï¼›ç¨åæˆ‘ä»¬å°†æ·»åŠ å®ƒã€‚ </p></div></div><br><a name="Parser"></a><br><h1 id="parser"> è§£æå™¨ </h1><br><p> è§£æå™¨å°†æ„å»ºä¸Šè¿°æ ‘ã€‚ </p><br><p> ç”±äºæˆ‘ä»¬åœ¨ä»¤ç‰Œç”Ÿæˆå™¨ä¸­æ‰€åšçš„å·¥ä½œï¼Œå› æ­¤è§£æå™¨å¯ä»¥å¤„ç†ä»¤ç‰Œæµè€Œä¸æ˜¯å­—ç¬¦æµã€‚ è¿™é‡Œè¿˜æœ‰è®¸å¤šå…¶ä»–åŠŸèƒ½å¯ä»¥ç®€åŒ–ç»“æ„ã€‚ æˆ‘ä»¬å°†è®¨è®ºä¸»è¦çš„ã€‚ è®©æˆ‘ä»¬ä»ä¸€ä¸ªé«˜çº§çš„è§£æå™¨åŠŸèƒ½å¼€å§‹ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>, <span class="hljs-attr"><span class="hljs-attr">vars</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_varname), <span class="hljs-attr"><span class="hljs-attr">body</span></span>: parse_expression() }; }</code> </pre> <br><p> å½“å·²ç»ä»ä»¤ç‰Œæµä¸­è·å–äº†<code>lambda</code>å…³é”®å­—æ—¶ï¼Œå°†è°ƒç”¨æ­¤å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦è·å–å‚æ•°çš„åç§°å³å¯ã€‚ ä½†æ˜¯ç”±äºå®ƒä»¬åœ¨æ–¹æ‹¬å·ä¸­å¹¶ç”¨é€—å·åˆ†éš”ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨å®š<code>delimited</code>å‡½æ•°æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œè¯¥å‡½æ•°é‡‡ç”¨ä»¥ä¸‹å‚æ•°ï¼š <code>start</code> ï¼Œ <code>stop</code> ï¼Œ <code>separator</code> ï¼Œ <code>parser</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°åˆ†åˆ«è§£ææ¯ä¸ªå…ƒç´ ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>parse_varname</code>å‡½æ•°ï¼Œå¦‚æœå®ƒæ³¨æ„åˆ°ä¸€äº›çœ‹èµ·æ¥ä¸åƒå˜é‡çš„å‡½æ•°ï¼Œ <code>parse_varname</code>å¼•å‘é”™è¯¯ã€‚ è¯¥å‡½æ•°çš„ä¸»ä½“æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>parse_expression</code>è·å¾—å®ƒã€‚ </p><br><p>  <code>delimited</code>åŠŸèƒ½ä¸ºè¾ƒä½çº§åˆ«ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delimited</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">start, stop, separator, parser</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = [], first = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; skip_punc(start); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first) first = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> skip_punc(separator); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      a.push(parser()); } skip_punc(stop); return a; }</span></span></code> </pre> <br><p> å¦‚æ‚¨æ‰€è§ï¼Œå®ƒä½¿ç”¨äº†æ›´å¤šåŠŸèƒ½ï¼š <code>is_punc</code>å’Œ<code>skip_punc</code> ã€‚ å¦‚æœå½“å‰æ ‡è®°æ˜¯ç»™å®šçš„æ ‡ç‚¹ç¬¦å·ï¼ˆä¸æå–å®ƒï¼‰ï¼Œåˆ™ç¬¬ä¸€ä¸ªè¿”å›<code>true</code> ï¼Œè€Œ<code>skip_punc</code>å°†æ£€æŸ¥å½“å‰æ ‡è®°æ˜¯å¦æ˜¯ç»™å®šçš„æ ‡ç‚¹å­—ç¬¦å¹¶æå–å®ƒï¼ˆå¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚ </p><br><p> è§£ææ•´ä¸ªç¨‹åºçš„å‡½æ•°ä¼¼ä¹æ˜¯æœ€ç®€å•çš„ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_toplevel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prog = []; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { prog.push(parse_expression()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!input.eof()) skip_punc(<span class="hljs-string"><span class="hljs-string">";"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: prog }; }</code> </pre> <br><p> ç”±äºæˆ‘ä»¬åªæœ‰è¡¨è¾¾å¼ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è°ƒç”¨<code>parse_expression()</code>å¹¶è¯»å–è¡¨è¾¾å¼ï¼Œç›´åˆ°è¯»å–æ‰€æœ‰å†…å®¹ã€‚ ä½¿ç”¨<code>skip_punc(";")</code> ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°<code>;</code> æ¯ä¸ªè¡¨è¾¾å¼åå¿…é¡»è¾“å…¥ã€‚ </p><br><p> å¦ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ˜¯<code>parse_if()</code> ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_if</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ skip_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cond = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) skip_kw(<span class="hljs-string"><span class="hljs-string">"then"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> then = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ret = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cond</span></span>: cond, <span class="hljs-attr"><span class="hljs-attr">then</span></span>: then }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"else"</span></span>)) { input.next(); ret.else = parse_expression(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre> <br><p> å¥¹è·³è¿‡<code>if</code>å…³é”®å­—ï¼ˆå¦‚æœå½“å‰ä»¤ç‰Œä¸æ˜¯<code>if</code>å…³é”®å­—ï¼Œ <code>if</code>æŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œä½¿ç”¨<code>parse_expression()</code>è¯»å–æ¡ä»¶ã€‚ å¦‚æœç¬¦å·<code>{</code>æ²¡æœ‰æ›´è¿›ä¸€æ­¥ï¼Œåˆ™éœ€è¦thenå…³é”®å­—ï¼ˆå¦‚æœæ²¡æœ‰å®ƒï¼Œè¯­æ³•çœ‹èµ·æ¥ä¼šä¸å¤ªå¥½ï¼‰ã€‚ åˆ†æ”¯åªæ˜¯è¡¨è¾¾å¼ï¼Œå› æ­¤æˆ‘ä»¬å†æ¬¡å¯¹å…¶ä½¿ç”¨<code>parse_expression()</code> ã€‚  <code>else</code>åˆ†æ”¯æ˜¯å¯é€‰çš„ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è§£æå…³é”®å­—ä¹‹å‰å…ˆæ£€æŸ¥è¯¥å…³é”®å­—çš„å­˜åœ¨ã€‚ </p><br><p> é€šè¿‡è®¸å¤šå°çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ä»£ç ç®€å•ã€‚ æˆ‘ä»¬ç¼–å†™è§£æå™¨çš„æ–¹å¼å‡ ä¹ä¸ä½¿ç”¨é«˜çº§è¯­è¨€æ¥è§£æè¯­æ³•çš„æ–¹å¼ä¸€æ ·ã€‚ æ‰€æœ‰è¿™äº›å‡½æ•°éƒ½æ˜¯â€œç›¸äº’é€’å½’â€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æœ‰<code>parse_atom()</code> ï¼Œå®ƒæ ¹æ®å½“å‰æ ‡è®°è°ƒç”¨å…¶ä»–å‡½æ•°ã€‚ å…¶ä¸­ä¹‹ä¸€æ˜¯<code>parse_if()</code> ï¼ˆåœ¨å½“å‰æ ‡è®°ä¸º<code>if</code>è°ƒç”¨ï¼‰ï¼Œç„¶åä¾æ¬¡è°ƒç”¨<code>parse_expression()</code> ã€‚ ä½†æ˜¯<code>parse_expression()</code>è°ƒç”¨<code>parse_atom()</code> ã€‚ ç”±äºå‡½æ•°ä¹‹ä¸€æ€»æ˜¯æå–è‡³å°‘ä¸€ä¸ªä»¤ç‰Œï¼Œå› æ­¤æ²¡æœ‰æ— é™é€’å½’ã€‚ </p><br><p> è¿™ç§è§£ææ–¹æ³•ç§°ä¸ºâ€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€’å½’ä¸‹é™æ³•â€</a> ï¼Œå®é™…ä¸Šï¼Œè¿™æ˜¯æœ€å®¹æ˜“ç¼–å†™çš„ã€‚ </p><br><h3 id="bolee-nizkiy-uroven-parse_atom-i-parse_expression"> ä¸‹å±‚ï¼š <code>parse_atom()</code>å’Œ<code>parse_expression()</code> </h3><br><p>  <code>parse_atom()</code>å‡½æ•°è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ï¼Œå…·ä½“å–å†³äºå½“å‰ä»¤ç‰Œï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_atom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> exp = parse_expression(); skip_punc(<span class="hljs-string"><span class="hljs-string">")"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exp; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_prog(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_if(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"true"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"false"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_bool(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"lambda"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"Î»"</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_lambda(); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok.type == <span class="hljs-string"><span class="hljs-string">"var"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"num"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"str"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok; unexpected(); }); }</code> </pre> <br><p> å½“å¥¹çœ‹åˆ°<code>parse_expression()</code>æ‹¬å·æ—¶ï¼Œåº”è¯¥åŠ ä¸Šæ‹¬å·è¡¨è¾¾å¼ï¼Œå› æ­¤ï¼Œè·³è¿‡è¯¥æ–¹æ‹¬å·ï¼Œè¯¥å‡½æ•°å°†è°ƒç”¨<code>parse_expression()</code>å¹¶å¸Œæœ›æ­¤åè·³è¿‡è¯¥å³æ–¹æ‹¬å·ã€‚ å¦‚æœå¥¹çœ‹åˆ°æŸç§å…³é”®å­—ï¼Œåˆ™å°†è°ƒç”¨ç›¸åº”çš„å‡½æ•°ã€‚ å¦‚æœå¥¹çœ‹åˆ°ä¸€ä¸ªå¸¸é‡æˆ–æ ‡è¯†ç¬¦ï¼Œåˆ™æŒ‰åŸæ ·è¿”å›å®ƒã€‚ å¦‚æœä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿï¼Œå®ƒå°†è°ƒç”¨<code>unexpected()</code> ï¼Œè¿™å°†å¼•å‘å¼‚å¸¸ã€‚ </p><br><p> å½“çœ‹åˆ°<code>{</code> ï¼Œå¥¹è°ƒç”¨<code>parse_prog</code>æ¥è§£æè¡¨è¾¾å¼åºåˆ—ã€‚ å¦å¤–ï¼Œ <code>parse_prog</code>äº†ä¸€ä¸ªç®€å•çš„ä¼˜åŒ–ï¼šå¦‚æœ<code>{</code>å’Œ<code>}</code>ä¹‹é—´æ²¡æœ‰è¡¨è¾¾å¼ï¼Œåˆ™è¿”å›<code>false</code> ï¼›å¦‚æœåªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œåˆ™ä»…è¿”å›å®ƒã€‚ å¦åˆ™ï¼Œå°†è¿”å›å¸¦æœ‰è¡¨è¾¾å¼æ•°ç»„çš„<code>prog</code>èŠ‚ç‚¹ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     FALSE   , //     . var FALSE = { type: "bool", value: false }; function parse_prog() { var prog = delimited("{", "}", ";", parse_expression); if (prog.length == 0) return FALSE; if (prog.length == 1) return prog[0]; return { type: "prog", prog: prog }; }</span></span></code> </pre> <br><p> è¿™æ˜¯<code>parse_expression()</code>å‡½æ•°ã€‚ ä¸<code>parse_atom()</code>ä¸åŒï¼Œå®ƒå°†ä½¿ç”¨<code>maybe_binary()</code>è§£æå°½å¯èƒ½å¤šçš„è¡¨è¾¾å¼ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_expression</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_binary(parse_atom(), <span class="hljs-number"><span class="hljs-number">0</span></span>); }); }</code> </pre> <br><h3 id="funkcii-maybe_"> åŠŸèƒ½å¯èƒ½<code>maybe_*</code> </h3><br><p> è¿™äº›å‡½æ•°æ£€æŸ¥è¡¨è¾¾å¼ä¹‹åçš„å†…å®¹ï¼Œå¹¶ç¡®å®šæ˜¯å°†è¡¨è¾¾å¼åŒ…è£…åœ¨å…¶èŠ‚ç‚¹ä¸­è¿˜æ˜¯ç›´æ¥è¿”å›è¯¥èŠ‚ç‚¹ã€‚ </p><br><p>  <code>maybe_call()</code>å‡½æ•°éå¸¸ç®€å•ï¼šå®ƒè·å¾—äº†ä¸€ä¸ªè§£æå½“å‰è¡¨è¾¾å¼çš„å‡½æ•°ï¼Œå¦‚æœé‡åˆ°<code>(</code>åœ¨è¡¨è¾¾å¼ä¹‹åï¼Œå®ƒå°†è‡ªèº«åŒ…è£…åœ¨<code>call</code> ã€‚è¯·æ³¨æ„<code>delimited()</code>å¦‚ä½•é€‚åˆè§£æå‚æ•°åˆ—è¡¨ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">expr</span></span></span><span class="hljs-function">) </span></span>{ expr = expr(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>) ? parse_call(expr) : expr; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"call"</span></span>, <span class="hljs-attr"><span class="hljs-attr">func</span></span>: func, <span class="hljs-attr"><span class="hljs-attr">args</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_expression) }; }</code> </pre> <br><h3 id="prioritet-operatorov"> æ“ä½œå‘˜ä¼˜å…ˆ </h3><br><p>  <code>maybe_binary(left, my_prec)</code>å‡½æ•°ç”¨äºç»„åˆè¯¸å¦‚<code>1 + 2 * 3</code>è¡¨è¾¾å¼ã€‚   , ,    ,     : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> PRECEDENCE = { <span class="hljs-string"><span class="hljs-string">"="</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"||"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;&amp;"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"=="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"!="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"+"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"/"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"%"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, };</code> </pre> <br><p>   ,  <code>*</code> "",  <code>+</code> , ,  <code>1 + 2 * 3</code>    <code>(1 + (2 * 3))</code>  <code>((1 + 2) * 3)</code> . </p><br><p>   ,      ( <code>read_atom</code> )     <code>maybe_binary()</code> ( ),     ( <code>my_prec</code> ).  <code>maybe_binary</code>  ,   .     ,     ,     . </p><br><p>   ,    ,   ,         <code>binary</code> ,  ,       ,      (*): </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_binary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left, my_prec</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = is_op(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> his_prec = PRECEDENCE[tok.value]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (his_prec &gt; my_prec) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> right = maybe_binary(parse_atom(), his_prec) <span class="hljs-comment"><span class="hljs-comment">// (*); var binary = { type : tok.value == "=" ? "assign" : "binary", operator : tok.value, left : left, right : right }; return maybe_binary(binary, my_prec); } } return left; }</span></span></code> </pre> <br><p>  ,  ,     ,    <code>maybe_binary</code> ,    ( <code>my_prec</code> ),  ,      ,     .  - ,    (,        ),     . </p><br><p> ,   ,  <code>my_prec</code>   0,         <code>binary</code> ( <code>assign</code>   <code>=</code> ). </p><br><p>      ,    . </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FALSE = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> PRECEDENCE = { <span class="hljs-string"><span class="hljs-string">"="</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"||"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;&amp;"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"=="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"!="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"+"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"/"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"%"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_toplevel(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_punc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok &amp;&amp; tok.type == <span class="hljs-string"><span class="hljs-string">"punc"</span></span> &amp;&amp; (!ch || tok.value == ch) &amp;&amp; tok; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_kw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">kw</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok &amp;&amp; tok.type == <span class="hljs-string"><span class="hljs-string">"kw"</span></span> &amp;&amp; (!kw || tok.value == kw) &amp;&amp; tok; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_op</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">op</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok &amp;&amp; tok.type == <span class="hljs-string"><span class="hljs-string">"op"</span></span> &amp;&amp; (!op || tok.value == op) &amp;&amp; tok; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_punc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(ch)) input.next(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting punctuation: \""</span></span> + ch + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_kw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">kw</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(kw)) input.next(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting keyword: \""</span></span> + kw + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_op</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">op</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_op(op)) input.next(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting operator: \""</span></span> + op + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unexpected</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ input.croak(<span class="hljs-string"><span class="hljs-string">"Unexpected token: "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(input.peek())); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_binary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left, my_prec</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = is_op(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> his_prec = PRECEDENCE[tok.value]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (his_prec &gt; my_prec) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_binary({ <span class="hljs-attr"><span class="hljs-attr">type</span></span> : tok.value == <span class="hljs-string"><span class="hljs-string">"="</span></span> ? <span class="hljs-string"><span class="hljs-string">"assign"</span></span> : <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-attr"><span class="hljs-attr">operator</span></span> : tok.value, <span class="hljs-attr"><span class="hljs-attr">left</span></span> : left, <span class="hljs-attr"><span class="hljs-attr">right</span></span> : maybe_binary(parse_atom(), his_prec) }, my_prec); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delimited</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">start, stop, separator, parser</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = [], first = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; skip_punc(start); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first) first = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> skip_punc(separator); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; a.push(parser()); } skip_punc(stop); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"call"</span></span>, <span class="hljs-attr"><span class="hljs-attr">func</span></span>: func, <span class="hljs-attr"><span class="hljs-attr">args</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_expression), }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_varname</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name.type != <span class="hljs-string"><span class="hljs-string">"var"</span></span>) input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting variable name"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name.value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_if</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ skip_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cond = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) skip_kw(<span class="hljs-string"><span class="hljs-string">"then"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> then = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ret = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cond</span></span>: cond, <span class="hljs-attr"><span class="hljs-attr">then</span></span>: then, }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"else"</span></span>)) { input.next(); ret.else = parse_expression(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>, <span class="hljs-attr"><span class="hljs-attr">vars</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_varname), <span class="hljs-attr"><span class="hljs-attr">body</span></span>: parse_expression() }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_bool</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : input.next().value == <span class="hljs-string"><span class="hljs-string">"true"</span></span> }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">expr</span></span></span><span class="hljs-function">) </span></span>{ expr = expr(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>) ? parse_call(expr) : expr; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_atom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> exp = parse_expression(); skip_punc(<span class="hljs-string"><span class="hljs-string">")"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exp; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_prog(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_if(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"true"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"false"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_bool(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"lambda"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"Î»"</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_lambda(); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok.type == <span class="hljs-string"><span class="hljs-string">"var"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"num"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"str"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok; unexpected(); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_toplevel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prog = []; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { prog.push(parse_expression()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!input.eof()) skip_punc(<span class="hljs-string"><span class="hljs-string">";"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: prog }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_prog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prog = delimited(<span class="hljs-string"><span class="hljs-string">"{"</span></span>, <span class="hljs-string"><span class="hljs-string">"}"</span></span>, <span class="hljs-string"><span class="hljs-string">";"</span></span>, parse_expression); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prog.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prog.length == <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prog[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: prog }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_expression</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_binary(parse_atom(), <span class="hljs-number"><span class="hljs-number">0</span></span>); }); } }</code> </pre> </div></div><br><h2 id="blagodarnosti">  </h2><br><p>   Marijn Haverbeke,   parse-js (Common Lisp),    ,   . ,        ,  JS,      . </p><br><p>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">     JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬2éƒ¨åˆ†ï¼šç¿»è¯‘</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN443630/">https://habr.com/ru/post/zh-CN443630/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN443618/index.html">æµè§ˆå™¨ä¸­çš„80å¹´ä»£è®¡ç®—æœºæ¨¡æ‹Ÿå™¨</a></li>
<li><a href="../zh-CN443620/index.html">æˆ‘ä»¬çš„ä¾èµ–é—®é¢˜</a></li>
<li><a href="../zh-CN443624/index.html">Digital Workså’ŒVMwareï¼šVDIå·²æ­»ï¼ŒVDIæ°¸æ— æ­¢å¢ƒ</a></li>
<li><a href="../zh-CN443626/index.html">æ¬¢è¿æ¥åˆ°2019é¡¶çº§3Dåšè§ˆä¼š</a></li>
<li><a href="../zh-CN443628/index.html">SymPyç¬¦å·æ•°å­¦ç¨‹åºä¸­çš„è´å¡å°”å‡½æ•°</a></li>
<li><a href="../zh-CN443636/index.html">è«å°”æ–¯Â·å‡¯æ–¯å’Œå…‹æ´›æ™®è´¹å°”</a></li>
<li><a href="../zh-CN443638/index.html">Protonmailå¦‚ä½•å—åˆ°ä¿„ç½—æ–¯FSBçš„å®¡æŸ¥</a></li>
<li><a href="../zh-CN443640/index.html">æ°´ç£¨çŸ³</a></li>
<li><a href="../zh-CN443642/index.html">ç¾å›½å®‡èˆªå±€å±€é•¿è®¤ä¸ºæœ‰å¯èƒ½ä½¿ç”¨å•†ä¸šç«ç®­åœ¨æœˆçƒçš„ç¬¬ä¸€æ¬¡èˆªè¡Œä¸­å‘é€çŒæˆ·åº§</a></li>
<li><a href="../zh-CN443644/index.html">ç”¨Unityå·é¸¡è›‹</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>