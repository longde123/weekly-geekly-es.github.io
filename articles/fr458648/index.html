<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÖ üëß ‚ô£Ô∏è CI / CD avec AWS et Bamboo ‚òÅÔ∏è üëÉüèΩ üë©üèæ‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Notre √©quipe est compos√©e d'un d√©veloppeur et d'un ing√©nieur DevOps. Je suis responsable du d√©ploiement de l'application sur le cluster Amazon ECS. En...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CI / CD avec AWS et Bamboo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/icl_services/blog/458648/">  Notre √©quipe est compos√©e d'un d√©veloppeur et d'un ing√©nieur DevOps.  Je suis responsable du d√©ploiement de l'application sur le cluster Amazon ECS.  En tant que serveur CI / CD, j'utilise Bamboo.  Dans cet article, je vais d√©crire en d√©tail comment je d√©ploie une application dans un environnement de d√©veloppement. <br><br><img src="https://habrastorage.org/webt/cn/bu/3w/cnbu3wmmjkhiqhwgxpuhk3pu2fc.png"><br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/ev/oz/rs/evozrsbpwhmgd0zodgrz4pukurm.png"><br><br><h4>  Cr√©er une image Docker </h4><br>  Ici, je suive ces √©tapes: <br><br><ul><li>  √âtape 1: installez et configurez Docker; </li><li>  √âtape 2: configurer les artefacts dans Bamboo; </li><li>  √âtape 3: configurer le r√©f√©rentiel Amazon ECR; </li><li>  √âtape 4: Cr√©ez l'image Docker dans Bamboo. </li></ul><br><h1>  √âtape 1: installer et configurer Docker </h1><br>  Tout d'abord, je mets √† niveau le serveur sur lequel Bamboo est install√©, j'installe les packages n√©cessaires et je configure le r√©f√©rentiel Docker.  Il convient de noter ici que j'ai install√© Bamboo sur le syst√®me d'exploitation CentOS 7. Des informations sur l'installation de docker sur d'autres syst√®mes d'exploitation sont disponibles sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.docker.com</a> . <br><br><pre><code class="plaintext hljs">$ sudo yum update $ sudo yum install -y yum-utils device-mapper-persistent-data lvm2 $ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</code> </pre> <br>  Ensuite, j'installe l'application Docker et d√©marre le service: <br><br><pre> <code class="plaintext hljs">$ sudo yum install docker-ce docker-ce-cli containerd.io $ sudo systemctl enable docker $ sudo systemctl start docker</code> </pre><br>  Ensuite, j'ajoute l'utilisateur bamboo au groupe Docker: <br><br><pre> <code class="plaintext hljs">$ sudo usermod -aG docker bamboo $ sudo su - bamboo $ docker run hello-world</code> </pre><br>  Si, apr√®s avoir ex√©cut√© ces commandes, docker r√©pond avec le message ¬´Bonjour de Docker!¬ª, Cela signifie que mon installation fonctionne correctement. <br><br><h1>  √âtape 2. Configurer les artefacts dans Bamboo </h1><br>  Le d√©veloppement d'applications est en cours chez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Grails</a> .  Lors de la compilation de l'application, un fichier avec l'extension war est cr√©√©.  Ce fichier, dans la terminologie Bamboo, est un artefact.  Configurez Bamboo pour utiliser ce fichier dans les t√¢ches suivantes.  Pour ce faire, je vais dans l'onglet <b>T√¢ches</b> : <br><br><img src="https://habrastorage.org/webt/l2/xf/rh/l2xfrhlwvte_3enperkvbqadtey.png"><br><br>  Et j'ai configur√© la t√¢che Grails, comme indiqu√© ci-dessous: <br><br><img src="https://habrastorage.org/webt/ba/6l/s7/ba6ls73snayld5eazip7mcc0eg4.png"><br><br>  Nous voyons que Grails efface d'abord le dossier de construction, puis ex√©cute les tests et cr√©e enfin un fichier war pour l'environnement de d√©veloppement. <br><br>  Apr√®s cela, je clique sur l'onglet <b>Artefacts</b> et sur le bouton <b>Cr√©er un artefact</b> : <br><br><img src="https://habrastorage.org/webt/2a/sj/am/2asjam033lqmwc9txcj_slq_5jc.png"><br><br>  Je d√©finis un artefact comme indiqu√© ci-dessous: <br><br><img src="https://habrastorage.org/webt/jw/_b/wb/jw_bwbdddrwx1pa1gh7etxonvys.png"><br><br>  Grails place le fichier war dans le r√©pertoire <b>build / libs</b> .  Je v√©rifierai le param√®tre <b>partag√©</b> , car j'aurai besoin de cet artefact plus tard. <br><br>  Maintenant, je cr√©e un projet de d√©ploiement et sp√©cifie un artefact √† utiliser dans mon plan de build: <br><br><img src="https://habrastorage.org/webt/y7/fs/uf/y7fsufkg7rsi-6d3i-hfk8o6rlc.png"><br><br><img src="https://habrastorage.org/webt/s7/nf/tu/s7nftu9r8vwudgjzi1qdtlaljpw.png"><br><br>  J'ai √©galement configur√© la t√¢che de <b>t√©l√©chargement d'artefact</b> dans le projet de d√©ploiement: <br><br><img src="https://habrastorage.org/webt/ie/vv/uv/ievvuvkegkneya15tqd9xlcayhu.png"><br><br>  Ainsi, Bamboo est maintenant configur√© pour utiliser un fichier war. <br><br><h1>  √âtape 3. Configurer le r√©f√©rentiel Amazon ECR </h1><br>  Amazon ECR est un service de stockage et de gestion Docker pour les images.  Pour configurer, ouvrez la console AWS et s√©lectionnez ECR: <br><br><img src="https://habrastorage.org/webt/ys/fd/1i/ysfd1ijutkdnzcugeldnemvywl4.png"><br><br>  Apr√®s avoir cr√©√© le r√©f√©rentiel, j'obtiens l'adresse suivante: <br><br><pre> <code class="plaintext hljs">aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard</code> </pre><br>  Apr√®s avoir termin√© la configuration, vous pouvez √©galement trouver des instructions sur la fa√ßon de se connecter, de t√©l√©charger une image √† partir du r√©f√©rentiel et de t√©l√©charger l'image dans le r√©f√©rentiel. <br><br><h1>  √âtape 4: cr√©er l'image Docker dans Bamboo </h1><br>  Maintenant, je dois configurer le d√©clencheur pour commencer √† cr√©er l'image Docker.  Pour ce faire, je vais dans l'onglet <b>D√©clencheurs</b> et je clique sur le bouton <b>Ajouter un d√©clencheur</b> : <br><br><img src="https://habrastorage.org/webt/ev/gq/nu/evgqnu95-my1ralvlnxrw6tx3fe.png"><br><br>  Ici, je s√©lectionne l'option <b>Construire apr√®s avoir construit avec succ√®s l'</b> option de <b>plan</b> afin que l'image Docker soit cr√©√©e apr√®s la compilation du projet. <br><br>  Maintenant, nous devons ajouter la t√¢che de g√©n√©ration d'image Docker.  Pour ce faire, acc√©dez √† l'onglet <b>T√¢ches</b> , cliquez sur <b>Ajouter une t√¢che</b> , s√©lectionnez le type <b>Docker</b> .  Saisissez une description et s√©lectionnez <b>Cr√©er une image Docker</b> dans le menu d√©roulant.  Dans le champ <b>R√©f√©rentiel</b> , entrez <br><br><pre> <code class="plaintext hljs"> aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest.</code> </pre><br>  Quant au Dockerfile, il peut √™tre comme indiqu√© ci-dessous: <br><br><pre> <code class="plaintext hljs">FROM openjdk:8-jre COPY *.war /usr/src/onboard.war WORKDIR /usr/src CMD ["/bin/bash", "-c", "java -DdataSource.url=$DATASOURCE_URL -DdataSource.username=$DATASOURCE_USERNAME -DdataSource.password=$DATASOURCE_PASSWORD -jar onboard.war"]</code> </pre><br>  Lors du d√©marrage de l'application, vous devez sp√©cifier la base de donn√©es.  Les variables d'environnement DATASOURCE_URL, DATASOURCE_USERNAME, DATASOURCE_PASSWORD sont utilis√©es pour transmettre ces informations √† l'application, mais leurs valeurs sont d√©finies au d√©marrage du conteneur. <br><br>  Ceci termine le processus d'installation pour assembler l'image Docker avec l'application.  L'√©tape suivante consiste √† configurer le t√©l√©chargement de cette image vers le r√©f√©rentiel Amazon ECR. <br><br><img src="https://habrastorage.org/webt/yx/n_/3t/yxn_3t_bqhvr2azfbyaywzadhpe.png"><br><br><h4>  Importer une image dans Elastic Container Registry </h4><br>  Vous pouvez utiliser Elastic Container Registry pour stocker les images collect√©es √† l'aide de Bamboo.  Pour y parvenir, je proc√®de comme suit: <br><br><ul><li>  √âtape 1. Installer Amazon ECR Docker Credential Helper </li><li>  √âtape 2. Connectez le r√¥le IAM au serveur Bamboo </li><li>  √âtape 3: configurer le travail de d√©marrage de l'image Docker </li></ul><br><h1>  √âtape 1. Installer Amazon ECR Docker Credential Helper </h1><br>  Pour t√©l√©charger des images Docker sur Amazon ECR, vous devez disposer d'informations d'identification.  Ces informations d'identification peuvent √™tre obtenues en ex√©cutant la commande <br><br><pre> <code class="plaintext hljs">aws ecr get-login</code> </pre><br>  Cependant, ces informations d'identification ne sont valables que 12 heures.  Par cons√©quent, vous pouvez soit ex√©cuter la commande ci-dessus √† chaque fois avant de t√©l√©charger l'image sur l'ECR, soit installer l'ECR Docker Credential Helper, qui maintient les informations d'identification temporaires √† jour et se connecte √† l'ECR.  Suivez ces √©tapes pour installer ECR Docker Credential Helper. <br><br>  Vous devez d'abord installer <i>git</i> , puis cloner le r√©f√©rentiel github: <br><br><pre> <code class="plaintext hljs">$ sudo yum install git $ sudo su - bamboo $ git clone https://github.com/awslabs/amazon-ecr-credential-helper.git $ make docker</code> </pre><br>  Ensuite, vous devez placer les lignes suivantes dans le fichier <i>/home/bamboo/.docker/config.json</i> : <br><br><pre> <code class="plaintext hljs">{ "credsStore": "ecr-login" }</code> </pre><br>  Et copiez l'application compil√©e dans le <i>r√©pertoire / usr / bin</i> : <br><br><pre> <code class="plaintext hljs">$ exit $ sudo cp /home/bamboo/docker-credential-ecr-login /usr/bin/</code> </pre><br><h1>  √âtape 2. Connectez le r√¥le IAM au serveur Bamboo </h1><br>  Pour que le serveur Bamboo puisse utiliser ECR, vous devez cr√©er un r√¥le, ajouter la strat√©gie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AmazonEC2ContainerRegistryPowerUser</a> √† ce r√¥le, puis attacher ce r√¥le √† l'instance EC2 Bamboo.  Ouvrez la console AWS et s√©lectionnez IAM.  Ensuite, cliquez sur le bouton <b>Cr√©er un r√¥le</b> , s√©lectionnez le <b>service AWS</b> et <b>EC2</b> , comme indiqu√© ci-dessous: <br><br><img src="https://habrastorage.org/webt/1o/vs/jf/1ovsjfchxa3p-bgv4y-6unnz8sk.png"><br><br>  Ensuite, nous cliquons sur le bouton <b>Suivant: Autorisations</b> et sur l'√©cran suivant, nous trouvons et s√©lectionnons la politique <b>AmazonEC2ContainerRegistryPowerUser</b> .  Apr√®s cela, nous finissons de cr√©er le r√¥le et l'attachons √† notre serveur Bamboo. <br><br><h1>  √âtape 3: configurer le travail de d√©marrage de l'image Docker </h1><br>  L'application que nous avons construite et assembl√© une image Docker avec un fichier de guerre.  Vous devez maintenant t√©l√©charger cette image dans le r√©f√©rentiel.  Pour ce faire, j'ajoute une autre t√¢che Docker, cette fois pour t√©l√©charger l'image dans le r√©f√©rentiel ECR.  Je vais dans l'onglet <b>T√¢ches</b> , cliquez sur <b>Ajouter une t√¢che</b> , s√©lectionnez le type <b>Docker</b> .  J'entre une description et s√©lectionne <b>Poussez une image Docker dans un registre Docker</b> dans le menu d√©roulant.  Je s√©lectionne <b>Registre personnalis√©</b> et saisis l'adresse du r√©f√©rentiel dans le champ <b>R√©f√©rentiel</b> .  Pour le <b>type d'authentification,</b> je s√©lectionne <b>Utiliser les informations d'identification natives de l'agent</b> . <br><br>  Ceci termine le processus d'installation pour charger l'image Docker dans le r√©f√©rentiel Amazon ECR.  Les √©tapes suivantes d√©crivent le processus de configuration d'un cluster et d'un service pour lancer une application conteneur.  Mais avant cela, vous devez configurer les options de lancement du conteneur.  C'est ce que nous allons faire maintenant. <br><br><img src="https://habrastorage.org/webt/f7/ku/os/f7kuosux7wvkojanpgoy8zd7wya.png"><br><br><h4>  Cr√©er une d√©finition de t√¢che Amazon ECS </h4><br>  D√©finition de la t√¢che - les param√®tres d'ex√©cution du conteneur sont √©crits ici.  Notre application utilise une base de donn√©es dont les param√®tres sont sp√©cifi√©s au d√©marrage du conteneur, donc dans cette section nous allons √©galement cr√©er une base de donn√©es.  J'utilise <b>Amazon RDS</b> comme base de donn√©es et je stocke le mot de passe pour acc√©der √† la base de donn√©es sous forme chiffr√©e dans <b>AWS Systems Manager Parameter Store</b> .  Les √©tapes suivantes que je suis afin de cr√©er une d√©finition de t√¢che: <br><br><ul><li>  √âtape 1. Cr√©ation d'une base de donn√©es sur une instance Amazon RDS; </li><li>  √âtape 2. Configuration du magasin de param√®tres AWS Systems Manager; </li><li>  √âtape 3. Cr√©ez la d√©finition de t√¢che. </li></ul><br><h1>  √âtape 1. Cr√©ez une base de donn√©es sur une instance Amazon RDS </h1><br>  Notre application utilise la base de donn√©es PostgreSQL.  Pour cr√©er une base de donn√©es, ouvrez la console AWS, s√©lectionnez le service Amazon RDS, cliquez sur le bouton <b>Cr√©er une base de donn√©es</b> , puis s√©lectionnez <b>PostgreSQL</b> comme moteur de base de donn√©es.  Sur la page suivante, je s√©lectionne <b>Dev / Test</b> comme environnement de travail et cliquez sur <b>Suivant</b> .  Ensuite, je d√©signe l' <b>identifiant d'instance de base de donn√©es comme onboard-dev-db</b> et le <b>nom</b> d' <b>utilisateur principal</b> comme <b>devdbadmin</b> .  Ensuite, je passe √† la page suivante pour configurer le VPC, le groupe de sous-r√©seaux et le groupe de s√©curit√©.  Cette base de donn√©es sera utilis√©e sur un r√©seau priv√©, je s√©lectionne donc <b>Non</b> pour le param√®tre <b>Accessibilit√© publique</b> .  <b>J'entre devdb</b> dans le <b>champ</b> <b>Nom de</b> la <b>base de donn√©es</b> et cliquez sur le bouton <b>Cr√©er une base de donn√©es</b> . <br><br><h1>  √âtape 2. Configuration du magasin de param√®tres AWS Systems Manager </h1><br>  Je stocke le mot de passe de la base de donn√©es sous forme crypt√©e.  Pour ce faire, ouvrez la console AWS et acc√©dez √† AWS Systems Manager ‚Üí Ressources partag√©es ‚Üí Magasin de param√®tres ‚Üí Cr√©er un param√®tre.  <b>J'entre devdbpassword</b> comme <b>nom de</b> param√®tre et s√©lectionne <b>SecureString</b> pour le type de param√®tre, puis j'entre le mot de passe de la base de donn√©es dans le champ <b>Valeur</b> . <br><br><h1>  √âtape 3. Cr√©er une d√©finition de t√¢che </h1><br>  Amazon ECS est le cluster sur lequel s'ex√©cutent les applications de conteneur.  Il utilise la d√©finition de t√¢che pour sp√©cifier les param√®tres d'ex√©cution d'une application conteneur.  Pour d√©finir ces param√®tres, cliquez sur le bouton <b>Cr√©er une nouvelle d√©finition de t√¢che</b> .  Ensuite, je s√©lectionne <b>Fargate</b> comme <b>type de</b> d√©marrage et je passe √† l'√©tape suivante.  Ici, j'ai d√©fini le nom comme <b>onboard-dev-taskdef</b> .  Pour le param√®tre de <b>champ R√¥le de t√¢che d'ex√©cution IAM</b> , s√©lectionnez <b>Cr√©er un nouveau r√¥le</b> .  Quant aux ressources allou√©es √† cette application, je d√©signe 2 Go de m√©moire et 1 vCPU.  Vous devez maintenant ajouter des options de lancement de conteneur.  Je nommerai le conteneur <b>onboard-dev-container</b> .  Je nommerai le nom de l'image comme ceci: <br><br>  <i>aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest</i> .  Amazon ECR Docker Credential Helper se chargera de l'authentification ECR, je laisse donc l'option d' <b>authentification du r√©f√©rentiel priv√©</b> d√©coch√©e.  Dans l'environnement de d√©veloppement, l'application est disponible sur le port 8080, donc pour le param√®tre de mappage de ports, j'√©cris <b>8080</b> et s√©lectionne le protocole <b>TCP</b> .  Les param√®tres d'URL de la base de donn√©es, le nom d'utilisateur et le mot de passe sont transmis au conteneur √† l'aide de variables d'environnement.  J'ai d√©fini ces param√®tres dans la section Variables d'environnement.  Afin d'obtenir la valeur du param√®tre <b>devdbpassword √†</b> partir du magasin de param√®tres, je sp√©cifie le type <b>ValueFrom</b> .  La derni√®re chose que je configure est la <b>configuration des journaux</b> , ici je s√©lectionne <b>Auto-configure CloudWatch Logs</b> .  La cr√©ation de la d√©finition de t√¢che est maintenant termin√©e. <br><br>  Cependant, le r√¥le ecsTaskExecutionRole a besoin d'une strat√©gie pour obtenir devdbpassword √† partir du magasin de param√®tres.  Pour ce faire, acc√©dez √† R√¥les IAM et s√©lectionnez ecsTaskExecutionRole, cliquez sur <b>Ajouter une strat√©gie en ligne</b> .  Dans ce cas, j'ajoute en utilisant un √©diteur visuel.  Par cons√©quent, dans le champ Service, j'entre <b>Systems Manager</b> , dans le champ Actions - <b>GetParameters</b> .  Ensuite, je clique sur <b>Ajouter ARN</b> pour le champ Ressources et remplis mes valeurs: <br><br><img src="https://habrastorage.org/webt/2j/wd/6r/2jwd6r5dpp41jbjj4g7gctfeafw.png"><br><br>  √Ä la fin, je regarde les valeurs des param√®tres qui sont d√©finis en cliquant sur Review policy, je lui donne un nom et je termine de travailler avec la configuration ecsTaskExecutionRole. <br><br>  Ceci termine la configuration des param√®tres de l'application du conteneur de lancement.  Vous devez maintenant cr√©er un cluster et un service ECS. <br><br><img src="https://habrastorage.org/webt/0k/u7/xn/0ku7xnp7bctypewbbcwyzdda_-y.png"><br><br><h4>  Cr√©er un service Amazon ECS </h4><br>  Notre application de conteneur s'ex√©cute en tant que service dans un cluster ECS.  Pour configurer, vous devez effectuer les √©tapes suivantes: <br><br><ul><li>  √âtape 1. Cr√©ez un cluster Amazon ECS; </li><li>  √âtape 2: cr√©ation d'un service </li></ul><br><h1>  √âtape 1. Cr√©ez un cluster Amazon ECS </h1><br>  Pour cr√©er un cluster ECS, acc√©dez √† la console AWS et s√©lectionnez le service ECS.  Cliquez ensuite sur <b>Cr√©er un cluster</b> et s√©lectionnez le mod√®le de cluster de mise en <b>r√©seau uniquement</b> .  Sur la page suivante, je nomme le cluster <b>onboard-dev-cluster</b> et compl√®te le cluster.  J'ai maintenant un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cluster</a> ECS bas√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fargate</a> . <br><br><h1>  √âtape 2: cr√©ation d'un service </h1><br>  Pour cr√©er un service, je clique sur le lien <b>onboard-dev-cluster</b> , puis je vais dans l'onglet <b>Services</b> et je clique sur le bouton <b>Cr√©er</b> .  Pour le <b>type de lancement, je</b> s√©lectionne Fargate, pour <b>la d√©finition de t√¢che, je</b> s√©lectionne onboard-dev-taskdef.  De plus, je s√©lectionne onboard-dev-cluster dans le champ Cluster.  Dans le champ <b>Nom</b> du <b>service</b> , j'√©cris onboard-dev.  J'ai d√©fini le param√®tre <b>Nombre de t√¢ches</b> sur z√©ro, car je ne veux pas d√©marrer l'application pour le moment.  Je laisse les param√®tres de <b>pourcentage d'int√©grit√© minimal</b> √©gal √† 100 et le <b>pourcentage</b> <b>maximal</b> √©gal √† 200. Pour le param√®tre <b>Type de d√©ploiement</b> , s√©lectionnez <b>Mise √† jour</b> continue et passez √† l'√©tape suivante. <br><br>  Sur la page <b>Configurer le r√©seau</b> , pour le param√®tre <b>Cluster VPC</b> , je s√©lectionne un VPC cr√©√© pr√©c√©demment appel√© <b>Development VPC</b> .  L'application en cours de d√©veloppement n'est disponible que sur le r√©seau priv√©, j'ai donc choisi deux sous-r√©seaux priv√©s.  Pour configurer les groupes de s√©curit√©, je clique sur le bouton <b>Modifier</b> , puis s√©lectionnez <b>S√©lectionner le groupe de s√©curit√© existant</b> , puis le groupe de s√©curit√© <b>par d√©faut</b> et cliquez sur le bouton <b>Enregistrer</b> .  Pour le param√®tre <b>IP public assign√© automatiquement</b> , je s√©lectionne <b>D√©sactiv√©</b> .  Ensuite, pour le param√®tre de <b>type d'√©quilibreur de charge</b> , je s√©lectionne <b>Aucun</b> et je laisse l'option <b>Activer l'int√©gration de la d√©couverte de services d√©coch√©e</b> .  Ensuite, je clique sur <b>Suivant, Suivant</b> et <b>Cr√©er un service</b> . <br><br>  Maintenant, j'ai un service dans lequel le nombre de travaux en cours d'ex√©cution est nul.  Nous configurerons le lancement de l'application √† l'√©tape suivante. <br><br><img src="https://habrastorage.org/webt/dg/_9/er/dg_9er1txnjnjbhpkrcmn5af4lk.png"><br><br><h4>  Mise √† jour du service </h4><br>  D√®s que le d√©veloppeur met √† jour le code de l'application, notre d√©ploiement passe par la cr√©ation d'une image Docker, son t√©l√©chargement sur Elastic Container Registry et enfin le lancement de l'application conteneur en tant que service dans le cluster ECS Fargate.  Pour le moment, le nombre de travaux en cours d'ex√©cution dans le cluster est nul.  Pour que l'application d√©marre, vous devez mettre √† jour le service, en indiquant la quantit√© √©gale √† un.  Je poursuis ces √©tapes pour y parvenir: <br><br><ul><li>  √âtape 1. Installation du plug-in T√¢ches pour AWS Bamboo; </li><li>  √âtape 2. Mise √† jour du service ECS </li></ul><br><h1>  √âtape 1. Installation du plug-in T√¢ches pour AWS Bamboo </h1><br>  <b>T√¢ches pour AWS Bamboo</b> est un plugin qui simplifie la pr√©paration et le fonctionnement des ressources AWS √† partir des projets de construction et de d√©ploiement Bamboo.  Pour installer ce plugin, je vais dans le projet de d√©ploiement, cliquez sur <b>Ajouter une t√¢che</b> , allez sur Atlassian Marketplace et installez des <b>t√¢ches pour AWS (Bamboo)</b> . <br><br><h1>  √âtape 2. Mise √† jour du service ECS </h1><br>  Maintenant, dans le projet de d√©ploiement, j'ajoute le travail <b>Amazon ECS Service</b> .  Ensuite, j'√©cris dans le champ de description de travail <b>Update Service for onBoard-dev</b> .  Dans le champ Action, s√©lectionnez <b>Mettre √† jour le service</b> et <b>Forcer le nouveau d√©ploiement</b> .  Ensuite, je s√©lectionne US East (Ohio) comme r√©gion de lancement.  Ensuite, j'√©cris dans les champs appropri√©s ARN (Amazon Resource Name) pour la d√©finition de t√¢che, le cluster et le service.  Dans cette t√¢che, je mets √† jour le nombre souhait√© de t√¢ches en cours d'ex√©cution.  Ensuite, je remplis la zone de texte de configuration de d√©ploiement avec les valeurs suivantes: <br><br><pre> <code class="plaintext hljs">{ "maximumPercent": 200, "minimumHealthyPercent": 100 }</code> </pre><br>  J'installe un r√©seau sans IP publique comme suit: <br><br><pre> <code class="plaintext hljs">{ "awsvpcConfiguration": { "assignPublicIp": "DISABLED", "subnets": ["subnet-ID1", "subnet-ID2"], "securityGroups": ["sg-ID"] } }</code> </pre><br>  Dans la section <b>Source</b> pour les <b>informations d'identification de s√©curit√© AWS,</b> je s√©lectionne <b>R√¥le IAM pour EC2</b> . <br><br>  Je dois pouvoir mettre √† jour ECS, donc <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">j'attache la</a> strat√©gie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AmazonECS_FullAccess</a> √† mon instance Bamboo EC2.  Pour ce faire, ouvrez la console AWS, s√©lectionnez IAM.  Ensuite, je s√©lectionne le r√¥le que j'utilise pour mon serveur Bamboo.  Je clique sur le bouton <b>Attacher les politiques</b> , je trouve la politique AmazonECS_FullAccess, je coche la case √† gauche et je termine de joindre la politique. <br><br>  Ceci conclut la configuration CI / CD √† l'aide d'AWS et de Bamboo.  Ainsi, lorsque le d√©veloppeur met √† jour le code de l'application, t√©l√©charge ce code dans le r√©f√©rentiel, les tests et l'assemblage de l'application sont lanc√©s.  Ensuite, l'image Docker est cr√©√©e avec le fichier war de l'application, et cette image est copi√©e dans le r√©f√©rentiel Amazon ECR.  Ensuite, dans le cluster Amazon ECS, une application conteneur est lanc√©e en tant que service, qui met √† jour l'application actuelle si elle n'a pas √©t√© arr√™t√©e.  Si l'application a √©t√© arr√™t√©e pour √©conomiser des ressources, l'application d√©marre simplement.  Apr√®s avoir v√©rifi√© l'application dans l'environnement de d√©veloppement, vous pouvez arr√™ter l'application en sp√©cifiant le nombre de travaux en cours d'ex√©cution dans le cluster √† z√©ro. <br><br>  Si vous avez aim√© l'article et avez des id√©es d'am√©lioration, √©crivez dans les commentaires. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr458648/">https://habr.com/ru/post/fr458648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr458636/index.html">Cassettes vid√©o de mitap DevLeads du bureau Tutu.ru</a></li>
<li><a href="../fr458638/index.html">Projet Intel oneAPI: de nombreuses architectures, une API</a></li>
<li><a href="../fr458640/index.html">Trouver un long tableau de bord</a></li>
<li><a href="../fr458642/index.html">Th√©orie au lieu d'heuristique: s'am√©liorer en tant que d√©veloppeurs frontend</a></li>
<li><a href="../fr458646/index.html">Atomic Swaps en bref</a></li>
<li><a href="../fr458650/index.html">Cyber ‚Äã‚ÄãChallenge. Un nouveau niveau. Concours en ligne de Rostelecom Solar</a></li>
<li><a href="../fr458652/index.html">RamblerFront et Meetup # 7</a></li>
<li><a href="../fr458654/index.html">Le virus Lurk a pirat√© des banques alors qu'il √©tait √©crit par des employ√©s ordinaires</a></li>
<li><a href="../fr458658/index.html">Passer des machines virtuelles aux conteneurs LXC: raisons, avantages et instructions pr√™tes √† l'emploi</a></li>
<li><a href="../fr458660/index.html">Un d√©ploiement logiciel infructueux bloque le service Cloudflare</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>