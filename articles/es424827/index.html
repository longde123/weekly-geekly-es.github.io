<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì© üë®‚Äç‚úàÔ∏è üßî La ilusi√≥n del espacio: c√≥mo el nuevo Spiderman renderiza habitaciones sin geometr√≠a üë©üèΩ‚Äç‚öñÔ∏è ü•â üíÖüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En el recientemente lanzado juego Marvel's Spider-Man, muchos edificios tienen interiores fuera de las ventanas. Se ven geniales, pero parece que se i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La ilusi√≥n del espacio: c√≥mo el nuevo Spiderman renderiza habitaciones sin geometr√≠a</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424827/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ss/pw/49/sspw499wnlg2zjfkih9ofjhk8ge.png"></div><br>  En el recientemente lanzado juego Marvel's Spider-Man, muchos edificios tienen interiores fuera de las ventanas.  Se ven geniales, pero parece que se implementaron utilizando una representaci√≥n astuta: la geometr√≠a de los interiores en realidad no existe y es generada por un sombreador.  No vi ninguna declaraci√≥n oficial de Insomniac sobre c√≥mo lo hicieron, pero en funci√≥n de c√≥mo se ve el efecto, es muy probable que se implement√≥ la t√©cnica de <em>mapeo interior</em> que se me ocurri√≥ en 2007 mientras trabajaba en la disertaci√≥n.  No escrib√≠ sobre eso en el blog antes, as√≠ que ahora es el momento adecuado para explicar el curioso sombreador que se me ocurri√≥. <br><br>  Comencemos viendo el juego Marvel's Spider-Man.  El juego se ve incre√≠ble.  El sitio web de Kotaku grab√≥ un video separado en Windows: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/YQVHtlVEirs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Como puede ver aproximadamente a los 40 segundos del video, de hecho, las habitaciones no son parte de la geometr√≠a: donde la ventana obviamente deber√≠a estar, la puerta est√° ubicada.  Adem√°s, mirando en una habitaci√≥n desde diferentes √°ngulos del edificio, vemos un interior diferente.  En algunos casos, incluso hay una pared alrededor de la esquina del edificio.  Todo esto nos hace comprender que las habitaciones son imitadas.  Sin embargo, desde un punto de vista en perspectiva, se muestran correctamente y tienen una profundidad real. <a name="habracut"></a>  Creo que los inconvenientes de tales salas no son muy importantes durante el juego, porque los jugadores generalmente no estudian las salas tan de cerca: los interiores son solo un tel√≥n de fondo y no un tema de estudio cuidadoso.  Creo que esta forma de crear habitaciones agrega profundidad y vida a la ciudad sin gastar demasiados recursos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b77/b8d/bc9/b77b8dbc9c2a8f05cb6e547c626ffd0b.jpg"></div><br>  <i>Para ahorrar recursos, los edificios en los juegos a menudo no tienen interiores, como se puede ver en la captura de pantalla de GTA V</i> <br><br>  En primer lugar, quiero explicar que mi publicaci√≥n no es una queja: estoy encantado de que mi equipo se haya utilizado en un juego a gran escala y de ninguna manera acusar a Insomniac de robo.  Como dije en la primera publicaci√≥n sobre mapeo interior, ser√≠a un honor para m√≠ si alguien usa esta t√©cnica.  Si Insomniac realmente aprovech√≥ mi idea en su t√©cnica, entonces creo que es genial.  Si ella no lo us√≥, entonces parece que se le ocurri√≥ algo extra√±amente similar.  Entonces estar√≠a interesado en c√≥mo se hizo esto. <br><br>  Entonces, ¬øc√≥mo funciona el mapeo interior?  La idea es que el edificio en s√≠ no contenga ninguna geometr√≠a adicional.  Los interiores solo existen en el sombreador.  Este sombreador realiza una emisi√≥n de rayos con paredes, techos y pisos para calcular lo que el jugador deber√≠a ver en el interior. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af4/7e7/b8f/af47e7b8ff8b0237682a9e6573b42183.jpg"></div><br>  <i>De izquierda a derecha: solo ventanas con reflejos, ventanas con mapeo interior, modelo de estructura met√°lica: el mapeo interior no agrega ning√∫n pol√≠gono.</i> <br><br>  El rayo utilizado para raycast es simplemente un rayo de la c√°mara al p√≠xel.  El p√≠xel que representamos se encuentra en el exterior del edificio, por lo que usamos solo la parte de la viga despu√©s del p√≠xel, porque esta es la parte que est√° realmente dentro del edificio. <br><br>  Raycasting puede parecer una operaci√≥n complicada y costosa, pero en este caso particular es realmente muy simple y r√°pido.  El truco es que puede agregar una restricci√≥n simple: con el mapeo interior, los techos y los pisos est√°n a una distancia constante.  Sabiendo esto, podemos calcular f√°cilmente en qu√© habitaci√≥n estamos y d√≥nde se encuentran el piso y el techo en esta habitaci√≥n.  Los techos y los pisos son planos geom√©tricos infinitos.  Calcular la intersecci√≥n entre un plano infinito y un rayo toma solo unos pocos pasos y gasta pocos recursos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99a/36a/cc3/99a36acc3fb2962935e9d0b76c4512d0.gif"></div><br>  La sala tiene 6 planos: techo, piso y 4 paredes.  Sin embargo, necesitamos considerar solo tres de ellos, porque sabemos en qu√© direcci√≥n estamos mirando.  Por ejemplo, si miramos hacia arriba, entonces no necesitamos revisar el piso de abajo, porque veremos el techo de arriba.  Del mismo modo, en lugar de 4 paredes, debemos considerar solo dos en la direcci√≥n en la que estamos mirando. <br><br>  Para determinar lo que vemos, necesitamos calcular la intersecci√≥n del rayo con cada uno de estos tres planos.  La intersecci√≥n con el haz m√°s cercano a la c√°mara nos dice cu√°l de los planos vemos en este p√≠xel.  Luego usamos el punto de intersecci√≥n como la coordenada de la textura para encontrar el color del p√≠xel.  Por ejemplo, si la viga se cruza en la posici√≥n (x, y, z) con el techo, entonces usamos (x, y) como la coordenada de textura e ignoramos z. <br><br>  Aqu√≠ agregu√© una buena optimizaci√≥n: parte de los c√°lculos de intersecci√≥n para cada uno de los tres planos se pueden realizar simult√°neamente.  Los sombreadores utilizados trabajaron con float4 a la misma velocidad que con float, por lo que gracias al inteligente empaquetado de variables, fue posible intersectar los tres rayos con planos al mismo tiempo.  Esto me ahorr√≥ algunos recursos y me ayud√≥ a lograr una alta velocidad de cuadros con el mapeo interior incluso en 2007.  Me dijeron que las tarjetas de video modernas con float funcionan m√°s r√°pido que con float4;  significa que en el hardware actual esta optimizaci√≥n ya no funciona. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d5d/1f5/751/d5d1f57518f274783ab5b797d861a4d0.jpg"></div><br>  <i>El mapeo interior sin texturas de ventana muestra que las habitaciones se representan con la perspectiva y las texturas correctas, aunque no se requiere geometr√≠a adicional.</i> <br><br>  Puedes aprender m√°s sobre mapeo interior en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mi art√≠culo</a> .  Este art√≠culo fue publicado en la Conferencia Internacional de Gr√°ficos por Computadora en 2008. Tener esta publicaci√≥n revisada por pares es mi primera (y √∫nica) solicitud para el orgulloso t√≠tulo de cient√≠fico.  Este art√≠culo tambi√©n describe experimentos adicionales para agregar detalles, por ejemplo, cambiando la distancia entre paredes para habitaciones de tama√±o desigual y seleccionando texturas al azar de un atlas de texturas para una mayor variabilidad de la habitaci√≥n.  Tambi√©n describe en detalle las dos variaciones que se muestran en las im√°genes a continuaci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed8/17a/28a/ed817a28adbc6f0dd9ea44ce6f61294b.jpg"></div><br>  <i>La iluminaci√≥n de las habitaciones se puede encender y apagar din√°micamente para simular un cambio de d√≠a y de noche.</i>  <i>Esto se hace usando la textura de ruido de la que estamos leyendo, usando el √≠ndice de la habitaci√≥n como coordenadas de textura.</i> <br><br>  Como solo emitimos rayos en el plano, todas las habitaciones son cuadrados simples con texturas.  Todos los muebles de la habitaci√≥n estar√°n en la textura, lo que significa permanecer planos.  En Spiderman, esto se nota cuando te acercas a la c√°mara: las mesas en las habitaciones son en realidad texturas planas en las paredes.  Como puede ver en la imagen a continuaci√≥n, podemos complementar nuestra t√©cnica con una o m√°s capas de textura adicionales por habitaci√≥n, pero esto est√° asociado con costos de rendimiento adicionales. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea2/e0d/2dc/ea2e0d2dc5b8b6783928931e15e612a5.jpg"></div><br>  <i>Al realizar el trazado de rayos de otro plano paralelo a la superficie exterior del edificio, puede agregar muebles y personas a la habitaci√≥n.</i>  <i>Sin embargo, seguir√°n siendo planos.</i> <br><br>  Despu√©s de la publicaci√≥n de esta publicaci√≥n, uno de los programadores Simcity (2013) me dijo que la t√©cnica de mapeo interior tambi√©n se us√≥ en este juego.  En ella, se ve muy bien, y los desarrolladores grabaron un gran video al respecto.  Refinaron mi idea original guardando todas las texturas en una textura y agregando habitaciones de diferentes profundidades.  La parte de mapeo interior comienza a las 1:00 a.m .: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_x88tvkAGuo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Si desea explorar esta t√©cnica m√°s profundamente, puede descargar <a href="">mi demo de mapeo interior</a> con c√≥digo fuente.  Si trabaja en Unreal Engine 4, puede encontrar el mapeo interior como una funci√≥n est√°ndar del motor en forma de la funci√≥n InteriorCubeMap. <br><br>  ¬°Despu√©s de tantos a√±os, es genial finalmente ver que mi t√©cnica de mapeo interior se usa en la producci√≥n de videojuegos a gran escala!  Si est√°s familiarizado con juegos que usan algo similar, escr√≠beme al respecto. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es424827/">https://habr.com/ru/post/es424827/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es424817/index.html">Dise√±o de producto digital. Prop√≥sito, Rol, M√©todo</a></li>
<li><a href="../es424819/index.html">Validaci√≥n de datos - Validaci√≥n de Java y Spring</a></li>
<li><a href="../es424821/index.html">Sobre demonios y teletransportaci√≥n: dos tecnolog√≠as que acercan el futuro cu√°ntico</a></li>
<li><a href="../es424823/index.html">C√≥mo la nutrici√≥n baja en calor√≠as afecta el envejecimiento</a></li>
<li><a href="../es424825/index.html">Robots y comunismo</a></li>
<li><a href="../es424831/index.html">Lo que se invierte en la econom√≠a digital.</a></li>
<li><a href="../es424835/index.html">C√≥mo reducir el riesgo de inversi√≥n en bolsa: 3 factores de diversificaci√≥n</a></li>
<li><a href="../es424841/index.html">Almacene un archivo de im√°genes para un sitio en Azure BLOB Storage</a></li>
<li><a href="../es424843/index.html">¬øIBOutlet es privado en sus aplicaciones de iOS?</a></li>
<li><a href="../es424845/index.html">C√°lculo de cuadrados m√°gicos usando una GPU</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>