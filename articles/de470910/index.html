<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçü§ù‚Äçüë®üèª üòú üßòüèΩ Was kann mit Anmerkungen zu Microservice-Vertr√§gen getan werden? üçó üï° üå§Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im letzten Beitrag haben wir dar√ºber gesprochen, wie und warum wir bei Ancronis Anmerkungen f√ºr Microservices erstellen, und versprochen, unsere Praxi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Was kann mit Anmerkungen zu Microservice-Vertr√§gen getan werden?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acronis/blog/470910/">  Im letzten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beitrag haben</a> wir dar√ºber gesprochen, wie und warum wir bei Ancronis Anmerkungen f√ºr Microservices erstellen, und versprochen, unsere Praxis der Verwendung eines einzigen API-Formats f√ºr die gesamte Acronis Cyber ‚Äã‚ÄãPlatform zu teilen.  Heute werden wir √ºber unsere Erfahrungen mit statischen Annotationspr√ºfungen berichten - auch bekannt als der erste Schritt auf dem Weg zur Einf√ºhrung von Annotationen in einem Unternehmen. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/hm/0k/un/hm0kunnfzs9fvcgleqiyumvqny8.jpeg"></a> <br><a name="habracut"></a><br>  Angenommen, Sie haben bereits Anmerkungen f√ºr alle oder die meisten APIs.  Eine vern√ºnftige Frage, die uns unsere Kollegen auch gestellt haben: ‚ÄûWas kann man mit diesen magischen Objekten machen?‚Äú <br><br>  Tats√§chlich gibt es zwei Arten von √úberpr√ºfungen, die direkt durch Anmerkungen durchgef√ºhrt werden k√∂nnen.  Statische √úberpr√ºfungen gehen direkt zu den Texten von Swagger- oder RAML-Anmerkungen.  Sie brauchen nichts anderes und k√∂nnen zu Recht als der erste Vorteil der Verwendung formalisierter Microservice-Vertr√§ge angesehen werden. <br><br>  Dynamische √úberpr√ºfungen k√∂nnen nur gestartet werden, wenn Sie einen funktionierenden Dienst haben.  Sie sind etwas komplizierter, da Sie tiefer eintauchen und √ºberpr√ºfen k√∂nnen, wie g√ºltig die Anmerkung √ºberhaupt ist, die Stabilit√§t des Dienstes testen und auch viel mehr tun k√∂nnen.  Aber das ist das Thema des n√§chsten Beitrags, und heute werden wir uns auf die Statik konzentrieren. <br><br><h3>  Es lebe die API-Richtlinie! </h3><br>  Um sich selbst oder andere nicht zu verwirren, sollte sofort erw√§hnt werden, dass statische Annotationspr√ºfungen erstellt werden, um die Konformit√§t der API-Annotationen (und hoffentlich der APIs selbst) mit den Unternehmensanforderungen zu kontrollieren.  Dies kann entweder nur die vom Unternehmen angewandte Vorgehensweise sein oder eine vollwertige Richtlinien-API, die die Regeln f√ºr die Vorbereitung der API f√ºr Ihre Dienste formalisiert. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/084/f24/61b/084f2461b8fa9d944fbcf83ce4618ab7.jpg" alt="Bild"><br><br>  Wenn wir √ºber die farbenfrohe Welt der Microservices sprechen, ist dies sehr wichtig, da jedes Team sein eigenes Framework, seine eigene Programmiersprache, einen einzigartigen Stack oder einige spezielle Bibliotheken haben kann.  Unter dem Einfluss von Praktiken, die f√ºr den Mikroservice spezifisch sind, √§ndert sich die Darstellung der API f√ºr einen externen Beobachter.  Dies schafft unn√∂tige Abwechslung.  F√ºr eine effektive Interaktion von Elementen eines √ñkosystems (oder einer Plattform) ist es erforderlich, die API so weit wie m√∂glich auszurichten. <br><br>  Hier ein Beispiel: 404-Code wird nur dann an die API einer Komponente zur√ºckgegeben, wenn die Ressource nicht vorhanden ist.  Das andere Team bindet diesen Fehler an die Anwendungslogik und die API gibt 404 zur√ºck, wenn der Benutzer ein Produkt kaufen m√∂chte, das im Warehouse beendet wurde.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Atygaev</a> hat diese Probleme hier sehr deutlich beschrieben.  Diese Inkonsistenz beim Verst√§ndnis von 404-Code verlangsamt die Entwicklung und f√ºhrt zu Fehlern, was unn√∂tige Supportanfragen oder zus√§tzliche Stunden Debugging bedeutet, aber auf jeden Fall Probleme, gemessen in Geldbetr√§gen. <br><br>  Die vom Unternehmen √ºbernommenen Besonderheiten der Syntax und Benennung werden durch verschiedene Aspekte erg√§nzt, die f√ºr REST selbst spezifisch sind.  Der Entwickler muss Fragen beantworten wie: <br><br><ul><li>  Wird POST idempotent sein oder nicht? </li><li>  Welche Fehlercodes verwenden wir und was bedeuten sie? </li><li>  Kann ich Fehlercodes mit Gesch√§ftslogik versehen? </li></ul><br>  Stellen Sie sich nun vor, dass jedes Team diese Antworten einzeln durchgehen sollte. <br><br>  Das Format der Suchabfrage kann auch v√∂llig anders sein.  Beispielsweise gibt es etwa ein Dutzend M√∂glichkeiten, ein Beispiel zu erstellen, in dem nur die Benutzer aufgelistet werden, die √ºber MacBookPro und h√§ufige Virenangriffe verf√ºgen.  Bei der Arbeit an einem gro√üen Projekt, das aus Dutzenden von Microservices besteht, muss die Syntax der Suchabfrage allen Versionen und Produkten des Unternehmens gemeinsam sein.  Und wenn eine Person es gewohnt ist, sich auf eines der Produkte / Dienstleistungen Ihrer Entwicklung zu beziehen, erwartet sie, dass sie dieselbe Anforderungs- und Antwortstruktur in einer anderen findet.  Andernfalls werden Erstaunen (und Trauer) nicht vermieden. <br><br>  Viele Unternehmen, insbesondere Giganten wie <a href="">Microsoft</a> , <a href="">PayPal</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google</a> , haben ihre eigenen Richtlinien und sind sehr gut durchdacht.  Die Verwendung der Richtlinien anderer Personen ist jedoch nicht immer m√∂glich, da diese weitgehend an die Besonderheiten des Unternehmens gebunden sind.  Dar√ºber hinaus hat das Denken eines jeden eine andere Struktur, und die Regeln k√∂nnen einfach deshalb unterschiedlich sein, weil es f√ºr Menschen bequemer ist, auf diese Weise und nicht anders zu arbeiten. <br><br>  Das Verst√§ndnis, dass Acronis eine eigene API-Richtlinie ben√∂tigt, kam nicht sofort, sondern mit der wachsenden Anzahl von Entwicklern, Microservices und tats√§chlich externen Clients und Integrationen.  Irgendwann musste das Architektenteam einheitliche Regeln f√ºr die Deklaration der API festlegen, wobei sowohl die Erfahrungen der oben genannten IT-Giganten als auch bereits etablierte De-facto-Praktiken in Entwicklungsteams ber√ºcksichtigt wurden. <br><br>  Eines der Probleme bei dieser sp√§ten Implementierung der Richtlinien-API sind die vorhandenen ver√∂ffentlichten APIs, die die Anforderungen nicht erf√ºllen, was wiederum zu zus√§tzlichen Kosten f√ºr die Neugestaltung der Schnittstellen und die Aufrechterhaltung der Abw√§rtskompatibilit√§t f√ºhrt.  Wenn Ihr Gesch√§ftsmodell die zuk√ºnftige Integration und Ver√∂ffentlichung der API umfasst, m√ºssen Sie daher so fr√ºh wie m√∂glich √ºber einheitliche Regeln nachdenken. <br><br><img src="https://habrastorage.org/webt/qt/yf/gz/qtyfgz3v0rojzm0dubyojcwl6hw.png"><br><br>  Nat√ºrlich hat die √úbernahme der Richtlinien-APIs nicht automatisch alle APIs konstitutiv gemacht.  Jede API musste analysiert werden, jeder Entwickler musste neue Anforderungen verstehen.  Daher haben wir die Automatisierung von RAML-Pr√ºfungen anhand der von uns entwickelten Richtlinien-API durchgef√ºhrt. <br>  Statische Analyse <br><br>  Zuerst m√ºssen Sie entscheiden, was wir statisch analysieren.  Nicht alle Richtlinien-API-Punkte k√∂nnen formalisiert werden. Daher m√ºssen Sie zun√§chst eine Reihe von Regeln hervorheben, die anhand der API-Annotation leicht zu verstehen sind. <br><br>  In der ersten Version haben wir die folgenden Regeln identifiziert: <br><br><ol><li>  Suchen Sie nach API-Beschreibungen.  Wie bereits in unserem vorherigen Artikel erw√§hnt, k√∂nnen Sie anhand der API-Annotation eine sch√∂ne Dokumentation erstellen.  Dies bedeutet, dass jede Ressource, jeder Abfrageparameter und jede Antwort eine Beschreibung haben sollte, die jedem Benutzer unserer API alle erforderlichen Informationen liefert.  Es scheint eine Kleinigkeit zu sein, aber wie einfach ist es, Entwicklern zu zeigen, dass ihre Anmerkungen nicht reich an Beschreibungen sind! </li><li>  √úberpr√ºfung auf Vorhandensein und Richtigkeit von Beispielen.  Mit API-Anmerkungssprachen k√∂nnen Sie auch Beispiele beschreiben.  Als Antwort k√∂nnen wir beispielsweise ein Beispiel f√ºr eine echte Serviceantwort hinzuf√ºgen, etwas aus dem realen Leben.  Anhand von Beispielen wird erl√§utert, wie der Endpunkt verwendet werden soll und wie er funktioniert, und anhand statischer Analysen von Anmerkungen wird nach Beispielen gesucht. </li><li>  Validierung von HTTP-Antwortcodes.  Der HTTP-Standard definiert eine gro√üe Anzahl von Codes, die jedoch unterschiedlich interpretiert werden k√∂nnen.  Unsere Richtlinie formalisiert die Verwendung von Codes.  Wir beschr√§nken auch die Anwendbarkeit verschiedener Codes gem√§√ü der HTTP-Methode.  Beispielsweise wird Code 201 gem√§√ü der HTTP-Spezifikation zur√ºckgegeben, wenn eine Ressource erstellt wird.  Daher ist das GET, das 201 zur√ºckgibt, ein Weckruf (entweder wird der Code falsch verwendet oder GET erstellt die Ressource).  Daher verbietet unsere Richtlinien-API eine solche Verwendung.  Dar√ºber hinaus haben Architekten feste Codes√§tze f√ºr jede Methode, und jetzt √ºberpr√ºfen wir sie im statischen Modus auf der Ebene der Anmerkungen. </li><li>  √úberpr√ºfen von HTTP-Methoden.  Jeder wei√ü, dass das HTTP-Protokoll √ºber eine Reihe von Standardmethoden (GET, POST, PUT usw.) verf√ºgt und auch die Verwendung benutzerdefinierter Methoden erm√∂glicht.  Unsere Richtlinien-API beschreibt zul√§ssige Methoden, die zul√§ssig, aber unerw√ºnscht (OPTIONEN) sowie vollst√§ndig verboten sind (kann nur mit dem Segen von Architekten verwendet werden).  Verboten sind die Standard-HEAD-Methode sowie alle benutzerdefinierten Methoden.  All dies l√§sst sich auch leicht in den Anmerkungen zu den Vertr√§gen √ºberpr√ºfen. </li><li>  √úberpr√ºfung der Zugriffsrechte.  Wir hoffen, dass der Bedarf an Autorisierungsunterst√ºtzung im Jahr 2019 keine zus√§tzlichen Erl√§uterungen erfordert.  Eine gute Dokumentation sollte Informationen dar√ºber enthalten, welche Rollen die API unterst√ºtzt und welche API-Methoden f√ºr jede Rolle verf√ºgbar sind.  Neben der Dokumentation von Informationen zum Vorbild, die auf Annotationsebene aufgezeichnet wurden, k√∂nnen Sie viel interessantere Dinge in der Dynamik tun. Wir werden jedoch im n√§chsten Artikel darauf eingehen. </li><li>  Validierung der Benennung.  Lindert Kopfschmerzen bei der Verwendung unterschiedlicher Ans√§tze zur Benennung von Entit√§ten.  Im Allgemeinen gibt es zwei ‚ÄûLager‚Äú - Unterst√ºtzer von CamelCase und snake_case.Camelcase - wenn jedes Wort mit einem Gro√übuchstaben beginnt, und snake_case - wenn W√∂rter durch Unterstriche getrennt sind und alles in kleinen Buchstaben geschrieben ist.  In verschiedenen Sprachen ist es √ºblich, Namen auf unterschiedliche Weise zu vergeben.  Beispielsweise wird snake_case in Python akzeptiert und CamelCase in Go oder Java.  Wir haben unsere eigene Auswahl f√ºr alle Projekte universell getroffen und in der API-Richtlinie festgelegt.  Daher √ºberpr√ºfen wir durch Anmerkungen die Namen von Ressourcen und Parametern statisch. </li><li>  Validierung von benutzerdefinierten Headern.  Dies ist ein weiteres Beispiel f√ºr eine Namenspr√ºfung, die jedoch speziell an K√∂pfe gebunden ist.  Bei uns in Acronis ist es √ºblich, das Format des Formulars X-Custom-Header-Name zu verwenden (obwohl dieses Format veraltet ist).  Und wir kontrollieren die Einhaltung auf der Ebene der Anmerkungen. </li><li>  √úberpr√ºfen Sie die HTTPS-Unterst√ºtzung.  Jeder moderne Dienst sollte HTTPS unterst√ºtzen, und einige glauben, dass die Arbeit mit HTTP heutzutage im Allgemeinen eine schlechte Nachricht ist.  Daher sollte die Annotation RAML oder Swagger angegeben werden.  dass der Microservice HTTPS ohne HTTP unterst√ºtzt. </li><li>  √úberpr√ºfen Sie die Struktur des URI.  In pr√§historischen Zeiten, dh vor der Ver√∂ffentlichung der Richtlinien-API, sah der Anforderungs-URI in verschiedenen Diensten unterschiedlich aus: irgendwo / api / 2, irgendwo / api / service_name / v2 und so weiter.  In unserer Richtlinie ist jetzt eine Standard-URI-Struktur f√ºr alle unsere APIs definiert.  Das Handbuch beschreibt, wie sie aussehen sollten, um keine Verwirrung zu stiften. </li><li>  √úberpr√ºfen der Kompatibilit√§t neuer Versionen.  Ein weiterer Faktor, den jeder API-Autor ber√ºcksichtigen sollte, ist die Abw√§rtskompatibilit√§t.  Es ist wichtig zu √ºberpr√ºfen, ob der auf der alten API basierende Code mit der neuen Version funktioniert.  Basierend auf dieser √Ñnderung kann in zwei Kategorien unterteilt werden: Aufheben der Abw√§rtskompatibilit√§t und Kompatibilit√§t.  Jeder wei√ü, dass das Brechen von √Ñnderungen inakzeptabel ist. Wenn Sie etwas dramatisch ‚Äûverbessern‚Äú m√∂chten, sollte der Entwickler eine neue Version der API ver√∂ffentlichen. Jeder kann sich jedoch irren. Daher besteht unser anderes Ziel bei statischen √úberpr√ºfungen darin, nur kompatible √Ñnderungen zu √ºberspringen und auf inkompatible √Ñnderungen zu schw√∂ren.  Es wird davon ausgegangen, dass die Annotation wie der Code im Repository gespeichert ist und daher den gesamten √Ñnderungsverlauf aufweist.  Daher k√∂nnen wir unseren HTTP-REST auf Abw√§rtskompatibilit√§t √ºberpr√ºfen.  Beispielsweise verst√∂√üt das Hinzuf√ºgen von (Methode, Parameter, Antwortcode) Kompatibilit√§t nicht, und das Entfernen kann durchaus zu einem Verlust der Kompatibilit√§t f√ºhren.  Und dies kann bereits auf der Annotationsebene √ºberpr√ºft werden. </li></ol><br><br> <i><img src="https://habrastorage.org/webt/kt/vo/wc/ktvowckxsyc4hujr2owbwmvy2qe.png"><br></i>  <i>Wenn es keine Beschreibungen gibt</i> <i><br><img src="https://habrastorage.org/webt/po/dv/k6/podvk6eqjgnydciv-jzbbw7-nm4.png"><br></i>  <i>Wenn es Beschreibungen gibt</i> <i><br></i> <br><h3>  Schlussfolgerungen </h3><br>  Eine statische Analyse der Anmerkungen ist erforderlich, um zu √ºberpr√ºfen (nein, nicht die Servicequalit√§t), sondern die Qualit√§t der API.  In dieser Phase k√∂nnen Sie die Programmschnittstellen so aufeinander abstimmen, dass die Mitarbeiter in einer klaren und verst√§ndlichen Umgebung arbeiten, in der alles ziemlich vorhersehbar ist. <br><br>  Nat√ºrlich ist es nur in ausreichend gro√üen Unternehmen notwendig, sich mit einem solchen Formalismus zu befassen, wenn die manuelle √úberpr√ºfung aller Korrespondenzen sehr langwierig, teuer und unzuverl√§ssig ist.  Ein kleines Startup braucht es einfach nicht.  Zumindest vorerst.  Wenn es jedoch in Zukunft Pl√§ne gibt, ein Einhorn wie Akronis zu werden, helfen Ihnen statische √úberpr√ºfungen und die Richtlinien-API. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de470910/">https://habr.com/ru/post/de470910/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de470892/index.html">Einfache Implementierung eines kleinen CAM auf einem FPGA</a></li>
<li><a href="../de470894/index.html">Kugel</a></li>
<li><a href="../de470902/index.html">Hohe Leistung und native Partitionierung: Zabbix mit TimescaleDB-Unterst√ºtzung</a></li>
<li><a href="../de470904/index.html">Der weichste und pelzigste Weg in maschinellem Lernen und tiefen neuronalen Netzen</a></li>
<li><a href="../de470908/index.html">Zum ersten Mal auf der Welt wurde mit Hilfe additiver Technologien eine gro√üformatige Triebwerksbaugruppe f√ºr Flugzeuge erhalten</a></li>
<li><a href="../de470916/index.html">Der ‚Äûbilligste‚Äú elektronische Kontrollpunkt in Russland, der √ºber ein Smartphone gesteuert wird</a></li>
<li><a href="../de470918/index.html">F # 9: Geben Sie Option ein</a></li>
<li><a href="../de470920/index.html">5+ M√∂glichkeiten, eine Verbindung zu einer DataLine-Cloud herzustellen</a></li>
<li><a href="../de470922/index.html">Ank√ºndigung von mitap ThinkJava # 10 in Kharkov</a></li>
<li><a href="../de470924/index.html">Warum f√ºr das neue Projekt habe ich Robot Framework genommen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>