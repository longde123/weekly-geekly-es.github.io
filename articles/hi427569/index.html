<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯН┐ ЁЯЪ╜ ЁЯд▒ЁЯП┐ рдЙрдЪреНрдЪ рд▓реЛрдб рдХреЗ рддрд╣рдд рдареАрдХ рдзреБрди рдУрдкрдирд╕реНрдЯреИрдХ ЁЯШ╖ ЁЯП║ ЁЯзТЁЯП╛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдирдорд╕реНрддреЗ, рдореЗрд░рд╛ рдирд╛рдо рдореИрдХреНрд╕рд┐рдо рд╣реИ, рдореИрдВ рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рд╢рд╛рд╕рдХ рд╣реВрдВред рддреАрди рд╕рд╛рд▓ рдкрд╣рд▓реЗ, рдореИрдВрдиреЗ рдФрд░ рдореЗрд░реЗ рд╕рд╣рдпреЛрдЧрд┐рдпреЛрдВ рдиреЗ рдЙрддреНрдкрд╛рджреЛрдВ рдХреЛ рдорд╛рдЗрдХреНрд░реЛрд╕рд░реНрд╡рд┐рд╕реЗрд╕ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рд╢реБрд░реВ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЙрдЪреНрдЪ рд▓реЛрдб рдХреЗ рддрд╣рдд рдареАрдХ рдзреБрди рдУрдкрдирд╕реНрдЯреИрдХ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/427569/"><p>  рдирдорд╕реНрддреЗ, рдореЗрд░рд╛ рдирд╛рдо рдореИрдХреНрд╕рд┐рдо рд╣реИ, рдореИрдВ рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рд╢рд╛рд╕рдХ рд╣реВрдВред  рддреАрди рд╕рд╛рд▓ рдкрд╣рд▓реЗ, рдореИрдВрдиреЗ рдФрд░ рдореЗрд░реЗ рд╕рд╣рдпреЛрдЧрд┐рдпреЛрдВ рдиреЗ рдЙрддреНрдкрд╛рджреЛрдВ рдХреЛ рдорд╛рдЗрдХреНрд░реЛрд╕рд░реНрд╡рд┐рд╕реЗрд╕ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛, рдФрд░ рдУрдкрдирд╕реНрдЯреИрдХ рдХреЛ рдПрдХ рдордВрдЪ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛, рдФрд░ рдкрд░реАрдХреНрд╖рдг рд╕рд░реНрдХрд┐рдЯреЛрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддреЗ рд╕рдордп рдХрдИ рдЕрд╕рднреНрдп рд░реЗрдХ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд┐рдпрд╛ред  рдпрд╣ рдкреЛрд╕реНрдЯ рдУрдкрдирд╕реНрдЯреИрдХ рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреА рдмрд╛рд░реАрдХрд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИ, рдЬреЛ рд╢рд╛рдпрдж рд╣реА рдЦреЛрдЬ рдЗрдВрдЬрди рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рдкрд╛рдВрдЪрд╡реЗрдВ рдкреГрд╖реНрда рдкрд░ рдкрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ (рдпрд╛ рдмреЗрд╣рддрд░, рд╡реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдкрд╣рд▓реЗ рдкрд░ рд╣реИрдВ)ред </p><br><p><img src="https://habrastorage.org/webt/mq/7k/0o/mq7k0oanmmzmtasnicu6ra237po.png"><br>  <em>рдХреЛрд░ рдкрд░ рднрд╛рд░: рдпрд╣ рдерд╛</em> </p><br><h3 id="nat">  рдиреЗрдЯ </h3><br><p>  рдХреБрдЫ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рд╣рдо рдбреНрдпреВрд▓рд╕реНрдЯреИрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдпрд╣ рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдПрдХ рд╣реА рдмрд╛рд░ рдореЗрдВ рджреЛ рдкрддреЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреА рд╣реИ - IPv4 рдФрд░ IPv6ред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдордиреЗ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд┐рдпрд╛ рдХрд┐ "рдлреНрд▓реЛрдЯрд┐рдВрдЧ" v4 рдПрдбреНрд░реЗрд╕ рдХреЛ NAT рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдВрддрд░рд┐рдХ рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдФрд░ рдорд╢реАрди рдХреЛ BGP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ v6 рдкреНрд░рд╛рдкреНрдд рд╣реБрдЖ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рд╕рд╛рде рдХреБрдЫ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реИрдВред </p><br><p> рдиреЗрдЯ - рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдиреЛрдб, рдЬрд╣рд╛рдВ рдЗрд╕рдХреЗ рдмрд┐рдирд╛ рднреА рдЖрдкрдХреЛ рд╕рд╛рдорд╛рдиреНрдп рд▓реЛрдб рд╡рд┐рддрд░рдг рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ NAT рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рд▓рдЧрднрдЧ рд╣рдореЗрд╢рд╛ рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдХрдард┐рдирд╛рдЗрдпреЛрдВ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рддреА рд╣реИ - рдореЗрдЬрдмрд╛рди рдПрдХ рдЖрдИрдкреА рдкрд░, рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдПрдХ рдФрд░, рдФрд░ рдЕрдиреБрд░реЛрдз рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред  рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░ рдЦреЛрдЬ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ, рдФрд░ рд╕рдорд╛рдзрд╛рди рдЕрднреА рднреА рдУрдкрдирд╕реНрдЯреИрдХ рдХреЗ рдЕрдВрджрд░ рд╣реЛрдЧрд╛ред </p><br><p>  рдлрд┐рд░ рднреА NAT рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рдмреАрдЪ рдкрд╣реБрдВрдЪ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред  рд╕рднреА рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рдЕрдкрдиреЗ-рдЕрдкрдиреЗ рд╕рдмрдиреЗрдЯ рд╣реИрдВ, рдлреНрд▓реЛрдЯрд┐рдВрдЧ рдЖрдИрдкреА рд▓рдЧрд╛рддрд╛рд░ рдкрд▓рд╛рдпрди рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдПрдирдПрдЯреА рдХреЗ рд╕рд╛рде рдЗрд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдирд╛ рдмрд┐рд▓реНрдХреБрд▓ рдЕрд╕рдВрднрд╡ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред  рдХреБрдЫ рд╕реНрдерд╛рдкрдирд╛рдПрдВ NAT 1 рдореЗрдВ 1 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рддреА рд╣реИрдВ (рдЖрдВрддрд░рд┐рдХ рдкрддрд╛ рдмрд╛рд╣рд░реА рд╕реЗ рдЕрд▓рдЧ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ), рд▓реЗрдХрд┐рди рдпрд╣ рдЕрднреА рднреА рдмрд╛рд╣рд░реА рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХреА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рдЕрдирд╛рд╡рд╢реНрдпрдХ рд▓рд┐рдВрдХ рдЫреЛрдбрд╝рддрд╛ рд╣реИред  рд╣рдо рдЗрд╕ рдирд┐рд╖реНрдХрд░реНрд╖ рдкрд░ рдкрд╣реБрдВрдЪреЗ рдХрд┐ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╡рд┐рдХрд▓реНрдк рдмреАрдЬреАрдкреА рдиреЗрдЯрд╡рд░реНрдХ рд╣реИред </p><a name="habracut"></a><br><h2 id="chem-prosche-tem-luchshe">  рдмреЗрд╣рддрд░ рд╕рд░рд▓ рд╣реИ </h2><br><p>  рд╣рдордиреЗ рд╡рд┐рднрд┐рдиреНрди рд╕реНрд╡рдЪрд╛рд▓рди рд╕рд╛рдзрдиреЛрдВ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА, рд▓реЗрдХрд┐рди Ansible рдкрд░ рдмрд╕ рдЧрдПред  рдпрд╣ рдПрдХ рдЕрдЪреНрдЫрд╛ рдЙрдкрдХрд░рдг рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреА рдорд╛рдирдХ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ (рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЕрддрд┐рд░рд┐рдХреНрдд рдореЙрдбреНрдпреВрд▓ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП) рдХреБрдЫ рдХрдард┐рди рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИред </p><br><p>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, Ansible рдореЙрдбреНрдпреВрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдЖрдк рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХрд┐рд╕ рд╕рдмрдиреЗрдЯ рдкрддреЗ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рд╣реИред  рдпрд╣реА рд╣реИ, рдЖрдк рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдк рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрддрд╛ рдкреВрд▓ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред  рдлреНрд▓реЛрдЯрд┐рдВрдЧ IP рдмрдирд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╢реЗрд▓ рдХрдорд╛рдВрдб рдпрд╣рд╛рдВ рдорджрдж рдХрд░реЗрдЧрд╛: </p><br><pre><code class="bash hljs">openstack floating ip create -c floating_ip_address -f value -project \ {{ project name }} тАФsubnet private-v4 CLOUD_NET</code> </pre> <br><p>  рдЧреБрдо рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдПрдХ рдФрд░ рдЙрджрд╛рд╣рд░рдг: рдбреНрдпреВрд▓рд╕реНрдЯреИрдХ рдХреЗ рдХрд╛рд░рдг, рд╣рдо v4 рдФрд░ v6 рдХреЗ рд▓рд┐рдП рджреЛ рдкреЛрд░реНрдЯ рдХреЗ рд╕рд╛рде рдПрдХ рд░рд╛рдЙрдЯрд░ рдареАрдХ рд╕реЗ рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ  рдпрд╣ рд╡рд╣ рдЬрдЧрд╣ рд╣реИ рдЬрд╣рд╛рдБ рдПрдХ рдмреИрд╢ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛рдо рдЖрддреА рд╣реИ: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/bash # $1 - router_name # $2 - router_project # $3 - router_network # echo "${@:4}" - private subnet lists FIXED4_SUBNET="subnet-bgp-nexthop-v4" FIXED6_SUBNET="subnet-bgp-nexthop-v6" openstack --os-project-name $2 router show $1 if [ $? -eq 0 ] then echo "router is exist" exit 0 fi openstack --os-project-name $2 router create --project $2 $1 for subnet in "${@:4}"; do openstack --os-project-name $2 router add subnet $1 $subnet done openstack --os-project-name $2 router set $1 --external-gateway $3 --fixed-ip subnet=$FIXED4_SUBNET --fixed-ip subnet=$FIXED6_SUBNET</span></span></code> </pre> <br><p>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд░рд╛рдЙрдЯрд░ рдмрдирд╛рддрд╛ рд╣реИ, рдЗрд╕рдореЗрдВ v4 рдФрд░ v6 рд╕рдмрдиреЗрдЯ рдЬреЛрдбрд╝рддрд╛ рд╣реИ, рдФрд░ рдПрдХ рдмрд╛рд╣рд░реА рдЧреЗрдЯрд╡реЗ рдЕрд╕рд╛рдЗрди рдХрд░рддрд╛ рд╣реИред </p><br><h3 id="retry">  рдкреБрди: рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ </h3><br><p>  рдХрд┐рд╕реА рднреА рдЕрд╕рдВрдЧрдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ - рдкреБрдирд░рд╛рд░рдВрдн рдХрд░реЗрдВред  рдлрд┐рд░ рд╕реЗ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ, рдПрдХ рдЙрджрд╛рд╣рд░рдг, рдПрдХ рд░рд╛рдЙрдЯрд░ рдпрд╛ рдбреАрдПрдирдПрд╕ рд░рд┐рдХреЙрд░реНрдб рдмрдирд╛рдПрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рд╣рдореЗрд╢рд╛ рдпрд╣ рдирд╣реАрдВ рд╕рдордЭрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА рд╕рдорд╕реНрдпрд╛ рдХреНрдпрд╛ рд╣реИред  рд░рд┐рдЯреНрд░реА рд╕реЗрд╡рд╛ рдХреА рдЧрд┐рд░рд╛рд╡рдЯ рдореЗрдВ рджреЗрд░реА рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕ рд╕рдордп рдЖрдк рд╢рд╛рдВрддрд┐ рд╕реЗ рдФрд░ рдирд╕реЛрдВ рдХреЗ рдмрд┐рдирд╛ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдКрдкрд░ рджрд┐рдП рдЧрдП рд╕рднреА рдЯрд┐рдкреНрд╕ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЯреЗрд░рд╛рдлреЙрд░реНрдо, рдкрдкреЗрдЯ, рдФрд░ рдХреБрдЫ рдФрд░ рдХреЗ рд╕рд╛рде рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред </p><br><h2 id="vsemu-svoyo-mesto">  рд╣рд░ рдЪреАрдЬ рдХреА рдЕрдкрдиреА рдЬрдЧрд╣ рд╣реИ </h2><br><p>  рдХреЛрдИ рднреА рдмрдбрд╝реА рд╕реЗрд╡рд╛ (рдУрдкрдирд╕реНрдЯреИрдХ рдХреЛрдИ рдЕрдкрд╡рд╛рдж рдирд╣реАрдВ рд╣реИ) рдХрдИ рдЫреЛрдЯреА рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝рддреА рд╣реИ рдЬреЛ рдПрдХ-рджреВрд╕рд░реЗ рдХреЗ рдХрд╛рдо рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХрд░ рд╕рдХрддреА рд╣реИрдВред  рдпрд╣рд╛рдБ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИред </p><br><p>  рдиреЗрдЯрд╡рд░реНрдХ рдПрдЬреЗрдВрдЯ рдиреНрдпреВрдЯреНрд░реЙрди-рдПрд▓ 2-рдПрдЬреЗрдВрдЯ рдУрдкрдирд╕реНрдЯреИрдХ рдореЗрдВ рдиреЗрдЯрд╡рд░реНрдХ рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред  рдпрджрд┐ рд╕рднреА рдЕрдиреНрдп рдПрдЬреЗрдВрдЯ рдирд┐рдпрдВрддреНрд░рдХреЛрдВ рдкрд░ рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рд╣реИрдВ, рддреЛ рдПрд▓ 2, рдмрд╛рд░реАрдХрд┐рдпреЛрдВ рдХреЗ рдХрд╛рд░рдг, рд╣рд░ рдЬрдЧрд╣ рдореМрдЬреВрдж рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/ae/dx/uh/aedxuhggl2u8fyrtqgwkfphjjle.png"><br>  <em>рдЗрд╕реА рддрд░рд╣ рд╕реЗ рд╣рдорд╛рд░рд╛ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪрд╛ рдмрд╣реБрдд рд╢реБрд░реБрдЖрдд рдореЗрдВ рджреЗрдЦрд╛ рдЧрдпрд╛, рдЬрдм рддрдХ рдХрд┐ рдпреЛрдЬрдирд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ 50 рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реЛ рдЧрдИ</em> </p><br><p>  рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░, рд╣рдордиреЗ рдорд╣рд╕реВрд╕ рдХрд┐рдпрд╛ рдХрд┐ рдПрдЬреЗрдВрдЯреЛрдВ рдХреА рдЗрд╕ рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреЗ рдХрд╛рд░рдг, рдирд┐рдпрдВрддреНрд░рдХ рд▓реЛрдб рдХрд╛ рд╕рд╛рдордирд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХреЗ, рдФрд░ рдиреЛрдбреНрд╕ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдЬреЗрдВрдЯреЛрдВ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рджрд┐рдпрд╛ред  рд╡реЗ рдирд┐рдпрдВрддреНрд░рдХреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рд╣реИрдВ, рдФрд░ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдирд┐рдпрдВрддреНрд░рдХ рдХреЛ рд╣рд░ рдЪреАрдЬ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рд╕реЗ рдирд┐рдкрдЯрдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рдирд╣реАрдВ рд╣реИ - рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдиреЛрдб рдХреЛ рдХрд╛рд░реНрдп рджреЗрдирд╛ рд╣реЛрдЧрд╛, рдФрд░ рдиреЛрдб рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред </p><br><p><img src="https://habrastorage.org/webt/63/mh/8v/63mh8vrzvrqv3w5exan5tw8npba.png"><br>  <em>рдиреЛрдбреНрд╕ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдПрдЬреЗрдВрдЯ</em> </p><br><p>  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рдерд╛, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рддрд░рд╣ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд╛ рдЖрднрд╛рд╕реА рдорд╢реАрдиреЛрдВ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдкрд░ рдмреБрд░рд╛ рдкреНрд░рднрд╛рд╡ рдкрдбрд╝рд╛ред  рдкреНрд░рддрд┐ рднреМрддрд┐рдХ 14 рд╡рд░реНрдЪреБрдЕрд▓ рдХреЛрд░ рдХреЗ рдШрдирддреНрд╡ рдХреЗ рд╕рд╛рде, рдпрджрд┐ рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рдПрдЬреЗрдВрдЯ рдиреЗ рд╕реНрдЯреНрд░реАрдо рд▓реЛрдб рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛, рддреЛ рдпрд╣ рдПрдХ рд╣реА рдмрд╛рд░ рдореЗрдВ рдХрдИ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/br/z5/zi/brz5ziy4mpmlr2ijectmrezvgtw.png"><br>  <em>рддреАрд╕рд░рд╛ рдкреБрдирд░рд╛рд╡реГрддрд┐ред</em>  <em>рдЪрдпрдирд┐рдд рдиреЛрдбреНрд╕ рджрд┐рдЦрд╛рдИ рджрд┐рдПред</em> </p><br><p>  рд╣рдордиреЗ рдиреЗрдЯрд╡рд░реНрдХ рдиреЛрдбреНрд╕ рдХреЛ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдЬреЗрдВрдЯреЛрдВ рдХреЛ рд╕реЛрдЪрд╛ рдФрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ред  рдЕрдм рдХреЗрд╡рд▓ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛рдПрдВ рдХрдВрдкреНрдпреВрдЯ рдиреЛрдбреНрд╕ рдкрд░ рдмрдиреА рд╣реБрдИ рд╣реИрдВ, рд╕рднреА рдПрдЬреЗрдВрдЯ рдиреЗрдЯрд╡рд░реНрдХ рдиреЛрдб рдкрд░ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдХреЗрд╡рд▓ bgp рдПрдЬреЗрдВрдЯ рдЬреЛ v6 рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рд╡реЗ рдирд┐рдпрдВрддреНрд░рдХреЛрдВ рдкрд░ рдмрдиреЗ рд░рд╣рддреЗ рд╣реИрдВ (рдХреНрдпреЛрдВрдХрд┐ рдПрдХ bgp рдПрдЬреЗрдВрдЯ рдХреЗрд╡рд▓ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рд╕реЗрд╡рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ)ред  L2 рд╣рд░ рдЬрдЧрд╣ рдмрдирд╛ рд░рд╣рд╛, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рдмрд┐рдирд╛, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдКрдкрд░ рд▓рд┐рдЦрд╛ рд╣реИ, рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдХреЛрдИ рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рдирд╣реАрдВ рд╣реЛрдЧреАред </p><br><p><img src="https://habrastorage.org/webt/pu/yg/ie/puygieqmiyz9zi8dlovcu_j88ma.png"><br>  <em>рд╕рдм рдХреБрдЫ рдорд┐рд╢реНрд░рд┐рдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЧрдгрдирд╛ рдиреЛрдбреНрд╕ рдХрд╛ рд▓реЛрдб рдЧреНрд░рд╛рдлред</em>  <em>рдпрд╣ рд▓рдЧрднрдЧ 60% рдерд╛, рд▓реЗрдХрд┐рди рднрд╛рд░ рдмреЗрд╣рдж рдХрдо рд╣реЛ рдЧрдпрд╛</em> </p><br><p><img src="https://habrastorage.org/webt/y5/im/t2/y5imt2_c5e-7xoha7crtboepbd4.png"><br>  <em>рдиреЗрдЯрд╡рд░реНрдХ рдПрдЬреЗрдВрдЯреЛрдВ рд╕реЗ рдкрд╣рд▓реЗ рд╕реЙрдлреНрдЯрд░реИрдХ рдкрд░ рд▓реЛрдб рдиреЗ рдЧрдгрдирд╛ рдиреЛрдбреНрд╕ рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ред</em>  <em>3 рдХреЛрд░ рд▓реЛрдбреЗрдб рд░рд╣реЗред</em>  <em>рдЙрд╕ рд╕рдордп, рд╣рдордиреЗ рд╕реЛрдЪрд╛ рдХрд┐ рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ</em> </p><br><h2 id="code-asdocumentation">  рдкреНрд░рд▓реЗрдЦрди рдХреЗ рд░реВрдк рдореЗрдВ рдХреЛрдб </h2><br><p>  рдХрднреА-рдХрднреА рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдХреЛрдб рдкреНрд░рд▓реЗрдЦрди рд╣реИ, рдЦрд╛рд╕рдХрд░ рдУрдкрдирд╕реНрдЯреИрдХ рдЬреИрд╕реА рдмрдбрд╝реА рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВред  рдЫрд╣ рдорд╣реАрдиреЗ рдХреЗ рд░рд┐рд▓реАрдЬ рдЪрдХреНрд░ рдХреЗ рд╕рд╛рде, рдбреЗрд╡рд▓рдкрд░реНрд╕ рднреВрд▓ рдЬрд╛рддреЗ рд╣реИрдВ рдпрд╛ рдмрд╕ рдХреБрдЫ рдЪреАрдЬреЛрдВ рдХреЛ рджрд╕реНрддрд╛рд╡реЗрдЬ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдХреА рддрд░рд╣ рдирд┐рдХрд▓рддрд╛ рд╣реИред </p><br><h4 id="pro-taymauty">  рдЯрд╛рдЗрдордЖрдЙрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ </h4><br><p>  рдПрдХ рдмрд╛рд░ рдЬрдм рд╣рдордиреЗ рджреЗрдЦрд╛ рдХрд┐ рдиреНрдпреВрдЯреНрд░реЙрди рдУрдкрди рд╡реАрд╕реНрд╡рд┐рдЪ рдХреЛ рдкрд╛рдВрдЪ рд╕реЗрдХрдВрдб рдореЗрдВ рдлрд┐рдЯ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЯрд╛рдЗрдордЖрдЙрдЯ рдореЗрдВ рдЖрддреЗ рд╣реИрдВред </p><br><pre> <code class="bash hljs">127.0.0.1:29696: no response to inactivity probe after 10 seconds, disconnecting neutron.agent.ovsdb.native.commands TimeoutException: Commands [DbSetCommand(table=Port, col_values=((<span class="hljs-string"><span class="hljs-string">'tag'</span></span>, 11),), record=qtoq69a81c6-e2)] exceeded timeout 5 seconds</code> </pre> <br><p>  рдмреЗрд╢рдХ, рд╣рдордиреЗ рдорд╛рди рд▓рд┐рдпрд╛ рдерд╛ рдХрд┐ рдХрд╣реАрдВ рди рдХрд╣реАрдВ рдпрд╣ рддрдп рд╣реИред  рд╣рдордиреЗ рдХреЙрдиреНрдлрд┐рдЧ, рдбреЙрдХреНрдпреВрдореЗрдВрдЯреЗрд╢рди рдФрд░ рдбрд┐рдмреЗрдЯ рдкреИрдХреЗрдЬ рдореЗрдВ рджреЗрдЦрд╛, рд▓реЗрдХрд┐рди рдкрд╣рд▓реЗ рддреЛ рдЙрдиреНрд╣реЗрдВ рдХреБрдЫ рднреА рдирд╣реАрдВ рдорд┐рд▓рд╛ред  рдирддреАрдЬрддрди, рдЦреЛрдЬ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рдкрд╛рдВрдЪрд╡реЗрдВ рдкреГрд╖реНрда рдкрд░ рд╡рд╛рдВрдЫрд┐рдд рд╕реЗрдЯрд┐рдВрдЧ рдХрд╛ рд╡рд┐рд╡рд░рдг рдорд┐рд▓рд╛ - рд╣рдордиреЗ рдлрд┐рд░ рд╕реЗ рдХреЛрдб рдХреЛ рджреЗрдЦрд╛ рдФрд░ рд╕рд╣реА рд╕реНрдерд╛рди рдкрд╛рдпрд╛ред  рд╕реЗрдЯрд┐рдВрдЧ рдпрд╣ рд╣реИ: </p><br><pre> <code class="bash hljs">ovs_vsctl_timeout = 30</code> </pre> <br><p>  <em>рд╣рдордиреЗ рдЗрд╕реЗ 30 рд╕реЗрдХрдВрдб рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдпрд╛ (рдпрд╣ 5 рдерд╛), рдФрд░ рд╕рдм рдХреБрдЫ рдереЛрдбрд╝рд╛ рдмреЗрд╣рддрд░ рдХрд╛рдо рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛ред</em> </p><br><p>  рдпрд╣рд╛рдВ рдПрдХ рдФрд░ рдЕрдкреНрд░рдпреБрдХреНрдд рд╣реИ - рдЬрдм рдЖрдк рдиреЗрдЯрд╡рд░реНрдХ рдШрдЯрдХреЛрдВ рдХреЛ рд░рд┐рдмреВрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХреБрдЫ рдУрдкрди vSwitch рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд░реАрд╕реЗрдЯ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред  рдпрд╣, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, ovs-vsctl inactivity_probe рдХреЗ рд╕рд╛рде рд╣реЛрддрд╛ рд╣реИред  рдпрд╣ рднреА рдПрдХ рд╕рдордпрдмрд╛рд╣реНрдп рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрдкрдиреЗ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд▓рд┐рдП рдУрд╡рд╕-рдбрд┐рд╕реНрдХреНрдЯрд▓ рдХреА рдХреЙрд▓ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред  рд╣рдордиреЗ рдЗрд╕реЗ рд╕рд┐рд╕реНрдЯрдордб рдЗрдирд┐рдЯ рдореЗрдВ рдЬреЛрдбрд╝рд╛, рдЬрд┐рд╕рдиреЗ рд╣рдореЗрдВ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рд╕рднреА рд╕реНрд╡рд┐рдЪ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреАред </p><br><pre> <code class="bash hljs">ovs-vsctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> Controller <span class="hljs-string"><span class="hljs-string">"br-int"</span></span> inactivity_probe=30000</code> </pre> <br><h4 id="pro-nastroyki-setevogo-steka">  рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдЯреИрдХ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ </h4><br><p>  рд╣рдореЗрдВ рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдЯреИрдХ рдореЗрдВ рдЖрдо рддреМрд░ рдкрд░ рд╕реНрд╡реАрдХреГрдд рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╕реЗ рднреА рдереЛрдбрд╝рд╛ рджреВрд░ рдЬрд╛рдирд╛ рдерд╛, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдЕрдкрдиреЗ рдЕрдиреНрдп рд╕рд░реНрд╡рд░ рдкрд░ рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рдпрд╣рд╛рдВ ARP рд░рд┐рдХреЙрд░реНрдб рдХреЛ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдореЗрдВ рдХрд┐рддрдирд╛ рд╕рдордп рд▓рдЧрддрд╛ рд╣реИ, рдЗрд╕рдХреА рд╕реЗрдЯрд┐рдВрдЧ рдпрд╣рд╛рдВ рджреА рдЧрдИ рд╣реИ: </p><br><pre> <code class="bash hljs">net.ipv4.neigh.default.base_reachable_time = 60 net.ipv4.neigh.default.gc_stale_time=60</code> </pre> <br><p>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди 1 рджрд┐рди рд╣реИред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдПрдХ рдпреЛрдЬрдирд╛ рдХреБрдЫ рд╣рдлреНрддреЛрдВ рддрдХ рд░рд╣ рд╕рдХрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рджрд┐рди рдХреЗ рд▓рд┐рдП, рдпреЛрдЬрдирд╛рдУрдВ рдХреЛ 4-6 рдмрд╛рд░ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдореИрдХ рдкрддреЗ рдФрд░ рдЖрдИрдкреА рдкрддреЗ рдХрд╛ рдкрддреНрд░рд╛рдЪрд╛рд░ рд▓рдЧрд╛рддрд╛рд░ рдмрджрд▓ рд░рд╣рд╛ рд╣реИред  рддрд╛рдХрд┐ рдХрдЪрд░рд╛ рдЬрдорд╛ рди рд╣реЛ, рд╣рдо рдПрдХ рдорд┐рдирдЯ рдХрд╛ рд╕рдордп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </p><br><pre> <code class="bash hljs">net.ipv4.conf.default.arp_notify = 1 net.nf_conntrack_max = 1000000 (default 262144) net.netfilter.nf_conntrack_max = 1000000 (default 262144)</code> </pre> <br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдордиреЗ рдиреЗрдЯрд╡рд░реНрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдмрдврд╝рд╛рддреЗ рд╕рдордп ARP рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд┐рдпрд╛ред  рд╣рдордиреЗ рдХреЙрдирдЯреНрд░реИрдХ рдЯреЗрдмрд▓ рдХреЛ рднреА рдмрдврд╝рд╛рдпрд╛, рдХреНрдпреЛрдВрдХрд┐ NAT рдФрд░ рдлреНрд▓реЛрдЯрд┐рдВрдЧ рдЖрдИрдкреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рдирд╣реАрдВ рдерд╛ред  рдПрдХ рдорд┐рд▓рд┐рдпрди (262 144 рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЗ рд╕рд╛рде) рддрдХ рдмрдврд╝ рдЧрдпрд╛, рд╕рдм рдХреБрдЫ рдФрд░ рднреА рдмреЗрд╣рддрд░ рд╣реЛ рдЧрдпрд╛ред </p><br><p>  рд╣рдо рдЦреБрд▓реЗ vSwitch рдХреЗ рдореИрдХ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рд╕рд╣реА рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="bash hljs">ovs-vsctl <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> bridge bt-int other-config:mac-table-size=50000 (default 2048)</code> </pre> <br><p><img src="https://habrastorage.org/webt/px/oi/px/pxoipxvpkzuou-twlr5uf0r28k8.png"><br>  <em>рд╕рднреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рдмрд╛рдж, 40% рд▓реЛрдб рд▓рдЧрднрдЧ рд╢реВрдиреНрдп рдореЗрдВ рдмрджрд▓ рдЧрдпрд╛</em> </p><br><h4 id="rx-flow-hash">  RX-рдкреНрд░рд╡рд╛рд╣ рдХреЗ рд╣реИрд╢ </h4><br><p>  рд╕рднреА рдХрддрд╛рд░реЛрдВ рдФрд░ рдкреНрд░реЛрд╕реЗрд╕рд░ рдереНрд░реЗрдбреНрд╕ рдХреЗ рдмреАрдЪ udp рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд╡рд┐рддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдордиреЗ rx-flow-hash рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ред  рдЗрдВрдЯреЗрд▓ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛рд░реНрдб рдкрд░, i40e рдбреНрд░рд╛рдЗрд╡рд░ рдореЗрдВ, рдпрд╣ рд╡рд┐рдХрд▓реНрдк рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдХреНрд╖рдо рд╣реИред  рд╣рдорд╛рд░реЗ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдореЗрдВ 72 рдХреЛрд░ рдХреЗ рд╕рд╛рде рд╣рд╛рдЗрдкрд░рд╡рд┐рдЬрд░ рд╣реИрдВ, рдФрд░ рдпрджрд┐ рдХреЗрд╡рд▓ рдПрдХ рд╣реА рд╡реНрдпрд╕реНрдд рд╣реИ, рддреЛ рдпрд╣ рдмрд╣реБрдд рдЗрд╖реНрдЯрддрдо рдирд╣реАрдВ рд╣реИред </p><br><p>  рдпрд╣ рдЗрд╕ рддрд░рд╣ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="bash hljs">ethtool -N eno50 rx-flow-hash udp4 sdfn</code> </pre> <br><p><img src="https://habrastorage.org/webt/zj/qp/16/zjqp16xvvxmawd1irfjbwaeia9q.png"></p><br><p>  <strong>рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд┐рд╖реНрдХрд░реНрд╖: рдЖрдк рд╕рдм рдХреБрдЫ рд╕рдм рдкрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</strong>  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреБрдЫ рдмрд┐рдВрджреБ рдкрд░ рдлрд┐рдЯ рд╣реЛрдЧрд╛ (рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдХрд┐рдпрд╛ рдерд╛), рд▓реЗрдХрд┐рди рдЯрд╛рдЗрдордЖрдЙрдЯ рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛ рдиреЗ рдЗрд╕реЗ рдЦреЛрдЬрдирд╛ рдЖрд╡рд╢реНрдпрдХ рдмрдирд╛ рджрд┐рдпрд╛ред  рдФрд░ рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╣реИред </p><br><h3 id="pravila-bezopasnosti">  рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдо </h3><br><p>  рд╕реБрд░рдХреНрд╖рд╛ рд╕реЗрд╡рд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдХрдВрдкрдиреА рдХреЗ рднреАрддрд░ рд╕рднреА рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдФрд░ рд╡реИрд╢реНрд╡рд┐рдХ рдирд┐рдпрдо рд╣реИрдВ - рдЙрдирдореЗрдВ рд╕реЗ рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╣реИрдВред  рдЬрдм рд╣рдо 300 рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрдиреЛрдВ рд╕реЗ рдПрдХ рд╣рд╛рдЗрдкрд░рд╡рд╛рдЗрдЬрд░ рдХреЗ рд▓рд┐рдП рд╡рд┐рджреЗрд╢ рдЧрдП, рддреЛ рдпрд╣ рд╕рдм iptables рдХреЗ рд▓рд┐рдП 80 рд╣рдЬрд╛рд░ рдирд┐рдпрдореЛрдВ рдореЗрдВ рдмрджрд▓ рдЧрдпрд╛ред  рдЦреБрдж iptables рдХреЗ рд▓рд┐рдП, рдпрд╣ рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдиреНрдпреВрдЯреНрд░реЙрди рдиреЗ RabbitMQ рд╕реЗ рдЗрди рдирд┐рдпрдореЛрдВ рдХреЛ рдПрдХ рдзрд╛рд░рд╛ рдореЗрдВ рд▓реЛрдб рдХрд░ рджрд┐рдпрд╛ (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкрд╛рдпрдерди рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рд╡рд╣рд╛рдВ рд╕рдм рдХреБрдЫ рдорд▓реНрдЯреАрдереНрд░реЗрдбрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рджреБрдЦреА рд╣реИ)ред  рдиреНрдпреВрдЯреНрд░реЙрди рдПрдЬреЗрдВрдЯ рдЬрдорд╛ рджреЗрддрд╛ рд╣реИ, рд░реИрдмрд┐рдЯрдПрдордХреНрдпреВ рдХреЗ рд╕рд╛рде рдХрдиреЗрдХреНрд╢рди рдЦреЛ рджреЗрддрд╛ рд╣реИ рдФрд░ рдЯрд╛рдЗрдордЖрдЙрдЯ рд╕реЗ рдПрдХ рдЪреЗрди рд░рд┐рдПрдХреНрд╢рди рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рд░рд┐рдХрд╡рд░реА рдХреЗ рдмрд╛рдж, рдиреНрдпреВрдЯреНрд░реЙрди рд╕рднреА рдирд┐рдпрдореЛрдВ рдХрд╛ рдлрд┐рд░ рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ, рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реЗрд╢рди рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рд╕рдм рдХреБрдЫ рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред </p><br><p>  рдЗрд╕рдХреЗ рд╕рд╛рде рд╣реА, рдЦрдбрд╝рд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп 20-40 рдорд┐рдирдЯ рд╕реЗ, рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛, рдПрдХ рдШрдВрдЯреЗ рддрдХ рдмрдврд╝ рдЧрдпрд╛ред </p><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдордиреЗ рдмрд╕ рд╕рдм рдХреБрдЫ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХреЗ рд╕рд╛рде рд▓рдкреЗрдЯрд╛ (рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрд╕ рд╕реНрддрд░ рдкрд░ рд╣рдордиреЗ рдорд╣рд╕реВрд╕ рдХрд┐рдпрд╛ рдХрд┐ рд╕рдорд╕реНрдпрд╛ рдЗрддрдиреА рдЬрд▓реНрджреА рд╣рд▓ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИ), рдФрд░ рдлрд┐рд░ рд╣рдордиреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдлрдбрдмреНрд▓реНрдпреВрдПрдПрдПрд╕</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджрд┐рдпрд╛</a> ред  рдЗрд╕рдХреЗ рд╕рд╛рде, рд╣рдордиреЗ рдиреЗрдЯрд╡рд░реНрдХ рдиреЛрдбреНрд╕ рдХреЛ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдВрдкреНрдпреВрдЯ рдиреЛрдбреНрд╕ рдХреЗ рд╕рд╛рде рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдо рдирд┐рдХрд╛рд▓реЗ рдЬрд╣рд╛рдВ рд░рд╛рдЙрдЯрд░ рдЦреБрдж рд╕реНрдерд┐рдд рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/ou/dg/r_/oudgr_riwann3smyytraqiommpe.png"><br>  <em>рд╕реНрд░реЛрдд - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">docs.openstack.org</a></em> </p><br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЗрд╕ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдЕрдВрджрд░ рд╣рд░ рдЙрд╕ рдЪреАрдЬ рдХреА рдкреВрд░реА рдкрд╣реБрдВрдЪ рд╣реИ, рдЬреЛ рдмрд╛рд╣рд░реА рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдореЛрдВ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреА рд╣реИред  рдЗрд╕рд▓рд┐рдП рд╣рдордиреЗ рдиреНрдпреВрдЯреНрд░реЙрди рдкрд░ рднрд╛рд░ рдХрдо рдХрд░ рджрд┐рдпрд╛ рдФрд░ рдкрд░реАрдХреНрд╖рдг рд╡рд╛рддрд╛рд╡рд░рдг рдмрдирд╛рдиреЗ рдХреЗ 20-30 рдорд┐рдирдЯ рдмрд╛рдж рд╡рд╛рдкрд╕ рдЖ рдЧрдПред </p><br><h2 id="itog">  рдкрд░рд┐рдгрд╛рдо </h2><br><p>  рдУрдкрдирд╕реНрдЯреИрдХ рдПрдХ рд╢рд╛рдВрдд рдЪреАрдЬ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЖрдк рд▓реЛрд╣реЗ рдХреЛ рд░реАрд╕рд╛рдпрдХрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдПрдХ рдЖрдВрддрд░рд┐рдХ рдХреНрд▓рд╛рдЙрдб рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХреБрдЫ рдФрд░ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рдореЗрдВ</a> рдПрдХ рдмрдбрд╝рд╛ рд╕рдореБрджрд╛рдп рдФрд░ рдПрдХ рд╕рдХреНрд░рд┐рдп <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдореВрд╣ рд╣реИ</a> , рдЬрд╣рд╛рдВ рдЙрдиреНрд╣реЛрдВрдиреЗ рд╣рдореЗрдВ рдЯрд╛рдЗрдордЖрдЙрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреНрд░реЗрд░рд┐рдд рдХрд┐рдпрд╛ред </p><br><p>  рд╡рд╣ рд╕рдм рд╣реИред  рдкреНрд░рд╢реНрди рдкреВрдЫреЗрдВ, рдореЗрд░реЗ рд╕рд╣рдпреЛрдЧрд┐рдпреЛрдВ рдФрд░ рдореИрдВ рд╣рдорд╛рд░реЗ рдЕрдиреБрднрд╡ рдХрд╛ рдЬрд╡рд╛рдм рджреЗрдиреЗ рдФрд░ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИрдВред </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi427569/">https://habr.com/ru/post/hi427569/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi427557/index.html">рдирд╡рдВрдмрд░ рдореЗрдВ рдЖрдИрдЯреА рдЗрд╡реЗрдВрдЯреНрд╕ рдХрд╛ рдбрд╛рдЗрдЬреЗрд╕реНрдЯ (рднрд╛рдЧ рдПрдХ)</a></li>
<li><a href="../hi427561/index.html">рдорд░рдореНрдордд рдХрд╛ рдЕрдзрд┐рдХрд╛рд░: рдореЛрдЯреЛрд░реЛрд▓рд╛ рд╕реЗ рд╕рд╣реА рджрд┐рд╢рд╛ рдореЗрдВ рдкрд╣рд▓рд╛ рдХрджрдо</a></li>
<li><a href="../hi427563/index.html">рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб SNI рдорд╛рдирдХ рдлрд╝рд╛рдпрд░рдлрд╝реЙрдХреНрд╕ рдирд╛рдЗрдЯрд▓реА рдореЗрдВ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛</a></li>
<li><a href="../hi427565/index.html">"рдореЗрд░реА рдЙрдкрд▓рдмреНрдзрд┐ рдпрд╣ рдереА рдХрд┐ рдореИрдВ рдЖрдо рддреМрд░ рдкрд░ рдкреЗрд╢реЗ рдореЗрдВ рд▓реМрдЯ рдЖрдпрд╛" - рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдХреЛ 10 рдкреНрд░рд╢реНрди, рдЕрдВрдХ 10</a></li>
<li><a href="../hi427567/index.html">рдПрдХрддрд╛ рдореЗрдВ рд╖рдЯреНрдХреЛрдг рдорд╛рдирдЪрд┐рддреНрд░: рдЬрд▓ рдЪрдХреНрд░, рдХреНрд╖рд░рдг, рдмрд╛рдпреЛрдо, рдмреЗрд▓рдирд╛рдХрд╛рд░ рдирдХреНрд╢рд╛</a></li>
<li><a href="../hi427571/index.html">R рдФрд░ PostgreSQL рдХрд╛ рдорд┐рд▓рдиред рд╣рдо рд╣рд╡рд╛рдИ рдЕрдбреНрдбреЛрдВ рдХреЗ рдХрд╛рдо рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддреЗ рд╣реИрдВ, рдкреЗрдВрд╢рди рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi427573/index.html">рдХреИрдВрдбреА рдпрд╛ рдЬреАрд╡рди: рд╣реИрд▓реЛрд╡реАрди рдПрдХ рдХрд╛рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдкрдиреЗ рдмрдЪреНрдЪреЗ рдХреЛ рд╡рд┐рдЬреНрдЮрд╛рди рдХреЗ рд▓рд┐рдП рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП</a></li>
<li><a href="../hi427575/index.html">рд╡рд╛рдИ-рдлрд╛рдИ рдпреЛрдЬрдирд╛ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХрд╛рдо рдХреНрдпреЛрдВ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, рдФрд░ рдпрд╣ рдЬрд╛рди рд▓реЗрдВ рдХрд┐ рдХрд░реНрдордЪрд╛рд░реА рдХрд┐рд╕ рддрд░рд╣ рдХреЗ рдлреЛрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ</a></li>
<li><a href="../hi427577/index.html">рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд░ рд╣рдорд▓реЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдкрд░ рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рдмрдирд╛рдо рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг</a></li>
<li><a href="../hi427579/index.html">рдХрдВрдкрдиреА рдХреЗ рднреАрддрд░ iOS рдХреЗ рд▓рд┐рдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╡рд┐рддрд░рдг (рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬрд╝ рд╡рд┐рддрд░рд┐рдд iOS рдРрдк рдЗрди-рд╣рд╛рдЙрд╕)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>