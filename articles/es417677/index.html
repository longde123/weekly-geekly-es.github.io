<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ò üöñ üïß Migrar un proyecto de yii1 a yii2 a trav√©s de un trabajo √∫nico üõåüèæ üë©üèª‚Äçüî¨ üßëüèø‚Äçü§ù‚Äçüßëüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúUn par de veces‚Äù tuve que lidiar con la migraci√≥n de proyectos de yii1 a yii2 y quiero compartir mi experiencia con la comunidad. No hay nada complic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Migrar un proyecto de yii1 a yii2 a trav√©s de un trabajo √∫nico</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417677/"><img src="https://habrastorage.org/webt/82/pe/wu/82pewu1kgru2yvayuvehfbeb258.jpeg"><br><br>  ‚ÄúUn par de veces‚Äù tuve que lidiar con la migraci√≥n de proyectos de yii1 a yii2 y quiero compartir mi experiencia con la comunidad.  No hay nada complicado en este proceso y no habr√° revelaciones.  La naturaleza de la publicaci√≥n es su experiencia + tutorial para principiantes. <br><br><h4>  Antecedentes </h4><br>  Si los proyectos realizados hist√≥ricamente en la primera versi√≥n de yii contin√∫an evolucionando, cada desarrollador que trabaje con ellos tarde o temprano tiene la idea: " <i>qu√© bueno ser√≠a si estuviera en yii2</i> ". <br><br>  Pero las cosas generalmente no van m√°s all√° de los pensamientos, porque  La cantidad de trabajo parece colosal.  En general, tal como es, el volumen es enorme, pero a√∫n no es prohibitivo, seg√∫n el proverbio "los ojos tienen miedo".  Adem√°s, para la transici√≥n a la acci√≥n, se necesita cierta fuerza de voluntad (internamente, me he estado preparando para la migraci√≥n del primer proyecto durante casi un a√±o). <br><br>  Mi idea de migraci√≥n est√° bajo cat. <br><a name="habracut"></a><br>  Antes de "mostrar el c√≥digo" escribir√© muchas letras "por qu√© hice esto", porque  razones determinan la naturaleza del trabajo.  Tuve 2 casos similares. <br><br>  En el primer proyecto, todo fue simple.  Soy copropietario y el √∫nico desarrollador.  Por lo tanto, la raz√≥n "Estoy cansado de escribir en yii1" es bastante convincente.  La escritura debe ser "alta", de lo contrario el resultado puede ser una <s>basura de</s> mala calidad. <br><br>  En el segundo caso, soy un contratista en un proyecto que ha sido escrito por varios desarrolladores durante mucho tiempo sin una arquitectura clara.  Por lo tanto, la salida fue un enorme mont√≥n de c√≥digo heredado.  Reescribir de esta manera es m√°s f√°cil de <s>disparar,</s> dejando de fumar; el cliente no reconoce la refactorizaci√≥n por el bien de la refactorizaci√≥n, por lo que cada nuevo desarrollador ha aumentado a√∫n m√°s el mont√≥n. <br><br>  La situaci√≥n est√° estancada: todos entienden que hay un problema con el c√≥digo, pero no pueden salir de este c√≠rculo.  Suger√≠ la migraci√≥n modular gradual a yii2.  Despu√©s de 1,5 meses, parte del sitio comenz√≥ a funcionar en yii2, lo que significa que hay un lugar para migrar y una infraestructura donde puede trabajar de manera significativa.  Por supuesto, puedes seguir escribiendo mal, pero ya no puedes justificarte con el "mira qu√© horror hay". <br><br><h3>  Piensa antes de comenzar </h3><br>  Para m√≠, he identificado varias reglas.  Si inicia una migraci√≥n, debe respetarlas o no debe iniciarla. <br><br><ol><li>  Es necesario <i>comprender y aceptar</i> "por qu√© necesitamos hemorroides".  Puede haber alguna motivaci√≥n, pero deber√≠a superar todas las desventajas con un amplio margen. </li><li>  No debe comenzar la migraci√≥n si el proyecto no tiene un futuro claro en el pron√≥stico con 2-3 a√±os de anticipaci√≥n.  O lo haces por diversi√≥n. </li><li>  Escribimos todas las nuevas funcionalidades, todo el desarrollo, todo nuevo en yii2.  En yii1, solo debe permanecer el soporte.  Si no se sigue esta regla, recibir√° inmediatamente 2 ramas activas, lo que requerir√° 2 veces m√°s recursos.  Y, dado que siempre no hay suficientes recursos, todo esto puede terminar. </li><li>  No establezca la tarea "reescribe est√∫pidamente todo lo que es".  "Reescribir todo" es tan abstracto y aburrido que si se lo dices a tu equipo con esta redacci√≥n, en sus caras tristes puedes leer muchas cosas interesantes sobre ti. </li><li>  Porque  incluso si "todo lo que desea" no puede reescribirse de inmediato, entonces necesita un plan para la migraci√≥n gradual: por p√°ginas, por servicios, por m√≥dulos. </li><li>  Lo mas importante!  Es mejor considerar la migraci√≥n a yii2 como una refactorizaci√≥n profunda de todo el proyecto dirigido al desarrollo.  Entonces puede resultar que un tercio del proyecto no necesita ser reescrito en absoluto (si funciona bien "como est√°" y requiere un apoyo m√≠nimo), y parte del proyecto puede quedar bellamente enterrado.  Es decir  no solo matando servicios / p√°ginas, sino tambi√©n rehaciendo el proyecto para que simplemente no sean necesarios. </li></ol><br><h3>  Idea de la migraci√≥n </h3><br>  Mi idea de migraci√≥n es la colaboraci√≥n simult√°nea de dos ramas del mismo proyecto en yii1 y yii2 en el mismo dominio, en el mismo host virtual.  Poco a poco, paso a paso servicios de puerto / p√°ginas / m√≥dulos a yii2. <br><br>  Por ejemplo, hay un sitio que se ejecuta en yii1 <br><br><pre><code class="dos hljs">site.ru/ #  site.ru/news #  site.ru/pages #  site.ru/comments # </code> </pre> <br>  Copiamos las noticias en yii2, recibimos: <br><br><pre> <code class="dos hljs">site.ru/ #  site.ru/news #  (yii2) site.ru/pages #  site.ru/comments # </code> </pre> <br>  Revisiones reescritas, recibidas <br><br><pre> <code class="dos hljs">site.ru/ #  site.ru/news #  (yii2) site.ru/pages #  site.ru/comments #  (yii2)</code> </pre> <br>  Y as√≠ gradualmente, p√°gina por p√°gina, hasta que reescribamos todo lo que queremos reescribir.  Est√° claro que cuanto m√°s reescribimos, m√°s f√°cil ser√° el proceso.  Lo m√°s dif√≠cil es siempre el primer paso: primera p√°gina, primer m√≥dulo, primer servicio. <br><br><h2>  Primera parte  Solo para trabajar al mismo tiempo </h2><br>  Agregar√© tautolog√≠as, pero todo es realmente simple.  En el caso m√°s simple, mantenga ambas ramas (yii1 y yii2) en el mismo espacio de trabajo, as√≠: <br><br><pre> <code class="dos hljs">/var/www/site/htdocs/ - DOCUMENT_ROOT   /var/www/site/yii1/ -   yii1 /var/www/site/yii2/ -   yii2</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">O eso</b> <div class="spoiler_text"><pre> <code class="dos hljs">/var/www/site/public_html/ - DOCUMENT_ROOT   /var/www/site/protected/ -   yii1 /var/www/site/yii2/ -   yii2</code> </pre> <br>  mas o menos <br><pre> <code class="dos hljs">/var/www/site/ - DOCUMENT_ROOT   /var/www/site/protected/ -   yii1 /var/www/site/yii2/ -   yii2</code> </pre><br></div></div><br>  No importa c√≥mo nombrar y colocar directorios.  Es necesario asegurarse de que el c√≥digo en yii1 y yii2 se encuentre cerca y est√© disponible para trabajar en un host virtual.  Y toda la magia del trabajo simult√°neo estar√° en los scripts de entrada index.php y .htaccess. <br><br><h4>  ¬øCu√°les son las ventajas de este enfoque? </h4><br><ul><li>  En su entorno de desarrollo, 2 ramas de proyectos estar√°n disponibles de inmediato.  Puede ser conveniente porque  durante mucho tiempo tienes que trabajar con ellos al mismo tiempo, cambiando de un lado a otro. <br></li><li>  Ambos proyectos tendr√°n acceso directo a DOCUMENT_ROOT, que es importante para un trabajo simple con estad√≠sticas css / js. </li></ul><br>  Los contras pueden ser tanto est√©ticos (por tipo: qu√© obst√°culo interferir todos juntos) como asociados con el trabajo multiusuario.  S√≠, puede dividir ubicaciones de almacenamiento de c√≥digo y proyectos divididos en un entorno de desarrollo.  Esto no cambia la esencia, solo agrega matices. <br><br>  Personalmente, cre√© un proyecto separado para la rama yii2 en el IDE, incluso cuando los archivos de la rama estaban f√≠sicamente cerca. <br><br><h3>  Ejemplo b√°sico.  Fuentes de las ramas del proyecto yii1 / yii2 en un directorio </h3><br>  DOCUMENT_ROOT usa 2 scripts de entrada. <br><br><pre> <code class="dos hljs">index.php -  yii1 index_yii2.php -  yii2.</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">En estructura de archivo</b> <div class="spoiler_text"><pre> <code class="dos hljs">htdocs/ htdocs/index.php htdocs/index_yii2.php yii1/ yii2/</code> </pre><br></div></div><br>  <b>index.php</b> <br>  Si no cambia la estructura de archivos para el proyecto a yii1, su index.php permanecer√° sin cambios. <br><br><div class="spoiler">  <b class="spoiler_title">Por ejemplo</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/* * -     . *   , ..     yii1 index.php *       . */</span></span> $app = Yii::createApplication(<span class="hljs-string"><span class="hljs-string">'WebApplication'</span></span>, $config); $app-&gt;run(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br></div></div><br>  <b>index_yii2.php</b> <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> defined(<span class="hljs-string"><span class="hljs-string">'YII_DEBUG'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> define(<span class="hljs-string"><span class="hljs-string">'YII_DEBUG'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); defined(<span class="hljs-string"><span class="hljs-string">'YII_ENV'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> define(<span class="hljs-string"><span class="hljs-string">'YII_ENV'</span></span>, <span class="hljs-string"><span class="hljs-string">'dev'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     yii2  index_yii2.php, //      ¬´¬ª. $path = '/../yii2/'; require(__DIR__ . $path.'vendor/autoload.php'); require(__DIR__ . $path.'vendor/yiisoft/yii2/Yii.php'); require(__DIR__ . $path.'common/config/bootstrap.php'); require(__DIR__ . $path.'frontend/config/bootstrap.php'); $config = yii\helpers\ArrayHelper::merge( require(__DIR__ . $path.'common/config/main.php'), require(__DIR__ . $path.'common/config/main-local.php'), require(__DIR__ . $path.'frontend/config/main.php'), require(__DIR__ . $path.'frontend/config/main-local.php') ); (new yii\web\Application($config))-&gt;run();</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><br>  <b>.htaccess</b> <br>  En .htaccess haremos un enrutamiento entre yii1 y yii2 <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">Options</span></span></span></span> +FollowSymlinks RewriteEngine <span class="hljs-literal"><span class="hljs-literal">On</span></span> RewriteBase / #    yii2 # #   RewriteRule ^test index_yii2.php<span class="hljs-meta"><span class="hljs-meta"> [L] RewriteRule ^news index_yii2.php [L] #   action RewriteRule ^page/one index_yii2.php [L] #       RewriteCond %{REQUEST_FILENAME} !-f RewriteCond %{REQUEST_FILENAME} !-d #     yii1 RewriteRule . index.php</span></span></code> </pre><br>  Es decir  Las siguientes URL son manejadas por index_yii2.php y se ejecutan en yii2. <br><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">https://</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">site</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">https</span></span></span><span class="hljs-function">://</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">site</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">news</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">https</span></span></span><span class="hljs-function">://</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">site</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">page</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">one</span></span></span></span></code> </pre><br>  El resto del sitio es index.php (yii1). <br><br>  Este es un lanzamiento concurrente b√°sico.  Por supuesto, cada uno tendr√° sus propios matices: un equipo, usuarios, derechos de acceso, servidores, diferentes repositorios, etc.  Y cada uno tendr√° su propio jard√≠n. <br><br><h3>  Los c√≥digos fuente de las ramas yii1 / yii2 se distribuyen en directorios </h3><br>  Por ejemplo, si tiene su propio servidor, puede publicar el almacenamiento de ramas de proyectos en diferentes directorios. <br><br><pre> <code class="dos hljs">/var/www/site/htdocs - DOCUMENT_ROOT    site.ru /var/www/site/protected -   yii1 /srv/site_yii2 -   yii2</code> </pre><br>  Luego debe cambiar la ruta al directorio con el proyecto yii2 en index_yii2.php.  Por supuesto, esto funcionar√° si est√° deshabilitado o si open_basedir est√° configurado.  Adem√°s de los derechos correspondientes en el servidor y deshabilitado / configurado, SELinux. <br><br><div class="spoiler">  <b class="spoiler_title">index_yii2.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> defined(<span class="hljs-string"><span class="hljs-string">'YII_DEBUG'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> define(<span class="hljs-string"><span class="hljs-string">'YII_DEBUG'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); defined(<span class="hljs-string"><span class="hljs-string">'YII_ENV'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> define(<span class="hljs-string"><span class="hljs-string">'YII_ENV'</span></span>, <span class="hljs-string"><span class="hljs-string">'dev'</span></span>); $pathYii2 = <span class="hljs-string"><span class="hljs-string">'/srv/site_yii2/'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> $pathYii2 . <span class="hljs-string"><span class="hljs-string">'vendor/autoload.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> $pathYii2 . <span class="hljs-string"><span class="hljs-string">'vendor/yiisoft/yii2/Yii.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> $pathYii2 . <span class="hljs-string"><span class="hljs-string">'common/config/bootstrap.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> $pathYii2 . <span class="hljs-string"><span class="hljs-string">'frontend/config/bootstrap.php'</span></span>; $config = yii\helpers\ArrayHelper::merge( <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> $pathYii2 . <span class="hljs-string"><span class="hljs-string">'common/config/main.php'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> $pathYii2 . <span class="hljs-string"><span class="hljs-string">'common/config/main-local.php'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> $pathYii2 . <span class="hljs-string"><span class="hljs-string">'frontend /config/main.php'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> $pathYii2 . <span class="hljs-string"><span class="hljs-string">'frontend /config/main-local.php'</span></span> ); (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> yii\web\Application($config))-&gt;run();<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><br></div></div><br><h3>  Que sigue </h3><br>  Si hay usuarios en el sitio, entonces la autorizaci√≥n √∫nica es un elemento cr√≠tico sin el cual la operaci√≥n simult√°nea de 2 sucursales es, de hecho, imposible.  En el pr√≥ximo art√≠culo, planeo mostrar lo f√°cil que es organizar una √∫nica autorizaci√≥n.  Por ejemplo, la autorizaci√≥n en s√≠ permanece en yii1, pero los usuarios autorizados son visibles de forma transparente en la rama yii2 o viceversa. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es417677/">https://habr.com/ru/post/es417677/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es417665/index.html">La gram√°tica inglesa como matem√°tica. Por d√≥nde empezar para aquellos que no trabajaron</a></li>
<li><a href="../es417667/index.html">AI. Rastreador de barrera t√°ctica</a></li>
<li><a href="../es417671/index.html">Nuevas caracter√≠sticas del lenguaje de programaci√≥n ABAP en seminarios web de SAP</a></li>
<li><a href="../es417673/index.html">La investigaci√≥n lleva Solar Dozor: 5 casos no est√°ndar que DLP revel√≥</a></li>
<li><a href="../es417675/index.html">Localizaci√≥n de juegos y aplicaciones en Unity. R√°pido y f√°cil</a></li>
<li><a href="../es417679/index.html">El grave legado del pasado. Problemas de la l√≠nea de comandos de Windows</a></li>
<li><a href="../es417681/index.html">Inmersi√≥n en desarrollo en Ethereum. Parte 5: Oraclize</a></li>
<li><a href="../es417683/index.html">C√≥digo obsoleto - C√≥digo de terceros</a></li>
<li><a href="../es417685/index.html">Seminarios web de Skillbox Friday: aprendizaje continuo gratis</a></li>
<li><a href="../es417687/index.html">Asimetr√≠a de la vida</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>