<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç≠ üàÇÔ∏è üèúÔ∏è Bedienfeld (HMI) mit I2C-Bus f√ºr Arduino ‚õ™Ô∏è ü§Ωüèæ ‚úçÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Als Teil der Arbeit mit einigen Arduino-kompatiblen Ger√§ten (ungef√§hr am Ende) brauchte ich einen Bildschirm mit Schaltfl√§chen, um aktuelle Informatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bedienfeld (HMI) mit I2C-Bus f√ºr Arduino</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401587/">  Als Teil der Arbeit mit einigen Arduino-kompatiblen Ger√§ten (ungef√§hr am Ende) brauchte ich einen Bildschirm mit Schaltfl√§chen, um aktuelle Informationen zu steuern und anzuzeigen.  Das hei√üt, das Bedienfeld wurde ben√∂tigt, es ist auch HMI. <br><br>  Es wurde beschlossen, HMI unabh√§ngig zu machen und den ‚Äûquadratischen‚Äú i2c-Bus als Schnittstelle zu verwenden. <br><br><img src="https://habrastorage.org/files/3e6/4e6/24e/3e64e624ed5741d9a37eea535359c671.jpg"><br><br>  Wenn Sie an der Entwicklung und Programmierung solcher Ger√§te interessiert sind, sind Sie bei cat willkommen. <br><a name="habracut"></a><br>  Eigenschaften <br><br><ul><li>  Anzeige 1602, monochrome 16x2 Zeichen </li><li>  5 Tasten: hoch, runter, abbrechen, eingeben, bearbeiten </li><li>  I2c-Schnittstelle </li><li>  DB9F-Anschluss </li><li>  Abmessungen 155x90x44 mm </li></ul><br>  Es gibt offensichtliche Fragen: <br><br><div class="spoiler">  <b class="spoiler_title">Warum nicht einen fertigen Schild kaufen?</b> <div class="spoiler_text">  Nat√ºrlich war es m√∂glich, von einem Chinesen ein fertiges Schild mit Display und Tastatur zu kaufen, und so: <br><img src="https://habrastorage.org/files/c7b/06a/03d/c7b06a03dff44d12bf25dddc779b2a82.jpg"><br>  Sie k√∂nnen 2 FC-113-Schals an diese Abschirmung anl√∂ten, und es stellt sich heraus, dass sie funktional mit meiner identisch ist: ein Display mit einer Tastatur, die an i2c arbeitet.  Der Preis f√ºr das Set betr√§gt ab 4 US-Dollar. <br><br>  Aber auf diesem Board passt die Gr√∂√üe der Tasten nicht zu mir, aber ich wollte gro√üe mit der F√§higkeit, mehrfarbige Kappen zu installieren.  Ich wollte das Arduino nicht √ºber den normalen DB9F-Anschluss mit dem HMI verbinden, aber es musste eine Verbindungsplatine hergestellt werden.  Und in diesem Fall, was ist der Unterschied, ein oder zwei Boards zu machen?  Au√üerdem hatte ich bereits mehrere 1602 Displays auf Lager, sodass ich nur 1,02 US-Dollar ausgeben musste, um FC-113 (0,55 US-Dollar) und den PCF8574P-Port-Expander (0,47 US-Dollar) f√ºr Aliexpress zu kaufen. <br><br>  Nun, und vor allem, wenn Sie es mit Arduino zu tun haben, ist die unabh√§ngige Herstellung von Schilden f√ºr ihn eine Selbstverst√§ndlichkeit, oder? <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Warum ist der i2c-Bus nicht einfacher, die Tasten direkt anzuschlie√üen?</b> <div class="spoiler_text">  Im Bereich der industriellen Steuerungssysteme, in denen ich arbeite, verwenden HMIs digitale Daten√ºbertragungsschnittstellen RS-232, RS-485, CAN usw., um mit Ger√§ten zu kommunizieren.  Daher ist es f√ºr mich logisch, dass mein hausgemachtes HMI <i>alle</i> auf einer Datenschnittstelle funktioniert, in diesem Fall auf i2c. <br><br>  Wenn ich ein Ger√§t herstellen w√ºrde, bei dem das Display auf einem quadratischen Bus funktioniert und die Tasten direkt zum Eingang von Arduino gehen, w√ºrde ich mich zutiefst unzufrieden f√ºhlen.  Wie ich dieses Bild pr√§sentieren werde: Ein separates Kabel ragt aus dem Panel zur Schnittstelle heraus, separate Dr√§hte zum Eingang, brrrr ... <br><br>  Dar√ºber hinaus besteht der Unterschied zwischen der Tastenkarte, die direkt zu den Arduino-Eing√§ngen f√ºhrt, und der Tastenkarte mit der i2c-Schnittstelle nur im PCF8574P-Chip (0,47 USD), einem Kondensator und zwei Widerst√§nden. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Warum sind die Tasten so angeordnet und nicht anders?</b> <div class="spoiler_text">  Die Schaltfl√§chen von links nach rechts haben folgende Funktionen: nach oben, unten, abbrechen, eingeben, bearbeiten. <br>  Die Schaltfl√§che ‚ÄûBearbeiten‚Äú wird von den anderen ein wenig zur Seite entfernt, um ihre Funktion hervorzuheben - √Ñndern der Werte logischer Parameter (Ein / Aus) oder Umschalten in den Bearbeitungsmodus bei numerischen Parametern. <br><br>  Insgesamt gibt es 5 Tasten, obwohl Sie mit dem Chip auf der Tastatur bis zu 8 Teile anschlie√üen k√∂nnen. <br>  Es w√ºrde ausreichen, mit vier Schaltfl√§chen zu arbeiten, und die Funktionalit√§t w√ºrde nicht beeintr√§chtigt - ‚ÄûEingabe‚Äú und ‚ÄûBearbeitung‚Äú k√∂nnen in einer Schaltfl√§che kombiniert werden.  Aber es tat mir nur leid, dass die H√§lfte der 8 Beine des Port Expander-Mikrokreises nicht betroffen sein w√ºrde. <br>  Eine weitere separate Schaltfl√§che zum Bearbeiten kann hilfreich sein, wenn ich mehrere Parameter in einer Zeile anzeigen m√∂chte.  Mit dieser Schaltfl√§che k√∂nnen Sie dann zwischen den Parametern wechseln und angeben, welche ge√§ndert werden m√ºssen.  So funktioniert die Taste ‚ÄûSET‚Äú im beliebten chinesischen HMI OP320. <br><br>  Wenn die ersten beiden Tasten nach oben und unten bedeuten, warum sollten Sie sie dann nicht vertikal platzieren, wie dies beispielsweise im obigen chinesischen Schild der Fall ist? <br><br>  F√ºr mich pers√∂nlich ist es bequemer, wenn alle Tasten horizontal sind und sich die Finger w√§hrend des Betriebs nur in einer Ebene bewegen. <br></div></div><br><h4>  <b>Eisen</b> </h4><br><img src="https://habrastorage.org/files/fdf/110/dee/fdf110deea844523baaf7fed5e5d7f67.jpg"><br><br><img src="https://habrastorage.org/files/d2e/39d/084/d2e39d0848924a5b9d2d3e1e8952462c.jpg"><br><br>  1. Selbstgemachte R√ºckwandplatine mit DB9F-Anschluss.  Da wir also eine + 5V-Stromversorgung f√ºr Port- und Display-Expander von Arduino verwenden, habe ich eine 0,1-A-Sicherung auf die Platine gelegt <br><br>  2. Wir alle kennen das bekannte 1602-Display mit einer gel√∂teten FC-113-Platine, die das Display mit dem i2c-Bus verbindet. <br><br>  3. Eine selbstgemachte Tastaturplatine mit einem PCF8574P-Chip, die den Status der Tasten liest und √ºber den i2c-Bus √ºbertr√§gt.  √úbrigens basiert die FC-113 "Anzeige" -Karte auch auf dem PCF8574-Chip, nur mit dem T-Index, d.h.  planar, nicht DIP, wie PCF8574P. <br><br>  Kn√∂pfe Ich habe 12h12mm mit einem quadratischen Dr√ºcker angebracht, auf denen Sie gro√üe mehrfarbige Kappen tragen k√∂nnen. <br><br><div class="spoiler">  <b class="spoiler_title">Fotos und Schemata von hausgemachten Leiterplatten</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d9a/41d/043/d9a41d0435244acc995795055522501c.jpg"><br><br><img src="https://habrastorage.org/files/a8a/faa/a15/a8afaaa15f16482a8eac22c8a99f5db2.jpg"><br><br><img src="https://habrastorage.org/files/693/76e/475/69376e475bc4455da8658553b0edbd1c.jpg"><br></div></div><br>  Es lohnt sich, ein paar Worte √ºber den PCF8574P-Chip zu sagen, auf dessen Grundlage ich eine Tastaturplatine hergestellt habe. <br>  Der PCF8574P ist ein i2c-Port-Extender.  Insgesamt gibt es 8 Ports, von denen jeder als Ein- oder Ausgang konfiguriert werden kann.  F√ºr diesen Chip ist kein Umreifen als solches erforderlich (denken Sie beispielsweise an max232), nur f√ºr den Fall, dass ich einen Kondensator f√ºr die Stromversorgung einsetze. <br><br>  Die Adresse des PCF8574P-Chips wird √ºber die Adresszweige A0, A1, A2 eingestellt, die √ºber einen 10-kŒ©-Widerstand zur Erde oder zur Stromversorgung gezogen werden. <br><br>  Auf der Tastatur habe ich alle Adresszweige des PCF8574P auf den Boden gelegt, sodass die Adresse als 0x20 fest codiert ist und Sie sie nicht √§ndern k√∂nnen. <br><br>  Wie ich bereits geschrieben habe, habe ich DB9F als Anschluss f√ºr das HMI gew√§hlt.  Arduino empf√§ngt Signale von ihm +5 V, GND, SDA, SCL. <br><br><img src="https://habrastorage.org/files/b9b/46d/b11/b9b46db117ea4418acc54be7f35db069.jpg"><br><br>  Der Draht f√ºr die Kommunikation √ºber i2c Arduino und HMI ist 1,4 m lang und funktioniert ohne St√∂rungen. <br><br>  Ich habe die Platten in Sprint Layout 6 gezeichnet, sie mit der LUT-Methode auf Textolit √ºbertragen und sie in eine L√∂sung aus Peroxid und Zitronens√§ure ge√§tzt. <br><br><div class="spoiler">  <b class="spoiler_title">Ein bisschen √ºber Beizen</b> <div class="spoiler_text">  Es gibt viele Rezepte zum √Ñtzen von Zitronens√§ureplatten auf Glasfaserfolie. <br><br>  Ich habe diese L√∂sung hergestellt: 100 ml Wasserstoffperoxid 3%, 50 g Zitronens√§ure, 3 Teel√∂ffel Salz.  Er erw√§rmte das Peroxidglas in einer Pfanne mit Wasser auf eine Temperatur von etwa 70 Grad. <br><br>  Wir tauchen die Platte mit dem Muster nach unten in die L√∂sung, wie beim √Ñtzen mit Peroxid empfohlen. <br>  Nach einigen zehn Sekunden beginnt ein st√ºrmischer Prozess.  Es wird viel Dampf freigesetzt, dessen Einatmen nicht empfohlen wird.  Wahrscheinlich. <br><br><img src="https://habrastorage.org/files/54a/f92/248/54af9224862547c1a6e41f57d73c0794.jpg"><br><br>  Dann l√§sst der Prozess nach.  Drehen Sie das Brett um. <br><br><img src="https://habrastorage.org/files/e84/801/c1a/e84801c1a7bc43e998f586b8241b202a.jpg"><br><br>  Fertig. <br><br><img src="https://habrastorage.org/files/101/9ec/44e/1019ec44edc945559d4f6b02514077c5.jpg"><br></div></div><br>  Das Geh√§use wurde von einem Freund aus Plexiglas 4 mm auf einer Laserschneidmaschine hergestellt. <br><br><div class="spoiler">  <b class="spoiler_title">Lyrischer Exkurs √ºber das Korps</b> <div class="spoiler_text">  Kaufen Sie einen fertigen Koffer oder machen Sie es selbst?  Nach einigem Nachdenken entschied ich mich, es selbst zu tun.  Diejenigen, die ich zum Verkauf sah, passten weder aus Preis- noch aus √§sthetischen Gr√ºnden zu mir oder befanden sich auf einer DIN-Schiene, die auch nicht zu mir passte. <br><br>  Anfangs wollte der K√∂rper aus Sperrholz herausschneiden.  Aber dann erinnerte ich mich, dass ich einen wunderbaren Freund und zu meiner gro√üen Freude den Direktor einer Sportpreisfirma hatte.  Er hat dort alle Arten von Maschinen, auch zum Laserschneiden. <br><br>  Er bat um Hilfe und ein Freund weigerte sich nicht, f√ºr ein paar Minuten wurden die Teile mit einem Laser geschnitten. <br><br>  Ich nutze diese Gelegenheit, um mich zu bedanken, Kolya!  Sonst m√ºsste ich den ganzen Tag Sperrholz schneiden und schleifen, und das Ergebnis w√§re kaum so brillant. </div></div><br><h4>  <b>Programmierung</b> </h4><br>  Aus Sicht von Arduino besteht dieses HMI aus 2 Ger√§ten, die am i2c-Bus arbeiten: einem Display (LCD) mit der Adresse 0x27 und einer Tastatur mit der Adresse 0x20.  Dementsprechend arbeitet Arduino separat mit der Tastatur und separat mit dem LCD. <br><br>  Die Arbeit mit LCD erfolgt √ºber eine spezielle Bibliothek "LiquidCrystal_I2C.h", die in der Aduino IDE installiert sein muss. <br><br>  Die Arbeit mit der Tastatur erfolgt √ºber die Standardbibliothek Wire.h, die zun√§chst in der Aduino IDE verf√ºgbar ist. <br><br>  Wir verbinden HMI mit Ardiuno. <br><br><img src="https://habrastorage.org/files/cd7/c58/0c1/cd7c580c192e4cac95a2eda6d5cd8756.jpg"><br><br>  1. √úberpr√ºfen Sie zun√§chst, ob Arduino unser HMI sieht.  Laden Sie dazu das Programm hinein, das den i2c-Bus nach Ger√§ten durchsucht. <br><br><div class="spoiler">  <b class="spoiler_title">Skizze 1, i2c-Bus-Scan</b> <div class="spoiler_text"><pre><code class="hljs pgsql">//i2c_scaner #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;Wire.h&gt; String stringOne; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { Wire.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!<span class="hljs-type"><span class="hljs-type">Serial</span></span>); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { byte error, address; <span class="hljs-type"><span class="hljs-type">int</span></span> nDevices; <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Scanning..."); nDevices = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(address = <span class="hljs-number"><span class="hljs-number">1</span></span>; address &lt; <span class="hljs-number"><span class="hljs-number">127</span></span>; address++ ) { Wire.beginTransmission(address); error = Wire.endTransmission(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error == <span class="hljs-number"><span class="hljs-number">0</span></span>) { String stringOne = String(address, HEX); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("0x"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(stringOne); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(" - "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="0A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Motor Driver'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="0F") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Motor Driver'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="1D") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADXL345 Input 3-Axis Digital Accelerometer'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="1E") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'HMC5883 3-Axis Digital Compass'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5B") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5C") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BH1750FVI digital Light Sensor' OR 'Touch Sensor" ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5D") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="20") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'LCM1602 LCD Adapter' "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="21") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="22") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="23") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'BH1750FVI digital Light Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="24") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="25") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="26") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="27") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'LCM1602 LCD Adapter '"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="39") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'TSL2561 Ambient Light Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="40") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP180 barometric pressure sensor'" ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="48") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="49") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit' OR 'SPI-to-UART'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="4A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="4B") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="50") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'AT24C32 EEPROM'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="53") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADXL345 Input 3-Axis Digital Accelerometer'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="68") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'DS3231 real-time clock' OR 'MPU-9250 Nine axis sensor module'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="7A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'LCD OLED 128x64'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="76") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP280 barometric pressure sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="77") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP180 barometric pressure sensor' OR 'BMP280 barometric pressure sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="78") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'LCD OLED 128x64'" ); nDevices++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error==<span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Unknow error at address 0x"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (address&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("0"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(address,HEX); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nDevices == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("No I2C devices found\n"); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("done\n"); delay(<span class="hljs-number"><span class="hljs-number">5000</span></span>); }</code> </pre> <br></div></div><br>  W√§hrend der Ausf√ºhrung dieses Programms schreibt Arduino die Scanergebnisse des i2c-Busses auf die serielle Schnittstelle.  Um diese Daten anzuzeigen, gehen Sie zu Arduino IDE Tools-&gt; Port Monitor. <br><br><img src="https://habrastorage.org/files/cb1/fe9/19c/cb1fe919c65f484bb7d431cae64e87ec.jpg"><br><br>  Wir sehen, dass Arduino auf dem i2c-Bus zwei Ger√§te mit den Adressen 0x20 und 0x27 identifiziert hat, dies sind die Tastatur bzw. das LCD. <br><br>  2. Nun wollen wir sehen, wie unsere Tastatur funktioniert.  Erstellen Sie ein Programm, das den Status der Tasten abfragt und auf dem LCD anzeigt. <br><br><div class="spoiler">  <b class="spoiler_title">Skizze 2, zeigt den Status der Schaltfl√§chen an</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/*   LCD     i2c LCD    FC-113,  0x27      PCF8574P,  0x20 */</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;LiquidCrystal_I2C.h&gt; #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;Wire.h&gt; #define led <span class="hljs-number"><span class="hljs-number">13</span></span> #define ADDR_KBRD <span class="hljs-number"><span class="hljs-number">0x20</span></span> #define ADDR_LCD <span class="hljs-number"><span class="hljs-number">0x27</span></span> byte dio_in; <span class="hljs-type"><span class="hljs-type">bool</span></span> b; <span class="hljs-type"><span class="hljs-type">bool</span></span> key[<span class="hljs-number"><span class="hljs-number">5</span></span>]; LiquidCrystal_I2C lcd(ADDR_LCD,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); //   <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { pinMode(led, OUTPUT); // lcd.init(); lcd.backlight();//    // Wire.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(); Wire.beginTransmission(ADDR_KBRD); Wire.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(B11111111); //   PCF8574P     Wire.endTransmission(); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { Wire.requestFrom(ADDR_KBRD,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Wire.available()); byte dio_in = Wire.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); //   PCF8574P() //      byte mask=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-type"><span class="hljs-type">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">5</span></span>;i++) { key[i]=!(dio_in &amp; mask); mask=mask&lt;&lt;<span class="hljs-number"><span class="hljs-number">1</span></span>; } b=!b; digitalWrite(led, b); //    //    LCD lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.print(String(key[<span class="hljs-number"><span class="hljs-number">0</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">1</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">2</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">3</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">4</span></span>])+" "); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); }</code> </pre><br></div></div><br><img src="https://habrastorage.org/files/450/92f/cf3/45092fcf30ff4986bacf1bf3891ff58e.jpg"><br><br>  Die Tastatur funktioniert. <br><br>  3. Schlie√ülich k√∂nnen Sie mit dem, was alles vorhatte, fortfahren und in Arduino ein mehrstufiges Men√º erstellen.  √úber das Men√º sehen wir nicht nur Informationen, sondern steuern auch die Ausg√§nge von Arduino selbst. <br><br><img src="https://habrastorage.org/files/570/c95/a3b/570c95a3b830423e827c7ac3b68605bf.jpg"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/xBZAx9ewLq4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  In nete gibt es viele Informationen zum Erstellen eines mehrstufigen Men√ºs in C ++, aber f√ºr Arduino habe ich sogar einige Bibliotheken gesehen.  Aber ich habe mich in meinem Programm entschieden, das Men√º selbst zu schreiben.  Erstens ist es umso ruhiger, je weniger Bibliotheken im Projekt √ºbrig sind.  Und zweitens ist es einfach. <br><br>  Ich habe eine andere Variante des Baummen√ºs.  √úber das Men√º k√∂nnen Sie in jeder Zeile gleichzeitig statischen Text und den Wert der Variablen anzeigen.  Sie k√∂nnen beispielsweise den Namen des Parameters und seinen Wert anzeigen. <br><br>  Um Variablen auf dem Bildschirm anzuzeigen, wende ich das Prinzip der Tags an - auf bestimmte Weise gestaltete Textbeschriftungen im Text, anstelle dessen, wenn der Text auf dem Bildschirm angezeigt wird, ein Wert angezeigt wird. <br><br>  Die Parameter k√∂nnen durch Dr√ºcken der Schaltfl√§che ‚ÄûBearbeiten‚Äú ge√§ndert werden.  Dar√ºber hinaus gibt das Tag jedes Parameters an, ob es zum Bearbeiten oder schreibgesch√ºtzt verf√ºgbar ist.  Wenn der aktuelle Parameter schreibgesch√ºtzt ist, lautet der Zeiger am Zeilenanfang '*'. Wenn die Bearbeitung aktiviert ist, wird der Zeiger zu '+'. <br><br><div class="spoiler">  <b class="spoiler_title">Skizze 3, mehrstufiges Men√º</b> <div class="spoiler_text"><pre> <code class="hljs markdown">/<span class="hljs-bullet"><span class="hljs-bullet">*  ,    LCD   i2c LCD    FC-113,  0x27      PCF8574P,  0x20 *</span></span>/ #include <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LiquidCrystal_I2C.h</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> #include <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Wire.h</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> #define led 13 //    ;  ,  ,     #define ADDR<span class="hljs-emphasis"><span class="hljs-emphasis">_KBRD 0x20 #define ADDR_</span></span>LCD 0x27 #define PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D2 2 #define PORT_</span></span>D3 3 #define PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D4 4 #define POINT_</span></span>ON<span class="hljs-emphasis"><span class="hljs-emphasis">_ROOT_</span></span>MENU<span class="hljs-emphasis"><span class="hljs-emphasis">_ITEM 0 // 0/1= /   (*  +)     byte dio_</span></span>in; bool b; byte i; //bool ,      bool BoolVal[<span class="hljs-string"><span class="hljs-string">9</span></span>]={0,0,0, 0,0,0, 0,0,0}; #define ValSvet1 BoolVal[<span class="hljs-string"><span class="hljs-string">0</span></span>] #define ValSvet2 BoolVal[<span class="hljs-string"><span class="hljs-string">1</span></span>] #define ValSvet3 BoolVal[<span class="hljs-string"><span class="hljs-string">2</span></span>] #define ValRozetka1 BoolVal[<span class="hljs-string"><span class="hljs-string">3</span></span>] #define ValRozetka2 BoolVal[<span class="hljs-string"><span class="hljs-string">4</span></span>] #define ValRozetka3 BoolVal[<span class="hljs-string"><span class="hljs-string">5</span></span>] #define ValClapan1 BoolVal[<span class="hljs-string"><span class="hljs-string">6</span></span>] #define ValClapan2 BoolVal[<span class="hljs-string"><span class="hljs-string">7</span></span>] #define ValClapan3 BoolVal[<span class="hljs-string"><span class="hljs-string">8</span></span>] // struct STRUCT<span class="hljs-emphasis"><span class="hljs-emphasis">_KEY{ bool StateCur; //   bool StateOld; //     bool Imp; //   (  0  1) }; // STRUCT_</span></span>KEY Key[<span class="hljs-string"><span class="hljs-string">5</span></span>]={0,0,0, 0,0,0, 0,0,0, 0,0,0, 0,0,0 }; //--- /<span class="hljs-emphasis"><span class="hljs-emphasis">*   *</span></span>  , : <span class="hljs-bullet"><span class="hljs-bullet">* '#A1' bool ,  *</span></span> '#'-   bool, <span class="hljs-bullet"><span class="hljs-bullet">* 'A'- (HEX)    BoolVal, *</span></span> '1'-    <span class="hljs-bullet"><span class="hljs-bullet">*   ,       *</span></span>/ String StrNull=" "; //  String StrRoot1="COMP-MAN.INFO"; String StrRoot2="PLC-BLOG.COM.UA"; String StrSvet= ""; // String StrSvet1=" 1 #01"; String StrSvet2=" 2 #10"; String StrSvet3=" 3 #21"; String StrRozetka=""; // String StrRozetka1=" 1 #30"; String StrRozetka2=" 2 #40"; String StrRozetka3=" 3 #50"; String StrClapan=""; // String StrClapan1=" 1 #60"; // String StrClapan2=" 2 #70"; String StrClapan3=" 3 #80"; struct MENU<span class="hljs-emphasis"><span class="hljs-emphasis">_ITEM // (),   2        { byte KeyUp; //‚Ññ  ,     "" byte KeyDwn; //‚Ññ  ,     "" byte KeyCancel; //‚Ññ  ,     ""(cancel) byte KeyEnter; //‚Ññ  ,     ""(enter) byte KeyEdit; // "edit",  String *pstr1; //    () String *pstr2; //    () }; // MENU_</span></span>ITEM Menu[<span class="hljs-string"></span><span class="hljs-string"></span>]={0,0,0,1,0, &amp;StrRoot1,&amp;StrRoot2, //0   1,8,0,2,0, &amp;StrSvet,&amp;StrRozetka, //1  2,3,1,2,0, &amp;StrSvet1,&amp;StrSvet2, //2 2,4,1,3,0, &amp;StrSvet2,&amp;StrSvet3, //3 3,4,1,4,0, &amp;StrSvet3,&amp;StrNull, //4 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //5  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //6 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //7 1,15,0,9,0, &amp;StrRozetka,&amp;StrClapan, //8  9,10,8,9,0, &amp;StrRozetka1, &amp;StrRozetka2, //9 9,11,8,10,0, &amp;StrRozetka2, &amp;StrRozetka3, //10 10,11,8,11,0, &amp;StrRozetka3, &amp;StrNull, //11 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //12  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //13 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //14 8,15,0,16,0, &amp;StrClapan, &amp;StrNull, //15  16,17,15,0,0, &amp;StrClapan1,&amp;StrClapan2, //16 16,18,15,0,0, &amp;StrClapan2,&amp;StrClapan3, //17 17,18,15,0,0, &amp;StrClapan3,&amp;StrNull, //18 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //19  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //20 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //21 }; byte PosMenu=0; //  LiquidCrystal<span class="hljs-emphasis"><span class="hljs-emphasis">_I2C lcd(ADDR_</span></span>LCD,16,2); //   //   void ReadKey(byte dio<span class="hljs-emphasis"><span class="hljs-emphasis">_in) { //      byte mask=1; for(i=0; i&lt;5; i++) { Key[i].StateCur=!(dio_</span></span>in &amp; mask); mask=mask<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">!Key[i].StateOld</span></span></span></span><span class="xml"><span class="hljs-tag"> &amp; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.StateCur</span></span></span></span><span class="xml"><span class="hljs-tag">; //   (  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.StateOld</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">Key[i].StateCur;</span></span></span></span><span class="xml"><span class="hljs-tag"> } } /* *  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">UTF-8</span></span></span></span><span class="xml"><span class="hljs-tag">   ( )   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">LCD</span></span></span></span><span class="xml"><span class="hljs-tag"> *       */ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">MasRus</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">33</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2</span></span></span></span><span class="xml"><span class="hljs-tag">]= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">144</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x41</span></span></span></span><span class="xml"><span class="hljs-tag">, // </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">145</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">146</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x42</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">147</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa1</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">148</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">149</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x45</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">129</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa2</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">150</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa3</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">151</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa4</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">152</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa5</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">153</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa6</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">154</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4b</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">155</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa7</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">156</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4d</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">157</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x48</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">158</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4f</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">159</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa8</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">160</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x50</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">161</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x43</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">162</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x54</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">163</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa9</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">164</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xaa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">165</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x58</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">166</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe1</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">167</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xab</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">168</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xac</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">169</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe2</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">170</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xad</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">171</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xae</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">172</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xc4</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">173</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xaf</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">174</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xb0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">175</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xb1</span></span></span></span><span class="xml"><span class="hljs-tag"> // }; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">RusStrLCD</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrIn</span></span></span></span><span class="xml"><span class="hljs-tag">) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">l</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.length();</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">l</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.charAt(i);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">128</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrOut+char(b1);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">else</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">208)</span></span></span></span><span class="xml"><span class="hljs-tag"> //==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">208,</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2-</span></span></span></span><span class="xml"><span class="hljs-tag">  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.</span></span></span></span><span class="xml"><span class="hljs-tag">  { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.charAt(i+1);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">33</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">++) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">MasRus</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">]==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">b1)</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrOut+char(MasRus[y][1]);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">break</span></span></span></span><span class="xml"><span class="hljs-tag">; } } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++; } } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">return</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">; } //</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">---------------------------</span></span></span></span><span class="xml"><span class="hljs-tag"> //</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ASCII</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">HEX</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">---</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> dec byte StrHexToByte(char val) { byte dec=0; switch (val) { case '0': dec=0; break; case '1': dec=1; break; case '2': dec=2; break; case '3': dec=3; break; case '4': dec=4; break; case '5': dec=5; break; case '6': dec=6; break; case '7': dec=7; break; case '8': dec=8; break; case '9': dec=9; break; case 'A': dec=10; break; case 'B': dec=11; break; case 'C': dec=12; break; case 'D': dec=13; break; case 'E': dec=14; break; case 'F': dec=15; break; default: dec=0; break; } return dec; } //     void WriteLCD(byte num) { String str[]={"<span class="hljs-emphasis"><span class="hljs-emphasis">*"+*</span></span>Menu[num].pstr1,<span class="hljs-emphasis"><span class="hljs-emphasis">*Menu[num].pstr2}; if (num==0 &amp;&amp; POINT_ON_ROOT_MENU_ITEM==0) //     ? str[0].setCharAt(0,' '); // ,   //     byte NumVal; byte l; for(byte y=0; y&lt;2; y++) { l=str[y].length(); for(i=0; i&lt;l; i++) { if (str[y].charAt(i)=='#') //# bool,  off/ON { if(StrHexToByte(str[y].charAt(i+2))==1 &amp;&amp; y==0) //  ? str[y].setCharAt(0,'+'); NumVal=StrHexToByte(str[y].charAt(i+1)); str[y]=str[y].substring(0,i)+String(NumVal) ; if(BoolVal[NumVal]==0) str[y]=str[y].substring(0,i)+"off" ; if(BoolVal[NumVal]==1) str[y]=str[y].substring(0,i)+"ON" ; } if (str[y].charAt(i)=='$') //$ int,     ,      { ; } if (str[y].charAt(i)=='~') //~ ,     ,      { ; } } } //--- lcd.clear(); lcd.setCursor(0, 0); lcd.print(str[0]); lcd.setCursor(1, 1); lcd.print(str[1]); } //,       byte GoMenu(byte key) { byte PosMenuNew=PosMenu; switch (key) { case 0: PosMenuNew=Menu[PosMenu].KeyUp; break; case 1: PosMenuNew=Menu[PosMenu].KeyDwn; break; case 2: PosMenuNew=Menu[PosMenu].KeyCancel; break; case 3: PosMenuNew=Menu[PosMenu].KeyEnter; break; case 4: ; break; default: break; } return PosMenuNew; } //    "Edit" void Edit(byte posmenu) { byte NumVal; bool *</span></span>pval; String str=<span class="hljs-emphasis"><span class="hljs-emphasis">*Menu[posmenu].pstr1; byte l=str.length(); for(i=0; i&lt;l; i++) if (str.charAt(i)=='#') //#- bool,  off/ON { if(StrHexToByte(str.charAt(i+2))==1) //  ? { pval= &amp;(BoolVal[StrHexToByte(str.charAt(i+1))]); // ,    .   *</span></span>pval=!(*pval); //     } } } //     void ValToPort() { digitalWrite(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D2,ValSvet1); digitalWrite(PORT_</span></span>D3,ValSvet2); digitalWrite(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D4,ValSvet3); } void setup() { pinMode(led, OUTPUT); //     pinMode(PORT_</span></span>D2, OUTPUT); pinMode(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D3, OUTPUT); pinMode(PORT_</span></span>D4, OUTPUT); //    LCD StrSvet=RusStrLCD(StrSvet); StrSvet1=RusStrLCD(StrSvet1); StrSvet2=RusStrLCD(StrSvet2); StrSvet3=RusStrLCD(StrSvet3); StrRozetka=RusStrLCD(StrRozetka); StrRozetka1=RusStrLCD(StrRozetka1); StrRozetka2=RusStrLCD(StrRozetka2); StrRozetka3=RusStrLCD(StrRozetka3); StrClapan=RusStrLCD(StrClapan); StrClapan1=RusStrLCD(StrClapan1); StrClapan2=RusStrLCD(StrClapan2); StrClapan3=RusStrLCD(StrClapan3); // lcd.init(); lcd.backlight();//    WriteLCD(PosMenu); Wire.begin(); Wire.beginTransmission(ADDR<span class="hljs-emphasis"><span class="hljs-emphasis">_KBRD); Wire.write(B11111111); //   PCF8574P     Wire.endTransmission(); } void loop() { Wire.requestFrom(ADDR_</span></span>KBRD,1); while (!Wire.available()); byte dio<span class="hljs-emphasis"><span class="hljs-emphasis">_in = Wire.read(); //   PCF8574P() ReadKey(dio_</span></span>in); //   //,    ;  ,      int KeyImp=-1; for (i=0; i<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">5;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1)</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">KeyImp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">i;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">KeyImp</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>-1) //  ? { if (KeyImp==4) // "Edit" Edit(PosMenu); PosMenu=GoMenu((KeyImp)); WriteLCD(PosMenu); } b=!b; digitalWrite(led, b); //    ValToPort(); //  delay(50); }</code> </pre><br></div></div><br><h4>  <b>LCD 1602 und Sprachproblem</b> </h4><br>  Unabh√§ngig davon muss das Problem der Russifizierung angesprochen werden. <br><br>  Im Zeichengenerator einiger LCD 1602 gibt es keine russischen Buchstaben, und stattdessen werden japanische Krakozyabry gestickt.  Es ist unm√∂glich, den Zeichengenerator erneut zu starten.  Daher m√ºssen Sie entweder W√∂rter in lateinischen Buchstaben auf den Bildschirm schreiben oder im Programm, um die russischen Buchstaben selbst zu bilden, weil  Das LCD 1602 bietet die M√∂glichkeit, eigene Zeichen im RAM-RAM zu erstellen und zu speichern.  Im letzteren Fall k√∂nnen Sie jedoch nicht mehr als acht "hausgemachte" Zeichen gleichzeitig auf dem Bildschirm anzeigen. <br><br><div class="spoiler">  <b class="spoiler_title">Zeichentabellen LCD 1602</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/91b/eed/92f/91beed92f6f0487f922c3f9834ae9a8f.png"><br><br><img src="https://habrastorage.org/files/ecf/799/4a5/ecf7994a50584faba9805df1550d6157.png"><br></div></div><br>  Grunds√§tzlich ist es in Ordnung, russische W√∂rter auf Englisch auf dem LCD zu schreiben.  Dort war selbst die ehrw√ºrdige franz√∂sische Firma Shneider Electric (die bereits vor der Revolution Haubitzen an den Zaren verkaufte) anderthalb Jahrzehnte lang nicht in der Lage, Russisch in ihre ber√ºhmten programmierbaren Relais Zelio einzuf√ºhren.  Dies hindert sie jedoch nicht daran, aktiv mit der Weite der gesamten GUS zu handeln.  Dar√ºber hinaus wurden Kan√§le, Spanisch und Portugiesisch eingef√ºhrt. <br><br>  In vielen unserer Fabriken kommunizieren diese Zelio mit Mitarbeitern mit Redewendungen wie ‚ÄûNASOS 1 VKL‚Äú. <br><br>  Wenn nicht klar ist, ob ein bestimmtes LCD russische Buchstaben enth√§lt, m√ºssen Sie alle Zeichen des Zeichengenerators auf dem Bildschirm anzeigen.  Wenn es Kyrillisch gibt, beginnt es an Position 160. <br><br><div class="spoiler">  <b class="spoiler_title">Skizze 4, in der alle Zeichen aus der Tabelle des LCD 1602-Zeichengenerators angezeigt werden</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/*   LCD     * LCD    i2c */</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;LiquidCrystal_I2C.h&gt; LiquidCrystal_I2C lcd(<span class="hljs-number"><span class="hljs-number">0x27</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); //   <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { // put your setup code here, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> run once: lcd.init(); lcd.clear(); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { <span class="hljs-type"><span class="hljs-type">int</span></span> i,y; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>; i++) { lcd.clear(); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.print(String(i*<span class="hljs-number"><span class="hljs-number">16</span></span>)+" - "+String(i*<span class="hljs-number"><span class="hljs-number">16</span></span>+<span class="hljs-number"><span class="hljs-number">15</span></span>)); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(y=<span class="hljs-number"><span class="hljs-number">0</span></span>;y&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>;y++) lcd.print(<span class="hljs-type"><span class="hljs-type">char</span></span>(i*<span class="hljs-number"><span class="hljs-number">16</span></span>+y)); delay(<span class="hljs-number"><span class="hljs-number">3000</span></span>); } } }</code> </pre><br></div></div><br>  Aber selbst wenn Ihr LCD 1602 russifiziert ist, ist die Anzeige russischer W√∂rter nicht so einfach.  Verwenden Sie zumindest die LiquidCrystal_I2C.h-Bibliothek, wenn Sie mit LCD am i2c-Bus arbeiten. <br><br>  Wenn Sie den russischen Text beispielsweise einfach mit der Anweisung lcd.print (‚ÄûHallo !!!‚Äú) ausgeben, dann anstelle von ‚ÄûHallo !!!‚Äú  Auf dem Bildschirm erscheint etwas M√ºll. <br><br>  Dies liegt daran, dass die Arduino-IDE russische Buchstaben in Zwei-Byte-UTF-8-Code √ºbersetzt und im LCD alle Zeichen Einzelbyte sind. <br><br>  Das gleiche Problem tritt √ºbrigens beim √úbertragen russischer Texte von Arduino auf den Arduino IDE-Portmonitor auf.  Arduino sendet russische Buchstaben in der UTF-8-Doppelbyte-Codierung an die serielle Schnittstelle, und der Arduino IDE-Port-Monitor versucht, sie in der Einzelbyte-Windows-1251-Codierung (cp1251) zu lesen.  Obwohl cp1251 wie die LCD 1602-Codierung ebenfalls 8-Bit ist, stimmt es nicht mit dieser √ºberein. <br><br>  Sie k√∂nnen russische Texte durch Zeichencodes bilden.  Beispielsweise wird die Zeile "LCD-Anzeige" auf einem russifizierten LCD wie folgt angezeigt: <br><br><pre> <code class="hljs swift">lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\243K \343\270c\276\273e\271"</span></span>);</code> </pre> <br>  Aber ich mag diesen Ansatz nicht. <br><br>  Um russischen Text korrekt auf dem russifizierten LCD 1602 anzuzeigen, wurden mehrere Bibliotheken f√ºr Arduino erfunden.  Aber nachdem ich die Bewertungen gelesen hatte, sah ich, dass sich viele √ºber St√∂rungen bei der Verwendung beschwerten. <br><br>  Daher habe ich in meinem mehrstufigen Men√ºprogramm selbst eine einfache Funktion zum Konvertieren von UTF-8 in LCD-Codes geschrieben.  Es stimmt, ich habe es nur f√ºr russische Gro√übuchstaben gemacht, was perfekt zu mir passt. <br><br><div class="spoiler">  <b class="spoiler_title">Funktion zum Konvertieren von russischen UTF-8-Gro√übuchstaben in Einzelbyte-LCD 1602-Code</b> <div class="spoiler_text"><pre> <code class="hljs powershell">/* *  UTF<span class="hljs-literal"><span class="hljs-literal">-8</span></span>   ( )   LCD *       */ byte MasRus[<span class="hljs-number"><span class="hljs-number">33</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>]= { <span class="hljs-number"><span class="hljs-number">144</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x41, // <span class="hljs-number"><span class="hljs-number">145</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa0, <span class="hljs-number"><span class="hljs-number">146</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x42, <span class="hljs-number"><span class="hljs-number">147</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa1, <span class="hljs-number"><span class="hljs-number">148</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xe0, <span class="hljs-number"><span class="hljs-number">149</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x45, <span class="hljs-number"><span class="hljs-number">129</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa2, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa3, <span class="hljs-number"><span class="hljs-number">151</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa4, <span class="hljs-number"><span class="hljs-number">152</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa5, <span class="hljs-number"><span class="hljs-number">153</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa6, <span class="hljs-number"><span class="hljs-number">154</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x4b, <span class="hljs-number"><span class="hljs-number">155</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa7, <span class="hljs-number"><span class="hljs-number">156</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x4d, <span class="hljs-number"><span class="hljs-number">157</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x48, <span class="hljs-number"><span class="hljs-number">158</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x4f, <span class="hljs-number"><span class="hljs-number">159</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa8, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x50, <span class="hljs-number"><span class="hljs-number">161</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x43, <span class="hljs-number"><span class="hljs-number">162</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x54, <span class="hljs-number"><span class="hljs-number">163</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa9, <span class="hljs-number"><span class="hljs-number">164</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xaa, <span class="hljs-number"><span class="hljs-number">165</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x58, <span class="hljs-number"><span class="hljs-number">166</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xe1, <span class="hljs-number"><span class="hljs-number">167</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xab, <span class="hljs-number"><span class="hljs-number">168</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xac, <span class="hljs-number"><span class="hljs-number">169</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xe2, <span class="hljs-number"><span class="hljs-number">170</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xad, <span class="hljs-number"><span class="hljs-number">171</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xae, <span class="hljs-number"><span class="hljs-number">172</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xc4, <span class="hljs-number"><span class="hljs-number">173</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xaf, <span class="hljs-number"><span class="hljs-number">174</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xb0, <span class="hljs-number"><span class="hljs-number">175</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xb1 // }; String RusStrLCD(String StrIn) { String StrOut=<span class="hljs-string"><span class="hljs-string">""</span></span>; byte b1; byte y; byte l=StrIn.length(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(byte i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;l; i++) { b1=StrIn.charAt(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b1&lt;<span class="hljs-number"><span class="hljs-number">128</span></span>) StrOut=StrOut+char(b1); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b1==<span class="hljs-number"><span class="hljs-number">208</span></span>) //==<span class="hljs-number"><span class="hljs-number">208</span></span>,     <span class="hljs-number"><span class="hljs-number">2</span></span>-  .  { b1=StrIn.charAt(i+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(y=<span class="hljs-number"><span class="hljs-number">0</span></span>; y&lt;<span class="hljs-number"><span class="hljs-number">33</span></span>; y++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(MasRus[<span class="hljs-type"><span class="hljs-type">y</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]==b1) { StrOut=StrOut+char(MasRus[<span class="hljs-type"><span class="hljs-type">y</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } i++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StrOut; }</code> </pre><br></div></div><br>  Das ist alles f√ºr das hausgemachte HMI mit dem i2c-Bus. <br><br>  Oh ja, am Anfang des Artikels schrieb ich, dass ich HMI nicht ganz f√ºr Arduino mache, sondern f√ºr Arduino-kompatible Ger√§te.  Hier geht es um die SPS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CONTROLLINO MAXI</a> , die von der Arduino IDE (und vielen anderen) programmiert wird. <br><br><img src="https://habrastorage.org/files/e62/97f/16b/e6297f16bfa84a449fe1d34f629ed061.jpg"><br><br>  CONTROLLINO MAXI ist eigentlich Arduino + eine Reihe von Abschirmungen und alles ist als industrielle SPS konzipiert.  Aber √ºber ihn beim n√§chsten Mal. <br><br>  <b>Referenzen</b> <br><br>  ‚Üí <a href="">Archiv</a> mit Diagrammen, Skizzen und einer Leiterplatte im Lay6-Format <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Arduino-kompatible SPS CONTROLLINO</a> , deren Arbeit die Entwicklung des HMI i2c inspirierte <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PCF8574 Port Expander</a> und Anschluss an Arduino <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FC-113-</a> Karte f√ºr den Betrieb des LCD 1602 √ºber den i2c-Bus und dessen Verbindung zu Arduino <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mehrstufiges Baummen√º</a> , allgemeine Prinzipien der Erstellung in C. <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">UTF-8 codieren</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Windows-1251 codieren</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de401587/">https://habr.com/ru/post/de401587/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de401567/index.html">Chrome Sandbox verletzt drei Patente, Google zahlt Lizenzgeb√ºhren</a></li>
<li><a href="../de401569/index.html">Top 10 Gadgets mit CES 2017, die uns beeindruckt haben</a></li>
<li><a href="../de401573/index.html">Freiberuflich t√§tig. Vier Erfolgsgeschichten: Verlassen des B√ºros und Leben gesponnen</a></li>
<li><a href="../de401577/index.html">Inoffizielle Benchmarks und Preise f√ºr Ryzen-Prozessoren</a></li>
<li><a href="../de401583/index.html">Warum war ich sch√§dlich? Weil ich keine SSD hatte! Ist es sinnvoll, ein Solid-State-Laufwerk in einen alten Computer einzubauen?</a></li>
<li><a href="../de401591/index.html">Was ist ein Planet?</a></li>
<li><a href="../de401593/index.html">–ê–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç: –†–µ–º–æ–Ω—Ç, —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∏ –Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</a></li>
<li><a href="../de401595/index.html">Physiker haben gelernt, die Schrauben mit einem Magnetfeld festzuziehen</a></li>
<li><a href="../de401597/index.html">Unternehmen praktizieren Methoden zur √úberwachung am Arbeitsplatz</a></li>
<li><a href="../de401599/index.html">–ö–∞–∫ –Ω–∞–π—Ç–∏ —Ä–∞–±–æ—Ç—É –ø–æ –ª—é–±–∏–º–æ–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>