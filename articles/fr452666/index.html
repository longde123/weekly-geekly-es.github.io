<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😾 🐲 ⛽️ Comment effectuer des micro-paiements possibles dans votre application 🐼 👨🏼‍🚀 👩🏾‍🏫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette semaine, j'ai passé à coder ma toute première application publique pour animaux de compagnie basée sur le bot de chat Telegram qui agit comme un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment effectuer des micro-paiements possibles dans votre application</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452666/"><p>  Cette semaine, j'ai passé à coder ma toute première application publique pour animaux de compagnie basée sur le bot de chat Telegram qui agit comme un portefeuille Bitcoin et permet d'envoyer et de recevoir des conseils entre les utilisateurs de Telegram et d'autres soi-disant «applications Lightning».  Je suppose que vous êtes familier avec Bitcoin &amp; Telegram en général, je vais essayer de poster court et sans sauter dans les détails.  Plus de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ressources sur Bitcoin peuvent être trouvées ici</a> et Telegram est simplement un messager instantané qui vous permet de créer vos applications personnalisées (chat-bots) en utilisant leur plate-forme. </p><br><h3>  Quels sont les points clés d'une telle application? </h3><br><ul><li>  Permet d'évaluer les idées et les réponses des autres utilisateurs avec une valeur réelle au lieu de <br>  «j'aime virtuel».  Cela amène la conversation en ligne à un tout nouveau niveau </li><li>  Exemple réel d'application de micro-paiement qui peut fonctionner avec d'autres entités <br>  sur Internet en utilisant un protocole ouvert </li><li>  Tous les modules sont des projets open source et peuvent être facilement réutilisés et ajustés <br>  pour votre propre projet.  L'application ne relaie pas les services commerciaux tiers. <br>  Même si elle relève du domaine du commerce électronique, qui est actuellement presque fermé, l'application <br>  est basé sur des solutions ouvertes. </li></ul><br><h3>  Quels sont les cas d'utilisation? </h3><br><p>  quelque chose comme ça ... <br></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/097/02b/175/09702b1750c94616a10fc66c1275c00f.png" alt="image"></div><a name="habracut"></a><br>  ou comme ça .. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ef/1ff/85f/3ef1ff85f1e7b77662c63a9d4d838666.png" alt="image"></div><br><p>  Que signifient les chiffres?  Ce sont des <b>unités bitcoin - satoshis</b> .  À la mi-2019, 1000 satoshis ont une valeur de 0,06 $.  Vous pouvez le dépenser en ligne ou échanger dans votre devise locale en utilisant de nombreux services disponibles.  Ce n'est donc pas juste un autre <i>"numéro dans une base de données"</i> ou un <i>"coupons que vous pouvez dépenser dans notre boutique partenaire"</i> , mais un <b>véritable argent sur Internet</b> . </p><br><p>  Vous pouvez demander quoi faire si vous n'avez pas de bitcoin à utiliser dans l'application.  Vous pouvez simplement recevoir un pourboire de l'utilisateur de l'application existante ou acheter une petite quantité de bitcoin sur divers échanges ou portefeuilles bitcoin pour téléphone mobile ou PC. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/883/661/461/883661461bdc686aec7d084d5d581236.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/779/716/5d9/7797165d93d292700d9a41a171d882a6.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="image"></p><br><p>  Lorsque vous avez obtenu un bitcoin, vous pouvez démarrer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@atomic_tipbot</a> et effectuer un / dépôt. </p><br><p>  Vous verrez une facture, vous pouvez sélectionner le mode de paiement préféré et envoyer de l'argent simplement en scannant le code QR ou en appuyant sur le bouton ( <i>"ouvrir dans le portefeuille"</i> ) sur la facture. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/4a3/da5/f76/4a3da5f76574ac9ebb2161d56bceff62.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/54d/a43/0be/54da430be68237193dee82ade50bab37.png" alt="image"></p><br><p>  Confirmez le paiement dans votre portefeuille mobile et vous verrez un écran de confirmation presque instantanément dans Telegram. </p><br><p>  Jusqu'à présent, nous avons touché deux parties distinctes de l'application: le back-end du télégramme et le système de traitement des paiements (en fait, plus comme son front-end). </p><br><p>  Pour créer ce bot Telegram, j'ai utilisé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Python Telegram Bot</a> .  Et bien sûr, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bot est open-source</a> . </p><br><p>  En tant que système de traitement des paiements pour générer des factures, vérifier l'état, envoyer une notification et prendre soin de l'UX, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BTCPayServer</a> est utilisé, dont la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation peut être trouvée ici</a> . </p><br><p>  Si vous cherchez à traiter directement les événements de paiement, vous pouvez consulter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les pages de manuel Electrum CLI</a> pour les paiements en chaîne et découvrir des solutions pour les paiements hors chaîne (Lightning) comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lightning-charge</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sparko</a> . </p><br><h3>  Vous avez dit «pas de tiers» et «pas de services cloud»!? </h3><br><p>  Oui, c'est vrai.  Dans mon application, j'utilise l'hébergement partagé gratuit de l'instance BTCPayServer - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BTCPayJungle</a> , mais il est possible de tourner même sur votre propre serveur dédié.  N'oubliez pas que vous avez alors besoin d'environ ~ 500 Go d'espace pour stocker la blockchain Bitcoin et Litecoin.  BTCPayServer ne détient aucune clé privée ni information sensible pouvant permettre aux pirates de contrôler les fonds sur votre portefeuille.  Pour les paiements en chaîne (standard), vous devez fournir la clé xpub de votre portefeuille à BTCPayServer afin qu'il puisse générer des adresses publiques.  De cette façon, l'architecture BTCPay permet de traiter les paiements en toute confiance même sur un environnement partagé.  Il est très simple à configurer si vous utilisez des portefeuilles éprouvés comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Electrum</a> . </p><br><h3>  Qu'est-ce que Lightning Network? </h3><br><p>  C'est quelque chose comme un add-on à Bitcoin qui ajoute une couche d'abstraction supplémentaire et permet de faire des transactions Bitcoin instantanées et presque gratuites.  Tout cela est possible grâce à la magie cryptographique multi-signatures, souvent appelée <em>smart-contract</em> .  Il existe plusieurs implémentations du protocole LN.  J'utilise l'implémentation C <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">-Lightning</a> C. </p><br><p>  La principale différence entre les paiements en chaîne et hors chaîne (Lightning) réside dans la façon dont les transactions sont stockées.  Toutes <b>les</b> transactions en <b>chaîne</b> sont diffusées sur l'ensemble du réseau afin que chaque nœud Bitcoin en cours enregistre cette transaction dans la chaîne de blocs, si le bloc contenant cette transaction est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">miné</a> .  Hé, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">BitFury</a> , ai-je raison?  ;) C'est pourquoi nous appelons de telles transactions <b>en chaîne</b> .  Ces transactions seront stockées dans la blockchain jusqu'à la fin de son existence.  Il est possible de suivre, d'analyser et de surveiller publiquement une telle transaction sur le réseau. </p><br><p>  En cas de transaction <b>hors chaîne</b> (Lightning), les choses se passent d'une autre manière.  Chaque nœud Lightning a <i>(peut être plusieurs)</i> une adresse en chaîne, à partir de laquelle tout commence.  Lorsque des fonds sont reçus sur une telle adresse, l'utilisation d'un nœud de techniques de cryptographie peut ouvrir ce qu'on appelle un <i>canal de foudre</i> vers un autre nœud, ce qui signifie que ces deux nœuds se sont mis d'accord sur la disponibilité des fonds entre eux.  Plus tard, toutes les transactions effectuées via le canal (propres transactions, ou il peut être acheminé par un autre nœud) sont stockées uniquement sur ces deux nœuds (et nœud intermédiaire s'il y en avait).  Les seules transactions qui sont stockées dans la blockchain des réseaux sont les transactions d'ouverture et de fermeture de canaux.  C'est pourquoi les transactions Lightning que nous appelons <b>hors chaîne</b> .  Généralement, ils n'existent que dans le fichier de base de données de nœuds. </p><br><h3>  Le tout est visualisé sur le diagramme </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/3c6/636/b8c/3c6636b8c98d52aab9bd09ff9c52afcb.png" alt="image"><br><p>  Petite histoire: </p><br><p>  1) L'utilisateur envoie un message et demande un dépôt au bot sur <b>Telegram</b> </p><br><p>  2) Telegram déclenche l' <b>application python</b> du bot </p><br><p>  3) L' <b>application Python</b> envoie une demande à <b>BTCPayServer</b> </p><br><p>  4) BTCPayServer génère des adresses entrantes pour BTC et LTC, ainsi que pour contacter <b>Lightning-Charge</b> , qui obtient les données du démon <b>C-Lightning</b> .  En conséquence, nous obtenons un cadre HTML bien géré pour le traitement des paiements </p><br><p>  5) L'utilisateur paie la facture et verra la confirmation </p><br><p>  6) <b>BTCPayServer</b> envoie une <i>notification de paiement de</i> <b>facture</b> (IPN) à l'URL de rappel spécifiée, dans notre cas, il <br>  ira à <b>callbacks.py</b> (une autre application python pour écouter les rappels) </p><br><p>  7) Selon le détail complet du paiement, le solde de l'utilisateur est modifié et l'utilisateur reçoit une notification </p><br><p>  <i>... si l'utilisateur décide de retirer des fonds (pourboires qu'il a reçus) ...</i> </p><br><p>  8) <b>L'application python de Bot</b> écoute le texte ou l'image de QR, lorsqu'elle obtient des données de facturation (longue chaîne de caractères) puis envoie une demande de paiement de cette facture à une autre application python <b>paylightning.py *</b> , qui initialise les paiements à l'aide de c-lightning RPC </p><br><img src="https://habrastorage.org/getpro/habr/post_images/518/3dc/c81/5183dcc817817f1aa676ff74d17d08bb.png" alt="image"><br><p>  <i>* Pour être honnête, je dois mentionner que mon paylight wrapper paylightning.py est incomplet et peut retourner un faux négatif dans certains cas spécifiques.</i>  <i>Vous devez utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un emballage de paiement bien testé pour c-lightning</a> en cas d'utilisation similaire à la production.</i> </p><br><p>  Les utilisateurs peuvent s’envoyer des conseils lors de discussions de groupe et envoyer / recevoir de la <b>valeur</b> sans aucune limite.  Mais ce n'est pas tout.  Grâce au protocole Lightning Network, qui est dans une sorte de réseau de paiement unifié et simplifié, vous pouvez envoyer les mêmes pièces de solde à des applications complètement différentes.  Il existe un autre tip-bot bitcoin sur le télégramme - @lntxbot.  L'utilisateur peut demander un dépôt à ce bot </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f09/c3a/ef9/f09c3aef995f7a82560987646b0d8ee0.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/344/82c/1e234482c56aa0df1d4b341ecfe3beb8.png" alt="image"></p><br><p>  Transférez simplement les données de @lntxbot à @atomic_tipbot et voul'a! </p><br><p>  Ce n'est plus un «échange de numéro dans la base de données» mais un paiement entre deux «bases de données» distinctes et non liées.  Bot a déjà quelques «LApps» intégrés: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sat2.io</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lnsms.world</a> . </p><br><p>  <b>Vous pouvez vous demander ce que signifie exactement l' <i>intégration LApp</i> ?</b> </p><br><p>  Chaque nœud du <i>réseau Lightning</i> agit comme un portefeuille Bitcoin.  Il a à la fois un équilibre en chaîne et hors chaîne.  Le solde en chaîne est généralement utilisé pour ouvrir des canaux et stocker des fonds à partir de canaux fermés, dans des tâches de maintenance de nœuds courts.  Le solde hors chaîne est exactement ce qui est utilisé pour échanger des fonds entre les nœuds.  Les fonctions principales de chaque nœud sont la capacité d'envoyer ou de recevoir des fonds, de sorte que le nœud en tant que logiciel fournit des méthodes de <i><b>paiement</b></i> et de <i><b>facturation</b></i> .  Je vais vous montrer brièvement comment cela se passe: </p><br><pre><code class="bash hljs">user@ln-node:/ % lightning-cli invoice 1000000000 internal_description external_description { <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span> : 1558709834, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6"</span></span> }</code> </pre> <br><p>  La <a href="">facture BOLT11</a> est générée dans ce cas, qui est un format unifié pour les demandes de paiement dans le réseau Bitcoin (ainsi que Litecoin).  Cette chaîne comprend des données sur le destinataire de la facture, le montant, l'horodatage, l'expiration, etc.  Pour décoder cette chaîne, c-lightning fournit une méthode de décodage: </p><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> éclair cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> </pre> <br><p>  Dans le cas où nous devons payer une facture, nous devons utiliser la méthode de paiement de c-lightning: </p><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> éclair cli lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j salariale <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> </pre> <br><p>  Tous les statuts des paiements sont gérés par l'ensemble du réseau et votre propre nœud.  Vous n'avez pas besoin (mais avez la possibilité de le faire) de communiquer avec les développeurs d'applications côté réception ou leur API, un fournisseur de traitement de cartes ou toute banque pour obtenir une confirmation de votre paiement ou pour libérer des fonds de votre propre compte.  Il n'y a pas de refacturation ni aucune autre influence externe sur le solde de vos comptes.  Tout ce dont vous avez besoin est un logiciel qui agit selon des règles de réseau décentralisées.  Il s'agit d'une solution pour échanger une valeur sur Internet, sans avoir besoin d'arbitre au milieu qui décide de la compatibilité de votre paiement avec certaines règles, parfois même inconnues de toutes les parties.  Il n'y a pas de règles "internes" dans le bitcoin, toutes les règles que votre application doit remplir sont ouvertes et connues. </p><br><p>  Cela permet <b>un</b> échange de valeur <b>direct</b> , <b>presque gratuit</b> et <b>instantané</b> sur Internet entre les personnes ou même le logiciel lui-même de manière vraiment autonome. </p><br><p>  S'il existe un moyen d'obtenir des données de paiement à partir d'une autre application, vous pouvez agir avec cela sur le plan financier.  Comme dans notre exemple, lnsms.world est une application Web qui vous permet d'envoyer des SMS à n'importe quel numéro et de le payer avec Bitcoin.  Pour intégrer une telle option dans notre application, nous devons simplement transmettre les données requises du formulaire Web à lnsms.world: </p><br><pre> <code class="python hljs">payload = { <span class="hljs-string"><span class="hljs-string">'number'</span></span>: phone_number, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: text, <span class="hljs-string"><span class="hljs-string">'force_unicode'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } send_req = requests.post(<span class="hljs-string"><span class="hljs-string">'https://lnsms.world/invoice'</span></span>, data=payload) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> send_req.status_code == <span class="hljs-number"><span class="hljs-number">201</span></span>: plain_invoice = str(send_req.text)</code> </pre> <br><p>  Je ne sais pas pour quelle raison, mais lnsms répond avec 201 code de statut HTTP et renvoie la facture BOLT11.  Eh bien, cela suffit pour payer cette facture et nos utilisateurs enverront des sms peu de temps après la réception du paiement.  Nous pouvons facturer des frais supplémentaires ou non, c'est notre libre choix. </p><br><p>  Maintenant, imaginez que votre bot est en fait une application plus utile et ne paie pas un autre bot, mais une autre entité, connectée à Internet.  Ou bien, il peut s'agir de paiements entre logiciels, machines, magasins, prestataires de services sur une base régulière se répétant toutes les quelques secondes?  Ressentez-vous la puissance des micro-paiements?  Voilà à quoi ressemblera l'Internet des objets.  Déjà, il existe des projets tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://althea.org/</a> et dans un avenir proche, nous serons confrontés à de grands changements dans le domaine de ce que nous appelons le commerce électronique. </p><br><p>  Si vous aimez cet article et que vous essayez vous-même les paiements Bitcoin, vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">me laisser un conseil sur ma page de pourboire</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452666/">https://habr.com/ru/post/fr452666/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452648/index.html">PHP: Comment analyser un fichier XML complexe et ne pas se noyer dans le code natif</a></li>
<li><a href="../fr452652/index.html">Security Week 21: un trou dans Whatsapp, une nouvelle vulnérabilité dans les processeurs Intel, Zero-Day dans Windows</a></li>
<li><a href="../fr452656/index.html">Développement du «firmware» le plus simple pour les FPGA installés dans Redd, et débogage en utilisant le test de mémoire comme exemple</a></li>
<li><a href="../fr452662/index.html">Serveurs HPE à Selectel</a></li>
<li><a href="../fr452664/index.html">J'ai facturé 18 000 $ pour une page Web statique ... et je m'en suis sorti</a></li>
<li><a href="../fr452668/index.html">Comment vérifier la conformité des cookies au RGPD - un nouvel outil ouvert vous aidera</a></li>
<li><a href="../fr452670/index.html">Qui sont les ingénieurs de données et comment deviennent-ils?</a></li>
<li><a href="../fr452672/index.html">Habr hebdomadaire. Rencontrez la version pilote Habrapodcast</a></li>
<li><a href="../fr452674/index.html">Événements numériques à Moscou du 21 au 26 mai</a></li>
<li><a href="../fr452682/index.html">Prévisions et discussion: les systèmes de stockage hybrides céderont la place au 100% flash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>