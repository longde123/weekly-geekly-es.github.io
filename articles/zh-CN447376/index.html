<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤮 💆🏿 👫 SNA Hackathon 2019 🗽 🐭 ⚰️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在2019年2月至3月，举行了比赛以对SNA Hackathon 2019社交网络供稿进行排名，其中我们的团队获得了第一名。 在本文中，我将讨论比赛的组织，我们尝试的方法以及大数据培训的加速设置。 





 SNA Hackathon 


 这个名字下的黑客马拉松赛第三次举行。 它分别由ok....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SNA Hackathon 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447376/"><p> 在2019年2月至3月，举行了比赛以对<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SNA Hackathon 2019</a>社交网络供稿进行排名，其中我们的团队获得了第一名。 在本文中，我将讨论比赛的组织，我们尝试的方法以及大数据培训的加速设置。 </p><br><p><img src="https://habrastorage.org/webt/8b/bd/vv/8bbdvvg9ih5_0h5tdqmx4fho3io.jpeg"></p><a name="habracut"></a><br><p>  <strong>SNA Hackathon</strong> </p><br><p> 这个名字下的黑客马拉松赛第三次举行。 它分别由ok.ru社交网络组织，任务和数据直接与此社交网络相关。 <br> 在这种情况下，最好将SNA（社交网络分析）理解为不是对社交图的分析，而是对社交网络的分析。 </p><br><ul><li>  2014年的任务是预测该帖子将获得的喜欢人数。 </li><li> 在2016年，VVZ的目标（也许是您熟悉的）更加接近社会图的分析。 </li><li> 在2019年-按用户喜欢该帖子的可能性对用户的供稿进行排名。 </li></ul><br><p> 我不能说2014年，但是在2016年和2019年，除了具有分析数据的能力外，还需要处理大数据的技能。 我认为正是机器学习和大数据处理任务的结合才吸引了我参加这些竞赛，这些领域的经验也为我赢得了胜利。 </p><br><p>  <strong>mlbootcamp</strong> </p><br><p> 在2019年，比赛在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://mlbootcamp.ru</a>平台上组织。 </p><br><p> 比赛于2月7日在网上开始，共有3项任务。 每个人都可以在该网站上注册，下载<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">基线</a>并上载汽车几个小时。  3月15日，在线阶段结束时，每场演出的前15名都应邀到Mail.ru办公室参加离线阶段，该阶段于3月30日至4月1日举行。 </p><br><h1 id="zadacha"> 挑战赛 </h1><br><p> 源数据提供用户标识符（userId）和帖子标识符（objectId）。 如果向用户显示了一个帖子，则数据包含一行，其中包含userId，objectId，用户对此帖子的反应（反馈）以及一组各种符号或指向图片和文字的链接。 </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th>  ownerId </th><th> 意见回馈 </th><th> 图片 </th></tr></thead><tbody><tr><td>  3555 </td><td>  22 </td><td>  5677 </td><td>  [喜欢，点击] </td><td>  [hash1] </td></tr><tr><td>  12842 </td><td>  55 </td><td>  32144 </td><td>  [不喜欢] </td><td>  [hash2，hash3] </td></tr><tr><td>  13145 </td><td>  35 </td><td>  5677 </td><td>  [点击，转发] </td><td>  [hash2] </td></tr></tbody></table><br><p> 测试数据集包含类似的结构，但是缺少反馈字段。 目的是预测反馈字段中是否存在“喜欢的”反应。 <br> 提交文件具有以下结构： </p><br><table><thead><tr><th>  userId </th><th>  SortedList [objectId] </th></tr></thead><tbody><tr><td>  123 </td><td>  78.13.54.22 </td></tr><tr><td>  128 </td><td>  35.61.55 </td></tr><tr><td>  131 </td><td>  35,68,129,11 </td></tr></tbody></table><br><p> 指标-用户的平均ROC AUC。 </p><br><p> 可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在完善网站</a>上找到有关数据的更详细说明。 您也可以在那里下载数据，包括测试和图片。 </p><br><p>  <strong>在线舞台</strong> </p><br><p> 在在线阶段，任务分为3个部分 </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">协作系统</a> -包括所有标志，但图像和文字除外； </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">图片</a> -仅包含有关图片的信息； </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文本</a> -仅包含有关文本的信息。 </li></ul><br><p>  <strong>离线阶段</strong> </p><br><p> 在离线阶段，数据包含所有属性，而文本和图像则稀疏。 数据集中的行多于1.5倍，其中已经有很多行。 </p><br><h1 id="reshenie-zadachi"> 解决问题 </h1><br><p> 由于我在从事简历工作，因此我以“图片”任务开始了自己的比赛。 提供的数据包括userId，objectId，ownerId（发布该帖子的组），创建和显示该帖子的时间戳，当然还有该帖子的图像。 <br> 在基于时间戳生成了多个特征之后，下一个想法是采用在imagenet上预先训练的神经元的倒数第二层，并将这些嵌入发送出去以增强效果。 </p><br><p><img src="https://habrastorage.org/webt/g6/pq/id/g6pqidmcs0hqgilcqvmii7qdzz0.png"></p><br><p> 结果并不令人印象深刻。 我想，来自imagenet神经元的嵌入无关紧要，我需要提交自动编码器。 </p><br><p><img src="https://habrastorage.org/webt/8b/n_/pu/8bn_pui29109tsvwsf_s5sktlgq.png"></p><br><p> 花了很多时间，结果没有改善。 </p><br><p>  <strong>特征生成</strong> </p><br><p> 使用图像需要花费很多时间，因此我决定做一些简单的事情。 <br> 正如您马上看到的，数据集中有几个分类符号，为了不打扰我，我只加了升压。 该解决方案非常出色，没有任何设置，我立即进入了排行榜的第一行。 </p><br><p> 有很多数据，它们以镶木地板格式布置，因此，我三思而后行，开始使用scala并开始编写所有内容。 </p><br><p> 最简单的功能，比图像嵌入带来了更多的增长： </p><br><ul><li> 数据中的objectId，userId和ownerId满足多少次（应与受欢迎程度相关）； </li><li>  ownerId看到多少个userId帖子（应该与用户对该组的兴趣相关）； </li><li>  ownerId观看了多少不重复的userId（反映了该组受众的人数）。 </li></ul><br><p> 从时间戳可以获取用户观看录像带的一天中的时间（早晨/白天/晚上/晚上）。 通过组合这些类别，您可以继续生成功能： </p><br><ul><li> 晚上userId登录了多少次； </li><li> 该帖子通常显示什么时间（objectId），依此类推。 </li></ul><br><p> 所有这些逐渐改善了指标。 但是训练数据集的大小约为2000万条记录，因此添加功能会大大减慢学习速度。 </p><br><p> 我重新定义了数据使用方法。 尽管数据是随时间变化的，但是以后我还没有看到任何明显的信息泄漏，但是，以防万一，我像这样破坏了它： </p><br><p><img src="https://habrastorage.org/webt/jf/zr/gq/jfzrgq7s0l3q465pa-cc0x-rkxq.png"></p><br><p> 提供给我们的培训集（2月和3月2日）分为两部分。 <br> 根据最近N天的数据，他训练了模型。 上述汇总是基于包括测试在内的所有数据构建的。 同时，出现了可以建立目标变量的各种编码器的数据。 最简单的方法是重用已经创建新功能的代码，并简单地为其提供将不会训练且目标= 1的数据。 </p><br><p> 因此，我们得到了类似的功能： </p><br><ul><li>  userId在ownerId组中看到过一次帖子的次数； </li><li>  userId喜欢发给ownerId的帖子有多少次； </li><li>  userId喜欢ownerId的帖子的百分比。 </li></ul><br><p> 也就是说，根据分类特征的各种组合，结果证明了数据集部分的<em>平均目标编码</em> 。 原则上，catboost还会建立目标编码，从这个角度来看没有好处，但是，例如，可以计算出喜欢该组帖子的唯一用户的数量。 同时，主要目标得以实现-我的数据集减少了数倍，并且有可能继续生成要素。 </p><br><p> 虽然catboost只能根据喜欢的反应来构建编码器，但反馈还有其他反应：重新共享，不喜欢，有区别，被点击，被忽略，这可以手动完成。 我重述了各种聚合并筛选出低重要性的特征，以免膨胀数据集。 </p><br><p> 到那时，我已经遥遥领先。 唯一的尴尬是图像的嵌入几乎没有带来任何好处。 这个想法使一切都变得强大起来。 对Kmeans图像进行聚类，并获得新的分类特征imageCat。 </p><br><p> 这是手动过滤和合并从KMeans获得的群集之后的一些类。 </p><br><p><img src="https://habrastorage.org/webt/i3/s5/m2/i3s5m2ftpdmvr0m_0dvpau4eggs.png"></p><br><p> 基于imageCat我们生成： </p><br><ul><li> 新的分类功能： <br><ul><li> 什么imageCat最常显示为userId； </li><li> 哪个imageCat最经常由ownerId显示； </li><li> 哪个imageCat最喜欢userId； </li></ul></li><li> 各种柜台： <br><ul><li> 多少个唯一的imageCat看了userId； </li><li> 如上所述，大约有15个相似的功能以及目标编码。 </li></ul></li></ul><br><p>  <strong>文字</strong> </p><br><p> 图片比赛的结果适合我，因此我决定尝试自己的文章。 以前，我对文本的处理不多，并且由于愚蠢，我在tf-idf和svd上杀死了一天。 然后我看到了doc2vec的基线，它可以满足我的需求。 稍微调整了doc2vec的参数后，我收到了文本嵌入。 </p><br><p> 然后，他只是简单地为图像重用了代码，在其中他用文本嵌入替换了图像嵌入。 结果，我在文字竞赛中获得了第二名。 </p><br><p>  <strong>协同系统</strong> </p><br><p> 我还没有“戳竹竿”的比赛，但是根据排行榜上的AUC判断，这项特殊比赛的结果很可能会影响离线阶段。 <br> 我采用了源数据中的所有符号，选择了分类符号，并计算了与图像相同的聚合，但图像本身的特征除外。 只是把它放到了推特上，我就获得了第二名。 </p><br><h1 id="pervye-shagi-optimizacii-catboost"> 优化Catboost的第一步 </h1><br><p> 一等奖和二等奖让我感到高兴，但据了解，我没有做任何特别的事情，这意味着我们可以预期会失去位置。 </p><br><p> 竞赛的任务是在用户的框架内对帖子进行排名，而这一次我一直在解决分类问题，也就是说，我优化了错误的指标。 </p><br><p> 我将举一个简单的例子： </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th> 预言 </th><th> 基本事实 </th></tr></thead><tbody><tr><td>  1个 </td><td>  10 </td><td>  0.9 </td><td>  1个 </td></tr><tr><td>  1个 </td><td>  11 </td><td>  0.8 </td><td>  1个 </td></tr><tr><td>  1个 </td><td>  12 </td><td>  0.7 </td><td>  1个 </td></tr><tr><td>  1个 </td><td>  13 </td><td>  0.6 </td><td>  1个 </td></tr><tr><td>  1个 </td><td>  14 </td><td>  0.5 </td><td>  0 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0.4 </td><td>  0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0.3 </td><td>  1个 </td></tr></tbody></table><br><p> 我们做一个小的排列 </p><br><table><thead><tr><th>  userId </th><th>  objectId </th><th> 预言 </th><th> 基本事实 </th></tr></thead><tbody><tr><td>  1个 </td><td>  10 </td><td>  0.9 </td><td>  1个 </td></tr><tr><td>  1个 </td><td>  11 </td><td>  0.8 </td><td>  1个 </td></tr><tr><td>  1个 </td><td>  12 </td><td>  0.7 </td><td>  1个 </td></tr><tr><td>  1个 </td><td>  13 </td><td>  0.6 </td><td>  0 </td></tr><tr><td>  2 </td><td>  16 </td><td>  0.5 </td><td>  1个 </td></tr><tr><td>  2 </td><td>  15 </td><td>  0.4 </td><td>  0 </td></tr><tr><td>  1个 </td><td>  14 </td><td>  0.3 </td><td>  1个 </td></tr></tbody></table><br><p> 我们得到以下结果： </p><br><table><thead><tr><th> 型号 </th><th> 澳柯 </th><th>  User1 AUC </th><th>  User2 AUC </th><th> 平均AUC </th></tr></thead><tbody><tr><td> 选项1 </td><td>  0.8 </td><td>  1,0 </td><td>  0,0 </td><td>  0.5 </td></tr><tr><td> 选项2 </td><td>  0.7 </td><td>  0.75 </td><td>  1,0 </td><td>  0.875 </td></tr></tbody></table><br><p> 如您所见，改善整体AUC指标并不意味着改善用户内部的平均AUC指标。 </p><br><p>  Catboost <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">可以</a>开箱即用地<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">优化排名指标</a> 。 我阅读了有关使用Catboost时排名指标， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">成功案例的信息</a> ，并设置了YetiRankPairwise进行夜间学习。 结果并不令人印象深刻。 决定自己学得不好后，我将错误函数更改为QueryRMSE，根据catboost的文档判断，该函数收敛速度更快。 结果，我得到了与分类训练期间相同的结果，但是这两个模型的合奏得到了很好的提高，这使我在所有三场比赛中均排名第一。 </p><br><p> 在协作系统竞赛在线阶段结束前5分钟，Sergey Shalnov将我带到了第二名。 我们一起走的另一条路。 </p><br><h1 id="podgotovka-k-oflayn-etapu"> 为离线阶段做准备 </h1><br><p> 在RTX 2080 TI视频卡上我们获得了在线阶段的胜利，但是总奖金为300,000卢布，甚至最终的第一名也迫使我们不得不花了2周的时间。 </p><br><p> 事实证明，谢尔盖还使用了助推器。 我们交换了想法和功能，我发现了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Anna Veronika Dorogush</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">报告，</a>其中回答了我的许多问题，甚至还回答了我尚未出现的问题。 </p><br><p> 查看报告使我想到有必要将所有参数恢复为默认值，并且必须非常仔细地并且仅在固定一组符号之后才能微调设置。 现在，一次训练花费了大约15个小时，但是一种模型设法获得了比集合排名更高的速度。 </p><br><p>  <strong>特征生成</strong> </p><br><p> 在“协作系统”竞赛中，大量功能对于该模型很重要。 例如， <em>auditweights_spark_svd</em>是最重要的属性，并且没有关于其含义的信息。 我认为值得根据重要迹象来计算各种单位。 例如，每个用户，每个组，每个对象的平均auditweights_spark_svd。 可以根据未执行训练且目标= 1的数据（即，每个用户所喜欢的对象的平均<em>auditweights_spark_svd）</em>来计算出相同的值。 除了<em>auditweights_spark_svd</em>之外，还有几个重要标志。 以下是其中一些： </p><br><ul><li>  <em>审计权重</em> </li><li>  <em>auditweightsCtrHigh</em> </li><li>  <em>userOwnerCounterCreateLikes</em> </li></ul><br><p> 例如，事实证明，由userId组成的<em>auditweightsCtrGender</em>平均值以及由userId + ownerId组成的<em>userOwnerCounterCreateLikes</em>平均值都是一个重要功能。 这应该使我们考虑如何理解这些字段的含义。 </p><br><p> 其他重要功能包括<em>auditweightsLikesCount</em>和<em>auditweightsShowsCount</em> 。 一分为二，获得了更为重要的功能。 </p><br><p>  <strong>资料外泄</strong> </p><br><p> 竞争和生产模型是非常不同的任务。 在准备数据时，很难考虑所有细节并且不传递有关测试目标变量的一些重要信息。 如果创建生产解决方案，则在训练模型时将尝试避免使用数据泄漏。 但是，如果我们想赢得比赛，那么数据泄漏就是最好的功能。 </p><br><p> 检查数据后，您可以看到根据objectId， <em>auditweightsLikesCount</em>和<em>auditweightsShowsCount</em>的值发生了变化，这意味着这些符号的最大值之比将比转换后的比率更好地反映后期转换。 </p><br><p> 我们发现的第一个泄漏是<em>auditweightsLikesCountMax / auditweightsShowsCountMax</em> 。 <br> 但是，如果您更仔细地查看数据怎么办？ 按交货日期排序并获得： </p><br><table><thead><tr><th>  objectId </th><th>  userId </th><th>  auditweightsShowsCount </th><th>  auditweightsLikesCount </th><th> 目标（喜欢） </th></tr></thead><tbody><tr><td>  1个 </td><td>  1个 </td><td>  12 </td><td>  3 </td><td> 可能不是 </td></tr><tr><td>  1个 </td><td>  2 </td><td>  15 </td><td>  3 </td><td> 可能是 </td></tr><tr><td>  1个 </td><td>  3 </td><td>  16 </td><td>  4 </td><td></td></tr></tbody></table><br><p> 当我找到第一个这样的例子时，令人惊讶的是，事实证明我的预言没有实现。 但是，鉴于这些符号在对象框架内的最大值有所增加，我们并不太懒惰，因此决定查找<em>auditweightsShowsCountNext</em>和<em>auditweightsLikesCountNext</em> ，即下一个时刻的值。 新增功能 <br>  <em>（auditweightsShowsCountNext-auditweightsShowsCount）/（auditweightsLikesCount-auditweightsLikesCountNext），</em>我们<em>全天候</em>进行了大幅跃升。 <br> 如果在userId + ownerId中找到<em>userOwnerCounterCreateLikes</em>的以下值，例如，在objectId + userGender中找到<em>auditweightsCtrGender，</em>则可以使用类似的泄漏。 我们找到了6个相似的领域，其中有泄漏，并尽可能从中提取信息。 </p><br><p> 到那时，我们已经从协作属性中榨取了最多的信息，但没有回到图像和文字竞赛中。 有一个好主意要检查：在相应的比赛中，功能直接赋予图像或文字有多少？ </p><br><p> 在图像和文本竞赛中没有泄漏，但是到那时，我已经返回了catboost的默认参数，对代码进行了梳理并添加了一些功能。 总结果： </p><br><table><thead><tr><th> 解决方案 </th><th> 速度 </th></tr></thead><tbody><tr><td> 图片最大 </td><td>  0.6411 </td></tr><tr><td> 最多无图像 </td><td>  0.6297 </td></tr><tr><td> 第二名结果 </td><td>  0.6295 </td></tr></tbody></table><br><table><thead><tr><th> 解决方案 </th><th> 速度 </th></tr></thead><tbody><tr><td> 含文字的最大值 </td><td>  0.666 </td></tr><tr><td> 不含文字的最大值 </td><td>  0.660 </td></tr><tr><td> 第二名结果 </td><td>  0.656 </td></tr></tbody></table><br><table><thead><tr><th> 解决方案 </th><th> 速度 </th></tr></thead><tbody><tr><td> 协作最大 </td><td>  0.745 </td></tr><tr><td> 第二名结果 </td><td>  0.723 </td></tr></tbody></table><br><p> 很明显，很多文本和图像不太可能被挤出，在尝试了几个最有趣的想法之后，我们停止了与它们的合作。 </p><br><p> 协作系统中功能的进一步生成并没有带来增长，因此我们开始进行排名。 在在线阶段，分类和排名的合集给了我一点点增长，结果是因为我的分类训练不足。 包括YetiRanlPairwise在内的所有错误函数都没有给出LogLoss给出的接近结果（0.745对0.725）。 希望无法启动QueryCrossEntropy。 </p><br><h1 id="oflayn-etap"> 离线阶段 </h1><br><p> 在离线阶段，数据结构保持不变，但是有一些小的变化： </p><br><ul><li> 标识符userId，objectId，ownerId已重新随机化； </li><li> 删除了一些标志，并重命名了一些标志； </li><li> 数据已经增加了约1.5倍。 </li></ul><br><p> 除了列出的困难外，还有一个很大的好处：将具有RTX 2080TI的大型服务器分配给团队。 我很喜欢htop了很长时间。 <br><img src="https://habrastorage.org/webt/0c/6n/zp/0c6nzpburmw8nxsxz9y8iwkxmwa.jpeg"></p><br><p> 这个想法是一个-只是复制已经存在的东西。 花了几个小时在服务器上设置环境之后，我们逐渐开始验证结果是否正在复制。 我们面临的主要问题是数据量的增加。 我们决定稍微减少负载，并设置参数catboost ctr_complexity = 1。 这稍微降低了速度，但是我的模型开始起作用，结果很好-0.733。 与我不同，Sergei并未将数据分为两部分，也没有对所有数据进行训练，尽管这在联机阶段提供了最佳结果，但在脱机阶段存在很多困难。 如果我们采用已经生成的所有功能，并尝试将其放到“额头上”，那么在在线阶段就不会发生任何事情。  Sergey进行了类型优化，例如，将float64类型转换为float32。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在本文中，</a>您可以找到有关优化熊猫记忆的信息。 结果，Sergey在CPU上训练了所有数据，结果约为0.735。 </p><br><p> 这些成绩足以赢得胜利，但是我们掩盖了真实的速度，无法确定其他球队是否也没有做到这一点。 </p><br><h1 id="bitva-do-poslednego"> 战斗到最后 </h1><br><p>  <strong>调整助推器</strong> </p><br><p> 我们的解决方案被完全复制，我们添加了文本数据和图像的功能，因此剩下的只是调整catboost参数。  Sergey在CPU上进行了少量迭代研究，而在ctr_complexity = 1的情况下进行了研究。 仅剩一天，如果您仅添加迭代或增加ctr_complexity，那么在早晨，您甚至可以得到更快的速度，并整日走路。 </p><br><p> 在离线阶段，仅通过选择不是站点上最佳的解决方案就可以很容易地隐藏分数。 我们希望在提交结束之前的最后几分钟内，排行榜会发生重大变化，因此决定不停止。 </p><br><p> 从安娜的视频中，我了解到要提高模型的质量，最好选择以下参数： </p><br><ul><li>  <em>learning_rate-</em>根据数据集的大小计算默认值。 随着learning_rate的降低，有必要增加迭代次数以保持质量。 </li><li>  <em>l2_leaf_reg-</em>正则化系数，默认值为3，最好从2到30。值的减小导致过拟合的增加。 </li><li>  <em>bagging_temperature-</em>将随机化添加到所选对象的权重中。 默认值为1，从指数分布中选择权重。 值的减小导致过拟合的增加。 </li><li>  <em>random_strength-</em>影响特定迭代的分割选择。  random_strength越高，选择低重要性分割的机会就越高。 在每个后续迭代中，随机性降低。 值的减小导致过拟合的增加。 </li></ul><br><p> 其他参数对最终结果的影响较小，因此我没有尝试选择它们。 在ctr_complexity = 1的情况下，对我的GPU数据集进行了一次培训迭代，耗时20分钟，并且在简化数据集上选择的参数与整个数据集上的最佳参数略有不同。 结果，我对10％的数据进行了约30次迭代，然后对所有数据又进行了约10次迭代。 结果大致如下： </p><br><ul><li> 我将默认的<em>学习</em>率提高了40％； </li><li>  <em>l2_leaf_reg</em>保持不变； </li><li>  <em>bagging_temperature</em>和<em>random_strength</em>降低至0.8。 </li></ul><br><p> 我们可以得出结论，在使用默认参数的情况下，模型训练不足。 </p><br><p> 当我在排行榜上看到结果时，我感到非常惊讶： </p><br><table><thead><tr><th> 型号 </th><th> 模型1 </th><th> 模型2 </th><th> 模型3 </th><th> 合奏 </th></tr></thead><tbody><tr><td> 没有调音 </td><td>  0.7403 </td><td>  0.7404 </td><td>  0.7404 </td><td>  0.7407 </td></tr><tr><td> 随着调整 </td><td>  0.7406 </td><td>  0.7405 </td><td>  0.7406 </td><td>  0.7408 </td></tr></tbody></table><br><p> 我自己得出结论，如果您不需要快速应用模型，那么最好用未优化参数上的多个模型的集合代替参数选择。 </p><br><p>  Sergey致力于优化数据集的大小以在GPU上运行它。    —    ,      : </p><br><ul><li>      ( ),       ; </li><li>      ; </li><li>  userId,      ; </li><li>   userId,    . </li></ul><br><p>     —     . </p><br><p> <strong> </strong> </p><br><p>          ,   0,742.        ctr_complexity=2   30    5 .   4   ,     ,      0,7433. </p><br><p>       ,     ,      .          predict(prediction_type='RawFormulaVal')   scale_pos_weight=neg_count/pos_count. </p><br><p><img src="https://habrastorage.org/webt/ki/yv/yj/kiyvyjpnsouo46k-ny9e9hmyjxa.png"></p><br><p>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    </a> . </p><br><p> <strong> </strong> </p><br><p>       . ,      ,    ,   2  . </p><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a> . ,   Mail.ru,    ,         ,     . </li><li>  ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   facebook</a> ,        . </li></ul><br><h1 id="zaklyuchenie"> 结论 </h1><br><p>      : </p><br><ul><li>      ,       target encoding,     catboost. </li><li>     ,       ,  learning_rate  iterations.    —    . </li><li>     GPU. Catboost      GPU,    . </li><li>          rsm~=0.2 (CPU only)  ctr_complexity=1. </li><li>     ,      .         .         , ,     . </li><li>       ,   . </li><li>         ,    . </li></ul><br><p><img src="https://habrastorage.org/webt/en/m_/to/enm_topolhyttqfezaldsddvjs0.jpeg"></p><br><p>     ,   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN447376/">https://habr.com/ru/post/zh-CN447376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN447366/index.html">什么是启动项目的最佳方法，或者如何使其不致于造成极大痛苦的项目</a></li>
<li><a href="../zh-CN447368/index.html">不只是抓跳蚤。 为什么速度对任何商店都如此重要</a></li>
<li><a href="../zh-CN447370/index.html">为什么，由于专利制度破裂，Theranos的阴影仍然笼罩着我们</a></li>
<li><a href="../zh-CN447372/index.html">IT转型是不可避免的：从哪里开始</a></li>
<li><a href="../zh-CN447374/index.html">使用PureLayout以编程方式创建界面元素（第2部分）</a></li>
<li><a href="../zh-CN447380/index.html">Kotlin例外及其功能</a></li>
<li><a href="../zh-CN447382/index.html">《统一与C＃》一书。 Gamedev从构思到实施。 第二版</a></li>
<li><a href="../zh-CN447384/index.html">功率半导体保护生态</a></li>
<li><a href="../zh-CN447388/index.html">TL； ITMO大学的摘要：非经典的大学入学，即将发生的事件和最有趣的资料</a></li>
<li><a href="../zh-CN447390/index.html">适用于VMware vSphere的AccelStor AFA配置指南</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>