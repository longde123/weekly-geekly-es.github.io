<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’‹ ğŸ–•ğŸ¼ ğŸ‘©ğŸ¿â€ğŸ« J'ai Ã©crit une extension multi-navigateur pour les onglets, mais vous ne le faites pas ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ”„ ğŸ™„</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une introduction longue et fastidieuse avec une prÃ©tention Ã  la mÃ©galomanie 
 Une fois que j'ai dÃ©couvert que, comme toujours, quelque chose ne me con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>J'ai Ã©crit une extension multi-navigateur pour les onglets, mais vous ne le faites pas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427773/"><h3>  Une introduction longue et fastidieuse avec une prÃ©tention Ã  la mÃ©galomanie </h3><br>  Une fois que j'ai dÃ©couvert que, comme toujours, quelque chose ne me convenait pas beaucoup dans ce monde.  Ã€ savoir, en entrant une sorte de longue requÃªte dans un moteur de recherche sur un ordinateur de bureau, puis en passant Ã  une tablette, je ne pouvais pas rappeler le texte de la requÃªte textuellement afin d'obtenir exactement les mÃªmes rÃ©sultats.  Tout a si bien commencÃ©.  J'ai vu dans le moteur de recherche un lien vers la rÃ©ponse Ã  ma question et j'ai rÃ©alisÃ© qu'il promet une longue lecture.  Ensuite, j'ai Ã©teint l'ordinateur et je me suis laissÃ© tomber sur le canapÃ© avec la tablette en pensant que maintenant je vais tout retaper dans le moteur de recherche, j'ouvrirai ce lien maintenant sur la tablette et je m'allonge, calmement, dans une position plus confortable, je vais le lire ... Mais pas ici Ã©tait.  Quelques divergences mineures dans le texte - et mon lien n'est plus dans le moteur de recherche.  Jouer le lien lui-mÃªme n'est pas non plus une option: c'est trop long.  IntriguÃ© par les options pour le texte de la requÃªte, j'Ã©tais presque furieux de casser la tablette.  Bon sang, j'ai dÃ» me lever, rallumer l'ordinateur, lancer le navigateur et plonger dans l'historique pour trouver le texte exact de ma demande. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/96/4d/2c/964d2c1pum-7mihsz15k_6r1ayu.jpeg"></div><br>  <i>Extension installÃ©e dans Chrome et Firefox</i> <br><a name="habracut"></a><br><h3>  IdÃ©e </h3><br>  J'ai pensÃ©, mais ce serait bien d'Ã©crire une telle extension pour le navigateur qui vous permettrait de transfÃ©rer n'importe lequel de vos onglets ouverts via le serveur vers n'importe quel autre ordinateur et de continuer Ã  travailler avec eux.  Oui, certains navigateurs ont dÃ©jÃ  une fonctionnalitÃ© cloud - il vous suffit de vous connecter aux deux appareils et ... Mais c'est le problÃ¨me.  Mais que faire si j'ai Chrome sur mon ordinateur et Firefox sur ma tablette?  Et puis ... Connectez-vous, oui.  Si je me souviens encore de mon mot de passe depuis mon compte Google.  Et je n'ai tout simplement pas de compte dans Firefox.  Je ne sais mÃªme pas s'il y a des comptes lÃ -bas?  Il existe bien sÃ»r des services cloud tiers oÃ¹ vous pouvez vous inscrire et probablement vous jeter le lien souhaitÃ©.  Mais il faut quand mÃªme sâ€™y inscrire et mÃ©moriser fermement un autre mot de passe ... Non, câ€™est complÃ¨tement irrÃ©aliste.  Vous pouvez, Ã  la fin, vous jeter un lien par la poste.  Mais tout cela prend du temps et copiez-collez depuis, puis dans la barre d'adresse, ce qui, par exemple, sur une tablette est extrÃªmement gÃªnant Ã  faire.  Non, tout cela est une sorte de non-sens ... <br><br>  AllongÃ© sur le canapÃ©, je me suis lentement rendu compte que toutes ces actions nÃ©cessitaient trop de mouvement ... Non, les gars, Ã§a ne va pas.  Et quand je comprends que quelque chose ne me convient pas dans ce monde, alors je m'assois pour Ã©crire du code pour tout faire Ã  ma faÃ§on.  Je pensais que j'Ã©tais autorisÃ© sur les rÃ©seaux sociaux Ã  la fois sur la tablette et l'ordinateur de bureau.  Et dans diffÃ©rents navigateurs, par exemple, sur le mÃªme ordinateur - aussi.  En gÃ©nÃ©ral, la solution pour moi Ã©tait Ã©vidente - authentifier l'utilisateur via les rÃ©seaux sociaux. <br><br><h3>  Digression lyrique </h3><br>  Au fait, quand j'Ã©cris quelque chose de moi-mÃªme, je le fais aussi Ã  ma faÃ§on.  J'Ã©cris en pur javaScript dans un cahier avancÃ©, je n'utilise pas github, je n'utilise pas de bibliothÃ¨ques tierces, je n'utilise mÃªme pas jquery.  Par consÃ©quent, il n'y aura pas de tutoriel sur la faÃ§on d'Ã©crire une extension de navigateur.  Je ne vous apprendrai pas cela.  Ne fais pas comme moi.  Je vous prÃ©viens - c'est un mauvais exemple.  Je veux aussi dire Ã  tous les critiques potentiels, anticiper leur rÃ©action - oui, je suis entiÃ¨rement d'accord avec toute votre colÃ¨re juste.  Oui, vous ne pouvez pas mettre le script entier dans un ou deux fichiers, mais vous devez tout couper, comme une salade, en plusieurs petits morceaux afin qu'il puisse ensuite Ãªtre assemblÃ© pendant 3 heures sur une longue commande intelligente Ã  partir de la ligne de commande.  Oui, vous ne pouvez pas combiner le code javascript et le code html dans un seul fichier - il est prÃ©fÃ©rable de bousiller un autre niveau d'abstraction qui les combinera.  Oui, vous ne pouvez pas utiliser la disposition des tableaux, mais bon sang, c'est du fer!  Et, encore plus - maintenant ils vont me brÃ»ler - vous ne pouvez pas utiliser innerHtml et crÃ©er une structure html complexe d'un seul coup, mais vous devez attacher et dÃ©tacher tous les enfants dans une boucle et attacher puis supprimer soigneusement chaque gestionnaire ... Oui, je fais tout mal.  PÃ©cheur, je me repens.  Mais je le fais consciemment, car c'est plus facile.  Et qui m'interdira?  En fin de compte, ce n'est pas illÃ©gal, n'est-ce pas?  Je ne sais pas comment programmer comme un mod moderne l'exige, et je ne veux mÃªme pas essayer, car je pense que le diagramme du processus de dÃ©veloppement est inutilement compliquÃ©.  Je suis pour Ã©crire du code avec mes mains, et non pour le construire Ã  partir des morceaux de quelqu'un d'autre sans Ã©crire une seule ligne.  Cependant, mon code est lÃ©ger, il n'a pas besoin d'Ãªtre assemblÃ© par une Ã©quipe spÃ©ciale et il fonctionne rapidement.  J'Ã©cris du code en utilisant la technologie F5.  C'est Ã  ce moment que, pour voir comment fonctionne la version actuelle Ã  tout moment du processus de dÃ©veloppement, il suffit de cliquer sur le navigateur F5. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rl/hq/rs/rlhqrsc-7sjls6fju4o6lmawsto.jpeg"></div><br><br>  Cependant, j'ai quand mÃªme dÃ» raccrocher les gestionnaires dans une boucle, car sinon l'extension ne passe pas le test.  Ã‰galement dans les extensions, juste au cas oÃ¹, dans le fichier d'index html - soudainement - les scripts connectÃ©s dynamiquement sont interdits.  Je les ai donc connectÃ©s via la balise script. <br><br><h3>  Stockage des onglets </h3><br>  J'ai donc dÃ©cidÃ© que les onglets ouverts dans le navigateur devraient Ãªtre enregistrÃ©s dans certaines listes, qui seront appelÃ©es ordinateurs - ordinateur domestique, ordinateur professionnel, ordinateur local.  Local - c'est lorsque la liste n'est pas stockÃ©e sur le serveur, mais dans la base de donnÃ©es du navigateur, et, par consÃ©quent, vous ne pouvez l'utiliser que dans le navigateur Ã  partir duquel elle est enregistrÃ©e.  C'est pour les onglets qui n'ont pas besoin d'Ãªtre lancÃ©s entre diffÃ©rents ordinateurs.  Eh bien, le reste des listes peut Ãªtre consultÃ© sur tous les ordinateurs et navigateurs parmi ceux pris en charge par l'extension. <br><br>  Pour chaque onglet, l'utilisateur peut laisser un commentaire de texte arbitraire.  Par exemple, il est pratique pour moi de me souvenir de la sÃ©rie que j'ai arrÃªtÃ©e en regardant la sÃ©rie, et de marquer moi-mÃªme ce qui est sur la page, si ce n'est pas clair par son titre et le type de lien. <br><br>  Selon la documentation pour la crÃ©ation d'extensions pour Chrome et Firefox, le code d'extension doit se trouver dans deux fichiers - le principal et l'arriÃ¨re-plan.  Le script principal traite de l'affichage de l'interface utilisateur et le script d'arriÃ¨re-plan peut contrÃ´ler les onglets du navigateur et Ã©changer des donnÃ©es avec le serveur.  La gestion des onglets dans Chrome et Firefox est trÃ¨s similaire.  Par exemple, le gestionnaire d'Ã©vÃ©nements pour ouvrir ou fermer des onglets dans Chrome ressemble Ã  ceci: <br><br><pre><code class="plaintext hljs">chrome.tabs.onUpdated.addListener( function(tabId, changeInfo) { });</code> </pre> <br>  Et dans Firefox comme ceci: <br><br><pre> <code class="plaintext hljs">browser.tabs.onUpdated.addListener( function(tabId, changeInfo, tabInfo) { });</code> </pre> <br>  Et la fonction qui affiche une liste de tous les onglets ouverts est Ã©crite exactement de la mÃªme maniÃ¨re pour les deux navigateurs: <br><br><pre> <code class="plaintext hljs">chrome.tabs.query({},function(data){ });</code> </pre> <br>  Oui, oui, Chrome Ã©crit Ã©galement du chrome dans Firefox ... etc.  C'est un peu Ã©trange, cependant, le fait que les navigateurs s'orientent vers la standardisation de leur API est trÃ¨s encourageant. <br><br>  En fait, toutes les fonctionnalitÃ©s de l'extension sont obtenues en utilisant plusieurs fonctions - ouvrez la fenÃªtre d'extension en cliquant sur son icÃ´ne, lisez les onglets ouverts, fermez un onglet, crÃ©ez un nouvel onglet, Ã©coutez les Ã©vÃ©nements d'onglet et Ã©changez des donnÃ©es avec la fenÃªtre d'extension.  Câ€™est tout.  Ces mÃ©thodes sont disponibles uniquement Ã  partir du script d'arriÃ¨re-plan. <br><br>  AprÃ¨s lecture, les onglets ouverts dans le navigateur sont envoyÃ©s Ã  mon serveur et y sont enregistrÃ©s dans une base de donnÃ©es SQL rÃ©guliÃ¨re.  Le script du serveur est Ã©crit en PHP.  Il existe une table utilisateur qui stocke les liens vers les lignes d'une autre table - la table de donnÃ©es.  Ces donnÃ©es sont les adresses des pages, leurs noms et les commentaires de texte de l'utilisateur, stockÃ©s au format de chaÃ®nes de texte dans un champ de type texte d'environ un kilo-octet.  Les donnÃ©es sont stockÃ©es sous forme non cryptÃ©e.  Environ 1 000 onglets peuvent Ãªtre enregistrÃ©s par mÃ©gaoctet.  Un maximum de 25 de ces stockages (Â«ordinateursÂ») est fourni pour chaque utilisateur. <br><br>  Cependant, la version gratuite de l'extension limite l'utilisateur Ã  deux stockages - ordinateur personnel et ordinateur professionnel, et chacun d'eux ne peut pas stocker plus de 10 onglets.  Je travaille toujours sur la version payante et les mÃ©thodes de paiement.  Il y aura jusqu'Ã  25 Â«ordinateursÂ» et jusqu'Ã  environ 1000 onglets dans chacun, ainsi qu'un choix d'images d'arriÃ¨re-plan, d'icÃ´nes et de noms pour chaque ordinateur, des listes hiÃ©rarchiques et bien plus encore. <br><br>  Il existe un autre rÃ©fÃ©rentiel - ordinateur local.  Il n'y a aucune restriction ici, car les donnÃ©es de l'onglet sont stockÃ©es dans la base de donnÃ©es du navigateur local sur l'ordinateur de l'utilisateur.  Ici, vous pouvez stocker autant d'onglets que vous le souhaitez, mais pas plus que ne le permet le disque dur.  De plus, comme les donnÃ©es ne sont pas stockÃ©es dans Local Storage, mais dans indexedDB, il n'y a pas de limite de 5 ou quelques mÃ©gaoctets.  Il est seulement important de ne pas effacer accidentellement ce rÃ©fÃ©rentiel avec l'historique du navigateur.  Je prÃ©vois Ã©galement d'exporter et d'importer des onglets dans un fichier texte. <br><br>  Pour travailler avec indexedDB, j'ai Ã©crit une petite sous-bibliothÃ¨que qui ne fait que 106 lignes.  Contrairement Ã  la base de donnÃ©es sur le serveur, ici, toutes les donnÃ©es n'ont pas besoin d'Ãªtre distillÃ©es dans une chaÃ®ne de texte, mais peuvent Ãªtre enregistrÃ©es immÃ©diatement dans le tableau associatif telles quelles.  Le principe du stockage y est celui-ci: la clÃ© est la valeur.  Et la valeur peut Ãªtre un Ã©norme tableau associatif. <br><br><h3>  Authentification des utilisateurs </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n_/q-/iy/n_q-iys59c4pqcmjfcps0r3v-xw.jpeg"></div><br>  <i>Firefox</i> <br><br>  L'autorisation, comme je l'ai dÃ©jÃ  notÃ©, se fait via les rÃ©seaux sociaux et, sur le serveur, en utilisant le protocole OAuth.  Il est toujours pris en charge par Facebook et VKontakte, mais je prÃ©vois d'augmenter le nombre de mÃ©thodes d'authentification des utilisateurs.  Le schÃ©ma d'autorisation du serveur OAuth est dÃ©crit en dÃ©tail dans la documentation des deux rÃ©seaux sociaux, il est donc inutile de s'y attarder en dÃ©tail.  Je note seulement que je n'ai pas aimÃ© le fait que lors de l'autorisation un nouvel onglet de navigateur s'ouvre mÃªme si l'utilisateur est dÃ©jÃ  connectÃ© au rÃ©seau social et a dÃ©jÃ  accordÃ© les droits d'extension.  Cet onglet doit Ãªtre capturÃ© par le script d'extension d'arriÃ¨re-plan, puis forcÃ© de se fermer, et en gÃ©nÃ©ral, il n'a pas l'air esthÃ©tique, se coince dans les autres onglets et clignote lorsqu'il apparaÃ®t et est dÃ©truit. <br><br>  Pour le fermer, pour VKontakte, vous devez vÃ©rifier la prÃ©sence de l'adresse dans le gestionnaire d'Ã©vÃ©nements de l'onglet: <br><br><pre> <code class="plaintext hljs">oauth.vk.com/blank.html</code> </pre> <br>  Et pour Facebook: <br><br><pre> <code class="plaintext hljs">https://www.facebook.com/connect/blank.html</code> </pre> <br>  Et juste au cas oÃ¹: <br><br><pre> <code class="plaintext hljs">facebook.com/connect/login_success.html</code> </pre> <br>  Par consÃ©quent, j'ai d'abord envoyÃ© un assemblage d'extension au Google Web Store, dans lequel l'autorisation a Ã©tÃ© effectuÃ©e sur le client avec un pull-up prÃ©liminaire du rÃ©seau social client javascript api correspondant.  De plus, comme l'extension est installÃ©e sur l'utilisateur et que je dois autoriser sur mon serveur, j'ai Ã©galement extrait du code HTML de mon serveur dans le script d'extension dans l'i-frame, mais j'ai dÃ©jÃ  extrait l'api du rÃ©seau social dedans ... <br><br>  Et le schÃ©ma d'Ã©change de donnÃ©es avec le serveur Ã©tait comme Ã§a.  Une page d'index d'extension envoie une commande (informations de clic, par exemple) Ã  un script d'extension d'arriÃ¨re-plan.  Le script d'arriÃ¨re-plan utilisant postMessage envoie des donnÃ©es au format html i-frame.  I-frame envoie des donnÃ©es au script php sur le serveur.  Le serveur rÃ©pond dans l'i-frame, l'i-frame rÃ©pond dans le script d'arriÃ¨re-plan, le script d'arriÃ¨re-plan rÃ©pond dans l'index, l'utilisateur voit la rÃ©ponse.  Ouf ... Et surtout - tout a fonctionnÃ©! <br><br>  En gÃ©nÃ©ral, cela n'a pas fonctionnÃ©.  Google a enveloppÃ© mon extension d'un certain nombre de formulations, parmi lesquelles il y avait quelque chose de vague qui, disent-ils, votre extension ne respecte pas notre politique de sÃ©curitÃ©.  GrÃ¢ce Ã  la correspondance avec le support, j'ai pu obtenir des dÃ©tails.  Ã€ savoir, ils n'aimaient pas le fait que l'extension rÃ©cupÃ¨re du HTML et du js Ã  partir de serveurs tiers ... En gÃ©nÃ©ral, je devais me retrouver avec l'autorisation du client et revenir au serveur.  Oui, l'envoi d'une demande de publication http Ã  partir d'un script d'extension d'arriÃ¨re-plan directement Ã  votre serveur, cependant, il s'est avÃ©rÃ© Ãªtre autorisÃ©.  Et bien.  Câ€™est encore mieux.  Il s'est avÃ©rÃ© plus court et pas besoin de retirer l'api javascript des rÃ©seaux sociaux - c'est un temps d'attente supplÃ©mentaire pour l'utilisateur. <br><br><h3>  Afficher les onglets </h3><br>  Retour aux options d'extension.  La liste des onglets elle-mÃªme est une sÃ©rie de lignes dans lesquelles vient d'abord le favicon de l'image, puis le titre de la page et enfin le lien.  Ce qui ne correspond pas Ã  la taille de ligne indiquÃ©e Ã  l'Ã©cran est rognÃ©.  Mais la base de donnÃ©es est complÃ¨tement enregistrÃ©e.  De plus, n'importe quelle ligne peut Ãªtre dÃ©placÃ©e vers le haut de l'Ã©cran sous la forme d'une tuile colorÃ©e.  C'est pour les sites les plus importants qui devraient Ãªtre sous vos yeux en premier lieu. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9v/7_/7q/9v7_7qc9d8rbacokyuyloyuxths.jpeg"></div><br>  <i>Liste des onglets Chrome</i> <br><br>  Les couleurs des tuiles sont sÃ©lectionnÃ©es automatiquement en fonction du nom de domaine du site.  La fonction accepte l'url.  Le nom de domaine est divisÃ© en trois groupes de caractÃ¨res approximativement Ã©gaux. Les premiers caractÃ¨res de chaque groupe sont convertis en valeurs des composants de couleur: R, G, B. Cette conversion est effectuÃ©e comme suit.  Les codes de ces trois caractÃ¨res sont rÃ©duits Ã  la plage d1, de 0 Ã  25, en prenant le reste de la division par 26. MÃªme les caractÃ¨res de l'alphabet russe seront rÃ©duits Ã  cette plage.  Peu importe que la 27e lettre y devienne la premiÃ¨re: nous n'avons pas besoin que les composantes de couleur de toutes les lettres de l'alphabet soient nÃ©cessairement diffÃ©rentes, qu'elles soient rÃ©pÃ©tÃ©es.  Ensuite, les trois nombres obtenus Ã  partir de la plage d1 (0 ... 25) sont proportionnellement rÃ©duits Ã  la plage d2 (150 ... 255).  En gÃ©nÃ©ral, ces plages sont dÃ©finies au dÃ©but de la fonction et peuvent Ãªtre modifiÃ©es pour n'importe quelle autre.  J'ai pris 150 ... 255 pour que les composants de couleur soient brillants.  Si vous dÃ©finissez, par exemple, 0 ... 100, les carreaux deviendront sombres.  Ainsi, trois caractÃ¨res du nom de domaine sont convertis en 3 nombres compris entre 150 et 255.  Et puis, comme vous l'avez probablement devinÃ©, ils sont interprÃ©tÃ©s comme les composants de couleur des carreaux R, G et B. Tout est trÃ¨s simple. <br><br><pre> <code class="javascript hljs">getSiteColor=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d1=[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">25</span></span>], d2=[<span class="hljs-number"><span class="hljs-number">150</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code=<span class="hljs-number"><span class="hljs-number">0</span></span>, codep=<span class="hljs-number"><span class="hljs-number">0</span></span>, color=<span class="hljs-number"><span class="hljs-number">0</span></span>, str=<span class="hljs-string"><span class="hljs-string">''</span></span>, domen=<span class="hljs-string"><span class="hljs-string">''</span></span>, ar=[], inc=<span class="hljs-number"><span class="hljs-number">0</span></span>; ar=url.split(<span class="hljs-string"><span class="hljs-string">'//'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ar.length&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>) {str=ar[<span class="hljs-number"><span class="hljs-number">1</span></span>];} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {str=ar[<span class="hljs-number"><span class="hljs-number">0</span></span>];}; str=str.split(<span class="hljs-string"><span class="hljs-string">'www.'</span></span>).join(<span class="hljs-string"><span class="hljs-string">''</span></span>); domen=str.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; str=domen.split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>).join(<span class="hljs-string"><span class="hljs-string">''</span></span>); ar=[]; inc=<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(str.length/<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str.length % <span class="hljs-number"><span class="hljs-number">3</span></span> &gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) {inc++;}; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;str.length; i+=inc) { code=str.slice(i, i+<span class="hljs-number"><span class="hljs-number">1</span></span>).charCodeAt(<span class="hljs-number"><span class="hljs-number">0</span></span>); codep=code % (d1[<span class="hljs-number"><span class="hljs-number">1</span></span>]-d1[<span class="hljs-number"><span class="hljs-number">0</span></span>]+<span class="hljs-number"><span class="hljs-number">1</span></span>); color=<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round( codep * (d2[<span class="hljs-number"><span class="hljs-number">1</span></span>]-d2[<span class="hljs-number"><span class="hljs-number">0</span></span>]) / (d1[<span class="hljs-number"><span class="hljs-number">1</span></span>]-d1[<span class="hljs-number"><span class="hljs-number">0</span></span>]) ) + d2[<span class="hljs-number"><span class="hljs-number">0</span></span>]; ar.push(color); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">r</span></span>:ar[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">g</span></span>:ar[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-attr"><span class="hljs-attr">b</span></span>:ar[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-attr"><span class="hljs-attr">domen</span></span>:domen}; }</code> </pre> <br><h3>  Structure du document HTML </h3><br>  Un document html se compose de plusieurs Ã©lÃ©ments de canevas avec positionnement absolu, combinÃ©s par superposition, et d'un bloc div dans lequel la liste est affichÃ©e.  Une fonction est accrochÃ©e au redimensionnement de la fenÃªtre du navigateur qui redimensionne tous ces Ã©lÃ©ments, en les ajustant Ã  la nouvelle hauteur et largeur.  Il existe Ã©galement une taille minimale qui permet de surmonter l'apparition de barres de dÃ©filement.  L'image d'arriÃ¨re-plan s'affiche sur la toile infÃ©rieure.  J'ai dÃ©cidÃ© que pour diffÃ©rentes listes (c'est-Ã -dire les ordinateurs), diffÃ©rents arriÃ¨re-plans devraient Ãªtre dÃ©finis pour faciliter la navigation de l'utilisateur.  L'image de fond remplit la fenÃªtre avec la prÃ©servation de ses proportions et est lÃ©gÃ¨rement Ã©claircie pour ne pas attirer l'attention sur elle - un rectangle blanc translucide est dessinÃ© au-dessus d'elle.  Au-dessus du canevas d'arriÃ¨re-plan se trouve le canevas du menu principal, il ne remplit que le haut de l'Ã©cran.  Bien et encore plus haut se trouve le bloc div, dans lequel la liste des onglets elle-mÃªme est formÃ©e.  La navigation dans le menu Canvas se fait via ma mini bibliothÃ¨que. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hf/yo/7z/hfyo7zhfazg4zngh50ulh7mibte.jpeg"></div><br>  <i>Navigateur Opera et Yandex</i> <br><br><h3>  Localisation </h3><br>  Sur l'Ã©cran principal, il y a un drapeau, en cliquant sur lequel l'interface bascule entre le russe et l'anglais.  Ici, la page est redirigÃ©e vers la mÃªme adresse, mais avec un paramÃ¨tre sur la ligne de commande.  Ce paramÃ¨tre est lu avant de charger tous les autres Ã©lÃ©ments.  Et en fonction de sa valeur, tel ou tel fichier js contenant des phrases en russe ou en anglais est chargÃ© dans le tableau associatif pour les phrases: lng_en.js ou lng_ru.js.  Et dans l'application elle-mÃªme, pour afficher des phrases d'interface, des liens vers des chaÃ®nes de texte de ce tableau associatif sont dÃ©jÃ  utilisÃ©s.  En outre, en fonction de la valeur dans la barre d'adresse, un fichier est chargÃ© contenant les Ã©lÃ©ments de l'interface graphique - boutons: buttons_en.png, ou buttons_ru.png.  J'ai dÃ©cidÃ© qu'il Ã©tait prÃ©fÃ©rable de crÃ©er des boutons avec les icÃ´nes et les inscriptions dans chaque langue dans l'Ã©diteur graphique plutÃ´t que de crÃ©er un bouton vide et des icÃ´nes et des inscriptions superposÃ©es dessus, d'autant plus qu'il n'y en a pas beaucoup et que toute cette liste de sprites ne pÃ¨se que 50 Ko  Je prÃ©vois de continuer Ã  travailler sur la conception et Ã  rendre tous les boutons de forme diffÃ©rente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4j/42/i8/4j42i89k06pbdosro4pe1ytjm50.jpeg"></div><br><br>  Le fichier gÃ©nÃ©ral avec sprites main.png, qui contient des Ã©lÃ©ments graphiques qui ne sont pas liÃ©s Ã  une localisation spÃ©cifique, est quand mÃªme chargÃ©. <br><br><h3>  Version Web </h3><br>  Je pensais que ce serait bien si les liens soigneusement stockÃ©s Ã  partir de la maison ou de l'ordinateur de travail pouvaient Ãªtre consultÃ©s en chemin depuis le tÃ©lÃ©phone.  Mais tous les navigateurs OS mobiles ne prennent pas en charge les extensions.  J'ai donc crÃ©Ã© un assemblage Web.  En visitant le site Ã  une adresse spÃ©cifique, vous pouvez toujours vous connecter en utilisant l'un des rÃ©seaux sociaux et afficher vos onglets. <br><br>  Oui, il n'y a aucun moyen d'ajouter des onglets Ã  la liste ou de les modifier.  Mais vous pouvez au moins ouvrir des onglets dans la liste et afficher les pages.  Je pense qu'il vaut la peine de travailler sur la version mobile de ce site et d'y afficher de plus grandes listes d'onglets. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vh/h8/3p/vhh83pbba9_0rje4wdcjtye33ve.jpeg"></div><br>  <i>Version Web dans IE 11</i> <br><br><h3>  La publicitÃ© </h3><br>  Jusqu'Ã  prÃ©sent, je n'ai pas vraiment travaillÃ© sur la promotion de mon expansion.  Il vient de crÃ©er des groupes sur les rÃ©seaux sociaux et y a invitÃ© tous ses amis.  Oui, il a lancÃ© une campagne publicitaire dans Yandex Direct pour 1 500 roubles.  Elle n'a donnÃ© aucun rÃ©sultat spÃ©cial, mais peut-Ãªtre que je n'ai pas fait l'annonce correctement.  Ou peut-Ãªtre que le problÃ¨me est que j'ai indiquÃ© un lien vers la version anglaise de la page d'accueil de l'extension.  Et peut-Ãªtre valait-il la peine de donner un lien non pas vers la page d'accueil, mais immÃ©diatement vers l'un des magasins d'extension.  Comme vous le savez, je ne suis pas un gÃ©nie du marketing.  En gÃ©nÃ©ral, je vais rÃ©essayer avec d'autres paramÃ¨tres.  La campagne a gÃ©nÃ©rÃ© 39 clics.  Il est difficile de dire si j'ai acquis de nouveaux utilisateurs Ã  la suite de cela. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/89/sb/dg/89sbdgtfmp59-vykztuj4i-z3li.jpeg"></div><br>  Il y avait une bizarrerie avec la version sous Firefox. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k5/ku/so/k5kuso8qgka09q2ahx76mettkmo.jpeg"></div><br>  Les statistiques du 17 octobre indiquent jusqu'Ã  227 tÃ©lÃ©chargements.  Je ne sais pas si la campagne dans Yandex.Direct y a contribuÃ© ou non, mais pour une raison quelconque, 1 Ã  2 tÃ©lÃ©chargements par jour continuent Ã  nouveau pour une raison quelconque.  Dans le mÃªme temps, pour l'extension de Firefox, il y a le concept d'utilisateurs quotidiens: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h2/8j/2c/h28j2cd3ylazbx7nnqflnqghsmu.jpeg"></div><br>  Pourquoi il y avait 227 tÃ©lÃ©chargements, mais il n'y avait que 1-2 utilisateurs quotidiens, ce n'est pas clair.  C'Ã©tait peut-Ãªtre une sorte d'Ã©chec.  En gÃ©nÃ©ral, je ne comprenais toujours pas ce que c'Ã©tait, et oÃ¹ Ã©taient tous ces gens ... <br><br>  Les statistiques sur le magasin d'extensions Chrome Web Store ont satisfait un calendrier Ã©ternel de non-chargement - c'est ce que je n'ai pas vu - et 5-10 utilisateurs quotidiens. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dt/2u/zt/dt2uzt-5i74e8m947qxfntmuhgs.jpeg"></div><br>  J'ai Ã©galement envoyÃ© l'assemblage au magasin d'extension Opera.  Cependant, aprÃ¨s avoir prÃ©sentÃ© deux versions et sans attendre la modÃ©ration de l'une d'entre elles, j'ai Ã  un moment donnÃ© crachÃ© d'en rÃ©pandre de nouvelles.  Et, en effet, pourquoi est-ce nÃ©cessaire si l'Opera installe parfaitement les extensions du Chrome Store. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/or/6l/kt/or6lkthk4ovyqbuv3_hsyf8ypny.jpeg"></div><br><h3>  RÃ©sumÃ© </h3><br>  J'ai crÃ©Ã© trois versions d'extensions - pour Chrome, Firefox et la version Web.  En fait, les trois assemblys sont un seul et mÃªme assemblage, ce qui indique simplement dans la configuration quel moteur de navigateur est actuellement utilisÃ©.  Et les fonctions correspondantes pour travailler avec des onglets sont initialisÃ©es.  Je modifie cette valeur avant d'emballer en zip et d'envoyer le colis au magasin d'extension appropriÃ©. <br><br>  Les versions de Chrome et Firefox ont Ã©tÃ© testÃ©es et placÃ©es dans leurs magasins d'extensions officiels respectifs.  De plus, l'inscription en tant que dÃ©veloppeur d'extensions auprÃ¨s de Google coÃ»te 5 $.  Mozilla l'a gratuitement.  La version Web de l'extension se trouve sur le serveur.  L'assemblage du Chrome Store fonctionne bien dans les navigateurs compatibles: il peut Ã©galement Ãªtre installÃ© dans Yandex Browser et Opera.  Je prÃ©vois de publier de nouvelles versions avec des fonctionnalitÃ©s encore plus avancÃ©es. <br><br>  En gÃ©nÃ©ral, les extensions de navigateur sont puissantes.  Maintenant, je n'ai pas besoin de me lever du canapÃ©, et il n'y a pas non plus besoin de rage pour casser le comprimÃ©.  C'est complÃ¨tement zen.  Bon Ã  tous. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr427773/">https://habr.com/ru/post/fr427773/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr427759/index.html">A propos de la solvabilitÃ© des problÃ¨mes de ceinture de circulation en temps polynomial</a></li>
<li><a href="../fr427761/index.html">ImplÃ©mentation de l'algorithme k-means (k-means) en utilisant l'exemple du travail avec les pixels</a></li>
<li><a href="../fr427763/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 13: Protocoles rÃ©seau, partie 1</a></li>
<li><a href="../fr427767/index.html">Situation: au Canada, ils ont proposÃ© d'introduire une taxe sur le streaming - nous discutons du problÃ¨me</a></li>
<li><a href="../fr427771/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 13: Network Protocols, Part 2</a></li>
<li><a href="../fr427775/index.html">Un bot dÃ©guisÃ© en programmeur corrige les erreurs de code</a></li>
<li><a href="../fr427779/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 13: Network Protocols, Part 3</a></li>
<li><a href="../fr427781/index.html">Pourquoi les organisations de crÃ©dit data science</a></li>
<li><a href="../fr427783/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 14: Â«SSL et HTTPSÂ», partie 1</a></li>
<li><a href="../fr427785/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 14: Â«SSL et HTTPSÂ», partie 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>