<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§œğŸ¼ ğŸ– ğŸ§’ğŸ¾ Grafanaçš„æ’ä»¶å¼€å‘ï¼šå…¨é”¥çš„æ•…äº‹ ğŸ¤°ğŸ¾ ğŸ”£ ğŸ‘Š</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ï¼ å‡ ä¸ªæœˆå‰ï¼Œæˆ‘ä»¬å°†åä¸ºDevOpsProdigy KubeGrafçš„ç”¨äºç›‘è§†kubernetesçš„æ–°å¼€æºé¡¹ç›®Grafanaæ’ä»¶æŠ•å…¥ç”Ÿäº§ ã€‚ è¯¥æ’ä»¶çš„æºä»£ç å¯åœ¨GitHubçš„å…¬å…±å­˜å‚¨åº“ä¸­æ‰¾åˆ° ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æƒ³ä¸æ‚¨åˆ†äº«ä¸€ä¸ªæœ‰å…³å¦‚ä½•åˆ›å»ºæ’ä»¶ï¼Œä½¿ç”¨å“ªäº›å·¥å…·ä»¥åŠåœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„é™·é˜±çš„æ•…äº‹ã€‚ èµ°å§...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Grafanaçš„æ’ä»¶å¼€å‘ï¼šå…¨é”¥çš„æ•…äº‹</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/474500/"> å¤§å®¶å¥½ï¼ å‡ ä¸ªæœˆå‰ï¼Œæˆ‘ä»¬å°†åä¸º<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DevOpsProdigy KubeGrafçš„</a></b>ç”¨äºç›‘è§†kubernetesçš„æ–°å¼€æºé¡¹ç›®Grafanaæ’ä»¶<b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŠ•å…¥ç”Ÿäº§</a></b> ã€‚ è¯¥æ’ä»¶çš„æºä»£ç å¯åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…¬å…±å­˜å‚¨åº“ä¸­æ‰¾åˆ°</a> ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æƒ³ä¸æ‚¨åˆ†äº«ä¸€ä¸ªæœ‰å…³å¦‚ä½•åˆ›å»ºæ’ä»¶ï¼Œä½¿ç”¨å“ªäº›å·¥å…·ä»¥åŠåœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„é™·é˜±çš„æ•…äº‹ã€‚ èµ°å§ <br><a name="habracut"></a><br><h4> ç¬¬0éƒ¨åˆ†-ç®€ä»‹ï¼šæˆ‘ä»¬å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿ </h4><br> ä¸ºGrafanç¼–å†™è‡ªå·±çš„æ’ä»¶çš„æƒ³æ³•æ˜¯å¶ç„¶äº§ç”Ÿçš„ã€‚ åå¤šå¹´æ¥ï¼Œæˆ‘ä»¬å…¬å¸ä¸€ç›´åœ¨ç›‘è§†å„ç§å¤æ‚ç¨‹åº¦çš„Webé¡¹ç›®ã€‚ åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œæˆ‘ä»¬è·å¾—äº†å¤§é‡çš„ä¸“ä¸šçŸ¥è¯†ï¼Œæœ‰è¶£çš„æ¡ˆä¾‹ä»¥åŠä½¿ç”¨å„ç§ç›‘è§†ç³»ç»Ÿçš„ç»éªŒã€‚ åœ¨æŸä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬é—®è‡ªå·±ï¼šâ€œæ˜¯å¦æœ‰ä¸€ç§ç¥å¥‡çš„å·¥å…·æ¥ç›‘è§†Kubernetesï¼Œå°±åƒä»–ä»¬æ‰€è¯´çš„é‚£æ ·ï¼Œâ€œè®¾ç½®å¹¶å¿˜è®°â€ï¼Ÿ ä½œä¸ºé’ˆå¯¹è¯¥å †æ ˆçš„ç°æˆè§£å†³æ–¹æ¡ˆï¼Œæœ‰å¤§é‡çš„å„ç§å·¥å…·é›†ï¼šprometheus-operatorï¼Œä¸€ç»„ä»ªè¡¨æ¿kubernetes-mixinï¼Œgrafana-kubernetes-appã€‚ <br><br>  grafana-kubernetes-appæ’ä»¶å¯¹äºæˆ‘ä»¬æ¥è¯´ä¼¼ä¹æ˜¯æœ€æœ‰è¶£çš„é€‰æ‹©ï¼Œä½†æ˜¯ä¸€å¹´å¤šä»¥æ¥ä¸€ç›´æ²¡æœ‰å¾—åˆ°æ”¯æŒï¼Œè€Œä¸”ï¼Œä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨æ–°ç‰ˆæœ¬çš„node-exporterå’Œkube-state-metricsã€‚ åœ¨æŸä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å†³å®šï¼šâ€œä½†æ˜¯æˆ‘ä»¬ä¸åšè‡ªå·±çš„å†³å®šå—ï¼Ÿâ€ <br><br> æˆ‘ä»¬å†³å®šåœ¨æ’ä»¶ä¸­å®ç°å“ªäº›æƒ³æ³•ï¼š <br><br><ul><li>  â€œåº”ç”¨ç¨‹åºå›¾â€çš„å¯è§†åŒ–ï¼šæ–¹ä¾¿åœ°åœ¨é›†ç¾¤ä¸­å‘ˆç°åº”ç”¨ç¨‹åºï¼ŒæŒ‰åç§°ç©ºé—´åˆ†ç»„ï¼Œè¿›è¡Œéƒ¨ç½²...ï¼› </li><li> å¯è§†åŒ–å½¢å¼ä¸ºâ€œéƒ¨ç½²-æœåŠ¡ï¼ˆ+ç«¯å£ï¼‰â€çš„è¿æ¥ã€‚ </li><li> é€šè¿‡é›†ç¾¤èŠ‚ç‚¹å¯è§†åŒ–é›†ç¾¤åº”ç”¨ç¨‹åºçš„åˆ†å¸ƒã€‚ </li><li> ä»å¤šä¸ªæ¥æºæ”¶é›†æŒ‡æ ‡å’Œä¿¡æ¯ï¼šPrometheuså’Œk8s apiæœåŠ¡å™¨ã€‚ </li><li> ç›‘è§†åŸºç¡€ç»“æ„éƒ¨åˆ†ï¼ˆå¤„ç†å™¨æ—¶é—´ï¼Œå†…å­˜ï¼Œç£ç›˜å­ç³»ç»Ÿï¼Œç½‘ç»œçš„ä½¿ç”¨ï¼‰å’Œåº”ç”¨ç¨‹åºé€»è¾‘-å¥åº·çŠ¶æ€çª—æ ¼ï¼Œå¯ç”¨å‰¯æœ¬çš„æ•°é‡ï¼Œæœ‰å…³æ´»åŠ¨/å°±ç»ªæ ·æœ¬é€šè¿‡çš„ä¿¡æ¯ã€‚ </li></ul><br>
<h4> ç¬¬1éƒ¨åˆ†ï¼šä»€ä¹ˆæ˜¯Grafanaæ’ä»¶ï¼Ÿ </h4><br> ä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼ŒGrafanaæ’ä»¶æ˜¯ä¸€ä¸ªè§’åº¦æ§åˆ¶å™¨ï¼Œå­˜å‚¨åœ¨Grafanaæ•°æ®ç›®å½•ï¼ˆ <i>/var/grafana/plugins/&lt;your_plugin_name&gt;/dist/module.js</i> ï¼‰ä¸­ï¼Œå¯ä»¥ä½œä¸ºSystemJSæ¨¡å—åŠ è½½ã€‚ æ­¤å¤–ï¼Œåœ¨æ­¤ç›®å½•ä¸­è¿˜åº”è¯¥æ˜¯ä¸€ä¸ªplugin.jsonæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³æ‚¨çš„æ’ä»¶çš„æ‰€æœ‰å…ƒä¿¡æ¯ï¼šåç§°ï¼Œç‰ˆæœ¬ï¼Œæ’ä»¶çš„ç±»å‹ï¼Œä¸å­˜å‚¨åº“/ç«™ç‚¹/è®¸å¯è¯çš„é“¾æ¥ï¼Œä¾èµ–é¡¹ç­‰ã€‚ <br><br><img src="https://habrastorage.org/webt/ln/rz/kf/lnrzkf9mc6n6xcyn6iciuvak6cy.png"><br>  <i>module.ts</i> <br><br><img src="https://habrastorage.org/webt/lf/mk/3x/lfmk3xekikfm-p0y-donjv3rvw4.png"><br>  <i>plugin.json</i> <br><br> å¦‚æ‚¨åœ¨å±å¹•å¿«ç…§ä¸­æ‰€è§ï¼Œæˆ‘ä»¬æŒ‡å®šäº†plugin.type = appã€‚ å¯¹äºGrafanaçš„æ’ä»¶ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š <br><br>  <b>panel</b> ï¼šæœ€å¸¸è§çš„æ’ä»¶ç±»å‹-å®ƒæ˜¯ç”¨äºå¯è§†åŒ–ä»»ä½•æŒ‡æ ‡çš„é¢æ¿ï¼Œç”¨äºæ„å»ºå„ç§ä»ªè¡¨æ¿ã€‚ <br>  <b>datasource</b> ï¼šä»»ä½•æ•°æ®æºï¼ˆä¾‹å¦‚Prometheus-datasourceï¼ŒClickHouse-datasourceï¼ŒElasticSearch-datasourceï¼‰çš„æ’ä»¶è¿æ¥å™¨ã€‚ <br>  <b>app</b> ï¼šä¸€ä¸ªæ’ä»¶ï¼Œå¯è®©æ‚¨åœ¨Grafanaä¸­æ„å»ºè‡ªå·±çš„å‰ç«¯åº”ç”¨ç¨‹åºï¼Œåˆ›å»ºè‡ªå·±çš„htmlé¡µé¢å¹¶æ‰‹åŠ¨è®¿é—®æ•°æ®æºä»¥å¯è§†åŒ–å„ç§æ•°æ®ã€‚ å¦å¤–ï¼Œå…¶ä»–ç±»å‹çš„æ’ä»¶ï¼ˆæ•°æ®æºï¼Œé¢æ¿ï¼‰å’Œå„ç§ä»ªè¡¨æ¿ä¹Ÿå¯ä»¥ç”¨ä½œä¾èµ–é¡¹ã€‚ <br><br><img src="https://habrastorage.org/webt/x_/f-/3x/x_f-3x9bj18pz5zfvmx2yzg-9gg.png"><br>  <i>ç±»å‹= appçš„æ’ä»¶ä¾èµ–å…³ç³»ç¤ºä¾‹</i> ã€‚ <br><br> ä½œä¸ºä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œæ‚¨å¯ä»¥åŒæ—¶ä½¿ç”¨JavaScriptå’ŒTypeScriptï¼ˆæˆ‘ä»¬é€‰æ‹©äº†å®ƒï¼‰ã€‚ æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œæ‰¾åˆ°</a>ä»»ä½•ç±»å‹çš„hello-worldæ’ä»¶<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„</a>ç©ºç™½ï¼šåœ¨æ­¤å­˜å‚¨åº“ä¸­ï¼Œæœ‰å¤§é‡çš„é¢„è£…ç¨‹åºåŒ…ï¼ˆç”šè‡³åœ¨Reactä¸Šç”šè‡³æœ‰ä¸€ä¸ªå®éªŒæ€§çš„ç¤ºä¾‹ï¼‰ï¼Œè¿™äº›ç¨‹åºåŒ…éƒ½å·²é¢„å…ˆå®‰è£…å’Œé…ç½®äº†æ„å»ºå™¨ã€‚ <br><br><h4> ç¬¬2éƒ¨åˆ†ï¼šå‡†å¤‡æœ¬åœ°ç¯å¢ƒ </h4><br> è¦ä½¿ç”¨è¯¥æ’ä»¶ï¼Œæˆ‘ä»¬è‡ªç„¶éœ€è¦ä¸€ä¸ªå¸¦æœ‰æ‰€æœ‰é¢„è£…å·¥å…·çš„kubernetesé›†ç¾¤ï¼šprometheusï¼Œnode-exporterï¼Œkube-state-metricså’Œgrafanaã€‚ è¯¥ç¯å¢ƒåº”å¿«é€Ÿï¼Œè½»æ¾ä¸”è‡ªç„¶åœ°è¿›è¡Œè®¾ç½®ï¼Œå¹¶æä¾›çƒ­é‡è½½æ•°æ®ï¼Œåº”ç›´æ¥ä»å¼€å‘äººå‘˜çš„è®¡ç®—æœºä¸Šå®‰è£…Grafanaç›®å½•ã€‚ <br><br> æˆ‘ä»¬è®¤ä¸ºï¼Œä½¿ç”¨kubernetesåœ¨æœ¬åœ°å·¥ä½œæœ€æ–¹ä¾¿çš„æ–¹æ³•æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">minikube</a> ã€‚ ä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨prometheus-operatorå»ºç«‹Prometheus + Grafanaæ†ç»‘åŒ…ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬æ–‡</a>è¯¦ç»†ä»‹ç»äº†åœ¨minikubeä¸Šå®‰è£…prometheus-operatorçš„è¿‡ç¨‹ã€‚ è¦å¯ç”¨æŒä¹…æ€§ï¼Œå¿…é¡»åœ¨å›¾è¡¨/ grafana / values.yamlæ–‡ä»¶ä¸­è®¾ç½®<i>persistenceï¼štrue</i>å‚æ•°ï¼Œæ·»åŠ è‡ªå·±çš„PVå’ŒPVCå¹¶åœ¨persistence.existingClaimå‚æ•°ä¸­æŒ‡å®šå®ƒä»¬ <br><br> æœ€ç»ˆçš„minikubeå¯åŠ¨è„šæœ¬å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre><code class="plaintext hljs">minikube start --kubernetes-version=v1.13.4 --memory=4096 --bootstrapper=kubeadm --extra-config=scheduler.address=0.0.0.0 --extra-config=controller-manager.address=0.0.0.0 minikube mount /home/sergeisporyshev/Projects/Grafana:/var/grafana --gid=472 --uid=472 --9p-version=9p2000.L</code> </pre> <br><h4> ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¼€å‘æœ¬èº« </h4><br>  <b>å¯¹è±¡æ¨¡å‹</b> <br><br> åœ¨å‡†å¤‡å®ç°æ’ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å†³å®šä»¥TypeScriptç±»çš„å½¢å¼æè¿°å°†è¦ä½¿ç”¨çš„æ‰€æœ‰åŸºæœ¬Kuberneteså®ä½“ï¼špodï¼ŒDeploymentï¼Œdaemonsetï¼Œstatefulsetï¼Œjobï¼Œcronjobï¼Œserviceï¼Œnodeï¼Œnamespaceã€‚ è¿™äº›ç±»å‡ç»§æ‰¿è‡ªå…¬å…±BaseModelç±»ï¼Œè¯¥ç±»æè¿°äº†æ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°ï¼Œæ›´æ–°å’Œåˆ‡æ¢å¯è§æ€§çš„æ–¹æ³•ã€‚ æ¯ä¸ªç±»éƒ½æè¿°ä¸å…¶ä»–å®ä½“çš„åµŒå¥—å…³ç³»ï¼Œä¾‹å¦‚ï¼Œç±»å‹éƒ¨ç½²å®ä½“çš„Podåˆ—è¡¨ã€‚ <br><br><pre> <code class="plaintext hljs">import {Pod} from "./pod"; import {Service} from "./service"; import {BaseModel} from './traits/baseModel'; export class Deployment extends BaseModel{ pods: Array&lt;Pod&gt;; services: Array&lt;Service&gt;; constructor(data: any){ super(data); this.pods = []; this.services = []; } }</code> </pre> <br> ä½¿ç”¨getterå’Œsetterï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ–¹ä¾¿ä¸”æ˜“è¯»çš„æ–¹å¼æ˜¾ç¤ºæˆ–è®¾ç½®æ‰€éœ€å®ä½“çš„åº¦é‡ã€‚ ä¾‹å¦‚ï¼Œå¯åˆ†é…çš„cpuç‚¹å¤´çš„æ ¼å¼åŒ–è¾“å‡ºï¼š <br><br><pre> <code class="plaintext hljs">get cpuAllocatableFormatted(){ let cpu = this.data.status.allocatable.cpu; if(cpu.indexOf('m') &gt; -1){ cpu = parseInt(cpu)/1000; } return cpu; }</code> </pre> <br>  <b>é¡µæ•°</b> <br><br> æˆ‘ä»¬æ’ä»¶çš„æ‰€æœ‰é¡µé¢çš„åˆ—è¡¨æœ€åˆåœ¨pluing.jsonçš„ä¾èµ–é¡¹éƒ¨åˆ†ä¸­è¿›è¡Œäº†æè¿°ï¼š <br><br><img src="https://habrastorage.org/webt/vs/ij/b_/vsijb_avnlpat0ukzzgikcgmh4m.png"><br><br> åœ¨æ¯é¡µçš„å—ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡ç¤ºPAGE TITLEï¼ˆç„¶åå°†å…¶è½¬æ¢ä¸ºSlugï¼Œé€šè¿‡è¯¥æ ‡ç­¾å¯ä½¿ç”¨æ­¤é¡µé¢ï¼‰ï¼› è´Ÿè´£æ­¤é¡µé¢æ“ä½œçš„ç»„ä»¶çš„åç§°ï¼ˆç»„ä»¶åˆ—è¡¨å·²å¯¼å‡ºåˆ°module.tsï¼‰ï¼› æŒ‡å®šå¯ä»¥è®¿é—®è¯¥é¡µé¢çš„ç”¨æˆ·è§’è‰²ä»¥åŠä¾§è¾¹æ çš„å¯¼èˆªè®¾ç½®ã€‚ <br><br> åœ¨è´Ÿè´£é¡µé¢æ“ä½œçš„ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£…templateUrlï¼Œå¹¶åœ¨å…¶ä¸­ä¼ é€’å¸¦æœ‰æ ‡è®°çš„htmlæ–‡ä»¶çš„è·¯å¾„ã€‚ åœ¨æ§åˆ¶å™¨å†…éƒ¨ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬æœ€å¤šå¯ä»¥è®¿é—®2ä¸ªé‡è¦çš„è§’åº¦æœåŠ¡ï¼š <br><br><ul><li>  backendSrv-æä¾›ä¸grafana apiæœåŠ¡å™¨äº¤äº’çš„æœåŠ¡ï¼› </li><li>  datasourceSrv-ä¸€ç§æä¾›ä¸Grafanaä¸­å®‰è£…çš„æ‰€æœ‰æ•°æ®æºçš„æœ¬åœ°äº¤äº’çš„æœåŠ¡ï¼ˆä¾‹å¦‚.getAllï¼ˆï¼‰æ–¹æ³•-è¿”å›æ‰€æœ‰å·²å®‰è£…æ•°æ®æºçš„åˆ—è¡¨ï¼› .getï¼ˆ&lt;name&gt;ï¼‰-è¿”å›ç‰¹å®šæ•°æ®æºçš„å®ä¾‹å¯¹è±¡ï¼‰ã€‚ </li></ul><br><img src="https://habrastorage.org/webt/hd/ss/w8/hdssw8bsserz_p6ffzvuq49xbxs.png"><br><br><img src="https://habrastorage.org/webt/ps/we/ke/pswekesfljdpxjyedl4loxyuu_4.png"><br><br><img src="https://habrastorage.org/webt/aw/hv/ks/awhvksak5uamftrs_kwvbxdo71k.png"><br><br><h4> ç¬¬4éƒ¨åˆ†ï¼šæ•°æ®æº </h4><br> ä»Grafanaçš„è§’åº¦æ¥çœ‹ï¼Œæ•°æ®æºä¸å…¶ä»–æ‰€æœ‰äººå®Œå…¨ç›¸åŒï¼šå®ƒå…·æœ‰è‡ªå·±çš„å…¥å£ç‚¹module.jsï¼Œæœ‰ä¸€ä¸ªåŒ…å«å…ƒä¿¡æ¯plugin.jsonçš„æ–‡ä»¶ã€‚ å½“å¼€å‘ç±»å‹ä¸ºappçš„æ’ä»¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç°æœ‰æ•°æ®æºï¼ˆä¾‹å¦‚prometheus-datasourceï¼‰ä»¥åŠæˆ‘ä»¬è‡ªå·±çš„æ•°æ®æºè¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç›´æ¥å­˜å‚¨åœ¨æ’ä»¶ç›®å½•ï¼ˆdist / datasource / *ï¼‰ä¸­æˆ–è®¾ç½®ä¸ºä¾èµ–é¡¹ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ•°æ®æºå¸¦æœ‰æ’ä»¶ä»£ç ã€‚ è¿˜éœ€è¦æœ‰config.htmlæ¨¡æ¿å’ŒConfigCtrlæ§åˆ¶å™¨ï¼Œå®ƒä»¬å°†ç”¨äºæ•°æ®æºå®ä¾‹çš„é…ç½®é¡µé¢å’ŒDatasourceæ§åˆ¶å™¨ï¼Œè¯¥æ§åˆ¶å™¨å®ç°äº†æ•°æ®æºçš„é€»è¾‘ã€‚ <br><br> ä»ç”¨æˆ·ç•Œé¢çš„è§’åº¦æ¥çœ‹ï¼Œåœ¨KubeGrafæ’ä»¶ä¸­ï¼Œæ•°æ®æºæ˜¯kubernetesé›†ç¾¤çš„å®ä¾‹ï¼Œè¯¥é›†ç¾¤ä¸­å®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼ˆæºä»£ç å¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€šè¿‡å‚è€ƒè·å¾—</a> ï¼‰ï¼š <br><br><ul><li> ä»k8s apiæœåŠ¡å™¨æ”¶é›†æ•°æ®ï¼ˆè·å–å‘½åç©ºé—´'ovï¼Œdeployment'ov ...çš„åˆ—è¡¨ï¼‰ </li><li> åœ¨prometheus-datasourceï¼ˆåœ¨æ¯ä¸ªç‰¹å®šé›†ç¾¤çš„æ’ä»¶è®¾ç½®ä¸­é€‰æ‹©ï¼‰ä¸­ä»£ç†è¯·æ±‚ï¼Œå¹¶æ ¼å¼åŒ–å“åº”ä»¥åœ¨é™æ€é¡µé¢å’Œä»ªè¡¨æ¿ä¸­ä½¿ç”¨æ•°æ®ã€‚ </li><li> æ›´æ–°æ’ä»¶é™æ€é¡µé¢ä¸Šçš„æ•°æ®ï¼ˆè®¾ç½®åˆ·æ–°ç‡ï¼‰ã€‚ </li><li> å¤„ç†åœ¨grafanaä»ªè¡¨ç›˜ä¸­ç”Ÿæˆæ¨¡æ¿åˆ—è¡¨çš„è¯·æ±‚ï¼ˆ.metriFindQueryï¼ˆï¼‰æ–¹æ³•ï¼‰ </li></ul><br><img src="https://habrastorage.org/webt/m0/dp/eg/m0dpeghprcomipkozpjqmwle888.png"><br><br><img src="https://habrastorage.org/webt/kg/il/f5/kgilf58m2_urrtf9ad9cbdqoiby.png"><br><br><img src="https://habrastorage.org/webt/zh/em/xa/zhemxa8z6uu7mf6tflfbzqbuf-m.png"><br><br><ul><li> æµ‹è¯•ä¸æœ€ç»ˆk8sé›†ç¾¤çš„è¿æ¥ã€‚ </li></ul><br><br><pre> <code class="plaintext hljs">testDatasource(){ let url = '/api/v1/namespaces'; let _url = this.url; if(this.accessViaToken) _url += '/__proxy'; _url += url; return this.backendSrv.datasourceRequest({ url: _url, method: "GET", headers: {"Content-Type": 'application/json'} }) .then(response =&gt; { if (response.status === 200) { return {status: "success", message: "Data source is OK", title: "Success"}; }else{ return {status: "error", message: "Data source is not OK", title: "Error"}; } }, error =&gt; { return {status: "error", message: "Data source is not OK", title: "Error"}; }) }</code> </pre> <br> æˆ‘ä»¬è®¤ä¸ºï¼Œå¦ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜æ˜¯æ•°æ®æºèº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶çš„å®ç°ã€‚ é€šå¸¸ï¼Œå¼€ç®±å³ç”¨åœ°é…ç½®å¯¹æœ€ç»ˆæ•°æ®æºçš„è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…ç½®çš„Grafanaç»„ä»¶-datasourceHttpSettingsã€‚ ä½¿ç”¨æ­¤ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®šurlå’ŒåŸºæœ¬èº«ä»½éªŒè¯/æˆæƒè®¾ç½®ï¼ˆç™»å½•å¯†ç æˆ–client-cert / client-keyï¼‰æ¥é…ç½®å¯¹httpæ•°æ®æºçš„è®¿é—®ã€‚ ä¸ºäº†å®ç°ä½¿ç”¨æ‰¿è½½ä»¤ç‰Œï¼ˆå®é™…ä¸Šæ˜¯k8sçš„æ ‡å‡†ï¼‰é…ç½®è®¿é—®çš„èƒ½åŠ›ï¼Œæˆ‘ä¸å¾—ä¸åšä¸€ç‚¹â€œåŒ–å­¦â€æ“ä½œã€‚ <br><br> è¦è§£å†³æ­¤é—®é¢˜ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Grafanaçš„å†…ç½®â€œæ’ä»¶è·¯ç”±â€æœºåˆ¶ï¼ˆæ›´å¤šä¿¡æ¯è¯·å‚è§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£é¡µé¢</a> ï¼‰ã€‚ åœ¨æ•°æ®æºçš„è®¾ç½®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ç»„è·¯ç”±è§„åˆ™ï¼Œè¿™äº›è§„åˆ™å°†ç”±grafanaä»£ç†æœåŠ¡å™¨å¤„ç†ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºæ¯ä¸ªå•ç‹¬çš„ç«¯ç‚¹ï¼Œéƒ½å¯ä»¥å°†æ ‡å¤´æˆ–urlé™„åŠ ä¸ºæ¨¡æ¿çš„èƒ½åŠ›ï¼Œå¯ä»¥ä»jsonDataå’ŒsecureJsonDataå­—æ®µï¼ˆç”¨äºä»¥åŠ å¯†å½¢å¼å­˜å‚¨å¯†ç æˆ–ä»¤ç‰Œï¼‰è·å–æ•°æ®ã€‚ åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå½¢å¼ä¸º<i>/ __ proxy / api / v1 /åç§°ç©ºé—´çš„</i>è¯·æ±‚å°†è¢«ä»£ç†åˆ°å½¢å¼çš„url <br>  &lt;your_k8s_api_url&gt; / api / v1 /å…·æœ‰Authorizationï¼šBeareræ ‡å¤´çš„åç§°ç©ºé—´ã€‚ <br><br><img src="https://habrastorage.org/webt/ht/xt/nm/htxtnmm0hw6xg0wutfdr11kx1a4.png"><br><br><img src="https://habrastorage.org/webt/mj/z8/ra/mjz8razkuln7puiqzwuplxhfqc4.png"><br><br> è‡ªç„¶åœ°ï¼Œè¦ä½¿ç”¨k8s apiæœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…·æœ‰åªè¯»è®¿é—®æƒé™çš„ç”¨æˆ·ï¼Œä»¥åŠç”¨äºåˆ›å»ºæ¸…å•çš„ç”¨æˆ·ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ’ä»¶</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æºä»£ç ä¸­</a>æ‰¾åˆ°è¯¥æ¸…å•ã€‚ <br><br><h4> ç¬¬5éƒ¨åˆ†ï¼šå‘å¸ƒ </h4><br><img src="https://habrastorage.org/webt/wx/hb/bl/wxhbbl4dw6dszbcic1hhe9g5pte.jpeg"><br><br> åœ¨ä¸ºGrafanaç¼–å†™è‡ªå·±çš„æ’ä»¶ä¹‹åï¼Œæ‚¨è‡ªç„¶ä¼šå¸Œæœ›å°†å…¶æ”¾å…¥å…¬å…±é¢†åŸŸã€‚  Grafanaæ˜¯ä¸€ä¸ªå¯åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">grafana.com/grafana/pluginsä¸Š</a>ä½¿ç”¨çš„æ’ä»¶åº“ <br><br> ä¸ºäº†ä½¿æ‚¨çš„æ’ä»¶åœ¨å®˜æ–¹å•†åº—ä¸­å¯ç”¨ï¼Œæ‚¨éœ€è¦é€šè¿‡åœ¨repo.jsonæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹æ¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å­˜å‚¨åº“ä¸­</a>æ‰§è¡ŒPRï¼š <br><br><img src="https://habrastorage.org/webt/bk/cf/nt/bkcfntnwmmnx8scgebsbtxpgjfk.png"><br><br> å…¶ä¸­versionæ˜¯æ‚¨æ’ä»¶çš„ç‰ˆæœ¬ï¼Œurlæ˜¯å­˜å‚¨åº“çš„é“¾æ¥ï¼Œcommitæ˜¯æäº¤çš„å“ˆå¸Œï¼Œé€šè¿‡è¯¥å“ˆå¸Œå¯ä»¥ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„æ’ä»¶ã€‚ <br><br> åœ¨å‡ºå£å¤„ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€å¼ ç²¾ç¾çš„è¡¨æ ¼ï¼š <br><br><img src="https://habrastorage.org/webt/j3/cb/ul/j3cbulols6yx4buc_ysgd9qffdo.png"><br><br> å®ƒçš„æ•°æ®å°†è‡ªåŠ¨ä»æ‚¨çš„Readme.mdï¼ŒChangelog.mdå’Œå¸¦æœ‰æ’ä»¶è¯´æ˜çš„plugin.jsonæ–‡ä»¶ä¸­è·å–ã€‚ <br><br><h4> ç¬¬å…­éƒ¨åˆ†ï¼šä»£æ›¿ç»“è®º </h4><br> å‘å¸ƒåï¼Œæˆ‘ä»¬æ²¡æœ‰åœæ­¢å¼€å‘æ’ä»¶ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬æ­£åœ¨åŠªåŠ›æ­£ç¡®ç›‘æ§ç¾¤é›†èŠ‚ç‚¹èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œå¼•å…¥æ–°åŠŸèƒ½ä»¥å¢åŠ UXï¼Œä»¥åŠåœ¨å®‰è£…å®¢æˆ·ç«¯å’Œgithubä¸Šçš„ishuiæ’ä»¶åæ”¶åˆ°çš„å¤§é‡åé¦ˆï¼ˆå¦‚æœæ‚¨ç•™ä¸‹é—®é¢˜æˆ–è¯·æ±‚ï¼Œæˆ‘æˆ‘ä¼šå¾ˆé«˜å…´çš„:-)ï¼‰ã€‚ <br><br> æˆ‘ä»¬å¸Œæœ›æœ¬æ–‡å°†å¸®åŠ©æ‚¨äº†è§£Grafanaè¿™æ ·çš„å‡ºè‰²å·¥å…·ï¼Œå¹¶å¯èƒ½ç¼–å†™è‡ªå·±çš„æ’ä»¶ã€‚ <br><br> è°¢è°¢ï¼ï¼‰ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN474500/">https://habr.com/ru/post/zh-CN474500/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN474490/index.html">æ—¶æœºå·²åˆ°ï¼šCocleané¼»è…”å¸å¼•å™¨æ¦‚è¿°</a></li>
<li><a href="../zh-CN474492/index.html">ä¸Chatixåç«¯è¿›è¡Œå¤šç”¨æˆ·èŠå¤©</a></li>
<li><a href="../zh-CN474494/index.html">2019å¹´Zabbixå³°ä¼šæ€ä¹ˆæ ·</a></li>
<li><a href="../zh-CN474496/index.html">HighLoad ++ 2019ä¸Šçš„æ•°æ®åº“</a></li>
<li><a href="../zh-CN474498/index.html">JavaFXæ•™ç¨‹ï¼šHello World</a></li>
<li><a href="../zh-CN474502/index.html">Odnoklassnikiåœ¨Joker 2019ä¸Šçš„è§£æ</a></li>
<li><a href="../zh-CN474504/index.html">æ­£ç»Ÿåç«¯</a></li>
<li><a href="../zh-CN474508/index.html">æ¤çš®3Dç”Ÿç‰©æ‰“å°çš„æˆå°±</a></li>
<li><a href="../zh-CN474514/index.html">ä¸­å›½æ¯”ç‰¹å¸é‡‡çŸ¿å¤§äº¨å¦‚ä½•ç”Ÿå­˜</a></li>
<li><a href="../zh-CN474516/index.html">è¯­éŸ³åº”ç”¨ï¼šä¿„ç½—æ–¯æ²¡æœ‰æ³¨æ„åˆ°çš„åäº¿ä¸ªå¸‚åœº</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>