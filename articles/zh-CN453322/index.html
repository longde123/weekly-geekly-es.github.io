<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ© ğŸ™‹ğŸ¾ ğŸ‘¨ğŸ¾â€ğŸ¨ ä½¿ç”¨Consulé…ç½®Nomadé›†ç¾¤å¹¶ä¸Gitlabé›†æˆ ğŸ‘©ğŸ»â€ğŸ¤ ğŸ‘¨ğŸ¿â€ğŸŒ¾ ğŸ‘¨ğŸ»â€ğŸ’¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 

 æœ€è¿‘ï¼ŒKubernetesçš„æ™®åŠè¿…é€Ÿå¢é•¿-è¶Šæ¥è¶Šå¤šçš„é¡¹ç›®æ­£åœ¨å›½å†…å®æ–½å®ƒã€‚ æˆ‘æƒ³è°ˆè°ˆåƒNomadè¿™æ ·çš„åè°ƒå™¨ï¼šå®ƒéå¸¸é€‚åˆå·²ç»ä½¿ç”¨HashiCorpçš„å…¶ä»–è§£å†³æ–¹æ¡ˆçš„é¡¹ç›®ï¼Œä¾‹å¦‚Vaultå’ŒConsulï¼Œå¹¶ä¸”é¡¹ç›®æœ¬èº«åœ¨åŸºç¡€æ¶æ„æ–¹é¢å¹¶ä¸å¤æ‚ã€‚ æœ¬æ–‡å°†æä¾›æœ‰å…³å®‰è£…Nomadï¼Œå°†ä¸¤ä¸ªèŠ‚ç‚¹ç»„åˆåˆ°ç¾¤é›†ä¸­ä»¥...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨Consulé…ç½®Nomadé›†ç¾¤å¹¶ä¸Gitlabé›†æˆ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453322/"><h2> å¼•è¨€ </h2><br><br> æœ€è¿‘ï¼ŒKubernetesçš„æ™®åŠè¿…é€Ÿå¢é•¿-è¶Šæ¥è¶Šå¤šçš„é¡¹ç›®æ­£åœ¨å›½å†…å®æ–½å®ƒã€‚ æˆ‘æƒ³è°ˆè°ˆåƒNomadè¿™æ ·çš„åè°ƒå™¨ï¼šå®ƒéå¸¸é€‚åˆå·²ç»ä½¿ç”¨HashiCorpçš„å…¶ä»–è§£å†³æ–¹æ¡ˆçš„é¡¹ç›®ï¼Œä¾‹å¦‚Vaultå’ŒConsulï¼Œå¹¶ä¸”é¡¹ç›®æœ¬èº«åœ¨åŸºç¡€æ¶æ„æ–¹é¢å¹¶ä¸å¤æ‚ã€‚ æœ¬æ–‡å°†æä¾›æœ‰å…³å®‰è£…Nomadï¼Œå°†ä¸¤ä¸ªèŠ‚ç‚¹ç»„åˆåˆ°ç¾¤é›†ä¸­ä»¥åŠå°†Nomadä¸Gitlabé›†æˆçš„è¯´æ˜ã€‚ <br><br><img src="https://habrastorage.org/webt/bu/yn/4v/buyn4vqshurhgc9kavloja-fzsm.png"><br><br><a name="habracut"></a><br><br><h2> è¯•éªŒå° </h2><br><br> å…³äºæµ‹è¯•å¹³å°çš„ä¸€ç‚¹ç‚¹ï¼šä½¿ç”¨äº†ä¸‰ä¸ªè™šæ‹ŸæœåŠ¡å™¨ï¼Œå®ƒä»¬å…·æœ‰2ä¸ªCPUï¼Œ4ä¸ªRAMï¼Œ50 Gb SSDçš„ç‰¹å¾ï¼Œå¹¶ç»“åˆåœ¨ä¸€ä¸ªé€šç”¨çš„æœ¬åœ°ç½‘ç»œä¸­ã€‚ å®ƒä»¬çš„åç§°å’ŒIPåœ°å€ï¼š <br><br><ol><li>  <b>nomad-livelinux-01</b> ï¼š172.30.0.5 </li><li>  <b>nomad-livelinux-02</b> ï¼š172.30.0.10 </li><li>  <b>consul-livelinux-01</b> ï¼š172.30.0.15 </li></ol><br><br><h2> æ¸¸ç‰§æ°‘çš„å®‰è£…ï¼Œé¢†äº‹ã€‚ åˆ›å»ºæ¸¸ç‰§é›†ç¾¤ </h2><br><br> è®©æˆ‘ä»¬ç»§ç»­åŸºæœ¬å®‰è£…ã€‚ å°½ç®¡å®‰è£…å¾ˆå®¹æ˜“ï¼Œä½†ä¸ºäº†ä¿è¯æ–‡ç« çš„å®Œæ•´æ€§ï¼Œæˆ‘å°†å¯¹å…¶è¿›è¡Œæè¿°ï¼šå®é™…ä¸Šï¼Œå®ƒæ˜¯æ ¹æ®è‰ç¨¿å’Œæ³¨é‡Šåˆ›å»ºçš„ï¼Œä»¥ä¾¿åœ¨å¿…è¦æ—¶è¿›è¡Œå¿«é€Ÿè®¿é—®ã€‚ <br><br> åœ¨å¼€å§‹ç»ƒä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬å°†è®¨è®ºç†è®ºéƒ¨åˆ†ï¼Œå› ä¸ºåœ¨æ­¤é˜¶æ®µï¼Œäº†è§£æœªæ¥çš„ç»“æ„å¾ˆé‡è¦ã€‚ <br><br> æˆ‘ä»¬æœ‰ä¸¤ä¸ªNomadèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å®ƒä»¬ç»„åˆæˆä¸€ä¸ªé›†ç¾¤ï¼Œå¹¶ä¸”åœ¨å°†æ¥ï¼Œæˆ‘ä»¬å°†éœ€è¦è‡ªåŠ¨ç¼©æ”¾é›†ç¾¤-ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦Consulã€‚ ä½¿ç”¨æ­¤å·¥å…·ï¼Œç¾¤é›†å’Œæ·»åŠ æ–°èŠ‚ç‚¹å˜å¾—éå¸¸ç®€å•ï¼šåˆ›å»ºçš„NomadèŠ‚ç‚¹è¿æ¥åˆ°Consulä»£ç†ï¼Œç„¶åè¿æ¥åˆ°ç°æœ‰çš„Nomadç¾¤é›†ã€‚ å› æ­¤ï¼Œä¸€å¼€å§‹æˆ‘ä»¬å°†å®‰è£…ConsulæœåŠ¡å™¨ï¼Œä¸ºWebé¢æ¿é…ç½®åŸºæœ¬çš„httpæˆæƒï¼ˆé»˜è®¤æƒ…å†µä¸‹æœªç»æˆæƒå³å¯è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡å¤–éƒ¨åœ°å€è®¿é—®ï¼‰ï¼Œä»¥åŠåœ¨NomadæœåŠ¡å™¨ä¸Šçš„Consulä»£ç†æœ¬èº«ï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨Nomadã€‚ <br><br> å®‰è£…HashiCorpå·¥å…·éå¸¸ç®€å•ï¼šå®é™…ä¸Šï¼Œæˆ‘ä»¬åªéœ€å°†äºŒè¿›åˆ¶æ–‡ä»¶ç§»è‡³binç›®å½•ï¼Œé…ç½®å·¥å…·çš„é…ç½®æ–‡ä»¶å¹¶åˆ›å»ºå…¶æœåŠ¡æ–‡ä»¶ã€‚ <br><br> ä¸‹è½½ConsuläºŒè¿›åˆ¶æ–‡ä»¶å¹¶å°†å…¶è§£å‹ç¼©åˆ°ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­ï¼š <br><br><pre><code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># wget https://releases.hashicorp.com/consul/1.5.0/consul_1.5.0_linux_amd64.zip root@consul-livelinux-01:~# unzip consul_1.5.0_linux_amd64.zip root@consul-livelinux-01:~# mv consul /usr/local/bin/</span></span></code> </pre> <br><br> ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªç°æˆçš„äºŒè¿›åˆ¶é¢†äº‹æ–‡ä»¶ï¼Œç”¨äºè¿›ä¸€æ­¥çš„é…ç½®ã€‚ <br><br> è¦ä½¿ç”¨Consulï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨keygenå‘½ä»¤åˆ›å»ºä¸€ä¸ªå”¯ä¸€å¯†é’¥ï¼š <br><br><pre> <code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># consul keygen</span></span></code> </pre><br><br> è®©æˆ‘ä»¬ç»§ç»­é…ç½®Consulï¼Œä½¿ç”¨ä»¥ä¸‹ç»“æ„åˆ›å»º/etc/consul.d/ç›®å½•ï¼š <br><br><pre> <code class="bash hljs">/etc/consul.d/ â”œâ”€â”€ bootstrap â”‚ â””â”€â”€ config.json</code> </pre> <br><br>  bootstrapç›®å½•å°†åŒ…å«config.jsoné…ç½®æ–‡ä»¶-åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å°†è®¾ç½®Consulè®¾ç½®ã€‚ å…¶å†…å®¹ï¼š <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"bootstrap"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"server"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"datacenter"</span></span>: <span class="hljs-string"><span class="hljs-string">"dc1"</span></span>, <span class="hljs-string"><span class="hljs-string">"data_dir"</span></span>: <span class="hljs-string"><span class="hljs-string">"/var/consul"</span></span>, <span class="hljs-string"><span class="hljs-string">"encrypt"</span></span>: <span class="hljs-string"><span class="hljs-string">"your-key"</span></span>, <span class="hljs-string"><span class="hljs-string">"log_level"</span></span>: <span class="hljs-string"><span class="hljs-string">"INFO"</span></span>, <span class="hljs-string"><span class="hljs-string">"enable_syslog"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"start_join"</span></span>: [<span class="hljs-string"><span class="hljs-string">"172.30.0.15"</span></span>] }</code> </pre> <br><br> è®©æˆ‘ä»¬åˆ†åˆ«æ£€æŸ¥ä¸»è¦æŒ‡ä»¤åŠå…¶å«ä¹‰ï¼š <br><br><ul><li>  <b>bootstrap</b> ï¼šæ˜¯çš„ã€‚ å¦‚æœæ–°èŠ‚ç‚¹å·²è¿æ¥ï¼Œæˆ‘ä»¬å°†æ‰“å¼€å®ƒä»¬çš„è‡ªåŠ¨æ·»åŠ åŠŸèƒ½ã€‚ æˆ‘æ³¨æ„åˆ°æˆ‘ä»¬åœ¨è¿™é‡Œæ²¡æœ‰æŒ‡å‡ºé¢„æœŸèŠ‚ç‚¹çš„ç¡®åˆ‡æ•°ç›®ã€‚ </li><li>  <b>æœåŠ¡å™¨</b> ï¼šæ˜¯çš„ã€‚ æ‰“å¼€æœåŠ¡å™¨æ¨¡å¼ã€‚ ç›®å‰ï¼Œæ­¤è™šæ‹Ÿæœºä¸Šçš„Consulå°†æ˜¯å”¯ä¸€çš„æœåŠ¡å™¨å’Œä¸»æœåŠ¡å™¨ï¼ŒVM Nomadå°†æ˜¯å®¢æˆ·ç«¯ã€‚ </li><li>  <b>æ•°æ®ä¸­å¿ƒ</b> ï¼šdc1ã€‚ æŒ‡å®šæ•°æ®ä¸­å¿ƒçš„åç§°ä»¥åˆ›å»ºé›†ç¾¤ã€‚ åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šï¼Œå®ƒå¿…é¡»ç›¸åŒã€‚ </li><li>  <b>åŠ å¯†</b> ï¼šæ‚¨çš„å¯†é’¥ã€‚ å¯†é’¥ä¹Ÿå¿…é¡»å”¯ä¸€ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šéƒ½å¿…é¡»åŒ¹é…ã€‚ ä½¿ç”¨consul keygenå‘½ä»¤ç”Ÿæˆã€‚ </li><li>  <b>start_join</b> ã€‚ åœ¨æ­¤åˆ—è¡¨ä¸­ï¼Œæˆ‘ä»¬æŒ‡ç¤ºå°†å»ºç«‹è¿æ¥çš„IPåœ°å€åˆ—è¡¨ã€‚ ç›®å‰ï¼Œæˆ‘ä»¬åªç•™ä¸‹æˆ‘ä»¬è‡ªå·±çš„åœ°å€ã€‚ </li></ul><br><br> åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨é¢†äº‹ï¼š <br><br><pre> <code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># /usr/local/bin/consul agent -config-dir /etc/consul.d/bootstrap -ui</span></span></code> </pre> <br><br> è¿™æ˜¯ç°åœ¨è¿›è¡Œè°ƒè¯•çš„å¥½æ–¹æ³•ï¼Œä½†æ˜¯ï¼Œç”±äºæ˜¾è€Œæ˜“è§çš„åŸå› ï¼Œä½¿ç”¨è¯¥æ–¹æ³•å°†ä¸€ç›´æ— æ³•ä½¿ç”¨ã€‚ åˆ›å»ºç”¨äºé€šè¿‡systemdç®¡ç†Consulçš„æœåŠ¡æ–‡ä»¶ï¼š <br><br><pre> <code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># nano /etc/systemd/system/consul.service</span></span></code> </pre><br><br>  consul.serviceæ–‡ä»¶çš„å†…å®¹ï¼š <br><br><pre> <code class="bash hljs">[Unit] Description=Consul Startup process After=network.target [Service] Type=simple ExecStart=/bin/bash -c <span class="hljs-string"><span class="hljs-string">'/usr/local/bin/consul agent -config-dir /etc/consul.d/bootstrap -ui'</span></span> TimeoutStartSec=0 [Install] WantedBy=default.target</code> </pre> <br><br> é€šè¿‡systemctlè¿è¡ŒConsulï¼š <br><br><pre> <code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># systemctl start consul</span></span></code> </pre><br><br> æˆ‘ä»¬æ£€æŸ¥ï¼šåº”è¯¥å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡ï¼Œå¹¶ä¸”é€šè¿‡æ‰§è¡Œconsul Memberså‘½ä»¤ï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼š <br><br><pre> <code class="bash hljs">root@consul-livelinux:/etc/consul.d<span class="hljs-comment"><span class="hljs-comment"># consul members consul-livelinux 172.30.0.15:8301 alive server 1.5.0 2 dc1 &lt;all&gt;</span></span></code> </pre> <br><br> ä¸‹ä¸€æ­¥ï¼šå®‰è£…Nginxå¹¶è®¾ç½®ä»£ç†ï¼Œhttpæˆæƒã€‚ é€šè¿‡ç¨‹åºåŒ…ç®¡ç†å™¨å®‰è£…nginxå¹¶åœ¨/ etc / nginx / sites-enabledç›®å½•ä¸­åˆ›å»ºé…ç½®æ–‡ä»¶consul.confï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> consul-auth { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> localhost:<span class="hljs-number"><span class="hljs-number">8500</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> consul.doman.name; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://consul-auth; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">auth_basic_user_file</span></span> /etc/nginx/.htpasswd; <span class="hljs-attribute"><span class="hljs-attribute">auth_basic</span></span> <span class="hljs-string"><span class="hljs-string">"Password-protected Area"</span></span>; } }</code> </pre> <br><br> ä¸è¦å¿˜è®°åˆ›å»º.htpasswdæ–‡ä»¶å¹¶ä¸ºå…¶ç”Ÿæˆç”¨æˆ·åå’Œå¯†ç ã€‚ æ­¤é¡¹æ˜¯å¿…å¡«é¡¹ï¼Œå› æ­¤è®¤è¯†æˆ‘ä»¬åŸŸçš„æ¯ä¸ªäººéƒ½æ— æ³•è®¿é—®Webé¢æ¿ã€‚ ä½†æ˜¯ï¼Œåœ¨é…ç½®Gitlabæ—¶ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸æ”¾å¼ƒè¿™ä¸€ç‚¹-å¦åˆ™æˆ‘ä»¬å°†æ— æ³•å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°Nomadã€‚ åœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼ŒGitlabå’ŒNomadéƒ½ä»…ä½äºç°è‰²ç½‘ç»œä¸Šï¼Œå› æ­¤æ²¡æœ‰æ­¤ç±»é—®é¢˜ã€‚ <br><br> åœ¨å…¶ä»–ä¸¤å°æœåŠ¡å™¨ä¸Šï¼Œæ ¹æ®ä»¥ä¸‹è¯´æ˜å®‰è£…Consulä»£ç†ã€‚ å¯¹äºŒè¿›åˆ¶æ–‡ä»¶é‡å¤ä¸Šè¿°æ­¥éª¤ï¼š <br><br><pre> <code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># wget https://releases.hashicorp.com/consul/1.5.0/consul_1.5.0_linux_amd64.zip root@nomad-livelinux-01:~# unzip consul_1.5.0_linux_amd64.zip root@nomad-livelinux-01:~# mv consul /usr/local/bin/</span></span></code> </pre> <br><br> ä¸å…ˆå‰çš„æœåŠ¡å™¨ç±»ä¼¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹ç»“æ„ä¸ºé…ç½®æ–‡ä»¶/etc/consul.dåˆ›å»ºç›®å½•ï¼š <br><br><pre> <code class="bash hljs">/etc/consul.d/ â”œâ”€â”€ client â”‚ â””â”€â”€ config.json</code> </pre> <br><br>  config.jsonæ–‡ä»¶çš„å†…å®¹ï¼š <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"datacenter"</span></span>: <span class="hljs-string"><span class="hljs-string">"dc1"</span></span>, <span class="hljs-string"><span class="hljs-string">"data_dir"</span></span>: <span class="hljs-string"><span class="hljs-string">"/opt/consul"</span></span>, <span class="hljs-string"><span class="hljs-string">"log_level"</span></span>: <span class="hljs-string"><span class="hljs-string">"DEBUG"</span></span>, <span class="hljs-string"><span class="hljs-string">"node_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"nomad-livelinux-01"</span></span>, <span class="hljs-string"><span class="hljs-string">"server"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"encrypt"</span></span>: <span class="hljs-string"><span class="hljs-string">"your-private-key"</span></span>, <span class="hljs-string"><span class="hljs-string">"domain"</span></span>: <span class="hljs-string"><span class="hljs-string">"livelinux"</span></span>, <span class="hljs-string"><span class="hljs-string">"addresses"</span></span>: { <span class="hljs-string"><span class="hljs-string">"dns"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"https"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"grpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"http"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span> }, <span class="hljs-string"><span class="hljs-string">"bind_addr"</span></span>: <span class="hljs-string"><span class="hljs-string">"172.30.0.5"</span></span>, #    <span class="hljs-string"><span class="hljs-string">"start_join"</span></span>: [<span class="hljs-string"><span class="hljs-string">"172.30.0.15"</span></span>], #     <span class="hljs-string"><span class="hljs-string">"ports"</span></span>: { <span class="hljs-string"><span class="hljs-string">"dns"</span></span>: <span class="hljs-number"><span class="hljs-number">53</span></span> } }</code> </pre><br><br> æˆ‘ä»¬ä¿å­˜æ›´æ”¹å¹¶ç»§ç»­é…ç½®æœåŠ¡æ–‡ä»¶ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š <br><br>  /etc/systemd/system/consul.serviceï¼š <br><br><pre> <code class="bash hljs">[Unit] Description=<span class="hljs-string"><span class="hljs-string">"HashiCorp Consul - A service mesh solution"</span></span> Documentation=https://www.consul.io/ Requires=network-online.target After=network-online.target [Service] User=root Group=root ExecStart=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/consul agent -config-dir=/etc/consul.d/client ExecReload=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/consul reload KillMode=process Restart=on-failure [Install] WantedBy=multi-user.target</code> </pre> <br><br> æˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨é¢†äº‹ã€‚ ç°åœ¨ï¼Œåœ¨å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥åœ¨nsulæˆå‘˜ä¸­çœ‹åˆ°å·²é…ç½®çš„æœåŠ¡ã€‚ è¿™å°†æ„å‘³ç€ä»–ä»¥å®¢æˆ·ç«¯èº«ä»½æˆåŠŸè¿æ¥åˆ°é›†ç¾¤ã€‚ åœ¨ç¬¬äºŒå°æœåŠ¡å™¨ä¸Šé‡å¤åŒæ ·çš„æ“ä½œï¼Œç„¶åæˆ‘ä»¬å°†èƒ½å¤Ÿå¼€å§‹å®‰è£…å’Œé…ç½®Nomadã€‚ <br><br>  Nomadçš„æ­£å¼æ–‡æ¡£ä¸­æœ‰æ›´è¯¦ç»†çš„å®‰è£…è¯´æ˜ã€‚ ä¼ ç»Ÿçš„å®‰è£…æ–¹æ³•æœ‰ä¸¤ç§ï¼šä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶å’Œä»æºä»£ç è¿›è¡Œç¼–è¯‘ã€‚ æˆ‘å°†é€‰æ‹©ç¬¬ä¸€ç§æ–¹æ³•ã€‚ <br><br>  <b>æ³¨æ„</b> ï¼šé¡¹ç›®å‘å±•éå¸¸å¿«ï¼Œç»å¸¸ä¼šå‡ºç°æ–°çš„æ›´æ–°ã€‚ ä¹Ÿè®¸åˆ°æœ¬æ–‡å®Œæˆæ—¶ï¼Œå°†å‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚ å› æ­¤ï¼Œæˆ‘å»ºè®®é˜…è¯»ä¹‹å‰å…ˆæ£€æŸ¥Nomadçš„å½“å‰ç‰ˆæœ¬å¹¶ä¸‹è½½ã€‚ <br><br><pre> <code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># wget https://releases.hashicorp.com/nomad/0.9.1/nomad_0.9.1_linux_amd64.zip root@nomad-livelinux-01:~# unzip nomad_0.9.1_linux_amd64.zip root@nomad-livelinux-01:~# mv nomad /usr/local/bin/ root@nomad-livelinux-01:~# nomad -autocomplete-install root@nomad-livelinux-01:~# complete -C /usr/local/bin/nomad nomad root@nomad-livelinux-01:~# mkdir /etc/nomad.d</span></span></code> </pre> <br><br> è§£å‹ç¼©åï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªNomad'aäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå…¶å¤§å°ä¸º65 MB-å¿…é¡»å°†å…¶ç§»åŠ¨åˆ°/ usr / local / binã€‚ <br><br> ä¸ºNomadåˆ›å»ºæ•°æ®ç›®å½•å¹¶ç¼–è¾‘å…¶æœåŠ¡æ–‡ä»¶ï¼ˆå¾ˆå¯èƒ½åœ¨ä¸€å¼€å§‹å°±ä¸å­˜åœ¨ï¼‰ï¼š <br><br><pre> <code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># mkdir --parents /opt/nomad root@nomad-livelinux-01:~# nano /etc/systemd/system/nomad.service</span></span></code> </pre> <br><br> åœ¨å…¶ä¸­æ’å…¥ä»¥ä¸‹è¡Œï¼š <br><br><pre> <code class="bash hljs">[Unit] Description=Nomad Documentation=https://nomadproject.io/docs/ Wants=network-online.target After=network-online.target [Service] ExecReload=/bin/<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> -HUP <span class="hljs-variable"><span class="hljs-variable">$MAINPID</span></span> ExecStart=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/nomad agent -config /etc/nomad.d KillMode=process KillSignal=SIGINT LimitNOFILE=infinity LimitNPROC=infinity Restart=on-failure RestartSec=2 StartLimitBurst=3 StartLimitIntervalSec=10 TasksMax=infinity [Install] WantedBy=multi-user.target</code> </pre> <br><br> ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸æ€¥äºè¿è¡Œnomad-æˆ‘ä»¬å°šæœªåˆ›å»ºå…¶é…ç½®æ–‡ä»¶ï¼š <br><br><pre> <code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># mkdir --parents /etc/nomad.d root@nomad-livelinux-01:~# chmod 700 /etc/nomad.d root@nomad-livelinux-01:~# nano /etc/nomad.d/nomad.hcl root@nomad-livelinux-01:~# nano /etc/nomad.d/server.hcl</span></span></code> </pre><br><br> æœ€ç»ˆç›®å½•ç»“æ„å¦‚ä¸‹ï¼š <br><br><pre> <code class="bash hljs">/etc/nomad.d/ â”œâ”€â”€ nomad.hcl â””â”€â”€ server.hcl</code> </pre> <br><br>  nomad.hclæ–‡ä»¶åº”åŒ…å«ä»¥ä¸‹é…ç½®ï¼š <br><br><pre> <code class="bash hljs">datacenter = <span class="hljs-string"><span class="hljs-string">"dc1"</span></span> data_dir = <span class="hljs-string"><span class="hljs-string">"/opt/nomad"</span></span></code> </pre> <br><br>  server.hclæ–‡ä»¶çš„å†…å®¹ï¼š <br><br><pre> <code class="bash hljs">server { enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> bootstrap_expect = 1 } consul { address = <span class="hljs-string"><span class="hljs-string">"127.0.0.1:8500"</span></span> server_service_name = <span class="hljs-string"><span class="hljs-string">"nomad"</span></span> client_service_name = <span class="hljs-string"><span class="hljs-string">"nomad-client"</span></span> auto_advertise = <span class="hljs-literal"><span class="hljs-literal">true</span></span> server_auto_join = <span class="hljs-literal"><span class="hljs-literal">true</span></span> client_auto_join = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } bind_addr = <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span> advertise { http = <span class="hljs-string"><span class="hljs-string">"172.30.0.5"</span></span> } client { enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br><br> ä¸è¦å¿˜è®°åœ¨ç¬¬äºŒå°æœåŠ¡å™¨ä¸Šæ›´æ”¹é…ç½®æ–‡ä»¶-åœ¨é‚£æ‚¨å°†éœ€è¦æ›´æ”¹httpæŒ‡ä»¤çš„å€¼ã€‚ <br><br> æ­¤é˜¶æ®µçš„æœ€åä¸€ä¸ªæ˜¯Nginxçš„é…ç½®ï¼Œç”¨äºä»£ç†å’Œè®¾ç½®httpæˆæƒã€‚  nomad.confæ–‡ä»¶çš„å†…å®¹ï¼š <br><br><pre> <code class="bash hljs">upstream nomad-auth { server 172.30.0.5:4646; } server { server_name nomad.domain.name; location / { proxy_pass http://nomad-auth; proxy_set_header Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; auth_basic_user_file /etc/nginx/.htpasswd; auth_basic <span class="hljs-string"><span class="hljs-string">"Password-protected Area"</span></span>; } }</code> </pre> <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¤–éƒ¨ç½‘ç»œè®¿é—®Webé¢æ¿ã€‚ æˆ‘ä»¬è¿æ¥å¹¶è½¬åˆ°æœåŠ¡å™¨é¡µé¢ï¼š <br><br><img src="https://habrastorage.org/webt/en/uq/ck/enuqck8krqstsbt8b6uwbytoy0e.png"><br>  <b>å›¾1.</b> Nomadç¾¤é›†ä¸­çš„æœåŠ¡å™¨åˆ—è¡¨ <br><br> ä¸¤å°æœåŠ¡å™¨å‡æˆåŠŸæ˜¾ç¤ºåœ¨é¢æ¿ä¸­ï¼Œè¿™ä¸nomad node statuså‘½ä»¤çš„è¾“å‡ºç›¸åŒï¼š <br><br><img src="https://habrastorage.org/webt/c1/gv/82/c1gv82tjvwtw0onqxqv3huchv1w.png"><br>  <b>å›¾2.</b> nomad node statuså‘½ä»¤çš„è¾“å‡º <br><br> é‚£é¢†äº‹å‘¢ï¼Ÿ è®©æˆ‘ä»¬çœ‹çœ‹ã€‚ è½¬åˆ°é¢†äº‹æ§åˆ¶é¢æ¿ï¼Œåˆ°èŠ‚ç‚¹é¡µé¢ï¼š <br><img src="https://habrastorage.org/webt/m5/6w/tj/m56wtjjgkos9ed5e_jy9lidmutg.png"><br>  <b>å›¾3.</b> Consulé›†ç¾¤ä¸­çš„èŠ‚ç‚¹åˆ—è¡¨ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å‡†å¤‡äº†ä¸é¢†äº‹ä¸€èµ·å·¥ä½œçš„Nomadã€‚ åœ¨æœ€åé˜¶æ®µï¼Œæˆ‘ä»¬å°†å¼€å§‹æœ€æœ‰è¶£çš„éƒ¨åˆ†ï¼šæˆ‘ä»¬å°†é…ç½®Dockerå®¹å™¨ä»Gitlabåˆ°Nomadçš„äº¤ä»˜ï¼Œå¹¶è®¨è®ºå…¶å…¶ä»–ä¸€äº›ç‹¬ç‰¹åŠŸèƒ½ã€‚ <br><br><h2> åˆ›å»ºGitlab Runner <br></h2><br><br> ä¸ºäº†å°†Dockeræ˜ åƒéƒ¨ç½²åˆ°Nomadï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å†…éƒ¨å¸¦æœ‰NomadäºŒè¿›åˆ¶æ–‡ä»¶çš„å•ç‹¬è¿è¡Œç¨‹åºï¼ˆåœ¨æ­¤ï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ï¼ŒHashicorpåº”ç”¨ç¨‹åºçš„å¦ä¸€ä¸ªåŠŸèƒ½-åˆ†åˆ«æ˜¯å”¯ä¸€çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ã€‚ å°†å…¶ä¸‹è½½åˆ°è¿è¡Œç¨‹åºç›®å½•ã€‚ å¯¹ä»–æ¥è¯´ï¼Œåˆ›å»ºå…·æœ‰ä»¥ä¸‹å†…å®¹çš„æœ€ç®€å•çš„Dockerfileï¼š <br><br><pre> <code class="bash hljs">FROM alpine:3.9 RUN apk add --update --no-cache libc6-compat gettext COPY nomad /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/nomad</code> </pre><br><br> åœ¨åŒä¸€é¡¹ç›®ä¸­ï¼Œåˆ›å»º.gitlab-ci.ymlï¼š <br><br><pre> <code class="bash hljs">variables: DOCKER_IMAGE: nomad/nomad-deploy DOCKER_REGISTRY: registry.domain.name stages: - build build: stage: build image: <span class="hljs-variable"><span class="hljs-variable">${DOCKER_REGISTRY}</span></span>/nomad/alpine:3 script: - tag=<span class="hljs-variable"><span class="hljs-variable">${DOCKER_REGISTRY}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${DOCKER_IMAGE}</span></span>:latest - docker build --pull -t <span class="hljs-variable"><span class="hljs-variable">${tag}</span></span> -f Dockerfile . - docker push <span class="hljs-variable"><span class="hljs-variable">${tag}</span></span></code> </pre> <br><br> ç»“æœï¼Œæˆ‘ä»¬å°†åœ¨Gitlabæ³¨å†Œè¡¨ä¸­è·å¾—Nomadè¿è¡Œå™¨çš„å¯è®¿é—®å›¾åƒï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ç›´æ¥è½¬åˆ°é¡¹ç›®å­˜å‚¨åº“ï¼Œåˆ›å»ºç®¡é“å¹¶é…ç½®Nomadä½œä¸šNomadã€‚ <br><br><h2> é¡¹ç›®è®¾ç½® <br></h2><br><br> è®©æˆ‘ä»¬ä»Nomadçš„å·¥ä½œæ–‡ä»¶å¼€å§‹ã€‚ æˆ‘åœ¨æœ¬æ–‡ä¸­çš„é¡¹ç›®å°†éå¸¸åŸå§‹ï¼šå®ƒå°†åŒ…å«ä¸€é¡¹ä»»åŠ¡ã€‚  .gitlab-ciçš„å†…å®¹å¦‚ä¸‹ï¼š <br><br><pre> <code class="bash hljs">variables: NOMAD_ADDR: http://nomad.address.service:4646 DOCKER_REGISTRY: registry.domain.name DOCKER_IMAGE: example/project stages: - build - deploy build: stage: build image: <span class="hljs-variable"><span class="hljs-variable">${DOCKER_REGISTRY}</span></span>/nomad-runner/alpine:3 script: - tag=<span class="hljs-variable"><span class="hljs-variable">${DOCKER_REGISTRY}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${DOCKER_IMAGE}</span></span>:<span class="hljs-variable"><span class="hljs-variable">${CI_COMMIT_SHORT_SHA}</span></span> - docker build --pull -t <span class="hljs-variable"><span class="hljs-variable">${tag}</span></span> -f Dockerfile . - docker push <span class="hljs-variable"><span class="hljs-variable">${tag}</span></span> deploy: stage: deploy image: registry.example.com/nomad/nomad-runner:latest script: - envsubst <span class="hljs-string"><span class="hljs-string">'${CI_COMMIT_SHORT_SHA}'</span></span> &lt; project.nomad &gt; job.nomad - cat job.nomad - nomad validate job.nomad - nomad plan job.nomad || <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $? -eq 255 ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 255; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"success"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> - nomad run job.nomad environment: name: production allow_failure: <span class="hljs-literal"><span class="hljs-literal">false</span></span> when: manual</code> </pre> <br><br> æ­¤å¤„ï¼Œéƒ¨ç½²ä»¥æ‰‹åŠ¨æ¨¡å¼è¿›è¡Œï¼Œä½†æ˜¯æ‚¨å¯ä»¥å¯¹å…¶è¿›è¡Œé…ç½®ä»¥æ›´æ”¹é¡¹ç›®ç›®å½•çš„å†…å®¹ã€‚ ç®¡é“åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼šä»å›¾åƒçš„ç»„è£…ï¼Œéƒ¨ç½²åˆ°æ¸¸ç‰§ã€‚ åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬æ”¶é›†dockeræ˜ åƒå¹¶å°†å…¶æ¨é€åˆ°æ³¨å†Œè¡¨ä¸­ï¼›åœ¨ç¬¬äºŒé˜¶æ®µï¼Œæˆ‘ä»¬åœ¨Nomadä¸­å¯åŠ¨å·¥ä½œã€‚ <br><br><pre> <code class="bash hljs">job <span class="hljs-string"><span class="hljs-string">"monitoring-status"</span></span> { datacenters = [<span class="hljs-string"><span class="hljs-string">"dc1"</span></span>] migrate { max_parallel = 3 health_check = <span class="hljs-string"><span class="hljs-string">"checks"</span></span> min_healthy_time = <span class="hljs-string"><span class="hljs-string">"15s"</span></span> healthy_deadline = <span class="hljs-string"><span class="hljs-string">"5m"</span></span> } group <span class="hljs-string"><span class="hljs-string">"zhadan.ltd"</span></span> { count = 1 update { max_parallel = 1 min_healthy_time = <span class="hljs-string"><span class="hljs-string">"30s"</span></span> healthy_deadline = <span class="hljs-string"><span class="hljs-string">"5m"</span></span> progress_deadline = <span class="hljs-string"><span class="hljs-string">"10m"</span></span> auto_revert = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } task <span class="hljs-string"><span class="hljs-string">"service-monitoring"</span></span> { driver = <span class="hljs-string"><span class="hljs-string">"docker"</span></span> config { image = <span class="hljs-string"><span class="hljs-string">"registry.domain.name/example/project:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CI_COMMIT_SHORT_SHA}</span></span></span><span class="hljs-string">"</span></span> force_pull = <span class="hljs-literal"><span class="hljs-literal">true</span></span> auth { username = <span class="hljs-string"><span class="hljs-string">"gitlab_user"</span></span> password = <span class="hljs-string"><span class="hljs-string">"gitlab_password"</span></span> } port_map { http = 8000 } } resources { network { port <span class="hljs-string"><span class="hljs-string">"http"</span></span> {} } } } } }</code> </pre> <br><br> è¯·æ³¨æ„ï¼Œæˆ‘æœ‰ä¸€ä¸ªç§æœ‰æ³¨å†Œè¡¨ï¼Œè¦æˆåŠŸä½¿ç”¨dockeré•œåƒæ± ï¼Œæˆ‘éœ€è¦ç™»å½•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨Vaultä¸­è¾“å…¥ç™»å½•åå’Œå¯†ç ï¼Œç„¶åå†ä¸Nomadé›†æˆã€‚  Nomadæœ¬æœºæ”¯æŒVaultã€‚ ä½†æ˜¯é¦–å…ˆï¼Œåœ¨Vaultæœ¬èº«ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºNomadå®‰è£…å¿…è¦çš„ç­–ç•¥ï¼Œæ‚¨å¯ä»¥ä¸‹è½½å®ƒä»¬ï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Download the policy and token role $ curl https://nomadproject.io/data/vault/nomad-server-policy.hcl -O -s -L $ curl https://nomadproject.io/data/vault/nomad-cluster-role.json -O -s -L # Write the policy to Vault $ vault policy write nomad-server nomad-server-policy.hcl # Create the token role with Vault $ vault write /auth/token/roles/nomad-cluster @nomad-cluster-role.json</span></span></code> </pre> <br><br> ç°åœ¨ï¼Œå·²ç»åˆ›å»ºäº†å¿…è¦çš„ç­–ç•¥ï¼Œæˆ‘ä»¬å°†åœ¨job.nomadæ–‡ä»¶çš„ä»»åŠ¡å—ä¸­æ·»åŠ ä¸Vaultçš„é›†æˆï¼š <br><br><pre> <code class="bash hljs">vault { enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> address = <span class="hljs-string"><span class="hljs-string">"https://vault.domain.name:8200"</span></span> token = <span class="hljs-string"><span class="hljs-string">"token"</span></span> }</code> </pre> <br><br> æˆ‘ä½¿ç”¨ä»¤ç‰Œæˆæƒï¼Œå¹¶å°†å…¶ç›´æ¥å†™å…¥æ­¤å¤„ï¼Œåœ¨è¿è¡Œæ¼«æ¸¸ä»£ç†ç¨‹åºæ—¶ï¼Œè¿˜å¯ä»¥é€‰æ‹©å°†ä»¤ç‰ŒæŒ‡å®šä¸ºå˜é‡ï¼š <br><br><pre> <code class="bash hljs">$ VAULT_TOKEN=&lt;token&gt; nomad agent -config /path/to/config</code> </pre><br><br> ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨Vaultä¸­ä½¿ç”¨å¯†é’¥äº†ã€‚ æ“ä½œåŸç†å¾ˆç®€å•ï¼šæˆ‘ä»¬åœ¨Nomadä½œä¸šä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†å­˜å‚¨å˜é‡çš„å€¼ï¼Œä¾‹å¦‚ï¼š <br><br><pre> <code class="bash hljs">template { data = &lt;&lt;EOH {{with secret <span class="hljs-string"><span class="hljs-string">"secrets/pipeline-keys"</span></span>}} REGISTRY_LOGIN=<span class="hljs-string"><span class="hljs-string">"{{ .Data.REGISTRY_LOGIN }}"</span></span> REGISTRY_PASSWORD=<span class="hljs-string"><span class="hljs-string">"{{ .Data.REGISTRY_LOGIN }}{{ end }}"</span></span> EOH destination = <span class="hljs-string"><span class="hljs-string">"secrets/service-name.env"</span></span> env = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br><br> é€šè¿‡è¿™ç§ç®€å•çš„æ–¹æ³•ï¼Œæ‚¨å¯ä»¥é…ç½®å°†å®¹å™¨äº¤ä»˜åˆ°Nomadç¾¤é›†å¹¶åœ¨å°†æ¥ä½¿ç”¨å®ƒã€‚ æˆ‘è¦è¯´çš„æ˜¯ï¼Œæˆ‘åœ¨æŸç§ç¨‹åº¦ä¸Šå¯¹Nomadè¡¨ç¤ºåŒæƒ…-å®ƒæ›´é€‚åˆäºKuberneteså¯èƒ½ä¼šå¸¦æ¥æ›´å¤šå›°éš¾å¹¶ä¸”æœ€ç»ˆæ— æ³•å‘æŒ¥æ½œåŠ›çš„å°å‹é¡¹ç›®ã€‚ æ­¤å¤–ï¼ŒNomadéå¸¸é€‚åˆåˆå­¦è€…-æ˜“äºå®‰è£…å’Œé…ç½®ã€‚ ä½†æ˜¯ï¼Œåœ¨æŸäº›é¡¹ç›®ä¸Šè¿›è¡Œæµ‹è¯•æ—¶ï¼Œæˆ‘é‡åˆ°äº†å…¶è¾ƒæ—©ç‰ˆæœ¬çš„é—®é¢˜-è®¸å¤šåŸºæœ¬åŠŸèƒ½æ ¹æœ¬ä¸å­˜åœ¨æˆ–å®ƒä»¬æ— æ³•æ­£å¸¸å·¥ä½œã€‚ å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ç›¸ä¿¡Nomadå°†ç»§ç»­å‘å±•ï¼Œå°†æ¥å°†æ‹¥æœ‰æ‰€æœ‰å¿…è¦çš„åŠŸèƒ½ã€‚ <br><br>  <i>ç”±Ilya Andreevå‘è¡¨ï¼Œç”±Alexei Zhadanå’ŒLive Linux Teamç¼–è¾‘</i> <i><br></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN453322/">https://habr.com/ru/post/zh-CN453322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN453310/index.html">ä½¿ç”¨RxJSåº“åœ¨Reactç»„ä»¶ä¹‹é—´äº¤æ¢æ•°æ®</a></li>
<li><a href="../zh-CN453312/index.html">åŸºäºXMLæ•°æ®çš„PDFå•†ä¸šç”µå­é‚®ä»¶ç”Ÿæˆå™¨</a></li>
<li><a href="../zh-CN453314/index.html">DIY Black Mirror-æ ¹æ®èŠå¤©è®°å½•æ•™æœºå™¨äºº</a></li>
<li><a href="../zh-CN453316/index.html">è‹±å›½èŠ¯ç‰‡åˆ¶é€ å•†ARMåœæ­¢ä¸åä¸ºåˆä½œ</a></li>
<li><a href="../zh-CN453318/index.html">ç§»åŠ¨åº”ç”¨ç¨‹åºçš„æ¨é€é€šçŸ¥å®æ–½ä¸­çš„5ä¸ªé”™è¯¯</a></li>
<li><a href="../zh-CN453324/index.html">äºŒæç®¡ä½œä¸ºæ•´æµå™¨</a></li>
<li><a href="../zh-CN453326/index.html">å¦‚ä½•è‡ªåŠ¨åŒ–ITåŸºç¡€æ¶æ„ç®¡ç†-è®¨è®ºä¸‰ä¸ªè¶‹åŠ¿</a></li>
<li><a href="../zh-CN453328/index.html">åœ¨è¿œç¨‹ç«™ç‚¹ä¸Šåå¹´</a></li>
<li><a href="../zh-CN453330/index.html">å¦‚æœRAMå´©æºƒè¯¥æ€ä¹ˆåŠã€‚ å›å¿†å’Œæ²»ç–—æ–¹æ³•</a></li>
<li><a href="../zh-CN453332/index.html">å…³äºèŠ‚çœç¡¬ç›˜ç©ºé—´çš„å¥‡æ€ªæ–¹æ³•</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>