<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ŸğŸ¾ ğŸ”¡ ğŸ›• Clean Swiftæ¶æ„ä¸­çš„å•å…ƒæµ‹è¯• ğŸŒ¾ ğŸ¤³ğŸ¿ ğŸ‘©ğŸ½â€âš–ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¯»è€…å¥½ï¼ 


 æµ‹è¯•æ˜¯ä»»ä½•å¼€å‘å¿…ä¸å¯å°‘çš„éƒ¨åˆ†ï¼Œè¿™å·²ç»ä¸æ˜¯ä»€ä¹ˆç§˜å¯†äº†ã€‚ åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†Clean Swiftæ¶æ„çš„åŸºæœ¬æ¶æ„ï¼Œç°åœ¨æ˜¯æ—¶å€™å­¦ä¹ å¦‚ä½•ä½¿ç”¨æµ‹è¯•è¦†ç›–å…¶Unitäº† ã€‚ æˆ‘ä»¬å°†ä»¥å…³äºå·¥äººçš„æ–‡ç« ä¸­çš„é¡¹ç›®ä¸ºåŸºç¡€ï¼Œå¹¶åˆ†æè¦ç‚¹ã€‚ 



 ç†è®º 


ç”±äºä¾èµ–æ³¨å…¥å’Œé¢å‘åè®® ï¼Œ Clean S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Clean Swiftæ¶æ„ä¸­çš„å•å…ƒæµ‹è¯•</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483882/"><p> è¯»è€…å¥½ï¼ </p><br><p> æµ‹è¯•æ˜¯ä»»ä½•å¼€å‘å¿…ä¸å¯å°‘çš„éƒ¨åˆ†ï¼Œè¿™å·²ç»ä¸æ˜¯ä»€ä¹ˆç§˜å¯†äº†ã€‚ åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†<strong>Clean Swift</strong>æ¶æ„çš„åŸºæœ¬æ¶æ„ï¼Œç°åœ¨æ˜¯æ—¶å€™å­¦ä¹ å¦‚ä½•<strong>ä½¿ç”¨</strong>æµ‹è¯•è¦†ç›–å…¶<strong>Unitäº†</strong> ã€‚ æˆ‘ä»¬å°†ä»¥å…³äº<strong>å·¥äºº</strong>çš„æ–‡ç« ä¸­çš„é¡¹ç›®<strong>ä¸ºåŸºç¡€ï¼Œ</strong>å¹¶åˆ†æè¦ç‚¹ã€‚ </p><br><p><img src="https://habrastorage.org/webt/go/5w/bl/go5wblfd9u-psfnut7x-fgwv7mk.jpeg"></p><a name="habracut"></a><br><h2 id="teoriya"> ç†è®º </h2><br><p>ç”±äº<strong>ä¾èµ–æ³¨å…¥</strong>å’Œ<strong>é¢å‘åè®®</strong> ï¼Œ <strong>Clean Swiftä¸­çš„</strong>æ‰€æœ‰åœºæ™¯ç»„ä»¶<strong>éƒ½å½¼æ­¤</strong>ç‹¬ç«‹ï¼Œå¯ä»¥å•ç‹¬è¿›è¡Œæµ‹è¯•ã€‚ ä¾‹å¦‚ï¼Œ <strong>Interactor</strong>ä¾èµ–äº<strong>Presenter</strong>å’Œ<strong>Worker</strong> ï¼Œä½†æ˜¯è¿™äº›ä¾èµ–å…³ç³»æ˜¯å¯é€‰çš„å¹¶ä¸”åŸºäºåè®®ã€‚ å› æ­¤ï¼Œ <strong>Interactor</strong>å¯ä»¥åœ¨æ²¡æœ‰<strong>Presenter'a</strong>å’Œ<strong>Worker'açš„</strong>æƒ…å†µä¸‹æ‰§è¡Œå…¶å·¥ä½œï¼ˆå°½ç®¡å¾ˆå·®ï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜å¯ä»¥å°†å…¶æ›¿æ¢ä¸ºæ ¹æ®å…¶åè®®ç­¾åçš„å…¶ä»–å¯¹è±¡ã€‚ </p><br><p> ç”±äºæˆ‘ä»¬è¦åˆ†åˆ«æµ‹è¯•æ¯ä¸ªç»„ä»¶ï¼Œå› æ­¤éœ€è¦ç”¨<strong>ä¼ªç»„ä»¶</strong>æ›¿æ¢ä¾èµ–<strong>é¡¹</strong> ã€‚ è¿™å°†å¸®åŠ©æˆ‘ä»¬è¿›è¡Œé—´è°ï¼ˆSpyï¼‰ã€‚  <strong>é—´è°</strong>æ˜¯æµ‹è¯•å¯¹è±¡ï¼Œå®ƒä»¬å®ç°äº†æˆ‘ä»¬æƒ³è¦æ³¨å…¥å¹¶è·Ÿè¸ªå…¶ä¸­çš„æ–¹æ³•è°ƒç”¨çš„åè®®ã€‚ æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ä¸º<strong>Presenter</strong>å’Œ<strong>Worker</strong>åˆ›å»º<strong>Spy</strong> ï¼Œç„¶åå°†å®ƒä»¬æ³¨å…¥åˆ°<strong>Interactorä¸­</strong>ä»¥è·Ÿè¸ªæ–¹æ³•è°ƒç”¨ã€‚ </p><br><p><img src="https://habrastorage.org/webt/gf/t0/ka/gft0kanj4wecq7blljg90_s1ss8.jpeg"></p><br><p> å…¬å¹³åœ°è¯´ï¼Œæˆ‘è¿˜è¦æ·»åŠ ä¸€äº›æµ‹è¯•å¯¹è±¡ï¼ˆ <strong>æµ‹è¯•åŒæ‰“</strong> ï¼‰ <strong>Dummy</strong> ï¼Œ <strong>Fake</strong> ï¼Œ <strong>Stub</strong>å’Œ<strong>Mock</strong> ã€‚ ä½†æ˜¯åœ¨æœ¬æ–‡çš„æ¡†æ¶å†…ï¼Œæˆ‘ä»¬ä¸ä¼šå½±å“å®ƒä»¬ã€‚ åœ¨æ­¤å¤„é˜…è¯»æ›´å¤šå†…å®¹<a href="https://martinfowler.com/bliki/TestDouble.html">-TestDoubles</a> </p><br><h2 id="praktika"> ç»ƒä¹  </h2><br><p> æœ€åï¼Œè®©æˆ‘ä»¬å¼€å§‹åšç”Ÿæ„ã€‚ ä¸ºäº†èŠ‚çœæ‚¨çš„æ—¶é—´ï¼Œæˆ‘ä»¬å°†è€ƒè™‘æŠ½è±¡ä»£ç ï¼Œè€Œä¸æ¶‰åŠæ¯ç§æ–¹æ³•çš„å®ç°ç»†èŠ‚ã€‚ å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°åº”ç”¨ç¨‹åºä»£ç çš„<a href="https://github.com/AlekseyPleshkov/CleanSwift/tree/master/Examples/CleanSwiftTests">è¯¦ç»†ä¿¡æ¯</a> ï¼š <a href="https://github.com/AlekseyPleshkov/CleanSwift/tree/master/Examples/CleanSwiftTests">CleanSwiftTests</a> </p><br><p> å¯¹äºåœºæ™¯çš„æ¯ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«æµ‹è¯•çš„æ–‡ä»¶ï¼Œå¹¶æµ‹è¯•ç»„ä»¶ä¾èµ–å…³ç³»çš„<strong>æµ‹è¯•å€æ•°</strong> ï¼ˆ <strong>Test Doubles</strong> ï¼‰ã€‚ </p><br><p> è¿™ç§ç»“æ„çš„ä¸€ä¸ªä¾‹å­ï¼š </p><br><p><img src="https://habrastorage.org/webt/f-/e2/v5/f-e2v59mhhgomcpfi_k_ymxhwx4.png"></p><br><p> æ¯ä¸ªæµ‹è¯•æ–‡ä»¶ï¼ˆç”¨äºç»„ä»¶ï¼‰çš„ç»“æ„çœ‹èµ·æ¥éƒ½ç›¸åŒï¼Œå¹¶ä¸”éµå¾ªä»¥ä¸‹ç¼–å†™é¡ºåºï¼š </p><br><ul><li> æˆ‘ä»¬ç”¨<strong>SUT</strong> ï¼ˆæˆ‘ä»¬è¦æµ‹è¯•çš„å¯¹è±¡ï¼‰å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå¹¶å£°æ˜å…¶ä¸»è¦ä¾èµ–å…³ç³»çš„å˜é‡ </li><li> æˆ‘ä»¬åœ¨<strong>setUpï¼ˆï¼‰ä¸­</strong>åˆå§‹åŒ–<strong>SUT</strong>åŠå…¶ä¾èµ–é¡¹ï¼Œç„¶ååœ¨<strong>tearDownï¼ˆï¼‰ä¸­</strong>æ¸…é™¤å®ƒä»¬ </li><li> æµ‹è¯•æ–¹æ³• </li></ul><br><p> æ­£å¦‚æˆ‘ä»¬åœ¨ç†è®ºä¸Šæ‰€è®¨è®ºçš„ï¼Œå¯ä»¥åˆ†åˆ«æµ‹è¯•åœºæ™¯çš„æ¯ä¸ªç»„æˆéƒ¨åˆ†ã€‚ æˆ‘ä»¬å¯ä»¥å°†æµ‹è¯•å‰¯æœ¬ï¼ˆ <strong>Spy</strong> ï¼‰æ³¨å…¥å…¶ä¾èµ–é¡¹ï¼Œä»è€Œç›‘è§†<strong>SUT</strong>æ–¹æ³•çš„æ“ä½œã€‚ è®©æˆ‘ä»¬ä»”ç»†ç ”ç©¶ä¸€ä¸‹ä½¿ç”¨<strong>Home</strong>åœºæ™¯çš„<strong>Interactor</strong>ç¤ºä¾‹ç¼–å†™æµ‹è¯•çš„è¿‡ç¨‹ã€‚ </p><br><p>  <strong>HomeInteractor</strong>ä¾èµ–äºä¸¤ä¸ªå¯¹è±¡<strong>-Presenter</strong>å’Œ<strong>Worker</strong> ã€‚ è¯¥ç±»ä¸­çš„ä¸¤ä¸ªå˜é‡éƒ½å…·æœ‰åè®®ç±»å‹ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åˆ›å»ºæ ¹æ®<strong>HomePresentationLogic</strong>å’Œ<strong>HomeWorkingLogicåè®®</strong>ç­¾åçš„æµ‹è¯•å‰¯æœ¬ï¼Œç„¶åå°†å…¶æ³¨å…¥<strong>HomeInteractorä¸­</strong> ã€‚ </p><br><pre><code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HomeInteractor</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HomeBusinessLogic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HomeDataStore</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// MARK: - Public Properties var presenter: HomePresentationLogic? lazy var worker: HomeWorkingLogic = HomeWorker() var users: [User] = [] var selectedUser: User? // MARK: - HomeBusinessLogic func fetchUsers(_ request: HomeModels.FetchUsers.Request) { // ... } func selectUser(_ request: HomeModels.SelectUser.Request) { // ... }</span></span></code> </pre> <br><p> æˆ‘ä»¬å°†æµ‹è¯•ä¸¤ç§æ–¹æ³•ï¼š </p><br><ul><li>  <strong>fetchUsersï¼ˆ:)</strong> ã€‚ è´Ÿè´£é€šè¿‡<strong>API</strong>è·å–ç”¨æˆ·åˆ—è¡¨ã€‚ ä½¿ç”¨<strong>Worker</strong>å‘é€<strong>API</strong>è¯·æ±‚ã€‚ </li><li>  <strong>selectUserï¼ˆ:)</strong> ã€‚ è´Ÿè´£ä»å·²åŠ è½½çš„ç”¨æˆ·ï¼ˆ <strong>users</strong> ï¼‰åˆ—è¡¨ä¸­é€‰æ‹©æ´»åŠ¨ç”¨æˆ·ï¼ˆ <strong>selectedUser</strong> ï¼‰ã€‚ </li></ul><br><p> è¦å¼€å§‹ç¼–å†™<strong>Interactorçš„</strong>æµ‹è¯•ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºé—´è°ç¨‹åºï¼Œä»¥è·Ÿè¸ª<strong>HomePresentationLogic</strong>å’Œ<strong>HomeWorkingLogic</strong>ä¸­æ–¹æ³•çš„è°ƒç”¨ã€‚ ä¸ºæ­¤ï¼Œè¯·åœ¨ç›®å½•â€œ CleanSwiftTestsTests / Stores / Home / TestDoubles / Spiesâ€ä¸­åˆ›å»º<strong>HomePresentationLogicSpy</strong>ç±»ï¼Œç­¾ç½²åè®®<strong>HomePresentationLogic</strong>å¹¶å®ç°æ­¤åè®®çš„æ–¹æ³•ã€‚ </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HomePresentationLogicSpy</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HomePresentationLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// MARK: - Public Properties private(set) var isCalledPresentFetchedUsers = false // MARK: - Public Methods func presentFetchedUsers(_ response: HomeModels.FetchUsers.Response) { isCalledPresentFetchedUsers = true } }</span></span></code> </pre> <br><p> è¿™é‡Œçš„ä¸€åˆ‡éƒ½éå¸¸é€æ˜ã€‚ å¦‚æœ<strong>è°ƒç”¨presentFetchedUsers</strong> ï¼ˆ <strong>HomePresentationLogic</strong> ï¼‰æ–¹æ³•ï¼Œåˆ™å°†<strong>isCalledPresentFetchedUsers</strong>å˜é‡çš„å€¼è®¾ç½®ä¸º<strong>true</strong> ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿè¸ªåœ¨<strong>Interactor</strong>çš„æµ‹è¯•è¿‡ç¨‹ä¸­æ˜¯å¦è°ƒç”¨äº†æ­¤æ–¹æ³•ã€‚ </p><br><p>  <strong>ä½¿ç”¨</strong>ç›¸åŒçš„åŸç†ï¼Œåˆ›å»º<strong>HomeWorkingLogicSpy</strong> ã€‚ åŒºåˆ«ä¹‹ä¸€æ˜¯æˆ‘ä»¬ç§°ä¸º<strong>å®Œæˆ</strong> ï¼Œå› ä¸º  <strong>Interactorä¸­çš„</strong>éƒ¨åˆ†ä»£ç å°†è¢«åŒ…è£…åœ¨æ­¤æ–¹æ³•çš„é—­åŒ…ä¸­ã€‚  <strong>HomeWorkingLogic</strong>æ–¹æ³•<strong>å¤„ç†</strong>ç½‘ç»œè¯·æ±‚ã€‚ åœ¨æµ‹è¯•æœŸé—´ï¼Œæˆ‘ä»¬éœ€è¦é¿å…å®é™…çš„ç½‘ç»œè¯·æ±‚ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†å…¶æ›¿æ¢ä¸ºæµ‹è¯•ç”¨ä¾‹ï¼Œè¯¥ç”¨ä¾‹è·Ÿè¸ªæ–¹æ³•è°ƒç”¨å¹¶è¿”å›æ¨¡æ¿æ•°æ®ï¼Œä½†ä¸å‘ç½‘ç»œå‘å‡ºä»»ä½•è¯·æ±‚ã€‚ </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HomeWorkingLogicSpy</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HomeWorkingLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// MARK: - Public Properties private(set) var isCalledFetchUsers = false let users: [User] = [ User(id: 1, name: "Ivan", username: "ivan91"), User(id: 2, name: "Igor", username: "igor_test") ] // MARK: - Public Methods func fetchUsers(_ completion: @escaping ([User]?) -&gt; Void) { isCalledFetchUsers = true completion(users) } }</span></span></code> </pre> <br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»º<strong>HomeInteractorTests</strong>ç±»ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬å°†æµ‹è¯•<strong>HomeInteractor</strong> ã€‚ </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HomeInteractorTests</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XCTestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// MARK: - Private Properties private var sut: HomeInteractor! private var worker: HomeWorkingLogicSpy! private var presenter: HomePresentationLogicSpy! // MARK: - Lifecycle override func setUp() { super.setUp() let homeInteractor = HomeInteractor() let homeWorker = HomeWorkingLogicSpy() let homePresenter = HomePresentationLogicSpy() homeInteractor.worker = homeWorker homeInteractor.presenter = homePresenter sut = homeInteractor worker = homeWorker presenter = homePresenter } override func tearDown() { sut = nil worker = nil presenter = nil super.tearDown() } // MARK: - Public Methods func testFetchUsers() { // ... } func testSelectUser() { // ... } }</span></span></code> </pre> <br><p> æˆ‘ä»¬æŒ‡å‡ºäº†ä¸‰ä¸ªä¸»è¦å˜é‡<strong>-sut</strong> ï¼Œ <strong>worker</strong>å’Œ<strong>presenter</strong> ã€‚ </p><br><p> åœ¨<strong>setUpï¼ˆï¼‰ä¸­ï¼Œ</strong>åˆå§‹åŒ–å¿…è¦çš„å¯¹è±¡ï¼Œåœ¨<strong>Interactorä¸­</strong>æ³¨å…¥ä¾èµ–é¡¹<strong>ï¼Œ</strong>å¹¶å°†å¯¹è±¡åˆ†é…ç»™ç±»å˜é‡ã€‚ <br> åœ¨<strong>tearDownï¼ˆï¼‰ä¸­ï¼Œ</strong>æˆ‘ä»¬æ¸…é™¤ç±»å˜é‡ä»¥ç¡®ä¿å®éªŒçš„çº¯åº¦ã€‚ </p><br><p> åœ¨è¯¥æ–¹æ³•å®Œæˆå·¥ä½œä¹‹å‰ï¼Œå°†åœ¨æµ‹è¯•æ–¹æ³•å¼€å§‹ä¹‹å‰è°ƒç”¨<strong>setUpï¼ˆï¼‰</strong>æ–¹æ³•ï¼Œä¾‹å¦‚<strong>testFetchUsersï¼ˆï¼‰</strong>å’Œ<strong>tearDownï¼ˆï¼‰</strong> ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•è¿è¡Œä¹‹å‰é‡æ–°åˆ›å»ºæµ‹è¯•å¯¹è±¡ï¼ˆ <strong>sut</strong> ï¼‰ã€‚ </p><br><p> æ¥ä¸‹æ¥æ˜¯æµ‹è¯•æ–¹æ³•æœ¬èº«ã€‚ è¯¥ç»“æ„åˆ†ä¸º3ä¸ªä¸»è¦é€»è¾‘å—-å¿…è¦å¯¹è±¡çš„åˆ›å»ºï¼Œ <strong>SUTä¸­</strong>æµ‹è¯•æ–¹æ³•çš„å¯åŠ¨ä»¥åŠç»“æœéªŒè¯ã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¯·æ±‚ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè¯¥è¯·æ±‚æ²¡æœ‰å‚æ•°ï¼‰ï¼Œè¿è¡Œ<strong>fetchUsersï¼ˆ:)</strong> <strong>Interactor'a</strong>æ–¹æ³•ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦åœ¨<strong>HomeWorkingLogicSpy</strong>å’Œ<strong>HomePresentationLogicSpyä¸­</strong>è°ƒç”¨äº†å¿…è¦çš„æ–¹æ³•ã€‚ æˆ‘ä»¬è¿˜æ£€æŸ¥<strong>Interactor</strong>æ˜¯å¦å·²å°†ä»<strong>Worker</strong>æ¥æ”¶çš„æµ‹è¯•æ•°æ®ä¿å­˜åˆ°å…¶<strong>DataStoreä¸­</strong> ã€‚ </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testFetchUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> request = <span class="hljs-type"><span class="hljs-type">HomeModels</span></span>.<span class="hljs-type"><span class="hljs-type">FetchUsers</span></span>.<span class="hljs-type"><span class="hljs-type">Request</span></span>() sut.fetchUsers(request) <span class="hljs-type"><span class="hljs-type">XCTAssertTrue</span></span>(worker.isCalledFetchUsers, <span class="hljs-string"><span class="hljs-string">"Not started worker.fetchUsers(:)"</span></span>) <span class="hljs-type"><span class="hljs-type">XCTAssertTrue</span></span>(presenter.isCalledPresentFetchedUsers, <span class="hljs-string"><span class="hljs-string">"Not started presenter.presentFetchedUsers(:)"</span></span>) <span class="hljs-type"><span class="hljs-type">XCTAssertEqual</span></span>(sut.users.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>, worker.users.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) }</code> </pre> <br><p> æˆ‘ä»¬å°†é€šè¿‡ç±»ä¼¼çš„ç»“æ„æµ‹è¯•ç”¨æˆ·çš„é€‰æ‹©ã€‚ æˆ‘ä»¬å£°æ˜å˜é‡<strong>ExpectationId</strong>å’Œ<strong>ExpectationName</strong> ï¼Œé€šè¿‡å®ƒä»¬æˆ‘ä»¬å°†æ¯”è¾ƒç”¨æˆ·é€‰æ‹©çš„ç»“æœã€‚  <strong>users</strong>å˜é‡å­˜å‚¨æˆ‘ä»¬åˆ†é…ç»™<strong>Interactor</strong>çš„ç”¨æˆ·æµ‹è¯•åˆ—è¡¨ã€‚ å› ä¸º æµ‹è¯•æ–¹æ³•å½¼æ­¤ç‹¬ç«‹åœ°è°ƒç”¨ï¼Œå¹¶ä¸”åœ¨<strong>tearDownï¼ˆï¼‰</strong>ä¸­å°†æ•°æ®æ¸…é›¶ï¼Œç„¶å<strong>Interactor</strong>ç”¨æˆ·åˆ—è¡¨ä¸ºç©ºï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸€äº›ä¸œè¥¿å¡«å……å®ƒã€‚ ç„¶åï¼Œåœ¨è°ƒç”¨<strong>sut.selectUserï¼ˆ:)ä¹‹å</strong> ï¼Œæ£€æŸ¥æ˜¯å¦åœ¨<strong>DataStore</strong> <strong>Interactor'aä¸­</strong>åˆ†é…äº†è¯¥ç”¨æˆ·ï¼Œä»¥åŠè¯¥ç”¨æˆ·æ˜¯å¦åˆé€‚ã€‚ </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testSelectUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> expectationId = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> expectationName = <span class="hljs-string"><span class="hljs-string">"Vasya"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> users = [ <span class="hljs-type"><span class="hljs-type">User</span></span>(id: <span class="hljs-number"><span class="hljs-number">1</span></span>, name: <span class="hljs-string"><span class="hljs-string">"Ivan"</span></span>, username: <span class="hljs-string"><span class="hljs-string">"ivan"</span></span>), <span class="hljs-type"><span class="hljs-type">User</span></span>(id: <span class="hljs-number"><span class="hljs-number">2</span></span>, name: <span class="hljs-string"><span class="hljs-string">"Vasya"</span></span>, username: <span class="hljs-string"><span class="hljs-string">"vasya91"</span></span>), <span class="hljs-type"><span class="hljs-type">User</span></span>(id: <span class="hljs-number"><span class="hljs-number">3</span></span>, name: <span class="hljs-string"><span class="hljs-string">"Maria"</span></span>, username: <span class="hljs-string"><span class="hljs-string">"maria_love"</span></span>) ] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> request = <span class="hljs-type"><span class="hljs-type">HomeModels</span></span>.<span class="hljs-type"><span class="hljs-type">SelectUser</span></span>.<span class="hljs-type"><span class="hljs-type">Request</span></span>(index: <span class="hljs-number"><span class="hljs-number">1</span></span>) sut.users = users sut.selectUser(request) <span class="hljs-type"><span class="hljs-type">XCTAssertNotNil</span></span>(sut.selectedUser, <span class="hljs-string"><span class="hljs-string">"User not selected"</span></span>) <span class="hljs-type"><span class="hljs-type">XCTAssertEqual</span></span>(sut.selectedUser?.id, expectationId) <span class="hljs-type"><span class="hljs-type">XCTAssertEqual</span></span>(sut.selectedUser?.name, expectationName) }</code> </pre> <br><p> æµ‹è¯•<strong>Presenter'a</strong>å’Œ<strong>ViewController'a</strong>çš„åŸç†ç›¸åŒï¼Œå·®å¼‚æœ€å°ã€‚ åŒºåˆ«ä¹‹ä¸€æ˜¯ï¼Œä¸ºäº†æµ‹è¯•<strong>ViewControllerï¼Œæ‚¨</strong>å°†éœ€è¦åˆ›å»ºä¸€ä¸ª<strong>UIWindow</strong>å¹¶ä»<strong>setUpï¼ˆï¼‰ä¸­</strong>çš„<strong>Storyboard</strong>ä¸­è·å–æ§åˆ¶å™¨ï¼Œå¹¶åœ¨è¡¨å’Œé›†åˆä¸Šåˆ›å»º<strong>Spy</strong>å¯¹è±¡ã€‚ ä½†æ˜¯è¿™äº›ç»†å¾®å·®åˆ«å› éœ€æ±‚è€Œå¼‚ã€‚ </p><br><p> ä¸ºäº†å®Œæ•´èµ·è§ï¼Œå»ºè®®æ‚¨é€šè¿‡æœ¬æ–‡æœ«å°¾çš„é“¾æ¥ä½¿æ‚¨ç†Ÿæ‚‰è¯¥é¡¹ç›®ã€‚ </p><br><h2 id="zaklyuchenie"> ç»“è®º </h2><br><p> æˆ‘ä»¬å·²ç»ä»‹ç»äº†åœ¨<strong>Clean Swift</strong>æ¶æ„ä¸Šæµ‹è¯•åº”ç”¨ç¨‹åºçš„åŸºæœ¬åŸç†ã€‚ å®ƒä¸å…¶ä»–ä½“ç³»ç»“æ„ä¸Šçš„æµ‹è¯•é¡¹ç›®æ²¡æœ‰æœ¬è´¨ä¸Šçš„é‡å¤§å·®å¼‚ï¼Œæ‰€æœ‰ç›¸åŒçš„æµ‹è¯•éƒ½åŠ å€äº†ï¼Œæ³¨å…¥å’Œåè®®ç›¸åŒã€‚ æœ€ä¸»è¦çš„æ˜¯ä¸è¦å¿˜è®°ï¼Œæ¯ä¸ª<strong>VIP</strong>å‘¨æœŸéƒ½åº”è¯¥æœ‰ä¸€ä¸ªï¼ˆä¹Ÿåªæœ‰ä¸€ä¸ªï¼ï¼‰è´£ä»»ã€‚ è¿™å°†ä½¿ä»£ç æ›´ç®€æ´ï¼Œæµ‹è¯•ä¹Ÿæ›´åŠ æ˜æ˜¾ã€‚ </p><br><p> é“¾æ¥åˆ°é¡¹ç›®ï¼š <a href="https://github.com/AlekseyPleshkov/CleanSwift/tree/master/Examples/CleanSwiftTests">CleanSwiftTests</a> <br> æ’°å†™æ–‡ç« çš„å¸®åŠ©ï¼š <a href="https://habr.com/ru/users/bastien/" class="user_link">Bastien</a> </p><br><h2 id="seriya-statey"> ç³»åˆ—æ–‡ç«  </h2><br><ol><li>  <a href="https://habr.com/ru/post/453986/">Clean Swiftä½“ç³»ç»“æ„æ¦‚è¿°</a> </li><li>  <a href="https://habr.com/ru/post/454032/">Clean Swiftä½“ç³»ç»“æ„ä¸­çš„è·¯ç”±å™¨å’Œæ•°æ®ä¼ é€’</a> </li><li>  <a href="https://habr.com/ru/post/465991/">å¹²å‡€çš„Swiftä½“ç³»ç»“æ„ä¸­çš„å·¥äºº</a> </li><li>  Clean Swiftæ¶æ„ä¸­çš„å•å…ƒæµ‹è¯•ï¼ˆæ‚¨åœ¨è¿™é‡Œï¼‰ </li><li> ä¸€ä¸ªç®€å•çš„åœ¨çº¿å•†åº—æ¶æ„Clean Swiftçš„ç¤ºä¾‹ </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483882/">https://habr.com/ru/post/zh-CN483882/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483872/index.html">çª—æˆ·ä¸Šçš„å›¾æ¡ˆæˆ–é©¾è½¦è€…çš„ç¥¸å®³ï¼šäºŒç»´å†°å—å¦‚ä½•ç”Ÿé•¿</a></li>
<li><a href="../zh-CN483874/index.html">VVVVVVä»£ç çš„å‘å¸ƒæ˜¾ç¤ºäº†æ¸¸æˆå†…éƒ¨çš„ç²—é²ç¨‹åº¦</a></li>
<li><a href="../zh-CN483876/index.html">çº¢è‰²ä¼ä¸šæ–‡åŒ–æ˜¯ä¿„ç½—æ–¯å•†ä¸šçš„ä¸»è¦é—®é¢˜ï¼ˆç¬¬1éƒ¨åˆ†ï¼‰</a></li>
<li><a href="../zh-CN483878/index.html">å¦‚ä½•åœ¨15åˆ†é’Ÿå†…è°ˆè®ºAndroidçš„ä¸»è¦ç»„ä»¶</a></li>
<li><a href="../zh-CN483880/index.html">ä»Šå¤©çš„ç¼–ç¨‹ä¸20å¹´å‰çš„ç¼–ç¨‹æœ‰ä½•ä¸åŒï¼Ÿ</a></li>
<li><a href="../zh-CN483886/index.html">Movix Proæœºé¡¶ç›’ï¼šä»è½¯ä»¶åˆ°æœ€åä¸€ä¸ªèºæ¯</a></li>
<li><a href="../zh-CN483888/index.html">åœ¨Java 11ä¸­è¿è¡Œå•æ–‡ä»¶ç¨‹åºè€Œæ— éœ€ç¼–è¯‘</a></li>
<li><a href="../zh-CN483894/index.html">Avito Kafkaèšä¼šï¼šè¿æ¥å™¨ï¼Œé›†æˆï¼Œäº‘</a></li>
<li><a href="../zh-CN483896/index.html">å¦‚æœæ‚¨æ˜¯å¼€å‘äººå‘˜ï¼Œå¦‚ä½•ç‹¬è‡ªå‘å¸ƒäº§å“ï¼šLaravelåˆ›ä½œè€…Taylor Otvelçš„æç¤ºã€‚ ç¬¬2éƒ¨åˆ†ï¼šå¯»æ‰¾æƒ³æ³•</a></li>
<li><a href="../zh-CN483898/index.html">æ–‡æ¡£æ˜¯é’ˆå¯¹Confluenceè¿˜æ˜¯ä¸Confluenceç»“åˆä½¿ç”¨çš„ä»£ç ï¼Ÿ ä»å­˜å‚¨åº“å‘å¸ƒåˆ°Confluenceçš„å‡ ç§æ–¹æ³•æ¦‚è¿°</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>