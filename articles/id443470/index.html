<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤨 👒 🚎 Sejarah mengetik pada contoh satu proyek besar ⛹🏻 🧑🏻‍🤝‍🧑🏻 💩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! Hari ini saya akan menceritakan kisah pengembangan mengetik pada salah satu proyek di Ostrovok.ru . 



 Kisah ini dimulai jauh sebelum...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sejarah mengetik pada contoh satu proyek besar</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ostrovok/blog/443470/">  Halo semuanya!  Hari ini saya akan menceritakan kisah pengembangan mengetik pada salah satu proyek di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ostrovok.ru</a> . <br><br><img src="https://habrastorage.org/webt/ve/_4/hf/ve_4hfcpaxntn9-25xdiq9bv0z0.png"><br><br>  Kisah ini dimulai jauh sebelum <i>sensasi</i> mengetik di <i>python3.5</i> , apalagi, itu dimulai di dalam proyek yang ditulis dalam <i>python2.7</i> . <br><br>  <b>2013</b> : baru-baru ini ada rilis <i>python3.3</i> , tidak ada gunanya bermigrasi ke versi baru, karena tidak menambahkan fitur spesifik, dan akan ada banyak rasa sakit dan penderitaan selama masa transisi. <br><br>  Saya terlibat dalam proyek Mitra di Ostrovok.ru - layanan ini bertanggung jawab untuk segala sesuatu yang berkaitan dengan integrasi, reservasi, statistik, dan akun pribadi.  Kami menggunakan kedua API internal untuk layanan microser lainnya dari perusahaan, dan API eksternal untuk mitra kami. <br><a name="habracut"></a><br>  Pada titik tertentu, tim membentuk pendekatan berikut untuk menulis penangan HTTP atau semacam logika bisnis: <br><br>  1) input dan output data harus dijelaskan oleh suatu struktur (kelas), <br>  2) isi instance dari struktur harus divalidasi sesuai dengan deskripsi, <br>  3) fungsi yang mengambil struktur pada input dan memberikan struktur pada output harus memeriksa tipe data pada input dan output, masing-masing. <br><br>  Saya tidak akan membahas setiap poin secara rinci, contoh di bawah ini harus cukup untuk memahami apa yang dipertaruhkan. <br><br><div class="spoiler">  <b class="spoiler_title">Contoh</b> <div class="spoiler_text">  . <br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> dt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> contracts <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> new_contract, contract <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> schematics.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Model <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> schematics.types <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> IntType, DateType <span class="hljs-comment"><span class="hljs-comment"># in class OrderInfoData(Model): order_id = IntType(required=True) # out class OrderInfoResult(Model): order_id = IntType(required=True) checkin_at = DateType(required=True) checkout_at = DateType(required=True) cancelled_at = DateType(required=False) @new_contract def pyOrderInfoData(x): return isinstance(x, OrderInfoData) @new_contract def pyOrderInfoResult(x): return isinstance(x, OrderInfoResult) @contract def get_order_info(data_in): """ :type data_in: pyOrderInfoData :rtype: pyOrderInfoResult """ return OrderInfoResult( dict( order_id=data_in.order_id, checkin_at=dt.datetime.today(), checkout_at=dt.datetime.today() + dt.timedelta(days=1), cancelled_at=None, ) ) if __name__ == '__main__': data_in = OrderInfoData(dict(order_id=777)) data_out = get_order_info(data_in) print(data_out.to_native())</span></span></code> </pre> <br></div></div><br>  Contohnya menggunakan perpustakaan: <i>schematics</i> dan <i>pycontracts</i> . <br><br>  * <b>skema</b> - cara untuk menggambarkan dan memvalidasi data. <br>  * <b>pycontracts</b> - cara untuk memeriksa input / output dari suatu fungsi dalam runtime. <br><br>  Pendekatan ini memungkinkan Anda untuk: <br><br><ul><li>  lebih mudah untuk menulis tes - masalah dengan validasi tidak muncul, dan hanya logika bisnis yang dibahas. </li><li>  untuk menjamin format dan kualitas respons dalam API - kerangka kerja yang kaku muncul untuk apa yang siap kami terima dan apa yang dapat kami berikan. </li><li>  lebih mudah untuk memahami / memperbaiki format respons jika itu adalah struktur yang kompleks dengan tingkat bersarang yang berbeda. </li></ul><br>  Penting untuk memahami bahwa pengecekan tipe (non-validasi) hanya berfungsi dalam <i>runtime</i> , dan ini nyaman untuk pengembangan lokal, menjalankan tes dalam CI dan memverifikasi bahwa rilis kandidat bekerja dalam lingkungan <i>pementasan</i> .  Dalam lingkungan produksi, ini harus dinonaktifkan, jika tidak server akan melambat. <br><br>  Tahun-tahun berlalu, proyek kami tumbuh, logika bisnis yang lebih baru dan kompleks muncul, jumlah API yang menangani setidaknya tidak berkurang. <br><br>  Pada titik tertentu, saya mulai memperhatikan bahwa peluncuran proyek sudah berlangsung beberapa detik - ini menjengkelkan, karena setiap kali saya mengedit kode dan menjalankan tes saya harus duduk dan menunggu untuk waktu yang lama.  Ketika menunggu ini mulai memakan waktu 8-10 detik, kami akhirnya memutuskan untuk mencari tahu apa yang sedang terjadi di bawah tenda. <br><br>  Faktanya, semuanya ternyata cukup sederhana.  Ketika memulai sebuah proyek, pycontracts library mem-parsing semua <i>docstring</i> yang dicakup oleh <i>@contract</i> untuk mendaftarkan semua struktur dalam memori dan kemudian memeriksanya dengan benar.  Ketika jumlah struktur dalam suatu proyek berjumlah ribuan, semua ini mulai melambat. <br><br>  Apa yang harus dilakukan?  Jawaban yang benar adalah mencari solusi lain, untungnya di halaman tersebut sudah <b>2018</b> ( <i>python3.5</i> - <i>python3.6</i> ), dan kami sudah memindahkan proyek kami ke <i>python3.6</i> . <br><br>  Saya mulai mempelajari solusi alternatif dan berpikir tentang bagaimana memigrasikan suatu proyek dari "deskripsi tipe <i>pycontracts</i> + dalam <i>docstring</i> " ke "deskripsi tipe sesuatu + dalam <i>mengetik anotasi</i> ".  Ternyata jika Anda meningkatkan <i>pycontracts</i> ke versi terbaru, Anda dapat mendeskripsikan tipe dalam <i>mengetik</i> gaya <i>anotasi</i> , misalnya, mungkin terlihat seperti ini: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@contract def get_order_info(data_in: OrderInfoData) -&gt; OrderInfoResult: return OrderInfoResult( dict( order_id=data_in.order_id, checkin_at=dt.datetime.today(), checkout_at=dt.datetime.today() + dt.timedelta(days=1), cancelled_at=None, ) )</span></span></code> </pre><br>  Masalah dimulai jika Anda perlu menggunakan struktur dari <i>pengetikan</i> , misalnya <i>Opsional</i> atau <i>Gabungan</i> , karena <i>pycontracts</i> TIDAK tahu cara bekerja dengannya: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> typing <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Optional @contract <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_order_info</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data_in: OrderInfoData)</span></span></span><span class="hljs-function"> -&gt; Optional[OrderInfoResult]:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> OrderInfoResult( dict( order_id=data_in.order_id, checkin_at=dt.datetime.today(), checkout_at=dt.datetime.today() + dt.timedelta(days=<span class="hljs-number"><span class="hljs-number">1</span></span>), cancelled_at=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, ) )</code> </pre><br>  Saya mulai mencari pustaka alternatif untuk jenis pengecekan <i>runtime</i> : <br><br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menegakkan</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ketikan</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tipe-tipe</a> <br><br>  Menegakkan pada waktu itu tidak mendukung <i>python3.7</i> , tetapi kami telah memperbarui, <i>pytypes</i> tidak suka sintaksis, sebagai hasilnya, pilihan jatuh pada <i>typeguard</i> . <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> typeguard <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> typechecked @typechecked <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_order_info</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data_in: OrderInfoData)</span></span></span><span class="hljs-function"> -&gt; Optional[OrderInfoResult]:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> OrderInfoResult( dict( order_id=data_in.order_id, checkin_at=dt.datetime.today(), checkout_at=dt.datetime.today() + dt.timedelta(days=<span class="hljs-number"><span class="hljs-number">1</span></span>), cancelled_at=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, ) )</code> </pre><br>  Berikut adalah contoh dari proyek nyata: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@typechecked def view( request: HttpRequest, data_in: AffDeeplinkSerpIn, profile: Profile, contract: Contract, ) -&gt; AffDeeplinkSerpOut: ... @typechecked def create_contract( user: Union[User, AnonymousUser], user_uid: Optional[str], params: RegistrationCreateSchemaIn, account_manager: Manager, support_manager: Manager, sales_manager: Optional[Manager], legal_entity: LegalEntity, partner: Partner, ) -&gt; tuple: ... @typechecked def get_metaorder_ids_from_ordergroup_orders( orders: Tuple[OrderGroupOrdersIn, ...], contract: Contract ) -&gt; list: ...</span></span></code> </pre><br>  Hasilnya, setelah proses refactoring yang panjang, kami dapat sepenuhnya mentransfer proyek ke <i>mengetik</i> + <i>anotasi pengetikan</i> . <br><br>  Hasil apa yang telah kami capai: <br><br><ul><li>  Proyek dimulai dalam 2-3 detik, yang setidaknya tidak mengganggu. </li><li>  pembacaan kode telah meningkat. </li><li>  proyek ini menjadi lebih kecil baik dalam jumlah baris maupun dalam file, karena tidak ada lagi pendaftaran struktur melalui <i>@new_contract</i> . </li><li>  IDE PyCharm yang cerdas telah menjadi lebih baik dalam mengindeks proyek dan membuat petunjuk yang berbeda, karena sekarang ini bukan komentar, tetapi impor jujur. </li><li>  Anda dapat menggunakan analisis statis seperti <i>mypy</i> dan <i>pyre</i> <i>-check</i> , karena mereka mendukung kerja dengan <i>mengetik anotasi</i> . </li><li>  Komunitas python secara keseluruhan bergerak menuju mengetik dalam satu bentuk atau yang lain, yaitu, tindakan saat ini adalah investasi di masa depan proyek. </li><li>  kadang-kadang ada masalah dengan impor siklik, tetapi ada beberapa dari mereka, dan mereka dapat diabaikan. </li></ul><br>  Semoga artikel ini bermanfaat bagi Anda! <br><br>  Referensi: <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menegakkan</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ketikan</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tipe-tipe</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kontrak</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">skema</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id443470/">https://habr.com/ru/post/id443470/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id443460/index.html">11 jawaban tentang Yandex.Directory</a></li>
<li><a href="../id443462/index.html">Kamera peretasan: vektor serangan, alat pencarian kerentanan dan anti-pelacakan</a></li>
<li><a href="../id443464/index.html">Panduan Lengkap untuk Mengganti Ekspresi di Jawa 12</a></li>
<li><a href="../id443466/index.html">Raja pembangunan</a></li>
<li><a href="../id443468/index.html">Alat pemantauan jaringan apa yang telah menjadi pemimpin dalam versi Gartner</a></li>
<li><a href="../id443472/index.html">Punya masalah untuk pergi ke cloud? 7 tips tentang cara tidak mengacaukan</a></li>
<li><a href="../id443476/index.html">Bagaimana SimCity menginspirasi seluruh generasi perencana kota</a></li>
<li><a href="../id443478/index.html">Data uji sintetis vs nyata: pro, kontra, jebakan</a></li>
<li><a href="../id443480/index.html">Token kriptografis PKCS # 11: melihat dan mengekspor sertifikat, memeriksa validitasnya</a></li>
<li><a href="../id443482/index.html">AIOps dalam praktiknya - apa yang bisa Huawei FabricInsight</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>