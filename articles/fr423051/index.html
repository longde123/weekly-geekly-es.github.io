<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš‰ â–¶ï¸ ğŸ‘©ğŸ»â€âš•ï¸ La lutte pour les ressources, partie 1: les bases des groupes de contrÃ´le ğŸ†– ğŸ™‹ğŸ½ ğŸ•º</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les ordinateurs sont du matÃ©riel. Et aujourd'hui, nous sommes revenus au point de dÃ©part, dans le sens oÃ¹ vous trouvez maintenant rarement un hÃ´te phy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La lutte pour les ressources, partie 1: les bases des groupes de contrÃ´le</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redhatrussia/blog/423051/">  Les ordinateurs sont du matÃ©riel.  Et aujourd'hui, nous sommes revenus au point de dÃ©part, dans le sens oÃ¹ vous trouvez maintenant rarement un hÃ´te physique sur lequel une seule tÃ¢che est effectuÃ©e.  MÃªme si une seule application est en cours d'exÃ©cution sur le serveur, elle se compose trÃ¨s probablement de plusieurs processus, conteneurs ou mÃªme machines virtuelles (VM), et elles fonctionnent toutes sur le mÃªme serveur.  Red Hat Enterprise Linux 7 s'adapte bien Ã  la distribution des ressources systÃ¨me dans de telles situations, mais par dÃ©faut, il se comporte comme une gentille grand-mÃ¨re, traitant ses petits-enfants avec un gÃ¢teau fait maison et disant: "De maniÃ¨re Ã©gale Ã  tout le monde, Ã©galement Ã  tout le monde." <br><br><img src="https://habrastorage.org/webt/l2/wn/bp/l2wnbpxkcho_2zulxgbifsvkg3y.png" width="100%"><br><br>  En thÃ©orie, le principe du "partage Ã©gal" est bien sÃ»r beau, mais dans la pratique, certains processus, conteneurs ou VM sont plus importants que d'autres, et devraient donc en recevoir plus. <br><a name="habracut"></a><br>  Linux possÃ¨de depuis longtemps des outils de gestion des ressources (nice, ulimit, etc.), mais avec l'avÃ¨nement de Red Hat Enterprise Linux 7 et systemd, nous avons enfin un ensemble puissant de tels outils intÃ©grÃ©s dans le systÃ¨me d'exploitation lui-mÃªme.  Le fait est que le composant clÃ© de systemd est un ensemble de cgroups prÃªt Ã  l'emploi et entiÃ¨rement utilisÃ© au niveau du systÃ¨me d'exploitation. <br><br>  Eh bien, quels types de groupes de contrÃ´le sont-ils, et oÃ¹ va la gestion des ressources ou des performances? <br><br><h3>  ContrÃ´le au niveau du noyau </h3><br>  Ã€ partir de la version 2.6.24, publiÃ©e en janvier 2008, le noyau Linux est apparu qui a Ã©tÃ© initialement inventÃ© et crÃ©Ã© dans Google sous le nom de Â«conteneurs de processusÂ», et sous Linux, il est devenu connu sous le nom de Â«groupes de contrÃ´leÂ», abrÃ©gÃ©s cgroups.  En bref, cgroups est un mÃ©canisme de noyau qui vous permet de limiter l'utilisation, de conserver des enregistrements et d'isoler la consommation des ressources systÃ¨me (CPU, mÃ©moire, E / S disque, rÃ©seau, etc.) au niveau des collections de processus.  Les groupes de contrÃ´le peuvent Ã©galement geler les processus de vÃ©rification et de redÃ©marrage.  Les contrÃ´leurs Cgroups sont apparus pour la premiÃ¨re fois dans la version 6 de Red Hat Enterprise Linux, mais ils ont dÃ» Ãªtre configurÃ©s manuellement.  Mais avec l'avÃ¨nement de Red Hat Enterprise Linux 7 et de systemd, l'ensemble prÃ©configurÃ© de cgroups est fourni avec le systÃ¨me d'exploitation. <br><br>  Tout cela fonctionne au niveau du noyau du systÃ¨me d'exploitation et garantit donc un contrÃ´le strict sur chaque processus.  Il est donc extrÃªmement difficile pour un logiciel malveillant de charger le systÃ¨me afin qu'il cesse de rÃ©pondre et se bloque.  Bien sÃ»r, le code boguÃ© avec un accÃ¨s direct au matÃ©riel (par exemple, les pilotes) est toujours capable de cela.  En mÃªme temps, Red Hat Enterprise Linux 7 fournit une interface pour interagir avec les cgroups, et tout le travail avec eux se fait principalement via la commande systemd. <br><br><h3>  Votre morceau de gÃ¢teau </h3><br>  Le diagramme ci-dessous, qui rappelle une tarte en tranches, montre trois groupes de contrÃ´le qui sont par dÃ©faut sur le serveur Red Hat Enterprise Linux 7 - SystÃ¨me, Utilisateur et Machine.  Chacun de ces groupes est appelÃ© Â«trancheÂ» (secteur de tranche).  Comme vous pouvez le voir sur la figure, chaque tranche peut avoir des secteurs de dÃ©coupe enfants.  Et, comme dans le cas du gÃ¢teau, au total, toutes les tranches donnent 100% de la ressource correspondante. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/z1/xj/uk/z1xjukef06hg4do7_0iyaffbfv8.png"></div><br><br>  Examinons maintenant plusieurs concepts de cgroups en utilisant les ressources du processeur comme exemple. <br><br>  La figure ci-dessus montre que le temps du processeur est Ã©galement rÃ©parti entre les trois tranches de niveau supÃ©rieur (systÃ¨me, utilisateur et machine).  Mais cela ne se produit que sous charge.  Si un processus de la tranche Utilisateur demande 100% des ressources du processeur et que personne d'autre n'a besoin de ces ressources pour le moment, il recevra l'intÃ©gralitÃ© du temps du processeur. <br><br>  Chacune des trois tranches de niveau supÃ©rieur est conÃ§ue pour son type de charge de travail, qui tranche les secteurs enfants dans la tranche parent: <br><br><ul><li>  <b>SystÃ¨me</b> - dÃ©mons et services. </li><li>  <b>Utilisateur</b> - sessions utilisateur.  Chaque utilisateur reÃ§oit une tranche enfant et toutes les sessions avec le mÃªme UID "en direct" dans la mÃªme tranche, de sorte que les sages particuliÃ¨rement malins ne peuvent pas obtenir plus de ressources qu'ils ne devraient. </li><li>  <b>Machine</b> - machines virtuelles, telles que les invitÃ©s KVM. </li></ul><br>  En outre, le concept de la soi-disant Â«bouleÂ» (part) est utilisÃ© pour contrÃ´ler l'utilisation des ressources.  Une balle est un paramÃ¨tre numÃ©rique relatif;  sa valeur n'a de sens qu'en comparaison avec les valeurs des autres balles incluses dans le mÃªme groupe de contrÃ´le.  Par dÃ©faut, toutes les tranches ont une boule Ã©gale Ã  1024. Dans la tranche SystÃ¨me de la figure ci-dessus, les boules CPU Ã©gales Ã  1024 sont dÃ©finies pour httpd, sshd, crond et gdm. Les valeurs de balle pour les tranches SystÃ¨me, Utilisateur et Machine sont Ã©galement 1024. Est-ce un peu dÃ©routant?  En fait, cela peut Ãªtre reprÃ©sentÃ© comme un arbre: <br><br><ul><li>  SystÃ¨me - 1024 <ul><li>  httpd - 1024 </li><li>  sshd - 1024 </li><li>  crond - 1024 </li><li>  gdm - 1024 </li></ul></li><li>  Utilisateur - 1024 <ul><li>  bash (mrichter) - 1024 </li><li>  bash (dorf) - 1024 </li></ul></li><li>  Machine - 1024 <ul><li>  testvm - 1024 </li></ul></li></ul><br>  Dans cette liste, nous avons plusieurs dÃ©mons en cours d'exÃ©cution, quelques utilisateurs et une machine virtuelle.  Imaginez maintenant qu'ils demandent tous simultanÃ©ment tout le temps processeur qui peut Ãªtre obtenu. <br><br>  En rÃ©sumÃ©: <br><br><ul><li>  Le systÃ¨me Slice reÃ§oit 33,333% du temps processeur et le partage Ã©galement entre quatre dÃ©mons, ce qui donne Ã  chacun 8,25% des ressources CPU. </li><li>  La tranche utilisateur reÃ§oit 33,333% du temps processeur et la partage entre deux utilisateurs, chacun disposant de 16,5% des ressources CPU.  Si l'utilisateur mrichter se dÃ©connecte ou arrÃªte tous les processus en cours d'exÃ©cution, alors dorf aura accÃ¨s Ã  33% des ressources du processeur. </li><li>  Slice Machine reÃ§oit 33,333% du temps processeur.  Si vous Ã©teignez la machine virtuelle ou la mettez en mode veille, les tranches systÃ¨me et utilisateur recevront environ 50% des ressources CPU, qui seront ensuite partagÃ©es entre leurs tranches enfants. </li></ul><br>  De plus, pour tout dÃ©mon, utilisateur ou machine virtuelle, vous pouvez entrer non seulement des restrictions relatives, mais aussi absolues, sur la consommation de temps processeur, non seulement un, mais Ã©galement plusieurs processeurs.  Par exemple, la tranche utilisateur mrichter a la propriÃ©tÃ© CPUQuota.  Si vous le dÃ©finissez Ã  20%, mrichter ne recevra en aucun cas plus de 20% des ressources d'un processeur.  Sur les serveurs multicÅ“urs, le CPUQuota peut Ãªtre supÃ©rieur Ã  100% afin que la tranche puisse utiliser les ressources de plusieurs processeurs.  Par exemple, avec CPUQuota = 200%, une tranche peut utiliser pleinement deux cÅ“urs de processeur.  Il est important de comprendre que CPUQuota ne rÃ©serve pas, en d'autres termes, il ne garantit pas un pourcentage donnÃ© de temps processeur pour toute charge systÃ¨me - ce n'est que le maximum qui peut Ãªtre allouÃ© Ã  une tranche en tenant compte de toutes les autres tranches et paramÃ¨tres. <br><br><h3>  Tournez Ã  fond! </h3><br>  Comment puis-je modifier les paramÃ¨tres de tranche? <br><br>  Pour cela, chaque tranche a des propriÃ©tÃ©s personnalisÃ©es.  Et comme il s'agit de Linux, nous pouvons Ã©crire manuellement les paramÃ¨tres dans les fichiers de configuration ou dÃ©finir Ã  partir de la ligne de commande. <br><br>  Dans le second cas, la commande systemctl set-property est utilisÃ©e.  Voici ce qui se passera Ã  l'Ã©cran si vous tapez cette commande, ajoutez le nom de la tranche Ã  la fin (dans notre cas, Utilisateur), puis appuyez sur la touche Tab pour afficher les options: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2j/2v/k6/2j2vk6tp9lq16jnovtw5lst6zck.png"></div><br><br>  Toutes les propriÃ©tÃ©s de cette capture d'Ã©cran ne sont pas des paramÃ¨tres de groupe de contrÃ´le.  Nous sommes principalement intÃ©ressÃ©s par ceux qui dÃ©marrent sur Block, CPU et Memory. <br><br>  Si vous ne prÃ©fÃ©rez pas la ligne de commande, mais les fichiers de configuration (par exemple, pour un dÃ©ploiement automatisÃ© sur plusieurs hÃ´tes), vous devrez traiter les fichiers dans le dossier / etc / systemd / system.  Ces fichiers sont crÃ©Ã©s automatiquement lorsque vous dÃ©finissez des propriÃ©tÃ©s Ã  l'aide de la commande systemctl, mais ils peuvent Ã©galement Ãªtre crÃ©Ã©s dans un Ã©diteur de texte, tamponnÃ©s via Puppet ou mÃªme gÃ©nÃ©rÃ©s par des scripts Ã  la volÃ©e. <br><br>  Donc, avec les concepts de base des cgroups, tout devrait Ãªtre clair.  La prochaine fois, nous passerons en revue certains scÃ©narios et verrons comment les modifications de certaines propriÃ©tÃ©s affectent les performances. <br><br>  <b>Et littÃ©ralement demain, nous invitons tout le monde au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Forum Red Hat Russie 2018</a> - il sera possible de poser des questions directement aux ingÃ©nieurs de Red Hat.</b> <br><br>  D'autres articles cgroups de notre sÃ©rie Resource Fight sont disponibles sur: <br><br><ul><li>  Partie 2 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/company/redhatrussia/blog/424367</a> </li><li>  Partie 3 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/company/redhatrussia/blog/425803</a> </li><li>  Partie 4 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/company/redhatrussia/blog/427413</a> </li><li>  Partie 5 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/company/redhatrussia/blog/429064</a> </li><li>  Partie 6 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/company/redhatrussia/blog/430748</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423051/">https://habr.com/ru/post/fr423051/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423041/index.html">CD-ROM Bizarre Story Super NES</a></li>
<li><a href="../fr423043/index.html">En raison d'une vulnÃ©rabilitÃ© du systÃ¨me de protection des vÃ©hicules Ã©lectriques Tesla, une voiture peut Ãªtre volÃ©e en quelques secondes</a></li>
<li><a href="../fr423045/index.html">Quelle imprimante 3D choisir? Revue vidÃ©o 3Dtool</a></li>
<li><a href="../fr423047/index.html">Nous rÃ©servons les systÃ¨mes informatiques Ã  un prix raisonnable</a></li>
<li><a href="../fr423049/index.html">Processus d'apprentissage sous Linux</a></li>
<li><a href="../fr423053/index.html">Structurer et lire uniquement: comment Ã©viter la dÃ©gradation des performances</a></li>
<li><a href="../fr423055/index.html">Analystes de Wall Street: Â«Apple nous a fait manger nos chapeauxÂ»</a></li>
<li><a href="../fr423057/index.html">Python refuse Ã©galement partiellement les termes maÃ®tre / esclave</a></li>
<li><a href="../fr423059/index.html">Mieux qu'ils ne le disent: trois Ã©lÃ©ments essentiels pour que le prochain MacBook devienne l'un des meilleurs ordinateurs portables d'Apple</a></li>
<li><a href="../fr423061/index.html">ref locaux et ref renvoie en C #: piÃ¨ges de performance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>