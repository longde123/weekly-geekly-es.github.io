<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¥üèΩ ü§üüèæ üòâ Das beliebteste St√ºck Code in der Geschichte von StackOverflow hat einen Fehler! üÜé üèí üëéüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine k√ºrzlich durchgef√ºhrte Studie mit dem Titel ‚ÄûVerwenden und Zuweisen von Stack-Overflow-Code-Snippets in GitHub-Projekten‚Äú stellte pl√∂tzlich fest,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Das beliebteste St√ºck Code in der Geschichte von StackOverflow hat einen Fehler!</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478878/">  Eine k√ºrzlich durchgef√ºhrte Studie mit dem Titel <a href="https://doi.org/10.1007/s10664-018-9650-5" rel="nofollow">‚ÄûVerwenden und Zuweisen von Stack-Overflow-Code-Snippets in GitHub-Projekten‚Äú stellte</a> pl√∂tzlich fest, dass meine <a href="https://stackoverflow.com/a/3758880/276052" rel="nofollow">Antwort</a> in Open Source-Projekten die meiste Zeit vor fast zehn Jahren verfasst wurde.  Ironischerweise gibt es einen Fehler. <br><br><h2>  Es war einmal ... </h2><br>  2010 sa√ü ich in meinem B√ºro und machte Unsinn: Ich hatte Spa√ü mit <a href="https://en.wikipedia.org/wiki/Code_golf" rel="nofollow">Codegolf</a> und gab Stack Overflow <a href="https://en.wikipedia.org/wiki/Code_golf" rel="nofollow">eine</a> Bewertung. <br><br>  Die folgende Frage erregte meine Aufmerksamkeit: Wie kann ich die Anzahl der Bytes in einem lesbaren Format anzeigen?  Das hei√üt, wie man so etwas wie 123456789 Bytes in "123,5 MB" konvertiert. <br><br> <a href="https://stackoverflow.com/q/3758606/276052" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/7ca/00b/1f7/7ca00b1f7d4f57f0f8afa4ed9554797a.png"></a> <br>  <i><font color="gray">Gute alte 2010-Schnittstelle, danke The Wayback Machine</font></i> <br><a name="habracut"></a><br>  Implizit w√§re das Ergebnis eine Zahl zwischen 1 und 999,9 mit der entsprechenden Einheit. <br><br>  Es gab bereits eine Antwort mit einer Schleife.  Die Idee ist einfach: √úberpr√ºfen Sie alle Grade von der gr√∂√üten Einheit (EB = 10 <sup>18</sup> Bytes) bis zur kleinsten (B = 1 Byte) und wenden Sie die erste an, die kleiner als die Anzahl der Bytes ist.  Im Pseudocode sieht es ungef√§hr so ‚Äã‚Äãaus: <br><br><pre><code class="plaintext hljs">suffixes = [ "EB", "PB", "TB", "GB", "MB", "kB", "B" ] magnitudes = [ 10^18, 10^15, 10^12, 10^9, 10^6, 10^3, 10^0 ] i = 0 while (i &lt; magnitudes.length &amp;&amp; magnitudes[i] &gt; byteCount) i++ printf("%.1f %s", byteCount / magnitudes[i], suffixes[i])</code> </pre> <br>  Normalerweise ist es schwierig, mit der richtigen Antwort mit einer positiven Bewertung mitzuhalten.  In der Fachsprache Stack Overflow wird dies als das <a href="https://meta.stackexchange.com/questions/9731/fastest-gun-in-the-west-problem" rel="nofollow">Problem des schnellsten Sch√ºtzen im Westen bezeichnet</a> .  Aber hier hatte die Antwort einige Fehler, also hoffte ich immer noch, sie zu √ºbertreffen.  Zumindest Code mit einer Schleife kann stark reduziert werden. <br><br><h2>  Nun, das ist Algebra, alles ist einfach! </h2><br>  Dann d√§mmerte es mir.  Die Pr√§fixe sind Kilo-, Mega-, Giga-, ... - nicht mehr als Grad 1000 (oder 1024 in der IEC-Norm), sodass das richtige Pr√§fix anhand des Logarithmus und nicht anhand des Zyklus bestimmt werden kann. <br><br>  Ausgehend von dieser Idee habe ich Folgendes ver√∂ffentlicht: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">humanReadableByteCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bytes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> si)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> unit = si ? <span class="hljs-number"><span class="hljs-number">1000</span></span> : <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes &lt; unit) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bytes + <span class="hljs-string"><span class="hljs-string">" B"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> exp = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (Math.log(bytes) / Math.log(unit)); String pre = (si ? <span class="hljs-string"><span class="hljs-string">"kMGTPE"</span></span> : <span class="hljs-string"><span class="hljs-string">"KMGTPE"</span></span>).charAt(exp-<span class="hljs-number"><span class="hljs-number">1</span></span>) + (si ? <span class="hljs-string"><span class="hljs-string">""</span></span> : <span class="hljs-string"><span class="hljs-string">"i"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String.format(<span class="hljs-string"><span class="hljs-string">"%.1f %sB"</span></span>, bytes / Math.pow(unit, exp), pre); }</code> </pre> <br>  Nat√ºrlich ist dies nicht sehr gut lesbar und log / pow ist in der Effizienz anderen Optionen unterlegen.  Aber es gibt keine Schleife und fast keine Verzweigung, daher ist das Ergebnis meiner Meinung nach ziemlich sch√∂n. <br><br><blockquote>  <b>Mathematik ist einfach</b> .  Die Anzahl der Bytes wird ausgedr√ºckt als byteCount = 1000 <sup>s</sup> , wobei <i>s</i> den Grad darstellt (in bin√§rer Notation betr√§gt die Basis 1024). Die L√∂sung <i>s</i> ergibt <i>s</i> = log <sub>1000</sub> (byteCount). <br><br>  Es gibt keinen einfachen Ausdruck log <sub>1000</sub> in der API, aber wir k√∂nnen ihn in Form des nat√ºrlichen Logarithmus wie folgt ausdr√ºcken: s = log (byteCount) / log (1000).  Dann konvertieren wir <i>s</i> in int. Wenn wir zum Beispiel mehr als ein Megabyte (aber kein volles Gigabyte) haben, wird MB als Ma√üeinheit verwendet. <br><br>  Es stellt sich heraus, dass wenn <i>s</i> = 1, dann ist die Dimension Kilobyte, wenn <i>s</i> = 2 - Megabyte und so weiter.  Teilen Sie byteCount durch 1000 <sup>s</sup> und setzen Sie den entsprechenden Buchstaben in das Pr√§fix. </blockquote><br>  Es blieb nur abzuwarten, wie die Community die Antwort wahrnahm.  Ich konnte mir nicht vorstellen, dass dieser Code der am weitesten verbreitete in der Geschichte von Stack Overflow wird. <br><br><h2>  Attribution Study </h2><br>  Schneller Vorlauf bis 2018.  Der Doktorand Sebastian Baltes ver√∂ffentlicht einen Artikel in der Fachzeitschrift <i>Empirical Software Engineering mit dem</i> Titel <a href="https://doi.org/10.1007/s10664-018-9650-5" rel="nofollow">‚ÄûVerwenden und Zuweisen von Code-Snippets f√ºr den Stapel√ºberlauf in GitHub-Projekten‚Äú</a> .  Das Thema seiner Forschung ist, wie sehr die Stack Overflow CC BY-SA 3.0-Lizenz respektiert wird, das hei√üt, verweisen Autoren auf Stack Overflow als Quellcode? <br><br>  Zur Analyse wurden Codeausschnitte aus dem <a href="https://archive.org/details/stackexchange" rel="nofollow">Stack Overflow-Dump</a> extrahiert und dem Code in den √∂ffentlichen GitHub-Repositorys zugeordnet.  Zitat aus dem Abstract: <br><br><blockquote>  <i>Wir pr√§sentieren die Ergebnisse einer gro√ü angelegten empirischen Studie, die die Verwendung und Zuordnung von nicht-trivialen Fragmenten von Java-Code aus SO-Antworten in √∂ffentlichen GitHub (GH) -Projekten analysiert.</i> </blockquote><br>  (Spoiler: Nein, die meisten Programmierer erf√ºllen die Lizenzanforderungen nicht.) <br><br>  Der Artikel hat eine solche Tabelle: <br><br><img src="https://habrastorage.org/webt/d_/jb/az/d_jbazgu5cmhwyw__yxdxkzdhwy.png"><br><br>  Diese Antwort oben mit der Kennung <a href="https://stackoverflow.com/a/3758880/276052" rel="nofollow">3758880 hat</a> sich als die Antwort herausgestellt, die ich vor acht Jahren gepostet habe.  Im Moment hat er mehr als hunderttausend Aufrufe und mehr als tausend Pluspunkte. <br><br>  Eine schnelle Suche in GitHub erzeugt wirklich Tausende von Repositories mit dem Code <code>humanReadableByteCount</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c4c/3de/bc6/c4c3debc6c290c209b90c2dca5be46ab.png"><br><br>  Suchen Sie nach diesem Fragment in Ihrem Repository: <br><br><pre> <code class="bash hljs">$ git grep humanReadableByteCount</code> </pre> <br><blockquote>  <b>Eine lustige Geschichte</b> , wie ich √ºber diese Studie erfahren habe. <br><br>  Sebastian hat im OpenJDK-Repository eine √úbereinstimmung ohne Zuordnung gefunden, und die OpenJDK-Lizenz ist nicht mit CC BY-SA 3.0 kompatibel.  Auf <a href="http://mail.openjdk.java.net/pipermail/jdk9-dev/2016-December/005327.html" rel="nofollow">der Mailingliste von jdk9-dev</a> fragte er: <a href="http://mail.openjdk.java.net/pipermail/jdk9-dev/2016-December/005327.html" rel="nofollow">Wird</a> der Stack Overflow-Code von OpenJDK kopiert oder umgekehrt? <br><br>  Das Lustige ist, dass ich gerade in Oracle im OpenJDK-Projekt gearbeitet habe, also hat mein ehemaliger Kollege und Freund Folgendes geschrieben: <br><br>  <i>Hallo,</i> <i><br><br></i>  <i>Warum fragst du den Autor dieses Beitrags nicht direkt bei SO (aioobe)?</i>  <i>Er ist Mitglied von OpenJDK und arbeitete bei Oracle, als dieser Code in den OpenJDK-Quellrepositorys erschien.</i> <br><br>  Oracle nimmt diese Probleme sehr ernst.  Ich wei√ü, dass einige Manager erleichtert waren, als sie diese Antwort lasen und den ‚ÄûSchuldigen‚Äú fanden. <br><br>  Dann schrieb Sebastian mir, um die Situation zu kl√§ren, die ich tat: Dieser Code wurde hinzugef√ºgt, <i>bevor</i> ich zu Oracle kam, und ich habe nichts mit dem Festschreiben zu tun.  Es ist besser, nicht mit Oracle zu scherzen.  Einige Tage nach <a href="https://bugs.openjdk.java.net/browse/JDK-8170860" rel="nofollow">dem √ñffnen des Tickets wurde</a> dieser Code <a href="http://hg.openjdk.java.net/jdk9/jdk9/hotspot/rev/b552b596203f" rel="nofollow">gel√∂scht</a> . </blockquote><br><h2>  Bug </h2><br>  Ich wette, du hast schon dar√ºber nachgedacht.  Welche Art von Fehler im Code? <br><br>  Noch einmal: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">humanReadableByteCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bytes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> si)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> unit = si ? <span class="hljs-number"><span class="hljs-number">1000</span></span> : <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes &lt; unit) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bytes + <span class="hljs-string"><span class="hljs-string">" B"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> exp = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (Math.log(bytes) / Math.log(unit)); String pre = (si ? <span class="hljs-string"><span class="hljs-string">"kMGTPE"</span></span> : <span class="hljs-string"><span class="hljs-string">"KMGTPE"</span></span>).charAt(exp-<span class="hljs-number"><span class="hljs-number">1</span></span>) + (si ? <span class="hljs-string"><span class="hljs-string">""</span></span> : <span class="hljs-string"><span class="hljs-string">"i"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String.format(<span class="hljs-string"><span class="hljs-string">"%.1f %sB"</span></span>, bytes / Math.pow(unit, exp), pre); }</code> </pre> <br>  Welche M√∂glichkeiten gibt es? <br><br>  Nach Exabytes (10 <sup>18</sup> ) folgen Zettabytes (10 <sup>21</sup> ).  Vielleicht geht eine wirklich gro√üe Anzahl √ºber kMGTPE hinaus?  Nein.  Der Maximalwert ist 2 <sup>63</sup> -1 ‚âà 9,2 √ó 10 <sup>18</sup> , sodass kein Wert √ºber Exabyte hinausgeht. <br><br>  Vielleicht die Verwechslung zwischen SI-Einheiten und dem Bin√§rsystem?  Nein.  Es gab Verwirrung in der ersten Version der Antwort, aber es wurde ziemlich schnell behoben. <br><br>  Vielleicht endet exp mit dem Nullabgleich, wodurch charAt (exp-1) abst√ºrzt?  Auch nicht.  Die erste if-Anweisung behandelt diesen Fall.  Der Exp-Wert wird immer mindestens 1 sein. <br><br>  Vielleicht ein seltsamer Rundungsfehler in der Auslieferung?  Na endlich ... <br><br><h2>  Viele Neuner </h2><br>  Die L√∂sung funktioniert, bis sie sich 1 MB n√§hert.  Wenn <code>"1000,0 kB"</code> Bytes als Eingabe angegeben werden, ist das Ergebnis (im SI-Modus) <code>"1000,0 kB"</code> .  Obwohl 999.999 n√§her an 1000 √ó 1000 <sup>1 liegt</sup> als an 999,9 √ó 1000 <sup>1</sup> , ist der Signifikator 1000 durch die Spezifikation verboten.  Das korrekte Ergebnis ist <code>"1.0 MB"</code> . <br><br>  Zu meiner Verteidigung kann ich sagen, dass zum Zeitpunkt des Schreibens ein solcher Fehler in allen 22 ver√∂ffentlichten Antworten vorlag, einschlie√ülich Apache Commons und Android-Bibliotheken. <br><br>  Wie kann ich das beheben?  Zun√§chst ist zu beachten, dass sich der Exponent (exp) von 'k' nach 'M' √§ndern muss, sobald die Anzahl der Bytes n√§her an 1 √ó 1.000 <sup>2</sup> (1 MB) liegt als an 999,9 √ó 1000 <sup>1</sup> (999,9 k) )  Dies geschieht bei 999.950. Ebenso sollten wir von 'M' zu 'G' wechseln, wenn wir 999.950.000 und so weiter durchlaufen. <br><br>  Wir berechnen diesen Schwellenwert und erh√∂hen <code>exp</code> wenn <code>bytes</code> gr√∂√üer sind: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes &gt;= Math.pow(unit, exp) * (unit - <span class="hljs-number"><span class="hljs-number">0.05</span></span>)) exp++;</code> </pre> <br>  Mit dieser √Ñnderung funktioniert der Code gut, bis sich die Anzahl der Bytes 1 EB n√§hert. <br><br><h2>  Mehr Neunen </h2><br>  Bei der Berechnung von 999 949 999 999 999 999 999 ergibt der Code <code>1000.0 PB</code> , und das korrekte Ergebnis ist <code>999.9 PB</code> .  Mathematisch gesehen ist der Code korrekt. Was passiert also hier? <br><br>  Jetzt stehen wir vor <code>double</code> Einschr√§nkungen. <br><br><blockquote><h4>  Einf√ºhrung in die Gleitkomma-Arithmetik </h4><br>  Gem√§√ü der IEEE 754-Spezifikation haben Gleitkommawerte nahe Null eine sehr dichte Darstellung, w√§hrend gro√üe Werte eine sehr sp√§rliche Darstellung haben.  Tats√§chlich liegt die H√§lfte aller Werte zwischen -1 und 1, und bei gro√üen Zahlen bedeutet ein Wert der Gr√∂√üe <code>Long.MAX_VALUE</code> nichts.  Im wahrsten Sinne des Wortes. <br><br><pre> <code class="plaintext hljs">double l1 = Double.MAX_VALUE; double l2 = l1 - Long.MAX_VALUE; System.err.println(l1 == l2); // prints true</code> </pre> <br>  Siehe <a href="https://programming.guide/bits-of-a-floating-point-value.html" rel="nofollow">"Gleitkomma-Bits" f√ºr</a> Details. </blockquote><br>  Das Problem wird durch zwei Berechnungen dargestellt: <br><br><ul><li>  <code>String.format</code> in <code>String.format</code> und <br></li><li>  Expansionsschwelle <code>exp</code> </li></ul><br>  Wir k√∂nnen auf <code>BigDecimal</code> , aber es ist langweilig.  Dar√ºber hinaus treten auch hier Probleme auf, da die Standard-API keinen Logarithmus f√ºr <code>BigDecimal</code> . <br><br><h4>  Zwischenwerte reduzieren </h4><br>  Um das erste Problem zu l√∂sen, k√∂nnen wir den Wert von <code>bytes</code> auf den gew√ºnschten Bereich reduzieren, in dem die Genauigkeit besser ist, und <code>exp</code> entsprechend anpassen.  In jedem Fall ist das Endergebnis gerundet, so dass es keine Rolle spielt, dass wir die am wenigsten signifikanten Ziffern wegwerfen. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp &gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) { bytes /= unit; exp--; }</code> </pre> <br><h4>  Einstellung der niedrigstwertigen Bits </h4><br>  Um das zweite Problem zu l√∂sen <i>, sind</i> uns <i>die</i> niedrigstwertigen Bits <i>wichtig</i> (99994999 ... 9 und 99995000 ... 0 m√ºssen unterschiedliche Grade haben), daher m√ºssen wir eine andere L√∂sung finden. <br><br>  Beachten Sie zun√§chst, dass es 12 verschiedene Schwellenwerte gibt (6 f√ºr jeden Modus), von denen nur einer zu einem Fehler f√ºhrt.  Ein falsches Ergebnis kann eindeutig identifiziert werden, da es mit D00 <sub>16</sub> endet.  So k√∂nnen Sie es direkt beheben. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> th = (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>) (Math.pow(unit, exp) * (unit - <span class="hljs-number"><span class="hljs-number">0.05</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exp &lt; <span class="hljs-number"><span class="hljs-number">6</span></span> &amp;&amp; bytes &gt;= th - ((th &amp; <span class="hljs-number"><span class="hljs-number">0xFFF</span></span>) == <span class="hljs-number"><span class="hljs-number">0xD00</span></span> ? <span class="hljs-number"><span class="hljs-number">52</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>)) exp++;</code> </pre> <br>  Da wir bei Flie√ükommaergebnissen auf bestimmte Bitmuster angewiesen sind, verwenden wir den Modifikator strictfp, um sicherzustellen, dass der Code unabh√§ngig von der Hardware funktioniert. <br><br><h2>  Negative Eingabewerte </h2><br>  Es ist nicht klar, unter welchen Umst√§nden eine negative Anzahl von Bytes sinnvoll sein kann, aber da Java keine vorzeichenlose <code>long</code> , ist es am besten, mit dieser Option umzugehen.  Im <code>-10000 B</code> ergibt <code>-10000 B</code> Eingabe von <code>-10000 B</code> <br><br>  Schreiben <code>absBytes</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> absBytes = bytes == Long.MIN_VALUE ? Long.MAX_VALUE : Math.abs(bytes);</code> </pre> <br>  Der Ausdruck ist so ausf√ºhrlich, weil <code>-Long.MIN_VALUE == Long.MIN_VALUE</code> .  Jetzt f√ºhren wir alle <code>exp</code> Berechnungen mit <code>absBytes</code> anstelle von <code>bytes</code> . <br><br><h2>  Endg√ºltige Fassung </h2><br>  Hier ist die endg√ºltige Version des Codes, gek√ºrzt und verk√ºrzt im Geiste der Originalversion: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// From: https://programming.guide/the-worlds-most-copied-so-snippet.html public static strictfp String humanReadableByteCount(long bytes, boolean si) { int unit = si ? 1000 : 1024; long absBytes = bytes == Long.MIN_VALUE ? Long.MAX_VALUE : Math.abs(bytes); if (absBytes &lt; unit) return bytes + " B"; int exp = (int) (Math.log(absBytes) / Math.log(unit)); long th = (long) (Math.pow(unit, exp) * (unit - 0.05)); if (exp &lt; 6 &amp;&amp; absBytes &gt;= th - ((th &amp; 0xfff) == 0xd00 ? 52 : 0)) exp++; String pre = (si ? "kMGTPE" : "KMGTPE").charAt(exp - 1) + (si ? "" : "i"); if (exp &gt; 4) { bytes /= unit; exp -= 1; } return String.format("%.1f %sB", bytes / Math.pow(unit, exp), pre); }</span></span></code> </pre> <br>  Beachten Sie, dass dies als Versuch begann, Schleifen und √ºberm√§√üige Verzweigungen zu vermeiden.  Nachdem alle Randbedingungen gegl√§ttet wurden, war der Code noch schlechter lesbar als die Originalversion.  Pers√∂nlich w√ºrde ich dieses Fragment nicht in der Produktion kopieren. <br><br>  Eine aktualisierte Version der Produktionsqualit√§t finden Sie in einem separaten Artikel: <a href="https://programming.guide/java/formatting-byte-size-to-human-readable-format.html" rel="nofollow">‚ÄûFormatieren der Bytegr√∂√üe in einem lesbaren Format‚Äú.</a> <br><br><h2>  Schl√ºsselergebnisse </h2><br><ul><li>  Die Antworten auf Stack Overflow enthalten m√∂glicherweise Fehler, auch wenn sie Tausende von Pluspunkten aufweisen. <br></li><li>  √úberpr√ºfen Sie alle Grenzf√§lle, <i>insbesondere</i> im Code mit Stapel√ºberlauf. <br></li><li>  Flie√ükomma-Arithmetik ist kompliziert. <br></li><li>  Stellen Sie sicher, dass Sie beim Kopieren des Codes die richtige Zuordnung angeben.  Jemand kann Sie zu sauberem Wasser bringen. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de478878/">https://habr.com/ru/post/de478878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de478858/index.html">Vergleichen von Profilierungssitzungen in XHProf Admin</a></li>
<li><a href="../de478862/index.html">Wie ist der Frontend-Test in Yandex.Market aufgebaut und warum lehnen wir w√∂chentliche Releases ab?</a></li>
<li><a href="../de478866/index.html">Meet Space - Neues Produkt von JetBrains</a></li>
<li><a href="../de478872/index.html">DIY: Wie wir die Lager√ºberwachung automatisieren</a></li>
<li><a href="../de478874/index.html">Toshiba hat zwei neue Festplattenreihen mit einer Kapazit√§t von bis zu 6 TB angek√ºndigt und seine Ausrichtung auf das Unternehmenssegment seit 2020 angek√ºndigt</a></li>
<li><a href="../de478884/index.html">Wie man RTSP auf der Baustelle im Jahr 2020 vorbereitet oder warum Eber keine Zeit haben zu entkommen</a></li>
<li><a href="../de478886/index.html">Winkelkomponenten mit Inline-Inhalt</a></li>
<li><a href="../de478888/index.html">Einige Gedanken zu modularen CSS- und Code-Support-Problemen</a></li>
<li><a href="../de478890/index.html">Wo ist mein Paket? KI erleichtert die Zustellung</a></li>
<li><a href="../de478892/index.html">Freiwilligenarbeit als Lebensform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>