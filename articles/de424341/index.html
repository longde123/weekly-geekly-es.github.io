<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👨🏼 👎🏽 💥 Ulme. Bequem und umständlich. Zusammensetzung 🍳 👩🏿‍⚕️ 〰️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wir sprechen weiterhin über Elm 0.18 . 


 Ulme. Bequem und umständlich 
 Ulme. Bequem und umständlich. Json.Encoder und Json.Decoder 
 Ulme. Bequem u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ulme. Bequem und umständlich. Zusammensetzung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424341/"><p>  Wir sprechen weiterhin über <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Elm 0.18</a> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ulme.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bequem und umständlich</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ulme.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bequem und umständlich.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Json.Encoder und Json.Decoder</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ulme.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bequem und umständlich.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HTTP, Aufgabe</a> </p><br><p>  In diesem Artikel werden die Probleme der Elm-Anwendungsarchitektur und mögliche Optionen für die Implementierung des Komponentenentwicklungsansatzes behandelt. </p><br><p>  Betrachten Sie als Aufgabe die Implementierung eines Dropdown-Fensters, in dem ein registrierter Benutzer eine Frage hinzufügen kann.  Im Falle eines anonymen Benutzers schlägt er vor, sich zuerst anzumelden oder zu registrieren. </p><a name="habracut"></a><br><p>  Wir gehen auch davon aus, dass es später erforderlich sein kann, den Empfang anderer Arten von Benutzerinhalten zu implementieren, aber die Logik der Arbeit mit autorisierten und anonymen Benutzern bleibt dieselbe. </p><br><h2 id="nelovkaya-kompoziciya">  Umständliche Komposition </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Quellcode einer naiven Implementierung</a> .  Im Rahmen dieser Implementierung werden wir alles in einem Modell speichern. </p><br><p>  Alle für die Autorisierung und Benutzerabfrage erforderlichen Daten befinden sich im Modell auf derselben Ebene.  Die gleiche Situation mit Nachrichten (Msg). </p><br><pre><code class="hljs vbscript">type alias Model = { user: User , ui: Maybe Ui -- Popup <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> open <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> value equals <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> , login: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> , password: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> , question: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> , message: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> } type Msg = OpenPopup | LoginTyped <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | PasswordTyped <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | Login | QuestionTyped <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> | SendQuestion</code> </pre> <br><p>  Der Schnittstellentyp wird als Vereinigungstyp Ui beschrieben, der mit dem Typ Vielleicht verwendet wird. </p><br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ui</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">LoginUi</span></span> -- <span class="hljs-type"><span class="hljs-type">Popup</span></span> shown <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> authentication form | <span class="hljs-type"><span class="hljs-type">QuestionUi</span></span> -- <span class="hljs-type"><span class="hljs-type">Popup</span></span> shown <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> textarea to leave user question</code> </pre> <br><p>  Somit beschreibt ui = Nothing das Fehlen eines Popup-Fensters, und das Just-Popup ist mit einer bestimmten Oberfläche geöffnet. <br></p><p>  In der Aktualisierungsfunktion werden das Paar, die Nachricht und die Benutzerdaten abgeglichen.  Abhängig von diesem Paar werden verschiedene Aktionen ausgeführt. </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.user) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span></code> </pre> <br><p>  Wenn Sie beispielsweise auf die Schaltfläche "Popup öffnen" klicken, wird eine OpenPopup-Nachricht generiert.  Die OpenPopup-Nachricht in der Aktualisierungsfunktion wird auf verschiedene Arten behandelt.  Für einen anonymen Benutzer wird ein Autorisierungsformular generiert und für einen autorisierten Benutzer ein Formular, in dem Sie eine Frage hinterlassen können. </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.user) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-comment"><span class="hljs-comment">-- Anonymous user message handling section (OpenPopup, Anonymous) -&gt; ( { model | ui = Just LoginUi, message = "" }, Cmd.none) -- Authenticated user message handling section (OpenPopup, User userName) -&gt; ( { model | ui = Just QuestionUi, message = "" }, Cmd.none)</span></span></code> </pre> <br><p>  Offensichtlich kann dieser Ansatz Probleme mit dem Wachstum von Anwendungsfunktionen haben: </p><br><ol><li>  Es gibt keine Gruppierung von Daten im Modell und in den Nachrichten.  Alles liegt in einer Ebene.  Somit gibt es keine Komponentengrenzen, eine Änderung der Logik eines Teils wirkt sich höchstwahrscheinlich auf den Rest aus. </li><li>  Die Wiederverwendung von Code ist nach dem Prinzip des Kopierens und Einfügens mit allen daraus resultierenden Konsequenzen möglich. </li></ol><br><h2 id="udobnaya-kompoziciya">  Praktische Komposition </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Quellcode ist eine bequeme Implementierung</a> .  Im Rahmen dieser Implementierung werden wir versuchen, das Projekt in unabhängige Komponenten aufzuteilen.  Zulässige Abhängigkeiten zwischen Komponenten. </p><br><p>  Projektstruktur: </p><br><ol><li>  Im Ordner Typ werden benutzerdefinierte Typen deklariert. </li><li>  Benutzerdefinierte Komponenten werden im Komponentenordner deklariert. </li><li>  Einstiegspunkt für das Main.elm-Dateiprojekt; </li><li>  Die Dateien login.json und question.json werden als Testdaten für die Antwort des Servers auf die Autorisierung bzw. das Speichern von Informationen zu der Frage verwendet. </li></ol><br><h1 id="polzovatelskie-komponenty">  Benutzerdefinierte Komponenten </h1><br><p>  Jede auf der Spracharchitektur basierende Komponente sollte Folgendes enthalten: </p><br><ol><li>  Modell </li><li>  Nachrichten (Nachricht) </li><li>  Ergebnis der Ausführung (Return); </li><li>  Initialisierungsfunktion (init); </li><li>  Mutationsfunktion (Update); </li><li>  Ansichtsfunktion. </li></ol><br><p>  Jede Komponente kann bei Bedarf ein Abonnement enthalten. </p><br><p><img src="https://habrastorage.org/webt/rh/xg/0q/rhxg0qxlorqpoiyv-sljcbmec68.jpeg" alt="Bild"><br>  Abb.  1. Komponentenaktivitätsdiagramm </p><br><h1 id="inicializaciya">  Initialisierung </h1><br><p>  Jede Komponente muss ausgelöst werden, d.h.  muss empfangen werden: </p><br><ol><li>  Modell </li><li>  Der Befehl oder die Liste der Befehle, die den Status der Komponente initialisieren sollen </li><li>  Ausführungsergebnis.  Das Ergebnis der Ausführung zum Zeitpunkt der Initialisierung kann erforderlich sein, um die Autorisierung des Benutzers zu überprüfen, wie in den Beispielen zu diesem Artikel. </li></ol><br><p>  Die Liste der Argumente der Initialisierungsfunktion (init) hängt von der Logik der Komponente ab und kann beliebig sein.  Es kann mehrere Initialisierungsfunktionen geben.  Angenommen, für eine Autorisierungskomponente können zwei Initialisierungsoptionen bereitgestellt werden: mit einem Sitzungstoken und mit Benutzerdaten. </p><br><p>  Code, der die Komponente verwendet, muss nach der Initialisierung mithilfe der Funktion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cmd.map</a> Befehle an elm runtime <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">übergeben</a> . </p><br><h2 id="mutaciya">  Mutation </h2><br><p>  Die Funktion zum Aktualisieren der Komponente muss für jede Komponentennachricht aufgerufen werden.  Als Ergebnis der Ausführung gibt die Funktion ein Tripel zurück: </p><br><ol><li>  neues Modell oder neuer Zustand (Modell); </li><li>  Befehl oder Befehlsliste für die Elm-Laufzeit (Cmd Msg).  Die Befehle können Befehle zum Ausführen von HTTP-Anforderungen, zur Interaktion mit Ports und mehr sein. </li><li>  Ergebnis der Ausführung (Vielleicht zurück).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vielleicht hat</a> Typ zwei Zustände Nichts und Nur ein.  In unserem Fall gibt es nichts - es gibt kein Ergebnis, nur ein - es gibt ein Ergebnis.  Für die Autorisierung kann das Ergebnis beispielsweise Just (Authenticated UserData) sein - der Benutzer ist mit UserData-Daten angemeldet. </li></ol><br><p>  Nach der Mutation sollte der Code, der die Komponente verwendet, das Komponentenmodell aktualisieren und Befehle mithilfe der Funktion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cmd.map</a> an Elm Runtime <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">übergeben</a> . </p><br><p>  Erforderliche Argumente für die Aktualisierungsfunktion gemäß der Elm-Anwendungsarchitektur: </p><br><ol><li>  Nachricht (Nachricht) </li><li>  Modell (Modell). </li></ol><br><p>  Bei Bedarf kann die Liste der Argumente ergänzt werden. </p><br><h1 id="predstavlenie">  Einreichung </h1><br><p>  Die Ansichtsfunktion wird aufgerufen, wenn die Komponentenansicht in die allgemeine Anwendungsansicht eingefügt werden muss. </p><br><p>  Das erforderliche Argument für die Ansichtsfunktion muss das Komponentenmodell sein.  Bei Bedarf kann die Liste der Argumente ergänzt werden. </p><br><p>  Das Ergebnis der Ausführung der Ansichtsfunktion muss an die Funktion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Html.map übergeben</a> werden. </p><br><h1 id="integraciya-v-prilozhenie">  Anwendungsintegration </h1><br><p>  Das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beispiel</a> beschreibt zwei Komponenten: <a href="">Auth</a> und <a href="">Question</a> .  Komponenten der oben beschriebenen Prinzipien.  Überlegen Sie, wie sie in die <a href="">Anwendung</a> integriert werden <a href="">können</a> . </p><br><p>  Lassen Sie uns zunächst festlegen, wie unsere Anwendung funktionieren soll.  Wenn Sie darauf klicken, wird auf dem Bildschirm eine Schaltfläche angezeigt: </p><br><ol><li>  Für einen nicht autorisierten Benutzer wird nach der Autorisierung ein Autorisierungsformular angezeigt - ein Formular zum Posten von Fragen. </li><li>  Für einen autorisierten Benutzer wird ein Formular zur Platzierung von Fragen angezeigt. </li></ol><br><p>  Um die Anwendung zu beschreiben, die Sie benötigen: </p><br><ol><li>  Modell </li><li>  Nachrichten (Nachricht) </li><li>  Anwendungsstartpunkt (Haupt); </li><li>  Initialisierungsfunktion (init); </li><li>  Mutationsfunktion; </li><li>  Präsentationsfunktion; </li><li>  Abonnementfunktion. </li></ol><br><h1 id="model">  Modell </h1><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> alias </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ui</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Maybe</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ui</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ui</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AuthUi</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Component</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Auth</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QuestionUi</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Component</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Question</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Model</span></span></span></span></code> </pre> <br><p>  Das Modell enthält Informationen über den Benutzer (Benutzer) und den Typ der aktuellen Schnittstelle (UI).  Die Schnittstelle kann sich entweder im Standardzustand (Nothing) oder in einer der Komponenten Just a befinden. </p><br><p>  Zur Beschreibung der Komponenten verwenden wir den Ui-Typ, der jedes Komponentenmodell mit einer bestimmten Variante aus einer Reihe von Typen verknüpft (markiert).  Ein AuthUi-Tag verknüpft beispielsweise ein Berechtigungsmodell (Component.Auth.Model) mit einem Anwendungsmodell. </p><br><h1 id="soobscheniya">  Nachrichten </h1><br><pre> <code class="hljs vhdl"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Msg = OpenPopup | AuthMsg <span class="hljs-keyword"><span class="hljs-keyword">Component</span></span>.Auth.Msg | QuestionMsg <span class="hljs-keyword"><span class="hljs-keyword">Component</span></span>.Question.Msg</code> </pre> <br><p>  In Nachrichten müssen Sie alle Komponentennachrichten kennzeichnen und in die Anwendungsnachrichten aufnehmen.  Die Tags AuthMsg und QuestionMsg verknüpfen die Nachrichten der Autorisierungskomponente bzw. die Frage des Benutzers. </p><br><p>  Eine OpenPopup-Nachricht wird benötigt, um eine Anforderung zum Öffnen einer Schnittstelle zu verarbeiten. </p><br><h1 id="funkciya-main">  Hauptfunktion </h1><br><pre> <code class="hljs pgsql">main : Program Never Model Msg main = Html.program { init = init , <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> , subscriptions = subscriptions , <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> }</code> </pre> <br><p>  Der Anwendungseinstiegspunkt wird normalerweise für eine Elm-Anwendung beschrieben. </p><br><h1 id="funkciya-inicializacii">  Initialisierungsfunktion </h1><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">init</span></span> : ( <span class="hljs-type"><span class="hljs-type">Model</span></span>, <span class="hljs-type"><span class="hljs-type">Cmd</span></span> <span class="hljs-type"><span class="hljs-type">Msg</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> = ( initModel, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">none</span></span> ) initModel : <span class="hljs-type"><span class="hljs-type">Model</span></span> initModel = { user = <span class="hljs-type"><span class="hljs-type">Anonymous</span></span> , ui = <span class="hljs-type"><span class="hljs-type">Nothing</span></span> }</code> </pre> <br><p>  Die Initialisierungsfunktion erstellt ein Startmodell und erfordert keine Ausführung von Befehlen. </p><br><h1 id="funkciya-mutacii">  Mutationsfunktion </h1><br><div class="spoiler">  <b class="spoiler_title">Funktionsquellcode</b> <div class="spoiler_text"><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.ui) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (OpenPopup, <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span>) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Auth.init model.user <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (authModel, commands, Just (Component.Auth.Authenticated userData)) -&gt; let (questionModel, questionCommands, _) = Component.Question.init userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| QuestionUi questionModel, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> userData }, Cmd.batch [Cmd.map AuthMsg commands, Cmd.map QuestionMsg questionCommands] ) (authModel, commands, _) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| AuthUi authModel }, Cmd.map AuthMsg commands ) (AuthMsg authMsg, Just (AuthUi authModel)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Auth.update authMsg authModel <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (_, commands, Just (Component.Auth.Authenticated userData)) -&gt; let (questionModel, questionCommands, _) = Component.Question.init userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| QuestionUi questionModel, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">User</span></span> userData }, Cmd.batch [Cmd.map AuthMsg commands, Cmd.map QuestionMsg questionCommands] ) (newAuthModel, commands, _) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| AuthUi newAuthModel }, Cmd.map AuthMsg commands ) (QuestionMsg questionMsg, Just (QuestionUi questionModel)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Question.update questionMsg questionModel <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (_, commands, Just (Component.Question.Saved <span class="hljs-built_in"><span class="hljs-built_in">record</span></span>)) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span> }, Cmd.map QuestionMsg commands ) (newQuestionModel, commands, _) -&gt; ( { <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> | ui = Just &lt;| QuestionUi newQuestionModel }, Cmd.map QuestionMsg commands ) _ -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">model</span></span>, Cmd.none )</code> </pre> </div></div><br><p>  Weil  Wenn das Modell und die Nachrichten mit der Anwendung verbunden sind, werden einige Nachrichten (Msg) und die Art der Schnittstelle (model.ui: Ui) verarbeitet. </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">update</span></span> : Msg -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span> -&gt; ( <span class="hljs-keyword"><span class="hljs-keyword">Model</span></span>, Cmd Msg ) <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> msg <span class="hljs-keyword"><span class="hljs-keyword">model</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (msg, model.ui) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span></code> </pre> <br><h1 id="logika-raboty">  Arbeitslogik </h1><br><p>  Wenn eine OpenPopup-Nachricht empfangen wird und die Standardschnittstelle im Modell angegeben ist (model.ui = Nothing), initialisieren wir die Auth-Komponente.  Wenn die Auth-Komponente meldet, dass der Benutzer autorisiert ist, initialisieren wir die Question-Komponente und speichern sie im Anwendungsmodell.  Andernfalls speichern wir das Komponentenmodell im Anwendungsmodell. </p><br><pre> <code class="hljs swift">(<span class="hljs-type"><span class="hljs-type">OpenPopup</span></span>, <span class="hljs-type"><span class="hljs-type">Nothing</span></span>) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Auth</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span> model.user of (authModel, commands, <span class="hljs-type"><span class="hljs-type">Just</span></span> (<span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Auth</span></span>.<span class="hljs-type"><span class="hljs-type">Authenticated</span></span> userData)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (questionModel, questionCommands, <span class="hljs-number"><span class="hljs-number">_</span></span>) = <span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Question</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span> userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { model | ui = <span class="hljs-type"><span class="hljs-type">Just</span></span> &lt;| <span class="hljs-type"><span class="hljs-type">QuestionUi</span></span> questionModel, user = <span class="hljs-type"><span class="hljs-type">User</span></span> userData }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.batch [<span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">AuthMsg</span></span> commands, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">QuestionMsg</span></span> questionCommands] ) (authModel, commands, <span class="hljs-number"><span class="hljs-number">_</span></span>) -&gt; ( { model | ui = <span class="hljs-type"><span class="hljs-type">Just</span></span> &lt;| <span class="hljs-type"><span class="hljs-type">AuthUi</span></span> authModel }, <span class="hljs-type"><span class="hljs-type">Cmd</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">AuthMsg</span></span> commands )</code> </pre> <br><p>  Wenn eine Nachricht mit dem AuthMsg ein Tag empfangen wird und die Autorisierungsschnittstelle im Modell angegeben ist (model.ui = Just (AuthUi authModel)), übergeben wir die Komponentennachricht und das Komponentenmodell an die Auth.update-Funktion.  Als Ergebnis erhalten wir ein neues Komponentenmodell, neue Befehle und ein neues Ergebnis. </p><br><p>  Wenn der Benutzer autorisiert ist, initialisieren wir die Fragekomponente, andernfalls aktualisieren wir die Schnittstellendaten im Anwendungsmodell. </p><br><pre> <code class="hljs powershell">(AuthMsg authMsg, Just (AuthUi authModel)) -&gt; case Component.Auth.update authMsg authModel of (_, commands, Just (Component.Auth.Authenticated userData)) -&gt; let (questionModel, questionCommands, _) = Component.Question.init userData <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( { model | ui = Just &lt;| QuestionUi questionModel, user = User userData }, Cmd.batch [<span class="hljs-type"><span class="hljs-type">Cmd.map</span></span> <span class="hljs-type"><span class="hljs-type">AuthMsg</span></span> <span class="hljs-type"><span class="hljs-type">commands</span></span>, <span class="hljs-type"><span class="hljs-type">Cmd.map</span></span> <span class="hljs-type"><span class="hljs-type">QuestionMsg</span></span> <span class="hljs-type"><span class="hljs-type">questionCommands</span></span>] ) (newAuthModel, commands, _) -&gt; ( { model | ui = Just &lt;| AuthUi newAuthModel }, Cmd.map AuthMsg commands )</code> </pre> <br><p>  Ähnlich wie bei der Auth-Komponente werden Nachrichten für die Question-Komponente verarbeitet.  Wenn die Frage erfolgreich gestellt wurde, ändert sich die Schnittstelle auf die Standardeinstellung (model.ui = Nothing). </p><br><pre> <code class="hljs pgsql">(QuestionMsg questionMsg, Just (QuestionUi questionModel)) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Component.Question.<span class="hljs-keyword"><span class="hljs-keyword">update</span></span> questionMsg questionModel <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> (_, commands, Just (Component.Question.Saved <span class="hljs-type"><span class="hljs-type">record</span></span>)) -&gt; ( { model | ui = <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span> }, Cmd.map QuestionMsg commands ) (newQuestionModel, commands, _) -&gt; ( { model | ui = Just &lt;| QuestionUi newQuestionModel }, Cmd.map QuestionMsg commands )</code> </pre> <br><p>  Alle anderen Fälle werden ignoriert. </p><br><pre> <code class="hljs lisp"> _ -&gt; ( <span class="hljs-name"><span class="hljs-name">model</span></span>, Cmd.none )</code> </pre> <br><h1 id="funkciya-predstavleniya">  Ansichtsfunktion </h1><br><pre> <code class="hljs powershell">view : Model -&gt; Html Msg view model = case model.ui of Nothing -&gt; div <span class="hljs-function"><span class="hljs-function">[] [ </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">div</span></span></span><span class="hljs-function"> [] [ </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">button</span></span></span><span class="hljs-function"> [ </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">Events.onClick</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">OpenPopup</span></span></span><span class="hljs-function"> ] [ </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">text</span></span></span><span class="hljs-function"> </span><span class="hljs-string"><span class="hljs-function"><span class="hljs-string">"Open popup"</span></span></span><span class="hljs-function"> ] ] ] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Just</span></span></span></span> (AuthUi authModel) -&gt; Component.Auth.view authModel |&gt; Html.map AuthMsg Just (QuestionUi questionModel) -&gt; Component.Question.view questionModel |&gt; Html.map QuestionMsg</code> </pre> <br><p>  Abhängig vom Typ der Schnittstelle (model.ui) generiert die Präsentationsfunktion entweder eine Standardschnittstelle oder ruft die Komponentenpräsentationsfunktion auf und ordnet den Komponentennachrichtentyp dem Anwendungsnachrichtentyp (Html.map) zu. </p><br><h1 id="funkciya-podpiski">  Abonnementfunktion </h1><br><pre> <code class="hljs vbscript">subscriptions : Model -&gt; <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> Msg subscriptions model = <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span>.none</code> </pre> <br><p>  Kein Abonnement. </p><br><h1 id="dalee">  Weiter </h1><br><p>  Dieses Beispiel ist zwar etwas praktischer, aber recht naiv.  Was fehlt: </p><br><ol><li>  Blockieren der Interaktion mit der Anwendung während des Downloadvorgangs; </li><li>  Datenvalidierung.  Benötigt ein separates Gespräch; </li><li>  wirklich Popup-Fenster mit der Fähigkeit zu schließen. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424341/">https://habr.com/ru/post/de424341/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424331/index.html">Kubernetes 1.12: Ein Überblick über die wichtigsten Innovationen</a></li>
<li><a href="../de424333/index.html">Meine Erfahrung mit Dating und der Arbeit mit Robot Framework</a></li>
<li><a href="../de424335/index.html">Lass es Licht sein</a></li>
<li><a href="../de424337/index.html">Ruby-Code: kompetent, schön und effizient. Beispiel für Anfänger</a></li>
<li><a href="../de424339/index.html">Tandem des Autors und Experten: Wie macht man es effektiv?</a></li>
<li><a href="../de424343/index.html">Zusammenarbeit und Zugriffsrechte in DentalTap</a></li>
<li><a href="../de424345/index.html">Wie ich Datenwissenschaft studiert habe</a></li>
<li><a href="../de424349/index.html">"Testerkalender" für September. Tests optimieren</a></li>
<li><a href="../de424353/index.html">Hintergrund: Staatliche Internet-Suchmaschine Sputnik und ihre komplexe Geschichte</a></li>
<li><a href="../de424355/index.html">Spritzguss: wie es funktioniert</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>