<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçã üíº üôé Under the hood Screeps: virtualizaci√≥n en el sandbox MMO para programadores üéº üöÜ üë©üèæ‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo hablar√© sobre una tecnolog√≠a poco conocida que ha encontrado una aplicaci√≥n clave en nuestro juego en l√≠nea para programadores. Para ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Under the hood Screeps: virtualizaci√≥n en el sandbox MMO para programadores</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437836/"><p> En este art√≠culo hablar√© sobre una tecnolog√≠a poco conocida que ha encontrado una aplicaci√≥n clave en nuestro juego en l√≠nea para programadores.  Para no tirar de la goma durante mucho tiempo, hay un spoiler de inmediato: parece que nadie ha hecho tal chamanismo en el c√≥digo nativo de Node.js al que llegamos despu√©s de varios a√±os de desarrollo.  El motor de m√°quina virtual aislado (c√≥digo abierto), que se ejecuta bajo el cap√≥ del proyecto, fue escrito espec√≠ficamente para sus necesidades, y actualmente lo utilizamos en la producci√≥n nosotros y otra startup.  Y las capacidades de aislamiento que ofrece son √∫nicas y merecen ser informadas sobre ellas. </p><br><p>  Pero hablemos de todo en orden. </p><br><h2>  Antecedentes </h2><br><p>  ¬øTe gusta la programaci√≥n?  No es la codificaci√≥n empresarial de rutina que muchos de nosotros estamos obligados a hacer 40 horas a la semana, luchando con la dilaci√≥n, vertiendo litros de caf√© y quemando profesionalmente;  y la <i>programaci√≥n</i> es un proceso m√°gico incomparable de transformar los pensamientos en un programa de trabajo, disfrutando del hecho de que el c√≥digo que acaba de escribir est√° incorporado en la pantalla y comienza a vivir la vida que el creador le dice.  En esos momentos, quiero escribir la palabra "Creador" con una letra may√∫scula; tal sentimiento que surge en el proceso a veces es cercano a la reverencia. </p><br><p><img src="https://habrastorage.org/webt/mm/2a/5h/mm2a5hmu2k6s26hviyoykwd6tv8.jpeg"></p><br><p>  Es una pena que muy pocos proyectos reales relacionados con las ganancias diarias puedan ofrecer a sus desarrolladores tales sentimientos.  La mayor√≠a de las veces, para no perder la pasi√≥n por la programaci√≥n, los entusiastas deben comenzar una aventura al margen: un pasatiempo de programaci√≥n, un proyecto favorito, un c√≥digo abierto de moda, solo un script de Python para automatizar su hogar inteligente ... o el comportamiento de un personaje en alg√∫n popular en l√≠nea juego </p><a name="habracut"></a><br><p>  S√≠, son los juegos en l√≠nea que a menudo proporcionan una fuente inagotable de inspiraci√≥n para los programadores.  Incluso los primeros juegos de este g√©nero (Ultima Online, Everquest, sin mencionar todo tipo de MUD) atrajeron a muchos artesanos que no est√°n interesados ‚Äã‚Äãtanto en interpretar el papel y disfrutar la fantas√≠a del mundo, sino en la aplicaci√≥n de sus talentos para automatizar todo y todo en espacio de juego virtual  Y hasta el d√≠a de hoy, sigue siendo una disciplina especial de la Olimpiada de juegos MMO en l√≠nea: refina tu mente para escribir tu bot para pasar desapercibido por la administraci√≥n y obtener el m√°ximo beneficio en comparaci√≥n con otros jugadores.  U otros bots, como, por ejemplo, en EVE Online, donde el comercio en mercados densamente poblados est√° ligeramente menos que completamente controlado por scripts de comercio, al igual que en los intercambios reales. </p><br><p>  La idea de un juego en l√≠nea, <em>inicialmente y completamente orientada a los programadores,</em> flotaba en el aire.  Tal juego en el que escribir un bot no es un acto punible, sino la esencia del juego.  Donde la tarea no ser√≠a realizar las mismas acciones "matar monstruos X y encontrar elementos Y" de vez en cuando, sino escribir un script que pueda realizar correctamente estas acciones en su nombre.  Y dado que implica un juego en l√≠nea en el g√©nero MMO, la rivalidad tiene lugar con los guiones de otros jugadores en tiempo real en un solo mundo de juego com√∫n. </p><br><p>  Entonces, en 2014, apareci√≥ el juego Screeps (de las palabras "Scripts" y "creeps"): una caja de arena MMO estrat√©gica en tiempo real con un solo <em>mundo</em> grande y <em>persistente</em> en el que los jugadores no tienen influencia sobre lo que est√° sucediendo, excepto escribiendo scripts de IA para sus unidades de juego .  Todas las mec√°nicas de un juego estrat√©gico ordinario: extracci√≥n de recursos, construcci√≥n de unidades, construcci√≥n de una base, toma de territorios, fabricaci√≥n y comercio: el propio jugador debe ser programado a trav√©s de la API de JavaScript proporcionada por el mundo del juego.  La diferencia de las diferentes competencias en la escritura de IA es que el mundo del juego, como deber√≠a ser en el mundo de los juegos en l√≠nea, trabaja constantemente y vive su vida en tiempo real 24/7 durante los √∫ltimos 4 a√±os, lanzando la IA de cada jugador en cada ciclo de juego. </p><br><p>  Entonces, lo suficiente sobre el juego en s√≠, esto deber√≠a ser suficiente para comprender mejor la esencia de los problemas t√©cnicos que encontramos durante el desarrollo.  Puede obtener m√°s vistas de este video, pero esto es opcional: </p><br><div class="spoiler">  <b class="spoiler_title">Video trailer</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZboTgOajnGg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><h2>  Problemas t√©cnicos </h2><br><p>  La esencia de la mec√°nica del mundo del juego es la siguiente: el mundo entero est√° dividido en <strong>salas</strong> , que est√°n interconectadas por salidas en cuatro puntos cardinales.  Una habitaci√≥n es una unidad at√≥mica del proceso de procesamiento del estado del mundo del juego.  La sala puede tener ciertos objetos (por ejemplo, unidades) que tienen su propio estado, y en cada paso del juego reciben comandos de los jugadores.  El controlador del servidor ocupa una sala a la vez, ejecuta estos comandos, cambia el estado de los objetos y confirma el nuevo estado de la sala en la base de datos.  Este sistema se escala bien horizontalmente: puede agregar m√°s controladores al cl√∫ster, y dado que las salas est√°n aisladas arquitect√≥nicamente entre s√≠, se pueden procesar tantas salas en paralelo como hay controladores en ejecuci√≥n. </p><br><p><img src="https://habrastorage.org/webt/mp/d0/ed/mpd0ed40jp8efrihjrxkfft49fc.png"></p><br><p>  Por el momento tenemos <strong>42,060 habitaciones</strong> en el juego.  Un grupo de servidores de 36 m√°quinas f√≠sicas de cuatro n√∫cleos contiene 144 procesadores.  Usamos Redis para crear colas, todo el backend est√° escrito en Node.js. </p><br><p>  Esta fue una etapa del tacto del juego.  ¬øPero de d√≥nde vienen los equipos de jugadores?  Los detalles del juego son que no hay una interfaz en la que puedas hacer clic en una unidad y decirle que vaya a cierto punto o que construya una estructura espec√≠fica.  Lo m√°ximo que se puede hacer en la interfaz es colocar una bandera intangible en el lugar correcto de la habitaci√≥n.  Para que la unidad venga a este lugar y tome las medidas necesarias, es necesario que su script haga algo como lo siguiente para varios ticks del juego: </p><br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.loop = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> creep = Game.creeps[<span class="hljs-string"><span class="hljs-string">'Creep1'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> flag = Game.flags[<span class="hljs-string"><span class="hljs-string">'Flag1'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!creep.pos.isEqualTo(flag.pos)) { creep.moveTo(flag.pos); } }</code> </pre> <br><p>  Resulta que en cada paso del juego debes tomar la funci√≥n de <code>loop</code> del jugador, ejecutarla en un entorno JavaScript completo de ese jugador en particular (en el que existe el objeto del <code>Game</code> creado para √©l), obtener un conjunto de √≥rdenes para las unidades y darles la siguiente etapa de procesamiento.  Todo parece ser bastante simple. </p><br><p><img src="https://habrastorage.org/webt/po/om/vh/poomvhcw4nhpjcsgk2df0a5hg_e.png"></p><br><p>  Los problemas comienzan cuando se trata de los matices de la implementaci√≥n.  En este momento tenemos <strong>1600 jugadores activos</strong> en el mundo.  Los scripts de reproductores individuales ya no se pueden llamar "scripts": algunos de ellos contienen hasta <strong>25k l√≠neas de c√≥digo</strong> , se compilan a partir de TypeScript o incluso de C / C ++ / Rust a trav√©s de WebAssembly (s√≠, admitimos wasm!), E implementamos el concepto de sistemas operativos en miniatura reales, en el que los jugadores han desarrollado su propio grupo de tareas-procesos de juego y su gesti√≥n a trav√©s del n√∫cleo, que toma tantas tareas como resulta realizar en un determinado toque de un juego, las ejecuta y las vuelve a poner en la cola hasta la pr√≥xima medida.  Dado que la CPU y la memoria del reproductor est√°n limitadas en cada ciclo de reloj, este modelo funciona bien.  Aunque no es obligatorio, para comenzar el juego es suficiente que un principiante tome un gui√≥n de 15 l√≠neas, que tambi√©n est√° escrito como parte del tutorial. </p><br><p>  Pero ahora recordemos que el script del reproductor deber√≠a funcionar en una m√°quina JavaScript real.  Y que el juego funciona en tiempo real, es decir, la m√°quina JavaScript de cada jugador debe existir constantemente, trabajando a un cierto ritmo, para no ralentizar el juego en su conjunto.  La etapa de ejecutar guiones de juego y formar √≥rdenes para unidades funciona aproximadamente con el mismo principio que las salas de procesamiento: el gui√≥n de cada jugador es una tarea que un manejador del grupo asume, muchos manejadores paralelos trabajan en el grupo.  Pero a diferencia de la etapa de salas de procesamiento, ya hay muchas dificultades. </p><br><p>  En primer lugar, no puede simplemente distribuir tareas de forma aleatoria en cada ciclo de reloj, como es posible en el caso de las salas.  La m√°quina JavaScript del reproductor deber√≠a funcionar sin interrupci√≥n, cada medida posterior es solo una nueva llamada de funci√≥n de <code>loop</code> , pero el contexto global debe seguir existiendo igual.  En t√©rminos generales, el juego te permite hacer algo como esto: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> song = [<span class="hljs-string"><span class="hljs-string">'EX-'</span></span>, <span class="hljs-string"><span class="hljs-string">'TER-'</span></span>, <span class="hljs-string"><span class="hljs-string">'MI-'</span></span>, <span class="hljs-string"><span class="hljs-string">'NATE!'</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.loop = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Game.creeps[<span class="hljs-string"><span class="hljs-string">'DalekSinger'</span></span>].say(song[counter]); counter++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(counter == song.length) { counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre> <br><p><img src="https://habrastorage.org/webt/sz/sk/je/szskjecusiurkgvg1apq3sxzjdw.gif"></p><br><p>  Tal asqueroso cantar√° en una l√≠nea de la canci√≥n cada latido del juego.  El n√∫mero de l√≠nea del <code>counter</code> canciones se almacena en un contexto global que se almacena entre compases.  Si cada vez que se ejecuta el script de este reproductor en un nuevo proceso de controlador, se perder√° el contexto.  Esto significa que todos los jugadores deber√≠an asignarse a controladores espec√≠ficos, y deber√≠an cambiarse lo menos posible.  Pero entonces, ¬øqu√© pasa con el equilibrio de carga?  Un jugador puede gastar 500 ms de ejecuci√≥n en este nodo, y el otro jugador puede gastar 10 ms, y es muy dif√≠cil predecir esto por adelantado.  Si 20 jugadores 500ms caen cada uno en un nodo, entonces la operaci√≥n de dicho nodo tomar√° 10 segundos, durante los cuales todos los dem√°s esperar√°n su finalizaci√≥n y permanecer√°n inactivos.  Y para reequilibrar estos jugadores y lanzarlos a otros nodos, debes perder su contexto. </p><br><p>  En segundo lugar, el entorno del jugador debe estar bien aislado de otros jugadores y del entorno del servidor.  Y esto no solo concierne a la seguridad, sino tambi√©n a la comodidad de los propios usuarios.  Si un jugador vecino que se ejecuta en el mismo nodo del cl√∫ster que yo lo hace horriblemente, genera mucha basura y generalmente se comporta de manera incorrecta, entonces no deber√≠a sentirlo.  Dado que el recurso de CPU en el juego es el tiempo de ejecuci√≥n del script (se calcula desde el principio hasta el final del m√©todo de <code>loop</code> ), el desperdicio de recursos en tareas extra√±as durante la ejecuci√≥n de mi script puede ser muy sensible, ya que lo gasto del presupuesto de recursos de mi CPU. </p><br><p>  Al tratar de resolver estos problemas, encontramos varias soluciones. </p><br><h2 id="pervaya-versiya">  Primera versi√≥n </h2><br><p>  La primera versi√≥n del motor del juego se bas√≥ en dos cosas b√°sicas: </p><br><ul><li>  m√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>vm</code></a> tiempo completo en la entrega de Node.js, </li><li>  bifurcaci√≥n de procesos de tiempo de ejecuci√≥n. </li></ul><br><p>  Se ve√≠a as√≠.  En cada m√°quina en el cl√∫ster hab√≠a 4 (seg√∫n el n√∫mero de n√∫cleos) procesos de controladores de guiones de juego.  Cuando se recibi√≥ una nueva tarea de la cola de scripts del juego, el controlador solicit√≥ los datos necesarios de la base de datos y los transfiri√≥ a un proceso secundario, que se mantuvo en un estado de ejecuci√≥n constante, se reinici√≥ en caso de falla y fue reutilizado por diferentes jugadores.  El proceso hijo, al estar aislado del padre (que conten√≠a la l√≥gica empresarial del cl√∫ster), solo pod√≠a hacer una cosa: crear un objeto <code>Game</code> partir de los datos recibidos e iniciar la m√°quina virtual del jugador.  Para comenzar, utilizamos el m√≥dulo <code>vm</code> en Node.js. </p><br><p>  ¬øPor qu√© esta decisi√≥n fue imperfecta?  Estrictamente hablando, los dos problemas anteriores no se resolvieron aqu√≠. </p><br><p>  <code>vm</code> funciona en el mismo modo de subproceso √∫nico que Node.js.  Por lo tanto, para tener cuatro procesadores paralelos en cada n√∫cleo en una m√°quina de 4 n√∫cleos, debe tener 4 procesos.  Mover a un jugador "vivo" en un proceso a otro proceso lleva a una recreaci√≥n completa del contexto global, incluso si esto sucede dentro de la misma m√°quina. </p><br><p><img src="https://habrastorage.org/webt/mu/pk/xl/mupkxlqzbbgh4zjnnymqjdjapm0.png"></p><br><p>  Adem√°s, <code>vm</code> realidad no crea una m√°quina virtual completamente aislada.  Lo que hace es crear un <em>contexto</em> o √°mbito aislado, pero ejecutar el c√≥digo en la misma instancia de la m√°quina virtual JavaScript, de donde <code>vm.runInContext</code> llamada <code>vm.runInContext</code> .  Y eso significa, en el mismo caso en que se lanzan otros jugadores.  Aunque los jugadores est√°n separados por contextos globales aislados, pero, al ser parte de la misma m√°quina virtual, tienen una memoria de almacenamiento din√°mico com√∫n, un recolector de basura com√∫n y generan basura juntos.  Si el jugador "A" gener√≥ mucha basura durante la ejecuci√≥n de su script de juego, termin√≥ el trabajo y el control pas√≥ al jugador "B", entonces en ese momento se puede recolectar <em>toda la</em> basura del proceso, y el jugador "B" pagar√° el tiempo de CPU para recoger la basura de otra persona.  Sin mencionar el hecho de que todos los contextos funcionan en el mismo bucle de eventos y, en teor√≠a, es posible ejecutar la promesa de otra persona en cualquier momento, aunque tratamos de evitarlo.  Adem√°s, <code>vm</code> no le permite controlar la cantidad de memoria heap asignada para la ejecuci√≥n del script, toda la memoria de proceso est√° disponible. </p><br><h2 id="isolated-vm">  vm aislado </h2><br><p>  All√≠ vive una persona tan maravillosa llamada Marcel Laverde.  Para algunos, una vez se hizo notable por escribir una biblioteca de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fibras de nodo</a> , para otros, por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hackear Facebook y fue contratado para trabajar all√≠</a> .  Y para nosotros es maravilloso porque particip√≥ generosamente en nuestra primera campa√±a de crowdfunding y hasta el d√≠a de hoy es un gran admirador de Screeps. </p><br><p>  Nuestro proyecto ha estado en c√≥digo abierto durante varios a√±os: el servidor de juegos se publica en GitHub.  Aunque el cliente oficial se vende por una tarifa a trav√©s de Steam, existen versiones alternativas y el servidor est√° disponible para su estudio y modificaci√≥n a cualquier escala, lo que recomendamos encarecidamente. </p><br><p>  Y una vez que Marcel nos escribe: ‚ÄúChicos, tengo una buena experiencia en el desarrollo nativo de C / C ++ para Node.js, y me gusta su juego, pero no a todos les gusta c√≥mo funciona, escribamos uno nuevo ¬øTecnolog√≠a de lanzamiento de m√°quina virtual para Node.js espec√≠ficamente para Screeps? </p><br><p>  Como Marcel no pidi√≥ dinero, no pudimos rechazarlo.  Despu√©s de varios meses de nuestra cooperaci√≥n, naci√≥ la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>aislada-vm</strong></a> .  Y eso cambi√≥ absolutamente todo. </p><br><p>  <code>isolated-vm</code> difiere de <code>vm</code> en que no a√≠sla el <em>contexto</em> , sino que lo a√≠sla en t√©rminos de <abbr title="Motor de JavaScript utilizado en Node.js">V8</abbr> .  Sin entrar en detalles, esto significa que se crea una instancia separada completa de la m√°quina JavaScript, que no solo tiene su propio contexto global, sino tambi√©n su propia memoria de almacenamiento din√°mico, recolector de basura y funciona como parte de un bucle de eventos separado.  De las desventajas: para cada m√°quina en ejecuci√≥n, se requiere una peque√±a sobrecarga de RAM (aproximadamente 20 MB), y tambi√©n es imposible transferir objetos o llamar funciones directamente a la m√°quina, todo el intercambio debe ser serializado.  Esto termina con los contras, el resto, ¬°es solo una panacea! </p><br><p><img src="https://habrastorage.org/webt/gh/cz/5v/ghcz5vxih2oaferse6kgv-zruvq.png"></p><br><p>  Ahora es realmente posible ejecutar el script de cada jugador en su propio espacio completamente aislado.  El jugador tiene sus propios 500 MB de cadera, si termina, significa que es su propia cadera la que ha terminado, y no la cadera del proceso general.  Si gener√≥ basura, entonces esta es su propia basura, debe recolectarla.  Las promesas pendientes se ejecutar√°n solo cuando su aislamiento se haga cargo la pr√≥xima vez, y no antes.  Bien y seguridad: bajo ninguna circunstancia es posible acceder a alg√∫n lugar fuera del aislamiento, solo si encuentra alguna vulnerabilidad en el nivel V8. </p><br><p>  ¬øPero qu√© hay del equilibrio?  Otra ventaja de isolated-vm es que inicia las m√°quinas desde el mismo proceso, pero en subprocesos separados (la experiencia de Marcel con fibras de nodo fue √∫til aqu√≠).  Si tenemos una m√°quina de 4 n√∫cleos, podemos crear un grupo de 4 subprocesos e iniciar 4 m√°quinas paralelas a la vez.  Al mismo tiempo, al estar dentro del mismo proceso, lo que significa tener una memoria com√∫n, podemos transferir cualquier jugador de un hilo a otro dentro de este grupo.  Aunque cada jugador permanece atado a un proceso espec√≠fico en una m√°quina espec√≠fica (para no perder el contexto global), el equilibrio entre 4 hilos es suficiente para resolver los problemas de distribuci√≥n de jugadores "pesados" y "ligeros" entre nodos para que todos los procesadores terminen trabajar al mismo tiempo y a tiempo. </p><br><p>  Despu√©s de ejecutar esta funci√≥n en el modo experimental, recibimos una gran cantidad de comentarios positivos de los jugadores cuyas secuencias de comandos comenzaron a funcionar mucho mejor, m√°s estable y m√°s predecible.  Y ahora este es nuestro motor predeterminado, aunque los jugadores a√∫n pueden elegir el tiempo de ejecuci√≥n heredado puramente por compatibilidad con versiones anteriores de scripts (algunos jugadores se centraron conscientemente en los detalles del entorno compartido en el juego). </p><br><p>  Por supuesto, todav√≠a hay espacio para la optimizaci√≥n adicional, y tambi√©n hay otras √°reas interesantes del proyecto en las que resolvimos varios problemas t√©cnicos.  Pero m√°s sobre eso en otro momento. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/437836/">https://habr.com/ru/post/437836/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../437826/index.html">C√≥mo migramos la base de datos de Redis y Riak KV a PostgreSQL. Parte 1: el proceso</a></li>
<li><a href="../437828/index.html">Abra el seminario web "SELECCIONE el orden de ejecuci√≥n de consultas y el plan de consultas en MS SQL Server"</a></li>
<li><a href="../437830/index.html">Programaci√≥n confiable por idioma: revisi√≥n novata. Parte 1</a></li>
<li><a href="../437832/index.html">C√≥digo abierto: c√≥digo de humor, trucos de c√≥digo, NO c√≥digo</a></li>
<li><a href="../437834/index.html">Dos historias sobre c√≥mo tuvieron lugar los eventos de programaci√≥n en Ekaterimburgo</a></li>
<li><a href="../437838/index.html">Las tecnolog√≠as de aprendizaje autom√°tico aceleran el proceso de adaptaci√≥n de los pacientes a las pr√≥tesis bi√≥nicas a veces</a></li>
<li><a href="../437842/index.html">La historia secreta de Donkey Kong: de m√°quinas recreativas a NES</a></li>
<li><a href="../437844/index.html">La lucha duradera de la escritura est√°tica frente a la din√°mica: TypeScript no ayudar√°</a></li>
<li><a href="../437846/index.html">bobaoskit - accesorios, dnssd y WebSocket</a></li>
<li><a href="../437848/index.html">Hacemos que el proceso de desarrollo de software pesado para microcontroladores sea m√°s conveniente (no)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>