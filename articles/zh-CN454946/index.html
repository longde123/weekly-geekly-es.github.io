<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍💻 👣 🎁 全球国家：为什么以及如何避免它们 📃 😵 🧝🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="全球条件。 这个短语在每个不幸面对这种现象的开发人员的心中引起恐惧和痛苦。 您是否已经遇到过意外的应用程序行为，无法理解其原因，例如一个不幸的骑士试图用许多头杀死Hydra？ 您最终会经历无休止的反复试验，90％的时间想知道正在发生什么？ 

 所有这些可能会成为全局变量的令人讨厌的结果：由于您尚未...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>全球国家：为什么以及如何避免它们</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/454946/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/il/xm/yl/ilxmyllyrjl50zu_shop-i-3fus.jpeg"></div><br> 全球条件。 这个短语在每个不幸面对这种现象的开发人员的心中引起恐惧和痛苦。 您是否已经遇到过意外的应用程序行为，无法理解其原因，例如一个不幸的骑士试图用许多头杀死Hydra？ 您最终会经历无休止的反复试验，90％的时间想知道正在发生什么？ <br><br> 所有这些可能会成为全局变量的令人讨厌的结果：由于您尚未弄清原因，隐藏变量会在未知位置更改其状态。 <br><a name="habracut"></a><br> 您是否想在尝试更改应用程序时在黑暗中徘徊？ 我当然不喜欢 幸运的是，我为您准备了蜡烛： <br><br><ol><li> 首先，我将描述我们最常称为的全球状态。 该术语并非总是准确使用，因此需要澄清。 <br></li><li> 接下来，我们将找出为什么全局变量对我们的代码库有害。 <br></li><li> 然后，我将说明如何调整全局变量的范围，以将其转换为局部变量。 <br></li><li> 最后，我将讨论封装以及为什么对全局变量的争夺只是大问题的一部分。 <br></li></ol><br> 我希望本文能够解释您需要了解的有关全球状态的所有信息。 如果您认为我想念很多，并且为此而讨厌我并且不想再见到我，请在评论中写下。 对于我，我的读者以及突然出现在此页面上的每个人来说，这都是一件令人愉快的事情。 <br><br> 亲爱的读者，您准备好骑马并且认识您的敌人了吗？ 去找到这些地球仪，让他们尝尝我们的剑剑！ <br><br><h1> 什么情况？ </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/7dd/561/59c/7dd56159c2c3d32176e249ea71ed13ad.jpg"><br><br> 让我们从基础开始，以便开发人员彼此了解。 <br><br> 状态是系统或实体的定义。 在现实生活中发现状态： <br><br><ul><li> 关闭计算机后，其状态将关闭。 <br></li><li> 当一杯茶很热时，她的状况很热。 <br></li></ul><br> 在软件开发中，某些构造（例如变量）可能具有状态。 假设字符串“ hello”或数字11不被视为状态，它们是值。 将它们附加到变量并放入内存后，它们便变为状态。 <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// No state here! $lala = "hello"; // The variable $lala has the state 'hello'.</span></span></code> </pre> <br> 可以区分两种状态： <br><br> 可变状态：初始化后，它们可以在应用程序执行期间随时更改。 <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $lala = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Initialisation of the variable. $lala = "hallo"; // The state of the variable $lala can be changed at runtime.</span></span></code> </pre> <br> 不可变状态：执行期间无法更改。 您将第一个状态分配给变量，并且其值随后不会更改。 日常生活中的“常量”被称为不可变状态的示例： <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> define(<span class="hljs-string"><span class="hljs-string">"GREETING"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Constant definition. echo GREETING; GREETING = "hallo"; // This line will produce an error!</span></span></code> </pre> <br> 现在，让我们听听Denis和您的开发人员Vasily之间的假设对话： <br><br> 丹！ 您已经在各处创建了全局变量！ 不破坏一切就无法更改它们！ 我会杀了你！ <br>  -Nifiga，Vasek！ 我的全球财富真棒！ 我将自己的灵魂投入其中，这些都是杰作！ 我崇拜我的全球人！ <br><br> 开发人员通常将全局状态，全局变量或全局变量称为应称为全局可变状态的全局变量。 也就是说，可以在您可用的最大<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">范围内</a>修改状态：在整个应用程序中。 <br><br> 当变量没有将整个应用程序作为范围时，我们在谈论局部变量或区域设置。 它们存在于某些给定的可见性区域中，而不是整个应用程序的区域。 <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Ecommerce</span></span>; $global = <span class="hljs-string"><span class="hljs-string">"I'm a mutable global variable!"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// global variable class Shipment { public $warehouse; // local variable existing in the whole class public function __construct() { $info = "You're creating a shipment object!"; // local variable bound to the constructor scope echo $info; } } class Product { public function __construct() { global $global; $global = "I change the state now 'cause I can!"; echo "You're creating a product object!"; // no state here } }</span></span></code> </pre> <br> 您可能会想：拥有可从任何地方访问并更改它们的变量有多方便！ 我可以将状态从应用程序的一部分转移到另一部分！ 无需通过函数传递它们并编写太多代码！ 冰雹，全球可变状态！ <br><br> 如果您确实如此，我强烈建议您继续阅读。 <br><br><h1> 全球各州比瘟疫和霍乱还糟吗？ </h1><br><h2> 最大的链接图 </h2><br> 事实：如果只包含范围较小且已定义范围的语言环境，而不包含任何全局变量，则可以轻松创建准确的应用程序连接图。 <br><br> 怎么了 <br><br> 假设您有一个带有全局变量的大型应用程序。 每次需要更改某些内容时，都必须： <br><br><ul><li> 回想一下，存在这些可变的全局状态。 <br></li><li> 估计它们是否会影响您要更改的范围。 <br></li></ul><br> 通常，您无需考虑其他作用域中的局部变量，但是无论您做什么，都始终需要在疲惫的大脑中留出全局可变状态的位置，因为它们会影响所有作用域。 <br><br> 而且，您的全局可变状态可以在应用程序中的任何地方更改。 通常必须怀疑它们的当前状态是什么。 这意味着您不得不搜索整个应用程序，试图计算可修改范围内的全局值。 <br><br> 这还不是全部。 如果您需要更改全局状态，那么您将无法想象它将影响什么范围。 这会导致另一个类，方法或函数的意外行为吗？ 搜索成功。 <br><br> 简而言之，您将使用相同全局状态的所有类，方法和函数结合在一起。 不要忘记： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">依赖关系大大增加了复杂性</a> 。 它会吓到你吗？ 应该的 较小的可见性特定区域非常有用：您无需牢记整个应用程序，仅记住与您一起工作的区域就足够了。 <br><br> 人们不会立即跟踪大量信息。 当我们尝试这样做时，我们很快就会耗尽认知能力的供应，这使我们难以专心，并且我们开始制造错误和愚蠢的事物。 这就是为什么在应用程序的全局范围内执行操作如此令人不愉快的原因。 <br><br><h2> 全球名称冲突 </h2><br> 使用第三方库有困难。 想象一下，您想使用该超酷库来为每个字符随机着色并具有闪烁效果。 每个开发人员的梦想！ 如果该库还使用与您自己的名字相同的全局变量，那么您将享受名称冲突。 您的应用程序将崩溃，并且您可能会猜测很长一段时间的原因： <br><br><ul><li> 首先，您需要确定您的库使用全局变量。 <br></li><li> 其次，您需要计算执行期间使用了哪个变量-您的变量还是库？ 这不是那么简单，名字是一样的！ <br></li><li> 第三，由于您无法自行更改库，因此必须重命名全局可变变量。 如果在整个应用程序中使用，您将哭泣。 <br></li></ul><br> 在每个阶段，您都会从愤怒和绝望中拔出头发。 很快，您将不再需要梳子。 这种情况不太可能引诱您。 也许有人会想起，如果未将JavaScript库Mootools，Underscore和jQuery放在较小的范围内，它们总是会发生冲突。 哦，还有著名的jQuery中的global <code>$</code>对象！ <br><br><h2> 测试将成为一场噩梦 </h2><br> 如果我还没有说服您，让我们从单元测试的角度来看一下情况：如何在存在全局变量的情况下编写测试？ 由于测试可以更改全局变量，因此您不知道状态是什么。 您需要将测试彼此隔离，并且全局状态将它们绑定在一起。 <br><br> 您是否曾经使用过它，以便在隔离测试中正常工作，并且当您运行整个程序包时，它们会失败吗？ 不行吗 我有。 每当我记住这一点，我都会受苦。 <br><br><h2> 并发问题 </h2><br> 如果需要并发，可变的全局状态可能会导致很多问题。 当您在多个执行线程中更改全局状态时，请在强大<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的竞争状态下直奔世界</a> 。 <br><br> 如果您是PHP开发人员，那么除非您使用允许创建并行性的库，否则这不会打扰您。 但是，当您<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">学习一种</a>易于实现并行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的新语言</a>时，希望您能回忆起我的散文。 <br><br><h1> 避免全局易变的状态 </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/6df/acf/801/6dfacf801044e2e081ffd24ed7502a98.jpg"><br><br> 尽管全球易变国家可能会引起很多问题，但有时还是很难避免。 <br><br> 以REST API为例：端点接收带有参数的某种HTTP请求并发送响应。 在您的应用程序的许多级别，都可能需要这些发送到服务器的HTTP参数。 在接收HTTP请求时将这些参数设为全局，在发送响应之前对其进行修改是非常诱人的。 在每个请求的顶部添加并行性，灾难备案已准备就绪。 <br><br> 语言实现中也可以直接支持全局可变状态。 例如，在PHP中有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">superglobals</a> 。 <br><br> 如果全局变量来自某个地方，那么如何处理它们？ 由于您在过去20年中对开发工作一无所知，因此您应该如何重构Denis的应用程序，您的开发人员Danis尽可能创建了Globals？ <br><br><h2> 功能参数 </h2><br> 避免全局变量的最简单方法是使用函数参数传递变量。 举一个简单的例子： <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Router</span></span>\<span class="hljs-title"><span class="hljs-title">HttpRequest</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Product</span></span>\<span class="hljs-title"><span class="hljs-title">ProductData</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Exceptions</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpRequest $httpReq)</span></span></span><span class="hljs-function"> </span></span>{ $productData = $httpReq-&gt;get(<span class="hljs-string"><span class="hljs-string">"productData"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;validateProduct($productData)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ValidationException(sprintf(<span class="hljs-string"><span class="hljs-string">"The product %d is not valid"</span></span>, $productData[<span class="hljs-string"><span class="hljs-string">"id"</span></span>])); } $product = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;productModel-&gt;createProduct($productData); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } } class ProductDao { private $db; public function find(int $id): array { return $this-&gt;db-&gt;find(['product' =&gt; $id]); } public function save(array $productData): array { return $this-&gt;db-&gt;saveProduct($productData); } }</span></span></code> </pre> <br> 如您所见，控制器的<code>$productData</code>通过HTTP请求经过不同的级别： <br><br><ol><li> 控制器收到一个HTTP请求。 <br></li><li> 参数传递给模型。 <br></li><li> 参数传递给<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DAO</a> 。 <br></li><li> 参数保存在应用程序数据库中。 <br></li></ol><br> 从HTTP请求中检索此参数数组时，可以将其设为全局。 似乎更简单：无需将数据传输到4个不同的函数。 但是，将参数作为参数传递给函数： <br><br><ul><li> 很明显，这些函数将使用<code>$productData</code> 。 <br></li><li> 显然，它将显示哪些函数使用哪些参数。 可以看出，对于<code>ProductDao::find</code>从<code>$productData</code> <code>ProductDao::find</code> ，只需要<code>$id</code> ，而不是全部。 <br></li></ul><br> 全局变量使代码难以理解并且彼此关联方法，这对于几乎完全没有优势的情况来说是很高的代价。 <br><br> 您已经听到了丹尼斯（Denis）的抗议：“并且，如果一个函数具有三个或更多参数？ 如果您需要添加更多，函数的复杂性将会增加！ 那么到处都需要的变量，对象和其他构造呢？ 您会将它们传递给应用程序中的每个功能吗？” <br><br> 亲爱的读者，问题是公平的。 作为一名<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">优秀的开发人员</a> ，您应该使用自己的沟通技巧向Denis解释，这是什么： <br><br>  <i>“丹尼斯，如果您的函数有太多参数，那么函数本身可能是一个问题。</i>  <i>他们可能做的太多，对太多的事情负责。</i>  <i>您没有想到将它们划分为较小的功能吗？”</i>  。 <br><br> 您像在雅典卫城的演说家一样，继续： <br><br>  <i>“如果您需要在可见性的许多领域中使用变量，那么这将是一个问题，很快我们将讨论它。</i>  <i>但是，如果您真的需要它们，那么通过函数参数传递它们又有什么问题呢？</i>  <i>是的，您将不得不在键盘上键入它们，但是我们是开发人员，编写代码是我们的工作。”</i> <br><br> 当您有更多参数时，它看起来似乎更复杂（也许是这样），但是我重复一遍，优点胜于缺点：最好代码尽可能清晰，而不使用隐藏的全局可变状态。 <br><br><h2> 上下文对象 </h2><br> 上下文对象是那些包含由某些上下文定义的数据的对象。 通常，此数据存储为密钥对构造，例如PHP中的关联数组。 这样的对象没有行为，只有数据，类似于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">值对象</a> 。 <br><br> 上下文对象可以替换任何全局可变状态。 返回上一个代码示例。 我们可以使用封装该数据的对象来代替从请求中通过层次传递数据。 <br><br> 上下文将是查询本身：另一个查询-另一个上下文-另一个数据集。 然后，上下文对象将传递给需要此数据的任何方法。 <br><br> 您说：“这真棒，但这有什么用？” <br><br><ul><li> 数据封装在一个对象中。 通常，您的任务是使数据不可变，也就是说，您不能更改状态-初始化后对象中数据的值。 <br></li><li> 显然，上下文需要上下文对象的数据，因为它已传输到需要此数据的所有函数（或方法）。 <br></li><li> 这就解决了并发性问题：如果每个请求都有自己的上下文对象，则可以在自己的执行线程中安全地写入或读取它们。 <br></li></ul><br> 但是发展中的一切都有代价。 上下文对象可能有害： <br><br><ul><li> 查看函数的参数，您将不知道上下文对象中的数据。 <br></li><li> 您可以将任何东西放在上下文对象中。 注意不要放置太多内容，例如整个用户会话，甚至大部分应用程序数据。 然后会发生这种情况： <code>$context-&gt;getSession()-&gt;getUser()-&gt;getProfil()-&gt;getUsername()</code> 。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">违反得墨</a> the <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">耳定律</a> ，您的诅咒将是疯狂的复杂性。 <br></li><li> 上下文对象越大，则找出其使用的数据和范围就越困难。 <br></li></ul><br> 通常，我将尽可能避免使用上下文对象。 它们会引起很多疑问。 数据的不变性是一个很大的优点，但我们一定不能忘记这些缺点。 如果使用的是上下文对象，请确保它足够小，然后将其传递到仔细定义的小范围内。 <br><br> 如果在执行程序之前不知道将要传递给函数的状态数（例如，来自HTTP请求的参数），则上下文对象会很有用。 因此，其中一些使用它们，例如， <code>Request</code>记住Symfony中的<code>Request</code>对象。 <br><br><h2> 依赖注入 </h2><br> 全局可变状态的另一个很好的选择是在创建对象时将所需的数据直接嵌入到对象中。 这是依赖项注入的定义：一组将对象嵌入组件（类）的技术。 <br><br><h3> 为什么要进行依赖注入？ </h3><br> 目的是限制变量，对象或其他构造的使用，并将它们置于有限的范围内。 如果您具有嵌入的依赖项，因此只能在对象范围内运行，那么您将更容易发现它们在哪种上下文中使用以及为什么使用。 没有痛苦和折磨！ <br><br> 依赖注入将应用程序生命周期分为两个重要阶段： <br><br><ol><li> 创建应用程序对象并实现其依赖关系。 <br></li><li> 使用对象来实现您的目标。 <br></li></ol><br> 这种方法使代码更清晰；您无需在随机位置实例化所有内容，甚至不必在任何地方使用全局对象。 <br><br> 许多框架通过配置文件和依赖注入容器（DIC）使用依赖注入，有时以相当复杂的方案使用。 但这并不需要使事情复杂化。 您可以简单地在一个级别上创建依赖关系，并在较低级别上实现它们。 例如，在围棋世界中，我不认识会使用DIC的人。 您只需使用代码（main.go）在主文件中创建依赖项，然后将它们转移到下一个级别。 您还可以实例化不同包中的所有内容，以清楚地指示“依赖注入阶段”应仅在此特定级别上执行。 在Go中，包的范围比在PHP中使事情变得容易，在PHP中DIC在我所知道的每个框架中都广泛使用，包括Symfony和Laravel。 <br><br><h3> 通过构造器或设置器实现 </h3><br> 有两种方法来注入依赖关系：通过构造函数或setter。 我建议，如果可能的话，请坚持第一种方法： <br><br><ul><li> 如果您需要了解什么是类依赖关系，则要做的就是找到一个构造函数。 无需寻找散布在整个类中的方法。 <br></li><li> 在安装过程中设置依赖性将使您对使用该对象的安全性充满信心。 <br></li></ul><br> 让我们谈谈最后一点：这称为“强制不变”。 通过创建对象的实例并实现其依赖关系，您知道无论对象需要什么，它的配置都是正确的。 而且，如果您使用setter，您如何知道在使用对象时已经设置了依赖项？ 您可以继续进行尝试，尝试找出是否调用了二传手，但是我敢肯定您不想这样做。 <br><br><h1> 违反封装 </h1><br> 毕竟，本地和全局州之间的唯一区别是它们的范围。 它们仅限于本地州，对于全球来说，整个应用程序都可用。 但是，如果使用局部状态，则可能会遇到特定于全局状态的问题。 怎么了 <br><br><h2> 你说封装吗？ </h2><br> 使用全局状态最终会破坏封装，就像您可以使用局部状态破坏封装一样。 <br><br> 让我们从头开始。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wikipedia</a>关于封装的定义告诉了我们什么？ 限制直接访问对象某些组件的语言机制。 访问限制？ 怎么了 <br><br> 好了，正如我们在上面看到的，在本地范围内进行推理比在全局范围内进行推理要容易得多。 顾名思义，全局可变状态随处可见，这是反对封装的！ 没有您的访问限制。 <br><br><h2> 范围扩大和状态泄漏 </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/0a4/466/ed1/0a4466ed1a0cb8710127f819e160be0f.jpg"><br><br> 让我们想象一下一个状态，它的范围很小。 不幸的是，随着时间的流逝，应用程序不断增长，该局部状态作为参数传递给整个应用程序中的函数。 现在，您的语言环境已在许多范围中使用，并且在所有这些范围中，都可以直接访问该语言环境。 现在，您无需查看所有存在的可见性区域以及可以在何处更改的区域，就很难计算出区域的确切状态。 我们已经在全球可变国家中看到了所有这些。 <br><br> 举个例子： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">贫血域模型</a>可以扩大可变模型的范围。 实际上，贫血域模型将域对象的数据和行为分为两类：模型（仅具有数据的对象）和服务（仅具有行为的对象）。 这些模型通常会在所有服务中使用。 因此，某种模型可能会不断扩大范围。 您将不了解在哪种上下文中使用哪种模型，它们的状态将发生变化，所有相同的问题都将落在您身上。 <br><br> 我想传达一个重要的想法：如果您避免全局易变的状态，这并不意味着您可以放松，一只手握住鸡尾酒，另一只手按下按钮，享受生活和您的传奇密码。 -, <a href="https://res.cloudinary.com/practicaldev/image/fetch/s--CWGA3Ax4--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/">    </a> ,  -,     ,           . <br><br>       ,       .   ,        . <br><br>     ?  -  .     ,         ,  -. <br><br> ,  -    ,    ,    .     ,      ,   —  .    ,   :       ,   .           .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . <br><br><h2>    </h2><br>            .      <code>Product</code> , ,   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ $productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"SuperProduct"</span></span>.$productData[<span class="hljs-string"><span class="hljs-string">"name"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// This is not what you should do; I talk about it later in the article. try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($productData); return $product; } } }</span></span></code> </pre> <br>  <code>$productData</code>   .      ,     ,      ,     . <br><br>         ,  .   ,   -   ?   ,        .         . <br><br>    ,       ,    .    . <br><br>   : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $productData)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Since $productData is passed to other variable, it has to be immutable. $name = "SuperProduct".$productData["name"]; try { $product = $this-&gt;productDao-&gt;find($productData["id"]); return product; } catch (NotFoundException $e) { $product = $this-&gt;productDao-&gt;save($name, $productData); return $product; } } }</span></span></code> </pre> <br>   ,      ,       <code>$productData</code> .  ,   .      <code>$productData</code>    ,    ,        HTTP-. <br><br>          ,    : «,     ». <br><br><h1>     ? </h1><br><img src="https://habrastorage.org/getpro/habr/post_images/0cd/d30/a3f/0cdd30a3fbd1097b15e7f5457d3d5c55.jpg"><br><br>        . ,    . <br><br>    ? <br><br><ul><li>      ,      ,      . <br></li><li>  ,      ,        (,     ) . <br></li></ul><br>          .  ,      . <br><br>  ,  <code>ShipmentDelay</code>  , ,  ,     .   ,  -,   <code>ShipmentDelay</code>   ,    ,      ,     . ?    ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> DRY</a> . <br><br>           ,      ,     .       :      ,   ,        .  ,       ,    ,      .          ,    ,        . <br><br><h1>        ? </h1><br>  ,      (,   ),   ,    ,        .       ,    ,   ,    ,   . <br><br>    .  : <br><br><ul><li>        . <br></li><li>            ,     . <br></li><li>   —   :         ,    ,        . <br></li><li>     ,        . <br></li></ul><br>           .       ,       —      .  ,      . <br><br>   ,         ,  . <br><br>        ,   ,   .    ,        .  ,     ,     .  ,       ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN454946/">https://habr.com/ru/post/zh-CN454946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN454928/index.html">在RDP会话上绕过Windows锁定屏幕的方法</a></li>
<li><a href="../zh-CN454930/index.html">V8中的垃圾收集：新的Orinoco GC如何工作</a></li>
<li><a href="../zh-CN454932/index.html">投资和软件：5个用于在交易所进行交易的交易终端</a></li>
<li><a href="../zh-CN454938/index.html">开发自己的内核以嵌入基于FPGA的处理器系统</a></li>
<li><a href="../zh-CN454940/index.html">旅游健康保险：详细说明</a></li>
<li><a href="../zh-CN454958/index.html">内幕：EPFL研究生院。 第4.1部分：日常生活</a></li>
<li><a href="../zh-CN454960/index.html">微生物群。 药物如何影响肠道细菌</a></li>
<li><a href="../zh-CN454962/index.html">全球的IT公司如何面对前雇员面对竞争者提供保护？</a></li>
<li><a href="../zh-CN454964/index.html">在海洋研究中或在死者胸部的12个人中使用计算机视觉</a></li>
<li><a href="../zh-CN454966/index.html">在Google Play Instant上的Unity上创建即时游戏</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>