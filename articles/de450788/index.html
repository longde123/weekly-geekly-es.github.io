<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👂🏼 👋 🕚 Abhängigkeitsinjektion mit DITranquillity 🤛🏽 👩‍🔧 😻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Abhängigkeitsinjektion ist ein recht beliebtes Muster, mit dem Sie das System flexibel konfigurieren und die Abhängigkeiten der Komponenten dieses...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Abhängigkeitsinjektion mit DITranquillity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450788/"><p> Die Abhängigkeitsinjektion ist ein recht beliebtes Muster, mit dem Sie das System flexibel konfigurieren und die Abhängigkeiten der Komponenten dieses Systems korrekt voneinander aufbauen können.  Dank der Eingabe können Sie in Swift praktische Frameworks verwenden, mit denen Sie das Abhängigkeitsdiagramm sehr kurz beschreiben können.  Heute möchte ich ein wenig über eines dieser Frameworks <code>DITranquillity</code> - <code>DITranquillity</code> . </p><a name="habracut"></a><br><p>  Dieses Tutorial behandelt die folgenden Bibliotheksfunktionen: </p><br><ul><li>  Typregistrierung </li><li>  Initialisierungsbereitstellung </li><li>  Einbetten in eine Variable </li><li>  Zyklische Abhängigkeiten von Komponenten </li><li>  Verwenden der Bibliothek mit <code>UIStoryboard</code> </li></ul><br><h3 id="opisanie-komponentov">  Komponentenbeschreibung </h3><br><p>  Die Anwendung besteht aus den folgenden Hauptkomponenten: <code>ViewController</code> , <code>Router</code> , <code>Presenter</code> , <code>Networking</code> - dies sind ziemlich häufige Komponenten in jeder iOS-Anwendung. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w-/pn/ro/w-pnroiey2c8xri9o3erqm9er_0.gif" alt="Komponentenstruktur"></div><br><p>  <code>ViewController</code> und <code>Router</code> werden zyklisch ineinander eingeführt. </p><br><h3 id="podgotovka">  Vorbereitung </h3><br><p>  Erstellen Sie zunächst eine Single View-Anwendung in Xcode und fügen Sie mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CocoaPods</a> DITranquillity <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hinzu</a> .  Erstellen Sie die erforderliche Hierarchie von Dateien, fügen Sie dann Main.storyboard einen zweiten Controller hinzu und verbinden Sie ihn mit <code>StoryboardSegue</code> .  Als Ergebnis sollte die folgende Dateistruktur erhalten werden: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jw/li/s8/jwlis8txyhuzn1m5swacqvrixe4.png" alt="Dateistruktur"></div><br><p>  Erstellen Sie Abhängigkeiten in den Klassen wie folgt: </p><br><div class="spoiler">  <b class="spoiler_title">Komponentendeklaration</b> <div class="spoiler_text"><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Presenter</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCounter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Int)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyPresenter</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Presenter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> networking: <span class="hljs-type"><span class="hljs-type">Networking</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(networking: <span class="hljs-type"><span class="hljs-type">Networking</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.networking = networking } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCounter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Int)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// Implementation } }</span></span></code> </pre> <br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Networking</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Result&lt;Int, Error&gt;)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyNetworking</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Networking</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(Result&lt;Int, Error&gt;)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// Implementation } }</span></span></code> </pre> <br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Router</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">presentNewController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyRouter</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Router</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> viewController: <span class="hljs-type"><span class="hljs-type">ViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(viewController: <span class="hljs-type"><span class="hljs-type">ViewController</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewController = viewController } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">presentNewController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// Implementation } }</span></span></code> </pre> <br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> presenter: <span class="hljs-type"><span class="hljs-type">Presenter!</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> router: <span class="hljs-type"><span class="hljs-type">Router!</span></span> }</code> </pre> </div></div><br><h4 id="ogranicheniya">  Einschränkungen </h4><br><p>  Im Gegensatz zu anderen Klassen wird der <code>ViewController</code> nicht von uns erstellt, sondern von der UIKit-Bibliothek in der <code>UIStoryboard.instantiateViewController</code> Implementierung. Daher können wir mithilfe des Storyboards keine Abhängigkeiten mit dem Initialisierer in die Erben des <code>UIViewController</code> .  So ist es auch mit den Erben von <code>UIView</code> und <code>UITableViewCell</code> . </p><br><p>  Beachten Sie, dass Objekte, die hinter Protokollen versteckt sind, in alle Klassen eingebettet sind.  Dies ist eine der Hauptaufgaben beim Implementieren von Abhängigkeiten - Abhängigkeiten nicht von Implementierungen, sondern von Schnittstellen herzustellen.  Dies wird in Zukunft helfen, verschiedene Protokollimplementierungen zum Wiederverwenden oder Testen von Komponenten bereitzustellen. </p><br><h3 id="vnedrenie-zavisimostey">  Abhängigkeitsinjektion </h3><br><p>  Nachdem alle Komponenten des Systems erstellt wurden, fahren wir mit der Verbindung von Objekten untereinander fort.  In DITranquillity ist der Ausgangspunkt <code>DIContainer</code> , der die Registrierung mit der Methode <code>container.register(...)</code> hinzufügt.  Um die Abhängigkeiten in Teile zu trennen, werden <code>DIFramework</code> und <code>DIPart</code> , die implementiert werden müssen.  Der <code>DIFramework</code> erstellen wir nur eine <code>ApplicationDependency</code> Klasse, die <code>DIFramework</code> implementiert und als Registrierungsort für alle Abhängigkeiten dient.  Für die <code>DIFramework</code> Schnittstelle müssen Sie nur eine Methode implementieren - <code>load(container:)</code> . </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationDependency</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DIFramework</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(container: DIContainer)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// registrations will be placed here } }</span></span></code> </pre> <br><p>  Beginnen wir mit der einfachsten Anmeldung ohne Abhängigkeiten - <code>MyNetworking</code> </p><br><pre> <code class="swift hljs">container.register(<span class="hljs-type"><span class="hljs-type">MyNetworking</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>)</code> </pre> <br><p>  Diese Registrierung verwendet die Implementierung über den Initialisierer.  Trotz der Tatsache, dass die Komponente selbst keine Abhängigkeiten aufweist, muss der Initialisierer bereitgestellt werden, um der Bibliothek klar zu machen, wie die Komponente erstellt wird. </p><br><p>  Registrieren <code>MyPresenter</code> ähnlicher Weise <code>MyPresenter</code> und <code>MyRouter</code> . </p><br><pre> <code class="swift hljs">container.register1(<span class="hljs-type"><span class="hljs-type">MyPresenter</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>) container.register1(<span class="hljs-type"><span class="hljs-type">MyRouter</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>)</code> </pre> <br><p>  <strong>Hinweis:</strong> Beachten Sie, dass nicht das <code>register</code> verwendet wird, sondern das <code>register1</code> .  Leider ist dies erforderlich, um anzugeben, ob das Objekt eine und nur eine Abhängigkeit im Initialisierer hat.  Das heißt, wenn es 0 oder zwei oder mehr Abhängigkeiten gibt, müssen Sie nur <code>register</code> .  Diese Einschränkung ist ein Fehler von Swift Version 4.0 und höher. </p><br><p>  Es ist Zeit, unseren <code>ViewController</code> zu registrieren.  Es injiziert Objekte nicht über den Initialisierer, sondern direkt in die Variable, sodass die Registrierungsbeschreibung etwas mehr ausfällt. </p><br><pre> <code class="swift hljs">container.register(<span class="hljs-type"><span class="hljs-type">ViewController</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) .injection(cycle: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, \.router) .injection(\.presenter)</code> </pre> <br><p>  Die Syntax des Formulars <code>\.presenter</code> lautet SwiftKeyPath, dank dessen Abhängigkeiten <code>\.presenter</code> implementiert werden können.  Da <code>Router</code> und <code>ViewController</code> zyklisch voneinander abhängig sind, müssen Sie dies explizit mit <code>cycle: true</code> angeben.  Die Bibliothek selbst kann diese Abhängigkeiten ohne explizite Angabe auflösen. Diese Anforderung wurde jedoch eingeführt, damit die Person, die das Diagramm liest, sofort versteht, dass es Zyklen in der Abhängigkeitskette gibt.  Beachten Sie auch, dass <strong>NICHT</strong> <code>ViewController.init</code> , <strong>sondern</strong> <code>ViewController.self</code> .  Dies wurde oben im Abschnitt <em>Einschränkungen beschrieben</em> . </p><br><p>  Es ist auch erforderlich, das <code>UIStoryboard</code> mit einer speziellen Methode zu registrieren. </p><br><pre> <code class="swift hljs">container.registerStoryboard(name: <span class="hljs-string"><span class="hljs-string">"Main"</span></span>)</code> </pre> <br><p>  Jetzt haben wir das gesamte Abhängigkeitsdiagramm für einen Bildschirm beschrieben.  Es gibt jedoch noch keinen Zugriff auf dieses Diagramm.  Sie müssen einen <code>DIContainer</code> erstellen, mit dem Sie auf die darin enthaltenen Objekte zugreifen können. </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> container: <span class="hljs-type"><span class="hljs-type">DIContainer</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> container = <span class="hljs-type"><span class="hljs-type">DIContainer</span></span>() <span class="hljs-comment"><span class="hljs-comment">// 1 container.append(framework: ApplicationDependency.self) // 2 assert(container.validate(checkGraphCycles: true)) // 3 return container }()</span></span></code> </pre> <br><ol><li>  Initialisieren Sie den Container </li><li>  Fügen Sie eine Beschreibung des Diagramms hinzu. </li><li>  Wir überprüfen, ob wir alles richtig gemacht haben.  Wenn ein Fehler gemacht wird, stürzt die Anwendung nicht beim Auflösen von Abhängigkeiten ab, sondern sofort beim Erstellen eines Diagramms </li></ol><br><p>  Dann müssen Sie den Container zum Ausgangspunkt der Anwendung machen.  Zu diesem <code>didFinishLaunchingWithOptions</code> implementieren <code>AppDelegate</code> die <code>didFinishLaunchingWithOptions</code> Methode in <code>didFinishLaunchingWithOptions</code> anstatt <code>Main.storyboard</code> als Startpunkt in den Projekteinstellungen anzugeben. </p><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">]?)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { window = <span class="hljs-type"><span class="hljs-type">UIWindow</span></span>(frame: <span class="hljs-type"><span class="hljs-type">UIScreen</span></span>.main.bounds) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> storyboard: <span class="hljs-type"><span class="hljs-type">UIStoryboard</span></span> = <span class="hljs-type"><span class="hljs-type">ApplicationDependency</span></span>.container.resolve() window?.rootViewController = storyboard.instantiateInitialViewController() window?.makeKeyAndVisible() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br><h3 id="zapusk">  Starten </h3><br><p>  Beim ersten Start tritt ein Drop auf und die Validierung schlägt aus folgenden Gründen fehl: </p><br><ul><li>  Der Container findet die Typen <code>Router</code> , <code>Presenter</code> , <code>Networking</code> , da nur Objekte registriert wurden.  Wenn wir nicht auf Implementierungen, sondern auf Schnittstellen zugreifen möchten, müssen wir die Schnittstellen explizit angeben </li><li>  Der Container versteht es nicht, die zyklische Abhängigkeit aufzulösen, da explizit angegeben werden muss, welche Objekte nicht jedes Mal neu erstellt werden sollen, wenn das Diagramm aufgelöst wird. </li></ul><br><p>  Es ist einfach, den ersten Fehler zu beheben. Es gibt eine spezielle Methode, mit der Sie angeben können, unter welchen Protokollen die Methode im Container verfügbar ist. </p><br><pre> <code class="swift hljs">container.register(<span class="hljs-type"><span class="hljs-type">MyNetworking</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>(check: <span class="hljs-type"><span class="hljs-type">Networking</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) {$<span class="hljs-number"><span class="hljs-number">0</span></span>}</code> </pre> <br><p>  Wenn wir die Registrierung wie folgt beschreiben, sagen wir: Auf das <code>MyNetworking</code> Objekt kann über das <code>Networking</code> zugegriffen werden.  Dies muss für alle Objekte erfolgen, die unter den Protokollen versteckt sind.  <code>{$0}</code> fügen <code>{$0}</code> für die korrekte Überprüfung der Typen durch den Compiler hinzu. </p><br><p>  Der zweite Fehler ist etwas komplizierter.  Es ist notwendig, den sogenannten <code>scope</code> , der beschreibt, wie oft das Objekt erstellt wird und wie viel es lebt.  Für jede Registrierung, die an einer zirkulären Abhängigkeit teilnimmt, müssen Sie einen <code>scope</code> angeben, der <code>objectGraph</code> .  Dadurch wird dem Container klar, dass beim Auflösen dieselben erstellten Objekte wiederverwendet werden müssen, anstatt jedes Mal erstellt zu werden.  So stellt sich heraus: </p><br><pre> <code class="swift hljs">container.register(<span class="hljs-type"><span class="hljs-type">ViewController</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) .injection(cycle: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, \.router) .injection(\.presenter) .lifetime(.objectGraph) container.register1(<span class="hljs-type"><span class="hljs-type">MyRouter</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>(check: <span class="hljs-type"><span class="hljs-type">Router</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) {$<span class="hljs-number"><span class="hljs-number">0</span></span>} .lifetime(.objectGraph)</code> </pre> <br><p>  Nach dem Neustart besteht der Container die Validierung erfolgreich und unser ViewController wird mit den erstellten Abhängigkeiten geöffnet.  Sie können einen Haltepunkt in <code>viewDidLoad</code> und sicherstellen. </p><br><h3 id="perehod-mezhdu-ekranami">  Übergang zwischen Bildschirmen </h3><br><p>  Erstellen Sie als Nächstes zwei kleine Klassen, <code>SecondViewController</code> und <code>SecondPresenter</code> , fügen Sie <code>SecondViewController</code> zum Storyboard hinzu und erstellen Sie einen <code>Segue</code> zwischen ihnen mit der Kennung <code>"RouteToSecond"</code> , mit dem Sie den zweiten Controller vom ersten öffnen können. </p><br><p>  Fügen Sie unserer <code>ApplicationDependency</code> für jede der neuen Klassen zwei weitere Registrierungen hinzu: </p><br><pre> <code class="swift hljs">container.register(<span class="hljs-type"><span class="hljs-type">SecondViewController</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) .injection(\.secondPresenter) container.register(<span class="hljs-type"><span class="hljs-type">SecondPresenter</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>)</code> </pre> <br><p>  <code>.as</code> nicht erforderlich, <code>.as</code> anzugeben, da wir <code>SecondPresenter</code> hinter dem Protokoll versteckt <code>SecondPresenter</code> , sondern die Implementierung direkt verwenden.  Dann rufen wir in der <code>viewDidAppear</code> Methode des ersten Controllers <code>performSegue(withIdentifier: "RouteToSecond", sender: self)</code> , start, der zweite Controller wird geöffnet, in dem die <code>secondPresenter</code> Abhängigkeit angebracht werden soll.  Wie Sie sehen können, wurde im Container ein zweiter Controller aus <code>UIStoryboard</code> und die Abhängigkeiten erfolgreich <code>UIStoryboard</code> . </p><br><h3 id="zaklyuchenie">  Fazit </h3><br><p>  Mit dieser Bibliothek können Sie bequem mit zyklischen Abhängigkeiten und Storyboards arbeiten und in Swift die automatische Typinferenz verwenden, die eine sehr kurze und flexible Syntax für die Beschreibung eines Abhängigkeitsdiagramms bietet. </p><br><h4 id="ssylki">  Referenzen </h4><br><p>  Vollständiger Beispielcode in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github-Bibliothek</a> </p><br><p>  DITranquillity <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf Github</a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Englischer Artikel</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450788/">https://habr.com/ru/post/de450788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450776/index.html">Glücklicher Radio- und Kommunikationstag! Kurze Postkarte über</a></li>
<li><a href="../de450780/index.html">Blinde Einfachheit</a></li>
<li><a href="../de450782/index.html">Pseudozufälligkeit wird uns helfen: eine Auswahl von Werkzeugen zum Generieren von Assets für das Spiel</a></li>
<li><a href="../de450784/index.html">Wie verwaltet Netflix seine Zuschauer so gut?</a></li>
<li><a href="../de450786/index.html">Unterschiede zwischen Fluent und gettext</a></li>
<li><a href="../de450790/index.html">Hydrogel, Blaubeeren und eine Prise Kurkuma: Künstliches Gefäßsystem</a></li>
<li><a href="../de450794/index.html">Wahl ist böse</a></li>
<li><a href="../de450796/index.html">Wie Tesla Autopilot lehrt</a></li>
<li><a href="../de450798/index.html">Maschinelles Lernen in der mobilen Entwicklung: Perspektiven und Dezentralisierung</a></li>
<li><a href="../de450800/index.html">Entwicklung von Microservices mit BDD und IOD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>