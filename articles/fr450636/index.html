<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé¨ ‚ù£Ô∏è ü§öüèª Magento 2. Monolog ou comment √©crire des journaux üÜî üñï üåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En √©tudiant les diff√©rents modules de Magento 2, vous remarquerez que la journalisation est utilis√©e beaucoup moins fr√©quemment que Magento 1. Cela es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Magento 2. Monolog ou comment √©crire des journaux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450636/">  En √©tudiant les diff√©rents modules de Magento 2, vous remarquerez que la journalisation est utilis√©e beaucoup moins fr√©quemment que Magento 1. Cela est d√ª en grande partie au fait que la journalisation est devenue plus difficile.  Ici, je voudrais me concentrer sur le c√¥t√© technique du probl√®me, √† savoir comment enregistrer les donn√©es, comment √©crire des journaux dans votre propre fichier et qu'est-ce que Monolog. <br><a name="habracut"></a><br><h3>  Table des mati√®res </h3><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Monolog</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fonctionnalit√©s de l'application dans Magento 2</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Impl√©mentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Journalisation √† l'aide de l'enregistreur standard</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Journalisation √† l'aide d'un enregistreur standard avec un canal personnalis√©</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âcriture dans un fichier personnalis√© √† l'aide de votre propre gestionnaire</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âcriture dans un fichier personnalis√© √† l'aide de virtualType</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Enregistrement rapide des donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conclusion</a> <br></blockquote><a name="monolog"></a><h2>  Monolog </h2><br>  Commen√ßons par la question la plus importante - Qu'est-ce que Monolog et d'o√π vient-il? <br><br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Monolog</a></b> - Il s'agit d'une biblioth√®que qui impl√©mente la norme PSR-3 pour l'enregistrement des donn√©es.  C'est Monolog qui est utilis√© dans Magento 2 pour enregistrer les journaux. <br><br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le PSR-3</a></b> est √† son tour une norme qui d√©crit une approche commune pour l'enregistrement des donn√©es et des recommandations pour la mise en ≈ìuvre des enregistreurs qui fournissent une interface commune. <br><br><a name="psr-3"></a><div class="spoiler">  <b class="spoiler_title">Points forts du PSR-3</b> <div class="spoiler_text"><blockquote> <b>1. L'</b> enregistreur (objet) doit impl√©menter l'interface \ Psr \ Log \ LoggerInterface. <br>  <b>2.</b> Nous avons les niveaux d'erreur suivants (indiqu√©s par ordre de priorit√© du plus grand au moins): <br>  <i><b>URGENCE</b> - Le syst√®me est inutilisable.</i> <br>  <i><b>ALERTE</b> - Des mesures doivent √™tre prises imm√©diatement.</i>  <i>Exemple: site Web entier en panne, base de donn√©es indisponible, etc.</i> <br>  <i><b>CRITIQUE</b> - Conditions critiques.</i>  <i>Exemple: composant d'application non disponible, exception inattendue.</i> <br>  <i><b>ERREUR</b> - Erreurs d'ex√©cution qui ne n√©cessitent pas d'action imm√©diate mais doivent g√©n√©ralement √™tre surveill√©es.</i> <br>  <i><b>AVERTISSEMENT</b> - Occurrences exceptionnelles qui ne sont pas des erreurs. Exemple: utilisation d'API obsol√®tes.</i> <br>  <i><b>AVIS</b> - √âv√©nements normaux mais significatifs.</i> <br>  <i><b>INFO</b> - Ev√©nements int√©ressants.</i>  <i>Exemple: l'utilisateur se connecte, les journaux SQL.</i> <br>  <i><b>DEBUG</b> - Informations de d√©bogage d√©taill√©es.</i> <br><br>  <b>3.</b> Chaque niveau a sa propre m√©thode (d√©bogage, info, avis, avertissement, erreur, critique, alerte, urgence / urgence) et il devrait √©galement y avoir une m√©thode de journalisation, qui prend le niveau d'erreur comme premier param√®tre. <br>  <b>4. Les</b> m√©thodes acceptent une cha√Æne ou tout ce qui impl√©mente __toString () (c'est-√†-dire que vous devez utiliser print_r ($ message, true) manuellement pour les tableaux ou les passer dans le param√®tre suivant). <br>  <b>5.</b> Toutes les m√©thodes acceptent un tableau $ context qui compl√®te le journal. <br>  <b>6.</b> Peut, mais pas n√©cessairement, impl√©menter la substitution des donn√©es du tableau $ context dans le message.  Dans ce cas, le format {nom} est recommand√©, o√π nom -&gt; la cl√© du tableau dans $ context. <br></blockquote><br></div></div><br>  Monolog est assez facile √† utiliser.  Regardons l'exemple suivant. <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Monolog</span></span>\<span class="hljs-title"><span class="hljs-title">Logger</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Monolog</span></span>\<span class="hljs-title"><span class="hljs-title">Handler</span></span>\<span class="hljs-title"><span class="hljs-title">StreamHandler</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Monolog</span></span>\<span class="hljs-title"><span class="hljs-title">Formatter</span></span>\<span class="hljs-title"><span class="hljs-title">HtmlFormatter</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     "name" $log = new Logger('name'); //  ,      "path/to/your1.log"       "WARNING"   (notice, info  debug   ). $log-&gt;pushHandler(new StreamHandler('path/to/your1.log', Logger::WARNING)); //  ,      "path/to/your2.log"       "ALERT"   (..        alert  emergency).    ,    .         html   HtmlFormatter. $log-&gt;pushHandler(new StreamHandler('path/to/your2.log', Logger::ALERT,false) -&gt;setFormatter(new HtmlFormatter)); //  ,       . $log-&gt;pushProcessor(function ($record) { $record['extra']['dummy'] = 'Hello world!'; return $record; }); //   $log-&gt;warning('Foo'); $log-&gt;error('Bar',['test']); $log-&gt;info('Test'); //   ,    1     INFO //your1.log // [2019-08-12 02:57:52] name.WARNING: Foo [] ['extra'=&gt;['dummy'=&gt;'Hello world!']] // [2019-08-12 02:57:53] name.ERROR: BAR ['test'] ['extra'=&gt;['dummy'=&gt;'Hello world!']] //your2.log // , .    ALERT  EMERGENCY</span></span></code> </pre> <br>  Points saillants du travail de Monolog √† garder √† l'esprit: <br><br><ul><li>  <b>L'enregistreur</b> est un objet que nous utilisons pour enregistrer des journaux.  L'enregistreur lui-m√™me n'enregistre pas, mais g√®re les gestionnaires.  N'importe quel nombre peut √™tre cr√©√©. </li><li>  <b>Handler</b> - un objet qui traite directement les donn√©es.  Vous pouvez ajouter autant de gestionnaires √† l'enregistreur que vous le souhaitez.  Tous seront appel√©s tour √† tour, que le gestionnaire donn√© ait pu traiter l'erreur ou non.  La m√©thode isHandling d√©termine si ce gestionnaire sera capable de g√©rer l'erreur re√ßue. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isHandling</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $record)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $record[<span class="hljs-string"><span class="hljs-string">'level'</span></span>] &gt;= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;level; }</code> </pre><br>  La ressemblance la plus proche avec le gestionnaire, √† mon avis, est l'observateur d'√©v√©nements. <br></li><li>  <b>Processeur</b> - toute entit√© appel√©e (appelable).  Peut-√™tre quelques-uns.  Ils peuvent √™tre attribu√©s globalement et install√©s pour le gestionnaire.  Premi√®rement, des processeurs mondiaux sont lanc√©s.  La t√¢che principale du processeur consiste √† ajouter des donn√©es suppl√©mentaires au journal (par exemple, l'adresse IP √† partir de laquelle la connexion √©tait, la valeur des variables globales, les informations sur la branche git sur laquelle se trouve le code, etc.). </li><li>  <b>Formateur</b> - Convertit la sortie du message avant l'√©criture.  Il ne peut y en avoir qu'un par gestionnaire.  Il est n√©cessaire de modifier la mise en forme du corps du message, par exemple, pour convertir du texte en html ou json. </li><li>  <b>Canal</b> - le nom de l'enregistreur.  Il sera √©crit lors de l'enregistrement du journal.  Comme 1 gestionnaire peut √™tre utilis√© dans 2 enregistreurs diff√©rents (il √©crira les journaux dans 1 m√™me fichier), cela d√©terminera d'o√π vient l'erreur. </li><li>  <b>Niveau</b> - niveau d'erreur.  Ce param√®tre pour le gestionnaire signifie le niveau d'erreur minimum qu'il g√©rera. </li><li>  <b>Bulle</b> - popup de message.  Une fois que le gestionnaire a trait√© le message, l'enregistreur transmet le message au gestionnaire suivant.  Ce processus peut √™tre arr√™t√© √† l'aide de la propri√©t√© bubble.  Si le gestionnaire a la valeur de cette propri√©t√© false (la valeur par d√©faut est toujours vraie), apr√®s que ce gestionnaire a fait son travail (a pu traiter cette erreur), les autres gestionnaires ne d√©marrent pas. </li><li>  <b>Ordre de tri</b> - ordre d'ex√©cution.  Le dernier gestionnaire ajout√© est toujours lanc√© le tout premier.  C'est cette fonctionnalit√© qui vous permet de mettre en ≈ìuvre un m√©canisme pour d√©sactiver compl√®tement l'enregistreur (via bullage faux).  Les gestionnaires ajout√©s via le constructeur vont dans l'ordre sp√©cifi√© dans le constructeur. </li></ul><br><blockquote>  √âtant donn√© que PSR-3 n'oblige pas les d√©veloppeurs √† impl√©menter des valeurs de correction automatique dans le texte, Monolog ne le fait pas par d√©faut.  Si vous √©crivez -&gt; Emerg ('test 1111 {placeholder}', ['placeholder' =&gt; 'foo']), vous obtiendrez ce qui suit <br>  [2019-08-12 02:57:52] main.EMERGENCY: test 1111 {placeholder} {"placeholder": "foo"} [] <br><br>  Pour que le remplacement fonctionne, vous devez connecter un processeur suppl√©mentaire - \ Monolog \ Processor \ PsrLogMessageProcessor. <br></blockquote>  Il vaut la peine de dire que Monolog a un grand nombre de formateurs, processeurs, gestionnaires pr√™ts √† l'emploi.  Vous pouvez les utiliser ou √©crire les v√¥tres. <br><br><a name="subtlety"></a><h2>  Fonctionnalit√©s de l'application dans Magento 2 </h2><br>  Sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel de Magento,</a> vous pouvez trouver un exemple g√©n√©ral de la fa√ßon d'utiliser l'enregistreur.  Malheureusement, l'exemple pr√©sent√© ne r√©v√®le pas tous les d√©tails et, h√©las, ne r√©pond pas √† la question ¬´comment √©crire des journaux dans votre propre fichier¬ª.  Par cons√©quent, comprenons tout plus en d√©tail. <br><br>  √Ä l'√©poque de Magento 1, tout le monde utilisait probablement t√¥t ou tard la m√©thode Mage :: log, qui √©tait disponible partout dans le code et l'entr√©e de journal la plus simple ressemblait √† Mage :: log ('ALARM!', Null, 'api.log').  Par cons√©quent, nous avions un enregistrement du formulaire suivant dans le fichier var / log / api.log <br><br><pre> <code class="php hljs"><span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span>T01:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">27</span></span>+<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> DEBUG (<span class="hljs-number"><span class="hljs-number">7</span></span>): ALARM!</code> </pre><br>  <i>Format par d√©faut:% timestamp %% priorityName% (% priority%):% message%.</i> <br><br>  Voyons comment enregistrer les donn√©es dans le cas le plus simple de Magento 2. Le plus souvent, vous utiliserez $ this -&gt; _ logger-&gt; info ('ALARM!');  (si un objet poss√®de une telle propri√©t√©, par exemple, h√©rit√©). <br><br>  √Ä la suite d'un tel appel, nous obtenons l'entr√©e suivante dans le fichier var / log / system.log <br><br><pre> <code class="php hljs">[<span class="hljs-number"><span class="hljs-number">2019</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span>] main.INFO: ALARM! [] []</code> </pre><br>  <i>Le format par d√©faut est [% datetime%]% channel%.% Level_name%:% message %% context %% extra%</i> <br><blockquote>  Si l'objet n'a pas une telle propri√©t√© (_logger ou logger), alors nous devons d'abord ajouter la d√©pendance \ Psr \ Log \ LoggerInterface √† votre classe et √©crire l'objet r√©sultant dans la propri√©t√© $ logger (selon la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">clause 4.2 du PSR-2</a> et l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemple pr√©sent√© sur le site Web de Magento</a> ) . <br></blockquote>  Contrairement √† Magento 1, il y a beaucoup plus de nuances ici. <br><br>  <b>1. Param√®tres de journalisation.</b> <br><br>  Consid√©rons un appel g√©n√©ral √† la m√©thode d'√©criture <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_logger-&gt;{level}($message, $context = []); <span class="hljs-comment"><span class="hljs-comment">//$this-&gt;_logger-&gt;log('{level}', $message, $context = []);</span></span></code> </pre><br>  <b>1)</b> O√π {niveau} est, selon le PSR-3, 1 des m√©thodes r√©serv√©es pour enregistrer un certain niveau d'erreur (d√©bogage, info, avis, avertissement, erreur, critique, alerte, √©mergence / urgence). <br>  <b>2)</b> $ message - contrairement √† Magento 1, ce devrait √™tre une cha√Æne.  C'est-√†-dire  $ object-&gt; getData () ne fonctionnera pas ici.  Le tableau de donn√©es doit √™tre pass√© au param√®tre suivant.  Les objets \ Exception sont une exception, car l'impl√©mentation de \ Magento \ Framework \ Logger \ Monolog les traite s√©par√©ment et fait automatiquement rouler -&gt; getMessage () plus loin en tant que $ message si l'objet \ Exception a √©t√© pass√© en tant que message. <br>  <b>3)</b> $ context est un param√®tre facultatif, un tableau. <br><br>  <b>2. La propri√©t√© $ this -&gt; _ logger n'est pas disponible dans toutes les classes.</b> <br><br>  <b>Pr√©sent</b> dans: Block, Helper, Model, Collection, etc. <br>  <b>Non disponible</b> dans: ResourceModel, Controller, Comand, Setup, etc. <br><br><div class="spoiler">  <b class="spoiler_title">En savoir plus sur ResourceModel et Collection.</b> <div class="spoiler_text">  ResourceModel a la propri√©t√© _logger, mais elle n'est pas remplie dans le constructeur.  Il est rempli uniquement √† l'aide de la m√©thode getLogger priv√©e dans \ Magento \ Framework \ Model \ ResourceModel \ AbstractResource.  La m√©thode n'est appel√©e qu'en cas d'erreur lors de l'√©criture dans la base de donn√©es (dans le bloc catch) √† l'int√©rieur de la m√©thode commit ().  Jusque-l√†, le mod√®le de ressource n'aura pas d'enregistreur. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">commit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getConnection()-&gt;commit(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getConnection()-&gt;getTransactionLevel() === <span class="hljs-number"><span class="hljs-number">0</span></span>) { $callbacks = CallbackPool::get(spl_object_hash(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getConnection())); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($callbacks <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $callback) { call_user_func($callback); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (\<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLogger()-&gt;critical($e); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLogger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> === <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_logger) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_logger = ObjectManager::getInstance()-&gt;get(\Psr\Log\LoggerInterface::class); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_logger; }</code> </pre><br>  La collection a un enregistreur d√®s le d√©but.  Il est attribu√© dans le constructeur \ Magento \ Framework \ Data \ Collection \ AbstractDb et h√©rit√© plus tard. <br></div></div><br>  Il est impossible de ne pas le dire, mais dans les contr√¥leurs, il existe un moyen d'obtenir l'enregistreur √† l'aide de l'ObjectManager (via la propri√©t√© $ this -&gt; _ objectManager).  Mais ce n'est bien s√ªr pas la mani√®re la plus correcte. <br><br>  <b>3. L'enregistreur par d√©faut et la liste des gestionnaires.</b> <br><br>  Dans le fichier di.xml global (app / etc / di.xml), vous pouvez trouver que \ Psr \ Log \ LoggerInterface est impl√©ment√© par la classe \ Magento \ Framework \ Logger \ Monolog, qui √† son tour h√©rite de \ Monolog \ Logger.  Le nom de l'enregistreur est principal.  Plusieurs gestionnaires y sont √©galement d√©finis. <br><br><pre> <code class="xml hljs">‚Ä¶ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">preference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Psr\Log\LoggerInterface"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Magento\Framework\Logger\Monolog"</span></span></span><span class="hljs-tag"> /&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Magento\Framework\Logger\Monolog"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">&gt;</span></span>main<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"handlers"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"array"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"system"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"object"</span></span></span><span class="hljs-tag">&gt;</span></span>Magento\Framework\Logger\Handler\System<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"debug"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"object"</span></span></span><span class="hljs-tag">&gt;</span></span>Magento\Framework\Logger\Handler\Debug<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"syslog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"object"</span></span></span><span class="hljs-tag">&gt;</span></span>Magento\Framework\Logger\Handler\Syslog<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> ...</code> </pre><br>  Certaines classes diff√®rent de celles r√©pertori√©es ci-dessus (car elles sont red√©finies dans le module Magento \ Developer): <br><br>  <b>1)</b> Magento \ Framework \ Logger \ Handler \ System ( <i>√©coute INFO)</i> <br>  <b>2)</b> Magento \ Developer \ Model \ Logger \ Handler \ Debug ( <i>√©coute sur DEBUG</i> ) <br>  <b>3)</b> Magento \ Developer \ Model \ Logger \ Handler \ Syslog ( <i>√©coute DEBUG</i> ) <br><br>  Dans les classes sp√©cifi√©es (Debug et Syslog) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">, la possibilit√© de d√©sactiver la journalisation</a> (dev / debug / debug_logging et dev / syslog / syslog_logging, respectivement) est ajout√©e. <br><br>  Notez qu'il n'y a aucun gestionnaire d'exceptions dans la liste des gestionnaires qui √©crit dans exception.log.  Il est appel√© dans le gestionnaire de syst√®me. <br><br><div class="spoiler">  <b class="spoiler_title">Magento \ Framework \ Logger \ Handler \ System</b> <div class="spoiler_text"><pre> <code class="php hljs">... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $record)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($record[<span class="hljs-string"><span class="hljs-string">'context'</span></span>][<span class="hljs-string"><span class="hljs-string">'exception'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;exceptionHandler-&gt;handle($record); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } $record[<span class="hljs-string"><span class="hljs-string">'formatted'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getFormatter()-&gt;format($record); <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::write($record); } ...</code> </pre><br></div></div><br><blockquote>  Magento 2 √† 2.2 a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">eu un probl√®me</a> avec l'enregistreur incapable de passer √† un autre gestionnaire apr√®s le premier trouv√©.  Ce probl√®me √©tait d√ª au fait que Monolog s'attendait √† ce que tous les gestionnaires y arrivent dans un tableau avec des cl√©s num√©riques et avec des cl√©s alphab√©tiques (['system' =&gt;, 'debug' =&gt;, ...]).  Les d√©veloppeurs de Magento ont ensuite corrig√© la situation - ils convertissent le hachage en un tableau r√©gulier avec des cl√©s num√©riques avant de le transmettre √† Monolog.  Monolog a d√©sormais √©galement modifi√© l'algorithme d'√©num√©ration du gestionnaire et utilise la m√©thode next (). <br></blockquote>  <b>4. Pr√©sentation de votre gestionnaire dans la liste des gestionnaires existants.</b> <br><br>  Nous arrivons √† la chose la plus int√©ressante, qui g√¢che un peu l'impression d'impl√©mentation dans Magento 2. Vous ne pouvez pas ajouter un gestionnaire personnalis√© √† la liste des gestionnaires existants en utilisant di.xml sans ... "gestes suppl√©mentaires".  Cela est d√ª au principe des configurations de fusion. <br><br>  Il existe plusieurs <b>√©tendues de configuration</b> : <br><br>  <b>1)</b> Initiale (app / etc / di.xml) <br>  <b>2)</b> Global ({moduleDir} /etc/di.xml) <br>  <b>3)</b> Sp√©cifique √† la zone ({moduleDir} / etc / {area} /di.xml, c'est-√†-dire Frontend / adminhtml / crontab / webapi_soap / webapi_rest, etc.) <br><br>  √Ä l'int√©rieur du niveau 1, les configurations sont fusionn√©es, mais le niveau suivant les red√©finit lors de la fusion (si elles y sont √©galement d√©clar√©es).  Cela rend impossible d'ajouter des gestionnaires dans leurs modules √† la liste existante, car il est d√©clar√© dans la port√©e initiale. <br><br>  <i>Peut-√™tre qu'√† l'avenir, nous verrons une impl√©mentation dans laquelle l'ajout de gestionnaires sera d√©plac√© de la port√©e initiale vers un autre module, transf√©r√© ainsi √† la port√©e globale.</i> <br><br><a name="howto"></a><h2>  Impl√©mentation </h2><br>  Examinons les principales fa√ßons d'enregistrer les journaux, qui peuvent nous √™tre utiles dans la mise en ≈ìuvre des t√¢ches. <br><br><a name="howto1"></a><h3>  1. Journalisation √† l'aide de l'enregistreur standard </h3><br>  Cette m√©thode nous permet d'√©crire facilement des journaux dans l'un des journaux standard (debug.log, system.log ou exception.log). <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $logger; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\Psr\Log\LoggerInterface $logger)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger = $logger; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger-&gt;info(<span class="hljs-string"><span class="hljs-string">'Something went wrong'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//[...some date...] main.INFO: Something went wrong [] [] } }</span></span></code> </pre><br>  Tout devient encore plus simple s'il existe d√©j√† une d√©pendance h√©rit√©e de l'enregistreur dans notre classe. <br><br><pre> <code class="php hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_logger-&gt;info(<span class="hljs-string"><span class="hljs-string">'Something went wrong'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    -&gt;debug,   ,      debug.log ...</span></span></code> </pre><br><a name="howto2"></a><h3>  2. Journalisation √† l'aide d'un enregistreur standard avec un canal personnalis√© </h3><br>  Cette m√©thode diff√®re de la pr√©c√©dente en ce sens qu'un clone de l'enregistreur est cr√©√© et qu'un autre canal (nom) lui est attribu√©.  Ce qui simplifiera la recherche dans le fichier journal. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $logger; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\Psr\Log\LoggerInterface $logger)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger = $logger-&gt;withName(<span class="hljs-string"><span class="hljs-string">'api'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    } public function foo() { $this-&gt;logger-&gt;info('Something went wrong'); //[...some date...] api.INFO: Something went wrong [] [] } }</span></span></code> </pre><br><br>  Pour rechercher les journaux n√©cessaires, il suffit maintenant d'utiliser la recherche par ¬´api¬ª (l'enregistreur par d√©faut dans Magento 2 est appel√© principal) dans les fichiers system.log, debug.log, exception.log existants.  Peut utiliser <br><pre> <code class="bash hljs">grep -rn <span class="hljs-string"><span class="hljs-string">'api'</span></span> var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/system.log</code> </pre><br><br><a name="howto3"></a><h3>  3. √âcrire dans un fichier personnalis√© √† l'aide de votre propre gestionnaire </h3><br>  Cr√©ons un gestionnaire simple qui enregistre toutes les erreurs de niveau critique et sup√©rieur dans un fichier distinct var / log / critical.log.  Ajoutez la possibilit√© de bloquer tous les autres gestionnaires pour un niveau d'erreur donn√© et plus.  Cela √©vitera la duplication des donn√©es dans les fichiers debug.log et system.log. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Oxis</span></span>\<span class="hljs-title"><span class="hljs-title">Log</span></span>\<span class="hljs-title"><span class="hljs-title">Logger</span></span>\<span class="hljs-title"><span class="hljs-title">Handler</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Magento</span></span>\<span class="hljs-title"><span class="hljs-title">Framework</span></span>\<span class="hljs-title"><span class="hljs-title">Filesystem</span></span>\<span class="hljs-title"><span class="hljs-title">DriverInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Magento</span></span>\<span class="hljs-title"><span class="hljs-title">Framework</span></span>\<span class="hljs-title"><span class="hljs-title">Logger</span></span>\<span class="hljs-title"><span class="hljs-title">Handler</span></span>\<span class="hljs-title"><span class="hljs-title">Base</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Monolog</span></span>\<span class="hljs-title"><span class="hljs-title">Logger</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Base</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $fileName = <span class="hljs-string"><span class="hljs-string">'var/log/critical.log'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $loggerType = Logger::CRITICAL; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DriverInterface $filesystem)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($filesystem,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bubble = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      setBubble() } }</span></span></code> </pre><br><blockquote>  Dans Magento 2 2.2+ dans le constructeur \ Magento \ Framework \ Logger \ Handler \ Base, la fa√ßon de traiter le chemin d'acc√®s au fichier journal a chang√© <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// BP . $this-&gt;fileName // BP. DIRECTORY_SEPARATOR . $this-&gt;fileName</span></span></code> </pre><br>  Par cons√©quent, dans les anciens gestionnaires, vous pouvez toujours trouver / au d√©but de $ fileName. <br></blockquote><br><br>  Par exemple, une petite explication m√©rite d'√™tre donn√©e.  √âtant donn√© que Base ne vous permet pas de d√©finir la propri√©t√© bubble via les param√®tres du constructeur, nous devons soit r√©p√©ter une partie du code du constructeur Base pour transmettre correctement le param√®tre d'entr√©e au parent de la classe Base (qui, soit dit en passant, poss√®de un param√®tre d'entr√©e pour d√©finir cette propri√©t√©), soit utiliser une telle approche.  J'ai choisi la deuxi√®me option. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Oxis</span></span>\<span class="hljs-title"><span class="hljs-title">Log</span></span>\<span class="hljs-title"><span class="hljs-title">Logger</span></span>\<span class="hljs-title"><span class="hljs-title">Handler</span></span>\<span class="hljs-title"><span class="hljs-title">Test</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Log</span></span>\<span class="hljs-title"><span class="hljs-title">LoggerInterface</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $logger; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( LoggerInterface $logger, Test $handler )</span></span></span><span class="hljs-function"> </span></span>{ $logger-&gt;pushHandler($handler); <span class="hljs-comment"><span class="hljs-comment">//  setHandlers([$handler]),        . $this-&gt;logger = $logger; } public function foo() { $this-&gt;logger-&gt;critical('Something went wrong'); //      critical.log //[...some date...] main.CRITICAL: Something went wrong [] [] } }</span></span></code> </pre><br>  Cette m√©thode d'ajout d'un gestionnaire n'est pas id√©ale, mais vous permet de vous √©loigner de la port√©e de configuration du probl√®me, ce qui nous obligera √† dupliquer tous les enregistreurs dans notre di.xml.  Si l'objectif est de remplacer tous les enregistreurs par les v√¥tres, il est pr√©f√©rable d'utiliser l'approche virtualType, que nous examinerons plus loin. <br><br><a name="howto4"></a><h3>  4. √âcriture dans un fichier personnalis√© √† l'aide de virtualType </h3><br>  Cette approche nous permet de forcer la classe dont nous avons besoin pour √©crire des journaux dans le fichier journal sp√©cifi√© pour cela en utilisant di.xml.  Vous pouvez trouver une approche similaire dans les modules Magento \ Paiement et Magento \ Exp√©dition.  J'attire votre attention sur le fait que cette approche fonctionne √† partir de Magento 2 2.2 et sup√©rieur. <br><blockquote>  Dans Magento 2 2.2+, un nouveau param√®tre a √©t√© ajout√© au constructeur \ Magento \ Framework \ Logger \ Handler \ Base, qui vous permet de cr√©er un gestionnaire virtuel et de sp√©cifier via di.xml le chemin relatif vers le fichier pour √©crire le journal.  Auparavant, il √©tait n√©cessaire de sp√©cifier le chemin d'acc√®s complet via $ filePath, ou de cr√©er un nouveau gestionnaire et d'√©crire le chemin d'acc√®s relatif √† la propri√©t√© du fichier prot√©g√© $ fileName. <br></blockquote><br>  Dans le di.xml de notre module, ajoutez ce qui suit <br><pre> <code class="xml hljs"> <span class="hljs-comment"><span class="hljs-comment">&lt;!--      ,     --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ApiHandler"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Magento\Framework\Logger\Handler\Base"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fileName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">&gt;</span></span>var/log/api.log<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  ,     --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ApiLogger"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Magento\Framework\Logger\Monolog"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">&gt;</span></span>api<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"handlers"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"array"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"object"</span></span></span><span class="hljs-tag">&gt;</span></span>ApiHandler<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--       --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Oxis\Log\Model\A"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"logger"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"object"</span></span></span><span class="hljs-tag">&gt;</span></span>ApiLogger<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Ajoutez une classe d'enregistreur √† Oxis \ Log \ Model \ A. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Oxis</span></span>\<span class="hljs-title"><span class="hljs-title">Log</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $logger; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\Psr\Log\LoggerInterface $logger)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger = $logger; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger-&gt;info(<span class="hljs-string"><span class="hljs-string">'Something went wrong'</span></span>); } }</code> </pre><br>  Maintenant, absolument tous les journaux qui seront √©crits dans notre classe seront trait√©s par notre version de l'enregistreur, qui √©crira les journaux en utilisant notre gestionnaire dans le fichier var / log / api.log. <br><br>  <b>4.1.</b>  <b>Si la classe re√ßoit l'enregistreur via l'objet $ context, et non via son constructeur.</b> <br>  Cela inclut \ Magento \ Catalog \ Model \ Product, dont les d√©pendances n'ont pas \ Psr \ Log \ LoggerInterface, mais il existe \ Magento \ Framework \ Model \ Context par lequel l'enregistreur est d√©fini sur la propri√©t√© de classe.  Dans ce cas, nous devons compliquer un peu l'option ci-dessus et remplacer l'enregistreur situ√© dans l'objet $ context.  Et pour que cela n'affecte pas l'ensemble de Magento, nous remplacerons $ context uniquement pour notre classe par virtualType. <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ApiHandler"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Magento\Framework\Logger\Handler\Base"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fileName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">&gt;</span></span>var/log/api.log<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ApiLogger"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Magento\Framework\Logger\Monolog"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">&gt;</span></span>api<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"handlers"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"array"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"object"</span></span></span><span class="hljs-tag">&gt;</span></span>ApiHandler<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--       logger--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ApiLogContainingContext"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Magento\Framework\Model\Context"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"logger"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"object"</span></span></span><span class="hljs-tag">&gt;</span></span>ApiLogger<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Oxis\Log\Model\A"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"context"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"object"</span></span></span><span class="hljs-tag">&gt;</span></span>ApiLogContainingContext<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><a name="howto5"></a><h3>  5. Enregistrement rapide des donn√©es </h3><br>  Il y a des moments o√π nous devons ajouter rapidement la journalisation.  Le plus souvent, cela peut √™tre n√©cessaire sur le serveur de production ou pour des tests rapides. <br><pre> <code class="php hljs">... $log = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Monolog\Logger(<span class="hljs-string"><span class="hljs-string">'custom'</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Monolog\Handler\StreamHandler(BP.<span class="hljs-string"><span class="hljs-string">'/var/log/custom.log'</span></span>)]); $log-&gt;error(<span class="hljs-string"><span class="hljs-string">'test'</span></span>); ...</code> </pre><br>  <i>Avantages de cette approche: √©crit une date, il y a un contexte (tableau), ajoute automatiquement \ n √† la fin</i> <br><br>  Dans l'exemple ci-dessus, \ Monolog \ Logger est sp√©cifiquement appliqu√©, et non \ Magento \ Framework \ Logger \ Monolog qui l'√©tend.  Le fait est qu'avec cette utilisation il n'y a pas de diff√©rence, mais √©crire moins (et s'en souvenir plus facilement). <br><br>  \ Monolog \ Handler \ StreamHandler, √† son tour, est utilis√© √† la place de \ Magento \ Framework \ Logger \ Handler \ Base car l'utilisation de Base comme extrait de code n'est pas tr√®s pratique en raison de d√©pendances suppl√©mentaires sur les classes tierces. <br><br>  Une autre approche dont on ne peut pas parler est le bon vieux file_put_contents. <br><br><pre> <code class="php hljs">... file_put_contents(BP.<span class="hljs-string"><span class="hljs-string">'/var/log/custom.log'</span></span>, <span class="hljs-string"><span class="hljs-string">'test'</span></span>,FILE_APPEND); ...</code> </pre><br>  <i>Avantages de cette approche: √©crivez relativement rapidement et n'avez pas besoin de vous souvenir des cours.</i> <br><br>  Dans les deux cas, le r√¥le principal est jou√© par le <b>BP</b> constant.  Elle pointe toujours vers le dossier avec le magenta (1 niveau plus haut que le pub), ce qui est pratique et nous aide toujours √† √©crire les journaux au bon endroit. <br><br><a name="fin"></a><h2>  Conclusion </h2><br>  J'esp√®re que les informations ci-dessus vous ont √©t√© ou vous seront utiles. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450636/">https://habr.com/ru/post/fr450636/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450626/index.html">Correction du mod√®le de conception - Singleton en PHP</a></li>
<li><a href="../fr450628/index.html">Julia: types, multim√©thodes et arithm√©tique sur polyn√¥mes</a></li>
<li><a href="../fr450630/index.html">Frontend Weekly Digest (29 avril - 5 mai 2019)</a></li>
<li><a href="../fr450632/index.html">Cram Basic en 768 octets</a></li>
<li><a href="../fr450634/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 363 (29 avril - 5 mai 2019)</a></li>
<li><a href="../fr450640/index.html">Comment comprendre que vous avez vraiment arr√™t√© de fumer</a></li>
<li><a href="../fr450642/index.html">PHP Digest n ¬∞ 155 (22 avril - 6 mai 2019)</a></li>
<li><a href="../fr450644/index.html">Crypto-monnaie: vit ou meurt? 3e partie</a></li>
<li><a href="../fr450648/index.html">√âmulateur PS2 / PSP + Google Drive + YouTube = "la folie" continue</a></li>
<li><a href="../fr450650/index.html">Infrastructure centr√©e sur les applications. Architecture de r√©seau du futur - du raisonnement aux affaires</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>