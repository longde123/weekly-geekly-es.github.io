<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎗️ 🛀🏻 🌥️ Bot pour Starcraft dans Rust, C et toute autre langue 👩🏾‍🔧 ⏬ 🏇🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="StarCraft: Brood War . Combien cela signifie pour moi. Et pour beaucoup d'entre vous. Tellement que je doutais de donner un lien vers le wiki. 


 Une...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bot pour Starcraft dans Rust, C et toute autre langue</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416743/"><p><img src="https://habrastorage.org/webt/qv/fa/ex/qvfaexsnkzmckmwrt_spqmc7nr4.png" align="left">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">StarCraft: Brood War</a> .  Combien cela signifie pour moi.  Et pour beaucoup d'entre vous.  Tellement que je doutais de donner un lien vers le wiki. </p><br><p>  Une fois, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Halt</a> m'a frappé dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">e</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">mail</a> personnel et m'a proposé d'apprendre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rust</a> .  Comme toute personne normale, nous avons décidé de commencer par <del>  bonjour le monde </del>  écrire une bibliothèque dynamique pour Windows qui pourrait se charger dans l'espace d'adressage d'un jeu StarCraft et gérer les unités. </p><br><p> L'article décrira le processus de recherche de solutions, en utilisant des technologies, des techniques qui vous permettront d'apprendre de nouvelles choses dans le langage Rust et son écosystème ou d'être inspiré pour implémenter un bot dans votre langage préféré, que ce soit C, C ++, ruby, python, etc. </p><a name="habracut"></a><br><p>  Cet article mérite certainement d'être lu sous l'hymne de la Corée du Sud: </p><br><div class="spoiler">  <b class="spoiler_title">Starcraft OST</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/pNt0iVG2VOA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><h2 id="bwapi">  Bwapi </h2><br><p>  Ce jeu a déjà 20 ans.  Et il est toujours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">populaire</a> , les championnats rassemblent des salles entières de personnes aux États-Unis, même <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en 2017</a> , où la bataille des grands maîtres Jaedong vs Bisu a eu lieu.  En plus des joueurs en direct, les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">voitures sans âme</a> participent également aux batailles!  Et cela est possible grâce à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BWAPI</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liens</a> plus utiles. </p><br><p>  Depuis plus d'une décennie, il existe une communauté de développeurs de bots autour de ce jeu.  Les amateurs écrivent des bots et participent à divers championnats.  Beaucoup d'entre eux étudient l'IA et l'apprentissage automatique.  BWAPI est utilisé par les universités pour éduquer leurs étudiants.  Il existe même une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chaîne Twitch</a> qui diffuse des jeux. </p><br><p>  Il y a quelques années, une équipe de fans a inversé les internes de Starcraft et a écrit une API C ++ qui vous permet d'écrire des bots, de vous intégrer au processus de jeu et de dominer les petites personnes pathétiques. </p><br><p>  Comme cela arrive souvent avant <del>  pour construire une maison, il faut se procurer du minerai, forger des outils ... </del>  écrire un bot, vous devez implémenter l'API.  Qu'est-ce que Rust peut offrir? </p><br><h2 id="ffi">  Ffi </h2><br><p>  L'interaction avec d'autres langues de Rust est assez simple.  Il y a <abbr title="Interface de fonction étrangère">FFI</abbr> pour cela.  Permettez-moi de vous fournir un bref extrait de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> . </p><br><p>  Supposons que nous ayons une bibliothèque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">snappy</a> qui a un fichier d'en <a href="">-</a> tête <a href="">snappy-ch à</a> partir duquel nous copierons les déclarations de fonction. </p><br><p>  Créez un projet en utilisant le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fret</a> . </p><br><pre><code class="bash hljs">$ cargo new --bin snappy Created binary (application) `snappy` project $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> snappy snappy$ tree . ├── Cargo.toml └── src └── main.rs 1 directory, 2 files</code> </pre> <br><p>  Cargo a créé une structure de fichiers standard pour le projet. </p><br><p>  Dans <code>Cargo.toml</code> spécifiez la dépendance à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libc</a> : </p><br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">dependencies</span></span>] libc = <span class="hljs-string"><span class="hljs-string">"0.2"</span></span></code> </pre> <br><p>  <code>src/main.rs</code> fichier <code>src/main.rs</code> ressemblera à ceci: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> libc; <span class="hljs-comment"><span class="hljs-comment">//   C ,     size_t use libc::size_t; #[link(name = "snappy")] //       extern { //    ,    //  C  : // size_t snappy_max_compressed_length(size_t source_length); fn snappy_max_compressed_length(source_length: size_t) -&gt; size_t; } fn main() { let x = unsafe { snappy_max_compressed_length(100) }; println!("max compressed length of a 100 byte buffer: {}", x); }</span></span></code> </pre> <br><p>  Nous collectons et gérons: </p><br><pre> <code class="bash hljs">snappy$ cargo build ... snappy$ cargo run Finished dev [unoptimized + debuginfo] target(s) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.02s Running `target/debug/snappy` max compressed length of a 100 byte buffer: 148</code> </pre> <br><p>  Vous ne pouvez appeler que <code>cargo run</code> , qui avant le lancement appelle <code>cargo build</code> .  Ou créez un projet et appelez directement le binaire: </p><br><pre> <code class="bash hljs">snappy$ ./target/debug/snappy max compressed length of a 100 byte buffer: 148</code> </pre> <br><p>  Le code se compile à condition que la bibliothèque snappy soit installée (pour Ubuntu, le paquet libsnappy-dev doit être installé). </p><br><pre> <code class="bash hljs">snappy$ ldd target/debug/snappy ... libsnappy.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libsnappy.so.1 (0x00007f8de07cf000)</code> </pre> <br><p>  Comme vous pouvez le voir, notre binaire est lié à la bibliothèque partagée libsnappy.  Et l'appel <code>snappy_max_compressed_length</code> est un appel de fonction de cette bibliothèque. </p><br><h2 id="rust-bindgen">  rouille-bindgen </h2><br><p>  Ce serait bien si nous pouvions générer automatiquement des FFI.  Heureusement, il existe un tel utilitaire dans l'arsenal de rastomanov appelé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rust-bindgen</a> .  Elle est capable de générer des liaisons FFI vers des bibliothèques C (et certaines C ++). </p><br><p>  Installation: </p><br><pre> <code class="bash hljs">$ cargo install bindgen</code> </pre> <br><p>  À quoi ressemble l'utilisation de <strong>rust-bindgen</strong> ?  Nous prenons les fichiers d'en-tête C / C ++, définissons l'utilitaire <strong>bindgen</strong> sur eux et nous obtenons le code Rust généré avec les définitions des structures et des fonctions de la structure.  Voici à quoi ressemble la génération FFI pour Snappy: </p><br><pre> <code class="rust hljs">$ bindgen /usr/include/snappy-ch | grep -C <span class="hljs-number"><span class="hljs-number">1</span></span> snappy_max_compressed_length <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">snappy_max_compressed_length</span></span></span></span>(source_length: <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>; }</code> </pre> <br><p>  Il s'est avéré que bindgen passe devant les en-têtes BWAPI, générant des tonnes de feuilles de code non utilisables (en raison des fonctions membres virtuelles, std :: string dans l'API publique, etc.).  Le fait est que BWAPI est écrit en C ++.  C ++ est généralement difficile à utiliser même à partir de projets C ++.  Une fois qu'une bibliothèque compilée est préférable de lier avec le même éditeur de liens (versions identiques), les fichiers d'en-tête sont mieux analysés avec le même compilateur (versions identiques).  Parce que de nombreux facteurs peuvent affecter le résultat.  Par exemple, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mangling</a> , que GNU GCC ne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">peut</a> toujours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pas implémenter sans erreurs</a> .  Ces facteurs sont si importants qu'ils ne pouvaient pas être surmontés même dans <abbr title="Cadre de test C ++ de Google">gtest</abbr> , et la documentation <a href="">indiquait</a> qu'il serait préférable pour vous de construire gtest dans le cadre du projet avec le même compilateur et le même éditeur de liens. </p><br><h2 id="bwapi-c">  Bwapi-c </h2><br><p>  C est une programmation en lingua franca.  Si rust-bindgen fonctionne bien pour le langage C, pourquoi ne pas implémenter le BWAPI pour C puis utiliser son API?  Bonne idée! </p><br><p>  Oui, c'est une bonne idée jusqu'à ce que vous examiniez les tripes de BWAPI et que vous voyiez le nombre de classes et de méthodes que vous devez implémenter = (en particulier toutes ces dispositions de structures en mémoire, assembleurs, correctifs de mémoire et autres horreurs pour lesquelles nous n'avons pas le temps. Il est nécessaire d'utiliser au maximum la solution existante. </p><br><p>  Mais nous devons en quelque sorte gérer le mangling, le code C ++, l'héritage et les fonctions membres virtuelles. </p><br><p>  En C ++, il existe deux outils puissants que nous utiliserons pour résoudre notre problème, ce sont les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pointeurs opaques</a> et les <code>extern "C"</code> . </p><br><p>  <code>extern "C" {}</code> permet au code C ++ de se déguiser en C. Cela vous permet de générer des noms de fonction purs sans altération. </p><br><p>  Les pointeurs opaques nous permettent d'effacer un type et de créer un pointeur vers "un certain type" dont nous ne fournissons pas l'implémentation.  Comme il ne s'agit que d'une déclaration d'un certain type, et non de son implémentation, il est impossible d'utiliser ce type par valeur, il ne peut être utilisé que par pointeur. </p><br><p>  Disons que nous avons un tel code C ++: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> cpp { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bar; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;bar; } }; } <span class="hljs-comment"><span class="hljs-comment">// namespace cpp</span></span></code> </pre> <br><p>  Nous pouvons le transformer en un en-tête C comme ceci: </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo_</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">//    Foo //  cpp::Foo::get_bar int Foo_get_bar(Foo* self); }</span></span></code> </pre> <br><p>  Et la partie C ++, qui sera le lien entre l'en-tête C et l'implémentation C ++: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo_get_bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Foo* self)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      cpp::Foo    ::get_bar return reinterpret_cast&lt;cpp::Foo*&gt;(self)-&gt;get_bar(); }</span></span></code> </pre> <br><p>  Toutes les méthodes de classe ne devaient pas être gérées de cette façon.  Il existe des classes dans BWAPI, opérations sur lesquelles vous pouvez vous implémenter en utilisant les valeurs de champ de ces structures, par exemple <code>typedef struct Position { int x; int y; } Position;</code> <code>typedef struct Position { int x; int y; } Position;</code>  et des méthodes comme <code>Position::get_distance</code> . </p><br><p>  Il y avait ceux qui devaient être jugés d'une manière spéciale.  Par exemple, un AIModule doit être un pointeur vers une classe C ++ avec un ensemble spécifique de fonctions membres virtuelles.  Cependant, voici le <a href="">titre</a> et l' <a href="">implémentation</a> . </p><br><p>  Ainsi, après plusieurs mois de dur labeur, <strong>554</strong> méthodes et une douzaine de classes, la bibliothèque multiplateforme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BWAPI-C</a> est née, qui vous permet <a href="">d'écrire des bots en C.</a>  Le sous-produit était une compilation croisée et la possibilité d'implémenter l'API dans n'importe quel autre langage prenant en charge FFI et la convention d'appel cdecl. </p><br><p>  Si vous écrivez une bibliothèque, veuillez écrire l'API C. </p><br><p>  La caractéristique la plus importante de BWAPI-C est la plus large capacité d'intégration avec d'autres langues.  <code>Python</code> , <code>Ruby</code> , <code>Rust</code> , <code>PHP</code> , <code>Java</code> et bien d'autres savent travailler avec C, donc vous pouvez également écrire un bot dessus, si vous travaillez un peu avec un fichier et implémentez vos wrappers. </p><br><h2 id="pishem-bota-na-c">  Écrire un bot en C </h2><br><p>  Cette partie décrit les principes généraux de la conception des modules Starcraft. </p><br><p>  Il existe 2 types de bots: module et client.  Nous allons voir un exemple d'écriture d'un module. </p><br><p>  Un module est une bibliothèque téléchargeable, le principe général du chargement peut être vu <a href="">ici</a> .  Le module devrait exporter 2 fonctions: <code>newAIModule</code> et <code>gameInit</code> . </p><br><p>  Avec <code>gameInit</code> tout est simple, cette fonction est appelée pour passer un pointeur sur le jeu en cours.  Ce pointeur est très important, car dans la nature de BWAPI vit une variable statique globale qui est utilisée dans certaines parties du code.  <code>gameInit</code> : </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">DLLEXPORT </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gameInit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* game</span></span></span><span class="hljs-function">)</span></span> { BWAPIC_setGame(game); }</code> </pre> <br><p>  <code>newAIModule</code> peu plus compliqué.  Il doit renvoyer un pointeur vers une classe C ++ qui a une table de méthode virtuelle avec les noms <strong>onXXXXX</strong> qui sont appelés sur certains événements de jeu.  Définissez la structure du module: </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleAIModule</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AIModule_vtable* vtable_; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* name; } ExampleAIModule;</code> </pre> <br><p>  Le premier champ doit être un pointeur vers un tableau de méthodes (magie, tout).  Ainsi, la fonction <code>newAIModule</code> : </p><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-function">DLLEXPORT </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAIModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ExampleAIModule* <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span> = (ExampleAIModule*) <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(ExampleAIModule) ); <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>-&gt;name = <span class="hljs-string"><span class="hljs-string">"ExampleAIModule"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>-&gt;vtable_ = &amp;module_vtable; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> createAIModuleWrapper( (AIModule*) <span class="hljs-keyword"><span class="hljs-keyword">module</span></span> ); }</code> </pre> <br><p>  <code>createAIModuleWrapper</code> est une autre magie qui transforme un pointeur C en pointeur vers une classe C ++ avec virtual <del>  les méthodes </del>  fonctions des membres. </p><br><p>  <code>module_vtable</code> est une variable statique sur la table des méthodes, les valeurs des méthodes sont remplies de pointeurs vers des fonctions globales: </p><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> AIModule_vtable module_vtable = { onStart, onEnd, onFrame, onSendText, onReceiveText, onPlayerLeft, onNukeDetect, onUnitDiscover, onUnitEvade, onUnitShow, onUnitHide, onUnitCreate, onUnitDestroy, onUnitMorph, onUnitRenegade, onSaveGame, onUnitComplete }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isWinner)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSendText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* text)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceiveText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Player* player, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* text)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPlayerLeft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Player* player)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNukeDetect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Position target)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUnitDiscover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Unit* unit)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUnitEvade</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Unit* unit)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUnitShow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Unit* unit)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUnitHide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Unit* unit)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUnitCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Unit* unit)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUnitDestroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Unit* unit)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUnitMorph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Unit* unit)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUnitRenegade</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Unit* unit)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSaveGame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* gameName)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onUnitComplete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Unit* unit)</span></span></span><span class="hljs-function"> </span></span>{}</code> </pre> <br><p>  Par le nom des fonctions et leurs signatures, il est clair dans quelles conditions et avec quels arguments elles sont appelées.  Par exemple, j'ai rendu toutes les fonctions vides sauf </p><br><pre> <code class="hljs java"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AIModule* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ ExampleAIModule* self = (ExampleAIModule*) <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>; Game* game = BWAPIC_getGame(); Game_sendText(game, <span class="hljs-string"><span class="hljs-string">"Hello from bwapi-c!"</span></span>); Game_sendText(game, <span class="hljs-string"><span class="hljs-string">"My name is %s"</span></span>, self-&gt;name); }</code> </pre> <br><p>  Cette fonction est appelée au démarrage du jeu.  Un pointeur vers le module actuel est passé en argument.  <code>BWAPIC_getGame</code> renvoie un pointeur global sur le jeu que nous avons défini en appelant <code>BWAPIC_setGame</code> .  Nous allons donc montrer un exemple de compilation croisée et de fonctionnement de module: </p><br><pre> <code class="bash hljs">bwapi-c/example$ tree . ├── BWAPIC.dll └── Dll.c 0 directories, 2 files bwapi-c/example$ i686-w64-mingw32-gcc -mabi=ms -shared -o Dll.dll Dll.c -I../include -L. -lBWAPIC bwapi-c/example$ cp Dll.dll ~/Starcraft/bwapi-data/ bwapi-c/example$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Starcraft/bwapi-data/ Starcraft$ wine bwheadless.exe -e StarCraft.exe -l bwapi-data/BWAPI.dll --headful ... ... ...</code> </pre> <br><p>  Nous poussons des boutons et commençons le jeu.  Vous pouvez en savoir plus sur le lancement sur le site Web de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BWAPI</a> et dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BWAPI-C</a> . </p><br><p>  Le résultat du module: </p><br><p><img src="https://habrastorage.org/webt/cw/a-/41/cwa-41ihsyva-pj2stpef1xjn2g.png" alt="image"></p><br><p>  Un exemple un peu plus complexe d'un module qui montre le travail avec les itérateurs, le contrôle d'unité, la recherche de minéraux et les statistiques se trouve dans <a href="">bwapi-c / example / Dll.c.</a> </p><br><h2 id="bwapi-sys">  bwapi-sys </h2><br><p>  Dans l'écosystème Rasta, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">il est habituel</a> d'appeler les packages d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une</a> certaine manière qui sont liés aux bibliothèques natives.  Tout paquet foo-sys a deux fonctions importantes: </p><br><ul><li>  Lien vers la bibliothèque libfoo native </li><li>  Fournit des déclarations de fonction à partir de la bibliothèque libfoo.  Mais seules les déclarations, les abstractions de haut niveau dans les caisses * -sys ne sont pas fournies. </li></ul><br><p>  Pour que le package * -sys puisse réussir la liaison, ils y intègrent une <a href="">recherche de</a> bibliothèque native et / ou un <a href="">assemblage</a> de bibliothèque à partir des sources. </p><br><p>  Pour que le package * -sys fournisse des déclarations, il faut soit les écrire à la main, soit les générer à l'aide de bindgen.  Encore une fois bindgen.  Tentative numéro deux =) </p><br><p>  La génération de liants avec bwapi-c devient obscène: </p><br><pre> <code class="bash hljs">bindgen BWAPI.h -o lib.rs \ --opaque-type <span class="hljs-string"><span class="hljs-string">".+_"</span></span> \ --blacklist-type <span class="hljs-string"><span class="hljs-string">"std.*|__.+|.+_$|Game_v(Send|Print|Draw).*|va_list|.+_t$"</span></span> \ --no-layout-tests \ --no-derive-debug \ --raw-line <span class="hljs-string"><span class="hljs-string">"#![allow(improper_ctypes, non_snake_case)]"</span></span> \ -- -I../submodules/bwapi-c/include sed -i -r -- <span class="hljs-string"><span class="hljs-string">'s/.+\s+(.+)_;/pub struct \1;/'</span></span> lib.rs</code> </pre> <br><p>  Où <code>BWAPI.h</code> est le fichier avec les inclusions de tous les en-têtes d'en-tête de BWAPI-C. </p><br><p>  Par exemple, pour des fonctions déjà connues, bindgen a généré les déclarations suivantes: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-comment"><span class="hljs-comment">/// BWAPIC_setGame must be called from gameInit to initialize BWAPI::BroodwarPtr pub fn BWAPIC_setGame(game: *mut Game); } extern "C" { pub fn BWAPIC_getGame() -&gt; *mut Game; }</span></span></code> </pre> <br><p>  Il existe 2 stratégies: stocker le code généré dans le référentiel et générer du code à la volée lors de l'assemblage.  Ces deux approches ont leurs avantages et leurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">inconvénients</a> . </p><br><p>  Bienvenue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bwapi-sys</a> , un autre petit pas vers notre objectif. </p><br><p>  Rappelez-vous, j'ai parlé de multiplateforme?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Nlinker a</a> rejoint le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">projet</a> et a mis en œuvre une stratégie délicate.  Si la cible est Windows, téléchargez le BWAPIC déjà assemblé depuis le github.  Et pour les cibles restantes, nous collectons BWAPI-C à partir des sources d'OpenBW (je vous le dirai un peu plus tard). </p><br><h2 id="bwapi-rs">  bwapi-rs </h2><br><p>  Maintenant que nous avons les liants, nous pouvons décrire des abstractions de haut niveau.  Nous avons 2 types avec lesquels travailler: des valeurs pures et des pointeurs opaques. </p><br><p>  Avec des valeurs pures, tout est plus simple.  Prenons l'exemple de la couleur.  Nous devons faciliter l'utilisation du code Rust afin de pouvoir utiliser les couleurs de manière pratique et naturelle: </p><br><pre> <code class="rust hljs">game.draw_line(CoordinateType::Screen, (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>), (<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>), Color::Red); ^^^</code> </pre> <br><p>  Donc, pour une utilisation pratique, il sera nécessaire de définir un idiomatique pour l'énumération du langage Rust avec des <a href="">constantes</a> de C ++ et de définir des méthodes de conversion dans bwapi_sys :: Color en utilisant le trait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">std :: convert :: From</a> : </p><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// FFI version #[repr(C)] #[derive(Copy, Clone)] pub struct Color { pub color: ::std::os::raw::c_int, } // Idiomatic version #[derive(PartialEq, PartialOrd, Copy, Clone)] pub enum Color { Black = 0, Brown = 19, ...</span></span></code> </pre> <br><p>  Bien que pour plus de commodité, vous pouvez utiliser la caisse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">enum-primitive-derive</a> . </p><br><p>  Avec des pointeurs opaques, ce n'est pas plus difficile.  Pour ce faire, utilisez le modèle <a href="">Newtype</a> : </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Player</span></span></span></span>(*<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> sys::Player);</code> </pre> <br><p>  Autrement dit, Player est une certaine structure avec un champ privé - un pointeur opaque brut de C. Et voici comment vous pouvez décrire la méthode Player :: color: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Player { <span class="hljs-comment"><span class="hljs-comment">//    Player::getColor  bwapi-sys //extern "C" { // pub fn Player_getColor(self_: *mut Player) -&gt; Color; //} pub fn color(&amp;self) -&gt; Color { // bwapi_sys::Player_getColor -    BWAPI-C // self.0 -   let color = unsafe { bwapi_sys::Player_getColor(self.0) }; color.into() //  bwapi_sys::Color -&gt; Color } }</span></span></code> </pre> <br><p>  Nous pouvons maintenant écrire notre premier bot en rouille! </p><br><h2 id="pishem-bota-na-rust">  Écrire un bot en rouille </h2><br><p>  Comme preuve de concept, le bot ressemblera à un pays célèbre: toutes ses fonctionnalités seront d'embaucher des travailleurs et de collecter des minéraux. </p><br><p><img src="https://habrastorage.org/webt/hx/r_/jm/hxr_jmj2fbsitx-tfw96p2pa2tu.png" alt="Corée du Nord"></p><br><p><img src="https://habrastorage.org/webt/ww/gf/lr/wwgflrekcnxtv75thaurrwcm0g8.png" alt="Corée du sud"></p><br><p>  Commençons par les <code>newAIModule</code> <code>gameInit</code> et <code>newAIModule</code> : </p><br><pre> <code class="rust hljs"><span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gameInit</span></span></span></span>(game: *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> void) { bwapi_sys::BWAPIC_setGame(game <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> bwapi_sys::Game); } <span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAIModule</span></span></span></span>() -&gt; *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> void { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> module = ExampleAIModule { name: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::from(<span class="hljs-string"><span class="hljs-string">"ExampleAIModule"</span></span>) }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = wrap_handler(<span class="hljs-built_in"><span class="hljs-built_in">Box</span></span>::new(module)); result }</code> </pre> <br><p>  <code>#[no_mangle]</code> remplit la même fonction que l' <code>extern "C"</code> en C ++.  Dans <code>wrap_handler</code> , toutes sortes de magie se produisent avec la substitution de la table de fonction virtuelle et se déguisent en classe C ++. </p><br><p>  La description de la structure du module est encore plus simple et plus belle qu'en C: </p><br><pre> <code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleAIModule</span></span></span></span> { name: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, }</code> </pre> <br><p>  Ajoutez quelques méthodes pour rendre les statistiques et donner des ordres: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> ExampleAIModule { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw_stat</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> game = Game::get(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> message = <span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"Frame {}"</span></span>, game.frame_count()); game.draw_text(CoordinateType::Screen, (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), &amp;message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">give_orders</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> player = Game::get().self_player(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> unit <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> player.units() { <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> unit.get_type() { UnitType::Terran_SCV | UnitType::Zerg_Drone | UnitType::Protoss_Probe =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !unit.is_idle() { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> unit.is_carrying_gas() || unit.is_carrying_minerals() { unit.return_cargo(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-literal"><span class="hljs-literal">Some</span></span>(mineral) = Game::get() .minerals() .min_by_key(|m| unit.distance_to(m)) { <span class="hljs-comment"><span class="hljs-comment">// WE REQUIRE MORE MINERALS unit.right_click(&amp;mineral, false); } } UnitType::Terran_Command_Center =&gt; { unit.train(UnitType::Terran_SCV); } UnitType::Protoss_Nexus =&gt; { unit.train(UnitType::Protoss_Probe); } UnitType::Zerg_Hatchery | UnitType::Zerg_Lair | UnitType::Zerg_Hive =&gt; { unit.train(UnitType::Zerg_Drone); } _ =&gt; {} }; } } }</span></span></code> </pre> <br><p>  Pour que le type ExampleAIModule devienne un véritable module, vous devez lui apprendre à répondre aux événements <strong>onXXXX</strong> , pour lesquels vous devez implémenter le type EventHandler, qui est un analogue de la table virtuelle AIModule_vtable de C: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> EventHandler <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ExampleAIModule { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { Game::get().send_text(&amp;<span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello from Rust! My name is {}"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_end</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _is_winner: <span class="hljs-built_in"><span class="hljs-built_in">bool</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_frame</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.draw_stat(); <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.give_orders(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_send_text</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _text: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_receive_text</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _player: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Player, _text: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_player_left</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _player: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Player) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_nuke_detect</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _target: Position) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_discover</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_evade</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_show</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_hide</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_create</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_destroy</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_morph</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_renegade</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_save_game</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _game_name: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_complete</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} }</code> </pre> <br><p>  Construire et démarrer le module est aussi simple que pour C: </p><br><pre> <code class="bash hljs">bwapi-rs$ cargo build --example dll --target=i686-pc-windows-gnu bwapi-rs$ cp ./target/i686-pc-windows-gnu/debug/examples/dll.dll ~/Starcraft/bwapi-data/Dll.dll bwapi-rs$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Starcraft/bwapi-data/ Starcraft$ wine bwheadless.exe -e StarCraft.exe -l bwapi-data/BWAPI.dll --headful ... ... ...</code> </pre> <br><p>  Et la vidéo de travail: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/rACbnWpI01M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="nemnogo-o-krosskompilyacii">  Un peu sur la compilation croisée </h2><br><p>  Bref, Rust est magnifique!  En deux clics, vous pouvez mettre en place de nombreuses chaînes d'outils pour différentes plateformes.  Plus précisément, la chaîne d'outils i686-pc-windows-gnu est définie par la commande: </p><br><pre> <code class="bash hljs">rustup target add i686-pc-windows-gnu</code> </pre> <br><p>  Vous pouvez également spécifier le kofig pour la cargaison à la racine du projet <code>.cargo/config</code> : </p><br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">target.i686</span></span>-<span class="hljs-type"><span class="hljs-type">pc</span></span>-<span class="hljs-type"><span class="hljs-type">windows</span></span>-<span class="hljs-type"><span class="hljs-type">gnu</span></span>] linker = <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32-gcc"</span></span> ar = <span class="hljs-string"><span class="hljs-string">"i686-w64-mingw32-ar"</span></span> runner = <span class="hljs-string"><span class="hljs-string">"wine"</span></span></code> </pre> <br><p>  Et c'est tout ce que vous devez faire pour compiler votre projet Rust à partir de Linux sur Windows. </p><br><h2 id="openbw">  Openbw </h2><br><p>  Ces gars sont allés encore plus loin.  Ils ont décidé d'écrire une version open-source du jeu SC: BW!  Et ils s'en sortent plutôt bien.  L'un de leurs objectifs était d'implémenter des images HD, mais SC: Remastered les a devancés = (Pour le moment, vous pouvez utiliser leur API pour écrire des bots (oui, également en C ++). Mais la fonctionnalité la plus étonnante est la possibilité d'afficher les rediffusions <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">directement dans le navigateur</a> . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Un problème non résolu est resté pendant la mise en œuvre: nous ne contrôlons pas l'unicité des liens, et l'existence simultanée de <code>&amp;mut</code> et <code>&amp;</code> lorsque vous changez un objet entraînera un comportement indéfini.  Trouble.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Halt a</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">essayé de</a> mettre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en</a> œuvre des liaisons idiomatiques, mais son fusible s'est légèrement estompé.  De plus, pour résoudre ce problème, vous devrez pelleter qualitativement l'API C ++ et définir correctement les qualificateurs <code>const</code> . </p><br><p>  J'ai vraiment aimé travailler sur ce projet, j'ai regardé les rediffusions et plongé profondément dans l'atmosphère.  Ce jeu a laissé un héritage à 믿어 믿어 않을 정도 인.  Aucun jeu n'est populaire auprès de SC: BW, et son impact sur 대한민국 정치 에게 était impensable.  Les pro-gamers en Corée 아마도 sont aussi populaires que dram 주연 배우 들 les drames coréens diffusés aux heures de grande écoute.  또한, 한국 에서 프로 게이머 라면 군대 의 특별한 육군 에 입대 할 수 있다. </p><br><p>  Vive StarCraft! </p><br><h2 id="ssylki">  Les références </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gitter</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bwapi-rs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bwapi-sys</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bwapi-c</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bwapi</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">openbw</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416743/">https://habr.com/ru/post/fr416743/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416729/index.html">Le programme PYCON RUSSIA est prêt: 25 rapports et 3 ateliers de conférenciers de Google, Red Hat, Yelp, Yandex</a></li>
<li><a href="../fr416731/index.html">Frost on glass: comment fabriquer du plastique metglass robuste</a></li>
<li><a href="../fr416737/index.html">Un * algorithme de recherche de chemin dans un jeu Voxel 3d Unity</a></li>
<li><a href="../fr416739/index.html">Nouvel ASUS au Computex 2018</a></li>
<li><a href="../fr416741/index.html">Les attaquants ont utilisé des certificats D-Link volés dans leur logiciel de vol de mot de passe</a></li>
<li><a href="../fr416745/index.html">Nouveau ASUS ROG au Computex 2018</a></li>
<li><a href="../fr416751/index.html">Collecte d'informations contextuelles pour la journalisation</a></li>
<li><a href="../fr416753/index.html">Plugin VPN Hola populaire compromis</a></li>
<li><a href="../fr416755/index.html">Extreme Likes - Comité d'enquête contre</a></li>
<li><a href="../fr416757/index.html">Tests feuilletés</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>