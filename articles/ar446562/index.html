<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ด๐พ ๐ ๐ก ุชุฒุงูู ูู ุงูุจุฑูุฌุฉ ๐จโ๐จโ๐ฆ ๐ ๐๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ูุฌุงู ุชุทููุฑ ุชุทุจููุงุช ูุญูููุฉ ุฐุงุช ูุคุดุฑุงุช ุชุฑุงุจุท ูุชุนุฏุฏุฉ ุฃู ููุฒุนุฉ ุ ุบุงูุจูุง ูุง ุชูุดุฃ ููุงูุดุงุช ุญูู ุงูุจุฑูุฌุฉ ุบูุฑ ุงููุชุฒุงููุฉ. ุงูููู ุณูู ูุชุนูู ูู ุนุฏู ุงูุชุฒุงูู ุจุงูุชู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุฒุงูู ูู ุงูุจุฑูุฌุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/446562/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูู ูุฌุงู ุชุทููุฑ ุชุทุจููุงุช ูุญูููุฉ ุฐุงุช ูุคุดุฑุงุช ุชุฑุงุจุท ูุชุนุฏุฏุฉ ุฃู ููุฒุนุฉ ุ ุบุงูุจูุง ูุง ุชูุดุฃ ููุงูุดุงุช ุญูู ุงูุจุฑูุฌุฉ ุบูุฑ ุงููุชุฒุงููุฉ.  ุงูููู ุณูู ูุชุนูู ูู ุนุฏู ุงูุชุฒุงูู ุจุงูุชูุตูู ูุฏุฑุงุณุฉ ูุง ูู ุนููู ุนูุฏูุง ูุญุฏุซ ุ ูููู ูุคุซุฑ ุนูู ูุบุฉ ุงูุจุฑูุฌุฉ ููุบุฉ ุงูุจุฑูุฌุฉ ุงูุชู ูุณุชุฎุฏููุง.  ุณูุนุฑู ุณุจุจ ุงูุญุงุฌุฉ ุฅูู ุงูุนููุฏ ุงููุณุชูุจููุฉ ูุงููุนูุฏ ุ ูุณูุชุทุฑู ุฅูู ุฃูุธูุฉ ุงูุชุดุบูู ูุฃูุธูุฉ ุงูุชุดุบูู.  ูุฐุง ุณูุฌุนู ุงูููุงุถูุงุช ุงูุชู ุชูุดุฃ ุฃุซูุงุก ุชุทููุฑ ุงูุจุฑูุฌูุงุช ุฃูุซุฑ ูุถูุญุง. </p><br><p style=";text-align:right;direction:rtl">  ุชุณุชูุฏ ุงููุงุฏุฉ ุฅูู ูุณุฎุฉ ูู ุชูุฑูุฑ ุฃุนุฏู ุฅููุงู ุจูุฒูุฑููุณูู ุ ููู ูุฏุฑุณ ูู ูุฏุฑุณุฉ ุชุญููู ุจูุงูุงุช ูุงูุฏูุณ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zl/f-/6v/zlf-6v_wphtcesgmq7cvpvfctbk.png"></p><a name="habracut"></a><br><h1 id="videozapis" style=";text-align:right;direction:rtl">  ุชุณุฌูู ุงูููุฏูู </h1><br><iframe width="560" height="315" src="https://www.youtube.com/embed/g7dno0SupKY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="section1"></a><br><h1 id="1-soderzhanie" style=";text-align:right;direction:rtl">  1. ุงููุญุชูู </h1><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงููุต ุงููุฎูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">1. ุงููุญุชูู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">2. ููุฏูุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">3. ุงูููุงููู ุงูุฃุณุงุณูุฉ</a> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">3.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุถูุน ุงูุชูููุฐ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">3.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุนุฏุฏ ุงูููุงู ูุงูุชุฒุงูู</a> </li></ul></li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">4. ุงูุญุฌุจ ูุงูุงูุชุธุงุฑ</a> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">4.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนุฏู ุญุธุฑ ุงูุงูุชุธุงุฑ</a> </li></ul></li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">5. ุงูุนููุฏ ุงูุขุฌูุฉ / ุงููุนูุฏ</a> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">5.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุณุชูุจู ูุงููุนุฏ ูุงุฌูุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">5.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูููู ุงูุญูุณุจุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">5.3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃูุซูุฉ</a> </li><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">5.4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃู-ูุชุขูุฑ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">5.5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ูุชุขูุฑ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">5.6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฑุฏ ุงูุงุชุตุงู ุงูุชููู</a> </li></ul></li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">6. ููููุฉ ุฌุนู ุฑูุฒ ูููุฑุงุกุฉ ูุน coroutine</a> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">6.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Korutiny</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">6.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุดุฑูุน WaitFor ุงูุชูููุฐ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">6.3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููู ูู ุฏูุฑุฉ ุงูุชุฎุทูุท</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">6.4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุฑูุชูู TS</a> </li></ul></li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">7. ูุงุฐุง ุชูููุชุ</a> </li></ul></div></div><br><a name="section2"></a><br><h1 id="2-vvedenie" style=";text-align:right;direction:rtl">  2. ููุฏูุฉ </h1><br><p style=";text-align:right;direction:rtl"> ูุฑุญุจุงู ุจุงูุฌููุน ุ ุงุณูู ุฅููุงู Puzyrevsky ุ ุฃุนูู ูุฏู Yandex.  ุนูู ูุฏุงุฑ ุงูุณููุงุช ุงูุณุช ุงููุงุถูุฉ ุ ุดุงุฑูุช ูู ุงูุจููุฉ ุงูุชุญุชูุฉ ูุชุฎุฒูู ููุนุงูุฌุฉ ุงูุจูุงูุงุช ุ ูุงูุขู ุงูุชููุช ุฅูู ุงูููุชุฌ - ุจุญุซูุง ุนู ุงูุณูุฑ ูุงูููุงุฏู ูุชุฐุงูุฑ ุงูุณูุฑ.  ููุฐ ุฃู ุนููุช ููุชุฑุฉ ุทูููุฉ ูู ุงูุจููุฉ ุงูุชุญุชูุฉ ุ ุงูุชุณุจุช ุฎุจุฑุฉ ูุจูุฑุฉ ูู ููููุฉ ูุชุงุจุฉ ุงูุชุทุจููุงุช ุงููุญููุฉ ุงููุฎุชููุฉ.  ุชุนูู ุงูุจููุฉ ุงูุฃุณุงุณูุฉ ูุฏููุง ุนูู <code>24*7*365</code> ูููููุง ุทูุงู ุฃูุงู ุงูุฃุณุจูุน ุฏูู ุชููู ุ ูุจุดูู ูุณุชูุฑ ุนูู ุงูุขูุงู ูู ุงูุฃุฌูุฒุฉ.  ุจุทุจูุนุฉ ุงูุญุงู ุ ุชุญุชุงุฌ ุฅูู ูุชุงุจุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุจุญูุซ ุชุนูู ุจุดูู ููุซูู ููุนุงู ููุญู ุงูููุงู ุงูุชู ุชูุฑุถูุง ุงูุดุฑูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงูููู ุณูุชุญุฏุซ ุนู ุนุฏู ุงูุชุฒุงูู.  ูุง ูู ุนุฏู ุงูุชุฒุงููุ  ูู ุนุฏู ุชุทุงุจู ุดูุก ูุน ุดูุก ูู ุงูููุช ุงูููุงุณุจ.  ูู ูุฐุง ุงููุตู ุ ูู ุบูุฑ ุงููุงุถุญ ุนููููุง ูุง ุณุฃุชุญุฏุซ ุนูู ุงูููู.  ูุชูุถูุญ ุงููุถูุฉ ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุ ุฃุญุชุงุฌ ุฅูู ูุซุงู "ูุฑุญุจุงู ูุง ุนุงูู!".  ูุญุฏุซ ุนุฏู ุงูุชุฒุงูู ุนุงุฏุฉู ูู ุณูุงู ูุชุงุจุฉ ุชุทุจููุงุช ุงูุดุจูุฉ ุ ูุฐูู ุณูููู ูุฏูู ูุธูุฑ ุดุจูุฉ "Helloุ world!".  ูุฐุง ูู ุชุทุจูู ูุฑุฉ ุงูุทุงููุฉ.  ุงูุฑูุฒ ูุดุจู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">socket s; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> x; x = read_from_socket(s, <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x == <span class="hljs-string"><span class="hljs-string">"ping"</span></span>) { write_to_socket(s, <span class="hljs-string"><span class="hljs-string">"pong"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃููู ุจุฅูุดุงุก ููุจุณ ุ ููุฑุงุกุฉ ุณุทุฑ ูู ููุงู ุ ูุชุญูู ููุง ุฅุฐุง ูุงู ุจููุบ ุ ุซู ุฃูุชุจ ุจููุบ ุฑุฏูุง.  ุจุณูุท ุฌุฏุง ููุงุถุญ.  ูุงุฐุง ูุญุฏุซ ุนูุฏูุง ุชุฑู ูุฐุง ุงูุฑูุฒ ุนูู ุดุงุดุฉ ุงูููุจููุชุฑ ุงูุฎุงุต ุจูุ  ูููุฑ ูู ูุฐุง ุงูุฑูุฒ ูุชุณูุณู ูู ูุฐู ุงูุฎุทูุงุช: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/va/3e/dk/va3edk8_ja838w9qo7apppwyy50.png"></p><br><p style=";text-align:right;direction:rtl">  ูู ูุฌูุฉ ูุธุฑ ุงูููุช ุงููุนูู ุงููุนูู ุ ูู ุดูุก ูุชุญูุฒ ููููุงู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/od/wo/4g/odwo4gzguqz7nr_odgsksityvda.png"></p><br><p style=";text-align:right;direction:rtl">  ุฃููุฆู ุงูุฐูู ูุงููุง ุจุงููุนู ุจูุชุงุจุฉ ูุชุดุบูู ูุฐุง ุงูุฑูุฒ ูุนุฑููู ุฐูู ุจุนุฏ ูุฑุงุกุฉ ุงูุฎุทูุฉ ูุจุนุฏ ุงูุฎุทูุฉ <br>  ุงููุชุงุจุฉ ูู ูุชุฑุฉ ุฒูููุฉ ููุญูุธุฉ ุฅูู ุญุฏ ูุง ุนูุฏูุง ูุจุฏู ุฃู ุจุฑูุงูุฌูุง ูุง ููุนู ุดูุฆูุง ูู ูุฌูุฉ ูุธุฑ ููุฏูุง ุ ูููู ุชุญุช ุบุทุงุก ูุญุฑู ุงูุณูุงุฑุฉ ุชุนูู ุงููุงูููุฉ ุ ูุงูุชู ูุณูููุง "ุงููุฏุฎูุงุช ูุงููุฎุฑุฌุงุช". </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ye/jl/67/yejl67r3goweaiupb1wjieg5i2a.png"><br>  ุฃุซูุงุก ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ ุ ูุชู ุชุจุงุฏู ุงูุญุฒู ุนุจุฑ ุงูุดุจูุฉ ูุฌููุน ุงูุฃุนูุงู ุงูุซูููุฉ ุฐุงุช ุงููุณุชูู ุงูููุฎูุถ.  ุฏุนูุง ูุฌุฑู ุชุฌุฑุจุฉ ููุฑูุฉ: ุฎุฐ ูุซู ูุฐุง ุงูุจุฑูุงูุฌ ุ ููู ุจุชุดุบููู ุนูู ูุนุงูุฌ ูุงุฏู ูุงุญุฏ ูุงูุชุธุงูุฑ ุจุฃูู ููุณ ูุฏููุง ุฃู ูุธุงู ุชุดุบูู ุ ูุงุฐุง ุณูุญุฏุซุ  ูุง ูููู ูููุนุงูุฌ ุงูุชููู ุ ููู ูุณุชูุฑ ูู ุงุชุฎุงุฐ ุงูุชุฏุงุจูุฑ ุฏูู ุงุชุจุงุน ุฃู ุชุนูููุงุช ุ ููุท ุฅูุฏุงุฑ ุงูุทุงูุฉ ุฏูู ุฌุฏูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/pg/lu/xp/pgluxpmbkl8ho9w-2docuab2iqg.png"></p><br><p style=";text-align:right;direction:rtl">  ุงูุณุคุงู ุงูุฐู ูุทุฑุญ ููุณู ูู ูุง ุฅุฐุง ูุงู ุจุฅููุงููุง ูุนู ุฃู ุดูุก ูููุฏ ุฎูุงู ูุฐู ุงููุชุฑุฉ ุงูุฒูููุฉ.  ูุฐุง ุณุคุงู ุทุจูุนู ููุบุงูุฉ ุ ุญูุซ ุชุชูุญ ููุง ุงูุฅุฌุงุจุฉ ุชูููุฑ ุทุงูุฉ ุงููุนุงูุฌ ูุงุณุชุฎุฏุงูู ูู ุดูุก ูููุฏ ุ ุจูููุง ูุจุฏู ุฃู ุชุทุจูููุง ูุง ููุนู ุดูุฆูุง. </p><br><a name="section3"></a><br><h1 id="3-osnovnye-ponyatiya" style=";text-align:right;direction:rtl">  3. ุงูููุงููู ุงูุฃุณุงุณูุฉ </h1><br><a name="section3-1"></a><br><h2 id="31-potok-vypolneniya" style=";text-align:right;direction:rtl">  3.1.  ููุถูุน ุงูุชูููุฐ </h2><br><p style=";text-align:right;direction:rtl">  ููู ูููููุง ุงูุชุนุงูู ูุน ูุฐู ุงููููุฉุ  ุฏุนููุง ุงูุชูููู ุจูู ุงูููุงููู.  ุณุฃููู "ุชุฏูู ุงูุชูููุฐ" ุ ูู ุฅุดุงุฑุฉ ุฅูู ุจุนุถ ุงูุชุณูุณู ุงููุงุฏู ููุนูููุงุช ุงูุฃูููุฉ ุฃู ุงูุฎุทูุงุช.  ุณูุชู ุชุญุฏูุฏ ุงููุนูู ูู ุฎูุงู ุงูุณูุงู ุงูุฐู ุฃุชุญุฏุซ ููู ุนู ุชุฏูู ุงูุชูููุฐ.  ูุฐุง ูู ุ ุฅุฐุง ููุง ูุชุญุฏุซ ุนู ุฎูุงุฑุฒููุฉ ููุฑุฏุฉ ุงูุชุฑุงุจุท (Aho-Korasik ุ ุงูุจุญุซ ูู ุงูุฑุณู ุงูุจูุงูู) ุ ูุฅู ูุฐู ุงูุฎูุงุฑุฒููุฉ ููุณูุง ูู ุจุงููุนู ุณูุณูุฉ ูู ุงูุชูููุฐ.  ูุฃุฎุฐ ุจุนุถ ุงูุฎุทูุงุช ูุญู ุงููุดููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุฃุชุญุฏุซ ุนู ูุงุนุฏุฉ ุจูุงูุงุช ุ ููุฏ ูููู ูุคุดุฑ ุชุฑุงุจุท ุงูุชูููุฐ ูุงุญุฏูุง ุฌุฒุกูุง ูู ุงูุฅุฌุฑุงุกุงุช ุงูุชู ุชููุฐูุง ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฎุฏูุฉ ุทูุจ ูุงุฑุฏ ูุงุญุฏ.  ุงูุดูุก ููุณู ููุทุจู ุนูู ุฎูุงุฏู ุงูููุจ.  ุฅุฐุง ููุช ุฃูุชุจ ููุนูุง ูู ุชุทุจูู ุงููุงุชู ุงููุญููู ุฃู ุงูููุจ ุ ููู ุจุฎุฏูุฉ ุฃุญุฏ ุงููุณุชุฎุฏููู ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงูููุฑ ููู ุฒุฑ ุ ูุชูุงุนูุงุช ุงูุดุจูุฉ ุ ูุงูุชูุงุนู ูุน ุงูุชุฎุฒูู ุงููุญูู ุ ููุง ุฅูู ุฐูู.  ุณูููู ุชุณูุณู ูุฐู ุงูุฅุฌุฑุงุกุงุช ูู ูุฌูุฉ ูุธุฑ ุชุทุจููู ูููุงุชู ุงููุญููู ุฃูุถูุง ุชุฏูููุง ูููุตูุงู ููุงููุง ููุชูููุฐ.  ูู ูุฌูุฉ ูุธุฑ ูุธุงู ุงูุชุดุบูู ุ ูุนุชุจุฑ ูุคุดุฑ ุชุฑุงุจุท ุงูุนูููุฉ ุฃู ุงูุนูููุฉ ุฃูุถูุง ูุคุดุฑ ุชุฑุงุจุท ุฐุง ูุนูู ููุชูููุฐ. </p><br><a name="section3-2"></a><br><h2 id="32-mnogozadachnost-i-parallelizm" style=";text-align:right;direction:rtl">  3.2.  ุชุนุฏุฏ ุงูููุงู ูุงูุชุฒุงูู </h2><br><p style=";text-align:right;direction:rtl">  ุญุฌุฑ ุงูุฒุงููุฉ ูู ุงูุฅูุชุงุฌูุฉ ูู ุงููุฏุฑุฉ ุนูู ุงูููุงู ุจูุฐู ุงูุฎุฏุนุฉ: ุนูุฏูุง ูููู ูุฏูู ูุคุดุฑ ุชุฑุงุจุท ูุงุญุฏ ููุชูููุฐ ูุญุชูู ุนูู ูุฑุงุบุงุช ูู ููุชู ุงููุนูู ุ ุซู ููุก ูุฐู ุงููุฑุงุบุงุช ุจุดูุก ูููุฏ - ุงุชุจุน ุฎุทูุงุช ูุคุดุฑุงุช ุงูุชุฑุงุจุท ุงูุฃุฎุฑู ููุชูููุฐ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/vw/x1/si/vwx1sijti5ahggnjozkymza2hna.png"></p><br><p style=";text-align:right;direction:rtl">  ุชุฎุฏู ููุงุนุฏ ุงูุจูุงูุงุช ุนุงุฏุฉู ุงูุนุฏูุฏ ูู ุงูุนููุงุก ูู ููุณ ุงูููุช.  ุฅุฐุง ุงุณุชุทุนูุง ุงูุฌูุน ุจูู ุงูุนูู ุนูู ุนุฏุฉ ุฎููุท ููุชูููุฐ ูู ุฅุทุงุฑ ุฎูุท ูุงุญุฏ ููุชูููุฐ ุจูุณุชูู ุฃุนูู ุ ูุฅู ูุฐุง ูุณูู ุชุนุฏุฏ ุงูููุงู.  ุฃู ุฃู ุชุนุฏุฏ ุงูููุงู ูู ุนูุฏูุง ุฃููู ุจุชูููุฐ ุฅุฌุฑุงุกุงุช ูู ุฅุทุงุฑ ุชุฏูู ุฃูุจุฑ ูุงุญุฏ ูู ุงูุชูููุฐ ูููู ุฎุงุถุนูุง ูุญู ุงูููุงู ุงูุฃุตุบุฑ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูููู ุนุฏู ุงูุฎูุท ุจูู ููููู ุชุนุฏุฏ ุงูููุงู ูุงูุชูุงุฒู.  ุงูุชุฒุงูู - <br>  ูุฐู ูู ุฎุตุงุฆุต ุจูุฆุฉ ููุช ุงูุชุดุบูู ุ ูุงูุชู ุชุฌุนู ูู ุงููููู ูู ุฎุทูุฉ ูุงุญุฏุฉ ูู ุงูููุช ุ ูู ุฎุทูุฉ ูุงุญุฏุฉ ุ ุฅุญุฑุงุฒ ุชูุฏู ูู ูุคุดุฑุงุช ุชุฑุงุจุท ุงูุชูููุฐ ุงููุฎุชููุฉ.  ุฅุฐุง ูุงู ูุฏู ูุนุงูุฌุงู ูุนููุงู ุ ูููููููุง ูู ุฏูุฑุฉ ูุงุญุฏุฉ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ ุชูููุฐ ุชุนูููููู.  ุฅุฐุง ูุงู ุงูุจุฑูุงูุฌ ูุนูู ุนูู ูุนุงูุฌ ูุงุญุฏ ุ ูุณูุณุชุบุฑู ุงูุฃูุฑ ุฏูุฑุชูู ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ ูุชูููุฐ ููุณ ุงูุฅุฑุดุงุฏุงุช. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nq/n5/yf/nqn5yf1pee8kwgi3rw1lxmnyomi.png"></p><br><p style=";text-align:right;direction:rtl">  ูู ุงูููู ุนุฏู ุงูุฎูุท ุจูู ูุฐู ุงูููุงููู ุ ูุฃููุง ุชูุน ูู ูุฆุงุช ูุฎุชููุฉ.  ุชุนุฏ ุชุนุฏุฏ ุงูููุงู ุฅุญุฏู ููุฒุงุช ุงูุจุฑูุงูุฌ ุงูุชู ูุชู ุชูุธูููุง ุฏุงุฎูููุง ูุนูู ูุชุบูุฑ ูู ููุงู ูุฎุชููุฉ.  ุงูุชุฒุงูู ูู ุฎุงุตูุฉ ูุจูุฆุฉ ุงูุชุดุบูู ุงูุชู ุชูููู ูู ุงูุนูู ุนูู ุงูุนุฏูุฏ ูู ุงูููุงู ูู ุฏูุฑุฉ ูุงุญุฏุฉ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุนุฏูุฏ ูู ุงูุทุฑู ุ ุชููู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุบูุฑ ุงููุชุฒุงููุฉ ูุงููุชุงุจุฉ ุบูุฑ ุงููุชุฒุงููุฉ ุจูุชุงุจุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุชุนุฏุฏุฉ ุงูููุงู.  ุชููู ุงูุตุนูุจุฉ ุงูุฑุฆูุณูุฉ ูู ููููุฉ ุชุดููุฑ ุงูููุงู ูููููุฉ ุฅุฏุงุฑุชูุง.  ูุฐูู ุ ุงูููู ุณูู ูุชุญุฏุซ ุนู ูุฐุง - ูุชุงุจุฉ ุฑูุฒ ุชุนุฏุฏ ุงูููุงู. </p><br><a name="section4"></a><br><h1 id="4-blokirovanie-i-ozhidanie" style=";text-align:right;direction:rtl">  4. ุงูุญุฌุจ ูุงูุงูุชุธุงุฑ </h1><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/da7/042/897/da7042897d750697821baf6381db92ea.png"></p><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ุจุจุนุถ ุงูุฃูุซูุฉ ุงูุจุณูุทุฉ.  ุงูุนูุฏุฉ ุฅูู ูุฑุฉ ุงูุทุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">socket s; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> x; x = read_from_socket(s, <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x == <span class="hljs-string"><span class="hljs-string">"ping"</span></span>) { write_to_socket(s, <span class="hljs-string"><span class="hljs-string">"pong"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ูุงูุดูุง ุจุงููุนู ุ ุจุนุฏ ุฃู ููุฑุฃ ุฎููุท ุงูุชูููุฐ ูุงูุฎุทูุท ุงูุจูุถุงุก ูุงุฆููุง ุ ูุชู ุญุธุฑู.  ุนุงุฏุฉ ูุง ูููู ุ "ุงูุชุฏูู ูุญุธูุฑ." </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">socket s; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> x; x = read_from_socket(s, <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* thread is blocked here */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x == <span class="hljs-string"><span class="hljs-string">"ping"</span></span>) { write_to_socket(s, <span class="hljs-string"><span class="hljs-string">"pong"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* thread is blocked here */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ูุนูู ุฃู ุชุฏูู ุงูุชูููุฐ ูุฏ ูุตู ุฅูู ููุทุฉ ุญูุซ ุฃู ุญุฏุซ ุถุฑูุฑู ูููุงุตูุฉ ุฐูู.  ุนูู ูุฌู ุงูุฎุตูุต ุ ูู ุญุงูุฉ ุชุทุจูู ุดุจูุชูุง ุ ูู ุงูุถุฑูุฑู ุฃู ุชุตู ุงูุจูุงูุงุช ุนุจุฑ ุงูุดุจูุฉ ุ ุฃู ุนูู ุงูุนูุณ ุ ูุฏููุง ูุฎุฒู ูุคูุช ูุฌุงูู ููุชุงุจุฉ ุงูุจูุงูุงุช ุฅูู ุงูุดุจูุฉ.  ุงูุฃุญุฏุงุซ ูุฏ ุชููู ูุฎุชููุฉ.  ุฅุฐุง ููุง ูุชุญุฏุซ ุนู ุงูุฌูุงูุจ ุงูุฒูููุฉ ุ ููููููุง ุงูุงูุชุธุงุฑ ุญุชู ูุชู ุชุดุบูู ุงููุคูุช ุฃู ุฅููุงู ุนูููุฉ ุฃุฎุฑู.  ุงูุฃุญุฏุงุซ ููุง ูู ููุน ูู ุงูุฃุดูุงุก ุงููุฌุฑุฏุฉ ุ ูู ุงูููู ุฃู ูููู ุฃูู ูููู ุชููุนูุง. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c91/02f/7ca/c9102f7ca66291666b9df9c05ce7f46e.png"></p><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ููุชุจ ุฑูุฒูุง ุจุณูุทูุง ุ ูุฅููุง ูููุญ ุถููููุง ุงูุชุญูู ูู ุชููุน ุงูุญุฏุซ ุฅูู ูุณุชูู ุฃุนูู.  ูู ุญุงูุชูุง ุ ููุธุงู ุงูุชุดุบูู.  ูู ุ ุจุตูุชูุง ููุงููุง ุจูุณุชูู ุฃุนูู ุ ูุณุคููุฉ ุนู ุงุฎุชูุงุฑ ุงููููุฉ ุงูุชู ุณูุชู ุชูููุฐูุง ุจุนุฏ ุฐูู ุ ููู ุฃูุถูุง ูุณุคููุฉ ุนู ุชุชุจุน ุญุฏูุซ ุงูุฃุญุฏุงุซ. </p><br><p style=";text-align:right;direction:rtl">  ููุฏูุง ุ ุงูุฐู ููุชุจู ููุทูุฑูู ุ ููุธู ูู ููุณ ุงูููุช ูููุง ูุชุนูู ุจุงูุนูู ูู ูููุฉ ูุงุญุฏุฉ.  ูุนุงูุฌ ููุชุทู ุงูุดูุฑุฉ ูู ุงููุซุงู ุงุชุตุงููุง ูุงุญุฏูุง: ููุฑุฃ ping ูู ุงุชุตุงู ูุงุญุฏ ูููุชุจ pong ุฅูู ุงุชุตุงู ูุงุญุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุงูููุฏ ูุงุถุญ  ููููู ูุฑุงุกุชูุง ูููู ูุง ุงูุฐู ุชูุนูู ุ ูููู ุชุนูู ุ ูุงููุดููุฉ ุงูุชู ุชุญููุง ุ ููุง ูู ุงูุซุบุฑุงุช ุงูููุฌูุฏุฉ ูุฏููุง ุ ููุง ุฅูู ุฐูู.  ูู ุงูููุช ููุณู ุ ูุญู ูุฏูุฑ ุชุฎุทูุท ุงูููุงู ุจุดูู ุณูุก ููุบุงูุฉ ูู ูุซู ูุฐุง ุงููููุฐุฌ.  ุจุดูู ุนุงู ุ ุชุญุชูู ุฃูุธูุฉ ุงูุชุดุบูู ุนูู ููุงููู ููุฃููููุงุช ุ ูููู ุฅุฐุง ูุชุจุช ุฃูุธูุฉ ูู ุงูููุช ุงููุนูู ุ ูุฃูุช ุชุนูู ุฃู ุงูุฃุฏูุงุช ุงููุชููุฑุฉ ูู Linux ููุณุช ูุงููุฉ ูุฅูุดุงุก ูุง ูููู ูู ุฃูุธูุฉ ุงูููุช ุงูุญูููู ุงููุนูููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุนูุงูุฉ ุนูู ุฐูู ุ ูุนุฏ ูุธุงู ุงูุชุดุบูู ุฃูุฑูุง ูุนูุฏูุง ุ ููููู ุชุจุฏูู ุงูุณูุงู ูู ุชุทุจูููุง ุฅูู ุงูููุงุฉ ุจุถุนุฉ ูููุฑูุซุงููุฉ ุ ูุงูุชู ุ ูุน ุจุนุถ ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ุงูุจุณูุทุฉ ุ ุชุนุทููุง ุชูุฏูุฑูุง ูุญูุงูู 20-100 ุฃูู ุชุจุฏูู ููุณูุงู ูู ุงูุซุงููุฉ.  ูุฐุง ูุนูู ุฃูู ุฅุฐุง ูููุง ุจูุชุงุจุฉ ุฎุงุฏู ููุจ ุ ููููููุง ูู ุบุถูู ุซุงููุฉ ูุงุญุฏุฉ ูุนุงูุฌุฉ ุญูุงูู 20 ุฃูู ุทูุจ ุ ุนูู ุงูุชุฑุงุถ ุฃู ูุนุงูุฌุฉ ุงูุทูุจุงุช ุฃุนูู ุนุดุฑ ูุฑุงุช ูู ุงููุธุงู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c12/68f/503/c1268f5037154f9f0f5ac5bc82dfc531.png"></p><br><a name="section4-1"></a><br><h2 id="41-neblokiruyuschee-ozhidanie" style=";text-align:right;direction:rtl">  4.1.  ุนุฏู ุญุธุฑ ุงูุงูุชุธุงุฑ </h2><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ffe/97f/c42/ffe97fc42eca8beb2dae841358b31b8e.png"></p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุตูุช ุฅูู ุงููููู ุงูุฐู ุชุญุชุงุฌู ููุนูู ูุน ุงูุดุจูุฉ ุจุดูู ุฃูุซุฑ ููุงุกุฉ ุ ูุฅูู ุชุจุฏุฃ ูู ุงูุจุญุซ ุนู ุงููุณุงุนุฏุฉ ุนูู ุงูุฅูุชุฑูุช ูุชูุชูู ุชุญุฏูุฏ / epoll.  ููุชูุจ ุนูู ุงูุฅูุชุฑูุช ุฃูู ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฎุฏูุฉ ุงูุขูุงู ูู ุงูุงุชุตุงูุงุช ูู ููุณ ุงูููุช ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู epoll ุ ูุฃููุง ุขููุฉ ุฌูุฏุฉ ููุง ุฅูู ุฐูู.  ุชูุชุญ ุงููุซุงุฆู ูุชุฑู ุดูุฆูุง ููุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">select</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nfds, fd_set* readfds, fd_set* writefds, fd_set* exceptfds, struct timeval* timeout)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FD_CLR</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, fd_set* </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">set</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FD_ISSET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, fd_set* </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">set</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FD_SET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, fd_set* </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">set</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FD_ZERO</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fd_set* </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">set</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">epoll_ctl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> epfd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> op, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, struct epoll_event* event)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">epoll_wait</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> epfd, struct epoll_event* events, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxevents, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> timeout)</span></span></span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููุธุงุฆู ุงูุชู ุชุญุชูู ูููุง ุงููุงุฌูุฉ ุฅูุง ุนูู ุงููุซูุฑ ูู ุงููุงุตูุงุช ุงูุชู ุชุนูู ูุนูุง (ูู ุญุงูุฉ ุงูุงุฎุชูุงุฑ) ุ ุฃู ุงูุนุฏูุฏ ูู ุงูุฃุญุฏุงุซ ุงูุชู ุชูุฑ <br>  ุนุจุฑ ุญุฏูุฏ ุงูุชุทุจูู ุงูุฎุงุต ุจู ุ ููุงุฉ ูุธุงู ุงูุชุดุบูู ุงูุชู ุชุญุชุงุฌ ุฅูู ูุนุงูุฌุฉ (ูู ุญุงูุฉ epoll). </p><br><p style=";text-align:right;direction:rtl">  ูุฌุฏุฑ ุฃูุถูุง ุฅุถุงูุฉ ุฃูู ูุง ููููู ุชุญุฏูุฏ / epoll ุ ูููู ุฅูู ููุชุจุฉ ูุซู libuv ุ ูุงูุชู ูู ุชุชุถูู ุฃู ุฃุญุฏุงุซ ูู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุ ูููู ุณูููู ููุง ุงูุนุฏูุฏ ูู ุนูููุงุช ุงูุงุณุชุฑุฌุงุนุงุช.  ุณุชููู ูุงุฌูุฉ ุงูููุชุจุฉ: "ุตุฏููู ุงูุนุฒูุฒ ุ ูู ุจุชูููุฑ ุฑุฏ ุงุชุตุงู ููุฑุงุกุฉ ุงูููุจุณ ุ ูุงูุฐู ุณุฃุชุตู ุจู ุนูุฏูุง ุชุธูุฑ ุงูุจูุงูุงุช." </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uv_timer_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_timer_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* handle, uv_timer_cb cb, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> timeout, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> repeat)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*uv_timer_cb)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_timer_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* handle)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uv_read_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_stream_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* stream, uv_alloc_cb alloc_cb, uv_read_cb read_cb)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uv_read_stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_stream_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">*)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*uv_read_cb)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_stream_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* stream, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ssize_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nread, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_buf_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buf)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uv_write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_write_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* req, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_stream_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* handle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_buf_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bufs[], </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nbufs, uv_write_cb cb)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*uv_write_cb)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uv_write_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* req, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> status)</span></span></span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ุงูุฐู ุชุบูุฑ ููุงุฑูุฉู ุจุฑูุฒูุง ุงููุชุฒุงูู ูู ุงููุตู ุงูุณุงุจูุ  ุฃุตุจุญ ุงูุฑูุฒ ุบูุฑ ูุชุฒุงูู.  ูุฐุง ูุนูู ุฃููุง ุฃุฎุฐูุง ุงูููุทู ูู ุงูุชุทุจูู ูุชุญุฏูุฏ ุงูููุทุฉ ุงูุฒูููุฉ ุงูุชู ูุชู ูููุง ูุฑุงูุจุฉ ุงูุฃุญุฏุงุซ.  ููุงููุงุช ุงูุชุญุฏูุฏ / epoll ุงูุตุฑูุญุฉ ูู ุงูููุงุท ุงูุชู ูุทูุจ ูู ูุธุงู ุงูุชุดุบูู ุงูุญุตูู ุนูู ูุนูููุงุช ุญูู ุงูุฃุญุฏุงุซ ุงูุชู ุญุฏุซุช ูููุง.  ุฃุฎุฐูุง ุฃูุถูุง ูู ุฑูุฒ ุงูุชุทุจูู ุงูุฎุงุต ุจูุง ุงุฎุชูุงุฑ ุงููููุฉ ุงูุชู ูุฌุจ ุงูุนูู ุนูููุง ูู ุงููุฑุฉ ุงููุงุฏูุฉ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/458/28b/5f2/45828b5f2463ec94abf292e8a5db86bf.png"></p><br><p style=";text-align:right;direction:rtl">  ูู ุฃูุซูุฉ ุงููุงุฌูุงุช ุ ููููู ุฃู ุชุฑู ุฃู ููุงู ุขููุชูู ูุฅุฏุฎุงู ุงูููุงู ุงููุชุนุฏุฏุฉ.  ููุน ูุงุญุฏ ูู "ุณุญุจ" ุนูุฏูุง ูููู <br>  ูุณุชุฎูุต ุงูุนุฏูุฏ ูู ุงูุฃุญุฏุงุซ ุงูุชู ููุชุธุฑูุง ุ ููู ุซู ูุชูุงุนู ูุนูุง ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู.  ูู ูุฐุง ุงูููุฌ ุ ูู ุงูุณูู ุฅุทูุงุก ุงููููุงุช ุงูุนุงูุฉ ุจูุงุญุฏ <br>  ุญุฏุซ ูุจุงูุชุงูู ุชุญููู ุฅูุชุงุฌูุฉ ุนุงููุฉ ูู ุงูุชูุงุตู ุญูู ูุฌููุนุฉ ุงูุฃุญุฏุงุซ ุงูุชู ุญุฏุซุช.  ุนุงุฏุฉู ุ ุชุนุชูุฏ ุฌููุน ุนูุงุตุฑ ุงูุดุจูุฉ ูุซู ุชูุงุนู kernel ูุน ุจุทุงูุฉ ุงูุดุจูุฉ ุฃู ุชูุงุนูู ููุธุงู ุงูุชุดุบูู ุนูู ุขููุงุช ุงูุงุณุชุทูุงุน. </p><br><p style=";text-align:right;direction:rtl">  ุงูุทุฑููุฉ ุงูุซุงููุฉ ูู ุขููุฉ "ุงูุฏูุน" ุ ุนูุฏูุง ูุฃุชู ููุงู ุฎุงุฑุฌู ูุนูู ุจูุถูุญ ุ ููุงุทุน ุชุฏูู ุงูุชูููุฐ ููููู: "ุงูุขู ุ ูุฑุฌู ุงูุชุนุงูู ูุน ุงูุญุฏุซ ุงูุฐู ูุตู ูุชูู".  ูุฐุง ูู ุงูููุฌ ูุน ุฑุฏ ุงูุงุชุตุงู ุ ูุน ุฅุดุงุฑุงุช ููููุณ ุ ูุน ุงููุทุงุน ุนูู ูุณุชูู ุงููุนุงูุฌ ุ ุนูุฏูุง ูุบุฒู ููุงู ุฎุงุฑุฌู ุจูุถูุญ ููุถูุน ุงูุชูููุฐ ููููู: "ุงูุขู ุ ูู ูุถูู ุ ูุญู ูุนูู ุนูู ูุฐุง ุงูุญุฏุซ."  ููุฏ ุธูุฑ ูุฐุง ุงูููุฌ ูู ุฃุฌู ุงูุญุฏ ูู ุงูุชุฃุฎูุฑ ุจูู ุญุฏูุซ ุญุฏุซ ูุฑุฏ ุงููุนู ุนููู. </p><br><p style=";text-align:right;direction:rtl">  ููุงุฐุง ูุฏ ูุฑุบุจ ูุทูุฑู C ++ ุงูุฐูู ููุชุจูู ููุญููู ูุดุงูู ูุนููุฉ ูู ุงูุชุทุจูู ูู ุณุญุจ ูููุฐุฌ ุญุฏุซ ุฅูู ุงูููุฏ ุงูุฎุงุต ุจูุงุ  ุฅุฐุง ูููุง ุจุณุญุจ ูุฅุณูุงุท ุงูุนูู ูู ุงูุนุฏูุฏ ูู ุงูููุงู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจูุง ูุฅุฏุงุฑุชูุง ุ ูุจุณุจุจ ุนุฏู ุงูุงูุชูุงู ุฅูู kernel ูุงูุนูุณ ุตุญูุญ ุ ูููููุง ุงูุนูู ุจุดูู ุฃุณุฑุน ููููุงู ูุชูููุฐ ุฅุฌุฑุงุกุงุช ุฃูุซุฑ ูุงุฆุฏุฉ ููู ูุญุฏุฉ ุฒูููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุง ุงูุฐู ูุคุฏู ุฅููู ูุฐุง ูู ุญูุซ ุงูุฑูุฒ ุงูุฐู ููุชุจูุ  ุฎุฐ nginx ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฎุงุฏู HTTP ุนุงูู ุงูุฃุฏุงุก ุ ุดุงุฆุน ุฌุฏูุง.  ุฅุฐุง ููุช ุจูุฑุงุกุฉ ุงูููุฏ ุงูุฎุงุต ุจู ุ ููู ูุจูู ุนูู ูููุฐุฌ ุบูุฑ ูุชุฒุงูู.  ุงูููุฏ ูู ุงูุตุนุจ ุฌุฏุง ูุฑุงุกุชู.  ุนูุฏูุง ุชุณุฃู ููุณู ุนูุง ูุญุฏุซ ุจุงูุถุจุท ุนูุฏ ูุนุงูุฌุฉ ุทูุจ HTTP ูุงุญุฏ ุ ูุชุจูู ุฃู ููุงู ุงููุซูุฑ ูู ุงูุฃุฌุฒุงุก ูู ุงูุดูุฑุฉ ุ ูุชุจุงุนุฏุฉ ูู ูููุงุช ูุฎุชููุฉ ุ ูู ุฒูุงูุง ูุฎุชููุฉ ูู ูุงุนุฏุฉ ุงูุดูุฑุฉ.  ุชููู ูู ุฌุฒุก ุจุฌุฒุก ุตุบูุฑ ูู ุงูุนูู ูุฌุฒุก ูู ุฎุฏูุฉ ุทูุจ HTTP ุจุงููุงูู.  ุนูู ุณุจูู ุงููุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ngx_http_request_handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ngx_event_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ev)</span></span></span><span class="hljs-function"> </span></span>{ โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c-&gt;close) { ngx_http_terminate_request(r, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ev-&gt;write) { r-&gt;write_event_handler(r); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { r-&gt;read_event_handler(r); } ... } <span class="hljs-comment"><span class="hljs-comment">/* where the handler... */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*ngx_http_event_handler_pt)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ngx_http_request_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *r)</span></span></span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ngx_http_request_s</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> ngx_http_event_handler_pt read_event_handler; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }; <span class="hljs-comment"><span class="hljs-comment">/* ...is set when switching to the next processing stage */</span></span> r-&gt;read_event_handler = ngx_http_request_empty_handler; r-&gt;read_event_handler = ngx_http_block_reading; r-&gt;read_event_handler = ngx_http_test_reading; r-&gt;read_event_handler = ngx_http_discarded_request_body_handler; r-&gt;read_event_handler = ngx_http_read_client_request_body_handler; r-&gt;read_event_handler = ngx_http_upstream_rd_check_broken_connection; r-&gt;read_event_handler = ngx_http_upstream_read_request_handler;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู ุจููุฉ ุงูุทูุจ ุ ูุงูุชู ูุชู ุชูุฌูููุง ุฅูู ูุนุงูุฌ ุงูุฃุญุฏุงุซ ุนูุฏ ูุฑุงุกุฉ ุฅุดุงุฑุงุช ุงูููุจุณ ุฃู ุงููุตูู ูููุชุงุจุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูููู ูุฐุง ุงููุนุงูุฌ ุจุงูุชุจุฏูู ุจุงุณุชูุฑุงุฑ ูู ุงูุจุฑูุงูุฌ ููููุง ูุญุงูุฉ ูุนุงูุฌุฉ ุงูุทูุจ.  ุฅูุง ุฃู ููุฑุฃ ุงูุฑุคูุณ ุ ุฃู ููุฑุฃ ูุต ุงูุทูุจ ุ ุฃู ูุทูุจ ุงูุจูุงูุงุช ุงูุฃูููุฉ - ุจุดูู ุนุงู ุ ููุงู ุงูุนุฏูุฏ ูู ุงูุญุงูุงุช ุงููุฎุชููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุตุนุจ ูุฑุงุกุฉ ูุฐุง ุงูุฑูุฒ ูุฃูู ููุตู ูู ุฌููุฑู ูู ุญูุซ ุฑุฏ ุงููุนู ุนูู ุงูุฃุญุฏุงุซ.  ูุญู ูู ูุซู ูุฐู ุงูุญุงูุฉ ููุฑุฏ ุนูููุง ุจุทุฑููุฉ ูุนููุฉ ููุฃุญุฏุงุซ ุงูุชู ููุนุช.  ููุงู ููุต ูู ุงูุตูุฑุฉ ุงููููุฉ ููุนูููุฉ ุจุฃููููุง ููุนุงูุฌุฉ ุทูุจ HTTP. </p><br><p style=";text-align:right;direction:rtl">  ููุงู ุฎูุงุฑ ุขุฎุฑ ุ ูุชู ุงุณุชุฎุฏุงูู ุบุงูุจูุง ูู JavaScript ุ ููู ุฅูุดุงุก ุชุนูููุฉ ุจุฑูุฌูุฉ ุชุณุชูุฏ ุฅูู ุฑุฏ ุงูุงุชุตุงู ุนูุฏูุง ูุนูุฏ ุชูุฌูู ุฑุฏ ุงูุงุชุตุงู ุฅูู ุงุณุชุฏุนุงุก ุงููุงุฌูุฉ ุ ุญูุซ ููุฌุฏ ุนุงุฏุฉู ุฑุฏ ุงุชุตุงู ูุชุฏุงุฎู ุขุฎุฑ ูุญุฏุซ ูุง ุ ููุง ุฅูู ุฐูู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LibuvStreamWrap::ReadStart() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> uv_read_start(stream(), [](<span class="hljs-keyword"><span class="hljs-keyword">uv_handle_t</span></span>* handle, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> suggested_size, <span class="hljs-keyword"><span class="hljs-keyword">uv_buf_t</span></span>* buf) { <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;LibuvStreamWrap*&gt;(handle-&gt;data)-&gt;OnUvAlloc(suggested_size, buf); }, [](<span class="hljs-keyword"><span class="hljs-keyword">uv_stream_t</span></span>* stream, <span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> nread, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uv_buf_t</span></span>* buf) { <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;LibuvStreamWrap*&gt;(stream-&gt;data)-&gt;OnUvRead(nread, buf); }); } <span class="hljs-comment"><span class="hljs-comment">/* ...for example, parsing http... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (p=data; p != data + len; p++) { ch = *p; reexecute: <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (CURRENT_STATE()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_start_req_or_res: <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_or_resp_H: <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_HT: <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_HTT: <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_HTTP: <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_http_major: <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> s_res_http_dot: <span class="hljs-comment"><span class="hljs-comment">/*... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุฑูุฒ ูุฌุฒุฃ ูุฑุฉ ุฃุฎุฑู ุ ูุง ููุฌุฏ ููู ููุญุงูุฉ ุงูุญุงููุฉ ูููููุฉ ุนูููุง ุนูู ุงูุทูุจ.  ูุชู ููู ุงููุซูุฑ ูู ุงููุนูููุงุช ูู ุฎูุงู ุนูููุงุช ุงูุฅุบูุงู ุ ูุชุญุชุงุฌ ุฅูู ุจุฐู ุฌููุฏ ุฐูููุฉ ูุฅุนุงุฏุฉ ุจูุงุก ููุทู ูุนุงูุฌุฉ ุทูุจ ูุงุญุฏ. </p><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ูู ุฎูุงู ุฅุฏุฎุงู ุชุนุฏุฏ ุงูููุงู ูู ุงูููุฏ ุงูุฎุงุต ุจูุง (ููุทู ุงุฎุชูุงุฑ ููุงู ุงูุนูู ูุชุนุฏุฏูุง) ุ ูุญุตู ุนูู ููุฏ ูุนุงู ูุงูุชุญูู ูู ุชุฑุชูุจ ุฃููููุงุช ุงููููุฉ ุ ููููุง ูููุฏ ุงููุซูุฑ ูููุง ูู ุณูููุฉ ุงููุฑุงุกุฉ.  ูุตุนุจ ูุฑุงุกุฉ ูุฐุง ุงูุฑูุฒ ููุตุนุจ ุตูุงูุชู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/da5/a8a/151/da5a8a1517fb18945a330ae4c2b6d722.png"></p><br><p style=";text-align:right;direction:rtl">  ููุงุฐุงุ  ุงูุชุฑุถ ุฃู ูุฏู ุญุงูุฉ ุจุณูุทุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ููุฏ ูุฑุฃุช ููููุง ููููุชู ุนุจุฑ ุงูุดุจูุฉ.  ูู ุฅุตุฏุงุฑ ุบูุฑ ูุญุธูุฑ ุ ุชุชูุงูู ูุฐู ุงูุญุงูุฉ ูุน ุขูุฉ ุงูุญุงูุฉ ุงูุฎุทูุฉ ูุฐู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุญุงูุฉ ุงูุฃูููุฉ </li><li style=";text-align:right;direction:rtl">  ุงุจุฏุฃ ูู ูุฑุงุกุฉ ููู ุ </li><li style=";text-align:right;direction:rtl">  ูู ุงูุชุธุงุฑ ุงูุฑุฏ ูู ูุธุงู ุงููููุงุช ุ </li><li style=";text-align:right;direction:rtl">  ูุชุงุจุฉ ููู ุฅูู ููุจุณ ุ </li><li style=";text-align:right;direction:rtl">  ุงูุญุงูุฉ ุงูููุงุฆูุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุ ุฏุนูุง ูููู ุฃููู ุฃุฑูุฏ ุฅุถุงูุฉ ูุนูููุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅูู ูุฐุง ุงูููู.  ุฎูุงุฑ ุจุณูุท: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุญุงูุฉ ุงูุฃูููุฉ </li><li style=";text-align:right;direction:rtl">  ูุฑุงุกุฉ ููู </li><li style=";text-align:right;direction:rtl">  ุงูุฑุฃ ุงูููู </li><li style=";text-align:right;direction:rtl">  ูุฑุงุกุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช </li><li style=";text-align:right;direction:rtl">  ูุฑุงุกุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ </li><li style=";text-align:right;direction:rtl">  ุฃูุง ุฃุนูู ูุน ุงูููุจุณ </li><li style=";text-align:right;direction:rtl">  ูุชุจ ุฅูู ุงูููุจุณ. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ูุซู ุฑูุฒ ุฎุทู ุ ููู ุนุฏุฏ ุงูุญุงูุงุช ุฒุงุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุซู ุชุจุฏุฃ ูู ุงูุชูููุฑ ูู ุฃูู ุณูููู ูู ุงูุฌูุฏ ููุงุฒุงุฉ ุงูุฎุทูุชูู - ุงููุฑุงุกุฉ ูู ููู ููู ูุงุนุฏุฉ ุจูุงูุงุช.  ุชุจุฏุฃ ูุนุฌุฒุงุช ุงูุชูุงูููุฉ: ุฃูุช ูู ุงูุญุงูุฉ ุงูุฃูููุฉ ุ ูุชุทูุจ ูุฑุงุกุฉ ุงูููู ูุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ุซู ููููู ุงููุตูู ุฅูู ุญุงูุฉ ุชูุฌุฏ ูููุง ุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูููู ูุง ููุฌุฏ ููู ุ ุฃู ุงูุนูุณ - ููุงู ุจูุงูุงุช ูู ุงูููู ุ ูููู ููุณ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ุจุนุฏ ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุงูุฏุฎูู ูู ุญุงูุฉ ูููู ูุฏูู ูููุง ุฃุญุฏ ุฃูุฑูู.  ูุฑุฉ ุฃุฎุฑู ุ ูุฐู ุฏููุชุงู.  ุซู ุชุญุชุงุฌ ุฅูู ุงูุฐูุงุจ ุฅูู ุญุงูุฉ ุญูุซ ูุฏูู ูู ุงูููููุงุช.  ุซู ุงูุชุจูุง ุฅูู ุงูููุจุณ ูููู ุฌุฑุง. </p><br><p style=";text-align:right;direction:rtl">  ูููุง ูุงู ุงูุชุทุจูู ุฃูุซุฑ ุชุนููุฏูุง ุ ุฒุงุฏ ุนุฏุฏ ุงูุญุงูุงุช ุ ุฒุงุฏ ุนุฏุฏ ุฃุฌุฒุงุก ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุชู ูุฌุจ ุฏูุฌูุง ูู ุฑุฃุณู.  ุบูุฑ ูุฑูุญุฉ.  ุฃู ููุช ุชูุชุจ ุงูุดุนุฑูุฉ ุฑุฏ ุงูุงุชุตุงู ุ ููู ุบูุฑ ูุฑูุญ ูููุฑุงุกุฉ.  ุฅุฐุง ูุงู ูุธุงู ุงููุชูุฑุนุฉ ููุชูุจูุง ุ ูุญููุฆุฐู ูุฃุชู ููู ูุง ูู ูุนุฏ ุจุฅููุงูู ุชุญููู. </p><br><a name="section5"></a><br><h1 id="5-futurespromises" style=";text-align:right;direction:rtl">  5. ุงูุนููุฏ ุงูุขุฌูุฉ / ุงููุนูุฏ </h1><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f93/0ea/b0a/f930eab0a9a5556b0db5d21f23d98190.png"></p><br><p style=";text-align:right;direction:rtl">  ูุญู ุงููุดููุฉ ุ ุชุญุชุงุฌ ุฅูู ุงููุธุฑ ุฅูู ุงููููู ุจุดูู ุฃุณูู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/-v/6e/gb/-v6egbslm8_jjhwcsevjffbe35s.png"></p><br><p style=";text-align:right;direction:rtl">  ููุฌุฏ ุจุฑูุงูุฌ ุจู ุฏูุงุฆุฑ ุณูุฏุงุก ูุญูุฑุงุก.  ุชุฏูู ุงูุชูููุฐ ูุฏููุง ูู ุฏูุงุฆุฑ ุณูุฏุงุก.  ูู ุจุนุถ ุงูุฃุญูุงู ูุชูุงูุจูู ูุน ุงูููู ุงูุฃุญูุฑ ุนูุฏูุง ูุชุนุฐุฑ ุนูู ุงูุฏูู ููุงุตูุฉ ุนููู.  ุงููุดููุฉ ูู ุฃูู ุจุงููุณุจุฉ ูุฎูุท ุงูุชูููุฐ ุงูุฃุณูุฏ ุงูุฎุงุต ุจูุง ุ ูุฌุจ ุนููู ุงูุฏุฎูู ุฅูู ุงูุฏุงุฆุฑุฉ ุงูุณูุฏุงุก ุงูุชุงููุฉ ุ ูุงูุชู ูู ุชููู ูุนุฑููุฉ ูุชู. </p><br><p style=";text-align:right;direction:rtl">  ุงููุดููุฉ ูู ุฃูู ุนูุฏูุง ููุชุจ ุงูุดูุฑุฉ ุจูุบุฉ ุจุฑูุฌุฉ ุ ูุฅููุง ููุถุญ ููููุจููุชุฑ ูุง ูุฌุจ ุงูููุงู ุจู ุงูุขู.  ุงูููุจููุชุฑ ูู ุดูุก ุจุณูุท ูุณุจูุงู ููุชููุน ุงูุฅุฑุดุงุฏุงุช ุงูุชู ููุชุจูุง ุจูุบุฉ ุงูุจุฑูุฌุฉ.  ุฅููุง ุชูุชุธุฑ ุงูุชุนูููุงุช ููุฏุงุฆุฑุฉ ุงูุชุงููุฉ ุ ููู ูุบุชูุง ุงูุจุฑูุฌูุฉ ูุง ููุฌุฏ ูุง ูููู ูู ุงููุงู ููููู: "ูู ุงููุณุชูุจู ุ ูู ูุถูู ุ ุนูุฏูุง ูุญุฏุซ ุดูุก ูุง ุ ุงูุนู ุดูุฆูุง ูุง." </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/vp/8f/mx/vp8fmxhtnkukhqym-baw3g4mzyg.png"></p><br><p style=";text-align:right;direction:rtl">  ูู ูุบุฉ ุงูุจุฑูุฌุฉ ุ ูุนูู ุจุฅุฌุฑุงุกุงุช ูุญุธูุฉ ูููููุฉ: ุงุณุชุฏุนุงุก ุฏุงูุฉ ุ ุงูุนูููุงุช ุงูุญุณุงุจูุฉ ุ ุฅูุฎ.  ูุตููู ุงูุฎุทูุฉ ุงูุชุงููุฉ ุงูุชุงููุฉ ุงููุญุฏุฏุฉ.  ูู ุงูููุช ููุณู ุ ููุนุงูุฌุฉ ููุทู ุงูุชุทุจูู ุ ูู ุงูุถุฑูุฑู ุฃู ูุง ุชุตู ุงูุฎุทูุฉ ุงููุนููุฉ ุงูุชุงููุฉ ุ ูููู ุงูุฎุทูุฉ ุงูููุทููุฉ ุงูุชุงููุฉ: ูุงุฐุง ูุฌุจ ุฃู ููุนู ุนูุฏูุง ุชุธูุฑ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ุนูู ุณุจูู ุงููุซุงู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6m/by/ma/6mbyma_pagz74dx-j2ch1ixpxpg.png"></p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุจุนุถ ุงูุขููุฉ ููููุฉ ุงูุฌูุน ุจูู ูุฐู ุงูุดุธุงูุง.  ูู ุงูุญุงูุฉ ุงูุชู ูุชุจูุง ูููุง ุฑูุฒูุง ูุชุฒุงูููุง ุ ูููุง ุจุฅุฎูุงุก ุงูุณุคุงู ุจุงููุงูู ุฃุณูู ุงูุบุทุงุก ููููุง ุฅู ูุธุงู ุงูุชุดุบูู ุณูุชุนุงูู ูุนู ุ ููุณูุญ ูู ุจููุงุทุนุฉ ูุฅุนุงุฏุฉ ุฌุฏููุฉ ูุคุดุฑุงุช ุงูุชุฑุงุจุท ุงูุฎุงุตุฉ ุจูุง. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุณุชูู 1 ุ ุงูุชุชุญูุง ูุฑุจุน Pandora ุ ูุฌูุจ ุงููุซูุฑ ูู ุงูุชุจุฏูู ูุงูุญุงูุฉ ูุงูุธุฑูู ูุงููุฑูุน ุฅูู ุงูููุฏ.  ุฃุฑูุฏ ุจุนุถ ุงูุชูุงุฒูุงุช ุจุญูุซ ุชููู ุงูุดูุฑุฉ ูุงุจูุฉ ูููุฑุงุกุฉ ูุณุจููุง ุ ูููููุง ุชุญุชูุธ ุจุฌููุน ูุฒุงูุง ุงููุณุชูู 1. </p><br><p style=";text-align:right;direction:rtl">  ูุญุณู ุงูุญุธ ุจุงููุณุจุฉ ููุง ุ ูู ุนุงู 1988 ุ ุฃุฏุฑู ุงูุฃุดุฎุงุต ุงููุดุงุฑููู ูู ุงููุธู ุงูููุฒุนุฉ ุ ุจุงุฑุจุฑุง ููุณููู ูููุจุง ุดูุฑูุฑ ุ ุงููุดููุฉ ุ ูุชูุตููุง ุฅูู ุงูุญุงุฌุฉ ุฅูู ุชุบููุฑุงุช ูุบููุฉ.  ูู ุงูุถุฑูุฑู ุฅุถุงูุฉ ุชุตูููุงุช ุฅูู ูุบุฉ ุงูุจุฑูุฌุฉ ุงูุชู ุชุณูุญ ุจุงูุชุนุจูุฑ ุนู ุงูุนูุงูุงุช ุงูุฒูููุฉ ุจูู ุงูุฃุญุฏุงุซ - ูู ุงูููุช ุงูุญุงูู ูู ุงูููุช ููู ูุญุธุฉ ุบูุฑ ูุคูุฏุฉ ูู ุงููุณุชูุจู. </p><br><p style=";text-align:right;direction:rtl">  ูุชุณูู ูุฐู ุงููุนูุฏ.  ุงูููููู ุฑุงุฆุน ุ ูููู ูุฌูุน ุงูุบุจุงุฑ ุนูู ุงูุฑู ููุฏุฉ ุนุดุฑูู ุนุงููุง.       โ  ,   Twitter,      Ruby on Rails  Scala,     ,  ,      ,      future  .     Your Server as a Function.   ,        . </p><br><p style=";text-align:right;direction:rtl">   Scala,    , ++ ? </p><br><p style=";text-align:right;direction:rtl">    ,   Future.      T c  :       ,  -    . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class"> &lt;T&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">         ,    ,  ,     .   ,   ยซยป,  ,      .     Future     ยซยป,  Promise โ  ยซยป.        ;  ,  JavaScript, Promise โ      ,   Java โ   Future. </p><br><p style=";text-align:right;direction:rtl">   ,     .     ,       ,     boost::future ( std::future) โ      ,     . </p><br><a name="section5-1"></a><br><h2 id="51-interfeys-future--promise" style=";text-align:right;direction:rtl">  5.1.  Future &amp; Promise </h2><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> T&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">T* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TryGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Subscribe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::function&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp;)&gt; cb)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Then</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">:</span></span>:function&lt;R(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp;)&gt; f); <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Then</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">:</span></span>:function&lt;Future&lt;R&gt;(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp;)&gt; f); }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MakeFuture</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&amp; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">);</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  , ,  - ,      .  , ,      ,   . ,      ,       โ   ,   ,   .       Then,      . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Promise</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; value)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TrySet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T&amp; value)</span></span></span></span>; Future&lt;T&gt; ToFuture() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Promise</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NewPromise</span></span></span><span class="hljs-class">();</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   .      ,       .    ยซ, , ,      ยป. </p><br><a name="section5-2"></a><br><h2 id="52-kompoziciya-vychisleniy" style=";text-align:right;direction:rtl">  5.2.   </h2><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/676/e68/6b7/676e686b75c6875ba0a914567bc46839.png"></p><br><p style=";text-align:right;direction:rtl">    ?  ,         .  Then โ  ,      . </p><br><p style=";text-align:right;direction:rtl"> ,      โ future --,     -  t โ       .    , ,   ,        f,  -     r. </p><br><p style=";text-align:right;direction:rtl">          t     f.        ,  ,      r. </p><br><p style=";text-align:right;direction:rtl">   :    t,      ,   r      .       : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">template</span></span></span><span class="hljs-class"> &lt;class R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt;:</span></span>:Then(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::function&lt;R(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp;)&gt; f) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> promise = NewPromise&lt;R&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Subscribe([promise] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp; t) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> r = f(t); promise.Set(r); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> promise.ToFuture(); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>Promise</code>  <code>R</code> , </li><li style=";text-align:right;direction:rtl">    <code>Future&lt;T&gt;</code>    <code>t</code> , </li><li style=";text-align:right;direction:rtl">   ,    <code>r = f(t)</code> , </li><li style=";text-align:right;direction:rtl">  <code>r</code>   <code>Promise</code> , </li><li style=";text-align:right;direction:rtl">      <code>Promise</code> . </li></ul><br><p style=";text-align:right;direction:rtl">      <code>f</code> ,     <code>R</code> ,  <code>Future&lt;R&gt;</code> ,         <code>R</code> .  : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">          <code>T</code> , </li><li style=";text-align:right;direction:rtl">  ,     <code>T</code> ,  ,      <code>R</code> , </li><li style=";text-align:right;direction:rtl">     ,      <code>R</code> ,    ,        . </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">template</span></span></span><span class="hljs-class"> &lt;class R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;R&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt;:</span></span>:Then(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::function&lt;Future&lt;R&gt;(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp;)&gt; f) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> promise = NewPromise&lt;R&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Subscribe([promise] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp; t) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> that = f(t); that.Subscribe([promise] (R r) { promise.Set(r); }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> promise.ToFuture(); }</code> </pre> <br><p style=";text-align:right;direction:rtl">        ,   -    t.        f,        r,    .    ,       ,   . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/3c6/92f/064/3c692f06489d41c745a0d1b51085b278.png"></p><br><p style=";text-align:right;direction:rtl">    ,    Then   : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">   <code>Promise</code> , </li><li style=";text-align:right;direction:rtl">  <code>Subscribe</code>   -, </li><li style=";text-align:right;direction:rtl">  <code>Promise</code> ,   <code>Future</code> . </li></ul><br><p style=";text-align:right;direction:rtl">      ,       .    ,       ,    ,            . </p><br><p style=";text-align:right;direction:rtl">     ,   ,          ,     -.   ,  ,   -,   Subscribe.       ,    ,   ,  -  .   ,    . </p><br><a name="section5-3"></a><br><h2 id="53-primery" style=";text-align:right;direction:rtl">  5.3.  ุฃูุซูุฉ </h2><br><p style=";text-align:right;direction:rtl">       AsyncComputeValue,      GPU,        .   Then,    ,        (2v+1) <sup>2</sup> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; value = AsyncComputeValue(); <span class="hljs-comment"><span class="hljs-comment">//    value.Subscribe([] (int v) { std::cerr &lt;&lt; "Value is: " &lt;&lt; v &lt;&lt; std::endl; });</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">      .  ,    :   (2v+1) <sup>2</sup>       .       ,            . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  (2v+1)^2 Future&lt;int&gt; anotherValue = value .Then([] (int v) { return 2 * v; }) .Then([] (int u) { return u + 1; }) .Then([] (int w) { return w * w; });</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">     ,     ,       .       . </p><br><p style=";text-align:right;direction:rtl">  .   :   ,       ;       ;       . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; GetDbKey(); Future&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; LoadDbValue(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> key); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; SendToMars(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> message); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; ExploreOuterSpace() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetDbKey() <span class="hljs-comment"><span class="hljs-comment">// Future&lt;int&gt; .Then(&amp;LoadDbValue) // Future&lt;string&gt; .Then(&amp;SendToMars); // Future&lt;void&gt; } ExploreOuterSpace().Subscribe( [] () { std::cout &lt;&lt; "Mission Complete!" &lt;&lt; std::endl; });</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">         โ ExploreOuterSpace.           Then;    โ    โ    ,     .         ( ) .      . </p><br><a name="section5-4"></a><br><h2 id="54-any-kombinator" style=";text-align:right;direction:rtl">  5.4. Any- </h2><br><p style=";text-align:right;direction:rtl">  :     <code>Future</code>    ,       ,      . ,  ,          : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Any</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f2</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> promise = NewPromise&lt;T&gt;(); f1.Subscribe([promise] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp; t) { promise.TrySet(t); }); f2.Subscribe([promise] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp; t) { promise.TrySet(t); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> promise.ToFuture(); } <span class="hljs-comment"><span class="hljs-comment">//    </span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   ,      Any-,      Future  :   ,   .      ,    ,  . </p><br><p style=";text-align:right;direction:rtl">   ,  ,       ,     ,  ,    .      ยซ   DB1,    DB2,        โ  - ยป. </p><br><a name="section5-5"></a><br><h2 id="55-all-kombinator" style=";text-align:right;direction:rtl">  5.5. All- </h2><br><p style=";text-align:right;direction:rtl">    .                  ,       ,  ,     ( T1  T2),    T1  T2   ,        ,   . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T2</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;std::tuple&lt;T1, T2&gt;&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">All</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T1&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f1</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T2&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f2</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> promise = NewPromise&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::tuple&lt;T1, T2&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_shared&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::tuple&lt;T1, T2&gt; &gt;(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> counter = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_shared&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::atomic&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; &gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>); f1.Subscribe([promise, result, counter] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T1&amp; t1) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::get&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>&gt;(*result) = t1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (--(*counter) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { promise.Set(*result)); } }); f2.Subscribe([promise, result, counter] (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T2&amp; t2) { <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> promise.ToFuture(); } <span class="hljs-comment"><span class="hljs-comment">//    </span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    nginx.   ,      ,        .     nginx    ยซ ยป, ยซ  ยป, ยซ    ยป   .  All-         ,     .      . </p><br><a name="section5-6"></a><br><h2 id="56-adaptaciya-obratnogo-vyzova" style=";text-align:right;direction:rtl"> 5.6.    </h2><br><p style=";text-align:right;direction:rtl">   Future  Promises โ     legacy-,   .     callback-    ,     ,   :   Future,     ,   callback-  Future. </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   cb     void LegacyAsyncComputeStuff(std::function&lt;void(int)&gt; cb); //      Future Future&lt;int&gt; ModernAsyncComputeStuff() { auto promise = NewPromise&lt;int&gt;(); LegacyAsyncComputeStuff( [promise] (int value) { promise.Set(value); }); return promise.ToFuture(); }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> :      ,              Future  . </p><br><a name="section6"></a><br><h1 id="6-kak-sdelat-kod-chitaemee-s-pomoschyu-korutin" style=";text-align:right;direction:rtl"> 6.        </h1><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/19a/093/212/19a093212125673ff89cc4196c59583a.png"></p><br><p style=";text-align:right;direction:rtl">   ,     ,     .  . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">Future&lt;Request&gt; GetRequest(); Future&lt;Payload&gt; QueryBackend(Request req); Future&lt;Response&gt; HandlePayload(Payload pld); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; Reply(Request req, Response rsp); <span class="hljs-comment"><span class="hljs-comment">// req  2 :  QueryBackend   Reply GetRequest().Subscribe( [] (Request req) { auto rsp = QueryBackend(req) .Then(&amp;HandlePayload) .Then(Bind(&amp;Reply, req)); });</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">      .    Request,   -   .  ,     .  ,   ,        ,    .  ,   -      . </p><br><p style=";text-align:right;direction:rtl">  ,  ,     .  ?   โ  ,    request  payload,     โ  ,      . </p><br><p style=";text-align:right;direction:rtl"> ,   Java   Netty. ,      ,        .  ,        ,    . </p><br><p style=";text-align:right;direction:rtl">      ,    GetRequest, QueryBackend, HandlePayload   Reply   ,     Future. </p><br><p style=";text-align:right;direction:rtl">     ,   ,   Future   T โ   WaitFor. <br></p><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">Future&lt;Request&gt; GetRequest(); Future&lt;Payload&gt; QueryBackend(Request req); Future&lt;Response&gt; HandlePayload(Payload pld); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; Reply(Request req, Response rsp); <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaitFor</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">future</span></span></span><span class="hljs-class">);</span></span> <span class="hljs-comment"><span class="hljs-comment">// req  2 :  QueryBackend   Reply GetRequest().Subscribe( [] (Request req) { auto rsp = QueryBackend(req) .Then(&amp;HandlePayload) .Then(Bind(&amp;Reply, req)); });</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">Future&lt;Request&gt; GetRequest(); Future&lt;Payload&gt; QueryBackend(Request req); Future&lt;Response&gt; HandlePayload(Payload pld); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; Reply(Request req, Response rsp); <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaitFor</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">future</span></span></span><span class="hljs-class">);</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> req = WaitFor(GetRequest()); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pld = WaitFor(QueryBackend(req)); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rsp = WaitFor(HandlePayload(pld)); WaitFor(Reply(req, rsp));</code> </pre> <br><p style=";text-align:right;direction:rtl">   :    Future,    .    .         ,    .      . </p><br><p style=";text-align:right;direction:rtl">     .                    .     -  0,     ,  , mutex+cvar  future.        .          ,     . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/99d/f77/3e4/99df773e4d1922427ab7dc98fde28b8f.png"></p><br><a name="section6-1"></a><br><h2 id="61-korutiny" style=";text-align:right;direction:rtl">  6.1.  </h2><br><p style=";text-align:right;direction:rtl">  ,        .        ,  ,     ,   ,    - ,   .     ,    <i>-</i> . </p><br><p style=";text-align:right;direction:rtl">       โ ยซยป      ,  ,    .       .     .  : boost::asio  boost::fiber. </p><br><p style=";text-align:right;direction:rtl">         ,                .  ููู ููุนู ุฐููุ </p><br><a name="section6-2"></a><br><h2 id="62-chernovik-realizacii-waitfor" style=";text-align:right;direction:rtl">  6.2.   WaitFor </h2><br><p style=";text-align:right;direction:rtl">   , , boost::context,        :  ,   ;  ,              .    x86/64       ,       ,         . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      class MachineContext; //     from,    to void SwitchContext(MachineContext* from, MachineContext* to); //      โ boost::context //    // * x86_64-ASM (push...-movq(rsp,eip)-pop...-jmpq) // * makecontext/swapcontext // * setjmp/longjmp</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">      ,       goto:    ,     ,        ,   . </p><br><p style=";text-align:right;direction:rtl">      ,  -   .     Fiber โ   .       +Future.  ,      ,         Future,    . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fiber</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> MachineContext context_; Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; future_; };</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scheduler</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitFor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Future&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; future)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; MachineContext loop_context_; Fiber* current_fiber_; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">deque</span></span>&lt;Fiber*&gt; run_queue_; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  Future   ,     ,    ,     .    :   Loop,      ,    ,   ,        ,    . </p><br><p style=";text-align:right;direction:rtl">     WaitFor? </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">thread_local</span></span> Scheduler* ThisScheduler; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaitFor</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">future</span></span></span><span class="hljs-class">) {</span></span> ThisScheduler-&gt;WaitFor(future.As&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt;()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> future.Get(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Scheduler::WaitFor(Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; future) { current_fiber_-&gt;future_ = future; SwitchContext(ยคt_fiber_-&gt;context_, &amp;loop_context_); }</code> </pre> <br><p style=";text-align:right;direction:rtl">   :  ,   -   ,      ,      Future  void,        .           . </p><br><p style=";text-align:right;direction:rtl">  <code>Future&lt;void&gt;</code>   ,     ,    -  . </p><br><p style=";text-align:right;direction:rtl">   WaitFor    :   : ยซ     Fiber   Futureยป,        ( )       . </p><br><p style=";text-align:right;direction:rtl">  ,        : <br> <code>ThisScheduler-&gt;WaitFor</code>  <code>return future.Get()</code> ,         . </p><br><p style=";text-align:right;direction:rtl">      ?  ,       Future,      . </p><br><a name="section6-3"></a><br><h2 id="63-kak-ustroen-cikl-planirovaniya" style=";text-align:right;direction:rtl">  6.3.     </h2><br><p style=";text-align:right;direction:rtl">   -  , ,    ,     -     ,    .    SwitchContext   ,    2 โ       . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Scheduler::Loop() { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// (1)     (= !) current_fiber_ = run_queue_.front(); run_queue_.pop_front(); SwitchContext(&amp;loop_context_, ยคt_fiber_-&gt;context_); // (2) ,      //โฆ</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   ?   ,   ,    ,     Future,       Future, ,     ,           . </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Scheduler::Loop() { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// (1)     โฆ // (2) ,      if (current_fiber_-&gt;future_) { current_fiber_-&gt;future_.Subscribe( [this, fiber = current_fiber_] { fiber-&gt;future_ = nullptr; run_queue_.push_back(fiber); }); } //โฆ</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   ,      .       : </p><br><p style=";text-align:right;direction:rtl">     WaitFor โ   . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/_4/m8/ao/_4m8aoag2egfc2mzczah2xf6a9i.png"></p><br><p style=";text-align:right;direction:rtl">    Switch-    . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/sa/hg/kz/sahgkzqleux5-htiqo-58lb0gua.png"></p><br><p style=";text-align:right;direction:rtl">     Future    (  ),   ,         .   -               Fiber. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/hg/cm/gc/hgcmgclv5raicu_tlfywmw0yrpi.png"></p><br><p style=";text-align:right;direction:rtl">   WaitFor     Future ,     - , Future  .     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">Future&lt;Request&gt; GetRequest(); Future&lt;Payload&gt; QueryBackend(Request req); Future&lt;Response&gt; HandlePayload(Payload pld); Future&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; Reply(Request req, Response rsp); <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaitFor</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Future</span></span></span><span class="hljs-class">&lt;T&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">future</span></span></span><span class="hljs-class">);</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> req = WaitFor( GetRequest()); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pld = WaitFor( QueryBackend(req)); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rsp = WaitFor( HandlePayload(pld)); WaitFor( Reply(req, rsp));</code> </pre> <br><p style=";text-align:right;direction:rtl">    ,    ,      ,   .         ,    ,    . </p><br><a name="section6-4"></a><br><h2 id="64-coroutine-ts" style=";text-align:right;direction:rtl">  6.4. Coroutine TS </h2><br><p style=";text-align:right;direction:rtl">    ?   โ .   Coroutine TS,        ,  WaitFor  CoroutineWait,    CoroutineTS โ  -  .     ,         - . ,    Waiter  Co,     ,    . </p><br><a name="section7"></a><br><h1 id="7-chto-poluchili" style=";text-align:right;direction:rtl"> 7.  ? </h1><br><p style=";text-align:right;direction:rtl">   .           ,   ,    ,    .     ,       ,     ,    . </p><br><p style=";text-align:right;direction:rtl">     โ  .    ,                  .       .     ,     . ,         ,        ,         ,      . </p><br><p style=";text-align:right;direction:rtl">       -    ,        ,               .    ,  .      ,                ,          . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e02/3b7/924/e023b79240490a7b561152aa0972b3ac.png"></p><br><p style=";text-align:right;direction:rtl">         ,   ?    ,     . </p><br><p style=";text-align:right;direction:rtl">   .       ,     ,   ,  ,      .       .       ,     ,     ,    ,    . </p><br><p style=";text-align:right;direction:rtl">    nginx,  ,  ,  ,       ,    .        ,     ,  ,    future  promises. </p><br><p style=";text-align:right;direction:rtl">     ,       ,    ,     ,       ,      ,      ,      . </p><br><p style=";text-align:right;direction:rtl">       futures, promises  actors.    .             ,    . </p><br><p style=";text-align:right;direction:rtl"> :      , ,   ,     .               ,    , ,      ,   .     ? ,   . </p><br><blockquote style=";text-align:right;direction:rtl">  ุฏูููุฉ ูู ุงูุฅุนูุงูุงุช. 19-20      C++ Russia 2019.      , , Grimm Rainer    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ยซConcurrency and parallelism in C++17 and C++20/23ยป</a> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">   C++</a> .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> .  ,         ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">-</a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar446562/">https://habr.com/ru/post/ar446562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar446548/index.html">ุชุญููู ุงูุฅุญุตุงุกุงุช ุงููุชุนููุฉ ุจุงูุญููุงุช ุงูุฅุนูุงููุฉ - ุฅูุดุงุก ูููุงุณ ุฌุฏูุฏ ูู DataFrame (ุจูุซูู)</a></li>
<li><a href="../ar446552/index.html">ุงูุนูู ูุน ุฃูุงูุฑ APDU ุจุงุณุชุฎุฏุงู ูุซุงู EToken</a></li>
<li><a href="../ar446554/index.html">ุจุฑูุงูุฌ ุงููููู ูุงูุฏูุณ ุ ุฃู ููู ุฅูู ุงูููุงูุฉ ุงูุฎูููุฉ ูู ุฐูู ุงูุฎุจุฑุฉ ุชุตุจุญ ูููุฏุณ ML</a></li>
<li><a href="../ar446558/index.html">ููุงูู ุงูุจูุงูุงุช ุงูุบุฑูุจุฉ: ุชุนุฏูู ููุฑูู ุจุงุชุฑูุดูุง ุชุฑู</a></li>
<li><a href="../ar446560/index.html">"ุชุจุงุฏู ุงููุฌุงููุฉ": ุฌููุฑ ุงูุตุฑุงุน ุจูู ุงูุดุฑูุชูู ุงูุฃูุซุฑ ุดูุฑุฉ ูุชุฏูููู</a></li>
<li><a href="../ar446566/index.html">ูุดุฑูุน ุตูุฑ. ููู ุชุฑูุฏ ุฃูุงุฒูู ุงูุชุนุงูู ูุน ุงูููุชุฌุงุช ุงููููุฏุฉ</a></li>
<li><a href="../ar446568/index.html">ุชุญุฏูุซ Umbraco 8 ุนูู ูุทุงู ูุงุณุน ููุธุงู ุฅุฏุงุฑุฉ ุงููุญุชูู: ูุง ุงูุฌุฏูุฏ</a></li>
<li><a href="../ar446570/index.html">ูุตุฉ ุฃูู GPU: Rendition Vรฉritรฉ 1000</a></li>
<li><a href="../ar446572/index.html">Editor.js ูู ูุญุฑุฑ ููุชุงุฒ ูุญูุธ ุดูุฑุฉ ุงููุตุฏุฑ ุจุชูุณูู JSON</a></li>
<li><a href="../ar446576/index.html">ุงุณุชุจุฏุงู ุงููุงุฑุฏุงุช ุ ุฃู ููู ูุนูุช ุงููุฑูุญูุงุช ุงูุฑูุณูุฉ ุดูุก ุฎุงุทุฆ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>