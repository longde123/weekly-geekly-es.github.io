<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😝 🐳 👶🏾 Atenção para manequins e implementação em Keras 👨🏻‍🎤 🚿 🙎🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sobre artigos sobre inteligência artificial em russo 
 Apesar do mecanismo de atenção estar descrito na literatura inglesa, ainda não vi uma descrição...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Atenção para manequins e implementação em Keras</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458992/"><h2>  Sobre artigos sobre inteligência artificial em russo </h2><br>  Apesar do mecanismo de atenção estar descrito na literatura inglesa, ainda não vi uma descrição decente dessa tecnologia no setor de língua russa.  Existem muitos artigos sobre Inteligência Artificial (IA) em nosso idioma.  No entanto, os artigos encontrados revelam apenas os modelos mais simples de IA, por exemplo, redes de convolução, redes generativas.  No entanto, de acordo com os mais recentes desenvolvimentos de ponta no campo da IA, existem muito poucos artigos no setor de língua russa. <br><br><a name="habracut"></a>  A falta de artigos em russo sobre os últimos desenvolvimentos se tornou um problema para mim quando entrei no tópico, estudei o estado atual das coisas no campo da IA.  Eu sei inglês bem, leio artigos em inglês sobre tópicos de IA.  No entanto, quando um novo conceito ou um novo princípio de IA sai, seu entendimento em uma língua estrangeira é doloroso e longo.  Saber inglês, penetrar em um objeto não-nativo em um objeto complexo ainda vale muito mais tempo e esforço.  Depois de ler a descrição, você se pergunta: quantos por cento você entende?  Se houvesse um artigo em russo, eu entenderia 100% após a primeira leitura.  Isso aconteceu com redes generativas, para as quais há uma excelente série de artigos: depois de ler tudo ficou claro.  Mas no mundo das redes, existem muitas abordagens descritas apenas em inglês e que precisavam ser tratadas por dias. <br><br>  Escreverei periodicamente artigos em meu idioma nativo, trazendo conhecimento para o nosso campo de idioma.  Como você sabe, a melhor maneira de entender um tópico é explicá-lo a alguém.  Então, quem mais, além de eu, deveria começar uma série de artigos sobre a IA de arquitetura mais moderna, complexa e avançada.  No final do artigo, eu mesmo entenderei uma abordagem 100%, e será útil para alguém que lê e melhora sua compreensão (a propósito, eu amo Gesser, mas melhor ** Blanche de bruxelles **). <br><br>  Quando você entende o assunto, existem 4 níveis de entendimento: <br><br><ol><li>  você entende o princípio e as entradas e saídas do algoritmo / nível </li><li>  você entende as saídas de coleta e, em termos gerais, como funciona </li><li>  você entende tudo o que foi dito acima, bem como o dispositivo de cada nível de rede (por exemplo, no modelo VAE, você entendeu o princípio e também a essência do truque de reparameterização) </li><li>  Entendi tudo, incluindo todos os níveis, também entendi por que tudo aprende e, ao mesmo tempo, sou capaz de selecionar hiper parâmetros para minha tarefa, em vez de copiar e colar soluções prontas. </li></ol><br>  Para novas arquiteturas, a transição do nível 1 para o nível 4 é muitas vezes difícil: os autores enfatizam que estão mais próximos descrevendo superficialmente vários detalhes importantes (eles os entenderam?).  Ou seu cérebro não contém nenhuma construção, portanto, mesmo depois de ler a descrição, ele não decifrou e não se transformou em habilidades.  Isso acontece se durante os anos de estudante você dormiu na mesma lição de matemática, depois de uma festa noturna, onde deu o tapete certo.  aparelho.  E aqui precisamos de artigos em nossa língua nativa que revelem as nuances e sutilezas de cada operação. <br><br><h2>  Atenção conceito e aplicação </h2><br>  O exposto acima é um cenário de níveis de entendimento.  Para analisar Atenção, vamos começar no nível um.  Antes de descrever as entradas e saídas, analisaremos a essência: em que conceitos básicos, compreensíveis até para uma criança, esse conceito se baseia.  No artigo, usaremos o termo em inglês Atenção, pois, neste formulário, também é uma chamada para a função de biblioteca Keras (não é implementada diretamente nela, é necessário um módulo adicional, mas mais sobre isso abaixo).  Para ler mais, você deve entender as bibliotecas Keras e python, porque o código-fonte será fornecido. <br><br><img src="https://habrastorage.org/webt/lf/nv/-a/lfnv-ayy8tlpfgkiwcrgiinkme4.png" align="right">  Atenção traduz do inglês como "atenção".  Esse termo descreve corretamente a essência da abordagem: se você é motorista e o general da polícia de trânsito é mostrado na foto, você atribui importância a ela de forma intuitiva, independentemente do contexto da foto.  É provável que você dê uma olhada mais de perto no general.  Você força os olhos, olha atentamente as tiras dos ombros: quantas estrelas ele tem lá especificamente.  Se o general não for muito alto, ignore-o.  Caso contrário, considere-o como um fator-chave na tomada de decisões.  É assim que nosso cérebro funciona.  Na cultura russa, fomos treinados por gerações para prestar atenção a altos escalões; nosso cérebro automaticamente atribui alta prioridade a esses objetos. <br><br>  Atenção é uma maneira de informar à rede o que você deve prestar mais atenção, ou seja, relatar a probabilidade de um resultado específico, dependendo do estado dos neurônios e dos dados de entrada.  A camada de atenção implementada no próprio Keras identifica fatores com base no conjunto de treinamento, cuja atenção reduz o erro de rede.  A identificação de fatores importantes é realizada através do método de propagação reversa de erros, semelhante à maneira como isso é feito para redes de convolução. <br><br>  No treinamento, a Atenção demonstra sua natureza probabilística.  O mecanismo em si forma uma matriz de escalas de importância.  Se não tivéssemos treinado a Atenção, poderíamos ter dado importância, por exemplo, empiricamente (o general é mais importante que o alferes).  Mas quando treinamos uma rede em dados, a importância se torna uma função da probabilidade de um resultado específico, dependendo dos dados recebidos na entrada da rede.  Por exemplo, se encontrássemos um morador em geral na Rússia czarista, a probabilidade de conseguir manoplas seria alta.  Tendo verificado isso, seria possível através de várias reuniões pessoais, coletando estatísticas.  Depois disso, nosso cérebro colocará o peso apropriado no fato de conhecer esse assunto e colocará marcadores nas tiras e listras nos ombros.  Deve-se notar que o marcador definido não é provável: agora a reunião do general acarretará consequências completamente diferentes para você do que então; além disso, o peso pode ser mais do que um.  Mas, o peso pode ser reduzido à probabilidade normalizando-o. <br><br>  A natureza probabilística do mecanismo Atenção na aprendizagem se manifesta nas tarefas de tradução automática.  Por exemplo, informe à rede que, ao traduzir do russo para o inglês, a palavra Amor é traduzida em 90% dos casos como Amor, em 9% dos casos como Sexo, em 1% dos casos.  A rede marca imediatamente muitas opções, mostrando a melhor qualidade de treinamento.  Ao traduzir, dizemos à rede: "ao traduzir a palavra amor, preste atenção especial à palavra inglesa Amor, veja também se ainda pode ser Sexo". <br><br>  A abordagem Atenção é aplicada ao trabalho com texto, bem como a séries de sons e temporais.  Para o processamento de texto, redes neurais recorrentes (RNN, LSTM, GRU) são amplamente utilizadas.  A atenção pode complementá-los ou substituí-los, movendo a rede para arquiteturas mais simples e rápidas. <br><br>  Um dos usos mais famosos do Attention é usá-lo para abandonar a rede de recorrências e mudar para um modelo totalmente conectado.  As redes recorrentes têm uma série de deficiências: a incapacidade de fornecer treinamento sobre a GPU, reciclagem rápida.  Usando o mecanismo Atenção, podemos construir uma rede capaz de aprender seqüências com base em uma rede totalmente conectada, treiná-la na GPU, usar droput. <br><br>  A atenção é amplamente usada para melhorar o desempenho das redes de recorrência, por exemplo, no campo da tradução de um idioma para outro.  Ao usar a abordagem de codificação / decodificação, que é frequentemente usada na IA moderna (por exemplo, auto-codificadores variacionais).  Quando uma camada de atenção é adicionada entre o codificador e o decodificador, o resultado da operação de rede melhora visivelmente. <br><br>  Neste artigo, não cito arquiteturas de rede específicas usando Atenção; este será o assunto de um trabalho separado.  Uma lista de todos os usos possíveis da atenção vale um artigo separado. <br><br><h2>  Implementando Atenção em Keras Out of the Box </h2><br>  Quando você entende que tipo de abordagem, é muito útil aprender o princípio básico.  Mas, muitas vezes, o entendimento completo ocorre apenas olhando para uma implementação técnica.  Você vê os fluxos de dados que compõem a função da operação, fica claro o que exatamente é calculado.  Mas primeiro você precisa executá-lo e escrever "Atenção, olá, palavra". <br><br>  Atualmente, a atenção não é implementada no próprio Keras.  Mas já existem implementações de terceiros, como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">kera-atenção,</a> que pode ser instalado com o github.  Então seu código se tornará extremamente simples: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> attention_keras.layers.attention <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AttentionLayer attn_layer = AttentionLayer(name=<span class="hljs-string"><span class="hljs-string">'attention_layer'</span></span>) attn_out, attn_states = attn_layer([encoder_outputs, decoder_outputs])</code> </pre> <br>  Esta implementação suporta a função de visualização da escala de atenção.  Após treinar a Atenção, você pode obter uma sinalização matricial, que, de acordo com a rede, é especialmente importante sobre esse tipo (foto do github na página da biblioteca de atenção-keras). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ju/hr/yj/juhryjvb8eedahp2h77q07p_pwm.png"></div><br>  Basicamente, você não precisa de mais nada: inclua esse código na sua rede como um dos níveis e aproveite para aprender sua rede.  Qualquer rede, qualquer algoritmo é projetado nos primeiros estágios em um nível conceitual (como o banco de dados, a propósito), após o qual a implementação é especificada em uma representação lógica e física antes da implementação.  Esse método de design ainda não foi desenvolvido para redes neurais (ah, sim, esse será o tópico do meu próximo artigo).  Você não entende como as camadas de convolução funcionam por dentro?  O princípio é descrito, você os usa. <br><br><h2>  Keras implementação de Atenção baixa </h2><br>  Para finalmente entender o tópico, analisaremos detalhadamente abaixo a implementação do Attention under the hood.  O conceito é bom, mas como exatamente funciona e por que o resultado é obtido exatamente como indicado? <br><br>  A implementação mais simples do mecanismo de atenção no Keras leva apenas 3 linhas: <br><br><pre> <code class="python hljs">inputs = Input(shape=(input_dims,)) attention_probs = Dense(input_dims, activation=<span class="hljs-string"><span class="hljs-string">'softmax'</span></span>, name=<span class="hljs-string"><span class="hljs-string">'attention_probs'</span></span>)(inputs) attention_mul = merge([inputs, attention_probs], output_shape=<span class="hljs-number"><span class="hljs-number">32</span></span>, name=<span class="hljs-string"><span class="hljs-string">'attention_mul'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'mul'</span></span></code> </pre><br>  Nesse caso, a camada de entrada é declarada na primeira linha e, em seguida, vem uma camada totalmente conectada com a função de ativação softmax com o número de neurônios igual ao número de elementos na primeira camada.  A terceira camada multiplica o resultado da camada totalmente conectada pelo elemento de dados de entrada por elemento. <br><br>  Abaixo está toda a classe Attention, que implementa um mecanismo de auto-atenção um pouco mais complexo, que pode ser usado como um nível completo no modelo; a classe herda a classe da camada Keras. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Attention class Attention(Layer): def __init__(self, step_dim, W_regularizer=None, b_regularizer=None, W_constraint=None, b_constraint=None, bias=True, **kwargs): self.supports_masking = True self.init = initializers.get('glorot_uniform') self.W_regularizer = regularizers.get(W_regularizer) self.b_regularizer = regularizers.get(b_regularizer) self.W_constraint = constraints.get(W_constraint) self.b_constraint = constraints.get(b_constraint) self.bias = bias self.step_dim = step_dim self.features_dim = 0 super(Attention, self).__init__(**kwargs) def build(self, input_shape): assert len(input_shape) == 3 self.W = self.add_weight((input_shape[-1],), initializer=self.init, name='{}_W'.format(self.name), regularizer=self.W_regularizer, constraint=self.W_constraint) self.features_dim = input_shape[-1] if self.bias: self.b = self.add_weight((input_shape[1],), initializer='zero', name='{}_b'.format(self.name), regularizer=self.b_regularizer, constraint=self.b_constraint) else: self.b = None self.built = True def compute_mask(self, input, input_mask=None): return None def call(self, x, mask=None): features_dim = self.features_dim step_dim = self.step_dim eij = K.reshape(K.dot(K.reshape(x, (-1, features_dim)), K.reshape(self.W, (features_dim, 1))), (-1, step_dim)) if self.bias: eij += self.b eij = K.tanh(eij) a = K.exp(eij) if mask is not None: a *= K.cast(mask, K.floatx()) a /= K.cast(K.sum(a, axis=1, keepdims=True) + K.epsilon(), K.floatx()) a = K.expand_dims(a) weighted_input = x * a return K.sum(weighted_input, axis=1) def compute_output_shape(self, input_shape): return input_shape[0], self.features_dim</span></span></code> </pre><br>  Aqui vemos aproximadamente a mesma coisa que foi implementada acima através de uma camada Keras totalmente conectada, realizada apenas através de uma lógica mais profunda em um nível inferior.  Um nível paramétrico (self.W) é criado na função, que é multiplicada escalarmente (K.dot) pelo vetor de entrada.  A lógica com fio dessa variante é um pouco mais complicada: deslocamento (se o parâmetro de viés é divulgado), tangente hiperbólica, exposição, máscara (se especificada), normalização são aplicadas ao vetor de entrada vezes self.W, então o vetor de entrada é ponderado novamente por o resultado obtido.  Não tenho descrição da lógica estabelecida neste exemplo; reproduzo as operações de leitura do código.  A propósito, escreva nos comentários se reconhecer algum tipo de função matemática de alto nível nessa lógica. <br><br>  A classe possui um parâmetro "viés", isto é,  preconceito.  Se o parâmetro estiver ativado, depois de aplicar a camada Densa, o vetor final será adicionado ao vetor dos parâmetros da camada "self.b", o que permitirá não apenas determinar os "pesos" para a nossa função de atenção, mas também mudar o nível de atenção por um número.  Exemplo de vida: temos medo de fantasmas, mas nunca os encontramos.  Assim, fazemos uma correção para o medo -100 pontos.  Ou seja, somente se o medo diminuir de 100 pontos, tomaremos decisões sobre a proteção contra fantasmas, ligando para uma agência de captura de fantasmas, comprando dispositivos repelentes etc. <br><br><h2>  Conclusão </h2><br>  O mecanismo de atenção possui variações.  A opção mais simples de atenção implementada na classe acima é chamada de auto-atenção.  A atenção pessoal é um mecanismo projetado para processar dados seqüenciais, levando em consideração o contexto de cada registro de data e hora.  É usado com mais frequência para trabalhar com informações de texto.  A implementação da atenção pessoal pode ser retirada da caixa importando a biblioteca de atenção pessoal do keras.  Existem outras variações de atenção.  Estudando materiais em inglês, foi possível contar mais de 5 variações. <br><br>  Ao escrever este artigo relativamente curto, estudei mais de 10 artigos em inglês.  Obviamente, não consegui baixar todos os dados de todos esses artigos em cinco páginas; fiz apenas um aperto para criar um "guia para manequins".  Para entender todas as nuances do mecanismo Atenção, você precisa de um livro das páginas 150-200.  Eu realmente espero que eu tenha sido capaz de revelar a essência básica desse mecanismo, para que aqueles que estão começando a entender o aprendizado de máquina entendam como tudo isso funciona. <br><br><h2>  Fontes </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mecanismo de atenção em redes neurais com Keras</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atenção em redes profundas com Keras</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sequência-sequência-baseada na atenção em Keras</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Classificação de texto usando o mecanismo de atenção em Keras</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atenção Pervasiva: Redes Neurais Convolucionais 2D para Previsão de Sequência a Sequência</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como implementar a camada de atenção no Keras?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atenção?</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atenção!</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tradução automática neural com atenção</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt458992/">https://habr.com/ru/post/pt458992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt458982/index.html">Nginx Recipes: Convertendo de HTML e URLs para PDF e PS</a></li>
<li><a href="../pt458984/index.html">Como criar o primeiro aplicativo para negociação na bolsa: 3 etapas iniciais</a></li>
<li><a href="../pt458986/index.html">Receitas do PostgreSQL: Convertendo de HTML e URLs para PDF e PS</a></li>
<li><a href="../pt458988/index.html">Texturização ou o que você precisa saber para se tornar um Artista de Superfície. Parte 4. Modelos, normais e varredura</a></li>
<li><a href="../pt458990/index.html">Pare de zeloso com comentários no código</a></li>
<li><a href="../pt458994/index.html">Raspberry Pi + CentOS = Ponto de acesso Wi-Fi (ou Raspberry Router em um Red Hat)</a></li>
<li><a href="../pt458996/index.html">Usuário Inyerface - como não atormentar o usuário</a></li>
<li><a href="../pt459000/index.html">Como eu tentei melhorar o Halo 2, mas quase arruinei</a></li>
<li><a href="../pt459002/index.html">Como configurar o HTTPS - SSL Configuration Generator ajudará</a></li>
<li><a href="../pt459004/index.html">Algoritmo criptográfico Grasshopper: praticamente o complexo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>