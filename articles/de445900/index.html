<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛩️ 👨🏻‍💻 👸 So halten Sie erhöhten Systemlasten stand: Sprechen Sie über umfangreiche Vorbereitungen für den Black Friday 👨‍🔧 👩🏽‍✈️ ♋️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! 

 Im Jahr 2017, während des Black Friday, stieg die Auslastung fast eineinhalb Mal an, und unsere Server waren an den Grenzen der Möglich...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So halten Sie erhöhten Systemlasten stand: Sprechen Sie über umfangreiche Vorbereitungen für den Black Friday</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/retailrocket/blog/445900/">  Hallo Habr! <br><br>  Im Jahr 2017, während des Black Friday, stieg die Auslastung fast eineinhalb Mal an, und unsere Server waren an den Grenzen der Möglichkeiten.  Im Laufe des Jahres ist die Anzahl der Kunden erheblich gestiegen, und es wurde deutlich, dass die Plattform ohne eine gründliche Vorbereitung möglicherweise den Belastungen von 2018 einfach nicht standhält. <br><br>  Das Ziel war das ehrgeizigste von allen: Wir wollten auf alle, auch die mächtigsten, Aktivitätsschübe vollständig vorbereitet sein und begannen im Laufe des Jahres, neue Kapazitäten im Voraus abzubauen. <br><br>  Unser CTO Andrei Chizh ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">chizh_andrey</a> ) erzählt, wie wir uns auf den Black Friday 2018 vorbereitet haben, welche Maßnahmen wir ergriffen haben, um Stürze zu vermeiden, und natürlich die Ergebnisse dieser sorgfältigen Vorbereitung. <br><br><img src="https://habrastorage.org/webt/nv/pg/sq/nvpgsqdi4auhsvdmclno1upgvju.jpeg"><br><a name="habracut"></a><br>  Heute möchte ich über die Vorbereitungen für den Black Friday 2018 sprechen. Warum jetzt, wenn die meisten Hauptverkäufe zurückliegen?  Wir begannen ungefähr ein Jahr vor Großveranstaltungen mit der Vorbereitung und fanden durch Versuch und Irrtum die optimale Lösung.  Wir empfehlen, dass Sie sich im Voraus um die heißen Jahreszeiten kümmern und die Fakaps vermeiden, die im ungünstigsten Moment auftreten können. <br>  Das Material wird für alle nützlich sein, die den maximalen Gewinn aus solchen Aktien herausholen möchten, wie z  Die technische Seite des Problems ist der Marketing-Seite nicht unterlegen. <br><br><h2>  Merkmale des Verkehrs bei großen Verkäufen </h2><br>  Entgegen der landläufigen Meinung ist der Schwarze Freitag nicht nur ein Tag im Jahr, sondern fast eine ganze Woche: Die ersten Rabattangebote kommen 7-8 Tage vor dem Verkauf an.  Der Website-Verkehr beginnt die ganze Woche über reibungslos zu wachsen, erreicht am Freitag seinen Höhepunkt und fällt am Samstag ziemlich stark auf reguläre Store-Indikatoren ab. <br><br><img src="https://habrastorage.org/webt/fp/gg/zh/fpggzhkt6td7vbzkbmw7k5ljo6u.jpeg"><br><br>  Dies ist wichtig zu beachten: Online-Shops reagieren besonders empfindlich auf „Verlangsamungen“ im System.  Darüber hinaus verzeichnete unser E-Mail-Newsletter einen deutlichen Anstieg der Anzahl der Sendungen. <br><br>  Es ist strategisch wichtig für uns, den Schwarzen Freitag ohne Stürze zu überstehen  Die wichtigste Funktionalität der Websites und Mailinglisten der Geschäfte hängt vom Betrieb der Plattform ab, nämlich: <br><br><ul><li>  Verfolgung und Ausgabe von Produktempfehlungen, </li><li>  Die Ausgabe verwandter Materialien (z. B. Bilddesign-Empfehlungsblöcke wie Pfeile, Logos, Symbole und andere visuelle Elemente), </li><li>  Ausgabe von Produktabbildern mit der richtigen Größe (zu diesem Zweck haben wir „ImageResizer“ - ein Subsystem, das ein Bild vom Server des Geschäfts herunterlädt, es auf die gewünschte Größe komprimiert und über Caching-Server Bilder mit der richtigen Größe für jedes Produkt in jedem Empfehlungsblock bereitstellt). </li></ul><br>  Tatsächlich stieg während des Black Friday 2019 die Auslastung des Dienstes um 40%, d.h.  Die Anzahl der Ereignisse, die das Retail Rocket-System auf Online-Shop-Websites überwacht und verarbeitet, ist von 5 auf 8.000 Anfragen pro Sekunde gestiegen.  Aufgrund der Tatsache, dass wir uns auf ernstere Belastungen vorbereiteten, kam es leicht zu einem solchen Anstieg. <br><br><img src="https://habrastorage.org/webt/hj/rf/yi/hjrfyizrdasmrzna_e2yv26s7x4.png"><br><br><h2>  Allgemeine Vorbereitung </h2><br><br>  Der Schwarze Freitag ist eine heiße Zeit für den gesamten Einzelhandel und insbesondere für den E-Commerce.  Die Anzahl der Benutzer und ihre Aktivitäten zu diesem Zeitpunkt nimmt zeitweise zu, sodass wir uns wie immer gründlich auf diese geschäftige Zeit vorbereitet haben.  Wir fügen die Tatsache hinzu, dass viele Online-Shops mit uns verbunden sind, nicht nur in Russland, sondern auch in Europa, wo der Hype viel höher ist, und dass die Leidenschaften schlechter sind als in der brasilianischen Serie.  Was muss getan werden, um vollständig auf erhöhte Lasten vorbereitet zu sein? <br><br><h3>  Arbeiten Sie mit Servern </h3><br>  Zunächst musste herausgefunden werden, was genau uns fehlt, um die Kapazität von Servern zu erhöhen.  Bereits im August haben wir begonnen, neue Server speziell für den Black Friday zu bestellen - insgesamt wurden 10 zusätzliche Maschinen hinzugefügt.  Im November waren sie bereits vollständig im Kampf. <br><br>  Gleichzeitig wurde ein Teil der Build-Maschinen für die Verwendung als Anwendungsserver neu installiert.  Wir haben sie sofort auf die Verwendung verschiedener Funktionen vorbereitet: sowohl für die Ausgabe von Empfehlungen als auch für den ImageResizer-Dienst, sodass jede von ihnen je nach Art der Last für eine dieser Rollen verwendet werden kann.  Im normalen Modus haben Anwendungs- und ImageResizer-Server klar definierte Funktionen: Die ersten sind an der Abgabe von Empfehlungen beteiligt, die zweiten stellen Bilder für Briefe und Empfehlungsblöcke auf der Website von Online-Shops bereit.  In Vorbereitung auf den Black Friday wurde beschlossen, alle Dual-Purpose-Server so einzurichten, dass der Datenverkehr je nach Art der Auslastung zwischen ihnen ausgeglichen wird. <br><br>  Dann haben wir zwei große Server für Kafka (Apache Kafka) hinzugefügt und einen Cluster von 5 leistungsstarken Maschinen erhalten.  Leider lief nicht alles so reibungslos, wie wir es uns gewünscht hätten: Während der Datensynchronisation nahmen zwei neue Maschinen die gesamte Breite des Netzwerkkanals ein, und wir mussten dringend herausfinden, wie der Add-Prozess schnell und sicher für die gesamte Infrastruktur ausgeführt werden kann.  Um dieses Problem zu beheben, mussten unsere Administratoren das Wochenende tapfer opfern. <br><br><h3>  Mit Daten arbeiten </h3><br>  Zusätzlich zu den Servern haben wir beschlossen, die Dateien zu optimieren, um das Laden zu erleichtern. Ein großer Schritt für uns war die Übersetzung statischer Dateien.  Alle statischen Dateien, die zuvor auf den Servern gehostet wurden, wurden in S3 + Cloudfront übernommen.  Sie wollten dies schon lange tun, da die Belastung des Servers nahe an den Grenzwerten lag und nun ein hervorragender Grund erschien. <br><br>  Eine Woche vor dem Black Friday haben wir die Caching-Zeit von Bildern auf 3 Tage erhöht, sodass im Falle eines Rückgangs von ImageResizer zuvor zwischengespeicherte Bilder von cdn abgerufen wurden.  Dadurch wurde auch die Belastung unserer Server verringert, da je länger das Image gespeichert ist, desto seltener Ressourcen für die Größenänderung aufgewendet werden müssen. <br><br>  Und zu guter Letzt: 5 Tage vor dem Black Friday wurde ein Moratorium für die Bereitstellung neuer Funktionen sowie für die Arbeit mit der Infrastruktur angekündigt - alle Aufmerksamkeit galt der Bewältigung erhöhter Belastungen. <br><br><h2>  Notfallpläne </h2><br>  Egal wie gut die Vorbereitung ist, Fakapy ist immer möglich.  Und wir haben 3 Reaktionspläne für mögliche kritische Situationen entwickelt: <br><br><ul><li>  Lastreduzierung </li><li>  Deaktivieren einiger Dienste, </li><li>  vollständige Abschaltung des Dienstes. </li></ul><br>  <b>Plan A: Lastreduzierung.</b>  Sollte beteiligt gewesen sein, wenn unsere Server aufgrund eines Lastanstiegs über akzeptable Antwortzeiten hinausgehen.  In diesem Fall haben wir Mechanismen vorbereitet, um die Last schrittweise zu reduzieren, indem ein Teil des Datenverkehrs auf Amazon-Server umgeschaltet wird, wodurch einfach alle Anfragen mit „200 OK“ beantwortet und eine leere Antwort gegeben werden.  Wir haben verstanden, dass dies eine Verschlechterung der Servicequalität darstellt, aber die Wahl zwischen der Tatsache, dass der Service überhaupt nicht funktioniert oder keine Empfehlungen für etwa 10% des Datenverkehrs enthält, ist offensichtlich. <br><br>  <b>Plan B: Dienste deaktivieren.</b>  Implizite teilweise Verschlechterung des Dienstes.  Reduzieren Sie beispielsweise die Geschwindigkeit der Berechnung persönlicher Empfehlungen, um einige Datenbanken und Kommunikationskanäle zu entladen.  Im normalen Modus werden Empfehlungen im Echtzeitmodus berechnet, wodurch für jeden Besucher eine Version des Online-Shops erstellt wird. Unter Bedingungen erhöhter Auslastung ermöglicht eine Verringerung der Geschwindigkeit jedoch, dass andere Kerndienste weiterarbeiten können. <br><br>  <b>Plan C: für Harmagedon.</b>  Wenn ein vollständiger Systemfehler auftritt, haben wir einen Plan erstellt, der uns sicher von den Kunden trennt.  Käufer sehen einfach keine Empfehlungen mehr, die Leistung eines Online-Shops wird nicht beeinträchtigt.  Dazu müssten wir unsere Integrationsdatei zurücksetzen, damit neue Benutzer nicht mehr mit dem Dienst interagieren.  Das heißt, wir würden die Arbeit unseres Hauptverfolgungscodes deaktivieren, der Dienst würde aufhören, Daten zu sammeln und Empfehlungen zu berechnen, und der Benutzer würde einfach eine Seite ohne Empfehlungsblöcke sehen.  Für alle, die zuvor die Integrationsdatei erhalten haben, haben wir die Option bereitgestellt, DNS-Einträge auf Amazon und einen 200-OK-Stub umzustellen. <br><br><h2>  Zusammenfassung </h2><br>  Wir haben die gesamte Last bewältigt, auch ohne zusätzliche Baumaschinen.  Und dank der Vorbereitungen brauchten wir keinen der entwickelten Reaktionspläne.  Aber all die geleistete Arbeit ist eine unschätzbare Erfahrung, die uns helfen wird, mit den unerwartetsten und größten Verkehrsströmen fertig zu werden. <br>  Wie im Jahr 2017 stieg die Auslastung des Dienstes um 40% und die Anzahl der Nutzer in Online-Shops für Black Friday um 60%.  Alle Schwierigkeiten und Fehler traten während der Vorbereitungszeit auf, was uns und unsere Kunden vor unvorhergesehenen Situationen bewahrte. <br><br>  Wie denkst du über Black Friday?  Wie bereite ich mich auf kritische Belastungen vor? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de445900/">https://habr.com/ru/post/de445900/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de445890/index.html">PyTest Neo</a></li>
<li><a href="../de445892/index.html">Theorie der großen und kleinen Explosionen</a></li>
<li><a href="../de445894/index.html">[Ischewsk und Perm, Ankündigung] Warm- und Transistor-Online-Sendung CodeFest X.</a></li>
<li><a href="../de445896/index.html">Warum Budget-3D-Scanner nicht für professionelle Aufgaben geeignet sind</a></li>
<li><a href="../de445898/index.html">Über neue Ideen, enge Ansichten und Mundpropaganda</a></li>
<li><a href="../de445904/index.html">Arten von Unendlichkeiten und Hirnstamm</a></li>
<li><a href="../de445906/index.html">Iss kein Aspirin</a></li>
<li><a href="../de445908/index.html">Golang und die Entwicklung der Datenbankinteraktion</a></li>
<li><a href="../de445910/index.html">Wie wir uns mit EF 6 MSSQL und PostgresSQL angefreundet haben</a></li>
<li><a href="../de445912/index.html">Hallo Habr, wir sind Advantech</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>