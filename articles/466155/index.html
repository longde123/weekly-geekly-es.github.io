<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßöüèø üëèüèø üë©üèæ‚Äçüç≥ Arquitectura y caracter√≠sticas de la red de datos de Tarantool üë©‚Äç‚ù§Ô∏è‚Äçüë© üíµ üõ¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En 2017, ganamos la competencia para el desarrollo del n√∫cleo de transacciones del negocio de inversi√≥n de Alfa Bank y comenzamos a trabajar (en HighL...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arquitectura y caracter√≠sticas de la red de datos de Tarantool</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/466155/"><img src="https://habrastorage.org/webt/v7/6-/di/v76-dikmo5ifekbsg35xutol68s.jpeg"><br><br>  En 2017, ganamos la competencia para el desarrollo del n√∫cleo de transacciones del negocio de inversi√≥n de Alfa Bank y comenzamos a trabajar (en HighLoad ++ 2018 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">,</a> Vladimir Drynkin, Jefe del n√∫cleo de transacciones del negocio de inversi√≥n de Alfa Bank, present√≥ un informe sobre el n√∫cleo del negocio de inversi√≥n).  Este sistema fue para agregar datos de transacciones de varias fuentes en varios formatos, llevar los datos a una forma unificada, guardarlos y proporcionarles acceso. <br><br>  En el proceso de desarrollo, el sistema evolucion√≥ y se volvi√≥ funcional, y en alg√∫n momento nos dimos cuenta de que est√°bamos cristalizando algo mucho m√°s que solo un software de aplicaci√≥n dise√±ado para resolver un rango de tareas estrictamente definido: obtuvimos un <b>sistema para construir aplicaciones distribuidas con almacenamiento persistente</b>  Nuestra experiencia form√≥ la base de un nuevo producto: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tarantool Data Grid</a> (TDG). <br><br>  Quiero hablar sobre la arquitectura TDG y las soluciones que surgieron durante el proceso de desarrollo, presentarles la funcionalidad b√°sica y mostrarles c√≥mo nuestro producto puede convertirse en la base para construir soluciones completas. <br><a name="habracut"></a><br>  Arquitect√≥nicamente, dividimos el sistema en <i>roles</i> separados, cada uno de los cuales es responsable de resolver un cierto rango de tareas.  Una instancia en ejecuci√≥n de una aplicaci√≥n implementa uno o m√°s tipos de roles.  Un cl√∫ster puede tener varios roles del mismo tipo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cdc/d63/482/cdcd634820cb3878bb338fcc6c5c5829.png"><br><br><h3>  Conector </h3><br>  Connector es responsable de la comunicaci√≥n con el mundo exterior;  su tarea es aceptar la solicitud, analizarla y, si tiene √©xito, enviar los datos para su procesamiento al procesador de entrada.  Admitimos los formatos HTTP, SOAP, Kafka, FIX.  La arquitectura le permite simplemente agregar soporte para nuevos formatos, el soporte de IBM MQ llegar√° pronto.  Si falla el an√°lisis de la solicitud, el conector devolver√° un error;  de lo contrario, responder√° que la solicitud se proces√≥ con √©xito, incluso si se produjo un error durante su procesamiento posterior.  Esto se hace a prop√≥sito, para trabajar con sistemas que no saben c√≥mo repetir solicitudes, o viceversa, hacerlo de manera demasiado agresiva.  Para no perder datos, se utiliza la cola de reparaci√≥n: el objeto ingresa primero y solo despu√©s de que se elimina el procesamiento exitoso.  El administrador puede recibir notificaciones sobre los objetos que quedan en la cola de reparaci√≥n y, despu√©s de eliminar un error de software o falla de hardware, intente nuevamente. <br><br><h3>  Procesador de entrada </h3><br>  El procesador de entrada clasifica los datos recibidos por caracter√≠sticas y llama a los manejadores adecuados.  Los controladores son c√≥digo Lua que se ejecuta en el sandbox, por lo que no pueden afectar el funcionamiento del sistema.  En esta etapa, los datos pueden reducirse a la forma deseada y, si es necesario, ejecutar un n√∫mero arbitrario de tareas que pueden implementar la l√≥gica necesaria.  Por ejemplo, en el producto MDM (Master Data Management) creado en Tarantool Data Grid, al agregar un nuevo usuario, ejecutamos una tarea separada para no ralentizar el procesamiento de la solicitud.  El entorno limitado admite solicitudes para leer, cambiar y agregar datos; le permite realizar alguna funci√≥n en todos los roles, como el almacenamiento y agregar el resultado (asignar / reducir). <br><br>  Los controladores se pueden describir en archivos: <br><br><pre><code class="lua hljs">sum.lua <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> x, y = <span class="hljs-built_in"><span class="hljs-built_in">unpack</span></span>(...) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y</code> </pre> <br>  Y luego, declarado en la configuraci√≥n: <br><br><pre> <code class="lua hljs">functions: sum: { __file: sum.lua }</code> </pre><br><blockquote>  ¬øPor qu√© lua?  Lua es un lenguaje muy simple.  Seg√∫n nuestra experiencia, un par de horas despu√©s de conocerlo, la gente comienza a escribir c√≥digo que resuelve su problema.  Y estos no son solo desarrolladores profesionales, sino, por ejemplo, analistas.  Adem√°s, gracias al compilador jit, Lua es muy r√°pido. </blockquote><br><h3>  Almacenamiento </h3><br>  El almacenamiento almacena datos persistentes.  Antes de guardar, los datos se validan para cumplir con el esquema de datos.  Para describir el esquema, utilizamos el formato extendido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apache Avro</a> .  Un ejemplo: <br><br><pre> <code class="lua hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"User"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"record"</span></span>, <span class="hljs-string"><span class="hljs-string">"logicalType"</span></span>: <span class="hljs-string"><span class="hljs-string">"Aggregate"</span></span>, <span class="hljs-string"><span class="hljs-string">"fields"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"first_name"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"last_name"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>} ], <span class="hljs-string"><span class="hljs-string">"indexes"</span></span>: [<span class="hljs-string"><span class="hljs-string">"id"</span></span>] }</code> </pre> <br>  En base a esta descripci√≥n, se generan autom√°ticamente DDL (Lenguaje de definici√≥n de datos) para Tarantula DBMS y el esquema <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GraphQL</a> para el acceso a datos. <br><br>  La replicaci√≥n de datos as√≠ncrona es compatible (planea agregar s√≠ncrona). <br><br><h3>  Procesador de salida </h3><br>  A veces es necesario notificar a los consumidores externos sobre la llegada de nuevos datos, para esto est√° el papel del procesador de salida.  Despu√©s de guardar los datos, pueden transferirse al controlador apropiado (por ejemplo, para llevarlos al formulario que el consumidor requiere) y luego transferirse al conector para su env√≠o.  La cola de reparaci√≥n tambi√©n se usa aqu√≠: si nadie ha aceptado el objeto, el administrador puede intentarlo m√°s tarde. <br><br><h3>  Escalamiento </h3><br>  Los roles del conector, el procesador de entrada y el procesador de salida no tienen estado, lo que nos permite escalar el sistema horizontalmente, simplemente agregando nuevas instancias de la aplicaci√≥n con el rol incluido del tipo deseado.  Para el escalado de almacenamiento horizontal, se utiliza un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enfoque</a> para la organizaci√≥n del cl√∫ster utilizando cubos virtuales.  Despu√©s de agregar un nuevo servidor, parte del grupo de servidores antiguos en segundo plano se mueve al nuevo servidor;  Esto sucede de manera transparente a los usuarios y no afecta el funcionamiento de todo el sistema. <br><br><h3>  Propiedades de datos </h3><br>  Los objetos pueden ser muy grandes y contener otros objetos.  Aseguramos la atomicidad de agregar y actualizar datos, guardando el objeto con todas las dependencias en un dep√≥sito virtual.  Esto elimina la "mancha" del objeto en varios servidores f√≠sicos. <br><br>  Se admite el control de versiones: cada actualizaci√≥n del objeto crea una nueva versi√≥n, y siempre podemos hacer un intervalo de tiempo y ver c√≥mo se ve√≠a el mundo en ese momento.  Para los datos que no necesitan un historial largo, podemos limitar la cantidad de versiones o incluso almacenar solo una, la √∫ltima, es decir, deshabilitar el control de versiones para un tipo determinado.  Tambi√©n puede limitar el historial por tiempo: por ejemplo, elimine todos los objetos de un tipo determinado de m√°s de 1 a√±o.  Tambi√©n se admite el archivado: podemos descargar objetos anteriores al tiempo especificado, liberando espacio en el cl√∫ster. <br><br><h3>  Las tareas </h3><br>  De las funciones interesantes, vale la pena se√±alar la capacidad de ejecutar tareas en un horario, a solicitud del usuario, o program√°ticamente desde el sandbox: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ca/c14/fcf/0cac14fcf839b96ebf4ca0b544c25f68.png"><br><br>  Aqu√≠ vemos otro rol: corredor.  Este rol no tiene estado y, si es necesario, se pueden agregar instancias de aplicaciones adicionales con este rol al cl√∫ster.  La responsabilidad del corredor es completar las tareas.  Como se dijo, la creaci√≥n de nuevas tareas desde el sandbox es posible;  se ponen en cola en el almacenamiento y luego se ejecutan en el corredor.  Este tipo de tarea se llama Job.  Tambi√©n tenemos un tipo de tarea llamada Tarea: son tareas definidas por el usuario que est√°n programadas para ejecutarse (utilizando la sintaxis cron) o bajo demanda.  Para ejecutar y rastrear tales tareas, tenemos un conveniente administrador de tareas.  Para que esta funcionalidad est√© disponible, debe habilitar la funci√≥n de planificador;  este rol tiene un estado, por lo tanto, no escala, lo que, sin embargo, no es obligatorio;  Sin embargo, ella, como todos los dem√°s roles, puede tener una r√©plica que comienza a funcionar si el maestro se niega de repente. <br><br><h3>  Registrador </h3><br>  Otro rol se llama registrador.  Recopila registros de todos los miembros del cl√∫ster y proporciona una interfaz para cargarlos y verlos a trav√©s de una interfaz web. <br><br><h3>  Servicios </h3><br>  Vale la pena mencionar que el sistema facilita la creaci√≥n de servicios.  En el archivo de configuraci√≥n, puede especificar qu√© solicitudes deben enviarse al controlador escrito por el usuario que se ejecuta en el entorno limitado.  En este controlador, puede, por ejemplo, ejecutar alg√∫n tipo de consulta anal√≠tica y devolver el resultado. <br><br>  El servicio se describe en el archivo de configuraci√≥n: <br><br><pre> <code class="lua hljs">services: sum: doc: <span class="hljs-string"><span class="hljs-string">"adds two numbers"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return_type</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">args</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span></code> </pre><br>  La API GraphQL se genera autom√°ticamente y el servicio est√° disponible para llamar: <br><br><pre> <code class="lua hljs">query { sum(x: <span class="hljs-number"><span class="hljs-number">1</span></span>, y: <span class="hljs-number"><span class="hljs-number">2</span></span>) }</code> </pre> <br>  Esto llamar√° al manejador de <code>sum</code> , que devolver√° el resultado: <br><br><pre> <code class="plaintext hljs">3</code> </pre><br><h3>  Perfil de consulta y m√©tricas </h3><br>  Para comprender el sistema y el perfil de consultas, implementamos soporte para el protocolo OpenTracing.  El sistema puede, bajo demanda, enviar informaci√≥n a herramientas que admiten este protocolo, por ejemplo, Zipkin, que le permitir√° comprender c√≥mo se ejecut√≥ la solicitud: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed3/43f/3a6/ed343f3a63b49ad49c41b603786eb72d.png"><br><br>  Naturalmente, el sistema proporciona m√©tricas internas que se pueden recopilar con Prometheus y visualizar con Grafana. <br><br><h3>  Implementar </h3><br>  Tarantool Data Grid se puede implementar desde paquetes o archivos RPM, utilizando la utilidad de la entrega o Ansible, tambi√©n hay soporte para Kubernetes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">operador de Tarantool Kubernetes</a> ). <br><br>  Una aplicaci√≥n que implementa l√≥gica de negocios (configuraci√≥n, controladores) se carga en el cl√∫ster de Tarantool Data Grid como un archivo a trav√©s de la interfaz de usuario o mediante un script a trav√©s de la API proporcionada por nosotros. <br><br><h3>  Ejemplos de aplicaci√≥n </h3><br>  ¬øQu√© aplicaciones puedo crear con Tarantool Data Grid?  De hecho, la mayor√≠a de las tareas comerciales est√°n relacionadas de alguna manera con el procesamiento del flujo de datos, el almacenamiento y el acceso a √©l.  Por lo tanto, si tiene grandes flujos de datos que deben almacenarse de forma segura y tener acceso a ellos, nuestro producto puede ahorrarle mucho tiempo en el desarrollo y centrarse en la l√≥gica de su negocio. <br><br>  Por ejemplo, queremos recopilar informaci√≥n sobre el mercado inmobiliario para posteriormente, por ejemplo, tener informaci√≥n sobre las mejores ofertas.  En este caso, distinguimos las siguientes tareas: <br><br><ol><li>  Robots que recopilan informaci√≥n de fuentes abiertas: estas ser√°n nuestras fuentes de datos.  Puede resolver este problema utilizando soluciones preparadas o escribiendo c√≥digo en cualquier idioma. <br></li><li>  A continuaci√≥n, Tarantool Data Grid aceptar√° y guardar√° los datos.  Si el formato de los datos de diferentes fuentes es diferente, puede escribir c√≥digo en el idioma Lua, lo que conducir√° a la conversi√≥n a un solo formato.  En la etapa de preprocesamiento, tambi√©n puede, por ejemplo, filtrar ofertas recurrentes o adem√°s actualizar informaci√≥n sobre agentes que operan en el mercado en la base de datos. <br></li><li>  Ahora ya tiene una soluci√≥n escalable en el cl√∫ster, que se puede llenar con datos y hacer muestras de datos.  Luego puede implementar una nueva funcionalidad, por ejemplo, escribir un servicio que consultar√° los datos y emitir√° la oferta m√°s rentable en un d√≠a; esto requerir√° algunas l√≠neas en el archivo de configuraci√≥n y un poco de c√≥digo Lua. <br></li></ol><br><h3>  Que sigue </h3><br>  Nuestra prioridad es aumentar la conveniencia de desarrollo con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tarantool Data Grid</a> .  Por ejemplo, este es un IDE con soporte para perfilar y depurar controladores de espacio aislado. <br><br>  Tambi√©n prestamos mucha atenci√≥n a los problemas de seguridad.  En este momento estamos aprobando la certificaci√≥n FSTEC Rusia para confirmar el alto nivel de seguridad y cumplir con los requisitos para la certificaci√≥n de productos de software utilizados en sistemas de informaci√≥n de datos personales y sistemas de informaci√≥n estatales. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/466155/">https://habr.com/ru/post/466155/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../466143/index.html">¬øC√≥mo hicimos el c√≥digo de cart√≥n o la versi√≥n Scratch del juego de mesa Golem Battle</a></li>
<li><a href="../466147/index.html">Administrador de visualizaci√≥n de datos reactivos. Introduccion</a></li>
<li><a href="../466149/index.html">Crear un s√≠mbolo de conector con texto "din√°mico" en OrCAD</a></li>
<li><a href="../466151/index.html">Investigaci√≥n: programas extra√±os en el registro de software dom√©stico</a></li>
<li><a href="../466153/index.html">Crear un documento de dise√±o de misi√≥n de juego narrativo usando el ejemplo de Last of Us</a></li>
<li><a href="../466157/index.html">Blockchain: ¬øqu√© debemos construir PoC?</a></li>
<li><a href="../466159/index.html">Por qu√© la velocidad es importante en un intercambio moderno y c√≥mo superar a los competidores: 3 formas pr√°cticas</a></li>
<li><a href="../466165/index.html">C√≥mo la inteligencia artificial ayuda a gestionar proyectos</a></li>
<li><a href="../466169/index.html">Oferta especial para estudiantes que trabajan de JetBrains</a></li>
<li><a href="../466171/index.html">Cinco razones para ir a JUG.EKB</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>