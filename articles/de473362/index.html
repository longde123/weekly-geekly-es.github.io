<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆚 🔋 🚣🏼 GSoC-Erfahrung: Wie zwei (drei) Schüler den CRIU-Code wirklich verbessert haben 😾 ↪️ 🧝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jedes Jahr veranstaltet Google das Google Summer of Code-Event, bei dem führende OpenSource-Projekte neue talentierte Entwickler unter den Studenten f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GSoC-Erfahrung: Wie zwei (drei) Schüler den CRIU-Code wirklich verbessert haben</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/virtuozzo/blog/473362/">  Jedes Jahr veranstaltet Google das Google Summer of Code-Event, bei dem führende OpenSource-Projekte neue talentierte Entwickler unter den Studenten finden.  Im Jahr 2019 gelang es unserem CRIU-Projekt nicht nur, die Qualifikationsrunde zu bestehen, sondern auch mehrere junge Entwickler gleichzeitig anzuziehen.  Warum all dies und wie die Arbeit an CRUI im Rahmen von GSoC weiterging - lesen Sie unter der Katze. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/109/de4/c31/109de4c31759545abe5fd1cd510484db.png" alt="Bild"><br><br><a name="habracut"></a><br><br>  Wir bei Virtuozzo haben ein kleines, aber bereits sehr beliebtes Projekt namens CRIU.  Dies ist ein ziemlich komplexes Systemdienstprogramm und eine Reihe von Kernel-Patches (die meisten davon wurden übrigens bereits in den Hauptkernelbaum aufgenommen), mit denen Sie beispielsweise die Live-Migration von Containern durchführen oder den Kernel aktualisieren können, ohne Anwendungen neu zu starten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5f4/ea0/8ed/5f4ea08edfc77cbbb9aad905a193f0d3.png" alt="Bild"><br><br>  Wir haben dieses Projekt bereits 2011 gestartet.  Und trotz der Tatsache, dass das Dienstprogramm anfangs viele Fragen aufwirft und einige seine Implementierung für unmöglich hielten, entwickelte sich CRIU allmählich zu einem ausgereiften Tool.  Bis heute haben es mehr als eineinhalb Hundert Mitarbeiter von mehreren Dutzend Unternehmen, darunter Giganten wie Google und IBM, geschafft, daran teilzunehmen.  Trotzdem geht die Suche nach neuen Mitgliedern weiter und dieses Jahr haben wir endlich Google Summer of Code (GSoC) erreicht. <br><br>  GSoC ist eine von Google gesponserte jährliche Veranstaltung, die darauf abzielt, Studenten für verschiedene OpenSource-Projekte zu gewinnen.  Einerseits versuchen Teams aus offenen Projekten, an der Veranstaltung teilzunehmen, andererseits Studenten, die zur Entwicklung der Community beitragen und ihre Professionalität bei realen Projekten unter Beweis stellen möchten. <br><br>  Um in das GSoC-Team einzutreten, müssen Sie eine Bewerbung mit der Projektbeschreibung, mehreren Themen, an denen die Schüler arbeiten können, und einer Liste sogenannter „Mentoren“ einreichen - aktive Teilnehmer am Projekt, die dem Schüler bei seiner schwierigen Arbeit helfen.  Die Studierenden müssen ein oder mehrere Projekte auswählen und ihre Lebensläufe an die Mentoren senden. <br><br>  In der Mitte des Schuljahres prüft Google die Anwendungen der Teams und wählt die Projekte aus, die teilnehmen werden. Kurz vor den Sommerferien wählen die Teams die Schüler aus, mit denen sie arbeiten möchten. Anschließend führt Google die endgültige Filterung durch und verteilt die Schüler nach den Teams.  Im Sommer beginnt die Arbeit, die drei Monate dauert.  Einmal alle 30 Tage reichen die Schüler Zwischenberichte ein, und ihre Mentoren bewerten die Ergebnisse und geben Empfehlungen für die Fortsetzung (oder Beendigung) der Arbeit. <br><br><h3>  Speicheroptimierung und Implementierung von Binärprotokollen <br></h3><br>  Ich gebe zu, dass 2019 nicht unser erster Versuch war, in die GSoC einzutreten.  Bis jetzt konnten wir noch keine Projekte von Google auswählen.  Aber wir haben nicht aufgegeben (im Allgemeinen ist es nicht schwierig, einen Antrag einzureichen), und schließlich hat alles geklappt - Google hat die Entwicklung unseres Projekts als wichtig erkannt und CRUI bei GSoC veröffentlicht. <br><br>  Wir hatten viele Themen für Studenten, eines schöner und komplexer.  Eine angenehme Überraschung war die Tatsache, dass es für jeden von ihnen in der Gemeinde Darsteller gab.  Es gab Leute, die die geäußerten Probleme kannten und bereit waren, als Mentor zu arbeiten.  In der Phase der Studenteneinreichung erhielten wir einen ganzen „Wettbewerb“ - 2 Studenten bewarben sich für jedes der Themen und fast alle hatten wunderbare Eingabedaten.  Die endgültige Auswahl ermöglichte es uns, zwei Studenten zu gewinnen, die Themen der Optimierung des Speichererhaltungscodes aus dem laufenden Prozess sowie der Implementierung von Binärprotokollen aufnahmen. <br><br>  Da CRIU ein System zur Migration von Live-Anwendungen ist, verfügt es über eine solche Betriebsart, wenn der vom Prozess verwendete Speicher parallel zum Prozess selbst gelesen und in Bilddateien geschrieben wird.  Wir nennen dies die „lebendige Herzoperation“ des Prozesses, weil er weiterhin funktioniert, ohne anzuhalten.  Vor der GSoC-Runde wurde der gesamte Speicher mithilfe des vmsplice-Systemaufrufs, der gleichzeitig Rauschen verursachte, in Pipes gezogen. Anschließend wurde der Prozess weiter ausgeführt, und CRIU speicherte diesen Speicher langsam in Dateien (oder in einen Netzwerkkanal, wenn es sich um eine Live-Migration handelte).  Im Prinzip ist dies ein funktionierender Ansatz, aber das Problem bestand darin, dass der in den Pipes befindliche Speicher effektiv gesperrt ist (mlock) und der Kernel ihn bei Bedarf nicht auf die Festplatte entladen kann (Swap-out). <br><br>  Aus architektonischer Sicht wollten wir die Pipes ersetzen, um den Speicher in kleinen Teilen durch Aufrufen von process_vm_readv zu kopieren.  Diese Innovation erschien vor nicht allzu langer Zeit im Linux-Kernel (dieser Aufruf hat übrigens einen Zwillingsbruder namens process_vm_writev).  Gleichzeitig können Sie damit beispielsweise die Arbeit des Dienstprogramms strace und der Debugger erheblich vereinfachen und beschleunigen, die im Speicher von Prozessen zum Lösen einiger anderer Aufgaben gespeichert werden können. <br><br>  Die Arbeit an der Optimierung wurde durch die Tatsache erschwert, dass der Code für die Arbeit mit dem Prozessspeicher einer der zentralen Codes im Dienstprogramm ist und daher absolut zuverlässig sein muss.  Jeder Fehler beim Speichern von Seiten kann dazu führen, dass der Prozess einen inkonsistenten Status seiner internen Objekte erhält (von denen CRIU natürlich nichts "weiß") und nach der Wiederherstellung ohne eindeutige Diagnose ausfällt. <br><br>  Die zweite Schwierigkeit dieser Entwicklung bestand darin, dass die Arbeit mit dem Speicher in fast allen CRIU-Funktionen enthalten ist.  Dies sind die üblichen Checkpoint-Wiederherstellungsverfahren. Dies sind die verschiedenen optimierten Versionen, z. B. Pre-Dump oder Lazy-Restore.  Einmal in der nächsten Berichtswoche hatten wir sogar vor, den Studenten aus dem Projekt zu „entlassen“, aber zum Glück haben wir dies nicht getan und jetzt haben wir die lang erwartete Optimierung in unserer Entwicklungsbranche. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b31/4a8/e69/b314a8e6945d365f2dbc1b4e73412ad8.png" alt="Bild"><br><br>  Die zweite Aufgabe im Rahmen der GSoC 2019 war die Entwicklung und Implementierung der sogenannten Binärprotokolle.  Hier ist die Sache: Wenn CRIU ausgeführt wird, schreibt das Dienstprogramm Nachrichten über seine Arbeit in die Datei (oder auf den Bildschirm, aber noch besser in die Datei).  Die Bedeutung dieser Beiträge ist enorm!  Wenn der Sicherungs- oder Wiederherstellungsvorgang aus irgendeinem Grund nicht mit Erfolg endet, besteht die einzige Möglichkeit, den Grund zu verstehen, darin, jeden Schritt so detailliert wie möglich zu analysieren. Dazu benötigen Sie Informationen zum Dienstprogramm.  Im Idealfall erfordern die Verfahren die detailliertesten Protokolle und Bilddateien, falls vorhanden.  In der Praxis sind solche Anforderungen schwer zu erfüllen. <br><br>  Um die detailliertesten Protokolle zu erhalten, bietet CRIU einen geeigneten Modus, den die überwiegende Mehrheit der Benutzer (und möglicherweise sogar alle) immer aktiviert.  Die Menge an Informationen, die criu dabei generiert, ist jedoch so groß, dass die Protokollierung selbst die Geschwindigkeit des Systems spürbar beeinflusst.  Eine kleine Untersuchung hat gezeigt, dass wir 90% unserer Zeit mit der Protokollierung von Ausgabeformatierungsvorgängen verbringen - das heißt mit den gleichen% d,% 08s,% .2f und anderen Modifikatoren der printf-Funktionsfamilie.  Durch Deaktivieren der Protokolle wird die Zeit zum Speichern und Wiederherstellen von Prozessen von 10 auf 30 Prozent reduziert, abhängig von der Größe der Prozesse selbst. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/035/8cc/429/0358cc42935b88b0792a1c693e84f7c6.png" alt="Bild"><br><br>  Um die Verwendung einer solchen Menge an Systemressourcen für die Protokollierung zu deaktivieren, die Protokolle jedoch so informativ wie möglich zu gestalten, haben wir beschlossen, die Formatierung zu entfernen und Binärdaten in Protokolldateien zu speichern.  Schließlich können Sie sie bei Bedarf später formatieren.  Der zweite Student hat diese Aufgabe gemeistert, deren Patches ebenfalls bereits in den Entwicklungszweig aufgenommen wurden. <br><br><h3>  Und das nicht nur bei GSoC <br></h3><br>  Eine weitere interessante Tatsache bei der Teilnahme an GSoC ist übrigens, dass ein dritter Student zu uns kam, der den Wunsch äußerte, das Problem der Anonymisierung zu lösen.  Schließlich ist es oft unmöglich, Bilddateien abzurufen, da sie geheime Informationen enthalten, die der Benutzer zu Recht nicht an Dritte weitergeben möchte - den Inhalt des Speichers, die Dateien, mit denen der Prozess arbeitet, den Inhalt der Warteschlangen in Netzwerkverbindungen usw.  Um dieses Problem zu lösen, haben wir in der Anwendung eine Funktion namens "Anonymisierung von Bildern" eingereicht, die jedoch von Google nicht akzeptiert wurde. <br><br>  Trotzdem hat das Thema nicht an Relevanz verloren, und der Student, der sich im Rahmen von GSoC damit befassen wollte, entschied sich letztendlich, außerhalb des Google-Events unabhängig an dem Thema zu arbeiten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/521/6c2/3cd/5216c23cdb38140d3997e8d928e03b86.png" alt="Bild"><br><br><h3>  Fazit <br></h3><br>  Es war natürlich eine positive Erfahrung, an GSoC teilzunehmen.  Unser CRIU-Tool, das wir lieben und schätzen, hat ein paar stärkere Entwicklungsimpulse erhalten und ist noch ausgereifter und praktischer geworden.  Also, für wen es nützlich sein kann, verwenden Sie es gerne! <br><br>  Andererseits waren wir davon überzeugt, dass die Frage der Teilnahme an solchen Veranstaltungen eine Frage der Beharrlichkeit und des Vertrauens in unser Projekt ist.  Wenn Sie Entwickler benötigen, werden Sie nicht müde, Bewerbungen einzureichen und neue, interessante Themen zu formulieren.  Möglicherweise finden Sie völlig unerwartete Mitwirkende aus einem anderen Land oder sogar aus einem anderen Unternehmen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473362/">https://habr.com/ru/post/de473362/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473348/index.html">Die Idee der Trägheit (SGDm), die Idee der Skalierung (Adagrad) und der Regularisierung beim maschinellen Lernen am Beispiel des Klassifizierungsproblems</a></li>
<li><a href="../de473350/index.html">Erstellen einer REST-API mit Node.js und einer Oracle-Datenbank. Teil 3</a></li>
<li><a href="../de473352/index.html">Aktuelle Sammlungen in 10 Minuten</a></li>
<li><a href="../de473354/index.html">Über die Kuriositäten der Habrostatistik</a></li>
<li><a href="../de473358/index.html">Installieren und konfigurieren Sie Nexus Sonatype mithilfe der Infrastruktur als Code-Ansatz</a></li>
<li><a href="../de473364/index.html">Es gibt einen Grundel, der schwingt: eine Checkliste für den E-Commerce in der Verkaufssaison</a></li>
<li><a href="../de473366/index.html">Was ist in meinem Smart-TV für Sie? Oder was kann in den Fernseher gesteckt werden?</a></li>
<li><a href="../de473368/index.html">MIRO ist eine offene Indoor-Roboterplattform. Teil 3 - Softwarekomponente: ESP8266</a></li>
<li><a href="../de473372/index.html">Erstellen eines einfachen Anrufverfolgungsdienstes, Teil 1</a></li>
<li><a href="../de473374/index.html">Wie wir YouTube Live mit Zoom integriert haben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>