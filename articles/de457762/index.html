<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèùÔ∏è üë©üèæ üßö CCD-Lineal: Womit es gegessen wird ‚õµÔ∏è ü§∑üèæ üñ≤Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel m√∂chte ich meine Erfahrungen mit der Verwendung eines linearen CCD-Fotodetektors vorstellen. Eine solche CCD-Linie kann beim Entwurf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CCD-Lineal: Womit es gegessen wird</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457762/"><img src="https://habrastorage.org/webt/6f/ss/-0/6fss-0mg8davzerthbljhhg9ora.jpeg"><br>  In diesem Artikel m√∂chte ich meine Erfahrungen mit der Verwendung eines linearen CCD-Fotodetektors vorstellen.  Eine solche CCD-Linie kann beim Entwurf eines provisorischen Spektrometers, eines Barcodelesers, eines Laserstrahl-Positions- oder Abweichungssensors, eines Scanners f√ºr Foto oder Film und vielem mehr verwendet werden.  In meinem Fall war es ein Laserscanner, den ich im Netzwerk nicht beschreiben kann. <br><a name="habracut"></a><br>  <b>Was ist ein ladungsgekoppeltes Ger√§t?</b> <br><br>  Wenn es um CCD geht, meinen sie meistens verschiedene Fotodetektoren.  Seltener sind dies Speichervorrichtungen: Schieberegister, Verz√∂gerungsleitungen.  Im Kern erinnert dieses Ger√§t etwas an den Speicher auf zylindrischen magnetischen Dom√§nen, nur auf Silizium - mit Hilfe einer Wanderwelle eines elektrischen Feldes, das von einem Elektrodensystem erzeugt wird, bewegen sich Klumpen von Ladungstr√§gern, die sich fr√ºher in ihm gebildet haben, durch den Halbleiter.  So erhalten wir ein Schieberegister, das eine extrem einfache Struktur aufweist und sich nicht nur eine Folge von digitalen Einheiten und Nullen, sondern auch ein analoges Signal merken kann. <br><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/webt/at/dl/gv/atdlgvfbnsok-t_geekshblchyo.gif"></div><br>  In den CCD-Bildempf√§ngern wird genau diese F√§higkeit dieser Struktur verwendet, um die unter jedem der Pixel der Struktur akkumulierten Ladungen sequentiell auszugeben.  Dar√ºber hinaus erzeugt dasselbe Gatesystem, das zum Bewegen der Ladungen w√§hrend der Belichtung verwendet wird, Potentialt√∂pfe, in denen sich diese Ladungen ansammeln (oder diese L√∂cher entstehen w√§hrend der Bildung der Struktur - √§hnlich den eingebauten und induzierten Kan√§len des MOS-Transistors).  Komplexere Strukturen umfassen ein Widerstandstor, entlang dessen eine glatte Potentialsteigung gebildet wird (so sind die Hamamatsu S11155 CCD-Leitungen angeordnet), sowie die Trennung von Ladungsakkumulations- und Ladungs√ºbertragungszonen - die akkumulierten Ladungen der gesamten Leitung werden zuerst auf die Pufferleitung √ºbertragen und anschlie√üend vorgeschoben Ausfahrt entlang der letzten. <br>  Die Einfachheit der internen Struktur f√ºhrt zu einer komplexen Verwaltung.  Selbst die einfachste Version der CCD-Leitung erfordert die Erzeugung eines zwei- oder dreiphasigen Signals komplexer Form mit unterschiedlichen Spannungspegeln mit steilen Kanten (mit einer hohen Eingangskapazit√§t von 1000 pF oder mehr), die relativ zueinander verschoben sind.  Lineale vom Typ Hamamatsu S11155 ben√∂tigen bis zu acht verschiedene Signale mit unterschiedlichen Hoch- und Niederspannungspegeln auf beiden Seiten von Null. <br>  Gl√ºcklicherweise haben einige Unternehmen (zum Beispiel Sony) eine Linie herausgebracht, in der all diese Komplexit√§t direkt auf dem Chip gebildet wird.  Und f√ºr ihre Arbeit m√ºssen Sie nur zwei Signale erzeugen: den sich √∂ffnenden elektronischen Verschluss f√ºr die Dauer der Belichtung und die Uhr.  In unserem Design ist dies genau die ILX554-Linie: Sie ist (in der Regel gebraucht, aber recht funktional) bei den Chinesen auf Aliexpress leicht zu kaufen. <br><br>  <b>Schauen wir uns das Datenblatt an</b> <br><br>  Und wir sehen, dass nur 6 der 22 Pins beteiligt sind. Dies sind + 5V-Stromversorgung, ROG- und CLK-Eingangssignale, Vout-Ausgangssignal, SHSW-Modus-Auswahleingang und Masse.  Und das ist alles. <br>  ROG ist die elektronische Verschlusssteuerung (und der Beginn der Ladungs√ºbertragung von der lichtempfindlichen Leitung zum direkten Schieberegister).  Er hat ein aktives Level - Null.  Um die Matrix freizulegen, muss sie auf Null gedr√ºckt und so lange wie n√∂tig gehalten werden - von 5 Œºs bis zu mehreren Sekunden.  Warten Sie dann beim Loslassen mindestens 3 Œºs (w√§hrend dieser Zeit funktioniert die Ladungs√ºbertragungsschaltung).  Die ganze Zeit am Eingang von CLK halten wir ein hohes Niveau.  Und dann k√∂nnen Sie die Zeile lesen und auf den CLK-Eingang einen M√§ander mit einer Frequenz von mehreren zehn Kilohertz bis 2 MHz anwenden.  In diesem Fall wird bei jeder Differenz von Eins zu Null das n√§chste Pixel zur Ausgabe verschoben.  Es gibt 2088 solcher Pixel in der Aufstellung, von denen 2048 lichtempfindlich arbeiten (in Wirklichkeit sind es mehrere, aber die √§u√üersten Pixel sind teilweise verdeckt).  Datashit empfiehlt, mindestens 2090 CLK-Impulse f√ºr einen korrekten Betrieb an die Matrix anzulegen. <br>  Und wie es gepusht wird, h√§ngt davon ab, was am Eingang von SHSW ist.  Wenn es sich um eine logische Einheit handelt, erzeugt der Ausgang ein ziemlich kompliziertes Signal: <br><div style="text-align:center;"><img width="50%" src="https://habrastorage.org/webt/dz/xq/qb/dzxqqbdg8vq_r_jgxg4gwek-6lg.gif"></div><br>  Wenn der CLK von Null auf Eins geht, tritt au√üerdem ein Zur√ºcksetzen auf, und von Eins auf Null wird ein Nutzsignal ausgegeben. <br>  Und bei Null am SHSW-Eingang wird die eingebaute Abtastspeicherschaltung eingeschaltet, was dieses Signal zu einem einfachen schrittweisen Videosignal vereinfacht, bei dem bei jedem neuen √úbergang von CLK zu Null der Signalpegel des n√§chsten Pixels einfach erscheint und f√ºr die gesamte Periode des CLK-Signals gehalten wird. <br>  Der n√ºtzliche Bereich des Ausgangssignals kommt von einem bestimmten Dunkelpegel, der laut Datenblatt 2,85 V betr√§gt, aber in Wirklichkeit kann er unterschiedlich sein (in meiner Leitung - ungef√§hr 3 V), und wenn er ges√§ttigt ist, f√§llt der Ausgangssignalpegel auf 1,5-2 B. B. <br>  Im Allgemeinen ist das alles, was wir √ºber diese Linie wissen m√ºssen. <br><br>  <b>Einschlussschaltung</b> <br><br><div style="text-align:center;"><img width="60%" src="https://habrastorage.org/webt/th/vo/xs/thvoxsmrevwageaehbzgex4j054.png"></div><br>  Es ist einfach und offensichtlich.  Wir erzeugen CLK- und ROG-Signale programmgesteuert mit MK, und Schmitt-Trigger am Eingang sind die einfachste M√∂glichkeit, von 3,3 V auf 5 V umzuschalten. Tatsache ist, dass diese Leitungen in den Leitungen keine Puffer enthalten und dass die Matrixschaltungen ordnungsgem√§√ü funktionieren Sie m√ºssen ihnen einen M√§ander mit einer vollen Skala von null bis f√ºnf Volt und einer guten Steilheit der Fronten vorlegen.  Die im Diagramm angegebenen NC7SZ14M5X sind sehr praktische einzelne Schmitt-Invertierungsausl√∂ser mit steilen Fronten und erh√∂hter Tragf√§higkeit, die ich h√§ufig in meinen Projekten verwende. <br>  Bei Verwendung von DA1 "beschleunigt" der Videosignalpegel aus der Aufstellung auf den Bereich, in dem der ADC arbeitet, w√§hrend der "Stand" von ungef√§hr 1,5 V, der dem S√§ttigungspegel entspricht, entfernt wird.  Da die Differenz zwischen der Signalamplitude und dem "Stand" -Wert zwischen verschiedenen CCD-Arrays stark variiert, sollten die Widerst√§nde R1 und R3 ausgew√§hlt werden, indem das Ausgangssignal in den erforderlichen Bereich "gelegt" wird.  Es sollte beachtet werden, dass nicht nur die Verschiebung, sondern auch die Verst√§rkung vom Widerstand R1 abh√§ngt. Sie m√ºssen ihn also zuerst ausw√§hlen. <br>  L1 und L2 sind Ferritperlen oder kleine Drosseln f√ºr 1-2 ŒºG der Baugr√∂√üe 0805 oder 0603. Widerst√§nde und Kondensatoren werden von gleicher Gr√∂√üe verwendet.  Die Schaltung wird durch Aufputzmontage auf einer doppelseitigen Platine montiert.  Ich bringe das Board-Layout nicht mit, da ich noch viele Dinge drauf habe. <br><br>  <b>Software-Implementierung auf MK</b> <br><br>  Die MK-Aufgabe besteht darin, ein ROG-Signal mit hohem Pegel zu erzeugen (Wechselrichter nicht vergessen!) Von der erforderlichen Dauer, dann eine kurze Pause (3-10 Œºs) und danach eine Folge von 2090 Impulsen mit hohem Pegel, die durch gleiche Pausen in der Dauer getrennt sind.  W√§hrend dieser Impulse (oder Pausen), einige Zeit nach der Vorderseite, wird der Pixelbeleuchtungswert unter Verwendung eines integrierten oder externen ADC gemessen.  Nach dem Lesen des Frames m√ºssen Sie auch bis zu einem neuen ROG-Impuls pausieren - die gleichen 3-10 Œºs.  Nach dem Einschalten der Stromversorgung und, wie sich herausstellte, nach einer langen (mehr als 100 ms) Nichtbenutzung des Lineals m√ºssen Sie es ‚Äûreinigen‚Äú, indem Sie ein paar Mal eine kostenlose Standardimpulsfolge an den CLK anlegen. <br>  Auf STM32 ist es ratsam, dies alles bei einem Timer-Interrupt zu tun.  Durch Einstellen des Timers zum Erzeugen von Interrupts mit einer Frequenz, die einer doppelten Pixelfrequenz entspricht, wird jede Timeroperation in einen Interrupt umgewandelt, in dem wir abwechselnd Null oder Eins an den Port ausgeben. Wenn wir Null ausgeben, lesen wir die Messwerte vom ADC.  Und nachdem wir 2090 Zyklen gez√§hlt haben, stoppen wir den Timer.  Um das n√§chste Bild zu lesen, m√ºssen Sie den Zyklusz√§hler auf Null zur√ºcksetzen, den Timer starten und warten, bis alles gez√§hlt ist. <br>  So etwas wie in diesen Codefragmenten gezeigt. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> clkState = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> frameOk = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> pixCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> ccdFrame[<span class="hljs-number"><span class="hljs-number">2090</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> uint16_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readADC1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//            { . . . } void Delay(unsigned int Val) //     { for( ; Val != 0; Val--) __NOP(); } void readCCD(void) //   - { pixCount = 0; //    frameOk = false; //   TIM_Cmd(TIM6, ENABLE); //   while(frameOk == false); // ,     } // ...    ... // void TIM6_IRQHandler(void) /*      -     CLK       */ { if (TIM_GetITStatus(TIM4, TIM_IT_Update) != RESET) { if(clkState == true) //   (.0)      { clkState = false; GPIOB-&gt;ODR &amp;= ~GPIO_ODR_ODR_1; //      Delay(3); //  ,        ccdFrame[pixCount] = readADC1(); } else //   (.1) { pixCount++; clkState = true; GPIOB-&gt;ODR |= GPIO_ODR_ODR_1; //      } if(pixCount &gt;= 2090) //    ,      { pixCount = 0; frameOk = true; TIM_Cmd(TIM6, DISABLE); } TIM_ClearITPendingBit(TIM4, TIM_IT_Update); } }</span></span></span></span></code> </pre> <br><br>  <b>Und hier ist das Ergebnis</b> <br>  Das Ergebnis ist nicht schlecht.  Trotz der Tatsache, dass der eingebaute ADC keine Eigenschaften aufweist, entsprechen seine Rauscheigenschaften vollst√§ndig dem Rauschen der CCD-Leitung.  Die Amplitude des Rauschpfades des dunklen Signals mit einer Akkumulationszeit von etwa 1 ms betr√§gt ~ 3-4 Quantisierungspegel, und bei Verwendung eines externen 14-Bit-ADC mit hervorragenden Eigenschaften sind die Ergebnisse nur geringf√ºgig besser.  Mit zunehmender Beleuchtung nimmt das Rauschen aus einem einfachen Grund zu: Die Anzahl der Photoelektronen in jedem der Pixel ist nicht so gro√ü (nach meinen Berechnungen etwa 30.000 bei S√§ttigung).  F√ºr die besten Ger√§te erreicht dieser Wert 200.000. <br>  In der folgenden Tabelle sehen Sie ein Beispiel f√ºr ein vom Lineal registriertes ‚ÄûBild‚Äú, auf dem sich vor dem Hintergrund der beleuchteten Wand ein dunkler St√§nder befindet, auf dem eine Glashohlkugel mit einem Durchmesser von 1 cm, die im Inneren befestigt ist, mit schwarzer L√∂sung gef√ºllt ist.  Ein Peak ist eine Reflexion von der Au√üenfl√§che dieser Kugel.  Das Rauschen in hellen Bereichen ist die Struktur der Wand selbst, die durch Flecken vom Laser verst√§rkt wird und von Bild zu Bild station√§r bleibt.  Das reale Leitungsrauschen ist viel geringer. <br><div style="text-align:center;"><img width="65%" src="https://habrastorage.org/webt/ce/bt/jw/cebtjw-j6wmi1icilzg_oprfxnc.png" alt="Bild"></div><br><br>  <b>Andere √§hnliche Linien</b> <br>  Einige andere 2048-Pixel-Schwarzwei√ü-SONY-CCD-Leitungen von ILX511, ILX551 (letztere haben eine andere Pinbelegung und erfordern zwei Versorgungsspannungen - 5 und 9 V), die sich in der transversalen Pixelgr√∂√üe (von 14 bis 200 Mikrometer) unterscheiden, funktionieren genauso. und spektrale Empfindlichkeit (ILX554A ist rot- und IR-empfindlich, √§hnlich wie Index B hat eine verringerte Empfindlichkeit im IR-Bereich und ist nahe an der Empfindlichkeit f√ºr das Auge, und ILX511B ist blauerempfindlicher).  Ihre dynamischen Eigenschaften sind unterschiedlich: Der Dynamikbereich des ILX551B erreicht aufgrund der geringen Pixelgr√∂√üe 6000 (unsere Linie erreicht diese DD mit kurzen Verschlusszeiten von ca. 10 Œºs). <br><br>  * * * <br>  Dieser Artikel beschreibt den Anschluss der vielleicht am einfachsten zu verwendenden CCD-Leitung.  Diese Einfachheit ist auf die Tatsache zur√ºckzuf√ºhren, dass die ganze Komplexit√§t in ihr unter der Haube verborgen ist.  Ohne die eingebauten Treiber m√ºsste ich viele mehrstufige Signale erzeugen. <br>  Leider weist eine solche CCD-Linie mit eingebauten Treibern nach modernen Ma√üst√§ben nicht die besten Eigenschaften auf.  In dieser Zeile betr√§gt der dynamische Bereich, definiert als das Verh√§ltnis des S√§ttigungssignals zum dunklen Signal, 333: 1 und definiert als das Verh√§ltnis des S√§ttigungssignals zum minimalen Signal, das vor dem Hintergrund des Rauschens erfasst wird - etwa 1000: 1.  Solche Ger√§te sind jedoch nicht nur schwer zu bedienen, sondern oft auch schwer zug√§nglich (dasselbe Hamamatsu erfordert komplexe b√ºrokratische Formalit√§ten beim Kauf seiner CCD-Arrays und anderer Fotodetektoren aufgrund des doppelten Zwecks dieser Produkte).  Eine derart hohe Leistung ist jedoch nicht immer erforderlich, und f√ºr viele Zwecke sind die Parameter dieser Ger√§te durchaus akzeptabel. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de457762/">https://habr.com/ru/post/de457762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de457752/index.html">Keine Mondrover und keine Joker. Was wissen wir √ºber Roboter in Fukushima?</a></li>
<li><a href="../de457754/index.html">Staats- und T-Killer</a></li>
<li><a href="../de457756/index.html">Das Buch Kafka Streams in Aktion. Echtzeitanwendungen und Microservices ¬ª</a></li>
<li><a href="../de457758/index.html">Ingenieure retten Menschen, die im Wald verloren gegangen sind, aber der Wald hat sich noch nicht ergeben</a></li>
<li><a href="../de457760/index.html">So machen Sie Container noch isolierter: eine √úberpr√ºfung der Container-Sandbox-Technologien</a></li>
<li><a href="../de457764/index.html">10 Fehler der jungen PO (Teil II)</a></li>
<li><a href="../de457766/index.html">Wir generieren Kachelebenen und verstecken Quadrate vor dem Spieler</a></li>
<li><a href="../de457768/index.html">Wie ich verwundbar wurde: Scannen der IT-Infrastruktur mit Qualys</a></li>
<li><a href="../de457770/index.html">Wir schreiben benutzerdefinierte Transformatoren AST auf TypeScript</a></li>
<li><a href="../de457774/index.html">Studieren als Privatpilot in Mittelerde: Umzug und Leben in einem neuseel√§ndischen Dorf</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>