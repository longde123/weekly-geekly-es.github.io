<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è±Ô∏è üò£ üéÜ Outra maneira de medir o desempenho dos m√©todos de aplicativo .NET üßöüèø üçÖ üë®üèº‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Freq√ºentemente, √© necess√°rio coletar estat√≠sticas sobre o desempenho dos m√©todos de aplicativo em tempo real (quando o aplicativo j√° est√° sendo execut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Outra maneira de medir o desempenho dos m√©todos de aplicativo .NET</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485198/"><p><img src="https://habrastorage.org/webt/-q/hs/z8/-qhsz8oawswkr7chwsijjbkrr1y.png"></p><br><p>  Freq√ºentemente, √© necess√°rio coletar estat√≠sticas sobre o desempenho dos m√©todos de aplicativo em tempo real (quando o aplicativo j√° est√° sendo executado) para identificar seus gargalos e ver qual parte do aplicativo est√° desacelerando. </p><br><p>  Al√©m disso, seria bom, al√©m dos pr√≥prios dados de desempenho (tempo de desenvolvimento do m√©todo, data de in√≠cio e t√©rmino da chamada) armazenar um contexto de chamada no qual o desempenho √© monitorado (como argumentos de chamada de m√©todo e dados arbitr√°rios adicionados pelo desenvolvedor). </p><br><p>  Bem, a "cereja no bolo" pode ser considerada a conveni√™ncia e simplicidade da ferramenta utilizada, o que tamb√©m √© importante. </p><br><p>  Para resolver esses problemas, <a href="https://github.com/unchase/Unchase.FluentPerformanceMeter" rel="nofollow">foi desenvolvida uma</a> biblioteca .NET de c√≥digo aberto de plataforma cruzada, <a href="https://github.com/unchase/Unchase.FluentPerformanceMeter" rel="nofollow">Unchase.FluentPerformanceMeter</a> . </p><a name="habracut"></a><br><h2 id="vvedenie">  1. Introdu√ß√£o </h2><br><p> Portanto, este artigo √© uma descri√ß√£o do trabalho com o <a href="https://github.com/unchase/Unchase.FluentPerformanceMeter" rel="nofollow"><strong>Unchase Fluent Performance Meter</strong></a> , uma biblioteca <em>.Net Standard 2.0 de</em> c√≥digo aberto de plataforma cruzada, projetada para calcular o desempenho dos m√©todos. </p><br><p>  A biblioteca pode ser usada em aplicativos .NET Core e .NET Framework compat√≠veis com o <em>.Net Standard 2.0</em> e permite: </p><br><ul><li>  <a href="https://habr.com/ru/post/485198/"><strong>Fa√ßa medi√ß√µes precisas do</strong></a> desempenho de <strong>m√©todos <em>p√∫blicos</em></strong> para <strong>classes <em>p√∫blicas</em> ,</strong> tanto do seu c√≥digo quanto do <a href="https://habr.com/ru/post/485198/">c√≥digo das bibliotecas usadas</a> (com a fixa√ß√£o da hora exata do in√≠cio e do final da medi√ß√£o); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Adicione</strong></a> <strong>dados adicionais</strong> ( <strong>dados</strong> personalizados) <a href="https://habr.com/ru/post/485198/"><strong>aos resultados da</strong></a> medi√ß√£o.  Por exemplo, os valores dos par√¢metros de entrada do m√©todo e o resultado;  ou dados de contexto de execu√ß√£o do m√©todo;  ou <em>corellationId</em> , pelo qual ser√° poss√≠vel vincular v√°rias medi√ß√µes do desempenho dos m√©todos; </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Divida a medi√ß√£o de</strong></a> desempenho do m√©todo <strong>em etapas separadas</strong> (etapas) com a fixa√ß√£o de dados pr√≥prios para cada etapa.  Al√©m disso, voc√™ pode <a href="https://habr.com/ru/post/485198/">definir o</a> tempo de execu√ß√£o <a href="https://habr.com/ru/post/485198/">m√≠nimo</a> , a partir do qual a etapa ser√° levada em considera√ß√£o na medi√ß√£o (se a etapa for conclu√≠da mais rapidamente, ela n√£o ser√° medida); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Excluir</strong></a> <strong>partes individuais do c√≥digo</strong> <a href="https://habr.com/ru/post/485198/"><strong>da medi√ß√£o de</strong></a> desempenho (por exemplo, chamadas para m√©todos individuais cujo tempo de execu√ß√£o n√£o precisa ser levado em considera√ß√£o na medi√ß√£o); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Adicione seus pr√≥prios comandos</strong></a> (comandos), que s√£o garantidos para <strong>serem executados imediatamente ap√≥s o</strong> final da medi√ß√£o de desempenho do m√©todo (por exemplo, para adicionar processamento adicional dos resultados obtidos, como registrar ou gravar dados no armazenamento); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Adicione seu pr√≥prio manipulador de exce√ß√£o</strong></a> para o c√≥digo executado no contexto da medi√ß√£o do desempenho do m√©todo (comum para todas as medi√ß√µes e para cada medi√ß√£o separadamente); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Defina o tempo para armazenar os resultados das</strong></a> medi√ß√µes da produtividade dos m√©todos, ap√≥s os quais os resultados ser√£o exclu√≠dos; </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Adicione</strong></a> dados sobre <strong>quem chama o m√©todo</strong> (Chamador) via <em>IHttpContextAccesor</em> ou a tarefa do Chamador no c√≥digo aos resultados da medi√ß√£o (por exemplo, voc√™ pode especificar o nome do servi√ßo externo que chamou o m√©todo); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Adicione aos</strong></a> dados dos <a href="https://habr.com/ru/post/485198/"><strong>resultados da medi√ß√£o</strong></a> o local onde a medi√ß√£o de desempenho foi iniciada (nome do arquivo e n√∫mero da linha com o local da chamada no c√≥digo); </li><li>  <a href="https://habr.com/ru/post/485198/"><strong>Interromper a medi√ß√£o do</strong></a> desempenho do m√©todo <strong>antes do final de sua execu√ß√£o</strong> . </li></ul><br><p>  Os dados obtidos como resultado da medi√ß√£o do desempenho dos m√©todos podem ser usados ‚Äã‚Äãpara analisar o desempenho do aplicativo (suas partes individuais, tanto interna - c√≥digo nativo quanto externo - o c√≥digo das bibliotecas utilizadas) e exibidos em uma forma gr√°fica conveniente para voc√™. </p><br><h2 id="soderzhanie">  Conte√∫do </h2><br><ul><li>  <a href="https://habr.com/ru/post/485198/">Introdu√ß√£o</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Exemplos de uso</a> <br><ul><li>  <a href="https://habr.com/ru/post/485198/">M√©todo de Medi√ß√£o de Desempenho</a> </li><li>  <a href="https://habr.com/ru/post/485198/">M√©todo de medi√ß√£o de desempenho usando DiagnosticSource</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Medindo o desempenho do m√©todo usado pela biblioteca</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Adicionando dados adicionais (dados personalizados) e pagina√ß√£o (etapas)</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Exce√ß√£o da medi√ß√£o (Ignorar)</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Adicionando comandos e a√ß√µes</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Adicionando manipuladores de exce√ß√£o</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Definindo o tempo de armazenamento de dados (Definir tempo de cache)</a> </li><li>  <a href="https://habr.com/ru/post/485198/">Adicionando dados sobre o m√©todo de chamada e o local da chamada (interrup√ß√£o da medi√ß√£o de desempenho)</a> </li></ul></li></ul><br><h2 id="a-namestarta-nachalo-raboty">  Introdu√ß√£o </h2><br><p>  Para usar a biblioteca, instale o <a href="https://www.nuget.org/packages/Unchase.FluentPerformanceMeter/" rel="nofollow">pacote <em>NuGet</em></a> no seu projeto: </p><br><h4 id="vruchnuyu-s-pomoschyu-menedzhera-nuget-paketov-package-manager">  Usando manualmente o <em>NuGet</em> Package Manager: </h4><br><pre><code class="powershell hljs"><span class="hljs-built_in"><span class="hljs-built_in">Install-Package</span></span> Unchase.FluentPerformanceMeter</code> </pre> <br><h4 id="s-pomoschyu-net-cli">  Usando a CLI do .NET: </h4><br><pre> <code class="powershell hljs">dotnet add package Unchase.FluentPerformanceMeter -<span class="hljs-literal"><span class="hljs-literal">-version</span></span> {version}</code> </pre> <br><blockquote>  Onde {version} √© a vers√£o do pacote que voc√™ deseja instalar. <br>  Por exemplo, o <code>dotnet add package Unchase.FluentPerformanceMeter --version 1.0.0</code> </blockquote><br><h2 id="a-namesimplesamplesa-primery-ispolzovaniya">  Exemplos de uso </h2><br><h3 id="izmerenie-proizvoditelnosti-metoda">  M√©todo de Medi√ß√£o de Desempenho </h3><br><p>  A seguir, √© apresentado um exemplo simples de uso da biblioteca (sem configura√ß√£o e configura√ß√µes adicionais) para medir o desempenho do <code>SimpleWatchingMethodStart</code> (Action) <code>SimpleWatchingMethodStart</code> controller (Controller) <code>PerformanceMeterController</code> <em>Asp.Net Core 2.2 WebAPI</em> .  Para fazer isso, voc√™ pode usar o m√©todo de extens√£o <code>.WatchingMethod().Start()</code> ou uma funcionalidade semelhante <code>.StartWatching()</code> . <br>  Desde a v1.0.5, voc√™ tamb√©m pode usar <code>.WatchingMethod().Start(SimpleWatchingMethodStart)</code> ou <code>.StartWatching(SimpleWatchingMethodStart)</code> com o nome do m√©todo. </p><br><blockquote>  Todos os exemplos de uso da biblioteca podem ser encontrados nos projetos <code>Unchase.FluentPerformanceMeter.Test*</code> <a href="https://github.com/unchase/Unchase.FluentPerformanceMeter" rel="nofollow">deste reposit√≥rio</a> . </blockquote><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Test GET method with simple performance watching. /// &lt;/summary&gt; [HttpGet("SimpleWatchingMethodStart")] public ActionResult SimpleWatchingMethodStart() { // for C# 8 you can use: //using var pm = PerformanceMeter&lt;PerformanceMeterController&gt;.StartWatching(); using (PerformanceMeter&lt;PerformanceMeterController&gt;.WatchingMethod().Start()) { // put your code with some logic here return Ok(); } }</code> </pre> <br><p>  Para obter os resultados das medi√ß√µes de desempenho de m√©todos p√∫blicos da classe de controlador <code>PerformanceMeterController</code> , voc√™ pode chamar o seguinte m√©todo: </p><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Get methods performance info for this controller. /// &lt;/summary&gt; /// &lt;returns&gt;Returns methods performance info.&lt;/returns&gt; [HttpGet("GetPerformanceInfo")] [IgnoreMethodPerformance] public ActionResult&lt;IPerformanceInfo&gt; GetPerformanceInfo() { return Ok(PerformanceMeter&lt;PerformanceMeterController&gt;.PerformanceInfo); }</code> </pre> <br><p>  Depois de chamar o m√©todo <code>SimpleWatchingMethodStart</code> ao chamar <code>GetPerformanceInfo</code> , obtemos: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:00.0016350"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"unknown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3385385Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3401735Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3370183Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStart"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h3 id="a-namediagnosticsourcesamplea-izmerenie-proizvoditelnosti-metoda-s-pomoschyu-diagnosticsource">  M√©todo de medi√ß√£o de desempenho usando <code>DiagnosticSource</code> </h3><br><p>  A partir da vers√£o <em>v1.1.0</em> , tornou-se poss√≠vel medir o desempenho dos m√©todos em um aplicativo <em>AspNetCore MVC</em> usando o <code>DiagnosticSource</code> e o atributo <code>WatchingWithDiagnosticSourceAttribute</code> especial. <br>  Para fazer isso, adicione o pacote <a href="" rel="nofollow"><code>Unchase.FluentPerformanceMeter.AspNetCore.Mvc</code></a> ao projeto <em>NuGet</em> e adicione o seguinte c√≥digo ao <code>Startap.cs</code> : </p><br><pre> <code class="plaintext hljs">public void ConfigureServices(IServiceCollection services) { // ... // allows to measure methods performance for class "MeasurableClass" and "MeasurableSecondClass" services.AddPerformanceDiagnosticObserver&lt;MeasurableClass&gt;(); services.AddPerformanceDiagnosticObserver&lt;MeasurableSecondClass&gt;(); // ... the same for another classes services.AddMvc(); // ... } public void Configure(IApplicationBuilder app, IHostingEnvironment env) { // ... app.UsePerformanceDiagnosticObserver(); app.UseMvc(); }</code> </pre> <br><p>  Em seguida, marque com o atributo <code>WatchingWithDiagnosticSourceAttribute</code> ou m√©todos individuais: </p><br><pre> <code class="plaintext hljs">[HttpGet("SimpleWatchingMethodStart")] [WatchingWithDiagnosticSource] public ActionResult SimpleWatchingMethodStart() { return Ok(); }</code> </pre> <br><p>  ou toda a classe: </p><br><pre> <code class="plaintext hljs">[ApiController] [Route("api/v1/[controller]")] [Produces("application/json")] [SwaggerTag("Unchase.PerformanceMeter Test WebAPI Controller")] [WatchingWithDiagnosticSource] public class PerformanceMeterController : ControllerBase { // measurable methods }</code> </pre> <br><p>  A partir da vers√£o <em>v1.2.0</em> , tornou-se poss√≠vel incluir argumentos de chamada nos dados de medi√ß√£o de desempenho do m√©todo do usu√°rio em um aplicativo <em>AspNetCore MVC</em> usando o atributo especial <code>AddMethodArgumentsToCustomDataAttribute</code> em conjunto com o atributo <code>WatchingWithDiagnosticSourceAttribute</code> : </p><br><pre> <code class="plaintext hljs">[HttpPost("SimpleWatchingMethodStartWithArgs")] [WatchingWithDiagnosticSource] [AddMethodArgumentsToCustomData("actionArguments")] public ActionResult SimpleWatchingMethodStartWithArgs(DTOArgument arg) { return Ok(); }</code> </pre> <br><p>  Depois de chamar o m√©todo <code>SimpleWatchingMethodStartWithArgs</code> ao chamar <code>GetPerformanceInfo</code> , obtemos: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:00.0016350"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"unknown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3385385Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3401735Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"actionArguments"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"arg"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;string_in_DTOArgument&gt;"</span></span> } } }, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T10:27:27.3370183Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"SimpleWatchingMethodStartWithArgs"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h3 id="a-namesampleexternala-izmerenie-proizvoditelnosti-metoda-ispolzuemoy-biblioteki">  Medindo o desempenho do m√©todo usado pela biblioteca </h3><br><p>  Para medir o desempenho do m√©todo <em>p√∫blico da</em> classe <em>p√∫blica</em> da biblioteca de terceiros usada, voc√™ deve definir explicitamente a pr√≥pria classe e seu nome do m√©todo: </p><br><pre> <code class="plaintext hljs">[HttpGet("GetThreadSleepPerformance")] public ActionResult&lt;string&gt; GetThreadSleepPerformance() { using (PerformanceMeter&lt;Thread&gt;.WatchingMethod(nameof(Thread.Sleep)).Start()) { Thread.Sleep(1000); } return Ok(PerformanceMeter&lt;Thread&gt;.PerformanceInfo.MethodCalls.FirstOrDefault(ta =&gt; ta.MethodName == nameof(Thread.Sleep))?.Elapsed); }</code> </pre> <br><p>  O m√©todo executado retornar√°: </p><br><pre> <code class="plaintext hljs">"00:00:01.0033040"</code> </pre> <br><p>  Voc√™ pode obter dados sobre como chamar esse m√©todo por meio de uma chamada: </p><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Get methods performance info for Thread class. /// &lt;/summary&gt; /// &lt;returns&gt;Returns Thread methods performance info.&lt;/returns&gt; [HttpGet("GetThreadPerformanceInfo")] [IgnoreMethodPerformance] public ActionResult&lt;IPerformanceInfo&gt; GetThreadPerformanceInfo() { return Ok(PerformanceMeter&lt;Thread&gt;.PerformanceInfo); }</code> </pre> <br><blockquote>  O atributo <code>IgnoreMethodPerformance</code> projetado para que o m√©todo que ele <code>IgnoreMethodPerformance</code> n√£o seja levado em considera√ß√£o ao medir o desempenho. </blockquote><p>  Em resposta √† chamada para este m√©todo ser√°: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sleep"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:01.0033040"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"unknown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:08:09.336624Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:08:10.339928Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Abort"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, // ... { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sleep"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } // ... ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Abort"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, // ... { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sleep"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } // ... ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:08:09.3357028Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"System.Threading.Thread"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Abort"</span></span>, // ... <span class="hljs-string"><span class="hljs-string">"Sleep"</span></span>, // ... ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h3 id="a-namesamplecustomdataa-dobavlenie-dopolnitelnyh-dannyh-custom-data-i-razbienie-na-shagi-steps">  Adicionando dados adicionais (dados personalizados) e pagina√ß√£o (etapas) </h3><br><p>  Voc√™ pode adicionar dados adicionais (dados personalizados) para todas as medidas de desempenho dos m√©todos de uma classe espec√≠fica.  Por exemplo, no construtor est√°tico da classe do controlador <code>PerformanceMeterController</code> : </p><br><pre> <code class="plaintext hljs">[ApiController] [Route("api/v1/[controller]")] public class PerformanceMeterController : ControllerBase { /// &lt;summary&gt; /// Static constructor. /// &lt;/summary&gt; static PerformanceMeterController() { // add common custom data (string) to class performance information PerformanceMeter&lt;PerformanceMeterController&gt;.AddCustomData("Tag", "CustomTag"); // add common custom data (anonymous class) to class performance information PerformanceMeter&lt;PerformanceMeterController&gt;.AddCustomData("Custom anonymous class", new { Name = "Custom Name", Value = 1 }); } // ... actions }</code> </pre> <br><p>  Al√©m disso, voc√™ pode adicionar dados adicionais (Dados Customizados) para uma medida espec√≠fica usando o m√©todo de extens√£o <code>.WithSettingData.CustomData("&lt;key&gt;", &lt;value&gt;)</code> (inclusive por meio de um atributo especial do m√©todo <code>MethodCustomDataAttribute</code> ) e para cada etapa (Etapa ) dessa medida, adicionada usando o <code>.Step("&lt;step_name&gt;")</code> extens√£o <code>.Step("&lt;step_name&gt;")</code> , usando o <code>.AddCustomData("&lt;key&gt;", &lt;value&gt;)</code> extens√£o <code>.AddCustomData("&lt;key&gt;", &lt;value&gt;)</code> : </p><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Test GET method with simple performance watching (with steps). /// &lt;/summary&gt; [HttpGet("SimpleStartWatchingWithSteps")] [MethodCustomData("Custom data from attribute", "Attr")] public ActionResult SimpleStartWatchingWithSteps() { using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt; .WatchingMethod() .WithSettingData .CustomData("coins", 1) .CustomData("Coins sets", new { Gold = "Many", Silver = 5 }) .Start()) { // put your code with some logic here // add "Step 1" using (pm.Step("Step 1")) { Thread.Sleep(1000); } // add "Step 2" with custom data using (var pmStep = pm.Step("Step 2").AddCustomData("step2 custom data", "data!")) { // add "Step 3 in Step 2" using (pm.Step("Step 3 in Step 2")) { Thread.Sleep(1000); } // add custom data to "Step 2" pmStep.AddCustomData("step2 another custom data", "data2!"); // get and remove custom data from "Step 2" var customData = pmStep.GetAndRemoveCustomData&lt;string&gt;("step2 custom data"); // get custom data from "Step 2" (without removing) var anotherCustomData = pmStep.GetCustomData&lt;string&gt;("step2 another custom data"); // ... } } }</code> </pre> <br><p>  Como resultado, ao chamar <code>GetPerformanceInfo</code> , obtemos: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithSteps"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:02.0083031"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"unknown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:18.9006891Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:20.9089922Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Coins sets"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"gold"</span></span>: <span class="hljs-string"><span class="hljs-string">"Many"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"silver"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"coins"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Custom data from attribute"</span></span>: <span class="hljs-string"><span class="hljs-string">"Attr"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"stepName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Step 1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:01.0009758"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:18.9018272Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:19.902803Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {} }, { <span class="hljs-attr"><span class="hljs-attr">"stepName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Step 3 in Step 2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:01.0004549"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:19.9046523Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:20.9051072Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {} }, { <span class="hljs-attr"><span class="hljs-attr">"stepName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Step 2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:01.0029596"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:19.904534Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:20.9074936Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"step2 another custom data"</span></span>: <span class="hljs-string"><span class="hljs-string">"data2!"</span></span> } } ] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithSteps"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithSteps"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T11:58:18.8801249Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithSteps"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Tag"</span></span>: <span class="hljs-string"><span class="hljs-string">"CustomTag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Custom anonymous class"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Custom Name"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h3 id="a-namesampleignorea-isklyuchenie-iz-zamera-ignore">  Exce√ß√£o da medi√ß√£o (Ignorar) </h3><br><p>  Voc√™ pode ignorar partes individuais do m√©todo na medi√ß√£o de desempenho (usando <code>.Ignore()</code> ou <code>.Executing().WithoutWatching().Start(&lt;Action&gt;)</code> ) e tamb√©m n√£o salva etapas individuais (m√©todo de extens√£o <code>.StepIf("&lt;step_name&gt;", &lt;minSaveMs&gt;)</code> ) se eles n√£o <code>.StepIf("&lt;step_name&gt;", &lt;minSaveMs&gt;)</code> √† condi√ß√£o (o tempo de execu√ß√£o da etapa ser√° levado em considera√ß√£o no tempo de execu√ß√£o do m√©todo): </p><br><pre> <code class="plaintext hljs">using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt;.WatchingMethod().Start()) { // put your code with some logic here // sleep 1 sec Thread.Sleep(1000); // ignore this block in performance watching using (pm.Ignore()) { Thread.Sleep(5000); } // skip this step with minSaveMs (not save, but consider duration in method performance watching) using (pm.StepIf("Skipped step", minSaveMs: 1000)) { Thread.Sleep(500); } // execute action without performance watching pm.Executing().WithoutWatching().Start(() =&gt; { Thread.Sleep(2000); }); return Ok(); }</code> </pre> <br><p>  Como resultado, obtemos: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithIgnored"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:01.5080227"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"unknown"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T12:34:36.9187359Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T12:34:38.4267586Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithIgnored"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithIgnored"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T12:34:36.9035129Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"SimpleStartWatchingWithIgnored"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { }, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h3 id="a-namesamplecustomcommandsa-dobavlenie-komand-commands-i-deystviy-actions">  Adicionando comandos e a√ß√µes </h3><br><p>  Para adicionar um comando que ser√° garantido para ser executado ap√≥s a conclus√£o da medi√ß√£o do desempenho de um m√©todo, voc√™ deve criar uma classe de comando que implementar√° a interface <code>IPerformanceCommand</code> . <br>  Ao mesmo tempo, voc√™ pode transferir dados arbitr√°rios atrav√©s do construtor do comando criado que ser√° usado durante sua execu√ß√£o.  Por exemplo: </p><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Custom executed command. /// &lt;/summary&gt; public class ExecutedCommand : IPerformanceCommand { /// &lt;summary&gt; /// Executed commad name. /// &lt;/summary&gt; public string CommandName =&gt; this.GetType().Name; private string _customString { get; } internal bool IsCommandExecuted { get; private set; } /// &lt;summary&gt; /// Constructor. /// &lt;/summary&gt; /// &lt;remarks&gt; /// You can pass any data through the command constructor. /// &lt;/remarks&gt; /// &lt;param name="customString"&gt;&lt;/param&gt; public ExecutedCommand(string customString) { this._customString = customString; } /// &lt;summary&gt; /// Execute command. /// &lt;/summary&gt; /// &lt;param name="performanceInfo"&gt;&lt;see cref="IPerformanceInfo"/&gt;.&lt;/param&gt; public void Execute(IPerformanceInfo performanceInfo) { // for example, write to the debug console some information Debug.WriteLine(this.CommandName); Debug.WriteLine(this._customString); Debug.WriteLine($"Method names count: {performanceInfo.MethodNames.Count}"); this.IsCommandExecuted = true; } }</code> </pre> <br><p>  Voc√™ pode adicionar um comando (IPerformanceCommand) e uma a√ß√£o (Action) para que eles sejam executados no final da medi√ß√£o, da seguinte maneira: </p><br><pre> <code class="plaintext hljs">// custom "ExecutedCommand" will be executed after performance watching is completed using (PerformanceMeter&lt;PerformanceMeterController&gt; .WatchingMethod() .WithExecutingOnComplete .Command(new ExecutedCommand("bla-bla-bla")) .Action((pi) =&gt; { Debug.WriteLine($"Class name: {pi.ClassName}"); }) .Start()) { return Ok(); }</code> </pre> <br><p>  Como resultado, ao final da medi√ß√£o do desempenho do m√©todo no console de <em>depura√ß√£o</em> , ele exibir√°: </p><br><pre> <code class="plaintext hljs">ExecutedCommand bla-bla-bla Method names count: 13 Class name: Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController</code> </pre> <br><h3 id="a-namesamplecustomexceptionhandlera-dobavlenie-obrabotchikov-isklyucheniy-exception-handlers">  Adicionando manipuladores de exce√ß√£o </h3><br><p>  Se voc√™ precisar manipular exce√ß√µes que possam ocorrer durante a execu√ß√£o de uma parte do m√©todo para a qual o desempenho √© monitorado, adicione um manipulador de Exce√ß√£o da seguinte maneira: </p><br><pre> <code class="plaintext hljs">using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt;.StartWatching()) { // execute action throws Exception with exception handler pm.Executing() .WithExceptionHandler((ex) =&gt; Debug.WriteLine(ex.Message)) .Start(() =&gt; throw new Exception("Exception")); // execute action throws custom Exception with exception handler pm.Executing&lt;CustomException&gt;() .WithExceptionHandler((ex) =&gt; { Debug.WriteLine(ex.Message); }) .Start(() =&gt; { throw new CustomException("Custom exception was occured!"); }); return Ok(); }</code> </pre> <br><p>  Onde est√° a classe <code>CustomException</code> , por exemplo: </p><br><pre> <code class="plaintext hljs">/// &lt;summary&gt; /// Custom exception. /// &lt;/summary&gt; public class CustomException : Exception { public CustomException(string message) : base(message) { } public CustomException(string message, Exception innerException) : base(message, innerException) { } public CustomException() { } }</code> </pre> <br><p>  Como resultado, o console <em>Debug</em> exibir√°: </p><br><pre> <code class="plaintext hljs">Exception Custom exception was occured!</code> </pre> <br><p>  Al√©m disso, voc√™ pode especificar um manipulador de exce√ß√£o que ser√° usado por padr√£o para medir o desempenho de qualquer m√©todo dessa classe, por exemplo, atrav√©s do construtor est√°tico da classe do controlador <code>PerformanceMeterController</code> : </p><br><pre> <code class="plaintext hljs">[ApiController] [Route("api/v1/[controller]")] public class PerformanceMeterController : ControllerBase { /// &lt;summary&gt; /// Static constructor. /// &lt;/summary&gt; static PerformanceMeterController() { // set default exception handler for PerformanceMeterController class PerformanceMeter&lt;PerformanceMeterController&gt;.SetDefaultExceptionHandler((ex) =&gt; Debug.WriteLine(ex.Message)); } // ... actions }</code> </pre> <br><h3 id="a-namesamplesettingcachetimea-ustanovka-vremeni-hraneniya-dannyh-set-cache-time">  Definindo o tempo de armazenamento de dados (Definir tempo de cache) </h3><br><p>  Voc√™ pode definir o tempo de armazenamento para os dados das medidas de desempenho dos m√©todos, ap√≥s os quais esses dados ser√£o exclu√≠dos.  Para cada classe para a qual a medi√ß√£o √© feita, esse tempo √© definido separadamente.  Por exemplo, o tempo pode ser definido atrav√©s do construtor est√°tico da classe do controlador <code>PerformanceMeterController</code> : </p><br><pre> <code class="plaintext hljs">[ApiController] [Route("api/v1/[controller]")] public class PerformanceMeterController : ControllerBase { /// &lt;summary&gt; /// Static constructor. /// &lt;/summary&gt; static PerformanceMeterController() { // set cache time for PerformanceMeterController class PerformanceMeter&lt;PerformanceMeterController&gt;.SetMethodCallsCacheTime(5); } // ... actions }</code> </pre> <br><h3 id="a-namesamplesetcallerandsourcewithstopa-dobavlenie-dannyh-o-vyzyvayuschem-metod-i-meste-vyzova-i-preryvanie-zamera-proizvoditelnosti">  Adicionando dados sobre o m√©todo de chamada e o local da chamada (e interrompendo a medi√ß√£o do desempenho) </h3><br><ul><li><p>  Voc√™ pode especificar quem est√° chamando o m√©todo usando o m√©todo de extens√£o <code>.CallerFrom("&lt;caller_name&gt;")</code> (uma cadeia ou <em>IHttpContextAccessor √© passada a ele</em> ) ou um atributo especial do m√©todo <code>[MethodCaller("&lt;caller_name&gt;")]</code> .  Al√©m disso, se o atributo e o m√©todo de extens√£o forem usados, o valor ser√° obtido deste √∫ltimo. </p><br></li><li><p>  O m√©todo de extens√£o <code>.WithSettingData.CallerSourceData()</code> usado para adicionar um ponto de chamada para medir o desempenho. </p><br></li><li><p>  Para parar de medir o desempenho dentro do bloco <code>using</code> , use o m√©todo de extens√£o <code>.StopWatching()</code> ou o m√©todo <code>Dispose()</code> diretamente: </p><br></li></ul><br><pre> <code class="plaintext hljs">[HttpPost("StartWatchingWithCallerName")] [MethodCaller("testCaller")] public ActionResult&lt;string&gt; StartWatchingWithCallerName([FromBody] string value) { // method performance info will reach with caller name (if internal HttpContextAccessor is null) using (var pm = PerformanceMeter&lt;PerformanceMeterController&gt; .WatchingMethod() .WithSettingData .CallerSourceData() .CallerFrom("Test caller") .Start()) { pm.StopWatching(); // stop watching here (or you can use "pm.Dispose();") Thread.Sleep(2000); return Ok(value); } }</code> </pre> <br><p>  Como resultado da chamada do m√©todo <code>GetPerformanceInfo</code> , <code>GetPerformanceInfo</code> obt√©m: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"methodCalls"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"StartWatchingWithCallerName"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"elapsed"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:00:00.0019172"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caller"</span></span>: <span class="hljs-string"><span class="hljs-string">"Test caller"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:35:45.3164507Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"endTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:35:45.3183679Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"customData123"</span></span>: <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callerSourceLineNumber"</span></span>: <span class="hljs-number"><span class="hljs-number">525</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callerSource"</span></span>: <span class="hljs-string"><span class="hljs-string">"D:\\GitHub\\Unchase.FluentPerformanceMeter\\Unchase.FluentPerformanceMeter.TestWebAPI\\Controllers\\PerformanceMeterController.cs"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"steps"</span></span>: [] } ], <span class="hljs-attr"><span class="hljs-attr">"totalActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"StartWatchingWithCallerName"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"currentActivity"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"methodName"</span></span>: <span class="hljs-string"><span class="hljs-string">"StartWatchingWithCallerName"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"callsCount"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"uptimeSince"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-12-06T13:35:45.2601668Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"className"</span></span>: <span class="hljs-string"><span class="hljs-string">"Unchase.FluentPerformanceMeter.TestWebAPI.Controllers.PerformanceMeterController"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"methodNames"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"StartWatchingWithCallerName"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"customData"</span></span>: { }, <span class="hljs-attr"><span class="hljs-attr">"timerFrequency"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span> }</code> </pre> <br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p>  Assim, a solu√ß√£o apresentada nos permite automatizar parcialmente a coleta de informa√ß√µes sobre o desempenho dos m√©todos de aplicativos .NET de uma maneira bastante conveniente.  Os dados coletados podem ser visualizados de uma maneira mais adequada para cada desenvolvedor espec√≠fico. </p><br><p>  Obviamente, a biblioteca n√£o resolve todos os problemas associados √† coleta de dados sobre o desempenho dos m√©todos, mas procura simplificar os mais comuns. </p><br><p>  A biblioteca √© uma solu√ß√£o de c√≥digo aberto, todas as sugest√µes e sugest√µes para o seu desenvolvimento s√£o bem-vindas, assim como os relat√≥rios de erros (todos podem seguir o <a href="https://github.com/unchase/Unchase.FluentPerformanceMeter/issues" rel="nofollow">link</a> ; o autor agradece por qualquer ajuda!). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt485198/">https://habr.com/ru/post/pt485198/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt485184/index.html">Resultados da vota√ß√£o com guias</a></li>
<li><a href="../pt485186/index.html">Startup de trilh√µes de d√≥lares ou como nasceram as empresas Valley de maior sucesso</a></li>
<li><a href="../pt485190/index.html">Andrew Eun "Paix√£o pelo aprendizado de m√°quina". Tradu√ß√£o dos cap√≠tulos 47-58</a></li>
<li><a href="../pt485194/index.html">√Årvore de segmentos: r√°pido e f√°cil</a></li>
<li><a href="../pt485196/index.html">AvitoTech On Tour: V√° e participe de reuni√µes em Kazan</a></li>
<li><a href="../pt485200/index.html">Confus√£o no in√≠cio: post-mortem na velocidade de lan√ßamento de um aplicativo iOS</a></li>
<li><a href="../pt485202/index.html">Sistema de Supress√£o</a></li>
<li><a href="../pt485204/index.html">Retornar ao topo: por que a capitaliza√ß√£o da Amazon em breve exceder√° US $ 1 trilh√£o</a></li>
<li><a href="../pt485206/index.html">Como o Typecript me decepcionou e vale a pena?</a></li>
<li><a href="../pt485208/index.html">Cria√ß√£o de infraestrutura de TI tolerante a falhas. Parte 2. Instalando e configurando o cluster oVirt 4.3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>