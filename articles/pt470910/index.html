<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï¥üèæ ü§í üë®üèø‚Äçü§ù‚Äçüë®üèæ O que pode ser feito com anota√ß√µes de contratos de microsservi√ßo? üë∂üèæ üï• ‚õπüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Num post anterior , falamos sobre como e por que fazemos na Ancronis anota√ß√µes para microsservi√ßos e prometemos compartilhar nossa pr√°tica de usar um ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O que pode ser feito com anota√ß√µes de contratos de microsservi√ßo?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acronis/blog/470910/">  Num <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">post</a> anterior <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">,</a> falamos sobre como e por que fazemos na Ancronis anota√ß√µes para microsservi√ßos e prometemos compartilhar nossa pr√°tica de usar um √∫nico formato de API para toda a Acronis Cyber ‚Äã‚ÄãPlatform.  Hoje, contaremos sobre a nossa experi√™ncia em verifica√ß√µes de anota√ß√µes est√°ticas - tamb√©m conhecido como o primeiro passo no caminho para introduzir anota√ß√µes em uma empresa. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/hm/0k/un/hm0kunnfzs9fvcgleqiyumvqny8.jpeg"></a> <br><a name="habracut"></a><br>  Portanto, suponha que voc√™ j√° tenha anota√ß√µes para todas ou a maioria das APIs.  Uma pergunta razo√°vel que nossos colegas tamb√©m nos fizeram: "O que pode ser feito com esses objetos m√°gicos?" <br><br>  De fato, existem dois tipos de verifica√ß√µes que podem ser feitas diretamente por anota√ß√£o.  As verifica√ß√µes est√°ticas v√£o diretamente para os textos das anota√ß√µes Swagger ou RAML.  Eles n√£o precisam de mais nada e podem ser considerados, com raz√£o, a primeira vantagem do uso de contratos de microsservi√ßo formalizados. <br><br>  As verifica√ß√µes din√¢micas s√≥ podem ser iniciadas se voc√™ tiver um servi√ßo em funcionamento.  Eles s√£o um pouco mais complicados, pois permitem aprofundar e verificar a validade da anota√ß√£o, testar a estabilidade do servi√ßo e tamb√©m fazer muito mais.  Mas este √© o t√≥pico do pr√≥ximo post, e hoje vamos nos concentrar nas est√°ticas. <br><br><h3>  Viva a Diretriz da API! </h3><br>  Para n√£o confundir voc√™ ou outras pessoas, vale a pena mencionar imediatamente que as verifica√ß√µes de anota√ß√£o est√°tica s√£o criadas para controlar a conformidade das anota√ß√µes da API (e, esperamos, as pr√≥prias APIs) com os requisitos corporativos.  Pode ser apenas pr√°ticas adotadas pela empresa ou uma API de diretrizes completa, que formaliza as regras para preparar a API para seus servi√ßos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/084/f24/61b/084f2461b8fa9d944fbcf83ce4618ab7.jpg" alt="imagem"><br><br>  Quando falamos sobre o mundo colorido dos microsservi√ßos, isso √© muito importante, porque cada equipe pode ter sua pr√≥pria estrutura, sua pr√≥pria linguagem de programa√ß√£o, uma pilha √∫nica ou algumas bibliotecas especiais.  Sob a influ√™ncia de pr√°ticas espec√≠ficas ao microsservi√ßo, a apresenta√ß√£o da API para um observador externo est√° mudando.  Isso cria variedade desnecess√°ria.  Para uma intera√ß√£o eficaz dos elementos de um ecossistema (ou plataforma), √© necess√°rio "alinhar" a API o m√°ximo poss√≠vel. <br><br>  Aqui est√° um exemplo: o c√≥digo 404 ser√° retornado para a API de um componente apenas se o recurso n√£o existir.  E a outra equipe vincula esse erro √† l√≥gica do aplicativo e a API retornar√° 404 quando o usu√°rio desejar comprar um produto que foi encerrado no armaz√©m.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Atygaev</a> descreveu esses problemas muito claramente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Essa inconsist√™ncia no entendimento do c√≥digo 404 atrasar√° o desenvolvimento e levar√° a erros, o que significa chamadas desnecess√°rias para suporte ou horas extras de depura√ß√£o, mas, em qualquer caso, problemas medidos em termos monet√°rios. <br><br>  As especificidades de sintaxe e nomea√ß√£o adotadas pela empresa s√£o complementadas por v√°rios aspectos espec√≠ficos do pr√≥prio REST.  O desenvolvedor deve responder a perguntas como: <br><br><ul><li>  O POST ser√° idempotente ou n√£o? </li><li>  Quais c√≥digos de erro usamos e o que eles significam? </li><li>  Posso adicionar l√≥gica de neg√≥cios a c√≥digos de erro? </li></ul><br>  Agora imagine que cada equipe deva individualmente confundir essas respostas. <br><br>  O formato da consulta de pesquisa tamb√©m pode ser completamente diferente.  Por exemplo, existem cerca de uma d√∫zia de maneiras de criar uma amostra na qual apenas os usu√°rios que possuem o MacBookPro e ataques de v√≠rus frequentes ser√£o listados.  Ao trabalhar em um grande projeto que consiste em dezenas de microsservi√ßos, √© necess√°rio que a sintaxe da consulta de pesquisa seja comum a todas as vers√µes e produtos da empresa.  E se uma pessoa est√° acostumada a se referir a um dos produtos / servi√ßos do seu desenvolvimento, ela espera encontrar a mesma estrutura de solicita√ß√£o e resposta em outra.  Caso contr√°rio, a surpresa (e a dor) n√£o ser√£o evitadas. <br><br>  Muitas empresas, especialmente gigantes, como <a href="">Microsoft</a> , <a href="">PayPal</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Google</a> , t√™m suas pr√≥prias diretrizes e s√£o muito bem pensadas.  Mas nem sempre √© poss√≠vel usar as diretrizes de outras pessoas, porque elas est√£o amplamente ligadas √†s especificidades da empresa.  Al√©m disso, o pensamento de todos tem uma estrutura diferente, e as regras podem diferir simplesmente porque √© mais conveniente que as pessoas trabalhem dessa maneira e n√£o de outra maneira. <br><br>  O entendimento de que a Acronis precisa de sua pr√≥pria diretriz de API n√£o veio imediatamente, mas com o crescente n√∫mero de desenvolvedores, microsservi√ßos e clientes e integra√ß√µes realmente externos.  Em algum momento, a equipe de arquitetos teve que estabelecer regras uniformes para declarar a API, levando em conta a experi√™ncia dos gigantes de TI mencionados acima e as pr√°ticas de fato j√° estabelecidas nas equipes de desenvolvimento. <br><br>  Um dos problemas com essa implementa√ß√£o tardia da API de diretrizes s√£o as APIs publicadas existentes que n√£o atendem aos requisitos, o que por sua vez leva a custos adicionais para redesenhar as interfaces e manter a compatibilidade com vers√µes anteriores.  Portanto, se seu modelo de neg√≥cios envolver integra√ß√£o e publica√ß√£o futura da API, ser√° necess√°rio pensar em regras uniformes o mais cedo poss√≠vel. <br><br><img src="https://habrastorage.org/webt/qt/yf/gz/qtyfgz3v0rojzm0dubyojcwl6hw.png"><br><br>  Obviamente, a ado√ß√£o das APIs das diretrizes n√£o tornou automaticamente todas as APIs constitutivas.  Cada API precisava ser analisada, cada devlid precisava entender novos requisitos.  Portanto, fizemos a automa√ß√£o das verifica√ß√µes de RAML contra a API Guideline que desenvolvemos. <br>  An√°lise est√°tica <br><br>  Primeiro, voc√™ precisa decidir o que analisaremos estaticamente.  Nem todos os pontos da API de diretrizes podem ser formalizados; portanto, primeiro voc√™ precisa destacar um conjunto de regras que podem ser facilmente entendidas a partir da anota√ß√£o da API. <br><br>  Na primeira vers√£o, identificamos as seguintes regras: <br><br><ol><li>  Verifique as descri√ß√µes da API.  Como dissemos no artigo anterior, voc√™ pode criar uma documenta√ß√£o bonita com base na anota√ß√£o da API.  Isso significa que cada recurso, par√¢metro de consulta e resposta deve ter uma descri√ß√£o que forne√ßa todas as informa√ß√µes necess√°rias para qualquer usu√°rio de nossa API.  Parece um pouco, mas como √© f√°cil mostrar aos desenvolvedores que suas anota√ß√µes n√£o s√£o ricas em descri√ß√µes! </li><li>  Verificando a presen√ßa e a corre√ß√£o dos exemplos.  As linguagens de anota√ß√£o da API tamb√©m permitem descrever exemplos.  Por exemplo, em resposta, podemos adicionar um exemplo de resposta de servi√ßo real, algo da vida real.  O uso de exemplos informa como o terminal deve ser usado e funcionando, e verificamos exemplos atrav√©s da an√°lise est√°tica de anota√ß√µes. </li><li>  Valida√ß√£o de c√≥digos de resposta HTTP.  O padr√£o HTTP define um grande n√∫mero de c√≥digos, mas eles podem ser interpretados de maneiras diferentes.  Nossa diretriz formaliza o uso de c√≥digos.  Tamb√©m limitamos a aplicabilidade de c√≥digos diferentes de acordo com o m√©todo HTTP.  Por exemplo, o c√≥digo 201, de acordo com a especifica√ß√£o HTTP, √© retornado quando um recurso √© criado.  Portanto, o retorno GET 201 ser√° uma chamada de ativa√ß√£o (o c√≥digo √© usado incorretamente ou o GET cria o recurso).  Portanto, nossa API de diretrizes pro√≠be esse uso.  Al√©m disso, os arquitetos fixaram conjuntos de c√≥digos para cada m√©todo e agora os verificamos no modo est√°tico no n√≠vel das anota√ß√µes. </li><li>  Verificando m√©todos HTTP.  Todo mundo sabe que o protocolo HTTP possui um conjunto de m√©todos padr√£o (GET, POST, PUT etc.) e tamb√©m possibilita o uso de m√©todos personalizados.  Nossa API de diretrizes descreve m√©todos permitidos que s√£o permitidos, mas indesej√°veis ‚Äã‚Äã(OPTIONS), bem como completamente proibidos (s√≥ podem ser usados ‚Äã‚Äãcom a ben√ß√£o dos arquitetos).  Proibido incluir o m√©todo HEAD padr√£o, bem como quaisquer m√©todos personalizados.  Tudo isso tamb√©m √© f√°cil de verificar nas anota√ß√µes dos contratos. </li><li>  Verifica√ß√£o de direitos de acesso.  Esperamos que em 2019 a necessidade de suporte √† autoriza√ß√£o n√£o exija explica√ß√µes adicionais.  Uma boa documenta√ß√£o deve incluir informa√ß√µes sobre quais fun√ß√µes a API suporta e quais m√©todos de API est√£o dispon√≠veis para cada fun√ß√£o.  Al√©m de documentar informa√ß√µes sobre o modelo, registrado no n√≠vel da anota√ß√£o, permite que voc√™ fa√ßa coisas muito mais interessantes em din√¢mica, no entanto, falaremos sobre isso no pr√≥ximo artigo. </li><li>  Valida√ß√£o de nomea√ß√£o.  Alivia uma dor de cabe√ßa ao usar abordagens diferentes para nomear entidades.  Em geral, existem dois "campos" - apoiadores do CamelCase e snake_case.Camelcase - quando cada palavra come√ßa com uma letra mai√∫scula e snake_case - quando as palavras s√£o separadas por sublinhados e tudo √© escrito em letras min√∫sculas.  Em diferentes idiomas, √© costume dar nomes de maneiras diferentes.  Por exemplo, snake_case √© aceito em Python e CamelCase √© adotado em Go ou Java.  Fizemos nossa pr√≥pria escolha universal para todos os projetos e corrigimos as diretrizes da API.  Portanto, atrav√©s de anota√ß√µes, verificamos os nomes dos recursos e par√¢metros estaticamente; </li><li>  Valida√ß√£o de cabe√ßalhos personalizados.  Este √© outro exemplo de uma verifica√ß√£o de nomenclatura, mas est√° ligada especificamente √†s cabe√ßas.  Na Acronis, √© habitual usar o formato no formato X-Custom-Header-Name (apesar de esse formato estar obsoleto).  E controlamos sua conformidade no n√≠vel das anota√ß√µes. </li><li>  Verifique o suporte HTTPS.  Qualquer servi√ßo moderno deve oferecer suporte a HTTPS, e alguns acreditam que trabalhar com HTTP atualmente √© geralmente uma m√° not√≠cia.  Portanto, a anota√ß√£o RAML ou Swagger deve ser indicada.  que o microsservi√ßo suporta HTTPS sem HTTP. </li><li>  Verifique a estrutura do URI.  Em tempos pr√©-hist√≥ricos, isto √©, antes do lan√ßamento da API Guideline, o URI da solicita√ß√£o parecia diferente em diferentes servi√ßos: em algum lugar / api / 2, em algum lugar / api / service_name / v2 e assim por diante.  Agora, em nossas diretrizes, uma estrutura padr√£o de URI √© definida para todas as nossas APIs.  O manual descreve como eles devem parecer para n√£o criar confus√£o. </li><li>  Verificando a compatibilidade de novas vers√µes.  Outro fator que qualquer autor de API deve ter em mente √© a compatibilidade com vers√µes anteriores.  √â importante verificar se o c√≥digo criado com base na API antiga pode funcionar com a nova vers√£o.  Com base nessa altera√ß√£o, pode ser dividido em duas categorias: quebrando a compatibilidade com vers√µes anteriores e compat√≠vel.  Todo mundo sabe que quebrar altera√ß√µes √© inaceit√°vel e, se voc√™ quiser melhorar drasticamente alguma coisa, o desenvolvedor deve lan√ßar uma nova vers√£o da API. Mas todos podem cometer erros, ent√£o nosso outro objetivo no est√°gio de verifica√ß√µes est√°ticas √© ignorar apenas as altera√ß√µes compat√≠veis e xingar as incompat√≠veis.  Sup√µe-se que a anota√ß√£o, como o c√≥digo, seja armazenada no reposit√≥rio e, portanto, tenha todo o hist√≥rico de altera√ß√µes.  Portanto, podemos verificar nosso HTTP REST para compatibilidade com vers√µes anteriores.  Por exemplo, a adi√ß√£o de (m√©todo, par√¢metro, c√≥digo de resposta) compatibilidade n√£o viola e a remo√ß√£o pode causar perda de compatibilidade.  E isso j√° pode ser verificado no n√≠vel da anota√ß√£o. </li></ol><br><br> <i><img src="https://habrastorage.org/webt/kt/vo/wc/ktvowckxsyc4hujr2owbwmvy2qe.png"><br></i>  <i>Quando n√£o h√° descri√ß√µes</i> <i><br><img src="https://habrastorage.org/webt/po/dv/k6/podvk6eqjgnydciv-jzbbw7-nm4.png"><br></i>  <i>Quando houver descri√ß√µes</i> <i><br></i> <br><h3>  Conclus√µes </h3><br>  A an√°lise est√°tica das anota√ß√µes √© necess√°ria para verificar (n√£o, n√£o a qualidade do servi√ßo), mas a qualidade da API.  Esse est√°gio permite alinhar as interfaces do programa entre si, para que as pessoas trabalhem em um ambiente claro e compreens√≠vel, onde tudo seja razoavelmente previs√≠vel. <br><br>  Obviamente, s√≥ √© necess√°rio lidar com esse formalismo em empresas grandes o suficiente, quando a verifica√ß√£o manual de todas as correspond√™ncias √© muito longa, cara e n√£o confi√°vel.  Uma pequena startup simplesmente n√£o precisa dela.  Pelo menos por enquanto.  Mas se, no seu futuro, houver planos de se tornar um unic√≥rnio, como o Akronis, as verifica√ß√µes est√°ticas e a API Guideline o ajudar√£o. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt470910/">https://habr.com/ru/post/pt470910/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt470892/index.html">Implementa√ß√£o simples de pequenas CAM no FPGA</a></li>
<li><a href="../pt470894/index.html">Bullet</a></li>
<li><a href="../pt470902/index.html">Alto desempenho e particionamento nativo: Zabbix com suporte ao TimescaleDB</a></li>
<li><a href="../pt470904/index.html">O caminho mais suave e peludo do aprendizado de m√°quina e das redes neurais profundas</a></li>
<li><a href="../pt470908/index.html">Pela primeira vez no mundo, com a ajuda de tecnologias aditivas, foi obtido um conjunto de motores de aeronaves de grande porte</a></li>
<li><a href="../pt470916/index.html">O ponto de verifica√ß√£o eletr√¥nico "mais barato" na R√∫ssia controlado a partir de um smartphone</a></li>
<li><a href="../pt470918/index.html">F # 9: Op√ß√£o de tipo</a></li>
<li><a href="../pt470920/index.html">Mais de 5 maneiras de conectar-se a uma nuvem DataLine</a></li>
<li><a href="../pt470922/index.html">An√∫ncio do mitap ThinkJava # 10 em Kharkov</a></li>
<li><a href="../pt470924/index.html">Por que para o novo projeto eu peguei o Robot Framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>