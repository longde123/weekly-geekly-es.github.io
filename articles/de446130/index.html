<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¥üèº ü§öüèº üë©üèº Ereignisaggregator f√ºr Ereignis Unity3d üïë üë¶üèΩ üôã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Idee, einen eigenen erweiterten Ereignisaggregator f√ºr Unity3d zu schreiben, ist l√§ngst √ºberf√§llig. Nachdem ich mehrere Artikel zu diesem Thema ge...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ereignisaggregator f√ºr Ereignis Unity3d</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446130/">  Die Idee, einen eigenen erweiterten Ereignisaggregator f√ºr Unity3d zu schreiben, ist l√§ngst √ºberf√§llig.  Nachdem ich mehrere Artikel zu diesem Thema gelesen hatte, stellte ich fest, dass es nicht genug ‚ÄûRichtiges‚Äú (in Unity3d) und den f√ºr mich erforderlichen Aggregator gibt. Alle L√∂sungen sind reduziert und verf√ºgen nicht √ºber die erforderliche Funktionalit√§t. <br><br><h3>  Erforderliche Funktionalit√§t: </h3><br><ol><li>  Jede Klasse kann jedes Ereignis abonnieren (h√§ufig bilden Aggregatoren in einer Einheit bestimmte Gameobject-Abonnenten). </li><li>  Die M√∂glichkeit des doppelten Abonnierens einer bestimmten Instanz f√ºr ein bestimmtes Ereignis sollte ausgeschlossen werden (in Standardtools m√ºssen Sie dies selbst befolgen). </li><li>  Es sollte sowohl manuelles als auch automatisches Abbestellen von Funktionen geben, wenn eine Instanz gel√∂scht oder Monobekh deaktiviert wird (ich m√∂chte abonnieren und kein Dampfbad nehmen, das der Abonnent pl√∂tzlich den Huf zur√ºckwirft). </li><li>  Ereignisse sollten in der Lage sein, Daten / Links beliebiger Komplexit√§t zu √ºbertragen (ich m√∂chte in einer Zeile abonnieren und den gesamten Datensatz ohne Probleme abrufen). </li></ol><a name="habracut"></a><br><h3>  Wo kann man es anwenden? </h3><br><ol><li>  Dies ist ideal f√ºr die Benutzeroberfl√§che, wenn Daten von einem Objekt ohne Verbindung weitergeleitet werden m√ºssen. </li><li>  Meldungen √ºber Daten√§nderungen, einige Analoga des reaktiven Codes. </li><li>  Zur Abh√§ngigkeitsinjektion </li><li>  Globale R√ºckrufe </li></ol><br><h3>  Schwachstellen </h3><br><ol><li> Aufgrund von √úberpr√ºfungen toter Abonnenten und Takes (ich werde sp√§ter offenbaren) ist der Code langsamer als √§hnliche L√∂sungen </li><li>  Klasse / Struktur wird als Kern des Ereignisses verwendet. Um keinen Speicher + das Hauptproblem zuzuweisen, wird nicht empfohlen, Ereignisse im Update als Spam zu versenden. </li></ol><br><h3>  Allgemeine Ideologie </h3><br>  Die allgemeine Ideologie ist, dass eine Veranstaltung f√ºr uns ein spezifisches und relevantes Datenpaket ist.  Angenommen, wir haben eine Taste auf einer Schnittstelle / einem Joystick gedr√ºckt.  Und wir m√∂chten ein Ereignis mit Anzeichen f√ºr das Dr√ºcken einer bestimmten Taste zur weiteren Verarbeitung senden.  Das Ergebnis der Verarbeitung von Klicks sind visuelle √Ñnderungen an der Benutzeroberfl√§che und eine Aktion in der Logik.  Dementsprechend kann die Verarbeitung / das Abonnement an zwei verschiedenen Orten erfolgen. <br><br>  <b>Wie der Ereignisk√∂rper / das Datenpaket in meinem Fall aussieht:</b> <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel f√ºr einen Ereignisk√∂rper</b> <div class="spoiler_text"><pre><code class="javascript hljs">public struct ClickOnButtonEvent   {     public int ButtonID; <span class="hljs-comment"><span class="hljs-comment">//     enum    }</span></span></code> </pre> <br></div></div><br>  <b>Wie das Veranstaltungsabonnement aussieht:</b> <br><br><pre> <code class="javascript hljs">public <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AddListener&lt;T&gt;(object listener, Action&lt;T&gt; action)</code> </pre><br>  Um sich anzumelden, m√ºssen wir Folgendes angeben: <br>  Ein Objekt, das ein Abonnent ist (normalerweise ist es die Klasse selbst, in der sich das Abonnement befindet, dies ist jedoch nicht erforderlich. Der Abonnent kann eine der Klasseninstanzen aus den Klassenfeldern angeben. <br>  Typ / Ereignis, das wir abonnieren.  Dies ist die Schl√ºsselessenz dieses Aggregators. F√ºr uns ist eine bestimmte Art von Klasse ein Ereignis, das wir abh√∂ren und verarbeiten. <br>  Am besten in Awake und OnEnable abonnieren; <br><br>  <b>Beispiel</b> <br><br><pre> <code class="javascript hljs">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class"> </span></span>{ private <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Awake() { EventAggregator.AddListener&lt;ClickOnButtonEvent&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, ClickButtonListener); } private <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ClickButtonListener(ClickOnButtonEvent obj) { Debug.Log(<span class="hljs-string"><span class="hljs-string">"  "</span></span> + obj.ButtonID); } }</code> </pre><br><h3>  Betrachten Sie einen komplexeren Fall, um zu verdeutlichen, was der Chip ist </h3><br>  <b>Wir haben Charaktersymbole, die:</b> <br><ol><li>  Wissen Sie, an welchen Charakter sie gebunden sind. </li><li>  Reflektieren Sie die Menge an Mana, HP, Exp und Status (Bet√§ubung, Blindheit, Angst, Wahnsinn). </li></ol><br>  <b>Und hier k√∂nnen Sie mehrere Veranstaltungen durchf√ºhren</b> <br><br>  So √§ndern Sie die Indikatoren: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> struct CharacterStateChanges { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Character Character; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Hp; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Mp; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Xp; }</code> </pre> <br>  So √§ndern Sie den negativen Status: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> struct CharacterNegativeStatusEvent { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Character Character; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Statuses Statuses; <span class="hljs-comment"><span class="hljs-comment">//enum  }</span></span></code> </pre><br>  Warum bestehen wir in beiden F√§llen die Zeichenklasse?  Hier ist der Teilnehmer und sein Handler: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ EventAggregator.AddListener&lt;CharacterNegativeStatusEvent&gt; (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, CharacterNegativeStatusListener); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CharacterNegativeStatusListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CharacterNegativeStatusEvent obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj.Character != _character) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; _currentStatus = obj.Statuses; }</code> </pre><br>  Dies ist der Marker, anhand dessen wir das Ereignis verarbeiten und verstehen, was genau wir brauchen. <br>  <b>Nehmen Sie an, Sie abonnieren direkt die Zeichenklasse.</b>  <b>Und sie spammen?</b> <br>  Es wird schwierig zu deb√ºtieren sein, es ist besser f√ºr eine Gruppe von Klassen / Ereignissen, ein eigenes separates Ereignis zu erstellen. <br><br>  <b>Warum sollte man innerhalb des Events einfach nicht den Charakter setzen und alles daraus nehmen?</b> <br>  √úbrigens ist es m√∂glich, aber h√§ufig gibt es in Klassen Sichtbarkeitsbeschr√§nkungen, und die f√ºr das Ereignis erforderlichen Daten sind m√∂glicherweise von au√üen nicht sichtbar. <br><br>  <b>Ist die Klasse zu schwer, um als Marker verwendet zu werden?</b> <br>  Tats√§chlich wird in den meisten F√§llen kein Marker ben√∂tigt, eine Gruppe aktualisierter Klassen ist eher selten.  Normalerweise ben√∂tigt eine bestimmte Entit√§t ein Ereignis - ein Controller- / Ansichtsmodell, das normalerweise den Status des ersten Zeichens anzeigt.  Und so gibt es immer eine banale L√∂sung - IDs verschiedener Typen (von Inam bis zu komplexem Hash usw.). <br><br><h3>  Was ist unter der Haube und wie funktioniert es? </h3><br><div class="spoiler">  <b class="spoiler_title">Direkt Aggregatorcode</b> <div class="spoiler_text"><pre> <code class="java hljs">namespace GlobalEventAggregator <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> delegate <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> EventHandler&lt;T&gt;(T e); { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventContainer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDebugable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> event EventHandler&lt;T&gt; _eventKeeper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly Dictionary&lt;WeakReference, EventHandler&lt;T&gt;&gt; _activeListenersOfThisType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;WeakReference, EventHandler&lt;T&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> string Error = <span class="hljs-string"><span class="hljs-string">"null"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasDuplicates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object listener)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _activeListenersOfThisType.Keys.Any(k =&gt; k.Target == listener); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddToEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object listener, EventHandler&lt;T&gt; action)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newAction = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WeakReference(listener); _activeListenersOfThisType.Add(newAction, action); _eventKeeper += _activeListenersOfThisType[newAction]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveFromEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object listener)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentEvent = _activeListenersOfThisType.Keys.FirstOrDefault(k =&gt; k.Target == listener); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentEvent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { _eventKeeper -= _activeListenersOfThisType[currentEvent]; _activeListenersOfThisType.Remove(currentEvent); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventContainer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object listener, EventHandler&lt;T&gt; action)</span></span></span><span class="hljs-function"> </span></span>{ _eventKeeper += action; _activeListenersOfThisType.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WeakReference(listener), action); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T t)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_activeListenersOfThisType.Keys.Any(k =&gt; k.Target.ToString() == Error)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> failObjList = _activeListenersOfThisType.Keys.Where(k =&gt; k.Target.ToString() == Error).ToList(); foreach (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fail in failObjList) { _eventKeeper -= _activeListenersOfThisType[fail]; _activeListenersOfThisType.Remove(fail); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_eventKeeper != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) _eventKeeper(t); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> string </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DebugInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ string info = string.Empty; foreach (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c in _activeListenersOfThisType.Keys) { info += c.Target.ToString() + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> info; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventAggregator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Dictionary&lt;Type, object&gt; GlobalListeners = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Type, object&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventAggregator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SceneManager.sceneUnloaded += ClearGlobalListeners; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClearGlobalListeners</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Scene scene)</span></span></span><span class="hljs-function"> </span></span>{ GlobalListeners.Clear(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AddListener&lt;T&gt;(object listener, Action&lt;T&gt; action) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = typeof(T); EventHandler&lt;T&gt; handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventHandler&lt;T&gt;(action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GlobalListeners.ContainsKey(key)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lr = (EventContainer&lt;T&gt;)GlobalListeners[key]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lr.HasDuplicates(listener)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; lr.AddToEvent(listener, handler); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } GlobalListeners.Add(key, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventContainer&lt;T&gt;(listener, handler)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Invoke&lt;T&gt;(T data) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = typeof(T); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!GlobalListeners.ContainsKey(key)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventContainer = (EventContainer&lt;T&gt;)GlobalListeners[key]; eventContainer.Invoke(data); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> RemoveListener&lt;T&gt;(object listener) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = typeof(T); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GlobalListeners.ContainsKey(key)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventContainer = (EventContainer&lt;T&gt;)GlobalListeners[key]; eventContainer.RemoveFromEvent(listener); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> string </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DebugInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ string info = string.Empty; foreach (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> listener in GlobalListeners) { info += <span class="hljs-string"><span class="hljs-string">"     "</span></span> + listener.Key.ToString() + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = (IDebugable)listener.Value; info += t.DebugInfo() + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> info; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDebugable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">string </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DebugInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } }</code> </pre> <br></div></div><br>  <b>Beginnen wir mit dem Haupt</b> <br><br>  Dies ist ein W√∂rterbuch, in dem der Schl√ºssel Typ und der Wert Container ist <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventContainer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDebugable</span></span></span></span></code> </pre> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Dictionary&lt;Type, object&gt; GlobalListeners = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Type, object&gt;();</code> </pre> <br>  Warum speichern wir den Container als Objekt?  Das W√∂rterbuch kann keine Generika speichern.  Dank des Schl√ºssels k√∂nnen wir das Objekt jedoch schnell auf den gew√ºnschten Typ bringen. <br><br>  <b>Was enth√§lt der Container?</b> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> event EventHandler&lt;T&gt; _eventKeeper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly Dictionary&lt;WeakReference, EventHandler&lt;T&gt;&gt; _activeListenersOfThisType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;WeakReference, EventHandler&lt;T&gt;&gt;();</code> </pre> <br>  Es enth√§lt eine generische Multidelegate und eine Sammlung, in der der Schl√ºssel das Objekt ist, das der Abonnent ist, und der Wert dieselbe Handlermethode ist.  Tats√§chlich enth√§lt dieses W√∂rterbuch alle Objekte und Methoden, die zu diesem Typ geh√∂ren.  Infolgedessen rufen wir ein Multidelegate auf, und er ruft alle Abonnenten an. Dies ist ein ‚Äûehrliches‚Äú Ereignissystem, bei dem es keine Einschr√§nkungen f√ºr den Abonnenten gibt. In den meisten anderen Aggregatoren wird jedoch eine Sammlung von Klassen, die entweder von einer speziellen Schnittstelle verallgemeinert oder von einer Klasse geerbt werden, die das System implementiert, unter der Haube iteriert Nachrichten. <br><br>  Wenn ein Multidelegate aufgerufen wird, wird gepr√ºft, ob tote Schl√ºssel vorhanden sind, die Sammlung wird von Leichen gereinigt, und anschlie√üend wird ein Multidelegate mit relevanten Abonnenten aufgenommen.  Dies braucht Zeit, aber wenn die Funktionalit√§t der Ereignisse getrennt ist, hat ein Ereignis 3-5 Abonnenten, sodass die √úberpr√ºfung nicht so be√§ngstigend ist und der Vorteil des Komforts offensichtlicher ist.  F√ºr Netzwerk-Storys mit tausend oder mehr Abonnenten ist es besser, diesen Aggregator nicht zu verwenden.  Obwohl die Frage offen bleibt - wenn Sie die Pr√ºfung auf Leichen entfernen, was schneller ist -, iterieren Sie √ºber ein Array von Abonnenten von 1k oder rufen Sie einen Multi-Delegaten von 1k-Abonnenten an. <br><br><h3>  Merkmale der Verwendung </h3><br>  Ein Abonnement wird am besten in Awake gepusht. <br><br>  Wenn ein Objekt aktiv ein- und ausgeschaltet wird, ist es besser, Awake und OnEnable zu abonnieren. Es wird nicht zweimal signiert, aber die M√∂glichkeit, dass ein inaktives GameObject f√ºr tot gehalten wird, wird ausgeschlossen. <br><br>  Rechnungsereignisse sind besser nicht vor dem Start, wenn alle Abonnenten erstellt und registriert werden. <br><br>  Der Aggregator bereinigt die Liste beim Entladen der Szene.  In einigen Aggregatoren wird empfohlen, das Laden der Szene zu bereinigen. Dies ist eine Datei. Das Ereignis zum Laden der Szene erfolgt nach Awake / OnEnable. Die hinzugef√ºgten Abonnenten werden gel√∂scht. <br><br>  Der Aggregator hat - √∂ffentliche statische Zeichenfolge DebugInfo (), Sie k√∂nnen sehen, welche Klassen welche Ereignisse abonniert haben. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><b>GitHub-Repository</b></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de446130/">https://habr.com/ru/post/de446130/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de446118/index.html">Open Rack v3: Was erwartet Sie vom neuen Standard f√ºr die Server-Rack-Architektur?</a></li>
<li><a href="../de446120/index.html">US-Telekommunikation zur Bek√§mpfung von Telefon-Spam</a></li>
<li><a href="../de446124/index.html">Digitale Veranstaltungen in Moskau vom 1. bis 7. April</a></li>
<li><a href="../de446126/index.html">Freizeitgedanken einer unt√§tigen Person √ºber Kryptographie und Datenschutz</a></li>
<li><a href="../de446128/index.html">R√∂ntgenphonogramme kehren zur√ºck: Massive Attacke, Jonsi und andere ver√∂ffentlichten Aufzeichnungen ‚Äûon the Bones‚Äú</a></li>
<li><a href="../de446132/index.html">92,7% machen Backups, der Datenverlust stieg um 30%. Was ist los?</a></li>
<li><a href="../de446134/index.html">Abh√§ngigkeitsinjektion beim Flattern</a></li>
<li><a href="../de446136/index.html">Meine Marmormaschine 3D gedruckt</a></li>
<li><a href="../de446142/index.html">Flache Erde: Experimente und Beweise</a></li>
<li><a href="../de446144/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 292 (25. M√§rz - 31. M√§rz)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>