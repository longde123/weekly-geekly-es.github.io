<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüíº üë©üèΩ‚Äç‚öïÔ∏è üöø Apple Wallet Was ist das und wie integrieren Sie Ihre Karte darin? ‚öæÔ∏è üôáüèæ üíí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es ist allgemein anerkannt, dass Wallet nicht der beliebteste Dienst in der GUS ist. Aber bereits im zweiten Projekt in Folge stellt der Kunde die Auf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apple Wallet Was ist das und wie integrieren Sie Ihre Karte darin?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/agima/blog/428437/"><p>  Es ist allgemein anerkannt, dass Wallet nicht der beliebteste Dienst in der GUS ist.  Aber bereits im zweiten Projekt in Folge stellt der Kunde die Aufgabe "Integration mit Wallet vornehmen".  Aus diesem Grund habe ich beschlossen, diesen Artikel zu schreiben, um √ºber den gesamten Service zu sprechen und zu zeigen, wie ich mein Produkt in ihn integrieren kann. </p><br><p>  Was ist eine Brieftasche?  Sie k√∂nnen verschiedene Arten von Karten in Ihrem Telefon behalten (Tickets, Rabattkarten usw.), was den Benutzern des Produkts das Leben erleichtert.  Dar√ºber hinaus ist es m√∂glich, Informationen √ºber die Karte durch Push-Benachrichtigungen zu aktualisieren. Dies ist jedoch ein Thema f√ºr einen separaten Artikel.  Wenn Sie jedoch eine Karte / ein Ticket / ein Abonnement haben, die bzw. das in das Telefon integriert werden kann, gibt es eine L√∂sung!  Wie es geht - lesen Sie unten. </p><a name="habracut"></a><br><p> In der Regel ist Ihr Server f√ºr die Erstellung der Karte verantwortlich.  Die Anwendung empf√§ngt die Karte in Form einer .pkpass-Datei und √ºber die Anwendung kann der Benutzer die Karte zu Wallet hinzuf√ºgen. </p><br><h2 id="struktura-karty">  Kartenstruktur </h2><br><p>  Was ist die Karte aus Sicht des Entwicklers?  Eine Karte ist ein Archiv mit der Erweiterung .pkpass.  Es enth√§lt alle Daten, die f√ºr die Anzeige und den Betrieb der Karte erforderlich sind.  Der Inhalt des Archivs ist in der folgenden Tabelle aufgef√ºhrt. </p><br><table><tbody><tr><th>  Datei </th><th>  Termin </th></tr><tr><td>  background.png </td><td>  Hintergrundbild f√ºr die Karte. </td></tr><tr><td>  footer.png </td><td>  Bild neben dem Barcode </td></tr><tr><td>  icon.png </td><td>  Symbol f√ºr Benachrichtigungen und Briefe </td></tr><tr><td>  logo.png </td><td>  Kartenlogo.  Oben links angezeigt </td></tr><tr><td>  manifest.json </td><td>  Registrierung aller enthaltenen Dateien </td></tr><tr><td>  Unterschrift </td><td>  PKCS7-Signatur </td></tr><tr><td>  pass.json </td><td>  Aussehen und Karteninformationen </td></tr><tr><td>  strip.png </td><td>  Bild befindet sich hinter der Hauptbeschreibung der Karte </td></tr><tr><td>  thumbnail.png </td><td>  Zus√§tzliches Bild (bitte angeben) </td></tr></tbody></table><br><p>  Folgende Kartentypen stehen zur Verf√ºgung: </p><br><ul><li>  <b>Bordkarte:</b> mit dem Flugzeug oder dem Zug.  Normalerweise gilt der Gutschein f√ºr eine Reise. </li><li>  <b>Gutschein:</b> f√ºr Gutscheine und Sonderangebote; </li><li>  <b>Veranstaltungsticket:</b> Kann sowohl f√ºr eine Veranstaltung als auch f√ºr eine ganze Saison verwendet werden. </li><li>  <b>Rabattkarte:</b> Kundenkarten, Rabatt- oder Geschenkkarten; </li><li>  <b>√úbersichtskarte:</b> Wenn f√ºr Ihren Fall keine der oben genannten Punkte zutrifft: Zum Beispiel eine Karte f√ºr die Fahrt mit der U-Bahn oder ein Pass f√ºr das Fitnessstudio. </li></ul><br><p>  Betrachten Sie schematisch das Erscheinungsbild verschiedener Karten.  Bilder werden am besten wie in der obigen Tabelle angegeben benannt. </p><br><h3>  Bordkarte </h3><br><img src="https://habrastorage.org/webt/8m/s6/cy/8ms6cyz55rve1igxt_xfv2e034i.png"><br><h3>  Gutschein </h3><br><img src="https://habrastorage.org/webt/-r/l-/dk/-rl-dknkbsqnkuim5-kqog6ceuu.png"><br><h3>  Veranstaltungsticket </h3><br><img src="https://habrastorage.org/webt/rr/r9/jh/rrr9jh2ho29rfmht7xrf0z7pmes.png"><br><h3>  Gemeinschaftskarte </h3><br><img src="https://habrastorage.org/webt/az/zc/hg/azzchgo25cvpj_gcu_oof1vh1k8.png"><br><h3>  Rabattkarte </h3><br><img src="https://habrastorage.org/webt/zl/zt/ft/zlztft7igalmerx8rhabnxorwfc.png"><br><h1 id="struktura-passjson">  Pass.json-Struktur </h1><br><p>  Erforderliche Felder.  Enth√§lt Pass-Typ-ID, Team-ID, Organisationsname usw. <br>  Schl√ºssel f√ºr verwandte Anwendungen.  Wird ben√∂tigt, um Anwendungen anzuzeigen, die der Karte "zugeordnet" werden m√ºssen. <br>  Schl√ºssel "Ablaufdatum" Karten. <br>  Schl√ºssel von Relevanz.  Zum Beispiel die Koordinaten des Bereichs, in dem die Karte verwendet werden kann, oder der Beginn des Ereignisses, f√ºr das sie bestimmt ist. <br>  Der Schl√ºssel ist Stil.  Zu Beginn des Artikels wurden 5 Arten von Karten f√ºr Wallet aufgelistet.  Jeder von ihnen hat seinen eigenen Stil.  Ein solcher Schl√ºssel muss unbedingt einer sein. <br>  Schl√ºssel f√ºr die visuelle Gestaltung der Karte.  Zus√§tzlich zum Offensichtlichen enthalten sie Informationen √ºber den auf der Karte angezeigten Barcode. <br>  Webdienstschl√ºssel.  Sie k√∂nnen Webdienste verwenden, um mit der Karte zu interagieren, und sie beispielsweise automatisch aktualisieren. <br>  NFC-Schl√ºssel.  Enthalten zus√§tzliche Informationen f√ºr Apple Pay-Transaktionen. </p><br><p>  Nun zu allem im Detail. </p><br><h2>  Erforderliche Felder </h2><br><table><tbody><tr><th>  <nobr>Geben Sie JSON ein</nobr> </th><th>  <nobr>Datentyp</nobr> </th><th>  <nobr>Beschreibung</nobr> </th></tr><tr><td>  Beschreibung </td><td>  String <br>  Lokalisiert </td><td>  Eine kurze Beschreibung der Karte.  Lokalisiert. </td></tr><tr><td>  formatVersion </td><td>  Int </td><td>  Dateiformatversion.  Der Wert muss 1 sein. </td></tr><tr><td>  <nobr>organisationsname</nobr> </td><td>  String <br>  Lokalisiert </td><td>  Der Name der Organisation, die die Karten ausstellt. </td></tr><tr><td>  <nobr>passTypeIdentifier</nobr> </td><td>  String </td><td>  Pass Type ID und Entwicklerkonto. </td></tr><tr><td>  <nobr>Seriennummer</nobr> </td><td>  String </td><td>  Seriennummer einer einzelnen Karte </td></tr><tr><td>  <nobr>teamIdentifier</nobr> </td><td>  String </td><td>  Team ID des Entwicklungsteams </td></tr></tbody></table><br><h2>  Schl√ºssel f√ºr verwandte Anwendungen </h2><br><table><tbody><tr><th>  <nobr>Geben Sie JSON ein</nobr> </th><th>  <nobr>Datentyp</nobr> </th><th>  <nobr>Beschreibung</nobr> </th></tr><tr><td>  <nobr>AssociatedStoreIdentifiers</nobr> </td><td>  [Int] </td><td>  Optional.  Die ID der mit der Karte verkn√ºpften Anwendungen.  Der erste, der mit dem aktuellen Ger√§t kompatibel ist, wird immer verwendet. </td></tr><tr><td>  <nobr>appLaunchURL</nobr> </td><td>  String </td><td>  URL, die beim √ñffnen an die Anwendung √ºbergeben wird </td></tr></tbody></table><br><h2>  Stilschl√ºssel </h2><br><table><tbody><tr><th>  <nobr>Geben Sie JSON ein</nobr> </th><th>  <nobr>Datentyp</nobr> </th><th>  <nobr>Beschreibung</nobr> </th></tr><tr><td>  <nobr>Prim√§rfelder</nobr> </td><td>  [JSON] </td><td>  Grundlegende Informationen zur Karte. </td></tr><tr><td>  <nobr>sekund√§re Felder</nobr> </td><td>  [JSON] </td><td>  Hintergrundinformationen. </td></tr><tr><td>  <nobr>Hilfsfelder</nobr> </td><td>  [JSON] </td><td>  Felder f√ºr zus√§tzliche Informationen.  Optional </td></tr><tr><td>  <nobr>headerFields</nobr> </td><td>  [JSON] </td><td>  Der Titel der Karte.  Es wird auch dann angezeigt, wenn die Karten in der Liste sichtbar sind. </td></tr><tr><td>  <nobr>Hilfsfelder</nobr> </td><td>  [JSON] </td><td>  Grundlegende Informationen zur Karte. </td></tr><tr><td>  <nobr>transitType</nobr> </td><td>  String </td><td>  Art des Transports f√ºr Ticketkarten.  Es kann folgende Werte annehmen: <br>  PKTransitTypeAir, <br>  PKTransitTypeBoat, <br>  PKTransitTypeBu`, <br>  PKTransitTypeGeneric, <br>  `PKTransitTypeTrain`. </td></tr><tr><td>  <nobr>backFields</nobr> </td><td>  [JSON] </td><td>  Array von Feldern, die f√ºr die R√ºckseite der Karte verantwortlich sind </td></tr></tbody></table><br><p>  JSON hat in diesem Fall die folgende Form: </p><br><pre><code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"key"</span></span> : <span class="hljs-string"><span class="hljs-string">"value1"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span> : <span class="hljs-string"><span class="hljs-string">"value2"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : <span class="hljs-string"><span class="hljs-string">"value3"</span></span></code> </pre> <br><p>  Der Wert durch den Werteschl√ºssel kann entweder numerisch oder als Zeichenfolge sein.  CurrencyCode zusammen mit dem Zeichenfolgenwert kann jedoch nicht verwendet werden.  Bei AuxiliaryFields und SecondaryFields kann es mehrere geben, und Sie sollten die L√§nge der in ihnen verwendeten Zeilen √ºberwachen. </p><br><h2>  Schl√ºssel f√ºr visuelles Design </h2><br><table><tbody><tr><th>  <nobr>Geben Sie JSON ein</nobr> </th><th>  <nobr>Datentyp</nobr> </th><th>  <nobr>Beschreibung</nobr> </th></tr><tr><td>  <nobr>Barcodes</nobr> </td><td>  [JSON] </td><td>  Informationen zum Barcode (siehe unten). </td></tr><tr><td>  <nobr>Hintergrundfarbe</nobr> </td><td>  Farbe als Schnur </td><td>  Hintergrundfarbe (# Fa32e4) </td></tr><tr><td>  <nobr>Vordergrundfarbe</nobr> </td><td>  Farbe als Schnur </td><td>  Beschriften Sie die Farbe mit Werten </td></tr><tr><td>  <nobr>groupingIdentifier</nobr> </td><td>  String </td><td>  Optional f√ºr Veranstaltungstickets und Transporttickets.  Karten mit demselben Stil - passTypeIdentifier und groupingIdentifier - werden gruppiert </td></tr><tr><td>  <nobr>labelColor</nobr> </td><td>  Farbe als Schnur </td><td>  Beschriften Sie Text mit Feldnamen </td></tr><tr><td>  <nobr>logoText</nobr> </td><td>  Lokalisierbare Zeichenfolge </td><td>  Text neben dem Logo angezeigt </td></tr></tbody></table><br><h2>  Barcode </h2><br><p>  Der wichtigste Teil der Karte.  Darin ist eine Kartenidentifikationsnummer eingen√§ht (z. B. eine physische Kartennummer oder eine Ticketnummer).  Es ist wichtig, dass der Scanner oder ein anderes Tool Codes in der richtigen Codierung lesen kann. </p><br><table><tbody><tr><th>  <nobr>Geben Sie JSON ein</nobr> </th><th>  <nobr>Datentyp</nobr> </th><th>  <nobr>Beschreibung</nobr> </th></tr><tr><td>  <nobr>altText</nobr> </td><td>  String </td><td>  Optionaler Text wird neben dem Barcode angezeigt, wenn der Barcode nicht gelesen wird. </td></tr><tr><td>  <nobr>Format</nobr> </td><td>  String </td><td>  Barcode-Format.  Kann Werte annehmen: PKBarcodeFormatQR, <br>  PKBarcodeFormatPDF417, <br>  PKBarcodeFormatAztec, <br>  PKBarcodeFormatCode128 </td></tr><tr><td>  <nobr>Nachricht</nobr> </td><td>  String </td><td>  Code oder Kartennummer in Barcode verschl√ºsselt. </td></tr><tr><td>  <nobr>messageEncoding</nobr> </td><td>  String </td><td>  Nachrichtenkodierung.  Normalerweise iso-8859-1 </td></tr></tbody></table><br><h2>  Lage </h2><br><p>  Diese Schl√ºssel sind f√ºr den Ort verantwortlich, an dem die Karte verwendet werden kann. </p><br><table><tbody><tr><th>  <nobr>Geben Sie JSON ein</nobr> </th><th>  <nobr>Datentyp</nobr> </th><th>  <nobr>Beschreibung</nobr> </th></tr><tr><td>  <nobr>Altiture</nobr> </td><td>  String </td><td>  Optionaler Text wird neben dem Barcode angezeigt, wenn der Barcode nicht gelesen wird. </td></tr><tr><td>  <nobr>Breitengrad</nobr> </td><td>  L√§ngengrad </td><td>  Breitengrad </td></tr><tr><td>  <nobr>L√§nge</nobr> </td><td>  Doppel </td><td>  Breitengrad </td></tr><tr><td>  <nobr>relevanterText</nobr> </td><td>  String </td><td>  Optionaler Text, der auf dem Sperrbildschirm angezeigt wird, wenn der Benutzer den Bereich der Karte betritt. </td></tr></tbody></table><br><h2>  R√ºckseite </h2><br><p>  Zus√§tzliche Informationen k√∂nnen im umgekehrten Informationsteil platziert werden: Nutzungsbedingungen, Richtlinien f√ºr die automatische Aktualisierung, Kontaktdaten und ein Link zu der Anwendung, zu der die Karte geh√∂rt.  Die Abbildung zeigt die Entsprechung der Felder in pass.json und das Erscheinungsbild der R√ºckseite der Karte.  Wenn sich im Wertefeld Links, Telefonnummern usw. befinden, werden diese automatisch hervorgehoben. </p><br><p><img src="https://habrastorage.org/webt/er/gx/ow/ergxowmbtn08dmjnv2lkrqlo3ku.png"></p><br><h1 id="sozdanie-karty-chast-2">  Erstellen Sie eine Karte.  Teil 2 </h1><br><p>  Also, die Bilder sind fertig, pass.json wird gebildet, es bleibt alles zusammen zu setzen.  F√ºllen Sie dazu manifest.json aus (siehe Tabelle 1), wo Sie alle Bilder und pass.json einf√ºgen m√ºssen.  Es stellt sich so etwas heraus: </p><br><pre> <code class="hljs go">. . . . . . <span class="hljs-string"><span class="hljs-string">"pass.json"</span></span> = <span class="hljs-number"><span class="hljs-number">303</span></span>c753abc39aa732ec74643d6db28348fe8a823; <span class="hljs-string"><span class="hljs-string">"strip.png"</span></span> = <span class="hljs-number"><span class="hljs-number">736d</span></span>01f84cb73d06e8a9932e43076d68f19461ff; <span class="hljs-string"><span class="hljs-string">"strip@2x.png"</span></span> = <span class="hljs-number"><span class="hljs-number">468f</span></span>a7bc93e6b55342b56fda09bdce7c829d7d46; . . . . . .</code> </pre> <br><p>  Ab diesem Zeitpunkt muss nichts mehr ge√§ndert werden, da der SHA nicht korrekt ist. Im Falle von √Ñnderungen muss der SHA neu generiert werden. </p><br><p>  Als N√§chstes m√ºssen Sie im B√ºro des Entwicklers eine Pass-Typ-ID erstellen und ein Zertifikat daf√ºr erstellen.  Die Vorgehensweise sollte mehr oder weniger vertraut sein, wenn Sie zuvor beispielsweise Bereitstellungsprofile erstellt haben. </p><br><img src="https://habrastorage.org/webt/2b/um/hu/2bumhu9wgoawlz1lt-qhieildna.png"><br><p>  Wechseln Sie als N√§chstes zum Schl√ºsselbund und exportieren Sie von dort das Apple Worldwide Developer Relation Certificate (WWDR) als .pem. </p><br><p><img src="https://habrastorage.org/webt/jg/kk/sl/jgkksl_tfac4e23hz7bk1swxhtq.png"></p><br><p>  Von dort exportieren wir die erstellte Pass Type ID als .p12.  Zu diesem Zeitpunkt werden Sie von der Haush√§lterin aufgefordert, das Passwort f√ºr das Zertifikat einzugeben.  In diesem Fall ist ein Passwort optional. <br>  Bitte beachten Sie, dass alle weiteren Aktionen in einem Ordner ausgef√ºhrt werden m√ºssen, in dem manifest.json, pass.json und images bereits liegen sollten. </p><br><p>  Jetzt m√ºssen Sie eine Signatur generieren, mit der wir das Archiv signieren.  Exportieren Sie zun√§chst die Pass Type ID und den Schl√ºssel dazu als .pem. </p><br><pre> <code class="hljs powershell">openssl pkcs12 <span class="hljs-operator"><span class="hljs-operator">-in</span></span> certificate.p12 <span class="hljs-literal"><span class="hljs-literal">-clcerts</span></span> <span class="hljs-literal"><span class="hljs-literal">-nokeys</span></span> <span class="hljs-literal"><span class="hljs-literal">-out</span></span> passcertificate.pem <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass: your_password</code> </pre> <br><p>  und </p><br><pre> <code class="hljs powershell">openssl pkcs12 <span class="hljs-operator"><span class="hljs-operator">-in</span></span> certificates.p12 <span class="hljs-literal"><span class="hljs-literal">-nocerts</span></span> <span class="hljs-literal"><span class="hljs-literal">-out</span></span> passkey.pem <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass: <span class="hljs-literal"><span class="hljs-literal">-passout</span></span> pass:new_password</code> </pre> <br><p>  Jetzt k√∂nnen wir eine Signatur erstellen.  Machen wir es zu einem Befehl: </p><br><pre> <code class="hljs powershell">openssl smime <span class="hljs-literal"><span class="hljs-literal">-binary</span></span> <span class="hljs-literal"><span class="hljs-literal">-sign</span></span> <span class="hljs-literal"><span class="hljs-literal">-certfile</span></span> WWDR.pem <span class="hljs-literal"><span class="hljs-literal">-signer</span></span> passcertificate.pem <span class="hljs-literal"><span class="hljs-literal">-inkey</span></span> passkey.pem <span class="hljs-operator"><span class="hljs-operator">-in</span></span> manifest.json <span class="hljs-literal"><span class="hljs-literal">-out</span></span> signature <span class="hljs-literal"><span class="hljs-literal">-outform</span></span> DER <span class="hljs-literal"><span class="hljs-literal">-passin</span></span> pass:___</code> </pre> <br><p>  Also, alles ist bereit f√ºr uns, es bleibt nur das Archiv zu sammeln, wir tun dies mit dem Befehl: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">zip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nameOfPass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pkpass</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">manifest</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">signature</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.png</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span>@<span class="hljs-keyword"><span class="hljs-keyword">2x</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">png</span></span> logo@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png icon.png icon@<span class="hljs-number"><span class="hljs-number">2</span></span>x.png icon@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png</code> </pre> <br><p>  Ich mache Sie darauf aufmerksam, dass alle Dateien, in die Sie das Datenarchiv f√ºr die Karte (.pkpass) aufnehmen m√∂chten, hier aufgelistet sein sollten. <br>  Als Ergebnis erhalten wir eine .pkpass-Datei, die auf dem Computer ge√∂ffnet werden kann.  Wir sehen eine Vorschau der Karte, deren Erscheinungsbild vom Erscheinungsbild des Telefons abweichen kann. <br>  All dies kann etwas einfacher gemacht werden.  Apple bietet das <code>signpass</code> Dienstprogramm ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apple Wallet-Beispielmessger√§te</a> ) an, das alle SHA-Berechnungen (die Datei <code>manifest.json</code> kann in Ruhe gelassen werden) und die Erstellung von Signaturen √ºbernimmt.  Um es zu verwenden, m√ºssen Sie ein Projekt <code>signpass</code> und die <code>signpass</code> Datei in einem Ordner mit allen erforderlichen Ressourcen <code>signpass</code> . </p><br><img src="https://habrastorage.org/webt/tj/jj/eo/tjjjeoqlhxzjumfr3nrg9ve8yhm.png"><br><p>  Im Allgemeinen sollte die Struktur ungef√§hr so ‚Äã‚Äãaussehen: </p><br><img src="https://habrastorage.org/webt/qc/pb/lr/qcpblrbdaw7piffxdehwa1whlpw.png"><br><p>  F√ºhren Sie als n√§chstes den Befehl aus: </p><br><pre> <code class="hljs powershell">./signpass <span class="hljs-literal"><span class="hljs-literal">-p</span></span> wallet</code> </pre> <br><p>  Brieftasche ist der Name des Ordners, in dem sich alle Ressourcen befinden.  Die Ausgabe ist wallet.pkpass.  Der Inhalt kann durch Entpacken von wallet.pkpass angezeigt werden. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">unzip</span></span> wallet.pkpass</code> </pre> <br><p>  Es ist m√∂glich, dass die Erstellung von pkpass an das Backend gesendet wird. In diesem Fall muss das Zertifikat f√ºr die Pass-Typ-ID in Form von .p12 und das Kennwort daf√ºr an die WWDR-Entwickler √ºbertragen werden. </p><br><h1 id="integraciya-s-prilozheniem">  Anwendungsintegration </h1><br><p>  Damit die Anwendung Wallet Karten hinzuf√ºgen kann, m√ºssen Sie diese Funktion in der App-ID und diese Funktion in den Funktionen des Projekts aktivieren. </p><br><img src="https://habrastorage.org/webt/yq/wo/py/yqwopyfu9nhk-_klilrcoczwe3m.png"><br><img src="https://habrastorage.org/webt/o-/se/ek/o-seekf9zbohe4jmwtcvnzfwes4.png"><br><p>  Dies ist f√ºr die vollst√§ndige korrekte Arbeit mit Wallet erforderlich.  Andernfalls ist es nicht m√∂glich, Karten aus der Brieftasche zu lesen, und es ist beispielsweise nicht m√∂glich zu verstehen, ob unsere Karte hinzugef√ºgt wurde oder nicht.  Es ist auch wichtig zu beachten, dass die Team-ID in pass.json mit der Team-ID √ºbereinstimmen muss, oder Sie m√ºssen sie manuell zu Berechtigungen hinzuf√ºgen. Dies kann die Situation beheben, aber ich habe dies nicht √ºberpr√ºft. </p><br><p><img src="https://habrastorage.org/webt/82/ow/p9/82owp9rv4gyaldwm0si77b5nn8m.png"></p><br><h2 id="dobavlenie-karty">  Karte hinzuf√ºgen </h2><br><p>  Das Hinzuf√ºgen von Karten ist sehr einfach: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passPath = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.path(forResource: <span class="hljs-string"><span class="hljs-string">"wallet"</span></span>, ofType: <span class="hljs-string"><span class="hljs-string">"pkpass"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error: <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span> = <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span>(nilLiteral: ()) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passData = <span class="hljs-type"><span class="hljs-type">NSData</span></span>(contentsOfFile: passPath) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pass = <span class="hljs-type"><span class="hljs-type">PKPass</span></span>(data: passData <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">Data</span></span>, error: error) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() passLibrary.addPasses([pass]) { (status) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(passLibrary.containsPass(pass)) }</code> </pre> <br><p>  Wiederum muss die .pkpass-Datei jedoch h√§ufiger von Ihrem Server heruntergeladen werden. <br>  Es ist erw√§hnenswert, dass PassKit ziemlich lesbare Fehler erzeugt, sodass Sie leicht verstehen k√∂nnen, was genau falsch gemacht wurde. </p><br><h2 id="poluchenie-informacii-o-dobavlennyh-kartah">  Informationen zu hinzugef√ºgten Karten abrufen </h2><br><p>  Um Informationen zu den in Wallet verf√ºgbaren Karten zu erhalten, die sich auf Ihre Anwendung beziehen, m√ºssen Sie sich an das PKPassLibrary-Objekt wenden. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passes = passLibrary.passes()</code> </pre> <br><p>  So k√∂nnen Sie verstehen, ob die Karte hinzugef√ºgt wurde oder nicht, und die Benutzeroberfl√§che aktualisieren.  Dar√ºber hinaus k√∂nnen √ºber PKPassLibrary Karten aktualisiert und gel√∂scht werden.  Karten k√∂nnen auch √ºber Webdienste aktualisiert werden. In diesem Artikel wird eine solche Option jedoch nicht ber√ºcksichtigt. </p><br><h1 id="proverka-na-unikalnost">  Eindeutigkeitspr√ºfung </h1><br><p>  Da in Ihrem Dienst die Karte in der Regel an ein Konto gebunden ist, m√ºssen Sie in der Anwendung h√∂chstwahrscheinlich feststellen, ob die Karte dem aktuellen Benutzer geh√∂rt.  Ich schlage vor, dies √ºber <code>serialNumber</code> .  <code>serialNumber</code> Sie beispielsweise die <code>serialNumber</code> des Benutzers oder die Kartennummer fest. </p><br><h1 id="testirovanie">  Testen </h1><br><p>  Apple bietet pkpass-Beispiele f√ºr verschiedene Typen, auf die Sie sich konzentrieren k√∂nnen. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apple Wallet Beispiele</a> <br>  Um zu sehen, wie die Karte aussieht, k√∂nnen Sie dem Projekt pkpass hinzuf√ºgen (siehe ‚ÄûHinzuf√ºgen einer Karte‚Äú).  Der Prozess des Hinzuf√ºgens / Entfernens wurde bereits oben erl√§utert. Es muss nur daran erinnert werden, dass die Anwendung die bereits hinzugef√ºgten Karten nicht sieht, wenn die Karte f√ºr Wallet auf dem Konto eines Entwicklers erstellt wurde und die Entwicklung selbst von einem anderen Konto aus durchgef√ºhrt wurde (relevant f√ºr Outsourcing-Unternehmen).  In diesem Fall k√∂nnen Sie problemlos Karten hinzuf√ºgen. <br>  Mit einem QR-Code-Scanner k√∂nnen Sie √ºberpr√ºfen, ob die Informationen im Barcode korrekt codiert sind.  Und es ist definitiv notwendig, die Richtigkeit der Arbeit mit diesem Scanner zu √ºberpr√ºfen. </p><br><h1 id="zaklyuchenie">  Fazit </h1><br><p>  Der Artikel untersuchte den Prozess des Erstellens und Entwerfens einer Karte sowie den Prozess der Integration in die Anwendung und m√∂gliche Probleme.  Ich habe absichtlich keine Probleme mit der Integration in Webdienste und Kartenaktualisierungen angesprochen, und ich hoffe, dies im n√§chsten Artikel zu tun. </p><br><h1 id="ispolzuemye-materialy">  Verwendete Materialien: </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Creating.html</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Reference/PassKit_Bundle/Chapters/TopLevel.html#//apple_ref/doc/uid/TP40012026-CH2-SW3</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://itechroof.wordpress.com/2015/11/30/apple-wallet-part-13/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Updating.html</a> </p><br><p>  Besonderer Dank geht an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">mehdzor</a> f√ºr das Entwicklerkonto f√ºr die Tests. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de428437/">https://habr.com/ru/post/de428437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de428423/index.html">Wie ein 34-Milliarden-Dollar-Deal zwischen IBM und Red Hat den IT-Markt ver√§ndern wird: Experten und Analysten</a></li>
<li><a href="../de428429/index.html">GOST R 34.10 elektronische Signatur von PDF-Dokumenten in der Office-Suite LibreOffice</a></li>
<li><a href="../de428431/index.html">Mehr als konzentrische Schichten</a></li>
<li><a href="../de428433/index.html">Private Pr√ºfungsanw√§lte</a></li>
<li><a href="../de428435/index.html">Was in PHP auf Russisch zu lesen?</a></li>
<li><a href="../de428439/index.html">Ohne Ensemble</a></li>
<li><a href="../de428441/index.html">GitHub-Kauf abgeschlossen. Was wird als n√§chstes passieren?</a></li>
<li><a href="../de428443/index.html">Abstimmung - √úberpr√ºfung der Datenintegrit√§t in verteilten Systemen</a></li>
<li><a href="../de428445/index.html">Wie wir in Helsinki einen Hackathon gemacht und verloren haben</a></li>
<li><a href="../de428447/index.html">Cloud Data Protection: Ein Leitfaden f√ºr Entwickler</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>