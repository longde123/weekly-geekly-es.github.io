<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ» ğŸ˜• ğŸ’ å¦‚ä½•åœ¨Phaserä¸­ç¼–å†™ä¸€ä¸ªSapperå¹¶è¿è¡ŒHTML5å¼€å‘äººå‘˜æµ‹è¯•ä»»åŠ¡ ğŸ¥  ğŸ‘©ğŸ¼ â˜”ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸‹åˆå¥½ï¼Œäº²çˆ±çš„åŒäº‹ä»¬ï¼ 

 æˆ‘çš„åå­—å«äºšå†å±±å¤§ï¼ˆAlexanderï¼‰ï¼Œæˆ‘æ˜¯HTML5æ¸¸æˆçš„å¼€å‘å•†ã€‚ 

 åœ¨æˆ‘å‘é€ç®€å†çš„å…¬å¸ä¹‹ä¸€ä¸­ï¼Œæˆ‘è¢«è¦æ±‚å®Œæˆæµ‹è¯•ä»»åŠ¡ã€‚ æˆ‘åŒæ„ï¼Œå¹¶åœ¨1å¤©åæ ¹æ®TOR HTML5å¼€å‘äº†è¯¥æ¸¸æˆã€‚ 



 å› ä¸ºæˆ‘æ­£åœ¨æ¥å—æ¸¸æˆç¼–ç¨‹æ–¹é¢çš„åŸ¹è®­ï¼Œå¹¶ä¸”ä¸ºäº†æ›´æœ‰æ•ˆåœ°ä½¿ç”¨æˆ‘çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘å†³å®šåœ¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¦‚ä½•åœ¨Phaserä¸­ç¼–å†™ä¸€ä¸ªSapperå¹¶è¿è¡ŒHTML5å¼€å‘äººå‘˜æµ‹è¯•ä»»åŠ¡</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476682/">ä¸‹åˆå¥½ï¼Œäº²çˆ±çš„åŒäº‹ä»¬ï¼ <br><br> æˆ‘çš„åå­—å«äºšå†å±±å¤§ï¼ˆAlexanderï¼‰ï¼Œæˆ‘æ˜¯HTML5æ¸¸æˆçš„å¼€å‘å•†ã€‚ <br><br> åœ¨æˆ‘å‘é€ç®€å†çš„å…¬å¸ä¹‹ä¸€ä¸­ï¼Œæˆ‘è¢«è¦æ±‚å®Œæˆæµ‹è¯•ä»»åŠ¡ã€‚ æˆ‘åŒæ„ï¼Œå¹¶åœ¨1å¤©åæ ¹æ®TOR HTML5å¼€å‘äº†è¯¥æ¸¸æˆã€‚ <br><br><img src="https://habrastorage.org/webt/4t/ng/dn/4tngdnvlxq3izqrpk2nykww2dvs.png"><br><br> å› ä¸ºæˆ‘æ­£åœ¨æ¥å—æ¸¸æˆç¼–ç¨‹æ–¹é¢çš„åŸ¹è®­ï¼Œå¹¶ä¸”ä¸ºäº†æ›´æœ‰æ•ˆåœ°ä½¿ç”¨æˆ‘çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘å†³å®šåœ¨å®Œæˆçš„é¡¹ç›®ä¸Šå†™ä¸€ç¯‡åŸ¹è®­æ–‡ç« ä¼šå¾ˆæœ‰ç”¨ã€‚ ç”±äºå®Œæˆçš„æµ‹è¯•å¾—åˆ°äº†ç§¯æçš„è¯„ä¼°å¹¶å¯¼è‡´äº†é¢è¯•çš„é‚€è¯·ï¼Œå› æ­¤æˆ‘çš„å†³å®šå¯èƒ½æœ‰æƒå­˜åœ¨ï¼Œå¹¶ä¸”å¯èƒ½ä¼šåœ¨å°†æ¥å¯¹æŸäººæœ‰æ‰€å¸®åŠ©ã€‚ <br><br> æœ¬æ–‡å°†ä»‹ç»è¶³ä»¥æˆåŠŸå®Œæˆå¼€å‘äººå‘˜HTML5èŒä½çš„å¹³å‡æµ‹è¯•ä»»åŠ¡çš„å·¥ä½œé‡ã€‚ æƒ³è¦ç†Ÿæ‚‰Phaseræ¡†æ¶çš„ä»»ä½•äººä¹Ÿå¯èƒ½ä¼šæ„Ÿå…´è¶£ã€‚ å¹¶ä¸”ï¼Œå¦‚æœæ‚¨å·²ç»åœ¨ä½¿ç”¨Phaserå¹¶ç”¨JSç¼–å†™-è¯·å‚é˜…å¦‚ä½•åœ¨TypeScriptä¸­å¼€å‘é¡¹ç›®ã€‚ <br><br> å› æ­¤ï¼Œåœ¨catä¸‹æœ‰å¾ˆå¤šTypeScriptä»£ç ï¼ <br><a name="habracut"></a><br><h2> å¼•è¨€ </h2><br> æˆ‘ä»¬å¯¹æ­¤é—®é¢˜ä½œç®€è¦è¯´æ˜ã€‚ <br><br><ol><li> æˆ‘ä»¬å°†å¼€å‘ä¸€ä¸ªç®€å•çš„HTML5æ¸¸æˆ-ä¸€ä¸ªç»å…¸çš„å·¥å…·ã€‚ </li><li> ä½œä¸ºä¸»è¦å·¥å…·ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç›¸ä½å™¨3ï¼Œæ‰“å­—ç¨¿å’Œwebpackã€‚ </li><li> è¯¥æ¸¸æˆå°†ä¸ºæ¡Œé¢è®¾è®¡ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚ </li></ol><br> æˆ‘ä»¬æä¾›äº†æœ€ç»ˆé¡¹ç›®çš„é“¾æ¥ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">é“¾æ¥åˆ°æ¼”ç¤ºå’Œæº</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯æ’­æ”¾çš„æ¼”ç¤º</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubæºä»£ç </a> <br></div></div><br> å¦‚æœçªç„¶æœ‰äººå¿˜è®°äº†æ¸¸æˆè§„åˆ™ï¼Œè¯·å›æƒ³ä¸€ä¸‹è¿™ä½å·¥å…µçš„æŠ€å·§ã€‚ ä½†æ˜¯ç”±äºè¿™ç§æƒ…å†µä¸å¤ªå¯èƒ½å‘ç”Ÿï¼Œå› æ­¤å°†è§„åˆ™æ”¾ç½®åœ¨ç ´åè€…çš„ä¸‹æ–¹ï¼š) <br><br><div class="spoiler">  <b class="spoiler_title">æ‹æ‰‹è§„åˆ™</b> <div class="spoiler_text"> æ¯”èµ›åœºåœ°ç”±å¸ƒç½®åœ¨æ¡Œå­ä¸­çš„å•å…ƒæ ¼ç»„æˆã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ¸¸æˆå¼€å§‹æ—¶ï¼Œæ‰€æœ‰å•å…ƒæ ¼éƒ½å…³é—­ã€‚ ç‚¸å¼¹æ”¾ç½®åœ¨æŸäº›ç‰¢æˆ¿ä¸­ã€‚ <br><br> åœ¨å°é—­çš„å•å…ƒæ ¼ä¸Šå•å‡»é¼ æ ‡å·¦é”®æ—¶ï¼Œå®ƒå°†æ‰“å¼€ã€‚ å¦‚æœä¸€ä¸ªå¼€å­”ä¸­æœ‰ç‚¸å¼¹ï¼Œåˆ™æ¸¸æˆä»¥å¤±è´¥å‘Šç»ˆã€‚ <br><br> å¦‚æœè¯¥å•å…ƒæ ¼ä¸­æ²¡æœ‰ç‚¸å¼¹ï¼Œåˆ™ä¼šåœ¨å…¶ä¸­æ˜¾ç¤ºä¸€ä¸ªæ•°å­—ï¼Œè¡¨æ˜ç›¸å¯¹äºå½“å‰æ‰“å¼€çš„ä½ç½®ï¼Œç›¸é‚»å•å…ƒæ ¼ä¸­çš„ç‚¸å¼¹æ•°é‡ã€‚ å¦‚æœé™„è¿‘æ²¡æœ‰ç‚¸å¼¹ï¼Œåˆ™ç‰¢æˆ¿çœ‹èµ·æ¥æ˜¯ç©ºçš„ã€‚ <br><br> å³é”®å•å‡»å°é—­çš„å•å…ƒæ ¼å¯ä»¥åœ¨å…¶ä¸Šè®¾ç½®ä¸€ä¸ªæ ‡å¿—ã€‚ ç©å®¶çš„ä»»åŠ¡æ˜¯å®‰æ’æ‰€æœ‰å¯ç”¨çš„æ ‡è®°ï¼Œä»¥ä¾¿æ ‡è®°æ‰€æœ‰å·²å¼€é‡‡çš„å•å…ƒæ ¼ã€‚ æ”¾ç½®æ‰€æœ‰æ ‡å¿—åï¼Œç©å®¶åœ¨ä¸€ä¸ªæ‰“å¼€çš„å•å…ƒæ ¼ä¸ŠæŒ‰ä¸‹é¼ æ ‡å·¦é”®ä»¥æ£€æŸ¥ä»–æ˜¯å¦è·èƒœã€‚ <br></div></div><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥æ‰‹å†Œæœ¬èº«ã€‚ æ‰€æœ‰ææ–™éƒ½åˆ†ä¸ºå°æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½æè¿°äº†åœ¨çŸ­æ—¶é—´å†…å®Œæˆç‰¹å®šä»»åŠ¡çš„è¿‡ç¨‹ã€‚ å› æ­¤ï¼Œé€æ­¥æ‰§è¡Œå°ç›®æ ‡ï¼Œæœ€ç»ˆæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„æ¸¸æˆã€‚ å¦‚æœå†³å®šå¿«é€Ÿè½¬åˆ°ç‰¹å®šæ­¥éª¤ï¼Œè¯·ä½¿ç”¨ç›®å½•ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ç›®å½•</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.å‡†å¤‡</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.1é¡¹ç›®æ¨¡æ¿</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.2æ„å»ºé…ç½®</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.3å®‰è£…æ¨¡å—</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.4èµ„äº§å‡†å¤‡</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2.åˆ›å»ºåœºæ™¯</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2.1å…¥å£ç‚¹</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2.2èµ·å§‹åœºæ™¯</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2.3èµ·å§‹åœºæ™¯çš„æ–‡å­—</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2.4è¿‡æ¸¡åˆ°æ¸¸æˆçº§åˆ«</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2.5çº§åœºæ™¯</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2.6åœ¨å…¥å£å¤„è®¾ç½®åœºæ™¯</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.æ¸¸æˆå¯¹è±¡</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.1æ¸¸æˆæ¿</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.2ç»†èƒæ¨¡å‹</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.3å•å…ƒæ ¼è§†å›¾</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.4åœ¨è§†å›¾ç±»ä¸­åˆ›å»ºç²¾çµ</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.5ç²¾çµå®šä½</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.6åˆ›å»ºFieldViewçš„å®ä¾‹</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.7æ˜¾ç¤ºæ¿å­—æ®µã€‚</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.8åˆ¶é€ ç‚¸å¼¹</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.9è®¾å®šå€¼</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4.å¤„ç†è¾“å…¥äº‹ä»¶</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4.1è·Ÿè¸ªé¼ æ ‡å•å‡»äº‹ä»¶</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4.2ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å·¦é”®ç‚¹å‡»å¤„ç†</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4.4å³é”®å¤„ç†</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4.5 GameSceneViewå¯¹è±¡</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.åŠ¨ç”»</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.1æœ¨æ¿å¡«å……åŠ¨ç”»</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.2å•å…ƒç¿»è½¬åŠ¨ç”»</a> <br></div></div><br><a name="section-1"></a><h2>  <font color="#008080">1.å‡†å¤‡</font> </h2><br><a name="section-1-1"></a><h3>  <font color="#008080">1.1é¡¹ç›®æ¨¡æ¿</font> </h3><br> ä¸‹è½½<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é»˜è®¤çš„ç›¸ä½å™¨é¡¹ç›®æ¨¡æ¿</a> ã€‚ è¿™æ˜¯æ¡†æ¶ä½œè€…æ¨èçš„æ¨¡æ¿ï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹ç›®å½•ç»“æ„ï¼š <br><div class="scrollable-table"><table><tbody><tr><td>  index.html </td><td colspan="2"> å¯åŠ¨æ¸¸æˆçš„HTMLé¡µé¢ </td></tr><tr><td rowspan="2">  webpack / </td><td>  base.js </td><td> ä¸ºæµ‹è¯•ç¯å¢ƒæ„å»ºé…ç½® </td></tr><tr><td>  prod.js </td><td> ä¸ºç”Ÿäº§æ„å»ºé…ç½® </td></tr><tr><td rowspan="2">  src / </td><td> èµ„äº§/ </td><td> æ¸¸æˆèµ„äº§ï¼ˆç²¾çµï¼Œå£°éŸ³ï¼Œå­—ä½“ï¼‰ </td></tr><tr><td>  index.js </td><td> å…¥å£ç‚¹ </td></tr></tbody></table></div>å¯¹äºæˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬ä¸éœ€è¦å½“å‰çš„<code>index.js</code>æ–‡ä»¶ï¼Œå› æ­¤å°†å…¶åˆ é™¤ã€‚ ç„¶ååˆ›å»ºç›®å½•<code>/src/scripts/</code> ï¼Œå¹¶å°†ç©ºçš„<code>index.ts</code>æ–‡ä»¶æ”¾å…¥å…¶ä¸­ã€‚ æˆ‘ä»¬å°†æ‰€æœ‰è„šæœ¬æ·»åŠ åˆ°æ­¤æ–‡ä»¶å¤¹ä¸­ã€‚ <br> è¿˜éœ€è¦è®°ä½çš„æ˜¯ï¼Œåœ¨æ„å»ºç”¨äºç”Ÿäº§çš„é¡¹ç›®æ—¶ï¼Œå°†åœ¨æ ¹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª<code>dist</code>ç›®å½•ï¼Œè¯¥ç›®å½•å°†æ”¾ç½®å‘è¡Œç‰ˆæœ¬ã€‚ <br><br><a name="section-1-2"></a><h3>  <font color="#008080">1.2æ„å»ºé…ç½®</font> </h3><br> æˆ‘ä»¬å°†ä½¿ç”¨webpackè¿›è¡Œç»„è£…ã€‚ ç”±äºæˆ‘ä»¬çš„æ¨¡æ¿æœ€åˆæ˜¯ä¸ºä½¿ç”¨JavaScriptè€Œå‡†å¤‡çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬ä½¿ç”¨TypeScriptç¼–å†™ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹æ”¶é›†å™¨çš„é…ç½®è¿›è¡Œä¸€äº›å°çš„æ›´æ”¹ã€‚ <br><br> åœ¨<code>webpack/base.js</code>æ·»åŠ <code>entry</code>é”®ï¼ˆç”¨äºæŒ‡ç¤ºæ„å»ºæˆ‘ä»¬çš„é¡¹ç›®æ—¶çš„è¿›å…¥ç‚¹ï¼‰ï¼Œä»¥åŠç”¨äºæè¿°æ„å»ºTSè„šæœ¬è§„åˆ™çš„<code>ts-loader</code>é…ç½®ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// webpack/base.js //... module.exports = { entry: './src/scripts/index.ts', // ... resolve: { extensions: [ '.ts', '.tsx', '.js' ] }, module: { rules: [{ test: /\.tsx?$/, use: 'ts-loader', exclude: /node_modules/ }, //...</span></span></code> </pre><br> æˆ‘ä»¬è¿˜éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºtsconfig.jsonæ–‡ä»¶ã€‚ å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹å†…å®¹ï¼š <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"compilerOptions"</span></span>: { <span class="hljs-string"><span class="hljs-string">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"commonjs"</span></span>, <span class="hljs-string"><span class="hljs-string">"lib"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"dom"</span></span>, <span class="hljs-string"><span class="hljs-string">"es5"</span></span>, <span class="hljs-string"><span class="hljs-string">"es6"</span></span>, <span class="hljs-string"><span class="hljs-string">"es2015"</span></span>, <span class="hljs-string"><span class="hljs-string">"es2017"</span></span>, <span class="hljs-string"><span class="hljs-string">"es2015.promise"</span></span> ], <span class="hljs-string"><span class="hljs-string">"target"</span></span>: <span class="hljs-string"><span class="hljs-string">"es5"</span></span>, <span class="hljs-string"><span class="hljs-string">"skipLibCheck"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-string"><span class="hljs-string">"exclude"</span></span>: [<span class="hljs-string"><span class="hljs-string">"node_modules"</span></span>, <span class="hljs-string"><span class="hljs-string">"dist"</span></span>] }</code> </pre> <br><a name="section-1-3"></a><h3>  <font color="#008080">1.3å®‰è£…æ¨¡å—</font> </h3><br> ä»package.jsonå®‰è£…æ‰€æœ‰ä¾èµ–é¡¹ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ typescriptå’Œts-loaderæ¨¡å—ï¼š <br><br><pre> <code class="plaintext hljs">npm i npm i typescript --save-dev npm i ts-loader --save-dev</code> </pre><br> ç°åœ¨è¯¥é¡¹ç›®å·²å‡†å¤‡å¥½å¼€å§‹å¼€å‘ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨2æ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤å·²ç»åœ¨<code>package.json</code>æ–‡ä»¶çš„<code>scripts</code>å±æ€§ä¸­å®šä¹‰ã€‚ <br><br><ol><li> å»ºç«‹ä¸€ä¸ªè°ƒè¯•é¡¹ç›®å¹¶é€šè¿‡æœ¬åœ°æœåŠ¡å™¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <br><br><pre> <code class="plaintext hljs">npm start</code> </pre> </li><li> è¿è¡Œè¦å‡ºå”®çš„ç‰ˆæœ¬ï¼Œå¹¶å°†å‘è¡Œç‰ˆæœ¬æ”¾åœ¨dist /æ–‡ä»¶å¤¹ä¸­ <br><br><pre> <code class="plaintext hljs">npm run build</code> </pre> </li></ol><br><a name="section-1-4"></a><h3>  <font color="#008080">1.4èµ„äº§å‡†å¤‡</font> </h3><br> è¯¥æ¸¸æˆçš„æ‰€æœ‰èµ„äº§å‡å·²ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OpenGameArt</a> ï¼ˆç‰ˆæœ¬61x61ï¼‰è¿›è¡Œäº†è¯šå®ä¸‹è½½ï¼Œå¹¶æ‹¥æœ‰åä¸º<i>Feel free to use</i>çš„æœ€å‹å¥½çš„è®¸å¯è¯ï¼Œéšé™„çš„é¡µé¢ä¼šä»”ç»†åœ°å‘Šè¯‰æˆ‘ä»¬ï¼‰ã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œæœ¬æ–‡ä¸­æä¾›çš„ä»£ç å…·æœ‰ç›¸åŒçš„è®¸å¯è¯ï¼  ;ï¼‰ <br><br> æˆ‘ä»ä¸‹è½½çš„é›†åˆä¸­åˆ é™¤äº†æ—¶é’Ÿå›¾åƒï¼Œå¹¶é‡å‘½åäº†å…¶ä½™æ–‡ä»¶ï¼Œä»¥ä¾¿è·å¾—æ˜“äºä½¿ç”¨çš„å¸§åç§°ã€‚ åç§°å’Œç›¸åº”æ–‡ä»¶çš„åˆ—è¡¨æ˜¾ç¤ºåœ¨ä¸‹é¢çš„å±å¹•ä¸Šã€‚ <br><br> æ ¹æ®ç”Ÿæˆçš„ç²¾çµï¼Œæˆ‘ä»¬å°†åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TexturePacker</a>ç¨‹åºä¸­åˆ›å»ºä¸€ä¸ª<code>Phaser JSONArray</code>æ ¼å¼åœ°å›¾é›†ï¼ˆå…è´¹ç‰ˆæœ¬å·²ç»è¶³å¤Ÿäº†ï¼Œæˆ‘è¿˜æ²¡æœ‰å¾—åˆ°å·¥ä½œï¼‰ï¼Œå¹¶å°†ç”Ÿæˆçš„<code>spritesheet.png</code>å’Œ<code>spritesheet.json</code>æ–‡ä»¶æ”¾åœ¨<code>src/assets/</code> projectç›®å½•ä¸­ã€‚ <br><br><img src="https://habrastorage.org/webt/ms/ki/z9/mskiz9zmuidbxk8hhcbksfmny4k.png"><br><br><a name="section-2"></a><h2>  <font color="#008080">2.åˆ›å»ºåœºæ™¯</font> </h2><br><a name="section-2-1"></a><h3>  <font color="#008080">2.1å…¥å£ç‚¹</font> </h3><br> æˆ‘ä»¬é€šè¿‡åˆ›å»ºwebpacké…ç½®ä¸­æè¿°çš„å…¥å£ç‚¹å¼€å§‹å¼€å‘ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// src/scripts/index.ts import * as Phaser from "phaser"; new Phaser.Game({ type: Phaser.AUTO, parent: "minesweeper", width: window.innerWidth, height: window.innerHeight, backgroundColor: "#F0FFFF", scene: [] });</span></span></code> </pre><br> ç”±äºæˆ‘ä»¬æ‹¥æœ‰çš„æ¸¸æˆæ˜¯ä¸ºå°å¼æœºè®¾è®¡çš„ï¼Œå¹¶ä¸”å°†å¡«æ»¡æ•´ä¸ªå±å¹•ï¼Œå› æ­¤æˆ‘ä»¬å°†<code>width</code>å’Œ<code>height</code>å­—æ®µå¤§èƒ†åœ°ä½¿ç”¨æµè§ˆå™¨çš„æ•´ä¸ª<code>width</code>å’Œ<code>height</code> ã€‚ <br>  <code>scene</code>å­—æ®µå½“å‰ä¸ºç©ºæ•°ç»„ï¼Œæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œä¿®å¤ï¼ <br><br><a name="section-2-2"></a><h3>  <font color="#008080">2.2èµ·å§‹åœºæ™¯</font> </h3><br> åœ¨<code>src/scripts/scenes/StartScene.ts</code>åˆ›å»ºç¬¬ä¸€ä¸ªåœºæ™¯çš„ç±»ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StartScene</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Phaser</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scene</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-string"><span class="hljs-string">'Start'</span></span>); } public preload(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { } public create(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { } }</code> </pre><br> ä¸ºäº†æœ‰æ•ˆç»§æ‰¿<code>Phaser.Scene</code>æˆ‘ä»¬å°†åœºæ™¯åç§°ä½œä¸ºå‚æ•°ä¼ é€’ç»™çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚ <br><br> è¯¥åœºæ™¯å°†ç»“åˆèµ„æºé¢„åŠ è½½å’Œå¼€å§‹å±å¹•çš„åŠŸèƒ½ï¼Œé‚€è¯·ç”¨æˆ·åŠ å…¥æ¸¸æˆã€‚ <br><br> é€šå¸¸ï¼Œåœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œç©å®¶æŒ‰é¡ºåºä¾æ¬¡ç»å†ä¸¤ä¸ªåœºæ™¯ï¼Œç„¶åè¿›å…¥å¼€å§‹åœºæ™¯ï¼š <br><br><pre> <code class="plaintext hljs">Boot =&gt; Preload =&gt; Start</code> </pre><br> ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¸¸æˆæ˜¯å¦‚æ­¤ç®€å•ï¼Œå¹¶ä¸”èµ„äº§å¤ªå°‘ï¼Œå› æ­¤æ²¡æœ‰ç†ç”±å°†é¢„è½½æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„åœºæ™¯ä¸­ï¼Œç”šè‡³æ²¡æœ‰æ›´å¤šçš„ç†ç”±æ¥åšåˆå§‹çš„å•ç‹¬çš„<code>Boot</code> loaderã€‚ <br><br> æˆ‘ä»¬å°†ä»¥<code>preload</code>æ–¹æ³•åŠ è½½æ‰€æœ‰èµ„äº§ã€‚ ä¸ºäº†å°†æ¥èƒ½å¤Ÿä½¿ç”¨åˆ›å»ºçš„å›¾é›†ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸¤ä¸ªæ­¥éª¤ï¼š <br><br><ol><li> ä½¿ç”¨<code>require</code>è·å–<code>png</code>å’Œ<code>json</code>åœ°å›¾é›†æ–‡ä»¶ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// StartScene.ts const spritesheetPng = require("./../../assets/spritesheet.png"); const spritesheetJson = require("./../../assets/spritesheet.json"); // ...</span></span></code> </pre><br></li><li> å°†å®ƒä»¬<code>preload</code>åˆ°å¼€å§‹åœºæ™¯çš„<code>preload</code>æ–¹æ³•ä¸­ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// StartScene.ts // ... public preload(): void { this.load.atlas("spritesheet", spritesheetPng, spritesheetJson); } // ...</span></span></code> </pre><br></li></ol><br><a name="section-2-3"></a><h3>  <font color="#008080">2.3èµ·å§‹åœºæ™¯çš„æ–‡å­—</font> </h3><br> åœ¨å¼€å§‹çš„åœºæ™¯ä¸­ï¼Œè¿˜æœ‰ä¸¤ä»¶äº‹è¦åšï¼š <br><br><ol><li> å‘Šè¯‰ç©å®¶å¦‚ä½•å¼€å§‹æ¸¸æˆ </li><li> åœ¨ç©å®¶çš„ä¸»åŠ¨ä¸‹å¼€å§‹æ¸¸æˆ </li></ol><br> ä¸ºäº†æ»¡è¶³ç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨åœºæ™¯æ–‡ä»¶çš„å¼€å¤´åˆ›å»ºä¸¤ä¸ªæšä¸¾ï¼Œä»¥æè¿°æ–‡æœ¬åŠå…¶æ ·å¼ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// StartScene.js enum Texts { Title = 'Minesweeper HTML5', Message = 'Click anywhere to start' } enum Styles { Color = '#008080', Font = 'Arial' } //...</span></span></code> </pre><br> ç„¶ååœ¨<code>create</code>æ–¹æ³•ä¸­å°†ä¸¤ä¸ªæ–‡æœ¬éƒ½åˆ›å»ºä¸ºå¯¹è±¡ã€‚ è®©æˆ‘æé†’æ‚¨ï¼Œåªæœ‰åœ¨å°†æ‰€æœ‰èµ„æºåŠ è½½åˆ°<code>preload</code>æ–¹æ³•ä¸­ä¹‹åï¼Œæ‰ä¼šè°ƒç”¨<code>Phaser</code>ä¸­åœºæ™¯çš„<code>create</code>æ–¹æ³•ï¼Œè¿™éå¸¸é€‚åˆæˆ‘ä»¬ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// StartScene.js //... public create(): void { this.add.text( this.cameras.main.centerX, this.cameras.main.centerY - 100, Texts.Title, {font: `52px ${Styles.Font}`, fill: Styles.Color}) .setOrigin(0.5); this.add.text( this.cameras.main.centerX, this.cameras.main.centerY + 100, Texts.Message, {font: `28px ${Styles.Font}`, fill: Styles.Color}) .setOrigin(0.5); } //...</span></span></code> </pre><br> åœ¨å¦ä¸€ä¸ªæ›´å¤§çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ–‡æœ¬å’Œæ ·å¼æ·»åŠ åˆ°jsonè¯­è¨€ç¯å¢ƒæ–‡ä»¶ä¸­æˆ–å•ç‹¬çš„é…ç½®ä¸­ï¼Œä½†æ˜¯é‰´äºæˆ‘ä»¬ç°åœ¨åªæœ‰2è¡Œï¼Œæˆ‘è®¤ä¸ºè¿™ä¸€æ­¥éª¤æ˜¯å¤šä½™çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å»ºè®®ä¸è¦ä½¿æˆ‘ä»¬çš„ç”Ÿæ´»å˜å¾—å¤æ‚ï¼Œå°†è‡ªå·±é™åˆ¶åœ¨åœºæ™¯æ–‡ä»¶å¼€å¤´çš„åˆ—è¡¨ä¸­ã€‚ <br><br><a name="section-2-4"></a><h3>  <font color="#008080">2.4è¿‡æ¸¡åˆ°æ¸¸æˆçº§åˆ«</font> </h3><br> åœ¨ç»§ç»­è¿›è¡Œä¹‹å‰ï¼Œæˆ‘ä»¬åœ¨æ­¤åœºæ™¯ä¸­è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯è·Ÿè¸ªé¼ æ ‡å•å‡»äº‹ä»¶ï¼Œä»¥å°†ç©å®¶å¯åŠ¨åˆ°æ¸¸æˆä¸­ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// StartScene.js //... public create(): void { //... this.input.once('pointerdown', () =&gt; { this.scene.start('Game'); }); } //...</span></span></code> </pre> <br><a name="section-2-5"></a><h3>  <font color="#008080">2.5çº§åœºæ™¯</font> </h3><br> é€šè¿‡ä¼ é€’ç»™<code>this.scene.start</code>æ–¹æ³•çš„<code>"Game"</code>å‚æ•°åˆ¤æ–­<code>this.scene.start</code>æ‚¨å·²ç»çŒœåˆ°æ˜¯æ—¶å€™åˆ›å»ºç¬¬äºŒä¸ªåœºæ™¯äº†ï¼Œè¯¥åœºæ™¯å°†å¤„ç†ä¸»è¦çš„æ¸¸æˆé€»è¾‘ã€‚ åˆ›å»º<code>src/scripts/scenes/GameScene.ts</code> ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameScene</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Phaser</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scene</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-string"><span class="hljs-string">'Game'</span></span>); } public create(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { } }</code> </pre><br> åœ¨æ­¤åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦<code>preload</code>æ–¹æ³•ï¼Œå› ä¸º æˆ‘ä»¬å·²ç»åœ¨ä¸Šä¸€ä¸ªåœºæ™¯ä¸­åŠ è½½äº†æ‰€æœ‰å¿…è¦çš„èµ„æºã€‚ <br><br><a name="section-2-6"></a><h3>  <font color="#008080">2.6åœ¨å…¥å£å¤„è®¾ç½®åœºæ™¯</font> </h3><br> ç°åœ¨å·²ç»åˆ›å»ºäº†ä¸¤ä¸ªåœºæ™¯ï¼Œå°†å®ƒä»¬æ·»åŠ åˆ°æˆ‘ä»¬çš„å…¥å£ç‚¹ <br>  <code>src/scripts/index.ts</code> ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//... import { StartScene } from "./scenes/StartScene"; import { GameScene } from "./scenes/GameScene"; //... new Phaser.Game({ // ... scene: [StartScene, GameScene] });</span></span></code> </pre><br><a name="section-3"></a><h2>  <font color="#008080">3.æ¸¸æˆå¯¹è±¡</font> </h2><br> å› æ­¤ï¼Œ <code>GameScene</code>ç±»å°†å®ç°æ¸¸æˆçº§é€»è¾‘ã€‚ æˆ‘ä»¬å¯¹ç²¾å·¥æ¸¸æˆæ°´å¹³æœ‰ä½•æœŸå¾…ï¼Ÿ åœ¨è§†è§‰ä¸Šï¼Œæˆ‘ä»¬å¸Œæœ›çœ‹åˆ°ä¸€ä¸ªå°é—­çš„è¿åŠ¨åœºã€‚ æˆ‘ä»¬çŸ¥é“è¯¥å­—æ®µæ˜¯ä¸€ä¸ªè¡¨ï¼Œè¿™æ„å‘³ç€å®ƒå…·æœ‰ç»™å®šæ•°é‡çš„è¡Œå’Œåˆ—ï¼Œå…¶ä¸­ä¸€äº›ç‚¸å¼¹æ”¾ç½®åœ¨èˆ’é€‚çš„ä½ç½®ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥åˆ›å»ºæè¿°æ¯”èµ›åœºåœ°çš„å•ç‹¬å®ä½“ã€‚ <br><br><a name="section-3-1"></a><h3>  <font color="#008080">3.1æ¸¸æˆæ¿</font> </h3><br> åˆ›å»º<code>src/scripts/models/Board.ts</code>åœ¨å…¶ä¸­æ”¾ç½®<code>Board</code>ç±»ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Field } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./Field"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Board</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Phaser</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Events</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventEmitter</span></span></span><span class="hljs-class"> </span></span>{ private _scene: Phaser.Scene = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; private _rows: number = <span class="hljs-number"><span class="hljs-number">0</span></span>; private _cols: number = <span class="hljs-number"><span class="hljs-number">0</span></span>; private _bombs: number = <span class="hljs-number"><span class="hljs-number">0</span></span>; private _fields: Field[] = []; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(scene: Phaser.Scene, rows: number, cols: number, bombs: number) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._scene = scene; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._rows = rows; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._cols = cols; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._bombs = bombs; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._fields = []; } public get cols(): number { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._cols; } public get rows(): number { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._rows; } }</code> </pre> <br> è®©æˆ‘ä»¬è®©è¯¥ç±»æˆä¸ºPhaser.Events.EventEmitterçš„åç»§è€…ï¼Œä»¥ä¾¿è®¿é—®å°†æ¥ç”¨äºæ³¨å†Œå’Œè°ƒç”¨äº‹ä»¶çš„æ¥å£ã€‚ <br><br>  <code>Field</code>ç±»çš„å¯¹è±¡æ•°ç»„å°†å­˜å‚¨åœ¨<code>_fields</code>ç§æœ‰å±æ€§ä¸­ã€‚ æˆ‘ä»¬ç¨åå°†å®ç°æ­¤æ¨¡å‹ã€‚ <br><br> æˆ‘ä»¬è®¾ç½®äº†ä¸“ç”¨æ•°å­—å±æ€§<code>_rows</code>å’Œ<code>_cols</code>ä»¥æŒ‡ç¤º<code>_cols</code>çš„è¡Œæ•°å’Œåˆ—æ•°ã€‚ åˆ›å»ºç”¨äºè¯»å–<code>_rows</code>å’Œ<code>_cols</code>å…¬å…±<code>_cols</code> ã€‚ <br><br>  <code>_bombs</code>å­—æ®µå‘Šè¯‰æˆ‘ä»¬è¯¥<code>_bombs</code>éœ€è¦ç”Ÿæˆçš„ç‚¸å¼¹æ•°é‡ã€‚ åœ¨<code>_scene</code>å‚æ•°ä¸­<code>_scene</code>æˆ‘ä»¬å°†å¼•ç”¨ä¼ é€’ç»™<code>GameScene</code>æ¸¸æˆåœºæ™¯çš„å¯¹è±¡ï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬å°†åˆ›å»º<code>Board</code>ç±»çš„å®ä¾‹ã€‚ <br><br> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä»…å°†åœºæ™¯å¯¹è±¡è½¬ç§»åˆ°æ¨¡å‹ä¸­ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥ä¼ è¾“åˆ°è§†å›¾ï¼Œè€Œåœ¨æ­¤å¤„ä»…å°†å…¶ç”¨äºæ˜¾ç¤ºè§†å›¾ã€‚ äº‹å®æ˜¯ï¼Œç§»ç›¸å™¨ç›´æ¥ä½¿ç”¨åœºæ™¯å¯¹è±¡æ¸²æŸ“å­ç”»é¢ï¼Œå› æ­¤åœ¨åˆ›å»ºå­ç”»é¢é¢„åˆ¶ä»¶æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¹‰åŠ¡æä¾›åˆ°å½“å‰åœºæ™¯çš„é“¾æ¥ï¼Œæˆ‘ä»¬å°†åœ¨ä»¥åè¿›è¡Œå¼€å‘ã€‚ å¯¹äºæˆ‘ä»¬è‡ªå·±ï¼Œæˆ‘ä»¬å°†æ¥å—ä»¥ä¸‹åè®®ï¼šå°†é“¾æ¥è½¬ç§»åˆ°åœºæ™¯ä»…ç”¨äºè¿›ä¸€æ­¥ç”¨ä½œæ˜¾ç¤ºå¼•æ“ï¼Œå¹¶åŒæ„æˆ‘ä»¬ä¸ä¼šåœ¨æ¨¡å‹å’Œè§†å›¾ä¸­ç›´æ¥è°ƒç”¨åœºæ™¯çš„è‡ªå®šä¹‰æ–¹æ³•ã€‚ <br><br> ä¸€æ—¦æˆ‘ä»¬ç¡®å®šäº†æ£‹ç›˜åˆ›å»ºç•Œé¢ï¼Œæˆ‘å»ºè®®åœ¨å…³å¡åœºæ™¯ä¸­å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼Œä»¥æœ€ç»ˆç¡®å®š<code>GameScene</code>ç±»ï¼š <br><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">// GameScene.ts import { Board } from "../models/Board"; const Rows = 8; const Cols = 8; const Bombs = 8; export class GameScene extends Phaser.Scene { private _board: Board = null; //... public create(): void { this._board = new Board(this, Rows, Cols, Bombs); } }</span></span></code> </pre> <br> æˆ‘ä»¬åœ¨åœºæ™¯æ–‡ä»¶çš„å¼€å¤´å°†boardå‚æ•°å¸¦åˆ°å¸¸é‡ï¼Œå¹¶åœ¨åˆ›å»ºæ­¤ç±»çš„å®ä¾‹æ—¶å°†å…¶ä¼ é€’ç»™<code>Board</code>æ„é€ å‡½æ•°ã€‚ <br><br><a name="section-3-2"></a><h3>  <font color="#008080">3.2ç»†èƒæ¨¡å‹</font> </h3><br> è¯¥æ¿åŒ…å«è¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„å•å…ƒæ ¼ã€‚ æ¯ä¸ªå•å…ƒæ ¼å¿…é¡»æ”¾ç½®åœ¨ç”±è¡Œå’Œåˆ—ç¡®å®šçš„ç›¸åº”ä½ç½®ã€‚ <br><br> å•å…ƒä¹Ÿè¢«é€‰æ‹©ä¸ºå•ç‹¬çš„å®ä½“ã€‚ åˆ›å»º<code>src/scripts/models/Field.ts</code>åœ¨å…¶ä¸­æ”¾ç½®æè¿°å•å…ƒæ ¼çš„ç±»ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Board } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./Board"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Field</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Phaser</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Events</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventEmitter</span></span></span><span class="hljs-class"> </span></span>{ private _scene: Phaser.Scene = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; private _board: Board = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; private _row: number = <span class="hljs-number"><span class="hljs-number">0</span></span>; private _col: number = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(scene: Phaser.Scene, board: Board, row: number, col: number) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._init(scene, board, row, col); } public get col(): number { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._col; } public get row(): number { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._row; } public get board(): Board { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._board; } private _init(scene: Phaser.Scene, <span class="hljs-attr"><span class="hljs-attr">board</span></span>: Board, <span class="hljs-attr"><span class="hljs-attr">row</span></span>: number, <span class="hljs-attr"><span class="hljs-attr">col</span></span>: number): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._scene = scene; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._board = board; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._row = row; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._col = col; } }</code> </pre><br> æ¯ä¸ªå•å…ƒæ ¼åº”å…·æœ‰å…¶æ‰€åœ¨çš„è¡Œå’Œåˆ—æŒ‡æ ‡ã€‚ æˆ‘ä»¬è®¾ç½®å‚æ•°<code>_board</code>å’Œ<code>_scene</code>ä»¥è®¾ç½®æŒ‡å‘æ¿å¯¹è±¡å’Œåœºæ™¯çš„é“¾æ¥ã€‚ æˆ‘ä»¬å®ç°äº†ç”¨äºè¯»å–<code>_row</code> ï¼Œ <code>_col</code>å’Œ<code>_board</code>å¸æ°”å‰‚ã€‚ <br><br><a name="section-3-3"></a><h3>  <font color="#008080">3.3å•å…ƒæ ¼è§†å›¾</font> </h3><br> åˆ›å»ºäº†æŠ½è±¡å•å…ƒæ ¼ï¼Œç°åœ¨æˆ‘ä»¬è¦å¯¹å…¶è¿›è¡Œå¯è§†åŒ–ã€‚ è¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå•å…ƒæ ¼ï¼Œéœ€è¦åˆ›å»ºå…¶è§†å›¾ã€‚ åˆ›å»º<code>src/scripts/views/FieldView.ts</code>å¹¶å°†è§†å›¾ç±»æ”¾å…¥å…¶ä¸­ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Field } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../models/Field"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FieldView</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Phaser</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameObjects</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sprite</span></span></span><span class="hljs-class"> </span></span>{ private _model: Field = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(scene: Phaser.Scene, model: Field) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(scene, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'spritesheet'</span></span>, <span class="hljs-string"><span class="hljs-string">'closed'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._model = model; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._init(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._create(); } private _init(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { } private _create(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { } }</code> </pre><br> è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿æ­¤ç±»æˆä¸º<code>Phaser.GameObjects.Sprite</code>çš„åä»£ã€‚ ç”¨ç§»ç›¸å™¨æ¥è¯´ï¼Œè¯¥ç±»å·²æˆä¸ºSpriteé¢„åˆ¶ä»¶ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘å¾—åˆ°äº†ç²¾çµæ¸¸æˆå¯¹è±¡çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è‡ªå·±çš„æ–¹æ³•è¿›ä¸€æ­¥æ‰©å±•è¯¥åŠŸèƒ½ã€‚ <br><br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ­¤ç±»çš„æ„é€ å‡½æ•°ã€‚ åœ¨è¿™é‡Œï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä»¥ä¸‹å‚æ•°é›†è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼š <br><br><ul><li> é“¾æ¥åˆ°åœºæ™¯å¯¹è±¡ï¼ˆæ­£å¦‚æˆ‘åœ¨3.1èŠ‚ä¸­æ‰€è­¦å‘Šçš„ï¼šç›¸ä½å™¨è¦æ±‚æˆ‘ä»¬é“¾æ¥åˆ°å½“å‰åœºæ™¯ä»¥æ¸²æŸ“ç²¾çµï¼‰ </li><li> ç”»å¸ƒä¸Šçš„<code>x</code>å’Œ<code>y</code>åæ ‡ </li><li> åœ°å›¾é›†å¯ç”¨çš„å­—ç¬¦ä¸²é”®ï¼Œæˆ‘ä»¬åœ¨å¼€å§‹åœºæ™¯çš„<code>preload</code>æ–¹æ³•ä¸­åŠ è½½äº†è¯¥é”® </li><li> æ‚¨è¦é€‰æ‹©ä»¥æ˜¾ç¤ºç²¾çµçš„æ­¤åœ°å›¾é›†ä¸­çš„æ¡†æ¶å­—ç¬¦ä¸²é”® </li></ul><br> åœ¨private <code>_model</code>å±æ€§ä¸­è®¾ç½®å¯¹æ¨¡å‹çš„å¼•ç”¨ï¼ˆå³<code>Field</code>ç±»çš„å®ä¾‹ï¼‰ã€‚ <br><br> æˆ‘ä»¬è¿˜è°¨æ…åœ°å¯åŠ¨äº†2ä¸ªå½“å‰ä¸ºç©ºçš„<code>_init</code>å’Œ<code>_create</code> ï¼Œæˆ‘ä»¬å°†åœ¨ç¨åå®ç°ã€‚ <br><br><a name="section-3-4"></a><h3>  <font color="#008080">3.4åœ¨è§†å›¾ç±»ä¸­åˆ›å»ºç²¾çµ</font> </h3><br> å› æ­¤ï¼Œåˆ›å»ºäº†è§†å›¾ï¼Œä½†æ˜¯å¥¹ä»ç„¶ä¸çŸ¥é“å¦‚ä½•ç»˜åˆ¶ç²¾çµã€‚ è¦å°†ç²¾çµå’Œæˆ‘ä»¬éœ€è¦çš„æ¡†æ¶æ”¾åœ¨ç”»å¸ƒä¸Šï¼Œæ‚¨å°†éœ€è¦ä¿®æ”¹æˆ‘ä»¬è‡ªå·±çš„private <code>_create</code>æ–¹æ³•ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.js //... private _create(): void { this.scene.add.existing(this); //      this.setOrigin(0.5); //  pivot point    } //...</span></span></code> </pre><br><a name="section-3-5"></a><h3>  <font color="#008080">3.5ç²¾çµå®šä½</font> </h3><br> æ­¤åˆ»ï¼Œæ‰€æœ‰åˆ›å»ºçš„ç²¾çµå°†æ”¾ç½®åœ¨ç”»å¸ƒçš„åæ ‡ï¼ˆ0ï¼Œ0ï¼‰ä¸­ã€‚ æˆ‘ä»¬è¿˜éœ€è¦å°†æ¯ä¸ªå•å…ƒæ ¼æ”¾åœ¨æ¿ä¸Šçš„ç›¸åº”ä½ç½®ã€‚ å³ï¼Œå¯¹åº”äºæ­¤å•å…ƒæ ¼çš„è¡Œå’Œåˆ—çš„ä½ç½®ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä»£ç æ¥è®¡ç®—<code>FieldView</code>ç±»çš„æ¯ä¸ªå®ä¾‹çš„åæ ‡ã€‚ <br><br> å°†<code>_position</code>å±æ€§æ·»åŠ åˆ°ç±»ä¸­ï¼Œè¯¥å±æ€§è´Ÿè´£æ¸¸æˆåœºåœ°ä¸Šå•å…ƒæ ¼çš„æœ€ç»ˆåæ ‡ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts //... interface Vec2 {x: number, y: number}; export class FieldView extends Phaser.GameObjects.Sprite { private _position: Vec2 = {x: 0, y: 0}; //...</span></span></code> </pre><br> ç”±äºæˆ‘ä»¬è¦ç›¸å¯¹äºå±å¹•çš„ä¸­å¿ƒå¯¹é½æ¿å¹¶ç›¸åº”åœ°å¯¹é½å…¶ä¸­çš„å•å…ƒæ ¼ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦<code>_offset</code>å±æ€§ï¼ŒæŒ‡ç¤ºæ­¤ç‰¹å®šå•å…ƒæ ¼ç›¸å¯¹äºå±å¹•çš„å·¦è¾¹ç¼˜å’Œä¸Šè¾¹ç¼˜çš„åç§»é‡ã€‚ ä½¿ç”¨ç§æœ‰è·å–å™¨æ·»åŠ å®ƒï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts //... private get _offset(): Vec2 { return { x: (this.scene.cameras.main.width - this._model.board.cols * this.width) / 2, y: (this.scene.cameras.main.height - this._model.board.rows * this.height) / 2 }; } //...</span></span></code> </pre><br> å› æ­¤ï¼Œæˆ‘ä»¬ï¼š <br><br><ol><li> åœ¨<code>this._scene.cameras.main.width</code>è·å¾—äº†æ€»å±å¹•å®½åº¦ã€‚ </li><li> æˆ‘ä»¬é€šè¿‡å°†å•å…ƒæ ¼çš„æ•°é‡ä¹˜ä»¥ä¸€ä¸ªå•å…ƒæ ¼çš„å®½åº¦æ¥è·å¾—æœ¨æ¿çš„æ€»å®½åº¦ï¼š <code>this._board.cols * this.width</code> ã€‚ </li><li> ä»å±å¹•çš„å®½åº¦ä¸Šå‡å»æœ¨æ¿çš„å®½åº¦ï¼Œæˆ‘ä»¬åœ¨å±å¹•ä¸Šå¾—åˆ°äº†ä¸€ä¸ªä½ç½®ï¼Œè€Œä¸æ˜¯è¢«æœ¨æ¿å æ®ã€‚ </li><li> å°†ç»“æœæ•°å­—é™¤ä»¥2ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç”µè·¯æ¿çš„å·¦ä¾§å’Œå³ä¾§è·å¾—ç¼©è¿›å€¼ã€‚ </li><li> é€šè¿‡å°†æ¯ä¸ªå•å…ƒæ ¼ç§»åŠ¨æ­¤ç¼©è¿›å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¿è¯æ•´ä¸ªç”µè·¯æ¿æ²¿<code>x</code>è½´å¯¹é½ã€‚ </li></ol><br> æˆ‘ä»¬æ‰§è¡Œç»å¯¹ç›¸ä¼¼çš„åŠ¨ä½œä»¥è·å¾—å‚ç›´ä½ç§»ã€‚ <br><br> ä»ç„¶éœ€è¦åœ¨<code>_init</code>æ–¹æ³•ä¸­æ·»åŠ å¿…è¦çš„ä»£ç ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts // ... private _init(): void { const offset = this._offset; this.x = this._position.x = offset.x + this.width * this._model.col + this.width / 2; this.y = this._position.y = offset.y + this.height * this._model.row + this.height / 2; } // ...</span></span></code> </pre><br> è¿™é‡Œçš„å±æ€§<code>this.x</code> ï¼Œ <code>this.y</code> ï¼Œ <code>this.width</code>å’Œ<code>this.height</code>æ˜¯çˆ¶ç±»<code>Phaser.GameObjects.Sprite</code>çš„ç»§æ‰¿å±æ€§ã€‚ æ›´æ”¹<code>this.x</code>å’Œ<code>this.y</code>çš„å±æ€§å°†å¯¼è‡´ç²¾çµåœ¨ç”»å¸ƒä¸Šçš„æ­£ç¡®å®šä½ã€‚ <br><br><a name="section-3-6"></a><h3>  <font color="#008080">3.6åˆ›å»ºFieldViewçš„å®ä¾‹</font> </h3><br> åœ¨<code>Field</code>ç±»ä¸­åˆ›å»ºä¸€ä¸ªè§†å›¾ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Field.ts // ... private _view: FieldView = null; public get view(): FieldView { return this._view; } private _init(scene: Phaser.Scene, board: Board, row: number, col: number): void { //... this._view = new FieldView(this._scene, this); } // ...</span></span></code> </pre><br><a name="section-3-7"></a><h3>  <font color="#008080">3.7æ˜¾ç¤ºæ¿å­—æ®µã€‚</font> </h3><br> è®©æˆ‘ä»¬å›åˆ°<code>Board</code>ç±»ï¼Œå®ƒå®é™…ä¸Šæ˜¯<code>Field</code>å¯¹è±¡çš„é›†åˆï¼Œå¹¶å°†åˆ›å»ºå•å…ƒæ ¼ã€‚ <br><br> æˆ‘ä»¬å°†æŠŠæœ¨æ¿åˆ›å»ºä»£ç å–å‡ºåˆ°ä¸€ä¸ªå•ç‹¬çš„<code>_create</code>æ–¹æ³•ä¸­ï¼Œå¹¶ä»æ„é€ å‡½æ•°ä¸­è°ƒç”¨æ­¤æ–¹æ³•ã€‚ çŸ¥é“åœ¨<code>_create</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…å°†åˆ›å»ºå•å…ƒæ ¼ï¼Œè¿˜å°†æå–ç”¨äºåœ¨å•ç‹¬çš„<code>_createFields</code>æ–¹æ³•ä¸­åˆ›å»ºå•å…ƒæ ¼çš„ä»£ç ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts constructor(scene: Phaser.Scene, rows: number, cols: number, bombs: number) { // ... this._create(); } private _create(): void { this._createFields(); } private _createFields(): void { }</span></span></code> </pre><br> æ­£æ˜¯åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨åµŒå¥—å¾ªç¯ä¸­åˆ›å»ºæ‰€éœ€æ•°é‡çš„å•å…ƒæ ¼ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts // ... private _createFields(): void { for (let row = 0; row &lt; this._rows; row++) { for (let col = 0; col &lt; this._cols; col++) { this._fields.push(new Field(this._scene, this, row, col)); } } } //...</span></span></code> </pre><br> è¿™æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨è¯¥å‘½ä»¤è¿è¡Œç¨‹åºé›†è¿›è¡Œè°ƒè¯• <br><br><pre> <code class="plaintext hljs">npm start</code> </pre> <br> ç¡®ä¿åœ¨å±å¹•ä¸­å¤®ï¼Œæˆ‘ä»¬å¸Œæœ›çœ‹åˆ°8è¡Œä¸­çš„64ä¸ªå•å…ƒæ ¼ã€‚ <br><br><a name="section-3-8"></a><h3>  <font color="#008080">3.8åˆ¶é€ ç‚¸å¼¹</font> </h3><br> ä¹‹å‰ï¼Œæˆ‘æŠ¥é“äº†åœ¨<code>Board</code>ç±»çš„<code>_create</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ä»…åˆ›å»ºå­—æ®µã€‚ è¿˜æœ‰ä»€ä¹ˆ è¿˜å°†åˆ›å»ºç‚¸å¼¹ï¼Œå¹¶å°†åˆ›å»ºçš„å•å…ƒæ ¼è®¾ç½®ä¸ºç›¸é‚»ç‚¸å¼¹çš„æ•°é‡ã€‚ è®©æˆ‘ä»¬ä»ç‚¸å¼¹æœ¬èº«å¼€å§‹ã€‚ <br><br> æˆ‘ä»¬éœ€è¦å°†Næšç‚¸å¼¹æ”¾åœ¨æ¿ä¸Šéšæœºçš„å•å…ƒæ ¼ä¸­ã€‚ æˆ‘ä»¬ç”¨è¿‘ä¼¼ç®—æ³•æè¿°ç‚¸å¼¹çš„åˆ›å»ºè¿‡ç¨‹ï¼š <br><br><pre> <code class="plaintext hljs">                        </code> </pre><br> åœ¨å¾ªç¯çš„æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°†ä»<code>this._fields</code>å±æ€§ä¸­è·å¾—ä¸€ä¸ªéšæœºå•å…ƒï¼Œç›´åˆ°åˆ›å»ºçš„ç‚¸å¼¹æ•°é‡ä¸<code>this._bombs</code>å­—æ®µä¸­æŒ‡ç¤ºçš„<code>this._bombs</code> ã€‚ å¦‚æœæ¥æ”¶åˆ°çš„å•å…ƒæ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†åœ¨å…¶ä¸­å®‰è£…ç‚¸å¼¹å¹¶æ›´æ–°ç”Ÿæˆç‚¸å¼¹æ‰€éœ€çš„è®¡æ•°å™¨ã€‚ <br><br> è¦ç”Ÿæˆéšæœºæ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨é™æ€æ–¹æ³•<code>Phaser.Math.Between</code> ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts //... private _createBombs(): void { let count = this._bombs; //      while (count &gt; 0) { //       let field = this._fields[Phaser.Math.Between(0, this._fields.length - 1)]; //    if (field.empty) { //     field.setBomb(); //     --count; //    } } }</span></span></code> </pre><br> ä¸è¦å¿˜è®°åœ¨<code>Board.ts</code>æ–‡ä»¶ä¸­å†™å¯¹<code>this._createBombs();</code>çš„<code>Board.ts</code> <code>this._createBombs();</code> åœ¨<code>_create</code>æ–¹æ³•çš„æœ«å°¾ <br><br> æ­£å¦‚æ‚¨å·²ç»æ³¨æ„åˆ°çš„ï¼Œä¸ºäº†ä½¿æ­¤ä»£ç æ­£ç¡®è¿è¡Œï¼Œæ‚¨éœ€è¦é€šè¿‡å‘å…¶æ·»åŠ <code>empty</code> getterå’Œ<code>setBomb</code>æ–¹æ³•æ¥æ”¹è¿›<code>Field</code>ç±»ã€‚ <br><br> å°†ä¸€ä¸ª<code>_value</code>ç§æœ‰å­—æ®µæ·»åŠ åˆ°Field <code>_value</code> ï¼Œè¿™å°†æ§åˆ¶å•å…ƒæ ¼çš„å†…å®¹ã€‚ æˆ‘ä»¬æ¥å—ä»¥ä¸‹åè®®ã€‚ <br><div class="scrollable-table"><table><tbody><tr><td>  <code>_value</code> === 0 </td><td> å•å…ƒæ ¼ä¸ºç©ºï¼Œå¹¶ä¸”å…¶ä¸­æ²¡æœ‰åœ°é›·æˆ–å€¼ </td></tr><tr><td>  <code>_value</code> === -1 </td><td> ç‰¢æˆ¿é‡Œæœ‰ä¸€ä¸ªåœ°é›· </td></tr><tr><td>  <code>_value</code> &gt; 0 </td><td> å•å…ƒä¸­çš„æ˜¯å½“å‰å•å…ƒæ—è¾¹çš„åœ°é›·æ•°é‡ </td></tr></tbody></table></div><br> éµå¾ªè¿™äº›è§„åˆ™ï¼Œæˆ‘ä»¬å°†åœ¨<code>Field</code>ç±»ä¸­å¼€å‘ä½¿ç”¨<code>_value</code>å±æ€§çš„æ–¹æ³•ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Field.ts // ... private _value: number = 0; // ... public get value(): number { return this._value; } public set value(value) { this._value = value; } public get empty(): boolean { return this._value === 0; } public get mined(): boolean { return this._value === -1; } public get filled(): boolean { return this._value &gt; 0; } public setBomb(): void { this._value = -1; } // ...</span></span></code> </pre><br><a name="section-3-9"></a><h3>  <font color="#008080">3.9è®¾å®šå€¼</font> </h3><br> ç‚¸å¼¹å·²ç»æ’åˆ—å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æ‹¥æœ‰æ‰€æœ‰æ•°æ®ï¼Œä»¥ä¾¿åœ¨éœ€è¦å®ƒçš„æ‰€æœ‰å•å…ƒæ ¼ä¸­è®¾ç½®æ•°å€¼ã€‚ <br><br> è®©æˆ‘æé†’æ‚¨ï¼Œæ ¹æ®å·¥å…µçš„è§„åˆ™ï¼Œè¯¥ç‰¢æˆ¿çš„æ•°é‡å¿…é¡»ä¸ä½äºè¯¥ç‰¢æˆ¿æ—è¾¹çš„ç‚¸å¼¹æ•°é‡ç›¸å¯¹åº”ã€‚ æ ¹æ®æ­¤è§„åˆ™ï¼Œæˆ‘ä»¬ç¼–å†™ç›¸åº”çš„ä¼ªä»£ç ã€‚ <br><br><pre> <code class="plaintext hljs">                  </code> </pre><br> åœ¨<code>Board</code>ç±»ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–¹æ³•å¹¶å°†æŒ‡å®šçš„ä¼ªä»£ç è½¬æ¢ä¸ºçœŸå®ä»£ç ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts //... private _createValues() { //      this._fields.forEach(field =&gt; { //      if (field.mined) { //     field.getClosestFields().forEach(item =&gt; { //      if (item.value &gt;= 0) { ++item.value; } }); } }); } //...</span></span></code> </pre><br> è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬ä½¿ç”¨çš„å“ªäº›æ¥å£æ²¡æœ‰å®ç°ã€‚ æ‚¨éœ€è¦æ·»åŠ <code>getClosestFields</code>æ–¹æ³•æ¥è·å–ç›¸é‚»çš„å•å…ƒæ ¼ã€‚ <br><br> å¦‚ä½•è¯†åˆ«ç›¸é‚»å°åŒºï¼Ÿ <br><br> ä¾‹å¦‚ï¼Œè€ƒè™‘æ¿å­ä¸Šä»»ä½•ä¸åœ¨è¾¹ç¼˜çš„å•å…ƒï¼Œå³ä¸åœ¨æè¡Œå’Œæåˆ—ä¸­çš„å•å…ƒã€‚ è¿™æ ·çš„åƒå…ƒå…·æœ‰æœ€å¤§æ•°é‡çš„é‚»å±…ï¼šé¡¶æ•°ä¸º1ï¼Œåº•æ•°ä¸º1ï¼Œå·¦æ•°ä¸º3ï¼Œå³æ•°ä¸º3ï¼ˆåŒ…æ‹¬å¯¹è§’çº¿ä¸Šçš„åƒå…ƒï¼‰ã€‚ <br><br> å› æ­¤ï¼Œåœ¨æ¯ä¸ªç›¸é‚»çš„å•å…ƒæ ¼ä¸­ï¼ŒæŒ‡ç¤ºç¬¦<code>_row</code>å’Œ<code>_col</code>ä¸è¶…è¿‡1ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é¢„å…ˆæŒ‡å®šå½“å‰å­—æ®µçš„å‚æ•°<code>_row</code>å’Œ<code>_col</code>ä¹‹é—´çš„å·®å¼‚ã€‚ åœ¨æ–‡ä»¶çš„å¼€å¤´æ·»åŠ ä¸€ä¸ªå¸¸é‡åˆ°ç±»æè¿°ä¸­ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Field.ts const Positions = [ {row : 0, col : 1}, //  {row : 0, col : -1}, //  {row : 1, col : 0}, //  {row : 1, col : 1}, //   {row : 1, col : -1}, //   {row : -1, col : 0}, //  {row : -1, col : 1}, //   {row : -1, col : -1} //   ]; //...</span></span></code> </pre><br> ç°åœ¨æˆ‘ä»¬å¯ä»¥æ·»åŠ ç¼ºå°‘çš„æ–¹æ³•ï¼Œåœ¨å…¶ä¸­å¾ªç¯éå†æ­¤æ•°ç»„ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Field.ts //... public getClosestFields(): Field[] { let results = []; //      Positions.forEach(position =&gt; { //      let field = this._board.getField(this._row + position.row, this._col + position.col); //       if (field) { //     results.push(field); } }); return results; }; //...</span></span></code> </pre><br> ä¸è¦å¿˜è®°åœ¨æ¯æ¬¡è¿­ä»£ä¸­æ£€æŸ¥<code>field</code>å˜é‡ï¼Œå› ä¸ºæ¿ä¸Šçš„å¹¶éæ‰€æœ‰å•å…ƒéƒ½æœ‰8ä¸ªé‚»å±…ã€‚ ä¾‹å¦‚ï¼Œå·¦ä¸Šæ–¹çš„å•å…ƒæ ¼åœ¨å…¶å·¦ä¾§å°†æ²¡æœ‰é‚»å±…ï¼Œä¾æ­¤ç±»æ¨ã€‚ <br><br> ä»ç„¶éœ€è¦å®ç°<code>getField</code>æ–¹æ³•å¹¶å°†æ‰€æœ‰å¿…éœ€çš„è°ƒç”¨æ·»åŠ åˆ°<code>Board</code>ç±»ä¸­çš„<code>_create</code>æ–¹æ³• <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts //... public getField(row: number, col: number): Field { return this._fields.find(field =&gt; field.row === row &amp;&amp; field.col === col); } //... private _create(): void { this._createFields(); this._createBombs(); this._createValues(); } //...</span></span></code> </pre><br><a name="section-4"></a><h2> <font color="#008080">4.   </font> </h2><br><a name="section-4-1"></a><h3> <font color="#008080">4.1     </font> </h3><br>        ,         ,             .            . <br><br>       .   <code>FieldView</code>      <code>_create</code>  : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FielView.ts //... private _create(): void { // ... this.setInteractive(); } //...</span></span></code> </pre><br>  phaser           <code>Phaser.GameObjects</code> .        ( <code>pointerdown</code> )   ,     <code>FieldView</code> ,   <code>Phaser.GameObjects.Sprite</code> . <br><br>     ,    ,     ,         .      <code>setInteractive</code>     ,       . <br><br> ,      ,    <code>Board</code>   ,      <code>Field</code> ,     <code>_createFields</code>        : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts //... private _createFields(): void { for (let row = 0; row &lt; this._rows; row++) { for (let col = 0; col &lt; this._cols; col++) { const field = new Field(this._scene, this, row, col) field.view.on('pointerdown', this._onFieldClick.bind(this, field)); this._fields.push(field); } } } //...</span></span></code> </pre><br>   ,          <code>_onFieldClick</code> ,    .          <code>Board</code> .  ,                ,         <code>GameScene</code> . ,      ,   <code>Board</code>   .   : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts //... private _onFieldClick(field: Field, pointer: Phaser.Input.Pointer): void { if (pointer.leftButtonDown()) { this.emit(`left-click`, field); } else if (pointer.rightButtonDown()) { this.emit(`right-click`, field); } } //...</span></span></code> </pre><br>       ,   ,    ,     .     ,           . ,      ,  ,     ,   ,   ,   <code>Field</code> . <br><br>         <code>GameScene</code>      <code>_create</code> ,     : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts //... import { Field } from "../models/Field"; //... public create(): void { this._board = new Board(this, Rows, Cols, Bombs); this._board.on('left-click', this._onFieldClickLeft, this); this._board.on('right-click', this._onFieldClickRight, this); } private _onFieldClickLeft(field: Field): void { } private _onFieldClickRight(field: Field): void { } //...</span></span></code> </pre><br><a name="section-4-2"></a><h3> <font color="#008080">4.2.     </font> </h3><br>       .     .       .  ,     ,   ,   : <br><br><ol><li>         </li><li>      â€”   </li><li>       ,  ,       ,               ,        </li><li>       ,         ,     </li></ol><br>             : <br><br><pre> <code class="plaintext hljs">                         </code> </pre><br>      ,   .   <code>_onFieldClickLeft</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// GameScene.ts //... private _onFieldClickLeft(field: Field): void { if (field.closed) { //    field.open(); //   if (field.mined) { //    field.exploded = true; this._onGameOver(false); //   } else if (field.empty) { //    this._board.openClosestFields(field); //   } } else if (field.opened) { //    if (this._board.completed) { //       this._onGameOver(true); //   } } } //...</span></span></code> </pre><br>  ,  ,   <code>Field</code>  <code>Board</code> ,     ,     . <br><br>  3      <code>States</code> ,   <code>_state</code>        : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Field.ts enum States { Closed = 'closed', Opened = 'opened', Marked = 'flag' }; export class Field extends Phaser.Events.EventEmitter { private _state: string = States.Closed; //... public get marked(): boolean { return this._state === States.Marked; } public get closed(): boolean { return this._state === States.Closed; } public get opened(): boolean { return this._state === States.Opened; } //...</span></span></code> </pre><br> ,     ,     ,     <code>open</code> ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Field.ts //... public open(): void { this._setState(States.Opened); } private _setState(state: string): void { if (this._state !== state) { this._state = state; this.emit('change'); } } //...</span></span></code> </pre><br>       ,   .      <code>_setState</code> ,         .         ,     . <br><br>    <code>_exploded</code>       Field,   : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Field.ts private _exploded: boolean = false; //... public set exploded(exploded: boolean) { this._exploded = exploded; this.emit('change'); } public get exploded(): boolean { return this._exploded; } //...</span></span></code> </pre><br>    <code>Board</code>      <code>openClosestFields</code> .           ,           . <br>   : <br><br><pre> <code class="plaintext hljs"> :                </code> </pre><br>                : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts //... public openClosestFields(field: Field): void { field.getClosestFields().forEach(item =&gt; {//     if (item.closed) {//    item.open();//   if (item.empty) {//    this.openClosestFields(item);//     } } }); } //...</span></span></code> </pre><br>   <code>completed</code>   <code>Board</code>       .        ?           . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts //... public get completed(): boolean { return this._fields.filter(field =&gt; field.completed).length === this._bombs; } //...</span></span></code> </pre><br>     <code>_fields</code>   <code>completed</code> ,      .     (      ,     <code>completed</code>    <code>Field</code> )    <code>_bombs</code> (     ),   <code>true</code> ,  ,   . <br>          ,       .       <code>Board</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts //... public open(): void { this._fields.forEach(field =&gt; field.open()); } //...</span></span></code> </pre><br>    <code>completed</code>    <code>Field</code> .        ?    ,   .           : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Field.ts //... public get completed(): boolean { return this.marked &amp;&amp; this.mined; } //...</span></span></code> </pre><br>         <code>_onGameOver</code> ,           .                 <code>status</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// GameScene.ts //... private _onGameOver(status: boolean) { this._board.off('left-click', this._onFieldClickLeft, this); this._board.off('right-click', this._onFieldClickRight, this); this._board.open(); } //...</span></span></code> </pre><br><a name="section-4-3"></a><h3> <font color="#008080">4.3  </font> </h3><br>             . <br><br>    <code>Field</code>    <code>_setState</code> ,    <code>change</code>    .      <code>FieldView</code>    : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts //... private _init(): void { //... this._model.on('change', this._onStateChange, this); } private _onStateChange(): void { this._render(); } private _render(): void { this.setFrame(this._frameName); } //...</span></span></code> </pre><br>      <code>_onStateChange</code>    .     ,     ,  ,    <code>_render</code> . <br><br>            .        ,     <code>setFrame</code>  ,      . <br><br>           <code>_frameName</code> ,    .     ,     . <br><div class="scrollable-table"><table><tbody><tr><td>  </td><td> æ¡ä»¶ </td></tr><tr><td> <code>closed</code> </td> <td>   <br></td></tr><tr><td> <code>flag</code> </td> <td>    <br></td></tr><tr><td> <code>empty</code> </td> <td>  ,       <br></td></tr><tr><td> <code>exploded</code> <br> </td><td>  ,    <br></td></tr><tr><td> <code>mined</code> <br> </td><td>  , ,    <br></td></tr><tr><td> <code>1...9</code> <br> </td><td>       1  9,        <br></td></tr></tbody></table></div><br>           ,      .      : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts const States = { 'closed': field =&gt; field.closed, 'flag': field =&gt; field.marked, 'empty': field =&gt; field.opened &amp;&amp; !field.mined &amp;&amp; !field.filled, 'exploded': field =&gt; field.opened &amp;&amp; field.mined &amp;&amp; field.exploded, 'mined': field =&gt; field.opened &amp;&amp; field.mined &amp;&amp; !field.exploded } //...</span></span></code> </pre><br>        ,     â€” ,   .            (    ): <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts //... private get _frameName(): string { for (let key in States) { if (States[key](this._model)) { return key; } } return this._model.value.toString(); }</span></span></code> </pre><br>                 .  ,     <code>true</code> , ,   <code>key</code>           . <br><br>      ,           <code>_value</code> ,        <code>States</code>   . <br><br>            ,          . <br><br><a name="section-4-4"></a><h3> <font color="#008080">4.4   </font> </h3><br>         ,     .           .     . <br><br><ol><li>      ,       </li><li>   ,           </li><li>  /                 </li></ol><br>          : <br><br><pre> <code class="plaintext hljs">                              </code> </pre><br>          ,      : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// GameScene.ts private _flags: number = 0; //... private _onFieldClickRight(field: Field): void { if (field.closed &amp;&amp; this._flags &gt; 0) { //        field.addFlag(); //     } else if (field.marked) { //     field.removeFlag(); //   } this._flags = Bombs - this._board.countMarked; } //... public create(): void { this._flags = Bombs; //... } //...</span></span></code> </pre><br>       <code>_flags</code> ,          ,           .        ,        ,    .    <code>Board</code>  <code>countMarked</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Board.ts //... public get countMarked(): number { return this._fields.filter(field =&gt; field.marked).length; } //...</span></span></code> </pre><br>     â€”     <code>Field</code> ,           <code>open</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Field.ts //... public addFlag(): void { this._setState(States.Marked); } public removeFlag(): void { this._setState(States.Closed); } //...</span></span></code> </pre><br> ,  <code>_setState</code>   <code>change</code> ,     ,  ,          . <br><br>       ,           .  ,   ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// GameScene.ts //... constructor() { super('Game'); //        document.querySelector("canvas").oncontextmenu = e =&gt; e.preventDefault(); } //...</span></span></code> </pre><br><a name="section-4-5"></a><h3> <font color="#008080">4.5  GameSceneView</font> </h3><br>   UI       <code>GameSceneView</code>     <code>src/scripts/views/GameSceneView.ts</code> . <br><br>         <code>FieldView</code>           <code>GameObjects</code> . <br>           : <br><br><ul><li>     </li><li>   </li><li>      (/) </li></ul><br>    UI      <code>GameSceneView</code> . <br>  . <br><br><pre> <code class="javascript hljs">enum Styles { Color = <span class="hljs-string"><span class="hljs-string">'#008080'</span></span>, Font = <span class="hljs-string"><span class="hljs-string">'Arial'</span></span> } enum Texts { Flags = <span class="hljs-string"><span class="hljs-string">'FLAGS: '</span></span>, Exit = <span class="hljs-string"><span class="hljs-string">'EXIT'</span></span>, Success = <span class="hljs-string"><span class="hljs-string">'YOU WIN!'</span></span>, Failure = <span class="hljs-string"><span class="hljs-string">'YOU LOOSE'</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameSceneView</span></span></span><span class="hljs-class"> </span></span>{ private _scene: Phaser.Scene = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; private _style: {<span class="hljs-attr"><span class="hljs-attr">font</span></span>: string, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: string}; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(scene: Phaser.Scene) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._scene = scene; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._style = {<span class="hljs-attr"><span class="hljs-attr">font</span></span>: <span class="hljs-string"><span class="hljs-string">`28px </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${Styles.Font}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: Styles.Color}; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._create(); } private _create(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { } public render() { } }</code> </pre><br>     . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// GameSceneView.ts //... private _txtFlags: Phaser.GameObjects.Text = null; //... private _createTxtFlags(): void { this._txtFlags = this._scene.add.text( 50, 50, Texts.Flags, this._style ).setOrigin(0, 1); } //...</span></span></code> </pre><br>           50px          .  ,  <code>setOrigin</code>  pivot point    (0, 1).  ,        . <br><br>   . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// GameSceneView.ts //... private _txtStatus: Phaser.GameObjects.Text = null; //... private _createTxtStatus(): void { this._txtStatus = this._scene.add.text( this._scene.cameras.main.centerX, 50, Texts.Success, this._style ).setOrigin(0.5, 1); this._txtStatus.visible = false; } //...</span></span></code> </pre><br>               <code>setOrigin</code>   0.5   x.  ,      ,           . <br><br>   ,        . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// GameSceneView.ts //... private _btnExit: Phaser.GameObjects.Text = null; //... private _createBtnExit(): void { this._btnExit = this._scene.add.text( this._scene.cameras.main.width - 50, 50, Texts.Exit, this._style ).setOrigin(1); this._btnExit.setInteractive(); this._btnExit.once('pointerdown', () =&gt; { this._scene.scene.start('Start'); }); } //...</span></span></code> </pre><br>           <code>setOrigin</code> ,          .         ,      .           . <br><br>    <code>render</code>      UI        <code>_create</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// GameSceneView.ts //... private _create(): void { this._createTxtFlags(); this._createTxtStatus(); this._createBtnExit(); } public render(data: {flags?: number, status?: boolean}) { if (typeof data.flags !== 'undefined') { this._txtFlags.text = Texts.Flags + data.flags.toString(); } if (typeof data.status !== 'undefined') { this._txtStatus.text = data.status ? Texts.Success : Texts.Failure; this._txtStatus.visible = true; } } //...</span></span></code> </pre><br>         UI,   . <br>        GameScene     _render  ,     : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// GameScene.ts //... import { GameSceneView } from "../views/GameSceneView"; //... export class GameScene extends Phaser.Scene { private _view: GameSceneView = null; //... private _onGameOver(status: boolean) { //... this._view.render({status}); } //... private _onFieldClickRight(field: Field): void { //... this._flags = Bombs - this._board.countMarked; this._view.render({flags: this._flags}); } //... public create(): void { //... this._view = new GameSceneView(this); this._view.render({flags: this._flags}); } //... }</span></span></code> </pre><br><a name="section-5"></a><h2> <font color="#008080">5. </font> </h2><br>      ,     ,     ?!  ,      phaser,           .             . <br><br>    2 :          .     . <br><br><a name="section-5-1"></a><h3> <font color="#008080">5.1   </font> </h3><br><img src="https://habrastorage.org/webt/7r/uu/1v/7ruu1vtppaw26sp-fapxbahgm9q.gif"><br><br>  ,             .                         . <br><br>   <code>FiledView</code>     <code>_create</code>  <code>_animateShow</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts //... private _create(): void { //... this._animateShow(); } //...</span></span></code> </pre><br> B     .  ,     ,   2 : <br><br><ol><li>       ,        </li><li>          </li></ol><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts //... private _animateShow(): Promise&lt;void&gt; { this.x = -this.width; this.y = -this.height; const delay = this._model.row * 50 + this._model.col * 10; return this._moveTo(this._position, delay); } //...</span></span></code> </pre><br>         (0, 0),      ,       ,           .       . <br><br>       <code>_moveTo</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts //... private _moveTo(position: Vec2, delay: number): Promise&lt;void&gt; { return new Promise(resolve =&gt; { this.scene.tweens.add({ targets: this, x: position.x, y: position.y, duration: 600, ease: 'Elastic', easeParams: [1, 1], delay, onComplete: () =&gt; { resolve(); } }); }); } //...</span></span></code> </pre><br>        <code>tweens</code> .    <code>add</code>      : <br><br><ul><li>  <code>targets</code>         ,      .      <code>this</code>   ,      . </li><li>         . </li><li>  <code>duration</code>    ,    â€” 600. </li><li>  <code>ease</code>  <code>easeParams</code>  easing . </li><li>   delay     ,             .    ,     .           . </li><li> ,   <code>onComplete</code>   ,       . </li></ul><br>     ,         ,        <code>resolve</code> ,    . <br><br><a name="section-5-2"></a><h3> <font color="#008080">5.2   </font> </h3><br><img src="https://habrastorage.org/webt/uc/d-/yw/ucd-yw-nq6a4veixb-npp0mdyqy.gif"><br><br>  ,          .     ? <br><br>            <code>_render</code>  .        ,  ,    .  ,    ,        . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts //... private _onStateChange(): void { if (this._model.opened) { this._animateFlip(); } else { this._render(); } } //...</span></span></code> </pre><br>          <code>scale</code> .           <code>x</code>  ,     ,     .  ,      <code>x</code>      ,       .      <code>_animateFlip</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts //... private _animateFlip(): void { this._scaleXTo(0).then(() =&gt; { this._render(); this._scaleXTo(1); }) } //...</span></span></code> </pre><br>     <code>_moveTo</code>  <code>_scaleTo</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// FieldView.ts //... private _scaleXTo(scaleX: number): Promise&lt;void&gt; { return new Promise(resolve =&gt; { this.scene.tweens.add({ targets: this, scaleX, ease: 'Elastic.easeInOut', easeParams: [1, 1], duration: 150, onComplete: () =&gt; { resolve() } }); }); } //...</span></span></code> </pre><br>          ,                   .          . <br><br>             ,    !  :) <br><br>     ,        ! <br><br><h2> ç»“è®º </h2><br> ,    ,    ,                .             ,      phaser      .            ! <br><br>         .          ,         .      . ,       ,      ,  , tilemap, spine  . <br>     ,        ,  ,         ,  ,      ?   ,                    ,     .   . <br><br>    !       ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN476682/">https://habr.com/ru/post/zh-CN476682/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN476670/index.html">å‡ ä½•æ ¸C3Dä¸Šçš„CADæ¦‚è¿°-2</a></li>
<li><a href="../zh-CN476674/index.html">ReportPortalå¿«é€Ÿéƒ¨ç½²ä»¥ç†Ÿæ‚‰</a></li>
<li><a href="../zh-CN476676/index.html">48ä¸ªJavaScriptå¼€æºèµ„æºï¼ˆ2019ï¼‰</a></li>
<li><a href="../zh-CN476678/index.html">ä½¿ç”¨Apple Combineè¿›è¡Œè¿œç¨‹å¼‚æ­¥è·å–çš„API</a></li>
<li><a href="../zh-CN476680/index.html">Rodovçš„è¿ç»­ç”Ÿäº§è®¡åˆ’ç³»ç»Ÿæ˜¯1961å¹´çš„è‹è”ç²¾ç›Šç”Ÿäº§è®¡åˆ’/ MRPã€‚ èµ·é£ï¼Œæ—¥è½å’Œæ–°ç”Ÿ</a></li>
<li><a href="../zh-CN476686/index.html">åŸºäºRaspberry CM3 +çš„ç‰©è”ç½‘ç½‘å…³çš„å¼€å‘</a></li>
<li><a href="../zh-CN476688/index.html">OTUSçš„æ–°è¯¾ç¨‹ã€‚ â€œ IOSå¼€å‘äººå‘˜ã€‚ é«˜çº§è¯¾ç¨‹V 2.0Â»</a></li>
<li><a href="../zh-CN476692/index.html">å†…å®¹è¥é”€åŸåˆ™</a></li>
<li><a href="../zh-CN476694/index.html">å…³äºä¸Farida Roslovetsä»¥åŠElectro-neeek RPAä¸»ç®¡ä¸€èµ·è¿›è¡Œçš„ä¸šåŠ¡æœºå™¨äººåŒ–</a></li>
<li><a href="../zh-CN476696/index.html">å¦‚ä½•åˆ›å»ºå’Œéƒ¨ç½²å…¨æ ˆé˜µè¥çš„åº”ç”¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>