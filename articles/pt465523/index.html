<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧓🏿 😉 📍 Mais uma cobra Android com Kivy, Python 🕟 👕 👨🏽‍🤝‍👨🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Olá. 

 Muitas pessoas querem começar a programar aplicativos para Android, mas preferem não usar o Android Studio e / ou Java. Porque Porque é um exa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mais uma cobra Android com Kivy, Python</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465523/"> Olá. <br><br>  Muitas pessoas querem começar a programar aplicativos para Android, mas preferem não usar o Android Studio e / ou Java.  Porque  Porque é um exagero.  "Eu só quero criar Snake e nada mais!" <br><br><img src="https://habrastorage.org/webt/gb/yu/vz/gbyuvzpeftcwxbxi9gwa2xz5axe.png"><br><br>  Vamos cobra sem java!  (com um bônus no final) <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Por que criar mais um tutorial sobre cobras?</b> <div class="spoiler_text">  Se você é um codificador python e deseja aprender o gamedev para android, já deve ter pesquisado no Google "snake on android" e encontrou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este (Eng)</a> ou sua <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tradução (Rus)</a> .  Eu também. Infelizmente, achei o artigo extremamente inútil porque: <br><br><h5>  O código deles é ruim </h5><br>  Questões menores: <br><br><ol><li>  Usar "lado a lado" e "cabeça" em vez de "lado a lado" ou "célula" não faz sentido para mim.  A cabeça não é suficientemente distinta do bloco para ser variáveis ​​diferentes. </li><li>  Clock.schedule para self.update é chamado de ... self.update. </li><li>  A classe de segundo nível Playground é implementada no início, enquanto a classe de primeiro nível SnakeApp é implementada no final. </li><li>  Nomes para direções ("para cima", "para baixo", ...) são usados ​​em vez de vetores ((0, 1), (1, 0) ...). </li></ol><br>  Questões principais: <br><br><ol><li>  A maioria dos objetos dinâmicos (por exemplo, a fruta) é anexada ao arquivo kv; portanto, você não pode fazer mais de uma maçã, pois deve reescrever esta parte </li><li>  Lógica estranha para o movimento da cobra em vez do movimento "célula após célula". </li><li>  O código é muito longo, com mais de 350 linhas. </li></ol><br><h5>  O artigo não está claro para iniciantes </h5><br>  Esta é a minha opinião pessoal.  Além disso, não garanto que meu tutorial seja mais interessante e claro.  Mas farei o meu melhor e, no meu artigo, garanto que: <br><br><ol><li>  O código é curto </li><li>  A cobra é legal </li><li>  As instruções terão implementações claras passo a passo e progressão suave de "olá, mundo" para uma cobra pronta com etapas transitórias. </li></ol><br><h5>  O resultado indesejável </h5><br><img src="https://habrastorage.org/webt/n6/q-/li/n6q-lieen74-rcs-tzwrr1yguwa.png"><br>  Não há espaço entre as células, o triângulo é embaraçoso, os gráficos são defeituosos. <br></div></div><br><h1>  Familiarize-se </h1><br><h3>  Primeiro aplicativo </h3><br>  Por favor, confirme que você já instalou o Kivy (caso contrário, siga as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instruções</a> ) e executou <br>  <code>buildozer init</code> no diretório do projeto. <br><br>  Vamos executar nosso primeiro aplicativo: <br><br>  main.py <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Widget() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br><img src="https://habrastorage.org/webt/ms/he/ud/msheudwu1tc3wcvjj8z2x9oswgi.png"><br><br>  Criamos um widget.  Analogamente, podemos criar um botão ou qualquer outro elemento da interface do usuário: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.button <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Button <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.but = Button() self.but.pos = (<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) self.but.size = (<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>) self.but.text = <span class="hljs-string"><span class="hljs-string">"Hello, cruel world"</span></span> self.form = Widget() self.form.add_widget(self.but) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br><img src="https://habrastorage.org/webt/gp/k1/cn/gpk1cngh7ns5z9wdtjuua5d1ogg.png"><br><br>  Uau!  Parabéns!  Você criou um botão! <br><br><h3>  arquivos .kv </h3><br>  No entanto, há outra maneira de criar elementos da interface do usuário.  Primeiro, implementamos nosso formulário: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.button <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Button <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.but1 = Button() self.but1.pos = (<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) self.add_widget(self.but1) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form = Form() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br>  Em seguida, criamos o arquivo "worm.kv". <br><br>  worm.kv <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: but2: but_id Button: id: but_id pos: (200, 200)</code> </pre><br>  O que aconteceu?  Criamos outro botão e atribuímos o ID but_id.  Em seguida, o but_id foi correspondido ao but2 do formulário.  Isso significa que agora podemos nos referir a este botão but2 <br><br><pre> <code class="plaintext hljs">class Form(Widget): def __init__(self): super().__init__() self.but1 = Button() self.but1.pos = (100, 100) self.add_widget(self.but1) # self.but2.text = "OH MY"</code> </pre><br><img src="https://habrastorage.org/webt/ug/a6/88/uga688dhltpl2klklqbigyodu40.png"><br><br><h3>  Gráficos </h3><br>  O que fazemos a seguir é criar um elemento gráfico.  Primeiro, implementamos no worm.kv: <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: &lt;Cell&gt;: canvas: Rectangle: size: self.size pos: self.pos</code> </pre><br>  Vinculamos a posição do retângulo ao self.pos e seu tamanho ao self.size.  Portanto, agora essas propriedades estão disponíveis no Cell, por exemplo, quando criamos uma célula, podemos fazer <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.size = (size, size) <span class="hljs-comment"><span class="hljs-comment"># As you can see, we can change self.size which is "size" property of a rectangle self.pos = (x, y) class Form(Widget): def __init__(self): super().__init__() self.cell = Cell(100, 100, 30) self.add_widget(self.cell)</span></span></code> </pre><br><img src="https://habrastorage.org/webt/we/j4/dn/wej4dnu0jojperjlmnlflu5dxi8.png"><br><br>  Ok, criamos uma célula. <br><br><h3>  Métodos desnecessários </h3><br>  Vamos tentar movê-lo.  Para fazer isso, devemos adicionar a função Form.update e agendá-la. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.size = (size, size) self.pos = (x, y) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cell = Cell(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.add_widget(self.cell) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> Clock.schedule_interval(self.update, <span class="hljs-number"><span class="hljs-number">0.01</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> self.cell.pos = (self.cell.pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-number"><span class="hljs-number">2</span></span>, self.cell.pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form = Form() self.form.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br>  A célula se moverá pelo formulário.  Como você pode ver, podemos agendar qualquer função com o Clock. <br><br>  Em seguida, vamos fazer um evento de toque.  Reescrever o formulário: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cells = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> Clock.schedule_interval(self.update, <span class="hljs-number"><span class="hljs-number">0.01</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.cells: cell.pos = (cell.pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-number"><span class="hljs-number">2</span></span>, cell.pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> cell = Cell(touch.x, touch.y, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.add_widget(cell) self.cells.append(cell)</code> </pre><br>  Cada touch_down cria uma célula com coordenadas = (touch.x, touch.y) e tamanho 30. Em seguida, a adicionamos como um widget do formulário AND à nossa própria matriz (para acessá-las facilmente). <br><br>  Agora você pode tocar no seu formulário e gerar células. <br><br><img src="https://habrastorage.org/webt/sf/rt/of/sfrtofg5ylwk8pxm3mowelxw1by.png"><br><br><h3>  Configurações legais </h3><br>  Como queremos obter uma boa cobra, devemos distinguir as posições gráficas e as posições reais das células. <br><br><div class="spoiler">  <b class="spoiler_title">Porque</b> <div class="spoiler_text">  Muitas razões para fazê-lo.  Toda a lógica deve ser conectada aos chamados dados reais, enquanto os dados gráficos são o resultado dos dados reais.  Por exemplo, se queremos fazer margens, a posição real da célula será (100, 100) enquanto a posição gráfica do retângulo - (102, 102). <br><br>  PS: Nós não o faríamos se lidássemos com o on_draw clássico.  Mas aqui não precisamos programar on_draw. <br></div></div><br>  Vamos corrigir o arquivo worm.kv: <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: &lt;Cell&gt;: canvas: Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br>  e main.py: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">... </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> graphical_size = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) graphical_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size, margin=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.actual_size = (size, size) self.graphical_size = (size - margin, size - margin) self.margin = margin self.actual_pos = (x, y) self.graphical_pos_attach() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.graphical_pos = (self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cell1 = Cell(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.cell2 = Cell(<span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) self.add_widget(self.cell1) self.add_widget(self.cell2) ...</code> </pre><br><img src="https://habrastorage.org/webt/sa/0m/yi/sa0myibds8nzaymucynrard6ixk.png"><br><br>  A margem apareceu e ficou bonita, embora tenhamos criado a segunda célula com X = 130 em vez de 132. Mais tarde, faremos um movimento suave com base na distância entre os valores reais e os gráficos. <br><br><h1>  Codificando o worm </h1><br><h3>  Implementação </h3><br>  Configuração inicial no main.py <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">:</span></span> DEFAULT_LENGTH = <span class="hljs-number"><span class="hljs-number">20</span></span> CELL_SIZE = <span class="hljs-number"><span class="hljs-number">25</span></span> APPLE_SIZE = <span class="hljs-number"><span class="hljs-number">35</span></span> MARGIN = <span class="hljs-number"><span class="hljs-number">4</span></span> INTERVAL = <span class="hljs-number"><span class="hljs-number">0.2</span></span> DEAD_CELL = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) APPLE_COLOR = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre><br>  (Confie em mim, você vai adorar!) <br><br>  Em seguida, atribua a configuração ao aplicativo: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = Config() self.form = Form(self.config) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form</code> </pre><br>  Reescreva init e start: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) Clock.schedule_interval(self.update, self.config.INTERVAL)</code> </pre><br>  Então, a célula: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> graphical_size = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) graphical_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size, margin=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.actual_size = (size, size) self.graphical_size = (size - margin, size - margin) self.margin = margin self.actual_pos = (x, y) self.graphical_pos_attach() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.graphical_pos = (self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) self.graphical_pos_attach() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y, **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.actual_pos <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_by(self.actual_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.actual_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">1</span></span>], **kwargs)</code> </pre><br>  Felizmente, é mais ou menos claro. <br><br>  e finalmente o verme: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cells = [] self.config = config self.cell_size = config.CELL_SIZE self.head_init((<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(config.DEFAULT_LENGTH): self.lengthen() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells)): self.remove_widget(self.cells[i]) self.cells = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lengthen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos=None, direction=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># If pos is set, we put the cell in pos, otherwise accordingly to the specified direction if pos is None: px = self.cells[-1].get_pos()[0] + direction[0] * self.cell_size py = self.cells[-1].get_pos()[1] + direction[1] * self.cell_size pos = (px, py) self.cells.append(Cell(*pos, self.cell_size, margin=self.config.MARGIN)) self.add_widget(self.cells[-1]) def head_init(self, pos): self.lengthen(pos=pos)</span></span></code> </pre><br>  Vamos dar vida ao nosso verme. <br><br><img src="https://habrastorage.org/webt/x8/89/ve/x889vemqslo2x8rxvp54jgbwgpi.png"><br><br><h3>  Movimento </h3><br>  Agora vamos fazer isso se mover. <br><br>  É simples: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): self.cells[i].move_to(*self.cells[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].get_pos()) self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].step_by(direction)</code> </pre><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) self.cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> self.worm.move(self.cur_dir)</code> </pre><br><img src="https://habrastorage.org/webt/jx/8v/jw/jx8vjwv5zpnnhfprs7peo1o_gfm.png"><br><br>  Está vivo!  Está vivo! <br><br><h3>  Controlando </h3><br>  Como você pode julgar pela imagem de visualização, os controles da cobra serão os seguintes: <br><br><img src="https://habrastorage.org/webt/va/u0/ad/vau0adepnd4fsjgcjxe0lp6jkqk.png"><br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> ws = touch.x / self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] hs = touch.y / self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] aws = <span class="hljs-number"><span class="hljs-number">1</span></span> - ws <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ws &gt; hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &gt; hs: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-comment"><span class="hljs-comment"># Down elif ws &gt; hs &gt;= aws: cur_dir = (1, 0) # Right elif ws &lt;= hs &lt; aws: cur_dir = (-1, 0) # Left else: cur_dir = (0, 1) # Up self.cur_dir = cur_dir</span></span></code> </pre><br><img src="https://habrastorage.org/webt/ff/8k/c2/ff8kc2ur1rct6cjmkt-ozc9xch4.png"><br><br>  Legal. <br><br><h3>  Criando a fruta </h3><br>  Primeiro, inicializamos. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_cell_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row = self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] // self.config.CELL_SIZE x_col = self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] // self.config.CELL_SIZE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row, x_col = self.random_cell_location(offset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y) ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.fruit = Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, self.config.APPLE_SIZE, self.config.MARGIN) self.worm = Worm(self.config) self.fruit_dislocate() self.add_widget(self.worm) self.add_widget(self.fruit) self.cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL)</code> </pre><br>  O resultado atual: <br><br><img src="https://habrastorage.org/webt/bb/t0/wh/bbt0whhowgmfdhnyjawtmnbv0ny.png"><br><br>  Agora devemos implementar alguns métodos de Worm: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-comment"><span class="hljs-comment"># Here we get all the positions of our cells def gather_positions(self): return [cell.get_pos() for cell in self.cells] # Just check if our head has the same position as another Cell def head_intersect(self, cell): return self.cells[0].get_pos() == cell.get_pos()</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Outros benefícios de gather_positions</b> <div class="spoiler_text">  A propósito, depois de implementarmos o gather_positions, podemos alterar fruit_dislocate: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x, y) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.gather_positions(): x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y)</code> </pre><br>  Nesse ponto, a fruta não estará localizada no ladrilho do verme. <br></div></div><br>  ... e adicione esta verificação para atualizar () <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> self.worm.move(self.cur_dir) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate()</code> </pre><br><h3>  Detecção de batidas de azulejos próprios </h3><br>  Queremos saber se a cabeça tem a mesma posição que uma das células do verme. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.worm.move(self.cur_dir) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm_bite_self(): self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worm_bite_self</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.cells[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(cell): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre><br><img src="https://habrastorage.org/webt/fu/yt/m4/fuytm4is8yrdbrlym0c5yj8bta8.png"><br><br><h3>  Coloração, decoração e refatoração de código </h3><br>  Vamos começar com a refatoração de código. <br><br>  Reescreva e adicione <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.fruit <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.remove_widget(self.fruit) self.fruit = Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, self.config.APPLE_SIZE) self.fruit_dislocate() self.add_widget(self.fruit) Clock.schedule_interval(self.update, self.config.INTERVAL) self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop() ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: self.worm.destroy() self.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ...</code> </pre><br>  Agora, se o worm estiver morto (congelado), se você tocar novamente, o jogo será reiniciado. <br><br>  Agora vamos decorar e colorir. <br><br>  worm.kv <br><br><pre> <code class="plaintext hljs">&lt;Form&gt;: popup_label: popup_label score_label: score_label canvas: Color: rgba: (.5, .5, .5, 1.0) Line: width: 1.5 points: (0, 0), self.size Line: width: 1.5 points: (self.size[0], 0), (0, self.size[1]) Label: id: score_label text: "Score: " + str(self.parent.worm_len) width: self.width Label: id: popup_label width: self.width &lt;Worm&gt;: &lt;Cell&gt;: canvas: Color: rgba: self.color Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br>  Reescreva o WormApp: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.config = Config() self.form = Form(self.config) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form.start()</code> </pre><br><img src="https://habrastorage.org/webt/fk/cq/6v/fkcq6vobxfathjjvs3pg3aak7oo.png"><br><br>  Vamos colorir.  Reescreva a célula em .kv: <br><br><pre> <code class="plaintext hljs">&lt;Cell&gt;: canvas: Color: rgba: self.color Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br>  Adicione isso à célula .__ init__ <br><br><pre> <code class="python hljs">self.color = (<span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) <span class="hljs-comment"><span class="hljs-comment">#</span></span></code> </pre><br>  e isso para Form.start <br><br><pre> <code class="python hljs">self.fruit.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>)</code> </pre><br>  Ótimo, aproveite sua cobra <br><br><img src="https://habrastorage.org/webt/1e/nh/6f/1enh6fainu28aqcei-9fg0of8iq.png"><br><br>  Por fim, criaremos um rótulo "game over" <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> ... self.popup_label.text = <span class="hljs-string"><span class="hljs-string">""</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.popup_label.text = text Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop(<span class="hljs-string"><span class="hljs-string">"GAME OVER"</span></span> + <span class="hljs-string"><span class="hljs-string">" "</span></span> * <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-string"><span class="hljs-string">"\ntap to reset"</span></span>)</code> </pre><br>  e torne a célula atingida vermelha: <br><br>  em vez de <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm_bite_self(): self.game_over() ...</code> </pre><br>  escrever <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cell = self.worm_bite_self() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell: cell.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) self.game_over()</code> </pre><br><img src="https://habrastorage.org/webt/lw/mr/na/lwmrnagdbvjt79qacs0kt9jg_2k.png"><br><br>  Você ainda está prestando atenção?  O próximo passo é a parte mais interessante. <br><br><h3>  Seção de bônus - movimento suave </h3><br>  Como o passo do worm é igual ao tamanho da célula, não é tão suave.  Mas queremos dar o passo o mais rápido possível, sem reescrever toda a lógica do jogo.  Portanto, precisamos criar um mecanismo que mova nossas poses gráficas, mas não nossas poses reais.  Então, eu escrevi um arquivo simples: <br><br>  smooth.py <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timing</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">linear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Smooth</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, interval=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">/</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">60.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.objs = [] self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.interval = interval <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> Clock.schedule_interval(self.update, self.interval) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr, value)</span></span></span><span class="hljs-function">:</span></span> exec(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr + <span class="hljs-string"><span class="hljs-string">" = "</span></span> + str(value)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(eval(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cur_time = time.time() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.objs: obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line time_gone = cur_time - start_time <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> time_gone &gt;= period: self.setattr(obj, prop_name_x, to_x) self.setattr(obj, prop_name_y, to_y) self.objs.remove(line) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: share = time_gone / period acs = timing(share) self.setattr(obj, prop_name_x, from_x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_x * acs) self.setattr(obj, prop_name_y, from_y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_y * acs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.objs) == <span class="hljs-number"><span class="hljs-number">0</span></span>: self.stop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear)</span></span></span><span class="hljs-function">:</span></span> self.objs.append((obj, prop_name_x, prop_name_y, self.getattr(obj, prop_name_x), self.getattr(obj, prop_name_y), to_x, to_y, time.time(), t, timing)) self.run() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSmooth</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Smooth)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, props, timing=Timing.linear, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(*args, **kwargs) self.props = props self.timing = timing <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, to_x, to_y, t)</span></span></span><span class="hljs-function">:</span></span> super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Para quem não gosta do meu código</b> <div class="spoiler_text">  Este módulo não é a solução mais elegante ©.  É uma solução ruim e eu reconheço.  É uma solução de apenas olá mundo. <br></div></div><br>  Então você apenas cria smooth.py e copia e cola esse código no arquivo. <br>  Finalmente, vamos fazê-lo funcionar: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> ... self.smooth = smooth.XSmooth([<span class="hljs-string"><span class="hljs-string">"graphical_pos[0]"</span></span>, <span class="hljs-string"><span class="hljs-string">"graphical_pos[1]"</span></span>])</code> </pre><br>  Em seguida, substituímos self.worm.move () por <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> ... self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL))</code> </pre><br>  E é assim que os métodos do Cell devem se parecer <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, smooth_motion=None)</span></span></span><span class="hljs-function">:</span></span> to_x, to_y = self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smooth_motion <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.graphical_pos = to_x, to_y <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: smoother, t = smooth_motion smoother.move_to(self, to_x, to_y, t) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) self.graphical_pos_attach(**kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y, **kwargs)</code> </pre><br>  É isso aí, obrigado pela atenção! <br><br>  Como o resultado final funciona: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/0clOAucqRDE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><div class="spoiler">  <b class="spoiler_title">O código final</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">main.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> smooth <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> graphical_size = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) graphical_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) color = ListProperty([<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, size, margin=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">4</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.actual_size = (size, size) self.graphical_size = (size - margin, size - margin) self.margin = margin self.actual_pos = (x, y) self.graphical_pos_attach() self.color = (<span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">graphical_pos_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, smooth_motion=None)</span></span></span><span class="hljs-function">:</span></span> to_x, to_y = self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] - self.graphical_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smooth_motion <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.graphical_pos = to_x, to_y <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: smoother, t = smooth_motion smoother.move_to(self, to_x, to_y, t) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) self.graphical_pos_attach(**kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y, **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.actual_pos <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> self.move_by(self.actual_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.actual_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] * direction[<span class="hljs-number"><span class="hljs-number">1</span></span>], **kwargs) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.cells = [] self.config = config self.cell_size = config.CELL_SIZE self.head_init((<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(config.DEFAULT_LENGTH): self.lengthen() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells)): self.remove_widget(self.cells[i]) self.cells = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lengthen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos=None, direction=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pos <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: px = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">0</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">0</span></span>] * self.cell_size py = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">1</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">1</span></span>] * self.cell_size pos = (px, py) self.cells.append(Cell(*pos, self.cell_size, margin=self.config.MARGIN)) self.add_widget(self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> self.lengthen(pos=pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): self.cells[i].move_to(*self.cells[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].get_pos(), **kwargs) self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].step_by(direction, **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gather_positions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [cell.get_pos() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.cells] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_intersect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, cell)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos() == cell.get_pos() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> worm_len = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.smooth = smooth.XSmooth([<span class="hljs-string"><span class="hljs-string">"graphical_pos[0]"</span></span>, <span class="hljs-string"><span class="hljs-string">"graphical_pos[1]"</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_cell_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row = self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] // self.config.CELL_SIZE x_col = self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] // self.config.CELL_SIZE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row, x_col = self.random_cell_location(offset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x, y) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.gather_positions(): x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.fruit <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.remove_widget(self.fruit) self.fruit = Cell(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, self.config.APPLE_SIZE) self.fruit.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) self.fruit_dislocate() self.add_widget(self.fruit) self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL) self.popup_label.text = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.popup_label.text = text Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop(<span class="hljs-string"><span class="hljs-string">"GAME OVER"</span></span> + <span class="hljs-string"><span class="hljs-string">" "</span></span> * <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-string"><span class="hljs-string">"\ntap to reset"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align_labels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: self.popup_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.popup_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) self.score_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.score_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] - <span class="hljs-number"><span class="hljs-number">80</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(self.__dict__) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate() cell = self.worm_bite_self() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell: cell.color = (<span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>) self.game_over() self.worm_len = len(self.worm.cells) self.align_labels() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: self.worm.destroy() self.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ws = touch.x / self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] hs = touch.y / self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] aws = <span class="hljs-number"><span class="hljs-number">1</span></span> - ws <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ws &gt; hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &gt; hs: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &gt; hs &gt;= aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &lt;= hs &lt; aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) self.cur_dir = cur_dir <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worm_bite_self</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.cells[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(cell): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">:</span></span> DEFAULT_LENGTH = <span class="hljs-number"><span class="hljs-number">20</span></span> CELL_SIZE = <span class="hljs-number"><span class="hljs-number">25</span></span> APPLE_SIZE = <span class="hljs-number"><span class="hljs-number">35</span></span> MARGIN = <span class="hljs-number"><span class="hljs-number">4</span></span> INTERVAL = <span class="hljs-number"><span class="hljs-number">0.3</span></span> DEAD_CELL = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) APPLE_COLOR = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WormApp</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.config = Config() self.form = Form(self.config) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.form <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.form.start() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: WormApp().run()</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">smooth.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timing</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">linear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Smooth</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, interval=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">/</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">60.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.objs = [] self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.interval = interval <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> Clock.schedule_interval(self.update, self.interval) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr, value)</span></span></span><span class="hljs-function">:</span></span> exec(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr + <span class="hljs-string"><span class="hljs-string">" = "</span></span> + str(value)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getattr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(eval(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cur_time = time.time() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.objs: obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line time_gone = cur_time - start_time <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> time_gone &gt;= period: self.setattr(obj, prop_name_x, to_x) self.setattr(obj, prop_name_y, to_y) self.objs.remove(line) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: share = time_gone / period acs = timing(share) self.setattr(obj, prop_name_x, from_x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_x * acs) self.setattr(obj, prop_name_y, from_y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_y * acs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.objs) == <span class="hljs-number"><span class="hljs-number">0</span></span>: self.stop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear)</span></span></span><span class="hljs-function">:</span></span> self.objs.append((obj, prop_name_x, prop_name_y, self.getattr(obj, prop_name_x), self.getattr(obj, prop_name_y), to_x, to_y, time.time(), t, timing)) self.run() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSmooth</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Smooth)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, props, timing=Timing.linear, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(*args, **kwargs) self.props = props self.timing = timing <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, to_x, to_y, t)</span></span></span><span class="hljs-function">:</span></span> super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">worm.kv</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;Form&gt;: popup_label: popup_label score_label: score_label canvas: Color: rgba: (.5, .5, .5, 1.0) Line: width: 1.5 points: (0, 0), self.size Line: width: 1.5 points: (self.size[0], 0), (0, self.size[1]) Label: id: score_label text: "Score: " + str(self.parent.worm_len) width: self.width Label: id: popup_label width: self.width &lt;Worm&gt;: &lt;Cell&gt;: canvas: Color: rgba: self.color Rectangle: size: self.graphical_size pos: self.graphical_pos</code> </pre><br></div></div><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Código, ajustado por @tshirtman</b> <div class="spoiler_text">  Recebi alguns problemas com meu código, por exemplo, tshirtman, um dos colaboradores do projeto Kivy, sugeriu que eu não fizesse Células como Widgets, mas, sim, fiz uma instrução Point.  No entanto, não acho esse código mais fácil de entender do que o meu, embora seja definitivamente melhor em termos de interface do usuário e desenvolvimento de jogos.  Enfim, o código: <br><div class="spoiler">  <b class="spoiler_title">main.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.uix.widget <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Widget <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.properties <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> smooth <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cell</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.actual_pos = (x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_by</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> self.move_to(self.actual_pos[<span class="hljs-number"><span class="hljs-number">0</span></span>] + x, self.actual_pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] + y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.actual_pos <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fruit</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Cell)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> super().__init__(x, y) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Worm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> margin = NumericProperty(<span class="hljs-number"><span class="hljs-number">4</span></span>) graphical_poses = ListProperty() inj_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">-1000</span></span>, <span class="hljs-number"><span class="hljs-number">-1000</span></span>]) graphical_size = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(**kwargs) self.cells = [] self.config = config self.cell_size = config.CELL_SIZE self.head_init((self.config.CELL_SIZE * random.randint(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), self.config.CELL_SIZE * random.randint(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>))) self.margin = config.MARGIN self.graphical_size = self.cell_size - self.margin <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(config.DEFAULT_LENGTH): self.lengthen() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.cells = [] self.graphical_poses = [] self.inj_pos = [<span class="hljs-number"><span class="hljs-number">-1000</span></span>, <span class="hljs-number"><span class="hljs-number">-1000</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cell_append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> self.cells.append(Cell(*pos)) self.graphical_poses.extend([<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]) self.cell_move_to(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lengthen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos=None, direction=</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pos <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: px = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">0</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">0</span></span>] * self.cell_size py = self.cells[<span class="hljs-number"><span class="hljs-number">-1</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">1</span></span>] + direction[<span class="hljs-number"><span class="hljs-number">1</span></span>] * self.cell_size pos = (px, py) self.cell_append(pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pos)</span></span></span><span class="hljs-function">:</span></span> self.lengthen(pos=pos) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cell_move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, i, pos, smooth_motion=None)</span></span></span><span class="hljs-function">:</span></span> self.cells[i].move_to(*pos) to_x, to_y = pos[<span class="hljs-number"><span class="hljs-number">0</span></span>], pos[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smooth_motion <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.graphical_poses[i * <span class="hljs-number"><span class="hljs-number">2</span></span>], self.graphical_poses[i * <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>] = to_x, to_y <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: smoother, t = smooth_motion smoother.move_to(self, <span class="hljs-string"><span class="hljs-string">"graphical_poses["</span></span> + str(i * <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-string"><span class="hljs-string">"]"</span></span>, <span class="hljs-string"><span class="hljs-string">"graphical_poses["</span></span> + str(i * <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-string"><span class="hljs-string">"]"</span></span>, to_x, to_y, t) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, direction, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.cells) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>): self.cell_move_to(i, self.cells[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].get_pos(), **kwargs) self.cell_move_to(<span class="hljs-number"><span class="hljs-number">0</span></span>, (self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">0</span></span>] + self.cell_size * direction[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos()[<span class="hljs-number"><span class="hljs-number">1</span></span>] + self.cell_size * direction[<span class="hljs-number"><span class="hljs-number">1</span></span>]), **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gather_positions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [cell.get_pos() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.cells] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">head_intersect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, cell)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.cells[<span class="hljs-number"><span class="hljs-number">0</span></span>].get_pos() == cell.get_pos() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Widget)</span></span></span><span class="hljs-class">:</span></span> worm_len = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) fruit_pos = ListProperty([<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>]) fruit_size = NumericProperty(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, config, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(**kwargs) self.config = config self.worm = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.smooth = smooth.Smooth() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_cell_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row = self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] // self.config.CELL_SIZE x_col = self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] // self.config.CELL_SIZE <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random.randint(offset, x_row - offset), random.randint(offset, x_col - offset) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random_location</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, offset)</span></span></span><span class="hljs-function">:</span></span> x_row, x_col = self.random_cell_location(offset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.config.CELL_SIZE * x_row, self.config.CELL_SIZE * x_col <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fruit_dislocate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, xy=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> xy <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: x, y = xy <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x, y) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.gather_positions(): x, y = self.random_location(<span class="hljs-number"><span class="hljs-number">2</span></span>) self.fruit.move_to(x, y) self.fruit_pos = (x, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.worm = Worm(self.config) self.add_widget(self.worm) self.fruit = Fruit(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) self.fruit_size = self.config.APPLE_SIZE self.fruit_dislocate() self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) Clock.schedule_interval(self.update, self.config.INTERVAL) self.popup_label.text = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, text=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.game_on = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.popup_label.text = text Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game_over</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stop(<span class="hljs-string"><span class="hljs-string">"GAME OVER"</span></span> + <span class="hljs-string"><span class="hljs-string">" "</span></span> * <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-string"><span class="hljs-string">"\ntap to reset"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">align_labels</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.popup_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.popup_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] / <span class="hljs-number"><span class="hljs-number">2</span></span>) self.score_label.pos = ((self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] - self.score_label.width) / <span class="hljs-number"><span class="hljs-number">2</span></span>, self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] - <span class="hljs-number"><span class="hljs-number">80</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.worm.move(self.cur_dir, smooth_motion=(self.smooth, self.config.INTERVAL)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(self.fruit): directions = [(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)] self.worm.lengthen(direction=random.choice(directions)) self.fruit_dislocate() cell = self.worm_bite_self() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.worm.inj_pos = cell.get_pos() self.game_over() self.worm_len = len(self.worm.cells) self.align_labels() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, touch)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.game_on: self.worm.destroy() self.start() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ws = touch.x / self.size[<span class="hljs-number"><span class="hljs-number">0</span></span>] hs = touch.y / self.size[<span class="hljs-number"><span class="hljs-number">1</span></span>] aws = <span class="hljs-number"><span class="hljs-number">1</span></span> - ws <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ws &gt; hs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> aws &gt; hs: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &gt; hs &gt;= aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> ws &lt;= hs &lt; aws: cur_dir = (<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: cur_dir = (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) self.cur_dir = cur_dir <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worm_bite_self</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.worm.cells[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.worm.head_intersect(cell): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">:</span></span> DEFAULT_LENGTH = <span class="hljs-number"><span class="hljs-number">20</span></span> CELL_SIZE = <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-comment"><span class="hljs-comment"># DO NOT FORGET THAT CELL_SIZE - MARGIN WILL BE DIVIDED BY 4 APPLE_SIZE = 36 MARGIN = 2 INTERVAL = 0.3 DEAD_CELL = (1, 0, 0, 1) APPLE_COLOR = (1, 1, 0, 1) class WormApp(App): def __init__(self, **kwargs): super().__init__(**kwargs) self.form = None def build(self, **kwargs): self.config = Config() self.form = Form(self.config, **kwargs) return self.form def on_start(self): self.form.start() if __name__ == '__main__': WormApp().run()</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">smooth.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> kivy.clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Clock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timing</span></span></span><span class="hljs-class">:</span></span> @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">linear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Smooth</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, interval=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">/</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">60.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.objs = [] self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.interval = interval <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> Clock.schedule_interval(self.update, self.interval) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.running: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> Clock.unschedule(self.update) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr, value)</span></span></span><span class="hljs-function">:</span></span> exec(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr + <span class="hljs-string"><span class="hljs-string">" = "</span></span> + str(value)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_attr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, attr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> float(eval(<span class="hljs-string"><span class="hljs-string">"obj."</span></span> + attr)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, _)</span></span></span><span class="hljs-function">:</span></span> cur_time = time.time() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.objs: obj, prop_name_x, prop_name_y, from_x, from_y, to_x, to_y, start_time, period, timing = line time_gone = cur_time - start_time <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> time_gone &gt;= period: self.set_attr(obj, prop_name_x, to_x) self.set_attr(obj, prop_name_y, to_y) self.objs.remove(line) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: share = time_gone / period acs = timing(share) self.set_attr(obj, prop_name_x, from_x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_x * acs) self.set_attr(obj, prop_name_y, from_y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - acs) + to_y * acs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.objs) == <span class="hljs-number"><span class="hljs-number">0</span></span>: self.stop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, prop_name_x, prop_name_y, to_x, to_y, t, timing=Timing.linear)</span></span></span><span class="hljs-function">:</span></span> self.objs.append((obj, prop_name_x, prop_name_y, self.get_attr(obj, prop_name_x), self.get_attr(obj, prop_name_y), to_x, to_y, time.time(), t, timing)) self.run() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSmooth</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Smooth)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, props, timing=Timing.linear, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(*args, **kwargs) self.props = props self.timing = timing <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_to</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, obj, to_x, to_y, t)</span></span></span><span class="hljs-function">:</span></span> super().move_to(obj, *self.props, to_x, to_y, t, timing=self.timing)</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">worm.kv</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;Form&gt;: popup_label: popup_label score_label: score_label canvas: Color: rgba: (.5, .5, .5, 1.0) Line: width: 1.5 points: (0, 0), self.size Line: width: 1.5 points: (self.size[0], 0), (0, self.size[1]) Color: rgba: (1.0, 0.2, 0.2, 1.0) Point: points: self.fruit_pos pointsize: self.fruit_size / 2 Label: id: score_label text: "Score: " + str(self.parent.worm_len) width: self.width Label: id: popup_label width: self.width &lt;Worm&gt;: canvas: Color: rgba: (0.2, 1.0, 0.2, 1.0) Point: points: self.graphical_poses pointsize: self.graphical_size / 2 Color: rgba: (1.0, 0.2, 0.2, 1.0) Point: points: self.inj_pos pointsize: self.graphical_size / 2</code> </pre><br></div></div></div></div><br>  Sinta-se livre para fazer qualquer pergunta. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt465523/">https://habr.com/ru/post/pt465523/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt465513/index.html">Um registro no olho: quais vulnerabilidades os sistemas de CFTV têm</a></li>
<li><a href="../pt465515/index.html">Treinamento Cisco 200-125 CCNA v3.0. Dia 27. Introdução à ACL. Parte 1</a></li>
<li><a href="../pt465517/index.html">Jogo de tabuleiro de papel DoodleBattle</a></li>
<li><a href="../pt465519/index.html">Exposição PRO // Movement.Expo</a></li>
<li><a href="../pt465521/index.html">Fly-fly-pétala ... ou uma história sobre como o designer de UX promoveu seu produto no Instagram</a></li>
<li><a href="../pt465525/index.html">Relatórios móveis no Oracle BI EE 12c - um, dois, três. Metodologia do Curso de Oracle BI EE 12c CAD</a></li>
<li><a href="../pt465527/index.html">A longa jornada do RFC 4357 ao RFC 8645 ou como gerenciar chaves de criptografia</a></li>
<li><a href="../pt465529/index.html">Suspensão sobre bloqueio</a></li>
<li><a href="../pt465531/index.html">Descompactando listas aninhadas de profundidade indefinida</a></li>
<li><a href="../pt465535/index.html">Quem implementa o IPv6 e o ​​que dificulta o seu desenvolvimento</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>