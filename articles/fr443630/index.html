<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíï ü•â üëãüèª Comment impl√©menter un langage de programmation en JavaScript. Partie 1: analyseur ‚èØÔ∏è üë®üèΩ‚Äçüîß üî≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour Je vous pr√©sente une traduction amateur d'un guide pour impl√©menter votre langage de programmation JavaScript - PL Tutorial . 
 Du traducteur ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment impl√©menter un langage de programmation en JavaScript. Partie 1: analyseur</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443630/"><p>  Bonjour  Je vous pr√©sente une traduction amateur d'un guide pour impl√©menter votre langage de programmation JavaScript - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PL Tutorial</a> . </p><br><h1 id="ot-perevodchika">  Du traducteur </h1><br><p>  Nous allons cr√©er notre propre langage de programmation - langage <strong>Œª</strong> (dans l'original - Œªanguage).  Dans le processus de cr√©ation, nous utiliserons de nombreuses techniques int√©ressantes, telles que la descente r√©cursive, le style de transfert de contr√¥le et les techniques d'optimisation de base.  Deux versions de l'interpr√©teur seront cr√©√©es - les interpr√®tes standard et CPS, le trans-compilateur en JavaScript. </p><br><p>  L'auteur de l'original est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mihai Bazon</a> , l'auteur de la c√©l√®bre biblioth√®que UglifyJS (un outil pour minimiser et formater le code JS). </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Table des mati√®res</b> <div class="spoiler_text"><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment impl√©menter un langage de programmation en JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1: analyseur</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment impl√©menter un langage de programmation en JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2: interpr√®te</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment impl√©menter un langage de programmation en JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3: interpr√®te CPS</a> </li><li>  Comment impl√©menter un langage de programmation en JavaScript.  Partie 4: Trans Compilation dans JS </li></ol></div></div><br><h1 id="vstuplenie">  Entr√©e </h1><br><p> Si vous avez d√©j√† √©crit votre compilateur ou interpr√®te, il n'y aura rien de nouveau pour vous.  Mais si vous utilisez des expressions r√©guli√®res pour <a href="">analyser</a> quelque chose qui ressemble √† un langage de programmation, lisez la section sur l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">analyse</a> .  √âcrivons du code avec moins de bugs! </p><br><p>  L'article est divis√© en parties dans l'ordre ¬´du simple au complexe¬ª.  Je ne vous recommande pas d'ignorer certaines parties de l'article, √† moins que vous ne compreniez bien le sujet.  Vous pouvez toujours revenir en arri√®re si vous ne comprenez pas quelque chose. </p><br><p>  Qu'allons-nous apprendre: </p><br><ul><li>  Qu'est-ce qu'un analyseur et comment l'√©crire. </li><li>  Comment √©crire un interpr√®te. </li><li>  La suite du transfert et pourquoi c'est important. </li><li>  √âcriture d'un compilateur (trans). </li><li>  Style de transfert de continuation. </li><li>  Quelques techniques de base d'optimisation de code. </li><li>  Exemples de nouveaut√©s dans notre langage Œª par rapport √† JavaScript. </li></ul><br><p>  Parall√®lement √† cela, je montrerai pourquoi Lisp est un excellent langage de programmation.  <strong>Cependant, la langue sur laquelle nous travaillons n'est pas le lisp.</strong>  Il a une syntaxe plus riche (une notation infixe classique que tout le monde conna√Æt), quelque chose comme Scheme (sauf les macros).  Bon ou pas, mais les macros sont la principale caract√©ristique de Lisp - quelque chose que les autres langues (√† l'exception des dialectes Lisp) ne peuvent pas faire aussi bien que lui.  (Oui, je connais SweetJS ... proche, mais pas √ßa.) </p><br><p>  Mais d'abord, introduisons notre langage de programmation. </p><br><a name="Language"></a><br><h1 id="zyk">  langue Œª </h1><br><p>  Avant de faire quoi que ce soit, nous devons avoir une image claire de ce que nous voulons faire.  Ce serait bien d'√©crire une description de la grammaire du langage, mais je vais vous faciliter la t√¢che - √©crivez un exemple de programme simple, alors voici quelques exemples du langage Œª: </p><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   println("Hello World!"); println(2 + 3 * 4); #       `lambda`  `Œª` fib = lambda (n) if n &lt; 2 then n else fib(n - 1) + fib(n - 2); println(fib(15)); print-range = Œª(a, b) # `Œª`     ,   `lambda` if a &lt;= b then { # `then`  ,      print(a); if a + 1 &lt;= b { print(", "); print-range(a + 1, b); } else println(""); #   }; print-range(1, 5);</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Remarque sur les noms de variables</b> <div class="spoiler_text"><p>  Notez que les identifiants peuvent contenir un signe moins ( <code>print-range</code> ).  C'est une question de go√ªt.  Je mets toujours des espaces autour des op√©rateurs.  Je n'aime pas vraiment le camelRegister et le tiret mieux que l'espace invisible ("_").  Comme vous pouvez faire ce que vous voulez quand vous faites quelque chose vous-m√™me. </p></div></div><br><p>  Conclusion: </p><br><pre> <code class="plaintext hljs">Hello World! 14 610 1, 2, 3, 4, 5</code> </pre> <br><p>  Le langage ressemble √† JavaScript, mais dans l'ensemble il ne l'est pas.  Premi√®rement, il n'y a pas de d√©clarations, seulement des expressions.  Une expression doit renvoyer une valeur et peut √™tre utilis√©e n'importe o√π dans une autre expression.  Les points-virgules sont n√©cessaires pour s√©parer les expressions dans une "s√©quence" d'expressions.  Les accolades <code>{</code> et <code>}</code> cr√©ent une s√©quence qui est elle-m√™me une expression, et sa valeur est la derni√®re valeur de la s√©quence.  Le programme suivant est correct: </p><br><pre> <code class="python hljs">a = { fib(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">#    ,      fib(15) #        }; print(a); #  610</span></span></code> </pre> <br><p>  Les fonctions sont cr√©√©es √† l'aide des mots cl√©s <code>lambda</code> ou <code>Œª</code> .  Apr√®s cela, entre parenth√®ses se trouve une liste (√©ventuellement vide) de noms d'arguments, s√©par√©s par des virgules.  Le corps d'une fonction est une expression, mais peut √™tre enferm√© dans une s√©quence <code>{...}</code> .  Il convient √©galement de noter qu'il n'y a pas de mot-cl√© <code>return</code> .  La fonction renvoie la valeur de la derni√®re expression. </p><br><p>  En outre, aucune <code>var</code> .  Pour ajouter une variable, vous pouvez utiliser ce que les programmeurs JavaScript appellent <code>IIFE</code> .  Utilisez <code>lambda</code> , d√©clarez les variables comme arguments.  Pour les variables, la port√©e est une fonction et les fonctions sont des fermetures, comme en JavaScript [env.  traduction: jusqu'√† ES6.]. </p><br><p>  M√™me <code>if</code> c'est une expression.  JavaScript utilise l'op√©rateur ternaire pour ce faire: </p><br><pre> <code class="python hljs">a = foo() ? bar() : baz(); // JavaScript a = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> foo() then bar() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> baz(); <span class="hljs-comment"><span class="hljs-comment"># Œª</span></span></code> </pre> <br><p>  Le mot cl√© <code>then</code> est facultatif si la branche est une s√©quence ( <code>{...}</code> ), comme vous pouvez le voir ci-dessus.  Dans un autre cas, c'est n√©cessaire.  <code>else</code> utilis√© si une branche alternative est pr√©sente.  Et encore une fois, <code>then</code> et <code>else</code> prenez l'expression comme corps, mais vous pouvez combiner plusieurs expressions en une seule en utilisant <code>{...}</code> .  Si <code>else</code> absent et que la condition est <code>false</code> , alors le r√©sultat de tout <code>if</code> est <code>false</code> .  Il convient de noter que <code>false</code> est un mot-cl√© repr√©sentant une valeur qui est la seule fausse valeur dans un langage Œª: </p><br><pre> <code class="plaintext hljs">if foo() then print("OK");</code> </pre> <br><p>  affichera <code>OK</code> si et seulement si le r√©sultat de <code>foo()</code> <strong>pas</strong> <code>false</code> .  De plus, il y a le mot-cl√© <code>true</code> , mais absolument tout ce qui n'est pas <code>false</code> (en JavaScript, l'op√©rateur <code>===</code> ) sera consid√©r√© comme <code>true</code> dans les branches (y compris le nombre <code>0</code> et la cha√Æne vide <code>""</code> ). </p><br><p>  Notez qu'il n'y a pas besoin de parenth√®ses autour de l'expression dans <code>if</code> .  Si vous les ajoutez, ce ne sera pas une erreur, car <code>(</code> l'expression commence, mais elles sont juste superflues. </p><br><p>  L'ensemble du programme peut √™tre analys√© m√™me s'il est entour√© de parenth√®ses, vous devez donc ajouter <code>;</code>  apr√®s chaque expression.  La derni√®re expression est une exception. </p><br><p>  G√©nial, c'est notre petit langage Œª.  Il n'est pas parfait.  La syntaxe est magnifique, mais elle a des d√©fauts.  Il existe de nombreuses fonctionnalit√©s manquantes, telles que des objets et des tableaux.  Nous n'y pr√™tons pas attention, car ils ne sont pas basiques pour notre langage de programmation. </p><br><p>  Ensuite, nous allons √©crire un analyseur pour notre langue. </p><br><a name="Parsing"></a><br><h1 id="prevraschenie-koda-v-ast">  Conversion de code en AST </h1><br><p>  La cr√©ation d'un analyseur est une t√¢che difficile.  En substance, il devrait prendre un morceau de code et le transformer en AST (arbre de syntaxe abstraite).  AST est une repr√©sentation structur√©e d'un programme en m√©moire, abstraite car elle ne contient pas d'informations compl√®tes sur le code, seulement la s√©mantique.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Description AST</a> est dans une pi√®ce s√©par√©e. </p><br><p>  Par exemple, nous avons le code suivant: </p><br><pre> <code class="python hljs">sum = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>(a, b) { a + b; }; print(sum(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>));</code> </pre> <br><p>  Notre analyseur va g√©n√©rer un arbre en tant qu'objet JavaScript: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">//  : { type: "assign", operator: "=", left: { type: "var", value: "sum" }, right: { type: "lambda", vars: [ "a", "b" ], body: { //     "prog",  ,  //     ,  //     . type: "binary", operator: "+", left: { type: "var", value: "a" }, right: { type: "var", value: "b" } } } }, //  : { type: "call", func: { type: "var", value: "print" }, args: [{ type: "call", func: { type: "var", value: "sum" }, args: [ { type: "num", value: 1 }, { type: "num", value: 2 } ] }] } ] }</span></span></code> </pre> <br><p>  La principale difficult√© de cr√©ation d'un analyseur est la difficult√© √† bien organiser le code.  L'analyseur doit fonctionner √† un niveau sup√©rieur √† la lecture de caract√®res dans une cha√Æne.  Quelques conseils pour r√©duire la complexit√© du code: </p><br><ul><li>  √âcrivez beaucoup de petites fonctionnalit√©s.  Dans chaque fonction, faites une chose et faites-la bien. </li><li>  N'essayez pas d'utiliser des expressions r√©guli√®res pour l'analyse.  Ils ne fonctionnent tout simplement pas.  Ils peuvent √™tre utiles dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">analyseur lexical</a> , mais, pour simplifier, nous ne les utiliserons pas. </li><li>  N'essayez pas de deviner.  Lorsque vous ne savez pas comment analyser quelque chose, lancez une exception contenant l'emplacement de l'erreur (ligne et colonne). </li></ul><br><p>  Pour garder le code plus simple, nous allons le diviser en trois parties, qui √† leur tour sont divis√©es en de nombreuses petites fonctions: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Flux de caract√®res</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Flux de jetons (jetons)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Analyseur</a> </li></ul><br><a name="InputStream"></a><br><h1 id="potok-simvolov">  Flux de caract√®res </h1><br><p>  C'est la partie la plus simple.  Nous allons cr√©er un objet stream qui repr√©sentera les op√©rations de lecture s√©quentielle des caract√®res d'une cha√Æne.  Il contient quatre fonctions: </p><br><ul><li>  <code>peek()</code> - renvoie le caract√®re suivant sans l'extraire du flux. </li><li>  <code>next()</code> - renvoie le caract√®re suivant, en l'extrayant du flux. </li><li>  <code>eof()</code> - retourne <code>true</code> s'il n'y a plus de caract√®res dans le flux. </li><li>  <code>croak(msg)</code> - l√®ve une exception contenant le message ( <code>msg</code> ) et la position actuelle dans le flux. </li></ul><br><p>  La derni√®re fonction est n√©cessaire pour que vous puissiez simplement lever une exception contenant l'emplacement de l'erreur. </p><br><p>  Voici le code complet de cet objet (appelons-le <code>InputStream</code> ).  Il est assez petit pour ne pas avoir de probl√®mes avec: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pos = <span class="hljs-number"><span class="hljs-number">0</span></span>, line = <span class="hljs-number"><span class="hljs-number">1</span></span>, col = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">next</span></span> : next, <span class="hljs-attr"><span class="hljs-attr">peek</span></span> : peek, <span class="hljs-attr"><span class="hljs-attr">eof</span></span> : eof, <span class="hljs-attr"><span class="hljs-attr">croak</span></span> : croak, }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.charAt(pos++); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) line++, col = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> col++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ch; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">peek</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> input.charAt(pos); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eof</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> peek() == <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">croak</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">msg</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(msg + <span class="hljs-string"><span class="hljs-string">" ("</span></span> + line + <span class="hljs-string"><span class="hljs-string">":"</span></span> + col + <span class="hljs-string"><span class="hljs-string">")"</span></span>); } }</code> </pre> <br><p>  Veuillez noter que ce n'est pas un objet ordinaire (qui est cr√©√© via <code>new</code> ).  Pour obtenir cet objet, vous avez besoin de: <code>var stream = InputStream(string)</code> . </p><br><p>  Ensuite, nous √©crirons le niveau d'abstraction suivant: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Flux de jetons (jetons)</a> . </p><br><a name="TokenStream"></a><br><h1 id="potok-tokenov-leksem">  Flux de jetons (jetons) </h1><br><p>  Le tokenizer (lexer) utilise un flux de caract√®res et renvoie un objet avec la m√™me interface, mais les valeurs de retour des fonctions <code>peek()</code> / <code>next()</code> seront des jetons.  Un jeton est un type avec deux propri√©t√©s: <code>type</code> , <code>value</code> .  Voici quelques exemples de jetons: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"punc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">"("</span></span> } <span class="hljs-comment"><span class="hljs-comment">// . : , ,     . . { type: "num", value: 5 } //  { type: "str", value: "Hello World!" } //  { type: "kw", value: "lambda" } //   { type: "var", value: "a" } //  { type: "op", value: "!=" } // </span></span></code> </pre> <br><p>  Les espaces (espace, tabulation, sauts de ligne) et les commentaires sont simplement ignor√©s. </p><br><p>  Pour √©crire un tokenizer, nous devons regarder de plus pr√®s notre langue.  L'id√©e est de remarquer qu'en fonction du caract√®re courant ( <code>input.peek()</code> ) nous pouvons d√©cider quel jeton lire: </p><br><ul><li>  Tout d'abord, ignorez les espaces. </li><li>  Si <code>input.eof()</code> , retourne <code>null</code> . </li><li>  S'il s'agit d'un caract√®re <code>#</code> , sautez tous les caract√®res √† la fin de la ligne (et retournez le jeton suivant). </li><li>  S'il s'agit d'un guillemet, lisez la cha√Æne. </li><li>  S'il s'agit d'un nombre, lisez-le. </li><li>  S'il s'agit d'une lettre, nous lisons le mot et retournons l'identifiant ou le mot-cl√©. </li><li>  S'il s'agit de l'un des caract√®res sp√©ciaux, renvoyez le jeton correspondant. </li><li>  Si c'est l'un des symboles des op√©rateurs, alors nous retournons le jeton correspondant. </li><li>  Si rien de ce qui pr√©c√®de ne s'applique, lancez une exception √† l'aide de <code>input.croak()</code> . </li></ul><br><p>  Nous aurons la fonction <code>read_next</code> , la fonction principale du tokenizer: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ read_while(is_whitespace); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (input.eof()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"#"</span></span>) { skip_comment(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_next(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">'"'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_string(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_digit(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_number(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_id_start(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_ident(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"punc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : input.next() }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_op_char(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"op"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : read_while(is_op_char) }; input.croak(<span class="hljs-string"><span class="hljs-string">"Can't handle character: "</span></span> + ch); }</code> </pre> <br><p>  Ici, vous pouvez voir de nombreuses fonctions suppl√©mentaires qui renvoient diff√©rents types de jetons, tels que <code>read_string()</code> , <code>read_number()</code> , etc ... Ils sont plac√©s dans des fonctions distinctes, de sorte que le code semble plus simple et plus beau. </p><br><p>  De plus, il est int√©ressant de ne pas retirer tous les symboles √† la fois: chaque fois que l'analyseur demande le prochain jeton, nous lirons un jeton.  Si une erreur se produit, nous ne lirons m√™me pas tous les caract√®res. </p><br><p>  <code>read_ident()</code> lira tous les caract√®res d'une ligne pouvant faire partie de l'identifiant ( <code>is_id()</code> ).  L'identifiant doit commencer par la lettre, <code>Œª</code> ou <code>_</code> , et peut contenir les m√™mes caract√®res, chiffres ou n'importe lequel des √©l√©ments suivants: <code>?!-&lt;&gt;=</code> .  Il s'ensuit que <code>foo-bar</code> ne sera pas lu comme trois jetons, mais comme un ( <code>var</code> ).  Est-ce n√©cessaire pour pouvoir d√©finir des fonctions avec des noms tels que <code>is-pair?</code>  ou <code>string&gt;=</code> (d√©sol√©, c'est Lisper en moi). </p><br><p>  De plus, <code>read_ident()</code> v√©rifiera s'il y a un identifiant dans la liste des mots cl√©s connus, et s'il y est, un <code>kw</code> -token sera retourn√© au lieu d'un <code>var</code> -token. </p><br><p>  Je pense que le code parle de lui-m√™me, alors voici un tokenizer pr√™t √† l'emploi pour notre langue: </p><br><div class="spoiler">  <b class="spoiler_title">Code entier</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TokenStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keywords = <span class="hljs-string"><span class="hljs-string">" if then else lambda Œª true false "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">next</span></span> : next, <span class="hljs-attr"><span class="hljs-attr">peek</span></span> : peek, <span class="hljs-attr"><span class="hljs-attr">eof</span></span> : eof, <span class="hljs-attr"><span class="hljs-attr">croak</span></span> : input.croak }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_keyword</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keywords.indexOf(<span class="hljs-string"><span class="hljs-string">" "</span></span> + x + <span class="hljs-string"><span class="hljs-string">" "</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_digit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-regexp"><span class="hljs-regexp">/[0-9]/i</span></span>.test(ch); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_id_start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-regexp"><span class="hljs-regexp">/[a-zŒª_]/i</span></span>.test(ch); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_id</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_id_start(ch) || <span class="hljs-string"><span class="hljs-string">"?!-&lt;&gt;=0123456789"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_op_char</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"+-*/%=&amp;|&lt;&gt;!"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_punc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">",;(){}[]"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_whitespace</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">" \t\n"</span></span>.indexOf(ch) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_while</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">predicate</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> str = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof() &amp;&amp; predicate(input.peek())) str += input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_number</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> has_dot = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> number = read_while(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"."</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (has_dot) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; has_dot = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_digit(ch); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">parseFloat</span></span>(number) }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_ident</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = read_while(is_id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : is_keyword(id) ? <span class="hljs-string"><span class="hljs-string">"kw"</span></span> : <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : id }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_escaped</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">end</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> escaped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, str = <span class="hljs-string"><span class="hljs-string">""</span></span>; input.next(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (escaped) { str += ch; escaped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"\\"</span></span>) { escaped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == end) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { str += ch; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_string</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"str"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: read_escaped(<span class="hljs-string"><span class="hljs-string">'"'</span></span>) }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_comment</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ read_while(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ch != <span class="hljs-string"><span class="hljs-string">"\n"</span></span> }); input.next(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ read_while(is_whitespace); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (input.eof()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ch = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">"#"</span></span>) { skip_comment(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_next(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">'"'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_string(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_digit(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_number(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_id_start(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> read_ident(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"punc"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : input.next() }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_op_char(ch)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"op"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : read_while(is_op_char) }; input.croak(<span class="hljs-string"><span class="hljs-string">"Can't handle character: "</span></span> + ch); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">peek</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> current || (current = read_next()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = current; current = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok || read_next(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eof</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> peek() == <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> </div></div><br><ul><li>  La fonction <code>next()</code> n'appelle pas toujours <code>read_next()</code> , car il peut y avoir un jeton qui a √©t√© lu auparavant (en utilisant la fonction <code>peek()</code> ).  Pour cela, nous avons une variable <code>current</code> qui contient le jeton courant. </li><li>  Seuls les nombres d√©cimaux sont pris en charge en notation r√©guli√®re (1E5, 0x, etc. ne sont pas pris en charge).  Mais si nous voulions ajouter leur support, nous ne <code>read_number()</code> que <code>read_number()</code> . </li><li>  Contrairement √† JavaScript, les seuls caract√®res qui ne peuvent pas √™tre √©chapp√©s dans une cha√Æne sont les guillemets et les barres obliques inverses.  Les lignes peuvent contenir des sauts de ligne, des tabulations et tout autre √©l√©ment.  Nous n'interpr√©tons pas les combinaisons standard comme <code>\n</code> , <code>\t</code> , etc ... C'est tr√®s facile √† refaire ( <code>read_string()</code> ). </li></ul><br><p>  Nous avons maintenant des outils puissants pour √©crire facilement un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">analyseur</a> , mais je recommanderais d'abord de regarder la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">description AST</a> . </p><br><a name="AST"></a><br><h1 id="opisanie-ast">  Description de l'AST </h1><br><p>  Comme indiqu√© ci-dessus, l'analyseur va construire une structure qui montre la s√©mantique du programme.  AST se compose de n≈ìuds.  Chaque n≈ìud est un objet JavaScript standard qui poss√®de une propri√©t√© <code>type</code> qui d√©termine le type du n≈ìud, ainsi que des informations suppl√©mentaires qui d√©pendent du type. </p><br><table><thead><tr><th>  Tapez </th><th>  La structure </th></tr></thead><tbody><tr><td>  num </td><td> <code>{ type: "num", value: NUMBER }</code> </td> </tr><tr><td>  str </td><td> <code>{ type: "str", value: STRING }</code> </td> </tr><tr><td>  bool </td><td> <code>{ type: "bool", value: true or false }</code> </td> </tr><tr><td>  var </td><td> <code>{ type: "var", value: NAME }</code> </td> </tr><tr><td>  lambda </td><td> <code>{ type: "lambda", vars: [ NAME... ], body: AST }</code> </td> </tr><tr><td>  appeler </td><td> <code>{ type: "call", func: AST, args: [ AST... ] }</code> </td> </tr><tr><td>  si </td><td> <code>{ type: "if", cond: AST, then: AST, else: AST }</code> </td> </tr><tr><td>  attribuer </td><td> <code>{ type: "assign", operator: "=", left: AST, right: AST }</code> </td> </tr><tr><td>  binaire </td><td> <code>{ type: "binary", operator: OPERATOR, left: AST, right: AST }</code> </td> </tr><tr><td>  prog </td><td> <code>{ type: "prog", prog: [ AST... ] }</code> </td> </tr><tr><td>  laisse </td><td> <code>{ type: "let", vars: [ VARS... ], body: AST }</code> </td> </tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">Des exemples</b> <div class="spoiler_text"><h5 id="chisla-num">  Num√©ros ( <code>num</code> ): </h5><br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">123.5</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">123.5</span></span> }</code> </pre> <br><h5 id="stroki-str">  Lignes ( <code>str</code> ): </h5><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"Hello World"</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"str"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span> }</code> </pre> <br><h5 id="true-i-false-bool">  <code>true</code> et <code>false</code> ( <code>bool</code> ): </h5><br><pre> <code class="python hljs">true false</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><h5 id="identifikatory-var">  Identifiants ( <code>var</code> ): </h5><br><pre> <code class="python hljs">foo</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }</code> </pre> <br><h5 id="funkcii-lambda">  Fonctions ( <code>lambda</code> ): </h5><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> (x) <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">#  Œª (x) 10</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>, <span class="hljs-attr"><span class="hljs-attr">vars</span></span>: [ <span class="hljs-string"><span class="hljs-string">"x"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">body</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } }</code> </pre> <br><p>  Plus tard, nous ajouterons un <code>name</code> param√®tre facultatif pour prendre en charge les fonctions avec un nom, mais la premi√®re version de l'analyseur ne les prendra pas en charge. </p><br><h5 id="vyzovy-funkciy-call">  Appels de fonction ( <code>call</code> ): </h5><br><pre> <code class="python hljs">foo(a, <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"call"</span></span>, <span class="hljs-string"><span class="hljs-string">"func"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }, <span class="hljs-string"><span class="hljs-string">"args"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } ] }</code> </pre> <br><h5 id="vetvleniya-if">  Succursales ( <code>if</code> ): </h5><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> foo then bar <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> baz</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-string"><span class="hljs-string">"cond"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }, <span class="hljs-string"><span class="hljs-string">"then"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"bar"</span></span> }, <span class="hljs-string"><span class="hljs-string">"else"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"baz"</span></span> } }</code> </pre> <br><h6 id="bez-else">  sans <code>else</code> : </h6><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> foo then bar</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-string"><span class="hljs-string">"cond"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span> }, <span class="hljs-string"><span class="hljs-string">"then"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"bar"</span></span> } }</code> </pre> <br><h5 id="prisvaivanie-assign">  Affectation: </h5><br><pre> <code class="python hljs">a = <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"assign"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"="</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } }</code> </pre> <br><h5 id="binarnye-operatory-binary">  Op√©rateurs <code>binary</code> ( <code>binary</code> ): </h5><br><pre> <code class="python hljs">x + y * z</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"x"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"y"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"z"</span></span> } } }</code> </pre> <br><h5 id="posledovtelnosti-prog">  S√©quences ( <code>prog</code> ): </h5><br><pre> <code class="python hljs">{ a = <span class="hljs-number"><span class="hljs-number">5</span></span>; b = a * <span class="hljs-number"><span class="hljs-number">2</span></span>; a + b; }</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-string"><span class="hljs-string">"prog"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"assign"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"="</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"assign"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"="</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> } } }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> } } ] }</code> </pre> <br><h5 id="peremennye-zaklyuchennye-v-bloki-let">  Variables enferm√©es dans des blocs ( <code>let</code> ): </h5><br><pre> <code class="python hljs">let (a = <span class="hljs-number"><span class="hljs-number">10</span></span>, b = a * <span class="hljs-number"><span class="hljs-number">10</span></span>) { a + b; }</code> </pre> <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"let"</span></span>, <span class="hljs-string"><span class="hljs-string">"vars"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-string"><span class="hljs-string">"def"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span>, <span class="hljs-string"><span class="hljs-string">"def"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"num"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> } } } ], <span class="hljs-string"><span class="hljs-string">"body"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-string"><span class="hljs-string">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-string"><span class="hljs-string">"right"</span></span>: { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"var"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> } } }</code> </pre> <br><p>  La premi√®re version de l'analyseur ne prendra pas en charge ce type de n≈ìud, nous l'ajouterons plus tard. </p></div></div><br><a name="Parser"></a><br><h1 id="parser">  Analyseur </h1><br><p>  L'analyseur va construire l'arborescence d√©crite ci-dessus. </p><br><p>  Gr√¢ce au travail que nous avons fait dans le tokenizer, l'analyseur fonctionne avec un flux de jetons, au lieu d'un flux de caract√®res.  Il existe encore de nombreuses fonctionnalit√©s suppl√©mentaires pour simplifier la structure.  Nous parlerons des principaux.  Commen√ßons par une fonction d'analyseur de haut niveau: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>, <span class="hljs-attr"><span class="hljs-attr">vars</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_varname), <span class="hljs-attr"><span class="hljs-attr">body</span></span>: parse_expression() }; }</code> </pre> <br><p>  Cette fonction sera appel√©e lorsque le mot-cl√© <code>lambda</code> a d√©j√† √©t√© extrait du flux de jetons, il nous suffit donc de prendre les noms des arguments.  Mais comme ils sont entre crochets et s√©par√©s par des virgules, nous le ferons en utilisant la fonction <code>delimited</code> , qui prend les arguments suivants: <code>start</code> , <code>stop</code> , <code>separator</code> , la fonction <code>parser</code> , qui analyse chaque √©l√©ment s√©par√©ment.  Dans ce cas, nous utilisons la fonction <code>parse_varname</code> , qui g√©n√®re une erreur si elle remarque quelque chose qui ne ressemble pas √† une variable.  Le corps de la fonction est une expression, nous l'obtenons donc avec <code>parse_expression</code> . </p><br><p>  La fonction <code>delimited</code> est de niveau inf√©rieur: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delimited</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">start, stop, separator, parser</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = [], first = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; skip_punc(start); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first) first = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> skip_punc(separator); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      a.push(parser()); } skip_punc(stop); return a; }</span></span></code> </pre> <br><p>  Comme vous pouvez le voir, il utilise encore plus de fonctions: <code>is_punc</code> et <code>skip_punc</code> .  La premi√®re renvoie <code>true</code> si le jeton actuel est un signe de ponctuation donn√© (sans l'extraire), tandis que <code>skip_punc</code> v√©rifie si le jeton actuel est un caract√®re de ponctuation donn√© et l'extrait (ou d√©clenche une exception sinon). </p><br><p>  La fonction qui analyse l'ensemble du programme semble √™tre la plus simple: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_toplevel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prog = []; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { prog.push(parse_expression()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!input.eof()) skip_punc(<span class="hljs-string"><span class="hljs-string">";"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: prog }; }</code> </pre> <br><p>  Puisque nous n'avons que des expressions, nous appelons simplement <code>parse_expression()</code> et lisons les expressions jusqu'√† ce que nous <code>parse_expression()</code> tout.  En utilisant <code>skip_punc(";")</code> , nous faisons <code>;</code>  obligatoire apr√®s chaque expression. </p><br><p>  Un autre exemple simple est <code>parse_if()</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_if</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ skip_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cond = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) skip_kw(<span class="hljs-string"><span class="hljs-string">"then"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> then = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ret = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cond</span></span>: cond, <span class="hljs-attr"><span class="hljs-attr">then</span></span>: then }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"else"</span></span>)) { input.next(); ret.else = parse_expression(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre> <br><p>  Elle ignore le mot cl√© <code>if</code> (l√®ve une exception si le jeton actuel n'est pas le mot cl√© <code>if</code> ), lit la condition √† l'aide de <code>parse_expression()</code> .  Si le symbole <code>{</code> ne va pas plus loin, alors le mot-cl√© then est requis (la syntaxe ne semble pas tr√®s bonne sans lui).  Les branches ne sont que des expressions, nous utilisons <code>parse_expression()</code> nouveau <code>parse_expression()</code> pour elles.  La branche <code>else</code> est facultative, nous v√©rifions donc d'abord la pr√©sence du mot-cl√© avant de l'analyser. </p><br><p>  Avec de nombreuses petites fonctions, nous pouvons simplifier le code.  Nous avons √©crit l'analyseur presque comme il le ferait si nous utilisions un langage de haut niveau sp√©cifiquement pour l'analyse syntaxique.  Toutes ces fonctions sont "mutuellement r√©cursives", c'est-√†-dire que nous avons <code>parse_atom()</code> , qui, selon le jeton actuel, appelle d'autres fonctions.  L'un d'eux est <code>parse_if()</code> (appel√© lorsque le jeton actuel est <code>if</code> ) et √† son tour appelle <code>parse_expression()</code> .  Mais <code>parse_expression()</code> appelle <code>parse_atom()</code> .  Il n'y a pas de r√©cursion infinie car l'une des fonctions extrait toujours au moins un jeton. </p><br><p>  Ce type de m√©thode d'analyse est appel√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©thode de descente r√©cursive</a> , et en fait, la plus simple √† √©crire. </p><br><h3 id="bolee-nizkiy-uroven-parse_atom-i-parse_expression">  Niveau inf√©rieur: <code>parse_atom()</code> et <code>parse_expression()</code> </h3><br><p>  La fonction <code>parse_atom()</code> appelle une autre fonction, selon le jeton actuel: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_atom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> exp = parse_expression(); skip_punc(<span class="hljs-string"><span class="hljs-string">")"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exp; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_prog(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_if(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"true"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"false"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_bool(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"lambda"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"Œª"</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_lambda(); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok.type == <span class="hljs-string"><span class="hljs-string">"var"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"num"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"str"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok; unexpected(); }); }</code> </pre> <br><p>  Quand elle voit le crochet ouvrant, alors l'expression parenth√®se devrait aller, donc, sautant le crochet, la fonction appelle <code>parse_expression()</code> et s'attend √† sauter le crochet fermant apr√®s cela.  Si elle voit une sorte de mot-cl√©, alors elle appelle la fonction correspondante.  Si elle voit une constante ou un identifiant, elle le renvoie tel quel.  Et si rien ne se produit, il appelle <code>unexpected()</code> , qui l√®ve une exception. </p><br><p>  Quand elle voit <code>{</code> , elle appelle <code>parse_prog</code> pour analyser la s√©quence d'expressions.  De plus, <code>parse_prog</code> fait une optimisation simple: s'il n'y a pas d'expressions entre <code>{</code> et <code>}</code> , alors il retourne <code>false</code> , s'il n'y a qu'une seule expression, alors il ne le retourne que.  Sinon, le n≈ìud <code>prog</code> avec un tableau d'expressions est retourn√©. </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     FALSE   , //     . var FALSE = { type: "bool", value: false }; function parse_prog() { var prog = delimited("{", "}", ";", parse_expression); if (prog.length == 0) return FALSE; if (prog.length == 1) return prog[0]; return { type: "prog", prog: prog }; }</span></span></code> </pre> <br><p>  Et voici la fonction <code>parse_expression()</code> .  Contrairement √† <code>parse_atom()</code> , il analysera autant d'expressions que possible en utilisant peut- <code>maybe_binary()</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_expression</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_binary(parse_atom(), <span class="hljs-number"><span class="hljs-number">0</span></span>); }); }</code> </pre> <br><h3 id="funkcii-maybe_">  Fonctions peut- <code>maybe_*</code> </h3><br><p>  Ces fonctions v√©rifient ce qui vient apr√®s l'expression et d√©cident d'envelopper l'expression dans son n≈ìud ou de la renvoyer telle quelle. </p><br><p>  La fonction peut- <code>maybe_call()</code> est tr√®s simple: elle obtient une fonction qui analyse l'expression actuelle, et si elle rencontre <code>(</code> apr√®s l'expression, elle s'enveloppe dans un <code>call</code> . Notez comment <code>delimited()</code> convient pour analyser une liste d'arguments: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">expr</span></span></span><span class="hljs-function">) </span></span>{ expr = expr(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>) ? parse_call(expr) : expr; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"call"</span></span>, <span class="hljs-attr"><span class="hljs-attr">func</span></span>: func, <span class="hljs-attr"><span class="hljs-attr">args</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_expression) }; }</code> </pre> <br><h3 id="prioritet-operatorov">  Priorit√© de l'op√©rateur </h3><br><p>  La fonction peut- <code>maybe_binary(left, my_prec)</code> est utilis√©e pour combiner des expressions telles que <code>1 + 2 * 3</code> .   , ,    ,     : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> PRECEDENCE = { <span class="hljs-string"><span class="hljs-string">"="</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"||"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;&amp;"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"=="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"!="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"+"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"/"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"%"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, };</code> </pre> <br><p>   ,  <code>*</code> "",  <code>+</code> , ,  <code>1 + 2 * 3</code>    <code>(1 + (2 * 3))</code>  <code>((1 + 2) * 3)</code> . </p><br><p>   ,      ( <code>read_atom</code> )     <code>maybe_binary()</code> ( ),     ( <code>my_prec</code> ).  <code>maybe_binary</code>  ,   .     ,     ,     . </p><br><p>   ,    ,   ,         <code>binary</code> ,  ,       ,      (*): </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_binary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left, my_prec</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = is_op(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> his_prec = PRECEDENCE[tok.value]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (his_prec &gt; my_prec) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> right = maybe_binary(parse_atom(), his_prec) <span class="hljs-comment"><span class="hljs-comment">// (*); var binary = { type : tok.value == "=" ? "assign" : "binary", operator : tok.value, left : left, right : right }; return maybe_binary(binary, my_prec); } } return left; }</span></span></code> </pre> <br><p>  ,  ,     ,    <code>maybe_binary</code> ,    ( <code>my_prec</code> ),  ,      ,     .  - ,    (,        ),     . </p><br><p> ,   ,  <code>my_prec</code>   0,         <code>binary</code> ( <code>assign</code>   <code>=</code> ). </p><br><p>      ,    . </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FALSE = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> PRECEDENCE = { <span class="hljs-string"><span class="hljs-string">"="</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"||"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;&amp;"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"=="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"!="</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"+"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"-"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"/"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"%"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_toplevel(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_punc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok &amp;&amp; tok.type == <span class="hljs-string"><span class="hljs-string">"punc"</span></span> &amp;&amp; (!ch || tok.value == ch) &amp;&amp; tok; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_kw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">kw</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok &amp;&amp; tok.type == <span class="hljs-string"><span class="hljs-string">"kw"</span></span> &amp;&amp; (!kw || tok.value == kw) &amp;&amp; tok; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_op</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">op</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.peek(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok &amp;&amp; tok.type == <span class="hljs-string"><span class="hljs-string">"op"</span></span> &amp;&amp; (!op || tok.value == op) &amp;&amp; tok; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_punc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(ch)) input.next(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting punctuation: \""</span></span> + ch + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_kw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">kw</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(kw)) input.next(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting keyword: \""</span></span> + kw + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">skip_op</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">op</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_op(op)) input.next(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting operator: \""</span></span> + op + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unexpected</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ input.croak(<span class="hljs-string"><span class="hljs-string">"Unexpected token: "</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(input.peek())); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_binary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">left, my_prec</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = is_op(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> his_prec = PRECEDENCE[tok.value]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (his_prec &gt; my_prec) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_binary({ <span class="hljs-attr"><span class="hljs-attr">type</span></span> : tok.value == <span class="hljs-string"><span class="hljs-string">"="</span></span> ? <span class="hljs-string"><span class="hljs-string">"assign"</span></span> : <span class="hljs-string"><span class="hljs-string">"binary"</span></span>, <span class="hljs-attr"><span class="hljs-attr">operator</span></span> : tok.value, <span class="hljs-attr"><span class="hljs-attr">left</span></span> : left, <span class="hljs-attr"><span class="hljs-attr">right</span></span> : maybe_binary(parse_atom(), his_prec) }, my_prec); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delimited</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">start, stop, separator, parser</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = [], first = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; skip_punc(start); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first) first = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> skip_punc(separator); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(stop)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; a.push(parser()); } skip_punc(stop); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"call"</span></span>, <span class="hljs-attr"><span class="hljs-attr">func</span></span>: func, <span class="hljs-attr"><span class="hljs-attr">args</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_expression), }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_varname</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name.type != <span class="hljs-string"><span class="hljs-string">"var"</span></span>) input.croak(<span class="hljs-string"><span class="hljs-string">"Expecting variable name"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name.value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_if</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ skip_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cond = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) skip_kw(<span class="hljs-string"><span class="hljs-string">"then"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> then = parse_expression(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ret = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"if"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cond</span></span>: cond, <span class="hljs-attr"><span class="hljs-attr">then</span></span>: then, }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"else"</span></span>)) { input.next(); ret.else = parse_expression(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_lambda</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"lambda"</span></span>, <span class="hljs-attr"><span class="hljs-attr">vars</span></span>: delimited(<span class="hljs-string"><span class="hljs-string">"("</span></span>, <span class="hljs-string"><span class="hljs-string">")"</span></span>, <span class="hljs-string"><span class="hljs-string">","</span></span>, parse_varname), <span class="hljs-attr"><span class="hljs-attr">body</span></span>: parse_expression() }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_bool</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span> : <span class="hljs-string"><span class="hljs-string">"bool"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span> : input.next().value == <span class="hljs-string"><span class="hljs-string">"true"</span></span> }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maybe_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">expr</span></span></span><span class="hljs-function">) </span></span>{ expr = expr(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>) ? parse_call(expr) : expr; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_atom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"("</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> exp = parse_expression(); skip_punc(<span class="hljs-string"><span class="hljs-string">")"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exp; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_punc(<span class="hljs-string"><span class="hljs-string">"{"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_prog(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"if"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_if(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"true"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"false"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_bool(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_kw(<span class="hljs-string"><span class="hljs-string">"lambda"</span></span>) || is_kw(<span class="hljs-string"><span class="hljs-string">"Œª"</span></span>)) { input.next(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parse_lambda(); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tok = input.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tok.type == <span class="hljs-string"><span class="hljs-string">"var"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"num"</span></span> || tok.type == <span class="hljs-string"><span class="hljs-string">"str"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tok; unexpected(); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_toplevel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prog = []; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!input.eof()) { prog.push(parse_expression()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!input.eof()) skip_punc(<span class="hljs-string"><span class="hljs-string">";"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: prog }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_prog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prog = delimited(<span class="hljs-string"><span class="hljs-string">"{"</span></span>, <span class="hljs-string"><span class="hljs-string">"}"</span></span>, <span class="hljs-string"><span class="hljs-string">";"</span></span>, parse_expression); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prog.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prog.length == <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prog[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"prog"</span></span>, <span class="hljs-attr"><span class="hljs-attr">prog</span></span>: prog }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_expression</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_call(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> maybe_binary(parse_atom(), <span class="hljs-number"><span class="hljs-number">0</span></span>); }); } }</code> </pre> </div></div><br><h2 id="blagodarnosti">  Remerciements </h2><br><p>   Marijn Haverbeke,   parse-js (Common Lisp),    ,   . ,        ,  JS,      . </p><br><p>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">     JavaScript.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2: interpr√®te</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr443630/">https://habr.com/ru/post/fr443630/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr443618/index.html">√âmulateur d'ordinateur des ann√©es 80 dans le navigateur</a></li>
<li><a href="../fr443620/index.html">Notre probl√®me avec les d√©pendances</a></li>
<li><a href="../fr443624/index.html">≈íuvres num√©riques et VMware: VDI est mort, VDI longue dur√©e</a></li>
<li><a href="../fr443626/index.html">Bienvenue √† la Top 3D Expo 2019</a></li>
<li><a href="../fr443628/index.html">Fonctions Bessel dans le programme de math√©matiques symboliques SymPy</a></li>
<li><a href="../fr443636/index.html">Morse Key et Klopfer</a></li>
<li><a href="../fr443638/index.html">Comment Protonmail est censur√© par le FSB en Russie</a></li>
<li><a href="../fr443640/index.html">L'eau aiguise une pierre</a></li>
<li><a href="../fr443642/index.html">Un administrateur de la NASA estime qu'il est possible d'envoyer Orion pour le premier voyage autour de la lune sur une fus√©e commerciale</a></li>
<li><a href="../fr443644/index.html">Rouler les ≈ìufs avec Unity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>