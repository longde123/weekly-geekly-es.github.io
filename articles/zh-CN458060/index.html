<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âœ‹ğŸ¿ ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ¨ åœ¨Unityå¼•æ“ä¸­åˆ›å»ºè‰ç€è‰²å™¨ ğŸ™„ ğŸ‘‡ğŸ¿ ğŸ”„</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ¬æ•™ç¨‹å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ç¼–å†™å‡ ä½•ç€è‰²å™¨ï¼Œä»¥ä»ä¼ å…¥ç½‘æ ¼çš„é¡¶éƒ¨ç”Ÿæˆè‰å¶ï¼Œå¹¶ä½¿ç”¨ç»†åˆ†æ¥æ§åˆ¶è‰çš„å¯†åº¦ã€‚ 

 æœ¬æ–‡ä»‹ç»äº†åœ¨Unityä¸­ç¼–å†™è‰ç€è‰²å™¨çš„åˆ†æ­¥è¿‡ç¨‹ã€‚ ç€è‰²å™¨æ¥æ”¶ä¼ å…¥çš„ç½‘æ ¼ï¼Œç„¶åä½¿ç”¨å‡ ä½•ç€è‰²å™¨ä»ç½‘æ ¼çš„æ¯ä¸ªé¡¶ç‚¹ç”Ÿæˆè‰å¶ã€‚ ä¸ºäº†æœ‰è¶£å’Œç°å®èµ·è§ï¼Œè‰å¶çš„å¤§å°å’Œæ—‹è½¬åº¦æ˜¯éšæœºçš„ ï¼Œå¹¶ä¸”å®ƒä»¬ä¹Ÿä¼šå—åˆ°é£çš„å½±å“ã€‚ ä¸ºäº†æ§...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Unityå¼•æ“ä¸­åˆ›å»ºè‰ç€è‰²å™¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458060/"><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> æœ¬æ•™ç¨‹å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ç¼–å†™å‡ ä½•ç€è‰²å™¨ï¼Œä»¥ä»ä¼ å…¥ç½‘æ ¼çš„é¡¶éƒ¨ç”Ÿæˆè‰å¶ï¼Œå¹¶ä½¿ç”¨ç»†åˆ†æ¥æ§åˆ¶è‰çš„å¯†åº¦ã€‚ <br><br> æœ¬æ–‡ä»‹ç»äº†åœ¨Unityä¸­ç¼–å†™è‰ç€è‰²å™¨çš„åˆ†æ­¥è¿‡ç¨‹ã€‚ ç€è‰²å™¨æ¥æ”¶ä¼ å…¥çš„ç½‘æ ¼ï¼Œç„¶åä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‡ ä½•ç€è‰²å™¨</a>ä»ç½‘æ ¼çš„æ¯ä¸ªé¡¶ç‚¹ç”Ÿæˆè‰å¶ã€‚ ä¸ºäº†æœ‰è¶£å’Œç°å®èµ·è§ï¼Œè‰å¶çš„<strong>å¤§å°</strong>å’Œ<strong>æ—‹è½¬åº¦</strong>æ˜¯<strong>éšæœºçš„</strong> ï¼Œå¹¶ä¸”å®ƒä»¬ä¹Ÿä¼šå—åˆ°<strong>é£çš„</strong>å½±å“ã€‚ ä¸ºäº†æ§åˆ¶è‰çš„å¯†åº¦ï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»†åˆ†</a>æ¥åˆ†ç¦»ä¼ å…¥çš„ç½‘æ ¼ã€‚ è‰å°†èƒ½å¤Ÿ<strong>æŠ•å°„</strong>å¹¶<strong>æ¥æ”¶</strong>é˜´å½±ã€‚ <br><br>  <strong>å®Œæˆçš„é¡¹ç›®</strong>å°†å‘å¸ƒåœ¨æ–‡ç« çš„æœ«å°¾ã€‚ ç”Ÿæˆçš„ç€è‰²å™¨æ–‡ä»¶åŒ…å«å¤§é‡æ³¨é‡Šï¼Œè¿™äº›æ³¨é‡Šä½¿ç†è§£å˜å¾—æ›´å®¹æ˜“ã€‚ <br><a name="habracut"></a><br><h3> è¦æ±‚æ¡ä»¶ </h3><br> è¦å®Œæˆæœ¬æ•™ç¨‹ï¼Œæ‚¨å°†éœ€è¦æœ‰å…³Unityå¼•æ“çš„å®ç”¨çŸ¥è¯†ä»¥åŠå¯¹ç€è‰²å™¨è¯­æ³•å’ŒåŠŸèƒ½çš„åˆæ­¥äº†è§£ã€‚ <br><br>  <a href="">ä¸‹è½½é¡¹ç›®è‰æ¡ˆï¼ˆ.zipï¼‰</a> ã€‚ <br><br><h2> å¼€å§‹å·¥ä½œ </h2><br> ä¸‹è½½é¡¹ç›®è‰ç¨¿ï¼Œç„¶ååœ¨Unityç¼–è¾‘å™¨ä¸­å°†å…¶æ‰“å¼€ã€‚ æ‰“å¼€<code>Main</code>åœºæ™¯ï¼Œç„¶ååœ¨ä»£ç ç¼–è¾‘å™¨ä¸­æ‰“å¼€<code>Grass</code>ç€è‰²å™¨ã€‚ <br><br> è¯¥æ–‡ä»¶åŒ…å«ä¸€ä¸ªäº§ç”Ÿç™½è‰²çš„ç€è‰²å™¨ï¼Œä»¥åŠæˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„ä¸€äº›åŠŸèƒ½ã€‚ æ‚¨ä¼šæ³¨æ„åˆ°ï¼Œè¿™äº›åŠŸèƒ½ä»¥åŠé¡¶ç‚¹ç€è‰²å™¨éƒ½åŒ…å«åœ¨<code>CGINCLUDE</code> <em>å¤–éƒ¨</em>çš„<code>CGINCLUDE</code>å—<em>ä¸­</em> ã€‚ æ”¾ç½®åœ¨æ­¤å—ä¸­çš„ä»£ç å°†<strong>è‡ªåŠ¨åŒ…å«åœ¨</strong>ç€è‰²å™¨çš„<strong>æ‰€æœ‰éæ¬¡</strong>ä¸­ã€‚ ç¨åå°†æ´¾ä¸Šç”¨åœºï¼Œå› ä¸ºæˆ‘ä»¬çš„ç€è‰²å™¨å°†ç»è¿‡æ•°æ¬¡ä¼ é€’ã€‚ <br><br> æˆ‘ä»¬å°†ä»ç¼–å†™ä¸€ä¸ª<strong>å‡ ä½•ç€è‰²å™¨</strong>å¼€å§‹ï¼Œè¯¥<strong>ç€è‰²å™¨</strong>ä»ç½‘æ ¼è¡¨é¢ä¸Šçš„æ¯ä¸ªé¡¶ç‚¹ç”Ÿæˆä¸‰è§’å½¢ã€‚ <br><br><h2>  1.å‡ ä½•ç€è‰²å™¨ </h2><br> å‡ ä½•ç€è‰²å™¨æ˜¯æ¸²æŸ“ç®¡çº¿çš„å¯é€‰éƒ¨åˆ†ã€‚ å®ƒä»¬<strong>åœ¨</strong>é¡¶ç‚¹ç€è‰²å™¨ï¼ˆå¦‚æœä½¿ç”¨é•¶åµŒç»†åˆ†ï¼Œåˆ™ä¸ºé•¶åµŒç»†åˆ†ç€è‰²å™¨ï¼‰ä¹‹åï¼Œåœ¨ä¸ºç‰‡æ®µç€è‰²å™¨å¤„ç†é¡¶ç‚¹ä¹‹å‰æ‰§è¡Œã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef7/c01/458/ef7c01458cadf7cd0cf46695d7114f96.jpg"></div><br>  <i>Direct3Då›¾å½¢ç®¡é“11.è¯·æ³¨æ„ï¼Œåœ¨æ­¤å›¾ä¸­ï¼Œç‰‡æ®µç€è‰²å™¨ç§°ä¸º<em>pixel shader</em> ã€‚</i> <br><br> å‡ ä½•ç€è‰²å™¨åœ¨è¾“å…¥å¤„æ¥æ”¶å•ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å›¾å…ƒ</a> ï¼Œå¹¶ä¸”å¯ä»¥ç”Ÿæˆé›¶ä¸ªï¼Œä¸€ä¸ªæˆ–å¤šä¸ªå›¾å…ƒã€‚ æˆ‘ä»¬å°†ä»ç¼–å†™ä¸€ä¸ªå‡ ä½•ç€è‰²å™¨å¼€å§‹ï¼Œè¯¥ç€è‰²å™¨åœ¨è¾“å…¥å¤„æ¥æ”¶ä¸€ä¸ª<strong>é¡¶ç‚¹</strong> ï¼ˆæˆ–<em>ç‚¹</em> ï¼‰ï¼Œå¹¶é¦ˆå…¥<strong>ä¸€ä¸ª</strong>ä»£è¡¨è‰å¶çš„<strong>ä¸‰è§’å½¢</strong> ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add inside the CGINCLUDE block. struct geometryOutput { float4 pos : SV_POSITION; }; [maxvertexcount(3)] void geo(triangle float4 IN[3] : SV_POSITION, inout TriangleStream&lt;geometryOutput&gt; triStream) { } â€¦ // Add inside the SubShader Pass, just below the #pragma fragment frag line. #pragma geometry geo</span></span></code> </pre> <br> ä¸Šé¢çš„ä»£ç å£°æ˜äº†ä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªå‚æ•°çš„å‡ ä½•ç€è‰²å™¨ï¼Œç§°ä¸º<code>geo</code> ã€‚ ç¬¬ä¸€ä¸ª<code>triangle float4 IN[3]</code>æŠ¥å‘Šå°†é‡‡ç”¨ä¸€ä¸ªä¸‰è§’å½¢ï¼ˆç”±ä¸‰ä¸ªç‚¹ç»„æˆï¼‰ä½œä¸ºè¾“å…¥ã€‚ ç¬¬äºŒä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚<code>TriangleStream</code> ï¼Œè®¾ç½®äº†ä¸€ä¸ªç€è‰²å™¨ä»¥è¾“å‡ºä¸‰è§’å½¢çš„æµï¼Œä»¥ä¾¿æ¯ä¸ªé¡¶ç‚¹éƒ½ä½¿ç”¨<code>geometryOutput</code>ç»“æ„æ¥ä¼ è¾“å…¶æ•°æ®ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">ä¸Šé¢æˆ‘ä»¬è¯´è¿‡ï¼Œç€è‰²å™¨å°†æ¥æ”¶ä¸€ä¸ªé¡¶ç‚¹å¹¶è¾“å‡ºä¸€è‰ã€‚</b>  <b class="spoiler_title">ä¸ºä»€ä¹ˆç„¶åæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªä¸‰è§’å½¢ï¼Ÿ</b> <div class="spoiler_text"> å°†ä¸€ä¸ª<code></code>ä½œä¸ºè¾“å…¥å°†é™ä½æˆæœ¬ã€‚ è¿™å¯ä»¥å¦‚ä¸‹è¿›è¡Œã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">geo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(point vertexOutput IN[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">], inout TriangleStream&lt;geometryOutput&gt; triStream)</span></span></span></span></code> </pre> <br> ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬çš„ä¼ å…¥ç½‘æ ¼ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º<code>GrassPlane10x10</code>æ–‡ä»¶å¤¹ä¸­çš„<code>GrassPlane10x10</code> ï¼‰å…·æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸‰è§’å½¢æ‹“æ‰‘</a> ï¼Œå› æ­¤è¿™å°†å¯¼è‡´ä¼ å…¥ç½‘æ ¼æ‹“æ‰‘ä¸æ‰€éœ€çš„è¾“å…¥å›¾å…ƒä¹‹é—´ä¸åŒ¹é…ã€‚ å°½ç®¡DirectX HLSLä¸­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…è®¸</a>è¿™æ ·åšï¼Œä½†æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OpenGLä¸­ä¸å…è®¸</a>è¿™æ ·åšï¼Œå› æ­¤å°†æ˜¾ç¤ºé”™è¯¯ã€‚ </div></div><br> æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°å£°æ˜ä¸Šæ–¹çš„æ–¹æ‹¬å·ä¸­æ·»åŠ äº†æœ€åä¸€ä¸ªå‚æ•°ï¼š <code>[maxvertexcount(3)]</code> ã€‚ ä»–å‘Šè¯‰GPUï¼Œæˆ‘ä»¬å°†è¾“å‡ºï¼ˆä½†ä¸<strong>è¦æ±‚</strong>è¿™æ ·åšï¼‰ <em>ä¸è¶…è¿‡</em> 3ä¸ªé¡¶ç‚¹ã€‚ æˆ‘ä»¬è¿˜é€šè¿‡åœ¨<code>Pass</code>å£°æ˜<code>SubShader</code>ä½¿ç”¨å‡ ä½•ç€è‰²å™¨ã€‚ <br><br> æˆ‘ä»¬çš„å‡ ä½•ç€è‰²å™¨å°šæœªæ‰§è¡Œä»»ä½•æ“ä½œã€‚ è¦ç»˜åˆ¶ä¸‰è§’å½¢ï¼Œè¯·åœ¨å‡ ä½•ç€è‰²å™¨ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ã€‚ <br><br><pre> <code class="cpp hljs">geometryOutput o; o.pos = float4(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); triStream.Append(o); o.pos = float4(<span class="hljs-number"><span class="hljs-number">-0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); triStream.Append(o); o.pos = float4(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); triStream.Append(o);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0db/534/ac1/0db534ac10c125955829fd53b9923cd7.gif"></div><br> è¿™ç»™å‡ºäº†éå¸¸å¥‡æ€ªçš„ç»“æœã€‚ å½“æ‚¨ç§»åŠ¨ç›¸æœºæ—¶ï¼Œå¾ˆæ˜æ˜¾ä¸‰è§’å½¢åœ¨<strong>å±å¹•ç©ºé—´ä¸­</strong>å‘ˆç°ã€‚ è¿™æ˜¯åˆä¹é€»è¾‘çš„ï¼šç”±äºå‡ ä½•ç€è‰²å™¨æ˜¯åœ¨å¤„ç†é¡¶ç‚¹ä¹‹å‰ç«‹å³æ‰§è¡Œçš„ï¼Œå› æ­¤å®ƒä½¿é¡¶ç‚¹ç€è‰²å™¨æ— éœ€æ‰¿æ‹…é¡¶ç‚¹ç€è‰²å™¨åœ¨<strong>æˆªæ–­ç©ºé—´ä¸­</strong>æ˜¾ç¤ºçš„è´£ä»»ã€‚ æˆ‘ä»¬å°†æ›´æ”¹ä»£ç ä»¥åæ˜ è¿™ä¸€ç‚¹ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Update the return call in the vertex shader. //return UnityObjectToClipPos(vertex); return vertex; â€¦ // Update each assignment of o.pos in the geometry shader. o.pos = UnityObjectToClipPos(float4(0.5, 0, 0, 1)); â€¦ o.pos = UnityObjectToClipPos(float4(-0.5, 0, 0, 1)); â€¦ o.pos = UnityObjectToClipPos(float4(0, 1, 0, 1));</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/221/912/b3e/221912b3e6bc0581126a0f415b6e79c5.png"></div><br> ç°åœ¨æˆ‘ä»¬çš„ä¸‰è§’å½¢åœ¨ä¸–ç•Œä¸Šæ­£ç¡®æ¸²æŸ“äº†ã€‚ ä½†æ˜¯ï¼Œä¼¼ä¹åªåˆ›å»ºäº†ä¸€ä¸ªã€‚ å®é™…ä¸Šï¼Œä¸ºç½‘æ ¼çš„æ¯ä¸ªé¡¶ç‚¹<em>ç»˜åˆ¶</em>äº†ä¸€ä¸ªä¸‰è§’å½¢ï¼Œä½†æ˜¯åˆ†é…ç»™ä¸‰è§’å½¢é¡¶ç‚¹çš„ä½ç½®æ˜¯<strong>æ’å®šçš„</strong> -å®ƒä»¬å¯¹äºæ¯ä¸ªä¼ å…¥çš„é¡¶ç‚¹éƒ½ä¸ä¼šæ”¹å˜ã€‚ å› æ­¤ï¼Œæ‰€æœ‰ä¸‰è§’å½¢éƒ½ä½äºå¦ä¸€ä¸ªä¸‰è§’å½¢çš„ä¸Šæ–¹ã€‚ <br><br> æˆ‘ä»¬å°†é€šè¿‡ä½¿è¾“å‡ºé¡¶ç‚¹ä½ç½®ç›¸å¯¹äºè¾“å…¥ç‚¹<strong>åç§»</strong>æ¥è§£å†³æ­¤é—®é¢˜ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the top of the geometry shader. float3 pos = IN[0]; â€¦ // Update each assignment of o.pos. o.pos = UnityObjectToClipPos(pos + float3(0.5, 0, 0)); â€¦ o.pos = UnityObjectToClipPos(pos + float3(-0.5, 0, 0)); â€¦ o.pos = UnityObjectToClipPos(pos + float3(0, 1, 0));</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6b2/ac4/84c/6b2ac484c5a033b18e88400e10191779.png"></div><br><div class="spoiler">  <b class="spoiler_title">ä¸ºä»€ä¹ˆæœ‰äº›é¡¶ç‚¹ä¸åˆ›å»ºä¸‰è§’å½¢ï¼Ÿ</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cab/447/d9c/cab447d9c4c82d8208a28e7cee2f7807.png"></div><br> å°½ç®¡æˆ‘ä»¬ç¡®å®šä¼ å…¥çš„å›¾å…ƒå°†æ˜¯<strong>ä¸‰è§’å½¢</strong> ï¼Œä½†ä»…ä»ä¸‰è§’å½¢çš„<strong>ä¸€ä¸ª</strong>ç‚¹ä¼ è¾“è‰å¶ï¼Œè€Œä¸¢å¼ƒå…¶ä»–ä¸¤ä¸ªç‚¹ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ‰€æœ‰ä¸‰ä¸ªä¼ å…¥ç‚¹è½¬ç§»è‰å¶ï¼Œä½†æ˜¯è¿™å°†å¯¼è‡´ä»¥ä¸‹äº‹å®ï¼šç›¸é‚»çš„ä¸‰è§’å½¢è¿‡åº¦åœ°åœ¨å½¼æ­¤ä¹‹ä¸Šåˆ›å»ºè‰å¶ã€‚ <br><br> æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡å°†å…·æœ‰æ‹“æ‰‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç‚¹</a>ç±»å‹çš„ç½‘æ ¼ä½œä¸ºå‡ ä½•ç€è‰²å™¨çš„ä¼ å…¥ç½‘æ ¼æ¥è§£å†³æ­¤é—®é¢˜ã€‚ </div></div><br> ç°åœ¨å¯ä»¥æ­£ç¡®ç»˜åˆ¶ä¸‰è§’å½¢ï¼Œå¹¶ä¸”ä¸‰è§’å½¢çš„åº•éƒ¨ä½äºå‘å‡ºä¸‰è§’å½¢çš„å³°å€¼å¤„ã€‚ åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ä½¿<code>GrassPlane</code>å¯¹è±¡åœ¨åœºæ™¯ä¸­<strong>å¤„äºéæ´»åŠ¨çŠ¶æ€</strong> ï¼Œå¹¶ä½¿<code>GrassBall</code>å¯¹è±¡<strong>å¤„äºæ´»åŠ¨çŠ¶æ€</strong> ã€‚ æˆ‘ä»¬å¸Œæœ›è‰èƒ½å¤Ÿåœ¨ä¸åŒç±»å‹çš„è¡¨é¢ä¸Šæ­£ç¡®ç”Ÿæˆï¼Œå› æ­¤åœ¨ä¸åŒå½¢çŠ¶çš„ç½‘æ ¼ä¸Šå¯¹å…¶è¿›è¡Œæµ‹è¯•éå¸¸é‡è¦ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/19b/f67/8fb/19bf678fbb6ce3c03956dbdf068004f0.png"></div><br> è€Œæ‰€æœ‰ä¸‰è§’å½¢å‡æ²¿ä¸€ä¸ªæ–¹å‘å‘å°„ï¼Œè€Œä¸æ˜¯ä»çƒä½“è¡¨é¢å‘å¤–å‘å°„ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†åœ¨<strong>åˆ‡çº¿ç©ºé—´ä¸­</strong>åˆ›å»ºè‰å¶ã€‚ <br><br><h2>  2.åˆ‡çº¿ç©ºé—´ </h2><br> ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡è®¾ç½®ä¸åŒçš„å®½åº¦ï¼Œé«˜åº¦ï¼Œæ›²ç‡å’Œæ—‹è½¬æ¥åˆ›å»ºè‰å¶ï¼Œè€Œä¸è€ƒè™‘ä»ä¸­å‘å‡ºè‰å¶çš„è¡¨é¢çš„è§’åº¦ã€‚ ç®€å•åœ°è¯´ï¼Œæˆ‘ä»¬åœ¨å‘å‡º<strong>è¯¥é¡¶ç‚¹çš„é¡¶ç‚¹å±€éƒ¨</strong>çš„ç©ºé—´ä¸­å®šä¹‰ä¸€ç‰‡è‰å¶ï¼Œç„¶åå¯¹å…¶è¿›è¡Œå˜æ¢ï¼Œä½¿å…¶ä½äº<strong>ç½‘æ ¼çš„å±€éƒ¨</strong> ã€‚ è¯¥ç©ºé—´ç§°ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ‡çº¿ç©ºé—´</a> ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3fd/8f7/c39/3fd8f7c394bf4eb18cb988aceafe342b.png"></div><br>  <i>åœ¨åˆ‡çº¿ç©ºé—´ä¸­ï¼Œç›¸å¯¹äºæ›²é¢çš„æ³•çº¿å’Œä½ç½®ï¼ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ä¸ºé¡¶ç‚¹ï¼‰å®šä¹‰<strong>X</strong>è½´ï¼Œ <strong>Y</strong>è½´å’Œ<strong>Z</strong>è½´ã€‚</i> <br><br> åƒä»»ä½•å…¶ä»–ç©ºé—´ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‰ä¸ªå‘é‡æ¥å®šä¹‰é¡¶ç‚¹çš„åˆ‡çº¿ç©ºé—´ï¼š <strong>right</strong> ï¼Œ <strong>forward</strong>å’Œ<strong>up</strong> ã€‚ ä½¿ç”¨è¿™äº›å‘é‡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªçŸ©é˜µï¼Œç”¨äºå°†è‰å¶ä»åˆ‡çº¿å˜ä¸ºå±€éƒ¨ç©ºé—´ã€‚ <br><br> æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ æ–°çš„è¾“å…¥é¡¶ç‚¹æ•°æ®æ¥<strong>å‘ä¸Š</strong>å’Œ<strong>å‘å³</strong>è®¿é—®å‘é‡ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the CGINCLUDE block. struct vertexInput { float4 vertex : POSITION; float3 normal : NORMAL; float4 tangent : TANGENT; }; struct vertexOutput { float4 vertex : SV_POSITION; float3 normal : NORMAL; float4 tangent : TANGENT; }; â€¦ // Modify the vertex shader. vertexOutput vert(vertexInput v) { vertexOutput o; o.vertex = v.vertex; o.normal = v.normal; o.tangent = v.tangent; return o; } â€¦ // Modify the input for the geometry shader. Note that the SV_POSITION semantic is removed. void geo(triangle vertexOutput IN[3], inout TriangleStream&lt;geometryOutput&gt; triStream) â€¦ // Modify the existing line declaring pos. float3 pos = IN[0].vertex;</span></span></code> </pre> <br> ç¬¬ä¸‰å‘é‡å¯ä»¥é€šè¿‡å–ä¸¤ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‘é‡</a>ä¹‹é—´çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‘é‡ä¹˜ç§¯</a>æ¥è®¡ç®—ã€‚ å‘é‡ä¹˜ç§¯è¿”å›ä¸€ä¸ª<strong>å‚ç›´</strong>äºä¸¤ä¸ªä¼ å…¥å‘é‡çš„å‘é‡ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Place in the geometry shader, below the line declaring float3 pos. float3 vNormal = IN[0].normal; float4 vTangent = IN[0].tangent; float3 vBinormal = cross(vNormal, vTangent) * vTangent.w;</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">ä¸ºä»€ä¹ˆçŸ¢é‡ä¹˜ç§¯çš„ç»“æœä¹˜ä»¥åˆ‡çº¿wçš„åæ ‡ï¼Ÿ</b> <div class="spoiler_text"> ä»3Dç¼–è¾‘å™¨å¯¼å‡ºç½‘æ ¼æ—¶ï¼Œå®ƒé€šå¸¸å·²ç»åœ¨ç½‘æ ¼æ•°æ®ä¸­å­˜å‚¨äº†åŒæ³•çº¿ï¼ˆä¹Ÿç§°ä¸º<em>åˆ°ä¸¤ä¸ªç‚¹çš„åˆ‡çº¿</em> ï¼‰ã€‚ æ— éœ€å¯¼å…¥è¿™äº›åŒæ³•çº¿ï¼ŒUnityåªéœ€è·å–æ¯ä¸ªåŒæ³•çº¿çš„æ–¹å‘å¹¶å°†å…¶åˆ†é…ç»™åˆ‡çº¿<strong>w</strong>çš„åæ ‡å³å¯ã€‚ è¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜ï¼ŒåŒæ—¶æä¾›é‡æ–°åˆ›å»ºæ­£ç¡®çš„Binormalçš„åŠŸèƒ½ã€‚ æœ‰å…³æ­¤ä¸»é¢˜çš„è¯¦ç»†è®¨è®ºï¼Œè¯·å‚è§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a> ã€‚ </div></div><br> æœ‰äº†æ‰€æœ‰ä¸‰ä¸ªå‘é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºåˆ‡çº¿å’Œå±€éƒ¨ç©ºé—´ä¹‹é—´çš„è½¬æ¢åˆ›å»ºçŸ©é˜µã€‚ åœ¨å°†è‰å¶çš„æ¯ä¸ªé¡¶ç‚¹ä¼ é€’ç»™<code>UnityObjectToClipPos</code>ä¹‹å‰ï¼Œæˆ‘ä»¬å°†å…¶ä¹˜ä»¥è¯¥çŸ©é˜µï¼Œè¯¥çŸ©é˜µæœŸæœ›å±€éƒ¨ç©ºé—´ä¸­æœ‰ä¸€ä¸ªé¡¶ç‚¹ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the lines declaring the three vectors. float3x3 tangentToLocal = float3x3( vTangent.x, vBinormal.x, vNormal.x, vTangent.y, vBinormal.y, vNormal.y, vTangent.z, vBinormal.z, vNormal.z );</span></span></code> </pre> <br> åœ¨ä½¿ç”¨çŸ©é˜µä¹‹å‰ï¼Œæˆ‘ä»¬å°†é¡¶ç‚¹è¾“å‡ºä»£ç ä¼ é€’ç»™å‡½æ•°ï¼Œä»¥å…ä¸€æ¬¡åˆä¸€æ¬¡åœ°å†™ç›¸åŒçš„ä»£ç è¡Œã€‚ è¿™å°±æ˜¯æ‰€è°“<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„DRYåŸç†</a> ï¼Œæˆ–è€…<strong>ä¸è¦é‡å¤è‡ªå·±</strong> ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the CGINCLUDE block. geometryOutput VertexOutput(float3 pos) { geometryOutput o; o.pos = UnityObjectToClipPos(pos); return o; } â€¦ // Remove the following from the geometry shader. //geometryOutput o; //o.pos = UnityObjectToClipPos(pos + float3(0.5, 0, 0)); //triStream.Append(o); //o.pos = UnityObjectToClipPos(pos + float3(-0.5, 0, 0)); //triStream.Append(o); //o.pos = UnityObjectToClipPos(pos + float3(0, 1, 0)); //triStream.Append(o); // ...and replace it with the code below. triStream.Append(VertexOutput(pos + float3(0.5, 0, 0))); triStream.Append(VertexOutput(pos + float3(-0.5, 0, 0))); triStream.Append(VertexOutput(pos + float3(0, 1, 0)));</span></span></code> </pre> <br> æœ€åï¼Œæˆ‘ä»¬å°†è¾“å‡ºé¡¶ç‚¹ä¸<code>tangentToLocal</code>çŸ©é˜µç›¸ä¹˜ï¼Œä½¿å®ƒä»¬ä¸è¾“å…¥ç‚¹çš„æ³•çº¿æ­£ç¡®å¯¹é½ã€‚ <br><br><pre> <code class="cpp hljs">triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)))); triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(<span class="hljs-number"><span class="hljs-number">-0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)))); triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>))));</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c95/3f8/286/c953f828675a9d4e202c0c9349d37f9d.png" alt="å›¾ç‰‡"></div><br> è¿™æ›´åƒæˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œä½†å¹¶ä¸å®Œå…¨æ­£ç¡®ã€‚ è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œæœ€åˆæˆ‘ä»¬å°†<strong>Y</strong>è½´çš„æ–¹å‘æŒ‡å®šä¸ºâ€œä¸Šâ€ï¼ˆä¸Šï¼‰ã€‚ ä½†æ˜¯ï¼Œåœ¨åˆ‡çº¿ç©ºé—´ä¸­ï¼Œå‘ä¸Šæ–¹å‘é€šå¸¸æ²¿<strong>Z</strong>è½´å®šä½ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›è¡Œè¿™äº›æ›´æ”¹ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Modify the position of the third vertex being emitted. triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(0, 0, 1))));</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0cf/f51/ddb/0cff51ddbea12280cb78a1db9ada1786.png"></div><br><h2>  3.è‰çš„å¤–è§‚ </h2><br> ä¸ºäº†ä½¿ä¸‰è§’å½¢çœ‹èµ·æ¥æ›´åƒè‰å¶ï¼Œæ‚¨éœ€è¦æ·»åŠ é¢œè‰²å’Œå˜åŒ–ã€‚ æˆ‘ä»¬é¦–å…ˆæ·»åŠ ä¸€ä¸ªä»è‰å¶é¡¶éƒ¨å‘ä¸‹çš„<strong>æ¸å˜</strong> ã€‚ <br><br><h3>  3.1é¢œè‰²æ¸å˜ </h3><br> æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å…è®¸è‰ºæœ¯å®¶è®¾ç½®ä¸¤ç§é¢œè‰²-é¡¶éƒ¨å’Œåº•éƒ¨ï¼Œå¹¶åœ¨è¿™ä¸¤ç§é¢œè‰²ä¹‹é—´è¿›è¡Œæ’å€¼ï¼Œä»¥ä½¿ä»–å€¾æ–œåˆ°è‰å¶çš„åº•éƒ¨ã€‚ è¿™äº›é¢œè‰²å·²åœ¨ç€è‰²å™¨æ–‡ä»¶ä¸­å®šä¹‰ä¸º<code>_TopColor</code>å’Œ<code>_BottomColor</code> ã€‚ ä¸ºäº†æ­£ç¡®é‡‡æ ·ï¼Œæ‚¨éœ€è¦å°†<strong>UVåæ ‡</strong>ä¼ é€’åˆ°ç‰‡æ®µç€è‰²å™¨ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the geometryOutput struct. float2 uv : TEXCOORD0; â€¦ // Modify the VertexOutput function signature. geometryOutput VertexOutput(float3 pos, float2 uv) â€¦ // Add to VertexOutput, just below the line assigning o.pos. o.uv = uv; â€¦ // Modify the existing lines in the geometry shader. triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(0.5, 0, 0)), float2(0, 0))); triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(-0.5, 0, 0)), float2(1, 0))); triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(0, 0, 1)), float2(0.5, 1)));</span></span></code> </pre> <br> æˆ‘ä»¬ä¸ºä¸‰è§’å½¢çš„è‰å¶åˆ›å»ºäº†UVåæ ‡ï¼Œä¸‰è§’å½¢çš„åŸºç‚¹çš„ä¸¤ä¸ªé¡¶ç‚¹åˆ†åˆ«ä½äºå·¦ä¸‹å’Œå³ä¸‹ï¼Œé¡¶ç«¯ä½äºé¡¶éƒ¨çš„ä¸­å¿ƒã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/165/e39/932/165e399323aaa07e7c4cee728c0c9988.png"></div><br>  <i>è‰å¶ç‰‡çš„ä¸‰ä¸ªé¡¶ç‚¹çš„UVåæ ‡ã€‚</i>  <i>å°½ç®¡æˆ‘ä»¬ä½¿ç”¨ç®€å•çš„æ¸å˜ç»˜åˆ¶è‰å¶ï¼Œä½†ç›¸ä¼¼çš„çº¹ç†æ’åˆ—æ–¹å¼å…è®¸æ‚¨è¦†ç›–çº¹ç†ã€‚</i> <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨UVå¯¹ç‰‡æ®µç€è‰²å™¨ä¸­çš„é¡¶éƒ¨å’Œåº•éƒ¨é¢œè‰²è¿›è¡Œé‡‡æ ·ï¼Œç„¶åä½¿ç”¨<code>lerp</code>å¯¹å…¶è¿›è¡Œ<code>lerp</code> ã€‚ æˆ‘ä»¬è¿˜å°†éœ€è¦ä¿®æ”¹ç‰‡æ®µç€è‰²å™¨çš„å‚æ•°ï¼Œä½¿<code>geometryOutput</code>ä½œä¸ºè¾“å…¥ï¼Œè€Œä¸ä»…ä»…æ˜¯<code>float4</code>çš„ä½ç½®ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Modify the function signature of the fragment shader. float4 frag (geometryOutput i, fixed facing : VFACE) : SV_Target â€¦ // Replace the existing return call. return float4(1, 1, 1, 1); return lerp(_BottomColor, _TopColor, i.uv.y);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/596/510/51f/59651051f474907a88740e83bc9d4532.png"></div><br><h3>  3.2éšæœºå¶ç‰‡æ–¹å‘ </h3><br> ä¸ºäº†äº§ç”Ÿå˜åŒ–å¹¶èµ‹äºˆè‰æ›´è‡ªç„¶çš„å¤–è§‚ï¼Œæˆ‘ä»¬å°†ä½¿æ¯ç‰‡è‰åœ¨éšæœºæ–¹å‘ä¸Šçœ‹èµ·æ¥ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ—‹è½¬çŸ©é˜µï¼Œä½¿è‰å¶ç»•å…¶<strong>ä¸Š</strong>è½´æ—‹è½¬ä»»æ„é‡ã€‚ <br><br> ç€è‰²å™¨æ–‡ä»¶ä¸­æœ‰ä¸¤ä¸ªå‡½æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬åšåˆ°è¿™ä¸€ç‚¹ï¼š <code>rand</code>ä»3Dè¾“å…¥ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œè€Œ<code>AngleAxis3x3</code>æ¥æ”¶è§’åº¦ï¼ˆä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¼§åº¦ä¸ºå•ä½</a> ï¼‰å¹¶è¿”å›ä¸€ä¸ªçŸ©é˜µï¼Œè¯¥çŸ©é˜µç»•ç€æŒ‡å®šçš„è½´æ—‹è½¬è¯¥å€¼ã€‚ åä¸€ä¸ªå‡½æ•°çš„å·¥ä½œåŸç†ä¸Cï¼ƒ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Quaternion.AngleAxis</a>å‡½æ•°å®Œå…¨ç›¸åŒï¼ˆåªæœ‰<code>AngleAxis3x3</code>è¿”å›ä¸€ä¸ªçŸ©é˜µï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå››å…ƒæ•°ï¼‰ã€‚ <br><br>  <code>rand</code>å‡½æ•°è¿”å›çš„æ•°å­—èŒƒå›´ä¸º0 ... 1ï¼› æˆ‘ä»¬å°†å…¶ä¹˜ä»¥<strong>2 Pi</strong>å³å¯è·å¾—æ•´ä¸ªè§’åº¦å€¼èŒƒå›´ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring the tangentToLocal matrix. float3x3 facingRotationMatrix = AngleAxis3x3(rand(pos) * UNITY_TWO_PI, float3(0, 0, 1));</span></span></code> </pre> <br> æˆ‘ä»¬ä½¿ç”¨ä¼ å…¥çš„<code>pos</code>ä½ç½®ä½œä¸ºéšæœºæ—‹è½¬çš„ç§å­ã€‚ å› æ­¤ï¼Œæ¯ç‰‡è‰å¶éƒ½ä¼šæœ‰è‡ªå·±çš„æ—‹è½¬ï¼Œåœ¨æ¯å¸§ä¸­éƒ½æ˜¯æ’å®šçš„ã€‚ <br><br> é€šè¿‡å°†å…¶ä¹˜ä»¥åˆ›å»ºçš„<code>tangentToLocal</code>çŸ©é˜µï¼Œå¯ä»¥å°†æ—‹è½¬åº”ç”¨äºè‰å¶ã€‚ æ³¨æ„çŸ©é˜µä¹˜æ³•æ˜¯<strong>ä¸å¯</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº¤æ¢çš„</a> ; æ“ä½œæ•°çš„é¡ºåºå¾ˆ<strong>é‡è¦</strong> ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring facingRotationMatrix. float3x3 transformationMatrix = mul(tangentToLocal, facingRotationMatrix); â€¦ // Replace the multiplication matrix operand with our new transformationMatrix. triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(0.5, 0, 0)), float2(0, 0))); triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(-0.5, 0, 0)), float2(1, 0))); triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(0, 0, 1)), float2(0.5, 1)));</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/09f/c2f/e80/09fc2fe8028b51f78989954e65812cd3.png"></div><br><h3>  3.3éšæœºå‘å‰å¼¯æ›² </h3><br> å¦‚æœæ‰€æœ‰è‰å¶éƒ½å®Œå…¨å¯¹é½ï¼Œå®ƒä»¬å°†çœ‹èµ·æ¥ä¸€æ ·ã€‚ è¿™å¯èƒ½é€‚åˆä¿®å‰ªæ•´é½çš„è‰ï¼Œä¾‹å¦‚åœ¨ä¿®å‰ªè¿‡çš„è‰åªä¸Šï¼Œä½†åœ¨è‡ªç„¶ç•Œä¸­ï¼Œè‰ä¸ä¼šåƒè¿™æ ·ç”Ÿé•¿ã€‚ æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„çŸ©é˜µæ¥æ²¿<strong>X</strong>è½´æ—‹è½¬è‰ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå±æ€§æ¥æ§åˆ¶è¯¥æ—‹è½¬ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as a new property. _BendRotationRandom("Bend Rotation Random", Range(0, 1)) = 0.2 â€¦ // Add to the CGINCLUDE block. float _BendRotationRandom; â€¦ // Add to the geometry shader, below the line declaring facingRotationMatrix. float3x3 bendRotationMatrix = AngleAxis3x3(rand(pos.zzx) * _BendRotationRandom * UNITY_PI * 0.5, float3(-1, 0, 0));</span></span></code> </pre> <br> å†æ¬¡ï¼Œæˆ‘ä»¬å°†è‰å¶çš„ä½ç½®ç”¨ä½œéšæœºç§å­ï¼Œè¿™ä¸€æ¬¡æ˜¯é€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰«æ å®ƒ</a>æ¥åˆ›å»ºå”¯ä¸€çš„ç§å­ã€‚ æˆ‘ä»¬è¿˜å°†<code>UNITY_PI</code>ä¹˜ä»¥<strong>0.5</strong> ï¼› è¿™å°†ä½¿æˆ‘ä»¬çš„éšæœºé—´éš”ä¸º0 ... 90åº¦ã€‚ <br><br> æˆ‘ä»¬å†æ¬¡é€šè¿‡æ—‹è½¬åº”ç”¨æ­¤çŸ©é˜µï¼Œä»¥æ­£ç¡®çš„é¡ºåºä¹˜ä»¥æ‰€æœ‰å†…å®¹ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Modify the existing line. float3x3 transformationMatrix = mul(mul(tangentToLocal, facingRotationMatrix), bendRotationMatrix);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49c/122/534/49c122534d7298c0f9c646501a708daa.gif"></div><br><h3>  3.4å®½åº¦å’Œé«˜åº¦ </h3><br> è€Œè‰å¶çš„å¤§å°è¢«é™åˆ¶ä¸º1ä¸ªå•ä½çš„å®½åº¦å’Œ1ä¸ªå•ä½çš„é«˜åº¦ã€‚ æˆ‘ä»¬å°†æ·»åŠ å±æ€§ä»¥æ§åˆ¶å¤§å°ï¼Œå¹¶æ·»åŠ å±æ€§ä»¥æ·»åŠ éšæœºå˜åŒ–ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as new properties. _BladeWidth("Blade Width", Float) = 0.05 _BladeWidthRandom("Blade Width Random", Float) = 0.02 _BladeHeight("Blade Height", Float) = 0.5 _BladeHeightRandom("Blade Height Random", Float) = 0.3 â€¦ // Add to the CGINCLUDE block. float _BladeHeight; float _BladeHeightRandom; float _BladeWidth; float _BladeWidthRandom; â€¦ // Add to the geometry shader, above the triStream.Append calls. float height = (rand(pos.zyx) * 2 - 1) * _BladeHeightRandom + _BladeHeight; float width = (rand(pos.xzy) * 2 - 1) * _BladeWidthRandom + _BladeWidth; â€¦ // Modify the existing positions with our new height and width. triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(width, 0, 0)), float2(0, 0))); triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(-width, 0, 0)), float2(1, 0))); triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(0, 0, height)), float2(0.5, 1)));</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/35b/22e/f34/35b22ef34945a576100a152a0e25eec5.png"></div><br> ä¸‰è§’å½¢ç°åœ¨æ›´åƒè‰å¶ï¼Œä½†ä¹Ÿå¤ªå°‘äº†ã€‚ ä¼ å…¥çš„ç½‘æ ¼ä¸­æ ¹æœ¬æ²¡æœ‰è¶³å¤Ÿçš„å³°å€¼ä»¥äº§ç”Ÿå¯†é›†å¯†é›†çš„åœºçš„å°è±¡ã€‚ <br><br> ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨Cï¼ƒæˆ–åœ¨3Dç¼–è¾‘å™¨ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œæ›´å¯†é›†çš„ç½‘æ ¼ã€‚ è¿™å°†èµ·ä½œç”¨ï¼Œä½†ä¸å…è®¸æˆ‘ä»¬åŠ¨æ€æ§åˆ¶è‰çš„å¯†åº¦ã€‚ ç›¸åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<strong>tessellation</strong>æ‹†åˆ†ä¼ å…¥çš„ç½‘<strong>æ ¼</strong> ã€‚ <br><br><h2>  4.é•¶åµŒ </h2><br>  <strong>ç»†åˆ†</strong>æ˜¯æ¸²æŸ“ç®¡çº¿çš„å¯é€‰é˜¶æ®µï¼Œåœ¨é¡¶ç‚¹ç€è‰²å™¨ä¹‹åå’Œå‡ ä½•ç€è‰²å™¨ï¼ˆå¦‚æœæœ‰ï¼‰ä¹‹å‰æ‰§è¡Œã€‚ å®ƒçš„ä»»åŠ¡æ˜¯å°†ä¸€ä¸ªä¼ å…¥è¡¨é¢ç»†åˆ†ä¸ºè®¸å¤šå›¾å…ƒã€‚ ç»†åˆ†å¯é€šè¿‡ä¸¤ä¸ªå¯ç¼–ç¨‹æ­¥éª¤æ¥å®ç°ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¤–å£³</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŸŸ</a>ç€è‰²å™¨ã€‚ <br><br> å¯¹äºè¡¨é¢ç€è‰²å™¨ï¼ŒUnityå…·æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†…ç½®çš„é•¶åµŒå®ç°</a> ã€‚ ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬<strong>ä¸ä½¿ç”¨</strong>è¡¨é¢ç€è‰²å™¨ï¼Œå› æ­¤å¿…é¡»å®ç°è‡ªå·±çš„å¤–å£³ç€è‰²å™¨å’ŒåŸŸç€è‰²å™¨ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ä¸è¯¦ç»†è®¨è®ºé•¶åµŒçš„å®ç°ï¼Œè€Œä»…ä½¿ç”¨ç°æœ‰çš„<code>CustomTessellation.cginc</code>æ–‡ä»¶ã€‚ è¯¥æ–‡ä»¶æ”¹ç¼–è‡ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Catlike Codingæ–‡ç« </a> ï¼Œè¯¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« </a>æ˜¯æœ‰å…³Unityä¸­ç»†åˆ†å®ç°çš„æå¥½ä¿¡æ¯æ¥æºã€‚ <br><br> å¦‚æœåœ¨åœºæ™¯ä¸­åŒ…å«<code>TessellationExample</code>å¯¹è±¡ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å®ƒå·²ç»å…·æœ‰å®ç°é•¶åµŒç»†åˆ†çš„æè´¨ã€‚ æ›´æ”¹â€œ <strong>é•¶åµŒç»†åˆ†ç»Ÿä¸€â€</strong>å±æ€§å¯æ¼”ç¤ºç»†åˆ†æ•ˆæœã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d8/8a7/f01/2d88a7f01e3a7462ffd0c8f20953b5ca.gif"></div><br> æˆ‘ä»¬åœ¨è‰ç€è‰²å™¨ä¸­å®ç°äº†ç»†åˆ†ï¼Œä»¥æ§åˆ¶å¹³é¢çš„å¯†åº¦ï¼Œä»è€Œæ§åˆ¶ç”Ÿæˆçš„è‰å¶ç‰‡çš„æ•°é‡ã€‚ é¦–å…ˆï¼Œæ‚¨éœ€è¦æ·»åŠ <code>CustomTessellation.cginc</code>æ–‡ä»¶ã€‚ æˆ‘ä»¬å°†é€šè¿‡å…¶åˆ°ç€è‰²å™¨çš„<em>ç›¸å¯¹</em>è·¯å¾„æ¥å¼•ç”¨å®ƒã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add inside the CGINCLUDE block, below the other #include statements. #include "Shaders/CustomTessellation.cginc"</span></span></code> </pre> <br> å¦‚æœæ‰“å¼€<code>CustomTessellation.cginc</code> ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°å·²ç»åœ¨å…¶ä¸­å®šä¹‰äº†<code>vertexInput</code>å’Œ<code>vertexOutput</code>ä»¥åŠé¡¶ç‚¹ç€è‰²å™¨ã€‚ æ— éœ€åœ¨æˆ‘ä»¬çš„è‰ç€è‰²å™¨ä¸­é‡æ–°å®šä¹‰å®ƒä»¬ï¼› å®ƒä»¬å¯ä»¥è¢«åˆ é™¤ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*struct vertexInput { float4 vertex : POSITION; float3 normal : NORMAL; float4 tangent : TANGENT; }; struct vertexOutput { float4 vertex : SV_POSITION; float3 normal : NORMAL; float4 tangent : TANGENT; }; vertexOutput vert(vertexInput v) { vertexOutput o; o.vertex = v.vertex; o.normal = v.normal; o.tangent = v.tangent; return o; }*/</span></span></code> </pre> <br> è¯·æ³¨æ„ï¼Œ <code>CustomTessellation.cginc</code>é¡¶ç‚¹ç€è‰²å™¨åªæ˜¯å°†è¾“å…¥ç›´æ¥ä¼ é€’ç»™ç»†åˆ†é˜¶æ®µï¼› åœ¨åŸŸç€è‰²å™¨å†…éƒ¨è°ƒç”¨çš„<code>vertexOutput</code>å‡½æ•°æ‰¿æ‹…åˆ›å»º<code>vertexOutput</code>ç»“æ„çš„ä»»åŠ¡ã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†<strong>å¤–å£³</strong>å’Œ<strong>åŸŸ</strong>ç€è‰²å™¨æ·»åŠ åˆ°è‰ç€è‰²å™¨ä¸­ã€‚ æˆ‘ä»¬è¿˜å°†æ·»åŠ ä¸€ä¸ªæ–°çš„<code>_TessellationUniform</code>å±æ€§ä»¥æ§åˆ¶å•ä½å¤§å°-ä¸æ­¤å±æ€§ç›¸å¯¹åº”çš„å˜é‡å·²ç»åœ¨<code>CustomTessellation.cginc</code>å£°æ˜ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as a new property. _TessellationUniform("Tessellation Uniform", Range(1, 64)) = 1 â€¦ // Add below the other #pragma statements in the SubShader Pass. #pragma hull hull #pragma domain domain</span></span></code> </pre> <br> ç°åœ¨ï¼Œæ›´æ”¹<strong>Tessellation Uniform</strong>å±æ€§å¯ä»¥æ§åˆ¶è‰çš„å¯†åº¦ã€‚ æˆ‘å‘ç°ä»¥<strong>5</strong>çš„å€¼å¯è·å¾—è‰¯å¥½çš„ç»“æœã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/280/d93/c14/280d93c1420a9744bd56f2d2496f96ab.gif"></div><br><h2>  5.é£ </h2><br> æˆ‘ä»¬é€šè¿‡é‡‡æ ·<strong>å˜å½¢çº¹ç†æ¥</strong>å®ç°é£ã€‚ è¯¥çº¹ç†çœ‹èµ·æ¥å°±åƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ³•çº¿è´´å›¾</a> ï¼Œä»…å…¶ä¸­åªæœ‰ä¸¤ä¸ªè€Œä¸æ˜¯ä¸‰ä¸ªé€šé“ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸¤ä¸ªé€šé“ä½œä¸ºæ²¿<strong>X</strong>å’Œ<strong>Yçš„</strong>é£å‘ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a58/aaa/687/a58aaa68742934ff1bddf1cbaf9564f5.png"></div><br> åœ¨é‡‡æ ·é£çº¹ç†ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªUVåæ ‡ã€‚ ä»£æ›¿ä½¿ç”¨åˆ†é…ç»™ç½‘æ ¼çš„çº¹ç†åæ ‡ï¼Œæˆ‘ä»¬åº”ç”¨è¾“å…¥ç‚¹çš„ä½ç½®ã€‚ å› æ­¤ï¼Œå¦‚æœä¸–ç•Œä¸Šæœ‰å¤šä¸ªè‰ç½‘ï¼Œå°±ä¼šäº§ç”Ÿä¸€ç§å¹»æƒ³ï¼Œå³å®ƒä»¬éƒ½å±äºåŒä¸€é£åŠ›ç³»ç»Ÿã€‚ æˆ‘ä»¬è¿˜ä½¿ç”¨<code>_Time</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">shaderå†…ç½®å˜é‡</a>åœ¨è‰è¡¨é¢ä¸Šæ»šåŠ¨é£çº¹ç†ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as new properties. _WindDistortionMap("Wind Distortion Map", 2D) = "white" {} _WindFrequency("Wind Frequency", Vector) = (0.05, 0.05, 0, 0) â€¦ // Add to the CGINCLUDE block. sampler2D _WindDistortionMap; float4 _WindDistortionMap_ST; float2 _WindFrequency; â€¦ // Add to the geometry shader, just above the line declaring the transformationMatrix. float2 uv = pos.xz * _WindDistortionMap_ST.xy + _WindDistortionMap_ST.zw + _WindFrequency * _Time.y;</span></span></code> </pre> <br> æˆ‘ä»¬å°†<code>_WindDistortionMap</code>çš„æ¯”ä¾‹å°ºå’Œåç§»é‡åº”ç”¨äºè¯¥ä½ç½®ï¼Œç„¶åå°†å…¶è¿›ä¸€æ­¥ç§»è‡³<code>_Time.y</code> ï¼Œå¹¶ç¼©æ”¾è‡³<code>_WindFrequency</code> ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™äº›UVæ¥é‡‡æ ·çº¹ç†å¹¶åˆ›å»ºä¸€ä¸ªå±æ€§æ¥æ§åˆ¶é£çš„å¼ºåº¦ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as a new property. _WindStrength("Wind Strength", Float) = 1 â€¦ // Add to the CGINCLUDE block. float _WindStrength; â€¦ // Add below the line declaring float2 uv. float2 windSample = (tex2Dlod(_WindDistortionMap, float4(uv, 0, 0)).xy * 2 - 1) * _WindStrength;</span></span></code> </pre> <br> è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å°†é‡‡æ ·å€¼ä»çº¹ç†ä»0 ... 1é—´éš”ç¼©æ”¾åˆ°-1 ... 1é—´éš”ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºè¡¨ç¤ºé£å‘çš„å½’ä¸€åŒ–çŸ¢é‡ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring float2 windSample. float3 wind = normalize(float3(windSample.x, windSample.y, 0));</span></span></code> </pre> <br> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªçŸ©é˜µæ¥å›´ç»•æ­¤å‘é‡æ—‹è½¬ï¼Œå¹¶å°†å…¶ä¹˜ä»¥æˆ‘ä»¬çš„<code>transformationMatrix</code> ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring float3 wind. float3x3 windRotation = AngleAxis3x3(UNITY_PI * windSample, wind); â€¦ // Modify the existing line. float3x3 transformationMatrix = mul(mul(mul(tangentToLocal, windRotation), facingRotationMatrix), bendRotationMatrix);</span></span></code> </pre> <br> æœ€åï¼Œæˆ‘ä»¬åœ¨Unityç¼–è¾‘å™¨ä¸­å°†â€œ <code>Wind</code>çº¹ç†ï¼ˆä½äºé¡¹ç›®çš„æ ¹ï¼‰ä¼ è¾“åˆ°è‰æè´¨çš„â€œ <strong>é£æ‰­æ›²è´´å›¾â€</strong>å­—æ®µã€‚ æˆ‘ä»¬è¿˜å°†çº¹ç†çš„â€œ <strong>å¹³é“ºâ€</strong>å‚æ•°è®¾ç½®ä¸º<code>0.01, 0.01</code> ã€‚ <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> å¦‚æœè‰æ²¡æœ‰åœ¨â€œ <strong>åœºæ™¯â€</strong>çª—å£ä¸­è®¾ç½®åŠ¨ç”»ï¼Œåˆ™å•å‡»â€œ <strong>åˆ‡æ¢å¤©ç©ºç›’â€ï¼Œâ€œé›¾â€å’Œå…¶ä»–å„ç§æ•ˆæœ</strong>æŒ‰é’®ä»¥å¯ç”¨åŠ¨ç”»æè´¨ã€‚ <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä»è¿œå¤„çœ‹ï¼Œè‰çœ‹ä¸Šå»æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä»”ç»†è§‚å¯Ÿè‰å¶ç‰‡ï¼Œå°±ä¼šæ³¨æ„åˆ°æ•´ä¸ªè‰å¶ç‰‡éƒ½åœ¨è½¬åŠ¨ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåŸºéƒ¨ä¸å†é™„ç€åœ¨åœ°é¢ä¸Šçš„åŸå› ã€‚ </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e9/148/51e/6e914851e888c448c30080a7abefae33.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è‰å¶çš„æ ¹éƒ¨ä¸å†é™„ç€åœ¨åœ°é¢ä¸Šï¼Œè€Œæ˜¯ä¸åœ°é¢ç›¸äº¤ï¼ˆä»¥</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº¢è‰²æ˜¾ç¤º</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼‰ï¼Œå¹¶å‚æ‚¬åœ¨åœ°é¢çš„ä¸Šæ–¹ï¼ˆä»¥</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»¿</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº¿</font><font style="vertical-align: inherit;">è¡¨ç¤º</font><font style="vertical-align: inherit;">ï¼‰ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†é€šè¿‡å®šä¹‰ç¬¬äºŒä¸ªå˜æ¢çŸ©é˜µæ¥è§£å†³æ­¤é—®é¢˜ï¼Œè¯¥å˜æ¢çŸ©é˜µä»…é€‚ç”¨äºåŸºç¡€çš„ä¸¤ä¸ªé¡¶ç‚¹ã€‚</font><font style="vertical-align: inherit;">åœ¨è¯¥çŸ©é˜µ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ä¸è¢«</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒ…æ‹¬åŸºè´¨</font></font><code>windRotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><code>bendRotationMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç”±äºå…¶ä¸­åº•åº§é™„æ¥åˆ°è‰è¡¨é¢ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring float3x3 transformationMatrix. float3x3 transformationMatrixFacing = mul(tangentToLocal, facingRotationMatrix); â€¦ // Modify the existing lines outputting the base vertex positions. triStream.Append(VertexOutput(pos + mul(transformationMatrixFacing, float3(width, 0, 0)), float2(0, 0))); triStream.Append(VertexOutput(pos + mul(transformationMatrixFacing, float3(-width, 0, 0)), float2(1, 0)));</span></span></code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6.å¶ç‰‡çš„æ›²ç‡ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œå•ä¸ªè‰å¶ç”±ä¸€ä¸ªä¸‰è§’å½¢å®šä¹‰ã€‚åœ¨è¿œè·ç¦»ï¼Œè¿™ä¸æ˜¯é—®é¢˜ï¼Œä½†æ˜¯åœ¨è‰å¶é™„è¿‘ï¼Œå®ƒä»¬çœ‹èµ·æ¥éå¸¸åƒµç¡¬å’Œå‡ ä½•å½¢çŠ¶ï¼Œè€Œä¸æ˜¯æœ‰æœºçš„å’Œç”ŸåŠ¨çš„ã€‚æˆ‘ä»¬å°†é€šè¿‡ä»å‡ ä¸ªä¸‰è§’å½¢æ„å»ºè‰å¶å¹¶å°†å®ƒä»¬æ²¿</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ›²çº¿</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¼¯æ›²æ¥è§£å†³æ­¤é—®é¢˜</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¯ç‰‡è‰è¢«åˆ†æˆ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡ æ®µ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æ¯ä¸ªç‰‡æ®µå°†å…·æœ‰çŸ©å½¢å½¢çŠ¶ï¼Œå¹¶ä¸”ç”±ä¸¤ä¸ªä¸‰è§’å½¢ç»„æˆï¼Œé™¤äº†ä¸Šé¢çš„ç‰‡æ®µä»¥å¤–-å®ƒæ˜¯ä¸€ä¸ªä¸‰è§’å½¢ï¼Œè¡¨ç¤ºè‰å¶çš„å°–ç«¯ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»…ç»˜åˆ¶äº†ä¸‰ä¸ªé¡¶ç‚¹ï¼Œåˆ›å»ºäº†ä¸€ä¸ªä¸‰è§’å½¢ã€‚é‚£ä¹ˆï¼Œå¦‚æœæœ‰æ›´å¤šçš„é¡¶ç‚¹ï¼Œå‡ ä½•ç€è‰²å™¨å¦‚ä½•çŸ¥é“éœ€è¦è¿æ¥å“ªäº›é¡¶ç‚¹å¹¶å½¢æˆä¸‰è§’å½¢ï¼Ÿç­”æ¡ˆåœ¨äºæ•°æ®ç»“æ„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸‰è§’å¸¦</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å‰ä¸‰ä¸ªé¡¶ç‚¹è¿æ¥å¹¶å½¢æˆä¸‰è§’å½¢ï¼Œæ¯ä¸ªæ–°é¡¶ç‚¹ä¸å‰ä¸¤ä¸ªé¡¶ç‚¹å½¢æˆä¸‰è§’å½¢ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/871/8ec/676/8718ec676d7efd819718bd25d5b27b54.gif"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç»†åˆ†çš„è‰å¶ï¼Œä»¥ä¸‰è§’å½¢å¸¦è¡¨ç¤ºï¼Œä¸€æ¬¡åˆ›å»ºä¸€ä¸ªé¡¶ç‚¹ã€‚åœ¨å‰ä¸‰ä¸ªé¡¶ç‚¹ä¹‹åï¼Œæ¯ä¸ªæ–°é¡¶ç‚¹ä¸å‰ä¸¤ä¸ªé¡¶ç‚¹å½¢æˆä¸€ä¸ªæ–°ä¸‰è§’å½¢ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™ä¸ä»…åœ¨å†…å­˜ä½¿ç”¨æ–¹é¢æ›´åŠ é«˜æ•ˆï¼Œè€Œä¸”è¿˜ä½¿æ‚¨å¯ä»¥è½»æ¾ï¼Œå¿«é€Ÿåœ°åœ¨ä»£ç ä¸­åˆ›å»ºä¸‰è§’å½¢åºåˆ—ã€‚å¦‚æœæˆ‘ä»¬è¦åˆ›å»ºå‡ ä¸ªä¸‰è§’å½¢çš„æ¡çº¹ï¼Œå¯ä»¥ä¸º</font></font><code>TriangleStream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å‡½æ•°</font><font style="vertical-align: inherit;">è°ƒç”¨</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RestartStrip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æˆ‘ä»¬å¼€å§‹ä»å‡ ä½•ç€è‰²å™¨ç»˜åˆ¶æ›´å¤šé¡¶ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ å®ƒ</font></font><code>maxvertexcount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¯¥è®¾è®¡</font></font><code>#define</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å…è®¸ç€è‰²å™¨ä½œè€…æ§åˆ¶çº¿æ®µçš„æ•°é‡ï¼Œå¹¶ä»ä¸­è®¡ç®—æ˜¾ç¤ºçš„é¡¶ç‚¹æ•°é‡ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the CGINCLUDE block. #define BLADE_SEGMENTS 3 â€¦ // Modify the existing line defining the maxvertexcount. [maxvertexcount(BLADE_SEGMENTS * 2 + 1)]</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åˆï¼Œæˆ‘ä»¬å°†çº¿æ®µæ•°è®¾ç½®ä¸º</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3ï¼Œ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç„¶å</font><font style="vertical-align: inherit;">æ ¹æ®çº¿æ®µæ•°è¿›è¡Œ</font><font style="vertical-align: inherit;">æ›´æ–°</font></font><code>maxvertexcount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥è®¡ç®—é¡¶ç‚¹æ•°ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦åˆ›å»ºåˆ†æ®µçš„è‰å¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå¾ªç¯</font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å¾ªç¯çš„æ¯æ¬¡è¿­ä»£éƒ½å°†æ·»åŠ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸¤ä¸ªé¡¶ç‚¹</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼š</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">left</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">right</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚å®Œæˆå°–ç«¯åï¼Œæˆ‘ä»¬å°†æœ€åä¸€ä¸ªé¡¶ç‚¹æ·»åŠ åˆ°è‰å¶çš„å°–ç«¯ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ‰§è¡Œæ­¤æ“ä½œä¹‹å‰ï¼Œå°†ä»£ç çš„è‰å¶é¡¶ç‚¹çš„éƒ¨åˆ†è®¡ç®—ä½ç½®ç§»å…¥å‡½æ•°ä¸­å°†å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨å¾ªç¯å†…å¤–å¤šæ¬¡ä½¿ç”¨æ­¤ä»£ç ã€‚å°†</font></font><code>CGINCLUDE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¸‹å†…å®¹</font><font style="vertical-align: inherit;">æ·»åŠ åˆ°å—ä¸­</font><font style="vertical-align: inherit;">ï¼š</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">geometryOutput </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateGrassVertex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float3 vertexPosition, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, float2 uv, float3x3 transformMatrix)</span></span></span><span class="hljs-function"> </span></span>{ float3 tangentPoint = float3(width, <span class="hljs-number"><span class="hljs-number">0</span></span>, height); float3 localPosition = vertexPosition + mul(transformMatrix, tangentPoint); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> VertexOutput(localPosition, uv); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥å‡½æ•°æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼Œå› ä¸ºå®ƒä¼ é€’äº†æˆ‘ä»¬å…ˆå‰ä¼ é€’çš„å‚æ•°</font></font><code>VertexOutput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ç”Ÿæˆè‰å¶çš„é¡¶ç‚¹ã€‚</font><font style="vertical-align: inherit;">è·å¾—ä½ç½®ï¼Œé«˜åº¦å’Œå®½åº¦åï¼Œå®ƒå°†ä½¿ç”¨ä¼ è¾“çš„çŸ©é˜µæ­£ç¡®åœ°å˜æ¢é¡¶ç‚¹å¹¶ä¸ºå…¶åˆ†é…UVåæ ‡ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ›´æ–°ç°æœ‰ä»£ç ä»¥ä½¿è¯¥åŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Update the existing code outputting the vertices. triStream.Append(GenerateGrassVertex(pos, width, 0, float2(0, 0), transformationMatrixFacing)); triStream.Append(GenerateGrassVertex(pos, -width, 0, float2(1, 0), transformationMatrixFacing)); triStream.Append(GenerateGrassVertex(pos, 0, height, float2(0.5, 1), transformationMatrix));</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥å‡½æ•°å¼€å§‹æ­£ç¡®è¿è¡Œï¼Œå¹¶ä¸”æˆ‘ä»¬å‡†å¤‡å°†é¡¶ç‚¹ç”Ÿæˆä»£ç ç§»å…¥å¾ªç¯</font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨æ­¤è¡Œä¸‹æ·»åŠ </font></font><code>float width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¸‹å†…å®¹ï¼š</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; BLADE_SEGMENTS; i++) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t = i / (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)BLADE_SEGMENTS; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å®£å¸ƒä¸€ä¸ªå¾ªç¯ï¼Œè¯¥å¾ªç¯å°†é’ˆå¯¹æ¯ä¸ªè‰å¶ç‰‡æ®µè¿è¡Œä¸€æ¬¡ã€‚</font><font style="vertical-align: inherit;">åœ¨å¾ªç¯å†…éƒ¨ï¼Œæ·»åŠ ä¸€ä¸ªå˜é‡</font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ­¤å˜é‡å°†å­˜å‚¨ä¸€ä¸ªä»‹äº0 ... 1ä¹‹é—´çš„å€¼ï¼ŒæŒ‡ç¤ºæˆ‘ä»¬æ²¿ç€è‰å¶ç§»åŠ¨äº†å¤šè¿œã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä½¿ç”¨æ­¤å€¼åœ¨å¾ªç¯çš„æ¯æ¬¡è¿­ä»£ä¸­è®¡ç®—æ®µçš„å®½åº¦å’Œé«˜åº¦ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring float t. float segmentHeight = height * t; float segmentWidth = width * (1 - t);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“å‘ä¸Šç§»åŠ¨ä¸€ç‰‡è‰æ—¶ï¼Œé«˜åº¦å¢åŠ è€Œå®½åº¦å‡å°ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†è°ƒç”¨æ·»åŠ åˆ°å¾ªç¯ä¸­ï¼Œ</font></font><code>GenerateGrassVertex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥å°†é¡¶ç‚¹æ·»åŠ åˆ°ä¸‰è§’å½¢æµä¸­ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜å°†</font></font><code>GenerateGrassVertex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨å¾ªç¯å¤–éƒ¨</font><font style="vertical-align: inherit;">æ·»åŠ ä¸€ä¸ªè°ƒç”¨</font><font style="vertical-align: inherit;">ï¼Œä»¥åˆ›å»ºè‰å°–ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring float segmentWidth. float3x3 transformMatrix = i == 0 ? transformationMatrixFacing : transformationMatrix; triStream.Append(GenerateGrassVertex(pos, segmentWidth, segmentHeight, float2(0, t), transformMatrix)); triStream.Append(GenerateGrassVertex(pos, -segmentWidth, segmentHeight, float2(1, t), transformMatrix)); â€¦ // Add just below the loop to insert the vertex at the tip of the blade. triStream.Append(GenerateGrassVertex(pos, 0, height, float2(0.5, 1), transformationMatrix)); â€¦ // Remove the existing calls to triStream.Append. //triStream.Append(GenerateGrassVertex(pos, width, 0, float2(0, 0), transformationMatrixFacing)); //triStream.Append(GenerateGrassVertex(pos, -width, 0, float2(1, 0), transformationMatrixFacing)); //triStream.Append(GenerateGrassVertex(pos, 0, height, float2(0.5, 1), transformationMatrix));</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çœ‹ä¸€ä¸‹å¸¦æœ‰å£°æ˜çš„è¡Œ</font></font><code>float3x3 transformMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©ä¸¤ä¸ªè½¬æ¢çŸ©é˜µä¹‹ä¸€ï¼šæˆ‘ä»¬å–</font></font><code>transformationMatrixFacing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŸºçš„é¡¶ç‚¹å’Œ</font></font><code>transformationMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ‰€æœ‰å…¶ä»–</font><font style="vertical-align: inherit;">çš„é¡¶ç‚¹</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02b/211/61c/02b21161cd4afc0cca35ae71ffe2570e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¦‚ä»Šï¼Œè‰å¶åˆ†ä¸ºè®¸å¤šéƒ¨åˆ†ï¼Œä½†è‰å¶è¡¨é¢ä»ç„¶å¹³å¦-å°šæœªæ¶‰åŠæ–°çš„ä¸‰è§’å½¢ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†æ·»åŠ è‰æ›²ç‡çš„å¶ç‰‡ï¼Œè½¬ç§»çš„é¡¶ç‚¹çš„ä½ç½®</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨Y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹å‡½æ•°</font></font><code>GenerateGrassVertex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œä½¿å…¶åœ¨</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yä¸­</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰ä¸€ä¸ªåç§»é‡</font><font style="vertical-align: inherit;">ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸º</font></font><code>forward</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Update the function signature of GenerateGrassVertex. geometryOutput GenerateGrassVertex(float3 vertexPosition, float width, float height, float forward, float2 uv, float3x3 transformMatrix) â€¦ // Modify the Y coordinate assignment of tangentPoint. float3 tangentPoint = float3(width, forward, height);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºäº†è®¡ç®—æ¯ä¸ªé¡¶ç‚¹çš„ä½ç§»ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ª</font></font><code>pow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å€¼ä»£</font><font style="vertical-align: inherit;">å…¥å‡½æ•°ä¸­</font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æé«˜</font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŠŸç‡åï¼Œå…¶å¯¹å‰ç§»çš„å½±å“å°†æ˜¯</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">éçº¿æ€§çš„ï¼Œ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¹¶å°†è‰å¶å˜æˆæ›²çº¿ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as new properties. _BladeForward("Blade Forward Amount", Float) = 0.38 _BladeCurve("Blade Curvature Amount", Range(1, 4)) = 2 â€¦ // Add to the CGINCLUDE block. float _BladeForward; float _BladeCurve; â€¦ // Add inside the geometry shader, below the line declaring float width. float forward = rand(pos.yyz) * _BladeForward; â€¦ // Add inside the loop, below the line declaring segmentWidth. float segmentForward = pow(t, _BladeCurve) * forward; â€¦ // Modify the GenerateGrassVertex calls inside the loop. triStream.Append(GenerateGrassVertex(pos, segmentWidth, segmentHeight, segmentForward, float2(0, t), transformMatrix)); triStream.Append(GenerateGrassVertex(pos, -segmentWidth, segmentHeight, segmentForward, float2(1, t), transformMatrix)); â€¦ // Modify the GenerateGrassVertex calls outside the loop. triStream.Append(GenerateGrassVertex(pos, 0, height, forward, float2(0.5, 1), transformationMatrix));</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿™æ˜¯ä¸€æ®µç›¸å½“å¤§çš„ä»£ç ï¼Œä½†æ˜¯æ‰€æœ‰å·¥ä½œéƒ½ä¸è‰å¶çš„å®½åº¦å’Œé«˜åº¦ç±»ä¼¼ã€‚</font><font style="vertical-align: inherit;">åœ¨è¾ƒä½å€¼</font></font><code>_BladeForward</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå¹¶ä¸”</font></font><code>_BladeCurve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªæœ‰åºï¼Œæ•´é½å¹²å‡€çš„è‰åªï¼Œå’Œæ›´å¤§çš„ä»·å€¼å°†ç»™äºˆç›¸åçš„æ•ˆæœã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c1f/cbc/e43/c1fcbce43fa5e1c1be319dc1f5190f3d.png"></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7.ç¯å…‰å’Œé˜´å½± </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½œä¸ºå®Œæˆç€è‰²å™¨çš„æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬å°†æ·»åŠ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŠ•å°„</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å’Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ¥æ”¶</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é˜´å½±çš„åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬è¿˜å°†ä»ä¸»è¦çš„å®šå‘å…‰æºä¸­æ·»åŠ ç®€å•çš„ç…§æ˜ã€‚</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7.1æŠ•å°„é˜´å½± </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¦åœ¨Unityä¸­æŠ•å°„é˜´å½±ï¼Œæ‚¨éœ€è¦å‘ç€è‰²å™¨æ·»åŠ ç¬¬äºŒéã€‚åœºæ™¯ä¸­åˆ›å»ºé˜´å½±çš„å…‰æºå°†ä½¿ç”¨æ­¤é€šé“ï¼Œä»¥å°†è‰çš„æ·±åº¦æ¸²æŸ“åˆ°å…¶</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é˜´å½±è´´å›¾ä¸­</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚è¿™æ„å‘³ç€å¿…é¡»åœ¨é˜´å½±é€šé“ä¸­å¯åŠ¨å‡ ä½•ç€è‰²å™¨ï¼Œä»¥ä¾¿è‰å¶å¯ä»¥æŠ•å°„é˜´å½±ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºå‡ ä½•ç€è‰²å™¨æ˜¯å†™åœ¨å—å†…éƒ¨çš„</font></font><code>CGINCLUDE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æ–‡ä»¶çš„ä»»ä½•ä¼ é€’ä¸­ä½¿ç”¨å®ƒã€‚åˆ›å»ºç¬¬äºŒéï¼Œè¯¥éå°†ä½¿ç”¨ä¸ç¬¬ä¸€éç›¸åŒçš„ç€è‰²å™¨ï¼Œä½†ç‰‡æ®µç€è‰²å™¨é™¤å¤–-æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªæ–°éï¼Œå¹¶åœ¨å…¶ä¸­ç¼–å†™ä¸€ä¸ªç”¨äºå¤„ç†è¾“å‡ºçš„å®ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the existing Pass. Pass { Tags { "LightMode" = "ShadowCaster" } CGPROGRAM #pragma vertex vert #pragma geometry geo #pragma fragment frag #pragma hull hull #pragma domain domain #pragma target 4.6 #pragma multi_compile_shadowcaster float4 frag(geometryOutput i) : SV_Target { SHADOW_CASTER_FRAGMENT(i) } ENDCG }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é™¤äº†åˆ›å»ºæ–°çš„ç‰‡æ®µç€è‰²å™¨ä¹‹å¤–ï¼Œè¿™æ®µä»£ç è¿˜æœ‰ä¸€äº›é‡è¦çš„åŒºåˆ«ã€‚</font><font style="vertical-align: inherit;">æ ‡ç­¾</font></font><code>LightMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ‰å€¼</font></font><code>ShadowCaster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª</font></font><code>ForwardBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-å®ƒè¯´çš„ç»Ÿä¸€ï¼Œè¿™æ®µè¯åº”è¯¥ç”¨æ¥æ¸²æŸ“é˜´å½±è´´å›¾çš„å¯¹è±¡ã€‚</font><font style="vertical-align: inherit;">è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé¢„å¤„ç†å™¨æŒ‡ä»¤</font></font><code>multi_compile_shadowcaster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒå¯ä»¥ç¡®ä¿ç€è‰²å™¨ç¼–è¯‘æŠ•å°„é˜´å½±æ‰€éœ€çš„æ‰€æœ‰å¿…è¦é€‰é¡¹ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½¿æ¸¸æˆå¯¹è±¡</font><font style="vertical-align: inherit;">åœ¨åœºæ™¯ä¸­</font></font><code>Fence</code> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤„äºæ´»åŠ¨çŠ¶æ€</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼›</font><font style="vertical-align: inherit;">å› æ­¤æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªè¡¨é¢ï¼Œè‰å¶å¯ä»¥åœ¨å…¶ä¸ŠæŠ•å°„é˜´å½±ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c57/640/6cf/c576406cf284fe41e4b04d8af264d96e.png"></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7.2è·å–é˜´å½± </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unityä»åˆ›å»ºé˜´å½±çš„å…‰æºçš„è§’åº¦æ¸²æŸ“é˜´å½±è´´å›¾åï¼Œä¼šå¯åŠ¨ä¸€ä¸ªé€šé“ï¼Œå°†é˜´å½±â€œæ”¶é›†â€åˆ°</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å±å¹•ç©ºé—´</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„çº¹ç†ä¸­</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">è¦å¯¹è¯¥çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œæˆ‘ä»¬å°†éœ€è¦è®¡ç®—å±å¹•ç©ºé—´ä¸­é¡¶ç‚¹çš„ä½ç½®ï¼Œå¹¶å°†å…¶è½¬ç§»åˆ°ç‰‡æ®µç€è‰²å™¨ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the geometryOutput struct. unityShadowCoord4 _ShadowCoord : TEXCOORD1; â€¦ // Add to the VertexOutput function, just above the return call. o._ShadowCoord = ComputeScreenPos(o.pos);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æ®µè½çš„ç‰‡æ®µç€è‰²å™¨ä¸­ï¼Œ</font></font><code>ForwardBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®æ¥è·å–ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼</font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æŒ‡ç¤ºæ›²é¢æ˜¯å¦åœ¨é˜´å½±ä¸­ã€‚</font><font style="vertical-align: inherit;">æ­¤å€¼çš„èŒƒå›´æ˜¯0 ... 1ï¼Œå…¶ä¸­0æ˜¯å®Œå…¨é˜´å½±ï¼Œ1æ˜¯å®Œå…¨ç…§æ˜ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆå±å¹•ç©ºé—´çš„UVåæ ‡ç§°ä¸º_ShadowCoordï¼Ÿ</font><font style="vertical-align: inherit;">è¿™ä¸ç¬¦åˆä»¥å‰çš„å‘½åçº¦å®šã€‚</font></font></b> <div class="spoiler_text">    Unity           (       ).          <code>SHADOW_ATTENUATION</code> .         <code>Autolight.cginc</code> ,  ,       . <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SHADOW_ATTENUATION(a) unitySampleShadow(a._ShadowCoord)</span></span></code> </pre> <br>              -    ,            . </div></div><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the ForwardBase pass's fragment shader, replacing the existing return call. return SHADOW_ATTENUATION(i); //return lerp(_BottomColor, _TopColor, i.uv.y);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œæˆ‘ä»¬éœ€è¦å°†ç€è‰²å™¨æ­£ç¡®é…ç½®ä¸ºæ¥æ”¶é˜´å½±ã€‚</font><font style="vertical-align: inherit;">ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨</font></font><code>ForwardBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">é¢„å¤„ç†è¿‡ç¨‹ä¸­</font><font style="vertical-align: inherit;">æ·»åŠ </font><font style="vertical-align: inherit;">é¢„å¤„ç†å™¨æŒ‡ä»¤</font><font style="vertical-align: inherit;">ï¼Œ</font><font style="vertical-align: inherit;">ä»¥ä¾¿ç¼–è¯‘æ‰€æœ‰å¿…éœ€çš„ç€è‰²å™¨é€‰é¡¹ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the ForwardBase pass's preprocessor directives, below #pragma target 4.6. #pragma multi_compile_fwdbase</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90a/491/468/90a491468a1ad129d35bea03b0b51898.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ç›¸æœºæ‹‰è¿‘åï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°è‰å¶è¡¨é¢ä¸Šçš„ä¼ªå½±ã€‚</font><font style="vertical-align: inherit;">å®ƒä»¬æ˜¯ç”±å•ä¸ªè‰å¶åœ¨è‡ªå·±èº«ä¸ŠæŠ•å°„é˜´å½±çš„äº‹å®å¼•èµ·çš„ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å¯ä»¥é€šè¿‡</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çº¿æ€§ç§»åŠ¨</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ–å°†æˆªæ–­ç©ºé—´ä¸­çš„é¡¶ç‚¹ä½ç½®ç¨å¾®è¿œç¦»å±å¹•</font><font style="vertical-align: inherit;">æ¥è§£å†³æ­¤é—®é¢˜</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä¸ºæ­¤ä½¿ç”¨Unityå®ï¼Œå¹¶å°†å…¶åŒ…å«åœ¨è®¾è®¡ä¸­ï¼Œ</font></font><code>#if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥ä¾¿ä»…åœ¨é˜´å½±è·¯å¾„ä¸­æ‰§è¡Œæ“ä½œã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add at the end of the VertexOutput function, just above the return call. #if UNITY_PASS_SHADOWCASTER // Applying the bias prevents artifacts from appearing on the surface. o.pos = UnityApplyLinearShadowBias(o.pos); #endif</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dca/ec0/d88/dcaec0d88eea1893b6a07eb45724a0b6.gif"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åº”ç”¨çº¿æ€§é˜´å½±åç§»åï¼Œæ¡çº¹å½¢å¼çš„é˜´å½±ä¼ªå½±å°†ä»ä¸‰è§’å½¢çš„è¡¨é¢æ¶ˆå¤±ã€‚</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸ºä»€ä¹ˆåœ¨é˜´å½±çš„è‰å¶è¾¹ç¼˜ä¼šå‡ºç°ä¼ªå½±ï¼Ÿ</font></font></b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08a/12e/af1/08a12eaf1af17fc9b35de7d07a64afca.png"></div><br>      (multisample anti-aliasing <strong>MSAA</strong> ) Unity <em> </em>     ,        .        ,  . <br><br>    â€”  ,    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  Unity</a> .      (     );     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    Unity</a> . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7.3ç…§æ˜ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä½¿ç”¨éå¸¸ç®€å•ä¸”å¸¸è§çš„æ¼«å°„ç…§æ˜è®¡ç®—ç®—æ³•æ¥å®ç°ç…§æ˜ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/404/3ae/452/4043ae452046c0b4b405aa88afe8d2b7.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...ï¼Œå…¶ä¸­</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯è¡¨é¢çš„æ³•çº¿ï¼Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯ä¸»è¦æ–¹å‘ç…§æ˜çš„æ ‡å‡†åŒ–æ–¹å‘ï¼Œ</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯è®¡ç®—å‡ºçš„ç…§æ˜ã€‚</font><font style="vertical-align: inherit;">åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†ä¸ä¼š</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®ç°é—´æ¥ç…§æ˜ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç›®å‰ï¼Œæ³•çº¿å°šæœªåˆ†é…ç»™è‰å¶çš„é¡¶ç‚¹ã€‚</font><font style="vertical-align: inherit;">ä¸é¡¶ç‚¹ä½ç½®ä¸€æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ‡çº¿ç©ºé—´ä¸­</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„æ³•çº¿</font><font style="vertical-align: inherit;">ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸ºå±€éƒ¨ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“â€œ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¶ç‰‡æ›²ç‡é‡â€</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸º</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1æ—¶</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œåˆ‡çº¿ç©ºé—´ä¸­çš„æ‰€æœ‰è‰å¶éƒ½æŒ‡å‘ä¸€ä¸ªæ–¹å‘ï¼šä¸</font><strong><font style="vertical-align: inherit;">Y</font></strong><font style="vertical-align: inherit;">è½´æ­£å¯¹</font></font><strong><font style="vertical-align: inherit;"></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½œä¸ºè§£å†³æ–¹æ¡ˆçš„ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å‡è®¾æ²¡æœ‰æ›²ç‡ï¼Œè®¡ç®—æ³•çº¿ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the GenerateGrassVertex function, belowing the line declaring tangentPoint. float3 tangentNormal = float3(0, -1, 0); float3 localNormal = mul(transformMatrix, tangentNormal);</span></span></code> </pre> <br> <code>tangentNormal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å®šä¹‰ä¸ºä¸</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½´æ­£å¥½ç›¸å¯¹</font><font style="vertical-align: inherit;">ï¼Œç”±ç”¨äºå°†åˆ‡ç‚¹è½¬æ¢ä¸ºå±€éƒ¨ç©ºé—´çš„åŒä¸€çŸ©é˜µè¿›è¡Œè½¬æ¢ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†å…¶ä¼ é€’ç»™å‡½æ•°</font></font><code>VertexOutput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œç„¶åä¼ é€’ç»™ç»“æ„</font></font><code>geometryOutput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Modify the return call in GenerateGrassVertex. return VertexOutput(localPosition, uv, localNormal); â€¦ // Add to the geometryOutput struct. float3 normal : NORMAL; â€¦ // Modify the existing function signature. geometryOutput VertexOutput(float3 pos, float2 uv, float3 normal) â€¦ // Add to the VertexOutput function to pass the normal through to the fragment shader. o.normal = UnityObjectToWorldNormal(normal);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ³¨æ„ï¼Œåœ¨å¾—å‡ºç»“è®ºä¹‹å‰ï¼Œæˆ‘ä»¬å°†æ³•çº¿è½¬æ¢ä¸º</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¸–ç•Œç©ºé—´</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼›</font><font style="vertical-align: inherit;">Unityå°†ç€è‰²å™¨åœ¨ä¸–ç•Œç©ºé—´ä¸­çš„ä¸»è¦å®šå‘å…‰æºçš„æ–¹å‘ä¼ è¾¾ç»™ç€è‰²å™¨ï¼Œå› æ­¤è¿™ç§è½¬æ¢æ˜¯å¿…éœ€çš„ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¯è§†åŒ–ç€è‰²å™¨ç‰‡æ®µä¸­çš„æ³•çº¿ï¼Œ</font></font><code>ForwardBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»¥æ£€æŸ¥å·¥ä½œçš„ç»“æœã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the ForwardBase fragment shader. float3 normal = facing &gt; 0 ? i.normal : -i.normal; return float4(normal * 0.5 + 0.5, 1); // Remove the existing return call. //return SHADOW_ATTENUATION(i);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”±äºåœ¨æˆ‘ä»¬çš„ç€è‰²å™¨ä¸­</font></font><code>Cull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ†é…</font><font style="vertical-align: inherit;">äº†ä¸€ä¸ª</font><font style="vertical-align: inherit;">å€¼</font></font><code>Off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå› æ­¤å°†æ¸²æŸ“è‰å¶çš„ä¸¤ä¾§ã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿æ³•çº¿æŒ‡å‘æ­£ç¡®çš„æ–¹å‘ï¼Œæˆ‘ä»¬ä½¿ç”¨</font></font><code>VFACE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ·»åŠ åˆ°ç‰‡æ®µç€è‰²å™¨</font><font style="vertical-align: inherit;">çš„è¾…åŠ©å‚æ•°</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¦‚æœæˆ‘ä»¬æ˜¾ç¤ºæ›²é¢çš„æ­£é¢ï¼Œåˆ™</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¯¥å‚æ•°</font></font><code>fixed facing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°†è¿”å›ä¸€ä¸ª</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­£</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°ï¼›å¦‚æœ</font><font style="vertical-align: inherit;">ç›¸åï¼Œåˆ™</font><font style="vertical-align: inherit;">è¯¥å‚æ•°</font><font style="vertical-align: inherit;">å°†è¿”å›ä¸€ä¸ª</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è´Ÿæ•°</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å¦‚æœéœ€è¦ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢çš„ä»£ç ä¸­ä½¿ç”¨å®ƒæ¥ç¿»è½¬æ³•çº¿ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1b/8ca/965/e1b8ca965ed8e80b539a9773d1adeb0c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å½“â€œ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¶ç‰‡æ›²ç‡é‡â€</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¤§äº1æ—¶ï¼Œ</font><font style="vertical-align: inherit;">æ¯ä¸ªé¡¶ç‚¹</font><font style="vertical-align: inherit;">çš„åˆ‡çº¿</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä½ç½®</font><font style="vertical-align: inherit;">å°†åç§»</font></font><code>forward</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼ é€’ç»™å‡½æ•°</font><font style="vertical-align: inherit;">çš„é‡</font></font><code>GenerateGrassVertex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬å°†ä½¿ç”¨æ­¤å€¼æŒ‰æ¯”ä¾‹ç¼©æ”¾</font><font style="vertical-align: inherit;">æ³•çº¿</font><font style="vertical-align: inherit;">çš„</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è½´</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Modify the existing line in GenerateGrassVertex. float3 tangentNormal = normalize(float3(0, -1, forward));</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æœ€åï¼Œå°†ä»£ç æ·»åŠ åˆ°ç‰‡æ®µç€è‰²å™¨ä»¥ç»„åˆé˜´å½±ï¼Œå®šå‘ç…§æ˜å’Œç¯å¢ƒç…§æ˜ã€‚</font><font style="vertical-align: inherit;">æˆ‘å»ºè®®åœ¨æˆ‘çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¡é€šç€è‰²å™¨æ•™ç¨‹ä¸­ç ”ç©¶æœ‰å…³</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨ç€è‰²å™¨ä¸­å®ç°è‡ªå®šä¹‰ç…§æ˜çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯</font><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the ForwardBase fragment shader, below the line declaring float3 normal. float shadow = SHADOW_ATTENUATION(i); float NdotL = saturate(saturate(dot(normal, _WorldSpaceLightPos0)) + _TranslucentGain) * shadow; float3 ambient = ShadeSH9(float4(normal, 1)); float4 lightIntensity = NdotL * _LightColor0 + float4(ambient, 1); float4 col = lerp(_BottomColor, _TopColor * lightIntensity, i.uv.y); return col; // Remove the existing return call. //return float4(normal * 0.5 + 0.5, 1);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c14/894/d14/c14894d14edc336b770f4b94bedd3708.png"></div><br><h2> ç»“è®º </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œè‰è¦†ç›–äº†10x10å•ä½çš„å°åŒºåŸŸã€‚</font><font style="vertical-align: inherit;">ä¸ºäº†ä½¿ç€è‰²å™¨åœ¨ä¿æŒé«˜æ€§èƒ½çš„åŒæ—¶è¦†ç›–è¾ƒå¤§çš„å¼€æ”¾ç©ºé—´ï¼Œå¿…é¡»è¿›è¡Œä¼˜åŒ–ã€‚</font><font style="vertical-align: inherit;">æ‚¨å¯ä»¥åŸºäºè·ç¦»åº”ç”¨é•¶åµŒï¼Œä»¥ä½¿æ›´å°‘çš„è‰å¶è¿œç¦»ç›¸æœºæ¸²æŸ“ã€‚</font><font style="vertical-align: inherit;">å¦å¤–ï¼Œåœ¨é•¿è·ç¦»ä¸Šï¼Œå¯ä»¥ä½¿ç”¨å…·æœ‰å åŠ çº¹ç†çš„å•ä¸ªå››è¾¹å½¢æ¥ç»˜åˆ¶å¤šç»„è‰å¶ï¼Œè€Œä¸æ˜¯å•ç‹¬çš„è‰å¶ã€‚</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a7/a05/e86/5a7a05e8690c152f9196bb3c94fada19.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unityå¼•æ“çš„</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ‡å‡†èµ„äº§</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åŒ…ä¸­åŒ…å«çš„è‰çº¹ç†</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">åœ¨ä¸€ä¸ªå››è¾¹å½¢ä¸Šç»˜åˆ¶äº†è®¸å¤šè‰å¶ï¼Œè¿™å‡å°‘äº†åœºæ™¯ä¸­ä¸‰è§’å½¢çš„æ•°é‡ã€‚</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å°½ç®¡ä»æœ¬è´¨ä¸Šè®²æˆ‘ä»¬ä¸èƒ½å°†å‡ ä½•ç€è‰²å™¨ä¸è¡¨é¢ç€è‰²å™¨ä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ”¹å–„æˆ–æ‰©å±•ç…§æ˜å’Œé˜´å½±çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨æ ‡å‡†Unityç…§æ˜æ¨¡å‹ï¼Œåˆ™å¯ä»¥ç ”ç©¶</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤GitHubå­˜å‚¨åº“</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œè¯¥</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">å­˜å‚¨åº“</font></a><font style="vertical-align: inherit;">é€šè¿‡å»¶è¿Ÿæ¸²æŸ“å’Œæ‰‹åŠ¨å¡«å……Gç¼“å†²åŒºå±•ç¤ºäº†è¯¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHubå­˜å‚¨åº“ä¸­çš„ç€è‰²å™¨æºä»£ç </font></font></a> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è¡¥å……ï¼šåˆä½œ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ²¡æœ‰äº’æ“ä½œæ€§ï¼Œå›¾å½¢æ•ˆæœå¯¹ç©å®¶æ¥è¯´ä¼¼ä¹æ˜¯é™æ­¢çš„æˆ–æ¯«æ— ç”Ÿæ°”çš„ã€‚</font><font style="vertical-align: inherit;">æœ¬æ•™ç¨‹å·²ç»å¾ˆé•¿äº†ï¼Œå› æ­¤æˆ‘æ²¡æœ‰æ·»åŠ æœ‰å…³ä¸–ç•Œå¯¹è±¡ä¸è‰çš„äº¤äº’ä½œç”¨çš„éƒ¨åˆ†ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">äº¤äº’å¼è¯è‰çš„å¹¼ç¨šå®ç°å°†åŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼šæ¸¸æˆä¸–ç•Œä¸­çš„ä¸€äº›ç»„ä»¶ï¼Œå¯ä»¥å°†</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ•°æ®ä¼ è¾“</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">åˆ°ç€è‰²å™¨ä»¥å‘Šè¯‰å®ƒæ­£åœ¨ä¸è‰çš„å“ªä¸€éƒ¨åˆ†è¿›è¡Œäº¤äº’ï¼Œä»¥åŠåœ¨ç€è‰²å™¨ä¸­è¿›è¡Œç¼–ç ä»¥</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è§£é‡Š</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤æ•°æ®ã€‚</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">æ­¤å¤„</font></a></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¾ç¤ºäº†å¦‚ä½•ç”¨æ°´å®ç°çš„ç¤ºä¾‹</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">å®ƒå¯ä»¥é€‚åº”ä¸è‰ä¸€èµ·å·¥ä½œï¼›</font><font style="vertical-align: inherit;">æ— éœ€åœ¨è§’è‰²æ‰€åœ¨çš„ä½ç½®ç»˜åˆ¶æ¶Ÿæ¼ªå›¾ï¼Œè€Œæ˜¯å¯ä»¥å°†è‰å¶è°ƒä½ä»¥æ¨¡æ‹Ÿå°é˜¶çš„æ•ˆæœã€‚</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN458060/">https://habr.com/ru/post/zh-CN458060/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN458046/index.html">æ‘‡ç¯®å¤‡å¿˜å•</a></li>
<li><a href="../zh-CN458048/index.html">å§”æ‰˜ä½œä¸ºç®¡ç†å·¥å…·</a></li>
<li><a href="../zh-CN458050/index.html">Mobius 2019 Piterçš„æƒ…å†µå¦‚ä½•ï¼ˆä»¥åŠæœ‰å…³ä¸‹ä¸€ä¸ªMobiusçš„ä¸€äº›çŸ¥è¯†ï¼‰</a></li>
<li><a href="../zh-CN458052/index.html">AMAä¸Habr.10ã€‚ æœ€å*é—®é¢˜</a></li>
<li><a href="../zh-CN458056/index.html">Martin Kleppmannçš„å¤§å‹è®¿è°ˆï¼šâ€œå¼„æ¸…æ¥šåˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿçš„æœªæ¥â€</a></li>
<li><a href="../zh-CN458062/index.html">UserGateå¹³å°æ¦‚è¿°</a></li>
<li><a href="../zh-CN458064/index.html">äº‘ä¸­çš„PVS-Studio-åœ¨Travis CIä¸Šè¿è¡Œåˆ†æ</a></li>
<li><a href="../zh-CN458068/index.html">PVS-Studio for Visual Studio</a></li>
<li><a href="../zh-CN458070/index.html">PVS-Studio for Visual Studio</a></li>
<li><a href="../zh-CN458072/index.html">PVS-Studioèµ°å‘äº‘ç«¯-åœ¨Travis CIä¸Šå¯åŠ¨åˆ†æ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>