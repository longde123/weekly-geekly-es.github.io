<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üß• üßëüèª üß§ DDoS para ajudar: como realizamos testes de estresse e estresse üï¥üèΩ üßë üëºüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A Variti desenvolve prote√ß√£o contra ataques de bots e DDoS e tamb√©m realiza testes de estresse e carga. Na confer√™ncia HighLoad ++ 2018, conversamos s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DDoS para ajudar: como realizamos testes de estresse e estresse</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/variti/blog/448626/"><img src="https://habrastorage.org/webt/ze/th/rb/zethrbwkfxc_3voyzfevkonnzao.png"><br><br>  <i>A Variti desenvolve prote√ß√£o contra ataques de bots e DDoS e tamb√©m realiza testes de estresse e carga.</i>  <i>Na confer√™ncia HighLoad ++ 2018, conversamos sobre como proteger recursos de v√°rios tipos de ataques.</i>  <i>Em resumo: isole partes do sistema, use servi√ßos em nuvem e CDN e atualize regularmente.</i>  <i>Mas sem empresas especializadas, prote√ß√£o voc√™ ainda n√£o pode fazer :)</i> <br><a name="habracut"></a><br>  Antes de ler o texto, voc√™ pode se familiarizar com pequenos resumos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no site da confer√™ncia</a> . <br>  E se voc√™ n√£o gosta de ler ou apenas deseja assistir a um v√≠deo, a grava√ß√£o do nosso relat√≥rio est√° abaixo do spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Denunciar v√≠deo</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/Lu4tsUvfYRc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  Muitas empresas j√° sabem como realizar testes de estresse, mas nem todas fazem testes de estresse.  Alguns de nossos clientes pensam que seu site √© invulner√°vel porque possui um sistema de carga alta e protege contra ataques.  Mostramos que isso n√£o √© inteiramente verdade. <br><br>  Obviamente, antes de realizar os testes, obtemos permiss√£o do cliente, assinada e carimbada e, com nossa ajuda, n√£o podemos fazer um ataque DDoS a ningu√©m.  Os testes s√£o realizados no hor√°rio escolhido pelo cliente, quando o atendimento de seus recursos √© m√≠nimo e os problemas de acesso n√£o afetam os clientes.  Al√©m disso, como algo sempre pode dar errado durante o processo de teste, temos contato constante com o cliente.  Isso permite n√£o apenas relatar os resultados alcan√ßados, mas tamb√©m alterar algo durante o teste.  No final do teste, sempre elaboramos um relat√≥rio no qual apontamos as falhas descobertas e fazemos recomenda√ß√µes para eliminar os pontos fracos do site. <br><br><h3>  Como trabalhamos </h3><br>  Durante o teste, emulamos uma botnet.  Como trabalhamos com clientes que n√£o est√£o localizados em nossas redes, para impedir que o teste termine no primeiro minuto devido ao acionamento de limites ou prote√ß√£o, carregamos a carga n√£o de um IP, mas de nossa pr√≥pria sub-rede.  Al√©m disso, para criar uma carga significativa, temos nosso pr√≥prio servidor de teste bastante poderoso. <br><br><h3>  Postulados </h3><br><blockquote>  <b>Muito n√£o √© bom</b> <br><br>  Quanto menos carga pudermos levar o recurso √† falha, melhor.  Se voc√™ conseguir fazer com que o site pare de funcionar com uma solicita√ß√£o por segundo, ou mesmo com uma solicita√ß√£o por minuto, tudo bem.  Porque, de acordo com a lei da maldade, usu√°rios ou atacantes acidentalmente se enquadram nessa vulnerabilidade. </blockquote><blockquote> <b>Falha parcial √© melhor que falha completa</b> <br><br>  Sempre aconselhamos tornar os sistemas heterog√™neos.  Al√©m disso, vale a pena separ√°-los no n√≠vel f√≠sico, e n√£o apenas na conteineriza√ß√£o.  No caso de separa√ß√£o f√≠sica, mesmo que algo falhe no site, √© prov√°vel que ele n√£o pare de funcionar completamente, e os usu√°rios ainda ter√£o acesso a pelo menos parte da funcionalidade. </blockquote><blockquote>  <b>Arquitetura adequada √© a base da sustentabilidade</b> <br><br>  A toler√¢ncia a falhas de um recurso e sua capacidade de suportar ataques e cargas devem ser estabelecidas no est√°gio de design, na verdade, no est√°gio de desenhar os primeiros diagramas de bloco em um notebook.  Porque se erros fatais aparecerem, voc√™ poder√° corrigi-los no futuro, mas √© muito dif√≠cil. </blockquote><blockquote>  <b>N√£o apenas o c√≥digo deve ser bom, mas tamb√©m uma configura√ß√£o</b> <br><br>  Muitas pessoas pensam que uma boa equipe de desenvolvimento √© uma garantia de resili√™ncia do servi√ßo.  Uma boa equipe de desenvolvimento √© realmente necess√°ria, mas tamb√©m deve haver uma boa opera√ß√£o, bons DevOps.  Ou seja, precisamos de especialistas que configurem corretamente o Linux e a rede, gravem corretamente as configura√ß√µes no nginx, configurem limites e muito mais.  Caso contr√°rio, o recurso funcionar√° bem apenas no teste e, em algum momento da produ√ß√£o, tudo quebrar√°. </blockquote><blockquote>  <b>Diferen√ßas entre estresse e teste de estresse</b> <br><br>  O teste de carga permite identificar os limites do sistema.  O teste de estresse visa encontrar as fraquezas do sistema e √© usado para quebrar esse sistema e ver como ele se comportar√° no processo de falha de certas partes.  Ao mesmo tempo, a natureza da carga geralmente permanece desconhecida para o cliente at√© o in√≠cio do teste de estresse. </blockquote><h3>  Recursos distintos dos ataques L7 </h3><br>  Geralmente, dividimos os tipos de carga em cargas nos n√≠veis L7 e L3 e 4.  L7 √© uma carga no n√≠vel do aplicativo, na maioria das vezes √© entendida apenas como HTTP, mas queremos dizer qualquer carga no n√≠vel do protocolo TCP. <br><br>  Os ataques L7 t√™m certas caracter√≠sticas distintivas.  Em primeiro lugar, eles v√™m diretamente para o aplicativo, ou seja, √© improv√°vel que possam ser refletidos por meios de rede.  Tais ataques usam l√≥gica e, por isso, consomem CPU, mem√≥ria, disco, banco de dados e outros recursos de maneira muito eficiente e com pouco tr√°fego. <br><br><h3>  Inunda√ß√£o HTTP </h3><br>  No caso de qualquer ataque, a carga √© mais f√°cil de criar do que manipular, e no caso de L7 isso tamb√©m √© verdade.  Nem sempre √© f√°cil distinguir o tr√°fego de ataque do leg√≠timo, e na maioria das vezes isso pode ser feito com frequ√™ncia, mas se tudo for planejado corretamente, ser√° imposs√≠vel entender onde est√° o ataque e onde est√£o os pedidos leg√≠timos dos logs. <br><br>  Como primeiro exemplo, considere um ataque HTTP Flood.  O gr√°fico mostra que geralmente esses ataques s√£o muito poderosos, no exemplo abaixo, o n√∫mero m√°ximo de solicita√ß√µes excedeu 600 mil por minuto. <br><br><img src="https://habrastorage.org/webt/rl/-i/qz/rl-iqze06e8bg4epyzgcsfpwddu.png"><br><br>  O HTTP Flood √© a maneira mais f√°cil de criar uma carga.  Geralmente, √© utilizado algum tipo de ferramenta de teste de carga, por exemplo, ApacheBench, e a solicita√ß√£o e a finalidade s√£o definidas.  Com uma abordagem t√£o simples, √© prov√°vel que ocorra o cache do servidor, mas √© f√°cil contornar isso.  Por exemplo, adicionando linhas aleat√≥rias √† consulta, o que for√ßa o servidor a fornecer constantemente uma p√°gina nova. <br>  Al√©m disso, n√£o se esque√ßa do user-agent no processo de cria√ß√£o de uma carga.  Muitos user-agents de ferramentas de teste populares s√£o filtrados pelos administradores do sistema e, nesse caso, a carga pode simplesmente n√£o atingir o back-end.  Voc√™ pode melhorar significativamente o resultado inserindo um cabe√ßalho mais ou menos v√°lido do navegador na solicita√ß√£o. <br>  Por toda a sua simplicidade, os ataques do HTTP Flood t√™m suas desvantagens.  Em primeiro lugar, s√£o necess√°rias grandes capacidades para criar uma carga.  Em segundo lugar, esses ataques s√£o muito f√°ceis de detectar, principalmente se vierem do mesmo endere√ßo.  Como resultado, as solicita√ß√µes come√ßam a ser filtradas imediatamente pelos administradores do sistema ou mesmo no n√≠vel do provedor. <br><br><h3>  O que procurar </h3><br>  Para reduzir o n√∫mero de solicita√ß√µes por segundo e ainda n√£o perder efici√™ncia, voc√™ precisa mostrar um pouco de imagina√ß√£o e explorar o site.  Portanto, voc√™ pode carregar n√£o apenas o canal ou servidor, mas tamb√©m partes individuais do aplicativo, por exemplo, bancos de dados ou sistemas de arquivos.  Voc√™ tamb√©m pode procurar lugares no site que fazem √≥timos c√°lculos: calculadoras, p√°ginas de sele√ß√£o de produtos e muito mais.  Finalmente, acontece frequentemente que existe um script php no site que gera uma p√°gina de v√°rias centenas de milhares de linhas.  Esse script tamb√©m carrega muito o servidor e pode se tornar um alvo de ataque. <br><br><h3>  Onde procurar </h3><br>  Quando analisamos um recurso antes do teste, antes de tudo, √© claro, olhamos para o pr√≥prio site.  Estamos procurando por todos os tipos de campos de entrada, arquivos pesados ‚Äã‚Äã- em geral, tudo o que possa criar problemas para um recurso e diminuir sua opera√ß√£o.  Aqui, ferramentas de desenvolvimento comuns no Google Chrome e Firefox ajudam a mostrar o tempo de resposta da p√°gina. <br><br>  Tamb√©m analisamos subdom√≠nios.  Por exemplo, existe uma determinada loja online, abc.com, e ela tem um subdom√≠nio admin.abc.com.  Provavelmente, este √© o painel de administra√ß√£o com autoriza√ß√£o, mas se voc√™ colocar um carregamento nele, ele poder√° criar problemas para o recurso principal. <br><br>  O site pode ter um subdom√≠nio api.abc.com.  Provavelmente, este √© um recurso para aplicativos m√≥veis.  O aplicativo pode ser encontrado na App Store ou no Google Play, colocar um ponto de acesso especial, dissecar a API e registrar contas de teste.  O problema √© que muitas vezes as pessoas pensam que tudo o que √© protegido por autoriza√ß√£o √© imune a ataques de nega√ß√£o de servi√ßo.  Alegadamente, a autoriza√ß√£o √© o melhor CAPTCHA, mas n√£o √©.  Fazer 10 a 20 contas de teste √© simples e, ao cri√°-las, obtemos acesso a funcionalidades complexas e indisfar√ßadas. <br><br>  Naturalmente, analisamos o hist√≥rico, no robots.txt e no WebArchive, ViewDNS, procuramos vers√µes antigas do recurso.  √Äs vezes acontece que os desenvolvedores lan√ßaram, digamos, mail2.yandex.net, mas a vers√£o antiga, mail.yandex.net, permaneceu.  Esse mail.yandex.net n√£o √© mais suportado, os recursos de desenvolvimento n√£o s√£o alocados a ele, mas continua consumindo o banco de dados.  Assim, usando a vers√£o antiga, voc√™ pode usar efetivamente os recursos do back-end e tudo o que est√° por tr√°s do layout.  Obviamente, isso nem sempre acontece, mas ainda encontramos algo assim com bastante frequ√™ncia. <br><br>  Naturalmente, dissecamos todos os par√¢metros de solicita√ß√£o, estrutura de cookies.  Voc√™ pode, por exemplo, inserir algum valor na matriz JSON dentro do cookie, criar mais aninhamentos e tornar o recurso excessivamente longo. <br><br><h3>  Carga de pesquisa </h3><br>  A primeira coisa que vem √† mente ao pesquisar um site √© carregar o banco de dados, j√° que quase todo mundo tem uma pesquisa e quase todo mundo a possui, infelizmente, est√° mal protegida.  Por alguma raz√£o, os desenvolvedores n√£o prestam aten√ß√£o suficiente √† pesquisa.  Mas h√° uma recomenda√ß√£o - n√£o fa√ßa o mesmo tipo de solicita√ß√µes, pois voc√™ pode encontrar armazenamento em cache, como √© o caso da inunda√ß√£o HTTP. <br><br>  Fazer consultas aleat√≥rias no banco de dados tamb√©m nem sempre √© eficiente.  √â muito melhor criar uma lista de palavras-chave relevantes para a pesquisa.  Se voc√™ voltar ao exemplo de uma loja on-line: digamos que o site vende pneus de carros e permite definir o raio dos pneus, o tipo de carro e outros par√¢metros.  Assim, combina√ß√µes de palavras relevantes far√£o o banco de dados funcionar em condi√ß√µes muito mais complexas. <br><br>  Al√©m disso, vale a pena usar a pagina√ß√£o: √© muito mais dif√≠cil para uma pesquisa retornar a pen√∫ltima p√°gina de um problema do que a primeira.  Ou seja, com a ajuda da pagina√ß√£o, voc√™ pode diversificar um pouco a carga. <br><br>  No exemplo abaixo, mostramos a carga na pesquisa.  Pode-se observar que, a partir do primeiro segundo do teste, a uma velocidade de dez solicita√ß√µes por segundo, o site caiu e n√£o respondeu. <br><br><img src="https://habrastorage.org/webt/dg/bu/oa/dgbuoarg4u2ufo9_jw1w2nxkurq.png"><br><br><h3>  Se n√£o houver pesquisa? </h3><br>  Se n√£o houver pesquisa, isso n√£o significa que o site n√£o contenha outros campos de entrada vulner√°veis.  Este campo pode ser uma autoriza√ß√£o.  Agora, os desenvolvedores gostam de criar hashes complexos para proteger o banco de dados de login de ataques a tabelas arco-√≠ris.  Isso √© bom, mas esses hashes consomem grandes recursos da CPU.  Um grande fluxo de autoriza√ß√µes falsas leva a uma falha do processador e, como resultado, o site para de funcionar na sa√≠da. <br><br>  A presen√ßa no site de todos os tipos de formul√°rios para coment√°rios e feedback √© uma ocasi√£o para enviar textos muito grandes para l√° ou simplesmente criar uma inunda√ß√£o maci√ßa.  √Äs vezes, os sites aceitam anexos de arquivos, inclusive no formato gzip.  Nesse caso, pegamos um arquivo de 1 TB, usando o gzip, compactamos para alguns bytes ou kilobytes e o enviamos para o site.  Depois √© descompactado e √© obtido um efeito muito interessante. <br><br><h3>  API Rest </h3><br>  Gostaria de prestar um pouco de aten√ß√£o a servi√ßos populares como a API Rest.  Proteger a API Rest √© muito mais dif√≠cil do que um site comum.  Para a API Rest, mesmo m√©todos triviais de prote√ß√£o contra quebra de senha e outras atividades ileg√≠timas n√£o funcionam. <br><br>  A API Rest √© muito f√°cil de quebrar porque acessa o banco de dados diretamente.  Ao mesmo tempo, a falha de um servi√ßo desse tipo acarreta consequ√™ncias bastante s√©rias para os neg√≥cios.  O fato √© que a API Rest normalmente envolve n√£o apenas o site principal, mas tamb√©m o aplicativo m√≥vel, alguns recursos internos de neg√≥cios.  E se tudo isso cair, o efeito ser√° muito mais forte do que no caso de falha de um site simples. <br><br><h3>  Carga de conte√∫do pesado </h3><br>  Se nos oferecerem o teste de algum aplicativo comum de uma p√°gina, p√°gina inicial, site de cart√£o de visita, que n√£o possui funcionalidade complexa, estamos procurando conte√∫do pesado.  Por exemplo, fotos grandes que o servidor fornece, arquivos bin√°rios, documenta√ß√£o em pdf - estamos tentando fazer tudo isso.  Esses testes carregam bem o sistema de arquivos e entupem os canais e, portanto, s√£o eficazes.  Ou seja, mesmo que voc√™ n√£o desligue o servidor, baixando um arquivo grande em baixa velocidade, voc√™ simplesmente obstruir√° o canal do servidor de destino e ocorrer√° uma nega√ß√£o de servi√ßo. <br>  Um exemplo desse teste mostra que, a uma velocidade de 30 RPS, o site parou de responder ou gerou 500 erros no servidor. <br><br><img src="https://habrastorage.org/webt/qc/wt/o-/qcwto-1m01beyofdf9vwgov8a6g.png"><br><br>  N√£o se esque√ßa de configurar servidores.  Muitas vezes, voc√™ pode descobrir que uma pessoa comprou uma m√°quina virtual, instalou o Apache l√°, configurou tudo por padr√£o, localizou um aplicativo php e, abaixo, voc√™ pode ver o resultado. <br><br><img src="https://habrastorage.org/webt/js/ji/xj/jsjixjh1afv4981burqrqtopx8i.png"><br><br>  Aqui, a carga foi para a raiz e atingiu apenas 10 RPS.  Esperamos 5 minutos e o servidor travou.  No final, no entanto, n√£o se sabe por que ele caiu, mas h√° uma suposi√ß√£o de que ele simplesmente estava cheio de mem√≥ria e, portanto, parou de responder. <br><br><h3>  Baseado em ondas </h3><br>  Nos √∫ltimos dois anos, ataques de onda se tornaram bastante populares.  Isso se deve ao fato de muitas organiza√ß√µes comprarem determinadas pe√ßas de hardware para prote√ß√£o contra DDoS, que exigem uma certa quantidade de estat√≠sticas para come√ßar a filtrar ataques.  Ou seja, eles n√£o filtram o ataque nos primeiros 30 a 40 segundos, porque acumulam dados e aprendem.  Assim, nesses 30 a 40 segundos, voc√™ pode iniciar tanto que o recurso permanecer√° por um longo tempo at√© que todas as solicita√ß√µes sejam processadas. <br><br>  No caso do ataque, houve um intervalo de 10 minutos abaixo, ap√≥s o qual uma nova parte modificada do ataque chegou. <br><br><img src="https://habrastorage.org/webt/tx/b4/l7/txb4l7l3s0yneaz0dn5__jzozmu.png"><br><br>  Ou seja, a defesa treinada come√ßou a filtrar, mas uma nova parte completamente diferente do ataque chegou e a defesa come√ßou a treinar novamente.  De fato, a filtragem para de funcionar, a prote√ß√£o se torna ineficaz e o site fica inacess√≠vel. <br><br>  Os ataques de onda s√£o caracterizados por valores muito altos no pico, podendo atingir cem mil ou um milh√£o de solicita√ß√µes por segundo, no caso de L7.  Se falamos de L3 e 4, pode haver centenas de gigabits de tr√°fego ou, consequentemente, centenas de mpps, se voc√™ contar em pacotes. <br><br>  O problema com esses ataques √© a sincroniza√ß√£o.  Os ataques v√™m de uma botnet e, para criar um pico √∫nico muito grande, √© necess√°rio um alto grau de sincroniza√ß√£o.  E essa coordena√ß√£o nem sempre funciona: √†s vezes a sa√≠da √© algum tipo de pico parab√≥lico, que parece bastante pat√©tico. <br><br><h3>  N√£o HTTP unificado </h3><br>  Al√©m do HTTP no n√≠vel L7, adoramos explorar outros protocolos.  Como regra, um site comum, especialmente uma hospedagem comum, possui protocolos de correio e o MySQL se destaca.  Os protocolos de correio s√£o menos afetados que os bancos de dados, mas tamb√©m podem ser carregados com bastante efici√™ncia e obter uma CPU sobrecarregada no servidor na sa√≠da. <br><br>  Com a ajuda da vulnerabilidade SSH 2016, tivemos bastante sucesso.  Agora, essa vulnerabilidade foi corrigida para quase todos, mas isso n√£o significa que o SSH n√£o possa ser carregado.  Voc√™ pode.  Apenas uma grande quantidade de autoriza√ß√µes √© atendida, o SSH consome quase toda a CPU no servidor e, em seguida, o site j√° √© composto de uma ou duas solicita√ß√µes por segundo. <br><br>  Portanto, essas uma ou duas consultas de log n√£o podem ser distinguidas de uma carga leg√≠tima. <br>  As muitas conex√µes que abrimos nos servidores permanecem relevantes.  Anteriormente, o Apache pecava, agora o nginx realmente pecava, pois geralmente √© configurado por padr√£o.  O n√∫mero de conex√µes que o nginx pode manter aberto √© limitado; portanto, abrimos esse n√∫mero de conex√µes, a nova conex√£o nginx n√£o aceita mais e o site n√£o funciona na sa√≠da. <br><br>  Nosso cluster de teste tem CPU suficiente para atacar o handshake SSL.  Em princ√≠pio, como mostra a pr√°tica, as redes de bots √†s vezes tamb√©m gostam disso.  Por um lado, √© claro que voc√™ n√£o pode ficar sem o SSL, porque a emiss√£o, a classifica√ß√£o e a seguran√ßa do Google.  SSL, por outro lado, infelizmente tem um problema de CPU. <br><br><h3>  L3 e 4 </h3><br>  Quando falamos sobre um ataque nos n√≠veis L3 e 4, geralmente falamos sobre um ataque no n√≠vel do canal.  Essa carga quase sempre √© distingu√≠vel de leg√≠tima se n√£o for um ataque de inunda√ß√£o SYN.  O problema dos ataques de inunda√ß√£o SYN para recursos de seguran√ßa √© grande.  O valor m√°ximo de L3 e 4 foi de 1,5-2 Tb / s.  Esse tr√°fego √© muito dif√≠cil de lidar, mesmo para grandes empresas, incluindo Oracle e Google. <br><br>  SYN e SYN-ACK s√£o os pacotes usados ‚Äã‚Äãpara estabelecer a conex√£o.  Portanto, √© dif√≠cil distinguir o SYN-flood de uma carga leg√≠tima: n√£o est√° claro que seja o SYN, que veio estabelecer a conex√£o ou parte do flood. <br><br><h3>  Inunda√ß√£o UDP </h3><br>  Normalmente, os invasores n√£o t√™m os recursos que temos, portanto a amplifica√ß√£o pode ser usada para organizar ataques.  Ou seja, um invasor verifica a Internet e encontra servidores vulner√°veis ‚Äã‚Äãou configurados incorretamente, que, por exemplo, em resposta a um pacote SYN, respondem com tr√™s SYN-ACKs.  Ao fingir o endere√ßo de origem do endere√ßo do servidor de destino, voc√™ pode usar um pacote para aumentar a capacidade, digamos, tr√™s vezes, e redirecionar o tr√°fego para a v√≠tima. <br><br><img src="https://habrastorage.org/webt/nd/yu/qz/ndyuqzpld7k2bu58rqqmbriass4.png"><br><br>  O problema das amplifica√ß√µes √© a sua detec√ß√£o complexa.  A partir dos exemplos mais recentes, podemos citar o caso sensacional com o vulner√°vel memcached.  Al√©m disso, agora existem muitos dispositivos IoT, c√¢meras IP, que tamb√©m s√£o configurados principalmente por padr√£o e, por padr√£o, s√£o configurados incorretamente; portanto, por meio desses dispositivos, os atacantes costumam fazer ataques. <br><br><img src="https://habrastorage.org/webt/h-/si/2n/h-si2n6jf8q84xzuzbfgwgwnd6o.png"><br><br><h3>  Dif√≠cil SYN-flood </h3><br>  O SYN-flood √© provavelmente a vis√£o mais interessante de todos os ataques do ponto de vista do desenvolvedor.  O problema √© que geralmente os administradores de sistema usam bloqueio de IP para prote√ß√£o.  Al√©m disso, o bloqueio de IP afeta n√£o apenas os administradores de sistemas que operam de acordo com os scripts, mas, infelizmente, alguns sistemas de seguran√ßa comprados por muito dinheiro. <br><br>  Esse m√©todo pode se transformar em uma cat√°strofe, porque se os invasores mudarem seus endere√ßos IP, a empresa bloquear√° sua pr√≥pria sub-rede.  Quando o Firewall bloqueia seu pr√≥prio cluster, as intera√ß√µes externas s√£o interrompidas na sa√≠da e o recurso √© interrompido. <br><br>  E para conseguir bloquear sua pr√≥pria rede √© f√°cil.  Se o escrit√≥rio do cliente tiver uma rede Wi-Fi ou se a integridade dos recursos for medida usando v√°rios monitoramento, pegamos o endere√ßo IP desse sistema de monitoramento ou cliente Wi-Fi do escrit√≥rio e o usamos como fonte.  Na sa√≠da, o recurso parece estar dispon√≠vel, mas os endere√ßos IP de destino est√£o bloqueados.  Portanto, a rede Wi-Fi da confer√™ncia HighLoad, onde √© apresentado um novo produto da empresa, pode ser bloqueada, e isso implica em certos custos comerciais e econ√¥micos. <br><br>  Durante o teste, n√£o podemos usar a amplifica√ß√£o atrav√©s do memcached por alguns recursos externos, porque existem acordos para fornecer tr√°fego apenas para endere√ßos IP permitidos.  Assim, usamos a amplifica√ß√£o via SYN e SYN-ACK, quando o sistema responde com dois ou tr√™s SYN-ACKs para enviar um SYN, e a sa√≠da √© multiplicada por duas a tr√™s vezes. <br><br><h3>  As ferramentas </h3><br>  Uma das principais ferramentas que usamos para a carga no n√≠vel L7 √© o tanque Yandex.  Em particular, um fantasma √© usado como arma, al√©m de v√°rios scripts para gerar cartuchos e analisar os resultados. <br><br>  Tcpdump √© usado para analisar o tr√°fego de rede e o Nmap √© usado para analisar o tr√°fego do servidor.  Para criar uma carga no n√≠vel L3 e 4, o OpenSSL √© usado e um pouco de sua pr√≥pria m√°gica com a biblioteca DPDK.  O DPDK √© uma biblioteca da Intel que permite trabalhar com uma interface de rede, ignorando a pilha do Linux e, assim, aumentando a efici√™ncia.  Naturalmente, usamos o DPDK n√£o apenas nos n√≠veis L3 e 4, mas tamb√©m no n√≠vel L7, porque permite criar um fluxo de carga muito alto, dentro de alguns milh√µes de solicita√ß√µes por segundo de uma m√°quina. <br>  Tamb√©m usamos certos geradores de tr√°fego e ferramentas especiais que escrevemos para testes espec√≠ficos.  Se recordarmos a vulnerabilidade no SSH, com o conjunto acima, n√£o ser√° poss√≠vel escapar.  Se atacarmos o protocolo de email, utilizamos utilit√°rios de email ou apenas escrevemos scripts neles. <br><br><blockquote><h3>  Conclus√µes </h3><br>  Como resultado, gostaria de dizer: <br><br><ul><li>  Al√©m do teste de carga cl√°ssico, tamb√©m √© necess√°rio realizar o teste de estresse.  Temos um exemplo do mundo real em que um subempreiteiro parceiro conduzia apenas testes de carga.  Ele mostrou que o recurso suporta a carga padr√£o.  Mas, em seguida, apareceu uma carga anormal, os visitantes do site come√ßaram a usar o recurso de maneira um pouco diferente e, na sa√≠da, o subcontratado estabeleceu.  Portanto, vale a pena procurar vulnerabilidades, mesmo se voc√™ j√° estiver protegido contra ataques DDoS. </li><li>  √â necess√°rio isolar algumas partes do sistema de outras.     ,      ,      .       ,    -  .    -      ,   , ,    ,    OAuth2. </li><li>      . </li><li>  CDN      ,               . </li><li>     .  L3&amp;4        ,    ,  ,    .  L7      ,     . ,     -   ,  . </li><li>  .     ,   SSH daemon,       .  ,    ,            . </li></ul></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt448626/">https://habr.com/ru/post/pt448626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt448610/index.html">DIY: Como fizemos uma programa√ß√£o ao vivo para o Codefest X</a></li>
<li><a href="../pt448612/index.html">O que foi congelado no congelamento de recursos em 2019. Parte I. JSONPath</a></li>
<li><a href="../pt448618/index.html">Algoritmo de Douglas-Pecker</a></li>
<li><a href="../pt448622/index.html">PHP GR8: JIT melhorar√° o desempenho do PHP 8</a></li>
<li><a href="../pt448624/index.html">Veja os dados? N√£o. Ent√£o, eu n√£o vejo, mas eles s√£o. Destru√≠mos dados em unidades SSD e at√© restauramos a velocidade</a></li>
<li><a href="../pt448628/index.html">Est√©tica e tecnologia t√©cnicas sovi√©ticas</a></li>
<li><a href="../pt448632/index.html">Java agora √© pago? Desmascarando boatos (ou n√£o?)</a></li>
<li><a href="../pt448634/index.html">Aulas de ucraniano</a></li>
<li><a href="../pt448636/index.html">Caso retro do computador de Hackaday</a></li>
<li><a href="../pt448638/index.html">Buildroot - Parte 1. Informa√ß√µes gerais, construindo um sistema m√≠nimo, configurando atrav√©s do menu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>