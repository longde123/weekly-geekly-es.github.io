<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🚀 🍅 👆🏿 Saya lelah menerima pembayaran melalui WebView. Apa yang harus saya lakukan 🍠 ⤵️ 🉐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya pergi ke kantor dengan kereta - saya harus melewati satu stasiun, dan saya akan hampir sampai. 

 Setiap pagi saya membeli tiket kereta di aplika...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Saya lelah menerima pembayaran melalui WebView. Apa yang harus saya lakukan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/416871/">  Saya pergi ke kantor dengan kereta - saya harus melewati satu stasiun, dan saya akan hampir sampai. <br><br>  Setiap pagi saya membeli tiket kereta di aplikasi dan menderita.  Lebih murah di sana, tetapi perbedaan harga tidak membayar rasa sakit saya ketika saya mengalami tiga menit stres ini.  Bahkan tanpa menyebutkan waktu pemuatan masing-masing dari lima layar aplikasi, orang tidak bisa tidak mengatakan tentang perbankan WebView dengan peta yang disimpan, memasukkan kode dari SMS dalam perjalanan dan kerusakan yang tak terduga. <br><br>  Ini terjadi ketika Anda berlari di kereta, dan mereka mengatakan "Ada yang salah" dan menghapus uang, tetapi mereka tidak memberikan tiket.  Kembali tiba di sana, tetapi kereta sudah pergi.  Ini terjadi beberapa kali dalam sebulan, terlepas dari kualitas Internet.  Tidak perlu berbicara tentang saham apa pun. <br><br><img src="https://habrastorage.org/webt/vk/cl/oz/vkclozwcg4inlgcwqn7equxs_hi.png"><br><br>  Saat ini Anda sedang berpikir - mungkin ada cara yang lebih sederhana?  Ya, tidak memiliki tampilan web sama sekali, cantik dan asli.  Dan ya, ada cara seperti itu.  Detail di bawah potongan. <br><a name="habracut"></a><br>  <b>tl; dr</b> Kami membuat antarmuka untuk menerima pembayaran melalui Apple Pay, Google Pay, bank seluler Sberbank, dan Yandex.Money di iOS dan Android.  Tidak, Anda tidak perlu menggambar formulir pembayaran.  Ya, itu juga dalam open source. <br><br>  Secara umum, ada sekitar dua skenario untuk menerima pembayaran dalam aplikasi seluler. <br><br>  Yang pertama adalah melalui WebView dengan halaman pembayaran.  Jadi, Anda dapat menerima pembayaran melalui dompet, kartu bank, ponsel, atau apa pun.  Masalahnya adalah bahwa WebView tidak memiliki akses ke cookie browser, yang berarti itu tidak memiliki otorisasi untuk beberapa metode pembayaran, sehingga Anda tidak akan dapat membayar. <br><br>  Dalam skenario kedua, pedagang melewati data kartu melalui bagian belakangnya - untuk ini Anda harus mematuhi PCI DSS, yang mahal, panjang dan sulit. <br><br><h2>  SDK Seluler </h2><br>  SDK seluler Yandex.Kassi adalah perpustakaan untuk iOS dan Android yang telah kami buat untuk menyederhanakan kehidupan pedagang, pengembang aplikasi, dan mereka yang peduli dengan penggunanya.  Bahkan, SDK seluler adalah alat untuk tokenizing kartu bank dan instrumen pembayaran lainnya.  Tokenisasi adalah pertukaran data yang diperlukan untuk melakukan pembayaran untuk pengidentifikasi unik - token. <br><br>  Di musim semi, kami meluncurkan versi pertama SDK - ada pembayaran dengan kartu dan dari dompet Yandex.Money.  Sekarang semuanya menjadi lebih baik - dalam rilis Juli mereka menambahkan Google Pay, Apple Pay dan pembayaran melalui Sberbank dengan konfirmasi melalui SMS. <br><br><h2>  Tentang manfaatnya </h2><br><img src="https://habrastorage.org/webt/1v/pt/9y/1vpt9yly6mhhzyl8ncqv374pbki.gif" align="left">  Manfaat utama adalah bahwa pembeli membayar apa pun, tetapi bagi pedagang, kelihatannya seperti token yang dapat dioperasikan alih-alih data pembayaran. <br><br>  Belum diperlukan untuk lulus sertifikasi untuk kepatuhan PCI DSS - data kartu akan diproses pada perimeter kami.  Setiap tahun kami melewati sertifikasi, mematuhi semua peraturan regulator, dan menghilangkan toko yang terhubung ke Kasir.  Jadi itu mungkin. <br><br>  Dengan SDK, pembayaran di Android dan iOS terlihat familier bagi pengguna, dan sekarang mereka tidak perlu meninggalkan konteks aplikasi pada saat pembayaran.  Mereka yang membayar dari dompet elektronik juga tidak perlu masuk - jika pengguna masuk ke aplikasi Uang, Anda hanya perlu memilih akun yang Anda butuhkan melalui Yandex.Passport. <br><br><h2>  Bagaimana cara mulai menggunakan di rumah? </h2><br>  Jika ingin menyamaratakan sepenuhnya, maka dua hal perlu dilakukan: <br><br><ul><li>  Integrasikan API pembayaran Yandex.Cash - untuk menerima pembayaran; </li><li>  Hubungkan SDK seluler - untuk tokenisasi dan antarmuka asli. </li></ul><br>  Untuk menambahkan Apple Pay, cukup untuk mengaktifkan penerimaan pembayaran kartu bank dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kunci masalah</a> di akun pengembang Apple. <br><br>  Google Pay sedikit berbeda.  Membutuhkan: <br><br><ol><li>  Mempersiapkan test build dari APK. </li><li>  Isi daftar periksa integrasi - konfirmasi bahwa aplikasi Anda tidak akan mengambil alih dunia, dan beberapa hal lagi. </li><li>  Isi majelis untuk verifikasi di Google Pay. </li></ol><br>  Google akan memeriksa semuanya dan mengizinkan (atau tidak mengizinkan) memposting aplikasi di Google Play. <br><br>  SDK seluler disematkan dalam aplikasi klien sehingga pembayaran asli dapat melewatinya.  Kerjanya seperti ini: detail kartu langsung ke perimeter PCI DSS kami, tanpa jatuh ke backend toko.  Kami memeriksa, memproses, dan mengembalikan token pembayaran kepada pedagang dengan masa pakai 30 menit - dapat digunakan sekali. <br><br><img src="https://habrastorage.org/webt/i_/ys/q7/i_ysq7ohb0g2qmlcpstlkjduzzu.png"><br>  <i>Skema interaksi pengguna, pedagang, SDK seluler, dan API Ya.Kassa</i> <br><br>  Dengan partisipasi SDK, pembayaran terdiri dari tiga tahap: <br><br><ol><li>  Inisiasi pembayaran dan penerimaan token.  Aplikasi memulai pembayaran melalui SDK, dan menerima token pembayaran di output. </li><li>  Buat pembayaran.  Token masuk ke server, yang memulai pembayaran melalui API. </li><li>  Minta status pembayaran.  Ini diperlukan untuk menggambar jendela yang benar dengan keberhasilan atau kesalahan. </li></ol><br><h4>  Kenapa itu bagus? </h4><br><ol><li>  Arsitekturnya homogen dalam berbagai skenario pembayaran. </li><li>  Tidak perlu bekerja dengan kartu kredit di bagian belakang toko. </li></ol><br><h2>  Tentang pengembangan dan pengujian </h2><br>  Dalam versi iOS kami menggunakan VIPER dan layanan microser. <br><br>  Modul tokenization adalah landasan SDK seluler - modul ini mengontrol proses sehingga pedagang hanya melihat token untuk output Yandex.Kassi API, terlepas dari apa yang dibayar pengguna.  Modul tokenization lain memutuskan jendela mana yang akan ditampilkan kepada pengguna sekarang, dan membuat permintaan POST ke server.  Kami menulis pembungkus untuk API untuk bekerja dengan permintaan HTTP / HTTPS ke YandexMoneyCoreApi - ini membuat hidup lebih mudah. <br><br>  Layanan adalah penyimpanan dan objek yang berfungsi dengan API klien Yandex.Kassi. <br>  Kode mereka ternyata bersih dan ringkas, tanpa banyak cabang dan pintu keluar awal, karena departemen pengembangan berhasil memikirkan seluruh arsitektur sebelumnya.  Layanan SDK memiliki jumlah pemrograman fungsional terkonsentrasi - di sini kami telah mengungkapkan kemampuannya secara penuh.  Di mana kami harus bekerja dengan Functor, Monad, Functor Applicative, Janji biasa membantu kami. <br><br><pre><code class="hljs pgsql">let <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = PaymentOptions.<span class="hljs-keyword"><span class="hljs-keyword">Method</span></span>(oauthToken: clientApplicationKey, passportAuthorization: passportToken, gatewayId: gatewayId, amount: amount, currency: currency) let paymentOptions = <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(apiMethod: <span class="hljs-keyword"><span class="hljs-keyword">method</span></span>).responseApi() let allItems = getItems &lt;^&gt; paymentOptions let items = paymentMethodHandler.filterPaymentMethods &lt;^&gt; allItems let itemsWithEmptyError = items .recover(<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">global</span></span>(), mapError) .<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(makeErrors) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> itemsWithEmptyError</code> </pre> <br>  Satu-satunya kesulitan muncul dengan VIPER - kami mulai menambahkan jenis pembayaran baru dan menyadari bahwa modul pusat berkembang pesat.  Ketika ada sekitar 1000 baris di dalamnya, kami memutuskan bahwa kami harus melakukan sesuatu dengan ini dan merevisi arsitekturnya. <br><br>  Kami menyukai gagasan modul pusat untuk proses tersebut, dan kami memutuskan untuk meninggalkannya.  Dalam proyek lain, kami menggunakan mesin negara hingga deterministik untuk menggambarkan proses, tetapi di sini tidak akan menyelesaikan masalah, karena implementasi banyak hal akan tetap dalam modul yang sama.  Jadi kami memutuskan untuk menerapkan pola "strategi" untuk mengisolasi proses setiap instrumen pembayaran.  Setelah pengguna memilih metode pembayaran, kami membuat strategi untuk metode pembayaran, yang mengontrol kartu transisi dan memutuskan proses mana yang diikuti. <br><br><h3>  Aplikasi demo </h3><br><img src="https://habrastorage.org/webt/jq/dd/go/jqddgovdbutq7q1gijnex5do6ho.gif" align="left">  Kami berhasil. <br><br>  Semuanya dimulai dengan fakta bahwa departemen pengujian membutuhkan sesuatu untuk menguji SDK seluler.  Tanpa aplikasi pengujian, mereka tidak dapat memeriksa cara kerja SDK, dan tidak ada pengembang untuk kedua platform di antara penguji. <br><br>  Dalam prosesnya, ternyata, selain tugas pengujian, aplikasi demo adalah cara yang baik untuk menunjukkan kepada mitra kami apa itu SDK seluler.  Siapa pun yang tidak tahu cara memprogram di Swift atau Kotlin (baca: siapa saja) dapat melihat cara kerja SDK.  Karena itu, kami mengunggah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">aplikasi demo di Google Play</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=http://itms-services//%3Faction%3Ddownload-manifest%26url%3D">versi iOS ke situs web Yandex.Cash.</a> <br><br>  Ternyata hal di mana Anda dapat melihat cara kerja berbagai metode pembayaran, bermain dengan pengaturan atau menunjukkannya kepada seseorang yang bertanggung jawab untuk memilih agregator pembayaran.  Jangan malu-malu. <br><br><h2>  Sumber terbuka </h2><br>  Beberapa bulan setelah peluncuran, kami mendistribusikan perpustakaan dengan sangat tidak nyaman - membagikan tautan ke situs atau mengirim file melalui surat.  Orang baik tidak melakukan ini - mereka memposting semuanya di GitHub di bawah lisensi MIT.  Jadi kami melakukan hal itu. <br><br>  Selain keajaiban tokenization, pedagang dapat menyesuaikan warna, mengubah logo, atau membuat perubahan lain ke perpustakaan.  Dan untuk membuatnya sangat nyaman, kami menerbitkan SDK seluler di CocoaPods untuk pengembang iOS dan Maven untuk Android. <br><br>  Jika Anda sudah menerima pembayaran melalui Kasir, tetapi sekarang Anda ingin melakukannya dengan lebih baik dan lebih produktif - hubungkan SDK seluler.  Jika Anda baru saja membuka toko, hubungkan Kasir.  Kami baik-baik saja. <br><br><h2>  Tautan yang bermanfaat </h2><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Perpustakaan untuk aplikasi seluler</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi SDK</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SDK untuk iOS</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Android</a> di GitHub. <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Maven</a> <br><br>  Itu saja.  Ajukan pertanyaan di komentar! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id416871/">https://habr.com/ru/post/id416871/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id416857/index.html">Kami membangun kuil - dalam kode dan dalam kehidupan. Pengalaman saya mengembangkan aplikasi Android kedua saya</a></li>
<li><a href="../id416859/index.html">Temui Semua Seketika Bereaksi Boilerplate oleh Maximilian Stoiber v3.6.0</a></li>
<li><a href="../id416863/index.html">Cara baru untuk memperkenalkan peserta pameran</a></li>
<li><a href="../id416865/index.html">Desain retro untuk konsol portabel pertama dari tahun 1979 yang jauh</a></li>
<li><a href="../id416867/index.html">Para peneliti telah menciptakan perangkat untuk serangan lokal pada sistem SCADA</a></li>
<li><a href="../id416877/index.html">Cetak Manajemen Infrastruktur</a></li>
<li><a href="../id416879/index.html">Agile Office: Tempat Tuan Rumah Seribu Pengembang?</a></li>
<li><a href="../id416881/index.html">Pengantar kontrak pintar. Potensi dan keterbatasan nyata mereka</a></li>
<li><a href="../id416883/index.html">Bagaimana saya menulis Postcrossing saya</a></li>
<li><a href="../id416885/index.html">Layanan kebugaran lagi "menyerahkan semua penampilan" pemerintah, militer dan layanan khusus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>