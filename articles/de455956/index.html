<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍💻 👩🏾‍🚀 🥔 Chromium ist nicht nur ein Browser, sondern auch ein gutes Framework 🙅🏻 🥋 👳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die meisten Menschen sind daran gewöhnt, dass Chromium sowohl ein Browser als auch die Basis für andere Browser ist. Bis vor kurzem habe ich das auch ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Chromium ist nicht nur ein Browser, sondern auch ein gutes Framework</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/455956/"><img src="https://habrastorage.org/webt/ue/ye/xv/ueyexvk-uewnyghxhvtud7vugrq.jpeg"><br><br>  Die meisten Menschen sind daran gewöhnt, dass Chromium sowohl ein Browser als auch die Basis für andere Browser ist.  Bis vor kurzem habe ich das auch gedacht, aber als ich dieses Thema ein paar Monate lang studierte, begann ich, eine andere wundervolle Welt zu entdecken.  Chrom ist ein riesiges Ökosystem, in dem es alles gibt: ein Abhängigkeitssystem, ein plattformübergreifendes Build-System und Komponenten für fast alle Gelegenheiten.  Warum also nicht versuchen, mit all dieser Kraft eigene Anwendungen zu erstellen? <br><br>  Unter kat eine kleine Anleitung, wie man damit anfängt. <br><a name="habracut"></a><br><h2>  Umweltvorbereitung </h2><br>  In dem Artikel, in dem ich Ubuntu 18.04 verwenden werde, finden Sie die Vorgehensweise für andere Betriebssysteme in der Dokumentation: <br><br><ul><li>  <a href="">Linux</a> <br></li><li>  <a href="">Windows</a> <br></li><li>  <a href="">Mac</a> <br></li></ul><br>  Die folgenden Schritte erfordern Git und Python.  Wenn sie nicht installiert sind, müssen sie mit dem folgenden Befehl installiert werden: <br><br><pre><code class="bash hljs">sudo apt install git python</code> </pre> <br><h3>  Depot_tools einstellen </h3><br>  <code>depot_tools</code> ist ein Chromium-Entwicklungs-Toolkit.  Um es zu installieren, müssen Sie Folgendes ausführen: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://chromium.googlesource.com/chromium/tools/depot_tools.git</code> </pre> <br>  Fügen Sie den Pfad zur Umgebungsvariablen PATH hinzu: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">:/path/to/depot_tools"</span></span></code> </pre> <br>  Wichtig: Wenn <code>depot_tools</code> in Ihren Home-Ordner heruntergeladen wurde, verwenden Sie <code>~</code> in der <code>PATH</code> Variablen, da sonst Probleme auftreten können.  Sie müssen die Variable <code>$HOME</code> : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${HOME}</span></span></span><span class="hljs-string">/depot_tools"</span></span></code> </pre> <br><h3>  Code abrufen </h3><br>  Zuerst müssen Sie einen Ordner für die Quelle erstellen.  Zum Beispiel im Home-Verzeichnis (ca. 30 GB freier Speicherplatz werden benötigt): <br><br><pre> <code class="bash hljs">mkdir ~/chromium &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/chromium</code> </pre> <br>  Danach können Sie die Quellen mit dem Dienstprogramm <code>fetch</code> von <code>depot_tools</code> : <br><br><pre> <code class="bash hljs">fetch --nohooks --no-history chromium</code> </pre> <br>  Jetzt können Sie Tee / Kaffee trinken, da der Vorgang nicht schnell ist.  Für Experimente wird kein Verlauf benötigt, daher wird das Flag <code>--no-history</code> verwendet.  Die Geschichte wird noch länger sein. <br><br><h3>  Abhängigkeitsinstallation </h3><br>  Alle Quellen befinden sich im Ordner <code>src</code> . Gehen Sie dazu: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> src</code> </pre> <br>  Jetzt müssen Sie alle Abhängigkeiten mithilfe des Skripts einfügen: <br><br><pre> <code class="bash hljs">./build/install-build-deps.sh</code> </pre> <br>  Und lassen Sie die Haken laufen: <br><br><pre> <code class="bash hljs">gclient runhooks</code> </pre> <br>  Damit ist die Vorbereitung der Umgebung abgeschlossen. <br><br><h2>  System erstellen </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ninja wird</a> als <code>.ninja</code> für Chromium verwendet, und das <a href="">GN-</a> Dienstprogramm wird zum Generieren von <code>.ninja</code> Dateien verwendet. <br><br>  Um zu verstehen, wie diese Tools verwendet werden, schlage ich vor, ein Beispiel für ein Testdienstprogramm zu erstellen.  Erstellen Sie dazu einen <code>example</code> im Ordner <code>src</code> : <br><br><pre> <code class="bash hljs">mkdir example</code> </pre> <br>  Erstellen Sie dann im Ordner <code>src/example</code> die Datei <code>BUILD.gn</code> , die <code>BUILD.gn</code> enthält: <br><br><pre> <code class="cpp hljs">executable(<span class="hljs-string"><span class="hljs-string">"example"</span></span>) { sources = [ <span class="hljs-string"><span class="hljs-string">"example.cc"</span></span>, ] }</code> </pre> <br>  <code>BUILD.gn</code> besteht aus einem Ziel ( <code>example</code> ausführbaren Datei) und einer Liste von Dateien, die zum Erstellen des Ziels benötigt werden. <br><br>  Der nächste Schritt besteht darin, die Datei <code>example.cc</code> selbst zu erstellen.  Zunächst schlage ich vor, eine klassische Anwendung "Hallo Welt" zu erstellen: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; int main(int argc, char **argv) { std::cout &lt;&lt; "Hello world" &lt;&lt; std::endl; return 0; }</span></span></span></span></code> </pre> <br>  Der Quellcode ist auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> zu finden. <br><br>  Damit GN mehr über das neue Projekt <code>BUILD.gn</code> kann, fügen Sie in der Datei <code>BUILD.gn</code> in <code>src</code> die Zeile <code>"//example"</code> im Abschnitt <code>deps</code> : <br><br><pre> <code class="cpp hljs">... group(<span class="hljs-string"><span class="hljs-string">"gn_all"</span></span>) { testonly = <span class="hljs-literal"><span class="hljs-literal">true</span></span> deps = [ <span class="hljs-string"><span class="hljs-string">":gn_visibility"</span></span>, <span class="hljs-string"><span class="hljs-string">"//base:base_perftests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//base:base_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//base/util:base_util_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//chrome/installer"</span></span>, <span class="hljs-string"><span class="hljs-string">"//chrome/updater"</span></span>, <span class="hljs-string"><span class="hljs-string">"//net:net_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//services:services_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//services/service_manager/public/cpp"</span></span>, <span class="hljs-string"><span class="hljs-string">"//skia:skia_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//sql:sql_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//third_party/flatbuffers:flatbuffers_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//tools/binary_size:binary_size_trybot_py"</span></span>, <span class="hljs-string"><span class="hljs-string">"//tools/ipc_fuzzer:ipc_fuzzer_all"</span></span>, <span class="hljs-string"><span class="hljs-string">"//tools/metrics:metrics_metadata"</span></span>, <span class="hljs-string"><span class="hljs-string">"//ui/base:ui_base_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//ui/gfx:gfx_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//url:url_unittests"</span></span>, # ↓↓↓↓↓↓↓↓ <span class="hljs-string"><span class="hljs-string">"//example"</span></span>, ] ...</code> </pre> <br>  Jetzt müssen Sie zum Ordner <code>src</code> und das Projekt mit dem folgenden Befehl generieren: <br><br><pre> <code class="bash hljs">gn gen out/Default</code> </pre> <br>  Mit GN können Sie auch ein Projekt für eine der unterstützten IDEs vorbereiten: <br><br><ul><li>  Sonnenfinsternis <br></li><li>  vs. <br></li><li>  vs2013 <br></li><li>  vs2015 <br></li><li>  vs2017 <br></li><li>  vs2019 <br></li><li>  xcode <br></li><li>  qtcreator <br></li><li>  json <br></li></ul><br>  Weitere Informationen erhalten Sie mit dem Befehl: <br><br><pre> <code class="bash hljs">gn <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> gen</code> </pre> <br>  Um beispielsweise mit dem <code>example</code> in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">QtCreator zu arbeiten, müssen</a> Sie den folgenden Befehl ausführen: <br><br><pre> <code class="bash hljs">gn gen --ide=qtcreator --root-target=example out/Default</code> </pre> <br>  Danach können Sie das Projekt in QtCreator öffnen: <br><br><pre> <code class="bash hljs">qtcreator out/Default/qtcreator_project/all.creator</code> </pre> <br>  Der letzte Schritt besteht darin, das Projekt mit Ninja zu erstellen: <br><br><pre> <code class="bash hljs">autoninja -C out/Default example</code> </pre> <br>  Diese kurze Einführung in das Montagesystem kann abgeschlossen werden. <br><br>  Die Anwendung kann mit dem folgenden Befehl gestartet werden: <br><br><pre> <code class="bash hljs">./out/Default/example</code> </pre> <br>  Und siehe Hallo Welt.  In der Tat können Sie einen separaten Artikel über das Montagesystem in Chromium schreiben.  Vielleicht nicht einer. <br><br><h2>  Arbeiten Sie mit der Befehlszeile </h2><br>  Als erstes Beispiel für die Verwendung der Chromium-Codebasis als Framework empfehle ich, mit der Befehlszeile herumzuspielen. <br><br>  Aufgabe: <i>Alle an die Anwendung übergebenen Argumente im Chromium-Stil anzeigen.</i> <br>  Um mit der Befehlszeile arbeiten zu können, müssen Sie die Header-Datei in example.cc einfügen: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#include "base/command_line.h"</span></span></code> </pre> <br>  Außerdem dürfen wir nicht vergessen, in <code>BUILD.gn</code> eine Abhängigkeit vom <code>BUILD.gn</code> .  <code>BUILD.gn</code> sollte folgendermaßen aussehen: <br><br><pre> <code class="cpp hljs">executable(<span class="hljs-string"><span class="hljs-string">"example"</span></span>) { sources = [ <span class="hljs-string"><span class="hljs-string">"example.cc"</span></span>, ] deps = [ <span class="hljs-string"><span class="hljs-string">"//base"</span></span>, ] }</code> </pre> <br>  Jetzt wird alles, was Sie brauchen, mit dem <code>example</code> . <br><br>  Um mit der Befehlszeile zu arbeiten, stellt Chromium eine Singleton- <code>base::CommandLine</code> bereit <code>base::CommandLine</code> .  Um einen Link dazu zu erhalten, müssen Sie die statische Methode <code>base::CommandLine::ForCurrentProcess</code> . Zuerst müssen Sie sie jedoch mit der <code>base::CommandLine::Init</code> Methode initialisieren: <br><br><pre> <code class="cpp hljs">base::CommandLine::Init(argc, argv); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> *cmd_line = base::CommandLine::ForCurrentProcess();</code> </pre> <br>  Alle Argumente, die in der Befehlszeile an die Anwendung übergeben werden und mit einem <code>-</code> mit der <code>GetSwitches</code> Methode als <code>base::SwitchMap</code> (im Wesentlichen <code>map&lt;string, string&gt;</code> ) <code>GetSwitches</code> .  Alle anderen Argumente werden als <code>base::StringVector</code> (im Wesentlichen <code>vectr&lt;strig&gt;</code> ).  Dieses Wissen reicht aus, um den Code für die Aufgabe zu implementieren: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;sw : cmd_line-&gt;GetSwitches()) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Switch "</span></span> &lt;&lt; sw.first &lt;&lt; <span class="hljs-string"><span class="hljs-string">": "</span></span> &lt;&lt; sw.second &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;arg: cmd_line-&gt;GetArgs()) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Arg "</span></span> &lt;&lt; arg &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre> <br>  Die Vollversion finden Sie auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> . <br><br>  Um die Anwendung zu erstellen und auszuführen, müssen Sie Folgendes ausführen: <br><br><pre> <code class="bash hljs">autoninja -C out/Default example ./out/Default/example arg1 --sw1=val1 --sw2 arg2</code> </pre> <br>  Der Bildschirm zeigt Folgendes an: <br><br><pre> <code class="bash hljs">Switch sw1: val1 Switch sw2: Arg arg1 Arg arg2</code> </pre> <br><h2>  Vernetzung </h2><br>  Als zweites und letztes Beispiel für heute schlage ich vor, mit dem Netzwerkteil von Chromium zu arbeiten. <br><br>  Aufgabe: <i>Zeigen Sie den Inhalt der als Argument übergebenen URL an</i> . <br><br><h3>  Chromium Network Subsystem </h3><br>  Das Netzwerksubsystem ist ziemlich groß und komplex.  Der Einstiegspunkt für Anforderungen an HTTP, HTTPS, FTP und andere <code>URLRequest</code> ist <code>URLRequest</code> , mit dem bereits festgelegt wird, welcher Client verwendet werden soll.  Ein vereinfachtes Diagramm sieht folgendermaßen aus: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d6/b9f/e45/7d6b9fe45ac8c5a47d51e4522735e5eb.png"><br><br>  <i>Die Vollversion finden Sie in der <a href="">Dokumentation</a> .</i> <br><br>  Um eine <code>URLRequest</code> zu erstellen <code>URLRequest</code> müssen Sie einen <code>URLRequestContext</code> .  Das Erstellen eines Kontexts ist eine ziemlich komplizierte Operation, daher wird empfohlen, <code>URLRequestContextBuilder</code> zu verwenden.  Es werden alle erforderlichen Variablen mit Standardwerten initialisiert, aber falls gewünscht, können sie in ihre eigenen geändert werden, zum Beispiel: <br><br><pre> <code class="cpp hljs">net::URLRequestContextBuilder context_builder; context_builder.DisableHttpCache(); context_builder.SetSpdyAndQuicEnabled(<span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-comment"><span class="hljs-comment">/* http2 */</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-comment"><span class="hljs-comment">/* quic */</span></span>); context_builder.SetCookieStore(<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>);</code> </pre> <br><h3>  Multithreading </h3><br>  Der Chromium-Netzwerkstapel ist für die Verwendung in einer Umgebung mit mehreren Threads ausgelegt, sodass Sie dieses Thema nicht überspringen können.  Die grundlegenden Objekte für die Arbeit mit Multithreading in Chromium sind: <br><br><ul><li>  Aufgabe - Eine auszuführende Aufgabe. In Chromium handelt es sich um eine Funktion vom Typ <code>base::Callback</code> , die mit <code>base::Bind</code> erstellt werden <code>base::Bind</code> . <br></li><li>  Aufgabenwarteschlange - Die auszuführende Aufgabenwarteschlange. <br></li><li>  Physischer Thread - Ein plattformübergreifender Wrapper über den Betriebssystem-Thread ( <code>pthread</code> unter POSIX oder <code>CreateThread()</code> unter Windows).  In der <code>base::PlatformThread</code> Klasse implementiert, nicht direkt verwenden. <br></li><li>  base :: Thread - ein echter Thread, der Nachrichten aus einer dedizierten Task-Warteschlange endlos verarbeitet;  Es wird nicht empfohlen, sie direkt zu erstellen. <br></li><li>  Thread-Pool - Thread-Pool mit einer allgemeinen Task-Warteschlange.  Implementiert in der <code>base::ThreadPool</code> Klasse.  Erstellen Sie in der Regel eine Instanz.  Aufgaben werden mit Funktionen aus <code>base/task/post_task.h</code> an sie <code>base/task/post_task.h</code> . <br></li><li>  Sequenz oder virtueller Thread - Ein virtueller Thread, der reale Threads verwendet und zwischen diesen wechseln kann. <br></li><li>  Task Runner - eine Schnittstelle zum Festlegen von Aufgaben, die in der <code>base::TaskRunner</code> . <br></li><li>  Sequenced Task Runner - eine Schnittstelle zum Festlegen von Aufgaben, die sicherstellt, dass Aufgaben in derselben Reihenfolge ausgeführt werden, in der sie angekommen sind.  Implementiert in der <code>base::SequencedTaskRunner</code> Klasse. <br></li><li>  Single-Thread-Task-Runner - ähnlich dem vorherigen, garantiert jedoch, dass alle Tasks in einem OS-Thread ausgeführt werden.  Implementiert in der <code>base::SingleThreadTaskRunner</code> . <br></li></ul><br><h3>  Implementierung </h3><br>  Für einige Chromium-Komponenten ist <code>base::AtExitManager</code> erforderlich. <code>base::AtExitManager</code> dieser Klasse können Sie Vorgänge registrieren, die beim Beenden der Anwendung ausgeführt werden müssen.  Die Verwendung ist sehr einfach. Sie müssen ein Objekt auf dem Stapel erstellen: <br><br><pre> <code class="cpp hljs">base::AtExitManager exit_manager;</code> </pre> <br>  Wenn <code>exit_manager</code> Gültigkeitsbereich <code>exit_manager</code> , werden alle registrierten Rückrufe ausgeführt. <br><br>  Jetzt müssen Sie sich um die Verfügbarkeit aller erforderlichen Multithreading-Komponenten für das Netzwerksubsystem kümmern.  Erstellen Sie dazu einen <code>Thread pool</code> , eine <code>Message loop</code> Typ <code>TYPE_IO</code> zum Verarbeiten von Netzwerknachrichten und eine <code>Run loop</code> - die Hauptprogrammschleife: <br><br><pre> <code class="cpp hljs">base::ThreadPool::CreateAndStartWithDefaultParams(<span class="hljs-string"><span class="hljs-string">"downloader"</span></span>); base::<span class="hljs-function"><span class="hljs-function">MessageLoop </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">msg_loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(base::MessageLoop::TYPE_IO)</span></span></span></span>; base::RunLoop run_loop;</code> </pre> <br>  Verwenden Sie als Nächstes den <code>Context builder</code> , um einen <code>Context</code> zu erstellen: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> ctx = net::URLRequestContextBuilder().Build();</code> </pre> <br>  Um eine Anfrage zu senden, müssen Sie ein <code>URLRequest</code> Objekt mit der <code>CreateRequest</code> Methode des <code>ctx</code> Objekts erstellen.  Folgende Parameter werden übergeben: <br><br><ul><li>  URL, Zeichenfolge vom Typ GURL; <br></li><li>  Priorität; <br></li><li>  Delegat, der Ereignisse behandelt. <br></li></ul><br>  Ein Delegat ist eine Klasse, die die Schnittstelle <code>net::URLRequest::Delegate</code> implementiert.  Für diese Aufgabe kann es so aussehen: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyDelegate</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> net::URLRequest::Delegate { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyDelegate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(base::Closure quit_closure)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quit_closure_</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::move(quit_closure))</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buf_</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(base::MakeRefCounted&lt;net::IOBuffer&gt;(BUF_SZ))</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnReceivedRedirect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest *request, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> net::RedirectInfo &amp;redirect_info, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *defer_redirect)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"redirect to "</span></span> &lt;&lt; redirect_info.new_url &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnAuthRequired</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest* request, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> net::AuthChallengeInfo&amp; auth_info)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"auth req"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnCertificateRequested</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest *request, net::SSLCertRequestInfo *cert_request_info)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"cert req"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnSSLCertificateError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest* request, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> net_error, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> net::SSLInfo&amp; ssl_info, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fatal)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"cert err"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnResponseStarted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest *request, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> net_error)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"resp started"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> n = request-&gt;Read(buf_.get(), BUF_SZ); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"resp read "</span></span> &lt;&lt; n &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == net::ERR_IO_PENDING) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { OnReadCompleted(request, n); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(buf_-&gt;data(), n) &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnReadCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest *request, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bytes_read)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"completed"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; quit_closure_.Run(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: base::Closure quit_closure_; scoped_refptr&lt;net::IOBuffer&gt; buf_; };</code> </pre> <br>  Die gesamte <code>OnResponseStarted</code> befindet sich im <code>OnResponseStarted</code> Ereignishandler: Der Inhalt der Antwort wird subtrahiert, bis ein Fehler auftritt oder nichts mehr zu lesen ist.  Da der Delegat nach dem Lesen der Antwort zum Abschließen der Anwendung Zugriff auf die Funktion haben muss, die die Hauptlaufschleife unterbricht, wird in diesem Fall ein Rückruf vom Typ <code>base::Closure</code> verwendet. <br><br>  Jetzt ist alles bereit, um die Anfrage zu senden: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">MyDelegate </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delegate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(run_loop.QuitClosure())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> req = ctx-&gt;CreateRequest(GURL(args[<span class="hljs-number"><span class="hljs-number">0</span></span>]), net::RequestPriority::DEFAULT_PRIORITY, &amp;delegate); req-&gt;Start();</code> </pre> <br>  Damit die Anforderung die Verarbeitung starten kann, müssen Sie die <code>Run loop</code> ausführen: <br><br><pre> <code class="cpp hljs">run_loop.Run();</code> </pre> <br>  Die Vollversion finden Sie auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> . <br><br>  Um die Anwendung zu erstellen und auszuführen, müssen Sie Folgendes ausführen: <br><br><pre> <code class="bash hljs">autoninja -C out/Default example out/Default/example <span class="hljs-string"><span class="hljs-string">"https://example.com/"</span></span></code> </pre> <br><h2>  Finale </h2><br>  In Chromium finden Sie viele nützliche Würfel und Bausteine, aus denen Sie Anwendungen erstellen können.  Es entwickelt sich ständig weiter, was einerseits ein Plus ist, und andererseits lassen regelmäßige Änderungen an der API Sie nicht entspannen.  In der neuesten Version wurde <code>base::TaskScheduler</code> <code>base::ThreadPool</code> glücklicherweise zu <code>base::ThreadPool</code> , ohne die API zu ändern. <br><br>  PS Wir suchen einen führenden C ++ - Programmierer in unserem Team!  Wenn Sie die Stärke in sich spüren, werden unsere Wünsche hier beschrieben: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">team.mail.ru/vacancy/4641/</a> .  Es gibt auch eine Schaltfläche "Antworten". </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de455956/">https://habr.com/ru/post/de455956/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de455944/index.html">Arbeiten Sie mit Freiberuflern. Sich fortbewegen lernen</a></li>
<li><a href="../de455948/index.html">RAMBleed: Ruft in 34 Stunden einen RSA-Schlüssel ab</a></li>
<li><a href="../de455950/index.html">Die seltensten und teuersten Programmiersprachen. Teil II</a></li>
<li><a href="../de455952/index.html">Codegenerierung mit Roslyn</a></li>
<li><a href="../de455954/index.html">Nutzung und Schutz des Erbes in der modernen Welt</a></li>
<li><a href="../de455958/index.html">Sich entwickelnde zelluläre Automaten</a></li>
<li><a href="../de455960/index.html">Warum Entwickler gehen: 8 Gründe</a></li>
<li><a href="../de455962/index.html">Data Science und die Tropenkonferenz</a></li>
<li><a href="../de455966/index.html">Top 5 Unternehmen für die Entwicklung mobiler Apps in Großbritannien</a></li>
<li><a href="../de455970/index.html">Alles, was Sie über SwiftUI wissen wollten, aber Angst hatten zu fragen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>