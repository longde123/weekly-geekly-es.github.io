<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç° ü§∏üèø üìù RecyclerView na velocidade m√°xima: analisando bibliotecas üïé ‚õΩÔ∏è üßòüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ilya Nekrasov, Mahtalitet , desenvolvedor Android do KODE 
 Por dois anos e meio no desenvolvimento do Android, consegui trabalhar em projetos complet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>RecyclerView na velocidade m√°xima: analisando bibliotecas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redmadrobot/blog/428525/"><p><img src="https://habrastorage.org/webt/02/i_/cl/02i_cl7q71uldgrkijpim0a0agk.jpeg"></p><br><p><img src="https://habrastorage.org/webt/np/kh/rc/npkhrc7elthbz0riiye9ri5zu1g.png" align="left">  <strong>Ilya Nekrasov, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Mahtalitet</a> , desenvolvedor Android do KODE</strong> <br>  <em>Por dois anos e meio no desenvolvimento do Android, consegui trabalhar em projetos completamente diferentes: de uma rede social para motoristas e um banco da Let√¥nia a um sistema federal de b√¥nus e a terceira companhia a√©rea de transporte.</em>  <em>De qualquer forma, em cada um desses projetos, deparei-me com tarefas que exigiam a busca de solu√ß√µes n√£o cl√°ssicas ao implementar listas usando a classe RecyclerView.</em> <em><br></em>  <em>Este artigo - fruto da prepara√ß√£o para uma apresenta√ß√£o no DevFest Kaliningrad'18, bem como da comunica√ß√£o com colegas - ser√° especialmente √∫til para desenvolvedores iniciantes e para aqueles que usaram apenas uma das bibliotecas existentes.</em> </p><br><p>  Para come√ßar, investigamos um pouco a ess√™ncia da quest√£o e a fonte da dor, a saber, o crescimento da funcionalidade no desenvolvimento do aplicativo e a complexidade das listas usadas. </p><a name="habracut"></a><br><h2 id="glava-pervaya-v-kotoroy-zakazchik-mechtaet-o-prilozhenii-a-my--o-chetkih-trebovaniyah">  Cap√≠tulo um, no qual o cliente sonha com um aplicativo, e n√≥s - sobre requisitos claros </h2><br><p><img src="https://habrastorage.org/webt/fi/wb/vs/fiwbvsaeyquagqloswybveolmaq.gif" align="right">  Vamos imaginar uma situa√ß√£o em que um cliente entra em contato com um est√∫dio que deseja um aplicativo m√≥vel para uma loja de patos de borracha. </p><br><p>  O projeto est√° se desenvolvendo rapidamente, novas id√©ias surgem regularmente e n√£o s√£o enquadradas em um roteiro de longo prazo. </p><br><p>  Primeiro, o cliente solicita que mostremos uma lista de mercadorias existentes e, quando clicadas, preenche uma solicita√ß√£o de entrega.  Voc√™ n√£o precisa ir muito longe para encontrar uma solu√ß√£o: usamos o conjunto cl√°ssico do <strong>RecyclerView</strong> , um simples adaptador auto-escrito para ele e <strong>Activity</strong> . </p><br><p>  Para o adaptador, usamos dados homog√™neos, um <strong>ViewHolder</strong> e l√≥gica de liga√ß√£o simples. </p><br><div class="spoiler">  <b class="spoiler_title">Adaptador com patos</b> <div class="spoiler_text"><pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DucksClassicAdapter</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: List&lt;Duck&gt;, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> onDuckClickAction: (Duck) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> ) : RecyclerView.Adapter&lt;DucksClassicAdapter.ViewHolder&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">, viewType: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ViewHolder { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rubberDuckView = LayoutInflater.from(parent.context).inflate(R.layout.item_rubber_duck, parent, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ViewHolder(rubberDuckView) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> duck = <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>[position] holder.divider.isVisible = position != <span class="hljs-number"><span class="hljs-number">0</span></span> holder.rubberDuckImage.apply { Picasso.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() .load(duck.icon) .config(Bitmap.Config.ARGB_4444) .fit() .centerCrop() .noFade() .placeholder(R.drawable.duck_stub) .into(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } holder.clicksHolder.setOnClickListener { onDuckClickAction.invoke(duck) } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.count() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span></span>(view: View) : RecyclerView.ViewHolder(view) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rubberDuckImage: ImageView = view.findViewById(R.id.rubberDuckImage) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clicksHolder: View = view.findViewById(R.id.clicksHolder) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> divider: View = view.findViewById(R.id.divider) } }</code> </pre> </div></div><br><p><br><br><img src="https://habrastorage.org/webt/kh/bn/x3/khbnx3_a59poubdcheopd3e5ax4.gif" align="left">  Com o tempo, o cliente teve a ideia de adicionar outra categoria de mercadorias aos patos de borracha, o que significa que ele precisar√° adicionar um novo modelo de dados e um novo layout.  Mais importante, por√©m, outro <strong>ViewType</strong> aparecer√° no adaptador, com o qual voc√™ pode determinar qual ViewHolder usar para um item de lista espec√≠fico. </p><br><p>  Depois disso, os cabe√ßalhos s√£o adicionados √†s categorias, segundo as quais cada categoria pode ser recolhida e expandida para simplificar a orienta√ß√£o dos usu√°rios na loja.  Isso √© mais outro <strong>ViewType</strong> e <strong>ViewHolder</strong> para cabe√ßalhos.  Al√©m disso, voc√™ ter√° que complicar o adaptador, pois voc√™ precisa manter uma lista de grupos abertos e us√°-lo para verificar a necessidade de ocultar e mostrar este ou aquele elemento clicando no cabe√ßalho. </p><br><div class="spoiler">  <b class="spoiler_title">Adaptador com tudo</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DucksClassicAdapter</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> onDuckClickAction: (Pair&lt;Duck, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> onSlipperClickAction: (Duck) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> onAdvertClickAction: (Advert) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> ) : RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: List&lt;Duck&gt; = emptyList() <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(value) { field = value internalData = <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.groupBy { it.javaClass.kotlin } .flatMap { groupedDucks -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> titleRes = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (groupedDucks.key) { DuckSlipper::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">slippers</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RubberDuck</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:class -&gt; R.string.rubber_ducks else -&gt; R.string.mixed_ducks } groupedDucks.value.let { listOf</span></span></span></span>(FakeDuck(titleRes, it)).plus(it) } } .toMutableList() duckCountsAdapters = internalData.map { duck -&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rubberDuck = (duck <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? RubberDuck) DucksCountAdapter( <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = (<span class="hljs-number"><span class="hljs-number">1</span></span>..(rubberDuck?.count ?: <span class="hljs-number"><span class="hljs-number">1</span></span>)).map { count -&gt; duck to count }, onCountClickAction = { onDuckClickAction.invoke(it) } ) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> advert = DuckMockData.adverts.orEmpty().shuffled().first() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> internalData: MutableList&lt;Duck&gt; = mutableListOf() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> duckCountsAdapters: List&lt;DucksCountAdapter&gt; = emptyList() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> collapsedHeaders: MutableSet&lt;Duck&gt; = hashSetOf() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">, viewType: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: RecyclerView.ViewHolder { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (viewType) { VIEW_TYPE_RUBBER_DUCK -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = parent.context.inflate(R.layout.item_rubber_duck, parent) DuckViewHolder(view) } VIEW_TYPE_SLIPPER_DUCK -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = parent.context.inflate(R.layout.item_duck_slipper, parent) SlipperViewHolder(view) } VIEW_TYPE_HEADER -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = parent.context.inflate(R.layout.item_header, parent) HeaderViewHolder(view) } VIEW_TYPE_ADVERT -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> view = parent.context.inflate(R.layout.item_advert, parent) AdvertViewHolder(view) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> UnsupportedOperationException(<span class="hljs-string"><span class="hljs-string">"view type </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$viewType</span></span></span><span class="hljs-string"> without ViewHolder"</span></span>) } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RecyclerView</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (holder) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> HeaderViewHolder -&gt; bindHeaderViewHolder(holder, position) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> DuckViewHolder -&gt; bindDuckViewHolder(holder, position) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> SlipperViewHolder -&gt; bindSlipperViewHolder(holder, position) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> AdvertViewHolder -&gt; bindAdvertViewHolder(holder) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindAdvertViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AdvertViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { holder.advertImage.showIcon(advert.icon) holder.advertTagline.text = advert.tagline holder.itemView.setOnClickListener { onAdvertClickAction.invoke(advert) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindHeaderViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HeaderViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> item = getItem(position) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> FakeDuck holder.clicksHolder.setOnClickListener { changeCollapseState(item, position) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> arrowRes = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (collapsedHeaders.contains(item)) R.drawable.ic_keyboard_arrow_up_black_24dp <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> R.drawable.ic_keyboard_arrow_down_black_24dp holder.arrow.setImageResource(arrowRes) holder.title.setText(item.titleRes) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeCollapseState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">FakeDuck</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> isCollapsed = collapsedHeaders.contains(item) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isCollapsed) { collapsedHeaders.remove(item) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { collapsedHeaders.add(item) } <span class="hljs-comment"><span class="hljs-comment">// 1 to add items after header val startPosition = position + 1 if (isCollapsed) { internalData.addAll(startPosition - ADVERTS_COUNT, item.items) notifyItemRangeInserted(startPosition, item.items.count()) } else { internalData.removeAll(item.items) notifyItemRangeRemoved(startPosition, item.items.count()) } notifyItemChanged(position) } @SuppressLint("SetTextI18n") private fun bindSlipperViewHolder(holder: SlipperViewHolder, position: Int) { val slipper = getItem(position) as DuckSlipper holder.duckSlipperImage.showIcon(slipper.icon) holder.duckSlipperSize.text = ": ${slipper.size}" holder.clicksHolder.setOnClickListener { onSlipperClickAction.invoke(slipper) } } private fun bindDuckViewHolder(holder: DuckViewHolder, position: Int) { val duck = getItem(position) as RubberDuck holder.rubberDuckImage.showIcon(duck.icon) holder.rubberDuckCounts.adapter = duckCountsAdapters[position - ADVERTS_COUNT] val context = holder.itemView.context holder.rubberDuckCounts.layoutManager = LinearLayoutManager(context, HORIZONTAL, false) } override fun getItemViewType(position: Int): Int { if (position == 0) return VIEW_TYPE_ADVERT return when (getItem(position)) { is FakeDuck -&gt; VIEW_TYPE_HEADER is RubberDuck -&gt; VIEW_TYPE_RUBBER_DUCK is DuckSlipper -&gt; VIEW_TYPE_SLIPPER_DUCK else -&gt; throw UnsupportedOperationException("unknown type for $position position") } } private fun getItem(position: Int) = internalData[position - ADVERTS_COUNT] override fun getItemCount() = internalData.count() + ADVERTS_COUNT class DuckViewHolder(view: View) : RecyclerView.ViewHolder(view) { val rubberDuckImage: ImageView = view.findViewById(R.id.rubberDuckImage) val rubberDuckCounts: RecyclerView = view.findViewById(R.id.rubberDuckCounts) } class SlipperViewHolder(view: View) : RecyclerView.ViewHolder(view) { val duckSlipperImage: ImageView = view.findViewById(R.id.duckSlipperImage) val duckSlipperSize: TextView = view.findViewById(R.id.duckSlipperSize) val clicksHolder: View = view.findViewById(R.id.clicksHolder) } class HeaderViewHolder(view: View) : RecyclerView.ViewHolder(view) { val title: TextView = view.findViewById(R.id.headerTitle) val arrow: ImageView = view.findViewById(R.id.headerArrow) val clicksHolder: View = view.findViewById(R.id.clicksHolder) } class AdvertViewHolder(view: View) : RecyclerView.ViewHolder(view) { val advertTagline: TextView = view.findViewById(R.id.advertTagline) val advertImage: ImageView = view.findViewById(R.id.advertImage) } } private class FakeDuck( val titleRes: Int, val items: List&lt;Duck&gt; ) : Duck private fun ImageView.showIcon(icon: String, placeHolderRes: Int = R.drawable.duck_stub) { Picasso.get() .load(icon) .config(Bitmap.Config.ARGB_4444) .fit() .centerCrop() .noFade() .placeholder(placeHolderRes) .into(this) } private class DucksCountAdapter( private val data: List&lt;Pair&lt;Duck, Int&gt;&gt;, private val onCountClickAction: (Pair&lt;Duck, Int&gt;) -&gt; Unit ) : RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;() { override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RecyclerView.ViewHolder { val view = parent.context.inflate(R.layout.item_duck_count, parent) return CountViewHolder(view) } override fun getItemCount() = data.count() override fun onBindViewHolder(holder: RecyclerView.ViewHolder, position: Int) { (holder as CountViewHolder).count.apply { val item = data[position] text = item.second.toString() setOnClickListener { onCountClickAction.invoke(item) } } } class CountViewHolder(view: View) : RecyclerView.ViewHolder(view) { val count: TextView = view.findViewById(R.id.count) } }</span></span></code> </pre> </div></div><br><p>  Eu acho que voc√™ entendeu o ponto - uma pilha de pouco se assemelha a um desenvolvimento saud√°vel.  E √† frente, h√° cada vez mais novos requisitos do cliente: fixar um banner de publicidade no topo da lista, perceber a possibilidade de escolher o n√∫mero de patos pedidos.  Somente essas tarefas acabar√£o se transformando em adaptadores regulares, que novamente ter√£o que ser gravados do zero. </p><br><blockquote>  O processo de desenvolvimento de um adaptador cl√°ssico na hist√≥ria do <a href="">github</a> </blockquote><br><h3 id="itogi">  Sum√°rio </h3><br><p>  De fato, o quadro n√£o √© nada animador: os adaptadores individuais precisam ser aprimorados para casos espec√≠ficos.  Todos n√≥s entendemos que em um aplicativo real existem dezenas ou mesmo centenas dessas telas de lista.  E eles n√£o cont√™m informa√ß√µes sobre patos, mas dados mais complexos.  Sim, e seu design √© muito mais complicado. </p><br><h3 id="chto-ne-tak-s-nashimi-adapterami">  O que h√° de errado com nossos adaptadores? </h3><br><ul><li>  obviamente, eles s√£o dif√≠ceis de reutilizar; </li><li>  dentro da l√≥gica de neg√≥cios aparece e com o tempo se torna cada vez mais; </li><li>  dif√≠cil de manter e expandir; </li><li>  alto risco de erros ao atualizar dados; </li><li>  design n√£o √≥bvio. </li></ul><br><h2 id="glava-vtoraya-v-kotoroy-vse-moglo-byt-inache">  Cap√≠tulo dois, em que tudo poderia ser diferente </h2><br><p>  N√£o √© realista e sem sentido imaginar o desenvolvimento do aplicativo nos pr√≥ximos anos.  Depois de algumas dan√ßas com um pandeiro, como no cap√≠tulo anterior, e escrevendo dezenas de adaptadores, qualquer pessoa ter√° uma pergunta: "Talvez haja outras solu√ß√µes?". </p><br><p><img src="https://habrastorage.org/webt/ct/6d/fx/ct6dfxsshhko-jfqycyqekpoqdu.jpeg"></p><br><p>  Depois de concluir o Github, descobrimos que a primeira biblioteca <strong>AdapterDelegates</strong> apareceu em 2015 e, um ano depois, o <strong>Groupie</strong> e o <strong>Epoxy</strong> adicionaram ao arsenal de desenvolvedores - todos eles ajudam a tornar a vida mais f√°cil, mas cada um tem suas pr√≥prias especificidades e armadilhas. </p><br><blockquote>  Existem v√°rias bibliotecas semelhantes (por exemplo, FastAdapter), mas nem eu nem meus colegas trabalhamos com elas, portanto, n√£o as consideraremos no artigo. </blockquote><p>  Antes de comparar as bibliotecas, analisamos brevemente o caso descrito acima com a loja on-line com a condi√ß√£o de usar o <strong>AdapterDelegates</strong> - das bibliotecas desmontadas, √© o mais simples do ponto de vista da implementa√ß√£o e uso interno (no entanto, n√£o √© avan√ßado em tudo, √© preciso adicionar muitas coisas manualmente). </p><br><p>  A biblioteca n√£o nos salvar√° completamente do adaptador, mas ser√° formada a partir de blocos (tijolos), que podem ser adicionados ou removidos com seguran√ßa da lista e trocados. </p><br><div class="spoiler">  <b class="spoiler_title">Adaptador de bloco</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DucksDelegatesAdapter</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ListDelegationAdapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">List&lt;DisplayableItem</span></span></span><span class="hljs-class">&gt;&gt;</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { delegatesManager.addDelegate(RubberDuckDelegate()) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(items: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DisplayableItem</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.items = items notifyDataSetChanged() } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RubberDuckDelegate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AbsListItemAdapterDelegate</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RubberDuckItem, DisplayableItem, RubberDuckDelegate.ViewHolder</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isForViewType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DisplayableItem</span></span></span></span><span class="hljs-function"><span class="hljs-params">, items: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DisplayableItem</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> RubberDuckItem } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ViewHolder { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> item = parent.context.inflate(R.layout.item_rubber_duck, parent, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ViewHolder(item) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RubberDuckItem</span></span></span></span><span class="hljs-function"><span class="hljs-params">, viewHolder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, payloads: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { viewHolder.apply { rubberDuckImage.showIcon(item.icon) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span></span>(itemView: View) : RecyclerView.ViewHolder(itemView) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rubberDuckImage: ImageView = itemView.findViewById(R.id.rubberDuckImage) } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Usando um Adaptador de Atividade</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DucksDelegatesActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppCompatActivity</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ducksList: RecyclerView <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) setContentView(R.layout.activity_ducks_delegates) ducksList = findViewById(R.id.duckList) ducksList.apply { layoutManager = LinearLayoutManager(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-symbol"><span class="hljs-symbol">@DucksDelegatesActivity</span></span>) adapter = createAdapter().apply { showData() } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: DucksDelegatesAdapter { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DucksDelegatesAdapter() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> DucksDelegatesAdapter.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { setData(getRubberDucks()) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRubberDucks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;DisplayableItem&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DuckMockData.ducks.orEmpty().map { RubberDuckItem(it.icon) } } }</code> </pre> </div></div><br><p>  Desde a primeira tarefa, vemos a diferen√ßa: temos uma classe de adaptador que herda da biblioteca.  Al√©m disso - o mesmo bloco, que √© chamado de <strong>delegado</strong> e do qual tamb√©m herdamos e implementamos parte da l√≥gica de que precisamos.  Em seguida, adicionamos um delegado ao <strong>gerente</strong> - essa tamb√©m √© uma classe de biblioteca.  E a √∫ltima coisa que voc√™ precisa √© criar um adaptador e preench√™-lo com dados </p><br><p>  Para implementar a segunda categoria da loja e os cabe√ßalhos, escreveremos mais alguns delegados, e a anima√ß√£o aparecer√° gra√ßas √† classe <strong>DiffUtil</strong> . </p><br><p>  Aqui vou indicar uma conclus√£o breve, mas definitiva: o uso desta biblioteca resolve todos os problemas listados que surgiram quando complicamos o aplicativo em um caso com uma loja online, mas sem os pontos negativos, em nenhum outro lugar. </p><br><blockquote>  Processo de desenvolvimento de adaptadores com AdapterDelegates no hist√≥rico do <a href="">github</a> </blockquote><br><h2 id="glava-tretya-v-kotoroy-razrabotchik-snimaet-rozovye-ochki-sravniv-biblioteki">  Cap√≠tulo Tr√™s, no qual o desenvolvedor remove √≥culos cor de rosa comparando bibliotecas </h2><br><p>  Iremos nos aprofundar na funcionalidade e opera√ß√£o de cada uma das bibliotecas.  De uma maneira ou de outra, usei as tr√™s bibliotecas em nossos projetos, dependendo das tarefas e da complexidade do aplicativo. </p><br><h3 id="adapterdelegateshttpsgithubcomsockeqweadapterdelegates">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Adapterdelegates</a> </h3><br><p><img src="https://habrastorage.org/webt/u9/9q/up/u99quph_ecf1su3ggudei9au6eg.gif" align="left">  Usamos essa biblioteca na aplica√ß√£o de uma das maiores companhias a√©reas russas.  Precis√°vamos substituir uma lista de pagamentos simples por uma lista com grupos e um grande n√∫mero de par√¢metros diferentes. </p><br><p>  Um esquema de trabalho simplificado da biblioteca se parece com isso: <img src="https://habrastorage.org/webt/w6/mw/4s/w6mw4shsbgr6ndkpbwvhsyuvayo.jpeg"></p><br><p>  A classe principal √© o <strong>DelegateAdapter</strong> , os v√°rios "tijolos" s√£o os "delegados" respons√°veis ‚Äã‚Äãpor exibir um tipo de dados espec√≠fico e, √© claro, a pr√≥pria lista. </p><br><h4 id="plyusy">  Pr√≥s: </h4><br><ul><li>  simplicidade de imers√£o; </li><li>  adaptadores f√°ceis de reutilizar; </li><li>  poucos m√©todos e classes; </li><li>  sem reflex√£o, gera√ß√£o de c√≥digo e liga√ß√£o de dados. </li></ul><br><h4 id="minusy">  Contras: </h4><br><ul><li>  voc√™ mesmo precisa implementar a l√≥gica, por exemplo <del>  atualizando itens atrav√©s do DiffUti </del>  l (desde a vers√£o 3.1.0, voc√™ pode usar o adaptador AsyncListDifferDelegationAdapter); </li><li>  c√≥digo redundante. </li></ul><br><blockquote>  Em geral, esta biblioteca resolve todas as principais dificuldades na expans√£o da funcionalidade do aplicativo e √© adequada para aqueles que n√£o usaram a biblioteca anteriormente.  Mas para parar apenas com isso, eu n√£o aconselho. </blockquote><br><h3 id="groupiehttpsgithubcomlisawraygroupie">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Groupie</a> </h3><br><p><img src="https://habrastorage.org/webt/wm/ke/5w/wmke5wd9rsxtqknnr_jsdhn6m_s.gif" align="left">  Costumamos usar o <strong>Groupie</strong> , criado h√° v√°rios anos por <strong>Lisa Wray</strong> , inclusive escrevendo o aplicativo para um banco let√£o usando-o completamente. </p><br><p>  Para usar esta biblioteca, primeiro voc√™ precisa <strong>lidar com depend√™ncias</strong> .  Al√©m da principal, voc√™ pode usar v√°rias op√ß√µes para escolher: </p><br><ul><li>  extens√£o para extens√µes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kotlin Android</a> ; </li><li>  extens√£o para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">liga√ß√£o de dados do Android</a> ; </li><li>  isso e outro. </li></ul><br><p>  N√≥s nos debru√ßamos sobre uma coisa e prescrevemos as depend√™ncias necess√°rias. </p><br><p>  Usando um exemplo de uma loja on-line com patos, precisamos criar um <strong>Item</strong> herdado da classe library, especificar o layout e implementar a liga√ß√£o por meio do Kotlin syntentics.  Comparado √† quantidade de c√≥digo que tive que escrever com o <strong>AdapterDelegates</strong> , √© apenas o c√©u e a terra. </p><br><p>  Tudo o que resta √© definir o RecyclerView <strong>GroupieAdapter</strong> como um adaptador e colocar os itens simulados nele. </p><br><p><img src="https://habrastorage.org/webt/3z/q9/wi/3zq9wiax9tufogfr6fx9cwipobe.jpeg"></p><br><p>  Pode-se ver que o esquema de trabalho √© maior e mais complexo.  Aqui, al√©m de itens simples, voc√™ pode usar se√ß√µes inteiras - grupos de itens e outras classes. </p><br><h4 id="plyusy-1">  Pr√≥s: </h4><br><ul><li>  interface intuitiva, embora api fa√ßa voc√™ pensar; </li><li>  a presen√ßa de solu√ß√µes in a box; </li><li>  decomposi√ß√£o em grupos de elementos; </li><li>  a escolha entre a op√ß√£o usual, Kotlin Extensions e DataBinding; </li><li>  incorporando ItemDecoration e anima√ß√µes. </li></ul><br><h4 id="minusy-1">  Contras: </h4><br><ul><li>  wiki incompleto; </li><li>  fraco apoio do mantenedor e da comunidade; </li><li>  pequenos bugs que precisavam ser contornados na primeira vers√£o; </li><li>  diferen√ßas na linha principal (por enquanto); </li><li>  n√£o h√° suporte para AndroidX (no momento, mas voc√™ precisa monitorar o reposit√≥rio). </li></ul><br><p>  √â importante que o <strong>Groupie,</strong> com todas as suas desvantagens, consiga substituir facilmente o <strong>AdapterDelegates</strong> , especialmente se voc√™ planeja criar listas dobr√°veis ‚Äã‚Äãdo primeiro n√≠vel e n√£o deseja escrever muitos clich√™s. </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Implementando</a> a lista de patos com groupie </blockquote><br><h3 id="epoxyhttpsgithubcomairbnbepoxy">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ep√≥xi</a> </h3><br><p><img src="https://habrastorage.org/webt/te/fg/tt/tefgttnpx4qijjlckdpxtuqpucq.gif" align="left">  A √∫ltima biblioteca que come√ßamos a usar h√° relativamente pouco tempo √© o <strong>Epoxy</strong> , desenvolvido pelo pessoal do <strong>Airbnb</strong> .  A biblioteca √© complexa, mas permite resolver uma grande variedade de tarefas.  Os pr√≥prios programadores do Airbnb o usam para renderizar telas diretamente do servidor.  <strong>A cola Epoxy</strong> foi √∫til em um de nossos projetos mais recentes - um pedido de banco em Ecaterimburgo. </p><br><p>  Para desenvolver telas, tivemos que trabalhar com diferentes tipos de dados, um grande n√∫mero de listas.  E uma das telas era realmente intermin√°vel.  E a <strong>Ep√≥xi</strong> nos ajudou a lidar com isso. </p><br><p>  O princ√≠pio de opera√ß√£o da biblioteca como um todo √© semelhante aos dois anteriores, exceto que, em vez de um adaptador, um EpoxyController √© usado para criar a lista, o que permite determinar declarativamente a estrutura do adaptador. </p><br><p><img src="https://habrastorage.org/webt/im/rk/rl/imrkrl2d6nnnoolqijk-_ubvkmg.jpeg"></p><br><p>  Para conseguir isso, a biblioteca √© constru√≠da sobre a gera√ß√£o de c√≥digo.  Como funciona - com todas as nuances, √© bem descrito no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wiki</a> e refletido nas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">amostras</a> . </p><br><h4 id="plyusy-2">  Pr√≥s: </h4><br><ul><li>  modelos para a lista, gerados a partir da visualiza√ß√£o usual, com possibilidade de reutiliza√ß√£o em telas simples; </li><li>  descri√ß√£o declarativa das telas; </li><li>  DataBinding na velocidade m√°xima - gera modelos diretamente de arquivos de layout; </li><li>  basta exibir n√£o apenas listas dos blocos, mas tamb√©m telas complexas; </li><li>  ViewPool compartilhado em Atividade; </li><li>  difus√£o ass√≠ncrona pronta para uso (AsyncEpoxyController); </li><li>  n√£o h√° necessidade de vaporizar com listas horizontais. </li></ul><br><h4 id="minusy-2">  Contras: </h4><br><ul><li>  um monte de classes, processadores, anota√ß√µes; </li><li>  mergulho dif√≠cil do zero; </li><li>  usa o plugin ButterKnife para gerar arquivos R2 em m√≥dulos; </li><li>  √© muito dif√≠cil entender como trabalhar corretamente com retornos de chamada (n√≥s mesmos ainda n√£o o entendemos); </li><li>  H√° problemas que precisam ser contornados: por exemplo, uma falha com o mesmo ID. </li></ul><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Implementando</a> a lista de patos com ep√≥xi </blockquote><br><h2 id="itogi-1">  Sum√°rio </h2><br><p>  O principal que eu queria transmitir era: n√£o atenda √† complexidade que aparece quando voc√™ precisa fazer listas complexas e constantemente precisa refaz√™-las.  E isso acontece com muita frequ√™ncia.  E, em princ√≠pio, quando eles s√£o implementados, se o projeto est√° apenas come√ßando, ou voc√™ est√° envolvido na refatora√ß√£o. </p><br><p>  A realidade √© que n√£o √© necess√°rio complicar a l√≥gica mais uma vez, pensando que algum tipo de abstra√ß√£o ser√° suficiente.  Eles s√£o curtos o suficiente E trabalhar com eles n√£o √© apenas um prazer, mas tamb√©m a tenta√ß√£o de transferir parte da l√≥gica para a parte da interface do usu√°rio, que n√£o deveria estar l√°.  Existem ferramentas que podem ajud√°-lo a evitar a maioria dos problemas e voc√™ precisa us√°-las. </p><br><blockquote>  Entendo que, para muitos desenvolvedores experientes (e n√£o apenas), isso √© √≥bvio ou eles podem discordar de mim.  Mas considero importante enfatizar isso novamente. </blockquote><br><h2 id="tak-a-chto-vybrat-to">  Ent√£o, o que escolher? </h2><br><p>  O aconselhamento para ficar em uma biblioteca √© bastante dif√≠cil, porque a escolha depende de muitos fatores: das prefer√™ncias pessoais √† ideologia do projeto. </p><br><p>  Eu faria o seguinte: </p><br><ol><li>  Se voc√™ est√° apenas come√ßando o seu caminho no desenvolvimento, tente iniciar <strong>um pequeno projeto</strong> com o <strong>AdapterDelegates</strong> - esta √© a biblioteca mais simples - n√£o √© necess√°rio nenhum conhecimento especial.  Voc√™ entender√° como trabalhar com ele e por que √© mais conveniente do que escrever adaptadores. </li><li>  <strong>O Groupie √©</strong> adequado para aqueles que j√° jogaram o suficiente com o AdapterDelegates e est√£o cansados ‚Äã‚Äãde escrever um monte de clich√™, ou para <strong>todos os outros</strong> que imediatamente querem come√ßar com um meio termo.  E n√£o se esque√ßa da presen√ßa de <strong>grupos dobr√°veis ‚Äã‚Äãfora da caixa</strong> - esse tamb√©m √© um bom argumento a seu favor. </li><li>  Bem, e <strong>Ep√≥xi</strong> - para aqueles que se deparam com um projeto verdadeiramente complexo, com uma enorme quantidade de dados, portanto a complexidade de uma biblioteca gorda ser√° menos problem√°tica.  No come√ßo, ser√° dif√≠cil, mas a implementa√ß√£o das listas parecer√° um pouco.  Um argumento importante a favor do Epoxy pode ser a presen√ßa de <strong>DataBinding</strong> e <strong>MVVM</strong> no projeto - ele foi literalmente criado para isso, dada a possibilidade de gerar modelos a partir dos layouts correspondentes. </li></ol><br><p>  Se voc√™ ainda tiver d√∫vidas, pode consultar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">link</a> para ver novamente o c√≥digo do nosso aplicativo com os detalhes. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt428525/">https://habr.com/ru/post/pt428525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt428513/index.html">500 ponteiros laser em um s√≥ lugar</a></li>
<li><a href="../pt428515/index.html">Top 3D Shop: como mudamos ao longo do ano - resultados de 2018</a></li>
<li><a href="../pt428517/index.html">GraphQL - API de uma nova maneira</a></li>
<li><a href="../pt428521/index.html">Por que n√£o h√° amigos no GitHub. Sobre Robbie Barrath, √ìbvio e Direitos autorais</a></li>
<li><a href="../pt428523/index.html">ShadowCloud - cliente universal de nuvem</a></li>
<li><a href="../pt428526/index.html">Taxa do Google: 180 ¬∞ de volta</a></li>
<li><a href="../pt428528/index.html">Por que revolucion√°rios gostam de comida apimentada ou como o chili chegou √† China</a></li>
<li><a href="../pt428530/index.html">Os resultados da investiga√ß√£o do acidente "Union MS-10"</a></li>
<li><a href="../pt428532/index.html">HyperloopTT planeja lan√ßar a primeira filial do Hyperloop no terceiro trimestre de 2019</a></li>
<li><a href="../pt428534/index.html">M√°quina de perfura√ß√£o para impressora 3D e conversor de cart√£o de perfura√ß√£o PCAD para G-Code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>