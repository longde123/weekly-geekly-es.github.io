<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ò üî≠ üßëüèΩ‚Äçü§ù‚ÄçüßëüèΩ Testen der Veeam-Sicherungs- und Replikationslast üï¥Ô∏è üàπ üëù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im Fr√ºhjahr 2018 startete Selectel √ºber Veeam¬Æ Backup & Replication ‚Ñ¢ (im Folgenden: VBR) einen Sicherungsdienst f√ºr VMware Cloud . Wir haben uns gr√ºn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Testen der Veeam-Sicherungs- und Replikationslast</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/431596/"><img src="https://habrastorage.org/webt/b4/zh/jj/b4zhjj50y8pexmomkjgovcahmvk.png"><br><br>  Im Fr√ºhjahr 2018 startete Selectel √ºber Veeam¬Æ Backup &amp; Replication ‚Ñ¢ (im Folgenden: VBR) einen Sicherungsdienst f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VMware Cloud</a> .  Wir haben uns gr√ºndlich mit dem Projekt befasst, die folgende Liste von Arbeiten geplant und durchgef√ºhrt: <br><br><ul><li>  Erkundung der Veeam-Produktdokumentation und Best Practices </li><li>  Entwerfen einer VBR-Architektur auf Service Provider-Ebene </li><li>  Stellen Sie die VBR-Infrastruktur bereit </li><li>  Testen der L√∂sung, Bestimmen der optimalen Einstellungen und Betriebsmodi </li><li>  Einf√ºhrung der L√∂sung im industriellen (kommerziellen) Betrieb </li></ul><br>  Wie sich herausstellte - nicht umsonst.  Der Service ist stabil, Kunden k√∂nnen ihre virtuellen Maschinen sichern und wir verf√ºgen √ºber ein bestimmtes Fachwissen, das wir teilen m√∂chten. <br><br>  In diesem Artikel m√∂chten wir √ºber die Ergebnisse von VBR-Lasttests f√ºr die beiden beliebtesten Backup-Proxy-Betriebsmodi sprechen, wobei die unterschiedliche Anzahl paralleler Tasks ber√ºcksichtigt wird. <br><a name="habracut"></a><br>  Hier k√∂nnen Sie sehen: <br><br><ul><li>  Beschreibung der zum Testen verwendeten Selectel-Produktionsinfrastruktur </li><li>  Funktionen des Backup-Proxys (Backup-Proxy) in verschiedenen Transportmodi </li><li>  Beschreibung des Testprogramms und Einstellungen der VBR-Komponenten f√ºr deren Implementierung </li><li>  Quantitative Indikatoren, deren Vergleich und Schlussfolgerungen </li></ul><br><h2>  Testen Sie die Infrastrukturkonfiguration </h2><br><h3>  Quellinfrastruktur </h3><br>  Als Plattform zum Testen der Leistung von VBR wurde einer der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf VMware basierenden</a> Produktionscluster der √∂ffentlichen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cloud erstellt</a> . <br><br><ul><li>  Die Hardwarekonfiguration der Hosts in diesem Cluster: </li><li>  Intel¬Æ Xeon¬Æ Gold Prozessoren 6140 </li><li>  Intel¬Æ DC NVMe P4600 und P3520 </li><li>  4 10-GbE-Ports pro Host </li></ul><br>  Der Cluster basiert auf folgenden L√∂sungen: <br><br><ul><li>  Physisches Netzwerk - Ethernet-Factory auf Brocade VDX-Switches, Leaf-Spine-Architektur (10-GbE-Ports - Hosts verbinden, 40-GbE-Uplinks zu Spine) </li><li>  Virtualisierungsumgebung - VMware vSphere¬Æ 6.5 </li><li>  VM-Speicher - VMware vSAN ‚Ñ¢ 6.6 (All-Flash vSAN-Cluster) </li><li>  Netzwerkvirtualisierung - VMware NSX¬Æ 6.4 </li></ul><br>  Die Leistung der Testplattform ist mehr als ausreichend und steht au√üer Zweifel.  F√ºr eine Hochgeschwindigkeitsleistung sollte dies nat√ºrlich alles richtig konfiguriert sein, aber da es sich um eine Produktion mit lebhaften und zufriedenen Kunden handelt, k√∂nnen Sie sicher sein, dass diesbez√ºglich alles in Ordnung ist. <br><br>  Zusammen mit der VMware-basierten Cloud hat Selectel einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dienst</a> f√ºr die Sicherung auf der VBR-Plattform gestartet.  Kunden erhalten ein Self-Service-Webportal, auf dem sie vApp und VMs von ihrem VDC (virtuelles Rechenzentrum) sichern und wiederherstellen k√∂nnen. <br><br>  Kunden haben Zugriff auf dieses Portal (Veeam¬Æ Enterprise Manager Self-Service-Portal) mit denselben Rechten wie vCloud Director¬Æ (vCD).  Dies ist aufgrund der Integration von Veeam¬Æ Backup Enterprise Manager (EM) und vCD m√∂glich. W√§hrend jeder Client, wenn er mit EM verbunden ist, durch die Ressourcen seines VDC begrenzt ist, werden keine anderen VMs angezeigt. <br><br>  Der Client muss kein eigenes VBR und die zugeh√∂rige Sicherungsinfrastruktur bereitstellen, was die Kosten f√ºr Computer- und Netzwerkressourcen, Speicher, Veeam- und MS-Lizenzen sowie Verwaltung impliziert.  Es ist lang, teuer und kompliziert.  Selectel bietet die grundlegenden Funktionen von VBR als BaaS-Dienst (Backup-as-a-Service): sofort, einfach, bequem und wirtschaftlich. <br><br>  Um diesen Service bereitzustellen, stellte Selectel eine VBR-Provider-Infrastruktur bereit, die alle vSphere- und VDC-Cluster von VMware-Cloud-Clients abdeckt, einschlie√ülich des Clusters, in dem dieser Test durchgef√ºhrt wurde.  Anhand der Testergebnisse k√∂nnen wir daher die maximale Geschwindigkeit beurteilen, mit der Kunden ihre VMs sichern k√∂nnen. <br><br><h3>  Testen Sie VMs </h3><br>  Um die Sicherungsleistung zu testen, wurden 6 identische VMs in der folgenden Konfiguration im vSphere-Cluster bereitgestellt: <br><br><ul><li>  Betriebssystem Windows Server 2016, 2 vCPU, 4 GB RAM </li><li>  200 GB vDisk </li></ul><br>  Die Festplatte ist fast voll - 193 GB.  Zus√§tzlich zu den Betriebssystemdateien wurde ein Ordner mit Distributionen verschiedener Betriebssysteme und DBMS mit einer Kapazit√§t von 60 GB erstellt (eindeutige Daten).  Auf demselben Laufwerk wurden 3 Kopien dieses Ordners erstellt - insgesamt 180 GB Nicht-Systemdaten. <br><br>  Auf diesen VMs wurden keine Anwendungen installiert, nur ein "sauberes" Betriebssystem und "kalte" Daten.  Keine Last, Computer oder Netzwerk, gestartet.  F√ºr diesen Test war dies nicht erforderlich. <br><br>  DRS ist im vSphere-Cluster aktiviert, sodass Test-VMs f√ºr den Lastenausgleich automatisch optimal auf VMware ESXi ‚Ñ¢ -Hosts verteilt werden. <br><br><h3>  Backup-Proxy </h3><br>  Eine VM mit Backup-Proxy wird direkt in dem oben beschriebenen vSphere-Cluster (der Quellinfrastruktur, im Folgenden als vSphere-Cluster bezeichnet) bereitgestellt. Dies ist eine notwendige Bedingung f√ºr das Testen im Virtual Appliance-Modus. <br><br>  VM-Konfiguration: <br><br><ul><li>  8 vCPU </li><li>  8 GB RAM </li><li>  40 GB vDisk </li><li>  10 GbE vNIC vmxnet3 </li><li>  Betriebssystem Windows Server 2016 </li></ul><br>  Der Parameter "Max. Gleichzeitige Aufgaben" f√ºr den Sicherungs-Proxy auf VBR-Ebene ist auf 6 festgelegt. Dies bedeutet, dass der Sicherungs-Proxy gleichzeitig (parallel) bis zu 6 Sicherungsaufgaben verarbeiten kann.  Eine Aufgabe ist die Sicherung einer virtuellen VM-Festplatte. <br><br><h3>  Backup-Repository </h3><br>  Der physische Server, der als Backup-Repository von VBR fungiert, fungiert als Frontend des Backup-Speichers.  Serverkonfiguration: <br><br><ul><li>  CPU E5-1650v3 </li><li>  32 GB RAM </li><li>  2 10-GbE-Ports </li></ul><br>  Speicher-Backend - CephFS-Cluster mit NVMe-Cache. <br><br>  Das Backup-Repository und die Ceph-Knoten kommunizieren √ºber ein 10-GbE-Netzwerk. Jeder von ihnen ist √ºber zwei Ports mit den Switches verbunden. <br><br>  Eine detaillierte Beschreibung der Ceph-Cluster-Konfiguration w√ºrde den Rahmen dieses Artikels sprengen.  Beachten Sie, dass die Daten aus Gr√ºnden der Zuverl√§ssigkeit und Fehlertoleranz in drei Kopien gespeichert werden.  Die Leistung des Clusters ist nicht zufriedenstellend und mit einem gewissen Abstand versehen. Die Testergebnisse zeigten, dass in keinem von ihnen der Sicherungsspeicher ein Engpass war. <br><br>  Der Parameter "Maximale Anzahl gleichzeitiger Aufgaben begrenzen" f√ºr das Sicherungsrepository auf VBR-Ebene ist auf 6 festgelegt. Dies bedeutet, dass das Sicherungsrepository gleichzeitig (bis zu 6) Sicherungsaufgaben verarbeiten kann. <br><br><h3>  Backup-Netzwerk </h3><br>  Das physische Netzwerk der oben beschriebenen Infrastruktur ist durch eine Bandbreite von 10 Gbit / s begrenzt, Switches und 10 GbE-Ports werden √ºberall verwendet.  Dies gilt nicht nur f√ºr vSAN, sondern auch f√ºr Verwaltungsschnittstellen von ESXi-Hosts. <br><br>  Um einen Backup-Proxy auf VMware NSX-Ebene zu hosten, wurde ein dediziertes Subnetz mit einem eigenen logischen Switch erstellt.  F√ºr die Konnektivit√§t mit Physik und Routing wird der X-Large NSX-Edge bereitgestellt. <br><br>  Mit Blick auf die Zukunft ist den Testergebnissen klar, dass das Netzwerk einer Last von bis zu 8 Gbit / s standhalten kann.  Dies ist eine sehr solide Bandbreite, die zu diesem Zeitpunkt ausreicht und bei Bedarf erh√∂ht werden kann. <br><br><h3>  Komponenteninteraktionsdiagramm </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cu/jh/cj/cujhcj5n4pch_msn8z03xdxvfdc.jpeg"></div><br>  Backup-Proxys und Test-VMs werden im selben VMware vSAN-Cluster bereitgestellt.  Nach dem Starten des Sicherungsjobs (Sicherungsjob) wird abh√§ngig vom ausgew√§hlten Transportmodus, dessen Funktionen unten erl√§utert werden, ein Sicherungsproxy erstellt: <br><br><ul><li>  Ruft Daten von Sicherungs-VMs √ºber vSAN (HotAdd) oder Steuerungsnetzwerk (NBD) ab. </li><li>  √úbertr√§gt verarbeitete Daten an das Backup-Repository des daf√ºr zugewiesenen Subnetzes </li></ul><br><h2>  Backup-Proxy-Transportmodi </h2><br>  Der Backup-Proxy ist eine Komponente der VBR-Infrastruktur, die die Verarbeitung von Backup-Jobs direkt durchf√ºhrt.  Es extrahiert Daten aus der VM, verarbeitet sie (komprimiert, dedupliziert, verschl√ºsselt) und sendet sie an das Repository, wo sie in Sicherungsdateien gespeichert werden. <br><br>  Mit dem Backup-Proxy k√∂nnen Sie in drei Transportmodi arbeiten: <br><br><ul><li>  Direkter Speicherzugriff </li><li>  Virtuelle Appliance </li><li>  Netzwerk </li></ul><br>  Die VMware Selectel-basierte Cloud <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">verwendet vSAN</a> als Speicher. In dieser Konfiguration wird der direkte Speicherzugriff nicht unterst√ºtzt. Daher wird dieser Modus nicht ber√ºcksichtigt und wurde nicht getestet.  Die verbleibenden zwei Modi funktionieren wunderbar in jedem unserer vSphere-Cluster. Lassen Sie uns n√§her darauf eingehen. <br><br><h3>  Virtueller Appliance-Modus (HotAdd) </h3><br>  Die virtuelle Appliance ist der empfohlene Modus, wenn Sicherungsproxys als VMs bereitgestellt werden.  ESXi-Hosts, auf denen Sicherungsproxys bereitgestellt werden, m√ºssen Zugriff auf alle Datenspeicher des vSphere-Clusters haben, in dem die Sicherungs-VMs gespeichert sind.  Der Kern des Modus besteht darin, dass der Proxy die Festplatten der Sicherungs-VM (VMware SCSI HotAdd) bereitstellt und Daten von ihnen entnimmt, als w√§ren es eigene.  Die Datenextraktion erfolgt mit dem Datenspeicher √ºber ein Speichernetzwerk. <br><br>  In unserem Fall muss sich die Backup-Proxy-VM auf einem der ESXi-Hosts des vSAN-Clusters befinden, den wir sichern.  Die Datenextraktion erfolgt √ºber vSAN.  Um im Virtual Appliance-Modus zu arbeiten, muss in jedem vSAN-Cluster mindestens ein Backup-Proxy bereitgestellt werden.  Erweitern Sie ein Paar Sicherungsproxys (z. B. in einem Verwaltungscluster), und die Sicherung aller vSAN-Cluster mit ihnen schl√§gt fehl. <br><table><tbody><tr><td align="center">  <strong>Vorteile</strong> </td><td align="center">  <strong>Nachteile</strong> </td></tr><tr><td>  Schnell ist in der Regel viel schneller als NBD, insbesondere bei einer vollst√§ndigen Sicherung oder gro√üen Schritten.  Nur der direkte Speicherzugriff kann eine geringere Geschwindigkeit aufweisen. </td><td>  Das Mounten von Festplatten (HotAdd) an einen Proxy kann pro Festplatte bis zu 2 Minuten dauern.  Mit inkrementellen Sicherungen kleiner Datenbl√∂cke kann NBD schneller sein. </td></tr><tr><td>  Entsorgt das Speichernetzwerk.  L√§dt nicht die Verwaltungsschnittstelle und den Hypervisor. </td><td>  Die Proxy-VM belegt einen Teil der Hostressourcen.  Manchmal kann es Probleme beim Entfernen von Schnappsch√ºssen geben. </td></tr></tbody></table><h3>  Netzwerkmodus (NBD) </h3><br>  Dies ist der einfachste und universellste Modus, der sowohl f√ºr physische als auch f√ºr virtuelle Backup-Proxys geeignet ist.  Die Datenextraktion erfolgt im Gegensatz zu den beiden vorherigen Modi nicht √ºber das Speichernetzwerk.  Ein Backup-Proxy nimmt VM-Daten auf, indem er eine Verbindung zur Verwaltungsschnittstelle der ESXi-Hosts herstellt, auf denen sie ausgef√ºhrt werden. <br><br>  Dieser Ansatz hat die folgenden Nachteile: <br><br><ul><li>  H√§ufig h√§ngen ESXi-Verwaltungsschnittstellen nicht an den schnellsten Uplinks. In der Regel ist dies 1 GbE </li><li>  Selbst wenn die Verwaltungsschnittstelle √ºber 10-GbE-Ports verf√ºgt, gibt ESXi nicht den gesamten Proxy-Band-Proxy auf - es begrenzt ihn k√ºnstlich und weist nur einen Teil der Schnittstellenbandbreite f√ºr Sicherungen zu </li></ul><table><tbody><tr><td align="center">  <strong>Vorteile</strong> </td><td align="center">  <strong>Nachteile</strong> </td></tr><tr><td>  Einfach und vielseitig.  Proxies k√∂nnen physisch und virtuell sein. </td><td>  In der Regel ist es viel langsamer als HotAdd, insbesondere bei gro√üen Sicherungsvolumes und einer kleinen Anzahl paralleler Aufgaben. </td></tr><tr><td>  Schnellstart, keine Verz√∂gerung bei der Montage von Laufwerken.  Kein Problem mit Schnappsch√ºssen. </td><td>  Erstellt eine Last (klein) auf der Verwaltungsoberfl√§che und dem Hypervisor. </td></tr></tbody></table>  Gleichzeitig behaupten viele Quellen, dass NBD bei 1 GbE sehr langsam ist, aber bei 10 GbE kann es ziemlich schnell sein.  Wir werden dies auf jeden Fall √ºberpr√ºfen. <br><br><h2>  Testprogramm </h2><br>  In der oben beschriebenen Infrastruktur m√ºssen Test-VMs gesichert und die folgenden Indikatoren aufgezeichnet werden: <br><br><ul><li>  CPU-Auslastung,% </li><li>  RAM-Verbrauch, GB </li><li>  Netzwerklast, Gbit / s </li><li>  Sicherungsleistung, MB / s </li><li>  Sicherungszeit, mm: ss </li></ul><br>  Die Indikatoren sollten f√ºr die Sicherung einer Test-VM und f√ºr die parallele Sicherung von zwei, vier und sechs Test-VMs festgelegt werden. <br><br>  Anzeigen sollten f√ºr die Betriebsmodi Virtual Appliance und Network Backup Proxy aufgezeichnet werden.  Jedes Mal, wenn eine vollst√§ndige Sicherung durchgef√ºhrt werden soll, werden keine Inkremente durchgef√ºhrt. <br><br>  Daher m√ºssen 4 Sicherungsjobs erstellt werden: <br><br><ul><li>  F√ºr eine Test-VM </li><li>  F√ºr zwei Test-VMs </li><li>  F√ºr vier Test-VMs </li><li>  F√ºr sechs Test-VMs </li></ul><br>  Im Rahmen der Pr√ºfung ist Folgendes erforderlich: <br><br><ol><li>  F√ºhren Sie nacheinander alle Aufgaben in einem Modus aus </li><li>  L√∂schen Sie erstellte Sicherungen, damit es keine Inkremente gibt </li><li>  Wiederholen Sie die L√§ufe im zweiten Modus, jedes Mal, wenn Anzeigen angezeigt werden </li></ol><br>  In den Einstellungen jeder Aufgabe m√ºssen Sie manuell einen zum Testen vorbereiteten Sicherungsproxy ausw√§hlen, da dies nicht der einzige in der allgemeinen VBR-Infrastruktur ist und der Proxy standardm√§√üig automatisch ausgew√§hlt wird. <br><br>  Der Standard-Backup-Proxy-Modus wird ebenfalls automatisch ausgew√§hlt.  Stellen Sie daher in den Backup-Proxy-Einstellungen vor jedem Lauf den gew√ºnschten Transportmodus manuell ein. <br><br>  Der interessanteste Indikator ist die durchschnittliche Geschwindigkeit oder Sicherungsleistung.  Dies ist in den Ergebnissen des Jobs in der VBR-Konsole zu sehen.  Au√üerdem wird die Sicherungslaufzeit angezeigt. <br><br>  Dar√ºber hinaus m√ºssen Sie die Belastung des Sicherungs-Proxys in jedem der Tests bewerten.  CPU-, Speicher- und Netzwerk√ºberlastung k√∂nnen mithilfe der Gastbetriebssystem-Tools (Windows 2016) und auf VMware-Ebene √ºberwacht werden. <br><br>  Auf dem Backup-Proxy und den Backup-Repositorys ist der Parameter f√ºr die maximale Anzahl gleichzeitiger Tasks auf 6 festgelegt. Dies bedeutet, dass w√§hrend des Tests alle VMs in jeder Task parallel verarbeitet werden und keiner von ihnen in der Warteschlange wartet. Die Leistung ist maximal. <br><br>  Veeam¬Æ empfiehlt, dass die Anzahl der parallelen Tasks die Anzahl der Prozessorkerne auf Proxys und Repositorys nicht √ºberschreitet.  Die empfohlene RAM-Gr√∂√üe im Repository betr√§gt 2 GB pro Kern, insgesamt 12 GB.  Die Infrastrukturkonfiguration zeigt, dass alle Empfehlungen befolgt werden. <br><br><h2>  Sicherungsgeschwindigkeit und Laden im Virtual Appliance-Modus (Hot Add) </h2><br><h3>  1 VM sichern </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xp/ez/bd/xpezbdpsxcufmtsdpprpvv_nm9w.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Backup Proxy Load</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  CPU-Auslastung,% </td><td align="center">  55-95 </td></tr><tr><td>  RAM-Verbrauch, GB </td><td align="center">  2-2,2 </td></tr><tr><td>  Netzwerklast, Gbit / s </td><td align="center">  4.7-6.4 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Sicherungsgeschwindigkeit</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  Sicherungsleistung, MB / s </td><td align="center">  709 </td></tr><tr><td>  Sicherungszeit, mm: ss </td><td align="center">  06:35 </td></tr></tbody></table><br></div></div><br><h3>  Backup 2 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qw/pj/qw/qwpjqwyr9vleuslvegj4wdzzudg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Backup Proxy Load</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  CPU-Auslastung,% </td><td align="center">  70-100 (Regal 100% mit scharfen kurzen Tropfen auf 70%) </td></tr><tr><td>  RAM-Verbrauch, GB </td><td align="center">  2.3-2.5 </td></tr><tr><td>  Netzwerklast, Gbit / s </td><td align="center">  5-7.7 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Sicherungsgeschwindigkeit</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  Sicherungsleistung, MB / s </td><td align="center">  816 </td></tr><tr><td>  Sicherungszeit, mm: ss </td><td align="center">  10:03 </td></tr></tbody></table><br></div></div><br><h3>  Backup 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7n/om/ii/7nomiiyognj8gswhpcwx2yoi5cs.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Backup Proxy Load</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  CPU-Auslastung,% </td><td align="center">  100 (100% Regal mit seltenen kleinen Tropfen) </td></tr><tr><td>  RAM-Verbrauch, GB </td><td align="center">  3-3.5 </td></tr><tr><td>  Netzwerklast, Gbit / s </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Sicherungsgeschwindigkeit</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  Sicherungsleistung, MB / s </td><td align="center">  885 </td></tr><tr><td>  Sicherungszeit, mm: ss </td><td align="center">  17:10 </td></tr></tbody></table><br></div></div><br><h3>  Backup 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qt/wx/ey/qtwxeyomib4z4zywrck_j_mmqbg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Backup Proxy Load</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  CPU-Auslastung,% </td><td align="center">  100 (100% Regal mit seltenen kleinen Tropfen) </td></tr><tr><td>  RAM-Verbrauch, GB </td><td align="center">  4-4,2 </td></tr><tr><td>  Netzwerklast, Gbit / s </td><td align="center">  5-8,2 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Sicherungsgeschwindigkeit</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  Sicherungsleistung, MB / s </td><td align="center">  888 </td></tr><tr><td>  Sicherungszeit, mm: ss </td><td align="center">  24:42 </td></tr></tbody></table><br></div></div><br><h2>  Sicherungsgeschwindigkeit und Last im Netzwerkmodus (NBD) </h2><br><h3>  1 VM sichern </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vf/1j/jk/vf1jjkuom98hsgw9v2mnfqs6wjg.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Backup Proxy Load</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  CPU-Auslastung,% </td><td align="center">  18-24 </td></tr><tr><td>  RAM-Verbrauch, GB </td><td align="center">  1.9-2.1 </td></tr><tr><td>  Netzwerklast, Gbit / s </td><td align="center">  1.2-1.8 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Sicherungsgeschwindigkeit</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  Sicherungsleistung, MB / s </td><td align="center">  192 </td></tr><tr><td>  Sicherungszeit, mm: ss </td><td align="center">  18:30 </td></tr></tbody></table><br></div></div><br><h3>  Backup 2 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v4/7n/ho/v47nhooellqc7pkgkjayv0e2d64.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Backup Proxy Load</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  CPU-Auslastung,% </td><td align="center">  25-33 </td></tr><tr><td>  RAM-Verbrauch, GB </td><td align="center">  2.2-2.4 </td></tr><tr><td>  Netzwerklast, Gbit / s </td><td align="center">  1,5-2,5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Sicherungsgeschwindigkeit</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  Sicherungsleistung, MB / s </td><td align="center">  269 </td></tr><tr><td>  Sicherungszeit, mm: ss </td><td align="center">  25:50 </td></tr></tbody></table><br></div></div><br><h3>  Backup 4 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ah/nf/ng/ahnfngh4urqwfdwkubfzaatesa8.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Backup Proxy Load</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  CPU-Auslastung,% </td><td align="center">  45-55 </td></tr><tr><td>  RAM-Verbrauch, GB </td><td align="center">  2.8-3.5 </td></tr><tr><td>  Netzwerklast, Gbit / s </td><td align="center">  2.8-4.5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Sicherungsgeschwindigkeit</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  Sicherungsleistung, MB / s </td><td align="center">  446 </td></tr><tr><td>  Sicherungszeit, mm: ss </td><td align="center">  31:14 </td></tr></tbody></table><br></div></div><br><h3>  Backup 6 VM </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f8/ah/90/f8ah90h6s77rwwywul_likwvln4.jpeg"></div><br><div class="spoiler">  <b class="spoiler_title">Backup Proxy Load</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  CPU-Auslastung,% </td><td align="center">  50-70 </td></tr><tr><td>  RAM-Verbrauch, GB </td><td align="center">  3,5-4 </td></tr><tr><td>  Netzwerklast, Gbit / s </td><td align="center">  3,5-5 </td></tr></tbody></table><br></div></div><div class="spoiler">  <b class="spoiler_title">Sicherungsgeschwindigkeit</b> <div class="spoiler_text"><table><tbody><tr><td>  <strong>Anzeige</strong> </td><td align="center">  <strong>Wert</strong> </td></tr><tr><td>  Sicherungsleistung, MB / s </td><td align="center">  517 </td></tr><tr><td>  Sicherungszeit, mm: ss </td><td align="center">  40:02 </td></tr></tbody></table><br></div></div><br><h2>  Leistungs- und Lastvergleich in der virtuellen Appliance (HotAdd) und im Netzwerkmodus (NBD) </h2><table><tbody><tr><td align="center">  <strong>VM-Anzahl</strong> </td><td align="center">  <strong>Geschwindigkeit - HotAdd, MB / s</strong> </td><td align="center">  <strong>Geschwindigkeit - NBD, MB / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  709 </td><td align="center">  192 </td><td align="center">  3.69 </td></tr><tr><td align="center">  2 </td><td align="center">  816 </td><td align="center">  269 </td><td align="center">  3.03 </td></tr><tr><td align="center">  4 </td><td align="center">  885 </td><td align="center">  446 </td><td align="center">  1,98 </td></tr><tr><td align="center">  6 </td><td align="center">  888 </td><td align="center">  517 </td><td align="center">  1,72 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>VM-Anzahl</strong> </td><td align="center">  <strong>CPU-Auslastung - HotAdd,%</strong> </td><td align="center">  <strong>CPU-Auslastung - NBD,%</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  55-95 </td><td align="center">  18-24 </td><td align="center">  3,06-3,96 </td></tr><tr><td align="center">  2 </td><td align="center">  70-100 </td><td align="center">  25-33 </td><td align="center">  2.8-3.03 </td></tr><tr><td align="center">  4 </td><td align="center">  100 </td><td align="center">  45-55 </td><td align="center">  1,82-2,22 </td></tr><tr><td align="center">  6 </td><td align="center">  100 </td><td align="center">  50-70 </td><td align="center">  1.43-2 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>VM-Anzahl</strong> </td><td align="center">  <strong>RAM-Download - HotAdd, GB</strong> </td><td align="center">  <strong>RAM laden - NBD, GB</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  2-2,2 </td><td align="center">  1.9-2.1 </td><td align="center">  1.05 </td></tr><tr><td align="center">  2 </td><td align="center">  2.3-2.5 </td><td align="center">  2.2-2.4 </td><td align="center">  1,04-1,05 </td></tr><tr><td align="center">  4 </td><td align="center">  3-3.5 </td><td align="center">  2.8-3.5 </td><td align="center">  1-1.07 </td></tr><tr><td align="center">  6 </td><td align="center">  4-4,2 </td><td align="center">  3,5-4 </td><td align="center">  1.14-1.05 </td></tr></tbody></table><table><tbody><tr><td align="center">  <strong>VM-Anzahl</strong> </td><td align="center">  <strong>Netzwerk-Download - HotAdd, GB / s</strong> </td><td align="center">  <strong>Netzwerk-Download - NBD, Gb / s</strong> </td><td align="center">  <strong>HotAdd / NBD</strong> </td></tr><tr><td align="center">  1 </td><td align="center">  4.7-6.4 </td><td align="center">  1.2-1.8 </td><td align="center">  3,56-3,92 </td></tr><tr><td align="center">  2 </td><td align="center">  5-7.7 </td><td align="center">  1,5-2,5 </td><td align="center">  3,08-3,33 </td></tr><tr><td align="center">  4 </td><td align="center">  5-8,2 </td><td align="center">  2.8-4.5 </td><td align="center">  1,79-1,82 </td></tr><tr><td align="center">  6 </td><td align="center">  5-8,2 </td><td align="center">  3,5-5 </td><td align="center">  1.43-1.64 </td></tr></tbody></table><h2>  Testergebnisse </h2><br>  Die Sicherungsleistungsindikatoren, die als Ergebnis von Tests erhalten wurden, best√§tigen eindeutig, dass der Virtual Appliance-Modus im Vergleich zum Netzwerkmodus eine deutlich h√∂here Geschwindigkeit aufweist, insbesondere bei einer kleinen Anzahl paralleler Aufgaben. <br><br>  Ich m√∂chte Sie daran erinnern, dass die Tests f√ºr beide Modi unter absolut identischen Bedingungen auf derselben Plattform durchgef√ºhrt wurden.  Die Netzwerkbandbreite war ebenfalls dieselbe - die Steuerschnittstellen, √ºber die der Proxy Daten im NBD-Modus sammelt, geben 10 Gbit / s aus, wie das vSAN-Netzwerk f√ºr den HotAdd-Modus. Wir haben keine Bandbreitenbeschr√§nkungen festgelegt. <br><br>  Offensichtlich verlangsamt ESXi Veeam¬Æ wirklich und gibt ihm im Netzwerkmodus nur einen Teil des Bandes, daher die Unterschiede in der Sicherungsgeschwindigkeit.  Mit der Zunahme der Anzahl der Threads - gleichzeitige Sicherungsaufgaben - reduziert der Netzwerkmodus den R√ºckstand erheblich. <br><br>  Wir sehen, dass im Virtual Appliance-Modus, bereits auf 4 VMs, der Backup-Proxy auf dem Prozessor ruht und nicht schneller arbeiten kann. Bei 6 VMs hat sich die Backup-Geschwindigkeit nicht wesentlich ge√§ndert.  Gleichzeitig liegt die Sicherungsgeschwindigkeit von 1-2 VMs in diesem Modus leicht zur√ºck, und die Funktionen von Sicherungsproxys und -plattformen werden selbst bei einer kleinen Anzahl von Threads maximal genutzt. <br><br>  Im Netzwerkmodus hingegen steigt die Produktivit√§t erheblich, und die Anzahl der gleichzeitigen Aufgaben steigt.  Gleichzeitig ist die Belastung des Backup-Proxy-Prozessors erheblich geringer als im HotAdd-Modus, selbst bei 6 Threads betr√§gt sie nicht mehr als 70%. <br><br>  Der Speicherverbrauch des Backup-Proxys ist gering und in beiden Modi ungef√§hr gleich. <br><br>  Die Belastung des Backup-Proxy-Netzwerks korreliert mit der Backup-Geschwindigkeit und √ºbersteigt diese um ~ 10-17%.  Anscheinend nimmt der Proxy die Daten aus den VM-Quellen etwas schneller als beim Hochladen in das Repository, da sie verarbeitet werden m√ºssen. <br><br>  Es ist interessant, die Linienlast in den Bildern mit den Ergebnissen der Ausf√ºhrung des Jobs zu beobachten.  Es zeigt die Auslastung verschiedener Elemente der Sicherungsinfrastruktur: Quelle, Proxy, Netzwerk, Repository. <br><br>  Im Virtual Appliance-Modus sehen wir, dass die Sicherungsleistung auf dem Proxy und dem Netzwerk liegt. Sie sind immer ungef√§hr gleich hoch.  Die Quelle und das Repository sind kein Engpass. <br><br>  Im Netzwerkmodus ist der Engpass immer die Quelle, auch f√ºr einen einzelnen Stream.  Es ist ersichtlich, dass der Rest der Infrastruktur mehr geben kann, ESXi jedoch nicht. <br><br><h2>  Zusammenfassung </h2><br>  Tests haben best√§tigt, dass sich der Backup-Proxy in den untersuchten Transportmodi in der Praxis genau so verh√§lt, wie es die Theorie vorschl√§gt. <br><br>  Die Veeam¬Æ-Software hat sich als sehr wertvoll erwiesen: <br><br><ul><li>  Im HotAdd-Modus wurden alle Infrastrukturfunktionen effektiv und vollst√§ndig genutzt. </li><li>  Im NBD-Modus wird eine geringere Leistung erwartet. Dies ist jedoch kein Veeam¬Æ-Problem, sondern eine Funktion des ESXi-Netzwerkstapels </li></ul><br>  Wir haben echte Leistungs- und Lastindikatoren, die sehr n√ºtzlich sind, um den optimalen Betriebsmodus und die anschlie√üende Skalierung des Systems auszuw√§hlen. <br><br>  Im Moment sind wir sehr zufrieden mit der vorhandenen Backup-Leistung. Wir wissen, wie man sie richtig erh√∂ht, wenn ein solcher Bedarf entsteht. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de431596/">https://habr.com/ru/post/de431596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de431582/index.html">Geschichte des Schutzes personenbezogener Daten: Wie kam es zur DSGVO?</a></li>
<li><a href="../de431584/index.html">Platz und Test: mischen, aber nicht sch√ºtteln</a></li>
<li><a href="../de431586/index.html">So gehen Sie schneller mit Fehlern in der JVM um</a></li>
<li><a href="../de431588/index.html">Selbstst√§ndiges Gesetz. Informationen zur Pr√ºfung</a></li>
<li><a href="../de431590/index.html">Die Modernisierung veralteter britischer Windparks wird die Energieerzeugung um 171% steigern</a></li>
<li><a href="../de431598/index.html">Wir bringen eine √∂ffentliche virtuelle QEMU-Maschine ohne Netzwerkkarte ins Internet und versuchen, sie abzubauen</a></li>
<li><a href="../de431600/index.html">Erh√∂hen Sie IDS / NMS: Mikrotik und Suricata mit einem Webinterface</a></li>
<li><a href="../de431602/index.html">Russische Entwickler pr√§sentierten in London ein virtuelles Rehabilitationssystem</a></li>
<li><a href="../de431604/index.html">Lokalisierung in Go mit Basispaketen</a></li>
<li><a href="../de431608/index.html">Das US-Unternehmen DriveSavers ist das weltweit erste Unternehmen, das einen iPhone-Hacking-Service f√ºr Einzelpersonen anbietet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>