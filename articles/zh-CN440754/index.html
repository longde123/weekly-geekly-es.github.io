<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔥 🔕 🕯️ 跨平台的英语实用程序，用于查看俄罗斯合格证书x509 🍔 😖 🍁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="今天，使用数字证书X509 v.3已变得司空见惯。 越来越多的人使用它们来访问国家服务局，联邦税务局，电子招标等网站。 越来越多的人想知道这个“胸”称为证书的含义。 如果证书是护照的类似物，那么如何读取/查看它。 是的，在操作系统中有多种实用程序可供查看。 但是他们对普通公民几乎没有任何帮助。 以g...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>跨平台的英语实用程序，用于查看俄罗斯合格证书x509</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440754/"><img src="https://habrastorage.org/webt/tj/bp/mp/tjbpmpejv6ig2dqs8r22x1zcmzw.png" alt="图片" align="left"> 今天，使用数字证书X509 v.3已变得司空见惯。 越来越多的人使用它们来访问国家服务局，联邦税务局，电子招标等网站。 越来越多的人想知道这个“胸”称为证书的含义。 如果证书是护照的类似物，那么如何读取/查看它。 是的，在操作系统中有多种实用程序可供查看。 但是他们对普通公民几乎没有任何帮助。 以gcr-viewer实用程序为例，它实际上是在Linux系统上（因此在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">家用OS中）</a>进行查看的标准工具： <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/lf/7g/nf/lf7gnfqkvwpo2cuhy_mcvulf_a8.png"><br><br><h3> 标准观众 </h3><br> 该实用程序制作精良，方便。 通常，它旨在用作查看包含各种密码格式（证书，请求，电子签名/ PKCS＃7，受保护的容器PKCS＃12等）的数据的文件的通用实用程序。 但是，不幸的是，它是为西方密码学设计的，并未考虑您所在国家/地区输入的oid。 并且，如果您查看屏幕截图，那么当显示有关证书持有者的信息时，将出现难以理解的字符。  oid本身在左侧，而第16种形式的右侧是其值的asn1-结构。 在这种情况下，它们是OGRN（1.2.643.100.1），SNILS（1.2.643.100.3）和TIN（1.2.643.3.131.1.1）。 这就是普通公民应确保这是他的数据的方式。 不要以为这仅在Linux上，它是任何证书查看器的共同功能。 如果您进一步看，那么一切都会变得令人费解： <br><br><img src="https://habrastorage.org/webt/55/6s/ib/556sib6y76f81ohud2laq0knsho.png"><br><br> 出现一些扩展名，标识符和值。 在这种情况下，oid om 1.2.643.100.111隐藏了CIPF的名称，该名称由用户用来生成密钥对，用于签名证书请求的私钥以及位于证书中的公钥： <br><br><img src="https://habrastorage.org/webt/yv/yx/uu/yvyxuu6hjoasxtytu7foy-s1o20.png"><br><br> 在这里，证书持有者了解得很少。 他甚至不了解使用哪种算法来生成密钥（GOST R 34.10-2001或GOST R 34.10-2012）以及密钥长度。 <br><br> 您可以继续举例。 例如，如果证书的有效性是明确的，那么密钥在哪里？ <br><br> 证书持有者还想回答两个问题：在哪里可以获得一连串的根证书（或者甚至可以得到一个），以及在已撤销证书列表中的类似问题。 <br><br> 最后，我想拥有一个通用的实用程序，该实用程序考虑了俄罗斯PKI / PKI的功能，该功能确实是跨平台的，并且可以在家用和非<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">家用OS</a>上运行。 要发展什么？ 当然，如果只是因为它们的跨平台性质，就使用脚本语言。 <br><br> 然后我想起了漂亮的脚本语言Tcl（工具命令语言）最近庆祝了它的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">30周年</a> 。 很高兴对此进行编程。 它具有大量扩展（程序包），几乎可以执行所有操作。 因此，要使用ASN结构，有一个asn包。 此外，对于使用证书（在这种情况下我们有兴趣解析它们），有一个pki软件包。 为了开发图形界面，有一个Tk软件包。 <br><br> 对于带有Tkinter的Pyton，Perl和红宝石，可以说都是一样的。 每个人都可以根据自己的口味选择。 我们在Tcl / Tk处停下来。 <br><br> 我们将从gcr-viewer实用程序借用该实用程序的图形设计。 还有一个要求。 <br><br> 由于Habr具有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">英语版本</a> ，因此我希望该实用程序具有不同的界面（俄语/英语）。 但这不是主要原因。 更重要的是，越来越多的西方世界公民成为俄罗斯联邦的公民，例如，世界著名的演员德帕迪约。 他们可能会反对：他是法国人。 但是我还是一名法语的军事翻译： <br><br><img src="https://habrastorage.org/webt/ma/xr/4d/maxr4dvthbpwapmxmodkjceujh4.png"><br><br> 因此，添加法语界面非常容易。 但是我认为Depardieu的英语没有问题。 另一方面，我们的国家是跨国公司，如果家用软件和家用操作系统至少具有几个国家接口，那将是很好的选择。 <br> 领先一点，这就是结果： <br><br><img src="https://habrastorage.org/webt/-e/d8/df/-ed8dfn1in3wl7iwa2wmf-w0w-w.png"><br><br><h3> 我们邀请翻译 </h3><br> 因此，让我们从“翻译器”开始。 在屏幕截图中，他躲在国旗下。 译者的主要要求是翻译的同步，即 随时可以切换到另一种语言的能力。  Tcl / Tk中的翻译器功能由msgcat软件包执行： <br><br><pre><code class="plaintext hljs">package require msgcat</code> </pre> <br> 要设置当前语言，请使用以下命令： <br><br><pre> <code class="plaintext hljs">msgcat::mclocale ru</code> </pre> <br>  “翻译器”的词汇存储在ru.msg文件中，如下所示： <br><br><pre> <code class="plaintext hljs">#  msgcat::mcset      #     mcset namespace import -force msgcat::mcset #     mcset ru "Language" "" …</code> </pre> <br> 以下是测试文字 <div class="spoiler">  <b class="spoiler_title">带翻译器的脚本：</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#!/usr/bin/wish -f #  msgcat package require msgcat #   ru msgcat::mclocale ru #  ::msgcat::mc      #     mc namespace import msgcat::mc #    [msgcat::mclocale].msg. #       . msgcat::mcload [file join [file dirname [info script]]] #  image create photo rf_32x21_f -file rf_32x21.png image create photo gb_32x21_f -file gb_32x21.png #,      label .lab -text "[mc Language]: " -relief flat -bd 0 –bg snow -anchor sw -width 10 button .but_lang -image rf_32x21_f -command ::changelang -relief flat -bd 0 pack .lab -side left -pady {2 0} pack .but_lang -side left #      proc ::changelang {} { #     #    if {[msgcat::mclocale] == "ru"} { msgcat::mclocale en .but_lang configure -image gb_32x21_f } else { msgcat::mclocale ru .but_lang configure -image rf_32x21_f } #  .lab configure -text "[mc Language]: " }</code> </pre> <br></div></div><br> 在此脚本中，:: changelang过程充当翻译器，当按下带有标志的.but_lang按钮时，将调用该过程。 <br><br> 如果运行此脚本，您将清楚地看到转换器的工作方式： <br><br><img src="https://habrastorage.org/webt/hs/4y/e6/hs4ye6p49e5soy4ud6aje91-e2i.png"><br><br><h3> 获取公钥 </h3><br> 现在，我们已经决定要翻译，让我们继续分析证书。 为此，我们需要pki包： <br><br><pre> <code class="plaintext hljs">package require pki).</code> </pre> <br>  pki软件包旨在与RSA算法密钥和证书一起使用。 如果使用不同类型的密钥创建了证书（proc :: pki :: x509 :: parse_cert），那么我们将不会收到有关此密钥的信息： <br><br><pre> <code class="plaintext hljs"># Handle RSA public keys by extracting N and E switch -- $ret(pubkey_algo) { "rsaEncryption" { set pubkey [binary format B* $pubkey] binary scan $pubkey H* ret(pubkey) ::asn::asnGetSequence pubkey pubkey_parts ::asn::asnGetBigInteger pubkey_parts ret(n) ::asn::asnGetBigInteger pubkey_parts ret(e) set ret(n) [::math::bignum::tostr $ret(n)] set ret(e) [::math::bignum::tostr $ret(e)] set ret(l) [expr {int([::pki::_bits $ret(n)] / 8.0000 + 0.5) * 8}] set ret(type) rsa } }</code> </pre> <br> 令人惊讶的是，公钥算法仍然返回（ret（pubkey_algo）） <br> 解析证书请求的情况相同（proc :: pki :: pkcs :: parse_csr）： <br><br><pre> <code class="plaintext hljs"># Parse public key, based on type switch -- $pubkey_type { "rsaEncryption" { set pubkey [binary format B* $pubkey] ::asn::asnGetSequence pubkey pubkey_parts ::asn::asnGetBigInteger pubkey_parts key(n) ::asn::asnGetBigInteger pubkey_parts key(e) set key(n) [::math::bignum::tostr $key(n)] set key(e) [::math::bignum::tostr $key(e)] set key(l) [expr {2**int(ceil(log([::pki::_bits $key(n)])/log(2)))}] set key(type) rsa } default { return -code error "Unsupported key type: $pubkey_type" } }</code> </pre> <br> 但是在这里他甚至返回有关错误的信息。 但是，今天，除了RSA以外，还使用了欧盟椭圆曲线上的键，包括GOST R 34.10-2012（GOST R 34.10-2001现在也已发布）。 <br><br> 但是默认情况下，只要返回证书或请求中的公钥的ASN结构就足够了，用户本人将根据密钥的类型来解析公钥。 为此，只需将十六进制值的公钥ASN结构添加到返回值中： <br><br><pre> <code class="plaintext hljs">proc ::pki::x509::parse_cert {cert} { . . . ::asn::asnGetSequence cert subject ::asn::asnGetSequence cert pubkeyinfo #    ASN-  . binary scan $pubkeyinfo H* ret(pubkey_pubkeyinfo) . . . }</code> </pre> <br> 一切，无事可做。 这样，:: pki :: x509 :: parse_cert过程将返回大多数证书扩展名，原因很简单，即它不知道如何解析它们（例如，带有我们合格证书的subjectSignTool），即 由用户自行决定。 <br><br> 另一方面，:: pki :: x509 :: parse_cert过程返回<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">tbs证书</a>的结果之一，该<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">证书</a>包含该证书的所有信息，但其签名（签名）和签名类型（signature_algo）除外： <br><br><pre> <code class="plaintext hljs">#    set fd [open «cert.pem» r] chan configure –translation binary set datacert [read $fd] close $fd #  array set cert_parse [::pki::x509::parse_cert $datacert] # tbs- set cert_tbs_hex $cert_parse(cert)</code> </pre> <br> 我们编写了从tbs证书中提取公钥信息的过程： <br><br><pre> <code class="plaintext hljs">proc ::pki::x509::parse_cert_pubkeyinfo {cert_tbs_hex} { array set ret [list] set wholething [binary format H* $cert_tbs_hex] ::asn::asnGetSequence wholething cert ::asn::asnPeekByte cert peek_tag if {$peek_tag != 0x02} { # Version number is optional, if missing assumed to be value of 0 ::asn::asnGetContext cert - asn_version ::asn::asnGetInteger asn_version ret(version) } ::asn::asnGetBigInteger cert ret(serial_number) ::asn::asnGetSequence cert data_signature_algo_seq ::asn::asnGetObjectIdentifier data_signature_algo_seq ret(data_signature_algo) ::asn::asnGetSequence cert issuer ::asn::asnGetSequence cert validity ::asn::asnGetUTCTime validity ret(notBefore) ::asn::asnGetUTCTime validity ret(notAfter) ::asn::asnGetSequence cert subject ::asn::asnGetSequence cert pubkeyinfo #    hex asn-   binary scan $pubkeyinfo H* ret(pubkeyinfo) return $ret(pubkeyinfo) }</code> </pre> <br> 并且由于我们对俄语密码学感兴趣，因此我们将立即编写解析GOST公钥的过程： <br><br><pre> <code class="plaintext hljs">proc parse_key_gost {pubkeyinfo_hex} { array set ret [list] set pubkeyinfo [binary format H* $pubkeyinfo_hex] ::asn::asnGetSequence pubkeyinfo pubkey_algoid ::asn::asnGetObjectIdentifier pubkey_algoid ret(pubkey_algo) #,   - if {[string first "1 2 643 " $ret(pubkey_algo)] == -1} { return [array get ret] } ::asn::asnGetBitString pubkeyinfo pubkey set pubkey [binary format B* $pubkey] #   binary scan $pubkey H* ret(pubkey) ::asn::asnGetSequence pubkey_algoid pubalgost #OID -  ::asn::asnGetObjectIdentifier pubalgost ret(paramkey) #OID -   ::asn::asnGetObjectIdentifier pubalgost ret(hashkey) #puts "ret(paramkey)=$ret(paramkey)\n" #puts "ret(hashkey)=$ret(hashkey)\n" #parray ret #  :  ,     return [array get ret] }</code> </pre><br> 是的，我几乎错过了它：加载pki包后，您需要添加到数组:: pki :: oids来表示GOST和合格证书的特征，或者在此数组中根本不存在的oid： <br><br><pre> <code class="plaintext hljs">package require pki # oid- set ::pki::oids(1.2.643.100.1) "OGRN" set ::pki::oids(1.2.643.100.5) "OGRNIP" set ::pki::oids(1.2.643.3.131.1.1) "INN" set ::pki::oids(1.2.643.100.3) "SNILS" set ::pki::oids(1.2.643.2.2.19) "GOST R 34.10-2001" set ::pki::oids(1.2.643.7.1.1.1.1) "GOST R 34.10-2012-256" set ::pki::oids(1.2.643.7.1.1.1.2) "GOST R 34.10-2012-512" set ::pki::oids(1.2.643.2.2.3) "GOST R 34.10-2001 with GOST R 34.11-94" set ::pki::oids(1.2.643.7.1.1.3.2) "GOST R 34.10-2012-256 with GOSTR 34.11-2012-256" set ::pki::oids(1.2.643.7.1.1.3.3) "GOST R 34.10-2012-512 with GOSTR 34.11-2012-512" set ::pki::oids(1.2.643.100.113.1) "KC1 Class Sign Tool" set ::pki::oids(1.2.643.100.113.2) "KC2 Class Sign Tool" . . .</code> </pre> <br> 您还可以通过添加到ru.msg文件来补充翻译者的词汇： <br><br><pre> <code class="plaintext hljs">mcset ru "GOST R 34.10-2001" "  34.10-2001" mcset ru "GOST R 34.10-2012-256" "  34.10-2012-256" mcset ru "GOST R 34.10-2012-512" "  34.10-2012-512" mcset ru "GOST R 34.10-2001 with GOST R 34.11-94" "  34.10-2001    34.11-94" mcset ru "GOST R 34.10-2012-256 with GOSTR 34.11-2012-256" "  34.10-2012-256    34.11-2012-256" mcset ru "GOST R 34.10-2012-512 with GOSTR 34.11-2012-512" "  34.10-2012-512    34.11-2012-512" . . .</code> </pre>  ： <br><img src="https://habrastorage.org/webt/am/gu/td/amgutdxuj-xkszh1qpmeaa-hf1g.png"><br><br><h3> 根证书链和证书吊销列表 </h3><br> 前面已经讨论了如何获取根证书链。 以此类推，编写了一个程序来获取已撤销的COS / CRL证书列表。 可以找到该实用程序的源代码及其针对Linux，OS X（macOS）和MS Windows的发行版 <br><br><div class="spoiler">  <b class="spoiler_title">在这里</b> <div class="spoiler_text"><ul><li>  <a href="">源代码</a> </li><li>  <a href="">Linux32</a> </li><li>  <a href="">Linux64</a> </li><li>  <a href="">OS X</a> </li><li>  <a href="">WIN32</a> </li><li>  <a href="">WIN64</a> </li></ul><br></div></div><br> 在源代码中，您可以找到解析证书扩展的所有过程。 <br> 对于Tk的反对者（Tcl / Tk，Python / Tkinter等），我建议找到两个实用程序之间的十（十）个区别：用gtk编写的gcr-viewer实用程序和用Tk开发的certViewer实用程序： <br><br><img src="https://habrastorage.org/webt/pq/k5/a5/pqk5a5yrh7fbjhlrfipmdvu5tyg.png"><br><br><h3>  PKCS＃11令牌/智能卡证书 </h3><br> 上面我们讨论了使用存储在文件中的证书（浏览，获取根证书链，吊销证书列表，sha1和sha256的指纹等）。 但是，仍有证书存储在PKCS＃11令牌/智能卡上。 自然的愿望不仅是看到它们，然后将其导出到文件中。 如何执行此操作，我们将在以下文章中进行描述： <br><br><img src="https://habrastorage.org/webt/vx/25/cu/vx25culnj3anfl_jwbkgd-t8nk4.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN440754/">https://habr.com/ru/post/zh-CN440754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN440742/index.html">AMP和Turbo页面：优点，缺点和实施结果</a></li>
<li><a href="../zh-CN440744/index.html">适用于初学者的PHP。 错误处理</a></li>
<li><a href="../zh-CN440746/index.html">Gartner的知识管理技术循环使用KnowledgeConf的案例研究</a></li>
<li><a href="../zh-CN440748/index.html">世界上最快的超级计算机打破了AI记录</a></li>
<li><a href="../zh-CN440752/index.html">用户请求优先级选择</a></li>
<li><a href="../zh-CN440756/index.html">AWS上的无服务器CI / CD</a></li>
<li><a href="../zh-CN440758/index.html">在Acronis参加聚会！ （莫斯科，Fiztehpark）</a></li>
<li><a href="../zh-CN440760/index.html">计算机架构的新黄金时代</a></li>
<li><a href="../zh-CN440762/index.html">雇主评论：匿名评论的性质和无意义</a></li>
<li><a href="../zh-CN440766/index.html">从极客到极客：2月23日的礼物</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>