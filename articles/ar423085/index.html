<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐พ ๐ง ๐ ููุงุฒูุฉ ุญูู ุฏููู ๐ง ๐ง๐ผ ๐ฉ๐ผโ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุณุชุฑูุฒ ูุฐู ุงูููุงูุฉ ุนูู ููุงุฒูุฉ ุงูุชุญููู ูู ูุดุงุฑูุน ุงูููุจ. ูุนุชูุฏ ุงููุซูุฑูู ุฃู ุญู ูุฐู ุงููุดููุฉ ูู ุชูุฒูุน ุงูุญูู ุจูู ุงูุฎูุงุฏู - ุฃูุซุฑ ุฏูุฉ ุ ูููุง ูุงู ุฐูู ุฃูุถู. ูููู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููุงุฒูุฉ ุญูู ุฏููู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/423085/" style=";text-align:right;direction:rtl">  ุณุชุฑูุฒ ูุฐู ุงูููุงูุฉ ุนูู ููุงุฒูุฉ ุงูุชุญููู ูู ูุดุงุฑูุน ุงูููุจ.  ูุนุชูุฏ ุงููุซูุฑูู ุฃู ุญู ูุฐู ุงููุดููุฉ ูู ุชูุฒูุน ุงูุญูู ุจูู ุงูุฎูุงุฏู - ุฃูุซุฑ ุฏูุฉ ุ ูููุง ูุงู ุฐูู ุฃูุถู.  ููููุง ูุนูู ุฃู ูุฐุง ููุณ ุตุญูุญูุง ุชูุงููุง.  <strong>ูุนุฏ ุงุณุชูุฑุงุฑ ุงููุธุงู ุฃูุซุฑ ุฃูููุฉ ูู ูุฌูุฉ ูุธุฑ ุงูุฃุนูุงู</strong> . <br><br><img src="https://habrastorage.org/webt/6i/vb/-w/6ivb-w0bzdgl_oa-hkep6luitfi.png"><br><br>  ุฐุฑูุฉ ุงูุฏูููุฉ ุงูุตุบูุฑุฉ ุนูุฏ 84 RPS ูู "ุฎูุณูุงุฆุฉ" ูู ุฎูุณุฉ ุขูุงู ุฎุทุฃ ุชููุงู ุงููุณุชุฎุฏููู ุงูุญูููููู.  ูุฐุง ูุซูุฑ ููู ููู ุฌุฏุง.  ูู ุงูุถุฑูุฑู ุงูุจุญุซ ุนู ุงูุฃุณุจุงุจ ุ ูุงูุนูู ุนูู ุงูุฃุฎุทุงุก ููุญุงููุฉ ุงูุงุณุชูุฑุงุฑ ูู ููุน ูุซู ูุฐู ุงูููุงูู. <br><br>  <strong>ุชุญุฏุซ ูููููุงู ุณูููู</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">NikolaySivko</a> ) ูู ุชูุฑูุฑู ุนู RootConf 2018 ุนู ุงูุฌูุงูุจ ุงูุฎููุฉ ูุบูุฑ ุงูุดุงุฆุนุฉ ุฌุฏูุง ูููุงุฒูุฉ ุงูุญูู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุช ุชูุฑุงุฑ ุงูุทูุจ (ุฅุนุงุฏุฉ ุงููุญุงููุฉ) ุ </li><li style=";text-align:right;direction:rtl">  ููููุฉ ุชุญุฏูุฏ ููู ุงููููุงุช ุ </li><li style=";text-align:right;direction:rtl">  ููู ูุง ุชูุชู ุงูุฎูุงุฏู ุงูุฃุณุงุณูุฉ ูู ููุช ูููุน ุงูุญุงุฏุซ / ุงูุงุฒุฏุญุงู ุ </li><li style=";text-align:right;direction:rtl">  ูุง ุฅุฐุง ูุงูุช ุงููุญูุตุงุช ุงูุทุจูุฉ ุถุฑูุฑูุฉ ุ </li><li style=";text-align:right;direction:rtl">  ููููุฉ ุงูุชุนุงูู ูุน ูุดุงูู ุงูุฎููุงู. </li></ul><br>  ุชุญุช ูู ุงููุท ูู ูุฐุง ุงูุชูุฑูุฑ. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/2-j2ADWFkkE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <strong>ุญูู ุงููุชุญุฏุซ:</strong> ูููููุงู ุณูููู ุฃุญุฏ ูุคุณุณู ูููุน okmeter.io.  ุนูู ููุณุคูู ูุธุงู ููุงุฆุฏ ูุฌููุนุฉ ูู ุงููุณุคูููู.  ุงูุนูููุฉ ุชุญุช ุงูุฅุดุฑุงู ุนูู hh.ru.  ุฃุณุณ ุฎุฏูุฉ ุงููุฑุงูุจุฉ okmeter.io.  ูุฌุฒุก ูู ูุฐุง ุงูุชูุฑูุฑ ุ ูุฅู ูุฑุงูุจุฉ ุชุฌุฑุจุฉ ุงูุชุทููุฑ ูู ุงููุตุฏุฑ ุงูุฑุฆูุณู ููุญุงูุงุช. <br><br><h2 style=";text-align:right;direction:rtl">  ูุง ุงูุฐู ุณูุชุญุฏุซ ุนููุ <br></h2><br>  ุณุชุชุญุฏุซ ูุฐู ุงูููุงูุฉ ุนู ูุดุงุฑูุน ุงูููุจ.  ูููุง ููู ูุซุงู ููุฅูุชุงุฌ ุงููุจุงุดุฑ: ูุนุฑุถ ุงูุฑุณู ุงูุจูุงูู ุงูุทูุจุงุช ูู ุงูุซุงููุฉ ูุฎุฏูุฉ ููุจ ูุนููุฉ. <br><br><img src="https://habrastorage.org/webt/oy/5c/qt/oy5cqtlz-halhw7y5ayuz6xl9lm.png"><br><br>  ุนูุฏูุง ุฃุชุญุฏุซ ุนู ุงูุชูุงุฒู ุ ูุฑู ุงููุซูุฑูู ุฃูู "ูุญู ุจุญุงุฌุฉ ุฅูู ุชูุฒูุน ุงูุญูู ุจูู ุงูุฎูุงุฏู - ูููุง ูุงูุช ุฃูุซุฑ ุฏูุฉ ุ ูุงู ุฐูู ุฃูุถู". <br><br><img src="https://habrastorage.org/webt/pm/g2/sp/pmg2spartsnxrxcyhzi_4-ui64g.png"><br><br>  ูู ุงููุงูุน ุ ูุฐุง ููุณ ุตุญูุญูุง ุชูุงููุง.  ูุฐู ุงููุดููุฉ ุฐุงุช ุตูุฉ ุจุนุฏุฏ ูููู ุฌุฏูุง ูู ุงูุดุฑูุงุช.  ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุ ุชุดุนุฑ ุงูุฃุนูุงู ุจุงูููู ุจุดุฃู ุงูุฃุฎุทุงุก ูุงุณุชูุฑุงุฑ ุงููุธุงู. <br><br><img src="https://habrastorage.org/webt/6i/vb/-w/6ivb-w0bzdgl_oa-hkep6luitfi.png"><br><br>  ุงูุฐุฑูุฉ ุงูุตุบูุฑุฉ ุนูู ุงูุฑุณู ุงูุจูุงูู ูู "ุฎูุณูุงุฆุฉ" ุ ูุงูุชู ุนุงุฏ ุงูุฎุงุฏู ูู ุบุถูู ุฏูููุฉ ุ ุซู ุชููู.  ูู ูุฌูุฉ ูุธุฑ ุดุฑูุฉ ุ ูุซู ูุชุฌุฑ ุนูู ุงูุฅูุชุฑูุช ุ ูุฐู ุงูุฐุฑูุฉ ุงูุตุบูุฑุฉ ุนูุฏ 84 RPS ูู "ุฎูุณูุงุฆุฉ" ูู 5040 ุฎุทุฃ ูููุณุชุฎุฏููู ุงูุญูููููู.  ูู ูุฌุฏ ุงูุจุนุถ ุดูุฆูุง ูู ุงููุชุงููุฌ ุงูุฎุงุต ุจู ุ ูุงูุจุนุถ ุงูุขุฎุฑ ูู ูุชููู ูู ูุถุน ุงูุจุถุงุฆุน ูู ุงูุณูุฉ.  ููุฐุง ููู ุฌุฏุง.  ุนูู ุงูุฑุบู ูู ุฃู ูุฐู ุงูุฐุฑูุฉ ูุง ุชุจุฏู ูุจูุฑุฉ ุฌุฏูุง ุนูู ุงูุฑุณู ุงูุจูุงูู ุ <strong>ุฅูุง ุฃููุง ูุซูุฑุฉ ูู ุงููุณุชุฎุฏููู ุงูุญูููููู</strong> . <br><br>  ููุงุนุฏุฉ ุนุงูุฉ ุ ูู ุดุฎุต ูุฏูู ูุซู ูุฐู ุงูููู ุ ููุง ูุณุชุฌูุจ ุงููุดุฑููู ููุง ุฏุงุฆููุง.  ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุ ุนูุฏูุง ูุณุฃู ุฑุฌุงู ุงูุฃุนูุงู ูุง ูู ุ ูุฌูุจูู ุนููู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  "ูุฐุง ุงููุฌุงุฑ ูุตูุฑ!" </li><li style=";text-align:right;direction:rtl">  "ุฅูู ูุฌุฑุฏ ุฅุตุฏุงุฑ ูุชุฏุงูู". </li><li style=";text-align:right;direction:rtl">  "ุงูุฎุงุฏู ูุฏ ูุงุช ุ ูููู ูู ุดูุก ูู ูุญูู ุจุงููุนู." </li><li style=";text-align:right;direction:rtl">  "Vasya ุบูุฑุช ุดุจูุฉ ูุงุญุฏุฉ ูู ุงูุฎูููุงุช." </li></ul><br>  ูู ูุซูุฑ ูู ุงูุฃุญูุงู <strong>ูุง ูุญุงูู</strong> ุงููุงุณ <strong>ุญุชู ููู ุฃุณุจุงุจ</strong> ุญุฏูุซ ุฐูู ุ ููุง ูููููู ุจุฃู ุนูู ูุงุญู ุญุชู ูุง ูุญุฏุซ ูุฑุฉ ุฃุฎุฑู. <br><br><h2 style=";text-align:right;direction:rtl">  ุถุจุท ุฏููู <br></h2><br>  ุฏุนูุช ุฅูู ุชูุฑูุฑ "ุงูุถุจุท ุงูุฏููู" (ุงููููุฏุณ. ุงูุถุจุท ุงูุฏููู) ุ ูุฃููู ุงุนุชูุฏุช ุฃูู ููุณ ูู ุดุฎุต ูุตู ุฅูู ูุฐู ุงููููุฉ ุ ููููู ูุณุชุญู ุฐูู.  ููุงุฐุง ูุง ูุตููู ููุงูุ <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ูุง ูุตู ุงูุฌููุน ุฅูู ูุฐู ุงููููุฉ ุ</strong> ูุฃูู ุนูุฏูุง ูุนูู ูู ุดูุก ุ ูููู ุบูุฑ ูุฑุฆู.  ูุฐุง ููู ุฌุฏุง ูููุดุงูู.  ูุง ุชุญุฏุซ Fakapa ูู ููู ุ ูุชุชุทูุจ ูุซู ูุฐู ุงููุดููุฉ ุงูุตุบูุฑุฉ ุฌููุฏูุง ุฌุงุฏุฉ ุฌุฏูุง ูุญููุง. </li><li style=";text-align:right;direction:rtl">  <strong>ุงูุช ุจุญุงุฌุฉ ุงูู ุงูุชูููุฑ ูุซูุฑุง.</strong>  ูู ูุซูุฑ ูู ุงูุฃุญูุงู ุ ุงููุดุฑู - ุงูุดุฎุต ุงูุฐู ูููู ุจุชุนุฏูู ุงูุชูุงุฒู - ุบูุฑ ูุงุฏุฑ ุนูู ุญู ูุฐู ุงููุดููุฉ ุจุดูู ูุณุชูู.  ุงูุชุงูู ุณูุฑู ููุงุฐุง. </li><li style=";text-align:right;direction:rtl">  <strong>ููุณู ุงููุณุชููุงุช ุงูุฃุณุงุณูุฉ.</strong>  ุชุฑุชุจุท ูุฐู ุงููููุฉ ุงุฑุชุจุงุทูุง ูุซูููุง ุจุงูุชุทููุฑ ุ ูุน ุงุนุชูุงุฏ ุงููุฑุงุฑุงุช ุงูุชู ุชุคุซุฑ ุนูู ููุชุฌู ูุงููุณุชุฎุฏููู. </li></ul><br>  <strong>ุฃุคูุฏ ุฃู ุงูููุช ูุฏ ุญุงู ููููุงู ุจูุฐู ุงููููุฉ ูุนุฏุฉ ุฃุณุจุงุจ:</strong> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุนุงูู ูุชุบูุฑ ุ ููุตุจุญ ุฃูุซุฑ ุฏููุงููููุฉ ุ ูููุงู ุงูุนุฏูุฏ ูู ุงูุฅุตุฏุงุฑุงุช.  ูููููู ุฃูู ูู ุงูุตุญูุญ ุงูุขู ุฅุทูุงู 100 ูุฑุฉ ูู ุงูููู ุ ูุงูุฅุตุฏุงุฑ ูู fakap ุงููุณุชูุจููุฉ ูุน ุงุญุชูุงู 50 ุฅูู 50 (ุชูุงููุง ูุซู ุงุญุชูุงู ููุงุก ุงูุฏููุงุตูุฑ) </li><li style=";text-align:right;direction:rtl">  ูู ูุฌูุฉ ูุธุฑ ุงูุชูููููุฌูุง ุ ูู ุดูุก ุฏููุงูููู ููุบุงูุฉ.  ุธูุฑุช Kubernetes ูุบูุฑูู ูู ุงูููุธููู.  ูุง ููุฌุฏ ูุดุฑ ูุฏูู ุฌูุฏ ุ ุนูุฏูุง ูุชู ุฅููุงู ุฎูููุฉ ูุงุญุฏุฉ ุนูู ุจุนุถ ุนูุงููู IP ุ ููุชู ุทุฑุญ ุงูุชุญุฏูุซ ุ ูุชุฑุชูุน ุงูุฎุฏูุฉ.  ุงูุขู ูู ุนูููุฉ ุงูุทุฑุญ ูู k8s ุชุชุบูุฑ ูุงุฆูุฉ IP upstream ุจุงููุงูู. </li><li style=";text-align:right;direction:rtl">  ุงูุฎุฏูุงุช ุงูุฏูููุฉ: ูุชูุงุตู ุงูุฌููุน ุงูุขู ุนุจุฑ ุงูุดุจูุฉ ุ ููุง ูุนูู ุฃูู ุจุญุงุฌุฉ ุฅูู ุงูููุงู ุจุฐูู ุจุดูู ููุซูู.  ุชูุนุจ ุงูููุงุฒูุฉ ุฏูุฑูุง ููููุง. </li></ul><br><h2 style=";text-align:right;direction:rtl">  ุงุฎุชุจุงุฑ ูููู <br></h2><br>  ููุจุฏุฃ ุจุญุงูุงุช ุจุณูุทุฉ ููุงุถุญุฉ.  ููุชูุถูุญ ุ ุณุฃุณุชุฎุฏู ููุถุฏุฉ ุงุฎุชุจุงุฑ.  ูุฐุง ูู ุชุทุจูู Golang ูุนุทู http-200 ุ ุฃู ููููู ุชุจุฏููู ุฅูู ูุถุน "ุฅุนุทุงุก http-503". <br><br>  ูุจุฏุฃ 3 ุญุงูุงุช: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  127.0.0.1:20001 </li><li style=";text-align:right;direction:rtl">  127.0.0.1:20002 </li><li style=";text-align:right;direction:rtl">  127.0.0.1:20003 </li></ul><br>  ูุญู ููุฏู 100rps ุนุจุฑ yandex.tank ุนุจุฑ nginx. <br><br>  Nginx ุฎุงุฑุฌ ููุทูุฉ ุงูุฌุฒุงุก: <br><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">upstream backends { server 127.0.0.1:20001; server 127.0.0.1:20002; server 127.0.0.1:20003; } server { listen 127.0.0.1:30000; location / { proxy_pass http://backends; } }</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุณููุงุฑูู ุจุฏุงุฆู </h3><br>  ูู ูุฑุญูุฉ ูุง ุ ูู ุจุชุดุบูู ุฃุญุฏ ุงููุงุฌูุงุช ุงูุฎูููุฉ ูู ูุถุน ุฅุนุทุงุก 503 ุ ููุญุตู ุนูู ุซูุซ ุงูุฃุฎุทุงุก ุจุงูุถุจุท. <br><br><img src="https://habrastorage.org/webt/qp/m1/ro/qpm1rolcydmcpwpvule4pw97b-o.png"><br><br>  ูู ุงููุงุถุญ ุฃูู ูุง ููุฌุฏ ุดูุก ูุนูู ุฎุงุฑุฌ ุงูุตูุฏูู: ูุง ูููู nginx ุจุฅุนุงุฏุฉ ุงููุญุงููุฉ ุฎุงุฑุฌ ุงูุตูุฏูู ุฅุฐุง ุชููู <strong>ุฃู ุฑุฏ</strong> ูู ุงูุฎุงุฏู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Nginx default: proxy_next_upstream error timeout;</code> </pre><br>  ูู ุงููุงูุน ุ ูุฐุง ููุทูู ุชูุงููุง ูู ุฌุงูุจ ูุทูุฑู nginx: ูุง ูุญู ูู nginx ุฃู ุชูุฑุฑ ูู ูุง ุชุฑูุฏ ุฅุนุงุฏุฉ ุชุณููุชู ููุง ูุง ุชุฑูุฏู. <br><br>  ุชุจุนุง ูุฐูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุฅุนุงุฏุฉ ุงููุญุงููุฉ - ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุ ููุจุฏุฃ ูู ุงูุญุฏูุซ ุนููุง. <br><br><h2 style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุงููุญุงููุฉ <br></h2><br>  ูู ุงูุถุฑูุฑู ุฅูุฌุงุฏ ุญู ูุณุท ุจูู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุทูุจ ุงููุณุชุฎุฏู ููุฏุณ ุ ุชุถุงุฑ ุ ูููู ุงูุฅุฌุงุจุฉ.  ูุฑูุฏ ุงูุฑุฏ ุนูู ุงููุณุชุฎุฏู ุจุฃู ุซูู ุ ูุงููุณุชุฎุฏู ูู ุงูุฃูู. </li><li style=";text-align:right;direction:rtl">  ูู ุงูุฃูุถู ุงูุฅุฌุงุจุฉ ุจุฎุทุฃ ูู ุงูุชุญููู ุงูุฒุงุฆุฏ ุนูู ุงูุฎูุงุฏู. </li><li style=";text-align:right;direction:rtl">  ุชูุงูู ุงูุจูุงูุงุช (ููุทูุจุงุช ุบูุฑ ุงููุชุนุซุฑุฉ) ุ ุฃู ุฃูู ูู ุงููุณุชุญูู ุชูุฑุงุฑ ุฃููุงุน ูุนููุฉ ูู ุงูุทูุจุงุช. </li></ul><br>  <strong>ุงูุญูููุฉ ุ ูุงูุนุงุฏุฉ ุ ูู ูู ููุงู ูุง ุจูู -</strong> ูุญู ูุถุทุฑูู ุฅูู ุงูููุงุฒูุฉ ุจูู ูุฐู ุงูููุงุท ุงูุซูุงุซ.  ุฏุนููุง ูุญุงูู ุฃู ูููู ูุงุฐุง ูููู. <br><br>  ูุณูุช ุงููุญุงููุงุช ุงููุงุดูุฉ ุฅูู 3 ูุฆุงุช: <br><br>  1. <strong>ุฎุทุฃ ูู ุงูููู</strong> <br>  ูููู HTTP ูู TCP ุ ูููุงุนุฏุฉ ุนุงูุฉ ุ ูุชุญุฏุซ ููุง ุนู ุฃุฎุทุงุก ุฅุนุฏุงุฏ ุงูุงุชุตุงู ููููุฉ ุฅุนุฏุงุฏ ุงูุงุชุตุงู.  ูู ุชูุฑูุฑู ุ ุณุฃุฐูุฑ 3 ููุงุฒูุงุช ูุดุชุฑูุฉ (ุณูุชุญุฏุซ ุนู ุงููุจุนูุซ ุฃูุซุฑ ููููุงู): <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>nginx</strong> : ุฃุฎุทุงุก + ูููุฉ (proxy_connect_timeout) ุ </li><li style=";text-align:right;direction:rtl">  <strong>HAProxy</strong> : ูููุฉ ุงูุงุชุตุงู ุ </li><li style=";text-align:right;direction:rtl">  <strong>ุงููุจุนูุซ</strong> : ูุดู ุงูุงุชุตุงู + ุงูุฏูู ุงููุฑููุถ. </li></ul><br>  ูุฏู Nginx ุงููุฑุตุฉ ูุชููู ุฅู ุงููุญุงููุฉ ุงููุงุดูุฉ ูู ุฎุทุฃ ุงุชุตุงู ููููุฉ ุงุชุตุงู ุ  ูุฏู HAProxy ูููุฉ ุงุชุตุงู ุ ูุฏู Envoy ุฃูุถูุง ูู ุดูุก ููุงุณู ูุทุจูุนู. <br><br>  2. <strong>ุทูุจ ูููุฉ:</strong> <br>  ูููุชุฑุถ ุฃููุง ุฃุฑุณููุง ุทูุจูุง ุฅูู ุงูุฎุงุฏู ุ ูุงุชุตููุง ุจู ุจูุฌุงุญ ุ ููู ุงูุฅุฌุงุจุฉ ูู ุชุฃุช ุฅูููุง ุ ูุงูุชุธุฑูุงูุง ููููู ุฃูู ูู ูุนุฏ ููุงู ุฃู ูุงุฆุฏุฉ ูู ุงูุงูุชุธุงุฑ.  ููุฐุง ูุง ูุณูู ูููุฉ ุงูุทูุจ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฏู <strong>Nginx</strong> : ูููุฉ (prox_send_timeout * + proxy_read_timeout *) ุ </li><li style=";text-align:right;direction:rtl">  <strong>HAProxy ุจู</strong> <strong>OOPS :(</strong> - ุฅูู ุบูุฑ ููุฌูุฏ ูู ุญูุซ ุงููุจุฏุฃ. ูุซูุฑ ูู ุงููุงุณ ูุง ูุนุฑููู ุฃู HAProxy ุ ุฅุฐุง ุฃูุงูุช ุงุชุตุงููุง ุจูุฌุงุญ ุ ูู ุชุญุงูู ุฃุจุฏูุง ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุทูุจ. </li><li style=";text-align:right;direction:rtl">  ูููู <strong>ูููุจุนูุซ</strong> ุฃู ููุนู ูู ุดูุก: ูููุฉ ||  per_try_timeout. </li></ul><br>  3. <strong>ุญุงูุฉ HTTP</strong> <br>  ุฌููุน ุงูููุงุฒูุงุช ุ ุจุงุณุชุซูุงุก HAProxy ุ ูุงุฏุฑุฉ ุนูู ุงููุนุงูุฌุฉ ุ ุฅุฐุง ูุงูุช ุงูุฎูููุฉ ุงูุฎูููุฉ ุชุฌูุจู ุ ูููู ูุน ููุน ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุทุฆุฉ. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>nginx</strong> : http_ * </li><li style=";text-align:right;direction:rtl">  <strong>HAProxy</strong> : <strong>OOPS :(</strong> </li><li style=";text-align:right;direction:rtl">  <strong>ุงููุจุนูุซ</strong> : 5xx ุ ุฎุทุฃ ุงูุจูุงุจุฉ (502 ุ 503 ุ 504) ุ ูุงุจู ููุงุณุชุฑุฌุงุน - 4xx (409) </li></ul><br><h3 style=";text-align:right;direction:rtl">  ุงููููุงุช <br></h3><br>  ุงูุขู ุฏุนููุง ูุชุญุฏุซ ุจุงูุชูุตูู ุนู ุงููููุงุช ุ ูุจุฏู ูู ุฃูู ูุณุชุญู ุงูุงูุชุจุงู ุฅูู ุฐูู.  ูู ูููู ููุงู ูุฒูุฏ ูู ุนูู ุงูุตูุงุฑูุฎ - ูุฐู ุจุจุณุงุทุฉ ูุนูููุงุช ููุธูุฉ ุญูู ูุง ูุญุฏุซ ุจุดูู ุนุงู ูููู ูุฑุชุจุท ุจู. <br><br><h4 style=";text-align:right;direction:rtl">  ุฑุจุท ูููุฉ <br></h4><br>  ูููุฉ ุงูุงุชุตุงู ูู ุงูููุช ุงูููุงุณุจ ูุฅูุดุงุก ุงุชุตุงู.  ูุฐู ุฎุงุตูุฉ ูููุฒุฉ ูุดุจูุชู ูุฎุงุฏูู ุงููุญุฏุฏ ุ ููุง ุชุนุชูุฏ ุนูู ุงูุทูุจ.  ุนุงุฏุฉู ุ ูุชู ุชุนููู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ููููุฉ ุงูุงุชุตุงู ุนูู ุตุบูุฑุฉ.  ูู ุฌููุน ุงูุจุฑููุณูุงุช ุ ุชููู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูุจูุฑุฉ ุจูุง ูููู ุ ููุฐุง ุฎุทุฃ - ูุฌุจ ุฃู ุชููู <strong>ูุญุฏุงุช ุ ูุฃุญูุงููุง ุนุดุฑุงุช ุงูููู ุซุงููุฉ</strong> (ุฅุฐุง ููุง ูุชุญุฏุซ ุนู ุดุจูุฉ ุฏุงุฎู ูุญุฏุฉ ุชุญูู ุงููุฌุงู DC ูุงุญุฏุฉ). <br><br>  ุฅุฐุง ููุช ุชุฑุบุจ ูู ุชุญุฏูุฏ ุงูุฎูุงุฏู ุงูุชู ุจูุง ูุดููุงุช ุจุดูู ุฃุณุฑุน ููููุงู ูู ูุฐู ุงููุญุฏุงุช - ุนุดุฑุงุช ุงููููู ุซุงููุฉ ุ ููููู ุถุจุท ุงูุญูู ุนูู ุงููุงุฌูุฉ ุงูุฎูููุฉ ุนู ุทุฑูู ุชุนููู ุชุฑุงูู ุตุบูุฑ ูุงุณุชูุงู ุงุชุตุงูุงุช TCP.  ูู ูุฐู ุงูุญุงูุฉ ุ ููููู ุ ุนูุฏูุง ูููู ุชุฑุงูู ุงูุชุทุจูู ููุชูุฆูุง ุ ุฃู ุชุฎุจุฑ Linux ุฃู ูุนูุฏ ุชุนูููู ูุชุฌุงูุฒ ุงูุชุฑุงูู.  ุซู ุณุชุชููู ูู ุชุตููุฑ ุงูุฎูููุฉ ุงูุฒุงุฆุฏุฉ "ุงูุณูุฆุฉ" ูุจู ููุช ูุตูุฑ ูู ูููุฉ ุงูุงุชุตุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">fail fast: listen backlog + net.ipv4.tcp_abort_on_overflow</code> </pre> <br><h4 style=";text-align:right;direction:rtl">  ุทูุจ ูููุฉ <br></h4><br>  ูููุฉ ุงูุทูุจ ููุณุช ูู ุฎุตุงุฆุต ุงูุดุจูุฉ ุ ูููููุง <strong>ุฎุงุตูุฉ ููุฌููุนุฉ ูู ุงูุทูุจุงุช</strong> (ูุนุงูุฌ).  ููุงู ุทูุจุงุช ูุฎุชููุฉ - ุชุฎุชูู ูู ุดุฏุชูุง ุ ููุฏููุง ููุทู ูุฎุชูู ุชูุงููุง ูู ุงูุฏุงุฎู ุ ููุญุชุงุฌูู ุฅูู ุงููุตูู ุฅูู ูุณุชูุฏุนุงุช ูุฎุชููุฉ ุชูุงููุง. <br><br>  Nginx ููุณูุง <strong>ููุณ ูุฏููุง ูููุฉ ููุทูุจ ุจุฃูููู.</strong>  ูุฏูู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  proxy_send_timeout: ุงูููุช ุจูู ุนูููุชู ูุชุงุจุฉ ูุงุฌุญุชูู ูููุชุงุจุฉ () ุ </li><li style=";text-align:right;direction:rtl">  proxy_read_timeout: ุงูููุช ุจูู ูุฑุงุกุชูู ูุงุฌุญุชูู (). </li></ul><br>  ุจูุนูู ุ ุฅุฐุง ูุงู ูุฏูู ุฎูููุฉ ุจุจุทุก ุ ุจุงูุช ูุงุญุฏ ูู ุงููุฑุงุช ุ ูุนุทู ุดูุฆูุง ูู ูููุฉ ุ ุซู ูู ุดูุก ุนูู ูุง ูุฑุงู.  ุนูู ูุฐุง ุงููุญู ุ ูุง ูุญุชูู nginx ุนูู request_timeout.  ููููุง ูุชุญุฏุซ ุนู ุงูููุจุน.  ูู ูุฑูุฒ ุงูุจูุงูุงุช ูุฏููุง ุ ูุญู ูุชุญูู ูููุง ุ ุนูู ุงูุชุฑุงุถ ุฃู ุงูุดุจูุฉ ูุง ุชุญุชูู ุนูู ููุฑูุณ ุจุทูุก ุ ุซู ุ ูู ุญูุซ ุงููุจุฏุฃ ุ ูููู ุงุณุชุฎุฏุงู ููุช ุงููุฑุงุกุฉ ูููุช_ุงูุทูุจ. <br><br>  ุงููุจุนูุซ ูุฏูู ูู ุดูุก: ูููุฉ ||  per_try_timeout. <br><br><h4 style=";text-align:right;direction:rtl">  ุญุฏุฏ ูููุฉ ุงูุทูุจ <br></h4><br>  ุงูุขู ุฃูู ุดูุก ุ ูู ุฑุฃูู ุ ูู request_timeout ููุถุนู.  ููุชูู ูู ููุฏุงุฑ ูุง ูุฌูุฒ ูููุณุชุฎุฏู ุงูุงูุชุธุงุฑ - ููุฐุง ุญุฏ ูุนูู.  ูู ุงููุงุถุญ ุฃู ุงููุณุชุฎุฏู ูู ููุชุธุฑ ุฃูุซุฑ ูู 10 ุซูุงูู ุ ูุฐุง ุนููู ุงูุฅุฌุงุจุฉ ุนููู ุจุดูู ุฃุณุฑุน. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุฐุง ุฃุฑุฏูุง ูุนุงูุฌุฉ ูุดู ุฎุงุฏู ูุงุญุฏ ุ ููุฌุจ ุฃู ุชููู ุงููููุฉ ุฃูู ูู ุงูุญุฏ ุงูุฃูุตู ุงููุณููุญ ุจู ูููููุฉ: <strong>request_timeout &lt;max.</strong> </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุฑุบุจ ูู ุงูุญุตูู ุนูู <strong>ูุญุงููุชูู</strong> <strong>ูุถูููุชูู</strong> ูุฅุฑุณุงู ุทูุจ ุฅูู ุฎุงุฏูุชูู ูุฎุชููุชูู ุ ูุฅู ูููุฉ ูุญุงููุฉ ูุงุญุฏุฉ ุชุณุงูู ูุตู ูุฐุง ุงููุงุตู ุงูุฒููู ุงููุณููุญ ุจู: <strong>per_try_timeout = 0.5 * ูุญุฏ ุฃูุตู.</strong> </li><li style=";text-align:right;direction:rtl">  ููุงู ุฃูุถูุง ุฎูุงุฑ ูุณูุท - <strong>ูุญุงููุชุงู</strong> <strong>ูุชูุงุฆูุชุงู</strong> ูู ุญุงูุฉ "ุฎููุช" ุงููุงุฌูุฉ ุงูุฎูููุฉ ุงูุฃููู ุ ููู ุงูุซุงููุฉ ุณุชุฑุฏ ุจุณุฑุนุฉ: <strong>per_try_timeout = k * max (ุญูุซ k&gt; 0.5).</strong> </li></ul><br>  ููุงู ุทุฑู ูุฎุชููุฉ ุ ูููู ุจุดูู ุนุงู ุ <strong>ุงุฎุชูุงุฑ ูููุฉ ุตุนุจ</strong> .  ุณุชููู ููุงู ุฏุงุฆููุง ุญุงูุงุช ุญุฏูุฏูุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุชุชู ูุนุงูุฌุฉ ุงููุนุงูุฌ ููุณู ูู 99 ูช ูู ุงูุญุงูุงุช ูู 10 ูููู ุซุงููุฉ ุ ูููู ููุงู 1 ูช ูู ุงูุญุงูุงุช ุนูุฏูุง ููุชุธุฑ 500 ูููู ุซุงููุฉ ุ ููุฐุง ุฃูุฑ ุทุจูุนู.  ูุฌุจ ุญู ูุฐุง. <br><br>  ูุน ูุฐุง 1ูช ุ ูุฌุจ ุงูููุงู ุจุดูุก ูุง ุ ูุฃู ูุฌููุนุฉ ุงูุทูุจุงุช ุจุฃููููุง ูุฌุจ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุฃู ุชุชูุงูู ูุน ุงุชูุงููุฉ ูุณุชูู ุงูุฎุฏูุฉ ูุชูุงุณุจ 100 ูููู ุซุงููุฉ.  ูู ูุซูุฑ ูู ุงูุฃุญูุงู ูู ูุฐู ุงููุญุธุงุช ูุชู ูุนุงูุฌุฉ ุงูุทูุจ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุธูุฑ ุงูุชุฑุญูู ูู ุชูู ุงูุฃูุงูู ุญูุซ ูุณุชุญูู ุฅุฑุฌุงุน ุฌููุน ุงูุจูุงูุงุช ูู ูููุฉ. </li><li style=";text-align:right;direction:rtl">  ูุชู ูุตู ุงููุณุคูู / ุงูุชูุงุฑูุฑ ุฅูู ูุฌููุนุฉ ูููุตูุฉ ูู ุนูุงููู URL ูุฒูุงุฏุฉ ุงููููุฉ ุงููุฎุตุตุฉ ููุง ุ ููุนู ูุฎูุถ ุทูุจุงุช ุงููุณุชุฎุฏููู. </li><li style=";text-align:right;direction:rtl">  ูููู ุจุฅุตูุงุญ / ุชุญุณูู ุชูู ุงูุทูุจุงุช ุงูุชู ูุง ุชุชูุงุณุจ ูุน ุงููููุฉ. </li></ul><br>  ููุง ูุญุชุงุฌ ุฅูู ุงุชุฎุงุฐ ูุฑุงุฑ ุ ููู ููุณ ุจุณูุทูุง ุฌุฏูุง ูู ูุฌูุฉ ูุธุฑ ููุณูุฉ ุ ุฃูู ุฅุฐุง ูู ููู ูุฏููุง ููุช ููุฅุฌุงุจุฉ ุนูู ุงููุณุชุฎุฏู ูู ุงูููุช ุงููุฎุตุต ุ ูุณูู ูุนุทู ุฎุทุฃ (ููุง ูู ุงูุญุงู ูู ููู ุตููู ูุฏูู: "ุฅุฐุง ูุงุชุช ุงููุฑุณ ุ ุงูุฒู!") <strong>.</strong> <br><br>  ุจุนุฏ ุฐูู ุ ูุชู ุชุจุณูุท ุนูููุฉ ูุฑุงูุจุฉ ุงูุฎุฏูุฉ ูู ูุฌูุฉ ูุธุฑ ุงููุณุชุฎุฏู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงูุช ููุงู ุฃุฎุทุงุก ุ ูู ุดูุก ุณูุก ุ ูุฌุจ ุฅุตูุงุญู. </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูู ุชูู ููุงู ุฃุฎุทุงุก ุ ูุฅููุง ููุงุฆู ููุช ุงูุงุณุชุฌุงุจุฉ ุงูุตุญูุญ ุ ููู ุดูุก ุนูู ูุง ูุฑุงู. </li></ul><br><h3 style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงููุถุงุฑุจุฉ # nifig <br></h3><br>  ุชุฃูุฏูุง ูู ุฃู ุงุฎุชูุงุฑ ูููุฉ ุงููููุฉ ุฃูุฑ ุตุนุจ ููุบุงูุฉ.  ููุง ุชุนูููู ุ ูุชุจุณูุท ุดูุก ูุง ุ ุชุญุชุงุฌ ุฅูู ุชุนููุฏ ุดูุก :) <br><br>  <strong>ุฅุนุงุฏุฉ ุงููุถุงุฑุจุฉ</strong> - ุทูุจ ูุชูุฑุฑ ุฅูู ุฎุงุฏู ุขุฎุฑ ุ ูุงูุฐู ุชู ุฅุทูุงูู ูู ูุจู ุจุนุถ ุงูุดุฑูุท ุ ูููู ูู ูุชู ููุงุทุนุฉ ุงูุทูุจ ุงูุฃูู.  ูุฃุฎุฐ ุงูุฅุฌุงุจุฉ ูู ุงูุฎุงุฏู ุงูุฐู ุฃุฌุงุจ ุจุดูู ุฃุณุฑุน. <br><br>  ูู ุฃุฑ ูุฐู ุงูููุฒุฉ ูู ููุงุฒูุงุช ูุนุฑููุฉ ูู ุ ูููู ููุงู ูุซุงู ููุชุงุฒ ูุน Cassandra (ุญูุงูุฉ ุงููุฑุงุกุฉ ุงูุณุฑูุนุฉ): <br><br>  speculative_retry = N ms |  <strong>ุงููุฆุฉ ุงููุฆููุฉ</strong> <br><br>  ุจูุฐู ุงูุทุฑููุฉ <strong>ููุณ ุนููู ุฃู ุชูุชูู ุงููููุฉ</strong> .  ููููู ุชุฑููุง ุนูุฏ ูุณุชูู ููุจูู ููู ุฃู ุญุงู ูุฏูู ูุญุงููุฉ ุซุงููุฉ ููุญุตูู ุนูู ุฑุฏ ุนูู ุงูุทูุจ. <br><br>  ุชุชูุชุน ูุงุณุงูุฏุฑุง ุจูุฑุตุฉ ูุซูุฑุฉ ููุงูุชูุงู ูุชุญุฏูุฏ ุงููุถุงุฑุจุฉ ุงูุซุงุจุชุฉ ุฃู ุงูุฏููุงููููุฉ ุ ุซู ุณุชุชู ุงููุญุงููุฉ ุงูุซุงููุฉ ูู ุฎูุงู ุงููุณุจุฉ ุงููุฆููุฉ ูููุช ุงูุงุณุชุฌุงุจุฉ.  ุชุฌูุน ูุงุณุงูุฏุฑุง ุฅุญุตุงุฆูุงุช ุญูู ุฃููุงุช ุงูุงุณุชุฌุงุจุฉ ููุทูุจุงุช ุงูุณุงุจูุฉ ูุชููู ุจุชุนุฏูู ูููุฉ ูููุฉ ูุญุฏุฏุฉ.  ูุฐุง ูุนูู ุจุดูู ุฌูุฏ. <br><br>  ูู ูุฐุง ุงูููุฌ ุ ูุนุชูุฏ ูู ุดูุก ุนูู ุงูุชูุงุฒู ุจูู ุงูููุซูููุฉ ูุงูุญูู ุงูุฒุงุฆู. ูููุณ ุงูุฎูุงุฏู. ุฃูุช ุชููุฑ ุงูููุซูููุฉ ุ ูููู ูู ุจุนุถ ุงูุฃุญูุงู ุชุญุตู ุนูู ุทูุจุงุช ุฅุถุงููุฉ ุฅูู ุงูุฎุงุฏู.  ุฅุฐุง ููุช ูู ุนุฌูุฉ ูู ุฃูุฑู ูู ููุงู ูุง ูุฃุฑุณูุช ุทูุจูุง ุซุงูููุง ุ ูููู ุงูุทูุจ ุงูุฃูู ูุง ูุฒุงู ูุชู ุงูุฑุฏ ุนููู ุ ููุฏ ุชููู ุงูุฎุงุฏู ุงููุฒูุฏ ูู ุงูุชุญููู.  ูู ุญุงูุฉ ูุงุญุฏุฉ ุ ูุฐู ูุดููุฉ ุตุบูุฑุฉ. <br><br><img src="https://habrastorage.org/webt/uv/7c/bs/uv7cbswancegyh5vc8t7mwvr8uy.png"><br><br>  ุงุชุณุงู ุงููููุฉ ุฌุงูุจ ููู ุขุฎุฑ.  ุณูุชุญุฏุซ ุฃูุซุฑ ุนู ุฅูุบุงุก ุงูุทูุจ ุ ูููู ุจุดูู ุนุงู ุ ุฅุฐุง ูุงูุช ูููุฉ ุทูุจ ุงููุณุชุฎุฏู ุจุฃูููู 100 ูููู ุซุงููุฉ ุ ููู ูููู ูู ุงูููุทูู ุชุนููู ูููุฉ ุงูุทูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุฏุฉ ุซุงููุฉ ูุงุญุฏุฉ.  ููุงู ุฃูุธูุฉ ุชุณูุญ ูู ุจุงูููุงู ุจุฐูู ุจุดูู ุฏููุงูููู: ุฎุฏูุฉ ูุฎุฏูุฉ ููู ูุง ุชุจูู ูู ุงูููุช ุงูุฐู ุณุชูุชุธุฑ ููู ุงูุฑุฏ ุนูู ูุฐุง ุงูุทูุจ.  ุงูุฃูุฑ ูุนูุฏ ุ ูููู ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅููู ูุฌุฃุฉ ุ ููููู ุจุณูููุฉ ูุนุฑูุฉ ููููุฉ ุงูููุงู ุจุฐูู ูู ููุณ ุงููุจุนูุซ. <br><br>  ูุง ุงูุฐู ุชุญุชุงุฌ ุฅูู ูุนุฑูุชู ุฃูุถูุง ุนู ุฅุนุงุฏุฉ ุงููุญุงููุฉุ <br><br><h3 style=";text-align:right;direction:rtl">  ููุทุฉ ุงููุงุนูุฏุฉ (V1) <br></h3><br>  ููุง V1 ููุณ ุงูุฅุตุฏุงุฑ 1. ูู ุงูุทูุฑุงู ููุงู ูุซู ูุฐุง ุงูููููู - ุณุฑุนุฉ V1.  ูุฐู ูู ุงูุณุฑุนุฉ ุงูุชู ูุณุชุญูู ุจุนุฏูุง ุฅุจุทุงุก ุชุณุงุฑุน ุงููุฏุฑุฌ.  ูู ุงูุถุฑูุฑู ุงูุฅููุงุน ุ ุซู ุงุชุฎุงุฐ ูุฑุงุฑ ุจุดุฃู ูุง ูุฌุจ ุงูููุงู ุจู ุจุนุฏ ุฐูู. <br><br>  ุชูุฌุฏ ููุณ ููุทุฉ ุงููุงุนูุฏุฉ ูู ููุงุฒูุงุช ุงูุชุญููู: <strong>ุนูุฏูุง ุชุชุฌุงูุฒ 1 ุจุงูุช ูู ุงูุงุณุชุฌุงุจุฉ ูุนูููู ุ ูุง ูููู ุฅุตูุงุญ ุงูุฃุฎุทุงุก</strong> .  ุฅุฐุง ูุงุชุช ุงูุฎูููุฉ ูู ูุฐู ุงููุฑุญูุฉ ุ ููู ุชุณุงุนุฏู ุฃู ูุญุงููุงุช ุฅุนุงุฏุฉ ุงููุญุงููุฉ.  ููููู ููุท ุชูููู ุงุญุชูุงููุฉ ุชุดุบูู ูุซู ูุฐุง ุงูุณููุงุฑูู ุ ูุฅุฌุฑุงุก ุฅููุงู ุชุดุบูู ูุทูู ุ ุฃู ุฅุฎุจุงุฑ ุชุทุจููู: "ุฃูุช ูุง ุชูุจู ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ ุงูุขู ุ ูููู ููููู ุชุนุฏูู ุงูุทูุจุงุช ุงููุฏููุฉ!" ุ ุซู ูู ุจุฅุฎูุงุฆูุง. <br><br>  ุฅุฐุง ููุช ุชุชุญูู ูู ุงูุนููู ุ ููุฐุง ุจุนุถ ุชุทุจููุงุช Ajax ุฃู ุชุทุจููุงุช ุงููุงุชู ุงููุญููู ุงูุตุนุจุฉ ุ ููุฏ ูุญุงูู ุชูุฑุงุฑ ุงูุทูุจ ุ ูุจุนุฏ ุฐูู ููููู ุงูุฎุฑูุฌ ูู ูุฐุง ุงููููู. <br><br><h3 style=";text-align:right;direction:rtl">  ููุทุฉ ุงููุงุนูุฏุฉ [ุงููุจุนูุซ] <br></h3><br>  ูุงู ูุฏู ุงููุจุนูุซ ูุซู ูุฐู ุงูุญููุฉ ุงูุบุฑูุจุฉ.  ููุงู per_try_timeout - ููู ุชุญุฏุฏ ุงููุฏุฉ ุงูุชู ูููู ุฃู ุชุณุชุบุฑููุง ูู ูุญุงููุฉ ููุญุตูู ุนูู ุฑุฏ ุนูู ุงูุทูุจ.  ุฅุฐุง ูุฌุญุช ูุฐู ุงููููุฉ ุ ูููู ุงููุงุฌูุฉ ุงูุฎูููุฉ ุจุฏุฃุช ุจุงููุนู ูู ุงูุงุณุชุฌุงุจุฉ ููุนููู ุ ููุฏ ุชูุช ููุงุทุนุฉ ูู ุดูุก ุ ูุชููู ุงูุนููู ุฎุทุฃ. <br><br>  ูุงู ุฒูููู Pavel Trukhanov ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">tru_pablo</a> ) ุจุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฑูุนุฉ</a> ุ ููู ุจุงููุนู ูู ูุจุนูุซ ุฑุฆูุณู ูุณุชููู ูู 1.7.  ุงูุขู ูุนูู ููุง ููุจุบู: ุฅุฐุง ุจุฏุฃ ุฅุฑุณุงู ุงูุงุณุชุฌุงุจุฉ ุ ููู ุชุนูู ุณูู ุงููููุฉ ุงูุนุงูููุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุงููุญุงููุฉ: ุงูุญุงุฌุฉ ุฅูู ุงูุญุฏ <br></h3><br>  ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุฌูุฏุฉ ุ ูููู ููุงู ูุง ูุณูู ุจุงูุทูุจุงุช ุงููุงุชูุฉ: ุงูุงุณุชุนูุงูุงุช ุงูุซูููุฉ ุงูุชู ุชุคุฏู ุฅูู ููุทู ูุนูุฏ ููุบุงูุฉ ุชุตู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุซูุฑูุง ููุง ุชุชูุงุณุจ ูุน per_try_timeout ูู ูุซูุฑ ูู ุงูุฃุญูุงู.  ุฅุฐุง ุฃุฑุณููุง ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุฑุงุฑูุง ูุชูุฑุงุฑูุง ุ ูุฅููุง ููุชู ูุงุนุฏุชูุง.  ูุฃูู <strong>ูู ูุนุธู ุฎุฏูุงุช ููุงุนุฏ ุงูุจูุงูุงุช (99.9ูช) ูุง ููุฌุฏ ุฅูุบุงุก ููุทูุจ</strong> . <br><br>  ุฅูุบุงุก ุงูุทูุจ ูุนูู ุฃู ุงูุนููู ูู ูุฎุชุฑู ุ ูุฃูุช ุจุญุงุฌุฉ ุฅูู ุฅููุงู ูู ุงูุนูู ุงูุขู.  ูุนูู Golang ุจูุดุงุท ุนูู ุชุนุฒูุฒ ูุฐุง ุงูููุฌ ุ ูููู ููุฃุณู ููุชูู ุจูุงุฌูุฉ ุฎูููุฉ ุ ูุงูุนุฏูุฏ ูู ูุณุชูุฏุนุงุช ููุงุนุฏ ุงูุจูุงูุงุช ูุง ุชุฏุนู ุฐูู. <br><br>  ููููุง ูุฐูู ุ ูุฌุจ ุฃู ุชููู ุนูููุงุช ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุญุฏูุฏุฉ ุ ููุง ูุณูุญ ูุฌููุน ุงูููุงุฒูุงุช ุชูุฑูุจูุง (ูุชููู ุนู ุงูุชูููุฑ ูู HAProxy ูู ุงูุขู ูุตุงุนุฏูุง). <br><br>  <strong>Nginx:</strong> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  proxy_next_upstream_timeout (ุนุงููู) </li><li style=";text-align:right;direction:rtl">  proxt_read_timeout ** ูู per_try_timeout </li><li style=";text-align:right;direction:rtl">  proxy_next_upstream_tries </li></ul><br>  <strong>ุงููุจุนูุซ:</strong> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููุฉ (ุนุงูููุฉ) </li><li style=";text-align:right;direction:rtl">  per_try_timeout </li><li style=";text-align:right;direction:rtl">  num_retries </li></ul><br>  ูู Nginx ุ ูููููุง ุงูููู ุฃููุง ูุญุงูู ุฅุฌุฑุงุก ุนูููุงุช ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุฎูุงู ุงููุงูุฐุฉ X ุ ุฃู ูู ูุชุฑุฉ ุฒูููุฉ ูุนููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ 500 ูููู ุซุงููุฉ ุ ูููู ุจุชูููุฐ ุงูุนุฏูุฏ ูู ุนูููุงุช ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุจุงูุดูู ุงูููุงุณุจ.  ุฃู ููุงู ุฅุนุฏุงุฏ ูุญุฏ ูู ุนุฏุฏ ุงูุนููุงุช ุงููุชูุฑุฑุฉ.  ูู <strong>Envoy</strong> ุ ููุณ ุงูุดูุก ูู ุงููููุฉ ุฃู ุงููููุฉ (ุงูุนุงูููุฉ). <br><br><h4 style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุงููุญุงููุฉ: ุชุทุจูู [nginx] <br></h4><br>  ุฎุฐ ุจุนูู ุงูุงุนุชุจุงุฑ ูุซุงู: ูููุง ุจุชุนููู ูุญุงููุงุช ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูู nginx 2 - ููููุง ูุฐูู ุ ุจุนุฏ ุฃู ุงุณุชูููุง HTTP 503 ุ ูุญุงูู ุฅุฑุณุงู ุทูุจ ุฅูู ุงูุฎุงุฏู ูุฑุฉ ุฃุฎุฑู.  ุซู ูู ุจุฅููุงู ุงููุงุฌูุฉ ุงูุฎูููุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">upstream backends { server 127.0.0.1:20001; server 127.0.0.1:20002; server 127.0.0.1:20003; } server { listen 127.0.0.1:30000; proxy_next_upstream error timeout http_503; proxy_next_upstream_tries 2; location / { proxy_pass http://backends; } }</code> </pre><br>  ูููุง ููู ุงูุฑุณูู ุงูุจูุงููุฉ ูููุถุฏุฉ ุงูุงุฎุชุจุงุฑ ูุฏููุง.  ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู ุงูุฑุณู ุงูุจูุงูู ุงูุนููู ุ ูุฃู ููุงู ุงููููู ุฌุฏูุง ูููุง.  ุฅุฐุง ุชุฑูุช ุงูุฃุฎุทุงุก ููุท ุ ููู ุงููุงุถุญ ุฃููุง ูุฐูู. <br><br><img src="https://habrastorage.org/webt/3h/sx/aq/3hsxaq8qyifcoyq3mvcyzmxm_cc.png"><br><br><img src="https://habrastorage.org/webt/sc/f_/2w/scf_2wz9tctmouvrs9hpqtpmau0.png"><br><br>  <strong>ูุงุฐุง ุญุฏุซ</strong> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  proxy_next_upstream_tries = <strong>2.</strong> </li><li style=";text-align:right;direction:rtl">  ูู ุงูุญุงูุฉ ุงูุชู ุชููู ูููุง ุจุงููุญุงููุฉ ุงูุฃููู ููุฎุงุฏู "ุงูููุช" ุ ูุงูุซุงููุฉ - ุฅูู "ุงูููุช" ุงูุขุฎุฑ ุ ุชุญุตู ุนูู HTTP-503 ูู ุญุงูุฉ ุงููุญุงููุชูู ููุฎูุงุฏู "ุงูุณูุฆุฉ". </li><li style=";text-align:right;direction:rtl">  ููุงู ุฃุฎุทุงุก ููููุฉ ุ ูุธุฑูุง ูุฃู nginx "ูุญุธุฑ" ุฎุงุฏููุง ุณูุฆูุง.  ุฃู ุฃูู ูู nginx ุชู ุฅุฑุฌุงุน ุจุนุถ ุงูุฃุฎุทุงุก ูู ุงููุงุฌูุฉ ุงูุฎูููุฉ ุ ูุฅูู ูุชููู ุนู ุฅุฌุฑุงุก ุงููุญุงููุงุช ุงูุชุงููุฉ ูุฅุฑุณุงู ุทูุจ ุฅูููุง.  ูุญูู ูุฐุง ุงููุชุบูุฑ <strong>fail_timeout.</strong> </li></ul><br>  ูููู ููุงู ุฃุฎุทุงุก ููุฐุง ูุง ููุงุณุจูุง. <br><br>  <strong>ูุงุฐุง ุชูุนู ุญูุงู ุฐููุ</strong> <br><br>  ูููููุง ุฅูุง ุฒูุงุฏุฉ ุนุฏุฏ ูุฑุงุช ุฅุนุงุฏุฉ ุงููุญุงููุฉ (ูููู ุจุนุฏ ุฐูู ูุนูุฏ ุฅูู ูุดููุฉ "ุงูุทูุจุงุช ุงููุงุชูุฉ") ุ ุฃู ูููููุง ุชูููู ุงุญุชูุงููุฉ ูุตูู ุงูุทูุจ ุฅูู ุฎูููุงุช "ููุชุฉ".  ูููู ุงูููุงู ุจุฐูู ุนู ุทุฑูู <strong>ุงููุญูุตุงุช ุงูุตุญูุฉ.</strong> <br><br><h2 style=";text-align:right;direction:rtl">  ุงููุญูุตุงุช ุงูุตุญูุฉ <br></h2><br>  ุฃูุชุฑุญ ุงุนุชุจุงุฑ ุนูููุงุช ุงููุญุต ุงูุตุญู ุจูุซุงุจุฉ ุชุญุณูู ูุนูููุฉ ุงุฎุชูุงุฑ ุฎุงุฏู "ูุจุงุดุฑ".  <strong>ูุฐุง ูุง ูุนุทู ุฃู ุถูุงูุงุช.</strong>  ููููุง ูุฐูู ุ ุฃุซูุงุก ุชูููุฐ ุทูุจ ุงููุณุชุฎุฏู ุ ูู ุงููุฑุฌุญ ุฃู ูุตู ุฅูู ุฎูุงุฏู "ูุจุงุดุฑุฉ" ููุท.  ูุตู ุงูููุงุฒู ุจุงูุชุธุงู ุฅูู ุนููุงู URL ูุญุฏุฏ ุ ููุฌูุจู ุงูุฎุงุฏู: "ุฃูุง ุนูู ููุฏ ุงูุญูุงุฉ ูุฌุงูุฒ". <br><br><h4 style=";text-align:right;direction:rtl">  ุงููุญูุตุงุช ุงูุตุญูุฉ: ูู ุญูุซ ุงููุงุฌูุฉ ุงูุฎูููุฉ <br></h4><br>  ูู ูุฌูุฉ ุงููุธุฑ ุงูุฎูููุฉ ุ ููููู ุงูููุงู ุจุฃุดูุงุก ูุซูุฑุฉ ููุงูุชูุงู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุญูู ูู ุฌุงูุฒูุฉ ุชุดุบูู ุฌููุน ุงูุฃูุธูุฉ ุงููุฑุนูุฉ ุงูุฃุณุงุณูุฉ ุงูุชู ุชุนุชูุฏ ุนูููุง ุนูููุฉ ุงููุงุฌูุฉ ุงูุฎูููุฉ: ูุชู ุฅูุดุงุก ุงูุนุฏุฏ ุงููุงุฒู ูู ุงูุงุชุตุงูุงุช ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ููุฏู ุงูุชุฌูุน ุงุชุตุงูุงุช ูุฌุงููุฉ ุ ููุง ุฅูู ุฐูู ุ ุฅูุฎ. </li><li style=";text-align:right;direction:rtl">  ููููู ุชุนููู ุงูููุทู ุงูุฎุงุต ุจู ุนูู ุนููุงู URL ููุชุญูู ูู ุงูุตุญุฉ ุฅุฐุง ูุงู ุงูููุงุฒู ุงููุณุชุฎุฏู ููุณ ุฐูููุง ุฌุฏูุง (ุนูู ุณุจูู ุงููุซุงู ุ ููููู ุฃุฎุฐ ููุงุฒู ุงูุชุญููู ูู ุงููุถูู).  ูููู ููุฎุงุฏู ุฃู ูุชุฐูุฑ ุฃูู "ูู ุงููุญุธุฉ ุงูุฃุฎูุฑุฉ ุฃุฎุทุฃุช ุงูุนุฏูุฏ ูู ุงูุฃุฎุทุงุก - ุฑุจูุง ุฃููู ููุนูุง ูู ุฎุงุฏู" ุฎุงุทุฆ "ุ ููู ุงูุฏูููุชูู ุงูุชุงููุชูู ุณุฃุฑุฏ ุจู" ุฎูุณูุงุฆุฉ "ุนูู ุงููุญูุตุงุช ุงูุตุญูุฉ.  ูุจุงูุชุงูู ุณุฃุญุธุฑ ููุณู! "  ูุณุงุนุฏ ูุฐุง ุฃุญูุงููุง ูุซูุฑูุง ุนูุฏูุง ูููู ูุฏูู ููุงุฒู ุชุญููู ุบูุฑ ูุชุญูู ููู. </li><li style=";text-align:right;direction:rtl">  ุนุงุฏุฉู ุ ูููู ุงููุงุตู ุงูุฒููู ูููุญุต ุญูุงูู ุซุงููุฉ ุ ูุชุญุชุงุฌ ุฅูู ูุนุงูุฌ ุงูุชุญูู ูู ุงูุตุญุฉ ุญุชู ูุง ููุชู ุงูุฎุงุฏู ุงูุฎุงุต ุจู.  ูุฌุจ ุฃู ุชููู ุฎูููุฉ. </li></ul><br><h4 style=";text-align:right;direction:rtl">  ุงููุญูุตุงุช ุงูุตุญูุฉ: ุงูุชูููุฐ <br></h4><br>  ููุงุนุฏุฉ ุ ูู ุดูุก ููุง ูู ููุณู ููุฌููุน: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุทูุจ </li><li style=";text-align:right;direction:rtl">  ูููุฉ ุนููู ุ </li><li style=";text-align:right;direction:rtl">  ุงููุงุตู ุงูุฒููู ุงูุฐู ูููู ูู ุฎูุงูู ุจุงูุชุญูู.  ุงููููุงุก ุงููุฎุฏูุนูู ูุฏููู <strong>ุบุถุจ</strong> ุ ุฃู ุจุนุถ ุงูุนุดูุงุฆูุฉ ุจุญูุซ ูุง ุชุฃุชู ุฌููุน ุงููุญูุตุงุช ุงูุตุญูุฉ ุฅูู ุงููุงุฌูุฉ ุงูุฎูููุฉ ูุฑุฉ ูุงุญุฏุฉ ุ ููุง ุชูุชููุง. </li><li style=";text-align:right;direction:rtl">  <strong>ุงูุญุฏ ุบูุฑ ุงูุตุญู</strong> - ุงูุญุฏ ุงูุฃุฏูู ูุนุฏุฏ ุงููุญูุตุงุช ุงูุตุญูุฉ ุงููุงุดูุฉ ุงูุชู ูุฌุจ ุฃู ุชูุฑ ุญุชู ุชุชููู ุงูุฎุฏูุฉ ูู ูุถุน ุนูุงูุฉ ุนูููุง ุนูู ุฃููุง ุบูุฑ ุตุญูุฉ. </li><li style=";text-align:right;direction:rtl">  <strong>ุนุชุจุฉ ุตุญูุฉ</strong> - ุนูู ุงูุนูุณ ูู ุฐูู ุ ูู ุนุฏุฏ ุงููุญุงููุงุช ุงููุงุฌุญุฉ ุงูุชู ูุฌุจ ุฃู ุชูุฑ ุญุชู ูุนูุฏ ุงูุฎุงุฏู ุฅูู ุงูุชุดุบูู. </li><li style=";text-align:right;direction:rtl">  ููุทู ุฅุถุงูู.  ููููู ุชุญููู ูุญุต ุงูุญุงูุฉ + ุงููุต ุ ููุง ุฅูู ุฐูู. </li></ul><br>  ุชุทุจู Nginx ูุธุงุฆู ุงููุญุต ุงูุตุญู ููุท ูู ุงูุฅุตุฏุงุฑ ุงููุฏููุน ูู nginx +. <br><br>  ุฃูุงุญุธ ููุฒุฉ <strong>Envoy</strong> ุ ูุฏููุง <strong>ูุถุน ุงูุฐุนุฑ</strong> ุงูุงุฎุชูุงุฑ ุงูุตุญุฉ <strong>.</strong>  ุนูุฏูุง ุญุธุฑูุง ุ ุจุตูุชูุง "ุบูุฑ ุตุญููู" ุ ุฃูุซุฑ ูู Nูช ูู ุงููุถูููู (ูููููู 70ูช) ุ ูุนุชูุฏ ุฃู ุฌููุน ูุญูุตุงุชูุง ุงูุตุญูุฉ ุชูุฐุจ ุ ูุฃู ุฌููุน ุงููุถูููู ุนูู ููุฏ ุงูุญูุงุฉ.  ูู ุญุงูุฉ ุณูุฆุฉ ููุบุงูุฉ ุ ุณูุณุงุนุฏู ูุฐุง ูู ุนุฏู ููุงุฌูุฉ ูููู ุญูุซ ููุช ุจููุณู ุจุฅุทูุงู ุงููุงุฑ ุนูู ุณุงูู ูุญุธุฑุช ุฌููุน ุงูุฎูุงุฏู.  ูุฐู ุทุฑููุฉ ูุชููู ุขูููุง ูุฑุฉ ุฃุฎุฑู. <br><br><h2 style=";text-align:right;direction:rtl">  ุถุน ูู ุฐูู ูุนูุง <br></h2><br>  ุนุงุฏุฉ ููุญูุตุงุช ุงูุตุญุฉ ุงููุญุฏุฏุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฃู nginx + ุ </li><li style=";text-align:right;direction:rtl">  ุฃู nginx + ุดูุก ุขุฎุฑ :) </li></ul><br>  ูู ุจูุฏูุง ุ ููุงู ููู ูุชุนููู nginx + HAProxy ุ ูุฃู ุงูุฅุตุฏุงุฑ ุงููุฌุงูู ูู nginx ูุง ูุญุชูู ุนูู ูุญูุตุงุช ุตุญูุฉ ุ ูุญุชู 1.11.5 ูู ููู ููุงู ุญุฏ ูุนุฏุฏ ุงูุงุชุตุงูุงุช ุจุงููุงุฌูุฉ ุงูุฎูููุฉ.  ููู ูุฐุง ุงูุฎูุงุฑ ุณูุฆ ูุฃู HAProxy ูุง ูุนุฑู ููู ูุชูุงุนุฏ ุจุนุฏ ุฅูุดุงุก ุงุชุตุงู.  ูุนุชูุฏ ุงููุซูุฑ ูู ุงููุงุณ ุฃูู ุฅุฐุง ุฃุนุงุฏ HAProxy ุฎุทุฃู ูู ุฅุนุงุฏุฉ ูุญุงููุฉ nginx ู nginx ุ ูุณูููู ูู ุดูุก ุนูู ูุง ูุฑุงู.  ููุณ ุจุงููุนู.  ููููู ุงููุตูู ุฅูู HAProxy ุขุฎุฑ ูููุณ ุงูุฎูููุฉ ุ ูุฃู ุชุฌูุนุงุช ุงูุฎูููุฉ ูู ููุณูุง.  ูุฐุง ูุฃูุช ุชูุฏู ูุณุชูู ุชุฌุฑูุฏ ุขุฎุฑ ูููุณู ุ ููุง ูููู ูู ุฏูุฉ ููุงุฒูุชู ุ ูุจุงูุชุงูู ุ ุชููุฑ ุงูุฎุฏูุฉ. <br><br>  ูุฏููุง nginx + Envoy ุ ูููู ุฅุฐุง ููุช ูุฑุชุจููุง ุ ูููููู ูุตุฑ ููุณู ุนูู Envoy ููุท. <br><br><h2 style=";text-align:right;direction:rtl">  ุฃู ููุน ูู ุงููุจุนูุซููุ <br></h2><br>  Envoy ูู ููุงุฒู ุชุญููู ุงูุดุจุงุจ ุงูุนุตุฑู ุ ุงูุฐู ุชู ุชุทููุฑู ูู ุงูุฃุตู ูู Lyft ุ ููุชูุจูุง ูู C ++.  <strong>ูู ุฎุงุฑุฌ ููุทูุฉ ุงูุฌุฒุงุก ุ ููููู ุนูู ูุฌููุนุฉ ูู ุงููุนู ุญูู ููุถูุนูุง ุงูููู.</strong>  ุฑุจูุง ุฑุฃูุช ุฃููุง ุดุจูุฉ ุฎุฏูุฉ ู Kubernetes.  ููุงุนุฏุฉ ุ ูุนูู Envoy ูุทุงุฆุฑุฉ ุจูุงูุงุช ุ ุฃู ุฃูู ููุงุฒู ุญุฑูุฉ ุงููุฑูุฑ ูุจุงุดุฑุฉ ุ ูููุงู ุฃูุถูุง ุทุงุฆุฑุฉ ุชุญูู ุชููุฑ ูุนูููุงุช ุญูู ูุง ุชุญุชุงุฌู ูุชูุฒูุน ุงูุญูู ุจูู (ุงูุชุดุงู ุงูุฎุฏูุฉ ุ ููุง ุฅูู ุฐูู). <br><br>  ุณุฃุฎุจุฑูู ุจุจุถุน ูููุงุช ุนู ูุนูุงุชู. <br><br>  ูุฒูุงุฏุฉ ุงุญุชูุงููุฉ ูุฌุงุญ ุงุณุชุฌุงุจุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูู ุงููุฑุฉ ุงูุชุงููุฉ ุงูุชู ุชุญุงูู ูููุง ุ ููููู ุงูููู ูููููุง ูุงูุชุธุงุฑ ุธููุฑ ุงูุฎูููุฉ.  ุจูุฐู ุงูุทุฑููุฉ ุณูุชุนุงูู ูุน ูุดุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุตูุฑุฉ.  ูุฏู ุงููุจุนูุซ <strong>ุชุฑุงุฌุน ุนู ุฅุนุงุฏุฉ ุงููุญุงููุฉ</strong> - ุชููู ูุคูุช ุจูู ุฅุนุงุฏุฉ ุงููุญุงููุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุฒูุฏ ุงููุงุตู ุงูุฒููู ููุชุฃุฎูุฑ ุจูู ุงููุญุงููุงุช ุจุดูู ูุจูุฑ.  ุชุญุฏุซ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุฃููู ุจุนุฏ 0-24 ูููู ุซุงููุฉ ุ ูุงูุซุงููุฉ ุจุนุฏ 0-74 ูููู ุซุงููุฉ ุ ุซู ูุฒูุฏ ุงููุงุตู ุงูุฒููู ููู ูุญุงููุฉ ูุงุญูุฉ ุ ููุชู ุชุญุฏูุฏ ุงูุชุฃุฎูุฑ ุงููุญุฏุฏ ุนุดูุงุฆููุง ูู ูุฐุง ุงููุงุตู ุงูุฒููู. <br><br>  ุงูููุฌ ุงูุซุงูู ููุณ ุฎุงุตูุง ุจุงููุจุนูุซ ุ ููููู ููุท ูุณูู <strong>ูุณุฑ ุงูุฏุงุฆุฑุฉ</strong> (ูุงุทุน ุงูุฏุงุฆุฑุฉ ุฃู ุงููุตูุฑ).  ุนูุฏูุง ุชุชุถุงุกู ุงููุงุฌูุฉ ุงูุฎูููุฉ ุ ูุญุงูู ูู ุงูููุงูุฉ ุฅููุงุกูุง ูู ูู ูุฑุฉ.  ูุฐุง ูุฃู ุงููุณุชุฎุฏููู ูู ุฃู ูููู ุบูุฑ ููููู ูููุฑูู ุนูู ุตูุญุฉ ุงูุชุญุฏูุซ ุ ููุฑุณููู ูู ุงููุฒูุฏ ูุงููุฒูุฏ ูู ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ.  ูุฒุนุฌ ููุงุฒูู ุ ููุฑุณู ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุ ููุฒุฏุงุฏ ุนุฏุฏ ุงูุทูุจุงุช - ุงูุญูู ูุฒุฏุงุฏ ุ ููู ูุฐู ุงูุญุงูุฉ ุณูููู ูู ุงูุฌูุฏ ุนุฏู ุฅุฑุณุงู ุงูุทูุจุงุช. <br><br>  ูุงุทุน ุงูุฏุงุฆุฑุฉ ูุณูุญ ูู ููุท ุจุชุญุฏูุฏ ุฃููุง ูู ูุฐู ุงูุญุงูุฉ ุ ูุณุฑุนุงู ูุง ูุทูู ุงููุงุฑ ุนูู ุงูุฎุทุฃ ููุนุทู ุงูุฎูููุฉ "ุงูุชูุงุท ุฃููุงุณูู". <br><br><img src="https://habrastorage.org/webt/xb/mm/i8/xbmmi88cqacoqvkzdmujynq6da0.gif"><br>  <em>ููุงุทุน ุฏูุงุฆุฑ (hystrix ูุซู libs) ุ</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><em>ุฃุตููุฉ</em></a> <em>ุนูู ูุฏููุฉ ebay.</em> <br><br>  ุฃุนูุงู ูู ุฏุงุฆุฑุฉ ููุงุทุน Hystrix.  Hystrix ูู ููุชุจุฉ Java ูู Netflix ุชู ุชุตููููุง ูุชุทุจูู ุฃููุงุท ุชุญูู ุงูุฎุทุฃ. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููู ุฃู ูููู "ุงููุตูุฑ" ูู ุญุงูุฉ "ูุบููุฉ" ุนูุฏูุง ูุชู ุฅุฑุณุงู ุฌููุน ุงูุทูุจุงุช ุฅูู ุงููุงุฌูุฉ ุงูุฎูููุฉ ููุง ุชูุฌุฏ ุฃุฎุทุงุก. </li><li style=";text-align:right;direction:rtl">  ุนูุฏูุง ูุชู ุชุดุบูู ุญุฏ ูุดู ูุนูู ุ ุฃู ุฃู ุจุนุถ ุงูุฃุฎุทุงุก ูุฏ ุญุฏุซุช ุ ููุชูู ูุงุทุน ุงูุฏุงุฆุฑุฉ ุงูููุฑุจุงุฆูุฉ ุฅูู ุงูุญุงูุฉ "ูุชุญ".  ุชููู ุจุฅุฑุฌุงุน ุฎุทุฃ ุฅูู ุงูุนููู ุจุณุฑุนุฉ ุ ููุง ุชุตู ุงูุทูุจุงุช ุฅูู ุงููุงุฌูุฉ ุงูุฎูููุฉ. </li><li style=";text-align:right;direction:rtl">  ูุฑุฉ ูุงุญุฏุฉ ูู ูุชุฑุฉ ุฒูููุฉ ูุนููุฉ ุ ูุง ูุฒุงู ูุชู ุฅุฑุณุงู ุฌุฒุก ุตุบูุฑ ูู ุงูุทูุจุงุช ุฅูู ุงููุงุฌูุฉ ุงูุฎูููุฉ.  ุฅุฐุง ุชู ุชุดุบูู ุฎุทุฃ ุ ุชุธู ุงูุญุงูุฉ "ููุชูุญุฉ".  ุฅุฐุง ุจุฏุฃ ูู ุดูุก ูู ุงูุนูู ุจุดูู ุฌูุฏ ูุงุณุชุฌุงุจ ุ ูุณูุบูู "ุงููุตูุฑ" ููุณุชูุฑ ุงูุนูู. </li></ul><br>  ูู ุงููุจุนูุซ ุ ุนูู ูุฐุง ุงููุญู ุ ููุณ ูุฐุง ูู ุดูุก.  ููุงู ุญุฏูุฏ ุงููุณุชูู ุงูุฃุนูู ุนูู ุญูููุฉ ุฃูู ูุง ูููู ุฃู ูููู ููุงู ุฃูุซุฑ ูู N ุทูุจุงุช ููุฌููุนุฉ ุฑุฆูุณูุฉ ูุญุฏุฏุฉ.  ุฅุฐุง ูุงู ููุงู ุงููุฒูุฏ ุ ููุงู ุฎุทุฃ ูุง - ูุนุฑุถ ุฎุทุฃ.  ูุง ูููู ุฃู ูููู ููุงู ุงููุฒูุฏ ูู ุนูููุงุช ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงููุดุทุฉ ูู N (ุฃู ุนูููุงุช ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชู ุชุญุฏุซ ุงูุขู). <br><br>  ูู ููู ูุฏูู ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุ ุงููุฌุฑ ุดูุก ูุง - ุฃุฑุณู ุฅุนุงุฏุฉ ุงููุญุงููุฉ.  ูููู ุงููุจุนูุซ ุฃู ุฃูุซุฑ ูู N ุบูุฑ ุทุจูุนู ุ ููุฌุจ ุชุตููุฑ ุฌููุน ุงูุทูุจุงุช ูุน ูุฌูุฏ ุฎุทุฃ. <br><br>  <strong>ูุณุฑ ุงูุฏุงุฆุฑุฉ [ุงููุจุนูุซ]</strong> <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฃูุตู ุงุชุตุงูุงุช ุงููุชูุฉ (ูุฌููุนุฉ ุงูููุจุน) </li><li style=";text-align:right;direction:rtl">  ุงูุญุฏ ุงูุฃูุตู ููุทูุจุงุช ุงููุนููุฉ ูู ุงููุฌููุนุฉ </li><li style=";text-align:right;direction:rtl">  ุทูุจุงุช ุงููุชูุฉ ุงููุตูู </li><li style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ูุญุงููุฉ ุงููุชูุฉ ุงููุดุทุฉ </li></ul><br>  ูุนูู ูุฐุง ุงูุดูุก ุงูุจุณูุท ุจุดูู ุฌูุฏ ุ ููู ูุงุจู ููุชูููู ุ ููุง ูุชุนูู ุนููู ุงูุชูุตู ุฅูู ูุนููุงุช ุฎุงุตุฉ ุ ูุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ุฌูุฏุฉ ุฌุฏูุง. <br><br><h4 style=";text-align:right;direction:rtl">  ููุงุทุน ุฏูุงุฆุฑ: ุชุฌุฑุจุชูุง <br></h4><br>  ุงุนุชุฏูุง ุฃู ูููู ูุฏููุง ุฌุงูุน ููุงููุณ HTTP ุ ุฃู ุฃู ูููุงุก ูุซุจุชูู ุนูู ุฎูุงุฏู ุนููุงุฆูุง ุฃุฑุณููุง ููุงููุณ ุฅูู ุงูุณุญุงุจุฉ ุนุจุฑ HTTP.  ุฅุฐุง ูุงู ูุฏููุง ุฃู ูุดุงูู ูู ุงูุจููุฉ ุงูุชุญุชูุฉ ุ ููุชุจ ุงููููู ุงูููุงููุณ ุนูู ูุฑุตู ุซู ูุญุงูู ุฅุฑุณุงููุง ุฅูููุง. <br><br>  ููููู ุงููููุงุก ุจุงุณุชูุฑุงุฑ ุจูุญุงููุงุช ูุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูููุง ุ ููุง ูุดุนุฑูู ุจุงูุถูู ูุฃููุง ุจุทุฑููุฉ ูุง ูุฑุฏ ุจุดูู ุบูุฑ ุตุญูุญ ุ ููุง ูุบุงุฏุฑ. <br><br>         (       ,      )  ,     ,           . <br><br>            nginx limit req.    ,    , , 200 RPS.       ,   ,          ,   limit req. <br><br>           TCP     HTTP (  nginx limit req).            .      limit req . <br><br>     ,      ,  .   <strong> </strong>  Circuit breaker,  ,     N  ,   ,   - ,   ,  .   ,    ,      spool  . <br><br>  <strong></strong>   Circuit breaker       + request cancellation ( ).  ,    N   Cassandra, N   Elastic,  ,    โ   ,         .      โ ,   . <br><br><img src="https://habrastorage.org/webt/jo/l2/jk/jol2jk44vlcmz3twgvr0jgtpbii.png"><br><br><img src="https://habrastorage.org/webt/1a/7b/x4/1a7bx4yq20uehqoagd4tutqxgmw.png"><br><br>    ,         (:  โ  ยซยป,  โ ยซยป). ,      800 RPS    20-30.     ยซยป, ,    . <br><br><h2 style=";text-align:right;direction:rtl">    <br></h2><br>    โ  ,  . <br><br>         ,   ,        โ      .    . <br><br>  ,       , ,      ,   Health checks โ HTTP 200. <br><br>    . <br><br><img src="https://habrastorage.org/webt/yu/cy/9s/yucy9sofdr-z7brvjedmnxt4_gc.png"><br><br>     Load Balancer, 3 ,         Cassandra.      Cassandra,   Cassandra   ,    Cassandra     data noda. <br><br>   โ    : <strong>kernel: NETDEV WATCHDOG: eth0 (ixgbe): transmit queue 3 timed out.</strong> <br><br>   :     (    ),    64     . , 1/64   .     reboot,    . <br><br> ,  ,    ,      .  , ,        ,            .   ,    ,   .     ,   . <br><br> <strong>Cassandra: coordinator -&gt; nodes</strong> <br><br>  Cassandra,      (speculative retries),      .    latency  99 ,         . <br><br> <strong>App -&gt; cassandra coordinator</strong> <br><br>     .     Cassandra      ยซยป ,    ,  ,  latency  .. <br><br>      gocql โ   cassandra client.       .   HostSelectionPolicy,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">bitly/go-hostpool</a> .    Epsilon greedy  ,       . <br><br>     ,    <strong>Epsilon-greedy</strong> . <br><br>      (multi-armed bandit):       ,     ,     N     . <br><br>    : <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ยซ <strong>exploreยป</strong> โ   : 10    ,  ,   . <br></li><li style=";text-align:right;direction:rtl">  ยซ <strong>exploitยป</strong> โ      . <br></li></ol><br> ,    (10 โ 30%)   <strong>round</strong> - <strong>robin</strong>    ,  ,  ,  .  70 โ 90%        . <br><br> Host-pool          .         .        (    โ ,    ,  ).      .      ,     , ,       . <br><br><h2 style=";text-align:right;direction:rtl">   </h2><br>   ยซยป ()   โCassandra  Cassandra coordinator-data.     (nginx, Envoy โ  )    ยซยป Application,     Cassandra  ,       ,      . <br><br>  Envoy    <strong>Outlier detection</strong> : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> Consecutive http-5xx. </li><li style=";text-align:right;direction:rtl"> Consecutive gateway errors (502,503,504). </li><li style=";text-align:right;direction:rtl"> Success rate. </li></ul><br>   ยซยป  ,    -  ,   .   ,    .        โ    ,   ,     .  ,    ,          . <br><br>   ,       ยซยป,   max_ejection_percent.    ,      outlier,     .  ,    70%  โ  ,   โ , ! <br><br>      ,       โ ! <br><br><h2 style=";text-align:right;direction:rtl">  <br></h2><br> ,     ,      .  ,       latency    , : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ,        .. </li><li style=";text-align:right;direction:rtl">    ,      -,       . </li></ul><br> ,  <strong>    </strong> ,   .  ,      ,     ,         โ  ,    . <br><br> <strong>      </strong> .  99%     nginx/ <s>HAProxy</s> /Envoy.   proxy ,           ยซยป. <br><br> <strong>    proxy</strong> (   HAProxy:)), <strong>  ,    .</strong> <br><br><blockquote style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DevOpsConf Russia</a>      Kubernetes         .          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> . <br><br>    ,       โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a>      DevOps. <br><br>    ,   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">YouTube-</a> โ              . <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar423085/">https://habr.com/ru/post/ar423085/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar423073/index.html">ูุธุงู ุงููููุงุช ุจูู ุงูููุงูุจ - ุชุฌุฒุฆุฉ (ูููุฉ) ุชุงููุฉ ุ ูุชูุฉ DAG ููุฎุงุฒู ุงูุจุฑูุชูููู</a></li>
<li><a href="../ar423075/index.html">ููุงุฐุง ูุชูู ุงููุฏูุฑูู ุงููุงูููู ุฅูู ุชุฑุฌูุฉ ุงูุฅููุงู ุงูุฑุฃุณูุงูู ุนูู ุชูููููุฌูุง ุงููุนูููุงุช ุฅูู ุงูุชุดุบูู</a></li>
<li><a href="../ar423077/index.html">ุฏููู ูุฌูุน X86 ูููุจุชุฏุฆูู</a></li>
<li><a href="../ar423079/index.html">ุงูููุงุท ุงูุฑุฆูุณูุฉ ูู ููุงุจูุฉ ูุน Elon Musk ูู Joe Rogan</a></li>
<li><a href="../ar423083/index.html">ููู ุฃุตุจุญุช ูุทูุฑูุง ูู ABBYY</a></li>
<li><a href="../ar423087/index.html">ูุง ุชุฏูุนูู ูู ุนููู</a></li>
<li><a href="../ar423089/index.html">ุงููุจุฑูุฌูู ูู MBLT DEV 2018</a></li>
<li><a href="../ar423091/index.html">Flutter ููุทูุฑู Android. ููููุฉ ุฅูุดุงุก ูุงุฌูุฉ ูุณุชุฎุฏู ููุดุงุท ุจุงุณุชุฎุฏุงู Flutter</a></li>
<li><a href="../ar423093/index.html">ูุฒูุฏ ุนุดูุงุฆูุฉ ุญูููุฉ ุฃูู [ุนูู ุงูุฃุฑุฌุญ] [ุชูุฑูุจูุง] ุนู ุทุฑูู ุงูุตุฏูุฉ</a></li>
<li><a href="../ar423095/index.html">ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ูู Apple Presentation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>