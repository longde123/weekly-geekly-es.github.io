<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>тЩУя╕П ЁЯЦХЁЯП╝ ЁЯЪС C ++ vtablesред рднрд╛рдЧ 1 (рдореВрд▓ рдмрд╛рддреЗрдВ + рдПрдХрд╛рдзрд┐рдХ рд╡рдВрд╢рд╛рдиреБрдХреНрд░рдо) ЁЯТД ЁЯФЙ ЁЯжА</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░! рд▓реЗрдЦ рдХрд╛ рдЕрдиреБрд╡рд╛рдж рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдкрд╛рдареНрдпрдХреНрд░рдо "C ++ рдбреЗрд╡рд▓рдкрд░" рдХреЗ рдЫрд╛рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдХреНрдпрд╛ рдЗрд╕ рджрд┐рд╢рд╛ рдореЗрдВ рд╡рд┐рдХрд╛рд╕ рдХрд░рдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ? 13 рджрд┐рд╕...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C ++ vtablesред рднрд╛рдЧ 1 (рдореВрд▓ рдмрд╛рддреЗрдВ + рдПрдХрд╛рдзрд┐рдХ рд╡рдВрд╢рд╛рдиреБрдХреНрд░рдо)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/479802/"><p>  <em>рд╕рднреА рдХреЛ рдирдорд╕реНрдХрд╛рд░!</em>  <em>рд▓реЗрдЦ рдХрд╛ рдЕрдиреБрд╡рд╛рдж рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдкрд╛рдареНрдпрдХреНрд░рдо <a href="https://otus.pw/d2qJ/">"C ++ рдбреЗрд╡рд▓рдкрд░" рдХреЗ</a> рдЫрд╛рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред</em>  <em>рдХреНрдпрд╛ рдЗрд╕ рджрд┐рд╢рд╛ рдореЗрдВ рд╡рд┐рдХрд╛рд╕ рдХрд░рдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ?</em>  <em>13 рджрд┐рд╕рдВрдмрд░ рдХреЛ 20:00 рдорд╛рд╕реНрдХреЛ рд╕рдордп рдкрд░ рдСрдирд▓рд╛рдЗрди рдЖрдУред</em>  <em>рдорд╛рд╕реНрдЯрд░ рд╡рд░реНрдЧ <a href="https://otus.pw/x79M/">"Google рдЯреЗрд╕реНрдЯ рдлреНрд░реЗрдорд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ"</a> !</em> </p><br><p><img src="https://habrastorage.org/webt/eh/lh/ox/ehlhoxzs1sz7v7xtni9lizjefxq.png"></p><br><p>  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рд╣рдо рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдХреИрд╕реЗ рдХреНрд▓реЗрдВрде vtables (рд╡рд░реНрдЪреБрдЕрд▓ рдореЗрдердб рдЯреЗрдмрд▓) рдФрд░ RTTI (рд░рдирдЯрд╛рдЗрдо рдЯрд╛рдЗрдк рдЖрдЗрдбреЗрдВрдЯрд┐рдлрд┐рдХреЗрд╢рди) рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред  рдкрд╣рд▓реЗ рднрд╛рдЧ рдореЗрдВ, рд╣рдо рдЖрдзрд╛рд░ рдХрдХреНрд╖рд╛рдУрдВ рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдХрдИ рдФрд░ рдЖрднрд╛рд╕реА рд╡рд┐рд░рд╛рд╕рдд рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред <a name="habracut"></a></p><br><p>  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рд╣рдореЗрдВ gdb рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдкрдиреЗ рдХреЛрдб рдХреЗ рд╡рд┐рднрд┐рдиреНрди рднрд╛рдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрддреНрдкрдиреНрди рджреНрд╡рд┐рдЖрдзрд╛рд░реА рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдореЗрдВ рдЦреБрджрд╛рдИ рдХрд░рдиреА рд╣реИред  рдпрд╣ рдХрд╛рдлреА рдирд┐рдореНрди рд╕реНрддрд░ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВ рдЖрдкрдХреЗ рд▓рд┐рдП рдкреВрд░реА рдореЗрд╣рдирдд рдХрд░реВрдВрдЧрд╛ред  рдореБрдЭреЗ рдирд╣реАрдВ рд▓рдЧрддрд╛ рдХрд┐ рднрд╡рд┐рд╖реНрдп рдХреЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдкреЛрд╕реНрдЯ рдЗрддрдиреЗ рдирд┐рдЪрд▓реЗ рд╕реНрддрд░ рдХреЗ рд╡рд┐рд╡рд░рдг рдХрд╛ рд╡рд░реНрдгрди рдХрд░реЗрдВрдЧреЗред </p><br><blockquote>  <em>рдбрд┐рд╕реНрдХреНрд▓реЗрдорд░</em> : рдпрд╣рд╛рдВ рд▓рд┐рдЦреА рдЧрдИ рд╣рд░ рдЪреАрдЬ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИ, рднрд╡рд┐рд╖реНрдп рдХреЗ рдХрд┐рд╕реА рднреА рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдмрджрд▓ рд╕рдХрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрд╕ рдкрд░ рднрд░реЛрд╕рд╛ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред  рд╣рдо рдЗрд╕реЗ рдХреЗрд╡рд▓ рд╢реИрдХреНрд╖рд┐рдХ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдорд╛рдирддреЗ рд╣реИрдВред </blockquote><p><img src="https://habrastorage.org/webt/40/po/du/40podustjhxkcl7_keexd9uea2e.png"></p><br><p>  рдЙрддреНрдХреГрд╖реНрдЯ, рддреЛ рдЪрд▓реЛ рд╢реБрд░реВ рд╣реЛ рдЬрд╛рдУред </p><br><h2 id="chast-1---vtables---osnovy">  рднрд╛рдЧ 1 - vtables - рдореВрд▓ рдмрд╛рддреЗрдВ </h2><br><p>  рдЖрдЗрдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рджреЗрдЦреЗрдВ: </p><br><pre><code class="plaintext hljs">#include &lt;iostream&gt; using namespace std; class NonVirtualClass { public: void foo() {} }; class VirtualClass { public: virtual void foo() {} }; int main() { cout &lt;&lt; "Size of NonVirtualClass: " &lt;&lt; sizeof(NonVirtualClass) &lt;&lt; endl; cout &lt;&lt; "Size of VirtualClass: " &lt;&lt; sizeof(VirtualClass) &lt;&lt; endl; }</code> </pre> <br><pre> <code class="plaintext hljs">$ #    main.cpp $ clang++ main.cpp &amp;&amp; ./a.out Size of NonVirtualClass: 1 Size of VirtualClass: 8</code> </pre> <br><p>  <code>NonVirtualClass</code> рдХрд╛ рдЖрдХрд╛рд░ 1 рдмрд╛рдЗрдЯ рд╣реЛрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ C ++ рдХрдХреНрд╖рд╛рдУрдВ рдореЗрдВ рд╢реВрдиреНрдп рдХрд╛ рдЖрдХрд╛рд░ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рдЕрдм рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИред </p><br><p>  <code>VirtualClass</code> рдПрдХ 64-рдмрд┐рдЯ рдорд╢реАрди рдкрд░ 8 рдмрд╛рдЗрдЯреНрд╕ рд╣реИред  рдХреНрдпреЛрдВ?  рдХреНрдпреЛрдВрдХрд┐ рдЕрдВрджрд░ рдПрдХ рдЫрд┐рдкреА рд╣реБрдИ рдкреЙрдЗрдВрдЯрд░ рд╣реИ рдЬреЛ рдПрдХ рд╡рд╛рдЗрдмреЗрдЯ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддреА рд╣реИред  vtables рдкреНрд░рддреНрдпреЗрдХ рдЖрднрд╛рд╕реА рдХрдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдИ рдЧрдИ рд╕реНрдерд┐рд░ рдЕрдиреБрд╡рд╛рдж рддрд╛рд▓рд┐рдХрд╛рдПрдБ рд╣реИрдВред  рдпрд╣ рд▓реЗрдЦ рдЙрдирдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  Vtables рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ, рдЗрд╕рдХреА рдЧрд╣рд░реА рд╕рдордЭ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдЗрдП gdb рдХреЗ рд╕рд╛рде рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рджреЗрдЦреЗрдВ рдХрд┐ рдХреИрд╕реЗ рд╕реНрдореГрддрд┐ рдЖрд╡рдВрдЯрд┐рдд рдХреА рдЧрдИ рд╣реИ: </p><br><pre> <code class="plaintext hljs">#include &lt;iostream&gt; class Parent { public: virtual void Foo() {} virtual void FooNotOverridden() {} }; class Derived : public Parent { public: void Foo() override {} }; int main() { Parent p1, p2; Derived d1, d2; std::cout &lt;&lt; "done" &lt;&lt; std::endl; }</code> </pre> <br><pre> <code class="plaintext hljs">$ #         ,  gdb $ clang++ -std=c++14 -stdlib=libc++ -g main.cpp &amp;&amp; gdb ./a.out ... (gdb) #  gdb  -  C++ (gdb) set print asm-demangle on (gdb) set print demangle on (gdb) #     main (gdb) b main Breakpoint 1 at 0x4009ac: file main.cpp, line 15. (gdb) run Starting program: /home/shmike/cpp/a.out Breakpoint 1, main () at main.cpp:15 15 Parent p1, p2; (gdb) #     (gdb) n 16 Derived d1, d2; (gdb) #     (gdb) n 18 std::cout &lt;&lt; "done" &lt;&lt; std::endl; (gdb) #  p1, p2, d1, d2 -     ,    (gdb) p p1 $1 = {_vptr$Parent = 0x400bb8 &lt;vtable for Parent+16&gt;} (gdb) p p2 $2 = {_vptr$Parent = 0x400bb8 &lt;vtable for Parent+16&gt;} (gdb) p d1 $3 = {&lt;Parent&gt; = {_vptr$Parent = 0x400b50 &lt;vtable for Derived+16&gt;}, &lt;No data fields&gt;} (gdb) p d2 $4 = {&lt;Parent&gt; = {_vptr$Parent = 0x400b50 &lt;vtable for Derived+16&gt;}, &lt;No data fields&gt;}</code> </pre> <br><p>  рдКрдкрд░ рд╕реЗ рд╣рдордиреЗ рдЬреЛ рд╕реАрдЦрд╛ рд╡рд╣ рдпрд╣рд╛рдВ рд╣реИ: <br>  - рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ рдХрдХреНрд╖рд╛рдУрдВ рдореЗрдВ рдбреЗрдЯрд╛ рд╕рджрд╕реНрдп рдирд╣реАрдВ рд╣реИрдВ, рд╡рд╣рд╛рдБ рдПрдХ рдЫрд┐рдкреА рд╕реВрдЪрдХ рд╣реИ, рдЬреЛ vtable рд╣реИ; <br>  - p1 рдФрд░ P2 рдХреЗ рд▓рд┐рдП рд╡рд┐рдЯреЗрдмрд▓ рд╕рдорд╛рди рд╣реИред  vtables рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕реНрдерд┐рд░ рдбреЗрдЯрд╛ рд╣реИрдВ; <br>  - рдбреА 1 рдФрд░ рдбреА 2 рдХреЛ рдкреЗрд░реЗрдВрдЯ рд╕реЗ рд╡рд╛рдЗрдмреЗрдЯ-рдкреЙрдЗрдВрдЯрд░ рд╡рд┐рд░рд╛рд╕рдд рдореЗрдВ рдорд┐рд▓рд╛ рд╣реИ, рдЬреЛ рд╡рд╛рдЗрдмрд░реНрдб рдбрд┐рд╡рд┐рдПрдб рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ; <br>  - рд╕рднреА vtables 16 (0x10) рдмрд╛рдЗрдЯреНрд╕ рдСрдлрд╝рд╕реЗрдЯ рдХреЛ рд╡рд╛рдЗрдмреЗрдЯ рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рдХреА рдЪрд░реНрдЪрд╛ рд╣рдо рдмрд╛рдж рдореЗрдВ рднреА рдХрд░реЗрдВрдЧреЗред </p><br><p>  рдЪрд▓реЛ vtables рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ gdb рд╕рддреНрд░ рдХреЛ рдЬрд╛рд░реА рд░рдЦреЗрдВред  рдореИрдВ x рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдВрдЧрд╛, рдЬреЛ рд╕реНрдХреНрд░реАрди рдкрд░ рдореЗрдореЛрд░реА рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИред  рд╣рдо рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рдореЗрдВ 300 рдмрд╛рдЗрдЯреНрд╕ рдХрд╛ рдЙрддреНрдкрд╛рджрди рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ, рдЬрд┐рд╕рдХреА рд╢реБрд░реБрдЖрдд 0x400b40 рд╕реЗ рд╣реЛрддреА рд╣реИред  рдЖрдЦрд┐рд░ рдпрд╣ рдкрддрд╛ рдХреНрдпреЛрдВ?  рдХреНрдпреЛрдВрдХрд┐ рд╣рдордиреЗ рдКрдкрд░ рджреЗрдЦрд╛ рдХрд┐ vtable рдкреЙрдЗрдВрдЯрд░ 0x400b50 рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕ рдПрдбреНрд░реЗрд╕ рдХрд╛ рд╕рд┐рдВрдмрд▓ <code>vtable for Derived+16 (16 == 0x10)</code> рд▓рд┐рдП рд╡реЙрдпрдЯреЗрдмрд▓ рд╣реИред </p><br><pre> <code class="plaintext hljs">(gdb) x/300xb 0x400b40 0x400b40 &lt;vtable for Derived&gt;: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x400b48 &lt;vtable for Derived+8&gt;: 0x90 0x0b 0x40 0x00 0x00 0x00 0x00 0x00 0x400b50 &lt;vtable for Derived+16&gt;: 0x80 0x0a 0x40 0x00 0x00 0x00 0x00 0x00 0x400b58 &lt;vtable for Derived+24&gt;: 0x90 0x0a 0x40 0x00 0x00 0x00 0x00 0x00 0x400b60 &lt;typeinfo name for Derived&gt;: 0x37 0x44 0x65 0x72 0x69 0x76 0x65 0x64 0x400b68 &lt;typeinfo name for Derived+8&gt;: 0x00 0x36 0x50 0x61 0x72 0x65 0x6e 0x74 0x400b70 &lt;typeinfo name for Parent+7&gt;: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x400b78 &lt;typeinfo for Parent&gt;: 0x90 0x20 0x60 0x00 0x00 0x00 0x00 0x00 0x400b80 &lt;typeinfo for Parent+8&gt;: 0x69 0x0b 0x40 0x00 0x00 0x00 0x00 0x00 0x400b88: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x400b90 &lt;typeinfo for Derived&gt;: 0x10 0x22 0x60 0x00 0x00 0x00 0x00 0x00 0x400b98 &lt;typeinfo for Derived+8&gt;: 0x60 0x0b 0x40 0x00 0x00 0x00 0x00 0x00 0x400ba0 &lt;typeinfo for Derived+16&gt;: 0x78 0x0b 0x40 0x00 0x00 0x00 0x00 0x00 0x400ba8 &lt;vtable for Parent&gt;: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x400bb0 &lt;vtable for Parent+8&gt;: 0x78 0x0b 0x40 0x00 0x00 0x00 0x00 0x00 0x400bb8 &lt;vtable for Parent+16&gt;: 0xa0 0x0a 0x40 0x00 0x00 0x00 0x00 0x00 0x400bc0 &lt;vtable for Parent+24&gt;: 0x90 0x0a 0x40 0x00 0x00 0x00 0x00 0x00 ...</code> </pre> <br><blockquote>  рдиреЛрдЯ: рд╣рдо рдбреА-рдбреЗрдХреЛрд░реЗрдЯ (рдзреНрд╡рд╕реНрдд) рд╡рд░реНрдгреЛрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред  рдпрджрд┐ рдЖрдк рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, рддреЛ _ZTV vtable рдХреЗ рд▓рд┐рдП рдЙрдкрд╕рд░реНрдЧ рд╣реИ, _ZTS рдкреНрд░рдХрд╛рд░ рд╕реНрдЯреНрд░рд┐рдВрдЧ (рдирд╛рдо) рдХреЗ рд▓рд┐рдП рдЙрдкрд╕рд░реНрдЧ рд╣реИ, рдФрд░ _ZTI рдЯрд╛рдЗрдкрд┐рдирдлреЛ рдХреЗ рд▓рд┐рдП рд╣реИред </blockquote><br><hr><br><p>  рдпрд╣рд╛рдБ <code>vtable Parent</code> рд╕рдВрд░рдЪрдирд╛ рд╣реИ: </p><br><div class="scrollable-table"><table><thead><tr><th>  рдкрддрд╛ </th><th>  рдореВрд▓реНрдп </th><th>  рд╕рд╛рдордЧреНрд░реА </th></tr></thead><tbody><tr><td>  0x400ba8 </td><td>  0x0 </td><td>  top_offset (рдЗрд╕ рдкрд░ рдмрд╛рдж рдореЗрдВ) </td></tr><tr><td>  0x400bb0 </td><td>  0x400b78 </td><td>  рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреЗ рд▓рд┐рдП рдЯрд╛рдЗрдкрд┐рдирдлреЛ рдХреЗ рд▓рд┐рдП рд╕реВрдЪрдХ (рдЙрдкрд░реЛрдХреНрдд рдореЗрдореЛрд░реА рдбрдВрдк рдХрд╛ рднреА рд╣рд┐рд╕реНрд╕рд╛) </td></tr><tr><td>  0x400bb8 </td><td>  0x400aa0 </td><td>  рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ :: рдлреВ () <em>(1)</em> ред  _vptr рдЕрднрд┐рднрд╛рд╡рдХ рдпрд╣рд╛рдВ рдмрддрд╛рддреЗ рд╣реИрдВред </td></tr><tr><td>  0x400bc0 </td><td>  0x400a90 </td><td>  рдЬрдирдХ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ :: FooNotOverridden () <em>(2)</em> </td></tr></tbody></table></div><br><p>  рдпрд╣рд╛рдБ <code>vtable Derived</code> рд╕рдВрд░рдЪрдирд╛ рд╣реИ: </p><br><div class="scrollable-table"><table><thead><tr><th>  рдкрддрд╛ </th><th>  рдореВрд▓реНрдп </th><th>  рд╕рд╛рдордЧреНрд░реА </th></tr></thead><tbody><tr><td>  0x400b40 </td><td>  0x0 </td><td>  top_offset (рдЗрд╕ рдкрд░ рдмрд╛рдж рдореЗрдВ) </td></tr><tr><td>  0x400b48 </td><td>  0x400b90 </td><td>  рд╡реНрдпреБрддреНрдкрдиреНрди рдХреЗ рд▓рд┐рдП рдЯрд╛рдЗрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реВрдЪрдХ (рдКрдкрд░ рдореЗрдореЛрд░реА рдбрдВрдк рдХрд╛ рднреА рд╣рд┐рд╕реНрд╕рд╛) </td></tr><tr><td>  0x400b50 </td><td>  0x400a80 </td><td>  рд╡реНрдпреБрддреНрдкрдиреНрди рдХреЗ рд▓рд┐рдП рд╕реВрдЪрдХ :: рдлреВ () <em>(3)</em> ред, _ Vptr рд╡реНрдпреБрддреНрдкрдиреНрди рдЕрдВрдХ рдпрд╣рд╛рдБред </td></tr><tr><td>  0x400b58 </td><td>  0x400a90 </td><td>  рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ :: FooNotOverridden () (рдорд╛рддрд╛-рдкрд┐рддрд╛ рдХреЗ рд╕рдорд╛рди) </td></tr></tbody></table></div><br><p>  1: </p><br><pre> <code class="plaintext hljs">(gdb) # ,        0x400aa0 (gdb) info symbol 0x400aa0 Parent::Foo() in section .text of a.out</code> </pre> <br><p>  2: </p><br><pre> <code class="plaintext hljs">(gdb) info symbol 0x400a90 Parent::FooNotOverridden() in section .text of a.out</code> </pre> <br><p>  3: </p><br><pre> <code class="plaintext hljs">(gdb) info symbol 0x400a80 Derived::Foo() in section .text of a.out</code> </pre> <br><p>  рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рд╡реНрдпреБрддреНрдкрдиреНрди рдореЗрдВ vtable рд╕реВрдЪрдХ рдиреЗ vtable рдореЗрдВ +16 рдмрд╛рдЗрдЯреНрд╕ рдХреА рднрд░рдкрд╛рдИ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╢рд╛рд░рд╛ рдХрд┐рдпрд╛?  рддреАрд╕рд░рд╛ рдкреЙрдЗрдВрдЯрд░ рдкрд╣рд▓реА рд╡рд┐рдзрд┐ рдХреЗ рдкреЙрдЗрдВрдЯрд░ рдХрд╛ рдкрддрд╛ рд╣реИред  рддреАрд╕рд░рд╛ рддрд░реАрдХрд╛ рдЪрд╛рд╣рд┐рдП?  рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ - 2 <em>рд╕рд╛рдЗрдЬрд╝реЛрдлрд╝ (рд╢реВрдиреНрдп</em> ) рдХреЛ рд╡рд╛рдЗрдмреЗрдЯрд░ рдкреЙрдЗрдВрдЯрд░ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред  рдПрдХ рдЯрд╛рдЗрдкрд┐рдиреЛ рд░рд┐рдХреЙрд░реНрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?  рдЗрд╕рдХреЗ рд╕рд╛рдордиреЗ рдкреЙрдЗрдВрдЯрд░ рдкрд░ рдЬрд╛рдПрдВред </p><br><p>  рдЪрд▓ рд░рд╣рд╛ рд╣реИ - рдЯрд╛рдЗрдкрд┐рдирдлреЛ рд░рд┐рдХреЙрд░реНрдб рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛? </p><br><p>  <code>Parent</code> : </p><br><div class="scrollable-table"><table><thead><tr><th>  рдкрддрд╛ </th><th>  рдореВрд▓реНрдп </th><th>  рд╕рд╛рдордЧреНрд░реА </th></tr></thead><tbody><tr><td>  0x400b78 </td><td>  0x602090 </td><td>  Type_info <em>(1)</em> рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╣реЗрд▓реНрдкрд░ рд╡рд░реНрдЧ </td></tr><tr><td>  0x400b80 </td><td>  0x400b69 </td><td>  рдкреНрд░рдХрд╛рд░ рдирд╛рдо рдХрд╛ рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ <em>(2)</em> </td></tr><tr><td>  0x400b88 </td><td>  0x0 </td><td>  0 рдХрд╛ рдорддрд▓рдм рдХреЛрдИ рдкреЗрд░реЗрдВрдЯ рдЯрд╛рдЗрдкрдЗрдирдлреЛ рдПрдВрдЯреНрд░реА рдирд╣реАрдВ рд╣реИ </td></tr></tbody></table></div><br><p>  рдФрд░ рдпрд╣рд╛рдБ <code>typeinfo Derived</code> рдЬрд╛рддрд╛ рд╣реИ </p><br><div class="scrollable-table"><table><thead><tr><th>  рдкрддрд╛ </th><th>  рдореВрд▓реНрдп </th><th>  рд╕рд╛рдордЧреНрд░реА </th></tr></thead><tbody><tr><td>  0x400b90 </td><td>  0x602210 </td><td>  Type_info <em>(3)</em> рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╣реЗрд▓реНрдкрд░ рд╡рд░реНрдЧ </td></tr><tr><td>  0x400b98 </td><td>  0x400b60 </td><td>  рд╕реНрдЯреНрд░рд┐рдВрдЧ рдкреНрд░рдХрд╛рд░ рдирд╛рдо рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ <em>(4)</em> </td></tr><tr><td>  0x400ba0 </td><td>  0x400b78 </td><td>  рдПрдХ рдЯрд╛рдЗрдкрд┐рдирдлреЛ рдЕрднрд┐рднрд╛рд╡рдХ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ </td></tr></tbody></table></div><br><p>  1: </p><br><pre> <code class="plaintext hljs">(gdb) info symbol 0x602090 vtable for __cxxabiv1::__class_type_info@@CXXABI_1.3 + 16 in section .bss of a.out</code> </pre> <br><p>  2: </p><br><pre> <code class="plaintext hljs">(gdb) x/s 0x400b69 0x400b69 &lt;typeinfo name for Parent&gt;: "6Parent"</code> </pre> <br><p>  3: </p><br><pre> <code class="plaintext hljs">(gdb) info symbol 0x602210 vtable for __cxxabiv1::__si_class_type_info@@CXXABI_1.3 + 16 in section .bss of a.out</code> </pre> <br><p>  4: </p><br><pre> <code class="plaintext hljs">(gdb) x/s 0x400b60 0x400b60 &lt;typeinfo name for Derived&gt;: "7Derived"</code> </pre> <br><p>  рдпрджрд┐ рдЖрдк __si_class_type_info рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк <a href="https://refspecs.linuxfoundation.org/LSB_4.0.0/LSB-CXX-generic/LSB-CXX-generic/baselib.html">рдпрд╣рд╛рдБ рдФрд░</a> рд╕рд╛рде рд╣реА рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдпрд╣ gdb рдХреЗ рд╕рд╛рде рдореЗрд░реЗ рдХреМрд╢рд▓ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рднрд╛рдЧ рдХреЛ рдкреВрд░рд╛ рднреА рдХрд░рддрд╛ рд╣реИред  рдореЗрд░рд╛ рд╕реБрдЭрд╛рд╡ рд╣реИ рдХрд┐ рдХреБрдЫ рд▓реЛрдЧреЛрдВ рдХреЛ рдпрд╣ рдмрд╣реБрдд рдХрдо рд▓рдЧрддрд╛ рд╣реИ, рдпрд╛ рд╢рд╛рдпрдж рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдореВрд▓реНрдп рдХрд╛ рдирд╣реАрдВред  рдпрджрд┐ рд╣рд╛рдВ, рддреЛ рдореИрдВ рднрд╛рдЧ 2 рдФрд░ 3 рдХреЛ рд▓рдВрдШрди рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреВрдВрдЧрд╛, рд╕реАрдзреЗ <a href="https://shaharmike.com/cpp/vtable-part4/">рднрд╛рдЧ 4 рдкрд░</a> рдЬрд╛ рд░рд╣рд╛ рд╣реВрдВ </p><br><h2 id="chast-2---mnozhestvennoe-nasledovanie">  рднрд╛рдЧ 2 - рдПрдХрд╛рдзрд┐рдХ рд╡рдВрд╢рд╛рдиреБрдХреНрд░рдо </h2><br><p>  рд╕рдВрдХрд▓рдХ рдХреЗ рд▓рд┐рдП рдПрдХрд▓ рд╡рдВрд╢рд╛рдиреБрдХреНрд░рдо рдкрджрд╛рдиреБрдХреНрд░рдо рдХреА рджреБрдирд┐рдпрд╛ рдЖрд╕рд╛рди рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдкрд╣рд▓реЗ рднрд╛рдЧ рдореЗрдВ рджреЗрдЦрд╛ рдерд╛, рдкреНрд░рддреНрдпреЗрдХ рдмрдЪреНрдЪреЗ рдХреА рдХрдХреНрд╖рд╛ рдкреНрд░рддреНрдпреЗрдХ рдирдИ рдЖрднрд╛рд╕реА рдкрджреНрдзрддрд┐ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдБ рдЬреЛрдбрд╝рдХрд░ рдореВрд▓ рд╡реНрдпрд╡рд╣рд╛рд░реНрдп рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рддреА рд╣реИред </p><br><p>  рдЖрдЗрдП рдХрдИ рд╡рд┐рд░рд╛рд╕рдд рдХреЛ рджреЗрдЦреЗрдВ, рдЬреЛ рд╕реНрдерд┐рддрд┐ рдХреЛ рдЬрдЯрд┐рд▓ рдмрдирд╛рддреА рд╣реИ, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЬрдм рд╡рд┐рд░рд╛рд╕рдд рдХреЛ рдХреЗрд╡рд▓ рдЗрдВрдЯрд░рдлреЗрд╕ рд╕реЗ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдЖрдЗрдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рд╕реНрдирд┐рдкреЗрдЯ рджреЗрдЦреЗрдВ: </p><br><pre> <code class="plaintext hljs">class Mother { public: virtual void MotherMethod() {} int mother_data; }; class Father { public: virtual void FatherMethod() {} int father_data; }; class Child : public Mother, public Father { public: virtual void ChildMethod() {} int child_data; };</code> </pre> <br><div class="scrollable-table"><table><thead><tr><th>  рдмрд╛рд▓ рд╕рдВрд░рдЪрдирд╛ </th></tr></thead><tbody><tr><td>  _vtr $ рдорд╛рдБ </td></tr><tr><td>  рдорд╛рдБ_рджрд╛рддрд╛ (+ рдЧрджреНрджреА) </td></tr><tr><td>  _vrr $ рдкрд┐рддрд╛ </td></tr><tr><td>  father_data </td></tr><tr><td>  child_data <em>(1)</em> </td></tr></tbody></table></div><br><p>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ 2 рд╡реНрдпрд╡рд╣рд╛рд░реНрдп рдмрд┐рдВрджреБ рд╣реИрдВред  рд╕рд╣рдЬ рд░реВрдк рд╕реЗ, рдореИрдВ 1 рдпрд╛ 3 рдкреЙрдЗрдВрдЯрд░реНрд╕ (рдорд╛рддрд╛, рдкрд┐рддрд╛ рдФрд░ рдмрдЪреНрдЪреЗ) рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░реВрдВрдЧрд╛ред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдПрдХ рдкреЙрдЗрдВрдЯрд░ (рдЗрд╕ рдкрд░ рдмрд╛рдж рдореЗрдВ рдЕрдзрд┐рдХ) рд╣реЛрдирд╛ рдЕрд╕рдВрднрд╡ рд╣реИ, рдФрд░ рдХрдВрдкрд╛рдЗрд▓рд░ рдкрд░реНрдпрд╛рдкреНрдд рд░реВрдк рд╕реЗ рд╕реНрдорд╛рд░реНрдЯ рд╣реИ рдЪрд╛рдЗрд▓реНрдб рд╡рд╛рдЗрдмреЗрдЯ рдЪрд╛рдЗрд▓реНрдб рдХреА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпреЛрдВ рдХреЛ рд╡рд╛рдЗрдмреНрд░реЗрдЯ рдорджрд░ рдХреА рдирд┐рд░рдВрддрд░рддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЗрд╕ рдкреНрд░рдХрд╛рд░ 1 рдкреЙрдЗрдВрдЯрд░ рдХреА рдмрдЪрдд рд╣реЛрддреА рд╣реИред </p><br><p>  рддреАрдиреЛрдВ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрдЪреНрдЪреЗ рдХреЗ рдкрд╛рд╕ рдПрдХ рд╡реНрдпрд╡рд╣рд╛рд░реНрдп рд╕реВрдЪрдХ рдХреНрдпреЛрдВ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ?  рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдПрдХ рдЪрд╛рдЗрд▓реНрдб рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдПрдХ рдРрд╕реЗ рдлрдВрдХреНрд╢рди рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдорджрд░ рдпрд╛ рдлрд╛рджрд░ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рджреЛрдиреЛрдВ рд╣реА рдЗрд╕ рдкреЙрдЗрдВрдЯрд░ рд╕реЗ рдпрд╣ рдЙрдореНрдореАрдж рдХрд░реЗрдВрдЧреЗ рдХрд┐ рд╕рд╣реА рдСрдЙрдЯрд╕реЗрдЯ рдореЗрдВ рд╕рд╣реА рдбреЗрдЯрд╛ рд╣реЛред  рдЗрди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЪрд╛рдЗрд▓реНрдб рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдЖрдкрдХреЛ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдпрд╣ рдирд╣реАрдВ рдорд╛рдирдирд╛ тАЛтАЛрдЪрд╛рд╣рд┐рдП рдХрд┐ рдЪрд╛рдЗрд▓реНрдб рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╡рд╣ рд╣реИ рдЬреЛ рдорджрд░ / рдлрд╛рджрд░ рдкреЙрдЗрдВрдЯрд░ рдХреЗ рдЕрдзреАрди рд╣реИ рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  <em>(1) рдпрд╣ рдЗрд╕ рд╡рд┐рд╖рдп рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди, рдлрд┐рд░ рднреА, рдпрд╣ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ child_data рдХреЛ рдкрд┐рддрд╛ рдХреЗ рднрд░рдиреЗ рдореЗрдВ рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИред</em>  <em>рдЗрд╕реЗ рдЯреЗрд▓ рдкреИрдбрд┐рдВрдЧ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рднрд╡рд┐рд╖реНрдп рдХреА рдкреЛрд╕реНрдЯ рдХрд╛ рд╡рд┐рд╖рдп рд╣реЛ рд╕рдХрддрд╛ рд╣реИред</em> </p><br><p>  рдпрд╣рд╛рдБ <code>vtable</code> рд╕рдВрд░рдЪрдирд╛ рд╣реИ: </p><br><div class="scrollable-table"><table><thead><tr><th>  рдкрддрд╛ </th><th>  рдореВрд▓реНрдп </th><th>  рд╕рд╛рдордЧреНрд░реА </th></tr></thead><tbody><tr><td>  0x4008b8 </td><td>  0 </td><td>  top_offset (рдЗрд╕ рдкрд░ рдмрд╛рдж рдореЗрдВ) </td></tr><tr><td>  0x4008c0 </td><td>  0x400930 </td><td>  рдЪрд╛рдЗрд▓реНрдб рдХреЗ рд▓рд┐рдП рдЯрд╛рдЗрдкрд┐рдирдлреЛ рдХрд╛ рд╕реВрдЪрдХ </td></tr><tr><td>  0x4008c8 </td><td>  0x400800 </td><td>  рдорд╛рддрд╛ :: рдорд╛рддреГрдореЗрдз ()ред  _vptr $ рдорджрд░ рдкреЙрдЗрдВрдЯреНрд╕ рдпрд╣рд╛рдБред </td></tr><tr><td>  0x4008d0 </td><td>  0x400810 </td><td>  рдмрдЪреНрдЪрд╛ :: рдЪрд╛рдЗрд▓реНрдбрдореИрдереЛрдб () </td></tr><tr><td>  0x4008d8 </td><td>  -16 </td><td>  top_offset (рдЗрд╕ рдкрд░ рдмрд╛рдж рдореЗрдВ) </td></tr><tr><td>  0x4008e0 </td><td>  0x400930 </td><td>  рдЪрд╛рдЗрд▓реНрдб рдХреЗ рд▓рд┐рдП рдЯрд╛рдЗрдкрд┐рдирдлреЛ рдХрд╛ рд╕реВрдЪрдХ </td></tr><tr><td>  0x4008e8 </td><td>  0x400820 </td><td>  рдкрд┐рддрд╛ :: FatherMethod ()ред  _vptr $ рдкрд┐рддрд╛ рдпрд╣рд╛рдБ рдмрддрд╛рддреЗ рд╣реИрдВред </td></tr></tbody></table></div><br><p>  рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдорджрд░ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдХрд╛рд╕реНрдЯрд┐рдВрдЧ рдХрд░рддреЗ рд╕рдордп рдмрд╛рд▓ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдПрдХ рд╣реА рдкреЙрдЗрдВрдЯрд░ рд╣реЛрдЧрд╛ред  рд▓реЗрдХрд┐рди рдЬрдм рдлрд╛рджрд░ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдХрд╛рд╕реНрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХрдВрдкрд╛рдЗрд▓рд░ рдЗрд╕ рдкреНрд╡реЙрдЗрдВрдЯ рдХреА рдСрдлрд╕реЗрдЯ рдХреА рдЧрдгрдирд╛ рдмрдЪреНрдЪреЗ рдХреЗ _vptr $ рдлрд╛рджрд░ рдкрд╛рд░реНрдЯ (рдЪрд╛рдЗрд▓реНрдб рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдореЗрдВ 3rd рдлреАрд▓реНрдб, рдКрдкрд░ рджреА рдЧрдИ рдЯреЗрдмрд▓ рджреЗрдЦреЗрдВ) рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИред </p><br><p>  рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рджрд┐рдП рдЧрдП рдЪрд╛рдЗрд▓реНрдб c рдХреЗ рд▓рд┐рдП ;: (void <em>) &amp; c! = (Void</em> ) static_cast &lt;Father *&gt; ((c)ред  рдХреБрдЫ рд▓реЛрдЧ рдЗрд╕рдХреА рдЙрдореНрдореАрдж рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рд╢рд╛рдпрдж рдПрдХ рджрд┐рди рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдЖрдкрдХреЛ рдХреБрдЫ рд╕рдордп рдбрд┐рдмрдЧрд┐рдВрдЧ рд╕реЗ рдмрдЪрд╛рдПрдЧрд╛ред </p><br><p>  рдореИрдВрдиреЗ рдЗрд╕реЗ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдмрд╛рд░ рдЙрдкрдпреЛрдЧреА рдкрд╛рдпрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рд░реБрдХрд┐рдП, рдпрд╣ рд╕рдм рдирд╣реАрдВ рд╣реИред </p><br><p>  рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдпрджрд┐ рдмрдЪреНрдЪрд╛ рдкрд┐рддрд╛ рд╡рд┐рдзрд┐рдпреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓реЗрддрд╛ рд╣реИ?  рдЗрд╕ рдХреЛрдб рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ: </p><br><pre> <code class="plaintext hljs">class Mother { public: virtual void MotherFoo() {} }; class Father { public: virtual void FatherFoo() {} }; class Child : public Mother, public Father { public: void FatherFoo() override {} };</code> </pre> <br><p>  рд╕реНрдерд┐рддрд┐ рдХрдард┐рди рд╣реЛрддреА рдЬрд╛ рд░рд╣реА рд╣реИред  рд╕рдорд╛рд░реЛрд╣ рддрд░реНрдХ рдкрд┐рддрд╛ * рдХреЛ рд▓реЗ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рдлрд╛рджрд░рдлреВ () рдХреЛ рдмреБрд▓рд╛ рд╕рдХрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдЖрдк рдЪрд╛рдЗрд▓реНрдб рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рд╕рд╣реА рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде рдУрд╡рд░рд░рд╛рдЗрдб рдЪрд╛рдЗрд▓реНрдб рдореЗрдердб рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рдЕрдкреЗрдХреНрд╖рд┐рдд рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдлреЛрди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛ рдкрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЙрд╕рдХреЗ рдкрд╛рд╕ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЪрд╛рдЗрд▓реНрдб рд╣реИред  рдЗрд╕рдореЗрдВ рдЪрд╛рдЗрд▓реНрдб рдСрдлрд╕реЗрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЙрдЗрдВрдЯрд░ рд╣реИ, рдЬрд╣рд╛рдВ рдкрд┐рддрд╛ рдХрд╛ рд╕реНрдерд╛рди рд╣реИред  рдХрд┐рд╕реА рдХреЛ рдЗрд╕ рд╕реВрдЪрдХ рдХреЛ рдСрдлрд╕реЗрдЯ рдХрд░рдирд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИ?  рд╕рдВрдХрд▓рдХ рдЗрд╕ рдХрд╛рдо рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпрд╛ рдЬрд╛рджреВ рдХрд░рддрд╛ рд╣реИ? </p><br><p>  <em>рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо рдЗрд╕рдХрд╛ рдЙрддреНрддрд░ рджреЗрдВ, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдорд╛рддрд╛ рдХреЗ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рдирд╛ рдмрд╣реБрдд рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕реВрдЪрдХ рд╕рдорд╛рди рд╣реИред</em>  <em>рдмрдЪреНрдЪреЗ рдХреЛ рдкрддрд╛ рд╣реИ рдХрд┐ рд╡реНрдпрд╡рд╣рд╛рд░реНрдп рдорд╛рдБ рдХреЗ рдмрд╛рдж рдХреНрдпрд╛ рдкрдврд╝рдирд╛ рд╣реИ, рдФрд░ рдЙрдореНрдореАрдж рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдмрд╛рд▓ рд╡рд┐рдзрд┐рдпрд╛рдБ рдЙрд╕рдХреЗ рдмрд╛рдж рд╕рд╣реА рд╣реЛрдВрдЧреАред</em> </p><br><p>  рдпрд╣рд╛рдВ рд╕рдорд╛рдзрд╛рди рд╣реИ: рдХрдВрдкрд╛рдЗрд▓рд░ рдПрдХ рдердВрдХ рд╡рд┐рдзрд┐ рдмрдирд╛рддрд╛ рд╣реИ рдЬреЛ рдЗрд╕ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рд╕рд╣реА рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ "рд╡рд╛рд╕реНрддрд╡рд┐рдХ" рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред  рдПрдбреЗрдкреНрдЯрд░ рд╡рд┐рдзрд┐ рдХрд╛ рдкрддрд╛ рд╡реНрдпрд╡рд╣рд╛рд░реНрдп рдкрд┐рддрд╛ рдХреЗ рдЕрдзреАрди рд╣реЛрдЧрд╛, рдЬрдмрдХрд┐ "рд╡рд╛рд╕реНрддрд╡рд┐рдХ" рд╡рд┐рдзрд┐ рд╡реНрдпрд╡рд╣рд╛рд░реНрдп рдЪрд╛рдЗрд▓реНрдб рдХреЗ рддрд╣рдд рд╣реЛрдЧреАред </p><br><p>  рдпрд╣рд╛рдБ <code>vtable Child</code> : </p><br><pre> <code class="plaintext hljs">0x4008e8 &lt;vtable for Child&gt;: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x4008f0 &lt;vtable for Child+8&gt;: 0x60 0x09 0x40 0x00 0x00 0x00 0x00 0x00 0x4008f8 &lt;vtable for Child+16&gt;: 0x00 0x08 0x40 0x00 0x00 0x00 0x00 0x00 0x400900 &lt;vtable for Child+24&gt;: 0x10 0x08 0x40 0x00 0x00 0x00 0x00 0x00 0x400908 &lt;vtable for Child+32&gt;: 0xf8 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0x400910 &lt;vtable for Child+40&gt;: 0x60 0x09 0x40 0x00 0x00 0x00 0x00 0x00 0x400918 &lt;vtable for Child+48&gt;: 0x20 0x08 0x40 0x00 0x00 0x00 0x00 0x00</code> </pre> <br><p>  рдЗрд╕рдХрд╛ рдХреНрдпрд╛ рдорддрд▓рдм рд╣реИ: </p><br><div class="scrollable-table"><table><thead><tr><th>  рдкрддрд╛ </th><th>  рдореВрд▓реНрдп </th><th>  рд╕рд╛рдордЧреНрд░реА </th></tr></thead><tbody><tr><td>  0x4008e8 </td><td>  0 </td><td>  top_offset (рдЬрд▓реНрдж рд╣реА рдЖ рд░рд╣рд╛ рд╣реИ!) </td></tr><tr><td>  0x4008f0 </td><td>  0x400960 </td><td>  рдмрдЪреНрдЪреЗ рдХреЗ рд▓рд┐рдП рдЯрд╛рдЗрдкрд┐рдирдлреЛ </td></tr><tr><td>  0x4008f8 </td><td>  0x400800 </td><td>  рдорд╛рдБ :: рдорджрд░рдлреВ () </td></tr><tr><td>  0x400900 </td><td>  0x400810 </td><td>  рдмрдЪреНрдЪрд╛ :: рдлрд╛рджрд░рдлреВ () </td></tr><tr><td>  0x400908 </td><td>  -8 </td><td>  top_offset </td></tr><tr><td>  0x400910 </td><td>  0x400960 </td><td>  рдмрдЪреНрдЪреЗ рдХреЗ рд▓рд┐рдП рдЯрд╛рдЗрдкрд┐рдирдлреЛ </td></tr><tr><td>  0x400918 </td><td>  0x400820 </td><td>  рд╡рд░реНрдЪреБрдЕрд▓ рдПрдбреЗрдкреНрдЯрд░ рдЪрд╛рдЗрд▓реНрдб :: рдлрд╛рджрд░рдлреВ () </td></tr></tbody></table></div><br><p>  рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг: рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдкрд╣рд▓реЗ рджреЗрдЦрд╛, рдмрд╛рд▓ рдореЗрдВ 2 vtables рд╣реИрдВ - рдПрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдорд╛рддрд╛ рдФрд░ рдмрдЪреНрдЪреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рджреВрд╕рд░рд╛ рдкрд┐рддрд╛ рдХреЗ рд▓рд┐рдПред  рд╡реНрдпрд╡рд╣рд╛рд░реНрдп рдкрд┐рддрд╛ рдореЗрдВ, рдлрд╛рджрд░рдлреВ () рдПрдХ "рдПрдбреЗрдкреНрдЯрд░" рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рд╡рд╛рдЗрдмрд▓ рдЪрд╛рдЗрд▓реНрдб рдореЗрдВ рд╕реАрдзреЗ рдЪрд╛рдЗрд▓реНрдб :: рдлрд╛рджрд░рдлреВ () рдкрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдФрд░ рдЗрд╕ "рдПрдбреЗрдкреНрдЯрд░" рдореЗрдВ рдХреНрдпрд╛ рд╣реИ, рдЖрдк рдкреВрдЫреЗрдВ? </p><br><pre> <code class="plaintext hljs">(gdb) disas /m 0x400820, 0x400850 Dump of assembler code from 0x400820 to 0x400850: 15 void FatherFoo() override {} 0x0000000000400820 &lt;non-virtual thunk to Child::FatherFoo()+0&gt;: push %rbp 0x0000000000400821 &lt;non-virtual thunk to Child::FatherFoo()+1&gt;: mov %rsp,%rbp 0x0000000000400824 &lt;non-virtual thunk to Child::FatherFoo()+4&gt;: sub $0x10,%rsp 0x0000000000400828 &lt;non-virtual thunk to Child::FatherFoo()+8&gt;: mov %rdi,-0x8(%rbp) 0x000000000040082c &lt;non-virtual thunk to Child::FatherFoo()+12&gt;: mov -0x8(%rbp),%rdi 0x0000000000400830 &lt;non-virtual thunk to Child::FatherFoo()+16&gt;: add $0xfffffffffffffff8,%rdi 0x0000000000400837 &lt;non-virtual thunk to Child::FatherFoo()+23&gt;: callq 0x400810 &lt;Child::FatherFoo()&gt; 0x000000000040083c &lt;non-virtual thunk to Child::FatherFoo()+28&gt;: add $0x10,%rsp 0x0000000000400840 &lt;non-virtual thunk to Child::FatherFoo()+32&gt;: pop %rbp 0x0000000000400841 &lt;non-virtual thunk to Child::FatherFoo()+33&gt;: retq 0x0000000000400842: nopw %cs:0x0(%rax,%rax,1) 0x000000000040084c: nopl 0x0(%rax)</code> </pre> <br><p>  рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╣реА рдЪрд░реНрдЪрд╛ рдХреА рд╣реИ, рдпрд╣ рдСрдлрд╕реЗрдЯ рд╣реИ рдФрд░ рдлрд╛рджрд░рдлреВ () рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдФрд░ рд╣рдореЗрдВ рдЪрд╛рдЗрд▓реНрдб рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдХрд┐рддрдирд╛ рд╢рд┐рдлреНрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП?  top_offset! </p><br><p>  <em>рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдореБрдЭреЗ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдЧреИрд░-рдЖрднрд╛рд╕реА рдердВрдХ рдирд╛рдо рдмреЗрд╣рдж рднреНрд░рдорд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╡рд░реНрдЪреБрдЕрд▓ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рд╡рд░реНрдЪреБрдЕрд▓ рдЯреЗрдмрд▓ рдПрдВрдЯреНрд░реА рд╣реИред</em>  <em>рдореБрдЭреЗ рдпрдХреАрди рдирд╣реАрдВ рд╣реИ рдХрд┐ рдпрд╣ рдЖрднрд╛рд╕реА рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдХреЗрд╡рд▓ рдореЗрд░реА рд░рд╛рдп рд╣реИред</em> </p><br><hr><br><p>  <em>рдЕрднреА рдХреЗ рд▓рд┐рдП рдпрд╣реА рд╣реИ, рдирд┐рдХрдЯ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рд╣рдо 3 рдФрд░ 4 рднрд╛рдЧреЛрдВ рдХрд╛ рдЕрдиреБрд╡рд╛рдж рдХрд░реЗрдВрдЧреЗред</em>  <em>рдЦрдмрд░ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ!</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi479802/">https://habr.com/ru/post/hi479802/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi479780/index.html">DevOps рдорд╛рд╕реНрдХреЛ рдореАрдЯрдЕрдк 17/12: рдкреНрд░рд╕рд╛рд░рдг рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ</a></li>
<li><a href="../hi479790/index.html">рддреАрди рдЗрдирдХреНрдпреВрдмреЗрдЯрд░ рдиреЗ рдЫрд╛рддреНрд░реЛрдВ рдХреЗ рдкрд╣рд▓реЗ рд╕рдореВрд╣ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдкрд╛рдареНрдпрдХреНрд░рдо рд╕рдВрдЪрд╛рд▓рд┐рдд рдХрд┐рдП</a></li>
<li><a href="../hi479794/index.html">рд╣рдо "рдмрдЪреНрдЪреЛрдВ рдХреЗ" рдорд╛рдЗрдХреНрд░реЛрдХрдВрдЯреНрд░реЛрд▓рд░ рдФрд░ рдмреЛрд░реНрдб рдЧреЗрдо рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi479796/index.html">рдХрд┐рдВрдЧреНрд╕реНрдЯрди рдХреЗ рдерд╛рдиреЛрд╕ рд▓реЗрд╡рд▓ рдереНрд░реЗрдЯ</a></li>
<li><a href="../hi479800/index.html">рдореИрдВ C # рдореЗрдВ рд▓рд┐рдЦ рд░рд╣рд╛ рд╣реВрдВ рддрд╛рдХрд┐ рд╕рд╛рдордиреЗ рд╡рд╛рд▓рд╛ рдЖрд╕рд╛рди рд╣реЛ</a></li>
<li><a href="../hi479810/index.html">рдореИрдВрдиреЗ рдкреНрд░рдХреГрддрд┐ рдореЗрдВ рдПрдХ рд╡рд┐рдЬреНрдЮрд╛рди рд▓реЗрдЦ рдХреИрд╕реЗ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд┐рдпрд╛</a></li>
<li><a href="../hi479814/index.html">рд╕рдХреНрд░рд┐рдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдбреЗрдЯрд╛ рдЧреЛрдкрдиреАрдпрддрд╛ рд╕рдорд╕реНрдпрд╛</a></li>
<li><a href="../hi479816/index.html">рдкрд╛рдЗрдерди рдореЗрдВ рд╕рдВрдпреЛрдЬрдХ</a></li>
<li><a href="../hi479818/index.html">рдЕрдВрдЧреНрд░реЗрдЬреА рджрдХреНрд╖рддрд╛ рдХрд╛ рдЖрдХрд▓рди рдХреИрд╕реЗ рдХрд░реЗрдВ</a></li>
<li><a href="../hi479820/index.html">рдЖрдИрдЯреА-рдЯреНрд░реА рдХреЗ рдиреАрдЪреЗ рдХреНрдпрд╛ рд░рдЦрд╛ рдЬрд╛рдП? рдмрд╛рдЗрдирд░реА рдШрдбрд╝реА</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>