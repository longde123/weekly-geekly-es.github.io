<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôãüèΩ üç¶ ‚ùî Servi√ßo de Restaura√ß√£o Ativa ou o hist√≥rico de um projeto industrial em Innopolis üíì üé¥ üï∂Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! Meu nome √© Roman e quero falar hoje sobre como n√≥s, na Universidade de Innopolis, desenvolvemos uma bancada de testes e servi√ßos para o sist...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servi√ßo de Restaura√ß√£o Ativa ou o hist√≥rico de um projeto industrial em Innopolis</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/acronis/blog/479524/">  Ol√° Habr!  Meu nome √© Roman e quero falar hoje sobre como n√≥s, na Universidade de Innopolis, desenvolvemos uma bancada de testes e servi√ßos para o sistema Acronis Active Restore, que em breve dever√° se tornar parte da linha de produtos da empresa.  Todo mundo que estiver interessado em como a universidade est√° construindo relacionamentos com parceiros industriais, convido voc√™ a prosseguir sob o comando cat. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b9e/2e6/1c8/b9e2e61c86c5b53a43ed3ee998d7db0f.jpg" alt="imagem"><br><a name="habracut"></a><br>  O desenvolvimento do Active Restore come√ßou dentro da Acronis, mas n√≥s, como estudantes da Universidade de Innopolis, participamos desse processo como parte de um projeto de treinamento industrial.  Meu curador (e agora colega) Daulet Tumbaev j√° escreveu sobre a id√©ia, bem como a arquitetura, <a href="https://habr.com/ru/company/acronis/blog/477658/">em seu post</a> .  Hoje vou falar sobre como preparamos o servi√ßo em Innopolis. <br><br>  Tudo come√ßou no ver√£o, quando fomos informados de que, no primeiro semestre, as empresas de TI viriam at√© n√≥s e ofereceriam suas id√©ias para trabalhos pr√°ticos.  Ent√£o, em dezembro de 2018, fomos presenteados com 15 projetos diferentes e, no final do m√™s, estabelecemos prioridades, descobrindo quem mais gosta. <br><br>  Todos os estudantes de gradua√ß√£o preencheram um formul√°rio onde era necess√°rio escolher quatro projetos nos quais quer√≠amos participar.  Era necess√°rio motivar por que eu e por que exatamente esses projetos.  Por exemplo, apontei que j√° tenho experi√™ncia em programa√ß√£o e desenvolvimento de sistemas em C / C ++.  Mas o mais importante, o projeto me permitiu desenvolver minhas habilidades e continuar a crescer. <br><br>  Duas semanas depois, fomos designados e, a partir do in√≠cio do segundo semestre, o trabalho em projetos come√ßou.  A equipe foi formada. Na primeira reuni√£o, avaliamos os pontos fortes e fracos de cada um e os pap√©is atribu√≠dos. <br><br><ul><li>  Roman Rybkin √© desenvolvedor de Python / C ++. </li><li>  Eugene Ishutin - desenvolvedor de Python / C ++, respons√°vel por interagir com a empresa. </li><li>  Anastasia Rodionova √© um desenvolvedor Python / C ++ respons√°vel por escrever a documenta√ß√£o. </li><li>  Brandon Acosta - montando o ambiente, preparando o estande para experimentos e testes. </li></ul><br>  Nas duas primeiras semanas tivemos que iniciar o processo.  Estabelecemos contatos com o cliente, formalizamos os requisitos do projeto, lan√ßamos um processo iterativo e configuramos o ambiente para o trabalho. <br><br>  A prop√≥sito, nosso trabalho com o cliente realmente come√ßou a ferver quando come√ßamos as eletivas.  O fato √© que Acronis lidera na Universidade de Innopolis (e n√£o apenas) os assuntos de sua escolha.  E Alexey Kostyushko, desenvolvedor l√≠der da equipe do Kernel, ministra dois cursos continuamente: Engenharia Reversa e Arquitetura e Drivers do Kernel do Windows.  At√© onde eu sei, tamb√©m est√° planejado um curso de programa√ß√£o de sistemas e computa√ß√£o multithread.  Mas o principal √© que todos esses cursos s√£o projetados de forma a ajudar os alunos a lidar com projetos industriais.  Eles realmente ajudam a entender a √°rea de assunto e, assim, simplificam o trabalho no projeto. <br><br>  Devido a isso, come√ßamos com mais vigor do que outras equipes, e a intera√ß√£o com a pr√≥pria Acronis se tornou mais densa.  Alexey Kostyushko atuou por n√≥s no papel de Product Owner, dele recebemos o conhecimento necess√°rio na √°rea de assunto.  Gra√ßas √†s suas disciplinas eletivas, nossas habilidades e compet√™ncias duraram muito, ficamos realmente prontos para cumprir a tarefa que nos confrontava. <br><br><h2>  Do pensamento ao projeto </h2><br>  O primeiro m√™s para todas as equipes foi o mais dif√≠cil poss√≠vel.  Todo mundo estava perdido, n√£o sabia por onde come√ßar - talvez com documentos ou, inversamente, mergulhando no c√≥digo.  A princ√≠pio, coment√°rios conflitantes vieram de curadores e mentores da universidade e de representantes da empresa. <br><br>  Quando tudo se encaixou (pelo menos na minha cabe√ßa), ficou claro que os mentores da universidade nos ajudaram a construir rela√ß√µes internas na equipe e a preparar documentos.  Mas o verdadeiro ponto de avan√ßo foi a chegada de Daulet em mar√ßo.  N√≥s apenas nos sentamos e trabalhamos no projeto durante todo o fim de semana.  Em seguida, repensamos a ess√™ncia do projeto, reinicializamos, redistribu√≠mos as prioridades das tarefas e rapidamente avan√ßamos.  Entendemos o que precisa ser feito para iniciar o experimento (um pouco mais tarde) e desenvolver o servi√ßo.  A partir desse momento, a ideia geral se transformou em um plano claro.  O verdadeiro desenvolvimento do c√≥digo come√ßou e, em duas semanas, desenvolvemos a primeira vers√£o da bancada de testes, incluindo m√°quinas virtuais, os servi√ßos e o c√≥digo necess√°rios para automatizar o experimento e coletar dados. <br><br>  Vale ressaltar que, paralelamente ao projeto industrial, foram realizados treinamentos que nos ajudaram a construir uma arquitetura competente para nossos projetos e a organizar a Gest√£o da Qualidade.  No in√≠cio, essas tarefas levavam 70 a 90% do tempo por semana, mas, como se viu, era necess√°rio tempo para evitar problemas no processo de desenvolvimento.  O objetivo da universidade era aprender a construir com compet√™ncia o processo de desenvolvimento, e as empresas, como clientes, estavam mais interessadas no resultado.  Isso, √© claro, trouxe muita confus√£o, mas ajudou a combinar habilidades te√≥ricas e pr√°ticas.  Complexidade e carga suficientes garantiram a presen√ßa de motiva√ß√£o, o que resultou em um projeto bem-sucedido. <br><br>  Inicialmente, duas pessoas em nossa equipe estavam envolvidas em puro desenvolvimento, uma pessoa assumiu os documentos e outra mergulhou na cria√ß√£o do ambiente.  No entanto, mais tarde, mais tr√™s solteiros se juntaram a n√≥s, com quem nos tornamos uma √∫nica equipe.  A universidade decidiu lan√ßar um projeto industrial de teste para estudantes do terceiro ano de estudo.  A expans√£o da equipe de 4 para 7 pessoas acelerou muito o processo, porque nossos solteiros podiam facilmente executar tarefas relacionadas ao desenvolvimento.  Ekaterina Levchenko ajudou a escrever c√≥digo python e scripts em lote para o banco de testes.  Ansat Abirov e Ruslan Kim atuaram como desenvolvedores, eles estavam envolvidos na sele√ß√£o e otimiza√ß√£o de algoritmos. <br><br>  Trabalhamos nesse formato at√© o final de maio, quando o experimento foi lan√ßado.  Nesse momento, o projeto industrial para solteiros terminou.  Dois deles come√ßaram um est√°gio Acronis e continuaram a trabalhar conosco.  Portanto, depois de maio, j√° trabalhamos como uma equipe de 6 pessoas. <br><br>  Antes de n√≥s era o terceiro semestre, que em Inn√≥polis √© livre de atividades acad√™micas.  T√≠nhamos apenas duas disciplinas eletivas e o restante do tempo foi gasto em um projeto industrial.  Foi no terceiro semestre que o trabalho no servi√ßo foi intensivo.  O processo de desenvolvimento caiu completamente nos trilhos, demonstra√ß√µes e relat√≥rios se tornaram regulares.  Nesse formato, trabalhamos por 1,5 meses e, no final de julho, quase terminamos a parte de desenvolvimento do trabalho. <br><br><h2>  Detalhes t√©cnicos </h2><br>  Primeiro, foram formulados os requisitos para um servi√ßo, que deveriam interagir adequadamente com o driver do minifiltro do sistema de arquivos (que √© o que voc√™ pode ler <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ifs/file-system-minifilter-drivers">aqui</a> ) e sua arquitetura foi pensada.  De olho na simplicidade de mais suporte a c√≥digo, fornecemos imediatamente uma abordagem modular.  Nosso servi√ßo inclui v√°rios gerentes, agentes e manipuladores e, mesmo antes do in√≠cio da codifica√ß√£o, a capacidade de trabalhar em modo paralelo foi estabelecida. <br><br>  No entanto, depois de discutir a arquitetura em uma reuni√£o com os funcion√°rios da Acronis, decidiu-se realizar um experimento primeiro e depois assumir o servi√ßo em si.  Como resultado, o desenvolvimento levou apenas 2,5 meses.  No restante do tempo, realizamos um experimento para encontrar a lista m√≠nima suficiente de arquivos nos quais o Windows poderia ser executado.  Em um sistema real, esse conjunto de arquivos √© gerado usando o driver, no entanto, decidimos encontr√°-lo heuristicamente, usando o m√©todo de meia divis√£o, para verificar a opera√ß√£o do driver. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a5/fd5/6b1/6a5fd56b1bb52d7b30e356735defba4a.png" alt="imagem"><br>  <i>A posi√ß√£o do experimento.</i> <i><br></i> <br><br>  Para fazer isso, montamos um suporte em Python a partir de duas m√°quinas virtuais.  Um deles trabalhava no Linux e o segundo carregava o Windows.  Dois discos foram configurados para eles: HD1 Virtual e HD2 Virtual.  Ambas as unidades foram conectadas √† VM1 na qual o Linux foi instalado.  Nesta m√°quina virtual no HD1, foi instalado o aplicativo Killer, que "danificou" o HD2.  Dano refere-se √† exclus√£o de alguns arquivos do disco.  HD2 era um disco de inicializa√ß√£o para VM2 que funcionava no Windows.  Ap√≥s o "dano" ao disco, tentamos iniciar o VM2.  Se fosse poss√≠vel, os arquivos exclu√≠dos do disco eram considerados desnecess√°rios para execu√ß√£o. <br><br>  Para automatizar esse processo, tentamos excluir arquivos n√£o aleatoriamente, mas como parte de uma abordagem pr√©-pensada.  O algoritmo consistiu em 3 etapas: <br><br><ol><li>  Divida a lista de arquivos ao meio. </li><li>  Exclua um dos metade dos arquivos. </li><li>  Tente iniciar o sistema.  Se o sistema foi iniciado, adicione os arquivos exclu√≠dos √† lista de desnecess√°rios.  Caso contr√°rio, retornaremos √† etapa 1. </li></ol><br>  Primeiro, decidimos simular o algoritmo.  Suponha que haja 1.000.000 de arquivos no sistema de arquivos.  Nesse caso, a pesquisa mais eficaz de arquivos cr√≠ticos ocorreu nos casos em que os arquivos cr√≠ticos representavam cerca de 15% do total. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f1/2eb/726/8f12eb72679d42f14095fbd92b81674d.png" alt="imagem"><br>  <i>M√©todo de meia divis√£o.</i> <br><br>  No come√ßo, havia muitos problemas com o experimento.  Durante 2-3 semanas, uma bancada de testes estava pronta.  E outros 1-1,5 meses eu tive que pegar bugs, adicionar o c√≥digo e aplicar v√°rios truques para fazer o suporte funcionar. <br><br>  O mais dif√≠cil foi encontrar um bug associado √†s opera√ß√µes de armazenamento em disco em cache.  O experimento funcionou por 2 dias e produziu resultados muito otimistas v√°rias vezes mais r√°pidos que as simula√ß√µes.  No entanto, o teste do arquivo cr√≠tico falhou, o sistema n√£o foi iniciado.  Aconteceu que durante o desligamento for√ßado da m√°quina virtual, as opera√ß√µes de exclus√£o que foram armazenadas em cache pelo sistema de arquivos n√£o foram executadas e, portanto, o disco n√£o foi completamente apagado.  Como resultado, o algoritmo recebeu resultados incorretos e, por alguns dias, esfor√ßamos todas as nossas convolu√ß√µes para descobrir tudo. <br><br>  Em um determinado momento, percebemos que durante a opera√ß√£o cont√≠nua o algoritmo foi enterrado em um dos segmentos do sistema de arquivos e come√ßou a tentar excluir os mesmos arquivos (na esperan√ßa de um novo resultado).  Isso acontecia √†s vezes quando o algoritmo ficava nas regi√µes onde a maioria era necess√°ria, enquanto se escolhia o intervalo errado para exclus√£o.  Nesse ponto, decidimos adicionar uma lista de arquivos de reorganiza√ß√£o.  Ou seja, depois de algumas itera√ß√µes, a lista de arquivos foi embaralhada.  Isso ajudou a tirar o algoritmo dessas varas. <br><br>  Quando tudo estava pronto, lan√ßamos essas duas VMs por tr√™s dias.  No total, foram aprovadas cerca de 600 itera√ß√µes, entre as quais houve mais de 20 lan√ßamentos bem-sucedidos.  Ficou claro que esse experimento pode ser executado por um longo per√≠odo de tempo, bem como em m√°quinas mais poderosas, para encontrar o tamanho ideal de arquivo para a execu√ß√£o do Windows.  Al√©m disso, o algoritmo pode ser distribu√≠do por v√°rias m√°quinas para acelerar ainda mais esse processo <br><br>  No nosso caso, al√©m do Windows, havia apenas Python e nosso servi√ßo no disco.  Em tr√™s dias, conseguimos reduzir o n√∫mero de arquivos de 70 mil para 50 mil.  A lista de arquivos foi reduzida em apenas 28%, mas ficou claro que essa abordagem est√° funcionando e permite determinar o conjunto m√≠nimo de arquivos necess√°rios para carregar o sistema operacional. <br><br><h2>  Estrutura de servi√ßo </h2><br>  Vamos tocar em uma pequena estrutura de servi√ßo.  O m√≥dulo de servi√ßo principal √© um gerenciador de filas.  Como obtemos uma lista de arquivos do driver, precisamos restaurar os arquivos dessa lista.  Para isso, criamos um turno com prioridades. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/848/c8b/f16/848c8bf16ea00fa05474ead1a278b045.jpg" alt="imagem"><br><br>  Temos uma lista de arquivos que s√£o restaurados por sua vez.  E se novas solicita√ß√µes de acesso aparecerem, os arquivos necess√°rios com urg√™ncia ser√£o restaurados com prioridade.  Devido a isso, no in√≠cio da fila, haver√° os arquivos que o usu√°rio realmente precisa agora e no final da linha - os arquivos que poder√£o ser necess√°rios no futuro.  Mas com o trabalho ativo do usu√°rio, uma ‚Äúfila de objetos extraordin√°rios‚Äù pode ser formada, bem como uma lista de arquivos que est√£o sendo restaurados no momento.  Al√©m disso, a opera√ß√£o de pesquisa deveria ter sido aplicada a todas essas filas ao mesmo tempo.  Infelizmente, n√£o encontramos uma implementa√ß√£o dessa fila que pudesse definir v√°rias prioridades de arquivo, enquanto apoiava a pesquisa e tamb√©m alterava as prioridades em tempo real.  N√£o quer√≠amos nos adaptar √†s estruturas de dados existentes e, portanto, tivemos que escrever nossas pr√≥prias e configurar a capacidade de trabalhar com elas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/30b/f65/b91/30bf65b91099cca8fd21f077d7c670f3.jpg" alt="imagem"><br><br>  Nosso servi√ßo precisar√° se comunicar primeiro com o driver em que Daulet trabalhou e, em seguida, com os componentes respons√°veis ‚Äã‚Äãpela restaura√ß√£o de arquivos ... Portanto, para iniciantes, decidimos criar nosso pr√≥prio pequeno emulador do sistema de recupera√ß√£o, que poderia emitir arquivos de uma unidade externa para que eles pudessem ser restaurar e testar o servi√ßo. <br><br>  No total, foram fornecidos dois modos de opera√ß√£o - normal e recupera√ß√£o.  No modo normal, o driver nos envia uma lista de arquivos afetados pela inicializa√ß√£o do SO.  Em seguida, enquanto o sistema est√° em execu√ß√£o, o driver monitora todas as opera√ß√µes de arquivo e envia notifica√ß√µes para o nosso servi√ßo e, por sua vez, altera a lista de arquivos.  No modo de recupera√ß√£o, o driver notifica o servi√ßo que a recupera√ß√£o do sistema √© necess√°ria.  O servi√ßo enfileira arquivos, executa agentes de software que solicitam arquivos de backup e inicia o processo de recupera√ß√£o. <br><br><h2>  Diploma, convite para trabalho e novos projetos </h2><br>  Quando o servi√ßo estava pronto e testado, tivemos a √∫ltima atividade no projeto.  Foi necess√°rio atualizar e estruturar todos os artefatos que acumulamos, al√©m de apresentar nossos resultados ao cliente e √† universidade.  Para a empresa, este foi mais um passo em dire√ß√£o √† implementa√ß√£o do projeto, para a universidade com nossa tese de gradua√ß√£o. <br><br>  Ap√≥s a apresenta√ß√£o, uma proposta foi feita aos alunos.  Depois de algumas semanas, vou trabalhar na Acronis.  Os resultados do projeto levaram os desenvolvedores a pensar que √© poss√≠vel tornar o servi√ßo mais eficiente, diminuindo-o para o n√≠vel do Aplicativo Windows Nativo.  Mas mais sobre isso no pr√≥ximo artigo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt479524/">https://habr.com/ru/post/pt479524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt479512/index.html">MVCC no PostgreSQL-4. Instant√¢neos</a></li>
<li><a href="../pt479514/index.html">Privacidade por design e privacidade por padr√£o (prote√ß√£o de dados projetada e privacidade padr√£o pelo GDPR)</a></li>
<li><a href="../pt479516/index.html">O que √© entropia no software e como gerenci√°-lo?</a></li>
<li><a href="../pt479518/index.html">A comunica√ß√£o dentro de uma equipe remota √© a nossa experi√™ncia</a></li>
<li><a href="../pt479522/index.html">Editora Peter. Venda de inverno</a></li>
<li><a href="../pt479530/index.html">Sistema de coordenadas ultrass√¥nicas 2.0</a></li>
<li><a href="../pt479534/index.html">Kubernetes 1.17 - como atualizar e n√£o gastar todo o or√ßamento de erros</a></li>
<li><a href="../pt479536/index.html">Balanceamento de carga no Zimbra Open-Source Edition com HAProxy</a></li>
<li><a href="../pt479538/index.html">A tecnologia est√° levando a humanidade ao decl√≠nio. √â hora de mudar alguma coisa</a></li>
<li><a href="../pt479540/index.html">Usando passwordstore.org - gerenciador de senhas no estilo KISS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>