<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎶 🌶️ 🍀 Ce que je manque à Java après avoir travaillé avec Kotlin / Scala 📚 👩🏿‍⚕️ ♾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Récemment, j'entends souvent que Java est devenu un langage obsolète dans lequel il est difficile de créer de grandes applications prises en charge. E...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ce que je manque à Java après avoir travaillé avec Kotlin / Scala</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/raiffeisenbank/blog/456774/">  Récemment, j'entends souvent que Java est devenu un langage obsolète dans lequel il est difficile de créer de grandes applications prises en charge.  En général, je ne partage pas ce point de vue.  À mon avis, la langue est toujours appropriée pour écrire des applications rapides et bien organisées.  Cependant, j'avoue, il arrive aussi que lorsque vous écrivez du code tous les jours, vous pensez parfois: "comment cela serait résolu avec cette chose d'un autre langage".  Dans cet article, je voulais partager ma douleur et mon expérience.  Nous examinerons certains problèmes Java et comment ils pourraient être résolus dans Kotlin / Scala.  Si vous avez un sentiment similaire ou si vous vous demandez simplement ce que d'autres langues peuvent offrir, je vous le demande sous cat. <br><br><img src="https://habrastorage.org/webt/gs/ur/yw/gsurywchgpevsavhgdjdaw1_sw4.jpeg"><br><a name="habracut"></a><br><h3>  Extension des classes existantes </h3><br>  Il arrive parfois qu'il soit nécessaire d'étendre une classe existante sans modifier son contenu interne.  Autrement dit, après avoir créé la classe, nous la complétons avec d'autres classes.  Prenons un petit exemple.  Supposons que nous ayons une classe qui est un point dans un espace à deux dimensions.  À différents endroits de notre code, nous devons le sérialiser à la fois en Json et en XML. <br><br><div class="spoiler">  <b class="spoiler_title">Voyons à quoi cela peut ressembler en Java en utilisant le modèle Visitor</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DotDemo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dot</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = x; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y = y; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Visitor visitor)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visitor.visit(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> y; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dot dot)</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonVisitor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dot dot)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String .format(<span class="hljs-string"><span class="hljs-string">""</span></span> + <span class="hljs-string"><span class="hljs-string">"{"</span></span> + <span class="hljs-string"><span class="hljs-string">"\"x\"=%d, "</span></span> + <span class="hljs-string"><span class="hljs-string">"\"y\"=%d "</span></span> + <span class="hljs-string"><span class="hljs-string">"}"</span></span>, dot.getX(), dot.getY()); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XMLVisitor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dot dot)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;dot&gt;"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;x&gt;"</span></span> + dot.getX() + <span class="hljs-string"><span class="hljs-string">"&lt;/x&gt;"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" &lt;y&gt;"</span></span> + dot.getY() + <span class="hljs-string"><span class="hljs-string">"&lt;/y&gt;"</span></span> + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"&lt;/dot&gt;"</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Dot dot = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dot(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); System.out.println(<span class="hljs-string"><span class="hljs-string">"-------- JSON -----------"</span></span>); System.out.println(dot.accept(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonVisitor())); System.out.println(<span class="hljs-string"><span class="hljs-string">"-------- XML ------------"</span></span>); System.out.println(dot.accept(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLVisitor())); } }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En savoir plus sur le motif et son utilisation</a> <br></div></div><br>  Il semble assez volumineux, non?  Est-il possible de résoudre ce problème de manière plus élégante à l'aide d'outils linguistiques?  Scala et Kotlin acquiescent positivement.  Ceci est réalisé en utilisant le mécanisme d'extension de méthode.  Voyons à quoi ça ressemble. <br><br><div class="spoiler">  <b class="spoiler_title">Extensions à Kotlin</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dot</span></span></span><span class="hljs-class"> </span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) <span class="hljs-comment"><span class="hljs-comment">//      fun Dot.convertToJson(): String = "{\"x\"=$x, \"y\"=$y}" fun Dot.convertToXml(): String = """&lt;dot&gt; &lt;x&gt;$x&lt;/x&gt; &lt;y&gt;$y&lt;/y&gt; &lt;/dot&gt;""" fun main() { val dot = Dot(1, 2) println("-------- JSON -----------") println(dot.convertToJson()) println("-------- XML -----------") println(dot.convertToXml()) }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Extensions à Scala</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DotDemo</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// val is default case class Dot(x: Int, y: Int) implicit class DotConverters(dot: Dot) { def convertToJson(): String = s"""{"x"=${dot.x}, "y"=${dot.y}}""" def convertToXml(): String = s"""&lt;dot&gt; &lt;x&gt;${dot.x}&lt;/x&gt; &lt;y&gt;${dot.y}&lt;/y&gt; &lt;/dot&gt;""" } val dot = Dot(1, 2) println("-------- JSON -----------") println(dot.convertToJson()) println("-------- XML -----------") println(dot.convertToXml()) }</span></span></code> </pre><br></div></div><br>  Ça a l'air beaucoup mieux.  Parfois, cela ne suffit vraiment pas avec une cartographie abondante et d'autres transformations. <br><br><h3>  Chaîne informatique multi-thread </h3><br>  Maintenant, tout le monde parle d'informatique asynchrone et des interdictions de verrouillage dans les threads d'exécution.  Imaginons le problème suivant: nous avons plusieurs sources de nombres, où le premier renvoie simplement le nombre, le second - renvoie la réponse après avoir calculé le premier.  Par conséquent, nous devons renvoyer une chaîne avec deux nombres. <br><br><div class="spoiler">  <b class="spoiler_title">Schématiquement, cela peut être représenté comme suit</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sl/en/2s/slen2s9wvmnlguh2sh1nh8435au.png"><br></div></div><br>  Essayons d'abord de résoudre le problème en Java <br><br><div class="spoiler">  <b class="spoiler_title">Exemple Java</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CompletableFuture&lt;Optional&lt;String&gt;&gt; calcResultOfTwoServices ( Supplier&lt;Optional&lt;Integer&gt;&gt; getResultFromFirstService, Function&lt;Integer, Optional&lt;Integer&gt;&gt; getResultFromSecondService ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CompletableFuture .supplyAsync(getResultFromFirstService) .thenApplyAsync(firstResultOptional -&gt; firstResultOptional.flatMap(first -&gt; getResultFromSecondService.apply(first).map(second -&gt; first + <span class="hljs-string"><span class="hljs-string">" "</span></span> + second ) ) ); }</code> </pre> <br></div></div><br>  Dans cet exemple, notre numéro est encapsulé dans Facultatif pour contrôler le résultat.  De plus, toutes les actions sont effectuées dans CompletableFuture pour un travail pratique avec les threads.  L'action principale se déroule dans la méthode thenApplyAsync.  Dans cette méthode, nous obtenons facultatif comme argument.  Ensuite, flatMap est appelé pour contrôler le contexte.  Si l'option facultative reçue est renvoyée comme optionnel.vide, nous n'irons pas au deuxième service. <br><br>  Le total que nous avons reçu?  En utilisant CompletableFuture et des fonctionnalités optionnelles avec flatMap et map, nous avons pu résoudre le problème.  Bien que, à mon avis, la solution ne semble pas la plus élégante: avant de comprendre quel est le problème, vous devez lire le code.  Et que se passerait-il avec deux sources de données ou plus? <br><br>  La langue pourrait-elle nous aider d'une manière ou d'une autre à résoudre le problème.  Et encore une fois, tournez-vous vers Scala.  Voici comment vous pouvez le résoudre avec les outils Scala. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple Scala</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcResultOfTwoServices</span></span></span></span>(getResultFromFirstService: <span class="hljs-type"><span class="hljs-type">Unit</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>], getResultFromSecondService: <span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>]) = <span class="hljs-type"><span class="hljs-type">Future</span></span> { getResultFromFirstService() }.flatMap { firsResultOption =&gt; <span class="hljs-type"><span class="hljs-type">Future</span></span> { firsResultOption.flatMap(first =&gt; getResultFromSecondService(first).map(second =&gt; <span class="hljs-string"><span class="hljs-string">s"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$first</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$second</span></span></span><span class="hljs-string">"</span></span> ) )} }</code> </pre> <br></div></div><br>  Cela semble familier.  Et ce n'est pas un hasard.  Il utilise la bibliothèque scala.concurrent, qui est principalement un wrapper sur java.concurrent.  Eh bien, quoi d'autre Scala peut-il nous aider?  Le fait est que les chaînes de la forme flatMap, ..., map peuvent être représentées comme une séquence dans for. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple de deuxième version sur Scala</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcResultOfTwoServices</span></span></span></span>(getResultFromFirstService: <span class="hljs-type"><span class="hljs-type">Unit</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>], getResultFromSecondService: <span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>]) = <span class="hljs-type"><span class="hljs-type">Future</span></span> { getResultFromFirstService() }.flatMap { firstResultOption =&gt; <span class="hljs-type"><span class="hljs-type">Future</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { first &lt;- firstResultOption second &lt;- getResultFromSecondService(first) } <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">s"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$first</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$second</span></span></span><span class="hljs-string">"</span></span> } }</code> </pre> <br></div></div><br>  C'est mieux, mais essayons à nouveau de changer notre code.  Connectez la bibliothèque de chats. <br><br><div class="spoiler">  <b class="spoiler_title">Troisième version de l'exemple Scala</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cats.instances.future._ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcResultOfTwoServices</span></span></span></span>(getResultFromFirstService: <span class="hljs-type"><span class="hljs-type">Unit</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>], getResultFromSecondService: <span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>]): <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]] = (<span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { first &lt;- <span class="hljs-type"><span class="hljs-type">OptionT</span></span>(<span class="hljs-type"><span class="hljs-type">Future</span></span> { getResultFromFirstService() }) second &lt;- <span class="hljs-type"><span class="hljs-type">OptionT</span></span>(<span class="hljs-type"><span class="hljs-type">Future</span></span> { getResultFromSecondService(first) }) } <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">s"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$first</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$second</span></span></span><span class="hljs-string">"</span></span>).value</code> </pre> <br></div></div><br>  Maintenant ce n'est pas si important ce que signifie OptionT.  Je veux juste montrer à quel point cette opération peut être simple et courte. <br><br>  Mais qu'en est-il de Kotlin?  Essayons de faire quelque chose de similaire sur les coroutines. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple de Kotlin</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> result = async { withContext(Dispatchers.Default) { getResultFromFirstService() }?.let { first -&gt; withContext(Dispatchers.Default) { getResultFromSecondService(first) }?.let { second -&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$first</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$second</span></span></span><span class="hljs-string">"</span></span> } } }</code> </pre> <br></div></div><br>  Ce code a ses propres particularités.  Tout d'abord, il utilise le mécanisme Kotlin de la corutine.  Les tâches dans async sont effectuées dans un pool de threads spécial (pas ForkJoin) avec un mécanisme de vol de travail.  Deuxièmement, ce code nécessite un contexte spécial, à partir duquel des mots clés comme async et withContext sont extraits. <br><br>  Si vous avez aimé Scala Future, mais que vous écrivez sur Kotlin, vous pouvez faire attention aux emballages Scala similaires.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tapez tel.</a> <br><br><h4>  Travailler avec des flux </h4><br>  Pour montrer le problème plus en détail ci-dessus, essayons d'étendre l'exemple précédent: nous nous tournons vers les outils de programmation Java les plus populaires - <i>Reactor</i> , sur Scala - <i>fs2</i> . <br><br>  Envisagez la lecture ligne par ligne de 3 fichiers dans un flux et essayez d'y trouver des correspondances. <br>  Voici la façon la plus simple de le faire avec Reactor en Java. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple de réacteur en Java</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Flux&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">glueFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String filename1, String filename2, String filename3)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getLinesOfFile(filename1).flatMap(lineFromFirstFile -&gt; getLinesOfFile(filename2) .filter(line -&gt; line.equals(lineFromFirstFile)) .flatMap(lineFromSecondFile -&gt; getLinesOfFile(filename3) .filter(line -&gt; line.equals(lineFromSecondFile)) .map(lineFromThirdFile -&gt; lineFromThirdFile ) ) ); }</code> </pre> <br></div></div><br>  Pas le moyen le plus optimal, mais indicatif.  Il n'est pas difficile de deviner qu'avec plus de logique et d'accès à des ressources tierces, la complexité du code augmentera.  Voyons l'alternative sucrée de la syntaxe for-comprehension. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple de FS2 sur Scala</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-function">def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findUniqueLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename1: String, filename2: String, filename3: String)</span></span></span><span class="hljs-function">: Stream[IO, String] </span></span>= <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { lineFromFirstFile &lt;- readFile(filename1) lineFromSecondFile &lt;- readFile(filename2).filter(_.equals(lineFromFirstFile)) result &lt;- readFile(filename3).filter(_.equals(lineFromSecondFile)) } yield result</code> </pre> <br></div></div><br>  Il semble qu'il n'y ait pas beaucoup de changements, mais cela semble beaucoup mieux. <br><br><h4>  Séparation de la logique métier avec HigherKind et implicite </h4><br>  Allons de l'avant et voyons comment nous pouvons améliorer notre code autrement.  Je tiens à vous avertir que la prochaine partie peut ne pas être immédiatement compréhensible.  Je veux montrer les possibilités et laisser la méthode d'implémentation hors de la boucle pour l'instant.  Une explication détaillée nécessite au moins un article séparé.  S'il y a un désir / commentaires - je suivrai dans les commentaires pour répondre aux questions et rédiger la deuxième partie avec une description plus détaillée :) <br><br>  Imaginez donc un monde dans lequel nous pouvons définir la logique métier quels que soient les effets techniques pouvant survenir au cours du développement.  Par exemple, nous pouvons effectuer chaque demande ultérieure auprès d'un SGBD ou d'un service tiers dans un thread distinct.  Dans les tests unitaires, nous devons faire un stupide mok dans lequel rien ne se passe.  Et ainsi de suite. <br><br>  Peut-être que certaines personnes ont pensé au moteur BPM, mais aujourd'hui ce n'est pas à propos de lui.  Il s'avère que ce problème peut être résolu à l'aide de certains modèles de programmation fonctionnelle et de prise en charge du langage.  À un endroit, nous pouvons décrire la logique comme celle-ci. <br><br><div class="spoiler">  <b class="spoiler_title">En un seul endroit, nous pouvons décrire la logique comme celle-ci</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeCatHappy</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>[_]: <span class="hljs-type"><span class="hljs-type">Monad</span></span>: <span class="hljs-type"><span class="hljs-type">CatClinicClient</span></span>](): <span class="hljs-type"><span class="hljs-type">F</span></span>[<span class="hljs-type"><span class="hljs-type">Unit</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { catId &lt;- <span class="hljs-type"><span class="hljs-type">CatClinicClient</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>].getHungryCat memberId &lt;- <span class="hljs-type"><span class="hljs-type">CatClinicClient</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>].getFreeMember _ &lt;- <span class="hljs-type"><span class="hljs-type">CatClinicClient</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>].feedCatByFreeMember(catId, memberId) } <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> ()</code> </pre> <br></div></div><br>  Ici F [_] (lu comme "ef avec un trou") signifie un type sur un type (parfois on l'appelle une espèce dans la littérature russe).  Il peut s'agir d'une liste, d'un ensemble, d'une option, d'un avenir, etc.  Tout cela est un conteneur d'un type différent. <br><br>  Ensuite, nous changeons simplement le contexte de l'exécution du code.  Par exemple, pour l'environnement prod, nous pouvons faire quelque chose comme ça. <br><br><div class="spoiler">  <b class="spoiler_title">À quoi pourrait ressembler le code de combat?</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RealCatClinicClient</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatClinicClient</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Future</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHungryCat</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Future</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>] = <span class="hljs-type"><span class="hljs-type">Future</span></span> { <span class="hljs-type"><span class="hljs-type">Thread</span></span>.sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-comment"><span class="hljs-comment">// doing some calls to db (waiting 1 second) 40 } override def getFreeMember: Future[Int] = Future { Thread.sleep(1000) // doing some calls to db (waiting 1 second) 2 } override def feedCatByFreeMember(catId: Int, memberId: Int): Future[Unit] = Future { Thread.sleep(1000) // happy cat (waiting 1 second) println("so testy!") // Don't do like that. It is just for debug } }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">À quoi pourrait ressembler le code de test</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MockCatClinicClient</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CatClinicClient</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHungryCat</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Id</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>] = <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFreeMember</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Id</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>] = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">feedCatByFreeMember</span></span></span></span>(catId: <span class="hljs-type"><span class="hljs-type">Int</span></span>, memberId: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">Id</span></span>[<span class="hljs-type"><span class="hljs-type">Unit</span></span>] = { println(<span class="hljs-string"><span class="hljs-string">"so testy!"</span></span>) <span class="hljs-comment"><span class="hljs-comment">// Don't do like that. It is just for debug } }</span></span></code> </pre> <br></div></div><br>  Notre logique métier ne dépend désormais plus des frameworks, des clients http et des serveurs que nous avons utilisés.  À tout moment, nous pouvons changer le contexte et l'outil changera. <br><br>  Ceci est réalisé par des fonctionnalités telles que HigherKind et implicite.  Prenons le premier, et pour cela nous reviendrons à Java. <br><br><div class="spoiler">  <b class="spoiler_title">Regardons le code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Calcer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> CompletableFuture&lt;Integer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCalc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre><br></div></div><br>  Combien de façons de renvoyer le résultat?  Beaucoup.  Nous pouvons soustraire, ajouter, échanger et bien plus encore.  Imaginez maintenant que l'on nous ait donné des exigences claires.  Nous devons ajouter le premier nombre au second.  De combien de façons pouvons-nous faire cela?  <s>si vous essayez dur et vous affinez beaucoup ...</s> en général, un seul. <br><br><div class="spoiler">  <b class="spoiler_title">Le voici</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Calcer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> CompletableFuture&lt;Integer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCalc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CompletableFuture.supplyAsync(() -&gt; x + y); } }</code> </pre> <br></div></div><br>  Mais que se passe-t-il si l'appel à cette méthode est masqué et que nous voulons tester dans un environnement à thread unique?  Ou si nous voulons changer l'implémentation de la classe en supprimant / remplaçant CompletableFuture.  Malheureusement, en Java, nous sommes impuissants et devons changer l'API de la méthode.  Jetez un œil à l'alternative à Scala. <br><br><div class="spoiler">  <b class="spoiler_title">Tenez compte du trait</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Calcer</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCulc</span></span></span></span>(x: <span class="hljs-type"><span class="hljs-type">Int</span></span>, y: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">F</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>] }</code> </pre><br></div></div><br>  Nous créons des traits (l'analogue le plus proche est l'interface en Java) sans spécifier le type de conteneur de notre valeur entière. <br><br>  De plus, nous pouvons simplement créer diverses implémentations si nécessaire. <br><br><div class="spoiler">  <b class="spoiler_title">Comme ça</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> futureCalcer: <span class="hljs-type"><span class="hljs-type">Calcer</span></span>[<span class="hljs-type"><span class="hljs-type">Future</span></span>] = (x, y) =&gt; <span class="hljs-type"><span class="hljs-type">Future</span></span> {x + y} <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> optionCalcer: <span class="hljs-type"><span class="hljs-type">Calcer</span></span>[<span class="hljs-type"><span class="hljs-type">Option</span></span>] = (x, y) =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>(x + y)</code> </pre><br></div></div><br>  De plus, il y a une chose aussi intéressante qu'Implicite.  Il vous permet de créer le contexte de notre environnement et de sélectionner implicitement l'implémentation du trait en fonction de celui-ci. <br><br><div class="spoiler">  <b class="spoiler_title">Comme ça</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userCalcer</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>[_]](<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> calcer: <span class="hljs-type"><span class="hljs-type">Calcer</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>]): <span class="hljs-type"><span class="hljs-type">F</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>] = calcer.getCulc(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doItInFutureContext</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> futureCalcer: <span class="hljs-type"><span class="hljs-type">Calcer</span></span>[<span class="hljs-type"><span class="hljs-type">Future</span></span>] = (x, y) =&gt; <span class="hljs-type"><span class="hljs-type">Future</span></span> {x + y} println(userCalcer) } doItInFutureContext() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doItInOptionContext</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> optionCalcer: <span class="hljs-type"><span class="hljs-type">Calcer</span></span>[<span class="hljs-type"><span class="hljs-type">Option</span></span>] = (x, y) =&gt; <span class="hljs-type"><span class="hljs-type">Option</span></span>(x + y) println(userCalcer) } doItInOptionContext()</code> </pre> <br></div></div><br>  Implicite simplifié avant val - ajouter une variable à l'environnement actuel, et implicite comme argument à une fonction signifie prendre la variable de l'environnement.  Cela rappelle quelque peu une fermeture implicite. <br><br>  Dans l'ensemble, il s'avère que nous pouvons créer un environnement de combat et de test de manière assez concise sans utiliser de bibliothèques tierces. <br><div class="spoiler">  <b class="spoiler_title">Mais qu'en est-kotlin</b> <div class="spoiler_text">  En fait, d'une manière similaire, nous pouvons faire en kotlin: <br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Calculator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eval</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, y: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: T } <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> FutureCalculator : Calculator&lt;CompletableFuture&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eval</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, y: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = CompletableFuture.supplyAsync { x + y } } <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> OptionalCalculator : Calculator&lt;Optional&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eval</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, y: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Optional.of(x + y) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> Calculator</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useCalculator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(y: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = eval(<span class="hljs-number"><span class="hljs-number">1</span></span>, y) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { with (FutureCalculator) { println(useCalculator(<span class="hljs-number"><span class="hljs-number">2</span></span>)) } with (OptionalCalculator) { println(useCalculator(<span class="hljs-number"><span class="hljs-number">2</span></span>)) } }</code> </pre> <br>  Ici, nous définissons également le contexte d'exécution de notre code, mais contrairement à Scala, nous le signalons explicitement. <br>  Merci à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Beholder</a> pour l'exemple. <br></div></div><br><br><h4>  Conclusion </h4><br>  En général, ce ne sont pas toutes mes douleurs.  Il y en a plus.  Je pense que chaque développeur a le sien.  Pour ma part, j'ai réalisé que l'essentiel est de comprendre ce qui est vraiment nécessaire au bénéfice du projet.  Par exemple, à mon avis, si nous avons un service de repos qui agit comme une sorte d'adaptateur avec un tas de mappage et une logique simple, alors toutes les fonctionnalités ci-dessus ne sont pas très utiles.  Spring Boot + Java / Kotlin est parfait pour de telles tâches.  Il existe d'autres cas avec un grand nombre d'intégrations et d'agrégation de certaines informations.  Pour de telles tâches, à mon avis, la dernière option semble très bonne.  En général, c'est cool si vous pouvez choisir un outil basé sur une tâche. <br><br>  Ressources utiles: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien vers tous les exemples complets ci-dessus</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plus sur Corotin à Kotlin</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un bon livre d'introduction sur la programmation fonctionnelle à Scala</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456774/">https://habr.com/ru/post/fr456774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456760/index.html">Crowdsourcing au ML Boot Camp. Nous considérons mIOU sans images pour une nouvelle tâche d'Odnoklassniki</a></li>
<li><a href="../fr456762/index.html">De Witcher 3 à Cyberpunk: L'évolution du CD Projekt Quest Design</a></li>
<li><a href="../fr456768/index.html">4 difficultés à localiser les jeux mobiles en utilisant Fishing Clash comme exemple - traduction</a></li>
<li><a href="../fr456770/index.html">Course aux armements</a></li>
<li><a href="../fr456772/index.html">M&A pour les équipes de projet: comment gérer efficacement les données et les processus du projet?</a></li>
<li><a href="../fr456780/index.html">9 façons de stimuler l'efficacité du développeur d'applications mobiles</a></li>
<li><a href="../fr456782/index.html">Conception orientée modèle - comment ne pas répéter Tchernobyl</a></li>
<li><a href="../fr456790/index.html">Résumé des nouvelles de PostgreSQL. Numéro 16</a></li>
<li><a href="../fr456792/index.html">Déployer le cluster Kubernetes sur OpenStack avec Kubespray</a></li>
<li><a href="../fr456794/index.html">Architecture de l'interface utilisateur Web: un passé en bois, un présent étrange et un brillant avenir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>