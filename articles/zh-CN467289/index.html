<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>âœŠ ğŸ‡ğŸ¿ ğŸ‘©ğŸ¿â€ğŸ« å¼€å‘å•ç‰‡ç±»Unixæ“ä½œç³»ç»Ÿ-GDTå’ŒIDTï¼ˆ5ï¼‰ ğŸš´ğŸ¼ ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨ ğŸ¤¯</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†åŠ¨æ€å†…å­˜ç®¡ç†å™¨ã€‚ 
 ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ä»‹ç»åœ¨Intel i386å¤„ç†å™¨çš„ä¿æŠ¤æ¨¡å¼ä¸‹å·¥ä½œçš„åŸºç¡€çŸ¥è¯†ã€‚ 
 å³ï¼šå…¨å±€æè¿°ç¬¦è¡¨å’Œä¸­æ–­å‘é‡è¡¨ã€‚ 


 ç›®å½• 
 æ„å»ºç³»ç»Ÿï¼ˆmakeï¼Œgccï¼Œgasï¼‰ã€‚ åˆå§‹å¼•å¯¼ï¼ˆå¤šæ¬¡å¼•å¯¼ï¼‰ã€‚ å¯åŠ¨ï¼ˆqemuï¼‰ã€‚ Cåº“ï¼ˆstrcpyï¼Œmemcpyï¼Œstr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¼€å‘å•ç‰‡ç±»Unixæ“ä½œç³»ç»Ÿ-GDTå’ŒIDTï¼ˆ5ï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467289/"> åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†åŠ¨æ€å†…å­˜ç®¡ç†å™¨ã€‚ <br> ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ä»‹ç»åœ¨Intel i386å¤„ç†å™¨çš„ä¿æŠ¤æ¨¡å¼ä¸‹å·¥ä½œçš„åŸºç¡€çŸ¥è¯†ã€‚ <br> å³ï¼šå…¨å±€æè¿°ç¬¦è¡¨å’Œä¸­æ–­å‘é‡è¡¨ã€‚ <br><a name="habracut"></a><br><br><h4> ç›®å½• </h4><br> æ„å»ºç³»ç»Ÿï¼ˆmakeï¼Œgccï¼Œgasï¼‰ã€‚ åˆå§‹å¼•å¯¼ï¼ˆå¤šæ¬¡å¼•å¯¼ï¼‰ã€‚ å¯åŠ¨ï¼ˆqemuï¼‰ã€‚  Cåº“ï¼ˆstrcpyï¼Œmemcpyï¼Œstrextï¼‰ã€‚ <br>  Cåº“ï¼ˆsprintfï¼Œstrcpyï¼Œstrcmpï¼Œstrtokï¼Œva_list ...ï¼‰ã€‚ ä»¥å†…æ ¸æ¨¡å¼å’Œç”¨æˆ·åº”ç”¨ç¨‹åºæ¨¡å¼æ„å»ºåº“ã€‚ <br> å†…æ ¸ç³»ç»Ÿæ—¥å¿—ã€‚ æ˜¾å­˜ è¾“å‡ºåˆ°ç»ˆç«¯ï¼ˆkprintfï¼Œkpanicï¼Œkassertï¼‰ã€‚ <br> åŠ¨æ€å†…å­˜ï¼Œå †ï¼ˆkmallocï¼Œkfreeï¼‰ã€‚ <br> å†…å­˜å’Œä¸­æ–­å¤„ç†çš„ç»„ç»‡ï¼ˆGDTï¼ŒIDTï¼ŒPICï¼Œsyscallï¼‰ã€‚ ä¾‹å¤–æƒ…å†µ <br> è™šæ‹Ÿå†…å­˜ï¼ˆé¡µé¢ç›®å½•å’Œé¡µé¢è¡¨ï¼‰ã€‚ <br> è¿‡ç¨‹ã€‚ ç­–åˆ’äºº å¤šä»»åŠ¡å¤„ç†ã€‚ ç³»ç»Ÿè°ƒç”¨ï¼ˆkillï¼Œexitï¼Œpsï¼‰ã€‚ <br> å†…æ ¸ï¼ˆinitrdï¼‰ï¼ŒelfåŠå…¶å†…éƒ¨æ–‡ä»¶ç³»ç»Ÿã€‚ ç³»ç»Ÿè°ƒç”¨ï¼ˆæ‰§è¡Œï¼‰ã€‚ <br> å­—ç¬¦è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚ ç³»ç»Ÿè°ƒç”¨ï¼ˆioctlï¼Œfopenï¼Œfreadï¼Œfwriteï¼‰ã€‚  Cåº“ï¼ˆfopenï¼Œfcloseï¼Œfprintfï¼Œfscanfï¼‰ã€‚ <br>  Shellä½œä¸ºå†…æ ¸çš„å®Œæ•´ç¨‹åºã€‚ <br> ç”¨æˆ·ä¿æŠ¤æ¨¡å¼ï¼ˆring3ï¼‰ã€‚ ä»»åŠ¡çŠ¶æ€æ®µï¼ˆtssï¼‰ã€‚ <br><br><h4> çº¿æ€§å¯»å€ </h4><br> è‹±ç‰¹å°”å¤„ç†å™¨æœ‰2ç§ä¸»è¦æ“ä½œæ¨¡å¼ï¼šä¿æŠ¤æ¨¡å¼x32å’ŒIA-32e x64ã€‚ <br> æ€»çš„æ¥è¯´ï¼Œç¥–å¸ƒç§‘å¤«å¯¹æ­¤å†™å¾—å¾ˆå¥½ï¼Œå¾ˆå®¹æ˜“ç†è§£ï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯»å®ƒï¼Œå°½ç®¡åŸåˆ™ä¸Šä¹Ÿå¯ä»¥ä½¿ç”¨ã€Šè‹±ç‰¹å°”æ‰‹å†Œã€‹ï¼Œä½†å®ƒå¹¶ä¸å¤æ‚ï¼Œä½†å¤šä½™ä¸”åºå¤§ã€‚ <br> ä»–ä»¬ä¸ºç³»ç»Ÿç¼–ç¨‹æä¾›äº†å•ç‹¬çš„å·ï¼Œæˆ‘å»ºè®®é˜…è¯»ã€‚ <br> é¦–å…ˆæœ‰æ›´å¤šçš„ä¿„è¯­ä¿¡æ¯ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å°†ç®€è¦è€ƒè™‘è¦ç‚¹ã€‚ <br> å¯»å€æœ‰ä¸¤ç§ç±»å‹ï¼šçº¿æ€§å¯»å€å’Œé¡µé¢å¯»å€ã€‚ çº¿æ€§è¡¨ç¤ºæ•´ä¸ªç‰©ç†ç©ºé—´æ˜¯è¿ç»­æè¿°çš„ï¼Œå¹¶ä¸”ä¸ç‰©ç†ç©ºé—´ä¸€è‡´ï¼Œå› ä¸ºé€šå¸¸ï¼Œæ®µæè¿°ç¬¦çš„åŸºæ•°ä¸ºé›¶ï¼Œå› ä¸ºå®ƒæ›´å®¹æ˜“ã€‚ <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºå†…æ ¸æ¨¡å¼ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸‰ä¸ªæè¿°å†…å­˜çš„æè¿°ç¬¦ï¼šä»£ç ï¼Œå †æ ˆå’Œæ•°æ®ã€‚ å®ƒä»¬å…·æœ‰ä¸€äº›ç¡¬ä»¶ä¿æŠ¤åŠŸèƒ½ã€‚ <br> æ¯ä¸ªè¿™æ ·çš„æ®µéƒ½æœ‰ä¸€ä¸ªä»¥0ä¸ºåº•çš„åŸºæ•°ï¼Œä»¥åŠä¸€ä¸ªç”±æœºå™¨å­—çš„æœ€å¤§å¤§å°ç¡®å®šçš„é™åˆ¶ã€‚ å †æ ˆæ²¿ç›¸åçš„æ–¹å‘å¢é•¿ï¼Œä¸ºæ­¤ï¼Œæè¿°ç¬¦ä¸­è¿˜æœ‰ä¸€ä¸ªæ ‡å¿—ã€‚ <br> å› æ­¤ï¼Œä½¿ç”¨æ­¤æ ¼å¼çš„ä¸‰æ¡è®°å½•ï¼Œæˆ‘ä»¬å¯ä»¥æ»¡è¶³æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼š <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Global descriptor table entry */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GDT_entry_t</span></span></span><span class="hljs-class"> {</span></span> u16 limit_low: <span class="hljs-number"><span class="hljs-number">16</span></span>; u16 base_low: <span class="hljs-number"><span class="hljs-number">16</span></span>; u8 base_middle: <span class="hljs-number"><span class="hljs-number">8</span></span>; u8 type: <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* whether code (0b1010), data (0b0010), stack (0b0110) or tss (0b1001) */</span></span> u8 s: <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* whether system descriptor */</span></span> u8 dpl: <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* privilege level */</span></span> u8 p: <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* whether segment prensent */</span></span> u8 limit_high: <span class="hljs-number"><span class="hljs-number">4</span></span>; u8 a: <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* reserved for operation system */</span></span> u8 zero: <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* zero */</span></span> u8 db: <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* whether 16 or 32 segment */</span></span> u8 g: <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* granularity */</span></span> u8 base_high: <span class="hljs-number"><span class="hljs-number">8</span></span>; } attribute(packed);</code> </pre> <br><br> æ¯ä¸ªæ®µå¯„å­˜å™¨ï¼ˆcsï¼Œdsï¼Œssï¼‰åœ¨GDTä¸­éƒ½æœ‰å…¶è‡ªå·±çš„æè¿°ç¬¦ï¼Œå› æ­¤ï¼Œå½“æˆ‘ä»¬åœ¨ä»£ç æ®µä¸­ç¼–å†™æŸäº›å†…å®¹æ—¶ï¼Œä¼šå‡ºé”™ï¼Œå› ä¸ºæè¿°ç¬¦ä¸­å­˜åœ¨å†™ä¿æŠ¤ã€‚ <br> ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»¥ä¸‹æ ¼å¼çš„ç»“æ„åŠ è½½åˆ°GDTRå¯„å­˜å™¨ä¸­ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Global descriptor table pointer */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GDT_pointer_t</span></span></span><span class="hljs-class"> {</span></span> u16 limit; u32 base; } attribute(packed);</code> </pre><br><br> é™åˆ¶æ˜¯GDTè¡¨çš„ç»“å°¾å‡å»1ï¼ŒåŸºæ•°æ˜¯å®ƒåœ¨å†…å­˜ä¸­çš„å¼€å¤´ã€‚ <br>  GDTåƒè¿™æ ·è¢«åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ï¼š <br><br> <code>/* <br> * Load global descriptor table <br> * void asm_gdt_load(void *gdt_ptr) <br> */ <br> asm_gdt_load: <br> mov 4(%esp),%eax # eax = gdt_ptr <br> lgdt (%eax) <br> mov $0x10,%eax <br> mov %ax,%ds <br> mov %ax,%es <br> mov %ax,%fs <br> mov %ax,%gs <br> mov %ax,%ss <br> jmp $0x08,$asm_gdt_load_exit <br> asm_gdt_load_exit: <br> ret <br></code> <br><br> ä¹‹åï¼Œæˆ‘ä»¬ç«‹å³å°†å†…æ ¸æ•°æ®é€‰æ‹©å™¨åŠ è½½åˆ°æ‰€æœ‰æ®µå¯„å­˜å™¨ä¸­ï¼Œä»è€ŒæŒ‡ç¤ºæ•°æ®æè¿°ç¬¦ï¼ˆé›¶ä¿æŠ¤ç¯ï¼‰ã€‚ <br> ä¹‹åï¼Œæ‰€æœ‰å†…å®¹éƒ½å‡†å¤‡å¥½åŒ…æ‹¬åˆ†é¡µï¼Œä½†ç¨åä¼šä»‹ç»æ›´å¤šå†…å®¹ã€‚ <br> é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¤šå¼•å¯¼å¼•å¯¼åŠ è½½ç¨‹åºå»ºè®®ç«‹å³è®¾ç½®å…¶GDTï¼Œå°½ç®¡å®ƒä»¬æ˜¯è‡ªå·±æ‰§è¡Œçš„ï¼Œä½†è¯´èµ·æ¥æ›´å¯é ã€‚ <br> åœ¨è§†é¢‘æ•™ç¨‹ä¸­äº†è§£å¦‚ä½•ä»æŠ€æœ¯ä¸Šæ­£ç¡®åœ°å®Œæˆæ‰€æœ‰è¿™äº›æ“ä½œã€‚ <br><br><h4> ä¸­æ–­å¤„ç† </h4><br> ä¸GDTç±»ä¼¼ï¼Œä¸­æ–­è¡¨å…·æœ‰è‡ªå·±çš„IDTRå¯„å­˜å™¨ï¼Œæ‚¨è¿˜éœ€è¦åœ¨å…¶ä¸­è£…è½½ç±»ä¼¼çš„æŒ‡é’ˆï¼Œä½†è¯¥æŒ‡é’ˆå·²ç»åœ¨IDTä¸Šã€‚ <br> ä¸­æ–­è¡¨æœ¬èº«ç”±ä»¥ä¸‹æ¡ç›®æè¿°ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Interrupt table entry */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDT_entry_t</span></span></span><span class="hljs-class"> {</span></span> u16 offset_lowerbits; u16 selector; u8 zero; u8 type_attr; u16 offset_higherbits; };</code> </pre><br><br> ä¸­æ–­ç½‘å…³é€šå¸¸æ˜¯ä¸€ç§ç±»å‹ï¼Œå› ä¸ºæˆ‘ä»¬è¦ä¸“é—¨å¤„ç†ä¸­æ–­ã€‚ æˆ‘ä»¬è¿˜ä¸è€ƒè™‘é™·é˜±å’Œå‘¼å«ç½‘å…³ï¼Œå› ä¸ºå®ƒç¦»TSSå’Œä¿æŠ¤ç¯æ›´è¿‘ã€‚ <br> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸æ‚¨ä¸€èµ·ä½¿ç”¨è¿™äº›è¡¨çš„ç•Œé¢ã€‚ å®ƒä»¬åªéœ€è¦è®¾ç½®ä¸€æ¬¡å¹¶è¢«å¿˜è®°ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Api */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gdt_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idt_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre><br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å°†å£°æ˜IDTè®°å½•æœ¬èº«ä¸­åˆ—å‡ºçš„ä¸­æ–­å¤„ç†ç¨‹åºã€‚ <br> é¦–å…ˆï¼Œç¼–å†™ç¡¬ä»¶é”™è¯¯å¤„ç†ç¨‹åºï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Api - IDT */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ih_double_fault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ih_general_protect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ih_page_fault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ih_alignment_check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asm_ih_double_fault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asm_ih_general_protect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asm_ih_page_fault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asm_ih_alignment_check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre><br><br> ç„¶åæ˜¯é”®ç›˜ä¸­æ–­å¤„ç†ç¨‹åºï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Api - IRQ */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ih_keyboard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asm_ih_keyboard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre><br><br> ç°åœ¨è¯¥åˆå§‹åŒ–IDTè¡¨äº†ã€‚ <br> çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idt_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> idt_address; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> idt_ptr[<span class="hljs-number"><span class="hljs-number">2</span></span>]; pic_init(); <span class="hljs-comment"><span class="hljs-comment">/* fill idt */</span></span> idt_fill_entry(INT_DOUBLE_FAULT, (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)asm_ih_double_fault); idt_fill_entry(INT_GENERAL_PROTECT, (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)asm_ih_general_protect); idt_fill_entry(INT_ALIGNMENT_CHECK, (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)asm_ih_alignment_check); idt_fill_entry(INT_KEYBOARD, (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)asm_ih_keyboard); <span class="hljs-comment"><span class="hljs-comment">/* load idt */</span></span> idt_address = (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>)IDT; idt_ptr[<span class="hljs-number"><span class="hljs-number">0</span></span>] = (LOW_WORD(idt_address) &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) + (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(struct IDT_entry_t) * IDT_SIZE); idt_ptr[<span class="hljs-number"><span class="hljs-number">1</span></span>] = idt_address &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>; asm_idt_load(idt_ptr); }</code> </pre><br><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ³¨å†Œäº†ä¸‰ä¸ªç¡¬ä»¶é”™è¯¯å¤„ç†ç¨‹åºå’Œä¸€ä¸ªä¸­æ–­ã€‚ <br> ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åŸºæ•°å’Œé™åˆ¶å°†ç‰¹æ®ŠæŒ‡é’ˆåŠ è½½åˆ°IDTRå¯„å­˜å™¨ä¸­ï¼š <br><br> <code>/* <br> * Load interrupt table <br> * void asm_idt_load(unsigned long *addr) <br> */ <br> asm_idt_load: <br> push %edx <br> mov 8(%esp), %edx <br> lidt (%edx) <br> pop %edx <br> ret <br></code> <br><br> éœ€è¦é™åˆ¶æ‰èƒ½äº†è§£è¡¨ä¸­æœ‰å¤šå°‘æ¡è®°å½•ã€‚ <br> æ˜¯æ—¶å€™ç¼–å†™é”®ç›˜ä¸­æ–­å¤„ç†ç¨‹åºäº†ï¼š <br><br> <code>/* <br> * Handle IRQ1 <br> * void asm_ih_keyboard(unsigned int) <br> */ <br> asm_ih_keyboard: <br> pushal <br> call ih_keyboard <br> popal <br> iretl <br></code> <br><br> æ³¨æ„ï¼šåœ¨ä¸‹æ–‡ä»¥åŠä»£ç çš„å„å¤„ï¼Œâ€œä¸‹åŠéƒ¨åˆ†â€ç­‰åŒäºLinuxä¸­çš„â€œä¸ŠåŠéƒ¨åˆ†â€ã€‚ ä¸â€œä¸Šâ€åˆ†åˆ«ç›¸åã€‚ æˆ‘å¾ˆæŠ±æ­‰ï¼Œç›¸åçš„è¯å‡ºç°åœ¨æˆ‘çš„è„‘æµ·ï¼šD <br><br> å®é™…ä¸Šï¼Œå®ƒå°†æŠŠä»£ç ä¼ é€’ç»™é«˜çº§å¤„ç†ç¨‹åºã€‚ <br> è¿™å°†ä¾æ¬¡è°ƒç”¨æ³¨å†Œäº†å¤„ç†æ­¤ä¸­æ–­è¯·æ±‚çš„ç›¸åº”é©±åŠ¨ç¨‹åºä¸‹åŠéƒ¨åˆ†çš„å¤„ç†ç¨‹åºã€‚ <br> åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒå°†æ˜¯å­—ç¬¦è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚ <br> éœ€è¦ä¸‹åŠéƒ¨åˆ†æ¥å¿«é€Ÿå¤„ç†ä¸­æ–­è€Œä¸é™ä½å…¶ä»–ä¸­æ–­çš„é€Ÿåº¦ï¼Œç„¶åï¼Œå¦‚æœæœ‰æ—¶é—´ï¼Œä¸ŠåŠéƒ¨åˆ†çš„å¤„ç†å™¨å°†é€æ¸æ‰§è¡Œå…¶ä»–å·¥ä½œï¼Œå› ä¸ºè¿™æ ·çš„å¤„ç†å™¨å·²ç»å¾ˆæ‹¥æŒ¤ï¼ˆè¢«ä¸­æ–­ï¼‰ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Api - Keyboard interrupt handler */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ih_keyboard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"[IH]: irq %u\n"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); u_char status = asm_read_port(KEYBOARD_STATUS_PORT); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (status &amp; <span class="hljs-number"><span class="hljs-number">0x01</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> keycode = asm_read_port(KEYBOARD_DATA_PORT); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keycode &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> end; } <span class="hljs-comment"><span class="hljs-comment">/* call low half (bottom) interrupt handler */</span></span> } end: asm_write_port(PIC1_CMD_PORT, <span class="hljs-number"><span class="hljs-number">0x20</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* end of interrupt */</span></span> }</code> </pre><br><br> ç°åœ¨ï¼Œå½“æˆ‘ä»¬æŒ‰ä¸‹é”®ç›˜é”®æ—¶ï¼Œæ¯æ¬¡æˆ‘ä»¬éƒ½ä¼šåœ¨å†…æ ¸ç³»ç»Ÿæ—¥å¿—ä¸­çœ‹åˆ°ç›¸åº”çš„æ¡ç›®ã€‚ <br><br><h4> å‚è€ƒæ–‡çŒ® </h4><br> ç°åœ¨ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰“å¼€æœ¬æ–‡çš„è§†é¢‘æ•™ç¨‹ã€‚</a> <br> å¹¶å¹¶è¡Œè§‚çœ‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">gitå­˜å‚¨åº“ï¼ˆæ‚¨éœ€è¦ä¸€ä¸ªlesson5åˆ†æ”¯ï¼‰</a> <br><br><h4> å‚è€ƒæ–‡çŒ® </h4><br>  1.è©¹å§†æ–¯Â·è«æ´›ä¼Šï¼ˆJames Molloyï¼‰ã€‚ æ»šåŠ¨è‡ªå·±çš„ç©å…·UNIXå…‹éš†æ“ä½œç³»ç»Ÿã€‚ <br>  2.ç‰™é½¿ã€‚  DOSï¼ŒWindowsï¼ŒUnixçš„æ±‡ç¼–å™¨ <br>  3.å¡æ‹‰ä»€å°¼ç§‘å¤«ã€‚ æ±‡ç¼–ç¨‹åºå¾ˆç®€å•ï¼ <br>  4. Tanenbaumã€‚ æ“ä½œç³»ç»Ÿã€‚ å®æ–½ä¸å¼€å‘ã€‚ <br>  5.ç½—ä¼¯ç‰¹Â·æ´›å¤«ï¼ˆRobert Loveï¼‰ã€‚  Linuxå†…æ ¸ å¼€å‘è¿‡ç¨‹çš„æè¿°ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN467289/">https://habr.com/ru/post/zh-CN467289/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN467275/index.html">åˆ°äº†ç¨‹åºå‘˜ä¹‹æ—¥ã€‚ 2019å¹´ç¨‹åºå‘˜</a></li>
<li><a href="../zh-CN467277/index.html">pg_stat_statements + pg_stat_activity + loq_query = pg_ashï¼Ÿ</a></li>
<li><a href="../zh-CN467279/index.html">UEFAå›½å®¶æ¯”ç‡è®¡ç®—</a></li>
<li><a href="../zh-CN467281/index.html">æ•°æ®ç§‘å­¦å®¶ç”»è±¡åœ¨ä¿„ç½—æ–¯ã€‚ ä»…äº‹å®</a></li>
<li><a href="../zh-CN467283/index.html">å¦‚ä½•å‘ç¥–æ¯è§£é‡ŠSQLå’ŒNoSQLä¹‹é—´çš„åŒºåˆ«</a></li>
<li><a href="../zh-CN467291/index.html">iOSåˆ›é€ åŠ›ï¼šç»˜å›¾</a></li>
<li><a href="../zh-CN467295/index.html">æœŸå¾…å·²ä¹…çš„Androidä¸­çš„è§†å›¾ç»‘å®š</a></li>
<li><a href="../zh-CN467299/index.html">æ¦‚å¿µï¼šç®€åŒ–STD Utilityç±»çš„å®ç°</a></li>
<li><a href="../zh-CN467301/index.html">AIåœ¨ã€Šæ€æ‰‹ã€‹ä¸­çš„è¿ä½œæ–¹å¼ï¼ˆ2016ï¼‰</a></li>
<li><a href="../zh-CN467303/index.html">æœ€å¹´è½»çš„PSBç¨‹åºå‘˜çš„æ•…äº‹ï¼šé»‘å®¢é©¬æ‹‰æ¾æˆä¸ºé“¶è¡Œçš„å¤§é—¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>