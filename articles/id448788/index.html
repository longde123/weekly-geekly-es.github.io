<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎳 👊 🏸 Pengujian Python dengan pytest. Bab 2, Fungsi Tes Penulisan 👩🏿‍🤝‍👩🏽 👩🏿‍🔬 👩🏽‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kembali Selanjutnya 


 Anda akan belajar bagaimana mengatur tes ke dalam kelas, modul, dan direktori. Saya kemudian akan menunjukkan kepada Anda baga...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengujian Python dengan pytest. Bab 2, Fungsi Tes Penulisan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448788/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kembali</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Selanjutnya</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>Anda akan belajar bagaimana mengatur tes ke dalam kelas, modul, dan direktori.</em>  <em>Saya kemudian akan menunjukkan kepada Anda bagaimana menggunakan marker untuk menandai tes mana yang ingin Anda jalankan, dan membahas bagaimana marker built-in dapat membantu Anda melewati tes dan menandai tes, mengharapkan kegagalan.</em>  <em>Akhirnya, saya akan berbicara tentang parameterisasi tes, yang memungkinkan tes dipanggil dengan data yang berbeda.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  Contoh-contoh dalam buku ini ditulis menggunakan Python 3.6 dan pytest 3.2.  pytest 3.2 mendukung Python 2.6, 2.7, dan Python 3.3+. </p><br><blockquote> Kode sumber untuk proyek Tugas, serta untuk semua tes yang ditunjukkan dalam buku ini, tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">tautan</a> di halaman web buku di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  Anda tidak perlu mengunduh kode sumber untuk memahami kode uji;  kode uji disajikan dalam bentuk yang mudah dalam contoh.  Tetapi untuk mengikuti tugas-tugas proyek, atau mengadaptasi contoh uji untuk menguji proyek Anda sendiri (tangan Anda tidak terikat!), Anda harus pergi ke halaman web buku dan mengunduh karya.  Di sana, di halaman web buku, ada tautan untuk pesan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest/errata">errata</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://forums.pragprog.com/forums/438">forum diskusi</a> . </blockquote><p>  Di bawah spoiler adalah daftar artikel dalam seri ini. </p><br><div class="spoiler">  <b class="spoiler_title">Daftar isi</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Pendahuluan</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 1: memulai dengan pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 2: Fungsi Tes Penulisan</strong></a> (Artikel ini) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 3: Jadwal Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 4: Perlengkapan yang Terpasang</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 5: Plugin</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 6: Konfigurasi</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 7: Menggunakan pytest dengan alat lain</strong></a> </li></ul></div></div><br><p>  Di bab sebelumnya, Anda menjalankan pytest.  Anda melihat cara menjalankannya dengan file dan direktori dan berapa banyak opsi yang berfungsi.  Dalam bab ini, Anda akan belajar cara menulis fungsi pengujian dalam konteks pengujian paket Python.  Jika Anda menggunakan pytest untuk menguji apa pun selain paket Python, sebagian besar bab ini akan sangat membantu. </p><br><p>  Kami akan menulis tes untuk paket Tugas.  Sebelum kita melakukan ini, saya akan berbicara tentang struktur paket distribusi Python dan tes untuk itu, serta bagaimana membuat tes melihat paket tes.  Lalu saya akan menunjukkan kepada Anda bagaimana menggunakan assert dalam tes, bagaimana tes menangani pengecualian yang tidak terduga dan menguji pengecualian yang diharapkan. </p><br><p>  Pada akhirnya, kami akan memiliki banyak tes.  Dengan cara ini Anda akan belajar cara mengatur tes ke dalam kelas, modul, dan direktori.  Saya kemudian akan menunjukkan kepada Anda bagaimana menggunakan marker untuk menandai tes mana yang ingin Anda jalankan, dan membahas bagaimana marker built-in dapat membantu Anda melewati tes dan menandai tes, mengharapkan kegagalan.  Akhirnya, saya akan berbicara tentang parameterisasi tes, yang memungkinkan tes dipanggil dengan data yang berbeda. </p><br><blockquote> <strong><em>Catatan Penerjemah:</em></strong> <strong><em>Jika Anda menggunakan Python 3.5 atau 3.6,</em></strong> maka ketika Anda menjalankan tes di Bab 2, Anda mungkin menerima pesan seperti ini <br><img src="https://habrastorage.org/webt/57/eq/4x/57eq4xsrdjfiyxn9g9ihresujc8.jpeg"><br>  Masalah ini diobati dengan memperbaiki <code>...\code\tasks_proj\src\tasks\tasksdb_tinydb.py</code> dan menginstal ulang paket tugas <br><pre> <code class="plaintext hljs">$ cd /path/to/code $ pip install ./tasks_proj/`</code> </pre> <br><br>  Anda <code>eids</code> <code>doc_ids</code> parameter bernama <code>eids</code> pada <code>doc_ids</code> dan <code>doc_id</code> pada <code>doc_id</code> dalam modul <code>...\code\tasks_proj\src\tasks\tasksdb_tinydb.py</code> <br><br>  Penjelasan Lihat <code>#83783</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini.</a> </blockquote><br><h2 id="testirovanie-paketa">  Paket pengujian </h2><br><p>  Untuk mempelajari cara menulis fungsi tes untuk paket Python, kami akan menggunakan proyek Tugas sampel seperti yang dijelaskan dalam proyek Tugas di halaman xii.  Tugas adalah paket Python yang mencakup alat baris perintah dengan nama tugas yang sama. </p><br><p>  Apendiks 4, Pengemasan dan Distribusi Proyek Python di halaman 175, memberikan penjelasan tentang bagaimana mendistribusikan proyek Anda secara lokal dalam tim kecil atau global melalui PyPI, jadi saya tidak akan merinci bagaimana melakukan ini;  namun, mari kita cepat melihat apa yang ada di proyek Tugas dan bagaimana file yang berbeda masuk ke dalam sejarah pengujian proyek ini. </p><br><p>  Berikut ini adalah struktur file proyek Tugas: </p><br><pre> <code class="plaintext hljs">tasks_proj/ ├── CHANGELOG.rst ├── LICENSE ├── MANIFEST.in ├── README.rst ├── setup.py ├── src │ └── tasks │ ├── __init__.py │ ├── api.py │ ├── cli.py │ ├── config.py │ ├── tasksdb_pymongo.py │ └── tasksdb_tinydb.py └── tests ├── conftest.py ├── pytest.ini ├── func │ ├── __init__.py │ ├── test_add.py │ └── ... └── unit ├── __init__.py ├── test_task.py └── ...</code> </pre> <br><p>  Saya menyertakan daftar lengkap proyek (dengan pengecualian daftar lengkap file tes) untuk menunjukkan bagaimana tes sesuai dengan sisa proyek dan menunjuk ke beberapa file yang merupakan kunci untuk pengujian, yaitu <em>conftest.py, pytest.ini</em> , berbagai <em><code>__init__.py</code></em> file <em><code>__init__.py</code></em> dan <em>setup.py</em> . </p><br><p>  Semua tes disimpan dalam <em>tes</em> dan terpisah dari file sumber paket di <em>src</em> .  Ini bukan persyaratan terbaik, tetapi ini adalah praktik terbaik. </p><br><p>  Semua file tingkat atas, <em>CHANGELOG.rst, LICENSE, README.rst, MANIFEST.in</em> , dan <em>setup.py</em> , dibahas secara lebih rinci di Lampiran 4, Proyek Pengemasan dan Distribusi Python, di halaman 175. Meskipun <em>setup.py</em> penting untuk membangun distribusi dari paket, serta untuk kemampuan menginstal paket secara lokal sehingga paket tersedia untuk impor. </p><br><p>  Tes fungsional dan unit dibagi ke dalam katalog mereka sendiri.  Ini adalah keputusan yang sewenang-wenang dan tidak perlu.  Namun, pengorganisasian file tes ke dalam beberapa direktori membuatnya mudah untuk menjalankan subset dari tes.  Saya suka memisahkan tes fungsional dan unit, karena tes fungsional hanya akan pecah jika kami dengan sengaja mengubah fungsionalitas sistem, sementara tes unit dapat rusak selama perubahan refactoring atau implementasi. </p><br><p>  Proyek ini berisi dua jenis file <code>__init__.py</code> : yang ditemukan di direktori <code>src/</code> dan yang ditemukan di <code>tests/</code> .  File <code>src/tasks/__init__.py</code> memberi tahu Python bahwa direktori adalah sebuah paket.  Itu juga bertindak sebagai antarmuka utama untuk paket ketika seseorang menggunakan <code>import tasks</code> .  Ini berisi kode untuk mengimpor fungsi tertentu dari <code>api.py</code> , sehingga <code>cli.py</code> dan file pengujian kami dapat mengakses fungsi paket, misalnya <code>tasks.add()</code> , alih-alih menjalankan <code>task.api.add ()</code> .  File <code>tests/func/__init__.py</code> dan <code>tests/unit/__init__.py</code> kosong.  Mereka memberi tahu pytest untuk naik satu direktori untuk menemukan root dari direktori tes dan file <code>pytest.ini</code> . </p><br><p>  File <code>pytest.ini</code> adalah opsional.  Ini berisi konfigurasi pytest umum untuk seluruh proyek.  Proyek Anda seharusnya tidak lebih dari satu.  Mungkin berisi arahan yang mengubah perilaku pytest, misalnya, menyiapkan daftar parameter yang akan selalu digunakan.  Anda akan mempelajari semua tentang <code>pytest.ini</code> di Bab 6, “Konfigurasi,” di halaman 113. </p><br><p>  File conftest.py juga opsional.  Itu dianggap pytest sebagai "plugin lokal" dan mungkin berisi fungsi dan perlengkapan kait.  <em>Fungsi kait</em> adalah cara untuk menyematkan kode di bagian runtime pytest untuk mengubah cara kerja pytest.  Fixture adalah fungsi pengaturan dan teardown yang berjalan sebelum dan sesudah fungsi tes dan dapat digunakan untuk mewakili sumber daya dan data yang digunakan oleh tes.  (Fixture dibahas dalam Bab 3, Fixture pytest, pada halaman 49 dan Bab 4, Fixture Fixin, pada halaman 71, dan fungsi kait dibahas dalam Bab 5 "Plugin" pada halaman 95.) Fungsi dan fiting hook yang digunakan dalam tes di beberapa subdirektori harus dimuat dalam tes / conftest.py.  Anda dapat memiliki beberapa file conftest.py;  misalnya, Anda dapat memiliki satu di tes dan satu untuk setiap subdirektori tes. </p><br><p>  Jika Anda belum melakukannya, Anda dapat mengunduh salinan kode sumber untuk proyek ini di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">situs web</a> buku.  Atau, Anda dapat mengerjakan proyek Anda dengan struktur yang sama. </p><br><p>  Inilah test_task.py: </p><br><blockquote>  <strong>ch2 / task_proj / test / unit / test_task.py</strong> </blockquote><br><pre> <code class="plaintext hljs">"""Test the Task data type.""" # -*- coding: utf-8 -*- from tasks import Task def test_asdict(): """_asdict()   .""" t_task = Task('do something', 'okken', True, 21) t_dict = t_task._asdict() expected = {'summary': 'do something', 'owner': 'okken', 'done': True, 'id': 21} assert t_dict == expected def test_replace(): """replace ()      .""" t_before = Task('finish book', 'brian', False) t_after = t_before._replace(id=10, done=True) t_expected = Task('finish book', 'brian', True, 10) assert t_after == t_expected def test_defaults(): """        .""" t1 = Task() t2 = Task(None, None, False, None) assert t1 == t2 def test_member_access(): """ .field  namedtuple.""" t = Task('buy milk', 'brian') assert t.summary == 'buy milk' assert t.owner == 'brian' assert (t.done, t.id) == (False, None)</code> </pre> <br><p>  File <em>test_task.py</em> berisi pernyataan impor ini: </p><br><pre> <code class="plaintext hljs">from tasks import Task</code> </pre> <br><p>  Cara terbaik untuk membiarkan tes mengimpor tugas atau mengimpor sesuatu dari tugas adalah menginstal tugas secara lokal menggunakan pip.  Ini dimungkinkan karena ada file setup.py untuk memanggil pip secara langsung. </p><br><p>  Instal tugas dengan menjalankan <code>pip install .</code>  atau <code>pip install -e .</code>  dari direktori task_proj.  Atau opsi lain untuk menjalankan <code>pip install -e tasks_proj</code> dari direktori satu tingkat lebih tinggi: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code $ pip install ./tasks_proj/ $ pip install --no-cache-dir ./tasks_proj/ Processing ./tasks_proj Collecting click (from tasks==0.1.0) Downloading click-6.7-py2.py3-none-any.whl (71kB) ... Collecting tinydb (from tasks==0.1.0) Downloading tinydb-3.4.0.tar.gz Collecting six (from tasks==0.1.0) Downloading six-1.10.0-py2.py3-none-any.whl Installing collected packages: click, tinydb, six, tasks Running setup.py install for tinydb ... done Running setup.py install for tasks ... done Successfully installed click-6.7 six-1.10.0 tasks-0.1.0 tinydb-3.4.0</code> </pre> <br><p>  Jika Anda hanya ingin menjalankan tes untuk tugas, perintah ini akan dilakukan.  Jika Anda ingin dapat mengubah kode sumber selama instalasi tugas, Anda perlu menggunakan instalasi dengan opsi -e (untuk "diedit" yang dapat diedit): </p><br><pre> <code class="plaintext hljs">$ pip install -e ./tasks_proj/ Obtaining file:///path/to/code/tasks_proj Requirement already satisfied: click in /path/to/venv/lib/python3.6/site-packages (from tasks==0.1.0) Requirement already satisfied: tinydb in /path/to/venv/lib/python3.6/site-packages (from tasks==0.1.0) Requirement already satisfied: six in /path/to/venv/lib/python3.6/site-packages (from tasks==0.1.0) Installing collected packages: tasks Found existing installation: tasks 0.1.0 Uninstalling tasks-0.1.0: Successfully uninstalled tasks-0.1.0 Running setup.py develop for tasks Successfully installed tasks</code> </pre> <br><p>  Sekarang coba jalankan tes: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch2/tasks_proj/tests/unit $ pytest test_task.py ===================== test session starts ====================== collected 4 items test_task.py .... =================== 4 passed in 0.01 seconds ===================</code> </pre> <br><p>  Impor telah berhasil!  Tes lain sekarang dapat dengan aman menggunakan tugas impor.  Sekarang mari kita menulis beberapa tes. </p><br><h2 id="ispolzovanie-operatorov-assert">  Menggunakan pernyataan tegas </h2><br><p>  Saat Anda menulis fungsi pengujian, pernyataan Python reguler adalah alat utama Anda untuk melaporkan kegagalan pengujian.  Kesederhanaan ini di pytest sangat brilian.  Inilah yang membuat banyak pengembang menggunakan pytest di atas kerangka kerja lainnya. </p><br><p>  Jika Anda menggunakan platform pengujian lain, Anda mungkin melihat berbagai fungsi pembantu yang menegaskan.  Misalnya, berikut ini adalah daftar beberapa bentuk fungsi pembantu dan penegasan: </p><br><div class="scrollable-table"><table><thead><tr><th>  <strong>pytest</strong> </th><th>  <strong>unittest</strong> </th></tr></thead><tbody><tr><td>  menegaskan sesuatu </td><td>  assertTrue (sesuatu) </td></tr><tr><td>  nyatakan a == b </td><td>  assertEqual (a, b) </td></tr><tr><td>  nyatakan a &lt;= b </td><td>  assertLessEqual (a, b) </td></tr><tr><td>  ... </td><td>  ... </td></tr></tbody></table></div><br><p>  Dengan pytest Anda dapat menggunakan menegaskan &lt;ekspresi&gt; dengan ekspresi apa pun.  Jika ekspresi dievaluasi menjadi False ketika dikonversi ke bool, tes akan gagal. </p><br><p>  pytest termasuk fungsi yang disebut penulisan ulang menegaskan yang memotong panggilan menegaskan dan menggantikannya dengan yang dapat memberi tahu Anda lebih banyak tentang mengapa laporan Anda gagal.  Mari kita lihat betapa bermanfaat penulisan ulang ini jika kita melihat beberapa kesalahan pernyataan: </p><br><blockquote>  <strong>ch2 / task_proj / test / unit / test_task_fail.py</strong> </blockquote><br><pre> <code class="plaintext hljs">""" the Task type    .""" from tasks import Task def test_task_equality(): """     .""" t1 = Task('sit there', 'brian') t2 = Task('do something', 'okken') assert t1 == t2 def test_dict_equality(): """ ,   dicts,    .""" t1_dict = Task('make sandwich', 'okken')._asdict() t2_dict = Task('make sandwich', 'okkem')._asdict() assert t1_dict == t2_dict</code> </pre> <br><p>  Semua tes ini gagal, tetapi informasi dalam penelusuran menarik: </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\unit&gt;pytest test_task_fail.py ============================= test session starts ============================= collected 2 items test_task_fail.py FF ================================== FAILURES =================================== _____________________________ test_task_equality ______________________________ def test_task_equality(): """Different tasks should not be equal.""" t1 = Task('sit there', 'brian') t2 = Task('do something', 'okken') &gt; assert t1 == t2 E AssertionError: assert Task(summary=...alse, id=None) == Task(summary='...alse, id=None) E At index 0 diff: 'sit there' != 'do something' E Use -v to get the full diff test_task_fail.py:9: AssertionError _____________________________ test_dict_equality ______________________________ def test_dict_equality(): """Different tasks compared as dicts should not be equal.""" t1_dict = Task('make sandwich', 'okken')._asdict() t2_dict = Task('make sandwich', 'okkem')._asdict() &gt; assert t1_dict == t2_dict E AssertionError: assert OrderedDict([...('id', None)]) == OrderedDict([(...('id', None)]) E Omitting 3 identical items, use -vv to show E Differing items: E {'owner': 'okken'} != {'owner': 'okkem'} E Use -v to get the full diff test_task_fail.py:16: AssertionError ========================== 2 failed in 0.30 seconds ===========================</code> </pre> <br><p>  Wow!  Ini banyak informasi.  Untuk setiap tes yang gagal, string kesalahan yang tepat ditampilkan dengan&gt; pointer kegagalan.  Baris E menunjukkan informasi tambahan tentang kegagalan yang tegas untuk membantu Anda memahami apa yang salah. </p><br><p>  Saya sengaja memasukkan dua ketidakcocokan dalam <code>test_task_equality()</code> , tetapi hanya yang pertama yang ditunjukkan dalam kode sebelumnya.  Mari kita coba lagi dengan flag <code>-v</code> , seperti yang disarankan dalam pesan kesalahan: </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\unit&gt;pytest -v test_task_fail.py ============================= test session starts ============================= collected 2 items test_task_fail.py::test_task_equality FAILED test_task_fail.py::test_dict_equality FAILED ================================== FAILURES =================================== _____________________________ test_task_equality ______________________________ def test_task_equality(): """Different tasks should not be equal.""" t1 = Task('sit there', 'brian') t2 = Task('do something', 'okken') &gt; assert t1 == t2 E AssertionError: assert Task(summary=...alse, id=None) == Task(summary='...alse, id=None) E At index 0 diff: 'sit there' != 'do something' E Full diff: E - Task(summary='sit there', owner='brian', done=False, id=None) E ? ^^^ ^^^ ^^^^ E + Task(summary='do something', owner='okken', done=False, id=None) E ? +++ ^^^ ^^^ ^^^^ test_task_fail.py:9: AssertionError _____________________________ test_dict_equality ______________________________ def test_dict_equality(): """Different tasks compared as dicts should not be equal.""" t1_dict = Task('make sandwich', 'okken')._asdict() t2_dict = Task('make sandwich', 'okkem')._asdict() &gt; assert t1_dict == t2_dict E AssertionError: assert OrderedDict([...('id', None)]) == OrderedDict([(...('id', None)]) E Omitting 3 identical items, use -vv to show E Differing items: E {'owner': 'okken'} != {'owner': 'okkem'} E Full diff: E {'summary': 'make sandwich', E - 'owner': 'okken', E ? ^... E E ...Full output truncated (5 lines hidden), use '-vv' to show test_task_fail.py:16: AssertionError ========================== 2 failed in 0.28 seconds ===========================</code> </pre> <br><p>  Yah, kurasa itu sangat keren!  pytest tidak hanya dapat menemukan kedua perbedaan, tetapi juga menunjukkan kepada kita di mana perbedaan-perbedaan ini berada.  Contoh ini hanya menggunakan pernyataan kesetaraan;  Anda dapat menemukan lebih banyak variasi pernyataan pernyataan di pytest.org dengan informasi debugging jejak yang menakjubkan. </p><br><h2 id="ozhidanie-isklyucheniy-expected-exception">  Pengecualian yang diharapkan </h2><br><p>  Pengecualian dapat terjadi di beberapa tempat di API Tugas.  Mari kita lihat fungsi-fungsi yang ditemukan di <em>task / api.py</em> : </p><br><pre> <code class="plaintext hljs">def add(task): # type: (Task) -\&gt; int def get(task_id): # type: (int) -\&gt; Task def list_tasks(owner=None): # type: (str|None) -\&gt; list of Task def count(): # type: (None) -\&gt; int def update(task_id, task): # type: (int, Task) -\&gt; None def delete(task_id): # type: (int) -\&gt; None def delete_all(): # type: () -\&gt; None def unique_id(): # type: () -\&gt; int def start_tasks_db(db_path, db_type): # type: (str, str) -\&gt; None def stop_tasks_db(): # type: () -\&gt; None</code> </pre> <br><p>  Ada kesepakatan antara kode CLI di <em>cli.py</em> dan kode API di <em>api.py</em> mengenai jenis apa yang akan diteruskan ke fungsi API.  Panggilan API adalah tempat saya perkirakan pengecualian akan dimunculkan jika jenisnya salah.  Untuk memastikan bahwa fungsi-fungsi ini membuang pengecualian jika mereka tidak dipanggil dengan benar, gunakan tipe yang salah dalam fungsi tes untuk secara sengaja membuang pengecualian TypeError dan gunakan dengan pytest.raises (pengecualian yang diharapkan), misalnya: </p><br><blockquote>  <strong>ch2 / task_proj / tests / func / test_api_exceptions.py</strong> </blockquote><br><pre> <code class="plaintext hljs">"""    -   API.""" import pytest import tasks def test_add_raises(): """add()       param.""" with pytest.raises(TypeError): tasks.add(task='not a Task object')</code> </pre> <br><p>  Di <code>test_add_raises()</code> , dengan <code>pytest.raises(TypeError)</code> : pernyataan melaporkan bahwa segala sesuatu di blok kode berikutnya harus membuang pengecualian TypeError.  Jika pengecualian tidak dinaikkan, tes gagal.  Jika tes menimbulkan pengecualian lain, itu gagal. </p><br><p>  Kami baru saja memeriksa jenis pengecualian di <code>test_add_raises()</code> .  Anda juga dapat memeriksa opsi pengecualian.  Untuk <code>start_tasks_db(db_path, db_type)</code> , bukan hanya <em>db_type yang</em> harus berupa string, itu harus berupa 'mungil' atau 'mongo'.  Anda dapat memeriksa untuk memastikan pesan pengecualian sudah benar dengan menambahkan excinfo: </p><br><blockquote>  <strong>ch2 / task_proj / tests / func / test_api_exceptions.py</strong> </blockquote><br><pre> <code class="plaintext hljs">def test_start_tasks_db_raises(): """,     .""" with pytest.raises(ValueError) as excinfo: tasks.start_tasks_db('some/great/path', 'mysql') exception_msg = excinfo.value.args[0] assert exception_msg == "db_type must be a 'tiny' or 'mongo'"</code> </pre> <br><p>  Ini memungkinkan kita untuk melihat lebih dekat pada pengecualian ini.  Nama variabel after as (dalam hal ini, excinfo) diisi dengan informasi pengecualian dan bertipe ExceptionInfo. </p><br><p>  Dalam kasus kami, kami ingin memastikan bahwa parameter pengecualian pertama (dan hanya) cocok dengan string. </p><br><h2 id="marking-test-functions">  Menandai fungsi tes </h2><br><p>  pytest menyediakan mekanisme keren untuk menempatkan marker pada fungsi pengujian.  Suatu tes dapat memiliki lebih dari satu marker, dan sebuah marker dapat dalam beberapa tes. </p><br><p>  Penanda akan masuk akal bagi Anda setelah Anda melihat mereka beraksi.  Misalkan kita ingin menjalankan subset dari tes kita sebagai "tes asap" cepat untuk mendapatkan gambaran apakah ada celah serius dalam sistem.  Secara konvensional, tes Smoke tidak komprehensif, suite tes menyeluruh, tetapi subset terpilih yang dapat Anda jalankan dengan cepat dan memberikan pengembang gambar yang layak tentang kesehatan semua bagian sistem. </p><br><p>  Untuk menambahkan suite tes asap ke proyek Tugas Anda, Anda perlu menambahkan <code>@mark.pytest.smoke</code> untuk beberapa tes.  Mari kita tambahkan ke beberapa <code>test_api_exceptions.py</code> tes (perhatikan bahwa <em>asap</em> dan spidol tidak dibangun ke pytest; saya baru saja datang dengan mereka): </p><br><blockquote>  <strong>ch2 / task_proj / tests / func / test_api_exceptions.py</strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.mark.smoke def test_list_raises(): """list()       param.""" with pytest.raises(TypeError): tasks.list_tasks(owner=123) @pytest.mark.get @pytest.mark.smoke def test_get_raises(): """get()       param.""" with pytest.raises(TypeError): tasks.get(task_id='123')</code> </pre> <br><p>  Sekarang mari kita jalankan hanya tes-tes yang ditandai dengan <code>-m marker_name</code> : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests&gt;cd func (venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v -m "smoke" test_api_exceptions.py ============================= test session starts ============================= collected 7 items test_api_exceptions.py::test_list_raises PASSED test_api_exceptions.py::test_get_raises PASSED ============================= 5 tests deselected ============================== =================== 2 passed, 5 deselected in 0.18 seconds ==================== (venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt; (venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v -m "get" test_api_exceptions.py ============================= test session starts ============================= collected 7 items test_api_exceptions.py::test_get_raises PASSED ============================= 6 tests deselected ============================== =================== 1 passed, 6 deselected in 0.13 seconds ====================</code> </pre> <br><p>  Ingat bahwa <code>-v</code> kependekan dari <code>--verbose</code> dan memungkinkan kita untuk melihat nama-nama tes yang sedang berjalan.  Menggunakan -m 'smoke' menjalankan kedua pengujian, berlabel @ pytest.mark.smoke. </p><br><p>  Menggunakan <code>-m</code> 'get' akan menjalankan satu tes bertanda <code>@pytest.mark.get</code> .  Cukup sederhana. </p><br><p>  Semuanya menjadi mukjizat dan mukjizat!  Ekspresi setelah <code>-m</code> dapat menggunakan <code>and</code> , <code>or</code> dan <code>not</code> menggabungkan beberapa penanda: </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v -m "smoke and get" test_api_exceptions.py ============================= test session starts ============================= collected 7 items test_api_exceptions.py::test_get_raises PASSED ============================= 6 tests deselected ============================== =================== 1 passed, 6 deselected in 0.13 seconds ====================</code> </pre> <br><p>  Kami melakukan tes ini hanya dengan <code>smoke</code> dan <code>get</code> spidol.  Kita tidak bisa menggunakan: </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v -m "smoke and not get" test_api_exceptions.py ============================= test session starts ============================= collected 7 items test_api_exceptions.py::test_list_raises PASSED ============================= 6 tests deselected ============================== =================== 1 passed, 6 deselected in 0.13 seconds ====================</code> </pre> <br><p>  Menambahkan <code>-m 'smoke and not get'</code> dipilih tes yang ditandai dengan <code>@pytest.mark.smoke</code> tetapi tidak <code>@pytest.mark.get</code> . </p><br><h3 id="zapolnenie-smoke-test">  Isi Tes Asap </h3><br><p>  Tes sebelumnya belum tampak seperti <code>smoke test</code> masuk akal.  Kami sebenarnya tidak menyentuh database dan tidak menambahkan tugas apa pun.  Tentu saja <code>smoke test</code> harus melakukan ini. </p><br><p>  Mari kita tambahkan beberapa tes yang mempertimbangkan untuk menambah tugas, dan gunakan salah satunya sebagai bagian dari rangkaian tes <em>asap</em> kami: </p><br><blockquote>  <strong>ch2 / task_proj / tests / func / test_add.py</strong> </blockquote><br><pre> <code class="plaintext hljs">"""  API tasks.add ().""" import pytest import tasks from tasks import Task def test_add_returns_valid_id(): """tasks.add(valid task)    .""" # GIVEN an initialized tasks db # WHEN a new task is added # THEN returned task_id is of type int new_task = Task('do something') task_id = tasks.add(new_task) assert isinstance(task_id, int) @pytest.mark.smoke def test_added_task_has_id_set(): """,   task_id  tasks.add().""" # GIVEN an initialized tasks db # AND a new task is added new_task = Task('sit in chair', owner='me', done=True) task_id = tasks.add(new_task) # WHEN task is retrieved task_from_db = tasks.get(task_id) # THEN task_id matches id field assert task_from_db.id == task_id</code> </pre> <br><p>  Kedua tes ini memiliki komentar GIVEN pada database tugas yang diinisialisasi, tetapi tidak ada database yang diinisialisasi dalam tes.  Kita dapat mendefinisikan fixture untuk menginisialisasi database sebelum tes dan membersihkan setelah tes: </p><br><blockquote>  <strong>ch2 / task_proj / tests / func / test_add.py</strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.fixture(autouse=True) def initialized_tasks_db(tmpdir): """Connect to db before testing, disconnect after.""" # Setup : start db tasks.start_tasks_db(str(tmpdir), 'tiny') yield #    # Teardown : stop db tasks.stop_tasks_db()</code> </pre> <br><p>  Fixture, tmpdir yang digunakan dalam contoh ini, adalah fixture bawaan.  Anda akan mempelajari semua tentang perlengkapan bawaan di Bab 4, Perlengkapan Terpasang, di halaman 71, dan Anda akan belajar cara menulis perlengkapan Anda sendiri dan cara kerjanya di Bab 3, Perlengkapan terbaik, di halaman 49, termasuk parameter pemadaman yang digunakan di sini. </p><br><p>  Autouse yang digunakan dalam pengujian kami menunjukkan bahwa semua tes dalam file ini akan menggunakan fixture.  Kode sebelum <code>yield</code> dijalankan sebelum setiap tes;  kode setelah <code>yield</code> dieksekusi setelah pengujian.  Jika diinginkan, hasil dapat mengembalikan data ke tes.  Anda akan mempertimbangkan semua ini dan banyak lagi di bab-bab berikut, tetapi di sini kita perlu mengkonfigurasi database untuk pengujian, jadi saya tidak bisa lagi menunggu dan harus menunjukkan perangkat ini kepada Anda (fixture tentunya!).  (pytest juga mendukung pengaturan kuno dan fungsi teardown, seperti yang digunakan di <strong>unittest</strong> dan <strong>hidung</strong> , tetapi mereka tidak begitu menarik. Namun, jika Anda tertarik, mereka dijelaskan dalam Lampiran 5, xUnit Fixtures, di halaman 183.) </p><br><p>  Mari kita tunda pembahasan jadwal pertandingan untuk saat ini dan pergi ke awal proyek dan menjalankan <em>uji asap</em> kami: </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;cd .. (venv33) ...\bopytest-code\code\ch2\tasks_proj\tests&gt;cd .. (venv33) ...\bopytest-code\code\ch2\tasks_proj&gt;pytest -v -m "smoke" ============================= test session starts ============================= collected 56 items tests/func/test_add.py::test_added_task_has_id_set PASSED tests/func/test_api_exceptions.py::test_list_raises PASSED tests/func/test_api_exceptions.py::test_get_raises PASSED ============================= 53 tests deselected ============================= =================== 3 passed, 53 deselected in 0.49 seconds ===================</code> </pre> <br><p>  Ini menunjukkan bahwa tes yang ditandai dari file yang berbeda dapat berjalan bersama. </p><br><h2 id="propusk-testov-skipping-tests">  Melewati Tes </h2><br><p>  Meskipun penanda yang dibahas dalam menandai metode verifikasi pada halaman 31 adalah nama-nama pilihan Anda, pytest menyertakan beberapa penanda <code>skipif</code> : <code>skip</code> , <code>skipif</code> , dan <code>xfail</code> .  Di bagian ini saya akan berbicara tentang <code>skip</code> dan <code>skipif</code> , dan di <code>-xfail</code> berikutnya. </p><br><p>  <code>skipif</code> <code>skip</code> dan <code>skipif</code> memungkinkan Anda untuk melewati tes yang tidak perlu dilakukan.  Misalnya, katakanlah kita tidak tahu bagaimana <code>tasks.unique_id()</code> harus berfungsi.  Setiap panggilan harus mengembalikan nomor yang berbeda?    ,       ? </p><br><p> -,    (,        <code>initialized_tasks_db</code> ;     ): </p><br><blockquote> <strong>ch2/tasks_proj/tests/func/ <code>test_unique_id_1.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">"""Test tasks.unique_id().""" import pytest import tasks def test_unique_id(): """ unique_id ()     .""" id_1 = tasks.unique_id() id_2 = tasks.unique_id() assert id_1 != id_2</code> </pre> <br><p>    : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest test_unique_id_1.py ============================= test session starts ============================= collected 1 item test_unique_id_1.py F ================================== FAILURES =================================== _______________________________ test_unique_id ________________________________ def test_unique_id(): """Calling unique_id() twice should return different numbers.""" id_1 = tasks.unique_id() id_2 = tasks.unique_id() &gt; assert id_1 != id_2 E assert 1 != 1 test_unique_id_1.py:11: AssertionError ========================== 1 failed in 0.30 seconds ===========================</code> </pre> <br><p>  Hm  ,  .   API  ,  ,  docstring  """Return an integer that does not exist in the db.""",   <em>  ,     DB</em> .      .       ,   : </p><br><blockquote> <strong>ch2/tasks_proj/tests/func/ <code>test_unique_id_2.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.mark.skip(reason='misunderstood the API') def test_unique_id_1(): """ unique_id ()     .""" id_1 = tasks.unique_id() id_2 = tasks.unique_id() assert id_1 != id_2 def test_unique_id_2(): """unique_id()    id.""" ids = [] ids.append(tasks.add(Task('one'))) ids.append(tasks.add(Task('two'))) ids.append(tasks.add(Task('three'))) #   id uid = tasks.unique_id() # ,        assert uid not in ids</code> </pre> <br><p>  ,   ,   ,   <code>@pytest..skip()</code>    . </p><br><p>  : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v test_unique_id_2.py ============================= test session starts ============================= collected 2 items test_unique_id_2.py::test_unique_id_1 SKIPPED test_unique_id_2.py::test_unique_id_2 PASSED ===================== 1 passed, 1 skipped in 0.19 seconds =====================</code> </pre> <br><p>  ,   -   ,       ,         0.2.0 .           skipif: </p><br><blockquote> <strong>ch2/tasks_proj/tests/func/ <code>test_unique_id_3.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.mark.skipif(tasks.__version__ &lt; '0.2.0', reason='not supported until version 0.2.0') def test_unique_id_1(): """ unique_id ()     .""" id_1 = tasks.unique_id() id_2 = tasks.unique_id() assert id_1 != id_2</code> </pre> <br><p> ,     <code>skipif()</code> ,      Python.   ,  ,    .      <em>skip</em> ,    <em>skipif</em> .     <em>skip</em> ,     <em>skipif</em> .      ( <em>reason</em> )   <em>skip</em> , <em>skipif</em>  <em>xfail</em> .    : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest test_unique_id_3.py ============================= test session starts ============================= collected 2 items test_unique_id_3.py s. ===================== 1 passed, 1 skipped in 0.20 seconds =====================</code> </pre> <br><p> <code>s.</code> ,     (skipped),    (passed).   ,    -  <code>-v</code> : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v test_unique_id_3.py ============================= test session starts ============================= collected 2 items test_unique_id_3.py::test_unique_id_1 SKIPPED test_unique_id_3.py::test_unique_id_2 PASSED ===================== 1 passed, 1 skipped in 0.19 seconds =====================</code> </pre> <br><p>       .        <code>-rs</code> : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -rs test_unique_id_3.py ============================= test session starts ============================= collected 2 items test_unique_id_3.py s. =========================== short test summary info =========================== SKIP [1] func\test_unique_id_3.py:8: not supported until version 0.2.0 ===================== 1 passed, 1 skipped in 0.22 seconds =====================</code> </pre> <br><p>  <code>-r chars</code>    : </p><br><pre> <code class="plaintext hljs">$ pytest --help ... -r chars show extra test summary info as specified by chars (     ,  ) (f)ailed, (E)error, (s)skipped, (x)failed, (X)passed, (p)passed, (P)passed with output, (a)all except pP. ...</code> </pre> <br><p>        ,           . </p><br><h2 id="markirovka-testov-ozhidayuschih-sboya">     </h2><br><p>    <code>skip</code>  <code>skipif</code>    ,   .    <code>xfail</code>   pytest   ,  ,    .     <code>unique_id ()</code> ,   <code>xfail</code> : </p><br><blockquote> <strong>ch2/tasks_proj/tests/func/ <code>test_unique_id_4.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.mark.xfail(tasks.__version__ &lt; '0.2.0', reason='not supported until version 0.2.0') def test_unique_id_1(): """ unique_id()     .""" id_1 = tasks.unique_id() id_2 = tasks.unique_id() assert id_1 != id_2 @pytest.mark.xfail() def test_unique_id_is_a_duck(): """ xfail.""" uid = tasks.unique_id() assert uid == 'a duck' @pytest.mark.xfail() def test_unique_id_not_a_duck(): """ xpass.""" uid = tasks.unique_id() assert uid != 'a duck'</code> </pre> <br><p> Running this shows: </p><br><p>    ,   ,   <code>xfail</code> .         == vs.! =.      . </p><br><p>   : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest test_unique_id_4.py ============================= test session starts ============================= collected 4 items test_unique_id_4.py xxX. =============== 1 passed, 2 xfailed, 1 xpassed in 0.36 seconds ================</code> </pre> <br><p> X  XFAIL,   «  ( <em>expected to fail</em> )».  X   XPASS  «,    ,   ( <em>expected to fail but passed.</em> )». </p><br><p> <code>--verbose</code>    : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v test_unique_id_4.py ============================= test session starts ============================= collected 4 items test_unique_id_4.py::test_unique_id_1 xfail test_unique_id_4.py::test_unique_id_is_a_duck xfail test_unique_id_4.py::test_unique_id_not_a_duck XPASS test_unique_id_4.py::test_unique_id_2 PASSED =============== 1 passed, 2 xfailed, 1 xpassed in 0.36 seconds ================</code> </pre> <br><p>    <em>pytest</em> ,  ,  ,    <code>xfail</code> ,   FAIL.    <em>pytest.ini</em> : </p><br><pre> <code class="plaintext hljs">[pytest] xfail_strict=true</code> </pre> <br><p>    <em>pytest.ini</em>    6, ,  . 113. </p><br><h2 id="vypolnenie-podmnozhestva-testov">    </h2><br><p>    ,         ​​    .       .        , ,          .      ,       .        .    . </p><br><h3 id="a-single-directory"> A Single Directory </h3><br><p>       ,      <em>pytest</em> : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj&gt;pytest tests\func --tb=no ============================= test session starts ============================= collected 50 items tests\func\test_add.py .. tests\func\test_add_variety.py ................................ tests\func\test_api_exceptions.py ....... tests\func\test_unique_id_1.py F tests\func\test_unique_id_2.py s. tests\func\test_unique_id_3.py s. tests\func\test_unique_id_4.py xxX. ==== 1 failed, 44 passed, 2 skipped, 2 xfailed, 1 xpassed in 1.75 seconds =====</code> </pre> <br><p>     ,   <code>-v</code>      ,   . </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj&gt;pytest -v tests\func --tb=no ============================= test session starts =============================</code> </pre> <br><p>  ... </p><br><pre> <code class="plaintext hljs">collected 50 items tests\func\test_add.py::test_add_returns_valid_id PASSED tests\func\test_add.py::test_added_task_has_id_set PASSED tests\func\test_add_variety.py::test_add_1 PASSED tests\func\test_add_variety.py::test_add_2[task0] PASSED tests\func\test_add_variety.py::test_add_2[task1] PASSED tests\func\test_add_variety.py::test_add_2[task2] PASSED tests\func\test_add_variety.py::test_add_2[task3] PASSED tests\func\test_add_variety.py::test_add_3[sleep-None-False] PASSED ... tests\func\test_unique_id_2.py::test_unique_id_1 SKIPPED tests\func\test_unique_id_2.py::test_unique_id_2 PASSED ... tests\func\test_unique_id_4.py::test_unique_id_1 xfail tests\func\test_unique_id_4.py::test_unique_id_is_a_duck xfail tests\func\test_unique_id_4.py::test_unique_id_not_a_duck XPASS tests\func\test_unique_id_4.py::test_unique_id_2 PASSED ==== 1 failed, 44 passed, 2 skipped, 2 xfailed, 1 xpassed in 2.05 seconds =====</code> </pre> <br><p>   ,      . </p><br><h3 id="odinochnyy-test-filemodule">   File/Module </h3><br><p>   ,  ,          pytest: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch2/tasks_proj $ pytest tests/func/test_add.py =========================== test session starts =========================== collected 2 items tests/func/test_add.py .. ======================== 2 passed in 0.05 seconds =========================</code> </pre> <br><p>        . </p><br><h3 id="odinochnaya-testovaya-funkciya">    </h3><br><p>     ,  <code>::</code>    : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch2/tasks_proj $ pytest -v tests/func/test_add.py::test_add_returns_valid_id =========================== test session starts =========================== collected 3 items tests/func/test_add.py::test_add_returns_valid_id PASSED ======================== 1 passed in 0.02 seconds =========================</code> </pre> <br><p>  <code>-v</code> ,  ,    . </p><br><h3 id="odinochnyy-test-class">  Test Class </h3><br><p> Here's an example: </p><br><p>   —    ,     . <br>  Berikut ini sebuah contoh: </p><br><blockquote> <strong>ch2/tasks_proj/tests/func/</strong> <code>test_api_exceptions.py</code> </blockquote><br><pre> <code class="plaintext hljs">class TestUpdate(): """    tasks.update().""" def test_bad_id(self): """non-int id   excption.""" with pytest.raises(TypeError): tasks.update(task_id={'dict instead': 1}, task=tasks.Task()) def test_bad_task(self): """A non-Task task   excption.""" with pytest.raises(TypeError): tasks.update(task_id=1, task='not a task')</code> </pre> <br><p>      ,     <code>update()</code> ,     .     ,   ,        <code>::</code> ,      : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj&gt;pytest -v tests/func/test_api_exceptions.py::TestUpdate ============================= test session starts ============================= collected 2 items tests\func\test_api_exceptions.py::TestUpdate::test_bad_id PASSED tests\func\test_api_exceptions.py::TestUpdate::test_bad_task PASSED ========================== 2 passed in 0.12 seconds ===========================</code> </pre> <br><h3 id="a-single-test-method-of-a-test-class"> A Single Test Method of a Test Class </h3><br><p>        ,     —     <code>::</code>   : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch2/tasks_proj $ pytest -v tests/func/test_api_exceptions.py::TestUpdate::test_bad_id ===================== test session starts ====================== collected 1 item tests/func/test_api_exceptions.py::TestUpdate::test_bad_id PASSED =================== 1 passed in 0.03 seconds ===================</code> </pre> <br><blockquote> <strong> ,   </strong> <br><br> ,        , , ,      .   ,        <code>pytest -v</code> . </blockquote><br><h3 id="nabor-testov-na-osnove-bazovogo-imeni-testa">        </h3><br><p>  <code>-k</code>      ,         .       <code>and</code> , <code>or</code>  <code>not</code>  . ,        <code>_raises</code> : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj&gt;pytest -v -k _raises ============================= test session starts ============================= collected 56 items tests/func/test_api_exceptions.py::test_add_raises PASSED tests/func/test_api_exceptions.py::test_list_raises PASSED tests/func/test_api_exceptions.py::test_get_raises PASSED tests/func/test_api_exceptions.py::test_delete_raises PASSED tests/func/test_api_exceptions.py::test_start_tasks_db_raises PASSED ============================= 51 tests deselected ============================= =================== 5 passed, 51 deselected in 0.54 seconds ===================</code> </pre> <br><p>    <code>and</code>  <code>not</code>    <code>test_delete_raises()</code>  : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj&gt;pytest -v -k "_raises and not delete" ============================= test session starts ============================= collected 56 items tests/func/test_api_exceptions.py::test_add_raises PASSED tests/func/test_api_exceptions.py::test_list_raises PASSED tests/func/test_api_exceptions.py::test_get_raises PASSED tests/func/test_api_exceptions.py::test_start_tasks_db_raises PASSED ============================= 52 tests deselected ============================= =================== 4 passed, 52 deselected in 0.44 seconds ===================</code> </pre> <br><p>     ,     , ,         <code>-k</code>     .     ,          ,         . </p><br><h2 id="parametrized-testing-parametrizovannoe-testirovanie"> [Parametrized Testing]:   </h2><br><p>         ,     ,       .                  .  -               pytest,  -    . </p><br><p>    ,     ,      <code>add()</code> : </p><br><blockquote> <strong>ch2/tasks_proj/tests/func/ <code>test_add_variety.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">"""  API tasks.add().""" import pytest import tasks from tasks import Task def test_add_1(): """tasks.get ()  id,   add() works.""" task = Task('breathe', 'BRIAN', True) task_id = tasks.add(task) t_from_db = tasks.get(task_id) # ,  ,    assert equivalent(t_from_db, task) def equivalent(t1, t2): """   .""" #  ,   id return ((t1.summary == t2.summary) and (t1.owner == t2.owner) and (t1.done == t2.done)) @pytest.fixture(autouse=True) def initialized_tasks_db(tmpdir): """    ,  .""" tasks.start_tasks_db(str(tmpdir), 'tiny') yield tasks.stop_tasks_db()</code> </pre> <br><p>    tasks   <code>id</code>   <code>None</code> .           <code>id</code> .       <code>==</code> ,  ,        .   <code>equivalent()</code>  ,   <code>id</code> .  <code>autouse</code> ,  ,    .  ,   : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v test_add_variety.py::test_add_1 ============================= test session starts ============================= collected 1 item test_add_variety.py::test_add_1 PASSED ========================== 1 passed in 0.69 seconds ===========================</code> </pre> <br><p>   .   ,      .  ,       ?  .    <code>@pytest.mark.parametrize(argnames, argvalues)</code>          , : </p><br><blockquote> <strong>ch2/tasks_proj/tests/func/ <code>test_add_variety.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.mark.parametrize('task', [Task('sleep', done=True), Task('wake', 'brian'), Task('breathe', 'BRIAN', True), Task('exercise', 'BrIaN', False)]) def test_add_2(task): """    .""" task_id = tasks.add(task) t_from_db = tasks.get(task_id) assert equivalent(t_from_db, task)</code> </pre> <br><p>   <code>parametrize()</code> —        — 'task',   .   —   ,         Task. pytest               : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v test_add_variety.py::test_add_2 ============================= test session starts ============================= collected 4 items test_add_variety.py::test_add_2[task0] PASSED test_add_variety.py::test_add_2[task1] PASSED test_add_variety.py::test_add_2[task2] PASSED test_add_variety.py::test_add_2[task3] PASSED ========================== 4 passed in 0.69 seconds ===========================</code> </pre> <br><p>  <code>parametrize()</code>    .      ,  ,      : </p><br><blockquote> <strong>ch2/tasks_proj/tests/func/ <code>test_add_variety.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.mark.parametrize('summary, owner, done', [('sleep', None, False), ('wake', 'brian', False), ('breathe', 'BRIAN', True), ('eat eggs', 'BrIaN', False), ]) def test_add_3(summary, owner, done): """    .""" task = Task(summary, owner, done) task_id = tasks.add(task) t_from_db = tasks.get(task_id) assert equivalent(t_from_db, task)</code> </pre> <br><p>   ,        pytest,       ,      : </p><br><pre> <code class="plaintext hljs">(venv35) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v test_add_variety.py::test_add_3 ============================= test session starts ============================= platform win32 -- Python 3.5.2, pytest-3.5.1, py-1.5.3, pluggy-0.6.0 -- cachedir: ..\.pytest_cache rootdir: ...\bopytest-code\code\ch2\tasks_proj\tests, inifile: pytest.ini collected 4 items test_add_variety.py::test_add_3[sleep-None-False] PASSED [ 25%] test_add_variety.py::test_add_3[wake-brian-False] PASSED [ 50%] test_add_variety.py::test_add_3[breathe-BRIAN-True] PASSED [ 75%] test_add_variety.py::test_add_3[eat eggs-BrIaN-False] PASSED [100%] ========================== 4 passed in 0.37 seconds ===========================</code> </pre> <br><p>  ,      ,     pytest,    : </p><br><pre> <code class="plaintext hljs">(venv35) c:\BOOK\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v test_add_variety.py::test_add_3[sleep-None-False] ============================= test session starts ============================= test_add_variety.py::test_add_3[sleep-None-False] PASSED [100%] ========================== 1 passed in 0.22 seconds ===========================</code> </pre> <br><p>   ,     : </p><br><pre> <code class="plaintext hljs">(venv35) c:\BOOK\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v "test_add_variety.py::test_add_3[eat eggs-BrIaN-False]" ============================= test session starts ============================= collected 1 item test_add_variety.py::test_add_3[eat eggs-BrIaN-False] PASSED [100%] ========================== 1 passed in 0.56 seconds ===========================</code> </pre> <br><p>      ,        : </p><br><blockquote> <strong>ch2/tasks_proj/tests/func/ <code>test_add_variety.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">tasks_to_try = (Task('sleep', done=True), Task('wake', 'brian'), Task('wake', 'brian'), Task('breathe', 'BRIAN', True), Task('exercise', 'BrIaN', False)) @pytest.mark.parametrize('task', tasks_to_try) def test_add_4(task): """ .""" task_id = tasks.add(task) t_from_db = tasks.get(task_id) assert equivalent(t_from_db, task)</code> </pre> <br><p>      .     : </p><br><pre> <code class="plaintext hljs">(venv35) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v test_add_variety.py::test_add_4 ============================= test session starts ============================= collected 5 items test_add_variety.py::test_add_4[task0] PASSED [ 20%] test_add_variety.py::test_add_4[task1] PASSED [ 40%] test_add_variety.py::test_add_4[task2] PASSED [ 60%] test_add_variety.py::test_add_4[task3] PASSED [ 80%] test_add_variety.py::test_add_4[task4] PASSED [100%] ========================== 5 passed in 0.34 seconds ===========================</code> </pre> <br><p>      ,     .    ,      ids  <code>parametrize()</code> ,          .  <code>ids</code>       ,     . ,         <code>tasks_to_try</code> ,       : </p><br><blockquote> <strong>ch2/tasks_proj/tests/func/ <code>test_add_variety.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">task_ids = ['Task({},{},{})'.format(t.summary, t.owner, t.done) for t in tasks_to_try] @pytest.mark.parametrize('task', tasks_to_try, ids=task_ids) def test_add_5(task): """Demonstrate ids.""" task_id = tasks.add(task) t_from_db = tasks.get(task_id) assert equivalent(t_from_db, task)</code> </pre> <br><p>     ,   : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v test_add_variety.py::test_add_5 ============================= test session starts ============================= collected 5 items test_add_variety.py::test_add_5[Task(sleep,None,True)] PASSED test_add_variety.py::test_add_5[Task(wake,brian,False)0] PASSED test_add_variety.py::test_add_5[Task(wake,brian,False)1] PASSED test_add_variety.py::test_add_5[Task(breathe,BRIAN,True)] PASSED test_add_variety.py::test_add_5[Task(exercise,BrIaN,False)] PASSED ========================== 5 passed in 0.45 seconds ===========================</code> </pre> <br><p>        : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v "test_add_variety.py::test_add_5[Task(exercise,BrIaN,False)]" ============================= test session starts ============================= collected 1 item test_add_variety.py::test_add_5[Task(exercise,BrIaN,False)] PASSED ========================== 1 passed in 0.21 seconds ===========================</code> </pre> <br><p>       ;          shell.     <code>parametrize()</code>  .               : </p><br><blockquote> <strong>ch2/tasks_proj/tests/func/ <code>test_add_variety.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.mark.parametrize('task', tasks_to_try, ids=task_ids) class TestAdd(): """   .""" def test_equivalent(self, task): """ ,   .""" task_id = tasks.add(task) t_from_db = tasks.get(task_id) assert equivalent(t_from_db, task) def test_valid_id(self, task): """          .""" task_id = tasks.add(task) t_from_db = tasks.get(task_id) assert t_from_db.id == task_id</code> </pre> <br><p>    : </p><br><pre> <code class="plaintext hljs">(venv33) ...\bopytest-code\code\ch2\tasks_proj\tests\func&gt;pytest -v test_add_variety.py::TestAdd ============================= test session starts ============================= collected 10 items test_add_variety.py::TestAdd::test_equivalent[Task(sleep,None,True)] PASSED test_add_variety.py::TestAdd::test_equivalent[Task(wake,brian,False)0] PASSED test_add_variety.py::TestAdd::test_equivalent[Task(wake,brian,False)1] PASSED test_add_variety.py::TestAdd::test_equivalent[Task(breathe,BRIAN,True)] PASSED test_add_variety.py::TestAdd::test_equivalent[Task(exercise,BrIaN,False)] PASSED test_add_variety.py::TestAdd::test_valid_id[Task(sleep,None,True)] PASSED test_add_variety.py::TestAdd::test_valid_id[Task(wake,brian,False)0] PASSED test_add_variety.py::TestAdd::test_valid_id[Task(wake,brian,False)1] PASSED test_add_variety.py::TestAdd::test_valid_id[Task(breathe,BRIAN,True)] PASSED test_add_variety.py::TestAdd::test_valid_id[Task(exercise,BrIaN,False)] PASSED ========================== 10 passed in 1.16 seconds ==========================</code> </pre> <br><p>     ,            <code>@pytest.mark.parametrize()</code> .       <code>pytest.param(&lt;value\&gt;, id="something")</code> : </p><br><p>  : </p><br><pre> <code class="plaintext hljs">(venv35) ...\bopytest-code\code\ch2\tasks_proj\tests\func $ pytest -v test_add_variety.py::test_add_6 ======================================== test session starts ========================================= collected 3 items test_add_variety.py::test_add_6[just summary] PASSED [ 33%] test_add_variety.py::test_add_6[summary\owner] PASSED [ 66%] test_add_variety.py::test_add_6[summary\owner\done] PASSED [100%] ================================ 3 passed, 6 warnings in 0.35 seconds ================================</code> </pre> <br><p>  ,  <code>id</code>       . </p><br><h2 id="uprazhneniya">  Latihan </h2><br><ol><li>     , <code>task_proj</code> ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">-  </a>  ,         <code>pip install /path/to/tasks_proj</code> . </li><li>   . </li><li>  <em>pytest</em>   . </li><li>  <em>pytest</em>   ,  <code>tasks_proj/tests/func</code> .  pytest     ,     .     .  ,    ? </li><li>  xfail      ,     pytest   tests    . </li><li>      <code>tasks.count()</code> ,   .    API  ,     ,  ,    . </li><li>          ?       <code>test_api_exceptions.py</code> . ,      . (   <code>api.py</code>   .) </li></ol><br><h2 id="chto-dalshe">  Apa selanjutnya </h2><br><p>         <em>pytest</em> . ,   ,   ,       .         <code>initialized_tasks_db</code> .     /        . </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mereka juga dapat memisahkan kode umum sehingga beberapa fungsi pengujian dapat menggunakan pengaturan yang sama. </font><font style="vertical-align: inherit;">Dalam bab berikutnya, Anda akan terjun jauh ke dunia pytest yang indah.</font></font></p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kembali</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Selanjutnya</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id448788/">https://habr.com/ru/post/id448788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id448776/index.html">RxVMS - Arsitektur Praktis untuk Aplikasi Flutter</a></li>
<li><a href="../id448778/index.html">Memperkenalkan Debugging Perjalanan Waktu untuk Visual Studio Enterprise 2019</a></li>
<li><a href="../id448780/index.html">Apa yang memberi perangkat lunak untuk merekrut uang</a></li>
<li><a href="../id448784/index.html">Fitur baru untuk penulis ekstensi di Visual Studio 2019 versi 16.1</a></li>
<li><a href="../id448786/index.html">Pengujian Python dengan pytest. BAB 3 Jadwal Terbaik</a></li>
<li><a href="../id448792/index.html">Pengujian Python dengan pytest. Perlengkapan Bawaan, Bab 4</a></li>
<li><a href="../id448796/index.html">Pengujian Python dengan pytest. Konfigurasi, BAB 6</a></li>
<li><a href="../id448798/index.html">Pengujian Python dengan pytest. Menggunakan pytest dengan alat lain, BAB 7</a></li>
<li><a href="../id448800/index.html">Konfigurasikan Visual Studio di seluruh organisasi Anda dengan .vsconfig</a></li>
<li><a href="../id448802/index.html">Berpikir dengan Portal: membuat portal di Unreal Engine 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>