<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ùî üçà üëö Microintera√ß√µes no iOS. Palestra Yandex ü§∂üèæ üëéüèø üëºüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Algumas semanas atr√°s, um evento especial da comunidade CocoaHeads foi realizado no escrit√≥rio da Yandex - maior do que as mitaps tradicionais. O dese...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microintera√ß√µes no iOS. Palestra Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/429580/">  Algumas semanas atr√°s, um evento especial da comunidade CocoaHeads foi realizado no escrit√≥rio da Yandex - maior do que as mitaps tradicionais.  O desenvolvedor Anton Sergeyev falou nesta reuni√£o e falou sobre o modelo de microintera√ß√£o que os designers de UX costumam usar, bem como sobre como colocar as id√©ias nele em pr√°tica.  Anton prestou mais aten√ß√£o √† anima√ß√£o. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/JoVBQCwX8ys" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - √â muito importante para mim que foi uma honra conhecer os convidados.  Vejo aqui aqueles com quem eu conhe√ßo h√° muito tempo, aqueles com quem eu conheci recentemente e aqueles com quem ainda n√£o conheci.  Bem-vindo ao CocoaHeads. <a name="habracut"></a><br><br>  Vou falar sobre micro-intera√ß√µes.  Isso √© um pouco de isca de clique - somos engenheiros, desenvolvedores, falaremos mais sobre a parte do software, mas come√ßaremos com um t√≥pico muito humanit√°rio, como microintera√ß√µes.  Como resultado, aplicaremos esse tema humanit√°rio na parte t√©cnica para aprender a projetar de forma mais eficiente e simples o design de componentes visuais muito pequenos, como bot√µes, carregadeiras pequenas e barras.  Eles est√£o saturados de anima√ß√£o, e o c√≥digo de anima√ß√£o ramificada geralmente pode parecer muito complicado, √© extremamente dif√≠cil de manter. <br><br>  Mas primeiro, um pouco de distra√ß√£o.  Pense nisso, voc√™ se lembra de quando decidiu se tornar um desenvolvedor?  Eu lembro claramente disso.  Tudo come√ßou com uma mesa.  Uma vez eu decidi aprender ObjC.  Linguagem elegante, divertida, assim, sem planos de longo alcance.  Encontrei um livro, ao que parece, Big Nerd Ranch, e comecei a ler cap√≠tulo por cap√≠tulo, fazendo cada exerc√≠cio, conferindo, lendo, at√© chegar √† mesa.  Em seguida, me familiarizei com o padr√£o de delegado, mais precisamente com sua subesp√©cie "Fonte de dados", fonte de dados.  Esse paradigma me parece muito simples agora: existe uma fonte de dados, delegado, tudo √© simples.  Mas ent√£o me surpreendeu: como posso separar uma tabela de dados completamente diferentes?  Voc√™ j√° viu uma tabela em um peda√ßo de papel na qual √© poss√≠vel colocar um n√∫mero infinito de linhas, dados completamente abstratos.  Isso me influenciou bastante.  Percebi que a programa√ß√£o, o desenvolvimento tem tremendas oportunidades, e ser√° muito interessante aplic√°-las.  Desde ent√£o, decidi me tornar um desenvolvedor. <br><br>  Durante o desenvolvimento, v√°rios padr√µes foram encontrados.  Enorme, chamados de arquiteturas que descrevem todo o aplicativo.  Pequenos que cabem em dezenas em um bot√£o pequeno.  √â importante entender que todos esses padr√µes n√£o vieram do ar, mas do setor humanit√°rio.  O mesmo padr√£o de delega√ß√£o.  A delega√ß√£o apareceu muito antes da programa√ß√£o, e a programa√ß√£o assume todas essas coisas humanit√°rias para um trabalho mais eficiente. <br><br>  Hoje vou falar sobre outra abordagem que assume outra coisa humanit√°ria.  Em particular, sobre micro-intera√ß√µes. <br><br>  Tudo come√ßou com um carregador.  No trabalho anterior, antes do Yandex, eu tinha a tarefa de repetir o carregador de design de material do Google.  Existem dois deles, um indefinido, o outro definido.  Eu tinha a tarefa de combin√°-los em um, ele tinha que ser capaz de tanto certo quanto por tempo indeterminado, mas havia requisitos r√≠gidos - para que fosse extremamente suave.  A qualquer momento, podemos passar de um estado para outro, e tudo deve ser animado de maneira suave e precisa. <br><br>  Sou um desenvolvedor inteligente, fiz tudo.  Eu tenho mais de 1000 linhas de c√≥digo de macarr√£o incompreens√≠vel.  Funcionou, mas recebi um coment√°rio interessante sobre a revis√£o do c√≥digo: "Realmente espero que ningu√©m nunca edite esse c√≥digo".  E para mim √© praticamente inadequado.  Eu escrevi c√≥digo horr√≠vel.  Funcionou bem, foi uma das minhas melhores anima√ß√µes, mas o c√≥digo era horr√≠vel. <br><br>  Hoje vou tentar descrever a abordagem que encontrei depois que deixei o emprego. <br><br><img src="https://habrastorage.org/webt/w6/93/ez/w693ezlmyrpdyxgcxluxx0scxdo.jpeg"><br><br>  Vamos come√ßar com o t√≥pico mais humanit√°rio - modelos de microintera√ß√£o.  Como eles s√£o incorporados e geralmente onde est√£o ocultos em nossos aplicativos?  Vamos continuar usando esse modelo em nosso mundo t√©cnico.  Considere como o UIView, que lida com exibi√ß√£o e anima√ß√£o, como isso funciona.  Em particular, falaremos muito sobre o mecanismo CAAction, que est√° intimamente integrado e funciona com o UIView, CALayer.  E ent√£o considere pequenos exemplos. <br><br>  Defini√ß√£o primeiro.  Aparentemente, o autor realmente gostou do prefixo "micro", mas n√£o h√° macro ou nano-intera√ß√µes, o tamanho n√£o importa.  Por simplicidade, os chamaremos de simplesmente intera√ß√µes.  Esse √© um modelo t√£o conveniente que permite descrever qualquer intera√ß√£o com o aplicativo, do in√≠cio ao fim.  Ele consiste em quatro pontos: um gatilho, l√≥gica de neg√≥cios que precisa ser implementada nessa intera√ß√£o, feedback para transmitir algo ao usu√°rio e uma altera√ß√£o no estado do aplicativo. <br><br>  Vou contar uma hist√≥ria com tr√™s pap√©is diferentes.  Vou come√ßar com o usu√°rio, como a coisa mais importante no desenvolvimento.  Quando eu estava me preparando para o relat√≥rio, fiquei doente.  Eu precisava encontrar uma farm√°cia e abri o Yandex.Map.  Abri o aplicativo, olhe para ele, ele olha para mim, mas nada acontece.  Percebi ent√£o que eu era o usu√°rio, sou o principal, dou instru√ß√µes sobre o que fazer para o aplicativo.  Eu orientei, cliquei no bot√£o "pesquisar", digitei "farm√°cia", clique em "OK", o aplicativo fez o trabalho interno, localizou as farm√°cias necess√°rias pr√≥ximas a mim e a exibiu na tela. <br><br>  Procurei o caminho certo e descobri que, al√©m das farm√°cias, um bot√£o especial aparecia na tela - para construir uma rota.  Assim, o aplicativo mudou para um novo estado.  Cliquei e fui √† farm√°cia.  Entrei neste aplicativo por algum motivo - para encontrar uma farm√°cia.  Eu a alcancei.  Eu sou um usu√°rio feliz. <br><br>  Antes que o aplicativo aparecesse e eu pudesse procurar algo nele, ele foi desenvolvido.  O que o designer de UX achou quando criou esse processo?  Tudo come√ßou com o fato de que era necess√°rio sair de uma cena muda quando o usu√°rio e o aplicativo se entreolham, e nada acontece.  Para isso, era necess√°rio algum tipo de gatilho.  Tudo tem um come√ßo, e aqui tamb√©m era necess√°rio come√ßar em algum lugar. <br><br>  O gatilho foi selecionado - bot√£o de pesquisa.  Ao clicar nele, era necess√°rio resolver o problema do ponto de vista t√©cnico.  Solicite dados no servidor, analise a resposta, de alguma forma atualize o modelo, analise.  Solicite a posi√ß√£o atual dos usu√°rios e muito mais.  E assim obtivemos esses dados e sabemos exatamente onde est√£o todas as farm√°cias. <br><br>  Parece que era poss√≠vel acabar com isso.  Afinal, resolvemos o problema, encontramos todas as farm√°cias.  H√° apenas um problema: o usu√°rio ainda n√£o sabe nada sobre essas farm√°cias.  Ele precisa entender. <br><br>  De alguma forma, empacote nossa solu√ß√£o para esse problema e leve-a para um pacote bonito, para que ele entenda.  Acontece que os usu√°rios s√£o pessoas, eles interagem com o mundo exterior atrav√©s dos sentidos.  O estado atual da tecnologia √© tal que n√≥s, como desenvolvedores de aplicativos m√≥veis, temos apenas tr√™s sentidos: vis√£o - podemos mostrar algo na tela, audi√ß√£o - podemos reproduzir nos alto-falantes e uma sensa√ß√£o t√°til, podemos empurrar o usu√°rio na m√£o. <br><br>  Mas o homem √© muito mais funcional.  Mas o estado atual da tecnologia √© tal que, no momento, podemos confiar apenas nesses tr√™s.  E, neste caso, selecionamos uma tela, mostramos no mapa as farm√°cias mais pr√≥ximas e com uma lista com informa√ß√µes mais detalhadas sobre essas farm√°cias.  E parece que isso √© exatamente tudo, o usu√°rio encontrou farm√°cias e est√° tudo bem. <br><br>  Mas h√° um problema.  Quando o usu√°rio entrou no aplicativo, ele estava em um contexto em que n√£o sabia onde as farm√°cias estavam localizadas.  E suas tarefas eram encontr√°-la.  Mas agora o contexto mudou, ele sabe onde est√£o as farm√°cias e n√£o precisa mais procur√°-las.  Ele teve a seguinte tarefa - obter instru√ß√µes para a pr√≥xima farm√°cia.  √â por isso que precisamos exibir controles adicionais na tela, em particular, este √© um bot√£o para construir uma rota, ou seja, transferir o aplicativo para outro estado em que esteja pronto para aceitar novos gatilhos para as pr√≥ximas intera√ß√µes novamente. <br><br>  Imagine, o designer de UX descobriu tudo isso, vem ao desenvolvedor e come√ßa a descrever em cores como o usu√°rio clica no bot√£o, como e o que acontece, como √© pesquisado, como o usu√°rio est√° satisfeito, como aumentamos a DAU e assim por diante.  A pilha de perguntas n√£o resolvidas do desenvolvedor transbordou para outro lugar na primeira frase, quando mencionamos o bot√£o pela primeira vez. <br><br>  Ele pacientemente ouve tudo e, no final, quando termina, ele diz que tudo bem, isso √© legal, mas vamos discutir o bot√£o.  Este √© um elemento importante. <br><br>  Durante a discuss√£o, verifica-se que o bot√£o √© inerentemente um gatilho, cont√©m l√≥gica em si mesma, segundo a qual pode receber mensagens do sistema, em particular, sobre cliques do usu√°rio na tela.  Com base nesse clique, ele pode iniciar uma cadeia de eventos, que come√ßa com o fato de que o mesmo bot√£o envia mensagens para diferentes objetos sobre a necessidade de iniciar v√°rios processos, nesse caso, solicitar informa√ß√µes sobre o servidor, mais um pouco. <br><br>  Quando pressionado, o bot√£o muda de estado e fica pressionado.  Quando o usu√°rio libera, ele deixa de ser pressionado.  Ou seja, fornece feedback ao usu√°rio para que ele entenda o que esperar desse bot√£o.  E o bot√£o pode ser pressionado, n√£o pressionado, ativo ou inativo, em diferentes estados, e mover de acordo com a l√≥gica diferente de um estado para outro. <br><br>  Assim, vimos que o mesmo modelo de microintera√ß√£o, que consiste em um gatilho, l√≥gica de neg√≥cios, feedback e altera√ß√µes de estado, pode descrever nosso aplicativo em v√°rias escalas, como na escala de um caso de usu√°rio inteiro, uma grande procura pela farm√°cia mais pr√≥xima, Ent√£o, em termos de um pequeno bot√£o. <br><br>  E esse √© um modelo muito conveniente que permite simplificar a intera√ß√£o dentro da equipe e descrever programaticamente, separar quatro entidades: gatilho, l√≥gica de neg√≥cios, feedback e mudan√ßa de estado.  Vamos ver o que o UIKit nos fornece para us√°-lo.  E n√£o apenas fornece, mas usa.  Ao implementar v√°rias anima√ß√µes, os pequenos componentes das subclasses do UIView, ele usa apenas esse mecanismo e n√£o √© diferente. <br><br>  Vamos come√ßar com o UIView, como ele se encaixa nesse modelo.  Em seguida, consideraremos o CALayer que ele nos fornece para apoiar esses estados e o mecanismo de a√ß√µes, o momento mais interessante. <br><br>  Vamos come√ßar com o UIView.  N√≥s o usamos para exibir alguns ret√¢ngulos na tela.  Mas, de fato, o UIView n√£o sabe desenhar, usa outro objeto CALayer para isso.  De fato, o UIView est√° comprometido em receber mensagens sobre como tocar no sistema, bem como sobre outras chamadas, sobre a API que definimos em nossas subclasses do UIView.  Assim, o pr√≥prio UIView implementa a l√≥gica do acionador, ou seja, o lan√ßamento de alguns processos, recebendo essas mensagens do sistema. <br><br>  O UIView tamb√©m pode notificar seus delegados sobre os eventos que ocorreram e tamb√©m enviar mensagens aos assinantes, como, por exemplo, fazer com que o UIControl subclasse eventos diferentes.  Dessa maneira, a l√≥gica comercial deste UIView √© implementada.  Nem todos eles t√™m l√≥gica de neg√≥cios, muitos deles s√£o apenas elementos de exibi√ß√£o e n√£o t√™m feedback no sentido de l√≥gica de neg√≥cios. <br><br><img src="https://habrastorage.org/webt/ur/9o/tu/ur9otu78v5xkyy3knr8ze443pl8.jpeg"><br><br>  Analisamos dois pontos, um gatilho e uma l√≥gica de neg√≥cios.  E onde o feedback e a mudan√ßa de estado est√£o ocultos no UIView?  Para entender isso, devemos lembrar que o UIView n√£o existe por si s√≥.  Quando criado, ele cria uma camada traseira, uma subclasse de CALayer. <br><br><img src="https://habrastorage.org/webt/_y/dw/wt/_ydwwtnnokhkvxeuj5kl02v4qaa.jpeg"><br><br>  E nomeia-se seu delegado.  Para entender como o UIView usa o CALayer, ele pode existir em v√°rios estados. <br><br>  Como distinguir um estado de outro?  Eles diferem no conjunto de dados que precisa ser armazenado em algum lugar.  Vamos considerar quais recursos o CALayer nos fornece para o UIView, para que ele armazene o estado. <br><br><img src="https://habrastorage.org/webt/ls/2x/7f/ls2x7f_qs_-ysgeirsunqki1o7o.jpeg"><br><br>  Nossa interface est√° se expandindo um pouco, a intera√ß√£o entre o UIView e o CALayer, o UIView tem uma tarefa adicional - atualizar o reposit√≥rio dentro do CALayer. <br><br>  Um fato pouco conhecido que poucas pessoas usam: CALayer pode se comportar como uma matriz associativa, o que significa que podemos gravar dados arbitr√°rios nele em qualquer chave da seguinte maneira: setValue (_: forKey :). <br><br><img src="https://habrastorage.org/webt/hy/l_/r9/hyl_r9663azms_wx4qlf1f12ctw.jpeg"><br><br>  Esse m√©todo est√° presente em todas as subclasses NSObject, mas, ao contr√°rio de muitos outros, quando uma chave √© recebida e n√£o √© substitu√≠da por ela, ela n√£o trava.  E ele escreve corretamente, e ent√£o podemos ler.  √â uma coisa muito conveniente, que permite, sem criar subclasses do CALayer, gravar quaisquer dados l√° e depois l√™-los, consultando-os.  Mas este √© um reposit√≥rio simples muito primitivo, de fato, um dicion√°rio.  O CALayer √© muito mais progressivo.  Ele suporta estilos. <br><br>  Isso √© implementado pela propriedade Style que qualquer CALayer possui.  Por padr√£o, √© nulo, mas podemos redefinir e us√°-lo. <br><br><img src="https://habrastorage.org/webt/ow/x1/ox/owx1ox1elo1_go_6jxikiuc6fws.jpeg"><br><br>  Em geral, este √© um dicion√°rio comum e nada mais, mas tem uma peculiaridade sobre como o CALayer funciona com ele, se solicitarmos valor para Key, outro m√©todo que o NSObject possui.  Ele age de maneira muito interessante, pois procura recursivamente os valores necess√°rios no dicion√°rio de estilos.  Se empacotarmos um estilo existente em um novo estilo com a tecla style e escrevermos algumas teclas l√°, mas a apar√™ncia ser√° a seguinte. <br><br><img src="https://habrastorage.org/webt/xd/m3/z1/xdm3z1vyiscv35nd1jspq5aujve.jpeg"><br><br>  Primeiro, olhe para a raiz, depois para o interior e assim por diante, at√© que fa√ßa sentido.  Quando o estilo se torna nulo, n√£o faz sentido procurar mais. <br><br>  Dessa forma, o UIView pode, usando a infraestrutura fornecida pelo CALayer, organizar altera√ß√µes de estado, atualizar o reposit√≥rio interno do CALayer, usando o estilo, um reposit√≥rio muito poderoso que pode simular uma pilha ou usando uma matriz associativa regular, que tamb√©m √© muito eficiente e muito √∫til . <br><br>  Terminado o armazenamento, comece com CAAction.  Vou lhe contar mais sobre ele. <br><br><img src="https://habrastorage.org/webt/r7/ay/kz/r7aykzzyhz25wrbcddkax9-oyzm.jpeg"><br><br>  H√° uma nova tarefa para o UIView - solicitar a√ß√µes do CALayer.  O que s√£o a√ß√µes? <br><br><img src="https://habrastorage.org/webt/rk/yi/le/rkyile_6v-vwfrq0d98sgeq4obs.jpeg"><br><br>  O CAAction √© apenas um protocolo que possui apenas um m√©todo - executado.  A Apple geralmente adora temas de cinema, a√ß√£o aqui como "c√¢mera, motor!".  Esse "motor" √© apenas uma a√ß√£o, e n√£o apenas esse nome foi usado.  O m√©todo run significa iniciar uma a√ß√£o que pode iniciar, executar e terminar, a mais importante.  Este m√©todo √© muito gen√©rico, possui apenas uma sequ√™ncia de eventos e todo o resto pode ser de qualquer tipo.  No ObjC, isso √© tudo id e um NSDictionary normal. <br><br><img src="https://habrastorage.org/webt/3u/q-/6z/3uq-6zsnqrcdp_ijgpmbvljcxui.jpeg"><br><br>  Existem classes dentro do UIKit que atendem ao protocolo CAAction.  O primeiro √© a anima√ß√£o.  Primeiro, sabemos que a anima√ß√£o pode ser adicionada a uma camada, mas isso √© algo de n√≠vel muito baixo.  Uma abstra√ß√£o de alto n√≠vel acima √© executar uma a√ß√£o com os par√¢metros necess√°rios com uma camada. <br><br>  A segunda exce√ß√£o importante √© o NSNull.  Sabemos que ele n√£o pode ser chamado por nenhum m√©todo, mas ele satisfaz o protocolo CAAction, e isso √© feito para procurar convenientemente CAAction em camadas. <br><br><img src="https://habrastorage.org/webt/nm/34/9d/nm349dj4-hpwpaf2jshz4bjr6ee.jpeg"><br><br>  Como dissemos antes, o UIView √© um delegado para o CALayer, e um dos m√©todos de delegado √© a a√ß√£o (para: forKey :).  A camada possui um m√©todo, a√ß√£o paraKey. <br><br><img src="https://habrastorage.org/webt/xh/1s/wz/xh1swzwsz49zo9iythd65yntg5a.jpeg"><br><br>  Podemos cham√°-lo a qualquer momento na camada, e a qualquer momento dar√° a a√ß√£o correta ou nula, uma vez que tamb√©m pode dar.  O algoritmo √© uma pesquisa muito incomum.  O pseudoc√≥digo est√° escrito aqui, vamos dar uma olhada nas linhas.  Ap√≥s o recebimento dessa mensagem, ele primeiro consulta o delegado.  Um delegado pode retornar nulo, o que significa que a pesquisa deve continuar em outro lugar ou pode retornar uma a√ß√£o v√°lida, um objeto v√°lido que satisfa√ßa o protocolo CAAction.  Mas existe uma regra l√≥gica: se retornar NSNull, que satisfaz esse protocolo, mais tarde ser√° convertido em zero.  Ou seja, se retornarmos Nulo, na verdade isso significar√° "pare de procurar".  N√£o h√° a√ß√£o e n√£o √© necess√°rio. <br><br>  Mas h√° o seguinte.  Depois de consultar o delegado e o delegado retornar nulo, ele continuou a pesquisar.  Primeiro, no dicion√°rio Actions, que a camada possui, e depois pesquisar√° recursivamente no dicion√°rio de estilo, onde tamb√©m pode haver um dicion√°rio com a chave actions, no qual muitas a√ß√µes podem ser gravadas, e tamb√©m ser√° poss√≠vel procur√°-las recursivamente.  Se n√£o deu certo, ele solicitar√° √† classe a a√ß√£o padr√£o para o m√©todo Key, que √© definida pelo CALayer e at√© recentemente retornou algo, mas ultimamente sempre retorna nulo nas vers√µes recentes do iOS. <br><br>  Entendeu a teoria.  Vamos ver como tudo √© aplicado na pr√°tica. <br><br>  Existem eventos, eles t√™m chaves, algumas a√ß√µes ocorrem nesses eventos.  Fundamentalmente, dois tipos diferentes de eventos podem ser distinguidos.  A primeira √© a anima√ß√£o das propriedades armazenadas.  Suponha que quando chamamos Viewcolor = red em View, √© teoricamente poss√≠vel animar. <br><br><img src="https://habrastorage.org/webt/2i/6p/sc/2i6pscholbhv-jvln05rlepz1ru.jpeg"><br><br>  Que relat√≥rio sobre padr√µes sem circuito?  Eu desenhei um casal.  O UIView possui algum tipo de interface que definimos para subclasses ou que √© recebida do sistema com eventos.  A tarefa do UIView √© solicitar a a√ß√£o desejada, atualizar o armazenamento interno e iniciar a a√ß√£o que ocorreu.  A ordem √© muito importante em rela√ß√£o √† solicita√ß√£o: a√ß√£o, somente ent√£o atualize a a√ß√£o e somente ent√£o atualize a loja e a a√ß√£o. <br><br><img src="https://habrastorage.org/webt/b4/qu/mm/b4qumm17wvgwfhycn1ld3z7tuka.jpeg"><br><br>  O que acontece se na UIView atualizarmos backgroundColor.  Sabemos que no UIView tudo o que √© exibido na tela ainda √© um proxy para o CALayer.  Ele armazena em cache tudo o que recebe, apenas por precau√ß√£o, mas ao mesmo tempo tudo transmite o CALayer e lida com toda a l√≥gica adicional do CALayer.  O que acontece no CALayer quando ele recebe uma tarefa para alterar o plano de fundo?  Tudo √© um pouco mais complicado aqui. <br><br><img src="https://habrastorage.org/webt/wd/gd/-p/wdgd-peskdkf3x9pt9ta408lpa8.jpeg"><br><br>  Para come√ßar, ele pedir√° a√ß√£o.  E √© importante entender que a a√ß√£o ser√° solicitada primeiro.  Isso permitir√° que voc√™ pergunte ao CALayer seus valores atuais, incluindo backgroundColor, no momento da cria√ß√£o da a√ß√£o, somente a loja ser√° atualizada e, quando a a√ß√£o recebida receber o comando de execu√ß√£o, poder√° consultar o CALayer e obter novos valores.  Assim, ele possuir√° o antigo e o novo, e isso permitir√° que ele crie anima√ß√£o, se necess√°rio. <br><br>  Mas h√° um recurso no UIView, se alterarmos o backgroundColor no UIView, se fizermos isso no bloco de anima√ß√£o, ele ser√° animado e, se estiver fora do bloco de anima√ß√£o, n√£o ser√° animado. <br><br><img src="https://habrastorage.org/webt/nm/34/9d/nm349dj4-hpwpaf2jshz4bjr6ee.jpeg"><br><br>  Tudo √© muito simples, n√£o h√° m√°gica.  Mas lembre-se de que o UIView √© um representante do CALayer, ele possui esse m√©todo.  Tudo √© muito simples. <br><br>  Se esse m√©todo foi executado no bloco de anima√ß√£o, ele retornar√° algum tipo de a√ß√£o.  Se estiver fora do bloco de anima√ß√£o, esse m√©todo retornar√° NSNull, o que significa que nada precisa ser animado.      ,  CALayer      . <br><br>       ,  UIView   ,  .         .       ? <br><br><img src="https://habrastorage.org/webt/hb/bp/j_/hbbpj_qzzphg6b_dvw-mhbmceak.jpeg"><br><br>    ,   .  UIView   ,  read only,      ,  inheritedAnimationDuration.    .      ,      .      . <br><br>    ?          duration,      .        ,   run, ,      . <br><br><img src="https://habrastorage.org/webt/a6/4u/n9/a64un9twddqprjgzjvzwnppwnpk.jpeg"><br><br>       ,   CAAction,  backgroundcolor  opacity,     UIView .  ,      ,  ,  ,  .          .    setValue forKey    ,        ,     ,   ,       ,      ,   . <br><br>     ,       ,    ,   ,   . <br><br>    ‚Äî      . ,    ¬´¬ª  ¬´¬ª   .    . <br><br>    . <br><br><img src="https://habrastorage.org/webt/l6/je/7m/l6je7mjo7fnwwxyvfql1y-yuy0q.jpeg"><br><br>     . ,        ,         ,    .               UIView   CALayer,       ,    , CAAction, ,  ,   . <br><br><img src="https://habrastorage.org/webt/q6/uo/jq/q6uojqtnrhojwxpuuwzxtuentju.jpeg"><br><br><img src="https://habrastorage.org/webt/jg/ax/_s/jgax_s_wow82hbtxeax_29d3brw.jpeg"><br><br> ,     ,    ,       .            ,       .    . <br><br>    .   - . <br><br>             CAAction,    ,   .   ,    ,    ,  . <br><br><img src="https://habrastorage.org/webt/pa/0b/b8/pa0bb8gtuowzwknknhve-btxbsw.jpeg"><br><br>   ,       , ,    home,    .     ,    . ,      . <br><br><img src="https://habrastorage.org/webt/hw/5r/l8/hw5rl8bhdrs4fvmi503inw7iauq.jpeg"><br><br>      .   - . <br><br><img src="https://habrastorage.org/webt/bp/np/di/bpnpdiveiwjnqlxotgrvlr5egj8.jpeg"><br><br>   ,  -    , -   .     ,    ,    .     ,   . <br><br>      ,    ,      . <br><br><img src="https://habrastorage.org/webt/hj/ub/55/hjub55ptyxd7nbmmr9jur-zn3sy.jpeg"><br><br>   ,   CAAction      ,   .     ,   UIControl,  - ,   - ,     ,      ,  -   . <br><br> ,  .  ,  UIView  -,     ,   -   ,       ,   ,      . <br><br>    ‚Äî     .       . <br><br>   ?    .  ,          .      ‚Äî   .      activating,      inactive  active.        ,  ,        . <br><br><img src="https://habrastorage.org/webt/rz/lt/hw/rzlthwfk8lmduvkc_ltfagvorbk.jpeg"><br><br>    .   ,  onOrderIn  onOrderOut.  ,      UIKit,        . <br><br>  ,   -, ‚Äî ,    . <br><br><img src="https://habrastorage.org/webt/q4/8t/2v/q48t2v7xemofbmsmaydyaivlgqw.jpeg"><br><br>    .      UIView  ,      : isActive  progress.        .        CAAction,     . <br><br>   ,   .   ,  , 30 CAACtion,    .          ,   30 ,        NSNull.     15     15 .    .      ‚Äî  .   ,   ‚Äî      . <br><br> ,         .     . <br><br>   .  ,        ,    : , -,     . <br><br>       ,        , .            . ,  UIKit   ,      .   .     ,   ,          ,   .  Obrigado pela aten√ß√£o. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429580/">https://habr.com/ru/post/pt429580/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429568/index.html">Reduza o tempo de inatividade do Zimbra durante falhas do servidor com o Zextras Backup</a></li>
<li><a href="../pt429570/index.html">Ensinar um agente a jogar Mario Kart com filtros</a></li>
<li><a href="../pt429572/index.html">Interceptando conversas particulares no Skype usando o Devicelock DLP</a></li>
<li><a href="../pt429574/index.html">Check Point gratuito para iniciantes no CheckMates</a></li>
<li><a href="../pt429578/index.html">Quais erros est√£o ocultos no c√≥digo Infer.NET?</a></li>
<li><a href="../pt429582/index.html">Indicador anal√≥gico de carga do computador</a></li>
<li><a href="../pt429586/index.html">Como determinar a melhor hora para negociar na bolsa</a></li>
<li><a href="../pt429588/index.html">Toda a verdade sobre o RTOS. Artigo 20. Sem√°foros: Servi√ßos Auxiliares e Estruturas de Dados</a></li>
<li><a href="../pt429590/index.html">An√°lise de voz para call centers baseados em SOLR</a></li>
<li><a href="../pt429592/index.html">Como os cart√µes banc√°rios afetam a economia e por que a bola branca n√£o decola</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>