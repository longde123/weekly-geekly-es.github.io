<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚Ü™Ô∏è üî± üë∂üèΩ Liveprof vous montrera quand et pourquoi les performances de votre application PHP ont chang√© üóÉÔ∏è üçé ‚úåÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Je m'appelle Timur Shagiakhmetov, je suis d√©veloppeur PHP chez Badoo . 

 La performance des applications est l'un des crit√®res les plu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Liveprof vous montrera quand et pourquoi les performances de votre application PHP ont chang√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/436364/"><img src="https://habrastorage.org/webt/sm/5p/or/sm5porzvybv5m_8ngvmgicgmeui.jpeg"><br><br>  Bonjour, Habr!  Je m'appelle Timur Shagiakhmetov, je suis d√©veloppeur PHP chez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Badoo</a> . <br><br>  La performance des applications est l'un des crit√®res les plus importants pour la qualit√© du travail d'un programmeur.  En mati√®re d'optimisation des applications PHP, l'assistant est le profileur. <br><br>  R√©cemment, nous avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">parl√© des</a> outils que nous utilisons pour le profilage.  Permettez-moi de vous rappeler: l'un des outils pour l'analyse des performances, lorsqu'il n'est pas clair quelles parties du code ont influenc√© l'augmentation du temps de g√©n√©ration de r√©ponse, est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">XHProf</a> .  Il s'agit d'une extension pour PHP qui vous permet de profiler du code sur un serveur de combat et de l'am√©liorer par la suite. <br><br>  Mais je voudrais √©galement avoir un historique des changements de productivit√©, afin que vous puissiez suivre ce qui et quand a affect√© sa d√©t√©rioration, non?  Pour ce faire, il y a environ un an, nous avons d√©velopp√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liveprof</a> , un outil de profilage automatique de toutes les requ√™tes avec une interface d'analyse des √©volutions des performances des applications. <br><br>  Notre outil vous permet d'analyser l'√©volution des performances de n'importe quelle partie du code, de trouver les endroits o√π il a le plus chut√©.  Dans le m√™me temps, il n'a pas besoin d'√™tre sp√©cifiquement activ√© et d'attendre que les statistiques s'accumulent - il est toujours actif et recueille des donn√©es pour une certaine fraction de toutes les demandes. <br><br>  Dans cet article, je parlerai des d√©tails d'impl√©mentation et des fonctionnalit√©s de l'utilisation de cet outil. <br><a name="habracut"></a><br><h2>  Un peu sur XHProf </h2><br>  Tout d'abord, quelques mots sur les fonctionnalit√©s de XHProf lui-m√™me.  Il s'agit d'un profileur pour PHP √©crit en C comme une extension.  Il a √©t√© d√©velopp√© sur Facebook et publi√© dans le domaine public.  Il dispose de plusieurs fourches ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">uprofiler</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tideways</a> ), enti√®rement compatibles au niveau du format de donn√©es de sortie. <br><br>  XHProf d√©finit des temporisateurs autour de tous les appels de fonction / m√©thode.  Son utilisation implique des frais g√©n√©raux.  Mais ils ne sont pas si gros et permettent de l'utiliser en production. <br><br>  Le r√©sultat de XHProf est un tableau d'√©l√©ments au format suivant: <br><br><pre><code class="php hljs">$data = [ <span class="hljs-string"><span class="hljs-string">'parentMethodName==&gt;childMethodName'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'ct'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">'wt'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-string"><span class="hljs-string">'cpu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-string"><span class="hljs-string">'mu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">528</span></span> <span class="hljs-string"><span class="hljs-string">'pmu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ] ];</code> </pre> <br>  o√π <br><br>  <code><b>parentMethodName</b></code> et <code><b>childMethodName</b></code> sont respectivement les m√©thodes parent et enfant; <br>  <code><b>ct</b></code> - le nombre d'appels dans le contexte de la demande; <br>  <code><b>wt</b></code> - temps d'ex√©cution de la demande (comprend le temps pass√© par le processeur et le temps d'attente pour les E / S ou la r√©ponse d'un autre service); <br>  <code><b>cpu</b></code> - temps consacr√© par le processeur au traitement de la demande; <br>  <code><b>mu</b></code> - modification de la consommation de m√©moire apr√®s un appel de m√©thode; <br>  <code><b>pmu</b></code> - modification de la consommation de m√©moire maximale apr√®s un appel de m√©thode. <br><br>  D'autres options sont √©galement possibles. <br><br>  XHProf contient √©galement des outils pour visualiser les r√©sultats ainsi obtenus.  Pour chaque op√©ration de profilage, nous obtenons un tableau avec un ensemble de param√®tres pour chaque m√©thode. <br><br>  Par exemple <br><br><div class="spoiler">  <b class="spoiler_title">r√©sultat du tri √† bulles</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRandomArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $count)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $array = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $count; $i++) { $array[] = rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $array; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BubbleSorter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sort</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;$array)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $len = count($array); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $len ; $i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; $len - $i - <span class="hljs-number"><span class="hljs-number">1</span></span>; $j++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($array[$j] &gt; $array[$j + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;swap($array[$j], $array[$j + <span class="hljs-number"><span class="hljs-number">1</span></span>]); } } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">swap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;$a, &amp;$b)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $tmp = $a; $a = $b; $b = $tmp; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSorted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $array)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{ $len = count($array); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $len - <span class="hljs-number"><span class="hljs-number">1</span></span>; $i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($array[$i] &gt; $array[$i + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayPrinter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $array, string $delimiter = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">' '</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> implode($delimiter, $array) . PHP_EOL; } } xhprof_enable(); $n = <span class="hljs-number"><span class="hljs-number">10</span></span>; $arrayGenerator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ArrayGenerator(); $array = $arrayGenerator-&gt;getRandomArray($n); $sorter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BubbleSorter(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$sorter-&gt;isSorted($array)) { $sorter-&gt;sort($array); } $printer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ArrayPrinter(); $printer-&gt;print($array); $xhprof_data = xhprof_disable();</code> </pre><br></div></div><br><img src="https://habrastorage.org/webt/ip/cw/vi/ipcwviocimg7kjon1memwwziho8.png"><br><br>  Vous pouvez parcourir chaque m√©thode pour savoir quelles m√©thodes ont utilis√© le nombre de ressources. <br><br>  Vous pouvez √©galement consulter le graphique des appels en mettant en √©vidence les m√©thodes les plus gourmandes en ressources: <br><br><img src="https://habrastorage.org/webt/zq/yw/pl/zqywplc0eibbdxdotsr3f0bed_o.png"><br><br>  XHProf est utile pour analyser manuellement les performances de chaque demande.  Mais il est √©galement important pour nous de voir la situation dans son ensemble.  Vous devez comprendre comment les performances ont chang√© au fil du temps.  Pour ce faire, un outil a √©t√© d√©velopp√© qui permet de profiler les requ√™tes en mode automatique et de les analyser dans l'interface web. <br><br><h2>  Liveprof: agr√©ger les r√©sultats et conserver l'historique </h2><br>  Comment obtenir l'historique du profilage? <br><br>  Vous devez d'abord configurer le lancement automatique du profileur et enregistrer les r√©sultats.  Les performances ne sont pas constantes et fluctuent d'un lancement √† l'autre.  Pour √©viter l'influence de telles fluctuations, nous utilisons les donn√©es moyennes de plusieurs requ√™tes.  Par cons√©quent, nous obtenons des r√©sultats agr√©g√©s pour chaque requ√™te, par exemple, minimum, maximum, moyenne et 95e centile.  Cela aide √† trouver des choses difficiles qui peuvent ne pas √™tre appel√©es pour chaque demande. <br><br>  Notre outil pr√©sente √† la fois des avantages et des limites. <br><br><h3>  Ce que l'agr√©gateur peut faire: </h3><br><ol><li>  Profilage automatique de chaque Ni√®me requ√™te. <br></li><li>  Agr√©gation quotidienne des profils collect√©s. <br></li><li>  La possibilit√© de voir des graphiques des changements dans chaque param√®tre mesur√©s par le profileur.  Par exemple, wt, cpu, mu, pmu d√©crits ci-dessus. <br></li><li>  Voir le changement de performances de toute m√©thode pour un certain intervalle. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Graphique de flamme</a> bas√© sur les derni√®res donn√©es agr√©g√©es. <br></li><li>  Rechercher des requ√™tes qui appellent une m√©thode sp√©cifique <br></li></ol><br><h3>  Limitations: </h3><br><ol><li>  √âtant donn√© que notre outil est un outil d'agr√©gation, vous ne pouvez pas d√©couvrir les performances d'une requ√™te (par exemple, la plus lente) - nous obtenons les r√©sultats en moyenne sur le dernier jour.  Mais cela suffit pour √©valuer la dynamique globale des performances.  Si une demande a gliss√© dans la vitesse d'ex√©cution, la valeur moyenne, le 95e centile et le temps d'ex√©cution maximal changeront. <br></li><li>  Vous ne pouvez pas restaurer sans ambigu√Øt√© la pile d'appels compl√®te, car XHProf ne renvoie que des paires parent-enfant uniques avec la somme des valeurs des ressources d√©pens√©es. <br></li><li>  Erreur d'ex√©cution de la requ√™te li√©e √† la surcharge XHProf.  La diff√©rence n'est pas si grande, mais elle doit √™tre prise en compte lors de la mesure du temps d'ex√©cution de la requ√™te. <br></li></ol><br><h3>  Comment utiliser le profileur </h3><br><ol><li>  Tout d'abord, le profileur doit √™tre connect√© au site ou au script.  La fa√ßon la plus pratique d'utiliser l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">outil est de lancer automatiquement le profileur</a> : <br><br><pre> <code class="plaintext hljs">php composer.phar require badoo/liveprof # Run a script to configure database LIVE_PROFILER_CONNECTION_URL=mysql://db_user:db_password@db_mysql:3306/Profiler?charset=utf8 php vendor/badoo/liveprof/bin/install.php</code> </pre><br>  Il prend en charge les versions de PHP √† partir de la version 5.4 et son utilisation est lourde de charges minimales, ce qui vous permet de l'utiliser dans un environnement de combat.  L'outil d√©tecte automatiquement l'extension de profileur utilis√©e: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">XHProf</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">uprofiler</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tideways</a> .  Au d√©marrage, vous devez sp√©cifier les param√®tres de connexion √† la base de donn√©es et les param√®tres de profilage. <br><br>  Exemple d'utilisation dans le code avec les param√®tres par d√©faut: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'vendor/autoload.php'</span></span>; \Badoo\LiveProfiler\LiveProfiler::getInstance()-&gt;start(); <span class="hljs-comment"><span class="hljs-comment">// Code is here</span></span></code> </pre> <br>  Les r√©sultats de profilage sont enregistr√©s dans la base de donn√©es.  Une fois par jour, un processus d'agr√©gation a lieu.  Pour ce faire, s√©lectionnez tous les enregistrements d'une demande sp√©cifique par jour et calculez les fonctions agr√©g√©es pour chacun des param√®tres.  Les fonctions d'agr√©gation peuvent √™tre d√©velopp√©es ou red√©finies. <br><br>  Les √©l√©ments suivants sont d√©sormais disponibles: <br><br><ul><li>  au moins par jour; </li><li>  maximum par jour; </li><li>  moyenne quotidienne </li><li>  95e centile de la journ√©e. </li></ul><br></li><li>  Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">client Web</a> agr√©gateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">est</a> utilis√© pour configurer l'agr√©gation et afficher les r√©sultats.  La fa√ßon la plus simple de l'installer dans un conteneur Docker: <br><br><pre> <code class="php hljs">git <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> https:<span class="hljs-comment"><span class="hljs-comment">//github.com/badoo/liveprof-ui.git cd liveprof-ui docker-compose up web</span></span></code> </pre> </li><li>  Avant le premier d√©marrage, vous devez configurer les param√®tres de connexion √† la base de donn√©es, une liste de champs et les fonctions d'agr√©gation utilis√©es dans le fichier de configuration src / config / services.yaml.  Ex√©cutez ensuite le script d'installation: <br><br><pre> <code class="php hljs">docker-compose exec web bash install.sh</code> </pre> </li><li>  Il est n√©cessaire d'enregistrer automatiquement des scripts d'agr√©gation et de nettoyage des anciennes donn√©es dans les couronnes: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># script aggregates all profiles for previous day, add it if you don't use a queue for aggregation jobs (parameter aggregator.use_jobs_in_aggregation=false) 0 2 * * * docker-compose -f %PATH_TO_PROJECT%/docker-compose.yml run --rm --entrypoint '/usr/local/bin/php /app/bin/cli.php cron:aggregate-all-profiles' web # script removes old aggregated data, by default &gt; 200 days 0 1 * * * docker-compose -f %PATH_TO_PROJECT%/docker-compose.yml run --rm --entrypoint '/usr/local/bin/php /app/bin/cli.php cron:remove-old-profiles' web 200</span></span></code> </pre> <br></li><li>  Pour remplir avec des donn√©es de test, vous pouvez ex√©cuter le script: <br><br><pre> <code class="php hljs">docker-compose exec web php /app/bin/cli.php example:a-week-degradation</code> </pre> </li></ol><br><h2>  Description de l'interface </h2><br>  L'interface Web est disponible √†: 127.0.0.1:8000. <br><br>  Par d√©faut, une page avec une liste de requ√™tes agr√©g√©es s'ouvre.  Il permet de trouver facilement une requ√™te qui vous int√©resse, de trier toutes les requ√™tes en fonction de l'un des param√®tres et de r√©-agr√©ger une requ√™te sp√©cifique pour voir les derniers r√©sultats: <br><br><img src="https://habrastorage.org/webt/qj/-d/6b/qj-d6bj1095huwhvqmzdwim1g6k.png"><br><br>  Une page avec une liste de m√©thodes et de graphiques des changements de performances est la plus utilis√©e lorsque vous travaillez avec l'outil.  Il vous permet de parcourir la pile des appels, de surveiller la consommation de chaque param√®tre, ainsi que des graphiques des changements de performances pour un certain intervalle: <br><br><img src="https://habrastorage.org/webt/-6/ag/u4/-6agu45zuu1qs77tckpkngabjwq.png"><br><br>  <i>Une page avec une liste compl√®te des m√©thodes appel√©es vous permet de trouver rapidement la m√©thode qui vous int√©resse et de voir les graphiques en allant sur la page des graphiques:</i> <br><br><img src="https://habrastorage.org/webt/nj/g-/f_/njg-f_48jsuo8mcmlxuq1ukxj_4.png"><br>  <i>La page avec le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">graphique de flamme de la</a> derni√®re requ√™te agr√©g√©e vous permet d'identifier visuellement les parties les plus lourdes.</i> <br><br>  L'utilisation de XHProf impose certaines limites √† la pr√©cision du r√©sultat.  Cela est d√ª au fait que le profileur ne renvoie pas une arborescence d'appels compl√®te, mais uniquement les paires parent-enfant.  De plus, si une paire de m√©thodes a √©t√© appel√©e √† diff√©rents endroits de l'application, nous obtenons ainsi le temps pass√©.  Pour un graphique de flamme, vous devez avoir un arbre d'appel complet.  Lors de la restauration d'un tel arbre, les valeurs des param√®tres sont normalis√©es en tenant compte du temps pass√© par les parents. <br><br><img src="https://habrastorage.org/webt/vp/lp/xr/vplpxry-gjd-lq774gg3ji9cooo.png"><br>  <i>Une page avec une liste de m√©thodes qui sont devenues plus lentes pendant l'intervalle s√©lectionn√©.</i> <br><br>  De plus, pour chaque m√©thode, vous pouvez voir lequel des appels enfants a le plus affect√© les performances.  Par exemple, dans la capture d'√©cran ci-dessous, vous pouvez voir que la m√©thode <code>ServiceApi::getAvailableServices()</code> commenc√© √† s'ex√©cuter 116 ms plus lentement.  La raison en √©tait l'ajout d'un appel √† <code>ServiceApi::getGifts()</code> (modification de 56 ms) et une augmentation du nombre d'appels √† la m√©thode <code>ServiceApi::getConfigForList()</code> de 1 √† 5 (encore 50 ms): <br><br> <a href=""><img src="https://habrastorage.org/webt/rv/mc/dd/rvmcddru-ay4x9cb45xsvey_tka.png"></a> <br><br>  Si l'on ne sait pas √† l'avance quelle requ√™te les performances ont le plus chang√©, une page avec une liste de m√©thodes devenues plus lentes sans r√©f√©rence √† une requ√™te sp√©cifique aidera: <br><br><img src="https://habrastorage.org/webt/-6/0b/3s/-60b3svwq_rg9z7wbzmzmpriapc.png"><br>  <i>Une page qui recherche des requ√™tes qui appellent une m√©thode particuli√®re.</i> <br><br>  Il vous permet de comparer le temps d'ex√©cution dans diff√©rentes requ√™tes.  √âgalement utile pour trouver du code inutilis√©: <br><br><img src="https://habrastorage.org/webt/hq/du/lv/hqdulvav1asbj9nczgowuk1mvak.png"><br><br><h3>  Caract√©ristiques de personnalisation </h3><br>  L'outil offre de nombreuses possibilit√©s de personnalisation: <br><br><ul><li>  vous pouvez ajouter vos propres fonctions d'agr√©gation qui calculent une certaine valeur en fonction du tableau pass√© de valeurs de param√®tres; <br></li><li>  Vous pouvez modifier la base de donn√©es pour stocker les profils et les r√©sultats agr√©g√©s (SQLite, MySQL et PostgreSQL sont d√©sormais pris en charge, mais vous pouvez en utiliser d'autres dans la liste disponible pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Doctrine DBAL</a> ); <br></li><li>  Vous pouvez remplacer le gestionnaire de connexions √† la base de donn√©es et impl√©menter vos m√©thodes d'obtention de donn√©es; <br></li><li>  Vous pouvez utiliser l'interface Web √† la fois en tant que projet autonome et dans n'importe quel cadre (par exemple, un panneau de configuration de site).  Un exemple: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profileListAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{      &lt;i&gt;<span class="hljs-comment"><span class="hljs-comment">//Some custom logic before&lt;/i&gt;   $this-&gt;checkPermissions();   $App = new \Badoo\LiveProfilerUI\LiveProfilerUI();   $Page = $App-&gt;getPage('profile_method_list_page');   return $Page-&gt;setData($data)-&gt;render(); }</span></span></code> </pre> </li></ul><br><h2>  Conclusion </h2><br>  J'esp√®re que notre outil sera utile √† d'autres d√©veloppeurs.  Il permettra de v√©rifier le changement de performance de n'importe quelle partie du code sans utiliser de temporisateurs suppl√©mentaires.  Cela facilitera √©galement le processus d'optimisation, car vous pouvez maintenant voir ce qui a affect√© la d√©gradation des performances de l'application au fil du temps. <br><br>  Il est disponible sur GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/badoo/liveprof</a> , l'interface web est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/badoo/liveprof-ui</a> . <br><br>  L'outil est en cours de d√©veloppement actif et peut contenir des erreurs.  Esp√©rons qu'avec la participation de la communaut√©, cela ira encore mieux.  Les plans incluent l'ajout de la prise en charge d'autres profileurs en plus de XHProf, ainsi que l'extension de la liste des bases de donn√©es prises en charge. <br><br>  Envoyez-nous vos commentaires et vos questions sur l'utilisation dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Telegram</a> , les bugs et les pull pulls - directement √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> .  Nous appr√©cions les commentaires et suggestions! <br><br>  Un merci sp√©cial √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gregory</a> pour l'id√©e et la premi√®re impl√©mentation. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr436364/">https://habr.com/ru/post/fr436364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr436352/index.html">R√©sum√© des nouvelles de PostgreSQL. Num√©ro 14</a></li>
<li><a href="../fr436354/index.html">L'arm√©e am√©ricaine n√©glige les probl√®mes de cybers√©curit√©</a></li>
<li><a href="../fr436356/index.html">[Int√©ressant de derri√®re la colline] Comment arr√™ter la d√©pendance technologique?</a></li>
<li><a href="../fr436358/index.html">Pourquoi les d√©veloppeurs seniors enseignent-ils aux √©tudiants</a></li>
<li><a href="../fr436360/index.html">Je dois aller vite: construire pour la vitesse dans iOS. Partie 1</a></li>
<li><a href="../fr436370/index.html">Infrastructure √† cl√© publique Cha√Æne de certificats racine X509 v.3</a></li>
<li><a href="../fr436372/index.html">Plugin isom√©trique pour Unity3D</a></li>
<li><a href="../fr436374/index.html">Tendances de conception UI et UX 2019</a></li>
<li><a href="../fr436376/index.html">Pr√©sentation du robot tout-terrain EZ-Robot Roli Rover</a></li>
<li><a href="../fr436378/index.html">bobaos.pub - KNX TP / UART, Raspberry Pi et Redis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>