<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ปโ๐ผ ๐ญ ๐ ูุชุงุจุฉ UDR ูู ุจุงุณูุงู โ๐ฝ ๐๐ฟ ๐ฉ๐พโ๐ป</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุฐ ูุชุฑุฉ ุทูููุฉ Firebird ูุงุฏุฑุฉ ุนูู ุชูุณูุน ูุฏุฑุงุช ูุบุฉ PSQL ุนู ุทุฑูู ูุชุงุจุฉ ูุธุงุฆู ุฎุงุฑุฌูุฉ - UDF (ูุธุงุฆู ูุญุฏุฏุฉ ูู ูุจู ุงููุณุชุฎุฏู). ูููู ูุชุงุจุฉ UDF ูู ุฃู ูุบุฉ ุจุฑูุฌุฉ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุชุงุจุฉ UDR ูู ุจุงุณูุงู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455375/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ููุฐ ูุชุฑุฉ ุทูููุฉ Firebird ูุงุฏุฑุฉ ุนูู ุชูุณูุน ูุฏุฑุงุช ูุบุฉ PSQL ุนู ุทุฑูู ูุชุงุจุฉ ูุธุงุฆู ุฎุงุฑุฌูุฉ - UDF (ูุธุงุฆู ูุญุฏุฏุฉ ูู ูุจู ุงููุณุชุฎุฏู).  ูููู ูุชุงุจุฉ UDF ูู ุฃู ูุบุฉ ุจุฑูุฌุฉ ูุชุฑุฌูุฉ ุชูุฑูุจูุง. </p><br><p style=";text-align:right;direction:rtl">  ูุฏู Firebird 3.0 ุจููุฉ ูู ุงูููููุงุช ูุชูุณูุน ูุฏุฑุงุช Firebird.  ุฃุญุฏ ูุฐู ุงูููููุงุช ุงูุฅุถุงููุฉ ูู ูุญุฑู ุฎุงุฑุฌู (ูุญุฑูุงุช ุฎุงุฑุฌูุฉ).  ุชุถูู ุขููุฉ UDR (ุฅุฌุฑุงุกุงุช ูุญุฏุฏุฉ ูู ูุจู ุงููุณุชุฎุฏู - ุฅุฌุฑุงุกุงุช ูุญุฏุฏุฉ ูู ูุจู ุงููุณุชุฎุฏู) ุทุจูุฉ ุฃุนูู ูุงุฌูุฉ ูุญุฑู FirebirdExternal. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุงูุฏููู ุ ุณูู ูุฎุจุฑู ุจููููุฉ ุงูุฅุนูุงู ุนู UDR ูุนู ุขููุงุชูุง ููุฏุฑุงุชูุง ุงูุฏุงุฎููุฉ ูุฅุนุทุงุก ุฃูุซูุฉ ููุชุงุจุฉ UDR ูู Pascal.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุณูุชู ุชุบุทูุฉ ุจุนุถ ุฌูุงูุจ ุงุณุชุฎุฏุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฌุฏูุฏุฉ ุงูููุฌูุฉ ูููุงุฆูุงุช. </p><a name="habracut"></a><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>  ุชูุฏู ูุฐู ุงูููุงูุฉ ุฅูู ุชุนูููู ููููุฉ ูุชุงุจุฉ UDR ุจุงุณุชุฎุฏุงู ูุงุฆู Firebird API. <br>  ูุฏ ูุง ูููู ูููุธุงุฆู ูุงูุฅุฌุฑุงุกุงุช ุงูููุชูุจุฉ ุชุทุจูู ุนููู. </blockquote><p style=";text-align:right;direction:rtl">  UDRs ููุง ุงููุฒุงูุง ุงูุชุงููุฉ ุนูู Legacy UDF: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููููู ูุชุงุจุฉ ููุณ ููุท ุงููุธุงุฆู ุงูุชู ุชูุฑุฌุน ูุชูุฌุฉ ุนุฏุฏูุฉ ุ ูููู ุฃูุถูุง ุงูุฅุฌุฑุงุกุงุช ุงููุฎุฒูุฉ (ุณูุงุก ุงููุงุจูุฉ ููุชูููุฐ ุฃู ุงูุงูุชูุงุฆูุฉ) ุ ููุฐูู ุงููุดุบูุงุช ุ </li><li style=";text-align:right;direction:rtl">  ุชุญุณูู ุงูุณูุทุฑุฉ ุนูู ุงููุฏุฎูุงุช ูุงููุฎุฑุฌุงุช ุงููุนููุงุช.  ูู ุจุนุถ ุงูุญุงูุงุช (ุจุงููุฑูุฑ ุจูุงุณุทุฉ ูุงุตู) ูู ูุชู ุงูุชุญูู ูู ุงูุฃููุงุน ูุงูุฎุตุงุฆุต ุงูุฃุฎุฑู ููุนููุงุช ุงูุฅุฏุฎุงู ุนูู ุงูุฅุทูุงู ุ ููุน ุฐูู ุ ููููู ุงูุญุตูู ุนูู ูุฐู ุงูุฎุตุงุฆุต ุฏุงุฎู UDF.  ุชููุฑ UDRs ุทุฑููุฉ ุฃูุซุฑ ุชูุญูุฏูุง ูุฅุนูุงู ูุนููุงุช ุงูุฅุฏุฎุงู ูุงูุฅุฎุฑุงุฌ ุ ููุง ูู ุงูุญุงู ูุน ูุธุงุฆู ูุฅุฌุฑุงุกุงุช PSQL ุงูุนุงุฏูุฉ ุ </li><li style=";text-align:right;direction:rtl">  UDR ุณูุงู ุงูุงุชุตุงู ุงูุญุงูู ุฃู ุงููุนุงููุฉ ุงููุชุงุญุฉ ุ ูุงูุฐู ูุณูุญ ูู ูุฃุฏุงุก <br>  ุจุนุถ ุงูุชูุงุนุจ ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญุงููุฉ ูู ูุฐุง ุงูุณูุงู ุ </li><li style=";text-align:right;direction:rtl">  ูุชููุฑ ุฅูุดุงุก ุฎุทุฃ Firebird ุนูุฏ ุญุฏูุซ ุงุณุชุซูุงุกุงุช ุ ููุณุช ููุงู ุญุงุฌุฉ ูุฅุฑุฌุงุน ูููุฉ ุฎุงุตุฉ ุ </li><li style=";text-align:right;direction:rtl">  ูููู ุชุฌููุน ุงูุฅุฌุฑุงุกุงุช ูุงููุธุงุฆู ุงูุฎุงุฑุฌูุฉ (UDR) ูู ุญุฒู PSQL ุ </li><li style=";text-align:right;direction:rtl">  ูููู ูุชุงุจุฉ UDR ุจุฃูุฉ ูุบุฉ ุจุฑูุฌุฉ (ูุชู ุชุฌููุนูุง ุงุฎุชูุงุฑููุง ูู ุฑููุฒ ุงููุงุฆูุงุช) ุ ูุฐูู ูู ุงูุถุฑูุฑู ูุชุงุจุฉ ุงููููู ุงูุฅุถุงูู ุงูููุงุจู ูููุญุฑู ุงูุฎุงุฑุฌู.  ุนูู ุณุจูู ุงููุซุงู ุ ููุงู ููููุงุช ุฅุถุงููุฉ ููุชุงุจุฉ ุงููุญุฏุงุช ุงูุฎุงุฑุฌูุฉ ูู Java ุฃู ุจุฃู ูู ูุบุงุช .NET. </li></ul><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>  ูุณุชุฎุฏู ุชุทุจูู UDR ุงูุญุงูู ูุนุจ ุฑูุชูู PSQL.  ุนูู ุณุจูู ุงููุซุงู ุ ูุชู ุงุณุชุฎุฏุงูู ู <br>  ุงูุชุญูู ูู ุงููุนููุงุช ูููู ุงูุฅุฑุฌุงุน ููุงูุชุซุงู ูููููุฏ.  ูุงุจ <br>  ุชู ุงุณุชุฎุฏุงูู ุจุณุจุจ ุนุฏู ุงููุฑููุฉ ูุงุณุชุฏุนุงุก ุงููุธุงุฆู ุงูุฏุงุฎููุฉ ูุจุงุดุฑุฉ.  ุงููุชุงุฆุฌ <br>  ููุธูุฑ ุงุฎุชุจุงุฑ ููุงุฑูุฉ ุฃุฏุงุก UDR ู UDF ุฃู UDR ุชูุฑูุจูุง <br>  ุฃุจุทุฃ ูุฑุชูู ููุตู ุจุงุณุชุฎุฏุงู ุฃุจุณุท ูุธููุฉ ูุฅุถุงูุฉ ุญุฌุฉ ุงุซููู ููุซุงู.  ุณุฑุนุฉ <br>  UDR ูุณุงููุฉ ุชูุฑูุจูุง ูุณุฑุนุฉ ูุธููุฉ PSQL ุนุงุฏูุฉ.  ุฑุจูุง ูู ุงููุณุชูุจู ูุฐุง <br>  ุณูุชู ุชุญุณูู ุงููุญุธุฉ.  ูู ูุธุงุฆู ุฃูุซุฑ ุชุนููุฏุง ุ ูููู ุฃู ุชุตุจุญ ูุฐู ุงููููุงุช ุงูุนุงูุฉ <br>  ุบูุฑ ูุญุณูุณ. </blockquote><p style=";text-align:right;direction:rtl">  ูุฐูู ูู ุฃุฌุฒุงุก ูุฎุชููุฉ ูู ูุฐุง ุงูุฏููู ุ ุนูุฏ ุงุณุชุฎุฏุงู ูุตุทูุญุงุช ุงูุฅุฌุฑุงุกุงุช ุงูุฎุงุฑุฌูุฉ ุ <br>  ูุธููุฉ ุฃู ุงูุฒูุงุฏ ุณูู ูุนูู UDR ุจุงูุถุจุท (ูููุณ UDF). </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>  ุฌููุน ุงูุฃูุซูุฉ ูุฏููุง ุชุนูู ุนูู ุฏููู 2009 ููุง ุจุนุฏู ุ ููุฐูู ุนูู Free Pascal.  ุฌููุน <br>  ูููู ุชุฌููุน ุงูุฃูุซูุฉ ูู ูู ูู ุฏููู ูุจุงุณูุงู ูุฑู ุ ุฅุฐุง <br>  ุบูุฑ ูุญุฏุฏ ุจุดูู ูููุตู. </blockquote><br><h2 id="firebird-api" style=";text-align:right;direction:rtl">  Firebird API </h2><br><p style=";text-align:right;direction:rtl"> ููุชุงุจุฉ ุงูุฅุฌุฑุงุกุงุช ุฃู ุงููุธุงุฆู ุฃู ุงููุดุบูุงุช ุงูุฎุงุฑุฌูุฉ ุจูุบุงุช ุงูุจุฑูุฌุฉ ุงููุชุฑุฌูุฉ ุ ูุญุชุงุฌ ุฅูู ูุนุฑูุฉ ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Firebird API ุงูุฌุฏูุฏุฉ.  ูุง ูุชุถูู ูุฐุง ุงูุฏููู ูุตููุง ูุงููุงู ููุงุฌูุฉ Firebird API.  ููููู ูุฑุงุกุชูุง ูู ุฏููู ุงููุซุงุฆู ุงูููุฒุน ุจุงุณุชุฎุฏุงู Firebird ( <code>doc/Using_OO_API.html</code> ). </p><br><p style=";text-align:right;direction:rtl">  ูุง ูุชู ุชูุฒูุน ุงูููููุงุช ุงูุฅุถุงููุฉ ููุฎุชูู ูุบุงุช ุงูุจุฑูุฌุฉ ุงูุชู ุชุญุชูู ุนูู ูุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ูุฌุฒุก ูู ุชูุฒูุน Firebird ููุธุงู ุงูุชุดุบูู Windows ุ ูููู ููููู ุงุณุชุฎุฑุงุฌูุง ูู ูููุงุช tarbar ุงููุถุบูุทุฉ ุงูููุฒุนุฉ ุจูุงุณุทุฉ Linux (ุงููุณุงุฑ ุฏุงุฎู ุฃุฑุดูู <code>/opt/firebird/include/firebird/Firebird.pas</code> ). </p><br><h3 id="cloop" style=";text-align:right;direction:rtl">  CLOOP </h3><br><p style=";text-align:right;direction:rtl">  CLOOP - ุงูุจุฑูุฌุฉ ุงููุดุชุฑูุฉ ูููุงุฆูุงุช ุฐุงุช ุงููุบุฉ.  ูุง ูุชู ุชุถููู ูุฐู ุงูุฃุฏุงุฉ ูุน Firebird.  ูููู ุงูุนุซูุฑ ุนููู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุตุฏุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/FirebirdSQL/firebird/tree/B3_0_Release/extern/cloop</a> .  ุจุนุฏ ุชุฌููุน ุงูุฃุฏุงุฉ ุ ููููู ุฅูุดุงุก ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ููุบุฉ ุงูุจุฑูุฌุฉ ุงูุฎุงุตุฉ ุจู ( <code>IdlFbInterfaces.h</code> ุฃู <code>Firebird.pas</code> ) ุจูุงุกู ุนูู ููู ูุตู <code>include/firebird/FirebirdInterface.idl</code> . </p><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ููุงุฆู pascal ุ ูุชู ุฐูู ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">cloop FirebirdInterface.idl pascal Firebird.pas Firebird --uses SysUtils \ --interfaceFile Pascal.interface.pas \ --implementationFile Pascal.implementation.pas \ --exceptionClass FbException --prefix I \ --functionsFile fb_get_master_interface.pas</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุงูุนุซูุฑ ุนูู <code>fb_get_master_interface.pas</code> ู <code>fb_get_master_interface.pas</code> ู <code>fb_get_master_interface.pas</code> ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/FirebirdSQL/firebird/tree/B3_0_Release/src/misc/pascal</a> . </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>  ูู ูุฐู ุงูุญุงูุฉ ุ ุณูุชู ุฅุถุงูุฉ ุงูุจุงุฏุฆุฉ I ููุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช Firebird ุ ุญูุซ ูุชู ูุจูู ุฐูู ูู Object Pascal. </blockquote><br><h4 id="konstanty" style=";text-align:right;direction:rtl">  ุงูุซูุงุจุช </h4><br><p style=";text-align:right;direction:rtl">  ูุง ุชูุฌุฏ <code>isc_*</code> ูู ููู <code>Firebird.pas</code> ุงููุงุชุฌ.  ูููู ุงูุนุซูุฑ ุนูู ูุฐู ุงูุซูุงุจุช ููุบุงุช C / C ++ ุนูู <a href="">https://github.com/FirebirdSQL/firebird/blob/B3_0_Release/src/include/consts_pub.h</a> .  ููุญุตูู ุนูู ุซูุงุจุช ูุบุฉ Pascal ุ ุณูู ูุณุชุฎุฏู ุงูุจุฑูุงูุฌ ุงููุตู AWK ูุชุญููู ุจูุงุก ุงูุฌููุฉ.  ูู ูุธุงู Windows ุ ุณุชุญุชุงุฌ ุฅูู ุชุซุจูุช Gawk ููุธุงู Windows ุฃู ุงุณุชุฎุฏุงู ูุธุงู Windows ุงููุฑุนู ููุธุงู Linux (ูุชุงุญ ุนูู ูุธุงู Windows 10).  ูุชู ุฐูู ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">awk -f Pascal.Constants.awk consts_pub.h &gt; const.pas</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ูุณุฎ ูุญุชููุงุช ุงูููู ุงููุงุชุฌ ุฅูู ูุณู const ุงููุงุฑุบ ูู ููู <code>Firebird.pas</code> ูุจุงุดุฑุฉ ุจุนุฏ ุงูุชูููุฐ.  ูููู ุงูุนุซูุฑ ุนูู ููู <code>Pascal.Constants.awk</code> ูู <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/FirebirdSQL/firebird/tree/B3_0_Release/src/misc/pascal</a> . </p><br><h3 id="upravlenie-vremenem-zhizni" style=";text-align:right;direction:rtl">  ุฅุฏุงุฑุฉ ุงูููุช ุงูุญูุงุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุง ุชุนุชูุฏ ูุงุฌูุงุช Firebird ุนูู ููุงุตูุงุช COM ุ ูุฐุง ูุฅู ุฅุฏุงุฑุฉ ุญูุงุชูุง ูุฎุชููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุงู ูุงุฌูุชุงู ูู Firebird ุชุชุนุงููุงู ูุน ุฅุฏุงุฑุฉ ูุฏู ุงูุญูุงุฉ: IDisposable ู IReferenceCounted.  ูููู ุงูุฃุฎูุฑ ูุดุทูุง ุจุดูู ุฎุงุต ุนูุฏ ุฅูุดุงุก ูุงุฌูุงุช ุฃุฎุฑู: ูููู IPlugin ุจุญุณุงุจ ุงูุฑูุงุจุท ุ ูุซู ุงูุนุฏูุฏ ูู ุงููุงุฌูุงุช ุงูุฃุฎุฑู ุงูุชู ุชุณุชุฎุฏููุง ุงูููููุงุช ุงูุฅุถุงููุฉ.  ุชุชุถูู ูุฐู ูุงุฌูุงุช ุชุตู ููููุฉ ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุจูุงูุงุช ูุฅุฏุงุฑุฉ ุงููุนุงููุงุช ูุนุจุงุฑุงุช SQL. </p><br><p style=";text-align:right;direction:rtl">  ุงูุญูู ุงูุฅุถุงูู ูููุงุฌูุฉ ูุน ุญุณุงุจ ุงููุฑุฌุน ููุณ ุถุฑูุฑููุง ุฏุงุฆููุง.  ุนูู ุณุจูู ุงููุซุงู ุ ุชุชูุชุน IMaster ุ ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ ุงูุชู ุชุณุชุฏุนู ุงููุธุงุฆู ุงููุชุงุญุฉ ูุจููุฉ ูุงุฌูุฉ ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุ ุจุนูุฑ ุบูุฑ ูุญุฏูุฏ ุจุญูู ุงูุชุนุฑูู.  ุจุงููุณุจุฉ ููุงุฌูุงุช ุจุฑูุฌุฉ ุงูุชุทุจููุงุช ุงูุฃุฎุฑู ุ ูุชู ุชุญุฏูุฏ ุงูุนูุฑ ุจุฏูุฉ ุจูุงุณุทุฉ ุนูุฑ ุงููุงุฌูุฉ ุงูุฃุตู ุ  ูุงุฌูุฉ IStatus ููุณุช ูุฐูู <br>  ูุคุดุฑุงุช.  ุจุงููุณุจุฉ ูููุงุฌูุงุช ุฐุงุช ุงูุนูุฑ ุงููุญุฏูุฏ ุ ูู ุงููููุฏ ุฃู ูููู ูุฏูู ุทุฑููุฉ ุจุณูุทุฉ ูุชุฏููุฑูุง ุ ุฃู ูุธููุฉ ุงูุชุฎูุต (). </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ูุณุงุนุฏุฉ</strong> <br><br>  ุฅุฐุง ููุช ูุง ุชุนุฑู ููู ูุชู ุชุฏููุฑ ูุงุฆู ูุง ุ ูุฑุงุฌุน ุงูุชุณูุณู ุงููุฑูู ูู <br>  ูุงุฌูุฉ IReferenceCounted ุ ุซู ูุชู ุงุณุชุฎุฏุงู ูุฑุฌุน ุงูุนุฏ. <br>  ุจุงููุณุจุฉ ูููุงุฌูุงุช ุงูุชู ููุง ุญุณุงุจ ูุฑุฌุนู ุ ุนูุฏ ุงูุงูุชูุงุก ูู ุงูุนูู ูุน ูุงุฆู ุ ูู ุงูุถุฑูุฑู <br>  ุฅููุงุต ุงูุนุฏุงุฏ ุงููุฑุฌุน ุนู ุทุฑูู ุงุณุชุฏุนุงุก ุงูุฃุณููุจ release (). </blockquote><br><h2 id="obyavlenie-udr" style=";text-align:right;direction:rtl">  ุฅุนูุงู UDR </h2><br><p style=";text-align:right;direction:rtl">  ูููู ุฅุถุงูุฉ UDRs ุฃู ุฅุฒุงูุชูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุฃูุงูุฑ DDL ุ ุชูุงููุง ููุง ุชุถูู ุฃู ุชุฒูู ุฅุฌุฑุงุกุงุช ุฃู ูุธุงุฆู ุฃู ูุดุบูุงุช PSQL ุงูุนุงุฏูุฉ.  ูู ูุฐู ุงูุญุงูุฉ ุ ุจุฏูุงู ูู ูุต ุงููุดุบู ุ ุชุชู ุงูุฅุดุงุฑุฉ ุฅูู ูููุนู ูู ุงููุญุฏุฉ ุงูุฎุงุฑุฌูุฉ ุจุงุณุชุฎุฏุงู ุฌููุฉ EXTERNAL NAME. </p><br><p style=";text-align:right;direction:rtl">  ุงููุธุฑ ูู ุจูุงุก ุฌููุฉ ูุฐู ุงูุฌููุฉ ุ ูุณูู ุชููู ูุดุชุฑูุฉ ุจูู ุงูุฅุฌุฑุงุกุงุช ุงูุฎุงุฑุฌูุฉ ุ ูุธุงุฆู ุ ูุงููุดุบูุงุช. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุจูุงุก ุงูุฌููุฉ:</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">EXTERNAL NAME '&lt;extname&gt;' ENGINE &lt;engine&gt; [AS &lt;extbody&gt;] &lt;extname&gt; ::= '&lt;module name&gt;!&lt;routine name&gt;[!&lt;misc info&gt;]'</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููุณูุทุฉ ุฅูู ุฌููุฉ EXTERNAL NAME ุนุจุงุฑุฉ ุนู ุณูุณูุฉ ุชุดูุฑ ุฅูู ูููุน ุงููุธููุฉ ูู ุงููุญุฏุฉ ุงูููุทูุฉ ุงูุฎุงุฑุฌูุฉ.  ุจุงููุณุจุฉ ูููุญุฏุงุช ุงูุฎุงุฑุฌูุฉ ุงูุชู ุชุณุชุฎุฏู ูุญุฑู UDR ุ ูุดูุฑ ูุฐุง ุงูุฎุท ุนุจุฑ ุงููุงุตู ุฅูู ุงุณู ุงููุญุฏุฉ ุงูุฎุงุฑุฌูุฉ ูุงุณู ุงููุธููุฉ ุฏุงุฎู ุงููุญุฏุฉ ุงูููุทูุฉ ูุงููุนูููุงุช ุงููุนุฑูุฉ ูู ูุจู ุงููุณุชุฎุฏู.  ูุชู ุงุณุชุฎุฏุงู ุนูุงูุฉ ุชุนุฌุจ (!) ููุงุตู. </p><br><p style=";text-align:right;direction:rtl">  ุชุญุฏุฏ ุฌููุฉ Engine ุงุณู ุงููุญุฑู ููุนุงูุฌุฉ ุงุชุตุงู ุงููุญุฏุงุช ุงูุฎุงุฑุฌูุฉ.  ูุณุชุฎุฏู Firebird ูุญุฑู UDR ููุนูู ูุน ุงููุญุฏุงุช ุงูุฎุงุฑุฌูุฉ ุงูููุชูุจุฉ ุจูุบุงุช ูุชุฑุฌูุฉ (C ุ C ++ ุ Pascal).  ุชุชุทูุจ ุงููุธุงุฆู ุงูุฎุงุฑุฌูุฉ ุงูููุชูุจุฉ ุจูุบุฉ ุฌุงูุง ูุญุฑู ุฌุงูุง. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุงููููุฉ ุงูุฃุณุงุณูุฉ AS ุ ูููู ุชุญุฏูุฏ ุญุฑูู ุงูุณูุณูุฉ - "ูุต" ุงููุญุฏุฉ ุงูููุทูุฉ ุงูุฎุงุฑุฌูุฉ (ุงูุฅุฌุฑุงุก ุฃู ุงููุธููุฉ ุฃู ุงููุดุบู) ุ ููููู ุงุณุชุฎุฏุงูู ุจูุงุณุทุฉ ุงููุญุฏุฉ ุงูููุทูุฉ ุงูุฎุงุฑุฌูุฉ ูุฃุบุฑุงุถ ูุฎุชููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุฏ ูุชู ุชุญุฏูุฏ ุงุณุชุนูุงู SQL ูููุตูู ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช ุฃู ูุต ุฎุงุฑุฌู ูู ุจุนุถ ุงููุบุงุช ููุชุฑุฌูุฉ ุจูุงุณุทุฉ ูุธููุชู. </p><br><h3 id="vneshnie-funkcii" style=";text-align:right;direction:rtl">  ูุธุงุฆู ุฎุงุฑุฌูุฉ </h3><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุจูุงุก ุงูุฌููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{CREATE [OR ALTER] | RECREATE} FUNCTION funcname [(&lt;inparam&gt; [, &lt;inparam&gt; ...])] RETURNS &lt;type&gt; [COLLATE collation] [DETERMINISTIC] EXTERNAL NAME &lt;extname&gt; ENGINE &lt;engine&gt; [AS &lt;extbody&gt;] &lt;inparam&gt; ::= &lt;param_decl&gt; [{= |DEFAULT} &lt;value&gt;] &lt;value&gt; ::= {literal | NULL | context_var} &lt;param_decl&gt; ::= paramname &lt;type&gt; [NOT NULL] [COLLATE collation] &lt;extname&gt; ::= '&lt;module name&gt;!&lt;routine name&gt; [!&lt;misc info&gt;]' &lt;type&gt; ::= &lt;datatype&gt; | [TYPE OF] domain | TYPE OF COLUMN rel.col &lt;datatype&gt; ::= {SMALLINT | INT[EGER] | BIGINT} | BOOLEAN | {FLOAT | DOUBLE PRECISION} | {DATE | TIME | TIMESTAMP} | {DECIMAL | NUMERIC} [(precision [, scale])] | {CHAR | CHARACTER | CHARACTER VARYING | VARCHAR} [(size)] [CHARACTER SET charset] | {NCHAR |NATIONAL CHARACTER | NATIONAL CHAR} [VARYING] [(size)] | BLOB [SUB_TYPE {subtype_num | subtype_name}] [SEGMENT SIZE seglen] [CHARACTER SET charset] | BLOB [(seglen [, subtype_num])]</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูููู ุชุบููุฑ ุฌููุน ูุนููุงุช ุงููุธููุฉ ุงูุฎุงุฑุฌูุฉ ุจุงุณุชุฎุฏุงู ุนุจุงุฑุฉ ALTER FUNCTION. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุจูุงุก ุงูุฌููุฉ:</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ALTER FUNCTION funcname [(&lt;inparam&gt; [, &lt;inparam&gt; ...])] RETURNS &lt;type&gt; [COLLATE collation] [DETERMINISTIC] EXTERNAL NAME &lt;extname&gt; ENGINE &lt;engine&gt; [AS &lt;extbody&gt;] &lt;extname&gt; ::= '&lt;module name&gt;!&lt;routine name&gt;[!&lt;misc info&gt;]'</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุญุฐู ูุธููุฉ ุฎุงุฑุฌูุฉ ุจุงุณุชุฎุฏุงู ุนุจุงุฑุฉ DROP FUNCTION. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุจูุงุก ุงูุฌููุฉ:</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">DROP FUNCTION funcname</code> </pre> <br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><caption>  ุจุนุถ ุงููุนููุงุช ูุธููุฉ ุฎุงุฑุฌูุฉ </caption><thead><tr><th>  ูุนููุฉ </th><th>  ูุตู </th></tr></thead><tbody><tr><td>  funcname </td><td>  ุงุณู ุงููุธููุฉ ุงููุฎุฒูุฉ.  ูุฏ ุชุญุชูู ุนูู ูุง ูุตู ุฅูู 31 ุจุงูุช. </td></tr><tr><td>  inparam </td><td>  ูุตู ุงููุนููุฉ ุงูุฅุฏุฎุงู. </td></tr><tr><td>  ุงุณู ุงููุญุฏุฉ </td><td>  ุงุณู ุงููุญุฏุฉ ุงูุฎุงุฑุฌูุฉ ุงูุชู ุชูุฌุฏ ูููุง ุงููุธููุฉ. </td></tr><tr><td>  ุงูุงุณู ุงูุฑูุชููู </td><td>  ุงูุงุณู ุงูุฏุงุฎูู ูููุธููุฉ ุฏุงุฎู ุงููุญุฏุฉ ุงูุฎุงุฑุฌูุฉ. </td></tr><tr><td>  ูุนูููุงุช ูุชููุนุฉ </td><td>  ุงููุนูููุงุช ุงููุนุฑูุฉ ูู ูุจู ุงููุณุชุฎุฏู ููุชู ุฅุฑุณุงููุง ุฅูู <br>  ูุธููุฉ ุงููุญุฏุฉ ุงูุฎุงุฑุฌูุฉ. </td></tr><tr><td>  ูุญุฑู </td><td>  ุงุณู ุงููุญุฑู ูุงุณุชุฎุฏุงู ุงููุธุงุฆู ุงูุฎุงุฑุฌูุฉ.  ุนุงุฏุฉ ูุง ูููู ุงูุงุณู ูู UDR. </td></tr><tr><td>  extbody </td><td>  ุงูุฌุณู ูู ูุธููุฉ ุฎุงุฑุฌูุฉ.  ุณูุณูุฉ ุญุฑููุฉ ูููู ุงุณุชุฎุฏุงููุง ุจูุงุณุทุฉ UDR ูุฃุบุฑุงุถ ูุชุนุฏุฏุฉ. </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ููุง ูู ูุตู ุจูุงุก ุฌููุฉ ูุนููุงุช ุงูุฅุฏุฎุงู ูุงูุฅุฎุฑุงุฌ.  ูุชูุงูู ุจุดูู ูุงูู ูุน ุจูุงุก ุฌููุฉ ูุธุงุฆู PSQL ุงูุนุงุฏูุฉ ุ ูุงูุชู ุชู ูุตููุง ุจุงูุชูุตูู ูู ุฏููู ูุบุฉ SQL.  ุจุฏูุงู ูู ุฐูู ุ ููุฏู ุฃูุซูุฉ ุนูู ุงูุฅุนูุงู ุนู ุงููุธุงุฆู ุงูุฎุงุฑุฌูุฉ ูุน ุงูุชูุณูุฑุงุช. </p><br><p style=";text-align:right;direction:rtl">  <strong>ูุธููุฉ ุฅุถุงูุฉ ุซูุงุซ ุญุฌุฌ</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> sum_args ( n1 <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, n2 <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, n3 <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-string"><span class="hljs-string">'udrcpp_example!sum_args'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">engine</span></span> udr;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุทุจูู ุงููุธููุฉ ููุฌูุฏ ูู ุงููุญุฏุฉ ุงูููุทูุฉ udrcpp_example.  ุฏุงุฎู ูุฐู ุงููุญุฏุฉ ุ ูุชู ุชุณุฌูู ูุธููุฉ ุชุญุช ุงุณู sum_args.  ุชุณุชุฎุฏู ูุธููุฉ ุฎุงุฑุฌูุฉ ูุญุฑู UDR. </p><br><p style=";text-align:right;direction:rtl">  <strong>ูุธููุฉ ุฌุงูุง</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> regex_replace ( regex <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">str</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>), replacement <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-string"><span class="hljs-string">'org.firebirdsql.fbjava.examples.fbjava_example.FbRegex.replace( String, String, String)'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">engine</span></span> <span class="hljs-keyword"><span class="hljs-keyword">java</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูููุฐ ุงููุธููุฉ ููุฌูุฏ ูู ุงููุธููุฉ ุงูุซุงุจุชุฉ ุงูุชู ุชู <code>org.firebirdsql.fbjava.examples.fbjava_example.FbRegex</code> ูููุฆุฉ <code>org.firebirdsql.fbjava.examples.fbjava_example.FbRegex</code> .  ุชุณุชุฎุฏู ูุธููุฉ ุฎุงุฑุฌูุฉ ูุญุฑู ุฌุงูุง. </p><br><h3 id="vneshnie-procedury" style=";text-align:right;direction:rtl">  ุงูุฅุฌุฑุงุกุงุช ุงูุฎุงุฑุฌูุฉ </h3><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุจูุงุก ุงูุฌููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{CREATE [OR ALTER] | RECREATE} PROCEDURE procname [(&lt;inparam&gt; [, &lt;inparam&gt; ...])] RETURNS (&lt;outparam&gt; [&lt;outparam&gt; ...]) EXTERNAL NAME &lt;extname&gt; ENGINE &lt;engine&gt; [AS &lt;extbody&gt;] &lt;inparam&gt; ::= &lt;param_decl&gt; [{= | DEFAULT} &lt;value&gt;] &lt;outparam&gt; ::= &lt;param_decl&gt; &lt;value&gt; ::= {literal | NULL | context_var} &lt;param_decl&gt; ::= paramname &lt;type&gt; [NOT NULL] [COLLATE collation] &lt;extname&gt; ::= '&lt;module name&gt;!&lt;routine name&gt;[!&lt;misc info&gt;]' &lt;type&gt; ::= &lt;datatype&gt; | [TYPE OF] domain | TYPE OF COLUMN rel.col &lt;datatype&gt; ::= {SMALLINT | INT[EGER] | BIGINT} | BOOLEAN | {FLOAT | DOUBLE PRECISION} | {DATE | TIME | TIMESTAMP} | {DECIMAL | NUMERIC} [(precision [,scale])] | {CHAR | CHARACTER | CHARACTER VARYING | VARCHAR} [(size)] [CHARACTER SET charset] | {NCHAR | NATIONAL CHARACTER | NATIONAL CHAR} [VARYING] [(size)] | BLOB [SUB_TYPE {subtype_num | subtype_name}] [SEGMENT SIZE seglen] [CHARACTER SET charset] | BLOB [(seglen [, subtype_num])]</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูููู ุชุบููุฑ ุฌููุน ูุนููุงุช ุงูุฅุฌุฑุงุก ุงูุฎุงุฑุฌู ุจุงุณุชุฎุฏุงู ุนุจุงุฑุฉ ALTER PROCEDURE. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุจูุงุก ุงูุฌููุฉ:</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ALTER PROCEDURE procname [(&lt;inparam&gt; [, &lt;inparam&gt; ...])] RETURNS (&lt;outparam&gt; [, &lt;outparam&gt; ...]) EXTERNAL NAME &lt;extname&gt; ENGINE &lt;engine&gt; [AS &lt;extbody&gt;]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุญุฐู ุฅุฌุฑุงุก ุฎุงุฑุฌู ุจุงุณุชุฎุฏุงู ุนุจุงุฑุฉ DROP PROCEDURE. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุจูุงุก ุงูุฌููุฉ:</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">DROP PROCEDURE procname</code> </pre> <br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><caption>  ุจุนุถ ูุนุงูู ุงูุฅุฌุฑุงุก ุงูุฎุงุฑุฌู </caption><thead><tr><th>  ูุนููุฉ </th><th>  ูุตู </th></tr></thead><tbody><tr><td>  funcname </td><td>  ุงุณู ุงูุฅุฌุฑุงุก ุงููุฎุฒู.  ูุฏ ุชุญุชูู ุนูู ูุง ูุตู ุฅูู 31 ุจุงูุช. </td></tr><tr><td>  inparam </td><td>  ูุตู ุงููุนููุฉ ุงูุฅุฏุฎุงู. </td></tr><tr><td>  outparam </td><td>  ูุตู ุงููุนููุฉ ุงูุฅุฎุฑุงุฌ. </td></tr><tr><td>  ุงุณู ุงููุญุฏุฉ </td><td>  ุงุณู ุงููุญุฏุฉ ุงูููุทูุฉ ุงูุฎุงุฑุฌูุฉ ุงูุชู ููุฌุฏ ุจูุง ุงูุฅุฌุฑุงุก. </td></tr><tr><td>  ุงูุงุณู ุงูุฑูุชููู </td><td>  ุงูุงุณู ุงูุฏุงุฎูู ููุฅุฌุฑุงุก ุฏุงุฎู ุงููุญุฏุฉ ุงูุฎุงุฑุฌูุฉ. </td></tr><tr><td>  ูุนูููุงุช ูุชููุนุฉ </td><td>  ุงููุนูููุงุช ุงููุนุฑูุฉ ูู ูุจู ุงููุณุชุฎุฏู ููุชู ุฅุฑุณุงููุง ุฅูู <br>  ุฅุฌุฑุงุก ูุญุฏุฉ ุฎุงุฑุฌูุฉ. </td></tr><tr><td>  ูุญุฑู </td><td>  ุงุณู ุงููุญุฑู ูุงุณุชุฎุฏุงู ุงูุฅุฌุฑุงุกุงุช ุงูุฎุงุฑุฌูุฉ.  ุนุงุฏุฉ ูุง ูููู ุงูุงุณู ูู UDR. </td></tr><tr><td>  extbody </td><td>  ุฌุณู ุงูุฅุฌุฑุงุก ุงูุฎุงุฑุฌู.  ุณูุณูุฉ ุญุฑููุฉ ูููู ุงุณุชุฎุฏุงููุง ุจูุงุณุทุฉ UDR ูุฃุบุฑุงุถ ูุชุนุฏุฏุฉ. </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ููุง ูู ูุตู ุจูุงุก ุฌููุฉ ูุนููุงุช ุงูุฅุฏุฎุงู ูุงูุฅุฎุฑุงุฌ.  ูุชูุงูู ุจุดูู ูุงูู ูุน ุจูุงุก ุฌููุฉ ุฅุฌุฑุงุกุงุช PSQL ุงููุนุชุงุฏุฉ ุ ุงูููุตููุฉ ุจุงูุชูุตูู ูู ุฏููู ูุบุฉ SQL.  ุจุฏูุงู ูู ุฐูู ุ ููุฏู ุฃูุซูุฉ ูุฅุนูุงู ุงูุฅุฌุฑุงุกุงุช ุงูุฎุงุฑุฌูุฉ ูุน ุงูุชูุณูุฑุงุช. </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span> gen_rows_pascal ( start_n <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>, end_n <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">result</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-string"><span class="hljs-string">'pascaludr!gen_rows'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">engine</span></span> udr;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูููุฐ ุงููุธููุฉ ูู ูุญุฏุฉ pascaludr.  ุฏุงุฎู ูุฐู ุงููุญุฏุฉ ุ ูุชู ุชุณุฌูู ุงูุฅุฌุฑุงุก ุจุงุณู gen_rows.  ูุณุชุฎุฏู ุฅุฌุฑุงุก ุฎุงุฑุฌู ูุญุฑู UDR. </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span> write_log ( message <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-string"><span class="hljs-string">'pascaludr!write_log'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">engine</span></span> udr;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชูููุฐ ุงููุธููุฉ ูู ูุญุฏุฉ pascaludr.  ุฏุงุฎู ูุฐู ุงููุญุฏุฉ ุ ูุชู ุชุณุฌูู ุงูุฅุฌุฑุงุก ุชุญุช ุงุณู write_log.  ูุณุชุฎุฏู ุฅุฌุฑุงุก ุฎุงุฑุฌู ูุญุฑู UDR. </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span> employee_pgsql ( <span class="hljs-comment"><span class="hljs-comment">-- Firebird 3.0.0 has a bug with external procedures without parameters dummy integer = 1 ) returns ( id type of column employee.id, name type of column employee.name ) external name 'org.firebirdsql.fbjava.examples.fbjava_example.FbJdbc .executeQuery()!jdbc:postgresql:employee|postgres|postgres' engine java as 'select * from employee';</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชูููุฐ ุงูุฏุงูุฉ ูู ุงูุฏุงูุฉ ุงูุซุงุจุชุฉ executeQuery ูููุฆุฉ <br>  <code>org.firebirdsql.fbjava.examples.fbjava_example.FbJdbc</code> .  ุจุนุฏ ุนูุงูุฉ ุงูุชุนุฌุจ (!) ุ ุชูุฌุฏ ุงููุนูููุงุช ููุงุชุตุงู ุจูุงุนุฏุฉ ุจูุงูุงุช ุฎุงุฑุฌูุฉ ุนุจุฑ JDBC.  ุชุณุชุฎุฏู ูุธููุฉ ุฎุงุฑุฌูุฉ ูุญุฑู ุฌุงูุง.  ููุง ุ ุจุงุนุชุจุงุฑู "ูุตูุง" ูุฅุฌุฑุงุก ุฎุงุฑุฌู ุ ูุชู ุชูุฑูุฑ ุงุณุชุนูุงู SQL ูุงุณุชุฑุฏุงุฏ ุงูุจูุงูุงุช. </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>  ูุณุชุฎุฏู ูุฐุง ุงูุฅุฌุฑุงุก ูุนุจ ุฑูุชูู ูุชู ููู ุชูุฑูุฑ ูุนููุฉ ุบูุฑ ูุณุชุฎุฏูุฉ.  ูุฐุง ูุฑุฌุน ุฅูู ุญูููุฉ ุฃู ูู Firebird 3.0 ููุงู ุฎูู ูู ูุนุงูุฌุฉ ุงูุฅุฌุฑุงุกุงุช ุงูุฎุงุฑุฌูุฉ ุฏูู ูุนููุงุช. </blockquote><br><h3 id="razmeschenie-vneshnih-procedur-i-funkciy-vnutri-paketov" style=";text-align:right;direction:rtl">  ูุถุน ุงูุฅุฌุฑุงุกุงุช ูุงููุธุงุฆู ุงูุฎุงุฑุฌูุฉ ุฏุงุฎู ุงูุญุฒู </h3><br><p style=";text-align:right;direction:rtl">  ูู ุงูููุงุณุจ ูุถุน ูุฌููุนุฉ ูู ุงูุฅุฌุฑุงุกุงุช ูุงููุธุงุฆู ุงููุชุฑุงุจุทุฉ ูู ุญุฒู PSQL.  ูููู ุฃู ุชุญุชูู ุงูุญุฒู ุนูู ุฅุฌุฑุงุกุงุช ููุธุงุฆู PSQL ุฎุงุฑุฌูุฉ ูููุชุธูุฉ. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุจูุงุก ุงูุฌููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{CREATE [OR ALTER] | RECREATE} PACKAGE package_name AS BEGIN [&lt;package_item&gt; ...] END {CREATE | RECREATE} PACKAGE BODY package_name AS BEGIN [&lt;package_item&gt; ...] [&lt;package_body_item&gt; ...] END &lt;package_item&gt; ::= &lt;function_decl&gt;; | &lt;procedure_decl&gt;; &lt;function_decl&gt; ::= FUNCTION func_name [(&lt;in_params&gt;)] RETURNS &lt;type&gt; [COLLATE collation] [DETERMINISTIC] &lt;procedure_decl&gt; ::= PROCEDURE proc_name [(&lt;in_params&gt;)] [RETURNS (&lt;out_params&gt;)] &lt;package_body_item&gt; ::= &lt;function_impl&gt; | &lt;procedure_impl&gt; &lt;function_impl&gt; ::= FUNCTION func_name [(&lt;in_impl_params&gt;)] RETURNS &lt;type&gt; [COLLATE collation] [DETERMINISTIC] &lt;routine body&gt; &lt;procedure_impl&gt; ::= PROCEDURE proc_name [(&lt;in_impl_params&gt;)] [RETURNS (&lt;out_params&gt;)] &lt;routine body&gt; &lt;routine body&gt; ::= &lt;sql routine body&gt; | &lt;external body reference&gt; &lt;sql routine body&gt; ::= AS   [&lt;declarations&gt;] BEGIN [&lt;PSQL_statements&gt;]   END &lt;declarations&gt; ::= &lt;declare_item&gt; [&lt;declare_item&gt; ...] &lt;declare_item&gt; ::= &lt;declare_var&gt;; | &lt;declare_cursor&gt;; | &lt;subroutine declaration&gt;; | &lt;subroutine implimentation&gt; &lt;subroutine declaration&gt; ::= &lt;subfunc_decl&gt; | &lt;subproc_decl&gt; &lt;subroutine implimentation&gt; ::= &lt;subfunc_impl&gt; | &lt;subproc_impl&gt; &lt;external body reference&gt; ::= EXTERNAL NAME &lt;extname&gt; ENGINE &lt;engine&gt; [AS &lt;extbody&gt;] &lt;extname&gt; ::= '&lt;module name&gt;!&lt;routine name&gt;[!&lt;misc info&gt;]'</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ุฅูู ุงูุฅุฌุฑุงุกุงุช ูุงููุธุงุฆู ุงูุฎุงุฑุฌูุฉ ุ ูุดุงุฑ ุฅูู ุงุณู ุงูุญุฒูุฉ ููุนููุงุช ุงูุฅุฏุฎุงู ูุฃููุงุนูุง ูููููุง ุงูุงูุชุฑุงุถูุฉ ููุนููุงุช ุงูุฅุฎุฑุงุฌ ูู ุฑุฃุณ ุงูุญุฒูุฉ ุ ููููู ูู ุดูุก ูู ููุณู ูู ูุต ุงูุญุฒูุฉ ุจุงุณุชุซูุงุก ุงูููู ุงูุงูุชุฑุงุถูุฉ ุ ููุฐูู ุงููููุน ูู ุงููุญุฏุฉ ุงูููุทูุฉ ุงูุฎุงุฑุฌูุฉ (ุฌููุฉ EXAMEAL NAME) ุ ูุงุณู ุงููุญุฑู ุ ูุฑุจูุง "ูุต" ุงูุฅุฌุฑุงุก / ุงููุธููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุชุฑุถ ุฃูู ูุชุจุช UDR ููุชุนุงูู ูุน ุงูุชุนุจูุฑุงุช ุงูุนุงุฏูุฉ ุ ุงูููุฌูุฏุฉ ูู ุงููุญุฏุฉ ุงูุฎุงุฑุฌูุฉ (ุงูููุชุจุฉ ุงูุฏููุงููููุฉ) ุงูุฎุงุตุฉ ุจู PCRE ุ ููุฏูู ุงูุนุฏูุฏ ูู UDRs ุงูุชู ุชุคุฏู ููุงู ุฃุฎุฑู.  ุฅุฐุง ูู ูุณุชุฎุฏู ุญุฒู PSQL ุ ูุณูุชู ุฎูุท ุฌููุน ุงูุฅุฌุฑุงุกุงุช ูุงููุธุงุฆู ุงูุฎุงุฑุฌูุฉ ูุน ุจุนุถูุง ุงูุจุนุถ ููุน ุงูุฅุฌุฑุงุกุงุช ูุงููุธุงุฆู ุงูุนุงุฏูุฉ ูู PSQL.  ูุคุฏู ูุฐุง ุฅูู ุชุนููุฏ ุงูุจุญุซ ุนู ุงูุชุจุนูุงุช ูุฅุฌุฑุงุก ุชุบููุฑุงุช ุนูู ุงููุญุฏุงุช ุงูุฎุงุฑุฌูุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ูุคุฏู ุฅูู ุญุฏูุซ ุงุฑุชุจุงู ูููุฑุถ ุนูู ุงูุฃูู ุงุณุชุฎุฏุงู ุงูุจุงุฏุฆุงุช ูุชุฌููุน ุงูุฅุฌุฑุงุกุงุช ูุงููุธุงุฆู.  ุญุฒู PSQL ุชุฌุนู ูุฐู ุงููููุฉ ุฃุณูู ุจูุซูุฑ ุจุงููุณุจุฉ ููุง. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุญุฒูุฉ RegExp</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> TERM ^; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PACKAGE</span></span> REGEXP <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> preg_match( APattern <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8192</span></span>), ASubject <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8192</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> (Matches <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8192</span></span>)); FUNCTION preg_is_match( APattern VARCHAR(8192), ASubject VARCHAR(8192)) RETURNS BOOLEAN; FUNCTION preg_replace( APattern VARCHAR(8192), AReplacement VARCHAR(8192), ASubject VARCHAR(8192)) RETURNS VARCHAR(8192); PROCEDURE preg_split( APattern VARCHAR(8192), ASubject VARCHAR(8192)) RETURNS (Lines VARCHAR(8192)); FUNCTION preg_quote( AStr VARCHAR(8192), ADelimiter CHAR(10) DEFAULT NULL) RETURNS VARCHAR(8192); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>^ RECREATE <span class="hljs-keyword"><span class="hljs-keyword">PACKAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span> REGEXP <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> preg_match( APattern <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8192</span></span>), ASubject <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8192</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> (Matches <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8192</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">EXTERNAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-string"><span class="hljs-string">'PCRE!preg_match'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> UDR; FUNCTION preg_is_match( APattern VARCHAR(8192), ASubject VARCHAR(8192)) RETURNS BOOLEAN AS <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> preg_match(:APattern, :ASubject)); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> preg_replace( APattern <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8192</span></span>), AReplacement <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8192</span></span>), ASubject <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8192</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">8192</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">EXTERNAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-string"><span class="hljs-string">'PCRE!preg_replace'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> UDR; PROCEDURE preg_split( APattern VARCHAR(8192), ASubject VARCHAR(8192)) RETURNS (Lines VARCHAR(8192)) EXTERNAL NAME 'PCRE!preg_split' ENGINE UDR; FUNCTION preg_quote( AStr VARCHAR(8192), ADelimiter CHAR(10)) RETURNS VARCHAR(8192) EXTERNAL NAME 'PCRE!preg_quote' ENGINE UDR; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>^ <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> TERM ;^</code> </pre> </div></div><br><h3 id="vneshnie-triggery" style=";text-align:right;direction:rtl">  ูุดุบูุงุช ุงูุฎุงุฑุฌูุฉ </h3><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุจูุงุก ุงูุฌููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">{CREATE [OR ALTER] | RECREATE} TRIGGER trigname {&lt;relation_trigger_legacy&gt; | &lt;relation_trigger_sql2003&gt; | &lt;database_trigger&gt; | &lt;ddl_trigger&gt; } &lt;external-body&gt; &lt;external-body&gt; ::= EXTERNAL NAME &lt;extname&gt; ENGINE &lt;engine&gt; [AS &lt;extbody&gt;] &lt;relation_trigger_legacy&gt; ::= FOR {tablename | viewname} [ACTIVE | INACTIVE] {BEFORE | AFTER} &lt;mutation_list&gt; [POSITION number] &lt;relation_trigger_sql2003&gt; ::= [ACTIVE | INACTIVE] {BEFORE | AFTER} &lt;mutation_list&gt; [POSITION number] ON {tablename | viewname} &lt;database_trigger&gt; ::= [ACTIVE | INACTIVE] ON db_event [POSITION number] &lt;ddl_trigger&gt; ::= [ACTIVE | INACTIVE] {BEFORE | AFTER} &lt;ddl_events&gt; [POSITION number] &lt;mutation_list&gt; ::= &lt;mutation&gt; [OR &lt;mutation&gt; [OR &lt;mutation&gt;]] &lt;mutation&gt; ::= INSERT | UPDATE | DELETE &lt;db_event&gt; ::= CONNECT | DISCONNECT | TRANSACTION START | TRANSACTION COMMIT | TRANSACTION ROLLBACK &lt;ddl_events&gt; ::= ANY DDL STATEMENT | &lt;ddl_event_item&gt; [{OR &lt;ddl_event_item&gt;} ...] &lt;ddl_event_item&gt; ::= CREATE TABLE | ALTER TABLE | DROP TABLE | CREATE PROCEDURE | ALTER PROCEDURE | DROP PROCEDURE | CREATE FUNCTION | ALTER FUNCTION | DROP FUNCTION | CREATE TRIGGER | ALTER TRIGGER | DROP TRIGGER | CREATE EXCEPTION | ALTER EXCEPTION | DROP EXCEPTION | CREATE VIEW | ALTER VIEW | DROP VIEW | CREATE DOMAIN | ALTER DOMAIN | DROP DOMAIN | CREATE ROLE | ALTER ROLE | DROP ROLE | CREATE SEQUENCE | ALTER SEQUENCE | DROP SEQUENCE | CREATE USER | ALTER USER | DROP USER | CREATE INDEX | ALTER INDEX | DROP INDEX | CREATE COLLATION | DROP COLLATION | ALTER CHARACTER SET | CREATE PACKAGE | ALTER PACKAGE | DROP PACKAGE | CREATE PACKAGE BODY | DROP PACKAGE BODY | CREATE MAPPING | ALTER MAPPING | DROP MAPPING</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุชุบููุฑ ุงููุดุบู ุงูุฎุงุฑุฌู ุจุงุณุชุฎุฏุงู ุนุจุงุฑุฉ ALTER TRIGGER. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุจูุงุก ุงูุฌููุฉ:</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ALTER TRIGGER trigname { [ACTIVE | INACTIVE] [ {BEFORE | AFTER} {&lt;mutation_list&gt; | &lt;ddl_events&gt;} | ON db_event ] [POSITION number] [&lt;external-body&gt;] &lt;external-body&gt; ::= EXTERNAL NAME &lt;extname&gt; ENGINE &lt;engine&gt; [AS &lt;extbody&gt;] &lt;extname&gt; ::= '&lt;module name&gt;!&lt;routine name&gt;[!&lt;misc info&gt;]' &lt;mutation_list&gt; ::= &lt;mutation&gt; [OR &lt;mutation&gt; [OR &lt;mutation&gt;]] &lt;mutation&gt; ::= { INSERT | UPDATE | DELETE }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ููููู ุฅุฒุงูุฉ ุงููุดุบู ุงูุฎุงุฑุฌู ุจุงุณุชุฎุฏุงู ุนุจุงุฑุฉ DROP TRIGGER. </p><br><p style=";text-align:right;direction:rtl">  <strong>ุจูุงุก ุงูุฌููุฉ:</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">DROP TRIGGER trigname</code> </pre> <br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><thead><tr><th>  ูุนููุฉ </th><th>  ูุตู </th></tr></thead><tbody><tr><td>  trigname </td><td>  ุงุณู ุงูุฒูุงุฏ.  ูุฏ ุชุญุชูู ุนูู ูุง ูุตู ุฅูู 31 ุจุงูุช. </td></tr><tr><td>  relation_trigger_legacy </td><td>  ุฅุนูุงู ุฌุฏูู ุงูุฒูุงุฏ (ููุฑูุซ). </td></tr><tr><td>  relation_trigger_sql2003 </td><td>  ุงูุฅุนูุงู ุนู ุฌุฏูู ุชุดุบูู ููููุง ููุนูุงุฑ SQL-2003. </td></tr><tr><td>  database_trigger </td><td>  ุฅุนูุงู ูุงุนุฏุฉ ุจูุงูุงุช ุงููุดุบู. </td></tr><tr><td>  ddl_trigger </td><td>  ุฅุนูุงู ูุดุบู DDL. </td></tr><tr><td>  TABLENAME </td><td>  ุงุณู ุงูุฌุฏูู. </td></tr><tr><td>  VIEWNAME </td><td>  ุงุณู ุงูุฑุฃู. </td></tr><tr><td>  mutation_list </td><td>  ูุงุฆูุฉ ุงูุฃุญุฏุงุซ ุงูุฌุฏูู. </td></tr><tr><td>  ุชุญูู </td><td>  ูุงุญุฏุฉ ูู ุฃุญุฏุงุซ ุงูุฌุฏูู. </td></tr><tr><td>  db_event </td><td>  ุงุชุตุงู ุฃู ุญุฏุซ ุงููุนุงููุฉ. </td></tr><tr><td>  ddl_events </td><td>  ูุงุฆูุฉ ุงูุฃุญุฏุงุซ ุชุบููุฑ ุงูุจูุงูุงุช ุงูุชุนุฑูููุฉ. </td></tr><tr><td>  ddl_event_item </td><td>  ุชุบููุฑ ุฃุญุฏ ุจูุงูุงุช ุงูุชุนุฑูู ุงูุฃุญุฏุงุซ. </td></tr><tr><td>  ุนุฏุฏ </td><td>  ุชุฑุชูุจ ุงูุฒูุงุฏ.  0 ุฅูู 32767 </td></tr><tr><td>  extbody </td><td>  ุฌุณู ุงูุฒูุงุฏ ุงูุฎุงุฑุฌู.  ุณูุณูุฉ ุญุฑููุฉ ูููู ุงุณุชุฎุฏุงููุง ุจูุงุณุทุฉ UDR ูุฃุบุฑุงุถ ูุชุนุฏุฏุฉ. </td></tr><tr><td>  ุงุณู ุงููุญุฏุฉ </td><td>  ุงุณู ุงููุญุฏุฉ ุงูุฎุงุฑุฌูุฉ ุงูุชู ููุฌุฏ ุจูุง ุงููุดุบู. </td></tr><tr><td>  ุงูุงุณู ุงูุฑูุชููู </td><td>  ุงูุงุณู ุงูุฏุงุฎูู ูููุดุบู ุฏุงุฎู ุงููุญุฏุฉ ุงูุฎุงุฑุฌูุฉ. </td></tr><tr><td>  ูุนูููุงุช ูุชููุนุฉ </td><td>  ุงููุนูููุงุช ุงููุนุฑูุฉ ูู ูุจู ุงููุณุชุฎุฏู ูููููุง ุฅูู ูุดุบู ูุญุฏุฉ ุฎุงุฑุฌูุฉ. </td></tr><tr><td>  ูุญุฑู </td><td>  ุงุณู ุงููุญุฑู ูุงุณุชุฎุฏุงู ุงููุดุบูุงุช ุงูุฎุงุฑุฌูุฉ.  ุนุงุฏุฉ ูุง ูููู ุงูุงุณู ูู UDR. </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ูููุง ููู ุฃูุซูุฉ ูุฅุนูุงู ุงููุดุบูุงุช ุงูุฎุงุฑุฌูุฉ ูุน ุงูุชูุณูุฑุงุช. </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-string"><span class="hljs-string">'c:\temp\slave.fdb'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> persons ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>, address <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>), info <span class="hljs-built_in"><span class="hljs-built_in">blob</span></span> sub_type <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-string"><span class="hljs-string">'c:\temp\master.fdb'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> persons ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>, address <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">60</span></span>), info <span class="hljs-built_in"><span class="hljs-built_in">blob</span></span> sub_type <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> replicate_config ( <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">31</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>, data_source <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> replicate_config (<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, data_source) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-string"><span class="hljs-string">'ds1'</span></span>, <span class="hljs-string"><span class="hljs-string">'c:\temp\slave.fdb'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trigger</span></span> persons_replicate <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> persons <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-string"><span class="hljs-string">'udrcpp_example!replicate!ds1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">engine</span></span> udr;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุทุจูู ุงููุดุบู ููุฌูุฏ ูู ุงููุญุฏุฉ ุงูููุทูุฉ udrcpp_example.  ุฏุงุฎู ูุฐู ุงููุญุฏุฉ ุ ูุชู ุชุณุฌูู ุงููุดุบู ุชุญุช ุงุณู ุงููุณุฎ ุงููุชูุงุซู.  ูุณุชุฎุฏู ุงููุดุบู ุงูุฎุงุฑุฌู ูุญุฑู UDR. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุงุฑุชุจุงุท ุจุงููุญุฏุฉ ุงูุฎุงุฑุฌูุฉ ุ <code>ds1</code> ูุนููุฉ ุฅุถุงููุฉ <code>ds1</code> ุ ูุงูุชู ุจููุฌุจูุง ุชุชู ูุฑุงุกุฉ ุงูุชูููู ูู ุฌุฏูู <em>ุงููุณุฎ ุงููุชูุงุซู</em> ุฏุงุฎู ุงููุดุบู ุงูุฎุงุฑุฌู ููุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฎุงุฑุฌูุฉ. </p><br><h2 id="struktura-udr" style=";text-align:right;direction:rtl">  ูููู UDR </h2><br><p style=";text-align:right;direction:rtl">  ููุฏ ุญุงู ุงูููุช ููุชุงุจุฉ UDR ุงูุฃูู.  ุณูููู ุจูุตู ูููู UDR ูู ุจุงุณูุงู.  ูุดุฑุญ ุงููููู ุงูุฃุฏูู ูุจูุงุก UDR ุ ุณูู ูุณุชุฎุฏู ุฃูุซูุฉ ููุงุณูุฉ ูู <code>examples/udr/</code> ุงููุชุฑุฌูุฉ ุฅูู Pascal. </p><br><p style=";text-align:right;direction:rtl">  ูู ุจุฅูุดุงุก ูุดุฑูุน ุฌุฏูุฏ ููููุชุจุฉ ุงูุฏููุงููููุฉ ุงูุฌุฏูุฏุฉ ุ ูุงูุชู ุณูู ูุณูููุง MyUdr.  ูุชูุฌุฉ ูุฐูู ุ ูุฌุจ ุฃู ุชุญุตู ุนูู ุงูููู <code>MyUdr.dpr</code> (ุฅุฐุง ููุช ุจุฅูุดุงุก ุงููุดุฑูุน ูู ุฏููู) ุฃู ุงูููู <code>MyUdr.lpr</code> (ุฅุฐุง ููุช ูุฏ ุฃูุดุฃุช ุงููุดุฑูุน ูู Lazarus).  ุงูุขู ุฏุนููุง ูุบูุฑ ููู ุงููุดุฑูุน ุงูุฑุฆูุณู ุจุญูุซ ูุจุฏู ูุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">library</span></span> MyUdr; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE DELPHI}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> <span class="hljs-meta"><span class="hljs-meta">{$IFDEF unix}</span></span> cthreads, <span class="hljs-comment"><span class="hljs-comment">// the c memory manager is on some systems much faster for multi-threading cmem, {$ENDIF} UdrInit in 'UdrInit.pas', SumArgsFunc in 'SumArgsFunc.pas'; exports firebird_udr_plugin; end.</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูุญุงูุฉ ุ ุชุญุชุงุฌ ุฅูู ุชุตุฏูุฑ ูุธููุฉ <code>firebird_udr_plugin</code> ูุงุญุฏุฉ ููุท ุ ููู ููุทุฉ ุฅุฏุฎุงู ุงูููููุงุช ุงูุฅุถุงููุฉ ููุญุฏุงุช UDR ุงูุฎุงุฑุฌูุฉ.  ุณูุชู ุชูููุฐ ูุฐู ุงููุธููุฉ ูู ูุญุฏุฉ UdrInit. </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>  ุฅุฐุง ููุช ุชููู ุจุชุทููุฑ UDR ูู Free Pascal ุ ูุณุชุญุชุงุฌ ุฅูู ุชูุฌููุงุช ุฅุถุงููุฉ.  <code>{$mode objfpc}</code> ูุทููุจ ูุชูููู ูุถุน Pascal Object.  ุจุฏูุงู ูู ุฐูู ุ ููููู ุงุณุชุฎุฏุงู ุงูุชูุฌูู <code>{$mode delphi}</code> ูุถูุงู ุงูุชูุงูู ูุน Delphi.  ูุธุฑูุง ูุฃูู ููุจุบู ุชุฌููุน ุงูุฃูุซูุฉ ุงูุฎุงุตุฉ ุจู ุจูุฌุงุญ ูู ูู ูู FPC ู Delphi ุ ุงุฎุชุฑุช <code>{$mode delphi}</code> . <br><br>  ูุชุถูู ุงูุชูุฌูู <code>{$H+}</code> ุฏุนู ุณูุงุณู ุทูููุฉ.  ูุนุฏ ูุฐุง ุถุฑูุฑููุง ุฅุฐุง ููุช ุชุณุชุฎุฏู ุณูุณูุฉ ุงูุฃููุงุน ุ ูุฎุท ุงูููุงูุฉ ุ ูููุณ ููุท ุงูุณูุงุณู ุฐุงุช ุงูููุงูุฉ ุงููุงุฑุบุฉ PChar ู PAnsiChar ู PWideChar. <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุณูุญุชุงุฌ ุฅูู ุชูุตูู ูุญุฏุงุช ูููุตูุฉ ูุฏุนู ุชุนุฏุฏ ูุคุดุฑุงุช ุงูุชุฑุงุจุท ุนูู Linux ูุฃูุธูุฉ ุงูุชุดุบูู ุงูุฃุฎุฑู ุงููุดุงุจูุฉ ูู Unix. </blockquote><br><h3 id="registraciya-procedur-funkciy-ili-triggerov" style=";text-align:right;direction:rtl">  ุชุณุฌูู ุงูุฅุฌุฑุงุกุงุช ุฃู ุงููุธุงุฆู ุฃู ุงููุดุบูุงุช </h3><br><p style=";text-align:right;direction:rtl">  ุฃุถู ุงูุขู ูุญุฏุฉ UdrInit ุ ูุฌุจ ุฃู ุชุจุฏู ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UdrInit; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE DELPHI}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Firebird; <span class="hljs-comment"><span class="hljs-comment">//    External Engine  UDR function firebird_udr_plugin(AStatus: IStatus; AUnloadFlagLocal: BooleanPtr; AUdrPlugin: IUdrPlugin): BooleanPtr; cdecl; implementation uses SumArgsFunc; var myUnloadFlag: Boolean; theirUnloadFlag: BooleanPtr; function firebird_udr_plugin(AStatus: IStatus; AUnloadFlagLocal: BooleanPtr; AUdrPlugin: IUdrPlugin): BooleanPtr; cdecl; begin //    AUdrPlugin.registerFunction(AStatus, 'sum_args', TSumArgsFunctionFactory.Create()); //    //AUdrPlugin.registerProcedure(AStatus, 'sum_args_proc', // TSumArgsProcedureFactory.Create()); //AUdrPlugin.registerProcedure(AStatus, 'gen_rows', TGenRowsFactory.Create()); //    //AUdrPlugin.registerTrigger(AStatus, 'test_trigger', // TMyTriggerFactory.Create()); theirUnloadFlag := AUnloadFlagLocal; Result := @myUnloadFlag; end; initialization myUnloadFlag := false; finalization if ((theirUnloadFlag &lt;&gt; nil) and not myUnloadFlag) then theirUnloadFlag^ := true; end.</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุธููุฉ <code>firebird_udr_plugin</code> ุ <code>firebird_udr_plugin</code> ุงูุถุฑูุฑู ุชุณุฌูู ุงููุตุงูุน ุงูุฎุงุตุฉ ุจุงูุฅุฌุฑุงุกุงุช ูุงููุธุงุฆู ูุงููุดุบูุงุช ุงูุฎุงุฑุฌูุฉ ุงูุฎุงุตุฉ ุจูุง.  ููู ูุธููุฉ ุฃู ุฅุฌุฑุงุก ุฃู ูุดุบู ุ ูุฌุจ ุนููู ูุชุงุจุฉ ุงููุตูุน ุงูุฎุงุต ุจู.  ูุชู ุฐูู ุจุงุณุชุฎุฏุงู ุฃุณุงููุจ ูุงุฌูุฉ IUdrPlugin: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> registerFunction โ   ; </li><li style=";text-align:right;direction:rtl"> registerProcedure โ   ; </li><li style=";text-align:right;direction:rtl"> registerTrigger โ   . </li></ul><br><p style=";text-align:right;direction:rtl">         ,      (  ).       //  SQL.         (  ). </p><br><h3 id="realizaciya-vneshney-funkcii" style=";text-align:right;direction:rtl">    </h3><br><p style=";text-align:right;direction:rtl">       .      SumArgsFunc.         . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">   SumArgsFunc</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> SumArgsFunc; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE DELPHI}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Firebird; <span class="hljs-comment"><span class="hljs-comment">// ********************************************************* // create function sum_args ( // n1 integer, // n2 integer, // n3 integer // ) returns integer // external name 'myudr!sum_args' // engine udr; // ********************************************************* type //        TSumArgsInMsg = record n1: Integer; n1Null: WordBool; n2: Integer; n2Null: WordBool; n3: Integer; n3Null: WordBool; end; PSumArgsInMsg = ^TSumArgsInMsg; //        TSumArgsOutMsg = record result: Integer; resultNull: WordBool; end; PSumArgsOutMsg = ^TSumArgsOutMsg; //       TSumArgsFunction TSumArgsFunctionFactory = class(IUdrFunctionFactoryImpl) //     procedure dispose(); override; {          .        . @param(AStatus  ) @param(AContext    ) @param(AMetadata   ) @param(AInBuilder     ) @param(AOutBuilder     ) } procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder: IMetadataBuilder; AOutBuilder: IMetadataBuilder); override; {      TSumArgsFunction @param(AStatus  ) @param(AContext    ) @param(AMetadata   ) @returns(  ) } function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalFunction; override; end; //   TSumArgsFunction. TSumArgsFunction = class(IExternalFunctionImpl) //      procedure dispose(); override; {      execute             .        ,   ExternalEngine::getCharSet. @param(AStatus  ) @param(AContext    ) @param(AName   ) @param(AName    ) } procedure getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); override; {    @param(AStatus  ) @param(AContext    ) @param(AInMsg    ) @param(AOutMsg    ) } procedure execute(AStatus: IStatus; AContext: IExternalContext; AInMsg: Pointer; AOutMsg: Pointer); override; end; implementation { TSumArgsFunctionFactory } procedure TSumArgsFunctionFactory.dispose; begin Destroy; end; function TSumArgsFunctionFactory.newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalFunction; begin Result := TSumArgsFunction.Create(); end; procedure TSumArgsFunctionFactory.setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder, AOutBuilder: IMetadataBuilder); begin end; { TSumArgsFunction } procedure TSumArgsFunction.dispose; begin Destroy; end; procedure TSumArgsFunction.execute(AStatus: IStatus; AContext: IExternalContext; AInMsg, AOutMsg: Pointer); var xInput: PSumArgsInMsg; xOutput: PSumArgsOutMsg; begin //         xInput := PSumArgsInMsg(AInMsg); xOutput := PSumArgsOutMsg(AOutMsg); //     NULL    NULL xOutput^.resultNull := xInput^.n1Null or xInput^.n2Null or xInput^.n3Null; xOutput^.result := xInput^.n1 + xInput^.n2 + xInput^.n3; end; procedure TSumArgsFunction.getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); begin end; end.</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">       IUdrFunctionFactory.      IUdrFunctionFactoryImpl.       . ,         ,        .       . </p><br><p style=";text-align:right;direction:rtl">  dispose    ,        .      . </p><br><p style=";text-align:right;direction:rtl">  setup          .            ,        .      . </p><br><p style=";text-align:right;direction:rtl">  newItem      .        ,       .   IRoutineMetadata        ,      .                 PSQL.           .          <code>TSumArgsFunction</code> . </p><br><p style=";text-align:right;direction:rtl">      IExternalFunction.      <code>IExternalFunctionImpl</code> . </p><br><p style=";text-align:right;direction:rtl">  dispose     ,        .      . </p><br><p style=";text-align:right;direction:rtl">      . </p><br><p style=";text-align:right;direction:rtl">  getCharSet   ,             .       ,               . </p><br><p style=";text-align:right;direction:rtl">  execute     .        ,     ,      . </p><br><p style=";text-align:right;direction:rtl">             .             ,        ,      BLOB.     BLOB,          . </p><br><p style=";text-align:right;direction:rtl">       ,            .         ,      .   ,          ,    ,      NULL ( Null ).          ,             ,       IMessageMetadata.        ,         execute. </p><br><p style=";text-align:right;direction:rtl">         .  ุฅูู <br>    Null     Null  <br>    ,         NULL,   <br>       </p><br><h3 id="realizaciya-vneshney-procedury" style=";text-align:right;direction:rtl">    </h3><br><p style=";text-align:right;direction:rtl">      UDR   .       :         .     , ..           EXECUTE PROCEDURE       . </p><br><p style=";text-align:right;direction:rtl">    UdrInit    <code>firebird_udr_plugin</code>      . </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firebird_udr_plugin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AUnloadFlagLocal: BooleanPtr; AUdrPlugin: IUdrPlugin)</span></span></span><span class="hljs-function">:</span></span> BooleanPtr; <span class="hljs-keyword"><span class="hljs-keyword">cdecl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//    AUdrPlugin.registerFunction(AStatus, 'sum_args', TSumArgsFunctionFactory.Create()); //    AUdrPlugin.registerProcedure(AStatus, 'sum_args_proc', TSumArgsProcedureFactory.Create()); //AUdrPlugin.registerProcedure(AStatus, 'gen_rows', TGenRowsFactory.Create()); //    //AUdrPlugin.registerTrigger(AStatus, 'test_trigger', // TMyTriggerFactory.Create()); theirUnloadFlag := AUnloadFlagLocal; Result := @myUnloadFlag; end;</span></span></code> </pre> <br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>      uses  SumArgsProc,       . </blockquote><p style=";text-align:right;direction:rtl">       IUdrProcedureFactory.      IUdrProcedureFactoryImpl.       . ,         ,        .       . </p><br><p style=";text-align:right;direction:rtl">  dispose    ,        .      . </p><br><p style=";text-align:right;direction:rtl">  setup          .            ,        .      . </p><br><p style=";text-align:right;direction:rtl">  newItem      .        ,       .   IRoutineMetadata        ,      .                 PSQL.           .          <code>TSumArgsProcedure</code> . </p><br><p style=";text-align:right;direction:rtl">          SumArgsProc. </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">   SumArgsProc</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> SumArgsProc; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE DELPHI}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Firebird; <span class="hljs-comment"><span class="hljs-comment">{ ********************************************************** create procedure sp_sum_args ( n1 integer, n2 integer, n3 integer ) returns (result integer) external name 'myudr!sum_args_proc' engine udr; ********************************************************* }</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-comment"><span class="hljs-comment">//        TSumArgsInMsg = record n1: Integer; n1Null: WordBool; n2: Integer; n2Null: WordBool; n3: Integer; n3Null: WordBool; end; PSumArgsInMsg = ^TSumArgsInMsg; //        TSumArgsOutMsg = record result: Integer; resultNull: WordBool; end; PSumArgsOutMsg = ^TSumArgsOutMsg; //       TSumArgsProcedure TSumArgsProcedureFactory = class(IUdrProcedureFactoryImpl) //     procedure dispose(); override; {                  . @param(AStatus  ) @param(AContext    ) @param(AMetadata   ) @param(AInBuilder     ) @param(AOutBuilder     ) } procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder: IMetadataBuilder; AOutBuilder: IMetadataBuilder); override; {      TSumArgsProcedure @param(AStatus  ) @param(AContext    ) @param(AMetadata   ) @returns(  ) } function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalProcedure; override; end; TSumArgsProcedure = class(IExternalProcedureImpl) public //      procedure dispose(); override; {      open             .        ,   ExternalEngine::getCharSet. @param(AStatus  ) @param(AContext    ) @param(AName   ) @param(AName    ) } procedure getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); override; {    @param(AStatus  ) @param(AContext    ) @param(AInMsg    ) @param(AOutMsg    ) @returns(      nil   ) } function open(AStatus: IStatus; AContext: IExternalContext; AInMsg: Pointer; AOutMsg: Pointer): IExternalResultSet; override; end; implementation { TSumArgsProcedureFactory } procedure TSumArgsProcedureFactory.dispose; begin Destroy; end; function TSumArgsProcedureFactory.newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalProcedure; begin Result := TSumArgsProcedure.create; end; procedure TSumArgsProcedureFactory.setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder, AOutBuilder: IMetadataBuilder); begin end; { TSumArgsProcedure } procedure TSumArgsProcedure.dispose; begin Destroy; end; procedure TSumArgsProcedure.getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); begin end; function TSumArgsProcedure.open(AStatus: IStatus; AContext: IExternalContext; AInMsg, AOutMsg: Pointer): IExternalResultSet; var xInput: PSumArgsInMsg; xOutput: PSumArgsOutMsg; begin Result := nil; //         xInput := PSumArgsInMsg(AInMsg); xOutput := PSumArgsOutMsg(AOutMsg); //     NULL    NULL xOutput^.resultNull := xInput^.n1Null or xInput^.n2Null or xInput^.n3Null; xOutput^.result := xInput^.n1 + xInput^.n2 + xInput^.n3; end; end.</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">      IExternalProcedure.      <code>IExternalProcedureImpl</code> . </p><br><p style=";text-align:right;direction:rtl">  dispose     ,        .      . </p><br><p style=";text-align:right;direction:rtl">  getCharSet                .       ,               . </p><br><p style=";text-align:right;direction:rtl">  open     .        ,     ,      .     ,      nil,           .          .      TSumArgsFunction.execute. </p><br><h3 id="hranimaya-procedura-vybora" style=";text-align:right;direction:rtl">    </h3><br><p style=";text-align:right;direction:rtl">     UDR    .      <code>firebird_udr_plugin</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firebird_udr_plugin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AUnloadFlagLocal: BooleanPtr; AUdrPlugin: IUdrPlugin)</span></span></span><span class="hljs-function">:</span></span> BooleanPtr; <span class="hljs-keyword"><span class="hljs-keyword">cdecl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//    AUdrPlugin.registerFunction(AStatus, 'sum_args', TSumArgsFunctionFactory.Create()); //    AUdrPlugin.registerProcedure(AStatus, 'sum_args_proc', TSumArgsProcedureFactory.Create()); AUdrPlugin.registerProcedure(AStatus, 'gen_rows', TGenRowsFactory.Create()); //    //AUdrPlugin.registerTrigger(AStatus, 'test_trigger', // TMyTriggerFactory.Create()); theirUnloadFlag := AUnloadFlagLocal; Result := @myUnloadFlag; end;</span></span></code> </pre> <br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>      uses  GenRowsProc,       . </blockquote><p style=";text-align:right;direction:rtl">           .     ,    open,    . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">   GenRowsProc</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> GenRowsProc; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE DELPHI}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Firebird, SysUtils; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-comment"><span class="hljs-comment">{ ********************************************************** create procedure gen_rows ( start integer, finish integer ) returns (n integer) external name 'myudr!gen_rows' engine udr; ********************************************************* }</span></span> TInput = <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> start: Integer; startNull: WordBool; finish: Integer; finishNull: WordBool; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; PInput = ^TInput; TOutput = <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> n: Integer; nNull: WordBool; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; POutput = ^TOutput; <span class="hljs-comment"><span class="hljs-comment">//       TGenRowsProcedure TGenRowsFactory = class(IUdrProcedureFactoryImpl) //     procedure dispose(); override; {          .        . @param(AStatus  ) @param(AContext    ) @param(AMetadata   ) @param(AInBuilder     ) @param(AOutBuilder     ) } procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder: IMetadataBuilder; AOutBuilder: IMetadataBuilder); override; {      TGenRowsProcedure @param(AStatus  ) @param(AContext    ) @param(AMetadata   ) @returns(  ) } function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalProcedure; override; end; //   TGenRowsProcedure. TGenRowsProcedure = class(IExternalProcedureImpl) public //      procedure dispose(); override; {      open             .        ,   ExternalEngine::getCharSet. @param(AStatus  ) @param(AContext    ) @param(AName   ) @param(AName    ) } procedure getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); override; {    @param(AStatus  ) @param(AContext    ) @param(AInMsg    ) @param(AOutMsg    ) @returns(      nil   ) } function open(AStatus: IStatus; AContext: IExternalContext; AInMsg: Pointer; AOutMsg: Pointer): IExternalResultSet; override; end; //      TGenRowsProcedure TGenRowsResultSet = class(IExternalResultSetImpl) Input: PInput; Output: POutput; //       procedure dispose(); override; {      .     SUSPEND.          . @param(AStatus  ) @returns(True        , False   ) } function fetch(AStatus: IStatus): Boolean; override; end; implementation { TGenRowsFactory } procedure TGenRowsFactory.dispose; begin Destroy; end; function TGenRowsFactory.newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalProcedure; begin Result := TGenRowsProcedure.create; end; procedure TGenRowsFactory.setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder, AOutBuilder: IMetadataBuilder); begin end; { TGenRowsProcedure } procedure TGenRowsProcedure.dispose; begin Destroy; end; procedure TGenRowsProcedure.getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); begin end; function TGenRowsProcedure.open(AStatus: IStatus; AContext: IExternalContext; AInMsg, AOutMsg: Pointer): IExternalResultSet; begin //      NULL    if PInput(AInMsg).startNull or PInput(AInMsg).finishNull then begin POutput(AOutMsg).nNull := True; Result := nil; exit; end; //  if PInput(AInMsg).start &gt; PInput(AInMsg).finish then raise Exception.Create('First parameter greater then second parameter.'); Result := TGenRowsResultSet.create; with TGenRowsResultSet(Result) do begin Input := AInMsg; Output := AOutMsg; //   Output.nNull := False; Output.n := Input.start - 1; end; end; { TGenRowsResultSet } procedure TGenRowsResultSet.dispose; begin Destroy; end; //   True       . //   False       //         //     function TGenRowsResultSet.fetch(AStatus: IStatus): Boolean; begin Inc(Output.n); Result := (Output.n &lt;= Input.finish); end; end.</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">   open   <code>TGenRowsProcedure</code>         NULL,      NULL,      NULL,              SELECT,      nil. </p><br><p style=";text-align:right;direction:rtl">    ,       ,     .         UDR     Firebird.      UDR  Legacy UDF. </p><br><p style=";text-align:right;direction:rtl">     ,   open     ,    IExternalResultSet.         <code>IExternalResultSetImpl</code> . </p><br><p style=";text-align:right;direction:rtl">  dispose     .      . </p><br><p style=";text-align:right;direction:rtl">  fetch       SELECT.        SUSPEND    PSQL  .     ,        .   true,       ,  <code>false</code> ,      .             ,      . </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>  Delphi    yeild,          <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(...) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { ... yield result; }</code> </pre> <br><br>      ,     open,  ,          fetch.            (   SELECT   FIRST/ROWS/FETCH FIRST   SELECT.) </blockquote><br><h3 id="realizaciya-vneshnego-triggera" style=";text-align:right;direction:rtl">    </h3><br><p style=";text-align:right;direction:rtl">     UDR   . </p><br><blockquote style=";text-align:right;direction:rtl"> <strong>Note</strong> <br><br>     C++        .  ,           .          . </blockquote><p style=";text-align:right;direction:rtl">    UdrInit    <code>firebird_udr_plugin</code>      . </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firebird_udr_plugin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AUnloadFlagLocal: BooleanPtr; AUdrPlugin: IUdrPlugin)</span></span></span><span class="hljs-function">:</span></span> BooleanPtr; <span class="hljs-keyword"><span class="hljs-keyword">cdecl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//    AUdrPlugin.registerFunction(AStatus, 'sum_args', TSumArgsFunctionFactory.Create()); //    AUdrPlugin.registerProcedure(AStatus, 'sum_args_proc', TSumArgsProcedureFactory.Create()); AUdrPlugin.registerProcedure(AStatus, 'gen_rows', TGenRowsFactory.Create()); //    AUdrPlugin.registerTrigger(AStatus, 'test_trigger', TMyTriggerFactory.Create()); theirUnloadFlag := AUnloadFlagLocal; Result := @myUnloadFlag; end;</span></span></code> </pre> <br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>      uses  TestTrigger,       . </blockquote><p style=";text-align:right;direction:rtl">       IUdrTriggerFactory.      IUdrTriggerFactoryImpl.       <br> . </p><br><p style=";text-align:right;direction:rtl">  dispose    ,        .      . </p><br><p style=";text-align:right;direction:rtl">  setup          .            ,        .      . </p><br><p style=";text-align:right;direction:rtl">  newItem      .        ,       .   IRoutineMetadata           ,      .                 PSQL.           .          <code>TMyTrigger</code> . </p><br><p style=";text-align:right;direction:rtl">          TestTrigger. </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">   TestTrigger</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> TestTrigger; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE DELPHI}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Firebird, SysUtils; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-comment"><span class="hljs-comment">{ ********************************************************** create table test ( id int generated by default as identity, a int, b int, name varchar(100), constraint pk_test primary key(id) ); create or alter trigger tr_test_biu for test active before insert or update position 0 external name 'myudr!test_trigger' engine udr; }</span></span> <span class="hljs-comment"><span class="hljs-comment">//     NEW.*  OLD.* //      test TFieldsMessage = record Id: Integer; IdNull: WordBool; A: Integer; ANull: WordBool; B: Integer; BNull: WordBool; Name: record Length: Word; Value: array [0 .. 399] of AnsiChar; end; NameNull: WordBool; end; PFieldsMessage = ^TFieldsMessage; //       TMyTrigger TMyTriggerFactory = class(IUdrTriggerFactoryImpl) //     procedure dispose(); override; {          .       . @param(AStatus  ) @param(AContext    ) @param(AMetadata   ) @param(AFieldsBuilder     ) } procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AFieldsBuilder: IMetadataBuilder); override; {      TMyTrigger @param(AStatus  ) @param(AContext    ) @param(AMetadata   ) @returns(  ) } function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalTrigger; override; end; TMyTrigger = class(IExternalTriggerImpl) //     procedure dispose(); override; {      execute             .        ,   ExternalEngine::getCharSet. @param(AStatus  ) @param(AContext    ) @param(AName   ) @param(AName    ) } procedure getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); override; {   TMyTrigger @param(AStatus  ) @param(AContext    ) @param(AAction  ( ) ) @param(AOldMsg      :OLD.*) @param(ANewMsg      :NEW.*) } procedure execute(AStatus: IStatus; AContext: IExternalContext; AAction: Cardinal; AOldMsg: Pointer; ANewMsg: Pointer); override; end; implementation { TMyTriggerFactory } procedure TMyTriggerFactory.dispose; begin Destroy; end; function TMyTriggerFactory.newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalTrigger; begin Result := TMyTrigger.create; end; procedure TMyTriggerFactory.setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AFieldsBuilder: IMetadataBuilder); begin end; { TMyTrigger } procedure TMyTrigger.dispose; begin Destroy; end; procedure TMyTrigger.execute(AStatus: IStatus; AContext: IExternalContext; AAction: Cardinal; AOldMsg, ANewMsg: Pointer); var xOld, xNew: PFieldsMessage; begin // xOld := PFieldsMessage(AOldMsg); xNew := PFieldsMessage(ANewMsg); case AAction of IExternalTrigger.ACTION_INSERT: begin if xNew.BNull and not xNew.ANull then begin xNew.B := xNew.A + 1; xNew.BNull := False; end; end; IExternalTrigger.ACTION_UPDATE: begin if xNew.BNull and not xNew.ANull then begin xNew.B := xNew.A + 1; xNew.BNull := False; end; end; IExternalTrigger.ACTION_DELETE: begin end; end; end; procedure TMyTrigger.getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); begin end; end.</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">      IExternalTrigger.      <code>IExternalTriggerImpl</code> . </p><br><p style=";text-align:right;direction:rtl">  dispose     ,        .      . </p><br><p style=";text-align:right;direction:rtl">  getCharSet                .       ,           . </p><br><p style=";text-align:right;direction:rtl">  execute            .        ,     ,  ()              .   ()      IExternalTrigger.      <code>ACTION_</code> .     ,   Firebird       .        ,  DDL ,      ,         ,           nil.                 .          ,          ,      . </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>  ,        ,             .             IMessageMetadata.        ,          .       ,      ,      /. </blockquote><p style=";text-align:right;direction:rtl">        ,       PSQL  </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"> if (:new.B IS NULL) THEN :new.B = :new.A + 1;</code> </pre> <br><h2 id="soobscheniya" style=";text-align:right;direction:rtl">  </h2><br><p style=";text-align:right;direction:rtl">    UDR             ,    .                NEW  OLD. </p><br><p style=";text-align:right;direction:rtl">        ,       ,      . <br>         : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">           ( Delphi  , .. record); </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">         IMessageMetadata,  /   ,      . </p><br></li></ul><br><p style=";text-align:right;direction:rtl">     ,  โ  ,                        UDR. </p><br><h3 id="rabota-s-buferom-soobscheniya-s-ispolzovaniem-struktury" style=";text-align:right;direction:rtl">        </h3><br><p style=";text-align:right;direction:rtl">             .     : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">TMyStruct = record &lt;var_1&gt;: &lt;type_1&gt;; &lt;nullIndicator_1&gt;: WordBool; &lt;var_2&gt;: &lt;type_1&gt;; &lt;nullIndicator_2&gt;: WordBool; ... &lt;var_N&gt;: &lt;type_1&gt;; &lt;nullIndicator_N&gt;: WordBool; end; PMyStruct = ^TMyStruct;</code> </pre> <br><p style=";text-align:right;direction:rtl">       /    ( ). Null-     /,       NOT NULL. Null-  2 .  -1   <br> /   NULL.      NULL-    NULL,      2-   .   SQL     : </p><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><th> SQL  </th><th> Delphi  </th><th>  </th></tr><tr><td> BOOLEAN </td><td> Boolean, ByteBool </td><td></td></tr><tr><td> SMALLINT </td><td> Smallint </td><td></td></tr><tr><td> INTEGER </td><td> Integer </td><td></td></tr><tr><td> BIGINT </td><td> Int64 </td><td></td></tr><tr><td> FLOAT </td><td> Single </td><td></td></tr><tr><td> DOUBLE PRECISION </td><td> Double </td><td></td></tr><tr><td> NUMERIC(N, M) </td><td>       : <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> 1-4 โ Smallint; </li><li style=";text-align:right;direction:rtl"> 5-9 โ Integer; </li><li style=";text-align:right;direction:rtl"> 10-18 (3 ) โ Int64; </li><li style=";text-align:right;direction:rtl"> 10-15 (1 ) โ Double. </li></ul><br></td><td>           <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>10</mn><mi>M</mi></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.284ex" height="2.419ex" viewBox="0 -935.7 1844.5 1041.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-30" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-4D" x="1415" y="557"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>10</mn><mi>M</mi></msup></math></span></span><script type="math/tex" id="MathJax-Element-1">10^M</script>  . </td></tr><tr><td> DECIMAL(N, M) </td><td>       : <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> 1-4 โ Integer; </li><li style=";text-align:right;direction:rtl"> 5-9 โ Integer; </li><li style=";text-align:right;direction:rtl"> 10-18 (3 ) โ Int64; </li><li style=";text-align:right;direction:rtl"> 10-15 (1 ) โ Double. </li></ul><br></td><td>           <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>10</mn><mi>M</mi></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.284ex" height="2.419ex" viewBox="0 -935.7 1844.5 1041.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-30" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-4D" x="1415" y="557"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>10</mn><mi>M</mi></msup></math></span></span><script type="math/tex" id="MathJax-Element-2">10^M</script>  . </td></tr><tr><td> CHAR(N) </td><td> array[0โฆ M] of AnsiChar </td><td> M    <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>M</mi><mo>=</mo><mi>N</mi><mo>&amp;#x2217;</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>s</mi><mi>P</mi><mi>e</mi><mi>r</mi><mi>C</mi><mi>h</mi><mi>a</mi><mi>r</mi><mo>&amp;#x2212;</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.996ex" height="2.419ex" viewBox="0 -780.1 12484.4 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-4D" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-3D" x="1329" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-4E" x="2385" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-2217" x="3496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-42" x="4219" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-79" x="4978" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-74" x="5476" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-65" x="5837" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-73" x="6304" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-50" x="6773" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-65" x="7525" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-72" x="7991" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-43" x="8443" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-68" x="9203" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-61" x="9780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-72" x="10309" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-2212" x="10983" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-31" x="11983" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mo>=</mo><mi>N</mi><mo>โ</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>s</mi><mi>P</mi><mi>e</mi><mi>r</mi><mi>C</mi><mi>h</mi><mi>a</mi><mi>r</mi><mo>โ</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-3">M = N * BytesPerChar - 1</script>  . <br>  BytesPerChar โ    ,    /.   UTF-8 โ  4 /,  WIN1251 โ 1 /. </td></tr><tr><td> VARCHAR(N) </td><td> FbVarChar&lt;N&gt; </td><td> M    <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>M</mi><mo>=</mo><mi>N</mi><mo>&amp;#x2217;</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>s</mi><mi>P</mi><mi>e</mi><mi>r</mi><mi>C</mi><mi>h</mi><mi>a</mi><mi>r</mi><mo>&amp;#x2212;</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.996ex" height="2.419ex" viewBox="0 -780.1 12484.4 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-4D" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-3D" x="1329" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-4E" x="2385" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-2217" x="3496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-42" x="4219" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-79" x="4978" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-74" x="5476" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-65" x="5837" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-73" x="6304" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-50" x="6773" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-65" x="7525" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-72" x="7991" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-43" x="8443" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-68" x="9203" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-61" x="9780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMATHI-72" x="10309" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-2212" x="10983" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=https://habr.com/ru/post/455375/&amp;usg=ALkJrhgr0q9hnpxnOCIEkPc9U15GfaBZlw#MJMAIN-31" x="11983" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mo>=</mo><mi>N</mi><mo>โ</mo><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>s</mi><mi>P</mi><mi>e</mi><mi>r</mi><mi>C</mi><mi>h</mi><mi>a</mi><mi>r</mi><mo>โ</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-4">M = N * BytesPerChar - 1</script>  . <br>  BytesPerChar โ    ,    /.   UTF-8 โ  4 /,  WIN1251 โ 1 /.  Length      .  Delphi        C++, <br>     FbVarChar&lt;N&gt; ,  <br>        .   . </td></tr><tr><td> DATE </td><td> ISC_DATE </td><td></td></tr><tr><td> TIME </td><td> ISC_TIME </td><td></td></tr><tr><td> TIMESTAMP </td><td> ISC_TIMESTAMP </td><td>  ISC_TIMESTAMP    Firebird.pas,     .      . </td></tr><tr><td> BLOB </td><td> ISC_QUAD </td><td>  BLOB    ,    BlobId.     BLOB   . </td></tr></tbody></table></div><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-comment"><span class="hljs-comment">//      VARCHAR(N) // M = N * BytesPerChar - 1 record Length: Smallint; Data: array[0 .. M] of AnsiChar; end; //      TIMESTAMP ISC_TIMESTAMP = record date: ISC_DATE; time: ISC_TIME; end;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">         <br>    ,   . </p><br><p style=";text-align:right;direction:rtl">         : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">function SUM_ARGS(A SMALLINT, B INTEGER) RETURNS BIGINT ....</code> </pre> <br><p style=";text-align:right;direction:rtl">            <br> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">TInput = record A: Smallint; ANull: WordBool; B: Integer; BNull: WordBool; end; PInput = ^TInput; TOutput = record Value: Int64; Null: WordBool; end; POutput = ^TOutput;</code> </pre> <br><p style=";text-align:right;direction:rtl">          ( 3 ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">function SUM_ARGS(A NUMERIC(4, 2), B NUMERIC(9, 3)) RETURNS NUMERIC(18, 6) ....</code> </pre> <br><p style=";text-align:right;direction:rtl">            <br> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs">TInput = <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> A: Smallint; ANull: WordBool; B: Integer; BNull: WordBool; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; PInput = ^TInput; TOutput = <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> Value: Int64; Null: WordBool; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; POutput = ^TOutput;</code> </pre> <br><p style=";text-align:right;direction:rtl">         : </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">procedure SOME_PROC(A CHAR(3) CHARACTER <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> WIN1251, B <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> UTF8) ....</code> </pre> <br><p style=";text-align:right;direction:rtl">          : </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs">TInput = <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> A: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>..<span class="hljs-number"><span class="hljs-number">2</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> AnsiChar; ANull: WordBool; B: <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> Length: Smallint; Value: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>..<span class="hljs-number"><span class="hljs-number">39</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> AnsiChar; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; BNull: WordBool; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; PInput = ^TInput;</code> </pre> <br><h3 id="rabota-s-buferom-soobscheniy-s-pomoschyu-imessagemetadata" style=";text-align:right;direction:rtl">       IMessageMetadata </h3><br><p style=";text-align:right;direction:rtl">           <br>      <br> IMessageMetadata.      / <br>  : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  /; </li><li style=";text-align:right;direction:rtl">  ; </li><li style=";text-align:right;direction:rtl">     ; </li><li style=";text-align:right;direction:rtl">     BLOB; </li><li style=";text-align:right;direction:rtl">      /; </li><li style=";text-align:right;direction:rtl">   /   NULL; </li><li style=";text-align:right;direction:rtl">      ; </li><li style=";text-align:right;direction:rtl">      NULL-. </li></ul><br><h4 id="metody-interfeysa-imessagemetadata" style=";text-align:right;direction:rtl">   IMessageMetadata </h4><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getCount </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   /  .   ,   ,    : 0 &lt;= index &lt; getCount(). </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getField </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getField</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getRelation </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRelation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    (    ). </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getOwner </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOwner</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getAlias </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAlias</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getType </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  SQL  . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> isNullable </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">FB_BOOLEAN </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isNullable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  true,      NULL. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getSubType </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSubType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    BLOB (0 โ , 1 โ   . .). </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getLength </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">      . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getScale </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getScale</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">     . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getCharSet </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCharSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">         BLOB. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getOffset </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOffset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">        (        ). </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getNullOffset </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNullOffset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   NULL      . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getBuilder </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">IMetadataBuilder* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBuilder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   IMetadataBuilder,    . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> getMessageLength </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsigned</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMessageLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StatusType* status)</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">     (      ). </p><br></li></ol><br><h4 id="poluchenie-i-ispolzovanie-imessagemetadata" style=";text-align:right;direction:rtl">    IMessageMetadata </h4><br><p style=";text-align:right;direction:rtl">     IMessageMetadata          IRoutineMetadata.       ,   .        .  ุนูู ุณุจูู ุงููุซุงู: </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">   RoutineMetadata</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"> <span class="hljs-comment"><span class="hljs-comment">//       TSumArgsFunction TSumArgsFunctionFactory = class(IUdrFunctionFactoryImpl) //     procedure dispose(); override; {           @param(AStatus  ) @param(AContext    ) @param(AMetadata   ) @param(AInBuilder     ) @param(AOutBuilder     ) } procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder: IMetadataBuilder; AOutBuilder: IMetadataBuilder); override; {      TSumArgsFunction @param(AStatus  ) @param(AContext    ) @param(AMetadata   ) @returns(  ) } function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalFunction; override; end; //   TSumArgsFunction. TSumArgsFunction = class(IExternalFunctionImpl) private FMetadata: IRoutineMetadata; public property Metadata: IRoutineMetadata read FMetadata write FMetadata; public //      procedure dispose(); override; {      execute             .        ,   ExternalEngine::getCharSet. @param(AStatus  ) @param(AContext    ) @param(AName   ) @param(AName    ) } procedure getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); override; {    @param(AStatus  ) @param(AContext    ) @param(AInMsg    ) @param(AOutMsg    ) } procedure execute(AStatus: IStatus; AContext: IExternalContext; AInMsg: Pointer; AOutMsg: Pointer); override; end; ........................ { TSumArgsFunctionFactory } procedure TSumArgsFunctionFactory.dispose; begin Destroy; end; function TSumArgsFunctionFactory.newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalFunction; begin Result := TSumArgsFunction.Create(); with Result as TSumArgsFunction do begin Metadata := AMetadata; end; end; procedure TSumArgsFunctionFactory.setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder, AOutBuilder: IMetadataBuilder); begin end;</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  IMessageMetadata           getInputMetadata  getOutputMetadata  IRoutineMetadata.    ,    ,      getTriggerMetadata. </p><br><blockquote style=";text-align:right;direction:rtl"> <strong></strong> <br><br>  ,     IMessageMetadata     .    IReferenceCounted.  getInputMetadata  getOutputMetadata     1   ,             <code>xInputMetadata</code>  <code>xOutputMetadata</code>   release. </blockquote><p style=";text-align:right;direction:rtl">           .      IMessageMetadata    getOffset        .         .    <br>     null  ,       getNullOffset. </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">     IMessageMetadata</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-comment"><span class="hljs-comment">// ........................ procedure TSumArgsFunction.execute(AStatus: IStatus; AContext: IExternalContext; AInMsg, AOutMsg: Pointer); var n1, n2, n3: Integer; n1Null, n2Null, n3Null: WordBool; Result: Integer; resultNull: WordBool; xInputMetadata, xOutputMetadata: IMessageMetadata; begin xInputMetadata := FMetadata.getInputMetadata(AStatus); xOutputMetadata := FMetadata.getOutputMetadata(AStatus); try //        n1 := PInteger(PByte(AInMsg) + xInputMetadata.getOffset(AStatus, 0))^; n2 := PInteger(PByte(AInMsg) + xInputMetadata.getOffset(AStatus, 1))^; n3 := PInteger(PByte(AInMsg) + xInputMetadata.getOffset(AStatus, 2))^; //   null-      n1Null := PWordBool(PByte(AInMsg) + xInputMetadata.getNullOffset(AStatus, 0))^; n2Null := PWordBool(PByte(AInMsg) + xInputMetadata.getNullOffset(AStatus, 1))^; n3Null := PWordBool(PByte(AInMsg) + xInputMetadata.getNullOffset(AStatus, 2))^; //     = NULL,     nullFlag resultNull := True; Result := 0; //     NULL    NULL //       if not(n1Null or n2Null or n3Null) then begin Result := n1 + n2 + n3; //   ,   NULL  resultNull := False; end; PWordBool(PByte(AInMsg) + xOutputMetadata.getNullOffset(AStatus, 0))^ := resultNull; PInteger(PByte(AInMsg) + xOutputMetadata.getOffset(AStatus, 0))^ := Result; finally xInputMetadata.release; xOutputMetadata.release; end; end;</span></span></code> </pre> </div></div><br><h2 id="fabriki" style=";text-align:right;direction:rtl">  </h2><br><p style=";text-align:right;direction:rtl">      .      . </p><br><p style=";text-align:right;direction:rtl">      ,   .         IUdrProcedureFactory, IUdrFunctionFactory  IUdrTriggerFactory     UDR.          UDR   <code>firebird_udr_plugin</code> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firebird_udr_plugin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AUnloadFlagLocal: BooleanPtr; AUdrPlugin: IUdrPlugin)</span></span></span><span class="hljs-function">:</span></span> BooleanPtr; <span class="hljs-keyword"><span class="hljs-keyword">cdecl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//    AUdrPlugin.registerFunction(AStatus, 'sum_args', TSumArgsFunctionFactory.Create()); //    AUdrPlugin.registerProcedure(AStatus, 'gen_rows', TGenRowsFactory.Create()); //    AUdrPlugin.registerTrigger(AStatus, 'test_trigger', TMyTriggerFactory.Create()); theirUnloadFlag := AUnloadFlagLocal; Result := @myUnloadFlag; end;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">     <code>TSumArgsFunctionFactory</code>   IUdrFunctionFactory, <code>TGenRowsFactory</code>   IUdrProcedureFactory,  <code>TMyTriggerFactory</code>   IUdrTriggerFactory. </p><br><p style=";text-align:right;direction:rtl">              ,   .         Firebird.  ,   SuperServer             ,  Classic   <br>      . </p><br><p style=";text-align:right;direction:rtl">         setup  newItem   IUdrProcedureFactory, IUdrFunctionFactory  IUdrTriggerFactory. </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"> </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">IUdrFunctionFactory</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(IDisposable) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VERSION = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(status: IStatus; context: IExternalContext; metadata: IRoutineMetadata; inBuilder: IMetadataBuilder; outBuilder: IMetadataBuilder)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(status: IStatus; context: IExternalContext; metadata: IRoutineMetadata)</span></span></span><span class="hljs-function">:</span></span> IExternalFunction; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-title"><span class="hljs-title">IUdrProcedureFactory</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(IDisposable) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VERSION = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(status: IStatus; context: IExternalContext; metadata: IRoutineMetadata; inBuilder: IMetadataBuilder; outBuilder: IMetadataBuilder)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(status: IStatus; context: IExternalContext; metadata: IRoutineMetadata)</span></span></span><span class="hljs-function">:</span></span> IExternalProcedure; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-title"><span class="hljs-title">IUdrTriggerFactory</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(IDisposable) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> VERSION = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(status: IStatus; context: IExternalContext; metadata: IRoutineMetadata; fieldsBuilder: IMetadataBuilder)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(status: IStatus; context: IExternalContext; metadata: IRoutineMetadata)</span></span></span><span class="hljs-function">:</span></span> IExternalTrigger; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ,      IDisposable,       dispose.    Firebird   ,    .   dispose   ,   ,    .       <br>   <code>IUdrProcedureFactoryImpl</code> , <code>IUdrFunctionFactoryImpl</code> , <code>IUdrTriggerFactoryImpl</code> .      . </p><br><h3 id="metod-newitem" style=";text-align:right;direction:rtl">  newItem </h3><br><p style=";text-align:right;direction:rtl">  newItem      ,   .   UDR        , ..    ,   .             . </p><br><p style=";text-align:right;direction:rtl">            . ,      ,    ,    <code>IUdrFunctionFactory</code> .             .      . </p><br><p style=";text-align:right;direction:rtl">   newItem     ,  <br>  UDR   UDR. </p><br><p style=";text-align:right;direction:rtl">        </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TSumArgsFunctionFactory</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata)</span></span></span><span class="hljs-function">:</span></span> IExternalFunction; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//     Result := TSumArgsFunction.Create(); end;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">   IRoutineMetadata        ,  UDR   .       UDR.         UDR      . </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"> <span class="hljs-comment"><span class="hljs-comment">//   TSumArgsFunction. TSumArgsFunction = class(IExternalFunctionImpl) private FMetadata: IRoutineMetadata; public property Metadata: IRoutineMetadata read FMetadata write FMetadata; public ... end;</span></span></code> </pre> <br><h3 id="metod-setup" style=";text-align:right;direction:rtl">  setup </h3><br><p style=";text-align:right;direction:rtl">  setup                 .     IMetadataBuilder,          ,    .       <br>    setup,         setup      DLL ,   .         . </p><br><p style=";text-align:right;direction:rtl">                    .        ,          SumArgs. </p><br><p style=";text-align:right;direction:rtl">      ,     </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-comment"><span class="hljs-comment">//        TSumArgsInMsg = record n1: Integer; n1Null: WordBool; n2: Integer; n2Null: WordBool; n3: Integer; n3Null: WordBool; end; PSumArgsInMsg = ^TSumArgsInMsg; //        TSumArgsOutMsg = record result: Integer; resultNull: WordBool; end; PSumArgsOutMsg = ^TSumArgsOutMsg;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    ,   setup    ,     . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">SumArgsFunctionFactory</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-comment"><span class="hljs-comment">{ TSumArgsFunctionFactory }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TSumArgsFunctionFactory</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Destroy; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TSumArgsFunctionFactory</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata)</span></span></span><span class="hljs-function">:</span></span> IExternalFunction; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := TSumArgsFunction.Create(); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TSumArgsFunctionFactory</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder, AOutBuilder: IMetadataBuilder)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//      AInBuilder.setType(AStatus, 0, Cardinal(SQL_LONG) + 1); AInBuilder.setLength(AStatus, 0, sizeof(Int32)); AInBuilder.setType(AStatus, 1, Cardinal(SQL_LONG) + 1); AInBuilder.setLength(AStatus, 1, sizeof(Int32)); AInBuilder.setType(AStatus, 2, Cardinal(SQL_LONG) + 1); AInBuilder.setLength(AStatus, 2, sizeof(Int32)); //      AOutBuilder.setType(AStatus, 0, Cardinal(SQL_LONG) + 1); AOutBuilder.setLength(AStatus, 0, sizeof(Int32)); end;</span></span></code> </pre> </div></div><br><blockquote style=";text-align:right;direction:rtl"> <strong> </strong> <br><br>    SQL  Firebird .   ,     SQL       NULL.          XSQLDA. </blockquote><p style=";text-align:right;direction:rtl">    </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TSumArgsFunction</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AInMsg, AOutMsg: Pointer)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xInput: PSumArgsInMsg; xOutput: PSumArgsOutMsg; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//         xInput := PSumArgsInMsg(AInMsg); xOutput := PSumArgsOutMsg(AOutMsg); //     = NULL,     nullFlag xOutput^.resultNull := True; //     NULL    NULL //       xOutput^.resultNull := xInput^.n1Null or xInput^.n2Null or xInput^.n3Null; xOutput^.result := xInput^.n1 + xInput^.n2 + xInput^.n3; end;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">        ,      ,          ,      setup. </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> FN_SUM_ARGS ( N1 <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>), N2 <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>), N3 <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">EXTERNAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-string"><span class="hljs-string">'MyUdrSetup!sum_args'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> UDR;</code> </pre> <br><p style=";text-align:right;direction:rtl">         </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> FN_SUM_ARGS(<span class="hljs-string"><span class="hljs-string">'15'</span></span>, <span class="hljs-string"><span class="hljs-string">'21'</span></span>, <span class="hljs-string"><span class="hljs-string">'35'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rdb$<span class="hljs-keyword"><span class="hljs-keyword">database</span></span></code> </pre> <br><h2 id="obobschyonnye-fabriki" style=";text-align:right;direction:rtl">   </h2><br><p style=";text-align:right;direction:rtl">    UDR     ,          UDR.            .     Delphi 2009,  Free Pascal    FPC 2.2. </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>  Free Pascal       <br> Delphi.    FPC 2.6.0    Delphi <br> . </blockquote><p style=";text-align:right;direction:rtl">          <br> : </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">   ,          ,         UDR,       ; </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">   ,       ,         UDR,        IMessageMetadata. </p><br></li></ul><br><p style=";text-align:right;direction:rtl">            newItem   .          <code>IUdrFunctionFactoryImpl</code> , <code>IUdrProcedureFactoryImpl</code> , <code>IUdrTriggerFactoryImpl</code> .      : </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">SimpleFactories</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UdrFactories; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE DELPHI}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> SysUtils, Firebird; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-comment"><span class="hljs-comment">//     TFunctionSimpleFactory&lt;T: IExternalFunctionImpl, constructor&gt; = class (IUdrFunctionFactoryImpl) procedure dispose(); override; procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder: IMetadataBuilder; AOutBuilder: IMetadataBuilder); override; function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalFunction; override; end; //     TProcedureSimpleFactory&lt;T: IExternalProcedureImpl, constructor&gt; = class (IUdrProcedureFactoryImpl) procedure dispose(); override; procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder: IMetadataBuilder; AOutBuilder: IMetadataBuilder); override; function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalProcedure; override; end; //     TTriggerSimpleFactory&lt;T: IExternalTriggerImpl, constructor&gt; = class (IUdrTriggerFactoryImpl) procedure dispose(); override; procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AFieldsBuilder: IMetadataBuilder); override; function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalTrigger; override; end;</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">      setup   ,     ,    dispose   .     newItem          <code>T</code> . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">  </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-comment"><span class="hljs-comment">{ TProcedureSimpleFactory&lt;T&gt; }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TProcedureSimpleFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Destroy; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TProcedureSimpleFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata)</span></span></span><span class="hljs-function">:</span></span> IExternalProcedure; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := T.Create; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TProcedureSimpleFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder, AOutBuilder: IMetadataBuilder)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-comment"><span class="hljs-comment">{ TFunctionFactory&lt;T&gt; }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFunctionSimpleFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Destroy; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFunctionSimpleFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata)</span></span></span><span class="hljs-function">:</span></span> IExternalFunction; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := T.Create; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFunctionSimpleFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder, AOutBuilder: IMetadataBuilder)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-comment"><span class="hljs-comment">{ TTriggerSimpleFactory&lt;T&gt; }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TTriggerSimpleFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Destroy; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TTriggerSimpleFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata)</span></span></span><span class="hljs-function">:</span></span> IExternalTrigger; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := T.Create; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TTriggerSimpleFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AFieldsBuilder: IMetadataBuilder)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">    1       ,   .          : </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firebird_udr_plugin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AUnloadFlagLocal: BooleanPtr; AUdrPlugin: IUdrPlugin)</span></span></span><span class="hljs-function">:</span></span> BooleanPtr; <span class="hljs-keyword"><span class="hljs-keyword">cdecl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//    AUdrPlugin.registerFunction(AStatus, 'sum_args', TFunctionSimpleFactory&lt;TSumArgsFunction&gt;.Create()); //    AUdrPlugin.registerProcedure(AStatus, 'gen_rows', TProcedureSimpleFactory&lt;TGenRowsProcedure&gt;.Create()); //    AUdrPlugin.registerTrigger(AStatus, 'test_trigger', TTriggerSimpleFactory&lt;TMyTrigger&gt;.Create()); theirUnloadFlag := AUnloadFlagLocal; Result := @myUnloadFlag; end;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">    .          ,   .         <code>newItem</code> .  UDR   <code>IRoutineMetadata</code> ,       Firebird,        UDR.           ,    ,  UDR, ,    <br>  UDR.      ,         ,      . </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UdrFactories; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE DELPHI}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> SysUtils, Firebird; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ... <span class="hljs-comment"><span class="hljs-comment">//     TExternalFunction = class(IExternalFunctionImpl) Metadata: IRoutineMetadata; end; //     TExternalProcedure = class(IExternalProcedureImpl) Metadata: IRoutineMetadata; end; //     TExternalTrigger = class(IExternalTriggerImpl) Metadata: IRoutineMetadata; end;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">       ,           . </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UdrFactories; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE DELPHI}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> SysUtils, Firebird; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ... <span class="hljs-comment"><span class="hljs-comment">//     TExternalFunction = class(IExternalFunctionImpl) Metadata: IRoutineMetadata; end; //     TExternalProcedure = class(IExternalProcedureImpl) Metadata: IRoutineMetadata; end; //     TExternalTrigger = class(IExternalTriggerImpl) Metadata: IRoutineMetadata; end;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">       ,           . </p><br><p style=";text-align:right;direction:rtl">       UDR   . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">  </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UdrFactories; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE DELPHI}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> SysUtils, Firebird; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ... <span class="hljs-comment"><span class="hljs-comment">//      TFunctionFactory&lt;T: TExternalFunction, constructor&gt; = class (IUdrFunctionFactoryImpl) procedure dispose(); override; procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder: IMetadataBuilder; AOutBuilder: IMetadataBuilder); override; function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalFunction; override; end; //      TProcedureFactory&lt;T: TExternalProcedure, constructor&gt; = class (IUdrProcedureFactoryImpl) procedure dispose(); override; procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder: IMetadataBuilder; AOutBuilder: IMetadataBuilder); override; function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalProcedure; override; end; //      TTriggerFactory&lt;T: TExternalTrigger, constructor&gt; = class (IUdrTriggerFactoryImpl) procedure dispose(); override; procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AFieldsBuilder: IMetadataBuilder); override; function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalTrigger; override; end;</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">   newItem      ,  <br>  ,      . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">  </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> ... <span class="hljs-comment"><span class="hljs-comment">{ TFunctionFactory&lt;T&gt; }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFunctionFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Destroy; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFunctionFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata)</span></span></span><span class="hljs-function">:</span></span> IExternalFunction; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := T.Create; (Result <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T).Metadata := AMetadata; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFunctionFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder, AOutBuilder: IMetadataBuilder)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-comment"><span class="hljs-comment">{ TProcedureFactory&lt;T&gt; }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TProcedureFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Destroy; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TProcedureFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata)</span></span></span><span class="hljs-function">:</span></span> IExternalProcedure; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := T.Create; (Result <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T).Metadata := AMetadata; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TProcedureFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder, AOutBuilder: IMetadataBuilder)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-comment"><span class="hljs-comment">{ TTriggerFactory&lt;T&gt; }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TTriggerFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Destroy; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TTriggerFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata)</span></span></span><span class="hljs-function">:</span></span> IExternalTrigger; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := T.Create; (Result <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T).Metadata := AMetadata; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TTriggerFactory</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AFieldsBuilder: IMetadataBuilder)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">          <a href="">https://github.com/sim1984/udr-book/blob/master/examples/Common/UdrFactories.pas</a> . </p><br><h1 id="rabota-s-tipom-blob" style=";text-align:right;direction:rtl">    BLOB </h1><br><p style=";text-align:right;direction:rtl">       BLOB    ( BLOB),    .  , BLOB    ,         .         BLOB .      BLOB   <br>  <code>IBlob</code> . </p><br><p style=";text-align:right;direction:rtl">      BLOB  ,  BLOB    ,      BLOB   ,     BLOB     . </p><br><p style=";text-align:right;direction:rtl">     BLOB    ,   BLOB     (),     64 .     <code>getSegment</code>  <code>IBlob</code> .     <code>putSegment</code>  <code>IBlob</code> . </p><br><h2 id="chtenie-dannyh-iz-blob" style=";text-align:right;direction:rtl">    BLOB </h2><br><p style=";text-align:right;direction:rtl">     BLOB     <br>    (     <br>  LIST).     </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span> <span class="hljs-keyword"><span class="hljs-keyword">split</span></span> ( txt <span class="hljs-built_in"><span class="hljs-built_in">blob</span></span> sub_type <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> utf8, delimiter <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> utf8 = <span class="hljs-string"><span class="hljs-string">','</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-string"><span class="hljs-string">'myudr!split'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">engine</span></span> udr;</code> </pre> <br><p style=";text-align:right;direction:rtl">    : </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firebird_udr_plugin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AUnloadFlagLocal: BooleanPtr; AUdrPlugin: IUdrPlugin)</span></span></span><span class="hljs-function">:</span></span> BooleanPtr; <span class="hljs-keyword"><span class="hljs-keyword">cdecl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//    AUdrPlugin.registerProcedure(AStatus, 'split', TProcedureSimpleFactory&lt;TSplitProcedure&gt;.Create()); theirUnloadFlag := AUnloadFlagLocal; Result := @myUnloadFlag; end;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">         ,         .      . </p><br><p style=";text-align:right;direction:rtl">     .        . </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"> TInput = <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> txt: ISC_QUAD; txtNull: WordBool; delimiter: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span> .. <span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> AnsiChar; delimiterNull: WordBool; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; TInputPtr = ^TInput; TOutput = <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> Id: Integer; Null: WordBool; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; TOutputPtr = ^TOutput;</code> </pre> <br><p style=";text-align:right;direction:rtl">     BLOB   BLOB,    <code>ISC_QUAD</code> . </p><br><p style=";text-align:right;direction:rtl">        : </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">   Split    </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TSplitProcedure</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(IExternalProcedureImpl) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveBlobToStream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; ABlobId: ISC_QUADPtr; AStream: TStream)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readBlob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; ABlobId: ISC_QUADPtr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-comment"><span class="hljs-comment">//      procedure dispose(); override; procedure getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); override; function open(AStatus: IStatus; AContext: IExternalContext; AInMsg: Pointer; AOutMsg: Pointer): IExternalResultSet; override; end; TSplitResultSet = class(IExternalResultSetImpl) {$IFDEF FPC} OutputArray: TStringArray; {$ELSE} OutputArray: TArray&lt;string&gt;; {$ENDIF} Counter: Integer; Output: TOutputPtr; procedure dispose(); override; function fetch(AStatus: IStatus): Boolean; override; end;</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">   <code>SaveBlobToStream</code>  <code>readBlob</code>    BLOB.   BLOB  ,  โ           Delphi.       OutputArray     Counter. </p><br><p style=";text-align:right;direction:rtl">   open  BLOB    .          <code>Split</code>    .        . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">TSplitProcedure.open</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TSplitProcedure</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AInMsg, AOutMsg: Pointer)</span></span></span><span class="hljs-function">:</span></span> IExternalResultSet; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xInput: TInputPtr; xText: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; xDelimiter: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> xInput := AInMsg; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> xInput.txtNull <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> xInput.delimiterNull <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; xText := readBlob(AStatus, AContext, @xInput.txt); xDelimiter := TFBCharSet.CS_UTF8.GetString(TBytes(@xInput.delimiter), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-comment"><span class="hljs-comment">//        //    //  - /4 SetLength(xDelimiter, 1); Result := TSplitResultSet.Create; with TSplitResultSet(Result) do begin Output := AOutMsg; OutputArray := xText.Split([xDelimiter], TStringSplitOptions.ExcludeEmpty); Counter := 0; end; end;</span></span></code> </pre> </div></div><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>   <code>TFBCharSet</code>    Firebird.pas.    <br>      Firebird.     <br>        UTF-8. <br>     <a href="">FbCharsets.pas</a> </blockquote><p style=";text-align:right;direction:rtl">       BLOB  .       BLOB   .      openBlob  <code>IAttachment</code> .    BLOB    ,        .              ,    <br> ( <code>IExternalContext</code> ). </p><br><p style=";text-align:right;direction:rtl"> BLOB   (),     64 .     <code>getSegment</code>  <code>IBlob</code> . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">TSplitProcedure.SaveBlobToStream</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TSplitProcedure</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveBlobToStream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; ABlobId: ISC_QUADPtr; AStream: TStream)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> att: IAttachment; trx: ITransaction; blob: IBlob; buffer: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span> .. <span class="hljs-number"><span class="hljs-number">32767</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> AnsiChar; l: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> att := AContext.getAttachment(AStatus); trx := AContext.getTransaction(AStatus); blob := att.openBlob(AStatus, trx, ABlobId, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> True <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> blob.getSegment(AStatus, SizeOf(buffer), @buffer, @l) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> IStatus.RESULT_OK: AStream.WriteBuffer(buffer, l); IStatus.RESULT_SEGMENT: AStream.WriteBuffer(buffer, l); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; AStream.Position := <span class="hljs-number"><span class="hljs-number">0</span></span>; blob.close(AStatus); <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Assigned(att) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> att.release; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Assigned(trx) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> trx.release; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Assigned(blob) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> blob.release; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> </div></div><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>  ,  <code>IAttachment</code> , <code>ITransaction</code>  <code>IBlob</code> <br>   <code>IReferenceCounted</code> ,      <br>  .      <br>     1.      <br>         release. </blockquote><p style=";text-align:right;direction:rtl">    <code>SaveBlobToStream</code>    BLOB  <br> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TSplitProcedure</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readBlob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; ABlobId: ISC_QUADPtr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> xStream: TBytesStream; <span class="hljs-meta"><span class="hljs-meta">{$ELSE}</span></span> xStream: TStringStream; <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> xStream := TBytesStream.Create(<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>); <span class="hljs-meta"><span class="hljs-meta">{$ELSE}</span></span> xStream := TStringStream.Create(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">65001</span></span>); <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> SaveBlobToStream(AStatus, AContext, ABlobId, xStream); <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> Result := TEncoding.UTF8.GetString(xStream.Bytes, <span class="hljs-number"><span class="hljs-number">0</span></span>, xStream.Size); <span class="hljs-meta"><span class="hljs-meta">{$ELSE}</span></span> Result := xStream.DataString; <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> xStream.Free; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>   Free Pascal      <br>  Delphi   <code>TStringStream</code> .    FPC   <br>      ,    <br>        . </blockquote><p style=";text-align:right;direction:rtl">  <code>fetch</code>           Counter      ,       .      .           <code>isc_convert_error</code> . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"> isc_convert_error</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TSplitResultSet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> SetLength(OutputArray, <span class="hljs-number"><span class="hljs-number">0</span></span>); Destroy; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TSplitResultSet</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus)</span></span></span><span class="hljs-function">:</span></span> Boolean; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statusVector: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span> .. <span class="hljs-number"><span class="hljs-number">4</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> NativeIntPtr; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Counter &lt;= High(OutputArray) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Output.Null := False; <span class="hljs-comment"><span class="hljs-comment">//         isc_random //        Firebird //  isc_convert_error try Output.Id := OutputArray[Counter].ToInteger(); except on e: EConvertError do begin statusVector[0] := NativeIntPtr(isc_arg_gds); statusVector[1] := NativeIntPtr(isc_convert_error); statusVector[2] := NativeIntPtr(isc_arg_string); statusVector[3] := NativeIntPtr(PAnsiChar('Cannot convert string to integer')); statusVector[4] := NativeIntPtr(isc_arg_end); AStatus.setErrors(@statusVector); end; end; inc(Counter); Result := True; end else Result := False; end;</span></span></code> </pre> </div></div><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>        <code>isc_random</code>   <br> ,      . </blockquote><p style=";text-align:right;direction:rtl">      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ids.ID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SPLIT</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIST</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> MYTABLE), <span class="hljs-string"><span class="hljs-string">','</span></span>) ids</code> </pre> <br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>       ,  BLOB  <br>   ,       <br>    .       <br>   ,      <br>   .       <br>    <code>fetch</code>     . </blockquote><br><h2 id="zapis-dannyh-v-blob" style=";text-align:right;direction:rtl">    BLOB </h2><br><p style=";text-align:right;direction:rtl">     BLOB     <br> BLOB  . </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>      UDF     <br>  BLOB / .  UDF    <br> <a href="">blobsaveload.zip</a> </blockquote><p style=";text-align:right;direction:rtl">      BLOB /      </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PACKAGE</span></span> BlobFileUtils <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> SaveBlobToFile(ABlob <span class="hljs-built_in"><span class="hljs-built_in">BLOB</span></span>, AFileName <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> UTF8); FUNCTION LoadBlobFromFile(AFileName VARCHAR(255) CHARACTER <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> UTF8) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BLOB</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>^ <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PACKAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span> BlobFileUtils <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> SaveBlobToFile(ABlob <span class="hljs-built_in"><span class="hljs-built_in">BLOB</span></span>, AFileName <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> UTF8) <span class="hljs-keyword"><span class="hljs-keyword">EXTERNAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-string"><span class="hljs-string">'BlobFileUtils!SaveBlobToFile'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> UDR; FUNCTION LoadBlobFromFile(AFileName VARCHAR(255) CHARACTER <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> UTF8) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BLOB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXTERNAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-string"><span class="hljs-string">'BlobFileUtils!LoadBlobFromFile'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> UDR; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>^</code> </pre> <br><p style=";text-align:right;direction:rtl">      : </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firebird_udr_plugin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AUnloadFlagLocal: BooleanPtr; AUdrPlugin: IUdrPlugin)</span></span></span><span class="hljs-function">:</span></span> BooleanPtr; <span class="hljs-keyword"><span class="hljs-keyword">cdecl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//  AUdrPlugin.registerProcedure(AStatus, 'SaveBlobToFile', TSaveBlobToFileProcFactory.Create()); AUdrPlugin.registerFunction(AStatus, 'LoadBlobFromFile', TLoadBlobFromFileFuncFactory.Create()); theirUnloadFlag := AUnloadFlagLocal; Result := @myUnloadFlag; end;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">          BLOB  ,   UDR      <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">06.BlobSaveLoad</a> .       LoadBlobFromFile   : </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">  </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Firebird, Classes, SysUtils; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-comment"><span class="hljs-comment">//    TInput = record filename: record len: Smallint; str: array [0 .. 1019] of AnsiChar; end; filenameNull: WordBool; end; TInputPtr = ^TInput; //    TOutput = record blobData: ISC_QUAD; blobDataNull: WordBool; end; TOutputPtr = ^TOutput; //   LoadBlobFromFile TLoadBlobFromFileFunc = class(IExternalFunctionImpl) public procedure dispose(); override; procedure getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); override; procedure execute(AStatus: IStatus; AContext: IExternalContext; AInMsg: Pointer; AOutMsg: Pointer); override; end; //       LoadBlobFromFile TLoadBlobFromFileFuncFactory = class(IUdrFunctionFactoryImpl) procedure dispose(); override; procedure setup(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata; AInBuilder: IMetadataBuilder; AOutBuilder: IMetadataBuilder); override; function newItem(AStatus: IStatus; AContext: IExternalContext; AMetadata: IRoutineMetadata): IExternalFunction; override; end;</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">      <code>execute</code>  <code>TLoadBlobFromFile</code> ,    . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">  execute</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TLoadBlobFromFileFunc</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AInMsg: Pointer; AOutMsg: Pointer)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MaxBufSize = <span class="hljs-number"><span class="hljs-number">16384</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xInput: TInputPtr; xOutput: TOutputPtr; xFileName: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; xStream: TFileStream; att: IAttachment; trx: ITransaction; blob: IBlob; buffer: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span> .. <span class="hljs-number"><span class="hljs-number">32767</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Byte; xStreamSize: Integer; xBufferSize: Integer; xReadLength: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> xInput := AInMsg; xOutput := AOutMsg; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> xInput.filenameNull <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> xOutput.blobDataNull := True; <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; xOutput.blobDataNull := False; <span class="hljs-comment"><span class="hljs-comment">//    xFileName := TEncoding.UTF8.GetString(TBytes(@xInput.filename.str), 0, xInput.filename.len * 4); SetLength(xFileName, xInput.filename.len); //     xStream := TFileStream.Create(xFileName, fmOpenRead or fmShareDenyNone); att := AContext.getAttachment(AStatus); trx := AContext.getTransaction(AStatus); blob := nil; try xStreamSize := xStream.Size; //     () if xStreamSize &gt; MaxBufSize then xBufferSize := MaxBufSize else xBufferSize := xStreamSize; //   blob blob := att.createBlob(AStatus, trx, @xOutput.blobData, 0, nil); //        BLOB   while xStreamSize &lt;&gt; 0 do begin if xStreamSize &gt; xBufferSize then xReadLength := xBufferSize else xReadLength := xStreamSize; xStream.ReadBuffer(buffer, xReadLength); blob.putSegment(AStatus, xReadLength, @buffer[0]); Dec(xStreamSize, xReadLength); end; //  BLOB blob.close(AStatus); finally if Assigned(blob) then blob.release; att.release; trx.release; xStream.Free; end; end;</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">      BLOB     blobId     <code>createBlob</code>  <code>IAttachment</code> .       BLOB    ,        .              ,    ( <code>IExternalContext</code> ). </p><br><p style=";text-align:right;direction:rtl">           BLOB,        <code>putSegment</code>  <code>IBlob</code>   ,       .             <code>close</code> . </p><br><h2 id="helper-dlya-raboty-s-tipom-blob" style=";text-align:right;direction:rtl">      BLOB </h2><br><p style=";text-align:right;direction:rtl">         BLOB  <br> ,     BLOB  .    <br>      BLOB,      <br>       . </p><br><p style=";text-align:right;direction:rtl">   Delphi  Free Pascal    <br>          . <br>     IBlob      <br>  / Blob. </p><br><p style=";text-align:right;direction:rtl">    FbBlob,     . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">BlobHelper</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> FbBlob; <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, Firebird; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MAX_SEGMENT_SIZE = $<span class="hljs-number"><span class="hljs-number">7</span></span>FFF; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> TFbBlobHelper = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">helper</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> IBlob <span class="hljs-comment"><span class="hljs-comment">{   BLOB   @param(AStatus  ) @param(AStream ) }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromStream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AStream: TStream)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-comment"><span class="hljs-comment">{     BLOB @param(AStatus  ) @param(AStream ) }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveToStream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AStream: TStream)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Math; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFbBlobHelper</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromStream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AStream: TStream)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xStreamSize: Integer; xReadLength: Integer; xBuffer: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span> .. MAX_SEGMENT_SIZE] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Byte; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> xStreamSize := AStream.Size; AStream.Position := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> xStreamSize &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> xReadLength := Min(xStreamSize, MAX_SEGMENT_SIZE); AStream.ReadBuffer(xBuffer, xReadLength); Self.putSegment(AStatus, xReadLength, @xBuffer[<span class="hljs-number"><span class="hljs-number">0</span></span>]); Dec(xStreamSize, xReadLength); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFbBlobHelper</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveToStream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AStream: TStream)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xInfo: TFbBlobInfo; Buffer: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span> .. MAX_SEGMENT_SIZE] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Byte; xBytesRead: Cardinal; xBufferSize: Cardinal; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> AStream.Position := <span class="hljs-number"><span class="hljs-number">0</span></span>; xBufferSize := Min(SizeOf(Buffer), MAX_SEGMENT_SIZE); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> True <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Self.getSegment(AStatus, xBufferSize, @Buffer[<span class="hljs-number"><span class="hljs-number">0</span></span>], @xBytesRead) <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> IStatus.RESULT_OK: AStream.WriteBuffer(Buffer, xBytesRead); IStatus.RESULT_SEGMENT: AStream.WriteBuffer(Buffer, xBytesRead); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">         BLOB,     BLOB      : </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">TLoadBlobFromFileFunc.execute</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TLoadBlobFromFileFunc</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AInMsg: Pointer; AOutMsg: Pointer)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xInput: TInputPtr; xOutput: TOutputPtr; xFileName: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; xStream: TFileStream; att: IAttachment; trx: ITransaction; blob: IBlob; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> xInput := AInMsg; xOutput := AOutMsg; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> xInput.filenameNull <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> xOutput.blobDataNull := True; <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; xOutput.blobDataNull := False; <span class="hljs-comment"><span class="hljs-comment">//    xFileName := TEncoding.UTF8.GetString(TBytes(@xInput.filename.str), 0, xInput.filename.len * 4); SetLength(xFileName, xInput.filename.len); //     xStream := TFileStream.Create(xFileName, fmOpenRead or fmShareDenyNone); att := AContext.getAttachment(AStatus); trx := AContext.getTransaction(AStatus); blob := nil; try //   blob blob := att.createBlob(AStatus, trx, @xOutput.blobData, 0, nil); //     BLOB blob.LoadFromStream(AStatus, xStream); //  BLOB blob.close(AStatus); finally if Assigned(blob) then blob.release; att.release; trx.release; xStream.Free; end; end;</span></span></code> </pre> </div></div><br><h1 id="kontekst-soedineniya-i-tranzakcii" style=";text-align:right;direction:rtl">     </h1><br><p style=";text-align:right;direction:rtl">    ,              ,    ,        / .  ,            BLOB. </p><br><p style=";text-align:right;direction:rtl">    ,          <code>IExternalContext</code>   execute   ,    open .  <code>IExternalContext</code>        <code>getAttachment</code> ,       <code>getTransaction</code> .      UDR,              ,        ,     <code>startTransaction</code>  <code>IExternalContext</code> .              .  ,               , ..     (2PC). </p><br><p style=";text-align:right;direction:rtl">          ,      SELECT    JSON.    : </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> GetJson ( sql_text <span class="hljs-built_in"><span class="hljs-built_in">blob</span></span> sub_type <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> utf8, sql_dialect <span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-built_in"><span class="hljs-built_in">blob</span></span> sub_type <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">external</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-string"><span class="hljs-string">'JsonUtils!getJson'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">engine</span></span> udr;</code> </pre> <br><p style=";text-align:right;direction:rtl">      SQL ,        ,         .         <code>IMessageMetadata</code> .      ,          ,    <br>     Firebird. </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>  JSON        . <br>    CHAR, VARCHAR  OCTETS NONE  BLOB SUB_TYPE BINARY <br>        base64, <br>      JSON. </blockquote><p style=";text-align:right;direction:rtl">    : </p><br><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firebird_udr_plugin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AUnloadFlagLocal: BooleanPtr; AUdrPlugin: IUdrPlugin)</span></span></span><span class="hljs-function">:</span></span> BooleanPtr; <span class="hljs-keyword"><span class="hljs-keyword">cdecl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//   AUdrPlugin.registerFunction(AStatus, 'getJson', TFunctionSimpleFactory&lt;TJsonFunction&gt;.Create()); theirUnloadFlag := AUnloadFlagLocal; Result := @myUnloadFlag; end;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">        ,       : </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">   GetJson</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> JsonFunc; <span class="hljs-meta"><span class="hljs-meta">{$IFDEF FPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$MODE objfpc}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$DEFINE DEBUGFPC}</span></span> <span class="hljs-meta"><span class="hljs-meta">{$ENDIF}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Firebird, UdrFactories, FbTypes, FbCharsets, SysUtils, System.NetEncoding, System.Json; <span class="hljs-comment"><span class="hljs-comment">// ********************************************************* // create function GetJson ( // sql_text blob sub_type text, // sql_dialect smallint not null default 3 // ) returns blob sub_type text character set utf8 // external name 'JsonUtils!getJson' // engine udr; // ********************************************************* type TInput = record SqlText: ISC_QUAD; SqlNull: WordBool; SqlDialect: Smallint; SqlDialectNull: WordBool; end; InputPtr = ^TInput; TOutput = record Json: ISC_QUAD; NullFlag: WordBool; end; OutputPtr = ^TOutput; //   TSumArgsFunction. TJsonFunction = class(IExternalFunctionImpl) public procedure dispose(); override; procedure getCharSet(AStatus: IStatus; AContext: IExternalContext; AName: PAnsiChar; ANameSize: Cardinal); override; {         @param(AValue ) @param(Scale ) @returns(   ) } function MakeScaleInteger(AValue: Int64; Scale: Smallint): string; {       Json @param(AStatus  ) @param(AContext    ) @param(AJson   Json) @param(ABuffer  ) @param(AMeta  ) @param(AFormatSetting     ) } procedure writeJson(AStatus: IStatus; AContext: IExternalContext; AJson: TJsonArray; ABuffer: PByte; AMeta: IMessageMetadata; AFormatSettings: TFormatSettings); {    @param(AStatus  ) @param(AContext    ) @param(AInMsg    ) @param(AOutMsg    ) } procedure execute(AStatus: IStatus; AContext: IExternalContext; AInMsg: Pointer; AOutMsg: Pointer); override; end;</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">   <code>MakeScaleInteger</code>       ,  <code>writeJson</code>        Json        .     ,      <code>execute</code>    . </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">TJsonFunction.execute</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TJsonFunction</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AInMsg, AOutMsg: Pointer)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xFormatSettings: TFormatSettings; xInput: InputPtr; xOutput: OutputPtr; att: IAttachment; tra: ITransaction; stmt: IStatement; inBlob, outBlob: IBlob; inStream: TBytesStream; outStream: TStringStream; cursorMetaData: IMessageMetadata; rs: IResultSet; msgLen: Cardinal; msg: Pointer; jsonArray: TJsonArray; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> xInput := AInMsg; xOutput := AOutMsg; <span class="hljs-comment"><span class="hljs-comment">//      NULL,    NULL if xInput.SqlNull or xInput.SqlDialectNull then begin xOutput.NullFlag := True; Exit; end; xOutput.NullFlag := False; //      xFormatSettings := TFormatSettings.Create; xFormatSettings.DateSeparator := '-'; xFormatSettings.TimeSeparator := ':'; //      blob inStream := TBytesStream.Create(nil); outStream := TStringStream.Create('', 65001); jsonArray := TJsonArray.Create; //      att := AContext.getAttachment(AStatus); tra := AContext.getTransaction(AStatus); stmt := nil; inBlob := nil; outBlob := nil; try //  BLOB   inBlob := att.openBlob(AStatus, tra, @xInput.SqlText, 0, nil); inBlob.SaveToStream(AStatus, inStream); inBlob.close(AStatus); //   stmt := att.prepare(AStatus, tra, inStream.Size, @inStream.Bytes[0], xInput.SqlDialect, IStatement.PREPARE_PREFETCH_METADATA); //     cursorMetaData := stmt.getOutputMetadata(AStatus); //   rs := stmt.openCursor(AStatus, tra, nil, nil, nil, 0); //     msgLen := cursorMetaData.getMessageLength(AStatus); msg := AllocMem(msgLen); try //     while rs.fetchNext(AStatus, msg) = IStatus.RESULT_OK do begin //     JSON writeJson(AStatus, AContext, jsonArray, msg, cursorMetaData, xFormatSettings); end; finally //   FreeMem(msg); end; //   rs.close(AStatus); //  JSON   outStream.WriteString(jsonArray.ToJSON); //  json   blob outBlob := att.createBlob(AStatus, tra, @xOutput.Json, 0, nil); outBlob.LoadFromStream(AStatus, outStream); outBlob.close(AStatus); finally if Assigned(inBlob) then inBlob.release; if Assigned(stmt) then stmt.release; if Assigned(outBlob) then outBlob.release; tra.release; att.release; jsonArray.Free; inStream.Free; outStream.Free; end; end;</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">                <code>getAttachment</code>  <code>getTransaction</code>  <code>IExternalContext</code> .    BLOB    SQL .      prepare  <code>IAttachment</code> .    SQL       .     <code>IStatement.PREPARE_PREFETCH_METADATA</code> ,             .         <code>getOutputMetadata</code>  <code>IStatement</code> . </p><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>     getOutputMetadata      . <br>  <code>IStatement.PREPARE_PREFETCH_METADATA</code>     <br>        .     <br>         ,    . </blockquote><p style=";text-align:right;direction:rtl">       openCursor     ( 2).           <code>getMessageLength</code>  <code>IMessageMetadata</code> .      ,         . </p><br><p style=";text-align:right;direction:rtl">       <code>fetchNext</code>  <code>IResultSet</code> .     <code>msg</code>      <code>IStatus.RESULT_OK</code>   ,     .       <code>writeJson</code> ,     <code>TJsonObject</code>       <code>TJsonArray</code> . </p><br><p style=";text-align:right;direction:rtl">     ,    <code>close</code> ,   Json   ,     ,     Blob. </p><br><p style=";text-align:right;direction:rtl">    <code>writeJson</code> .  <code>IUtil</code>    ,        .               <code>IMessageMetadata</code> .      <code>TJsonObject</code>        .          .   NullFlag,    null       ,            Json. </p><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"> writeJson</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TJsonFunction</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MakeScaleInteger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AValue: Int64; Scale: Smallint)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> L: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := AValue.ToString; L := Result.Length; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (-Scale &gt;= L) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Result := <span class="hljs-string"><span class="hljs-string">'0.'</span></span> + Result.PadLeft(-Scale, <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Result := Result.Insert(Scale + L, <span class="hljs-string"><span class="hljs-string">'.'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TJsonFunction</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeJson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AStatus: IStatus; AContext: IExternalContext; AJson: TJsonArray; ABuffer: PByte; AMeta: IMessageMetadata; AFormatSettings: TFormatSettings)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jsonObject: TJsonObject; i: Integer; FieldName: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; NullFlag: WordBool; pData: PByte; util: IUtil; metaLength: Integer; <span class="hljs-comment"><span class="hljs-comment">//  CharBuffer: array [0 .. 35766] of Byte; charLength: Smallint; charset: TFBCharSet; StringValue: string; SmallintValue: Smallint; IntegerValue: Integer; BigintValue: Int64; Scale: Smallint; SingleValue: Single; DoubleValue: Double; BooleanValue: Boolean; DateValue: ISC_DATE; TimeValue: ISC_TIME; TimestampValue: ISC_TIMESTAMP; DateTimeValue: TDateTime; year, month, day: Cardinal; hours, minutes, seconds, fractions: Cardinal; blobId: ISC_QUADPtr; BlobSubtype: Smallint; blob: IBlob; textStream: TStringStream; binaryStream: TBytesStream; att: IAttachment; tra: ITransaction; begin //  IUtil util := AContext.getMaster().getUtilInterface(); //   TJsonObject    //     jsonObject := TJsonObject.Create; for i := 0 to AMeta.getCount(AStatus) - 1 do begin //      FieldName := AMeta.getAlias(AStatus, i); NullFlag := PWordBool(ABuffer + AMeta.getNullOffset(AStatus, i))^; if NullFlag then begin //  NULL    JSON      jsonObject.AddPair(FieldName, TJsonNull.Create); continue; end; //      pData := ABuffer + AMeta.getOffset(AStatus, i); case TFBType(AMeta.getType(AStatus, i)) of // VARCHAR SQL_VARYING: begin //    VARCHAR metaLength := AMeta.getLength(AStatus, i); charset := TFBCharSet(AMeta.getCharSet(AStatus, i)); //  VARCHAR  2  -  charLength := PSmallint(pData)^; //     base64 if charset = CS_BINARY then StringValue := TNetEncoding.Base64.EncodeBytesToString((pData + 2), charLength) else begin //       3  Move((pData + 2)^, CharBuffer, metaLength - 2); StringValue := charset.GetString(TBytes(@CharBuffer), 0, charLength * charset.GetCharWidth) SetLength(StringValue, charLength); end; jsonObject.AddPair(FieldName, StringValue); end; // CHAR SQL_TEXT: begin //    CHAR metaLength := AMeta.getLength(AStatus, i); charset := TFBCharSet(AMeta.getCharSet(AStatus, i)); //     base64 if charset = CS_BINARY then StringValue := TNetEncoding.Base64.EncodeBytesToString((pData + 2), metaLength) else begin //     Move(pData^, CharBuffer, metaLength); StringValue := charset.GetString(TBytes(@CharBuffer), 0, metaLength); charLength := metaLength div charset.GetCharWidth; SetLength(StringValue, charLength); end; jsonObject.AddPair(FieldName, StringValue); end; // FLOAT SQL_FLOAT: begin SingleValue := PSingle(pData)^; jsonObject.AddPair(FieldName, TJSONNumber.Create(SingleValue)); end; // DOUBLE PRECISION // DECIMAL(p, s),  p = 10..15  1  SQL_DOUBLE, SQL_D_FLOAT: begin DoubleValue := PDouble(pData)^; jsonObject.AddPair(FieldName, TJSONNumber.Create(DoubleValue)); end; // INTEGER // NUMERIC(p, s),  p = 1..4 SQL_SHORT: begin Scale := AMeta.getScale(AStatus, i); SmallintValue := PSmallint(pData)^; if (Scale = 0) then begin jsonObject.AddPair(FieldName, TJSONNumber.Create(SmallintValue)); end else begin StringValue := MakeScaleInteger(SmallintValue, Scale); jsonObject.AddPair(FieldName, TJSONNumber.Create(StringValue)); end; end; // INTEGER // NUMERIC(p, s),  p = 5..9 // DECIMAL(p, s),  p = 1..9 SQL_LONG: begin Scale := AMeta.getScale(AStatus, i); IntegerValue := PInteger(pData)^; if (Scale = 0) then begin jsonObject.AddPair(FieldName, TJSONNumber.Create(IntegerValue)); end else begin StringValue := MakeScaleInteger(IntegerValue, Scale); jsonObject.AddPair(FieldName, TJSONNumber.Create(StringValue)); end; end; // BIGINT // NUMERIC(p, s),  p = 10..18  3  // DECIMAL(p, s),  p = 10..18  3  SQL_INT64: begin Scale := AMeta.getScale(AStatus, i); BigintValue := Pint64(pData)^; if (Scale = 0) then begin jsonObject.AddPair(FieldName, TJSONNumber.Create(BigintValue)); end else begin StringValue := MakeScaleInteger(BigintValue, Scale); jsonObject.AddPair(FieldName, TJSONNumber.Create(StringValue)); end; end; // TIMESTAMP SQL_TIMESTAMP: begin TimestampValue := PISC_TIMESTAMP(pData)^; //    - util.decodeDate(TimestampValue.date, @year, @month, @day); util.decodeTime(TimestampValue.time, @hours, @minutes, @seconds, @fractions); //  -    Delphi DateTimeValue := EncodeDate(year, month, day) + EncodeTime(hours, minutes, seconds, fractions div 10); //  -    StringValue := FormatDateTime('yyyy/mm/dd hh:nn:ss', DateTimeValue, AFormatSettings); jsonObject.AddPair(FieldName, StringValue); end; // DATE SQL_DATE: begin DateValue := PISC_DATE(pData)^; //     util.decodeDate(DateValue, @year, @month, @day); //      Delphi DateTimeValue := EncodeDate(year, month, day); //      StringValue := FormatDateTime('yyyy/mm/dd', DateTimeValue, AFormatSettings); jsonObject.AddPair(FieldName, StringValue); end; // TIME SQL_TIME: begin TimeValue := PISC_TIME(pData)^; //     util.decodeTime(TimeValue, @hours, @minutes, @seconds, @fractions); //      Delphi DateTimeValue := EncodeTime(hours, minutes, seconds, fractions div 10); //      StringValue := FormatDateTime('hh:nn:ss', DateTimeValue, AFormatSettings); jsonObject.AddPair(FieldName, StringValue); end; // BOOLEAN SQL_BOOLEAN: begin BooleanValue := PBoolean(pData)^; jsonObject.AddPair(FieldName, TJsonBool.Create(BooleanValue)); end; // BLOB SQL_BLOB, SQL_QUAD: begin BlobSubtype := AMeta.getSubType(AStatus, i); blobId := ISC_QUADPtr(pData); att := AContext.getAttachment(AStatus); tra := AContext.getTransaction(AStatus); blob := att.openBlob(AStatus, tra, blobId, 0, nil); if BlobSubtype = 1 then begin //  charset := TFBCharSet(AMeta.getCharSet(AStatus, i)); //      textStream := TStringStream.Create('', charset.GetCodePage); try blob.SaveToStream(AStatus, textStream); StringValue := textStream.DataString; finally textStream.Free; blob.release; tra.release; att.release end; end else begin //      binaryStream := TBytesStream.Create; try blob.SaveToStream(AStatus, binaryStream); //    base64 StringValue := TNetEncoding.Base64.EncodeBytesToString (binaryStream.Memory, binaryStream.Size); finally binaryStream.Free; blob.release; tra.release; att.release end; end; jsonObject.AddPair(FieldName, StringValue); end; end; end; //     Json   AJson.AddElement(jsonObject); end;</span></span></code> </pre> </div></div><br><blockquote style=";text-align:right;direction:rtl">  <strong>ุชุนููู</strong> <br><br>   TFbType     <code>Firebird.pas</code> . <br>      ,      <br> <a href="">FbTypes</a>        . <br><br>  TFBCharSet     <code>Firebird.pas</code> . <br>     <br> <a href="">FbCharsets</a>     .  ,     <br>  ,       <br>   ,  ,    , <br>   <code>TEncoding</code>   ,     <br>       Delphi. </blockquote><p style=";text-align:right;direction:rtl">    CHAR  VARCHAR  ,    OCTETS,     base64,          Delphi.  ,    VARCHAR  2      . </p><br><p style=";text-align:right;direction:rtl">  SMALLINT, INTEGER, BIGINT      ,  .      <code>getScale</code>  <code>IMessageMetadata</code> .     0,     ,    <code>MakeScaleInteger</code> . </p><br><p style=";text-align:right;direction:rtl">  DATE, TIME  TIMESTAMP           <code>decodeDate</code>  <code>decodeTime</code>  <code>IUtil</code> .        -   Delphi  <code>TDateTime</code> . </p><br><p style=";text-align:right;direction:rtl">   BLOB    Delphi.  BLOB ,     <code>TBytesStream</code> .        base64.  BLOB ,     <code>TStringStream</code>  ,     .       BLOB <br> . </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุดูุก.      UDR  Firebird,   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar455375/">https://habr.com/ru/post/ar455375/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar455361/index.html">ูุฌุนู ุงูุชุฏุงุฏ ุงููุชุตูุญ ุงูุฐู ูุชุญูู ูุชุงุฆุฌ ุงูุงูุชุญุงู</a></li>
<li><a href="../ar455367/index.html">ุงูุญุฏ ุงูุฃุฏูู ููุธููุฉ VueJs + MVC</a></li>
<li><a href="../ar455369/index.html">ุดูุงุฏุฉ ูู ูุณุคููู ููุงุนุฏ ุงูุจูุงูุงุช ูุฃูุซุฑ ูู ุฐูู ุจูุซูุฑ ูู ุฐูุฑู DevConfX (21-22 ููููู ูู ููุณูู)</a></li>
<li><a href="../ar455371/index.html">ูุตุฏุฑ ุชูุงุฑ ูุณุชูุฑ ูู 5 toA ุฅูู 20 ูููู ุฃูุจูุฑ</a></li>
<li><a href="../ar455373/index.html">ููู ูููู ุชุนุฏูู ูุงููู ุงูุฑุจูุน ุจุญูุซ ูุตุจุญ ุฑูุนูุง ุนู ููุฏูู ุงูุฎุฏูุงุช ุงูุตุบุงุฑุ ุฃูุบูุง</a></li>
<li><a href="../ar455377/index.html">ููุฏุณุฉ ุฅูุชุฑูุช ุงูุฃุดูุงุก</a></li>
<li><a href="../ar455381/index.html">ูุณุชุฌูุจ ุงูุฏุนู ุงูููู 3CX: ุงูุชูุงุท ุญุฑูุฉ ูุฑูุฑ SIP ุนูู ุฎุงุฏู PBX</a></li>
<li><a href="../ar455387/index.html">ููู ุงูุชุนูู ุงูุขูู ูู ุญุฒูุฉ ูุฑูุฉ (ุงููููุจ Elasticsearch ุ ููุนุฑู ุฃูุถูุง ุจุงุณู ELK)</a></li>
<li><a href="../ar455389/index.html">Haxe 4: ูุง ุงูุฌุฏูุฏุ</a></li>
<li><a href="../ar455391/index.html">ุงูุฌุฒุก 1: RISC-V / RocketChip ูู ููุฆู ุบูุฑ ุทุจูุนู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>