<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è∞ üè° üëå Como integrar o ReactJS ao 1C-Bitrix com gera√ß√£o autom√°tica de modelos no back-end usando o exemplo da rede Globus üèì üëäüèº üôÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este ano, o ReactJS foi lan√ßado pela primeira vez para a loja online da cadeia de hipermercados Globus. O projeto √© interessante na medida em que expa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como integrar o ReactJS ao 1C-Bitrix com gera√ß√£o autom√°tica de modelos no back-end usando o exemplo da rede Globus</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421531/"> Este ano, o ReactJS foi lan√ßado pela primeira vez para a loja online da cadeia de hipermercados Globus.  O projeto √© interessante na medida em que expande os recursos da plataforma Bitrix e, ao mesmo tempo, mant√©m a capacidade de gerar p√°ginas para os mecanismos de pesquisa e n√£o se confunde com a duplica√ß√£o de c√≥digo e layout.  Neste artigo, falamos sobre como conectar componentes do Bitrix aos componentes do ReactJS usando o m√≥dulo v8js para php e salvar a parte principal principal do site. <br><a name="habracut"></a><br><h3>  Por que isso foi necess√°rio? </h3><br>  Inicialmente, a l√≥gica do site da loja online foi criada na biblioteca Marionette.js.  Alguns anos atr√°s, essa l√≥gica valeu a pena, mas com o tempo, os requisitos de neg√≥cios para a funcionalidade de front-end cresceram tanto que todo refinamento foi acompanhado por s√©rias dificuldades.  Devido √† alta carga, a velocidade da parte frontal diminuiu e deixou muito a desejar.  Para resolver esse problema, escolhemos o ReactJS, mas houve um problema ao renderizar p√°ginas para o back-end e depois vincular partes das p√°ginas para reagir aos componentes.  Ao mesmo tempo, nosso objetivo era uma transi√ß√£o gradual para o ReactJS, pois  mudan√ßas dr√°sticas poderiam levar a um redesenho completo da frente, resultando na escolha dos seguintes componentes: <br><br><ul><li>  Cart√µes de produtos; </li><li>  Mini cesta; </li><li>  Menu </li></ul><br>  A principal dificuldade na transfer√™ncia de minicestas e cart√µes de produtos para o ReactJS foi a sincroniza√ß√£o instant√¢nea da quantidade de mercadorias nos dois componentes, ou seja,  se 3 kg de cenoura estiverem na cesta, no bloco para adicionar mercadorias √† cesta (coletor), 3 kg devem ser exibidos e, quando a quantidade de mercadorias na minicareta for alterada, a mudan√ßa dever√° ocorrer no coletor e vice-versa.  Al√©m disso, era necess√°rio nivelar o atraso da solicita√ß√£o de back-end para que a interface funcionasse o mais r√°pido poss√≠vel. <br><br><img src="https://habrastorage.org/webt/zs/0-/4t/zs0-4tm2cptsxb_ertod4wohimm.png">  " <br><br>  Uma complexidade adicional foi a especificidade da loja (varejo de alimentos), onde existe o conceito de bens ponderados por pe√ßa.  Este √© um produto que √© considerado em kg, mas o usu√°rio o compra em peda√ßos, por exemplo, uma melancia, que o cliente n√£o pode comprar em parte, apenas na totalidade.  Esse produto para o usu√°rio deve ser exibido no n√∫mero de pe√ßas, mas no back-end √© considerado em quilogramas. <br><br><h3>  Como voc√™ resolveu o problema? </h3><br>  Para n√£o duplicar o layout dos componentes nos modelos do sistema 1C-Bitrix e React, foi decidido coloc√°-lo nos componentes React.  O nome do componente em React deve coincidir com o modelo de componente do sistema 1C-Bitrix.  Para implementar essas id√©ias, usamos: <br><br><ul><li>  M√≥dulo V8js para php; </li><li>  reactjs / react-php-v8js; </li><li>  webpack. </li></ul><br>  O primeiro item √© o m√≥dulo v8js, que deve converter nossos componentes de rea√ß√£o em um layout est√°tico no ambiente php. <br><br>  A seguir, √© apresentada uma pequena biblioteca do React Community, que √© um inv√≥lucro para facilitar a inicializa√ß√£o do React no ambiente js do m√≥dulo v8js. <br><br>  E, claro, webpack, onde sem ele.  Em conjunto com o babel, ele permite que voc√™ use modelos jsx e o padr√£o es6 para escrever c√≥digo.  Todos os exemplos ser√£o apresentados na sintaxe es6.  √â bastante simples, mas se n√£o for imediatamente entendido, voc√™ dever√° atualizar sua mem√≥ria. <br><br>  <i>M√≥dulo V8js para php.</i> <br><br>  Este m√≥dulo √© uma extens√£o para php, que permite usar o V8 Javascript Engine para executar o c√≥digo js no php.  Instala de maneira simples, como uma extens√£o PECL comum.  O principal √© que voc√™ tem nas bibliotecas do sistema e nos arquivos de cabe√ßalho V8. <br><br>  <i>Webpack</i> <br><br>  Para criar a biblioteca de reagir e reagir componentes, usamos o webpack.  Os arquivos de montagem da frente e de tr√°s s√£o ligeiramente diferentes.  Vamos para 3 arquivos: <br><br><ul><li>  initialize.js -&gt; app.js - aplicativo para a frente; </li><li>  reactServer.js -&gt; reactBuild.js - biblioteca de rea√ß√µes para o lado do servidor; </li><li>  components.js -&gt; reactComponents.js - uma cole√ß√£o de componentes de rea√ß√£o. </li></ul><br>  A principal diferen√ßa entre o assembly para renderiza√ß√£o do servidor √© que todas as bibliotecas e componentes devem ser colocados no objeto global e as bibliotecas s√£o conectadas atrav√©s da fun√ß√£o require.  A diretiva de importa√ß√£o, por algum motivo, n√£o funciona. <br><br>  Todos os arquivos de origem est√£o no diret√≥rio local / templates / &lt;nome do modelo&gt; / src / <br><br><img src="https://habrastorage.org/webt/gg/vz/ck/ggvzckbgtq4g4jl9ftrgkr5ipnu.png"><br><br>  Na raiz do projeto est√° webpack.config.js - settings. <br><br><img src="https://habrastorage.org/webt/fd/2j/yk/fd2jykgbdtcbpwfjn11goi5s8xq.png"><br><br>  O conte√∫do dos arquivos de montagem pode ser encontrado no final do artigo. <br><br>  Npm e os seguintes pacotes devem ser instalados: <br><br><ul><li>  babel; </li><li>  babel-cli; </li><li>  webpack </li><li>  reagir </li><li>  rea√ß√£o; </li><li>  sublinhado // opcional. </li></ul><br>  A montagem √© feita executando o comando: <br>  $ webpack. <br><br>  <i>Customiza√ß√£o do mecanismo de modelo bitrix</i> <br><br>  Para registrar um mecanismo personalizado no sistema 1C-Bitrix, voc√™ precisa adicionar suas configura√ß√µes √† vari√°vel global $ arCustomTemplateEngines.  Na chave, voc√™ precisa especificar o c√≥digo do seu mecanismo.  Usamos "JSX".  Nos valores, voc√™ precisa especificar a extens√£o do arquivo do modelo, a fun√ß√£o de renderizar o modelo.  √â aconselh√°vel especificar uma classifica√ß√£o abaixo de um valor de 100, para que a prioridade do nosso motor esteja acima do padr√£o. <br><br>  Crie uma classe JSXEngine com os seguintes m√©todos: <br><br><ul><li>  setEngine - registra um modelo; </li><li>  init - inicializa√ß√£o do v8js atrav√©s do wrapper da biblioteca reactjs / react-php-v8js; </li><li>  execute - funcionalidade de renderiza√ß√£o de modelo </li></ul><br>  e uma fun√ß√£o de wrapper para renderizar o modelo _JSXEngineExecute, porque  O sistema 1C-Bitrix requer o registro de uma fun√ß√£o espec√≠fica. <br><br>  Para n√£o inicializar sempre que uma inst√¢ncia React, coloque-a em uma vari√°vel est√°tica e adicione um m√©todo de inicializa√ß√£o. <br><br>  Uma interface especial √© implementada na classe ReactJS da biblioteca reactjs / react-php-v8js para renderizar o componente react.  O construtor da classe usa dois par√¢metros como entrada, que devem conter o c√≥digo js do m√≥dulo reat e todos os componentes reagentes utilizados no projeto coletado via webpack.  Ap√≥s a inicializa√ß√£o, podemos renderiz√°-los.  Para fazer isso, chame o m√©todo setComponent de instalar o componente com os par√¢metros do nome do componente e da matriz props.  Depois disso, o m√©todo getMarkup exibir√° o conte√∫do do componente, e o getJS exibir√° o c√≥digo js para vincular o componente na frente.  O m√©todo getJS requer o identificador do bloco html no qual o componente est√° localizado nos par√¢metros.  Para isso, implementamos um modelo simples para agrupar um componente renderizado em um bloco html.  As configura√ß√µes do pr√≥prio bloco s√£o transferidas para um arquivo json, que √© colocado no modelo de componente do sistema 1C-Bitrix.  As configura√ß√µes s√£o armazenadas no formato json. <br><br><img src="https://habrastorage.org/webt/t7/fd/r3/t7fdr30zlxslwvouggmryh6bvgu.png"><br><br><img src="https://habrastorage.org/webt/6g/ng/op/6gngopga5l-r10z4zfqzkjjgmbw.jpeg"><br><br>  <i>Transferir um componente para um novo modelo</i> <br><br>  Mostraremos a tradu√ß√£o do componente no React usando o exemplo de um componente de menu padr√£o.  O layout do componente j√° foi integrado ao mecanismo de modelo padr√£o.  O React recomenda uma pol√≠tica para quebrar a funcionalidade em componentes.  Al√©m disso, os componentes podem ser muito pequenos.  At√© a tag de hiperlink.  N√£o dividiremos nosso card√°pio com essas ninharias, mas, no entanto, faremos uma pequena decomposi√ß√£o. <br><br>  Nosso menu usa aninhamento at√© 3 n√≠veis.  Portanto, ser√° l√≥gico dividir a funcionalidade do menu em tr√™s componentes de rea√ß√£o, cada um por n√≠vel.  Se voc√™ observar com aten√ß√£o, notar√° que os itens de menu do segundo n√≠vel est√£o organizados em duas colunas.  Essa funcionalidade deve ser colocada em um componente adicional. <br><br><img src="https://habrastorage.org/webt/y1/uy/fo/y1uyfohp9vilnly4xun9zkfe5pm.png"><br><br>  Assim, temos 4 componentes.  Vamos coloc√°-los nos arquivos TopMenu.js, SubMenuLevel2.js, SubMenuLevel3.js, TwoColumnItem.js no diret√≥rio src / components (veja o c√≥digo para outros componentes no final): <br><br><img src="https://habrastorage.org/webt/nt/80/bj/nt80bjgwhznbqv9ckuiursphqyw.png"><br><br>  Para que nosso modelo funcione, √© necess√°rio criar um modelo para o componente de menu do sistema 1C-Bitrix.  O nome do modelo deve corresponder ao nome do componente de rea√ß√£o.  Dentro do modelo, voc√™ precisa colocar o arquivo com a extens√£o correspondente √†s configura√ß√µes do nosso mecanismo.  Dentro do arquivo, voc√™ precisa especificar o n√≥ html no qual nosso componente de rea√ß√£o ser√° renderizado. <br><br><h3>  Resultado </h3><br>  Esta solu√ß√£o permite usar componentes de rea√ß√£o no lado de back-end e no lado de front-end.  Assim, a l√≥gica de exibir a funcionalidade √© armazenada em um √∫nico local, o que facilita muito o suporte ao projeto. <br><br>  A velocidade da renderiza√ß√£o inicial da p√°gina aumentou quase 1s.  Porque  Agora voc√™ n√£o precisa redesenhar o elemento da casa no qual o componente est√° localizado.  O ReactJs pega na hora.  Al√©m disso, o piscar de elementos em dispositivos fracos desapareceu. <br><br>  No futuro, planeja mudar para renderizar componentes no back-end por meio de um servi√ßo baseado no node.js e implementar um aplicativo de p√°gina √∫nica, mantendo a capacidade de gerar p√°ginas para SEO. <br><br><h3>  App </h3><br>  initialize.js <br><br><img src="https://habrastorage.org/webt/s_/n2/mz/s_n2mz7lilpjjdadeg0ppctjlmk.png"><br><br>  components.js <br><br><img src="https://habrastorage.org/webt/gs/eo/m7/gseom7029c7ams6zdvaojkl894c.png"><br><br>  reactServer.js <br><br><img src="https://habrastorage.org/webt/bh/ne/ln/bhnelnigqxydigkiafpmoccwvwm.png"><br><br>  SubMenuLevel2.js <br><br><img src="https://habrastorage.org/webt/ep/7t/xa/ep7txacqkwh--ep9lealiucgves.png"><br><br>  SubMenuLevel3.js <br><br><img src="https://habrastorage.org/webt/8l/bo/oq/8lbooq9g6y2ivrt_sr7pti6eyzc.png"><br><br>  TwoColumnItems.js <br><br><img src="https://habrastorage.org/webt/lv/5s/bk/lv5sbkebar6j_yvdjwjv3s01nca.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt421531/">https://habr.com/ru/post/pt421531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt421521/index.html">Monstros ap√≥s as f√©rias: AMD Threadripper 2990WX 32-Core e 2950X 16-Core (parte 3 - testes)</a></li>
<li><a href="../pt421523/index.html">Unidade: conhecendo objetos program√°veis</a></li>
<li><a href="../pt421525/index.html">Um pouco sobre as diferen√ßas entre hosters russos e estrangeiros</a></li>
<li><a href="../pt421527/index.html">Lan√ßamento da transmiss√£o do projeto "Servidor nas nuvens"</a></li>
<li><a href="../pt421529/index.html">Netflix, Uber, Google e voc√™ no MBLT DEV 2018</a></li>
<li><a href="../pt421533/index.html">Escolhendo uma linguagem de programa√ß√£o: 3 dicas de um programador da Apple</a></li>
<li><a href="../pt421535/index.html">Aventura - Eletr√¥nica. Em um balan√ßo alado no mundo da TI</a></li>
<li><a href="../pt421537/index.html">Fun√ß√µes de ordem superior em JS: curso de lutador jovem</a></li>
<li><a href="../pt421543/index.html">Clonar um cart√£o sem contato usando um aplicativo m√≥vel</a></li>
<li><a href="../pt421545/index.html">Revis√£o do PocketBook 616 - o bolso 2018 mais econ√¥mico com fun√ß√£o de luz de fundo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>