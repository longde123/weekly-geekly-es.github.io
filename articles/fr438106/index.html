<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👧🏿 👱 🌈 Clignotant avec des LED vintage ou comme nous avertissons des "incendies" sur le projet 🏨 🤵 🥦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La routine est un immense domaine d'automatisation. Si la tâche prend beaucoup d'énergie, nécessite de la persévérance et se répète de temps en temps ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Clignotant avec des LED vintage ou comme nous avertissons des "incendies" sur le projet</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/2gis/blog/438106/"><p><img src="https://habrastorage.org/webt/29/ky/np/29kynpsxkjuzjwdby5s9o7czujw.png"></p><br><p>  La routine est un immense domaine d'automatisation.  Si la tâche prend beaucoup d'énergie, nécessite de la persévérance et se répète de temps en temps - c'est un signe certain qu'il vaut la peine de prendre quelques mesures pour réduire cette douleur récurrente.  Et vous pouvez transformer la mise en œuvre en un bon technofanchik. </p><br><p>  Aujourd'hui, je vais parler de l'automatisation du système d'alerte, de la surveillance et des alertes.  Sous la coupe, un clignotant polonais en 1984 et pas un seul incendie manqué.  Le code et les instructions de montage sont inclus. </p><a name="habracut"></a><br><p>  Récemment, j'ai eu 8 ans.  8 ans que je travaille chez 2GIS.  À cette occasion, un ami a demandé: «Comment tenez-vous si longtemps?  Il n'y avait aucune envie d'essayer quelque chose de nouveau? " </p><br><p>  Cela a surgi.  Et se pose toujours.  Et essayez toujours.  Je m'essaye dans de nouveaux rôles, équipes, technologies.  Pourquoi pas?  Après tout, le travail ne consiste pas seulement à «venir à 9h00, ouvrir le gestionnaire de tâches et entreprendre la tâche suivante, rentrer à la maison à 18h00» et même pas «Ah !!!  Nous sommes à nouveau DDoS'yat, poussons request_limit ici, et ici nous allons faire trembler les adresses IP, et ici ... Oh, comment est-il déjà 3 heures du matin? "  C'est tout faux.  Le travail concerne l'équipe, les relations, les soirées dans la cuisine.  Des tâches intéressantes et un cadre de vie confortable, après tout.  Tout tue l'indifférence et la routine.  Je ne sais pas comment travailler avec le premier, je ne l'ai pas remarqué par moi-même, mais je vais vous parler du second. </p><br><p>  Aujourd'hui, nous sortirons des sentiers battus: un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">feu de signalisation dans le bureau</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">et un de plus</a> ;  et automatiser les alertes, la surveillance et les alertes.  Mais pour faire le prochain feu de signalisation pour le serveur de build - c'est parti.  Nous avons beaucoup de constructions, de succursales et de tests, mais nous ne souhaitons pas voler l'entrepôt de la police de la circulation pour une douzaine de feux de signalisation.  Nous allons visualiser les "incendies"! </p><br><h1>  Système de surveillance standard </h1><br><p><img src="https://habrastorage.org/webt/hp/q0/ct/hpq0ctxkqoknb410zxwps-ceyhs.jpeg"></p><br><p>  Voici un écran typique qui pend dans notre bureau.  95% du temps, cela montre à quel point notre projet est vivant et ce qui lui arrive.  En parallèle, il y a un canal dans Slack avec des notifications de versions et de bugs. </p><br><p>  Afin de ne pas distraire toute l'équipe, un officier de permanence est nommé pour une semaine, qui agit en tant que maître des libérations et prend feu sur lui en cas de problème.  Sa tâche est de découvrir ce qui s'est passé, et de le réparer vous-même, ou de trouver quelqu'un qui le réparera. </p><br><p>  Nous utilisons également ce moniteur pour les réunions quotidiennes - nous ouvrons le tableau Kanban à Jira et c'est parti. </p><br><h1>  Qu'est-ce qui ne va pas? </h1><br><p>  Le statut de service n'annule pas les tâches.  Si la personne responsable des incendies a erré trop loin dans les couloirs de son esprit, le résultat peut être moins opérationnel que requis.  Cela a conduit à l'idée que pour un bonheur complet, nous avons besoin d'un avertissement plus important que les notifications sans fin de Slack. </p><br><h1>  Automatisez-le! </h1><br><p>  L'idée est devenue plus forte lorsqu'un excellent clignotant polonais vintage de 1984 a été découvert dans l'Avito.  S'il y a un incendie quelque part, alors allumez cette chose!  La chose a été promise même en état de fonctionnement presque.  500 roubles et elle est dans mon sac à dos.  Alors ajoutons-lui un peu de battage médiatique IoT et de croquis Arduino. </p><br><p><img src="https://habrastorage.org/webt/6u/hg/ty/6uhgtyey8v4painxacw_ufdqog4.png"></p><br><h1>  Plan d'action </h1><br><p>  Le plan était simple et génial!  Nous prenons une alimentation 12 volts, ajoutons un Sonoff SV - esp8266 avec un relais et tout le cerclage et la puissance nécessaires à partir de 12 volts.  Nous clignotons quelque chose comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://wifi-iot.ru/</a> , nous attrapons une lumière clignotante - profit!  Nous avons un appareil connecté via Wi-Fi avec une API REST et 1000 autres fonctionnalités. </p><br><h1>  À propos des dépenses </h1><br><p><img src="https://habrastorage.org/webt/xf/sw/4j/xfsw4jknxqlkun2ol0dvj_q4baa.png"></p><br><p>  Cordon d'alimentation avec une fiche plate de la radio d'une grand-mère ou du marché le plus proche pour les produits radio - 60 roubles <br>  Alimentation 12v 10w avec Aliexpress ou tous les mêmes produits radio - 260 roubles <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sonoff SV</a> - 4,85 $ + expédition <br>  Flasher vintage - inestimable (500 roubles) </p><br><h1>  Opinion sur le Wi-Fi d'entreprise </h1><br><p>  Pour de telles actions audacieuses, le Wi-Fi d'entreprise avec des certificats EAP-PEAP et d'autres mots effrayants a dit "Vous ne passerez pas!". </p><br><p><img src="https://habrastorage.org/webt/oy/n-/nt/oyn-nth-sypocgf1vdx0hxz8fuq.jpeg"></p><br><p>  Vous pouvez retrousser vos manches, google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/esp8266/Arduino/issues/1032</a> , prendre un nouveau SDK et écrire tout vous-même rapidement.  Mais alors le technofanch se transforme en un long creusage et débag.  Je vais reporter cette option jusqu'à la sortie de la version 2.0, améliorée et corrigée. </p><br><h1>  Produits doux </h1><br><p>  Prenez le bien-aimé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">olartamonov</a> Arduino, une dispersion de ce qui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">accumule de la</a> poussière dans les tiroirs depuis N ans, et récupérez un monstre de Frankenstein.  Un entrepôt de pièces pour la maison sera suffisant pour vérifier la viabilité de MVP et jeter après avoir débogué la belle et brillante version 2.0. </p><br><p><img src="https://habrastorage.org/webt/ac/om/-9/acom-9r68ntrxwj6ag8ii0ysvhe.jpeg"></p><br><p>  La solution est maladroite: Arduino se connecte au réseau via Ethernet, reçoit IP via DHCP, écoute les requêtes HTTP et clignote «LED».  N'importe qui le soir peut créer une telle solution à partir des exemples Arduino IDE (mais jamais, écoutez, ne l'utilisez jamais! C'est l'enfer). </p><br><div class="spoiler">  <b class="spoiler_title">Que faut-il utiliser?</b> <div class="spoiler_text"><p>  Pour ceux qui pleurent, piquent, mais mangent toujours un cactus, je suggère de passer à au moins PlatformIO (installé sur Atom ou VSCode), mais il vaut mieux ne pas l'utiliser du tout, mais lire un cours de conférences sur STM32 ou quelque chose de plus utile.  Et moi, mordu comme un enfant par des Arduinistes, je finirai mon sale boulot :) </p></div></div><br><p>  Le code est publié sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a> , il n'y a pas d'autorisation, API branchée et belles pages html.  Seulement MVP, seulement hardcore!  À utiliser à vos risques et périls, ai-je averti. </p><br><h1>  Produits solides </h1><br><p>  Lorsque le logiciel est écrit, il est temps de démarrer une lumière clignotante.  Voici un diagramme qui devrait aider à comprendre l'appareil. </p><br><h2>  En attente: </h2><br><p><img src="https://habrastorage.org/webt/x6/oo/s9/x6oos9z3gfgyp2gk9k8hwjaann4.png"></p><br><h2>  Réalité: </h2><br><p><img src="https://habrastorage.org/webt/fo/7a/t1/fo7at166uyswi0-uhsyqianycfg.jpeg"></p><br><p>  Remplacez donc Sonoff SV par: <br>  Arduino UNO + wiznet w5100 + relais </p><br><p>  Connexion par broches: <br>  DIGITAL 10 - SS <br>  DIGITAL 11 - MOSI <br>  NUMÉRIQUE 12 - MISO <br>  NUMÉRIQUE 13 - SCK <br>  GND - GND <br>  5V - 5V </p><br><p>  Nous connectons le relais encore plus facilement: la broche de signal sur DIGITAL 4, le fil d'alimentation au clignotant nous accrochons dans l'espace sur C (commun) et NC (normalement fermé). </p><br><p>  <strong>Achtung!</strong> <br>  Consultez la documentation de vos appareils.  Ce n'est pas un fait qu'en connectant une carte Ethernet à 5 volts, vous n'obtiendrez pas une drôle de fumée lors des tests!  Dans mon cas, tout est normal, et le module est conçu pour une alimentation à partir de 5 volts. </p><br><h1>  Produits plastiques </h1><br><p>  Une annonce sur Avito a déclaré que le clignotant était presque opérationnel.  Au fil des ans, un seul détail est mort en elle - l'engrenage faisant tourner le réflecteur. </p><br><p><img src="https://habrastorage.org/webt/sx/6j/vi/sx6jviptedu-vrq_aj7ez2jryt0.jpeg"></p><br><p>  Nous expirons, prenons Fusion360 entre nos mains, simulons un nouveau et l'imprimons sur une imprimante 3D de bureau. </p><br><div class="spoiler">  <b class="spoiler_title">Processus de modélisation des engrenages</b> <div class="spoiler_text"><p>  Nous vérifions les rayons et autres caractéristiques de l'engrenage, nous nous battons avec les paramètres de sous-extrusion et de trancheuse <br><img src="https://habrastorage.org/webt/vm/sr/fw/vmsrfwhkdv3815zocydv9fntdyu.jpeg"></p><br><p>  Nous continuons à modéliser <br><img src="https://habrastorage.org/webt/hp/mv/z5/hpmvz5doqty3zajkkxakgnajk_s.png"></p><br><p>  Nous imprimons, essayons <br><img src="https://habrastorage.org/webt/lt/an/j2/ltanj2vww5u6phkeiv6mluezm1w.gif"></p><br><p>  Personnalisez un peu plus et imprimez à nouveau.  Les rivets d'origine ont été percés et remplacés par une combinaison de vis M3 conventionnelles et d'écrous autobloquants.  N'oubliez pas de leur ajouter des sièges. <br><img src="https://habrastorage.org/webt/zy/t-/nd/zyt-ndarwrrswyepbnyy96ia99o.png"></p><br><p><img src="https://habrastorage.org/webt/8e/ja/aj/8ejaajyh2kiup7bcse5wjzkzhbg.jpeg"></p></div></div><br><p>  Lubrifiez les engrenages, remplacez les fils, remontez - cela fonctionne! </p><br><p>  Ce serait bien d'imprimer le matériel à partir de nylon, mais la première impression fine a échoué, et la deuxième sonde de Bestfilament n'était plus suffisante pour la seconde. </p><br><h1>  Ce pour quoi nous sommes - quoi qu'il arrive! </h1><br><p><img src="https://habrastorage.org/webt/zr/gw/vp/zrgwvpeop5ig3rjqjqnkq0f5mnc.gif"></p><br><h4 id="kak-zastavit-migalku-vklyuchatsya-kogda-proizoshlo-chto-to-iz-ryada-von-vyhodyaschee">  Comment allumer le clignotant quand quelque chose hors de l'ordinaire s'est produit? </h4><br><p>  Élémentaire!  Nous utilisons Grafana au travail, nous commençons donc juste un nouveau canal de notification avec le type WebHook, qui envoie une demande pour allumer la lumière de secours selon certains critères.  Elle s'éteint au bout de quelques secondes, pour ne pas aggraver encore plus l'atmosphère. </p><br><p>  Combien de temps a pris tout ce bordel?  Quelques soirées, sinon distraites.  Plus une demi-journée de temps de travail pour configurer l'intégration avec d'autres systèmes internes. </p><br><p>  La technofanchik a été un succès, l'équipe a apporté des bénéfices, des photos du processus d'assemblage sont enfin présentées. </p><br><div class="spoiler">  <b class="spoiler_title">Le voici devant nous, un flasher avec des fils</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ez/fb/q7/ezfbq7hfzeexf6w8w9wfbjwohcu.jpeg"><br><img src="https://habrastorage.org/webt/as/qq/5-/asqq5-j3yotupe_cniquxe4psn8.jpeg"><br><img src="https://habrastorage.org/webt/p7/au/zx/p7auzx-p5ilvxb2k636yiplhb3y.jpeg"><br><img src="https://habrastorage.org/webt/y8/wb/3w/y8wb3weqcxns3azl1kq_2tbsxfg.jpeg"><br><img src="https://habrastorage.org/webt/il/qe/jf/ilqejfnwtv6dsypzxlfphpp4bik.jpeg"><br><img src="https://habrastorage.org/webt/cr/-o/qb/cr-oqbz0oz8jfeik7pydles-8h4.jpeg"></p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr438106/">https://habr.com/ru/post/fr438106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr438094/index.html">Les nuances des outils Target Length et Tuning Meter dans PADS Professional / Xpedition</a></li>
<li><a href="../fr438096/index.html">Livres à lire pour chaque chef de produit</a></li>
<li><a href="../fr438098/index.html">Spring, bytecode, JDK: les 10 meilleurs rapports de JBreak 2018</a></li>
<li><a href="../fr438100/index.html">Où vont les données: 12 attaques, hacks et fuites</a></li>
<li><a href="../fr438104/index.html">Pas une blockchain</a></li>
<li><a href="../fr438108/index.html">SEO et contexte: que choisir et choisir?</a></li>
<li><a href="../fr438110/index.html">Rails + Postgres + fixations</a></li>
<li><a href="../fr438112/index.html">Trouver une balle d'argent: acteurs + FRP dans React</a></li>
<li><a href="../fr438116/index.html">Analyse de l'impact environnemental des supports musicaux: musique numérique, enregistrements analogiques et CD</a></li>
<li><a href="../fr438118/index.html">Dex-Net 4.0 permet aux robots Ambidextro de choisir le meilleur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>