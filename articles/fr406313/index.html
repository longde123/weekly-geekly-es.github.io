<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏪ 👍🏻 📴 Une façon personnalisée de se faire des amis avec STM32: pas Arduino ou Discovery 🧖🏿 🤲 👨‍❤️‍👨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="À tous ceux qui utilisent ou s'intéressent aux microcontrôleurs de STMicroelectronics , je veux présenter mon petit projet de loisir. 


 Habré et gee...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une façon personnalisée de se faire des amis avec STM32: pas Arduino ou Discovery</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/406313/"><p> À tous ceux qui utilisent ou s'intéressent aux microcontrôleurs de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STMicroelectronics</a> , je veux présenter mon petit projet de loisir. </p><br><p>  Habré et geektimes ont déjà beaucoup d'articles consacrés aux microcontrôleurs de la série STM32F, par exemple: Carte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32 bon marché + IDE Arduino</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Essayer de se faire des amis avec STM32</a> et la réponse à cela <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment se faire des amis avec STM32</a> et bien d'autres.  Dans l'ensemble, ils couvrent très bien ce sujet, mais il y a une chose mais ... Dans tous ces articles, des cartes prêtes à l'emploi et un contrôleur spécifique qui sont sur cette carte sont pris en compte.  Et qu'en est-il de ceux qui veulent jouer avec différents contrôleurs, et même sur la planche à pain?  Par exemple, de nombreuses cartes que je connais avec le contrôleur STM32F4 (le même STM32F4-Discovery) ne peuvent pas être insérées dans la planche à pain.  Mais je veux personnellement quelque chose comme ça (attention, toutes les photos sont cliquables): </p><br><p></p><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/web/89a/05c/d87/89a05cd87f5245578465097c8201b084.jpg"></a> </div><br>  En même temps, comme je l'ai déjà écrit, je ne veux pas être connecté à un contrôleur spécifique, mais je veux pouvoir le remplacer facilement.  Ceux qui sont intéressés par la façon dont j'ai réalisé ces souhaits pas tout à fait ordinaires, je demande un chat. <p></p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Introduction (inspirée des commentaires sur l'article, veuillez donc sauter avant de les lire)</b> <div class="spoiler_text"><p>  L'utilisation ou non de tables d'expérimentation avec connecteurs est un point discutable.  Bien sûr, à partir d'un certain nombre de composants, ils deviennent inconfortables.  Mais bien que le composant ne soit pas très grand et que le nombre d'expériences au stade initial du prototypage soit encore important, les planches à pain, à mon avis, sont pratiques.  Et ici, si vous souhaitez utiliser STM32, une embuscade nous attend - ils ne sont tout simplement pas dans des packages DIP, contrairement à Atmega.  Vous pouvez acheter des cartes de démonstration toutes faites, mais là encore, il y a une embuscade - la plupart de ces cartes avec des contrôleurs plus anciens ne peuvent pas être coincées dans la planche à pain à cause des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">doubles peignes</a> .  Autrement dit, en utilisant des cartes de démonstration prêtes à l'emploi, nous sommes obligés de travailler avec les plus jeunes contrôleurs de la série (voir le même <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nucleo dans la version DIP</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Blue Pill</a> ).  La deuxième façon consiste à fabriquer des adaptateurs spécialisés.  Cet article explique cette deuxième voie. </p></div></div><br><p>  Montrez immédiatement le résultat final.  Ce sont de petites écharpes double face pour différents cas, dont l'impression peut être commandée dans l'Empire du Milieu (les Chinois n'ont rien contre l'impression de planches double face avec un design panneau): </p><br><p> <a href=""><img src="https://habrastorage.org/web/5e6/56c/fd9/5e656cfd9d3644a2a203e5f39e90b88f.jpg"></a> </p><br><p>  Un ensemble (à droite) est simplement des adaptateurs simples pour la planche à pain pour les boîtiers LQFP32 / 48/64, mais le deuxième ensemble (à gauche) sont également des adaptateurs, mais avec un connecteur JTAG, une alimentation, du quartz basse fréquence et haute fréquence et un bouton de réinitialisation.  Toutes les autres broches du contrôleur sont sur le peigne.  En général, le minimum.  Malheureusement, le connecteur JTAG n'est pas standard, donc la carte adaptateur de JTAG-20 à ce même JTAG-10 est également incluse. </p><br><p>  Ces cartes sont facilement soudées par un sèche-cheveux à la maison, donc si vous avez plusieurs contrôleurs, plusieurs cartes et composants passifs de taille 0805, vous pouvez obtenir quelque chose comme ça dans un délai raisonnable: </p><br><p> <a href=""><img src="https://habrastorage.org/web/0a3/cd3/be4/0a3cd3be45774cc7909e4d5b088b6670.jpg"></a> </p><br><p>  Et cela, me semble-t-il, donne une bonne liberté de créativité.  Si quelqu'un semble avoir épuisé le sujet, voici un lien vers le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référentiel github</a> . </p><br><p>  Mais je veux vous dire étape par étape comment arriver à une telle vie.  Image pour attirer l'attention (énoncé graphique du problème): </p><br><p> <a href=""><img src="https://habrastorage.org/web/b38/cc7/069/b38cc70693f748b68eb3a77680169cb7.jpg"></a> </p><br><p>  Il y a une dispersion de contrôleurs (séries L0, F3, F4), alimentation, convertisseur USART-USB, planche à pain.  Je veux faire clignoter les LED.  Cette étape est rendue très facile.  Nous prenons n'importe quel contrôleur, carte adaptateur du premier jeu, nous soudons avec un sèche-cheveux.  Ensuite, vous avez besoin de documentation sur la connexion de l'alimentation, du programmateur, du quartz.  Ici ST a la commande complète, tout est sur la page avec la documentation du contrôleur sélectionné.  Par exemple, pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32F303K8,</a> nous n'avons besoin que d'un seul document: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AN4206: Prise en main du développement matériel de la série STM32F3</a> , où il y a des circuits d'alimentation, des oscillateurs et un programmeur, sur la base desquels vous pouvez construire un tel modèle: </p><br><p></p><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/web/c2b/718/5f8/c2b7185f8a8b453db589da3152f6116d.jpg"></a> </div><br>  Ce contrôleur n'a pas de quartz basse fréquence externe, j'ai donc connecté uniquement des hautes fréquences à 16 MHz.  Pour la programmation, un connecteur JTAG-20 standard est utilisé, qui est équipé d'un programmateur standard de ST <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ST-LINK / V2</a> . <p></p><br><div class="spoiler">  <b class="spoiler_title">Si vous utilisez Linux</b> <div class="spoiler_text"><p>  Il y a déjà des pilotes dans le noyau, mais vous devez ajouter manuellement quelques règles au fichier /etc/udev/rules.d, voir par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> </p></div></div><br><p>  Étant donné que l'article est principalement consacré à la partie matérielle, je ne mentionnerai que brièvement la partie logicielle.  Système d'exploitation: Fedora 25. Environnement de développement: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">System Workbench pour STM32</a> est un système entièrement gratuit basé sur Eclipse de la communauté OpenSTM32.  La seule fois - pour télécharger, vous devez vous inscrire à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://www.openstm32.org</a> .  Il est pratique d'utiliser l'utilitaire graphique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32CubeMX</a> pour modéliser, documenter et générer des exemples.  Par exemple, la configuration du contrôleur sur la photo ci-dessus ressemble à ceci: </p><br><p> <a href=""><img src="https://habrastorage.org/web/a17/bf1/f91/a17bf1f9181842179826bee3c6b86282.png"></a> </p><br><p>  Les fichiers avec ces schémas sont également dans le référentiel.  Par exemple, pour STM32F303K8 voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> </p><br><p>  System Workbench for STM32 possède un assistant de projet intégré assez avancé qui génère la structure initiale du projet et peut éventuellement inclure dans le projet: pilotes de contrôleur de bas niveau (CMSIS), bibliothèque HAL (Hardware Abstraction Layer), FatFS, FreeRTOS.  J'utilise moi-même ma bibliothèque de pilotes orientée objet, qui s'exécute au-dessus de la couche HAL.  Peu importe, voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p>  Voici <a href="">un exemple de code</a> utilisant cette bibliothèque, qui fait clignoter des LED sur une minuterie (pendant une interruption) et enregistre (via un convertisseur USART-USB à la console de la station de travail) l'état du compteur connecté à l'horloge en temps réel.  Tout cela est quelque peu similaire à l'idéologie d'Arduino, mais j'aime juste programmer de telles choses moi-même. </p><br><p>  Voici un exemple d'utilisation d'un contrôleur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">STM32F410RB</a> assez puissant: </p><br><p></p><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/web/b23/964/9b1/b239649b112d4ac490b387d2efe96911.jpg"></a> </div><p></p><br><p>  De même, le document principal est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AN4488: Prise en main du développement matériel du microcontrôleur STM32F4xxxx</a> , où il existe tous les schémas de connexion nécessaires.  Le deuxième document important est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AN2867: Guide de conception des oscillateurs pour les microcontrôleurs STM8AF / AL / S et STM32</a> , qui détaille comment connecter un oscillateur haute fréquence. </p><br><p>  Naturellement, clôturer constamment de tels schémas prend beaucoup de temps, j'ai donc décidé de fabriquer les prochains foulards universels possibles, qui réalisent ces schémas.  La polyvalence est obtenue du fait que les contrôleurs de séries différentes, mais dans le même cas (par exemple, STM32F303RB et STM32F410RB, tous deux dans le cas LQFP64) ont les mêmes conclusions (à l'exception de petites différences dans le circuit d'alimentation).  Ces différences conduisent à ceci: </p><br><p> <a href=""><img src="https://habrastorage.org/web/551/09d/fdf/55109dfdf9844d17a4f6bdd3da46185d.jpg"></a> </p><br><p>  Tous les éléments avec des dénominations signées sont communs à différents contrôleurs, mais des éléments comme P30, P31, P47, où le nombre signifie le numéro de broche, doivent être sélectionnés en fonction du modèle spécifique.  En conséquence, la planche à pain ressemblera à ceci: </p><br><p> <a href=""><img src="https://habrastorage.org/web/83e/378/30c/83e37830c360491b8014b164c0917b12.jpg"></a> </p><br><p>  Voici une si petite amélioration. </p><br><p>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Projet sur github</a> <br>  Licence: GNU General Public License, Version 3 </p><br><p>  Circuit imprimé et circuits imprimés préparés par Eagle Cad.  Le très respecté <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">DiHalt</a> a une merveilleuse série d'articles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur ce système</a> .  La version gratuite d'Eagle Cad pour un usage domestique peut être téléchargée sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> . </p><br><p>  J'invite tout le monde à rejoindre le projet. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr406313/">https://habr.com/ru/post/fr406313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr406299/index.html">Affichage vectoriel RIN-609</a></li>
<li><a href="../fr406301/index.html">Rapport de fiabilité du disque dur Backblaze: les disques d'entreprise échouent plus souvent que les modèles grand public</a></li>
<li><a href="../fr406303/index.html">Hackspace, makerspace, FabLab et WTC: nous comprenons les noms des espaces publics</a></li>
<li><a href="../fr406307/index.html">Galaxy Note 8: quel était le nouveau fleuron de Samsung</a></li>
<li><a href="../fr406309/index.html">Le Jet Propulsion Laboratory de la NASA développe un véhicule tout-terrain sinueux pour étudier Vénus</a></li>
<li><a href="../fr406317/index.html">Les possibilités les plus larges et les limitations importantes des technologies additives sur l'exemple de la culasse d'une voiture de sport</a></li>
<li><a href="../fr406319/index.html">L'inspection fiscale américaine utilise l'exploration de données et l'analyse prédictive</a></li>
<li><a href="../fr406323/index.html">Nouvelle édition: outil de gestion du temps et de la motivation</a></li>
<li><a href="../fr406327/index.html">Imagerie de densité ou quelle est la méthode schlieren?</a></li>
<li><a href="../fr406329/index.html">Pluie, bruit d'armure et métal liquide: comment le son est produit pour un film</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>