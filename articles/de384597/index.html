<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤳🏼 👨🏾‍🍳 🗃️ Strommessung. Teil 1. Spannungs- und Strommessung 👇 📌 😔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einführung
 Hallo alle zusammen! Nach dem Ende des Zyklus an den Sensoren gab es Fragen eines anderen Plans zur Messung der Verbrauchsparameter von Ha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Strommessung. Teil 1. Spannungs- und Strommessung</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384597/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/4df/1f8/1cd/4df1f81cd86c4e2a8f5afa1441fb88e5.jpg" alt="Bild" align="left"></a><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung</font></font></b></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hallo alle zusammen! </font><font style="vertical-align: inherit;">Nach dem Ende des Zyklus an den Sensoren gab es Fragen eines anderen Plans zur Messung der Verbrauchsparameter von Haushaltsgeräten und nicht sehr elektrischen Geräten. </font><font style="vertical-align: inherit;">Wer verbraucht wie viel, wie verbindet man was zu messen, welche Feinheiten passieren und so weiter. </font><font style="vertical-align: inherit;">Es ist Zeit, alle Karten in diesem Bereich aufzudecken. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In dieser Artikelserie werden wir uns mit dem Thema der Messung der Parameter von Elektrizität befassen. </font><font style="vertical-align: inherit;">Diese Parameter sind eigentlich eine sehr große Zahl, die ich nach und nach in kleinen Reihen zu erzählen versuchen werde. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bisher sind drei Serien geplant:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strommessung. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Qualität der Elektrizität.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Geräte zur Messung der Elektrizitätsparameter.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Während des Analyseprozesses werden wir bestimmte praktische Probleme an Mikrocontrollern lösen, bis ein Ergebnis erzielt wird. </font><font style="vertical-align: inherit;">Natürlich wird der größte Teil dieses Zyklus der Messung der Wechselspannung gewidmet sein und kann für alle Lüfter nützlich sein, um die Elektrogeräte ihres Smart Homes zu steuern. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Basierend auf den Ergebnissen des gesamten Zyklus werden wir einen bestimmten intelligenten Stromzähler mit Internetzugang herstellen. </font><font style="vertical-align: inherit;">Sehr berüchtigte Lüfter zur Steuerung der Elektrogeräte ihres Smart Homes können beispielsweise bei MajorDomo alle möglichen Hilfestellungen bei der Implementierung des Kommunikationsteils leisten. </font><font style="vertical-align: inherit;">Machen wir OpenSource sozusagen zu einem besseren Smart Home. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In dieser zweiteiligen Reihe werden wir folgende Fragen diskutieren:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anschluss von Strom- und Spannungssensoren in Gleichstromgeräten sowie einphasigen und dreiphasigen Wechselstromkreisen;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Messung von Strom- und Spannungswerten;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leistungsfaktormessung;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Volle, aktive und Blindleistung;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Energieverbrauch;</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Tackle finden Sie Antworten auf die ersten beiden Fragen dieser Liste. </font><font style="vertical-align: inherit;">Ich gehe bewusst nicht auf die Genauigkeit der Messindikatoren ein und bin aus dieser Serie nur mit den Ergebnissen zufrieden, die mit einer Genauigkeit von Plus- oder Minus-Bastschuhen erzielt wurden. </font><font style="vertical-align: inherit;">Ich werde diesem Thema in der dritten Reihe sicherlich einen eigenen Artikel widmen.</font></font><br>
<a name="habracut"></a><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Anschluss der Sensoren</font></font></b></h4><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/ueE-XPjVkRY%3Ffeature%3Doembed&amp;usg=ALkJrhjjLW36rMD4qlJFMT__mfDAT4kMCw" frameborder="0" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der letzten Serie über Spannungs- und Stromsensoren habe ich über die Arten von Sensoren gesprochen, aber nicht darüber, wie man sie verwendet und wo man sie platziert. </font><font style="vertical-align: inherit;">Es ist Zeit, das Problem zu beheben</font></font><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anschließen von DC-Sensoren</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist klar, dass der gesamte Zyklus Wechselstromsystemen gewidmet sein wird, aber wir werden auch schnell auf die Gleichstromkreise eingehen, da dies für uns bei der Entwicklung von Gleichstromversorgungen nützlich sein kann. Nehmen wir zum Beispiel einen klassischen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWM- </font></font></a><font style="vertical-align: inherit;"></font><br>
<img src="https://habrastorage.org/files/d35/255/0f2/d352550f2c04401ea57bcda120ee3790.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abwärtswandler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><i><font style="vertical-align: inherit;">Abbildung 1. Ein PWM-Abwärtswandler</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Unser Ziel ist es, eine stabile Ausgangsspannung bereitzustellen. Zusätzlich ist es basierend auf den Informationen vom Stromsensor möglich, den Betriebsmodus des Induktors L1 zu steuern, seine Sättigung zu verhindern und auch einen Stromschutz des Wandlers zu implementieren. Und ehrlich gesagt gibt es keine besonderen Optionen für die Installation von Sensoren.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am Ausgang des Wandlers ist ein Spannungssensor in Form eines Widerstandsteilers R1-R2 installiert, der als einziger mit Gleichstrom arbeiten kann. In der Regel verfügt eine spezialisierte Wandler-Mikroschaltung über einen Rückkopplungseingang und bemüht sich, sicherzustellen, dass an dieser Eingabe (3) ein bestimmter Spannungspegel in der Dokumentation für die Mikroschaltung vorgeschrieben ist. Zum Beispiel 1,25V. Wenn unsere Ausgangsspannung diesem Pegel entspricht - alles ist in Ordnung -, legen wir die Ausgangsspannung direkt an diesen Eingang an. Wenn nicht, stellen Sie den Teiler ein. Wenn wir eine Ausgangsspannung von 5 V bereitstellen müssen, muss der Teiler einen Teilungsfaktor von 4 bereitstellen, d. H. Zum Beispiel R1 = 30k, R2 = 10k.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Stromsensor wird normalerweise zwischen der Stromquelle und dem Wandler sowie auf dem Chip installiert. Aus der Potentialdifferenz zwischen den Punkten 1 und 2 und mit einem bekannten Widerstand können die Widerstände Rs den Stromwert des Stroms unserer Induktivität bestimmen. Die Installation eines Stromsensors zwischen den Quellen und der Last ist keine gute Idee, da der Filterkondensator durch den Widerstand von den Verbrauchern gepulster Ströme abgeschaltet wird. Die Installation eines Widerstands in der Lücke des gemeinsamen Kabels verspricht ebenfalls nichts Gutes - es wird zwei Erdungsstufen geben, mit denen es immer noch Spaß macht, herumzuspielen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Probleme des Spannungsabfalls können durch die Verwendung berührungsloser Stromsensoren vermieden werden - beispielsweise Hallsensoren: </font></font><br>
<img src="https://habrastorage.org/files/90c/b6b/1e2/90cb6b1e298b4d408bd27d971218781e.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 2. Kontaktloser Stromsensor</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt jedoch eine schwierigere Möglichkeit, den Strom zu messen. Schließlich fällt auch die Spannung am Transistor ab und es fließt der gleiche Strom wie die Induktivität durch den Transistor. Daher können Sie anhand des Spannungsabfalls darüber auch den aktuellen Wert des Stroms bestimmen. Wenn Sie sich die interne Struktur der Wandlerschaltungen ansehen, beispielsweise von Texas Instruments, wird diese Methode genauso häufig verwendet wie die vorherigen. Die Genauigkeit dieser Methode ist sicherlich nicht die höchste, aber dies reicht völlig aus, damit der aktuelle Cutoff funktioniert. </font></font><br>
<img src="https://habrastorage.org/files/2fd/ecb/bab/2fdecbbab26c483ea476483e32e2a0c9.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 3. Transistor als Stromsensor.</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Dasselbe </font><i><font style="vertical-align: inherit;">tun wir</font></i><font style="vertical-align: inherit;"> in anderen Schaltkreisen ähnlicher Wandler, egal ob Boosten oder Invertieren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist jedoch notwendig, Transformator-Linear- und Flyback-Wandler getrennt zu erwähnen.</font></font><br>
<img src="https://habrastorage.org/files/1d7/ebd/4b1/1d7ebd4b13214a919014f35a8a672b24.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 4. Anschluss von Stromsensoren in Flyback-Wandlern</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
. Sie können in ihrer Rolle auch entweder einen externen Widerstand oder einen Transistor verwenden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit haben wir die Sensoren an die DC / DC-Wandler angeschlossen. </font><font style="vertical-align: inherit;">Wenn Sie Vorschläge für andere Optionen haben, füge ich ihnen gerne einen Artikel hinzu.</font></font><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 Anschließen von Sensoren an einphasige Wechselstromkreise</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Wechselstromkreisen haben wir eine viel größere Auswahl möglicher Sensoren. </font><font style="vertical-align: inherit;">Betrachten wir mehrere Optionen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Am einfachsten ist die Verwendung eines ohmschen Spannungsteilers und eines Stromshunts. </font></font><br>
<img src="https://habrastorage.org/files/458/c52/e43/458c52e436ac451d96927f6d3a14d772.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 5. Anschluss von Widerstandssensoren.</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sie hat jedoch einige wesentliche Nachteile:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Erstens werden wir entweder eine signifikante Amplitude des Signals vom Stromshunt bereitstellen und ihm eine große Menge an Leistung zuweisen, oder wir werden mit der kleinen Amplitude des Signals zufrieden sein und es anschließend verstärken. Und zweitens erzeugt der Widerstand eine Potentialdifferenz zwischen dem Neutralleiter des Netzwerks und dem Neutralleiter des Geräts. Wenn das Gerät isoliert ist, spielt es keine Rolle, ob das Gerät über einen Erdungsanschluss verfügt. Wir riskieren, ohne Signal vom Stromsensor zu bleiben, da wir es kurzschließen. Vielleicht sollten Sie Sensoren ausprobieren, die nach anderen Prinzipien arbeiten.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Beispiel verwenden wir Strom- und Spannungswandler oder einen Hall-Effekt-Stromsensor und einen Spannungswandler. </font><font style="vertical-align: inherit;">Hier gibt es viel mehr Möglichkeiten für die Arbeit mit Geräten, da der Neutralleiter keine Verluste aufweist und vor allem - in beiden Fällen gibt es eine galvanische Trennung der Messgeräte, was oft nützlich sein kann. </font><font style="vertical-align: inherit;">Es muss jedoch berücksichtigt werden, dass Strom- und Spannungssensoren von Transformatoren einen begrenzten Frequenzgang haben. Wenn wir die harmonische Zusammensetzung von Verzerrungen messen möchten, ist dies keine Tatsache, die funktionieren wird. </font></font><br>
<img src="https://habrastorage.org/files/b59/304/c28/b59304c2821d45ef87501f76acfa232a.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 6. Anschluss von Transformator und berührungslosen Strom- und Spannungssensoren</font></font></i><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 Anschließen von Sensoren an mehrphasige Wechselstromkreise</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In Mehrphasennetzwerken ist unsere Fähigkeit, Stromsensoren anzuschließen, etwas geringer. Dies liegt an der Tatsache, dass der Strom-Shunt überhaupt nicht verwendet werden kann, da die Potentialdifferenz zwischen den Phasen-Shunts innerhalb von Hunderten von Volt schwankt und ich keinen allgemeinen Controller kenne, dessen analoge Eingänge einem solchen Spott standhalten können. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich gibt es eine Möglichkeit, Stromshunts zu verwenden - für jeden Kanal muss ein galvanisch isolierter Analogeingang erstellt werden. Es ist jedoch viel einfacher und zuverlässiger, andere Sensoren zu verwenden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In meinem Qualitätsanalysator verwende ich ohmsche Spannungsteiler und entfernte Hall-Effekt-Stromsensoren. </font></font><br>
<img src="https://habrastorage.org/files/3e5/d90/547/3e5d90547af64b41a48bcfe42ee82429.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 7 Stromsensoren in einem dreiphasigen Netzwerk</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie aus der Abbildung ersichtlich, verwenden wir eine Vierdrahtverbindung. </font><font style="vertical-align: inherit;">Anstelle von Stromsensoren für den Hall-Effekt können Sie natürlich auch Stromwandler oder Rogowski-Schleifen verwenden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anstelle von Widerstandsteilern können Spannungstransformatoren sowohl für ein Vierleitersystem als auch für ein Dreileitersystem verwendet werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im letzteren Fall sind die Primärwicklungen von Spannungswandlern durch ein Dreieck und die Sekundärwicklung durch einen Stern verbunden, dessen gemeinsamer Punkt der gemeinsame Punkt des Messkreises ist. </font></font><br>
<img src="https://habrastorage.org/files/e4d/100/cf4/e4d100cf4d3048338dd15cacdb92a373.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 8. Verwendung von Spannungswandlern in einem dreiphasigen Netzwerk</font></font></i><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 Stromwert von Spannung und Strom</font></font></b></h4><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/TOaW9xvr8NE%3Ffeature%3Doembed&amp;usg=ALkJrhgCJpb_x6uRaSawCaTGIUwasCB6tg" frameborder="0" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist an der Zeit, das Problem der Messung unserer Signale zu lösen. Die praktische Bedeutung für uns ist in erster Linie der Stromwert von Strom und Spannung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich möchte Sie an das Material aus dem Sensorzyklus erinnern. Mit dem ADC unseres Mikrocontrollers in regelmäßigen Abständen legen wir den momentanen Spannungswert fest. Während des Messzeitraums haben wir also eine Reihe von Daten über den Pegel des momentanen Spannungswerts (für den Strom ist alles ähnlich). </font></font><br>
<img src="https://habrastorage.org/files/f70/ca7/063/f70ca706313a41a784c27c270cbd6eb2.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abb. 9. Eine Reihe von Momentanspannungswerten</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Unsere Aufgabe ist es, den effektiven Wert zu berechnen. Zunächst verwenden wir die Integralformel: </font></font><br>
<img src="https://habrastorage.org/files/417/546/27d/41754627def647e89dce0c4037146eba.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einem digitalen System müssen wir uns auf ein bestimmtes Zeitquantum beschränken, also gehen wir zur Summe: </font></font><br>
<img src="https://habrastorage.org/files/17c/f0a/b23/17cf0ab2355a4a86a67504036f331c6b.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wo </font></font><img src="https://habrastorage.org/files/c7c/ac5/dec/c7cac5dece7f4d03b262ad4c8ad30317.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist die Abtastperiode unseres Signals und</font></font><img src="https://habrastorage.org/files/289/63f/958/28963f958bf74b1888aeef21b047c567.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- die Anzahl der Proben für den Messzeitraum. Irgendwo hier, in einem Video, fange ich an, das Spiel über die Gleichheit der Bereiche zu reiben. Ich musste an diesem Tag schlafen. =) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In MSP430FE4252-Mikrocontrollern, die in einphasigen Quecksilber-Stromzählern verwendet werden, werden 4096 Messungen für einen Messzeitraum von 1, 2 oder 4 Sekunden durchgeführt. Auf T = 1s und N = 4096 werden wir uns weiter verlassen. Darüber hinaus können wir mit 4096 Punkten pro Sekunde schnelle Fourier-Transformationsalgorithmen verwenden, um das von GOST geforderte Oberschwingungsspektrum von bis zu 40 Oberschwingungen zu bestimmen. Aber mehr dazu in der nächsten Serie.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir skizzieren den Algorithmus für unser Programm. Wir müssen alle 1/8192 Sekunden einen stabilen Start des ADC sicherstellen, da wir zwei Kanäle haben und diese Daten abwechselnd messen. Konfigurieren Sie dazu den Timer und das Interrupt-Signal startet den ADC automatisch neu. Alle ADCs machen das. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden das zukünftige Programm auf Arduino schreiben, wie es viele zur Hand haben. Bisher haben wir ein rein akademisches Interesse. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit einer Systemquarzfrequenz von 16 MHz und einem 8-Bit-Timer (damit das Leben nicht wie Honig aussieht) müssen wir die Betriebsfrequenz eines Timer-Interrupts mit einer Frequenz von 8192 Hz sicherstellen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sind traurig über die Tatsache, dass 16 MHz nicht vollständig aufgeteilt sind und die Endfrequenz des Timers 8198 Hz beträgt. Wir schließen unsere Augen vor einem Fehler von 0,04% und lesen immer noch 4096 Samples pro Kanal.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir sind traurig, dass der Überlauf-Interrupt in Arduino mit der Berechnung der Zeit beschäftigt ist (er ist für Millis und Verzögerung verantwortlich, sodass dies nicht mehr normal funktioniert). Daher verwenden wir den Interrupt im Vergleich. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und wir stellen plötzlich fest, dass das Signal bipolar zu uns kommt und dass msp430fe4252 perfekt damit zurechtkommt. Wir geben uns mit einem unipolaren ADC zufrieden, daher bauen wir einen einfachen Wandler eines bipolaren Signals in einen unipolaren auf einem Operationsverstärker um: </font></font><br>
<img src="https://habrastorage.org/files/18f/0dd/c20/18f0ddc202544b24be6d684ce9d98c23.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 10. Ein Wandler eines bipolaren Signals in einen unipolaren Signal</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Darüber hinaus besteht unsere Aufgabe darin, sicherzustellen, dass unsere Sinuskurve relativ zur Hälfte der Referenzspannung schwingt - dann subtrahieren wir entweder die Hälfte des Bereichs oder aktivieren die Option in den ADC-Einstellungen und erhalten Sie die Vorzeichenwerte.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Arduino verfügt über einen 10-Bit-ADC, daher subtrahieren wir die Hälfte vom vorzeichenlosen Ergebnis innerhalb von 0-1023 und erhalten -512-511. Wir </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
überprüfen das in LTSpiceIV zusammengestellte Modell und stellen sicher, dass alles ordnungsgemäß funktioniert. </font><font style="vertical-align: inherit;">Im Videomaterial verifizieren wir zusätzlich experimentell. </font></font><br>
<img src="https://habrastorage.org/files/3de/320/1f6/3de3201f66f94937b29504236ded1044.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 11. Simulationsergebnis. </font><font style="vertical-align: inherit;">Grün ist das ursprüngliche Signal, Blau ist der Ausgang</font></font></i><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Skizze für Arduino für einen Kanal</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{<font></font>
  autoadcsetup();<font></font>
  DDRD |=(<span class="hljs-number">1</span>&lt;&lt;PD2)|(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
  Serial.begin(<span class="hljs-number">38400</span>);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">double</span> urms = <span class="hljs-number">0</span>;
<span class="hljs-keyword">double</span> utemp = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> umoment = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> N = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> flag = <span class="hljs-number">0</span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">if</span> (flag){<font></font>
    flag = <span class="hljs-number">0</span>;<font></font>
    Serial.println(urms);<font></font>
  }<font></font>
}<font></font>
<span class="hljs-keyword">int</span> i = <span class="hljs-number">255</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">autoadcsetup</span><span class="hljs-params">()</span></span>{
  <span class="hljs-comment">//set up TIMER0 to  4096Hz</span>
  <span class="hljs-comment">//TIMER0_OVF will be the trigger for ADC</span>
  <span class="hljs-comment">/*normal mode, prescaler 16
   16MHz / 64 / 61 = 4098 Hz 0.04% to 4096Hz*/</span>
  TCCR0B = (<span class="hljs-number">1</span> &lt;&lt; CS01)|(<span class="hljs-number">1</span> &lt;&lt; CS00);<span class="hljs-comment">//timer frequency = clk/64</span>
  OCR0A = <span class="hljs-number">60</span>;<span class="hljs-comment">//61-1</span>
  TIMSK0 = (<span class="hljs-number">1</span>&lt;&lt;OCIE0A);
  <span class="hljs-comment">//set ADC.</span>
  ADMUX =  (<span class="hljs-number">1</span> &lt;&lt; REFS0);<span class="hljs-comment">//8-bit mode, ADC0 channel, AVVCC as ref</span>
  ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADEN) | (<span class="hljs-number">1</span> &lt;&lt; ADATE) | (<span class="hljs-number">1</span> &lt;&lt; ADIE) | (<span class="hljs-number">1</span> &lt;&lt; ADPS2);<span class="hljs-comment">//TUrn ADC On, trigger enable, Interrupt enable, sysclk/16=1MHz_ADC_clk=76kHz conv freq(13ticks per conversion)</span>
  ADCSRB = (<span class="hljs-number">1</span>&lt;&lt; ADTS1) | (<span class="hljs-number">1</span>&lt;&lt;ADTS0) | (<span class="hljs-number">1</span>&lt;&lt;MUX5);<span class="hljs-comment">//Auto trigger source</span><font></font>
}<font></font>
<font></font>
ISR(TIMER0_COMPA_vect){<font></font>
  <span class="hljs-keyword">if</span> (PIND &amp; (<span class="hljs-number">1</span>&lt;&lt;PD2)){<font></font>
    PORTD &amp;= ~(<span class="hljs-number">1</span>&lt;&lt;PD2);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span>{<font></font>
    PORTD |=(<span class="hljs-number">1</span>&lt;&lt;PD2);<font></font>
  }<font></font>
  TCNT0 = <span class="hljs-number">0</span>;<font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
ISR(ADC_vect){<font></font>
<font></font>
  <span class="hljs-keyword">if</span>( ( UCSR0A &amp; (<span class="hljs-number">1</span>&lt;&lt;UDRE0)) ){<font></font>
    umoment = ADCL;<span class="hljs-comment">//copy result.</span>
    umoment += (ADCH&lt;&lt;<span class="hljs-number">8</span>);<font></font>
    umoment = umoment - <span class="hljs-number">512</span>;<font></font>
    utemp = utemp + <span class="hljs-built_in">pow</span>((<span class="hljs-keyword">double</span>)(umoment),<span class="hljs-number">2</span>)/<span class="hljs-number">4096</span>;<font></font>
    N++;<font></font>
    <span class="hljs-keyword">if</span> (N == <span class="hljs-number">4095</span>){<font></font>
      urms = <span class="hljs-built_in">sqrt</span>(utemp)/<span class="hljs-number">102</span>;<font></font>
      N = <span class="hljs-number">0</span>;<font></font>
      utemp = <span class="hljs-number">0</span>;<font></font>
      flag = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">if</span> (PIND &amp; (<span class="hljs-number">1</span>&lt;&lt;PD3)){<font></font>
        PORTD &amp;= ~(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span>{<font></font>
        PORTD |=(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Programm ist in der Arduino IDE für den ATmega1280-Mikrocontroller geschrieben. </font><font style="vertical-align: inherit;">Auf meiner Debug-Karte werden die ersten 8 Kanäle für die internen Anforderungen der Karte geroutet, sodass der ADC8-Kanal verwendet wird. </font><font style="vertical-align: inherit;">Es ist möglich, diese Skizze für eine Karte mit ATmega168 zu verwenden. Sie müssen jedoch den richtigen Kanal auswählen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Innerhalb von Interrupts zucken wir mit ein paar Service-Pins, um die funktionierende Digitalisierungsfrequenz visuell zu sehen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein paar Worte darüber, woher der Koeffizient 102 kam. Beim ersten Start wurde vom Generator ein Signal mit verschiedenen Amplituden geliefert, eine Anzeige des effektiven Spannungswerts vom Oszilloskop abgelesen und der berechnete Wert in absoluten Einheiten des ADC von der Konsole entnommen.</font></font><br>
<table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Umax, V.</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Urms, In</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zählte</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,08</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">212</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,73</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">176</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,38</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">141</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,03</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">106</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,684</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">71</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,358</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,25</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,179</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neunzehn</font></font></td>
</tr>
</tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir die Werte der dritten Spalte durch die Werte der zweiten Spalte dividieren, erhalten wir einen Durchschnitt von 102. Dies ist unser "Kalibrierungs" -Koeffizient. Es kann jedoch festgestellt werden, dass die Genauigkeit stark abnimmt, wenn die Spannung abnimmt. Dies liegt an der geringen Empfindlichkeit unseres ADC. Tatsächlich sind 10 Entladungen für genaue Berechnungen katastrophal klein. Wenn es möglich ist, die Spannung in der Steckdose auf diese Weise zu messen, ist die Verwendung eines 10-Bit-ADC zur Messung des von der Last verbrauchten Stroms ein Verbrechen gegen die Messtechnik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
An diesem Punkt werden wir aufhören. Im nächsten Teil werden wir die anderen drei Fragen in dieser Reihe betrachten und reibungslos mit der Erstellung des Geräts selbst fortfahren.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die vorgestellte Firmware sowie andere Firmware für diese Serie (da ich Videos schneller aufnehme als Artikel vorbereite) finden Sie im Repository auf GitHub: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/radiolok/arduino_rms_count</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Für die Entwicklung des Stromzählers wird die Referenz von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TI SimpleLink WiFi CC3200</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> als Grundlage verwendet </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">SmartPlug</font></a><font style="vertical-align: inherit;"> , dessen Nachricht erst </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">neulich</font></a><font style="vertical-align: inherit;"> in meine Mail geflogen ist. </font><font style="vertical-align: inherit;">Ich mag den CC3200-Mikrocontroller sehr, daher werden wir ein Booster-Pack für das vorhandene Lunchpad entwickeln und alle Funktionen realisieren, die uns interessieren. </font><font style="vertical-align: inherit;">Vergessen Sie nicht, dass es auf anderen Mikrocontrollern so gut funktioniert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kommentare sind erwünscht  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">progchip666</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, für Kommentare und Ergänzungen zum Material sowie  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smart_alex</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wie zuvor an der Messung von Strom und Spannung mit Arduino interessiert.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de384597/">https://habr.com/ru/post/de384597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de384583/index.html">Fans von "My Little Pony" sammeln Geld für ein Kampfspiel, das auf der Zeichentrickserie basiert (aber mit neuen Charakteren).</a></li>
<li><a href="../de384585/index.html">Eine detaillierte Geschichte des Scheiterns des Volkswagen-Konzerns mit einer Fälschung von Tests auf Umweltfreundlichkeit</a></li>
<li><a href="../de384589/index.html">Sprechen mit einer Glühbirne - VOCCA Smart Cartridge Review</a></li>
<li><a href="../de384593/index.html">[UPDATE ISS] Totale Sonnenfinsternis des Supermondes 28. September</a></li>
<li><a href="../de384595/index.html">Strahlengefahr: Spaltreaktoren versus Fusionsreaktoren</a></li>
<li><a href="../de384599/index.html">Warum Lampen auf LED umstellen?</a></li>
<li><a href="../de384603/index.html">Lima Bewertung: unbegrenzter persönlicher Cloud-Service</a></li>
<li><a href="../de384605/index.html">Mit IFTTT und OpenHAB eine herkömmliche Mikrowelle intelligenter machen</a></li>
<li><a href="../de384607/index.html">Wie ist die Form des Internets?</a></li>
<li><a href="../de384611/index.html">Weltraumfotos für die Woche (21.09.-27.09)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>