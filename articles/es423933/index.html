<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüåæ ‚ùáÔ∏è üìí Microsoft Office Security: objetos incrustados üêÇ üë©üèæ‚Äçü§ù‚Äçüë©üèº üèØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Inicialmente, la arquitectura de Microsoft Office fue construida sobre la base del concepto de documentos compuestos, tambi√©n son documentos OLE , pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microsoft Office Security: objetos incrustados</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/423933/"><img src="https://habrastorage.org/webt/os/-z/yx/os-zyx2ayrnxagtecn42u4spxke.jpeg"><br><br>  Inicialmente, la arquitectura de Microsoft Office fue construida sobre la base del concepto de documentos compuestos, tambi√©n son <b>documentos OLE</b> , promovidos activamente por Microsoft en los albores de Windows de 32 bits.  En aquellos d√≠as, la idea de combinar "sin problemas" datos de varios formatos en un documento parec√≠a atractiva y fascinante, y antes de identificar los primeros problemas, logr√≥ crecer firmemente en muchos productos a gran escala. <br><br>  La "mala noticia" fue que la forma universal de agregar datos (y el c√≥digo para procesar estos datos) en los documentos se ha convertido en una forma universal de introducir vulnerabilidades en el producto, que a√∫n hoy presenta sorpresas <s>agradables</s> para los <s>creadores de</s> investigadores de seguridad <s>de malware</s> . <a name="habracut"></a><br><br>  Posteriormente, el paquete de la aplicaci√≥n recibi√≥ un conjunto bastante rico de herramientas para agregar im√°genes, gr√°ficos y tablas, elementos de control que la aplicaci√≥n crea y procesa y que forman parte de ella en los documentos.  Desde el punto de vista de la seguridad, estos elementos tienen un poco menos de inter√©s que los elementos que (principalmente) se analizar√°n en el art√≠culo: elementos que usan el c√≥digo de aplicaciones externas que se agregan a los documentos que usan OLE. <br><br>  Una representaci√≥n de "disco" de un documento compuesto es un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archivo CFBF</a> .  Este art√≠culo discutir√° la incrustaci√≥n de objetos en documentos de Microsoft Office (o m√°s bien, solo el aspecto de seguridad) en el contexto de <b>datos y c√≥digo cargados en la memoria</b> en tiempo de ejecuci√≥n. <br><br>  Los objetos incrustados formalmente en documentos de Microsoft Office se pueden dividir en los siguientes grupos: <br><br><ul><li>  Controles ActiveX (controles ActiveX) </li><li>  <b>Objetos incrustados OLE</b> </li><li>  Archivos incrustados ( <b>paquetes</b> ) </li><li>  Elementos en l√≠nea <b>no OLE</b> </li></ul><br><h3>  Controles ActiveX </h3><br>  Los controles ActiveX pueden considerarse como elementos de una ventana de programa (por ejemplo, botones, interruptores, listas, campos de entrada y otros formularios) dise√±ados para producir ciertos eventos o responder a eventos.  √ârase una vez, parec√≠a una buena idea crear tales elementos de control universales, con la posibilidad de uso en cualquier aplicaci√≥n, y ponerlos para este prop√≥sito en <b>componentes COM</b> . <br><br>  Las p√°ginas web integradas de ActiveX representaban una conocida violaci√≥n de seguridad de Internet Explorer, las medidas de seguridad aumentaron con el tiempo.  Los navegadores de otros fabricantes abandonaron casi de inmediato la compatibilidad con ActiveX.  El nuevo navegador Microsoft Edge finalmente se separ√≥ de esta reliquia del pasado.  Sin embargo, todav√≠a es posible incrustar en documentos de Office. <br><br>  ActiveX en documentos est√° dise√±ado para usarse junto con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b>Visual Basic para Aplicaciones</b></a> .  Sin embargo, no se requiere VBA para descargarlos y activarlos, y no se requiere permiso del usuario para descargar <b>elementos de la lista blanca</b> . <br><br>  Las vulnerabilidades en este √∫ltimo son especialmente peligrosas: la configuraci√≥n predeterminada que se establece al instalar la aplicaci√≥n no implica ninguna protecci√≥n contra la carga de estos elementos, ni una advertencia para el usuario.  El administrador debe ajustar la configuraci√≥n al prohibir la carga de cualquier control ActiveX (sin embargo, tenga en cuenta que ActiveX no se carga en el modo Navegaci√≥n segura). <br><blockquote>  Ejemplo: CVE-2012-0158 <br><br>  Una de las vulnerabilidades m√°s peligrosas en los documentos de Office en 2012 fue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVE-2012-0158</a> .  El c√≥digo de carga para el elemento Microsoft ListView Control 6.0 de la biblioteca MSCOMCTL.OCX conten√≠a la posibilidad de desbordamiento del b√∫fer, lo que permiti√≥ reemplazar la direcci√≥n de retorno y ejecutar c√≥digo arbitrario.  Como el elemento estaba en la "lista blanca" de ActiveX, la carga comenz√≥ inmediatamente cuando se abri√≥ el documento.  La vulnerabilidad est√° arreglada actualmente, el control ListView todav√≠a se considera "seguro". </blockquote><h4>  Agregar ActiveX a un documento </h4><br>  Para agregar un elemento de control a un documento de Microsoft Office (por simplicidad, tome Word), use la interfaz de usuario para abrir la pesta√±a "Desarrollador" (su visibilidad est√° configurada en el men√∫ "Opciones de Word") y seleccione Controles -&gt; Herramientas de versiones anteriores -&gt; Controles ActiveX.  El men√∫ mostrar√° un conjunto de iconos correspondientes a elementos de Microsoft Forms, as√≠ como la capacidad de seleccionar ActiveX de la lista compuesta de elementos disponibles en el sistema que se seleccionan de acuerdo con una serie de criterios. <br><br><img src="https://habrastorage.org/webt/nn/wt/jt/nnwtjte9nabt8rriqxotr4f7is4.jpeg"><br><br>  La lista que se muestra no corresponde al conjunto de elementos que realmente se pueden cargar en el documento, por lo tanto, no se puede guiar al buscar elementos vulnerables.  La verificaci√≥n sofisticada de varios niveles de ActiveX descargado tiene varias etapas, difiere para las versiones de Office y var√≠a de una actualizaci√≥n a otra, por lo que la forma m√°s segura de verificar la descarga es "componer" manualmente el archivo del documento con el elemento de inter√©s e intentar abrirlo en Office.  Los posibles formatos de documentos se describen a continuaci√≥n. <br><br><h4>  Presentaci√≥n del programa </h4><br>  Cada elemento ActiveX es esencialmente un objeto de una de las clases COM que cumplen ciertos requisitos.  Un elemento se carga utilizando el subsistema COM, y el c√≥digo ejecutable est√° contenido en uno de los m√≥dulos, que generalmente son "externos" a la aplicaci√≥n contenedor.  Al igual que cualquier objeto COM, un elemento ActiveX puede implementarse como una DLL o como un archivo ejecutable EXE.  En el primer caso, la biblioteca se cargar√° en el espacio de direcciones del contenedor, en el segundo: el elemento se procesar√° en un proceso separado, con la transferencia de datos entre el contenedor y el objeto a trav√©s de la clasificaci√≥n COM. <br><br>  Al igual que cualquier objeto COM, ActiveX tiene <b>interfaces</b> , <b>propiedades</b> y <b>m√©todos</b> . <br><br>  Las interfaces son principalmente un conjunto de interfaces est√°ndar que la clase ActiveX debe tener para una carga completa e interacci√≥n con el contenedor, en particular, IOleControl e IOleObject. <br><br>  La ausencia de las interfaces necesarias puede reducir la funcionalidad del elemento o interrumpir su carga en alg√∫n momento. <br><blockquote>  Ejemplo: CVE-2015-2424 <br>  La vulnerabilidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVE-2015-2424</a> se asoci√≥ con el elemento de clase TaskSymbol de la biblioteca mmcndmgr.dll.  El elemento no estaba destinado para su uso en documentos y no export√≥ la interfaz IDispatch.  En el proceso de cargar un elemento, el procedimiento que solicit√≥ esta interfaz recibi√≥ un error y destruy√≥ la estructura interna del elemento, lo que condujo a una vulnerabilidad del tipo libre de uso posterior.  Por el momento, el elemento no se puede descargar (a pesar de esto, todav√≠a se puede encontrar en la lista para agregarlo al men√∫ "Desarrollador").  La vulnerabilidad en s√≠ no se resuelve. <br></blockquote>  Adem√°s de los est√°ndares, cada clase ActiveX exporta la interfaz "principal", que representa su propia funcionalidad √∫nica.  Por ejemplo, para la clase Forms.CommandButton.1, esto es ICommandButton. <br><br>  Puede ver las interfaces ActiveX con la herramienta <b>OleView</b> incluida en el paquete de Microsoft Visual Studio. <br><br><img src="https://habrastorage.org/webt/um/cc/zm/umcczmybv5voo3c6bbde66zxdmq.png"><br><br>  La interfaz de un elemento define sus <b>m√©todos</b> y <b>propiedades</b> .  Las propiedades representan algunos datos que determinan la apariencia y el funcionamiento de un elemento.  El desarrollador de un elemento ActiveX asigna un nombre espec√≠fico a cada propiedad, digamos BackColor o GridLineWidth, y un tipo, por ejemplo, una cadena, un entero o una precisi√≥n doble real.  Para im√°genes e iconos de mapa de bits, hay un tipo de propiedad, como una imagen.  El programa cliente puede establecer propiedades individuales del control estableciendo sus √≠ndices y valores enteros. <br><br>  Desde el punto de vista de una implementaci√≥n de bajo nivel, la divisi√≥n en m√©todos y propiedades es formal, ya que las "propiedades" est√°n representadas por un conjunto de m√©todos get / set.  Sin embargo, hay una diferencia significativa: los m√©todos de un elemento (su interfaz principal) solo se pueden llamar mediante programaci√≥n, en el caso de documentos de Office, solo desde un programa VBA en ejecuci√≥n.  Desde el punto de vista de la seguridad, esto no es de gran inter√©s, ya que la ejecuci√≥n de VBA ya es un compromiso del sistema operativo.  <b>Las propiedades</b> se guardan en el documento y cuando se abre, se <b>procesar√°n y</b> cargar√°n en las estructuras de la memoria, <b>incluso si se proh√≠be la ejecuci√≥n de VBA</b> . <br><br>  Desde el punto de vista del software, por parte del elemento, para preservar sus propiedades y estado en el documento, el contenedor proporciona las <b>interfaces IStream</b> , <b>IStorage</b> e <b>IPropertyBag</b> .  Su implementaci√≥n y presentaci√≥n de datos en un archivo de disco ya no es una preocupaci√≥n del elemento ActiveX, y depende completamente del contenedor y el formato del documento.  Cabe se√±alar que el conjunto y el formato de los datos almacenados pueden corresponder a un conjunto de propiedades exportado "p√∫blicamente", o puede ser completamente diferente.  Considere ejemplos de implementaci√≥n relacionados con Microsoft Office. <br><br><h4>  Archivo compuesto (CFBF) </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El formato de documento de Office obsoleto</a> , donde el almacenamiento de nivel inferior de ObjectPool y subdirectorios separados dentro de √©l se asignaron para almacenar datos ActiveX.  La secuencia "\ 001CompObj" contiene el identificador de clase, que finalmente determina la clase del objeto cargado.  <b>Reemplazar el identificador</b> directamente en hexadecimal dar√° como resultado un intento de cargar un objeto de una <b>clase</b> completamente <b>diferente</b> . <br><br><img src="https://habrastorage.org/webt/bc/sx/uc/bcsxucmomcw9wnqwgn-84bxosnu.jpeg"><br><br><h4>  Office Open XML </h4><br>  Formato de documento XML moderno.  El archivo es un archivo zip.  Los datos de control de ActiveX se almacenan en el subdirectorio ActiveX en archivos con nombres simples como activeX1.xml. <br><br><img src="https://habrastorage.org/webt/su/gx/uq/sugxuqtgsbhdg8tvr53srkbvtsg.png"><br><br>  Archivo de ejemplo: <br> <code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt; <br> &lt;ax:ocx ax: <b>classid="{D7053240-CE69-11CD-A777-00DD01143C57}</b> " ax: <b>persistence="persistPropertyBag"</b> xmlns:ax="http://schemas.microsoft.com/office/2006/activeX" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"&gt; <br> &lt;ax:ocxPr ax:name="Caption" ax:value="CommandButton1"/&gt; <br> &lt;ax:ocxPr ax:name="Size" ax:value="2540;847"/&gt; <br> &lt;ax:ocxPr ax:name="FontName" ax:value="Calibri"/&gt; <br> &lt;ax:ocxPr ax:name="FontHeight" ax:value="225"/&gt; <br> &lt;ax:ocxPr ax:name="FontCharSet" ax:value="204"/&gt; <br> &lt;ax:ocxPr ax:name="FontPitchAndFamily" ax:value="2"/&gt; <br> &lt;ax:ocxPr ax:name="ParagraphAlign" ax:value="3"/&gt; <br> &lt;/ax:ocx&gt;</code> <br> <br>  En estos archivos, los identificadores de clase se indican en forma de texto.  Reemplazar el identificador tambi√©n provocar√° un intento de cargar un elemento de otra clase. <br><br>  A continuaci√≥n, el archivo contiene una indicaci√≥n del tipo de almacenamiento de datos del objeto: persistPropertyBag, persistStorage o persistStream.  Si un elemento admite propiedades <b>persistPropertyBag</b> , sus datos se pueden almacenar <b>en el mismo archivo de texto</b> , consulte el ejemplo anterior.  Si necesita <b>almacenamiento</b> o una <b>secuencia binaria</b> , los datos se guardar√°n en un archivo con un nombre del tipo activeX1.bin, que es <b>un archivo CFBF</b> . <br><br><img src="https://habrastorage.org/webt/pt/tx/hp/pttxhpe9gevkgf8l4a7ddmcfspu.png"><br><br><h4>  RTF </h4><br>  En un documento rtf, el elemento ActiveX est√° definido por las <b>etiquetas \ object \ objocx</b> .  La <b>etiqueta \ objdata</b> contiene el almac√©n de propiedades del elemento como una representaci√≥n hexadecimal del archivo CFBF. <br><br> <code>{\object\objocx\f37\objsetsize\objw1440\objh480{\*\objclass Forms.CommandButton.1} <br> {\*\objdata 010500000200000016000000 <br> 466f726d732e436f6d6d616e64427574746f6e2e31000000000000000000000e0000 <br> <b>d0cf11e</b> 0a1b11ae1000000000000000000000000000000003e000300feff090006</code> <br> <br><h4>  Descargar desde archivo </h4><br>  El proceso de cargar ActiveX desde un documento en su conjunto es bastante simple.  La aplicaci√≥n contenedor crea un objeto limpio de la clase especificada, le solicita la interfaz de almacenamiento especificada y proporciona un puntero al almacenamiento, flujo o "paquete de propiedades". <br><br>  Filtrar elementos que se pueden cargar tiene muchos pasos.  En primer lugar, se eliminan las clases especificadas en la lista negra conocida como <b>Office COM Kill Bit</b> (sugerencia de registro * OFFICE_KEY * \ Common \ COM Compatibility).  Por ejemplo, los indicadores anti-descarga tienen clases como Microsoft Scriptlet Component y Microsoft Web Browser. <br><br>  Las clases restantes pasar√°n por la carga inicial.  Esto significa que <b>la DLL se cargar√°</b> en la aplicaci√≥n contenedor o se <b>iniciar√°</b> <b>el proceso del servidor COM</b> implementado en el archivo EXE.  Solo despu√©s de eso, se realizar√°n el resto de las verificaciones, incluida la primaria, y si el objeto es, de hecho, un representante de ActiveX. <br><blockquote>  Ejemplo: CVE-2015-6128 <br>  En 2015, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">investigador descubri√≥</a> que la precarga de m√≥dulos COM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se puede utilizar para omitir ASLR y ejecutar c√≥digo arbitrario</a> al cargar bibliotecas din√°micas falsas.  El CVE-2015-6128 lanzado posteriormente no es una palabra sobre Microsoft Office. <br></blockquote>  Si el identificador realmente define ActiveX, pasar√° por varias verificaciones m√°s en varias listas en blanco y negro. <br><br><div class="spoiler">  <b class="spoiler_title">Lista de arranque ActiveX desde .docx en Windows 7 y Office 2016 limpios con la configuraci√≥n predeterminada.</b> <div class="spoiler_text"> <code>{00024522-0000-0000-C000-000000000046} RefEdit.Ctrl <br> {02AF6DD2-77E6-44DF-B3E1-57CF1476D8EA} Microsoft Forms 2.0 OptionButton <br> {04082FC6-E032-49F2-A263-FE64E9DA1FA3} Microsoft Forms 2.0 HTML TEXT <br> {0B314611-2C19-4AB4-8513-A6EEA569D3C4} Microsoft Slider Control, version 6.0 <br> {13D557B6-A469-4362-BEAF-52BFD0F180E2} Microsoft Forms 2.0 HTML TextAREA <br> {19FED08E-EFD1-45da-B524-7BE4774A6AEE} Microsoft Forms 2.0 ListBox <br> {20DD1B9E-87C4-11D1-8BE3-0000F8754DA1} Microsoft Date and Time Picker Control 6.0 (SP4) <br> {227B1F3B-C276-4DE0-9FAA-C0AD42ADDCF0} Microsoft Forms 2.0 HTML RESET <br> {232E456A-87C3-11D1-8BE3-0000F8754DA1} Microsoft MonthView Control 6.0 (SP4) <br> {3D0FD779-0C2D-4708-A9BA-62F7458A5A53} Microsoft Forms 2.0 ToggleButton <br> {444D2D27-02E8-486B-9018-3644958EF8A9} FieldListCtrl.2 Object <br> {4C599241-6926-101B-9992-00000B65C6F9} Microsoft Forms 2.0 Image <br> {5052A832-2C0F-46c7-B67C-1F1FEC37B280} Microsoft Forms 2.0 Label <br> {5512D110-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML SUBMIT <br> {5512D112-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML IMAGE <br> {5512D114-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML RESET <br> {5512D116-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML CHECKBOX <br> {5512D118-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML OPTION <br> {5512D11A-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML TEXT <br> {5512D11C-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML Hidden <br> {5512D11E-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML Password <br> {5512D122-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML SELECT <br> {5512D124-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML TextAREA <br> {556C2772-F1AD-4DE1-8456-BD6E8F66113B} Microsoft ImageList Control 6.0 (SP6) <br> {585AA280-ED8B-46B2-93AE-132ECFA1DAFC} Microsoft StatusBar Control 6.0 (SP6) <br> {5CBA34AE-E344-40CF-B61D-FBA4D0D1FF54} Microsoft Forms 2.0 HTML CHECKBOX <br> {5E90CC8B-E402-4350-82D7-996E92010608} Microsoft Forms 2.0 HTML OPTION <br> {603C7E80-87C2-11D1-8BE3-0000F8754DA1} Microsoft UpDown Control 6.0 (SP4) <br> {6240EF28-7EAB-4dc7-A5E3-7CFB35EFB34D} Microsoft Forms 2.0 ScrollBar <br> {65BCBEE4-7728-41A0-97BE-14E1CAE36AAE} Microsoft Office List 16.0 <br> {6C177EBD-C42D-4728-A04B-4131892EDBF6} Microsoft Forms 2.0 ComboBox <br> {787A2D6B-EF66-488D-A303-513C9C75C344} Microsoft Forms 2.0 HTML Password <br> {79176FB0-B7F2-11CE-97EF-00AA006D2776} Microsoft Forms 2.0 SpinButton <br> {86F56B7F-A81B-478d-B231-50FD37CBE761} Microsoft Forms 2.0 CommandButton <br> {87DACC48-F1C5-4AF3-84BA-A2A72C2AB959} Microsoft ImageComboBox Control, version 6.0 <br> {8B2ADD10-33B7-4506-9569-0A1E1DBBEBAE} Microsoft Toolbar Control 6.0 (SP6) <br> {8BD21D10-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 TextBox <br> {8BD21D20-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ListBox <br> {8BD21D30-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ComboBox <br> {8BD21D40-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 CheckBox <br> {8BD21D50-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 OptionButton <br> {8BD21D60-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ToggleButton <br> {9432194C-DF54-4824-8E24-B013BF2B90E3} Microsoft Forms 2.0 HTML SUBMIT <br> {95F0B3BE-E8AC-4995-9DCA-419849E06410} Microsoft TreeView Control 6.0 (SP6) <br> {978C9E23-D4B0-11CE-BF2D-00AA003F40D0} Microsoft Forms 2.0 Label <br> {9A948063-66C3-4F63-AB46-582EDAA35047} Microsoft TabStrip Control 6.0 (SP6) <br> {9BDAC276-BE24-4F04-BB22-11469B28A496} Microsoft Forms 2.0 HTML IMAGE <br> {A0E7BF67-8D30-4620-8825-7111714C7CAB} Microsoft ProgressBar Control, version 6.0 <br> {CCDB0DF2-FD1A-4856-80BC-32929D8359B7} Microsoft ListView Control 6.0 (SP6) <br> {D7053240-CE69-11CD-A777-00DD01143C57} Microsoft Forms 2.0 CommandButton <br> {DCA0ED3C-B95D-490f-9C60-0FF3726C789A} Microsoft Forms 2.0 Image <br> {DD4CB8C5-F540-47ff-84D7-67390D2743CA} Microsoft Forms 2.0 TextBox <br> {DFD181E0-5E2F-11CE-A449-00AA004A803D} Microsoft Forms 2.0 ScrollBar <br> {E9729012-8271-4e1f-BC56-CF85F914915A} Microsoft Forms 2.0 CheckBox <br> {EA778DB4-CE69-4da5-BC1D-34E2168D5EED} Microsoft Forms 2.0 SpinButton <br> {EAE50EB0-4A62-11CE-BED6-00AA00611080} Microsoft Forms 2.0 TabStrip <br> {F14E8B03-D080-4D3A-AEBA-355E77B20F3D} Microsoft Forms 2.0 HTML SELECT <br> {F8CF7A98-2C45-4c8d-9151-2D716989DDAB} Microsoft Visio Document <br> {FB453AD8-2EF4-44D3-98A8-8C6474E63CE4} Microsoft Forms 2.0 HTML Hidden <br> {FDEA20DB-AC7A-42f8-90EE-82208B9B4FC0} Microsoft Forms 2.0 TabStrip <br> {FE38753A-44A3-11D1-B5B7-0000C09000C4} Microsoft Flat Scrollbar Control 6.0 (SP4) <br></code> </div></div><br>  Puede ver que un lugar significativo en la lista est√° ocupado por los componentes del grupo <b>Formularios de Microsoft</b> .  Este es un conjunto de controles que vienen con Office, y puede verlos en el panel de controles ActiveX.  Inicialmente, todos estaban registrados como "seguros", pero con el tiempo se hizo evidente que esto no era as√≠ para elementos individuales.  Por ejemplo, el elemento Frame carga cualquier otro ActiveX sin verificar ninguna lista (en las √∫ltimas versiones esto es "fijo", pero la propia lista negra de Frame es diferente de la Oficina general).  Por esta raz√≥n, algunos elementos de Microsoft Forms solo pueden cargarse en un documento con el permiso del usuario.  Microsoft Forms Frame tambi√©n requiere el consentimiento del usuario (en la configuraci√≥n predeterminada), pero le permite descargar algunos elementos de la lista Kill Bit que no se pudieron cargar en otras condiciones. <br><br>  Por lo tanto, si un atacante logra convencer al usuario de que permita que ActiveX se cargue, Frame lo ayudar√° a expandir significativamente el arsenal debido a elementos como, por ejemplo, el navegador web. <br><br>  El formato de almacenamiento de propiedades de Microsoft Forms est√° parcialmente documentado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la especificaci√≥n [MS-OFORMS]</a> . <br><br>  Durante el an√°lisis de ActiveX, result√≥ que el conjunto de clases para doc, docx y rtf es diferente, tambi√©n hay diferentes listas de ActiveX disponibles para una aplicaci√≥n que se ejecuta de la manera habitual y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en modo de automatizaci√≥n</a> . <br><br>  Muchas aplicaciones populares complementan estas listas con su propio ActiveX.  Si se descubre una vulnerabilidad, se reflejar√° en el bolet√≠n como relacionada con la aplicaci√≥n de la que forma parte.  Sin embargo, la √∫nica forma de aprovechar la vulnerabilidad pueden ser los documentos de Office. <br><blockquote>  Ejemplo: Flash ActiveX <br>  Los escritores de virus apreciaron especialmente a Flash ActiveX por sus vulnerabilidades consistentemente detectables y un lugar permanente en las listas blancas de IE y Office.  Las primeras vulnerabilidades conocidas en este componente aparecieron en 2008, una de las √∫ltimas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVE-2018-4878 se</a> cerr√≥ en febrero de este a√±o.  Con la creciente popularidad de IE, los documentos de Office se han convertido en la principal forma de distribuir exploits para Flash. <br></blockquote><h3>  Elementos de datos OLE integrados </h3><br>  Los elementos OLE implementados est√°n dise√±ados para implementar el concepto de "documento en documento" con la capacidad de editar datos in situ de varios formatos procesados ‚Äã‚Äãpor otras aplicaciones.  Al igual que ActiveX, los documentos OLE se implementan sobre la base de COM. <br><br>  Puede agregar un elemento OLE a un documento de Word de la siguiente manera: abra la pesta√±a "Insertar" y seleccione Texto -&gt; Objeto.  El programa muestra una lista de tipos de documentos para los que los controladores OLE est√°n registrados.  Como es el caso con ActiveX, esta lista no coincide con el conjunto de clases que realmente se pueden cargar como documentos OLE. <br><br><img src="https://habrastorage.org/webt/yi/x9/1g/yix91gwugtk06yq_s37z4iibzy0.png"><br><br><h4>  Presentaci√≥n del programa </h4><br>  Como en el caso de ActiveX, la implementaci√≥n de cualquier documento OLE est√° representada por la clase COM correspondiente, realizada en forma de DLL o EXE.  El componente exporta las interfaces de servicio necesarias y el estado se guarda en el documento contenedor a trav√©s de las interfaces IPersist *. <br><br>  En un documento CFBF, los datos del objeto OLE se almacenan en el almacenamiento de segundo nivel de ObjectPool.  Un conjunto de subprocesos es generalmente similar a los controles ActiveX correspondientes. <br><br><img src="https://habrastorage.org/webt/ir/qt/oc/irqtocl-val1mrwslawmlpzdpsq.png"><br><br>  En los documentos XML de Open Office, los datos del objeto OLE se almacenan en el subdirectorio de incrustaciones, en un archivo de almacenamiento CFBF con un nombre de tipo oleObject1.bin. <br><br><img src="https://habrastorage.org/webt/p-/7e/ww/p-7ewwax0n2gfsbqercoev9tie0.png"><br><br>  En los documentos RTF, la informaci√≥n del objeto se almacena bajo la etiqueta <b>\ object \ objemb \</b> .  La secci√≥n tambi√©n contiene almacenamiento codificado como una representaci√≥n hexadecimal del archivo CFBF. <br><br> <code>{\object\objemb\objw8307\objh553{\*\objclass WordPad.Document.1} <br> {\*\objdata 010500000200000013000000576f72645061642e446f63756d656e742e31000000000000000000000a0000 <br> <b>d0cf11e</b> 0a1b11ae100000000 <br></code> <br><br>  El formato RTF se distingue por el hecho de que admite la etiqueta <b>\ objupdate</b> , que provoca la activaci√≥n autom√°tica del elemento, mientras que los elementos OLE predeterminados est√°n inactivos cuando se cargan. <br><blockquote>  Ejemplo: CVE-2017-11882 <br>  La vulnerabilidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVE-2017-11882</a> OLE del componente Editor de ecuaciones debido al procesamiento del objeto en un proceso separado hizo posible una operaci√≥n estable y universal.  La etiqueta \ objupdate hizo que Word cargara el componente vulnerable inmediatamente despu√©s de abrir el documento. <br></blockquote><blockquote>  Ejemplo: elementos incrustados de Excel con macrovirus <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Los investigadores han descubierto</a> documentos rtf maliciosos que no utilizan ninguna vulnerabilidad nueva.  Los documentos contienen varios documentos de Excel con macros como objetos incrustados.  El c√°lculo se realiza sobre el hecho de que el usuario que, despu√©s de abrir el documento varias veces seguidas, se niega a ejecutar la macro, como resultado, "se rinde" y permite la ejecuci√≥n.  Por el momento, la t√©cnica sigue funcionando. <br><br><img src="https://habrastorage.org/webt/ih/e_/oq/ihe_oqpkamkndvqbjfcmxhjqhbi.png"><br></blockquote>  Una diferencia significativa de ActiveX en el caso de elementos OLE incrustados es que el identificador de clase se escribe directamente en el archivo de almacenamiento mediante la funci√≥n WriteClassStg.  Esta t√©cnica se hereda de hace mucho tiempo, cuando Microsoft desarroll√≥ con entusiasmo el concepto de "serializaci√≥n" y almacenamiento de objetos con su estado en formato CFBF.  El documento contenedor tambi√©n guarda el identificador de clase del elemento implementado, pero se cargar√° el objeto de la clase especificada en el repositorio.  Este identificador se puede reemplazar obligando a la aplicaci√≥n a cargar un objeto que no est√° destinado para estos fines. <br>  Es posible editar los datos del elemento, lo que en ciertos casos conduce a la identificaci√≥n de vulnerabilidades. <br><br>  Los objetos OLE tambi√©n se someten a numerosas comprobaciones de descarga, lo que dificulta obtener una lista completa de elementos potencialmente cargados.  El conjunto de elementos que se pueden cargar como objetos OLE es diferente de la lista de ActiveX cargados.  En particular, se verifican en una lista de KillBit que no es propiedad de Office, sino de Internet Explorer (HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Internet Explorer \ ActiveX Compatibility). <br><br><h4>  OLE por enlace </h4><br>  OLE distingue entre dos mecanismos para incrustar contenido en un documento: incrustar directamente un documento OLE y crear un enlace dentro de otro documento a otro documento.  En caso de incrustar el objeto OLE por referencia, el documento principal contiene una indicaci√≥n de la ruta al archivo del documento incrustado.  La ruta puede ser local o de red, o una direcci√≥n de Internet.  El controlador OLE est√° determinado por la extensi√≥n del archivo, el controlador correspondiente debe estar registrado en el sistema operativo. <br><blockquote>  Ejemplo: CVE-2017-0199 <br>  La vulnerabilidad de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVE-2017-0199</a> consisti√≥ en la posibilidad de agregar un formato hta "objeto por referencia" al documento.  Este √∫ltimo es html con la capacidad de ejecutar c√≥digo, es decir, en realidad es un archivo ejecutable.  El controlador descarg√≥ y ejecut√≥ autom√°ticamente hta, lo que le permite ejecutar c√≥digo arbitrario al abrir un documento. <br></blockquote>  Antes de actualizar el objeto incrustado, la aplicaci√≥n solicita permiso del usuario.  En este caso, el archivo se descarga por adelantado, lo que puede servir para revelar informaci√≥n sobre el usuario. <br><br><h3>  Archivos incrustados (paquetes) </h3><br>  Los documentos de Office admiten la capacidad de agregar cualquier archivo (Objeto -&gt; Crear desde archivo o simplemente arrastrar y soltar el icono del archivo en el campo de edici√≥n).  T√©cnicamente, esto se implementa agregando un elemento incorporado del <b>Object Packager</b> al documento que escribe el archivo deseado en sus propios datos.  Object Packager le permite reemplazar el icono y la firma del archivo, as√≠ como especificar la l√≠nea de comando para abrir.  Puede incluir <b>archivos "por referencia"</b> cuando el archivo se abre no desde su propio almacenamiento, sino a lo largo de la ruta especificada, <b>incluida la red</b> . <br><br>  Recientemente, la funcionalidad de Object Packager se ha reducido significativamente, e inicialmente el elemento podr√≠a guardar cualquier archivo, incluidos ejecutables, enlaces e incluso la l√≠nea de comandos.  Todo lo que el usuario tuvo que hacer para iniciar el contenido fue hacer doble clic en el icono en el texto del documento. <br><blockquote>  Ejemplo: archivos en el cuerpo de un mensaje de Outlook <br>  Los mensajes de Outlook, que tambi√©n son documentos compuestos, le permiten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">agregar elementos de Object Packager al cuerpo del mensaje</a> .  Para el usuario, el elemento parece una imagen seleccionada arbitrariamente por un atacante.  Al hacer doble clic en la imagen, se abre el archivo empaquetado.  Un atacante tiene que elegir un tipo de datos de aquellos que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">a√∫n no est√°n sujetos a pol√≠ticas de seguridad m√°s estrictas</a> . <br></blockquote><br><img src="https://habrastorage.org/webt/r-/cl/lr/r-cllr7l101bxg1g7noz3ntrs-c.jpeg"><br><br><h3>  Elementos en l√≠nea no implementados usando OLE </h3><br>  Por el momento, la mayor amenaza / inter√©s de los elementos que no son OLE pueden ser <b>im√°genes que se agregan al documento por referencia</b> .  Cuando se abre un documento en un modo no protegido, las im√°genes se descargan autom√°ticamente, lo que puede conducir a la divulgaci√≥n de la ubicaci√≥n e identidad del usuario que descarg√≥ el documento a trav√©s de servidores proxy an√≥nimos o recibi√≥ un documento confidencial de terceros.  Esta t√©cnica, en particular, se implement√≥ en la <b>herramienta Scribbles</b> , que est√° en servicio con la inteligencia estadounidense. <br>  En una red de √°rea local de Windows, la descarga autom√°tica de im√°genes por referencia permite aprovechar la <b>vulnerabilidad NTLMRelay</b> .  El mecanismo para vincular im√°genes no es compatible con los requisitos de seguridad de las redes ActiveDirectory, ya que un administrador que recibe dicho documento esencialmente ejecuta un c√≥digo de atacante con todos los privilegios administrativos. <br><br><h3>  M√©todos de seguridad </h3><br>  Que se puede hacer  En general, un poco. <br><br>  El m√©todo m√°s efectivo de protecci√≥n contra vulnerabilidades en objetos incrustados en documentos de Office es <b>el modo de visualizaci√≥n protegida</b> .  En este modo, se excluyen tanto la carga de objetos como la carga de datos de fuentes externas.  Desafortunadamente, la transici√≥n a un modo con todas las funciones requiere acciones elementales del usuario que son f√°cilmente provocadas por los m√©todos de ingenier√≠a social. <br><br><img src="https://habrastorage.org/webt/4r/7l/x_/4r7lx_il1btctygcoor7a9gmvwc.png"><br><br>  Los controles ActiveX se pueden <b>deshabilitar en la configuraci√≥n del Centro de confianza</b> <br><br><img src="https://habrastorage.org/webt/bf/ev/ol/bfevolvqahqwt-6slndlob7phxq.png"><br><br>  Tenga en cuenta que esto no funciona para los elementos en l√≠nea OLE. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423933/">https://habr.com/ru/post/es423933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423921/index.html">10 a√±os de Android: recuerda todo</a></li>
<li><a href="../es423923/index.html">SAP Leonardo Hackathon de velcom y SAP para desarrolladores de Bielorrusia</a></li>
<li><a href="../es423925/index.html">Abrir webinar "Plantilla recursiva extra√±a"</a></li>
<li><a href="../es423927/index.html">10 motores de b√∫squeda prometedores para mejorar el SEO</a></li>
<li><a href="../es423931/index.html">¬øC√≥mo omitir la autenticaci√≥n por SMS cuando se conecta a redes Wi-Fi p√∫blicas?</a></li>
<li><a href="../es423935/index.html">Embox responde a preguntas populares del festival TechTrain IT</a></li>
<li><a href="../es423937/index.html">Escalada de privilegios de Windows</a></li>
<li><a href="../es423939/index.html">Programaci√≥n din√°mica o dividir y conquistar</a></li>
<li><a href="../es423941/index.html">Informes de iOS mitap Redmadrobot</a></li>
<li><a href="../es423943/index.html">Optimizaci√≥n de precios minoristas fuera de l√≠nea</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>