<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úä üà∂ üë¢ ESET: Nuevos esquemas de entrega de puerta trasera Oceanberg de Cybergroup üíÆ ü§πüèª üåú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En una publicaci√≥n, describiremos c√≥mo el cibergrupo OceanLotus (APT32 y APT-C-00) utiliz√≥ recientemente uno de los exploits p√∫blicos para CVE-2017-11...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ESET: Nuevos esquemas de entrega de puerta trasera Oceanberg de Cybergroup</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/446604/">  En una publicaci√≥n, describiremos c√≥mo el cibergrupo OceanLotus (APT32 y APT-C-00) utiliz√≥ recientemente uno de los exploits p√∫blicos para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CVE-2017-11882</a> , la vulnerabilidad de corrupci√≥n de memoria en Microsoft Office, y c√≥mo el malware grupal proporciona persistencia en sistemas comprometidos sin dejar rastros .  A continuaci√≥n, describimos c√≥mo, desde principios de 2019, el grupo utiliz√≥ archivos autoextra√≠bles para ejecutar el c√≥digo. <br><br>  OceanLotus se especializa en ciberespionaje, con objetivos prioritarios en el sudeste asi√°tico.  Los atacantes falsifican documentos que atraen la atenci√≥n de las v√≠ctimas potenciales para convencerlos de que realicen una puerta trasera y tambi√©n trabajen en el desarrollo de herramientas.  Los m√©todos utilizados para crear se√±uelos var√≠an en diferentes ataques: desde archivos con "doble extensi√≥n", archivos autoextra√≠bles, documentos con macros hasta exploits conocidos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ap/h9/mc/aph9mchsgkupnlpka6cf7g_u13g.jpeg"></div><br><a name="habracut"></a><h2>  Usando un exploit en Microsoft Equation Editor </h2><br>  A mediados de 2018, OceanLotus lanz√≥ una campa√±a con la vulnerabilidad CVE-2017-11882.  Uno de los documentos maliciosos del cibergrupo fue analizado por 360 expertos del Centro de Inteligencia de Amenazas (un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estudio en chino</a> ), incluida una descripci√≥n detallada del exploit.  En la publicaci√≥n a continuaci√≥n, una descripci√≥n general de dicho documento malicioso. <br><br><h3>  Primera etapa </h3><br>  El <code>FW Report on demonstration of former CNRP in Republic of Korea.doc</code> (SHA-1: <code>D1357B284C951470066AAA7A8228190B88A5C7C3</code> ) es similar al mencionado en el estudio anterior.  Es interesante porque apunta a usuarios interesados ‚Äã‚Äãen la pol√≠tica camboyana (CNRP - Partido de Salvaci√≥n Nacional de Camboya, disuelto a fines de 2017).  A pesar de la extensi√≥n .doc, el documento tiene el formato RTF (consulte la figura a continuaci√≥n), contiene c√≥digo basura y tambi√©n est√° distorsionado. <br><br><img src="https://habrastorage.org/webt/a-/gt/6y/a-gt6ylnd0rbyzvs8eecjpi04-a.png"><br>  <i>Figura 1. Basura en RTF</i> <br><br>  A pesar de la presencia de elementos distorsionados, Word abre con √©xito este archivo RTF.  Como se puede ver en la Figura 2, aqu√≠ est√° la estructura EQNOLEFILEHDR con un desplazamiento de 0xC00, seguido del encabezado MTEF y luego la entrada MTEF (Figura 3) para la fuente. <br><br><img src="https://habrastorage.org/webt/oh/ks/tb/ohkstbugzx97wthqqqnrdoo27di.png"><br>  <i>Figura 2. Valores de registro FONT</i> <br><br><img src="https://habrastorage.org/webt/jy/wj/b5/jywjb5bgsixdqywivkc_ndzcgiu.png"><br>  <i>Figura 3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Formato de grabaci√≥n FONT</a></i> <br><br>  Es posible un desbordamiento en el campo de <i>nombre</i> , porque su tama√±o no se verifica antes de copiar.  Un nombre demasiado largo desencadena una vulnerabilidad.  Como se puede ver en el contenido del archivo RTF (desplazamiento 0xC26 en la Figura 2), el b√∫fer se llena con un c√≥digo de shell, seguido de un comando ficticio ( <code>0x90</code> ) y la direcci√≥n de retorno <code>0x402114</code> .  La direcci√≥n es un elemento de di√°logo en <code>EQNEDT32.exe</code> que apunta a una instrucci√≥n <code>RET</code> .  Esto hace que EIP apunte al comienzo del campo de <i>nombre que</i> contiene el shellcode. <br><br><img src="https://habrastorage.org/webt/_9/gf/lo/_9gflo6k9zsefvvnq8jdaqosuua.png"><br>  <i>Figura 4. Inicio de exploit shellcode</i> <br><br>  La direcci√≥n <code>0x45BD3C</code> almacena una variable que se desreferencia hasta que alcanza un puntero a la estructura <code>MTEFData</code> actualmente cargada.  Aqu√≠ est√° el resto del shellcode. <br><br>  El prop√≥sito del c√≥digo de shell es ejecutar el segundo fragmento del c√≥digo de shell incrustado en un documento abierto.  Primero, el c√≥digo fuente intenta encontrar el descriptor de archivo del documento abierto, <code>NtQuerySystemInformation</code> sobre todos los descriptores del sistema ( <code>NtQuerySystemInformation</code> con el argumento <code>SystemExtendedHandleInformation</code> ) y verificando si el <i>PID</i> del descriptor y el <i>PID del</i> proceso <i>WinWord</i> <code>WinWord</code> y si el documento se abri√≥ con la m√°scara de acceso - <code>0x12019F</code> . <br><br>  Para confirmar la detecci√≥n del descriptor correcto (y no el descriptor de otro documento abierto), el contenido del archivo se muestra utilizando la funci√≥n <code>CreateFileMapping</code> , y el c√≥digo de shell verifica si los √∫ltimos cuatro bytes del documento corresponden a " <code>yyyy</code> " (m√©todo de b√∫squeda de huevos).  Tan pronto como se encuentra una coincidencia, el documento se copia en una carpeta temporal ( <code>GetTempPath</code> ) como <code>ole.dll</code> .  Luego se leen los √∫ltimos 12 bytes del documento. <br><br><img src="https://habrastorage.org/webt/w3/lq/xv/w3lqxvqbmerfijoryxi3vkitaao.png"><br>  <i>Figura 5. Marcadores de fin de documento</i> <br><br>  El valor de 32 bits entre los marcadores <code>AABBCCDD</code> y <code>yyyy</code> es el desplazamiento del siguiente <code>AABBCCDD</code> .  Se llama usando la funci√≥n <code>CreateThread</code> .  Extrajo el mismo c√≥digo shell utilizado por OceanLotus antes.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El script de emulaci√≥n de Python que</a> lanzamos en marzo de 2018 todav√≠a funciona para volcar la segunda etapa. <br><br><h3>  Segunda etapa </h3><br><h4>  Recuperaci√≥n de componentes </h4><br>  Los nombres de archivo y directorio se seleccionan din√°micamente.  El c√≥digo selecciona aleatoriamente el nombre de un archivo ejecutable o DLL en <code>C:\Windows\system32</code> .  Luego realiza una solicitud a sus recursos y recupera el campo <code>FileDescription</code> para usarlo como el nombre de la carpeta.  Si esto no funciona, el c√≥digo selecciona aleatoriamente el nombre de la carpeta de los directorios <code>%ProgramFiles%</code> o <code>C:\Windows</code> (de GetWindowsDirectoryW).  Evita el uso de un nombre que pueda entrar en conflicto con los archivos existentes y garantiza que no contenga las siguientes palabras: <code>windows</code> , <code>Microsoft</code> , <code>desktop</code> , <code>system</code> , <code>system32</code> o <code>syswow64</code> .  Si el directorio ya existe, se agrega "NLS_ {6 caracteres}" al nombre. <br><br>  El recurso <code>0x102</code> analiza y los archivos se <code>0x102</code> en <code>%ProgramFiles%</code> o <code>%AppData%</code> , en una carpeta seleccionada al azar.  El tiempo de creaci√≥n cambi√≥ para tener los mismos valores que <code>kernel32.dll</code> . <br><br>  Por ejemplo, aqu√≠ hay una carpeta y una lista de archivos creados seleccionando el archivo ejecutable <code>C:\Windows\system32\TCPSVCS.exe</code> como fuente de datos. <br><br><img src="https://habrastorage.org/webt/px/ls/xq/pxlsxqrz8s0beuxfybxu0cvz8dg.png"><br>  <i>Figura 6. Extracci√≥n de varios componentes.</i> <br><br>  La estructura del recurso <code>0x102</code> en el cuentagotas es bastante complicada.  En pocas palabras, contiene: <br>  - nombres de archivo <br>  - Tama√±o y contenido de los archivos. <br>  - Formato de compresi√≥n ( <code>COMPRESSION_FORMAT_LZNT1</code> utilizado por la funci√≥n <code>RtlDecompressBuffer</code> ) <br><br>  El primer archivo se restablece como <code>TCPSVCS.exe</code> , que es el <code>AcroTranscoder.exe</code> leg√≠timo (seg√∫n <code>FileDescription</code> , SHA-1: <code>2896738693A8F36CC7AD83EF1FA46F82F32BE5A3</code> ). <br><br>  Es posible que haya notado que algunos archivos DLL tienen m√°s de 11 MB.  Esto se debe a que un gran b√∫fer contiguo de datos aleatorios se encuentra dentro del archivo ejecutable.  Es posible que esta sea una forma de evitar la detecci√≥n por parte de algunos productos de seguridad. <br><br><h4>  Persistencia </h4><br>  El recurso <code>0x101</code> en el cuentagotas contiene dos enteros de 32 bits que determinan c√≥mo mantener la persistencia.  El valor del primero indica c√≥mo el malware mantendr√° la persistencia sin derechos de administrador. <br><br><img src="https://habrastorage.org/webt/f6/aw/1x/f6aw1xtjqv-tfril3uzrx_nzstw.png"><br>  <i>Tabla 1. Mecanismo de persistencia sin derechos de administrador</i> <br><br>  El valor del segundo entero indica c√≥mo el malware debe garantizar la persistencia mientras trabaja como administrador. <br><br><img src="https://habrastorage.org/webt/db/p2/em/dbp2embzyazeoxdnk8h6uji9lm4.png"><br>  <i>Tabla 2. Mecanismo de persistencia con derechos de administrador</i> <br><br>  Un nombre de servicio es un nombre de archivo sin extensi√≥n;  el nombre para mostrar es el nombre de la carpeta, pero si ya existe, se le agrega la cadena " <code>Revision 1</code> " (el n√∫mero aumenta hasta que se encuentra un nombre no utilizado).  Los operadores se aseguraron de que la persistencia a trav√©s del servicio fuera estable; en caso de falla, el servicio deber√≠a reiniciarse despu√©s de 1 segundo.  Luego, el valor <code>WOW64</code> de la nueva clave de registro del servicio se establece en 4, lo que indica que es un servicio de 32 bits. <br><br>  La tarea programada se crea a trav√©s de varias interfaces COM: <code>ITaskScheduler</code> , <code>ITask</code> , <code>ITaskTrigger</code> , <code>IPersistFile</code> e <code>ITaskScheduler</code> .  En esencia, el programa malicioso crea una tarea oculta, establece la informaci√≥n de la cuenta junto con informaci√≥n sobre el usuario o administrador actual, y luego establece el desencadenante. <br><br>  Esta es una tarea diaria con una duraci√≥n de 24 horas e intervalos entre dos ejecuciones de 10 minutos, lo que significa que se realizar√° de forma continua. <br><br><h4>  Parte maliciosa </h4><br>  En nuestro ejemplo, el archivo ejecutable <code>TCPSVCS.exe</code> ( <code>AcroTranscoder.exe</code> ) es un software leg√≠timo que descarga archivos DLL que se descargan con √©l.  En este caso, <code>Flash Video Extension.dll</code> es de inter√©s. <br><br>  Su funci√≥n <code>DLLMain</code> simplemente llama a otra funci√≥n.  Algunos predicados difusos est√°n presentes: <br><br><img src="https://habrastorage.org/webt/b-/im/fe/b-imfeegcv30g23fj2n9qqowdeu.png"><br>  <i>Figura 7. Predicados difusos</i> <br><br>  Despu√©s de estas comprobaciones enga√±osas, el c√≥digo recibe la secci√≥n <code>TCPSVCS.exe</code> archivo <code>TCPSVCS.exe</code> , cambia su protecci√≥n a <code>PAGE_EXECUTE_READWRITE</code> y la sobrescribe, agregando instrucciones ficticias: <br><br><img src="https://habrastorage.org/webt/dp/e7/fn/dpe7fnpq2lrioo0i15ki742mhro.png"><br>  <i>Figura 8. La secuencia de instrucciones</i> <br><br>  Al final, la instrucci√≥n <code>CALL</code> se agrega a la direcci√≥n de la funci√≥n <code>FLVCore::Uninitialize(void)</code> exportada por <code>Flash Video Extension.dll</code> .  Esto significa que despu√©s de cargar la DLL maliciosa, cuando el tiempo de ejecuci√≥n llama a <code>WinMain</code> en <code>TCPSVCS.exe</code> , el puntero de la instrucci√≥n apuntar√° a NOP, lo que resultar√° en llamar a <code>FLVCore::Uninitialize(void)</code> , el siguiente paso. <br><br>  La funci√≥n simplemente crea un mutex que comienza con <code>{181C8480-A975-411C-AB0A-630DB8B0A221}</code> seguido del nombre de usuario actual.  Luego lee el archivo volcado con la extensi√≥n * .db3, que contiene c√≥digo independiente de la posici√≥n, y usa <code>CreateThread</code> para ejecutar el contenido. <br><br>  El contenido del archivo * .db3 es el c√≥digo shell utilizado com√∫nmente por el grupo OceanLotus.  Una vez m√°s, desempacamos con √©xito su carga √∫til utilizando el script de emulador que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicamos en GitHub</a> . <br><br>  El gui√≥n recupera la etapa final.  Este componente es una puerta trasera que ya analizamos en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estudio anterior de OceanLotus</a> .  Esto puede determinarse por el GUID <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}</code> archivo binario.  La configuraci√≥n de malware todav√≠a est√° encriptada en el recurso PE.  Tiene aproximadamente la misma configuraci√≥n, pero los servidores C&amp;C son diferentes de los anteriores: <br><br> <code>- andreagahuvrauvin[.]com <br> - byronorenstein[.]com <br> - stienollmache[.]xyz</code> <br> <br>  OceanLotus nuevamente demuestra una combinaci√≥n de diferentes t√©cnicas para evitar la detecci√≥n.  Regresaron con un esquema "refinado" del proceso de infecci√≥n.  Al elegir nombres aleatorios y completar archivos ejecutables con datos aleatorios, reducen el n√∫mero de IoC de confianza (en funci√≥n de hashes y nombres de archivos).  Adem√°s, gracias al uso de la carga de <code>AcroTranscoder</code> DLL de terceros, los atacantes solo necesitan eliminar el binario leg√≠timo <code>AcroTranscoder</code> . <br><br><h2>  Archivos autoextra√≠bles </h2><br>  Despu√©s de los archivos RTF, el grupo cambi√≥ a archivos de extracci√≥n autom√°tica (SFX) con iconos de documentos comunes para confundir a√∫n m√°s al usuario.  Esto fue escrito por Threatbook ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace en chino</a> ).  Despu√©s de comenzar, se descargan los archivos RAR autoextra√≠bles y se ejecutan las DLL con la extensi√≥n .ocx, cuya carga final se document√≥ previamente <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> .  Desde mediados de enero de 2019, OceanLotus ha reutilizado esta t√©cnica, pero con el tiempo, algunas configuraciones han cambiado.  En esta secci√≥n hablaremos sobre tecnolog√≠a y cambios. <br><br><h4>  Creaci√≥n de cebo </h4><br>  El documento <code>THICH-THONG-LAC-HANH-THAP-THIEN-VIET-NAM (1).EXE</code> (SHA-1: <code>AC10F5B1D5ECAB22B7B418D6E98FA18E32BBDEAB</code> ) se encontr√≥ por primera vez en 2018.  Este archivo SFX fue creado sabiamente: la descripci√≥n ( <i>Informaci√≥n de la versi√≥n</i> ) dice que esta es una imagen JPEG.  El script SFX es el siguiente: <br><br><img src="https://habrastorage.org/webt/i7/tg/nz/i7tgnzif_wi8kcy7g3liki3la4e.png"><br>  <i>Figura 9. Comandos SFX</i> <br><br>  El malware restablece <code>{9ec60ada-a200-4159-b310-8071892ed0c3}.ocx</code> (SHA-1: <code>EFAC23B0E6395B1178BCF7086F72344B24C04DCC</code> ), as√≠ como la imagen <code>2018 thich thong lac.jpg.</code> <br><br>  La imagen del cebo es la siguiente: <br><br><img src="https://habrastorage.org/webt/x2/xh/sn/x2xhsnoscn9jdpm_phc4x5bms4q.jpeg"><br>  <i>Figura 10. La imagen del cebo</i> <br><br>  Es posible que haya notado que las dos primeras l√≠neas del script SFX llaman al archivo OSX dos veces, pero esto no es un error. <br><br><h4>  {9ec60ada-a200-4159-b310-8071892ed0c3} .ocx (ShLd.dll) </h4><br>  El flujo de control de archivos OSX es muy similar a otros componentes de OceanLotus: hay muchas secuencias de <code>JZ/JNZ</code> y <code>PUSH/RET</code> alternan con c√≥digo basura. <br><br><img src="https://habrastorage.org/webt/hs/1j/yd/hs1jydni8wxcqylyvtvimc7_ckm.png"><br>  <i>Figura 11. C√≥digo ofuscado</i> <br><br>  Despu√©s de filtrar el c√≥digo basura, la exportaci√≥n <code>DllRegisterServer</code> llamada por <code>regsvr32.exe</code> ve as√≠: <br><br><img src="https://habrastorage.org/webt/qh/r3/ws/qhr3ws_knbm_pewxrzsqhrpzggi.png"><br>  <i>Figura 12. C√≥digo de instalador b√°sico</i> <br><br>  De hecho, la primera vez que <code>DllRegisterServer</code> llama a <code>DllRegisterServer</code> exportaci√≥n establece el valor de registro <code>HKCU\SOFTWARE\Classes\CLSID\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\Model</code> para el desplazamiento cifrado en la DLL ( <code>0x10001DE0</code> ). <br><br>  Cuando una funci√≥n se llama por segunda vez, lee el mismo valor y se ejecuta en esa direcci√≥n.  A partir de aqu√≠, se lee y ejecuta un recurso y muchas acciones en RAM. <br><br>  El shellcode es el mismo cargador PE utilizado en campa√±as OceanLotus anteriores.  Se puede emular usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuestro script</a> .  Como resultado, <code>db293b825dcc419ba7dc2c49fa2757ee.dll</code> , lo carga en la memoria y ejecuta <code>DllEntry</code> . <br><br>  La DLL extrae el contenido de su recurso, lo descifra (AES-256-CBC) y lo descomprime (LZMA).  El recurso tiene un formato espec√≠fico que es f√°cil de descompilar. <br><br><img src="https://habrastorage.org/webt/ge/l4/ss/gel4ssv32blxwcjjlxkc57g0vie.png"><br>  <i>Figura 13. Estructura de configuraci√≥n del instalador (KaitaiStruct Visualizer)</i> <br><br>  La configuraci√≥n se establece expl√≠citamente: seg√∫n el nivel de privilegio, los datos binarios se escribir√°n en <code>%appdata%\Intel\logs\BackgroundUploadTask.cpl</code> o <code>%windir%\System32\BackgroundUploadTask.cpl</code> (o <code>SysWOW64</code> para sistemas de 64 bits). <br><br>  La persistencia se garantiza creando una tarea llamada <code>BackgroundUploadTask[junk].job</code> , donde <code>[junk]</code> es un conjunto de bytes <code>0x9D</code> y <code>0xA0</code> . <br><br>  El nombre de la aplicaci√≥n de la tarea es <code>%windir%\System32\control.exe</code> , y el valor del par√°metro es la ruta al archivo binario descargado.  La tarea oculta se ejecuta todos los d√≠as. <br><br>  Estructuralmente, el archivo CPL es una DLL con el nombre interno <code>ac8e06de0a6c4483af9837d96504127e.dll</code> , que exporta la funci√≥n <code>CPlApplet</code> .  Este archivo descifra su √∫nico recurso <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> , luego carga esta DLL y llama a su √∫nica exportaci√≥n <code>DllEntry</code> . <br><br><h4>  Archivo de configuraci√≥n de puerta trasera </h4><br>  La configuraci√≥n de puerta trasera est√° encriptada e incrustada en sus recursos.  La estructura del archivo de configuraci√≥n es muy similar a la anterior. <br><br><img src="https://habrastorage.org/webt/as/2f/c8/as2fc8ivbc6_bku2pjs5h-6_qtw.png"><br>  <i>Figura 14. Estructura de configuraci√≥n de puerta trasera (KaitaiStruct Visualizer)</i> <br><br>  A pesar de la estructura similar, los valores de muchos campos se actualizaron en comparaci√≥n con los datos proporcionados en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuestro informe anterior</a> . <br><br>  El primer elemento de la matriz binaria contiene la DLL ( <code>HttpProv.dll</code> MD5: <code>2559738D1BD4A999126F900C7357B759</code> ) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">identificada por Tencent</a> .  Pero como el nombre de exportaci√≥n se ha eliminado del binario, los hashes no coinciden. <br><br><h3>  Investigaci√≥n adicional </h3><br>  Recolectando muestras, llamamos la atenci√≥n sobre algunas caracter√≠sticas.  La muestra que acabamos de describir apareci√≥ alrededor de julio de 2018, y otras similares recientemente, a mediados de enero y principios de febrero de 2019.  Se utiliz√≥ un archivo SFX como vector de infecci√≥n, volcando un documento de cebo leg√≠timo y un archivo OSX malicioso. <br><br>  Aunque OceanLotus utiliza marcas de tiempo falsas, notamos que las marcas de tiempo de los archivos SFX y OCX son siempre las mismas ( <code>0x57B0C36A</code> (14/08/2016 a las 7:15 pm UTC) y <code>0x498BE80F</code> (06/02/2009 a las 7:34 am UTC ) respectivamente).  Esto probablemente indica que los autores tienen un cierto "constructor" que usa las mismas plantillas y simplemente cambia algunas caracter√≠sticas. <br><br>  Entre los documentos que hemos estudiado desde principios de 2018, hay varios nombres que indican los pa√≠ses de inter√©s del ataque: <br><br>  <i>- La nueva informaci√≥n de contacto de Cambodia Media (New) .xls.exe</i> <i><br></i>  <i>- ÊùéÂª∫ È¶ô (‰∏™‰∫∫ ÁÆÄÂéÜ) .exe (documento pdf falso de un CV)</i> <i><br></i>  <i>- Comentarios, Rally en EE. UU. del 28 al 29 de julio de 2018.exe</i> <br><br>  Desde el descubrimiento de la puerta trasera <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> y la publicaci√≥n de su an√°lisis por parte de varios investigadores, hemos observado algunos cambios en los datos de configuraci√≥n del malware. <br><br>  Primero, los autores comenzaron a eliminar nombres de DLL DLL auxiliares ( <code>DNSprov.dll</code> y dos versiones de <code>HttpProv.dll</code> ).  Luego, los operadores dejaron de empaquetar la tercera DLL (la segunda versi√≥n de <code>HttpProv.dll</code> ), eligiendo incrustar solo una. <br><br>  En segundo lugar, se cambiaron muchos campos de configuraci√≥n de puerta trasera, probablemente para evitar la detecci√≥n, ya que muchos IoC estuvieron disponibles.  Entre los campos importantes modificados por los autores est√°n los siguientes: <br><br><ul><li>  La clave de registro de AppX cambi√≥ (ver IoC) </li><li>  cadena de codificaci√≥n mutex ("def", "abc", "ghi") </li><li>  n√∫mero de puerto </li></ul><br>  Finalmente, en todas las nuevas versiones analizadas, los nuevos C&amp;C se enumeran en la secci√≥n IoC. <br><br><h2>  Conclusiones </h2><br>  OceanLotus contin√∫a evolucionando.  El cybergroup se centra en el refinamiento y la expansi√≥n de herramientas y se√±uelos.  Los autores enmascaran cargas maliciosas con la ayuda de documentos llamativos que son relevantes para las presuntas v√≠ctimas.  Desarrollan nuevos dise√±os y tambi√©n usan herramientas disponibles p√∫blicamente, como el exploit del Editor de ecuaciones.  Adem√°s, son herramientas de perfeccionamiento para reducir la cantidad de artefactos que quedan en las m√°quinas de las v√≠ctimas, reduciendo as√≠ la posibilidad de detecci√≥n por software antivirus. <br><br><h2>  Indicadores de compromiso </h2><br>  Los indicadores de compromiso, as√≠ como los atributos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MITER</a> ATT y CK est√°n disponibles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en Welivesecurity</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/446604/">https://habr.com/ru/post/446604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446588/index.html">Comprobaci√≥n del c√≥digo fuente de Roslyn</a></li>
<li><a href="../446590/index.html">39 nuevas funciones estar√°n disponibles en Java 12</a></li>
<li><a href="../446592/index.html">Comprobando el c√≥digo fuente de Roslyn</a></li>
<li><a href="../446598/index.html">Recreando Fuentes CRT</a></li>
<li><a href="../446602/index.html">Corriente DC m√°xima a trav√©s del transistor de efecto de campo</a></li>
<li><a href="../446606/index.html">Comprueba lo bueno que eres en tecnolog√≠a aditiva</a></li>
<li><a href="../446608/index.html">Superando la Tercera Ley de Gravedad Organizacional</a></li>
<li><a href="../446612/index.html">En el momento en que empezamos a creer en la innovaci√≥n.</a></li>
<li><a href="../446616/index.html">C√≥mo creamos FaaS en la nube dentro de Kubernetes y ganamos en Tinkoff Hackathon</a></li>
<li><a href="../446620/index.html">DataGrip 2019.1: soporte para nuevas bases de datos, scripts de inicializaci√≥n, nuevas inspecciones y m√°s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>