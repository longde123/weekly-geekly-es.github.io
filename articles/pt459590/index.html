<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ç üë©üèæ‚Äçüî¨ üõ¢Ô∏è Programa de afiliados de c√≥digo aberto descentralizado na blockchain Waves üèüÔ∏è üé≤ üõ£Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um programa de afiliados descentralizado no blockchain Waves, implementado como parte de uma concess√£o do Waves Labs pela equipe Bettex. 

 A postagem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Programa de afiliados de c√≥digo aberto descentralizado na blockchain Waves</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459590/">  Um programa de afiliados descentralizado no blockchain Waves, implementado como parte de uma concess√£o do Waves Labs pela equipe Bettex. <br><br><div class="spoiler">  <b class="spoiler_title">A postagem n√£o est√° anunciando</b> <div class="spoiler_text">  !  O programa √© de c√≥digo aberto, seu uso e distribui√ß√£o s√£o gratuitos.  A aplica√ß√£o do programa estimula o desenvolvimento de aplicativos dApp e geralmente promove a descentraliza√ß√£o, o que √© ben√©fico para todos os usu√°rios da rede. <br></div></div><br><img src="https://habrastorage.org/webt/hn/xm/xk/hnxmxkdtj1phll6cwjyceneyczg.jpeg" alt="imagem"><br><a name="habracut"></a><br>  Introduzido pelo dApp para programas afiliados √© um modelo para projetos que incluem afiliados como parte de sua funcionalidade.  O c√≥digo pode ser usado como um modelo para copiar, como uma biblioteca ou como um conjunto de id√©ias para implementa√ß√£o t√©cnica. <br><br>  Em termos de funcionalidade, este √© um sistema afiliado regular que implementa o registro com um referenciador, acumula√ß√£o em v√°rios n√≠veis de recompensas por refer√™ncias e motiva√ß√£o para o registro no sistema (reembolso).  O sistema √© dApp "puro", ou seja, o aplicativo da web interage diretamente com o blockchain sem seu back-end, banco de dados, etc. <br><br>  S√£o usadas t√©cnicas que tamb√©m podem ser √∫teis em muitos outros projetos: <br><br><ul><li>  Ligar para uma conta inteligente com cr√©dito e com reembolso imediato (no momento da liga√ß√£o, n√£o h√° tokens na conta para pagar pela liga√ß√£o, mas eles aparecem l√° como resultado da liga√ß√£o). </li><li>  PoW-captcha - prote√ß√£o contra chamadas automatizadas de alta frequ√™ncia de fun√ß√µes de conta inteligente - um an√°logo do captcha, mas atrav√©s da prova do uso de recursos de computa√ß√£o. </li><li>  Solicita√ß√£o de chaves de dados por modelo. </li></ul><br>  O aplicativo consiste em: <br><br><ul><li>  c√≥digo de conta inteligente no idioma ride4dapps (que, por design, √© mesclado na conta inteligente principal, para a qual voc√™ precisa implementar a funcionalidade de afiliado); </li><li>  js wrappers que implementam o n√≠vel de abstra√ß√£o na API WAVES NODE REST; </li><li>  c√≥digo na estrutura vuejs, que √© um exemplo de uso da biblioteca e do c√≥digo RIDE. </li></ul><br>  N√≥s descrevemos todos esses recursos. <br><br>  <b>Ligue para uma conta inteligente com cr√©dito com reembolso imediato</b> <br><br>  As chamadas InvokeScript exigem uma taxa da conta inicial da transa√ß√£o.  Isso n√£o √© um problema se voc√™ estiver executando um projeto para geeks de blockchain que tenham alguns tokens WAVES em sua conta, mas se o produto for voltado para uso amplo, isso se tornar√° um problema s√©rio.  Afinal, o usu√°rio deve cuidar da compra de tokens WAVES (ou outro ativo adequado com o qual voc√™ pode pagar por transa√ß√µes), o que aumenta o limite j√° consider√°vel para a entrada no projeto.  Podemos distribuir ativos aos usu√°rios, o que nos permitir√° pagar pelas transa√ß√µes e enfrentar o risco de uso indevido quando sistemas automatizados s√£o criados para bombear ativos l√≠quidos de nosso sistema. <br><br>  Seria muito conveniente se fosse poss√≠vel fazer a chamada do InvokeScript "√†s custas do destinat√°rio" (a conta inteligente na qual o script est√° instalado), e essa possibilidade, embora n√£o de maneira √≥bvia, existe. <br><br>  Se voc√™ executar ScriptTransfer dentro do InvokeScript no endere√ßo do chamador, que compensa os tokens gastos com taxa, essa chamada ser√° bem-sucedida, mesmo se n√£o houver ativos na conta de chamada no momento da chamada.  Isso √© poss√≠vel devido ao fato de que um n√∫mero suficiente de tokens √© verificado depois que uma transa√ß√£o √© chamada, e n√£o antes dela, para que seja poss√≠vel tornar as transa√ß√µes de cr√©dito sujeitas ao seu pagamento imediato. <br><br>  <i>ScriptTransfer (i.caller, i.fee, unit)</i> <br><br>  O c√≥digo abaixo reembolsa a taxa gasta √†s custas da conta inteligente.  Para se proteger contra o uso indevido desse recurso, voc√™ deve verificar se o chamador est√° gastando uma taxa no ativo certo e dentro de limites razo√°veis: <br><br><pre><code class="plaintext hljs">func checkFee(i:Invocation) = { if i.fee &gt; maxFee then throw(‚Äúunreasonable large fee‚Äù) else if i.feeAssetId != unit then throw(‚Äúfee must be in WAVES‚Äù) else true }</code> </pre> <br>  Al√©m disso, a prote√ß√£o contra desperd√≠cio de fundos malicioso e sem sentido exige prote√ß√£o contra chamadas autom√°ticas (PoW-captcha) <br><br>  <b>PoW-captcha</b> <br><br>  A id√©ia de captcha de prova de trabalho n√£o √© nova e j√° foi implementada em v√°rios projetos, incluindo aqueles implementados com base no WAVES.  A ideia √© que, para a a√ß√£o que desperdice os recursos de nosso projeto, o chamador tamb√©m precise gastar seus pr√≥prios recursos, o que torna o ataque √† exaust√£o de recursos bastante caro.  Para uma valida√ß√£o muito f√°cil e de baixo custo de que o remetente da transa√ß√£o resolveu a tarefa PoW, h√° uma verifica√ß√£o do ID da transa√ß√£o: <br><br>  <i>se pegar (toBase58String (i.transactionId), 3)! = "123" e depois jogar ("prova de falha no trabalho")</i> <br><br>  Para realizar uma transa√ß√£o, o chamador deve selecionar esses par√¢metros para que seu c√≥digo base58 (id) inicie em 123, o que corresponde a uma m√©dia de algumas dezenas de segundos de tempo do processador e geralmente √© razo√°vel para a nossa tarefa.  Se for necess√°rio um PoW mais simples ou mais complexo, √© f√°cil refinar a tarefa de maneira √≥bvia. <br><br>  <b>Solicita√ß√£o de chaves de dados por modelo</b> <br><br>  Para usar o blockchain como um banco de dados, √© vital ter ferramentas de API para consultar o banco de dados como modelos de valores-chave.  Esse kit de ferramentas apareceu no in√≠cio de julho de 2019 como o par√¢metro <i>? Matches</i> para a solicita√ß√£o <i>/ endere√ßos / dados da</i> API REST <i>? Matches = regexp</i> .  Agora, se precisarmos obter n√£o uma chave e nem todas as chaves de um aplicativo Web de uma s√≥ vez, mas apenas alguns grupos, poderemos fazer uma sele√ß√£o pelo nome da chave.  Por exemplo, neste projeto, as transa√ß√µes de retirada s√£o codificadas como <br><br><pre> <code class="plaintext hljs">withdraw_${userAddress}_${txid}</code> </pre> <br>  que permite obter uma lista de transa√ß√µes para retirar fundos para qualquer endere√ßo, de acordo com o modelo: <br><br><pre> <code class="plaintext hljs">?matches=withdraw_${userAddress}_.*</code> </pre> <br>  Agora vamos analisar os componentes da solu√ß√£o turnkey. <br><br>  <b>C√≥digo Vuejs</b> <br><br>  O c√≥digo √© uma demonstra√ß√£o funcional pr√≥xima a um projeto real.  Ele implementa o login atrav√©s do Waves Keeper e trabalha com a biblioteca affiliate.js, com a ajuda de que ele registra o usu√°rio no sistema, pesquisa dados de transa√ß√µes e tamb√©m permite que voc√™ retire fundos ganhos para a conta do usu√°rio. <br><br><img src="https://habrastorage.org/webt/ug/dv/e6/ugdve6bg3kaamx7flsyzkaubxma.jpeg" alt="imagem"><br><br>  <b>C√≥digo RIDE</b> <br><br>  Consiste em registrar, financiar e retirar fun√ß√µes. <br><br>  A fun√ß√£o de registro √© registrada no sistema do usu√°rio.  Ele possui dois par√¢metros: referenciador (endere√ßo do referenciador) e o par√¢metro salt, que n√£o √© usado no c√≥digo de fun√ß√£o, necess√°rio para selecionar o ID da transa√ß√£o (tarefa PoW-captcha). <br><br>  A fun√ß√£o (como as outras fun√ß√µes deste projeto) usa a t√©cnica de empr√©stimo, o resultado da fun√ß√£o √© o financiamento de uma taxa para chamar essa fun√ß√£o.  Gra√ßas a essa decis√£o, o usu√°rio que acabou de criar a carteira pode trabalhar imediatamente com o sistema e n√£o precisa se surpreender com a quest√£o de comprar ou receber um ativo que permita pagar uma taxa de transa√ß√£o. <br><br>  O resultado da fun√ß√£o de registro √© duas entradas: <br><br><pre> <code class="plaintext hljs">${owner)_referer = referer ${referer}_referral_${owner} = owner</code> </pre> <br>  Isso permite pesquisas diretas e reversas (referenciador deste usu√°rio e todas as refer√™ncias deste usu√°rio). <br><br>  A fun√ß√£o do fundo provavelmente √© um modelo para o desenvolvimento de funcionalidades reais.  Na forma apresentada, ele pega todos os fundos transferidos pela transa√ß√£o e os distribui para as contas dos referenciadores 1, 2, 3, para a conta "cashback" e a conta "change" (tudo o que resta na distribui√ß√£o para as contas anteriores cai aqui). <br><br>  O reembolso √© um meio de estimular o usu√°rio final a participar do sistema de refer√™ncia.  O usu√°rio pode retirar a parte da comiss√£o paga pelo sistema na forma de "reembolso" da mesma maneira que as recompensas por refer√™ncias. <br><br>  Ao usar o sistema de refer√™ncia, a fun√ß√£o do fundo deve ser modificada, incorporada √† l√≥gica principal da conta inteligente na qual o sistema funcionar√°.  Por exemplo, se a taxa de refer√™ncia for paga pela aposta feita, a fun√ß√£o do fundo deve ser incorporada √† l√≥gica em que a aposta √© feita (ou outra a√ß√£o direcionada √© executada, pela qual a taxa √© paga).  Esta fun√ß√£o codifica tr√™s n√≠veis de recompensas por refer√™ncia.  Se voc√™ precisar fazer mais ou menos n√≠veis, isso tamb√©m ser√° corrigido no c√≥digo.  O percentual de remunera√ß√£o √© definido pelas constantes n√≠vel1-n√≠vel3, no c√≥digo √© considerado como <i>quantidade * n√≠vel / 1000</i> , ou seja, o valor 1 corresponde a 0,1% (isso tamb√©m pode ser alterado no c√≥digo). <br><br>  A chamada de fun√ß√£o altera o saldo da conta e tamb√©m cria entradas com a finalidade de efetuar logon no formul√°rio: <br><br><pre> <code class="1c hljs">fund_address_txid = address:owner:inc:level:timestamp <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  timestamp ( )     func getTimestamp() = { let block = extract(blockInfoByHeight(height)) toString(block.timestamp) }</code> </pre> <br>  Ou seja, o tempo da transa√ß√£o √© o tempo do bloco em que est√° localizado.  Isso √© mais confi√°vel do que usar o carimbo de data / hora da pr√≥pria transa√ß√£o, principalmente porque n√£o √© acess√≠vel a partir de chamada. <br>  A fun√ß√£o de retirada exibe todas as recompensas acumuladas na conta do usu√°rio.  Cria entradas para fins de registro em log: <br><br><pre> <code class="plaintext hljs"># withdraw log: withdraw_user_txid=amount:timestamp</code> </pre> <br>  <b>App</b> <br><br>  A parte principal do aplicativo √© a biblioteca affiliate.js, que √© uma ponte entre os modelos de dados do afiliado e a API REST do WAVES NODE.  Implementa um n√≠vel de abstra√ß√£o independente da estrutura (qualquer um pode ser usado).  As fun√ß√µes ativas (registrar, retirar) assumem que o Waves Keeper est√° instalado no sistema, a pr√≥pria biblioteca n√£o verifica isso. <br><br>  Implementa m√©todos: <br><br><pre> <code class="plaintext hljs">fetchReferralTransactions fetchWithdrawTransactions fetchMyBalance fetchReferrals fetchReferer withdraw register</code> </pre> <br>  A funcionalidade dos m√©todos √© √≥bvia nos nomes, nos par√¢metros e nos dados retornados s√£o descritos no c√≥digo.  A fun√ß√£o de registro requer coment√°rios adicionais - inicia o ciclo de correspond√™ncia do ID da transa√ß√£o para come√ßar em 123 - este √© o PoW-captcha descrito acima, que protege contra registros em massa.  A fun√ß√£o localiza a transa√ß√£o com o ID desejado e a assina atrav√©s do Waves Keeper. <br><br>  O programa de afiliados da DEX est√° dispon√≠vel no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub.com</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt459590/">https://habr.com/ru/post/pt459590/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt459580/index.html">Sistemas telef√¥nicos virtuais</a></li>
<li><a href="../pt459582/index.html">Vis√£o geral: como comprar a√ß√µes de empresas americanas da R√∫ssia</a></li>
<li><a href="../pt459584/index.html">Encontrei um √≥timo programador chamado Steve Wozniak</a></li>
<li><a href="../pt459586/index.html">Garden v0.10.0: Seu laptop n√£o precisa do Kubernetes</a></li>
<li><a href="../pt459588/index.html">N√£o concorde em desenvolver o que voc√™ n√£o entende</a></li>
<li><a href="../pt459592/index.html">Tr√™s dicas de gerenciamento de tempo para quem j√° tentou de tudo.</a></li>
<li><a href="../pt459594/index.html">Leia entre notas: sistema de transfer√™ncia de dados dentro da m√∫sica</a></li>
<li><a href="../pt459596/index.html">iOS Digest No. 9 (28 de junho a 11 de julho)</a></li>
<li><a href="../pt459598/index.html">Perguntas frequentes do SELinux (FAQ)</a></li>
<li><a href="../pt459602/index.html">Incorporamos o int√©rprete Lua no projeto do microcontrolador (stm32)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>