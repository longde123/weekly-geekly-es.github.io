<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ≤Ô∏è üòÉ üõÅ Formation du thermostat: comment c'est arriv√© ü§∞üèª ü§òüèª üôèüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apr√®s plusieurs ann√©es de travail fructueux, il a √©t√© d√©cid√© de pr√©senter au public notre premier produit de climatisation dans une maison intelligent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Formation du thermostat: comment c'est arriv√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474420/"><img src="https://habrastorage.org/webt/hq/ic/rj/hqicrj2h1bv5ytdxhdsxlst1uv0.png"><br><br>  Apr√®s plusieurs ann√©es de travail fructueux, il a √©t√© d√©cid√© de pr√©senter au public notre premier produit de climatisation dans une maison intelligente - un thermostat intelligent pour contr√¥ler un sol chaud. <br><a name="habracut"></a><br><h3>  Quel est cet appareil? </h3><br>  Il s'agit d'un thermostat intelligent pour tout chauffage au sol √©lectrique jusqu'√† 3 kW.  Il est contr√¥l√© via l'application, la page Web, HTTP, MQTT, de sorte qu'il est facilement int√©gr√© dans tous les syst√®mes de maison intelligente.  Pour les plus populaires, nous d√©velopperons des plugins. <br><br>  Vous pouvez contr√¥ler non seulement un chauffage au sol √©lectrique, mais √©galement une t√™te thermique √† un plancher chauffant √† l'eau, une chaudi√®re ou un sauna √©lectrique.  De plus, en utilisant nrf, le thermostat pourra communiquer avec divers capteurs.  Presque tous les capteurs li√©s au climat sont actuellement en d√©veloppement.  √âtant donn√© que l'appareil est bas√© sur ESP, nous avons d√©cid√© qu'il serait inappropri√© de s√©lectionner les options de personnalisation des utilisateurs.  Par cons√©quent, nous ferons en sorte que l'utilisateur puisse transf√©rer l'appareil en mode d√©veloppeur et installer un autre firmware, par exemple, avec prise en charge de HomeKit ou de projets tiers. <br><br>  * Apr√®s avoir install√© un firmware tiers avec prise en charge de HomeKit ou d'autres projets populaires, le retour √† l'original n'est pas possible via OTA (Over-the-Air). <br><cut></cut><br><h3>  Les difficult√©s que nous avons rencontr√©es </h3><br>  Dire qu'ils n'√©taient pas l√† serait idiot.  Je vais essayer de d√©crire les probl√®mes les plus difficiles qui sont apparus et comment nous les avons r√©solus. <br><br>  Le bo√Ætier de l'appareil √©tait un d√©fi.  Et le co√ªt des ressources, et le co√ªt du temps (d√©velopp√© environ un an). <br><br>  Il y avait beaucoup d'options sur le march√©.  Et le plus populaire est l'impression 3D.  Estimons: <br>  Impression 3D classique.  La qualit√© est mauvaise, la vitesse de production aussi.  Nous avons utilis√© l'impression 3D pour les prototypes, mais elle n'√©tait pas adapt√©e √† la production. <br><br>  Imprimante 3D photopolym√®re.  Ici, la qualit√© est bien meilleure, mais l'effet prix entre en jeu.  Les prototypes imprim√©s sur une imprimante similaire, pesaient environ 4000 roubles, et c'est une partie du corps de deux.  Vous pouvez acheter votre imprimante, ce qui r√©duira le prix, mais le prix sera toujours l'espace et la vitesse n'est pas satisfaisante. <br><br>  Coul√©e de silicone.  Nous avons consid√©r√© que c'√©tait la meilleure option.  La qualit√© √©tait au niveau, le prix est √©lev√©, mais pas critique.  M√™me le premier lot a √©t√© command√© dans 20 cas pour des essais sur le terrain. <br><br>  Mais tout a chang√© la donne.  Un soir, j'ai accidentellement publi√© dans un chat interne pour les d√©veloppeurs qu'avec les bo√Ætiers un montant, le prix est √©lev√©.  Et le lendemain, un coll√®gue a √©crit dans un message personnel que l'ami de son ami avait du TPA (machine thermoplastique).  Et √† la premi√®re √©tape, vous pouvez lui fabriquer un moule.  Ce message a tout chang√©! <br><br>  J'avais d√©j√† envisag√© l'utilisation du TPA, mais je n'ai m√™me pas √©t√© arr√™t√© par la n√©cessit√© de commander un lot de 5000 pi√®ces minimum (m√™me si si vous pouvez l'essayer, vous pouvez en trouver moins via le chinois).  J'ai √©t√© arr√™t√© par le prix d'un moule.  Environ 5000 $.  Je n'√©tais pas pr√™t √† exposer ce montant imm√©diatement.  Le montant pour le moule par notre coll√®gue nouvellement frapp√© n'√©tait pas cosmique, il variait entre 2000 $ et 2500 $.  De plus, il est all√© nous rencontrer et nous avons convenu que le paiement se ferait par versements.  Le probl√®me avec les cas a donc √©t√© r√©solu. <br><br>  La deuxi√®me difficult√©, tout aussi importante, que nous avons rencontr√©e est le fer. <br><br>  Ne comptez pas le nombre de r√©visions de fer.  Selon des estimations prudentes, l'option pr√©sent√©e est la septi√®me, sans compter les interm√©diaires.  Dans ce document, nous avons essay√© de r√©soudre toutes les lacunes identifi√©es dans le processus de test. <br><br>  Donc, plus t√¥t, je pensais qu'il n'y avait pas besoin d'un chien de garde mat√©riel.  Maintenant, sans lui, l'appareil ne passera pas en s√©rie: en raison du caprice de la plate-forme que nous avons choisie. <br>  Une autre entr√©e analogique pour l'ESP.  Auparavant, je pensais que chaque broche ESP √©tait universelle.  Mais ESP n'a qu'une seule broche analogique.  Apprenez que cela s'est produit dans la pratique, ce qui a conduit √† la modification et √† la r√©organisation des cartes de circuits imprim√©s. <br><br>  <i>La premi√®re version des cartes de circuits imprim√©s</i> <br><br><img src="https://habrastorage.org/webt/t-/hf/9n/t-hf9nry-pzvsm4shzy4fyta_kc.jpeg"><br><br><img src="https://habrastorage.org/webt/ok/d8/w7/okd8w7vazoijv851jztumvoj0w8.png"><br><br>  <i>La deuxi√®me version des cartes de circuits imprim√©s</i> <br><br><img src="https://habrastorage.org/webt/yf/c5/9c/yfc59crkqt9oclmawidome-mwm8.jpeg"><br><br><img src="https://habrastorage.org/webt/1o/wl/j0/1owlj0hbceqg4dbxcqsq94g43su.png"><br><br>  <i>L'avant-derni√®re version des cartes de circuits imprim√©s, o√π j'ai d√ª r√©soudre d'urgence des probl√®mes avec la broche analogique</i> <br><br><img src="https://habrastorage.org/webt/hs/ka/q5/hskaq5caccyx6b9ws6fo8lwysh0.jpeg"><br><br><img src="https://habrastorage.org/webt/px/ek/hp/pxekhp2fjamqqcd3nk3oajbjc-8.jpeg"><br><br>  En ce qui concerne le logiciel, il y avait aussi un tas d'emb√ªches. <br><br>  Par exemple, le lancement p√©riodique d'ESP.  Malgr√© le fait que ping y acc√®de, la page ne s'ouvre pas.  Il n'y a qu'une seule solution - r√©√©crire la biblioth√®que.  Il y en a peut-√™tre d'autres, mais nous avons tous essay√© de ne pas donner de r√©sultat. <br><br>  Le deuxi√®me probl√®me important, curieusement, est le nombre de demandes adress√©es √† ESP lors de l'ouverture d'une page.  En utilisant GET ou ajax, nous avons √©t√© confront√©s au fait que le nombre de demandes est devenu ind√©cemment important.  De ce fait, l'ESP s'est comport√© de mani√®re impr√©visible, il pourrait simplement red√©marrer ou traiter la demande pendant quelques secondes.  La solution √©tait de passer aux sockets Web.  Apr√®s cela, le nombre de demandes a consid√©rablement diminu√©. <br><br>  Le troisi√®me probl√®me est l'interface Web.  Plus d'informations sur lui seront dans un article s√©par√©, qui sera publi√© plus tard. <br><br>  Pour l'instant, je dirai simplement que la meilleure option pour le moment est d'utiliser VUE.JS. <br><br>  Ce framework est le plus adapt√© de tous que nous avons test√©. <br><br>  Les options d'interface peuvent √™tre consult√©es sur les liens ci-dessous. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">adaptive.lytko.com</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mobile.lytko.com</a> <br><br><h3>  Formation du thermostat </h3><br>  Apr√®s avoir surmont√© toutes les difficult√©s, nous sommes arriv√©s au r√©sultat suivant: <br><br><img src="https://habrastorage.org/webt/1r/q5/ai/1rq5aidxmw2b4zsct8rl9y8lhim.png"><br><br><img src="https://habrastorage.org/webt/fj/t8/zd/fjt8zdyi7j829j1yr8w3hps1sna.png"><br><br>  <b>La construction</b> <br><br>  Le thermostat se compose de trois cartes (modules): <br><br><ol><li>  Manager; </li><li>  G√©r√© </li><li>  Panneau d'affichage </li></ol><br>  <b>La</b> carte de <b>commande</b> est la carte sur laquelle se trouvent l'ESP12, le chien de garde mat√©riel et le nRF24 pour fonctionner avec les futurs capteurs.  Au d√©marrage, l'appareil prend en charge le capteur num√©rique DS18B20.  Mais nous avons fourni la possibilit√© de connecter des capteurs analogiques de fabricants tiers.  Et dans l'une des futures mises √† jour logicielles de l'appareil, nous ajouterons la possibilit√© d'utiliser des capteurs fournis avec des thermostats tiers. <br><br><img src="https://habrastorage.org/webt/nr/gf/vm/nrgfvmey1i1qjmiz5zuqbywn4i8.jpeg"><br><br>  <b>G√©r√©</b> - carte de gestion de l'alimentation et de la charge.  Ils ont plac√© un bloc d'alimentation de 750 mA, des bornes pour connecter des capteurs de temp√©rature et des relais de 16 A pour contr√¥ler la charge. <br><br><img src="https://habrastorage.org/webt/s4/ka/o-/s4kao-dmzluqeabuwu1g35kggsg.jpeg"><br><br>  <b>Affichage</b> - au stade du d√©veloppement, nous avons s√©lectionn√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'√©cran Nextion</a> 2,4 pouces. <br><br>  √Ä son sujet, vous pouvez facilement trouver des informations sur Internet.  J'ajouterai moi-m√™me que c'est pratique pour presque tout le monde sauf le prix.  Un √©cran de 2,4 pouces co√ªte environ 1 200 roubles, ce qui n'affecte pas le prix final de la meilleure fa√ßon. <br><br>  Il a donc √©t√© d√©cid√© de faire un analogue de nos besoins, mais √† un prix inf√©rieur.  Certes, il devra √™tre programm√© de mani√®re classique, et non √† partir de l'environnement Nextion Editor.  C'est plus difficile, mais nous y sommes pr√™ts. <br><br>  Un analogue sera une matrice de 2,4 pouces avec un √©cran tactile et une carte avec STM32 √† bord pour le contr√¥ler et r√©duire la charge sur l'ESP12.  Tout le contr√¥le sera similaire √† Nextion par UART, ainsi qu'une m√©moire de 32 Mo et une carte flash compl√®te pour l'enregistrement des journaux. <br><br>  La conception modulaire permet de changer facilement l'un des modules et la sortie est un appareil compl√®tement diff√©rent. <br><br>  Par exemple, il existe d√©j√† des options pour la ¬´carte 2¬ª dans plusieurs versions: <br><br><ul><li>  <b>Option 1</b> - pour le chauffage au sol.  Alimentation √† partir de 220v.  Le relais contr√¥le toute charge apr√®s lui-m√™me. </li><li>  <b>Option 2</b> - pour le chauffage par le sol ou la vanne de batterie.  Aliment√© par 24V AC.  Commande de valve 24v. </li><li>  <b>Option 3</b> - aliment√© par 220v.  Contr√¥le d'une ligne distincte, comme une chaudi√®re ou un sauna √©lectrique. </li></ul><br><h3>  Postface </h3><br>  Je ne suis pas d√©veloppeur professionnel.  J'ai r√©ussi √† unir les gens avec un seul objectif.  Pour la plupart, tout le monde travaille pour l'id√©e;  afin de faire quelque chose de vraiment valable;  ce qui sera utile √† l'utilisateur final. <br><br>  Je suis s√ªr que quelqu'un n'aimera pas la conception de l'√©tui;  quelqu'un - l'apparence de la page.  C'est ton droit!  Mais nous avons fait tout ce chemin nous-m√™mes, en critiquant constamment ce que nous faisons, et surtout - pourquoi.  S'il n'y a pas de questions comme ci-dessus, nous serons heureux de parler dans les commentaires. <br><br>  <b>La critique constructive est bonne, et nous lui en sommes reconnaissants.</b> <br><br>  L'histoire de l'id√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Pour les personnes int√©ress√©es: <br><br><ol><li>  Pour toutes questions: groupe dans Telegram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LytkoG</a> </li><li>  Suivez l'actualit√©: Telegram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lytko News</a> news channel </li></ol><br>  Et oui, nous devenons hauts sur ce que nous faisons. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr474420/">https://habr.com/ru/post/fr474420/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr474404/index.html">Analyse des probl√®mes r√©solus du championnat de programmation de Yandex (d√©veloppement front-end) 2019</a></li>
<li><a href="../fr474406/index.html">La premi√®re apparition de BlueKeep √† l'√©tat sauvage enregistr√©e</a></li>
<li><a href="../fr474408/index.html">R√©volution ou √©volution du mod√®le objet page?</a></li>
<li><a href="../fr474414/index.html">Nous √©crivons notre propre moteur voxel</a></li>
<li><a href="../fr474418/index.html">Conf√©rence DEFCON 27. B√©n√©ficier des produits de piratage pour macOS. Partie 1</a></li>
<li><a href="../fr474422/index.html">Des plateformes open source passionnantes pour le d√©veloppement d'applications mobiles</a></li>
<li><a href="../fr474424/index.html">Formation mixte - qu'est-ce que c'est et comment √ßa marche</a></li>
<li><a href="../fr474426/index.html">La s√©rie anim√©e "Cercle math√©matique"</a></li>
<li><a href="../fr474430/index.html">DevOpsDays Moscou - une conf√©rence que la communaut√© organise pour la communaut√©</a></li>
<li><a href="../fr474434/index.html">Propre bot Telegram pour suivre la disponibilit√© de ses serveurs en python et docker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>