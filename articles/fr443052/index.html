<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📿 👨🏼‍🚀 👛 Belle montre précise d'un vieux smartphone 👩‍🚀 🐙 🤴🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'article se concentrera sur la façon de refaire un vieux téléphone mobile inutile dans d'excellentes horloges murales avec de grands nombres, une heu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Belle montre précise d'un vieux smartphone</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443052/"><img src="https://habrastorage.org/webt/v3/zb/xe/v3zbxe4oreekk9jb1bdtkraqdcu.jpeg"><br><br>  L'article se concentrera sur la façon de refaire un vieux téléphone mobile inutile dans d'excellentes horloges murales avec de grands nombres, une heure toujours précise et une alimentation de secours. <br><br>  Je vais parler de certaines des fonctionnalités clarifiées de la synchronisation de l'heure dans le système d'exploitation Android, ainsi que de diverses astuces électriques dans le système d'alimentation du smartphone.  Je vais décrire un exemple de circuit sur des composants analogiques simples qui fournit une alimentation de secours automatique.  Et bien sûr, nous parlerons de la partie logicielle d'Android - comment et avec quelle aide vous pouvez créer une belle montre pour tous les goûts à partir de votre smartphone. <br><a name="habracut"></a><br>  ( <i>Avertissement traditionnel - les marques, marques déposées, etc. mentionnées ne sont pas de la publicité, j'espère que cela est clair.</i> ) <br><br><h4>  La seconde vie d'un vieux smartphone </h4><br>  Mon ancien Philips Xenium W732 était resté inactif pendant longtemps.  Fonctionne pleinement, avec un plein écran.  J'ai décidé de lui donner une seconde vie - transformée en horloge murale.  Ma vieille horloge domestique, toujours soviétique, avec de petits chiffres vacillants était très difficile à voir à quelques mètres.  De plus, ils étaient terriblement à la traîne, ils devaient être abattus de temps en temps, avec toute perte d'électricité dans la maison, ils étaient complètement réinitialisés et nécessitaient une procédure fastidieuse de pousser les boutons et de régler l'heure à nouveau.  Tout cela me fatiguait depuis longtemps, et j'ai décidé de fabriquer une bonne montre «intelligente», dépourvue de tous ces défauts, à partir de l'ancien téléphone portable. <br><br><h4>  Ce dont j'avais besoin </h4><br><ol><li>  Grands nombres clairs de n'importe quelle couleur, police et luminosité souhaitées. </li><li>  Précision et stabilité maximales sans aucune intervention extérieure de ma part. </li><li>  Non-volatilité, c'est-à-dire  La montre devrait continuer à fonctionner pendant les pannes de courant temporaires. </li><li>  Travail entièrement autonome, dans le sens de - sans utiliser de réseaux de données payants, de cartes SIM, d'opérateurs, etc. </li><li>  Respect maximum du principe du «fait, allumé et oublié».  C'est-à-dire qu'un appareil ne devrait jamais nécessiter de maintenance ni aucun autre type d'interaction. </li></ol><br><h4>  Nous fournissons à Android l'heure exacte. </h4><br>  La première chose à faire était d'obtenir une heure mondiale constamment précise sur votre smartphone.  Le concept «exact» pour moi s'inscrit dans 1 ... 2 secondes de déviation par rapport au monde. <br><br>  Il est clair que la minuterie du système du téléphone portable ne donnera pas une telle stabilité, elle n’est pas exigée de lui.  Par conséquent, la conformité garantie avec l'heure mondiale ne peut être obtenue que par une synchronisation externe régulière. <br><br>  Dans le cas le plus simple sous Android, il peut être configuré à l'aide de la méthode "réseau".  De plus, même un réseau cellulaire avec des cartes SIM et des paiements tarifaires inévitables ne sera pas nécessaire.  Il suffit de distribuer le Wi-Fi domestique au smartphone et de configurer le routeur pour synchroniser l'heure à partir du fournisseur Internet ou du serveur ntp. <br><br>  Cependant, il existe une deuxième méthode de synchronisation - pour les satellites GPS, que je pense personnellement meilleure. <br><br>  Des pros - vous pouvez synchroniser n'importe où dans le monde où le ciel est visible.  Précision absolue du temps, car le GPS lui-même est basé sur cela.  L'absence de canaux radio supplémentaires et d'émissions supplémentaires. <br><br>  Des lacunes du GPS - l'appareil devrait voir au moins un peu de ciel ouvert.  Très probablement, rien ne sera pris dans un endroit arbitraire à l'arrière de la pièce, surtout si l'appareil a une puce ancienne et insensible.  Et comme ma montre était située exactement à l'écart de la fenêtre, j'avais besoin d'une antenne GPS à distance ... <br><br><h4>  L'antenne externe la plus simple pour la réception GPS </h4><br>  Sur Internet, tout s'est avéré plutôt serré sur ce sujet.  J'ai immédiatement réalisé que je ne pouvais pas fabriquer une telle antenne moi-même - des conceptions élaborées et encombrantes avec des calculs compliqués compliqués étaient proposées partout.  J'ai essayé de trouver un achat - je n'ai pas non plus tout aimé.  Certains sont tous grands, maladroits, nécessitant une alimentation externe, avec un tas de fonctionnalités inutiles et en même temps insuffisamment coûteux. <br><br>  La solution a été trouvée par hasard - j'ai en quelque sorte vu la description d'une antenne de type "dipôle demi-onde".  Dans sa conception la plus simple, il s'agit simplement d'un morceau de fil droit d'une longueur égale à la moitié de la longueur d'onde du signal souhaité.  Cette «complexité» de construction me convenait tout à fait, alors je viens de prendre le premier coaxial avec une impédance d'onde arbitraire et de le souder doucement au smartphone sur les contacts correspondants de l'antenne patch GPS. <br><br><div class="spoiler">  <b class="spoiler_title">Photo des contacts de l'antenne GPS sur la carte W732</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/nn/em/ci/nnemci1spx4laynkv4kd_fe_syy.jpeg"><br>  <i>La tresse et le noyau central du coaxial sont soudés à ces contacts</i> <br></div></div><br>  Je viens de libérer l'autre extrémité du câble de la tresse de l'écran pour qu'il reste un noyau central de 95 mm de longueur - c'est la moitié de la longueur d'onde à la fréquence L1 du signal GPS standard (1575,42 MHz). <br><br><div class="spoiler">  <b class="spoiler_title">L'antenne GPS la plus simple.</b>  <b class="spoiler_title">Dipôle demi-onde</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/as/a2/yk/asa2yk0mwvmd034n7maxcwsexkq.jpeg"><br>  <i>Cette antenne doit être placée le plus près possible de la fenêtre.</i> <i><br></i>  <i>Je l'ai collé au verre avec du ruban adhésif.</i> <i><br></i> </div></div><br>  Le téléphone l'a éloigné de la fenêtre et, d'autre part, l'extrémité dénudée du fil de 95 mm l'a amené à la fenêtre pour qu'il puisse voir plus du ciel. <br><br>  Et donc - Philips a rapidement capturé ses 5 ... 7 satellites honnêtes et réparé!  L'antenne fonctionne! <br><br>  Et je m'inquiétais toujours de la coordination des impédances d'ondes du câble, de l'antenne et du récepteur, qui était censée être nécessaire dans de tels cas, avec lesquelles j'étais saupoudré de cervelle sur Internet lors des forums d'antennes.  Plus tard, j'ai découvert qu'une telle coordination des résistances était nécessaire pour obtenir simplement le maximum d'efficacité de la ligne de transmission (absence de réflexions finales et atténuation excessive).  Et si la ligne n'est que de 2 ... 3 mètres, comme la mienne, et que la tâche consiste simplement à fournir au moins une partie du signal au récepteur, alors vous ne devriez pas du tout penser à cette coordination - tout fonctionnera avec n'importe quel coaxial. <br><br><h4>  Caractéristiques du processus de synchronisation GPS </h4><br>  Après avoir reçu un GPS fonctionnel, j'ai bien sûr immédiatement défini la méthode de synchronisation de l'heure «sur les satellites GPS» dans les paramètres Android et laissé le téléphone dans cet état pour vérification.  Quelle a été ma surprise quand quelques heures plus tard, le temps passé sur le téléphone s'est considérablement «séparé» de l'horloge de contrôle de l'ordinateur (où Windows est synchronisé en ntp).  J'ai commencé à découvrir la raison ... Il s'est avéré que l'androïde, configuré pour synchroniser l'heure via GPS, n'effectue cette synchronisation qu'une seule <i>fois - au moment de fixer les coordonnées</i> . <br>  Et puis, même si le smartphone continue de surveiller en continu les satellites, l'heure de son système n'est toujours déterminée que par le générateur interne, c'est-à-dire qu'il n'y a pas de synchronisation du tout!  Au moins dans mon Philips Android 4.0.3, tout se passe de cette façon. <br><br>  Pour moi, c'était une mauvaise surprise.  Je ne continuerai pas à tirer le GPS manuellement pour mettre à jour l'heure exacte ... <br><br>  La solution a été trouvée un logiciel.  J'utilise le programme Locus du logiciel Asamm pour la navigation, dans lequel il est possible de configurer une maintenance GPS non constante à l'état actif, mais des corrections ponctuelles périodiques de coordonnées à des intervalles donnés, c'est exactement ce dont j'avais besoin.  J'ai réglé l'intervalle à 15 minutes et le problème a disparu en toute sécurité - l'heure dans le téléphone mobile depuis lors coïncide toujours clairement avec le monde!  Pendant 15 minutes, la minuterie système de tout smartphone normal n'accumulera pas une erreur de temps de plus de 1 ... 2 secondes, ce qui me convient parfaitement.  Si vous le souhaitez, vous pouvez réparer par temps chaud au moins toutes les dix secondes. <br><br><h4>  Restauration d'un smartphone fixe </h4><br>  Après l'heure exacte, c'était au tour de faire un régime compétent pour ma montre. <br><br>  Comme je l'ai déjà mentionné, j'avais besoin que l'horloge ne s'éteigne pas et ne passe pas à zéro lors de coupures de courant à court terme dans la maison, ce qui, bien que rare, se produit. <br><br>  La première solution, la plus maladroite ici, consiste à brancher bêtement le smartphone dans une prise de courant et à le laisser de cette façon.  En effet, en même temps, le problème des coupures de courant est parfaitement résolu - le téléphone portable passera simplement à une batterie, qui sera toujours complètement chargée et prête à l'emploi.  Aussitôt dit, aussitôt fait.  Connecté ... Une semaine s'est écoulée, la seconde - je commençais déjà à me réjouir ... Et le troisième, un beau jour, il y a eu un coup, et la batterie a volé joyeusement du téléphone au milieu de la pièce, gonflée par une pression interne à l'état de la balle. <br><br><div class="spoiler">  <b class="spoiler_title">Batterie standard Phillips</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/p7/e6/oj/p7e6ojfzrl_xu9egovxblz_l6mi.jpeg"><br>  <i>Ceci est son état normal.</i>  <i>Plat et dur ...</i> <i><br></i> </div></div><br>  Comme vous le savez, j'ai même eu de la chance que les coutures du boîtier de la batterie ne puissent pas résister et n'auraient pas été ouvertes, sinon j'aurais pu éviter un incendie de lithium, de la fumée, des odeurs et du linoléum gâté. <br><br>  Il n'y a qu'une seule conclusion: vous ne pouvez pas simplement <i>utiliser un smartphone pendant des mois et des années à charge constante</i> .  Le téléphone n'a pas affiné un tel scénario.  Sa tâche principale est de charger correctement la batterie au maximum, sans laisser la tension et la température dépasser.  Et puis la décharge est toujours supposée.  Si l'appareil n'est jamais déconnecté de la prise murale, le contrôleur commence généralement à maintenir un programme de charge en dents de scie - réglage d'abord à 100%, puis coupure du courant et attente de la décharge à environ 90%. Et ravitaillement à 100% à nouveau.  Et c'est une approche encore plus ou moins attentionnée.  Et de nombreux vieux téléphones peuvent simplement garder stupidement la tension maximale sur la batterie. <br><br>  Il est connu que plus la tension d'une cellule lithium-ion est élevée, plus son vieillissement et sa dégradation sont rapides.  Certains smartphones remplissent généralement leurs batteries même au-dessus de 4,2 V afin de maximiser la durée de vie de la batterie.  Mais il n'y a qu'un seul résultat - étant constamment à la tension maximale, la batterie se dégrade beaucoup plus rapidement.  S'il est également ancien, il n'est pas loin du développement progressif des circuits internes microscopiques, de l'accélération thermique et de l'explosion, comme cela m'est arrivé. <br><br>  Après l'incident avec la batterie éclatée, je me suis dit - comment puis-je avoir une alimentation de secours en même temps et empêcher la batterie d'être constamment sous pleine tension? <br><br>  Je suis passé par beaucoup de scénarios différents, puis je suis finalement tombé sur les points suivants. <br><br>  En mode normal, le téléphone sera toujours alimenté par une prise, c'est-à-dire 5V via un connecteur USB. <br><br>  À l'aide d'un simple circuit supplémentaire, la batterie de secours est automatiquement et simultanément chargée à son maximum normal de 4,2 V, après quoi elle est <i>complètement déconnectée de la charge</i> .  De plus, la batterie est simplement déchargée silencieusement par auto-décharge, n'étant connectée nulle part.  Dans ce cas, le circuit surveille constamment sa tension et rallume la charge unique jusqu'à 4,2 uniquement lorsque la tension de la cellule tombe en dessous d'un certain minimum prédéterminé (j'ai pris 3,6 V).  Et ainsi de suite, tout est entièrement automatique.  Le temps réel entre ces recharges est des années, pendant lesquelles la batterie se décharge lentement, mais reste néanmoins tout à fait capable d'alimenter la charge à tout moment, même si ce n'est pas de sa pleine capacité. <br><br>  En cas de panne de courant de la prise, la batterie doit être immédiatement connectée automatiquement au smartphone (comme dans les alimentations sans coupure), après quoi le système continuera de fonctionner de manière autonome jusqu'à ce que l'alimentation secteur soit rétablie ou jusqu'à ce que la batterie soit complètement déchargée (et éteinte). <br><br>  Avec cette approche, la pile au lithium fonctionne dans un mode plus économe que lorsque la tension maximale y est constamment maintenue.  Et ça n'explosera certainement pas! <br><br><h4>  Astuces électriques pour smartphone </h4><br>  Maintenant, comment implémenter tous ces circuits. <br><br>  La question ici est compliquée par le fait que dans le smartphone, il n'était pas si facile à organiser dans le système d'alimentation. <br><br>  Par exemple, sans batterie, le téléphone ne s'allumera pas même s'il y a 5V via USB. <br><br>  Si vous retirez la batterie lors de l'utilisation de l'USB, tout se vide également immédiatement.  Bien que la puissance en même temps ne provienne évidemment que du connecteur USB! <br><br>  Au début, il y avait un problème avec le troisième contact de la batterie.  Je ne voulais pas être lié à une batterie Philips ordinaire et j'ai décidé de savoir - que se passera-t-il si je laisse la troisième borne de contact pas du tout connectée?  Il s'est avéré que le smartphone ne s'allumait pas en même temps ... J'ai même commencé à craindre qu'une sorte de bus numérique sophistiqué, comme i2c, transmette au téléphone non seulement diverses télémétrie technique, mais aussi toutes sortes de codes d'usine dans le style "ami ou ennemi".  Cela signifierait que j'étais à jamais lié à ma batterie native de Philips, car je n'avais certainement pas l'intention de mettre en place des interfaces numériques trompeuses ici (je me souviens que j'ai eu une surprise similaire en travaillant avec des batteries de caméscope d'une entreprise japonaise célèbre et respectée). <br><br>  J'ai regardé l'oscilloscope sur ce qui se passait au troisième contact.  Heureusement pour moi, le Philips W732 s'est avéré très simple!  Il affiche la tension constante habituelle du capteur de température interne de la batterie.  L'entrée du troisième contact dans le smartphone est à haute impédance. <br><br>  J'ai assemblé un simple diviseur de réglage, et en appliquant différentes tensions au contact du milieu, j'ai pris plusieurs points de la dépendance de la température de la batterie affichée par l'androïde sur la tension du troisième contact. <br><br><div class="spoiler">  <b class="spoiler_title">Graphique de la température affichée de la batterie sur la tension du 3ème contact</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dc/-g/gd/dc-ggdncroj-gfw1mrxyiltj530.png"><br></div></div><br>  Il s'est avéré que si le troisième est inférieur à 153 mV, des avertissements en plein écran sur la surchauffe de la batterie commenceront et après quelques secondes, le téléphone s'éteindra normalement.  À des tensions supérieures à 630 mV, l'androïde commence à croire que sa batterie est gelée à une température négative, mais continuera de fonctionner (et même silencieusement!).  Je n'avais plus besoin d'expérimenter - je viens de réaliser qu'il est élémentaire de tromper le troisième contact - il suffit d'y appliquer n'importe quel potentiel entre 155 et 600 mV. <br><br>  Du coup, j'ai pris forme sur 2 critères, sans lesquels le smartphone ne fonctionnerait pas du tout: <br><br>  <b>1.</b> Tension obligatoire sur la borne positive de la batterie (malgré le fait que le système soit alimenté par un connecteur USB) <br><br>  Et cela ne devrait pas être une sorte de fausse tromperie potentielle, juste pour que le téléphone pense qu'une batterie y est insérée.  Il nécessite une <i>source de</i> tension à <i>basse impédance à part entière</i> avec un courant d'au moins le courant de fonctionnement du smartphone. <br><br>  <b>2.</b> La présence d'une tension constante sur le troisième contact de la batterie dans la plage de 155 ... 600mV.  Il y a déjà suffisamment de blende potentiel à potentiel élevé simple. <br><br><hr><br>  Soit dit en passant, je ne comprends toujours pas pourquoi l'androïde a un seuil d'arrêt aussi élevé (3,4 V), alors qu'une pile au lithium standard peut facilement décharger jusqu'à 3 et même 2,8 V!  La seule chose qui me vient à l'esprit est la présence dans les smartphones de consommateurs internes à 3,3 V, qui ont besoin d'une alimentation électrique pour leurs convertisseurs buck.  Mais vous pouvez mettre SEPIC et utiliser la batterie plus complètement!  Ou à l'époque moderne, personne n'y pense? <br><hr><br>  Ensuite, il fallait trouver un schéma auxiliaire simple qui surveillerait tout cela et le contrôlerait automatiquement.  J'ai immédiatement décidé de ne pas utiliser de microcontrôleurs, bien que je puisse travailler avec eux.  Dans ce cas, il fallait juste réfléchir un peu, tout optimiser à fond, et toutes les fonctions ont été implémentées sur de simples composants analogiques.  Tout fonctionne et ne gèle jamais. <br><br>  La batterie de l'horloge de secours doit être chargée périodiquement à partir de quelque chose.  Au début, j'ai décidé de le faire directement à partir de la batterie et du smartphone, car je croyais naïvement qu'il avait un 4.2V honnête et immuable.  À l'aide d'un oscilloscope, j'ai regardé ce qui se passait vraiment là-bas.  Il s’est avéré qu’il ne sentait aucun niveau constant! .. <br><br>  Premièrement, si rien n'est connecté à la borne positive de la batterie, le contrôleur de charge ne dort toujours pas et le «sonde» périodiquement avec des vérifications. <br><br><div class="spoiler">  <b class="spoiler_title">Forme d'onde de tension à la borne positive de la batterie</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/bi/hc/kq/bihckq8fd_wy5kabjuultdy7oai.png"><br>  ( <i>reconstruction d'une forme d'onde réelle</i> ) <br></div></div><br>  Vous voyez - après environ toutes les 45 millisecondes, le téléphone donne une échelle de «palpage» consécutif - la tension externe est-elle apparue sur le contact de la batterie?  Et entre ces vérifications, un certain niveau constant de 4,05V est conservé. <br><br>  Si vous connectez la batterie, le système la reconnaît et commence régulièrement à y alimenter le courant.  Mais, encore une fois, pas constamment, mais par périodes de 10 secondes.  Après chacune de ces 10 secondes de charge, le smartphone pendant 2 secondes inclut un <i>courant inverse</i> complet, c'est-à-dire  il prend du courant de la batterie, et avec une puissance décente (je n'ai pas mesuré les valeurs numériques exactes de tous ces paramètres, je me suis intéressé au principe).  Au cours de cet échantillonnage de courant à court terme, le smartphone mesure la charge de la batterie sous charge, obtenant ainsi des chiffres honnêtes de pourcentage et de tension.  Il était clairement visible comment exactement après cette inversion dans l'androïde, les valeurs de tous les paramètres de la batterie sont mises à jour. <br><br>  Tout ce mécanisme de charge délicat ne me convenait pas du tout, et même interférait, car j'avais l'intention de construire la logique des circuits de charge basée sur un contrôle de tension analogique continu sur le shunt de mesure.  Et éteignez automatiquement la charge lorsque la chute sur le shunt diminue à un minimum prédéterminé, indiquant que le courant de charge a atteint le stade final de charge.  Et puis ce revers a tout gâché ... Au début, j'ai essayé de le contourner ou de le tromper, mais j'ai réalisé qu'il était plus facile d'utiliser une source externe d'une tension de charge de référence.  Il sera à la fois plus fiable et plus transparent pour une meilleure compréhension. <br><br>  J'ai installé un stabilisateur intégré externe (normal, linéaire), avec lequel j'ai reçu 4,2V précis et <i>stable en</i> température d'un chargeur USB 5 ... 6V mal stabilisé.  Avec eux, tout d'abord, j'ai alimenté le smartphone avec une borne de batterie positive, de sorte qu'il ait toujours pensé qu'il avait une batterie chargée à 100% et ne diffusait jamais rien sur cet écran en entier.  Et deuxièmement, le système de charge de la batterie de secours fonctionne à partir de ce bus. <br><br>  En chemin, je suis tombé sur une curieuse observation.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'avère que si vous coupez l'alimentation via USB et appliquez une </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tension constante à</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partir d'une source stabilisée qui ne changera jamais au </font><font style="vertical-align: inherit;">terminal de la batterie du smartphone </font><font style="vertical-align: inherit;">, l'androïde dessinera constamment un graphique incliné et décroissant du pourcentage de charge! </font><font style="vertical-align: inherit;">Apparemment, une sorte d'équation pour calculer ces pourcentages est intégrée au programme de surveillance de la batterie Android, qui prend en compte non seulement la tension réelle de la cellule, mais également la consommation actuelle de l'appareil. </font><font style="vertical-align: inherit;">J'ai spécifiquement mené des expériences, allumant et éteignant le rétroéclairage de l'écran, en tant que l'un des consommateurs actuels les plus voraces. </font><font style="vertical-align: inherit;">Voici les statistiques collectées par jour:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alors Android a dessiné un graphique de "décharge de la batterie"</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m-/_j/dc/m-_jdcx_h9vkganwg0-nuci6fdc.jpeg"><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b7/y_/vv/b7y_vvrfjlfd_5teazjmiksc8bi.jpeg"></div><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous voyez, lorsque l'écran a fonctionné et que le courant provenant du terminal de la batterie est devenu notable, l'androïde a dessiné une bonne pente, une baisse d'environ 5% par heure. Ensuite, j'ai éteint le rétro-éclairage et le smartphone s'est endormi, le courant est tombé à quelques petites valeurs de veille et le graphique est allé presque horizontalement. Il ralluma l'écran - et encore la rampe. Notez que la tension à la borne positive de la batterie a toujours été strictement </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constante</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . L'androïde a donc calculé son pourcentage de charge uniquement sur la base du courant mesuré. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, dès que la charge atteint 15% (ici le téléphone donne un avertissement sur une batterie déchargée), le graphique cesse de diminuer puis passe horizontalement de 15% ... Voici l'astuce (ou pépin).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y avait une autre fonctionnalité. Il s'est avéré que si vous fournissez simultanément une alimentation USB et une alimentation externe stabilisée au terminal de la batterie, mais </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moins de 4,2 V</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , le smartphone affichera d'abord et pendant longtemps honnêtement un pourcentage de charge incomplet, puis se mettra soudainement à gronder, dans le style de " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do you quelque chose avec une batterie! La charge prend trop de temps!</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " Et bien sûr, tout cela à nouveau en plein écran et en haut de ma montre! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, si vous soumettez plus de 4,2 V, alors déjà quelque part avec 4,3 V, il commencera à maudire l'excès dangereux de la tension de la batterie, cela est compréhensible. Par conséquent, la "plage de calme" est ici assez étroite - seulement 0,1V.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et seulement s'il a reçu une alimentation USB de 5 V et une émulation complète de 4,2 V exacte via le terminal de la batterie - alors seulement l'androïde se ferme joyeusement, croyant qu'il a honnêtement chargé sa batterie au maximum. </font><font style="vertical-align: inherit;">Et de plus il déjà, Dieu merci, ne se plaint de rien!</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je rassurerai immédiatement ceux qui auraient pu penser que je l'ai fait très mal en chargeant deux sources de tension à faible impédance incompatibles l'une sur l'autre (c'est-à-dire un stabilisateur externe de 4,2 V et une borne de batterie positive, qui elle-même «alimente») . </font><font style="vertical-align: inherit;">Le fait est que mon stabilisateur externe est un LDO linéaire ordinaire et, par ses circuits, n'est pas en mesure de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">détourner le</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> courant. </font><font style="vertical-align: inherit;">Échouez seulement. </font><font style="vertical-align: inherit;">Par conséquent, aucun conflit électrique ne se produit ici, car cela peut se produire, par exemple, lorsque plusieurs batteries différentes sont connectées en parallèle.</font></font><hr><br><br><h4>  Schéma </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque les savoirs traditionnels ont finalement été pleinement déterminés, il a été possible de commencer à élaborer un schéma spécifique. </font><font style="vertical-align: inherit;">Malgré l'apparente simplicité de la tâche, je l'ai bricolée notamment! </font><font style="vertical-align: inherit;">J'ai dû inventer puis rejeter plus d'une douzaine d'options différentes, de l'indécemment simple au volumineux.</font></font> Voici le résultat: <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plan d'alimentation</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5p/av/_r/5pav_ru8mahbacmdyz4xxr6covo.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malgré la redondance apparente, le schéma est simple. </font><font style="vertical-align: inherit;">Grâce à SMD, une écharpe de 35x22 mm se glisse facilement à l'intérieur du compartiment d'une batterie ordinaire retirée. </font><font style="vertical-align: inherit;">En tant que batterie de secours, j'ai utilisé un lithium-ion 18650 ordinaire monté sur un support de montre. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le circuit offre les fonctions suivantes:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> L'alimentation principale constante de 5V de la prise via le connecteur USB. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Transférez automatiquement le smartphone vers une batterie de secours en cas de panne de courant via USB. </font></font></li><li>   4,2     (    ). </li><li>       (   ). </li><li>            . </li><li>     ,   . </li><li>         . </li><li>        . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, brièvement, comment fonctionne le circuit. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour obtenir un 4.2V stable et indépendant de la température, j'ai utilisé le merveilleux LDO ADM7172 intégré d'Analog Devices. Il me donne la tension souhaitée et parfaitement uniforme de 4,22 V jusqu'à une charge de 2 A. Je l'ai mis dans mon smartphone sur le plus du connecteur de batterie (VBAT), et je l'utilise également pour charger la batterie de secours du système. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le circuit d'émulation de tension du troisième contact de batterie (TEMP) est réalisé sur une simple diode D2, alimentée par un faible courant de fond. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le mosfet Q4 à canal P connecte immédiatement une batterie de secours au smartphone, dès que la tension disparaît sur le bus principal USB + 5V. LED2 a été réglé ici uniquement dans le but de changer de niveau pour une petite accélération de l'ouverture Q4 dans le processus d'affaissement des pneus. Il est infrarouge et ne brille nulle part.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le reste des détails a fait le circuit de charge. La batterie de secours BT1 est chargée via le mosfet Q3 et la résistance de limitation R9R10. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le travail de YOU U2 est intéressant ici. Il est tellement inclus ici qu'il permet à la fois de contrôler le degré de décharge et le degré de charge. L'ampli-op fonctionne ici en mode comparateur, et un OS positif pour lui est obtenu par lui-même en raison des processus dans les circuits qu'il contrôle.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici comment cela se passe: lorsque tout va bien - il y a une alimentation USB + 5 V et la batterie de secours est chargée jusqu'à une tension supérieure à celle définie par le point de division R4R5R6 - puis l'ampli op délivre le potentiel d'un bus de 4,2 volts (à partir duquel il est alimenté) et la charge Le Mosfet Q3 est fermé. Lorsque la batterie, pour une raison ou une autre, se décharge en dessous de ce point (+ 3,63 V dans le diagramme), la sortie de l'ampli opérationnel se «détache» progressivement du plus et ouvre ainsi le mosfet de charge Q3. Le courant circulera dans la batterie, la tension sur la cellule augmentera immédiatement d'au moins quelques millivolts (en raison d'une résistance interne non nulle) et cela servira de point de vente fiable pour l'ampli-op. Ici, vous pouvez appliquer un véritable comparateur avec sa propre hystérésis, mais en réalité, la commutation de l'amplificateur est fiable et rapide, il n'y a pas de dérive de cliquetis.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La charge de la batterie passe par la résistance R9R10 (elle est composite afin d'augmenter la puissance de dissipation). Premièrement, il limite le courant de charge, ce qui est absolument nécessaire ici, sinon même un chargeur de 2 ampères ne pourra tout simplement pas faire face et s'affaisser. Deuxièmement, en fonction de la chute de tension sur cette résistance, le circuit détermine le moment où la charge doit être coupée.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela se produit comme suit: dès que la charge est activée, le mosfet auxiliaire Q2 s'ouvre en même temps, ce qui reconstruit le diviseur de contrôle R4R5R6 pour l'entrée inverseuse de l'ampli-op, et donc l'ampli-op commence à surveiller la tension qui est libérée sur la résistance de charge. Au tout début de la charge, lorsque la batterie est complètement déchargée, environ 0,5 V tombe sur le R9R10, ce qui rend l'ampli-op déséquilibré de manière fiable en mode état de charge. Et seulement lorsque la batterie est progressivement complètement chargée, le courant à travers la résistance de contrôle s'affaiblit à une certaine valeur (environ 20 mA), puis les potentiels des entrées de l'ampli opérationnel sont égalisés, après quoi il est transféré par le même mécanisme POS externe à l'état opposé (plus à la sortie), désactivant les mosfets Q2 et Q3 et arrêt de la charge. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En ce qui concerne un tel régime résultant</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profil de charge d'une</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> batterie lithium-ion, la résistance R9R10 met ici en œuvre automatiquement une fonction de charge simple avec un courant initial maximum, sa diminution progressive automatique et se rapprochant de zéro.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Graphique de la fonction de charge</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/yx/6o/cx/yx6ocxkusa2pis2406l_y9jqvrq.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les fabricants de batteries recommandent à leur tour le profil de charge bien connu suivant avec des sections de stabilisation du courant et de la tension: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profil de charge recommandé typique pour Li-ion</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/rt/o0/ab/rto0abfgdgab_tlfpkkwdhx2cdu.jpeg"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans mon cas, ni la tension ni le courant sur la cellule ne sont jamais spécifiquement stabilisés, mais la tension ne dépassera jamais les limites de sécurité. Par conséquent, je considère qu'une telle méthode de charge simplifiée est tout à fait réalisable et efficace. En pratique, cela fonctionne très bien et ne nécessite en même temps qu'une seule résistance. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le Mosfet Q1 est utilisé de sorte que lorsque vous travaillez uniquement avec une batterie de secours, il n'est pas nécessaire de gaspiller son courant pour alimenter le reste du circuit. Lorsque l'alimentation est coupée de la prise, Q1 se ferme et coupe toutes les parties inutilisées du circuit du fil commun. Pour cette raison, la consommation propre de l'ensemble de la structure chute à un niveau négligeable de 3 à 5 microampères, ce qui empêche automatiquement une décharge profonde de la batterie au cas où vous oublieriez le système hors tension pendant une longue période.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La diode Schottky D1 à l'entrée du stabilisateur U1 remplit une double fonction: bloquer le courant inverse à travers U1 (il n'y a pas un tel blocage à l'intérieur de l'ADM7172) et décharger le petit microcircuit du stabilisateur d'une dissipation de puissance excessive. </font><font style="vertical-align: inherit;">Au tout début de la charge de la batterie, le courant de charge atteint 1A, et si tout le 1 volt de la chute de tension du bus USB + 5V est posé sur le minuscule ADM7172 de 3x3 mm, il sera très chaud, même malgré le coussin thermique soudé à la carte. </font><font style="vertical-align: inherit;">Par conséquent, une partie de la tension d'entrée est éteinte avec succès sur la diode de blocage D1, et en conséquence, ces deux parties sont chauffées plus uniformément et moins.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> À propos des composants utilisés </font></font></h4><br>  En tant que stabilisateur d'entrée, j'ai utilisé un excellent LDO avec une chute de passage minimale vraiment faible, bien qu'à cet endroit la tension ne baisse jamais en dessous de 0,4 V.  J'adore vraiment l'ADM7172 pour bon nombre de ses spécifications.  Et donc ici, vous pouvez mettre presque n'importe quel microcircuit de stabilisateur linéaire, l'essentiel est qu'il produit des volts fiables qui ne flottent pas à la température et au moins 1,5 A de courant. <br><br>  De mosfets j'avais besoin d'une résistance minimale de canal ouvert (RdsON) ici.  Cela est particulièrement vrai pour la clé de canal P bit Q4.  Là, j'ai mis un magnifique échantillon Toshibov TPH1R712MD - le meilleur qui a été trouvé par la résistance du canal dans un petit boîtier plat.  À l'état ouvert, il a un réel 1,3 mOhm, ce qui avec un courant de fonctionnement d'un smartphone de 200 ... 300mA donne une perte de transit de la tension de la batterie précieuse à un 0.4mV négligeable! <br><br>  Il est également souhaitable d'avoir un faible RdsON pour Q1 afin de se fixer plus précisément au potentiel du fil commun.  Les mosfets FDMC8010 de Fairchild s'en sortent également très bien.  Il y a plus d'échantillons à basse impédance, mais dans cette conception, les petites dimensions des pièces étaient également importantes pour moi. <br><br>  Le reste des mosfets peut être quelconque, il est seulement souhaitable qu'ils aient une tension de seuil d'ouverture inférieure. <br><br>  En tant que comparateur U2, j'ai utilisé la micropuissance Microchip MCP6V11 IOW, que j'ai aimé avec son excellente efficacité - seulement 7 microampères en arrière-plan.  Certes, par rapport au YOW conventionnel, il est certainement lent comme une tortue (GBW 80 kHz et taux de balayage de seulement 0,03 V / μs).  Mais cela fonctionne très bien ici de toute façon.  Au fait, j'ai essayé de mettre ici un vrai comparateur avec hystérésis intégrée.  J'ai trouvé un excellent échantillon MCP6541, qui ne consomme que 600 nanoampères (!) En arrière-plan, et lorsqu'il est déclenché, il peut tirer la sortie avec une puissance allant jusqu'à 30 mA ... Mais, en le mettant directement à la place du MCP6V11 (leur brochage coïncide), j'ai soudainement eu une panne de circuit.  Il s'est avéré que le MCP6541 commute si rapidement que le front à grande vitesse de son impulsion pénètre facilement à travers la capacité d'électrode de grille Q2 dans le circuit du diviseur de commande R4R5R6 et arrive à sa propre entrée inverseuse.  Il se révèle une telle rétroaction dynamique, et le comparateur ne commute pas, mais commence à générer. <br>  Le problème sera résolu en ajoutant simplement une résistance à haute résistance entre la sortie du comparateur et la porte Q2, mais j'avais déjà une carte sur laquelle il n'y avait absolument aucune place pour même une petite résistance SMD supplémentaire, donc je viens de laisser le MCP6V11 ici. <br><br>  LED1 est seulement nécessaire pour indiquer quand une charge se déverse dans la batterie.  Dans le bon sens, cela devrait se produire toutes les quelques années ... Vous pouvez utiliser absolument n'importe quelle, n'importe quelle couleur, ou vous ne pouvez pas la mettre du tout. <br><br>  Les résistances et les condensateurs sont les CMS les plus courants, il n'y a aucune exigence pour eux, sauf pour la petite taille.  J'ai utilisé des condensateurs au tantale, lowESR, dans des cas 7343H, mais tout ira, juste pour s'insérer dans le compartiment de la batterie avec la carte (pour le W732 Philips, il mesure 55x60x8 mm). <br><br>  Pendant le chargement de la batterie, la carte entière se réchauffe décemment pendant les premières heures, jusqu'à 60 degrés. Comme il y avait encore suffisamment d'espace dans le compartiment, j'ai intentionnellement augmenté la surface de la carte et élargi les pièces chauffantes dessus afin qu'elles ne se surchauffent pas mutuellement et leurs autres voisins en vain. <br><br><div class="spoiler">  <b class="spoiler_title">Carte de gestion de l'alimentation dans le compartiment à piles</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/bt/bf/jy/btbfjybybqxy0ope5aikbng-efw.jpeg"><br></div></div><br>  Fabriqué à la main, photorésist.  La méthode FR permet d'obtenir facilement un «processus» de 0,15 mm, mais pour une raison quelconque, j'ai tout le textolite de si mauvaise qualité que les routes minces essaient de tomber lors de l'étamage ... Si quelqu'un sait où vous pouvez acheter un textolite de bonne qualité avec une garantie - écrivez dans les commentaires ! <br><br>  Ainsi, le smartphone est enfin correctement alimenté et fonctionne «comme une horloge» dans tous les sens!  S'allume de manière stable à la fois avec l'alimentation de la prise et de la batterie, fonctionne silencieusement.  Lorsque le chargeur est connecté, il affiche toujours 100% de charge.  Si vous le retirez de la prise, il continue de fonctionner silencieusement à partir de la batterie de secours et commence bientôt à afficher la tension réelle dessus.  Lors du rétablissement de l'alimentation secteur, affiche à nouveau silencieusement et calmement une charge de 100%.  Tout est comme il se doit! <br><br>  En principe, via un circuit similaire, vous pouvez alimenter n'importe quel téléphone mobile qui reçoit une simple tension constante via le troisième contact de la batterie. <br><br><h4>  Montre numérique pour Android </h4><br>  Sur cela, l'affaire a été complétée avec du fer.  Le temps est venu pour les garnitures logicielles.  À savoir, il était nécessaire d'obtenir une grande horloge numérique sur l'écran du smartphone. <br><br>  Voici ce dont j'avais besoin: <br><br><ol><li>  Le plus grand nombre possible!  Je n'aime pas plisser les yeux et regarder les petites choses de loin. </li><li>  Possibilité de mettre n'importe quelle police de n'importe quelle couleur.  La lisibilité en dépend également. </li><li>  L'exclusivité de l'affichage de l'horloge à l'écran - rien que les chiffres de l'heure ne devraient pas être là.  Aucune prévision météorologique, avertissement, message, barre d'état et autre non-sens - <i>ne devrait jamais</i> apparaître. </li><li>  Il est clair que l'écran du smartphone ne doit jamais noircir seul. </li><li>  Fonction de luminosité automatique fonctionnant correctement de l'écran. </li><li>  Fiabilité maximale (je vis toujours sur cette montre).  Dépend, frises - tout cela est exclu. </li></ol><br>  J'ai commencé par brancher le téléphone et déraciner sans pitié toutes les ordures que je pouvais atteindre.  Toutes sortes de gapps, blotware et tout ce qui n'est pas nécessaire pour un chargement normal ont volé dans le panier.  Y compris un tas d'applications système, divers utilitaires pour travailler avec des cartes SIM, des numéroteurs, des SMS, des navigateurs, des calendriers, des fonds d'écran et d'autres bêtises.  Je suis même allé trop loin à quelques reprises - le téléphone a été mis en boucle par des erreurs.  Mais j'ai tout restauré et encore une fois effacé. <br><br>  Puis pendant longtemps, j'ai cherché sur Internet un programme normal d'horloges numériques en plein écran pour Android.  Malgré une montagne de programmes similaires, presque aucun ne me convenait!  Tous les développeurs, sans exception, essaient d'introduire un tas de choses inutiles dans leurs produits - à partir d'une sorte de fond drôle (non déconnectable), et se terminant par des prévisions météorologiques, des nouvelles, des calendriers et autres ordures similaires.  Je suis généralement silencieux sur les publicités qui ont déjà atteint tout le monde ... Je n'avais besoin que du temps de l'horloge! <br><br>  Et la caractéristique universelle des programmes de montre et des widgets est l'utilisation totalement non économique de la zone d'écran.  Les nombres sont petits partout et les marges depuis les bords de l'écran sont énormes.  Mon Philips, et donc l'écran n'est pas le plus grand - seulement 4,3 ". <br><br>  En bref, j'ai trouvé presque le seul programme approprié - Big Digital Clock 1.1.1. <br><br><div class="spoiler">  <b class="spoiler_title">Capture d'écran Big Digital Clock</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/i7/lw/eq/i7lweqe_tgvvqwiqqzdmjo_sk9q.png"><br></div></div><br>  Elle a le plus grand nombre.  Et pourtant, ils sont encore loin de la pleine utilisation de la zone matricielle.  Parmi les avantages du programme - la possibilité de tout supprimer de l'écran, à l'exception du temps, la possibilité de choisir n'importe quelle couleur, le format 24 heures, un côlon diviseur qui ne clignote pas, n'importe quelle orientation de l'écran et la maintenance automatique du rétroéclairage qui ne s'estompe pas.  Parmi les lacunes - une police bien cousue qui imite un sept segments typique. <br><br>  Livré et a commencé à utiliser tous les jours.  Au début, tout allait bien - les chiffres semblent grands, ils sont visibles normalement, et après mes vieilles heures - généralement le ciel et la terre!  Mais maintenant, après environ un mois de travail continu, j'ai soudain remarqué que le temps <i>s'est figé</i> sur eux <i>et n'a pas changé!</i>  Quelle bêtise!?  J'ai décidé de vérifier - c'est un problème ou une "caractéristique" unique du programme. <br><br>  Redémarré l'horloge, et après quelques semaines, la frise a été répétée.  Le temps cesse de se mettre à jour.  Au lieu de cela, le programme s'affaisse au hasard toutes les 7 ... 10 minutes, met à jour l'horloge et tombe à nouveau dans la stupeur.  Il est clair qu'une telle "fiabilité" ne me convenait pas. <br><br><h4>  Automators Android et leurs "puces" </h4><br>  Comme c'était pratiquement le seul programme approprié, j'ai dû commencer à lui inventer des béquilles.  J'ai décidé que je devais installer une sorte d'outil d'automatisation Android afin qu'il redémarre périodiquement le programme d'horloge buggy avant même qu'il ait le temps de geler.  Mettez Tasker.  Il était occupé, a réglé - mais quelque chose que je n'aimais pas ... Je l'ai changé en Automagic.  Qui n'est pas au courant - cet outil d'automatisation utilise des scripts basés sur des organigrammes visuels.  Et cette caractéristique de lui m'a vraiment attiré! <br><br><div class="spoiler">  <b class="spoiler_title">Représenter des scénarios d'automatisation Automagic</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dl/pr/ki/dlprki-84b4sgbvlax3ao2wm9kw.jpeg"><br></div></div><br>  La fonction de redémarrer périodiquement mon programme de surveillance de buggy que j'ai implémentée presque immédiatement.  Et puis il a mis Automagic sur son smartphone principal et a suspendu pendant une semaine des expériences intéressantes avec.  En conséquence, j'ai fait beaucoup d'utilité pour la vie quotidienne sur mon téléphone. <br><br>  Mais ce n'était pas l'essentiel.  Je suis tombé sur les propriétés Automagic sur une puce telle que les widgets personnalisés.  Et puis il s'est avéré qu'avec son aide, vous pouvez dessiner et "faire revivre" pratiquement <i>n'importe quel widget fait maison</i> qui n'a que l'imagination et la fonctionnalité du programme!  Puis j'ai réalisé que je pouvais dessiner moi-même une telle montre, que seul mon cœur désire!  De plus, l'aide du programme vient de décrire un exemple de création d'un widget d'horloge. <br><br>  Après quelques jours, tout était prêt de la meilleure façon possible!  Grâce au Nova lancer, j'ai la possibilité d'étirer les widgets jusqu'aux bords de la matrice.  J'ai également caché la barre de dock et la barre d'état, libérant l'écran de tous les éléments de l'interface.  Et voici le résultat - des chiffres vraiment énormes concernant les bords mêmes de l'écran ... Enfin, heureux !!! <br><br><div class="spoiler">  <b class="spoiler_title">Enfin, les chiffres occupent toute la largeur de l'écran!</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5k/xv/9s/5kxv9sdud2mssdnn7xm1iuo8k5m.jpeg"><br></div></div><br>  L'utilisation d'Automagic m'a permis de satisfaire toutes mes exigences.  Vous pouvez mettre n'importe quelle police .ttf ou .otf.  Vous pouvez dessiner et étirer des caractères dans n'importe quelle proportion pour les adapter parfaitement à l'écran.  Enfin, vous ne pouvez avoir que ce dont vous avez besoin!  Je n'ai même pas dessiné de points de division dans la montre - avec un espace simple, tout est parfaitement lisible.  Dans l'application de tous les programmes externes et béquilles immédiatement inutiles. <br><br>  De plus, je n'avais même plus besoin de Locus pour fixer périodiquement les coordonnées GPS pour la synchronisation de l'heure.  Tout cela peut être parfaitement réalisé par n'importe quel outil d'automatisation.  Dans un scénario de contrôle, vous pouvez implémenter presque tout ce dont vous avez besoin.  Par exemple, maintenir l'écran dans un état qui ne s'estompe pas. <br><br>  En outre, des problèmes d'apparence se sont généralement posés.  Et pourquoi pas, si tout cela peut être facilement mis en œuvre? <br><br>  Par exemple, lorsque vous choisissez la taille et le facteur de police, vous devez partir d'un format de temps à 4 caractères (XX: XX).  Mais dans la période de 0:00 à 9:59, il n'y a que trois chiffres sur l'écran, ils occupent une largeur inférieure à quatre et n'utilisent donc pas pleinement la matrice.  Un peu, mais moche.  Avec Automagic, le cas est facilement résolu avec quelques commandes supplémentaires.  Il a une fonction qui vous permet de modifier presque tous les paramètres d'un widget personnalisé <i>à la volée</i> .  Dans ce cas, il s'agit du facteur de la largeur (aplatissement) des caractères de police, que j'ai défini pour changer par le déclenchement des intervalles de temps ci-dessus.  Ça marche! <br><br><div class="spoiler">  <b class="spoiler_title">Trois et quatre caractères tiennent dans la même taille d'écran</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9t/ns/5r/9tns5rg_kbtelwl0fixwluearic.jpeg"><br>  <i>Le facteur de largeur de police change "à la volée" avec la transition de 9:59 à 10:00</i> <i><br></i>  <i>et retour de 23h59 à 0h00</i> <br></div></div><br>  Au début, j'avais d'abord des doutes sur le <i>moment où les</i> relevés d'horloge étaient <i>mis à jour</i> toutes les minutes.  J'avais peur qu'Automagic le mette à jour non pas de manière synchrone avec le changement de minutes de l'horloge système du smartphone, mais arbitrairement, introduisant ainsi une erreur aléatoire pendant une minute.  J'ai commencé à vérifier ... <br><br>  Dans Automagic, il existe deux façons différentes d'implémenter l'heure dans un widget personnalisé.  Vous pouvez envoyer des valeurs numériques à un champ de texte ordinaire d'un widget par un événement d'action externe.  Pour chacun de ces événements, il y a juste une option spéciale «À heure fixe», ce qui signifie que vous devez l'envoyer exactement de manière synchrone au moment où l'heure du système change. <br><br>  Et la deuxième méthode est plus simple - elle n'utilise pas de scripts externes et consiste à écrire une fonction d'appel système du type directement dans le champ de texte souhaité du widget <br><br><pre><code class="plaintext hljs">{getDate(),dateFormat,HH:mm}</code> </pre> <br>  Mais il n'y a pas une telle option "à heure fixe".  Le widget est simplement coché «Actualiser automatiquement» et réglé sur «Intervalle d'actualisation» exactement une minute.  Et ici, mes craintes étaient précisément que cet intervalle d'auto-renouvellement du widget en une minute puisse être compté arbitrairement par rapport à la «grille» temporelle du changement de minutes de l'heure système.  J'ai fait quelques expériences, mais à ma joie, il s'est avéré que tout était en ordre.  Le widget s'auto-met à jour clairement immédiatement, dès que les minutes de l'horloge système changent! <br><br>  Peu importe à quel moment le widget a commencé à fonctionner. <br><br><h4>  Écran de luminosité automatique </h4><br>  La prochaine chose que je voulais faire était une bonne luminosité automatique claire de l'écran.  La luminosité automatique intégrée sur mon ancien Philips a terriblement fonctionné.  Secousses, inadéquates et avec une plage très étroite.  Ici, je n'ai pas pris la peine de mettre l'un des nombreux programmes de luminosité automatique.  J'ai essayé Lux au début, mais je n'aimais pas certaines teintures non intuitives et certains profils complexes.  Changé en Velis, et cela s'est avéré être ce dont nous avons besoin.  Ce que j'ai particulièrement aimé - Velis permet de tracer une véritable courbe de la dépendance de la luminosité sur les lectures du luxomètre et montre en temps réel sur ce graphique comment le smartphone ajuste la luminosité en fonction de celui-ci.  Vous pouvez configurer n'importe quelle loi o-très douce de changement de luminosité et bien sûr n'importe quelle valeur, jusqu'à 1%, lorsque l'écran est presque invisible.  C'est très pratique la nuit, quand les chiffres devraient à peine briller. <br><br>  Pendant que je courais autour de la nouvelle montre, j'ai remarqué que la matrice du smartphone, même avec un fond d'écran complètement noir, brille toujours décemment avec le rétro-éclairage qui la traverse.  Cela est particulièrement visible dans l'obscurité totale - le rectangle de l'écran est clairement visible sous la forme d'un fond gris, quelque chose comme un effet de lueur.  J'ai décidé de le réparer avec un filtre externe.  La couleur des chiffres de l'horloge j'ai choisi le rouge, car  la couleur rouge que je vois le plus clairement de loin. <br><br>  J'ai fait le premier filtre manuellement - j'ai imprimé un remplissage rouge uni sur une imprimante à jet d'encre sur un film transparent et plié deux tirages encore bruts avec de l'encre l'un à l'autre.  Les films adhèrent fermement et on obtient un bon "verre" transparent de couleur rouge épaisse.  Soit dit en passant, un tel hack de vie ne fonctionnera plus, il est ringard parce que dans mon travail, toutes les imprimantes à jet d'encre ont été remplacées par des MFP laser à la mode.  Ils impriment parfaitement sur papier, mais il est impossible d'obtenir un remplissage de couleur transparent sur le film avec leur aide - il y aura une couche mate bruyante à travers laquelle rien n'est visible. <br><br>  Mais ici, je suis allé en quelque sorte à Komus pour les crayons et j'ai accidentellement vu ce genre de chose: <br><br><div class="spoiler">  <b class="spoiler_title">La photo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/of/e8/pw/ofe8pwoxfgo5hvkmvhul5evpync.jpeg"><br></div></div><br>  Il s'agit d'un bac à papier de bureau ordinaire, mais voyez de quoi il est fait.  Soit en plexiglas, soit en plastique transparent, mais il est de la même couleur et transmission lumineuse dont j'ai besoin pour le filtre.  Je l'ai acheté, j'ai soigneusement découpé une plaque pour l'adapter à l'écran et je l'ai adapté.  La beauté! <br><br><div class="spoiler">  <b class="spoiler_title">Avec filtre rouge</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/oq/oh/dr/oqohdrcoghynsiygiugq_egez_0.jpeg"><br></div></div><br><h4>  Touche finale </h4><br>  En principe, sur ce point, la transformation d'un ancien téléphone mobile inutile en d'excellentes belles montres peut être considérée comme terminée. <br><br>  Certes, même avant le tas, je suis devenu confus du fait que dans l'éditeur de police, j'ai un peu changé la police .otf pour que les caractères soient comme je le souhaitais, jusque dans les moindres virages.  Une bagatelle, mais sympa!  Il était également nécessaire de rendre la police monospace, de sorte que lors du changement de caractères, la ligne ne se déplace pas et ne rampe pas au-delà des limites de l'affichage.  Utilisé l'un des éditeurs de polices open source, Glyphr Studio. <br><br>  Eh bien, au final, il ne reste plus qu'à fixer toute la structure sur une étagère dans le coin de la pièce.  Il y a une grande marge de créativité.  J'ai simplement plié la bande d'aluminium en forme de L et vissé doucement le couvercle arrière du smartphone avec des vis.  Vissé l'autre extrémité sur l'étagère.  Vous pouvez faire pivoter en définissant n'importe quel angle de vue.  Et un peu d'aluminium plié-déplié, ajustant l'angle verticalement.  En fait, j'ai généralement tout installé, donc je n'y touche plus. <br><br>  La batterie de secours s'est adaptée au coude de la bande de montage.  Ici, je l'ai fait sans un design exquis, rien ne peut être vu de derrière.  Je n'ai pas non plus pris la peine d'utiliser des conteneurs terminaux pour la batterie, mais simplement soudé avec soin directement sur le boîtier métallique 18650 dans les endroits qui ne contenaient pas le contenu interne de la batterie afin de ne pas la surchauffer avec un fer à souder. <br><br>  Toutes les connexions sont effectuées par un câblage ordinaire, jeté à travers les trous percés dans la couverture arrière du smartphone.  Et à l'intérieur, j'ai repéré directement les détails et les traces de la carte du smartphone. <br><br>  Au total, deux fils externes proviennent de la conception: une alimentation 5V du chargeur secteur et un câble d'antenne GPS qui va à la fenêtre et est collé au verre avec du ruban adhésif. <br><br>  Depuis près d'un an maintenant, les montres me ravissent avec de grands et beaux chiffres, un fonctionnement précis et un fonctionnement fiable et ininterrompu. <br><br>  Et pour le plaisir, j'ai dessiné un deuxième widget horloge - pour l'emplacement vertical du smartphone. <br><br><div class="spoiler">  <b class="spoiler_title">Horloges horizontales et verticales à la même échelle</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hr/_b/o6/hr_bo6oelso-e2dyzglvbvnf9qa.jpeg"><br></div></div><br>  J'ai commencé à l'inventer parce que les nombres avec un tel agencement non conventionnel peuvent être encore plus grands, c'est-à-dire que l'utilisation utile de la zone d'écran s'avère être le maximum possible.  De plus, dans ce cas, la nécessité de changer à chaque fois le facteur de largeur des caractères lors du passage du format d'heure X: XX à XX: XX et vice versa disparaît, car tout se déroule toujours automatiquement. <br><br>  Il est vrai que presque tous ceux à qui j'ai montré une telle montre verticale non standard ont dit "fuu, horizontal c'est mieux!".  Eh bien, c'est une affaire d'amateur, j'aime personnellement les deux. <br><br>  C’est tout.  Merci à tous ceux qui ont lu! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr443052/">https://habr.com/ru/post/fr443052/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr443038/index.html">Si la superglue entre en contact avec les yeux</a></li>
<li><a href="../fr443040/index.html">7 principales raisons pour lesquelles les applications sont bloquées sur Google Play et AppStore</a></li>
<li><a href="../fr443042/index.html">Lancement de 619 mille tetris sur GLSL, leur rendu et un simple bot</a></li>
<li><a href="../fr443046/index.html">Comment les chercheurs en sécurité accèdent aux sites protégés du code iOS</a></li>
<li><a href="../fr443050/index.html">L'explication la plus simple du fonctionnement actuel des algorithmes de chiffrement symétrique</a></li>
<li><a href="../fr443054/index.html">Une sélection d'utilitaires pour un programmeur sous Linux</a></li>
<li><a href="../fr443056/index.html">Un deuxième patient atteint du VIH atteint une rémission</a></li>
<li><a href="../fr443058/index.html">Architecture épurée. Partie I - Introduction</a></li>
<li><a href="../fr443060/index.html">Est-ce que Starship atteindra Mars?</a></li>
<li><a href="../fr443062/index.html">Comment j'ai créé Recycle! VR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>