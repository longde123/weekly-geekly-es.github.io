<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€ğŸš’ ğŸ›©ï¸ ğŸ‘©ğŸ½â€ğŸš’ Assistente de Banco de Dados GreenPig ğŸŒ™ â–ªï¸ ğŸ™…ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Entrada 
2. ConexÃ£o de biblioteca 
3. Onde classe Parte atÃ´mica da solicitaÃ§Ã£o Consultas complicadas 
4. Parte atÃ´mica da solicitaÃ§Ã£o 
5. Consultas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Assistente de Banco de Dados GreenPig</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483458/"><ol><li>  <a href="https://habr.com/ru/post/483458/">Entrada</a> </li><li>  <a href="https://habr.com/ru/post/483458/">ConexÃ£o de biblioteca</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Onde classe</a> <br><ul><li>  <a href="https://habr.com/ru/post/483458/">Parte atÃ´mica da solicitaÃ§Ã£o</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Consultas complicadas</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/483458/">Participar da aula</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Consulta de classe</a> <br><ul><li>  <a href="https://habr.com/ru/post/483458/">SeleÃ§Ã£o de um banco de dados com parÃ¢metros aninhados</a> </li><li>  <a href="https://habr.com/ru/post/483458/">UniÃ£o mÃºltipla consigo no nome da pesquisa</a> </li></ul></li></ol><br><pre><code class="sql hljs">â•”â•â•â•â•—â•”â•â•â•â•—â•”â•â•â•â•—â•”â•â•â•â•—â•”â•—â”€â•”â•—â”€â”€â”€â”€â•”â•â•â•â•—â•”â•â•â•—â•”â•â•â•â•— â•‘â•”â•â•â•â•‘â•”â•â•—â•‘â•‘â•”â•â•â•â•‘â•”â•â•â•â•‘â•šâ•â•â•‘â”€â”€â”€â”€â•‘â•”â•â•—â•‘â•šâ•—â•”â•â•‘â•”â•â•â• â•‘â•‘â•”â•â•—â•‘â•šâ•â•â•‘â•‘â•šâ•â•â•—â•‘â•šâ•â•â•—â•‘â•”â•—â”€â•‘â”€â”€â”€â”€â•‘â•šâ•â•â•‘â”€â•‘â•‘â”€â•‘â•‘â•”â•â•— â•‘â•‘â•šâ•—â•‘â•‘â•”â•—â•”â•â•‘â•”â•â•â•â•‘â•”â•â•â•â•‘â•‘â•šâ•—â•‘â”€â”€â”€â”€â•‘â•”â•â•â•â”€â•‘â•‘â”€â•‘â•‘â•šâ•—â•‘ â•‘â•šâ•â•â•‘â•‘â•‘â•‘â•‘â”€â•‘â•šâ•â•â•—â•‘â•šâ•â•â•—â•‘â•‘â”€â•‘â•‘â”€â”€â”€â”€â•‘â•‘â”€â”€â”€â•”â•â•šâ•—â•‘â•šâ•â•â•‘ â•šâ•â•â•â•â•šâ•â•šâ•â”€â•šâ•â•â•â•â•šâ•â•â•â•â•šâ•â”€â•šâ•â”€â”€â”€â”€â•šâ•â”€â”€â”€â•šâ•â•â•â•šâ•â•â•â• 5HHHG HH HHHHHHH 9HHHA HHHHHHHH5 HHHHHHHHHHHHHHHHHH 9HHHHH5 5HHHHHHHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHHHHHHHHH ;HHHHHHHHHHHHHHHHHHHHHHHHHHA H2 HHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHHHH9 HHHHHHHHHHHHHHHHHHHHHHH AHHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHH9 iHS HHHHHHHHHHHHHHHHHHHHHHhh HHHHHHHHHHHHHHHHHH AA HHHHHHHHHHHHHH3 &amp;H Hi HS Hr &amp; H&amp; H&amp; Hi</code> </pre> <a name="habracut"></a><br><h2 id="entry">  Entrada </h2><br><p>  Quero falar sobre o desenvolvimento da minha pequena biblioteca em php.  Que tarefas ela resolve?  Por que eu decidi escrever e por que poderia ser Ãºtil para vocÃª?  Bem, tente responder a estas perguntas. </p><br><p>  <strong>O GreenPig</strong> (daqui em diante <strong>GP</strong> ) Ã© um pequeno assistente de banco de dados que pode complementar a funcionalidade de qualquer estrutura php usada. </p><br><p>  Como qualquer ferramenta <strong>GP</strong> , ela Ã© aprimorada para resolver certos problemas.  SerÃ¡ Ãºtil se vocÃª preferir escrever consultas de banco de dados em sql puro e nÃ£o usar o registro ativo e outras tecnologias semelhantes.  Por exemplo, temos um banco de dados Oracle em funcionamento e, muitas vezes, consultas ocupam vÃ¡rias telas com dezenas de junÃ§Ãµes, funÃ§Ãµes plsql, uniÃ£o de todas, etc., ainda sÃ£o usadas.  etc., entÃ£o nÃ£o hÃ¡ mais nada a fazer alÃ©m de escrever consultas em sql puro. </p><br><p>  Mas com essa abordagem, surge a pergunta: como gerar onde a parte da consulta sql quando os usuÃ¡rios pesquisam informaÃ§Ãµes?  <strong>O GP</strong> visa, em primeiro lugar, a compilaÃ§Ã£o conveniente por meio do php, onde hÃ¡ uma solicitaÃ§Ã£o de qualquer complexidade. </p><br><p>  Mas o que me levou a escrever nesta biblioteca (exceto, Ã© claro, para obter uma experiÃªncia interessante)?  Estas sÃ£o trÃªs coisas: </p><br><p>  Primeiro, a necessidade de obter nÃ£o uma resposta simples padrÃ£o do banco de dados, mas uma matriz aninhada em forma de Ã¡rvore. </p><br><div class="spoiler">  <b class="spoiler_title">Aqui estÃ¡ um exemplo de uma amostra de banco de dados padrÃ£o:</b> <div class="spoiler_text"><pre> <code class="php hljs">[ [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ], [<span class="hljs-number"><span class="hljs-number">3</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">4</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">5</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">6</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">7</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">8</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">9</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">10</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">11</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">12</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">13</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">14</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ], [<span class="hljs-number"><span class="hljs-number">15</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">16</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">17</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ] ]</code> </pre> </div></div><br><p>  Para obter uma matriz semelhante a uma Ã¡rvore, precisamos trazer o resultado para o formulÃ¡rio desejado ou fazer N consultas ao banco de dados para cada produto.  E se precisamos de paginaÃ§Ã£o, e mesmo com classificaÃ§Ã£o?  <strong>GP</strong> Ã© capaz de resolver esses problemas.  Aqui estÃ¡ um exemplo de uma amostra com <strong>GP</strong> : </p><br><pre> <code class="php hljs">[ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'prod_type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'properties'</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ] [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ] [<span class="hljs-number"><span class="hljs-number">3</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ] ] ] [<span class="hljs-number"><span class="hljs-number">4</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'prod_type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'properties'</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">10</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ] [<span class="hljs-number"><span class="hljs-number">8</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ] [<span class="hljs-number"><span class="hljs-number">9</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ] ] ] ]</code> </pre> <br><p>  E, Ã© claro, ao mesmo tempo, conveniente paginaÃ§Ã£o e classificaÃ§Ã£o: <code>-&gt;pagination(1, 10)-&gt;sort('id')</code> . </p><br><p>  A segunda razÃ£o nÃ£o Ã© tÃ£o frequente, mas, no entanto, ocorre (e no meu caso, essa Ã© a principal razÃ£o).  Se algumas entidades estiverem armazenadas no banco de dados e as propriedades dessas entidades forem dinÃ¢micas e definidas pelos usuÃ¡rios, quando vocÃª precisar procurar entidades por suas propriedades, serÃ¡ necessÃ¡rio adicionar (ingressar) na mesma tabela com os valores das propriedades (quantas vezes forem usadas propriedades ao pesquisar).  Portanto, o GP o ajudarÃ¡ a conectar todas as tabelas e gerar a consulta where com quase uma funÃ§Ã£o.  No final do artigo, analisarei esse caso em detalhes. </p><br><p>  E, finalmente, tudo isso deve funcionar para o banco de dados Oracle e para o mySql.  HÃ¡ tambÃ©m vÃ¡rios recursos descritos na documentaÃ§Ã£o. </p><br><p>  Ã‰ possÃ­vel que eu tenha inventado outra bicicleta, mas procurei conscientemente e nÃ£o encontrei uma soluÃ§Ã£o adequada para mim.  Se vocÃª conhece uma biblioteca que resolve esses problemas - escreva nos comentÃ¡rios. </p><br><p>  Antes de prosseguir diretamente para um exame da prÃ³pria biblioteca e para exemplos, direi que haverÃ¡ apenas a essÃªncia, sem explicaÃ§Ãµes detalhadas.  Se vocÃª se interessar em como o <strong>GP</strong> funciona, pode ver a <a href="https://falbin.ru/documentation/greenpig">documentaÃ§Ã£o</a> , tentei explicar tudo em detalhes. </p><br><h2 id="libraryconnection">  ConexÃ£o de biblioteca </h2><br><p>  A biblioteca pode ser instalada via compositor: o <code>composer require falbin/green-pig-dao</code> </p><br><p>  EntÃ£o vocÃª precisa escrever uma fÃ¡brica atravÃ©s da qual vocÃª usarÃ¡ esta biblioteca. </p><br><h2 id="where">  Onde classe </h2><br><p>  Usando essa classe, vocÃª pode compor a parte where da consulta sql de qualquer complexidade. </p><br><h3 id="partrequest">  Parte atÃ´mica da solicitaÃ§Ã£o </h3><br><p>  Considere a menor parte atÃ´mica de uma consulta.  Ã‰ descrito por uma matriz: <code>[, , ]</code> <br>  Exemplo: <code>['name', 'like', '%%']</code> </p><br><ul><li>  <strong>O primeiro elemento da</strong> matriz Ã© apenas uma string, inserida na consulta sql sem alteraÃ§Ãµes e, portanto, vocÃª pode escrever funÃ§Ãµes sql nela.  Exemplo: <code>['LOWER(name)', 'like', '%%']</code> </li><li>  <strong>O segundo elemento</strong> tambÃ©m Ã© uma string inserida no sql sem alteraÃ§Ãµes entre dois operandos.  Pode aceitar os seguintes valores: <em>=,&gt;, &lt;,&gt; =, &lt;=, &lt;&gt;, como, nÃ£o como, entre, nÃ£o entre, dentro, nÃ£o dentro</em> . </li><li>  <strong>O terceiro elemento da</strong> matriz pode ser do tipo numÃ©rico ou de sequÃªncia.  Onde a classe substituirÃ¡ automaticamente o alias gerado na consulta sql. </li><li>  <strong>Elemento de matriz com chave sql.</strong>  Ã€s vezes Ã© necessÃ¡rio que o valor seja inserido no cÃ³digo sql sem alteraÃ§Ãµes.  Por exemplo, para aplicar funÃ§Ãµes.  Isso pode ser conseguido especificando 'sql' como a chave (para o terceiro elemento).  Exemplo: <code>['LOWER(name)', 'like', 'sql' =&gt; "LOWER('$name')"]</code> </li><li>  <strong>Um elemento de matriz com a chave de ligaÃ§Ã£o</strong> Ã© uma matriz para armazenar ligaÃ§Ãµes.  O exemplo acima estÃ¡ errado do ponto de vista da seguranÃ§a.  VocÃª nÃ£o pode inserir variÃ¡veis â€‹â€‹no sql - Ã© muita injeÃ§Ã£o.  Portanto, nesse caso, vocÃª precisarÃ¡ especificar aliases, por exemplo, assim: <code>['LOWER(name)', 'like', 'sql' =&gt; "LOWER(:name)", 'bind'=&gt; ['name' =&gt; $name] ]</code> </li><li>  <strong>O operador in</strong> pode ser escrito assim: <code>['curse', 'not in', [1, 3, 5]]</code> .  A classe Where converte essa entrada no seguinte cÃ³digo sql: <code>curse not in (:al_where_jCgWfr95kh, :al_where_mCqefr95kh, :al_where_jCfgfr9Gkh)</code> </li><li>  <strong>A declaraÃ§Ã£o entre</strong> pode ser escrita assim: <code>['curse', ' between', 1, 5]</code> .  A classe Where converte essa entrada no seguinte cÃ³digo sql: <code>curse between :al_where_Pi4CRr4xNn and :al_where_WiPPS4NKiG</code> <br>  Mas tenha cuidado, se o terceiro e o quarto elementos da matriz forem seqÃ¼Ãªncias de caracteres, uma lÃ³gica especial serÃ¡ aplicada.  Nesse caso, acredita-se que a seleÃ§Ã£o seja de um intervalo de datas e, portanto, Ã© usada a funÃ§Ã£o sql de converter uma string para uma data.  A funÃ§Ã£o de conversÃ£o para uma data (mySql e Oracle tÃªm diferentes) e seus parÃ¢metros sÃ£o obtidos de uma matriz de configuraÃ§Ãµes (mais na documentaÃ§Ã£o).  A matriz <code>['build_date', 'between', '01.01.2016', '01.01.2019']</code> serÃ¡ convertida em sql: <code>build_date between TO_DATE(:al_where_fkD7nZg5lU, 'dd.mm.yyyy hh24:mi::ss') and TO_DATE(:al_where_LdyVRznPF8, 'dd.mm.yyyy hh24:mi::ss')</code> </li></ul><br><h3 id="complicatedqueries">  Consultas complicadas </h3><br><p>  Vamos criar uma instÃ¢ncia da classe atravÃ©s da fÃ¡brica: <code>$wh = GP::where();</code> </p><br><p>  Para indicar a conexÃ£o lÃ³gica entre as "partes atÃ´micas" da solicitaÃ§Ã£o, vocÃª deve usar as <code>linkAnd()</code> ou <code>linkOr()</code> .  Um exemplo: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// sql: (old &gt; 18 and old &lt; 50) $wh-&gt;linkAnd([ ['old', '&lt;', 18], ['old', '&gt;', 50] ]); // sql: (old &lt; 18 or old &gt; 50) $wh-&gt;linkOr([ ['old', '&lt;', 18], ['old', '&gt;', 50] ]);</span></span></code> </pre> <br><p>  Ao usar as <strong>funÃ§Ãµes linkAnd / linkOr,</strong> todos os dados sÃ£o armazenados em uma instÃ¢ncia da classe Where - $ wh.  AlÃ©m disso, todas as "partes atÃ´micas" indicadas na funÃ§Ã£o <strong>estÃ£o entre colchetes</strong> . </p><br><p>  O SQL de qualquer complexidade pode ser descrito por trÃªs funÃ§Ãµes: <code>linkAnd(), linkOr(), getRaw()</code> .  Considere um exemplo: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// sql: curse = 1 and (old &lt; 18 or old &gt; 50) $wh-&gt;linkAnd([ ['curse', '=', 1], $wh-&gt;linkOr([ ['old', '&lt;', 18], ['old', '&gt;', 50] ])-&gt;getRaw() ]);</span></span></code> </pre> <br><p>  A classe Where tem uma variÃ¡vel privada que armazena a expressÃ£o bruta.  Os <code>linkAnd()</code> e <code>linkOr()</code> sobrescrevem essa variÃ¡vel, portanto, ao construir uma expressÃ£o lÃ³gica, os mÃ©todos sÃ£o aninhados juntos e a variÃ¡vel com a expressÃ£o bruta contÃ©m dados obtidos do Ãºltimo mÃ©todo executado. </p><br><h2 id="join">  Classe JOIN </h2><br><p>  <strong>Join</strong> Ã© uma classe que gera um fragmento de junÃ§Ã£o do cÃ³digo sql.  Vamos criar uma instÃ¢ncia da classe atravÃ©s da fÃ¡brica: <code>$jn = GP::leftJoin('coursework', 'student_id', 's.id')</code> , onde: </p><br><ul><li>  <strong>o curso</strong> Ã© a mesa em que vamos nos juntar </li><li>  <strong>student_id</strong> - uma coluna com uma chave estrangeira da tabela de <strong>cursos</strong> . </li><li>  <strong>s.id</strong> - a coluna da tabela com a qual a junÃ§Ã£o deve ser escrita junto com o alias da tabela (nesse caso, o alias da tabela Ã© s). </li></ul><br><p>  <code>left JOIN coursework coursework_joM9YuTTfW ON coursework_joM9YuTTfW.student_id = s.id</code> gerado: <code>left JOIN coursework coursework_joM9YuTTfW ON coursework_joM9YuTTfW.student_id = s.id</code> </p><br><p>  Ao criar uma instÃ¢ncia da classe, jÃ¡ descrevemos a condiÃ§Ã£o para juntar tabelas, mas pode ser necessÃ¡rio esclarecer e expandir a condiÃ§Ã£o.  As <strong>funÃ§Ãµes linkAnd / linkOr</strong> ajudarÃ£o vocÃª a fazer isso: <code>$jn-&gt;linkAnd(['semester_number', '&gt;', 2])</code> </p><br><p>  <code>inner JOIN coursework coursework_Nd1n5T7c0r ON coursework_Nd1n5T7c0r.student_id = s.id and (semester_number &gt; :al_where_M1kEcHzZyy)</code> gerado: <code>inner JOIN coursework coursework_Nd1n5T7c0r ON coursework_Nd1n5T7c0r.student_id = s.id and (semester_number &gt; :al_where_M1kEcHzZyy)</code> </p><br><p>  Se houver vÃ¡rias tabelas para ingressar, vocÃª poderÃ¡ combinÃ¡-las em uma classe: <strong>CollectionJoin</strong> . </p><br><h2 id="query">  Consulta de classe </h2><br><p>  Esta Ã© a classe principal para trabalhar com o banco de dados, atravÃ©s dele existe uma seleÃ§Ã£o, gravaÃ§Ã£o, atualizaÃ§Ã£o e exclusÃ£o de dados.  VocÃª tambÃ©m pode executar determinado processamento de dados obtidos no banco de dados. </p><br><p>  Considere um exemplo tÃ­pico. </p><br><p>  Vamos criar uma instÃ¢ncia da classe atravÃ©s da fÃ¡brica: <code>$qr = GP::query();</code> </p><br><p>  Agora vamos definir o modelo sql, substituir os valores necessÃ¡rios para o cenÃ¡rio fornecido no modelo sql e dizer que queremos obter um registro, e especificamente os dados da coluna <strong>average_mark</strong> . </p><br><pre> <code class="php hljs">$rez = $qr-&gt;sql(<span class="hljs-string"><span class="hljs-string">"select /*select*/ from student s inner join mark m on s.id = m.student_id inner join lesson l on l.id = m.lesson_id /*where*/ /*group*/"</span></span>) -&gt;sqlPart(<span class="hljs-string"><span class="hljs-string">'/*select*/'</span></span>, <span class="hljs-string"><span class="hljs-string">'s.name, avg(m.mark) average_mark'</span></span>, []) -&gt;whereAnd(<span class="hljs-string"><span class="hljs-string">'/*where*/'</span></span>, [<span class="hljs-string"><span class="hljs-string">'s.id'</span></span>, <span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) -&gt;sqlPart(<span class="hljs-string"><span class="hljs-string">'/*group*/'</span></span>, <span class="hljs-string"><span class="hljs-string">'group by s.name'</span></span>, []) -&gt;one(<span class="hljs-string"><span class="hljs-string">'average_mark'</span></span>);</code> </pre> <br><p>  Resultado: <code>3,16666666666666666666666666666666666667</code> </p><br><h3 id="selection">  SeleÃ§Ã£o de um banco de dados com parÃ¢metros aninhados </h3><br><p>  Acima de tudo, nÃ£o tive a oportunidade de obter uma seleÃ§Ã£o do banco de dados em uma exibiÃ§Ã£o em Ã¡rvore, com propriedades anexadas.  Portanto, a biblioteca GP tem essa oportunidade e a profundidade do aninhamento nÃ£o Ã© limitada. </p><br><p>  A maneira mais fÃ¡cil de considerar o princÃ­pio de operaÃ§Ã£o Ã© baseada em um exemplo.  Para consideraÃ§Ã£o, adotamos o seguinte <strong>esquema de banco de dados:</strong> </p><br><p><img src="https://habrastorage.org/webt/tt/ih/_o/ttih_oflaq8cvslm1yiutxabp8q.png"></p><br><p>  <strong>ConteÃºdo da tabela:</strong> </p><br><p><img src="https://habrastorage.org/webt/z4/v4/aa/z4v4aa7oci4w-9q7nrncht1tceu.png"></p><br><p>  FreqÃ¼entemente, ao consultar um banco de dados, vocÃª deseja obter uma resposta semelhante a uma Ã¡rvore, nÃ£o uma resposta simples.  Por exemplo, executando esta consulta: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> s.id, s.name, c.id title_id, c.title <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> student s <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> coursework c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c. student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> s.id = <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Temos um resultado simples: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Â«Â»    '</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span>=&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span> ] ]</code> </pre> <br><p>  Usando o GP, vocÃª pode obter este resultado: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Â«Â»    '</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>] ] ] ]</code> </pre> <br><p>  Para alcanÃ§ar esse resultado, vocÃª precisa passar uma matriz com opÃ§Ãµes para a funÃ§Ã£o <code>all</code> (a funÃ§Ã£o retorna todas as linhas de consulta): </p><br><pre> <code class="php hljs">all([ <span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span> ] ])</code> </pre> <br><p>  A matriz <code>$option</code> no <strong>agregador de</strong> funÃ§Ãµes <strong>( <code>$option</code> , $ rawData)</strong> e <strong>all ( <code>$options</code> )</strong> Ã© criada de acordo com as seguintes regras: </p><br><ul><li>  <strong>Chaves de matriz</strong> - nomes de colunas.  <strong>Elementos da matriz</strong> - novos nomes para colunas, vocÃª pode inserir o nome antigo. </li><li>  HÃ¡ uma palavra reservada para valores de matriz - <code>pk</code> .  Ele diz que os dados serÃ£o agrupados por esta coluna (a chave da matriz Ã© o nome da coluna). </li><li>  Em cada nÃ­vel, deve haver apenas um <code>pk</code> . </li><li>  Na matriz agregada (resultante), os valores da coluna declarada por <code>pk</code> serÃ£o usados â€‹â€‹como chaves. </li><li>  Se for necessÃ¡rio colocar parte das colunas em um nÃ­vel mais baixo, um novo nome inventado serÃ¡ usado como uma chave de matriz, e uma matriz construÃ­da de acordo com as regras descritas acima serÃ¡ usada como valor. </li></ul><br><p>  Considere um exemplo mais complexo.  Suponha que precisamos obter todos os alunos com o nome de seus cursos e com todas as notas em todas as disciplinas.  GostarÃ­amos de recebÃª-lo nÃ£o em uma forma plana, mas em uma Ã¡rvore, sem duplicatas.  Abaixo estÃ¡ a consulta desejada para o banco de dados e o resultado. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> s.id student_id, s.name student_name, s.semester_number, c.id coursework_id, c.semester_number coursework_semester, c.title coursework_title, l.id lesson_id, l.name lesson, m.id mark_id, m.mark <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> student s <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> coursework c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> mark m <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> m.student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> lesson l <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.id = m.lesson_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> s.id, c.id, l.id, m.id</code> </pre> <br><p>  O resultado nÃ£o nos convÃ©m: </p><br><p><img src="https://habrastorage.org/webt/er/mj/7p/ermj7p5zki1g4hfxausavajfcps.png"></p><br><p>  Para realizar a tarefa, vocÃª precisa escrever a seguinte matriz de <code>$option</code> : </p><br><pre> <code class="php hljs">$option = [ <span class="hljs-string"><span class="hljs-string">'student_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'student_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'coursework_semester'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'coursework_title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span> ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'lesson'</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'mark_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mark'</span></span> ] ] ];</code> </pre> <br><p>  Consulta ao banco de dados: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//    Query   .       // (    yii2) $qr = Yii::$app-&gt;gp-&gt;query( "SELECT s.id student_id, s.name student_name, s.semester_number, c.id coursework_id, c.semester_number coursework_semester, c.title coursework_title, l.id lesson_id, l.name lesson, m.id mark_id, m.mark FROM student s LEFT JOIN coursework c ON c.student_id = s.id LEFT JOIN mark m ON m.student_id = s.id LEFT JOIN lesson l ON l.id = m.lesson_id ORDER BY s.id, c.id, l.id, m.id"); //   1,  2   3  //  1 $result = $qr-&gt;all($option); //  2 $result = $qr-&gt;aggregator($option, $qr-&gt;all()); //  3 $qr-&gt;all(); $result = $qr-&gt;aggregator($option, $qr-&gt;rawData());</span></span></code> </pre> <br><p>  A funÃ§Ã£o <code>aggregator</code> pode processar qualquer matriz com uma estrutura semelhante ao resultado de uma consulta ao banco de dados, de acordo com as regras descritas na <code>$option</code> . </p><br><p>  A variÃ¡vel <code>$result</code> contÃ©m os seguintes dados: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'    '</span></span>], ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Â«Â»    '</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>] ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">17</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">18</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">20</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">16</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">19</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>] ] ], ] ] ]</code> </pre> <br><p>  A propÃ³sito, com paginaÃ§Ã£o com consulta agregada, apenas os dados mais bÃ¡sicos sÃ£o considerados.  No exemplo acima, haverÃ¡ apenas 2 linhas para paginaÃ§Ã£o. </p><br><h2 id="union">  UniÃ£o mÃºltipla consigo no nome da pesquisa </h2><br><p>  Como escrevi anteriormente, a principal tarefa da minha biblioteca Ã© simplificar a geraÃ§Ã£o das partes where para consultas selecionadas.  EntÃ£o, nesse caso, talvez seja necessÃ¡rio juntar-nos repetidamente Ã  mesma tabela para a consulta where?  Uma das opÃ§Ãµes Ã© quando temos um determinado produto cujas propriedades nÃ£o sÃ£o conhecidas antecipadamente e serÃ£o adicionadas pelos usuÃ¡rios, e precisamos ter a oportunidade de procurar produtos por essas propriedades dinÃ¢micas.  A maneira mais fÃ¡cil de explicar com um exemplo simplificado. </p><br><p>  Suponha que tenhamos uma loja on-line vendendo componentes de computador e que nÃ£o tenhamos uma variedade rigorosa e que compraremos periodicamente um componente ou outro.  Mas gostarÃ­amos de descrever todos os nossos produtos como uma Ãºnica entidade e procurar todos os produtos.  Portanto, quais entidades podem ser distinguidas do ponto de vista da lÃ³gica de negÃ³cios: </p><br><ol><li>  <strong>Produto.</strong>  A entidade mais importante em torno da qual tudo Ã© construÃ­do. </li><li>  <strong>Tipo de produto.</strong>  Isso pode ser representado como a propriedade raiz de todas as outras propriedades do produto.  Por exemplo, em nossa pequena loja, Ã© apenas: RAM, SSD e HDD. </li><li>  <strong>Propriedades do produto.</strong>  Em nossa implementaÃ§Ã£o, qualquer propriedade pode ser aplicada a qualquer tipo de produto, a escolha permanece na consciÃªncia do gerente.  Em nossa loja, os gerentes criaram apenas trÃªs propriedades: tamanho da memÃ³ria, fator de forma e DDR. </li><li>  <strong>O valor das mercadorias.</strong>  O valor que o comprador irÃ¡ gerar na pesquisa. </li></ol><br><p>  Toda a lÃ³gica de negÃ³cios descrita acima Ã© refletida em detalhes na imagem abaixo. </p><br><p><img src="https://habrastorage.org/webt/z1/gx/um/z1gxum4ba1zhvsilqqdqijndt94.png"></p><br><p>  Por exemplo, temos um produto: <strong>16 GB DDR 3 RAM</strong> .  No diagrama, isso pode ser exibido da seguinte maneira: </p><br><p><img src="https://habrastorage.org/webt/kz/lp/-x/kzlp-xtvozjhyffgboxtbqr7qri.png"></p><br><p>  A estrutura e os dados do banco de dados sÃ£o claramente visÃ­veis na figura a seguir: </p><br><p><img src="https://habrastorage.org/webt/es/lk/8a/eslk8aungbzzjqtpjnejscp6ywk.png"></p><br><p>  Como podemos ver no diagrama, todos os valores de todas as propriedades sÃ£o armazenados em uma tabela de valores (a propÃ³sito, em nossa versÃ£o simplificada, todas as propriedades tÃªm valores numÃ©ricos).  Portanto, se queremos procurar simultaneamente vÃ¡rias propriedades com um monte de AND, obtemos uma seleÃ§Ã£o vazia. </p><br><p>  Por exemplo, um comprador estÃ¡ procurando produtos adequados para essa solicitaÃ§Ã£o: a <em>quantidade de memÃ³ria deve ser superior a 10 GB e o fator de forma deve ser de 2,5 polegadas</em> .  Se escrevermos sql como mostrado abaixo, obteremos uma seleÃ§Ã£o vazia: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> product p <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> val v <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> v.product_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> (v.property_id = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> v.value &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (v.property_id = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> v.value = <span class="hljs-number"><span class="hljs-number">2.5</span></span>)</code> </pre> <br><p>  Como os valores de todas as propriedades sÃ£o armazenados em uma tabela, para procurar vÃ¡rias propriedades, vocÃª deve associar o valor da tabela a cada propriedade que serÃ¡ pesquisada.  Mas hÃ¡ uma nuance: join junta tabelas "horizontalmente" (para a palavra uniÃ£o todas as junÃ§Ãµes "verticalmente"), o seguinte Ã© um exemplo: </p><br><p><img src="https://habrastorage.org/webt/00/th/4d/00th4d4mehwetkemk7vnkvqukr4.png"></p><br><p>  Este resultado nÃ£o nos convÃ©m, gostarÃ­amos de ver todos os valores em uma coluna.  Para fazer isso, vocÃª precisa associar-se Ã  tabela val 1 vezes mais do que as propriedades pelas quais a pesquisa Ã© realizada. </p><br><p><img src="https://habrastorage.org/webt/pp/br/rp/ppbrrphdkttykoq0uexraglkcve.png"></p><br><p>  Estamos perto de gerar automaticamente a consulta sql.  Vamos olhar para a funÃ§Ã£o <br>  <code>whereWithJoin ($aliasJoin, $options, $aliasWhere, $where)</code> , que farÃ¡ todo o trabalho: </p><br><ul><li>  <strong>$ aliasJoin</strong> - um alias no modelo base, em vez do qual a parte sql com junÃ§Ãµes Ã© substituÃ­da. </li><li>  <strong>$ options</strong> - uma matriz com descriÃ§Ãµes das regras para gerar a parte de junÃ§Ã£o. </li><li>  <strong>$ aliasWhere</strong> - um alias no modelo base, que substitui a parte where sql. </li><li>  <strong>$ where</strong> Ã© uma instÃ¢ncia da classe Where. </li></ul><br><p>  Vejamos um exemplo: <code>whereWithJoin('/*join*/', $options, '/*where*/', $wh)</code> . </p><br><p>  Primeiro, crie a variÃ¡vel <strong>$ options</strong> : <code>$options = ['v' =&gt; ['val', 'product_id', 'p.id']];</code> </p><br><p>  <strong>v</strong> Ã© o alias da tabela.  Se o alias dado for encontrado em <strong>$ wh</strong> , uma nova tabela <strong>val</strong> serÃ¡ conectada por join (onde <strong>product_id</strong> Ã© a chave estrangeira da tabela <strong>val</strong> e <strong>p.id</strong> Ã© a chave primÃ¡ria da tabela com o alias <strong>p</strong> ), um novo alias e esse alias serÃ£o gerados para ela substituirÃ¡ <strong>v</strong> em onde. </p><br><p>  <strong>$ wh</strong> Ã© uma instÃ¢ncia da classe Where.  Formamos a mesma solicitaÃ§Ã£o: <em>a memÃ³ria deve ter mais de 10 GB e o fator de forma deve ter 2,5 polegadas.</em> </p><br><pre> <code class="php hljs">$wh-&gt;linkAnd([ $wh-&gt;linkAnd([ [<span class="hljs-string"><span class="hljs-string">'v.property_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], [<span class="hljs-string"><span class="hljs-string">'v.value'</span></span>, <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>] ])-&gt;getRaw(), <span class="hljs-comment"><span class="hljs-comment">//    $wh-&gt;linkAnd([ ['v.property_id', '=', 3], ['v.value', '=', 2.5] ])-&gt;getRaw(),//    ]);</span></span></code> </pre> <br><p>  Ao criar uma solicitaÃ§Ã£o where, Ã© necessÃ¡rio agrupar a peÃ§a com a propriedade id e seu valor entre colchetes, isso informa Ã  funÃ§Ã£o <code>whereWithJoin()</code> que o alias da tabela serÃ¡ o mesmo nesta parte. </p><br><pre> <code class="php hljs">$qr-&gt;sql(<span class="hljs-string"><span class="hljs-string">"select p.id, t.name type_name, pr.id prop_id, pr.name prop_name, v.id val_id, v.value from product p inner join type t on t.id = p.type_id inner join val v on v.product_id = p.id inner join properties pr on pr.id = v.property_id /*join*/ /*where*/"</span></span>) -&gt;whereWithJoin(<span class="hljs-string"><span class="hljs-string">'/*join*/'</span></span>, $options, <span class="hljs-string"><span class="hljs-string">'/*where*/'</span></span>, $wh) <span class="hljs-comment"><span class="hljs-comment">//     . -&gt;all([ 'id' =&gt; 'pk', 'type_name' =&gt; 'type', 'properties' =&gt; [ 'prop_id' =&gt; 'pk', 'prop_name' =&gt; 'name', 'values' =&gt; [ 'val_id' =&gt; 'pk', 'value' =&gt; 'val' ] ] ]);</span></span></code> </pre> <br><p>  Examinamos o sql gerado, as <code>$qr-&gt;debugInfo()</code> e o tempo de execuÃ§Ã£o da consulta: <code>$qr-&gt;debugInfo()</code> : </p><br><pre> <code class="php hljs">[ [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'info'</span></span>, <span class="hljs-string"><span class="hljs-string">'sql'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'select p.id, t.name type_name, pr.id prop_id, pr.name prop_name, v.id val_id, v.value from product p inner join type t on t.id = p.type_id inner join val v on v.product_id = p.id inner join properties pr on pr.id = v.property_id inner JOIN val val_mIQWpnHhdQ ON val_mIQWpnHhdQ.product_id = p.id inner JOIN val val_J0uveMpwEM ON val_J0uveMpwEM.product_id = p.id WHERE ( val_mIQWpnHhdQ.property_id = :al_where_leV5QlmOZN and val_mIQWpnHhdQ.value &gt; :al_where_ycleYAswIw ) and ( val_J0uveMpwEM.property_id = :al_where_dinxDraTOE and val_J0uveMpwEM.value = :al_where_wZJhUqs74i )'</span></span>, <span class="hljs-string"><span class="hljs-string">'binds'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'al_where_leV5QlmOZN'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_ycleYAswIw'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_dinxDraTOE'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_wZJhUqs74i'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], <span class="hljs-string"><span class="hljs-string">'timeQuery'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0384588241577</span></span> ] ]</code> </pre> <br><p>      <code>$qr-&gt;rawData()</code> : </p><br><pre> <code class="php hljs">[ [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">512</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">256</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1024</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ] ]</code> </pre> <br><p>        <code>$qr-&gt;aggregateData()</code> : </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">512</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">256</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">8</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">11</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1024</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">12</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ] ]</code> </pre> <br><p>     ,   ,    <code>whereWithJoin()</code> ,    . </p><br><p>  <code>whereWithJoin()</code> ,    ,      <strong>n</strong>    ,   <strong>m</strong>    .  <strong>n</strong>  <strong>m</strong>     1         id    .        ,      <strong>AND</strong> . </p><br><hr><br><p>        <a href="https://falbin.ru/documentation/greenpig/"></a>     <a href="https://github.com/mrFalbin/green-pig-dao/tree/master">GitHub</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt483458/">https://habr.com/ru/post/pt483458/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt483440/index.html">Ãšltimos compiladores D</a></li>
<li><a href="../pt483444/index.html">RelatÃ³rio DORA 2019: Como melhorar o desempenho do DevOps</a></li>
<li><a href="../pt483446/index.html">Cientistas descobriram uma nova maneira de diminuir os nÃ­veis de ferro na Ã¡gua potÃ¡vel</a></li>
<li><a href="../pt483448/index.html">Disney - A maior via dupla da histÃ³ria da humanidade</a></li>
<li><a href="../pt483454/index.html">Mudando de Mercurial para GIT no Atlassian Bitbucket com salvando arquivos em cirÃ­lico</a></li>
<li><a href="../pt483460/index.html">HowTo SQL: construindo cadeias usando funÃ§Ãµes de janela</a></li>
<li><a href="../pt483462/index.html">Cale a boca e pegue meu dinheiro</a></li>
<li><a href="../pt483466/index.html">Introduzindo o mÃ©todo de retropropagaÃ§Ã£o</a></li>
<li><a href="../pt483468/index.html">Testes de integraÃ§Ã£o de vibraÃ§Ã£o - Ã© fÃ¡cil</a></li>
<li><a href="../pt483470/index.html">Coloque blocos de forma eficiente (Pro CSS, SVG, padrÃ£o e muito mais)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>