<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§òüèø üèïÔ∏è üóæ Speichern der Elementfarbe in der Navisworks-Datenbank üßó üì∏ üí¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aufgabenhintergrund 


 F√ºr den Kunden ist beispielsweise ein Problem aufgetreten: 


- Werfen Sie die Geb√§udemodellelemente in 1C ab. 
- Verwenden Si...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Speichern der Elementfarbe in der Navisworks-Datenbank</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450248/"><h2 id="predystoriya-zadachi">  Aufgabenhintergrund </h2><br><p>  F√ºr den Kunden ist beispielsweise ein Problem aufgetreten: </p><br><ul><li>  Werfen Sie die Geb√§udemodellelemente in 1C ab. </li><li>  Verwenden Sie in 1C diese Teile des Modells in Vertr√§gen. Nehmen wir beispielsweise an, dass solche und solche Elemente bereits erstellt wurden, solche und solche nur geplant sind usw. </li><li>  In Navisworks k√∂nnen Sie dies in einer Zeichnung sehen, indem Sie beispielsweise Modellelemente in verschiedenen Farben anzeigen.  Zu diesem Zweck haben sie ein Plug-In f√ºr Navisworks erstellt, mit dem Daten aus Quantifizierungstabellen (Starttabellen) nach 1C kopiert sowie von 1C zur√ºckgenommen und in Starttabellen abgelegt werden k√∂nnen. <br>  Und in 1C wurde angenommen, dass die im Vertrag verwendeten Modellelemente (R√§ume) ihre Farbe √§ndern sollten. </li></ul><br><p>  Erst jetzt stellte sich heraus, dass Navisworks nach dem √Ñndern dieser Tabellendaten in 1C nicht versteht, dass sie sich ge√§ndert haben, und dass sie aktualisiert werden m√ºssten.  Deshalb muss ich, der Programmierer, ihm das sagen. </p><br><h2 id="itak-zadacha-dlya-programmista">  Also die Aufgabe f√ºr den Programmierer </h2><br><p>  Nach dem Austausch mit 1C haben sich die Daten in der Tabelle TK_Item ge√§ndert - insbesondere das Feld Farbe.  Es ist notwendig, die Farben in der angezeigten Zeichnung in √úbereinstimmung mit den in der Tabelle angegebenen zu bringen. </p><a name="habracut"></a><br><p>  Wir suchen nach M√∂glichkeiten, dies zu tun.  Wir graben die Beschreibung.  Wir finden die Funktion - </p><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OverridePermanentColor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;ModelItem&gt; items, Color color</span></span></span><span class="hljs-function">)</span></span></code> </pre> <br><p>  Wie Sie Modellelemente finden, die dem ausgew√§hlten TK_Item-Element entsprechen, ist eine andere Geschichte. Ich werde Ihnen ein anderes Mal erz√§hlen, wenn es interessant ist.  Aber wer braucht es - und er wird es herausfinden.  Aber mit Farbe erwies sich alles als interessanter. <br>  Erstens ist die in den Parametern der Funktion angegebene Farbe nicht System.Drawing.Color, sondern sogar Autodesk.Navisworks.Api.Color mit seinem Blackjack und ... nun, Sie verstehen.  Nun, lass es sein, aber er hat einen solchen Konstruktor: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsafe</span></span></span><span class="hljs-function"> Color </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FromByteRGB</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> red, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> green, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> blue</span></span></span><span class="hljs-function">)</span></span></code> </pre> <br><p>  Daher werden wir ohne Probleme eine Farbe erstellen, die die Autodesk-API ben√∂tigt. <br>  (Eigentlich sollte ich zuerst versuchen, die Elemente zu finden, die dem ausgew√§hlten Element entsprechen, eine Farbe ausw√§hlen und auf diese Farbe einstellen.) </p><br><p>  Aber.  In der Tabelle haben wir im Feld Farbe einen Wert vom Typ Int64.  Und wie man es mit einem Objekt vom Typ Farbe vergleicht, ist unklar. </p><br><p>  Au√üerdem konnte ich weder in der Dokumentation noch im Forum noch in den Beispielen finden, wie es in der Datenbank geschrieben ist. </p><br><p>  OK, wir werden experimentell graben. </p><br><p>  Wir nehmen Navisworks, √∂ffnen Quantifizierung, √§ndern die Farbe eines Elements.  Sagen wir auf einem ehrlichen, sauberen Rot. </p><br><p><img src="https://pp.userapi.com/c846017/v846017649/1f3a4c/v2x4VoIrW1E.jpg" alt="Bild"></p><br><p>  Danach nehmen wir unser Plugin, pumpen ihnen die Daten aus der TK_Item-Tabelle und schauen, was ist in der Tabelle? </p><br><p>  (Gl√ºcklicherweise bot das Plug-In f√ºr Debugging-Zwecke eine solche Option - Daten herunterladen und auf dem Formular anzeigen.) </p><br><p>  Es stellt sich heraus, dass es -65536 ist. </p><br><p><img src="https://pp.userapi.com/c846017/v846017649/1f3a45/7Q1YusQG91I.jpg" alt="Bild"></p><br><p>  Wiederholen Sie den Vorgang mehrmals und reduzieren Sie die Ergebnisse auf eine Textdatei. </p><br><div class="scrollable-table"><table><thead><tr><th>  Titel </th><th>  Farbe </th><th>  Farbwert in Tabelle </th><th>  Bin√§re Darstellung der Farbe in einer Tabelle </th></tr></thead><tbody><tr><td>  Wandtyp 1.1 √ºber der Markierung  0,000 </td><td>  Rot </td><td>  -65536 </td><td>  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 0000 0000 0000 0000 </td></tr><tr><td>  Wandtyp 1.2 √ºber der Markierung  0,000 </td><td>  Gr√ºn </td><td>  -16711936 </td><td>  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 0000 0000 1111 1111 0000 0000 </td></tr><tr><td>  Wandtyp 2.1 √ºber der Markierung  0,000 </td><td>  Blau </td><td>  -16776961 </td><td>  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 0000 0000 0000 0000 1111 1111 </td></tr><tr><td>  Wandtyp 0,1 unter der Marke  0,000 </td><td>  Rot = 16 </td><td>  -15728640 </td><td>  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 0001 0000 0000 0000 0000 0000 </td></tr><tr><td>  Wandtyp 0,2 unter der Marke  0,000 </td><td>  Rot = 17 </td><td>  -15663104 </td><td>  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 0001 0001 0000 0000 0000 0000 </td></tr><tr><td>  Krawatten auf einer H√∂he.  0,000 </td><td>  Rot = 193 Gr√ºn = 32 Blau = 74 </td><td>  12 656 714 </td><td>  0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 1100 0001 0010 0000 0100 1010 </td></tr></tbody></table></div><br><p>  Anfangs war ich sehr √ºberrascht von den Zahlen in der Tabelle und insbesondere vom Vorhandensein positiver und negativer Werte. </p><br><p>  Nachdem ich mit den Werten der Komponenten R, G, B experimentiert hatte, stellte ich fest, dass diese drei Komponenten mit den letzten drei Bytes der Zahl angezeigt werden. </p><br><p>  Aber dann ist es seltsam - warum sind die hohen Bytes mit Einheiten gef√ºllt, nicht mit Nullen? <br>  Wenn wir jedoch annehmen, dass sie immer mit Einheiten gef√ºllt sind, wird das Vorhandensein negativer Zahlen erkl√§rt.  F√ºllen Sie einfach das High-Byte aus, das das Vorzeichen der Zahl bestimmt. <br>  Es gibt aber nicht immer negative Zahlen! </p><br><p>  Und als ich mich nur daran erinnerte, wie die Funktionen &gt;&gt; und &lt;&lt; funktionieren, wurde mir klar, dass sie die hohen Bits dumm mit Zahlen f√ºllen k√∂nnen, einschlie√ülich des Vorzeichenbits.  Und da die wichtigsten Bits nicht ben√∂tigt werden, spielt es keine Rolle, was vorhanden ist. </p><br><p>  Dann ist die Frage: Wof√ºr brauchten sie so viel Bedeutung f√ºr die Farbe?  Bereits 64 Bit?  Ich habe mir die Struktur der Tabellen angesehen, in denen diese Daten gespeichert sind - es wird nur Int64 f√ºr alle Ganzzahlen verwendet.  Wirklich, warum Kleinigkeit? </p><br><h2 id="itog">  Zusammenfassung </h2><br><p>  Der Wert der in der Tabelle aufgezeichneten Farbe wird wie folgt erhalten: </p><br><pre> <code class="cs hljs">Int64 dbColor = Rb&lt;&lt;<span class="hljs-number"><span class="hljs-number">16</span></span> + Gb&lt;&lt;<span class="hljs-number"><span class="hljs-number">8</span></span> + Bb;</code> </pre> <br><p>  Die inverse Transformation - die Tabellenfarbe in die Farbe, die f√ºr die Modellelemente verwendet wird - machen wir folgenderma√üen: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> R = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(dbColorValue &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span> % <span class="hljs-number"><span class="hljs-number">256</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> G = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(dbColorValue &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> % <span class="hljs-number"><span class="hljs-number">256</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> B = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) (dbColorValue % <span class="hljs-number"><span class="hljs-number">256</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> color = Autodesk.Navisworks.Api.Color.FromByteRGB(R, G, B);</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450248/">https://habr.com/ru/post/de450248/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450238/index.html">Validierung der TypeScript-Schnittstelle mit Joi</a></li>
<li><a href="../de450240/index.html">Walmart er√∂ffnet ersten AI-Driven Store</a></li>
<li><a href="../de450242/index.html">Warum brauchten Sie ein anderes PHP-Framework?</a></li>
<li><a href="../de450244/index.html">Wie schreibe und bewerbe ich Wei√übuch?</a></li>
<li><a href="../de450246/index.html">Das R√∂hren-Bounce-Unterdr√ºckungsmodul vom IBM 705-Computer. Was passiert, wenn Sie versuchen, es einzuschalten?</a></li>
<li><a href="../de450252/index.html">Die Chang'e-4-Mission ist der f√ºnfte Mondtag f√ºr das Landemodul und den Yutu-2-Rover</a></li>
<li><a href="../de450256/index.html">Kabelfernsehnetze f√ºr die Kleinsten. Teil 3: Analoge Signalkomponente</a></li>
<li><a href="../de450258/index.html">Kabelfernsehnetze f√ºr die Kleinsten. Teil 4: Digitales Signal</a></li>
<li><a href="../de450260/index.html">Meine Erfahrung mit der staatlichen Digitalisierung oder der Geschichte der Geburt der Digit-Plattform</a></li>
<li><a href="../de450262/index.html">Automatisierung der Typoskriptbibliothek</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>