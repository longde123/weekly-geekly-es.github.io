<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜¶ ğŸ‘©ğŸ½â€ğŸ”¬ ğŸ‘µğŸ» Webinaire ouvert "SELECT ordre d'exÃ©cution des requÃªtes et plan de requÃªte dans MS SQL Server" ğŸ’†ğŸ¿ ğŸ—œï¸ ğŸ‡ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour encore! 

 Chers collÃ¨gues, le dernier jour de janvier, nous lanÃ§ons le cours Â«MS SQL Server DeveloperÂ» , dans le cadre duquel nous avons eu u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Webinaire ouvert "SELECT ordre d'exÃ©cution des requÃªtes et plan de requÃªte dans MS SQL Server"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/437828/">  Bonjour encore! <br><br>  Chers collÃ¨gues, le dernier jour de janvier, nous lanÃ§ons le cours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Â«MS SQL Server DeveloperÂ»</a> , dans le cadre duquel nous avons eu une leÃ§on ouverte thÃ©matique.  Nous y avons expliquÃ© comment MS SQL Server exÃ©cute une requÃªte SELECT, discutÃ© dans quel ordre et ce qui est analysÃ©, et avons Ã©galement plongÃ© un peu dans la lecture du plan de requÃªte. <br><br>  ConfÃ©rencier - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kristina Kucherova</a> , architecte de modÃ¨le de donnÃ©es Ã  la Sberbank de Russie. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/H9oS-eLSX_8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <b>Objectifs et itinÃ©raire du webinaire</b> <br><br>  Les objectifs suivants ont Ã©tÃ© fixÃ©s au dÃ©but du webinaire: <br><br><ol><li>  DÃ©couvrez comment le serveur exÃ©cute la demande et pourquoi cela se produit de cette maniÃ¨re. </li><li>  Apprendre Ã  lire un plan de requÃªte. </li></ol><br>  Pour les atteindre, l'enseignant a prÃ©parÃ© un parcours simple mais efficace: <br><br><img src="https://habrastorage.org/webt/fq/kj/nr/fqkjnrypzokv5wpzw1phclft3xa.jpeg"><br><br>  <b>Pourquoi ai-je besoin d'un plan de requÃªte?</b> <br><br>  Le plan de requÃªte est un outil trÃ¨s utile que, malheureusement, de nombreux dÃ©veloppeurs n'utilisent pas.  Ã€ premiÃ¨re vue, il peut sembler qu'il n'est pas nÃ©cessaire de connaÃ®tre la mÃ©canique de la demande.  Cependant, si vous comprenez ce qui se passe dans SQL Server, vous pouvez Ã©crire une requÃªte plus efficace.  Et cela aidera beaucoup, par exemple, lors de l'optimisation. <br><br>  <b>Comment voyons-nous une requÃªte SELECT?</b> <br><br>  Voyons Ã  quoi ressemble la requÃªte SELECT: <br><br><table><tbody><tr><td>  SELECT [champ1], [champ2] ... <br></td><td>  Quels domaines choisissons-nous? <br></td></tr><tr><td>  DE [table] <br></td><td>  D'oÃ¹? <br></td></tr><tr><td>  O [[conditions] <br></td><td>  OÃ¹ sont les conditions <br></td></tr><tr><td>  GROUPE PAR [champ1] <br></td><td>  Regrouper par champs <br></td></tr><tr><td>  AYANT [conditions] <br></td><td>  Avoir telle ou telle condition <br></td></tr><tr><td>  COMMANDER PAR [field1] <br></td><td>  Commande (trier) <br></td></tr></tbody></table><br>  <b>Comment comprendre oÃ¹ aller pour les donnÃ©es?</b> <br><br>  La premiÃ¨re chose que le serveur essaie de comprendre quand une demande arrive est oÃ¹ aller pour les donnÃ©es.  La commande FROM rÃ©pond Ã  cette question, car c'est ici que nous aurons une liste de tables (ou le nom d'une table). <br><br>  Pour plus de clartÃ©, imaginons que notre serveur est une sorte de majordome, que nous commandons pour venir nous chercher en vacances.  En consÃ©quence, le majordome commence Ã  rÃ©flÃ©chir, mais dans quel placard sont les choses nÃ©cessaires (dans quelle table avez-vous besoin de prendre les donnÃ©es)?  Et pour que notre majordome puisse facilement terminer sa tÃ¢che, nous utilisons FROM. <br><br><img src="https://habrastorage.org/webt/ig/wo/uy/igwouy4la8vroshisd8pk5sqcx8.jpeg"><br><br>  <b>Comment comprendre quelles donnÃ©es prendre?</b> <br><br>  Disons que le majordome a trouvÃ© le bon placard et l'a ouvert.  Mais quelles choses prendre?  Peut-Ãªtre que nous allons dans une station de ski?  Ou peut-Ãªtre sur une plage chaude et ensoleillÃ©e?  Pour que nos choses correspondent Ã  la mÃ©tÃ©o, la commande WHERE est utile pour nous, qui dÃ©finit les conditions, c'est-Ã -dire nous permet de filtrer les donnÃ©es.  S'il fait chaud, nous prenons des ardoises, des chemises et des maillots de bain, s'il fait froid - mitaines, chaussettes tricotÃ©es, pulls)). <br><br>  L'Ã©tape suivante consiste Ã  attacher ces donnÃ©es Ã  des groupes, ce qui se produit avec GROUP BY (T-shirts sÃ©parÃ©ment, chaussettes sÃ©parÃ©ment).  Selon les rÃ©sultats du regroupement, une condition supplÃ©mentaire peut Ãªtre imposÃ©e Ã  l'aide de HAVING (par exemple, Ã©liminer les Ã©lÃ©ments non appariÃ©s).  En fin de compte, nous ajoutons tout en utilisant ORDER BY, obtenant la valise finie des choses Ã  la sortie, ou plutÃ´t, un bloc de donnÃ©es ordonnÃ©. <br><br><img src="https://habrastorage.org/webt/vd/lt/4b/vdlt4bg1o5ebpaxz1di_vhl__tm.jpeg"><br><br>  Soit dit en passant, il y a une nuance, mais elle consiste dans le fait qu'il y a une diffÃ©rence entre les conditions qui doivent Ãªtre Ã©crites dans OERE et celles dans HAVING.  Mais c'est mieux Ã  voir dans la vidÃ©o. <br><br>  Nous continuons.  Le chemin d'exÃ©cution de la demande est enregistrÃ© en <b>tant que plan de demande</b> dans le cache, c'est-Ã -dire que notre majordome Ã©crit tout, car il est un bon majordome - et si vous voulez rÃ©pÃ©ter votre commande l'annÃ©e prochaine?  Et de tels plans, en principe, peuvent Ãªtre nombreux. <br><br>  <b>Types de connexions dans le plan de requÃªte</b> <br><br>  Il existe trois connexions que vous pouvez rencontrer en termes de requÃªte: <br><br><ol><li>  Boucle imbriquÃ©e. </li><li>  Fusionner la jointure. </li><li>  Hash join. </li></ol><br>  Avant de nous attarder sur chacun d'eux plus en dÃ©tail, rÃ©sumons pourquoi nous devrions mÃªme lire le plan de requÃªte.  Ceci est en fait trÃ¨s utile car vous apprendrez: <br><br><ul><li>  quel indice est utilisÃ©; </li><li>  dans quel ordre adhÃ©rez-vous; </li><li>  ce qui est sÃ©lectionnÃ© dans le tampon; </li><li>  combien le serveur dÃ©pense des ressources pour l'opÃ©ration; </li><li>  quelle est la diffÃ©rence entre un plan hypothÃ©tique et un plan rÃ©el. </li></ul><br>  <b>Boucle imbriquÃ©e</b> <br><br>  Disons que nous devons joindre les donnÃ©es de diffÃ©rentes tables.  PrÃ©sentons ces tableaux comme ... une petite quantitÃ© de chocolats Skittles et l'emballage complet de M&amp;M. <br><br><img src="https://habrastorage.org/webt/4k/-s/uh/4k-suhjbpvptu8kjhe77rx8posm.jpeg"><br><br>  Lors de la connexion d'un type de boucle imbriquÃ©e, nous prenons le bonbon Skittles, puis nous obtenons le bonbon aveugle du package de M&amp;M.  Si nous ne tombons pas sur un bonbon de la mÃªme couleur (c'est notre condition), nous obtenons le suivant, c'est-Ã -dire qu'il y a un buste habituel.  Par consÃ©quent, nous pouvons dire que la connexion en boucle imbriquÃ©e convient mieux Ã  de petites quantitÃ©s de donnÃ©es.  De toute Ã©vidence, s'il y a beaucoup de donnÃ©es, la suppression n'est pas la meilleure option. <br><br><img src="https://habrastorage.org/webt/fu/0d/mv/fu0dmvprjve1i1mgbn5v3nou3ow.jpeg"><br><br>  Voyons Ã  quoi cela ressemble dans le panneau SQL: <br><br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--drop table skittles --drop table mms --    create table mms (id int identity(1,1), color varchar(25), taste varchar(15)) insert into mms (color, taste) values ('yellow', 'chocolate') insert into mms (color, taste) values ('red', 'nuts') create clustered index IX_mms_color ON mms(color); create table skittles (id int identity(1,1), color varchar(25), taste varchar(15)) create index IX_skittles_id ON skittles(id); create clustered index IX_skittles_color ON skittles(color); insert into skittles (color, taste) values ('red', 'cherry') insert into skittles (color, taste) values ('blue', 'strange') insert into skittles (color, taste) values ('yellow', 'lemon') insert into skittles (color, taste) values ('green', 'apple') insert into skittles (color, taste) values ('orange', 'orange') --    select mms.* from mms join skittles on mms.color = skittles.color select * from mms join skittles on mms.color = skittles.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/gx/vj/ed/gxvjedgxwzjcdv2kbzreqmmofwi.jpeg"><br><br>  <b>Fusionner la jointure</b> <br><br>  Une connexion est utilisÃ©e pour de grandes quantitÃ©s de donnÃ©es.  Lorsque vous avez une jointure de fusion, vos deux tables ont un index par lequel elles peuvent Ãªtre jointes.  Dans le cas des bonbons, c'est comme si nous les avions disposÃ©s Ã  l'avance par couleur. <br><br>  Cela ressemble Ã  ceci: <br><br><img src="https://habrastorage.org/webt/j2/cy/ld/j2cyldmem4_ytym2ssj3wpyco1q.jpeg"><br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--2 tables 50000 rows, only clustered index by color, color is not unique select COUNT(*) from mms_big join skittles_big on mms_big.color = skittles_big.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/xv/vm/mf/xvvmmf1ozq_lt7f2rrcnqsvz1cs.jpeg"><br><br>  La fusion de jointure est bonne dans les cas suivants: <br><br><ul><li>  grands ensembles de donnÃ©es; </li><li>  les mÃªmes champs de connexion du mÃªme type; </li><li>  les champs de connexion ont des indices. </li></ul><br>  <b>Hash Join</b> <br><br>  La jointure par hachage est utilisÃ©e pour de grandes quantitÃ©s de donnÃ©es non triÃ©es.  Pour rejoindre les tables dans ce cas, vous devez crÃ©er quelque chose qui imite l'index. <br><br>  Exemple de jointure par hachage: <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--drop table skittles --drop table mms --    create table mms (id int identity(1,1), color varchar(25), taste varchar(15)) insert into mms (color, taste) values ('yellow', 'chocolate') insert into mms (color, taste) values ('red', 'nuts') insert into mms (color, taste) values ('blue', 'strange') insert into mms (color, taste) values ('green', 'chocolate') insert into mms (color, taste) values ('orange', 'chocolate') create table skittles (id int identity(1,1), color varchar(25), taste varchar(15)) insert into skittles (color, taste) values ('red', 'cherry') insert into skittles (color, taste) values ('blue', 'strange') insert into skittles (color, taste) values ('yellow', 'lemon') insert into skittles (color, taste) values ('green', 'apple') insert into skittles (color, taste) values ('orange', 'orange') --    select * from mms join skittles on mms.color = skittles.color</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/0g/vr/xd/0gvrxdfdoc55bwpdkv5ghkwnq-w.jpeg"><br><br>  Pour plus de clartÃ©, nous rappelons nos bonbons: <br><br><img src="https://habrastorage.org/webt/xg/2l/cn/xg2lcndw5mzxm5msx6l_0kq_4wc.jpeg"><br><br>  L'utilisation de Hash Join implique 2 phases d'action: <br><br><ol><li>  Build - une table de hachage est construite sur la plus petite table.  Pour chaque valeur du tableau n Â° 1, un hachage est considÃ©rÃ©.  La valeur est stockÃ©e dans une table de hachage et le hachage calculÃ© est utilisÃ© comme clÃ©. </li><li>  Sonde.  Pour chaque ligne du tableau n Â° 2, la valeur de hachage est calculÃ©e pour les champs spÃ©cifiÃ©s dans join (operator =).  Un hachage est recherchÃ© dans la table de hachage, les valeurs des champs sont vÃ©rifiÃ©es. </li></ol><br><img src="https://habrastorage.org/webt/nr/nn/q2/nrnnq2ahbh57a28x3szylahyjue.jpeg"><br><br><img src="https://habrastorage.org/webt/fu/e3/bg/fue3bgxwsesvzgwjgzzva6isnpu.jpeg"><br><br><img src="https://habrastorage.org/webt/dd/fx/mn/ddfxmnjwgneqpqmzxeseavjpkhy.jpeg"><br><br>  Lorsque la jonction de hachage est bonne: <br><br><ul><li>  grand ensemble de donnÃ©es; </li><li>  pas d'indices marginaux. </li></ul><br>  Un point important: s'il n'y a pas assez de mÃ©moire, l'enregistrement ira Ã  tempdb - sur le disque. <br><br>  Amis, en plus de ce qui prÃ©cÃ¨de, la leÃ§on ouverte comprenait Ã©galement d'autres points intÃ©ressants, qui sont mieux vus en regardant la vidÃ©o.  Nous vous suggÃ©rons de visiter la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">journÃ©e portes ouvertes du cours</a> "DÃ©veloppeur MS SQL Server", oÃ¹ vous pourrez poser toutes vos questions au professeur. <br><br>  L'enseignante PS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kristina Kucherova</a> remercie Jes Schultz Borland pour sa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prÃ©sentation</a> avec PASS Summitt Execution Plans: The Secret to Query Tuning Success, qui a Ã©tÃ© utilisÃ© pour prÃ©parer la leÃ§on ouverte. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr437828/">https://habr.com/ru/post/fr437828/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr437816/index.html">MPLS est partout. Comment est l'infrastructure rÃ©seau Yandex.Cloud</a></li>
<li><a href="../fr437818/index.html">Nous enseignons Ã  un ordinateur Ã  distinguer les sons: se familiariser avec le concours DCASE et assembler votre classificateur audio en 30 minutes</a></li>
<li><a href="../fr437820/index.html">50 nuances de sÃ©curitÃ© Drupal</a></li>
<li><a href="../fr437824/index.html">Extension universelle 1C pour Google Sheets et Docs - prendre et utiliser</a></li>
<li><a href="../fr437826/index.html">Comment nous avons migrÃ© la base de donnÃ©es de Redis et Riak KV vers PostgreSQL. Partie 1: le processus</a></li>
<li><a href="../fr437830/index.html">Programmation fiable par langage - revue noob. Partie 1</a></li>
<li><a href="../fr437832/index.html">Open source: humour de code, astuces de code, PAS de code</a></li>
<li><a href="../fr437834/index.html">Deux histoires sur la faÃ§on dont les Ã©vÃ©nements de programmation ont eu lieu Ã  Iekaterinbourg</a></li>
<li><a href="../fr437836/index.html">Under the hood Screeps - virtualisation dans le sandbox MMO pour les programmeurs</a></li>
<li><a href="../fr437838/index.html">Les technologies d'apprentissage automatique accÃ©lÃ¨rent parfois le processus d'adaptation des patients aux prothÃ¨ses bioniques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>