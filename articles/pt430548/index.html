<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∏üèΩ üíë üòÑ Interrompe dispositivos externos em um sistema x86. Parte 1. A evolu√ß√£o dos controladores de interrup√ß√£o üë©üèΩ‚Äçü§ù‚Äçüë©üèª ‚Ñ¢Ô∏è üí°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, gostaria de considerar os mecanismos de entrega de interrup√ß√£o de dispositivos externos no sistema x86 e tentar responder √†s perguntas: ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interrompe dispositivos externos em um sistema x86. Parte 1. A evolu√ß√£o dos controladores de interrup√ß√£o</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430548/">  Neste artigo, gostaria de considerar os mecanismos de entrega de interrup√ß√£o de dispositivos externos no sistema x86 e tentar responder √†s perguntas: <br><br><ul><li>  O que √© o PIC e para que serve? </li><li>  O que √© o APIC e para que serve?  Para que servem o LAPIC e o I / O APIC? </li><li>  Quais s√£o as diferen√ßas entre APIC, xAPIC e x2APIC? </li><li>  O que √© MSI?  Quais s√£o as diferen√ßas entre MSI e MSI-X? </li><li>  Como as tabelas $ PIR, MPtable, ACPI est√£o relacionadas a isso? </li></ul><br>  Se voc√™ estiver interessado em receber uma resposta para qualquer uma dessas perguntas ou se quiser apenas se familiarizar com a evolu√ß√£o dos controladores de interrup√ß√£o no sistema x86, seja bem-vindo ao gato. <br><a name="habracut"></a><br><h3>  1. Introdu√ß√£o </h3><br>  Todos sabemos o que √© interrup√ß√£o.  Para quem n√£o √©, cite a wikipedia: <br><br><blockquote> Interrup√ß√£o (interrup√ß√£o em ingl√™s) - um sinal de software ou hardware que informa o processador sobre a ocorr√™ncia de qualquer evento que exija aten√ß√£o imediata.  A interrup√ß√£o notifica o processador sobre a ocorr√™ncia de um evento de alta prioridade que requer interrup√ß√£o do c√≥digo atual executado pelo processador.  O processador responde suspendendo sua atividade atual, salvando seu estado e executando uma fun√ß√£o chamada manipulador de interrup√ß√µes (ou manipulador de interrup√ß√µes) que responde ao evento e os presta servi√ßos de manuten√ß√£o, ap√≥s o que retorna o controle ao c√≥digo interrompido. <br><br>  Dependendo da fonte do sinal de interrup√ß√£o, eles s√£o divididos em: <br><br><ul><li>  ass√≠ncrono ou externo (hardware) - eventos originados de dispositivos de hardware externos (como dispositivos perif√©ricos) e podem ocorrer em qualquer momento arbitr√°rio: um sinal de um timer, placa de rede ou unidade de disco, pressionamentos de teclas, movimento do mouse.  O fato de tal interrup√ß√£o ocorrer no sistema √© interpretado como uma solicita√ß√£o de interrup√ß√£o (IRQ) - os dispositivos relatam que precisam de aten√ß√£o do sistema operacional; </li><li>  eventos s√≠ncronos ou internos no pr√≥prio processador como resultado da viola√ß√£o de determinadas condi√ß√µes ao executar o c√≥digo da m√°quina: divis√£o por zero ou excesso de pilha, acesso a endere√ßos de mem√≥ria inv√°lidos ou c√≥digo de opera√ß√£o inv√°lido; </li></ul></blockquote>  Neste artigo, eu gostaria de discutir interrup√ß√µes externas no IRQ. <br><br>  Por que eles s√£o necess√°rios?  Suponha que desejemos executar alguma a√ß√£o com um pacote de entrada para uma placa de rede quando ela chegar.  Para n√£o perguntar constantemente √† placa de rede "voc√™ tem um novo pacote?"  e n√£o desperdice recursos do processador nisso, voc√™ pode usar a interrup√ß√£o do IRQ.  A linha de interrup√ß√£o do dispositivo est√° conectada √† linha INTR do processador e, quando um pacote √© recebido, a placa de rede "puxa" essa linha.  O processador entende que h√° informa√ß√µes e l√™ o pacote. <br><br>  Mas e se houver muitos dispositivos?  Voc√™ n√£o pode obter o suficiente de todos os dispositivos externos das pernas do processador. <br><br><img src="https://habrastorage.org/webt/vg/3q/3v/vg3q3v7kx8vjttp43xo99o8pccs.png"><br><br>  Para resolver esse problema, eles criaram um chip - um controlador de interrup√ß√£o. <br><br><h3>  Pic </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wiki</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">osdev</a> ) <br><br>  O primeiro foi um chip <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Intel 8259 PIC</a> .  8 linhas de entrada (IRQ0-7) e uma sa√≠da conectando o controlador √† linha INTR do processador.  Quando ocorre uma interrup√ß√£o de um dispositivo, 8259 puxa a linha INTR, o processador entende que algum dispositivo sinaliza uma interrup√ß√£o e consulta o PIC para entender qual perna do IRQx causou a interrup√ß√£o.  H√° um atraso adicional para esta pesquisa, mas o n√∫mero de linhas de interrup√ß√£o aumenta para 8. <br><br><img src="https://habrastorage.org/webt/le/yf/6e/leyf6enogyzp6flpijo2d0x1w9g.png"><br><br>  No entanto, 8 linhas rapidamente se mostraram pequenas e, para aumentar seu n√∫mero, foram utilizados 2 8259 controladores (mestre e escravo) conectados em cascata (Dual PIC). <br><br>  Os IRQs de 0 a 7 s√£o processados ‚Äã‚Äãpelo primeiro Intel 8259 PIC (mestre) e os IRQs de 8 a 15 s√£o processados ‚Äã‚Äãpelo segundo 8259 PIC (escravo).  Somente um mestre sinaliza a ocorr√™ncia de uma interrup√ß√£o.  Se ocorrer uma interrup√ß√£o nas linhas 8 a 15, o segundo PIC (escravo) sinaliza uma interrup√ß√£o ao mestre via IRQ 2, e o mestre, por sua vez, sinaliza a CPU.  Essa interrup√ß√£o em cascata leva uma das 16 linhas, mas no final fornece 15 interrup√ß√µes dispon√≠veis para os dispositivos. <br><br><img src="https://habrastorage.org/webt/xj/yn/dh/xjyndhabujjwz0alrbx831zfzt8.png"><br><br>  O circuito se estabeleceu, e √© isso que eles querem dizer quando falam sobre o PIC (Programm Interrupt Controller) agora.  Posteriormente, os controladores 8259 receberam algumas melhorias e ficaram conhecidos como 8259A, e esse circuito foi inclu√≠do no chipset.  No momento em que o barramento principal para conectar dispositivos externos era o barramento ISA, esse sistema como um todo era suficiente.  Era necess√°rio apenas garantir que dispositivos diferentes n√£o se conectassem √† mesma linha de IRQ para evitar conflitos, pois as interrup√ß√µes do ISA n√£o s√£o compartilhadas. <br><br>  Geralmente, o layout das interrup√ß√µes para dispositivos era mais ou menos padr√£o <br><br>  Exemplo (retirado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">daqui</a> ): <br>  IRQ 0 - temporizador do sistema <br>  IRQ 1 - controlador de teclado <br>  IRQ 2 - cascata (interrup√ß√£o do controlador escravo) <br>  IRQ 3 - porta serial COM2 <br>  IRQ 4 - porta serial COM1 <br>  IRQ 5 - porta paralela 2 e 3 ou placa de som <br>  IRQ 6 - controlador de disquete <br>  IRQ 7 - porta paralela 1 <br>  IRQ 8 - Temporizador RTC <br>  IRQ 9 - ACPI <br>  IRQ 10 - aberto / SCSI / NIC <br>  IRQ 11 - aberto / SCSI / NIC <br>  IRQ 12 - controlador de mouse <br>  IRQ 13 - co-processador matem√°tico <br>  IRQ 14 - canal ATA 1 <br>  IRQ 15 - canal ATA 2 <br><br>  A configura√ß√£o e o trabalho com microcircuitos 8259 s√£o realizados atrav√©s das portas de E / S: <br><div class="scrollable-table"><table><tbody><tr><th>  Chip </th><th>  Registre-se </th><th>  Porta de E / S </th></tr><tr><td>  Foto principal </td><td>  Comando </td><td>  0x0020 </td></tr><tr><td>  Foto principal </td><td>  Dados </td><td>  0x0021 </td></tr><tr><td>  Escravo </td><td>  Comando </td><td>  0x00A0 </td></tr><tr><td>  Escravo </td><td>  Dados </td><td>  0x00A1 </td></tr></tbody></table></div><br>  ‚Üí A documenta√ß√£o para o 8259A pode ser encontrada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui.</a> <br><br>  O barramento ISA foi substitu√≠do pelo barramento PCI.  E o n√∫mero de dispositivos claramente come√ßou a exceder o n√∫mero 15, al√©m disso, diferentemente do barramento ISA est√°tico, nesse caso, os dispositivos podem ser adicionados ao sistema dinamicamente.  Felizmente, neste barramento, as interrup√ß√µes podem ser compartilhadas (ou seja, v√°rios dispositivos podem ser conectados √† mesma linha de IRQ).  Como resultado, para resolver o problema da falta de linhas IRQ, eles decidiram agrupar interrup√ß√µes de todos os dispositivos PCI em linhas PIRQ (solicita√ß√£o de interrup√ß√£o program√°vel). <br><br>  Digamos que temos 4 linhas de interrup√ß√£o livremente no controlador PIC e 20 dispositivos PCI.  Combinamos as interrup√ß√µes de 5 dispositivos por linha PIRQx e conectamos as linhas PIRQx ao controlador.  Se ocorrer uma interrup√ß√£o na linha PIRQx, o processador precisar√° interrogar todos os dispositivos conectados a esta linha para entender de quem veio a interrup√ß√£o, mas, em geral, isso resolve o problema.  Um dispositivo que vincula linhas de interrup√ß√£o PCI em uma linha PIRQ √© geralmente chamado de roteador PIR. <br><br>  Nesse m√©todo, voc√™ precisa garantir que as linhas PIRQx n√£o estejam conectadas √†s linhas IRQx nas quais as interrup√ß√µes ISA j√° foram iniciadas (pois isso causar√° conflitos) e que as linhas PIRQx estejam equilibradas (afinal, quanto mais dispositivos conectamos √† mesma linha PIRQ, mais dispositivos voc√™ precisar√° interrogar√° o processador para entender qual desses dispositivos causou a interrup√ß√£o). <br><br><img src="https://habrastorage.org/webt/u_/jr/u9/u_jru9pemdeda2xvvbqihvgtp3y.png"><br><br>  <b>Nota</b> : o dispositivo PCI -&gt; mapeamento PIR √© mostrado abstratamente na figura, porque na verdade √© um pouco mais complicado.  Na realidade, cada dispositivo PCI possui 4 linhas de interrup√ß√£o (INTA, INTB, INTC, INTD).  Cada dispositivo PCI pode ter at√© 8 fun√ß√µes e agora cada fun√ß√£o possui uma interrup√ß√£o INTx.  O INTx que cada fun√ß√£o do dispositivo puxar√° √© determinado pela configura√ß√£o do chipset. <br><br>  Em ess√™ncia, fun√ß√µes s√£o blocos l√≥gicos separados.  Por exemplo, em um dispositivo PCI, pode haver uma fun√ß√£o de controlador Smbus, uma fun√ß√£o de controlador SATA, uma fun√ß√£o de ponte LPC.  No lado do SO, cada fun√ß√£o √© um dispositivo separado com seu pr√≥prio espa√ßo de configura√ß√£o PCI Config. <br><br>  O BIOS passou as informa√ß√µes sobre o roteamento de interrup√ß√£o no PIC para o BIOS usando a tabela $ PIR e preenchendo os registros 3Ch (INT_LN Interrupt Line (R / W)) e 3Dh (INT_PN Interrupt Pin (RO)) do espa√ßo de configura√ß√£o do PCI para cada fun√ß√£o.  A especifica√ß√£o para a tabela $ PIR estava anteriormente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no site da Microsoft</a> , mas agora n√£o est√° mais l√°.  O conte√∫do das linhas da tabela $ PIR pode ser entendido na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">especifica√ß√£o do BIOS BIOS</a> [4.2.2.  Obtenha op√ß√µes de roteamento de interrup√ß√£o PCI] ou leia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> <br><br><h3>  Apic </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wiki</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">osdev</a> ) <br><br>  O m√©todo anterior funcionou at√© o surgimento dos sistemas multiprocessadores.  O fato √© que, em seu dispositivo, o PIC pode transmitir interrup√ß√µes para apenas um processador principal.  Mas eu gostaria que a carga nos processadores da manipula√ß√£o de interrup√ß√µes fosse equilibrada.  A solu√ß√£o para esse problema foi a nova interface APIC (Advanced PIC). <br><br>  Para cada processador, um controlador LAPIC especial (APIC local) √© adicionado e um controlador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">APIC de E / S</a> √© adicionado para rotear interrup√ß√µes de dispositivos.  Todos esses controladores s√£o combinados em um barramento comum chamado APIC (novos sistemas agora s√£o conectados atrav√©s de um barramento de sistema padr√£o). <br><br>  Quando uma interrup√ß√£o de um dispositivo chega ao pino de E / S APIC, o controlador direciona a interrup√ß√£o para o LAPIC de um dos processadores.  A presen√ßa de E / S APIC permite equilibrar a distribui√ß√£o de interrup√ß√µes de dispositivos externos entre processadores. <br><br>  O primeiro chip APIC foi o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">82489DX</a> , era um chip separado que combina LAPIC e I / O APIC.  Para criar um sistema de 2 processadores, eram necess√°rios 3 microcircuitos.  2 funcionaria como LAPIC e um como E / S APIC.  Posteriormente, a funcionalidade LAPIC foi inclu√≠da diretamente nos processadores e a funcionalidade I / O APIC foi enquadrada no chip 82093AA. <br><br>  O I / O APIC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">82093AA</a> continha 24 pinos de entrada e a arquitetura APIC podia suportar at√© 16 CPUs.  Para manter a compatibilidade com sistemas mais antigos, de 0 a 15 interrup√ß√µes foram alocadas para interrup√ß√µes antigas do ISA.  E as interrup√ß√µes dos dispositivos PCI come√ßaram a ser exibidas na linha IRQ 16-23.  Agora era poss√≠vel n√£o pensar em conflitos de interrup√ß√£o dos dispositivos ISA e PCI.  Al√©m disso, gra√ßas ao aumento do n√∫mero de linhas de interrup√ß√£o livres, tamb√©m foi poss√≠vel aumentar o n√∫mero de linhas PIRQx. <br><br><img src="https://habrastorage.org/webt/mc/ra/hj/mcrahjn-owk9qrcmyiixcmhomcq.png"><br><br>  A programa√ß√£o de E / S APIC e LAPIC √© feita atrav√©s do MMIO.  Os registros LAPIC geralmente est√£o localizados em 0xFEE00000, os registros de E / S APIC em 0xFE00000.  Embora, em princ√≠pio, todos esses endere√ßos possam ser reconfigurados. <br><br>  Como no caso do PIC, inicialmente, chips individuais passaram a fazer parte do chipset. <br><br>  Posteriormente, a arquitetura APIC recebeu moderniza√ß√£o e a nova vers√£o foi denominada xAPIC (x - extended).  Manteve a compatibilidade com a vers√£o anterior.  O n√∫mero de poss√≠veis CPUs no sistema aumentou para 256. <br><br>  A pr√≥xima rodada de desenvolvimento da arquitetura foi chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">x2APIC</a> .  O n√∫mero de CPUs poss√≠veis no sistema aumentou para 2 ^ 32.  Os controladores podem trabalhar no modo de compatibilidade xAPIC ou no novo modo x2APIC, onde a programa√ß√£o LAPIC √© realizada n√£o atrav√©s do MMIO, mas atrav√©s de registros MSR (que s√£o muito mais r√°pidos).  A julgar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">por este link, o</a> suporte do IOMMU √© necess√°rio para que este modo funcione. <br><br>  Note-se que o sistema pode ter v√°rios controladores de E / S APIC.  Por exemplo, um para 24 interrup√ß√µes na ponte sul e outro para 32 no norte.  No contexto de E / S, as interrup√ß√µes APIC s√£o freq√ºentemente chamadas de GSI (Global System Interrupt).  Portanto, em um sistema como esse ser√° o GSI 0-55. <br><br>  Existe um LAPIC embutido na CPU e qual arquitetura pode ser entendida pelos sinalizadores de bit no CPUID. <br>  Para que o sistema detecte LAPIC e I / O APIC, o BIOS deve fornecer informa√ß√µes sobre eles ao sistema atrav√©s do MPtable (o m√©todo antigo) ou da tabela ACPI (MADT neste caso).  Al√©m das informa√ß√µes gerais, o MPtable e o ACPI (desta vez na tabela DSDT) devem conter informa√ß√µes sobre roteamento de interrup√ß√µes, ou seja, informa√ß√µes sobre qual dispositivo fica em qual linha de interrup√ß√£o (an√°logo da tabela $ PIR). <br><br>  A tabela MPTable pode ser encontrada na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://web.archive.org/web/20121002210153/">especifica√ß√£o</a> oficial.  Anteriormente, a especifica√ß√£o estava no site da Intel, mas agora s√≥ pode ser encontrada no arquivo.  A especifica√ß√£o da ACPI agora est√° localizada no site da UEFI (vers√£o atual <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">6.2</a> ).  Deve-se observar que, usando o ACPI, voc√™ pode especificar o roteamento de interrup√ß√£o para sistemas sem APIC (em vez de usar a tabela $ PIR). <br><br><h3>  Msi </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wiki</a> ) <br><br>  A vers√£o anterior do APIC √© boa, mas n√£o sem falhas.  Todas essas linhas de interrup√ß√£o do dispositivo complicam o circuito e aumentam a probabilidade de erros.  O barramento PCI foi substitu√≠do pelo PCI express, no qual as linhas de interrup√ß√£o foram simplesmente decididas a serem removidas.  Para manter a compatibilidade, os sinais de interrup√ß√£o (INTx #) s√£o emulados por certos tipos de mensagens.  Nesse esquema, a adi√ß√£o l√≥gica de linhas de interrup√ß√£o, que costumava ser feita pela conex√£o f√≠sica de fios, ca√≠a sobre os ombros das pontes PCI.  No entanto, o suporte a interrup√ß√µes herdadas do INTx √© apenas suporte para compatibilidade com vers√µes anteriores com o barramento PCI.  De fato, o PCI Express prop√¥s um novo m√©todo para entregar mensagens de interrup√ß√£o - MSI (interrup√ß√£o sinalizada de mensagens).  Nesse m√©todo, para sinalizar uma interrup√ß√£o, o dispositivo simplesmente grava na √°rea MMIO alocada para o LAPIC do processador. <br><br><img src="https://habrastorage.org/webt/8z/qw/7h/8zqw7him-vupzm_wi5glkqtr1ja.png"><br><br>  Anteriormente, apenas 4 interrup√ß√µes eram alocadas para um dispositivo PCI (ou seja, para todas as suas fun√ß√µes), mas agora tornou-se poss√≠vel tratar at√© 32 interrup√ß√µes. <br><br>  No caso do MSI, n√£o h√° compartilhamento para as linhas, cada interrup√ß√£o corresponde ao seu dispositivo. <br><br>  As interrup√ß√µes do MSI tamb√©m resolvem outro problema.  Suponha que um dispositivo realize uma transa√ß√£o de grava√ß√£o na mem√≥ria e deseje relatar sua conclus√£o atrav√©s de uma interrup√ß√£o.  Mas uma transa√ß√£o de grava√ß√£o pode ser atrasada no barramento durante o processo de transfer√™ncia (que o dispositivo desconhece) e o sinal de interrup√ß√£o chegar√° antes do processador.  Assim, a CPU ainda ler√° dados inv√°lidos.  Se o MSI for usado, as informa√ß√µes sobre o MSI ser√£o transmitidas, assim como os dados, e simplesmente n√£o poder√£o ser acessadas mais cedo. <br><br>  Deve-se observar que as interrup√ß√µes do MSI n√£o podem funcionar sem o LAPIC, mas o uso do MSI pode nos substituir pelo I / O APIC (simplifica√ß√£o de design). <br><br>  Posteriormente, esse m√©todo recebeu a extens√£o MSI-X.  Agora, cada dispositivo pode ter at√© 2048 interrup√ß√µes.  E tornou-se poss√≠vel indicar individualmente a cada interrup√ß√£o em qual processador ele deve ser executado.  Isso pode ser muito √∫til para dispositivos muito carregados, como placas de rede. <br><br>  Nenhuma tabela BIOS adicional √© necess√°ria para o suporte ao MSI.  Mas o dispositivo deve relatar o suporte ao MSI em um dos recursos em seu PCI Config e o driver do dispositivo deve oferecer suporte ao trabalho com o MSI. <br><br><h3>  Conclus√£o </h3><br>  Neste artigo, examinamos a evolu√ß√£o dos controladores de interrup√ß√£o e recebemos informa√ß√µes te√≥ricas gerais sobre a entrega de interrup√ß√µes de dispositivos externos em um sistema x86. <br><br>  Na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pr√≥xima parte,</a> veremos como usar no Linux cada um dos controladores descritos na pr√°tica. <br><br><h4>  Refer√™ncias: </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Controladores de interrup√ß√£o (itens intermedi√°rios)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O que as diferentes interrup√ß√µes no PCIe fazem?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Reduzindo a lat√™ncia de interrup√ß√£o atrav√©s do uso de interrup√ß√µes sinalizadas por mensagem</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Arquitetura de processamento de interrup√ß√£o para sistemas compat√≠veis com Intel</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt430548/">https://habr.com/ru/post/pt430548/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt430534/index.html">Criando um modelo para o Zabbix usando o DVR Trassir SDK como exemplo</a></li>
<li><a href="../pt430536/index.html">Projetar fun√ß√µes da janela resumidas em uma unidade com um determinado n√≠vel de sobreposi√ß√£o</a></li>
<li><a href="../pt430538/index.html">Voc√™ l√™ o Scaladoc para m√©todos de coleta "√≥bvios"? Ou por que a pregui√ßa nem sempre √© boa</a></li>
<li><a href="../pt430542/index.html">Semin√°rio on-line aberto ‚ÄúInfraestrutura como um c√≥digo‚Äù</a></li>
<li><a href="../pt430546/index.html">"Acreditava-se que o c√≥digo seria substitu√≠do por diagramas UML, mas n√£o h√° necessidade de testar": uma entrevista com Alexei Barantsev</a></li>
<li><a href="../pt430550/index.html">Construindo um sistema de componentes reativos com o Kotlin</a></li>
<li><a href="../pt430552/index.html">Inicializa√ß√£o do dia (setembro a outubro de 2018)</a></li>
<li><a href="../pt430554/index.html">Google VR sapatos patenteados que voc√™ pode andar para sempre</a></li>
<li><a href="../pt430556/index.html">GeekBrains lan√ßa curso de treinamento para gerente de produtos</a></li>
<li><a href="../pt430558/index.html">Como funciona a pontua√ß√£o no setor de compartilhamento de carros. Parte 1. Vis√£o geral de ferramentas populares em dados reais</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>