<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆔 🚜 🤘🏾 Samba DC sebagai pengontrol kedua di domain AD Windows 2012R2 dan folder roaming untuk klien di Windows dan Linux 👨🏾‍🔧 🤨 🛌🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kesadaran bahwa saya berada dalam campuran impor tidak segera datang. Hanya ketika pasokan baru PC mulai tiba secara stabil dari organisasi induk deng...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Samba DC sebagai pengontrol kedua di domain AD Windows 2012R2 dan folder roaming untuk klien di Windows dan Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450572/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/q7/qz/gi/q7qzgibifknfegmdk3ffls-fik0.jpeg" alt="gambar"></div><br>  Kesadaran bahwa saya berada dalam campuran impor tidak segera datang.  Hanya ketika pasokan baru PC mulai tiba secara stabil dari organisasi induk dengan distribusi Alt Linux di papan, saya menduga ada sesuatu yang salah. <br><br>  Namun, dalam proses melewati tahap-tahap menerima yang tak terhindarkan, saya terlibat dan bahkan mulai sedikit menikmati prosesnya.  Dan pada titik tertentu saya berpikir bahwa, pada kecepatan seperti itu, cepat atau lambat saya harus menyerahkan keputusan untuk mengatur layanan direktori Microsoft dan bergerak ke arah sesuatu yang lebih eksotis.  Oleh karena itu, untuk mempersiapkan di muka untuk hal yang tak terhindarkan, dan jika mungkin untuk menangkap lebih banyak jebakan, diputuskan untuk memasang bangku tes, yang meliputi: <br><br><ul><li>  DC1 - Windows Server 2012R2 </li><li>  DC2 - Alt Server 8.2 </li><li>  File Server - Windows Server 2012R2 </li><li>  PC1 - Windows 7 </li><li>  PC2 - Alt Workstation 8.2 </li></ul><a name="habracut"></a><br><h4>  Tugas berdiri: </h4><br><ol><li> Menyebarkan domain berdasarkan w2k12r2.  Buat sekumpulan kebijakan grup minimal (mirip dengan yang digunakan dalam infrastruktur kerja), termasuk kebijakan untuk mentransfer folder kerja pengguna (Unduhan / Dokumen / Desktop).  Pada akhirnya, saya ingin bahwa ketika pengguna mengubah tempat kerjanya dari Windows ke Linux dan sebaliknya, ia memiliki akses yang nyaman ke dokumen kerjanya. </li><li>  Memasuki Samba DC oleh pengontrol kedua.  Memeriksa Layanan Direktori dan Replikasi DNS </li><li>  Mengkonfigurasi Klien Linux dengan Folder Roaming </li></ol><br><h4>  Implementasi: </h4><br><ol><li>  <b>Instal dan masukkan pengontrol baru</b> <br><br>  Dengan instalasi MS Windows 2012R2, semuanya sederhana dan kurang jelas.  Di Internet ada 1001 manual untuk menggelar domain di Windows menggunakan GUI dan Powershell, jadi saya tidak akan mengulanginya lagi, saya hanya akan membiarkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> mati.  dokumentasi untuk yang penasaran dan mereka yang ingin menyegarkan ingatan mereka. <br><br>  Namun, ada satu poin penting dalam paragraf ini.  Sampai saat ini, Samba tidak dapat bekerja dengan skema katalog di atas 2008R2. <br><br><div class="spoiler">  <b class="spoiler_title">Judul spoiler</b> <div class="spoiler_text">  Sebaliknya, pengembang dukungan ini dinyatakan sebagai eksperimental.  Namun dalam praktiknya, upaya untuk memasukkan samba sebagai DC kedua ke domain Windows yang ada dengan skema 69 akan menemui Anda dengan kesalahan berikut <br><blockquote>  DsAddEntry gagal dengan status WERR_ACCESS_DENIED info (8567, 'WERR_DS_INCOMPATIBLE_VERSION') </blockquote><br></div></div><br>  Masalahnya adalah bahwa Windows 2012 dan 2012R2 menggunakan alat WMI untuk bekerja dengan domain dan hutan, dukungan stabil yang diumumkan hanya untuk Samba versi 4.11, yang akan keluar sebelum akhir tahun ini. <br>  Oleh karena itu, satu-satunya pilihan untuk memperkenalkan samba ke domain AD yang digunakan pada server 2012R2 adalah menurunkan skema dari 69 menjadi 47. Tentu saja, ini tidak diperlukan pada infrastruktur kerja tanpa alasan yang baik, tetapi kami memiliki bangku uji di sini, jadi mengapa sebenarnya tidak. <br><br>  Kami menempatkan Alt Server 8.2.  Selama instalasi, pilih profil "Samba-DC Server (Pengontrol AD)."  Di server yang digunakan, kami membuat pembaruan sistem yang lengkap dan menginstal paket task-samba-dc, yang akan menarik semua yang Anda butuhkan <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get install task-samba-dc</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Jika task-samba-dc tiba-tiba, bertentangan dengan jaminan dokumentasi, Alta menolak untuk menginstal semua yang diperlukan.</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get install python-module-samba-DC samba-DC-common samba-DC-winbind-clients samba-DC-winbind samba-DC-common-libs libpytalloc-devel</span></span></code> </pre> <br></div></div><br>  Selanjutnya, lanjutkan untuk mengonfigurasi Kerberos dan menerima tiket.  Buka file krb5.conf, buka bagian [libdefaults], dan bawa ke formulir berikut: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vim /etc/krb5.conf</span></span></code> </pre> <br><pre> <code class="bash hljs"> dns_lookup_kdc = <span class="hljs-literal"><span class="hljs-literal">true</span></span> dns_lookup_realm = <span class="hljs-literal"><span class="hljs-literal">true</span></span> default_realm = TEST.LOCAL</code> </pre> <br>  Minta tiket <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># kinit administrator Password for administrator@TEST.LOCAL:</span></span></code> </pre> <br>  Memeriksa daftar tiket Kerberos yang diterima <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># klist Ticket cache: KEYRING:persistent:0:0 Default principal: administrator@TEST.LOCAL Valid starting Expires Service principal 16.05.2019 11:51:38 16.05.2019 21:51:38 krbtgt/TEST.LOCAL@TEST.LOCAL renew until 23.05.2019 11:51:35</span></span></code> </pre> <br>  Sekarang hapus atau ganti nama konfigurasi samba yang ada. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mv smb.conf smb.conf.bak1</span></span></code> </pre> <br>  Akhirnya, kita masukkan pengontrol kedua ke domain AD: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># samba-tool domain join test.local DC -U"TEST\administrator"</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Entri yang berhasil akan diikuti oleh log berikut</b> <div class="spoiler_text"><pre> <code class="bash hljs">Finding a writeable DC <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> domain <span class="hljs-string"><span class="hljs-string">'test.local'</span></span> Found DC DC1.TEST.LOCAL Password <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [TEST\administrator]: Reconnecting to naming master e31d7da6-8f56-4420-8473-80f2b3a31338._msdcs.TEST. LOCAL DNS name of new naming master is DC1.TEST.LOCAL workgroup is TEST realm is TEST.LOCAL Adding CN=DC2,OU=Domain Controllers,DC=TEST,DC=LOCAL Adding CN=DC2,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC =TEST,DC=LOCAL Adding CN=NTDS Settings,CN=DC2,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN =Configuration,DC=TEST,DC=LOCAL Adding SPNs to CN=DC2,OU=Domain Controllers,DC=TEST,DC=LOCAL Setting account password <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> DC2$ Enabling account Calling bare provision Looking up IPv4 addresses Looking up IPv6 addresses No IPv6 address will be assigned Setting up share.ldb Setting up secrets.ldb Setting up the registry Setting up the privileges database Setting up idmap db Setting up SAM db Setting up sam.ldb partitions and settings Setting up sam.ldb rootDSE Pre-loading the Samba 4 and AD schema A Kerberos configuration suitable <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Samba AD has been generated at /var/lib/sa mba/private/krb5.conf Provision OK <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> domain DN DC=TEST,DC=LOCAL Starting replication Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[402/1426] linked _values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[804/1426] linked _values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[1206/1426] linke d_values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[1608/1426] linke d_values[0/0] Schema-DN[CN=Schema,CN=Configuration,DC=TEST,DC=LOCAL] objects[1743/1426] linke d_values[0/0] Analyze and apply schema objects Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[402/2240] linked_values[0/ 24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[804/2240] linked_values[0/ 24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[1206/2240] linked_values[0 /24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[1608/2240] linked_values[0 /24] Partition[CN=Configuration,DC=TEST,DC=LOCAL] objects[1772/2240] linked_values[2 4/24] Replicating critical objects from the base DN of the domain Partition[DC=TEST,DC=LOCAL] objects[109/110] linked_values[26/29] Partition[DC=TEST,DC=LOCAL] objects[394/5008] linked_values[29/29] Done with always replicated NC (base, config, schema) Replicating DC=DomainDnsZones,DC=TEST,DC=LOCAL Partition[DC=DomainDnsZones,DC=TEST,DC=LOCAL] objects[42/42] linked_values[0/0] Replicating DC=ForestDnsZones,DC=TEST,DC=LOCAL Partition[DC=ForestDnsZones,DC=TEST,DC=LOCAL] objects[20/20] linked_values[0/0] Exop on[CN=RID Manager$,CN=System,DC=TEST,DC=LOCAL] objects[3] linked_values[0] Committing SAM database Adding 1 remote DNS records <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> DC2.TEST.LOCAL Adding DNS A record DC2.TEST.LOCAL <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> IPv4 IP: 192.168.90.201 Adding DNS CNAME record 6ff1df40-cbb5-41f0-b7b3-53a27dde8edf._msdcs.TEST.LOCAL <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> DC2.TEST.LOCAL All other DNS records (like _ldap SRV records) will be created samba_dnsupdate on first startup Replicating new DNS records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> DC=DomainDnsZones,DC=TEST,DC=LOCAL Partition[DC=DomainDnsZones,DC=TEST,DC=LOCAL] objects[1/42] linked_values[0/0] Replicating new DNS records <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> DC=ForestDnsZones,DC=TEST,DC=LOCAL Partition[DC=ForestDnsZones,DC=TEST,DC=LOCAL] objects[1/20] linked_values[0/0] Sending DsReplicaUpdateRefs <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> all the replicated partitions Setting isSynchronized and dsServiceName Setting up secrets database Joined domain TEST (SID S-1-5-21-3959064270-1572045903-2556826204) as a DC</code> </pre> <br></div></div><br>  Catatan tentang DC baru di domain TEST.LOCAL akan muncul di snap-in ADUC, dan catatan A baru yang sesuai dengan DC2 akan muncul di manajer DNS. </li><li>  <b>Replikasi antar pengontrol</b> <br><br>  Untuk memulai, periksa Layanan Replikasi Direktori (DRS) <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># samba-tool drs showrepl</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Semua upaya replikasi dalam output harus berhasil.</b>  <b class="spoiler_title">Dalam daftar objek KCC, dalam 15 menit setelah masuk, DC1 kami pada Windows akan muncul</b> <div class="spoiler_text"><pre> <code class="bash hljs">Default-First-Site-Name\DC2 DSA Options: 0x00000001 DSA object GUID: 0e9f5bce-ff59-401e-bdbd-fc69df3fc6bf DSA invocationId: 017997b5-d718-41d7-a3f3-e57ab5151b5c ==== INBOUND NEIGHBORS ==== DC=ForestDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:31 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:31 2019 MSK DC=DomainDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:32 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:32 2019 MSK CN=Schema,CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:32 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:32 2019 MSK DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:32 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:32 2019 MSK CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:56:33 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:56:33 2019 MSK ==== OUTBOUND NEIGHBORS ==== DC=ForestDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:03 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:03 2019 MSK DC=DomainDnsZones,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:03 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:03 2019 MSK CN=Schema,CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:08 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:08 2019 MSK DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Thu May 23 16:40:08 2019 MSK was successful 0 consecutive failure(s). Last success @ Thu May 23 16:40:08 2019 MSK CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> Default-First-Site-Name\DC1 via RPC DSA object GUID: 60fb339d-efa3-4585-a42d-04974e6601b7 Last attempt @ Mon May 27 12:12:17 2019 MSK was successful 0 consecutive failure(s). Last success @ Mon May 27 12:12:17 2019 MSK ==== KCC CONNECTION OBJECTS ==== Connection -- Connection name: 6d2652b3-e723-4af7-a19f-1ee48915753c Enabled : TRUE Server DNS name : DC1.test.local Server DN name : CN=NTDS Settings,CN=DC1,CN=Servers,CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,DC=<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> TransportType: RPC options: 0x00000001 Warning: No NC replicated <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Connection!</code> </pre> <br></div></div><br>  Peringatan <i>"Tidak ada NC yang direplikasi untuk Koneksi!"</i>  dapat diabaikan dengan aman.  Tampaknya karena fakta bahwa ketika mendaftarkan DC baru, samba salah mengatur beberapa flag replikasi. <br><br>  Memeriksa replikasi LDAP juga merupakan ide bagus. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># samba-tool ldapcmp ldap://dc1.test.local ldap://dc2.test.local -Uadministrator</span></span></code> </pre> <br>  Perintah di atas akan membandingkan nilai atribut dari objek seluruh direktori pada DC1 dan DC2. <br><br><div class="spoiler">  <b class="spoiler_title">Contoh Replikasi yang Berhasil</b> <div class="spoiler_text"><pre> <code class="bash hljs">* Comparing [DOMAIN] context... * Objects to be compared: 249 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [DOMAIN]: SUCCESS * Comparing [CONFIGURATION] context... * Objects to be compared: 1750 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [CONFIGURATION]: SUCCESS * Comparing [SCHEMA] context... * Objects to be compared: 1739 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [SCHEMA]: SUCCESS * Comparing [DNSDOMAIN] context... * Objects to be compared: 42 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [DNSDOMAIN]: SUCCESS * Comparing [DNSFOREST] context... * Objects to be compared: 20 * Result <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> [DNSFOREST]: SUCCESS</code> </pre> </div></div><br>  Dalam beberapa kasus, atribut objek pada pengontrol yang berbeda mungkin berbeda, dan output dari perintah akan memberi tahu Anda tentang hal itu.  Tetapi tidak dalam semua kasus ini akan menjadi tanda masalah replikasi. <br><br>  Langkah selanjutnya adalah mengkonfigurasi secara manual replikasi direktori SysVol yang stabil. <br>  Faktanya adalah samba belum mendukung DFS-R, karena tidak mendukung FRS sebelumnya.  Oleh karena itu, untuk replikasi antara DC Samba dan Windows, satu-satunya solusi yang bekerja saat ini adalah replikasi satu arah menggunakan utilitas <i>Robocopy</i> dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Windows Server 2003 Resource Kit Tools</a> . <br><br>  Untuk menghindari masalah kompatibilitas, pengembang samba merekomendasikan agar Anda menginstal kit utilitas terlebih dahulu pada workstation biasa, dan kemudian menyalin Robocopy ke controller di folder “C: \ Program Files (x86) \ Windows Resource Kits \ Tools \” <br><br>  Setelah instalasi, di penjadwal tugas pada pengontrol Windows, kami membuat tugas untuk replikasi dengan parameter berikut: <br><br>  - Lakukan untuk semua pengguna <br>  - Pemicu untuk mengeksekusi Setiap hari setiap 5 menit di siang hari <br>  - Dalam tindakan yang kami tentukan path ke utilitas robocopy, kami menunjukkan sebagai argumen: <br><br><pre> <code class="xml hljs">\\DC1\SYSVOL\test.local\ \\DC2\SYSVOL\test.local\ /mir /sec</code> </pre> <br>  Dalam kasus tertentu, salin konten direktori SysVol dari DC1 ke DC2. <br></li><li>  <b>Folder pengguna portabel menggunakan konfigurasi pam_mount</b> <br><br>  Secara empiris, saya menemukan dua opsi untuk menyelesaikan masalah ini dengan bantuannya. <br><br><ol><li>  Pemasangan lengkap folder profil dari jaringan ke bagian / home <br><br>  Opsi sederhana.  Ini berfungsi dengan baik jika nama folder My Documents, Downloads, dan Desktop adalah sama pada kedua sistem operasi.  Dipahami bahwa PC Linux telah dimasukkan ke dalam domain dan pengguna login di bawah akun domain mereka menggunakan sssd sebagai mekanisme otentikasi dan otorisasi. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vim /etc/security/pam_mount.conf.xml</span></span></code> </pre> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000000000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  dimana: <br><br><ul><li>  <b>uid = "100000000-2000000000000"</b> - rentang UID yang ditetapkan untuk pengguna domain dari SSSD </li><li>  <b>server = "dfs"</b> - nama server file </li><li>  <b>path = "Profile_Users /% (USER)"</b> - sumber daya di server file dengan profil pengguna di-host </li><li>  <b>mountpoint = "~"</b> - mount path ke folder home pengguna </li></ul><br>  Login pengguna dilewatkan ke variabel makro "% (USER)" yang digunakan oleh pam_mount untuk menghubungkan sumber daya jaringan kami, dalam bentuk yang dimasukkan di manajer tampilan.  Oleh karena itu, penting bahwa login DM dimasukkan tanpa indikasi eksplisit dari nama domain. <br><br>  Di sssd.conf, ini diselesaikan dengan berkomentar, atau dengan menetapkan nilai False ke opsi <b>use_fully_qualified_names</b> , yang mengaktifkan mode nama lengkap (termasuk domain) untuk pengguna dan grup. <br></li><li>  Metode kedua kurang mudah dan canggung, dan menurut saya lebih nyaman dan disukai.  Perbedaannya dari yang pertama hanya pada konfigurasi pam_mount <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vim /etc/security/pam_mount.conf.xml</span></span></code> </pre> <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000200000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)/ "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~/ "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000200000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)/Downloads"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">volume</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100000000-2000200000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fstype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cifs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">server</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dfs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Profile_Users/%(USER)/ "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mountpoint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"~/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">options</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sec=krb5,cruid=%(USERUID),nounix,uid=%(USERUID),gid=%(USERGID),file_mode=0664,dir_mode=0775"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  Artinya, kita cukup memasang masing-masing folder kita secara terpisah di direktori yang sesuai </li></ol></li></ol><br>  <b>Kesimpulan</b> <br><br>  Lebih dari setengah bulan bekerja di bangku tes, bundel ini berhasil selamat dari beberapa shutdown jangka panjang dan jangka pendek bergantian dari kedua pengontrol, dengan praktis tidak ada konsekuensi bagi klien (setelah klien di Windows7 kehilangan kepercayaan). <br><br>  Secara umum, saya memiliki kesan yang agak menyenangkan untuk bekerja dengan produk ini, meskipun ada banyak nuansa yang harus saya hadapi di artikel dan di belakang layar. <br><br>  Ada jebakan, ada banyak dari mereka, dan dalam perjalanan bekerja dengan samba mereka harus ditangkap dalam jumlah besar.  Namun, hingga saat ini, tidak ada solusi lain yang memungkinkan Anda untuk mengatur lingkungan hybrid menggunakan layanan direktori dan tanpa menggunakan Windows. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id450572/">https://habr.com/ru/post/id450572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id450554/index.html">Breaking the Design Pattern - Singleton dalam PHP</a></li>
<li><a href="../id450556/index.html">Indeks Valve - review dari set VR baru</a></li>
<li><a href="../id450564/index.html">Berkilauan dan kemiskinan: bagaimana revolusi digital membuat musisi semakin miskin</a></li>
<li><a href="../id450566/index.html">OutOfMemory dan penggunaan gambar vektor di Android Studio</a></li>
<li><a href="../id450568/index.html">Setiap racun memiliki penawarnya sendiri. Bagaimana cara menyimpan atau setidaknya mencoba (upd: tentang penangkal racun rumah tangga)</a></li>
<li><a href="../id450574/index.html">Buat multiplayer .io web game</a></li>
<li><a href="../id450576/index.html">Aturan baru untuk anonimitas messenger</a></li>
<li><a href="../id450578/index.html">Apa yang terdengar di udara? Kami menerima dan mendekode sinyal yang paling menarik. Bagian 2, VHF</a></li>
<li><a href="../id450582/index.html">Prinsip PIM</a></li>
<li><a href="../id450586/index.html">Fish Redux - Perpustakaan Redux Baru untuk Flutter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>