<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüåæ üò≠ ‚Ü©Ô∏è Gera√ß√£o de n√≠vel processual ü•Ö ü§Ωüèª üîÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O trabalho de programa√ß√£o, gr√°ficos e sons em alguns jogos novos acabou - apenas os n√≠veis permanecem. Trabalho f√°cil e agrad√°vel, mas por alguma raz√£...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gera√ß√£o de n√≠vel processual</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418685/"><p><img src="https://habrastorage.org/webt/2m/0y/gv/2m0ygvmlc1izxgmo4chumrammxi.png"></p><br><p>  O trabalho de programa√ß√£o, gr√°ficos e sons em <em>alguns jogos novos</em> acabou - apenas os n√≠veis permanecem.  Trabalho f√°cil e agrad√°vel, mas por alguma raz√£o vem com grande dificuldade.  Talvez o efeito da fadiga geral. </p><br><p>  Pensando em como simplificar sua vida, surgiu a id√©ia de gera√ß√£o processual.  √â claro que tamb√©m ter√° que ser escrito, mas como foi dito em uma obra bem conhecida, "√© melhor perder um dia, depois voar em cinco minutos". </p><br><p>  <strong>Aten√ß√£o!</strong>  <strong>Sob o corte, muitos textos e gifs "gordos".</strong> </p><a name="habracut"></a><br><h2 id="vvodnaya">  Introdut√≥rio </h2><br><p>  Os n√≠veis ainda ser√£o polidos manualmente, portanto, n√£o h√° requisitos especiais para mem√≥ria, velocidade ou mesmo a qualidade dos n√≠veis resultantes. </p><br><p>  Inicialmente, planejei que o gerador jogasse apenas salas e portas, e todo o refinamento adicional (enredo, cen√°rio e inimigos) fosse realizado no modo manual.  Mas, por enquanto, acho que o gerador pode fazer muito mais.  No entanto, a sintonia manual ainda permanecer√° - √© necess√°rio que os jogadores sintam que pelo menos um pouco de amor √© investido nos n√≠veis. </p><br><p>  Analisei minha base de conhecimento no game dev e escrevi links para artigos sobre gera√ß√£o de procedimentos em um documento separado.  A maioria, √© claro, trata de gerar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">labirintos cl√°ssicos</a> ou de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gerar terreno</a> (a prop√≥sito, os resultados s√£o muito impressionantes), o que n√£o √© adequado para um jogo de tiro em 3D.  Mas alguns estavam perto do que eu precisava (com um asterisco, notei aqueles que me pareciam mais adequados): </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.progamer.ru/dev/procedural-dungeon-generation.htm</a> (*) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://habr.com/post/333692/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://www.gamasutra.com/blogs/GrahamDavis/20170130/290326/Procedural_Level_Generation_in_Unity_for_MERC_part_1_of_2.php</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://ijdykeman.github.io/ml/2017/10/12/wang-tile-procedural-generation.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://habr.com/post/332832/</a> (*) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://habr.com/post/184818/</a> (*) </li></ul><br><p>  Decidi come√ßar pelos dois √∫ltimos - eles est√£o sendo implementados e d√£o bons resultados. </p><br><h2 id="struktura-generatora">  Estrutura do gerador </h2><br><p>  De fato, n√£o cheguei a essa estrutura imediatamente, mas no processo de in√∫meras refatora√ß√µes e reescritas, mas escrevo sobre isso imediatamente, para que fique claro o que est√° acontecendo: </p><br><ol><li>  Gera√ß√£o da geometria inicial (para escolher - "BSP" ou layout da sala). </li><li>  Limpeza de se√ß√µes de lixo (se√ß√µes que n√£o podem existir no jogo). </li><li>  Construindo conex√µes. </li><li>  Limpeza de subgr√°ficos de lixo (grupos de se√ß√µes interconectados, mas n√£o h√° conex√£o com as se√ß√µes restantes). </li><li>  Limpando conex√µes desnecess√°rias (construindo uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√°rvore de abrang√™ncia</a> , √© fornecido um link para a √°rvore de abrang√™ncia <strong>m√≠nima</strong> , porque existe uma imagem l√°, mas para o gerador n√£o √© necess√°rio o m√≠nimo). </li><li>  A randomiza√ß√£o das conex√µes √© a restaura√ß√£o de algumas conex√µes remotas (para um n√≠vel mais "humano"), bem como a transforma√ß√£o de outras em passagens entre se√ß√µes (que mescla v√°rias se√ß√µes em uma forma mais complexa). </li><li>  Gera√ß√£o de quarto secreto. </li><li>  Gera√ß√£o de um ‚Äúcen√°rio‚Äù (onde estar√£o as se√ß√µes inicial e final e qual caminho dever√° ser percorrido para passar da inicial para a final). </li><li>  Otimiza√ß√£o de conex√£o. </li><li>  Criando portas e janelas. </li><li>  A escolha da a√ß√£o a ser executada nesta se√ß√£o (pressione o bot√£o, levante a tecla ou encontre a parede secreta). </li></ol><br><p>  Ainda existem cerca de 12 pontos, mas eles ainda n√£o foram conclu√≠dos (quando eu terminar, escreverei um post separado sobre eles). </p><br><h2 id="generaciya-iznachalnoy-geometrii-bsp">  Gera√ß√£o inicial de geometria: "BSP" </h2><br><p><img src="https://habrastorage.org/webt/zn/j4/_k/znj4_kemnzlvr4cfr45tqtzami8.gif"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Esta tradu√ß√£o</a> foi tomada como base.  N√£o tenho certeza do quanto isso acontece nesse algoritmo √© pr√≥ximo ao BSP real, ent√£o escrevo "BSP" entre aspas. </p><br><p>  O algoritmo √© bastante simples.  Inicialmente, crie um ret√¢ngulo do tamanho de todo o campo de jogo: </p><br><p><img src="https://habrastorage.org/webt/fh/mx/x-/fhmxx-boo4euwsc4dl2g0gfc2nk.png"></p><br><p>  Em seguida, dividimos-o aleatoriamente em duas partes - horizontal ou verticalmente.  Onde a linha de separa√ß√£o ocorrer√°, tamb√©m escolhemos aleatoriamente: </p><br><p><img src="https://habrastorage.org/webt/ml/lo/jm/mllojmhd2qxiga7ma_skqxqoera.png"></p><br><p>  Recursivamente, fazemos o mesmo para os novos ret√¢ngulos: </p><br><p><img src="https://habrastorage.org/webt/ew/sw/wf/ewswwfagu3jcskhcebem5sd-jo8.png"></p><br><p>  E de novo e de novo, at√© certo ponto: </p><br><p><img src="https://habrastorage.org/webt/fl/s-/hd/fls-hd2xm17ghbjbvnwpyhwzd_m.png"></p><br><p>  Ent√£o, em cada ret√¢ngulo, selecionamos uma ‚Äúsala‚Äù - um ret√¢ngulo do mesmo tamanho que o original ou menor (mas n√£o inferior a 3x3 - mais sobre o que est√° abaixo). </p><br><p><img src="https://habrastorage.org/webt/r8/h1/_y/r8h1_yacj5bpuux_xmmxuwzdlo0.png"></p><br><p>  Em seguida, os quartos s√£o conectados por corredores.  Mas n√£o cada um, mas um pouco complicado, porque eles s√£o armazenados em uma estrutura semelhante a "BSP" (consulte o algoritmo original para obter mais detalhes). </p><br><p><img src="https://habrastorage.org/webt/5t/y6/3e/5ty63ewmz5eey4oaphja4uixjuu.png"><br>  <em>O corredor que liga as se√ß√µes roxas e brancas.</em> </p><br><p>  No algoritmo original, as salas e os corredores s√£o da mesma cor (ou seja, s√£o equivalentes); portanto, os corredores s√£o simplesmente desenhados em cima das salas.  No meu caso, os quartos originais devem ser preservados, para que os corredores sejam desenhados como se estivessem "atr√°s" dos quartos. </p><br><p>  Al√©m disso, se a sala (turquesa na figura) cruzar o corredor, ela dever√° ser dividida em duas se√ß√µes diferentes (portanto, o mesmo corredor pode ser desenhado em cores diferentes): </p><br><p><img src="https://habrastorage.org/webt/5n/wr/51/5nwr510wdeg8x9iw3cgy_eorsau.png"></p><br><p>  E aqui est√° o resultado: </p><br><p><img src="https://habrastorage.org/webt/q4/hq/7r/q4hq7rocs2amqbt-guzspzcmbp4.png"></p><br><p>  Em seguida, come√ßa a fase de marca√ß√£o das c√©lulas de lixo: </p><br><p><img src="https://habrastorage.org/webt/f0/ob/sc/f0obscdf1tabhec9mxv4m-wrj5s.png"></p><br><p>  Como j√° escrevi, nenhum setor pode ser menor que c√©lulas 3x3.  Isso ocorre porque o setor deve estar cercado por paredes (pelo menos 1 c√©lula de cada lado) e deve ter pelo menos uma c√©lula de espa√ßo livre: </p><br><p><img src="https://habrastorage.org/webt/iy/e8/ne/iye8ne6qltvzxtwrpgrtjgmgeae.png"></p><br><p>  Portanto, todas as c√©lulas que n√£o se encaixam nessa regra s√£o rotuladas.  Mas pegue e voc√™ n√£o poder√° remov√™-los - muitas conex√µes desaparecem e o n√≠vel √© muito escasso. </p><br><p>  Em vez disso, para cada c√©lula rotulada, o setor no qual ela pode ingressar √© pesquisado (observando a regra 3x3): </p><br><p><img src="https://habrastorage.org/webt/nc/6q/-y/nc6q-yh8jlkx_rhlilpamtzt27s.png"><br>  <em>Se a c√©lula ainda n√£o puder ser atribu√≠da a nenhum setor, ela ser√° exclu√≠da (mas n√£o neste caso - est√° tudo bem aqui).</em> </p><br><p>  No √∫ltimo est√°gio, essa bela imagem √© vetorizada, e os setores desenhados se transformam em caixas de pol√≠gono - pol√≠gonos nos quais cada aresta √© estritamente vertical ou estritamente horizontal (provavelmente existe um nome mais cient√≠fico): </p><br><p><img src="https://habrastorage.org/webt/xx/8x/8v/xx8x8vpyawz-uricpycndaadgfy.png"></p><br><h2 id="generaciya-iznachalnoy-geometrii-planirovka-pomescheniy">  Gera√ß√£o inicial da geometria: layout da sala </h2><br><p><img src="https://habrastorage.org/webt/7w/jh/nb/7wjhnbk6xzc6zmdaqyiufpq7t5m.gif"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Outro artigo</a> foi tomado como base.  Este algoritmo √© um pouco mais complicado que o anterior, mas tamb√©m n√£o √© um foguete. </p><br><p>  Primeiro, o campo de jogo √© preenchido com um certo valor de parada e, em seguida, uma √°rea retangular √© limpa aleatoriamente: </p><br><p><img src="https://habrastorage.org/webt/4n/24/py/4n24pyropjvmm0d8gsmzj9znte0.png"></p><br><p>  A etapa de limpeza de um ret√¢ngulo aleat√≥rio √© realizada mais um n√∫mero (tamb√©m aleat√≥rio) de vezes e, como resultado, os contornos externos do n√≠vel s√£o obtidos: </p><br><p><img src="https://habrastorage.org/webt/np/4v/fi/np4vfi_iumlrznv8bsy8ba3babk.png"></p><br><p>  No espa√ßo livre, os pontos de crescimento da sala s√£o espalhados aleatoriamente (o tamanho m√≠nimo da sala √© 3x3): </p><br><p><img src="https://habrastorage.org/webt/2y/wm/3n/2ywm3n3lgak23tcn0dmyshbicne.png"></p><br><p>  O primeiro est√°gio do crescimento da sala come√ßa - para cada sala, o lado maior √© selecionado, que ainda pode crescer, e cresce em 1 c√©lula (se houver v√°rios lados com o mesmo comprimento - um aleat√≥rio).  Os quartos s√£o movidos por sua vez, para que n√£o haja cruzamentos. </p><br><p><img src="https://habrastorage.org/webt/-b/4r/cd/-b4rcdczwe-_hu8xvha_cko1ihk.gif"></p><br><p>  Em seguida, os quartos s√£o convertidos em polyboxes: </p><br><p><img src="https://habrastorage.org/webt/pd/j8/qo/pdj8qos36_hf4slo-jlm2eailsw.png"></p><br><p>  E o segundo est√°gio do crescimento come√ßa - nesse est√°gio, o lado pode ser dividido em v√°rias partes.  Ao contr√°rio do primeiro est√°gio, ele n√£o cresce uma c√©lula de cada vez, mas imediatamente at√© a parada m√°xima - isso evita a "escada" nas juntas dos quartos.  Se ap√≥s a passagem por todas as salas ainda houver c√©lulas vazias, o ciclo se repete. </p><br><p>  O resultado √© um espa√ßo totalmente preenchido: </p><br><p><img src="https://habrastorage.org/webt/mi/8j/zf/mi8jzfzhpksr2cz7jzd1_k3gmng.png"></p><br><p>  Em seguida, as policarboxes s√£o desenhadas na forma de uma varredura e (como no caso do gerador "BSP"), o est√°gio de marca√ß√£o das c√©lulas "lixo" come√ßa: </p><br><p><img src="https://habrastorage.org/webt/ev/na/ru/evnaruhyjwsei7hfbywiiuxyzq4.png"></p><br><p>  E juntando-os aos setores existentes: </p><br><p><img src="https://habrastorage.org/webt/1h/yv/kf/1hyvkfcnerw5yu30txvbztecfzw.png"><br>  <em>Aqui n√£o foi poss√≠vel anexar todas as c√©lulas - as extras foram removidas.</em> </p><br><p>  O resultado √© convertido novamente em polyboxes: </p><br><p><img src="https://habrastorage.org/webt/ji/l3/yq/jil3yqqnbqpf4cfjyx-sklb_g8w.png"></p><br><h2 id="ochistka-ot-musornyhsekciy">  Limpeza de se√ß√µes de lixo </h2><br><p>  √Äs vezes, surgem se√ß√µes dentro das quais a regra 3x3 n√£o √© respeitada: </p><br><p><img src="https://habrastorage.org/webt/6v/zx/2v/6vzx2vnhvhn_kkxvqp1jyzenh6g.png"></p><br><p>  Voc√™ pode tentar "restaurar" essas se√ß√µes, mas eu segui o caminho mais simples e as apague: </p><br><p><img src="https://habrastorage.org/webt/gc/5s/4y/gc5s4yzeywvc6pi1kh0apfk90pm.png"></p><br><h2 id="postroenie-soedineniy">  Construindo conex√µes </h2><br><p><img src="https://habrastorage.org/webt/af/3m/w2/af3mw25mgkjtqwskriypbpzzaeo.gif"></p><br><p>  Para cada se√ß√£o, seus vizinhos s√£o pesquisados ‚Äã‚Äãe, nos locais de contato de tais se√ß√µes, conex√µes s√£o criadas.  As conex√µes s√£o criadas nos dois lados - se a se√ß√£o A estiver em contato com a se√ß√£o B, haver√° uma conex√£o de A a B e de B a A. O resultado √© um gr√°fico bidirecional. </p><br><h2 id="ochistka-ot-musornyh-podgrafov">  Compensa√ß√£o de subgr√°ficos de lixo </h2><br><p>  √Äs vezes, como resultado da limpeza das se√ß√µes de lixo, obtemos n√£o um gr√°fico, mas v√°rios independentes, como neste exemplo: </p><br><p><img src="https://habrastorage.org/webt/yi/s5/5u/yis55urvft0bohq8x0dsurgyyam.png"></p><br><p>  Nesse caso, o subgr√°fico √© selecionado como o principal, cuja ‚Äú√°rea‚Äù das se√ß√µes √© m√°xima e o restante √© exclu√≠do (a ‚Äú√°rea‚Äù est√° entre aspas, porque, embora seja poss√≠vel calcular a √°rea real da caixa de polivinil, simplifiquei a tarefa e considero a √°rea da caixa delimitadora - isso est√° errado, mas √© adequado para um gerador). </p><br><h2 id="ochistka-ot-izlishnih-soedineniy">  Remo√ß√£o de excesso de compostos </h2><br><p>  Se houver uma passagem de cada setor para cada um com o qual est√° conectado, haver√° muitas portas no n√≠vel e ser√° mais fortemente sentido que ele √© gerado.  Portanto, nesse est√°gio, as conex√µes em excesso s√£o removidas: </p><br><p><img src="https://habrastorage.org/webt/oa/sh/oy/oashoyuavho98281lo_s4hpc-ks.gif"></p><br><p>  Para mais randomiza√ß√£o, n√£o gero uma √°rvore de abrang√™ncia no n√∫mero m√≠nimo de passes, mas excluo uma aresta aleat√≥ria de cada vez (escolhendo-a aleatoriamente dentre todas as poss√≠veis na etapa atual). </p><br><p>  <em>Embora, quando escrevo isso, pareceu que seria bastante aleat√≥rio selecionar o setor inicial e remover as bordas do algoritmo j√° mais eficiente.</em> </p><br><h2 id="randomizaciya-soedineniy">  Randomiza√ß√£o de conex√£o </h2><br><p><img src="https://habrastorage.org/webt/ok/zl/vk/okzlvk4rclc7x3imkpjnjza3kje.gif"><br>  <em>A seguir, as ilustra√ß√µes vir√£o de outra gera√ß√£o, porque</em>  <em>no anterior houve um erro no gerador, devido ao qual outras imagens estavam incorretas.</em> </p><br><p>  Mas um n√≠vel em que n√£o h√° uma √∫nica conex√£o sup√©rflua tamb√©m n√£o parece muito humano; portanto, √© introduzido um caos: </p><br><ol><li>  Algumas arestas exclu√≠das s√£o restauradas. </li><li>  E alguns se transformam em corredores. </li></ol><br><p>  Al√©m disso, as se√ß√µes entre as quais as passagens foram formadas se fundem em uma: </p><br><p><img src="https://habrastorage.org/webt/nh/j_/uj/nhj_ujd0n7sqjdnddlvs9uozq5u.gif"><br>  <em>Se lhe pareceu que nesta ilustra√ß√£o as conex√µes exclu√≠das na etapa anterior reapareceram - pareceu-lhe :).</em>  <em>Quando li o texto, tamb√©m me pareceu assim, mas, olhando atentamente a ilustra√ß√£o anterior, fica claro que est√° tudo bem.</em> </p><br><h2 id="generaciya-sekretnyh-komnat">  Gera√ß√£o de quarto secreto </h2><br><p>  Os setores que possuem apenas uma conex√£o s√£o selecionados no gr√°fico: </p><br><p><img src="https://habrastorage.org/webt/xt/ku/qw/xtkuqweqgctwcbcckilick4-es4.png"></p><br><p>  Se houver v√°rios desses setores, todos eles se reunir√£o em uma matriz e ser√£o classificados por "√°rea".  Em seguida, essa matriz √© truncada aleatoriamente (mas para que pelo menos um elemento permane√ßa nela).  Esses setores se tornar√£o salas secretas: </p><br><p><img src="https://habrastorage.org/webt/pf/w0/yu/pfw0yufvv3orwiw_xohtfii8gqi.png"></p><br><h2 id="generaciya-scenariya">  Gera√ß√£o de scripts </h2><br><p><img src="https://habrastorage.org/webt/p2/ql/dn/p2qldn0n-scgjotykszlvsvd05a.gif"></p><br><p>  Primeiro, os setores com o n√∫mero m√≠nimo de conex√µes livres (ou seja, os mais pr√≥ximos da "aresta" do gr√°fico) s√£o selecionados: </p><br><p><img src="https://habrastorage.org/webt/lc/iw/7v/lciw7vahyrhoirla-hyahd7jzhu.png"><br>  <em>Nesta ilustra√ß√£o, um setor √© selecionado, mas se houvesse mais, de qualquer maneira um seria selecionado (aleatoriamente).</em> </p><br><p>  <em>NB</em>  <em>Durante a revis√£o do artigo, pude me deparar com uma situa√ß√£o em que um setor com um n√∫mero m√≠nimo de conex√µes livres n√£o estar√° apenas no limite, mas atribuir um script a ele levar√° a um n√≠vel intransit√°vel.</em>  <em>De fato, voc√™ pode escolher qualquer setor, mas apenas um, ap√≥s o qual o gr√°fico n√£o se enquadra em v√°rios subgr√°ficos.</em> </p><br><p>  Em seguida, selecione os setores que est√£o conectados ao setor atual e que possuem apenas uma conex√£o gratuita.  Eles, com alguma probabilidade, ser√£o usados ‚Äã‚Äãpara continuar o script.  Por exemplo, se o gr√°fico for o mesmo da ilustra√ß√£o abaixo, o setor indicado pela pergunta poder√° ser inclu√≠do na lista. </p><br><p><img src="https://habrastorage.org/webt/6u/b6/vf/6ub6vfbxncsmbug4optzec19gyw.png"><br>  <em>A sala secreta est√° marcada em cinza, as cruzes s√£o aquelas conex√µes que deveriam ter sido removidas no gr√°fico original e o setor de origem √© uma vantagem.</em> </p><br><p>  <em>NB</em>  <em>Durante a revis√£o do artigo, pareceu-me que a condi√ß√£o para a presen√ßa de apenas uma conex√£o era muito r√≠gida, a mesma que na etapa anterior seria suficiente - para que, ap√≥s a exclus√£o desse setor, o gr√°fico n√£o se decomponha.</em> </p><br><p>  Em seguida, o n√∫mero do script √© atribu√≠do a essa lista de setores (apenas um n√∫mero, nesse est√°gio n√£o significa nada espec√≠fico), e as conex√µes nas bordas dessa lista de setores s√£o marcadas como fechadas por esse script. </p><br><p><img src="https://habrastorage.org/webt/tw/4w/3w/tw4w3wxhybxndd5_94mw-l0e1zc.png"><br>  <em>Nestas ilustra√ß√µes, cen√°rios diferentes ter√£o cores de preenchimento de setor diferentes.</em>  <em>Eles n√£o t√™m nada a ver com a cor da borda do setor (nas pr√≥ximas etapas ser√° corrigido, mas nesta etapa √© mais conveniente para mim).</em> </p><br><p>  Em seguida, o pr√≥ximo setor √© selecionado, uma lista √© compilada e essa lista √© marcada com um novo cen√°rio: </p><br><p><img src="https://habrastorage.org/webt/qo/01/qw/qo01qww9cg-s2km6vfrjvoqb_vk.png"></p><br><p>  Preste aten√ß√£o aos pequenos pontos azuis dentro dos quadrados vermelhos - √© assim que o abridor de cen√°rio √© desenhado - ou seja,  em algum lugar dentro da se√ß√£o com o script vermelho, haver√° uma chave ou chave que abrir√° a passagem para setores com um script azul. </p><br><p>  Isso continua at√© que n√£o haja setores livres restantes: </p><br><p><img src="https://habrastorage.org/webt/5f/ok/yn/5fokynxff0gfpspu7-d8paaw7wi.png"></p><br><p>  O setor mais recente n√£o recebe um script, mas apenas um abridor de cen√°rio.  Este setor ser√° o setor em que o jogador inicia o jogo. </p><br><p>  Para este n√≠vel: </p><br><ul><li>  O jogador come√ßa no setor inicial, em algum lugar l√° encontra um "abridor de garrafas" para o setor amarelo, vai para l√°. </li><li>  No setor amarelo, abre o setor azul, vai l√°. </li><li>  No setor azul abre verde, vai l√°. </li><li>  No setor verde abre roxo, vai l√°. </li><li>  Em roxo abre vermelho. </li><li>  Em vermelho - azul. </li><li>  Onde ele encontra a chave de n√≠vel final. </li></ul><br><p>  Esquematicamente, isso pode ser mostrado da seguinte maneira: </p><br><p><img src="https://habrastorage.org/webt/c7/6o/xd/c76oxdwcgff53io6pv3sfcptpuu.png"></p><br><p>  Um "abridor" pode ser uma chave ou um comutador, ou qualquer outra coisa, por exemplo, uma tarefa para destruir todos os inimigos em qualquer setor (mas n√£o planejo que, em um futuro pr√≥ximo, o gerador ou o motor suporte isso). </p><br><h2 id="optimizaciya-soedineniy">  Otimiza√ß√£o de conex√£o </h2><br><p><img src="https://habrastorage.org/webt/5q/vl/gw/5qvlgwjtnablead4upxcwph7m6k.gif"></p><br><p>  Nesta etapa, para cada conex√£o, um lado √© selecionado (como voc√™ se lembra, inicialmente as conex√µes s√£o geradas nas duas dire√ß√µes).  Isso √© necess√°rio para que o n√≠vel pare√ßa mais "manual" e para simplificar as pr√≥ximas etapas <em>(mas, para um tipo de n√≠vel ainda mais interessante, em um futuro pr√≥ximo, planejo dar o passo de "desotimizar" algumas conex√µes)</em> . </p><br><h2 id="sozdanie-dverey-iokon">  Criando portas e janelas </h2><br><p><img src="https://habrastorage.org/webt/xr/je/m5/xrjem5kqzr7ncka2vuf8nsukw2c.gif"></p><br><p>  Para cada setor, todas as suas conex√µes s√£o visualizadas (que ap√≥s a etapa anterior parecem apenas em uma dire√ß√£o), e portas e janelas s√£o colocadas em cada conex√£o visualizada. </p><br><ul><li>  Primeiro, um ponto √© selecionado na jun√ß√£o, de prefer√™ncia mais perto do centro. </li><li>  Ent√£o, nesse ponto, uma porta ou uma janela √© colocada (e, se for uma conex√£o com uma sala secreta, uma parede secreta). </li><li>  Se uma porta for colocada, ela poder√° ter de 1 a 3 c√©lulas (uma √© uma porta comum, duas ou tr√™s s√£o uma porta herm√©tica grossa, que se abre ap√≥s pressionar um bot√£o). </li><li>  Al√©m disso, a conex√£o √© dividida em duas partes - a parte antes do ponto selecionado e a parte depois.  E, se houver espa√ßo restante antes ou depois, a fun√ß√£o ser√° chamada recursivamente. </li></ul><br><p>  Para tornar o n√≠vel mais interessante, em diferentes etapas, h√° uma probabilidade diferente de colocar uma porta ou janela: </p><br><ol><li>  Na primeira etapa, a porta √© sempre colocada, porque  qual √© a utilidade da conex√£o se houver apenas janelas l√°. </li><li>  No segundo passo, com <strong>uma</strong> probabilidade mais alta (75%), uma janela √© colocada que uma porta. </li><li>  Se houver uma terceira etapa (por exemplo, a conex√£o √© longa), uma janela dever√° ser colocada nela. </li><li>  No caso do quarto passo, a porta ou janela √© colocada igualmente prov√°vel. </li><li>  Se a conex√£o for extra longa, o gerador retornar√° √† segunda etapa. </li></ol><br><h2 id="vybor-deystviya">  Sele√ß√£o de a√ß√£o </h2><br><p>  Embora isso n√£o esteja relacionado √† gera√ß√£o, a visualiza√ß√£o muda nesta etapa - agora a borda do setor √© pintada na cor do script: </p><br><p><img src="https://habrastorage.org/webt/rc/6y/xv/rc6yxvsq6duv-xdujaamzq0fdry.png"><br>  <em>O setor inicial √© cinza claro, o setor final √© azul.</em>  <em>Observe tamb√©m que, em vez da porta da sala secreta (cinza escuro √† esquerda), uma parede √© desenhada - tudo est√° correto, essa √© uma parede secreta.</em> </p><br><p>  Em seguida, selecione os setores nos quais voc√™ pode colocar as chaves: </p><br><p><img src="https://habrastorage.org/webt/kl/os/jz/klosjzmyvv_tl2djbz5v6b9sqze.png"></p><br><p>  Eles s√£o selecionados simplesmente: </p><br><ul><li>  Se essa √© uma sala secreta, n√£o pode haver "abridor" nela e a chave n√£o pode ser colocada l√°. </li><li>  Voc√™ tamb√©m n√£o pode colocar a chave no setor final, porque √© final. </li><li>  Al√©m disso, a chave n√£o pode abrir portas duplas e triplas - devido √†s caracter√≠sticas do motor, elas s√≥ podem ser abertas com o interruptor <em>(n√£o existem setores na ilustra√ß√£o acima)</em> . </li></ul><br><p>  Depois disso, o n√∫mero de chaves em um n√≠vel (de zero a tr√™s) √© selecionado aleatoriamente e, em seguida, aleatoriamente, na lista de setores dispon√≠veis, s√£o selecionados aqueles em que haver√° chaves. </p><br><p>  Nos demais setores, haver√° interruptores. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt418685/">https://habr.com/ru/post/pt418685/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt418675/index.html">Como eu fui ao Droidcon Berlin</a></li>
<li><a href="../pt418677/index.html">Toda a verdade sobre o RTOS. Artigo 6. Outros servi√ßos RTOS</a></li>
<li><a href="../pt418679/index.html">Escrevemos um componente com bot√µes "materiais" para o Svelte</a></li>
<li><a href="../pt418681/index.html">Dia da Amizade - 50% de desconto em todos os IDEs do JetBrains para nossos amigos</a></li>
<li><a href="../pt418683/index.html">Criando uma m√°quina de arcade emulador. Parte 2</a></li>
<li><a href="../pt418687/index.html">Revolu√ß√£o de 3,5 ": detalhes de um pequeno boom de disquetes com vapores</a></li>
<li><a href="../pt418689/index.html">Como criar bibliotecas de componentes no Figma, economizando um or√ßamento, usando o exemplo de um leil√£o online</a></li>
<li><a href="../pt418691/index.html">Rancheiro: Kubernetes em 5 minutos em bare metal</a></li>
<li><a href="../pt418693/index.html">Por que a felicidade √© t√£o dif√≠cil de detectar no c√©rebro</a></li>
<li><a href="../pt418695/index.html">Guerras antipirataria - O imp√©rio contra-ataca</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>