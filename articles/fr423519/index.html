<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóìÔ∏è üèß üçÖ Monstre errant: comment se d√©barrasser des probl√®mes sur la carte üê® ü§üüèø üïì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D√©j√† en train de cr√©er The Witness est devenu l'un de mes jeux pr√©f√©r√©s. J'ai commenc√© √† jouer √† partir du moment o√π Jonathan Blow a commenc√© √† le d√©v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monstre errant: comment se d√©barrasser des probl√®mes sur la carte</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423519/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bda/24d/6ba/bda24d6ba69e530c352a7d9a0e3c8a3a.png" alt="image"></div><br>  D√©j√† en train de cr√©er <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Witness</a> est devenu l'un de mes jeux pr√©f√©r√©s.  J'ai commenc√© √† jouer √† partir du moment o√π <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jonathan Blow a</a> commenc√© √† le d√©velopper, et je ne pouvais pas attendre sa sortie. <br><br>  Contrairement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">au</a> jeu pr√©c√©dent de John <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Braid, l'</a> √©chelle des ressources et de la programmation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Witness</a> √©tait beaucoup plus proche des projets AAA que des jeux ind√©pendants.  Quiconque travaille sur de tels projets sait que la quantit√© de travail lors du choix de cette voie augmente consid√©rablement.  Il y avait beaucoup plus de personnes travaillant sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Witness</a> que sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Braid</a> , mais comme pour tout projet de ce niveau, de nombreux aspects n√©cessitent plus d'attention que la gestion de projet ne peut se le permettre. <br><br>  Par cons√©quent, j'ai toujours voulu trouver du temps libre pour aider √† cr√©er <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Witness</a> lors de la sortie du jeu.  Alors un jour, Thanksgiving, John et moi nous sommes assis et avons regard√© la liste des choses dans la base de code qui b√©n√©ficieraient des efforts suppl√©mentaires d'un autre programmeur.  Apr√®s avoir d√©cid√© de l'importance relative des √©l√©ments de la liste, nous avons d√©cid√© que le gameplay b√©n√©ficierait le plus si nous apportions des am√©liorations au code de mouvement du joueur. <br><a name="habracut"></a><br><h2>  Walkmonster dans le mur </h2><br>  Dans le contexte de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Witness</a> , l'objectif du code de mouvement d'un joueur est d'√™tre aussi discret que possible.  Le joueur doit s'immerger compl√®tement dans une r√©alit√© alternative, et dans cette exp√©rience de jeu, chaque d√©tail est important.  La derni√®re chose que nous voulions √©tait que le joueur remarque qu'il √©tait assis devant l'ordinateur et bougeait la cam√©ra virtuelle. <br><br>  Par cons√©quent, le code de mouvement du joueur doit √™tre absolument fiable.  Si un joueur s'accroche aux coins, se coince dans les murs, tombe √† travers le sol, descend d'une colline sans possibilit√© de revenir en arri√®re, etc., cela d√©truira instantan√©ment l'illusion d'immersion et rappellera au joueur qu'il est dans un processus de jeu artificiel qui est g√™n√© par un syst√®me peu fiable d√©placements.  Dans certaines circonstances, cela peut m√™me entra√Æner des cons√©quences d√©sastreuses pour le joueur s'il n'a pas la possibilit√© de r√©soudre le probl√®me en red√©marrant le jeu ou en rechargeant la sauvegarde (probablement tr√®s ancienne).  Si vous jouez souvent √† des jeux, vous devez avoir rencontr√© des probl√®mes de ce type et vous savez ce que je veux dire. <br><br>  Apr√®s notre discussion, j'ai commenc√© √† travailler sur cette t√¢che.  Tout d'abord, j'ai d√©cid√© d'√©crire des outils int√©gr√©s pour travailler avec le code de mouvement du joueur, afin que nous puissions l'analyser et observer son comportement actuel.  Apr√®s avoir ouvert le projet, je suis tomb√© sur un grave probl√®me d√©j√† connu de moi: que dois-je nommer le premier fichier de code source?  C'est toujours la partie la plus importante de tout projet ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme l'a dit Bob Pollard √† propos des noms des groupes musicaux et des albums</a> ).  Si vous donnez au fichier source un nom appropri√©, les travaux ult√©rieurs seront clairs et fluides.  Choisissez le mauvais - vous pouvez d√©truire tout le projet. <br><br>  Mais quel est le nom du syst√®me pour garantir la qualit√© du code de mouvement du joueur?  Je n'ai jamais eu √† √©crire de code comme √ßa auparavant.  Quand j'y ai pens√©, j'ai r√©alis√© que personnellement je n'ai vu un exemple d'un tel code qu'une seule fois: lors de la lecture de la premi√®re version b√™ta de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Quake</a> .  Il contenait des bogues avec l'emplacement des monstres, et dans la fen√™tre de la console, vous pouviez voir des messages d'erreur indiquant que des monstres, au lieu de cr√©er √† la surface de la terre, √©taient cr√©√©s, se croisant partiellement avec la g√©om√©trie des niveaux.  Chaque message de d√©bogage commen√ßait par la phrase ¬´walkmonster in wall at ...¬ª <br><br>  Bingo!  Il est difficile de trouver un meilleur nom pour le fichier de code que "walk_monster.cpp".  Et j'√©tais presque s√ªr que d√©sormais le code serait cr√©√© sans probl√®me. <br><br><h2>  Mouvement au point </h2><br>  Lorsque vous souhaitez tester le syst√®me, la chose la plus importante est <i>de tester r√©ellement le syst√®me</i> .  Bien que cette r√®gle semble simple, les personnes qui √©crivent des tests ne se conforment souvent pas. <br><br>  Dans notre cas particulier, il est tr√®s facile d‚Äô <i>imaginer</i> que nous testons le code de mouvement d‚Äôun joueur sans le tester r√©ellement.  Voici un exemple: vous pouvez analyser le volume de collisions et de surfaces sur lesquelles vous pouvez vous d√©placer dans le jeu, rechercher de petites surfaces, des lacunes, etc.  Apr√®s avoir √©limin√© tous ces probl√®mes, nous pouvons dire que le joueur peut d√©sormais se d√©placer et marcher en toute s√©curit√© dans le monde. <br><br>  Mais en fait, nous avons test√© les donn√©es, pas le code.  Il est tr√®s probable qu'il y aura des bogues dans le code de mouvement qui conduiront √† un mauvais comportement m√™me avec des donn√©es de haute qualit√©. <br><br>  Pour √©viter un tel pi√®ge, je voulais que le syst√®me de test soit aussi proche que possible du comportement de la personne qui contr√¥le r√©ellement le mouvement du personnage dans le jeu.  J'ai commenc√© par √©crire deux proc√©dures qui deviendraient les √©l√©ments constitutifs de ces tests. <br><br>  La premi√®re proc√©dure est la plus proche des actions humaines r√©elles.  Il s'agit d'un appel de mise √† jour qui se connecte au syst√®me de traitement d'entr√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">du t√©moin</a> et lui transmet les √©v√©nements synth√©tis√©s du clavier et de la souris.  Il est capable de faire des choses simples qu'une personne peut faire: regarder autour, aller vers un point, regarder un point, etc.  La proc√©dure effectue ces actions en √©mulant simplement l'interaction de l'utilisateur avec le clavier et la souris, donc j'√©tais s√ªr que lors du traitement de l'entr√©e de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Witness,</a> tout se fera exactement comme lors des tests.  Dans les articles suivants, je parlerai davantage de ce syst√®me et de son utilisation. <br><br>  La deuxi√®me proc√©dure est une √©tape qui n'est pas utilis√©e √† ce niveau.  Il s'agit d'une fonction appel√©e <i>DriveTowardPoint</i> , qui re√ßoit deux points dans le monde et, provoquant un syst√®me de collision existant d'un joueur, tente de se d√©placer en toute transparence d'un point √† un autre.  En effectuant le retour, elle transmet des informations sur la tentative: quels obstacles elle a rencontr√©s sur le chemin et si elle a r√©ussi √† atteindre le point final. <br><br>  Cette fonction n'est pas aussi fiable qu'une m√©thode de test avec entr√©e synth√©tis√©e, car elle √©limine une partie du syst√®me de mouvement du joueur des tests.  Par exemple, toute condition erron√©e associ√©e √† l'emplacement du joueur en cas de probl√®mes avec le syst√®me de collision n'affectera pas les tests utilisant cette fonction.  N√©anmoins, j'ai jug√© ce niveau de test pr√©cieux, car il peut tester de vastes zones beaucoup plus rapidement, car il ne n√©cessite pas l'ex√©cution de tout le cycle de jeu, c'est-√†-dire qu'il peut √™tre utilis√© beaucoup plus souvent dans le monde, et pas seulement dans des cycles de test s√©par√©s. . <br><br>  Il convient √©galement de noter que cette fonction ne transmet pas de donn√©es d'entr√©e physiques;  par exemple, les vitesses ne sont pas indiqu√©es pour le point de d√©part.  C'est parce que <i>The Witness</i> n'est pas un jeu d'action, donc le joueur a peu de propri√©t√©s physiques importantes.  Les joueurs ne peuvent pas sauter, courir sur les murs, allumer la balle.  Vous pouvez prendre en charge de tels comportements √† l'aide de syst√®mes que je d√©crirai plus tard, mais ils ajoutent des niveaux de complexit√© qui n'√©taient pas requis dans notre projet. <br><br>  Quoi qu'il en soit, apr√®s avoir impl√©ment√© <i>DriveTowardPoint,</i> j'ai pu commencer √† r√©soudre la premi√®re t√¢che du syst√®me: d√©terminer o√π le joueur peut se d√©placer vers l'√Æle des <i>t√©moins</i> . <br><br><h2>  Explorer rapidement des arbres al√©atoires </h2><br>  O√π les joueurs peuvent-ils aller?  Cela semble √™tre une question simple, mais vous serez surpris de savoir combien de jeux ont √©t√© publi√©s lorsque l'√©quipe de d√©veloppement ne connaissait pas la vraie r√©ponse.  Si cela est possible, je voulais que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Witness</a> soit l'un de ces rares jeux dans lesquels les d√©veloppeurs avant la sortie savaient exactement o√π un joueur pouvait et ne pouvait pas obtenir - pas de surprise. <br><br>  Cela rend l'√©nonc√© du probl√®me (mais probablement pas sa solution) tr√®s simple: s'il existe une fonction <i>DriveTowardPoint</i> qui d√©termine de mani√®re fiable si le joueur peut se d√©placer en ligne droite entre deux points, cr√©ez une carte de couverture montrant o√π le joueur peut √™tre. <br><br>  Pour une raison quelconque, sans √©crire une seule ligne de code, pour une raison quelconque, j'ai pens√© qu'il serait pr√©f√©rable d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rapidly Exploring Random Tree</a> .  Pour ceux qui ne connaissent pas cet algorithme, je vais vous expliquer: il s'agit d'un processus tr√®s simple dans lequel nous enregistrons tous les points que nous avons visit√©s en r√©f√©rence au point d'o√π nous venons.  Pour ajouter un point √† l'arbre, nous prenons un point cible al√©atoire n'importe o√π dans le monde, s√©lectionnons le point le plus proche de lui, d√©j√† dans l'arbre, et essayons d'aller de ce point √† la cible.  L'endroit o√π nous nous sommes retrouv√©s devient le prochain point d'√©chantillonnage. <br><br>  Habituellement, cet algorithme est utilis√© pour rechercher des chemins: alternativement pour des points al√©atoires, nous s√©lectionnons toujours le m√™me point que la cible.  Cela incline l'exploration de l'espace vers le point cible, et c'est ce qui est requis lorsque notre seule t√¢che est d'atteindre le but.  Mais dans ce cas, je voulais cr√©er une carte compl√®te des endroits o√π le joueur pourrait tomber, donc je n'utilise que des √©chantillons al√©atoires. <br><br>  Apr√®s avoir impl√©ment√© cet algorithme (heureusement, il est tr√®s simple et n'a pas demand√© beaucoup de temps), j'ai vu qu'il effectuait un assez bon travail d'exploration de l'espace (les chemins indiqu√©s sont repr√©sent√©s par des chemins blancs et les lignes rouges verticales indiquent les endroits o√π l'algorithme est entr√© en collision avec un obstacle) : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed2/ca3/fe3/ed2ca3fe3dbfe02cb7c9779af50f9ca6.png"></div><br>  Cependant, apr√®s avoir observ√© son comportement, j'ai r√©alis√© qu'en fait je n'ai pas besoin d'un tel algorithme.  Par exemple, m√™me apr√®s de nombreuses it√©rations, il est √† peine capable d'explorer les pi√®ces similaires √† celles illustr√©es ci-dessous, malgr√© la couverture dense des zones ext√©rieures.  En effet, il n'est tout simplement pas en mesure de s√©lectionner des points suffisamment al√©atoires √† l'int√©rieur des pi√®ces: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/983/2d4/5a5/9832d45a5c14dc13df9a03cf5216697f.png" width="1280" height="720"></div><br>  Si j'y r√©fl√©chissais avant de commencer le travail, je comprendrais que l'avantage d'algorithmes comme Rapidly Exploring Random Tree est qu'ils explorent efficacement les espaces de grande dimension.  En fait, c'est g√©n√©ralement la principale raison de leur utilisation.  Mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Witness n'a</a> pas d'espaces de grande dimension.  Nous avons un espace √† deux dimensions (oui, distribu√© sur une vari√©t√© complexe, mais c'est toujours un espace √† deux dimensions). <br><br>  Dans cet espace de faible dimension, les avantages de Rapidly Exploring Random Tree sont faibles et son inconv√©nient est extr√™mement important pour ma t√¢che: l'algorithme est con√ßu pour la recherche la plus efficace de chemins vers des paires de points connect√©s dans l'espace, et non pour une recherche efficace de tous les points accessibles de cet espace.  Si vous avez une telle t√¢che, alors en fait l'exploration rapide de l'arbre al√©atoire prendra beaucoup de temps pour la r√©soudre. <br><br>  J'ai donc rapidement r√©alis√© que je devais rechercher un algorithme qui couvrait efficacement les espaces de faible dimension. <br><br><h2>  Remplissage d'inondation 3D </h2><br>  Quand j'ai vraiment pens√© √† choisir un algorithme, il est devenu √©vident qu'en fait j'avais besoin de quelque chose comme le bon vieux remplissage bidimensionnel, qui est utilis√© pour remplir des zones du bitmap.  Pour tout point de d√©part, je devais juste remplir tout l'espace, en v√©rifiant de mani√®re exhaustive toutes les mani√®res possibles.  Malheureusement, pour de nombreuses raisons, la solution pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Witness</a> sera beaucoup plus compliqu√©e que pour un bitmap bidimensionnel. <br><br>  Premi√®rement, nous n'avons pas de concept clair de la connexit√© finie d'un point.  Tout l'espace est continu.  C'est pour un pixel, nous pouvons facilement lister 4 endroits possibles qui peuvent √™tre atteints √† partir d'un point donn√©, et v√©rifier chacun d'eux √† tour de r√¥le. <br><br>  Deuxi√®mement, il n'y a pas de taille fixe de position dans l'espace, comme un pixel sur un bitmap.  Les surfaces sur lesquelles le joueur se d√©place et les obstacles peuvent √™tre n'importe o√π, ils n'ont pas de taille topologique maximale ou minimale, ainsi que pas de liaison √† une grille externe. <br><br>  Troisi√®mement, bien que le mouvement √† travers l'espace <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Witness</a> puisse √™tre consid√©r√© localement comme se d√©pla√ßant le long d'un avion, l'espace lui-m√™me est en fait une vari√©t√© profond√©ment interconnect√©e et changeante, dans laquelle les zones de marche du joueur sont directement au-dessus d'autres zones (parfois il peut y avoir plusieurs niveaux situ√©s l'un au-dessus de l'autre) .  De plus, il existe des connexions qui varient en fonction des conditions du monde (portes ouvertes / ferm√©es, ascenseurs qui montent / tombent, etc.). <br><br>  Compte tenu des difficult√©s d√©crites, il est tr√®s simple de trouver votre propre option de mise en ≈ìuvre pour le remplissage, qui sera par cons√©quent rempli de zones qui se croisent, de routes importantes manquantes, d'informations erron√©es sur les connexions dans des endroits complexes de la vari√©t√©.  En fin de compte, l'algorithme sera trop lourd √† utiliser, car pour tenir compte des changements de l'√©tat du monde, il doit √™tre r√©ex√©cut√©. <br><br>  Je n'ai pas pens√© √† une bonne solution tout de suite, alors j'ai d√©cid√© de commencer par des exp√©riences simples.  En utilisant le code d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">arbre al√©atoire √† exploration rapide que</a> j'ai √©crit, j'ai chang√© la s√©lection des points cibles de al√©atoire √† tr√®s contr√¥l√©e.  Chaque fois qu'un nouveau point a √©t√© ajout√© √† l'arbre, j'ai indiqu√© que les points sont √† une distance unitaire le long des directions principales du point qui sera consid√©r√© comme le futur point cible, comme cela se produit dans un remplissage bidimensionnel simple. <br><br>  Mais bien s√ªr, si ce n'est pas prudent, cela cr√©era un cycle d'√©chantillonnage inutile.  Le point se ramifiera dans les 8 points voisins autour de lui, mais ces 8 points essaieront √† nouveau de revenir au point de d√©part, et cela continuera pour toujours.  Par cons√©quent, en plus de la s√©lection contr√¥l√©e des points cibles, j'ai besoin d'une restriction simple: tout point cible qui ne se trouve pas dans une certaine distance utile minimale d'un point cible existant ne sera pas pris en compte.  √Ä ma grande surprise, ces deux r√®gles simples cr√©ent un remplissage assez r√©ussi: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/591/cf6/446/591cf6446fdcc8281f7ebd9449c48703.png"></div><br>  Pas mal pour une exp√©rience assez simple.  Mais l'algorithme souffre de ce que j'appelle ¬´l'√©cho des limites¬ª.  Cet effet peut √™tre vu dans la capture d'√©cran suivante prise lors de l'√©tude de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/58e/fd0/25f/58efd025f80d2b96274ed849d3e4c568.png"></div><br>  Dans les zones sans obstacles, l'algorithme fonctionne bien en √©chantillonnant √† des distances relativement √©gales.  Mais quand ils atteignent l'intersection, ils cr√©ent des points qui sont ¬´en dehors de la grille¬ª, c'est-√†-dire qu'ils ne sont pas align√©s selon le motif des √©chantillons, selon lequel l'algorithme remplit la zone ouverte voisine.  La raison pour laquelle les points ¬´dans la grille¬ª ne cr√©ent pas de pavage excessivement dense est que chaque nouveau point essayant de revenir √† l'un des pr√©c√©dents y trouve le point pr√©c√©dent et refuse de le recompter.  Mais lors de la cr√©ation de nouveaux points sur la fronti√®re, ils sont compl√®tement d√©salign√©s, donc rien ne peut les emp√™cher de retourner dans l'espace d√©j√† explor√©.  Cela conduit √† la cr√©ation d'une vague d'√©chantillons biais√©s, qui se poursuit jusqu'√† ce qu'elle atteigne une ligne al√©atoire de points ailleurs suffisamment proche pour que l'algorithme puisse la trouver co√Øncidant avec le front mobile des points. <br><br>  Bien que cela ne semble pas √™tre un probl√®me grave, il est en r√©alit√© critique.  L'int√©r√™t de ces algorithmes est de concentrer les √©chantillons dans les zones o√π ils sont le plus susceptibles de produire des r√©sultats productifs.  Plus nous passons de temps √† √©chantillonner et √† r√©√©chantillonner de vastes zones ouvertes, moins nous consacrerons de temps au marquage des faces m√™mes de cette zone, qui sont les informations dont nous avons besoin.  √âtant donn√© qu'il s'agit d'un espace continu et que seul un nombre infini d'√©chantillons peut d√©crire sa v√©ritable forme, le rapport des √©chantillons significatifs aux √©chantillons insignifiants est litt√©ralement une mesure de l'efficacit√© de l'algorithme √† cr√©er une surface praticable pour un joueur. <br><br>  Cependant, il existe une solution simple √† ce probl√®me particulier: vous devez augmenter la distance √† laquelle les deux points sont consid√©r√©s comme "assez proches".  Ce faisant, nous r√©duirons la densit√© d'√©chantillonnage dans des endroits qui <i>ne</i> sont <i>pas importants pour</i> nous, mais perdrons √©galement la densit√© d'√©chantillonnage dans des endroits qui sont <i>importants pour</i> nous, par exemple, les zones autour des fronti√®res que nous voulons v√©rifier soigneusement pour la pr√©sence de "trous". <br><br><h2>  √âchantillonnage directionnel localis√© </h2><br>  Probablement parce que j'ai commenc√© avec l'arbre al√©atoire √† exploration rapide, mon cerveau a supplant√© toutes les autres id√©es, sauf l'id√©e de proximit√©.  Tous les algorithmes pr√©c√©dents utilisaient la proximit√© pour leur t√¢che, par exemple, afin de d√©terminer un nouveau point √† consid√©rer ensuite ou de s√©lectionner un point √† partir duquel commencer pour arriver √† un nouveau point cible. <br><br>  Mais apr√®s avoir r√©fl√©chi √† la t√¢che pendant un certain temps, je me suis rendu compte que tout devient plus logique, si nous pensons non seulement √† la proximit√©, mais aussi √† la <i>direction</i> .  Ensuite, cela devient √©vident, mais si vous avez travaill√© sur des t√¢ches similaires, vous savez qu'il est facile de tomber dans le pi√®ge de la pens√©e √©troite et de ne pas voir la situation dans son ensemble, m√™me si cela s'av√®re plus simple.  C'est exactement ce qui m'est arriv√©. <br><br>  Lorsque j'ai chang√© ma vision des choses, l'approche correcte de l'√©chantillonnage semblait √©vidente.  Chaque fois que je voulais √©tendre mon exploration de l'espace √† partir d'un point, je faisais une demande pour l'existence de points proches dans l'environnement local.  Cependant, au lieu d'utiliser la distance √† ces points pour la recherche, je vais les classer par leurs directions (avant cela, je n'ai utilis√© que huit directions principales, mais je voulais exp√©rimenter avec d'autres noyaux). <br><br>  Dans toutes les directions o√π je ne ¬´vois¬ª pas le point, je parcours la distance sp√©cifi√©e et j'ajoute un point √† n'importe quel endroit o√π je me suis arr√™t√© (que je rencontre ou non quelque chose).  Si je vois un point dans l'une des directions, je m'y d√©place et je v√©rifie si je peux y arriver.  Si je le peux, j'ajoute simplement un bord visible pour que l'utilisateur puisse facilement voir que les points sont connect√©s.  Si je ne peux pas, j'ajoute un nouveau point au point de collision, d√©finissant la limite de l'obstacle. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette m√©thode d'√©chantillonnage a tr√®s bien fonctionn√©. </font><font style="vertical-align: inherit;">Il nous permet de contr√¥ler tr√®s pr√©cis√©ment l'√©chantillonnage √† l'aide de param√®tres personnalisables pratiques, d'√©conomiser tous les points n√©cessaires et d'√©viter une tessellation inutile, ce qui conduit √† un remplissage tr√®s rapide de l'espace:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/699/e45/60e/699e4560ef50242ff48ba0682554248a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √âtant donn√© que l'algorithme recherche dans les directions et n'utilise pas seulement la proximit√©, il est prot√©g√© des √©chos des limites et limite l'√©chantillonnage excessif aux seules fronti√®res dont nous avons besoin: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6f3/673/618/6f3673618d182bb1810e2577c18ab1ef.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, l'algorithme n'est pas du tout affect√© par les transitions d'√©tat ou les probl√®mes avec les vari√©t√©s complexes. Il ne traite que des points, et ces points peuvent √™tre n'importe o√π, et de nouveaux peuvent √™tre ajout√©s √† tout moment. Si vous avez d√©j√† √©tabli une carte de la zone avec la porte ferm√©e, puis apr√®s avoir ouvert la porte, il vous suffit de placer le seul point de recherche de l'autre c√¥t√© de la porte et d'ordonner √† l'algorithme de continuer √† d√©velopper cette carte, apr√®s quoi il se connectera correctement et examinera correctement toute la zone √† l'ext√©rieur de la porte.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, √† tout moment, vous pouvez modifier les param√®tres de base et le syst√®me continuera de fonctionner. </font><font style="vertical-align: inherit;">Vous voulez faire un √©chantillonnage de zone avec une densit√© plus √©lev√©e? </font><font style="vertical-align: inherit;">R√©duisez simplement la distance par d√©faut. </font><font style="vertical-align: inherit;">Cela peut √™tre fait d√©j√† dans le processus de construction de la carte, et l'algorithme commencera l'√©chantillonnage avec une densit√© plus √©lev√©e sans avoir √† r√©initialiser les r√©sultats pr√©c√©dents (ce qui peut prendre un certain temps).</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V√©rification rudimentaire des bords </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'algorithme par d√©faut √©chantillonne d√©j√† les bordures avec beaucoup de soin, car les intersections cr√©ent des points suppl√©mentaires qui ne font pas partie du mod√®le d'√©chantillonnage, mais il ne les v√©rifie pas n√©cessairement avec le soin n√©cessaire, car il n'effectue aucune action sp√©ciale lorsqu'il rencontre des obstacles. J'ai r√©alis√© que depuis que je savais quels points ont √©t√© cr√©√©s lors des collisions, les deux points de collision d√©tect√©s sont reli√©s par une ar√™te, et nous pouvons appeler un √©chantillonnage suppl√©mentaire pour essayer de trouver plus de points limites dans le voisinage.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je n'ai pas activement recherch√© cette approche, mais j'ai cr√©√© une m√©thode rudimentaire pour tester cette th√©orie, et cela m'a sembl√© prometteur. </font><font style="vertical-align: inherit;">Apr√®s avoir pris deux points de collision reli√©s par un bord, je me d√©place vers le milieu du bord et j'essaie de tracer la perpendiculaire vers l'ext√©rieur par rapport au bord. </font><font style="vertical-align: inherit;">S'il n'intersecte pas la fronti√®re √† une tr√®s courte distance, je suppose que la fronti√®re est plus complexe et ajoute un nouveau point cible pour continuer la recherche dans cette zone. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√™me ce sch√©ma simple cr√©e un √©chantillonnage dense de tr√®s haute qualit√© le long de la fronti√®re sans √©chantillonner inutilement les zones ouvertes voisines. </font><font style="vertical-align: inherit;">Voici une zone avec plusieurs bordures, mais sans v√©rifier les bords:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6dc/c9f/f6d/6dcc9ff6d78ddb981413ed4b795dcd5b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et voici la m√™me zone avec des bords de v√©rification: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bda/24d/6ba/bda24d6ba69e530c352a7d9a0e3c8a3a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Peu importe √† quel point j'√©tais satisfait de ce r√©sultat, j'ai √©t√© surpris par le manque d'algorithmes significativement meilleurs pour l'√©chantillonnage des fronti√®res, et je vais essayer de choisir quelques m√©thodes suppl√©mentaires √† l'avenir. </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gains rapides </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√™me apr√®s avoir investi seulement un peu de temps dans le d√©veloppement et la cr√©ation d'un code assez simple, je me suis assur√© que Walk Monster cr√©e d√©j√† une sortie tout √† fait appropri√©e qui peut d√©tecter de vrais probl√®mes dans le jeu. </font><font style="vertical-align: inherit;">Voici des exemples de probl√®mes que j'ai trouv√©s lors du d√©veloppement de l'algorithme:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ed/6f6/823/4ed6f6823ba2de2886a0fd83f702aa97.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les pentes sur les c√¥t√©s de cette plate-forme ne doivent pas √™tre praticables, mais le joueur peut marcher dessus. </font><font style="vertical-align: inherit;">Cela est arriv√© parce que dans le code de mouvement du joueur, il existe une mauvaise fa√ßon pathologique de traiter la g√©om√©trie oblique. </font><font style="vertical-align: inherit;">Maintenant je sais qu'il est l√†, et je vais le corriger quand il s'agit d'assurer sa fiabilit√©.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/530/c38/b83/530c38b83fd5762238c3210d45e72d86.png"></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le T√©moin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √©tait cens√© √™tre un jeu contemplatif, mais se demandant pourquoi il semble qu'il y ait une pierre, m√™me si elle ne l'est pas, n'√©tait pas l'un de ses koans. </font><font style="vertical-align: inherit;">Comme vous pouvez le deviner, ce probl√®me est survenu parce que quelqu'un a laiss√© la quantit√© de collision dans le jeu apr√®s avoir supprim√© la g√©om√©trie qui la d√©notait. </font><font style="vertical-align: inherit;">Cela peut facilement se produire, et il est tr√®s bien que nous ayons un outil qui puisse rapidement reconna√Ætre de telles erreurs afin que les gens n'aient pas √† le faire.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/122/233/c86/122233c86cd7f7cf4f08e69cbb76404a.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/012/616/377/012616377b5515b2ee23d71da78bdeeb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ces objets √©taient cens√©s √™tre des roches infranchissables, mais Walk Monster a constat√© que cela ne s'√©tait pas produit. </font><font style="vertical-align: inherit;">Pire, Walk Monster a constat√© que pour une raison quelconque, le chemin n'est que dans un sens (de la capture d'√©cran de gauche √† droite), mais cela ne devrait pas l'√™tre. </font><font style="vertical-align: inherit;">J'ai fait en sorte que le joueur puisse vraiment faire √ßa (j'ai r√©ussi). </font><font style="vertical-align: inherit;">Il est tr√®s int√©ressant d'observer la survenue de telles erreurs!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Questions ouvertes </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quand vous voyez de bons r√©sultats qui peuvent √™tre d√©velopp√©s davantage, c'est inspirant. </font><font style="vertical-align: inherit;">Comme je l'ai dit, si vous choisissez un nom appropri√© pour les fichiers source, alors tout ira comme sur des roulettes! </font><font style="vertical-align: inherit;">Mais tout ce travail a √©t√© achev√© en quelques jours, il est donc loin d'√™tre exhaustif, et beaucoup a √©t√© fait compl√®tement improvis√©. </font><font style="vertical-align: inherit;">Si j'ai assez de temps pour le d√©veloppement de ces syst√®mes, cela vaut la peine de r√©pondre √† plusieurs questions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Premi√®rement, quel post-traitement doit √™tre fait avec les donn√©es afin qu'elles soient plus faciles √† visualiser? </font><font style="vertical-align: inherit;">Il sera difficile pour les gens de comprendre un r√©seau non trait√© de points et d'ar√™tes, mais si vous am√©liorez la description des donn√©es, cela rendra probablement difficile l'√©valuation des zones praticables difficiles √† premi√®re vue.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deuxi√®mement, comment am√©liorer les mod√®les d'√©chantillonnage autour des fronti√®res pour garantir que le nombre maximal de ¬´trous¬ª est trouv√©? Existe-t-il de bons moyens de caract√©riser la r√©duction des chiffres en r√©seau et existe-t-il des sch√©mas de pavage de haute qualit√© qui maximisent la probabilit√© de traverser et de traverser ces chiffres? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Troisi√®mement, quels mod√®les d'√©chantillonnage sont les meilleurs pour remplir les espaces - r√©guliers ou randomis√©s? Je peux facilement changer les crit√®res de choix des points cibles pour cr√©er des mod√®les plus al√©atoires, mais il n'est pas tr√®s clair si cela en vaut la peine, et si oui, quels types de mod√®les al√©atoires seront meilleurs.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quatri√®mement, quelles autres informations voulons-nous obtenir des cartes des zones praticables si nous avons d√©j√† appris √† les construire? Par exemple, il est tr√®s simple d'√©tendre un syst√®me existant avec des fonctions telles que la recherche de chemins ou de cartes de distance, afin que l'utilisateur puisse s√©lectionner un point et demander le chemin le plus court entre celui-ci et un autre point, ou voir une carte thermique de la distance entre un point et d'autres points de la carte. Ces requ√™tes seront-elles utiles? Quelles autres requ√™tes puis-je utiliser?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour le moment, les visualisations Walk Monster des zones praticables sont plus que suffisantes pour montrer que le code de mouvement du joueur est assez mauvais. </font><font style="vertical-align: inherit;">J'avais pr√©vu de passer √† la cr√©ation d'un syst√®me de test nocturne des cartes en utilisant la m√©thode de simulation de l'entr√©e utilisateur, mais il est √©vident que nous avons d√©j√† suffisamment de probl√®mes √† r√©soudre sans cette √©tape. </font><font style="vertical-align: inherit;">Par cons√©quent, la prochaine √©tape sera d'augmenter la fiabilit√© du code de mouvement du joueur. </font><font style="vertical-align: inherit;">Et pendant que je travaille l√†-dessus, je voudrais v√©rifier s'il est possible d'augmenter la vitesse d'ex√©cution d'un ou deux ordres de grandeur, car alors que le travail de Walk Monster est tr√®s ralenti par le syst√®me de freinage des collisions.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423519/">https://habr.com/ru/post/fr423519/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423505/index.html">Zuckerberg vend des actions Facebook pour 13 milliards de dollars afin que ¬´nos enfants ne tombent jamais malades¬ª</a></li>
<li><a href="../fr423507/index.html">Comment √©conomiser de la m√©moire sur les onglets du navigateur, mais ne pas perdre leur contenu. L'exp√©rience de l'√©quipe Yandex.Browser</a></li>
<li><a href="../fr423511/index.html">Interception de l'installation de Firefox et Chrome sur Windows 10</a></li>
<li><a href="../fr423513/index.html">Nous √©conomisons sur un contr√¥leur RAID, ou comment nourrir Varia avec Iops</a></li>
<li><a href="../fr423515/index.html">Est-ce que DRY est bon ou peut-il casser O de SOLID</a></li>
<li><a href="../fr423521/index.html">Sept r√®gles de base pour exp√©rimenter avec des sites Web</a></li>
<li><a href="../fr423523/index.html">Capteur combin√©, avec pr√©f√©rence et po√®tes</a></li>
<li><a href="../fr423527/index.html">Les applications pour enfants collectent massivement des donn√©es personnelles et les transmettent √† des tiers</a></li>
<li><a href="../fr423529/index.html">De quoi toute l'√©quipe a-t-elle besoin pour travailler? Comment faire glisser tout le monde dans le syst√®me de gestion de projet?</a></li>
<li><a href="../fr423531/index.html">√âvolution de l'architecture mobile de Reddit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>