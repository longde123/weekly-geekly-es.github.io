<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺 🙏🏻 📙 ISPsystem, pardonne et au revoir! Pourquoi et comment nous avons écrit notre panneau de contrôle du serveur 🈴 🤚🏻 ⚱️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut Nous sommes des «technologies d'hébergement» et il y a 5 ans a lancé VDSina - le premier hébergement vds créé spécifiquement pour les développeu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ISPsystem, pardonne et au revoir! Pourquoi et comment nous avons écrit notre panneau de contrôle du serveur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/460107/"><img src="https://habrastorage.org/webt/af/l8/yk/afl8yk6hovufiwx1ml-8cwcgaoy.png" alt="image"><br><br>  Salut  Nous sommes des «technologies d'hébergement» et il y a 5 ans a lancé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VDSina</a> - le premier hébergement vds créé spécifiquement pour les développeurs.  Nous nous efforçons de le rendre pratique, comme DigitalOcean, mais avec un support russe, des méthodes de paiement et des serveurs en Russie.  Mais DigitalOcean n'est pas seulement fiabilité et prix, c'est aussi un service. <br><br>  Le logiciel d'ISPsystem s'est avéré être une corde qui nous liait les mains sur le chemin d'un service sympa.  Il y a trois ans, nous avons utilisé la facturation Billmanager et le panneau de contrôle du serveur VMmanager et nous avons rapidement réalisé qu'il était presque impossible de fournir un bon service sans notre panneau. <br><a name="habracut"></a><br><br><h2>  Comment ISPsystem a tué la convivialité </h2><br>  <b>Bugs</b> <br><br>  Nous n'avons pas pu corriger le bogue nous-mêmes - chaque fois que nous devions écrire dans le support de quelqu'un d'autre et attendre.  La solution à tout problème nécessitait la réponse d'une société tierce. <br><br>  La prise en charge d'ISPsystem a répondu normalement, mais les correctifs n'ont été apportés que par quelques versions, et pas toujours et pas toutes.  Parfois, des bugs critiques corrigés pendant plusieurs semaines.  Nous avons dû rassurer les clients, nous excuser et attendre qu'ISPsystem corrige le bogue. <br><br>  <b>Menace d'indisponibilité</b> <br><br>  Les mises à jour pourraient entraîner des temps d'arrêt imprévisibles qui ont provoqué de nouveaux bugs. <br><br>  Chaque mise à jour était une loterie: il fallait couvrir la facturation et faire des sacrifices aux dieux des mises à jour - à quelques reprises, la mise à jour a causé un temps d'arrêt de 10 à 15 minutes.  À cette époque, nos administrateurs devenaient gris sous nos yeux - nous ne savions jamais combien de temps durerait le temps d'arrêt et ne pouvions pas prédire quand ISPsystem a décidé de publier une nouvelle mise à jour. <br><br>  À la cinquième génération, Billmanager s'est amélioré, mais pour avoir accès aux fonctionnalités nécessaires, j'ai dû installer une version bêta, qui était déjà mise à jour chaque semaine.  Si quelque chose se cassait, vous deviez donner accès aux développeurs étrangers afin qu'ils corrigent quelque chose. <br><br>  <b>Interface de panneau peu pratique</b> <br><br>  Tout était divisé en différents panneaux et contrôlé à partir de différents endroits.  Par exemple, les clients ont payé via Billmanager et ont dû redémarrer ou réinstaller VDS dans VMManager.  Nos employés ont également dû basculer entre les fenêtres pour aider le client, vérifier la charge sur son serveur ou voir quel OS il utilise. <br><br>  Une telle interface prend du temps - à la fois la nôtre et les clients.  À propos de toute commodité, comme DigitalOcean, il n'y a aucun doute dans une telle situation. <br><br>  <b>Cycles de vie courts avec mises à jour fréquentes de l'API</b> <br><br>  Nous avons écrit nos propres plugins - par exemple, un plugin avec des méthodes de paiement supplémentaires qui ne sont pas dans VMManager. <br><br>  Ces dernières années, VMManager a eu un cycle de vie relativement court, et dans les nouvelles versions, les noms des variables ou des fonctions dans l'API pouvaient changer arbitrairement - cela a cassé nos plugins.  La prise en charge des anciennes versions a été rapidement minimisée et a dû être mise à jour. <br><br>  <b>Vous ne pouvez pas modifier</b> <br><br>  Plus précisément, mais extrêmement inefficace.  Les restrictions de licence ne vous permettent pas de modifier la source, vous ne pouvez écrire que des plugins.  Le maximum de plugins est certains éléments de menu, un assistant étape par étape.  ISPsystem est affiné pour la polyvalence, et nous avions besoin de solutions spécialisées. <br><br>  La décision d'écrire votre panel a donc mûri.  Nous nous fixons des objectifs: <br><br><ul><li>  Répondez rapidement aux erreurs, bugs et soyez en mesure de les corriger vous-même, sans faire attendre le client. </li><li>  Modifiez librement l'interface en fonction des processus de travail et des besoins des clients. </li><li>  Améliorez la convivialité avec une conception claire et compréhensible. </li></ul><br>  Et ils ont commencé le développement. <br><br><h2>  Nouvelle architecture de panneau </h2><br>  Nous avons une équipe de développement autonome, nous avons donc écrit le panel nous-mêmes. <br>  Le travail principal a été effectué par trois ingénieurs - le directeur technique Sergey a conçu l'architecture et écrit l'agent du serveur, Alexey a fait la facturation et notre front Artysh a rassemblé le front. <br><br><h3>  Étape 1. Agent serveur </h3><br><br>  Un agent serveur est un serveur Web python qui gère la bibliothèque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libvirt</a> , qui à son tour gère l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hyperviseur Qemu-kvm</a> . <br><br>  L'agent gère tous les services sur le serveur: création, arrêt, désinstallation de vds, installation de systèmes d'exploitation, modification des paramètres, etc. via la bibliothèque libvirt.  Au moment de la publication, il s'agit de plus de quarante fonctions différentes, que nous complétons en fonction de la tâche et des besoins du client. <br><br>  En principe, libvirt pouvait être géré directement à partir de la facturation, mais il nécessitait trop de code supplémentaire et nous avons décidé de répartir ces fonctions entre l'agent et la facturation - la facturation fait simplement des demandes à l'agent via l'API JSON. <br><br>  L'agent est la première chose que nous avons faite, car il ne nécessitait aucune interface et il pouvait être testé directement à partir de la console du serveur. <br><br>  <b>Ce que l'agent serveur nous a donné:</b> une couche est apparue qui simplifie la vie de tout le monde - la facturation n'a pas besoin d'envoyer tout un tas de commandes, mais seulement de faire une demande.  Et l'agent fera tout ce dont vous avez besoin: par exemple, allouer de l'espace disque et de la RAM. <br><br><h3>  Étape 2. Facturation </h3><br>  Pour notre développeur, Alex, ce n'était pas le premier panneau de contrôle - Alex hébergeait depuis longtemps, donc il comprenait généralement ce dont le client avait besoin et ce dont l'hébergeur avait besoin. <br><br>  Nous appelons la facturation entre nous un «panneau de contrôle»: elle contient non seulement de l'argent et des services, mais aussi leur gestion, le support client et bien plus encore. <br><br>  Pour passer du logiciel ISPSystem, il était nécessaire de conserver complètement la fonctionnalité précédente pour les clients, de transférer toutes les actions des utilisateurs financiers de l'ancienne facturation vers la nouvelle, ainsi que tous les services et communications entre eux.  Nous avons étudié le contenu du produit actuel, puis les décisions des concurrents, principalement DO et Vultr.  Nous avons examiné les inconvénients et les avantages, recueilli les commentaires des personnes qui travaillaient avec d'anciens produits d'ISPsystem. <br><br>  Dans la nouvelle facturation, deux piles ont été utilisées: PHP classique, MySQL (et à l'avenir, il est prévu de passer à PostgreSQL), Yii2 comme framework sur le backend et VueJS sur le front.  Les piles fonctionnent indépendamment les unes des autres, développées par différentes personnes et communiquent à l'aide de l'API JSON.  Pour le développement, alors et maintenant nous utilisons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PHPStorm</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WebStorm</a> de JetBrains et les aimons beaucoup (les gars, bonjour!) <br><br>  Le panneau est conçu selon le principe modulaire: modules de système de paiement, module d'enregistrement de domaine ou, par exemple, module de certificat SSL.  Vous pouvez facilement ajouter une nouvelle fonction ou supprimer l'ancienne.  Les bases de l'expansion ont été posées sur le plan architectural, y compris dans le sens opposé, «au fer». <br><img src="https://habrastorage.org/webt/b-/v7/7u/b-v77ugcsfi0zhdm3bbriq2oxsu.png" alt="image"><br>  <b>Ce que nous avons obtenu</b> : un panneau de contrôle sur lequel nous avons un contrôle total.  Désormais, les bogues sont corrigés en heures et non en semaines, et de nouvelles fonctions sont implémentées à la demande des clients et non à la demande d'ISPSystem. <br><br><h3>  Étape 3. Interface </h3><br><img src="https://habrastorage.org/webt/9i/n0/b2/9in0b2skk3doxpelwvckx7ebmei.png" alt="image"><br>  L'interface est une idée originale de notre équipe. <br><br>  Tout d'abord, nous avons examiné ce qui se passerait si nous faisions un module complémentaire sur l'API ISPsystem sans rien changer de façon spectaculaire dans l'interface.  Cela s'est avéré moyen et nous avons décidé de tout faire à partir de zéro. <br><br>  Nous pensions que l'essentiel était de rendre l'interface logique, avec un design épuré et minimaliste, et nous obtiendrions alors un beau panneau.  L'arrangement des éléments a été discuté dans Megaplan, et l'interface que les utilisateurs voient maintenant dans le panneau de contrôle va progressivement naître. <br><br>  La première page de facturation est apparue, car nous avons déjà créé des plugins de paiement pour ISPsystem. <br><br>  <b>Frontend</b> <br><br>  Ils ont décidé de faire du panel une application SPA - peu exigeante en ressources et avec un chargement rapide des données.  Notre front-end Artysh a décidé de l'écrire sur Vue - à l'époque, Vue venait d'apparaître.  Nous avons supposé que le framework se développerait dynamiquement, comme React, après un certain temps, la communauté Vue se développerait et une mer de bibliothèques apparaîtrait.  Nous l'avons installé sur Vue et ne l'avons pas regretté - l'ajout de nouvelles fonctionnalités qui ont déjà été programmées sur le backend prend maintenant peu de temps.  Nous vous en dirons plus sur les panneaux frontaux dans un article séparé. <br><br>  <b>Communication du frontend avec le backend</b> <br><br>  Le frontend a été lié au backend par le biais de pushies.  J'ai dû transpirer et écrire mon propre gestionnaire, mais maintenant les informations sur la page sont mises à jour presque instantanément. <br><br>  <b>Ce qui s'est passé:</b> l'interface du panneau est devenue plus facile.  Nous l'avons rendu adaptatif, et un chargement rapide lui permet d'être utilisé même à partir de téléphones portables dans les dernières minutes avant le décollage, sans installer d'application séparée pour travailler avec le panneau. <br><br><h3>  Étape 4. Schéma de test et de migration </h3><br>  Lorsque tout a commencé et que les premiers tests ont réussi, la question de la migration s'est posée.  Tout d'abord, nous avons mis en place la facturation et commencé à tester son travail avec l'agent serveur. <br><br>  Ensuite, ils ont écrit un script simple qui transfère la base de données de l'ancienne facturation à la nouvelle. <br><br>  J'ai dû tester et revérifier littéralement tout, car les données ont été versées dans une nouvelle base de données à partir des trois anciennes: Billmanager, VMmanager et IPmanager manager.  La migration de test est peut-être la chose la plus difficile que nous ayons rencontrée lors du développement d'un nouveau panel. <br><br>  Après avoir revérifié, nous avons dissimulé l'ancienne facturation.  La migration finale des données a été un moment très inquiétant, mais, Dieu merci, elle s'est achevée en quelques minutes et sans problème notable.  Il y a eu des bugs mineurs que nous avons corrigés en une semaine.  Le temps principal a été pris en testant ce qui s'est passé. <br><br>  Ensuite, nous avons envoyé des lettres aux clients avec l'adresse du nouveau panneau et la facturation et fait une redirection. <br><br>  <b>Conclusion:</b> <b>C'EST VIVANT!</b> <br><br><h2>  Heureux </h2><br>  Dès les premières heures de notre logiciel, nous avons ressenti tous les délices de la transition.  Le code était complètement à nous et avec une architecture pratique, et l'interface était propre et logique. <br><img src="https://habrastorage.org/webt/7a/hv/is/7ahvis7zx-1m4pcouleavsqbldo.png" alt="image"><br>  <i>Le premier examen après le lancement d'un nouveau panel</i> <br><br>  Nous avons entamé le processus de transition en décembre, à la veille du nouvel an 2017, alors qu'il y avait le moins de charge pour faciliter la transition pour les clients - presque personne ne travaille la veille des vacances. <br><br>  La principale chose que nous avons obtenue lors de la transition vers notre système (en plus de la fiabilité et de la commodité générales) est la possibilité d'ajouter rapidement des fonctionnalités pour les clients clés - d'être leur visage et non leur cul. <br><br><h3>  Et ensuite? </h3><br>  Nous grandissons, la quantité de données, les clients, les données clients augmentent.  Un serveur memcached et deux gestionnaires de files d'attente avec des tâches différentes ont dû être ajoutés au backend.  Il y a une mise en cache et des files d'attente sur le frontal. <br><br>  Bien sûr, nous avions encore des aventures à mesure que nous développions et compliquions le produit, par exemple, lorsque nous avons ajouté HighLoad. <br><br>  Dans le prochain article, nous vous expliquerons comment le tarif Hi-CPU a été lancé: sur le matériel, les logiciels, les tâches que nous avons résolues et ce que nous avons fait. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ud/xv/wf/udxvwfcz80j3nug11rxaguqelww.png"><br></a> <br><h3>  Abonnez-vous à notre développeur Instagram </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/e5/as/-l/e5as-ltfnotkemk2dsqngygimra.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460107/">https://habr.com/ru/post/fr460107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460091/index.html">Impression directe sur des T-shirts avec Epson SureColor SC - F et sa différence avec la sérigraphie, l'autocollant et la sublimation</a></li>
<li><a href="../fr460095/index.html">Pris une interdiction pour fork deepNude sur gitlab.com</a></li>
<li><a href="../fr460097/index.html">The Matrix vous a: un aperçu des projets utilisant MITRE ATT & CK</a></li>
<li><a href="../fr460099/index.html">Application de l'apprentissage automatique aux réseaux de neurones avec une architecture de transformateur</a></li>
<li><a href="../fr460101/index.html">Fonctionnement XSS basé sur les cookies | Histoire de Bug Bounty à 2300 $</a></li>
<li><a href="../fr460109/index.html">Angulaire: lorsque vous avez besoin de voir l'application, mais que le backend n'est pas encore prêt</a></li>
<li><a href="../fr460111/index.html">Version mise à jour de SAP Business One 9.3: ce qui a changé</a></li>
<li><a href="../fr460113/index.html">Quelques histoires de la vie de JSOC CERT, ou Unbanal forensics</a></li>
<li><a href="../fr460115/index.html">Dix ans de programmation à Erlang</a></li>
<li><a href="../fr460117/index.html">Les plus gros clients en Russie sont-ils un gros jackpot ou un mal de tête? Expérience AGIMA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>