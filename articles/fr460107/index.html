<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∫ üôèüèª üìô ISPsystem, pardonne et au revoir! Pourquoi et comment nous avons √©crit notre panneau de contr√¥le du serveur üà¥ ü§öüèª ‚ö±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut Nous sommes des ¬´technologies d'h√©bergement¬ª et il y a 5 ans a lanc√© VDSina - le premier h√©bergement vds cr√©√© sp√©cifiquement pour les d√©veloppeu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ISPsystem, pardonne et au revoir! Pourquoi et comment nous avons √©crit notre panneau de contr√¥le du serveur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/460107/"><img src="https://habrastorage.org/webt/af/l8/yk/afl8yk6hovufiwx1ml-8cwcgaoy.png" alt="image"><br><br>  Salut  Nous sommes des ¬´technologies d'h√©bergement¬ª et il y a 5 ans a lanc√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VDSina</a> - le premier h√©bergement vds cr√©√© sp√©cifiquement pour les d√©veloppeurs.  Nous nous effor√ßons de le rendre pratique, comme DigitalOcean, mais avec un support russe, des m√©thodes de paiement et des serveurs en Russie.  Mais DigitalOcean n'est pas seulement fiabilit√© et prix, c'est aussi un service. <br><br>  Le logiciel d'ISPsystem s'est av√©r√© √™tre une corde qui nous liait les mains sur le chemin d'un service sympa.  Il y a trois ans, nous avons utilis√© la facturation Billmanager et le panneau de contr√¥le du serveur VMmanager et nous avons rapidement r√©alis√© qu'il √©tait presque impossible de fournir un bon service sans notre panneau. <br><a name="habracut"></a><br><br><h2>  Comment ISPsystem a tu√© la convivialit√© </h2><br>  <b>Bugs</b> <br><br>  Nous n'avons pas pu corriger le bogue nous-m√™mes - chaque fois que nous devions √©crire dans le support de quelqu'un d'autre et attendre.  La solution √† tout probl√®me n√©cessitait la r√©ponse d'une soci√©t√© tierce. <br><br>  La prise en charge d'ISPsystem a r√©pondu normalement, mais les correctifs n'ont √©t√© apport√©s que par quelques versions, et pas toujours et pas toutes.  Parfois, des bugs critiques corrig√©s pendant plusieurs semaines.  Nous avons d√ª rassurer les clients, nous excuser et attendre qu'ISPsystem corrige le bogue. <br><br>  <b>Menace d'indisponibilit√©</b> <br><br>  Les mises √† jour pourraient entra√Æner des temps d'arr√™t impr√©visibles qui ont provoqu√© de nouveaux bugs. <br><br>  Chaque mise √† jour √©tait une loterie: il fallait couvrir la facturation et faire des sacrifices aux dieux des mises √† jour - √† quelques reprises, la mise √† jour a caus√© un temps d'arr√™t de 10 √† 15 minutes.  √Ä cette √©poque, nos administrateurs devenaient gris sous nos yeux - nous ne savions jamais combien de temps durerait le temps d'arr√™t et ne pouvions pas pr√©dire quand ISPsystem a d√©cid√© de publier une nouvelle mise √† jour. <br><br>  √Ä la cinqui√®me g√©n√©ration, Billmanager s'est am√©lior√©, mais pour avoir acc√®s aux fonctionnalit√©s n√©cessaires, j'ai d√ª installer une version b√™ta, qui √©tait d√©j√† mise √† jour chaque semaine.  Si quelque chose se cassait, vous deviez donner acc√®s aux d√©veloppeurs √©trangers afin qu'ils corrigent quelque chose. <br><br>  <b>Interface de panneau peu pratique</b> <br><br>  Tout √©tait divis√© en diff√©rents panneaux et contr√¥l√© √† partir de diff√©rents endroits.  Par exemple, les clients ont pay√© via Billmanager et ont d√ª red√©marrer ou r√©installer VDS dans VMManager.  Nos employ√©s ont √©galement d√ª basculer entre les fen√™tres pour aider le client, v√©rifier la charge sur son serveur ou voir quel OS il utilise. <br><br>  Une telle interface prend du temps - √† la fois la n√¥tre et les clients.  √Ä propos de toute commodit√©, comme DigitalOcean, il n'y a aucun doute dans une telle situation. <br><br>  <b>Cycles de vie courts avec mises √† jour fr√©quentes de l'API</b> <br><br>  Nous avons √©crit nos propres plugins - par exemple, un plugin avec des m√©thodes de paiement suppl√©mentaires qui ne sont pas dans VMManager. <br><br>  Ces derni√®res ann√©es, VMManager a eu un cycle de vie relativement court, et dans les nouvelles versions, les noms des variables ou des fonctions dans l'API pouvaient changer arbitrairement - cela a cass√© nos plugins.  La prise en charge des anciennes versions a √©t√© rapidement minimis√©e et a d√ª √™tre mise √† jour. <br><br>  <b>Vous ne pouvez pas modifier</b> <br><br>  Plus pr√©cis√©ment, mais extr√™mement inefficace.  Les restrictions de licence ne vous permettent pas de modifier la source, vous ne pouvez √©crire que des plugins.  Le maximum de plugins est certains √©l√©ments de menu, un assistant √©tape par √©tape.  ISPsystem est affin√© pour la polyvalence, et nous avions besoin de solutions sp√©cialis√©es. <br><br>  La d√©cision d'√©crire votre panel a donc m√ªri.  Nous nous fixons des objectifs: <br><br><ul><li>  R√©pondez rapidement aux erreurs, bugs et soyez en mesure de les corriger vous-m√™me, sans faire attendre le client. </li><li>  Modifiez librement l'interface en fonction des processus de travail et des besoins des clients. </li><li>  Am√©liorez la convivialit√© avec une conception claire et compr√©hensible. </li></ul><br>  Et ils ont commenc√© le d√©veloppement. <br><br><h2>  Nouvelle architecture de panneau </h2><br>  Nous avons une √©quipe de d√©veloppement autonome, nous avons donc √©crit le panel nous-m√™mes. <br>  Le travail principal a √©t√© effectu√© par trois ing√©nieurs - le directeur technique Sergey a con√ßu l'architecture et √©crit l'agent du serveur, Alexey a fait la facturation et notre front Artysh a rassembl√© le front. <br><br><h3>  √âtape 1. Agent serveur </h3><br><br>  Un agent serveur est un serveur Web python qui g√®re la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libvirt</a> , qui √† son tour g√®re l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hyperviseur Qemu-kvm</a> . <br><br>  L'agent g√®re tous les services sur le serveur: cr√©ation, arr√™t, d√©sinstallation de vds, installation de syst√®mes d'exploitation, modification des param√®tres, etc. via la biblioth√®que libvirt.  Au moment de la publication, il s'agit de plus de quarante fonctions diff√©rentes, que nous compl√©tons en fonction de la t√¢che et des besoins du client. <br><br>  En principe, libvirt pouvait √™tre g√©r√© directement √† partir de la facturation, mais il n√©cessitait trop de code suppl√©mentaire et nous avons d√©cid√© de r√©partir ces fonctions entre l'agent et la facturation - la facturation fait simplement des demandes √† l'agent via l'API JSON. <br><br>  L'agent est la premi√®re chose que nous avons faite, car il ne n√©cessitait aucune interface et il pouvait √™tre test√© directement √† partir de la console du serveur. <br><br>  <b>Ce que l'agent serveur nous a donn√©:</b> une couche est apparue qui simplifie la vie de tout le monde - la facturation n'a pas besoin d'envoyer tout un tas de commandes, mais seulement de faire une demande.  Et l'agent fera tout ce dont vous avez besoin: par exemple, allouer de l'espace disque et de la RAM. <br><br><h3>  √âtape 2. Facturation </h3><br>  Pour notre d√©veloppeur, Alex, ce n'√©tait pas le premier panneau de contr√¥le - Alex h√©bergeait depuis longtemps, donc il comprenait g√©n√©ralement ce dont le client avait besoin et ce dont l'h√©bergeur avait besoin. <br><br>  Nous appelons la facturation entre nous un ¬´panneau de contr√¥le¬ª: elle contient non seulement de l'argent et des services, mais aussi leur gestion, le support client et bien plus encore. <br><br>  Pour passer du logiciel ISPSystem, il √©tait n√©cessaire de conserver compl√®tement la fonctionnalit√© pr√©c√©dente pour les clients, de transf√©rer toutes les actions des utilisateurs financiers de l'ancienne facturation vers la nouvelle, ainsi que tous les services et communications entre eux.  Nous avons √©tudi√© le contenu du produit actuel, puis les d√©cisions des concurrents, principalement DO et Vultr.  Nous avons examin√© les inconv√©nients et les avantages, recueilli les commentaires des personnes qui travaillaient avec d'anciens produits d'ISPsystem. <br><br>  Dans la nouvelle facturation, deux piles ont √©t√© utilis√©es: PHP classique, MySQL (et √† l'avenir, il est pr√©vu de passer √† PostgreSQL), Yii2 comme framework sur le backend et VueJS sur le front.  Les piles fonctionnent ind√©pendamment les unes des autres, d√©velopp√©es par diff√©rentes personnes et communiquent √† l'aide de l'API JSON.  Pour le d√©veloppement, alors et maintenant nous utilisons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PHPStorm</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WebStorm</a> de JetBrains et les aimons beaucoup (les gars, bonjour!) <br><br>  Le panneau est con√ßu selon le principe modulaire: modules de syst√®me de paiement, module d'enregistrement de domaine ou, par exemple, module de certificat SSL.  Vous pouvez facilement ajouter une nouvelle fonction ou supprimer l'ancienne.  Les bases de l'expansion ont √©t√© pos√©es sur le plan architectural, y compris dans le sens oppos√©, ¬´au fer¬ª. <br><img src="https://habrastorage.org/webt/b-/v7/7u/b-v77ugcsfi0zhdm3bbriq2oxsu.png" alt="image"><br>  <b>Ce que nous avons obtenu</b> : un panneau de contr√¥le sur lequel nous avons un contr√¥le total.  D√©sormais, les bogues sont corrig√©s en heures et non en semaines, et de nouvelles fonctions sont impl√©ment√©es √† la demande des clients et non √† la demande d'ISPSystem. <br><br><h3>  √âtape 3. Interface </h3><br><img src="https://habrastorage.org/webt/9i/n0/b2/9in0b2skk3doxpelwvckx7ebmei.png" alt="image"><br>  L'interface est une id√©e originale de notre √©quipe. <br><br>  Tout d'abord, nous avons examin√© ce qui se passerait si nous faisions un module compl√©mentaire sur l'API ISPsystem sans rien changer de fa√ßon spectaculaire dans l'interface.  Cela s'est av√©r√© moyen et nous avons d√©cid√© de tout faire √† partir de z√©ro. <br><br>  Nous pensions que l'essentiel √©tait de rendre l'interface logique, avec un design √©pur√© et minimaliste, et nous obtiendrions alors un beau panneau.  L'arrangement des √©l√©ments a √©t√© discut√© dans Megaplan, et l'interface que les utilisateurs voient maintenant dans le panneau de contr√¥le va progressivement na√Ætre. <br><br>  La premi√®re page de facturation est apparue, car nous avons d√©j√† cr√©√© des plugins de paiement pour ISPsystem. <br><br>  <b>Frontend</b> <br><br>  Ils ont d√©cid√© de faire du panel une application SPA - peu exigeante en ressources et avec un chargement rapide des donn√©es.  Notre front-end Artysh a d√©cid√© de l'√©crire sur Vue - √† l'√©poque, Vue venait d'appara√Ætre.  Nous avons suppos√© que le framework se d√©velopperait dynamiquement, comme React, apr√®s un certain temps, la communaut√© Vue se d√©velopperait et une mer de biblioth√®ques appara√Ætrait.  Nous l'avons install√© sur Vue et ne l'avons pas regrett√© - l'ajout de nouvelles fonctionnalit√©s qui ont d√©j√† √©t√© programm√©es sur le backend prend maintenant peu de temps.  Nous vous en dirons plus sur les panneaux frontaux dans un article s√©par√©. <br><br>  <b>Communication du frontend avec le backend</b> <br><br>  Le frontend a √©t√© li√© au backend par le biais de pushies.  J'ai d√ª transpirer et √©crire mon propre gestionnaire, mais maintenant les informations sur la page sont mises √† jour presque instantan√©ment. <br><br>  <b>Ce qui s'est pass√©:</b> l'interface du panneau est devenue plus facile.  Nous l'avons rendu adaptatif, et un chargement rapide lui permet d'√™tre utilis√© m√™me √† partir de t√©l√©phones portables dans les derni√®res minutes avant le d√©collage, sans installer d'application s√©par√©e pour travailler avec le panneau. <br><br><h3>  √âtape 4. Sch√©ma de test et de migration </h3><br>  Lorsque tout a commenc√© et que les premiers tests ont r√©ussi, la question de la migration s'est pos√©e.  Tout d'abord, nous avons mis en place la facturation et commenc√© √† tester son travail avec l'agent serveur. <br><br>  Ensuite, ils ont √©crit un script simple qui transf√®re la base de donn√©es de l'ancienne facturation √† la nouvelle. <br><br>  J'ai d√ª tester et rev√©rifier litt√©ralement tout, car les donn√©es ont √©t√© vers√©es dans une nouvelle base de donn√©es √† partir des trois anciennes: Billmanager, VMmanager et IPmanager manager.  La migration de test est peut-√™tre la chose la plus difficile que nous ayons rencontr√©e lors du d√©veloppement d'un nouveau panel. <br><br>  Apr√®s avoir rev√©rifi√©, nous avons dissimul√© l'ancienne facturation.  La migration finale des donn√©es a √©t√© un moment tr√®s inqui√©tant, mais, Dieu merci, elle s'est achev√©e en quelques minutes et sans probl√®me notable.  Il y a eu des bugs mineurs que nous avons corrig√©s en une semaine.  Le temps principal a √©t√© pris en testant ce qui s'est pass√©. <br><br>  Ensuite, nous avons envoy√© des lettres aux clients avec l'adresse du nouveau panneau et la facturation et fait une redirection. <br><br>  <b>Conclusion:</b> <b>C'EST VIVANT!</b> <br><br><h2>  Heureux </h2><br>  D√®s les premi√®res heures de notre logiciel, nous avons ressenti tous les d√©lices de la transition.  Le code √©tait compl√®tement √† nous et avec une architecture pratique, et l'interface √©tait propre et logique. <br><img src="https://habrastorage.org/webt/7a/hv/is/7ahvis7zx-1m4pcouleavsqbldo.png" alt="image"><br>  <i>Le premier examen apr√®s le lancement d'un nouveau panel</i> <br><br>  Nous avons entam√© le processus de transition en d√©cembre, √† la veille du nouvel an 2017, alors qu'il y avait le moins de charge pour faciliter la transition pour les clients - presque personne ne travaille la veille des vacances. <br><br>  La principale chose que nous avons obtenue lors de la transition vers notre syst√®me (en plus de la fiabilit√© et de la commodit√© g√©n√©rales) est la possibilit√© d'ajouter rapidement des fonctionnalit√©s pour les clients cl√©s - d'√™tre leur visage et non leur cul. <br><br><h3>  Et ensuite? </h3><br>  Nous grandissons, la quantit√© de donn√©es, les clients, les donn√©es clients augmentent.  Un serveur memcached et deux gestionnaires de files d'attente avec des t√¢ches diff√©rentes ont d√ª √™tre ajout√©s au backend.  Il y a une mise en cache et des files d'attente sur le frontal. <br><br>  Bien s√ªr, nous avions encore des aventures √† mesure que nous d√©veloppions et compliquions le produit, par exemple, lorsque nous avons ajout√© HighLoad. <br><br>  Dans le prochain article, nous vous expliquerons comment le tarif Hi-CPU a √©t√© lanc√©: sur le mat√©riel, les logiciels, les t√¢ches que nous avons r√©solues et ce que nous avons fait. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ud/xv/wf/udxvwfcz80j3nug11rxaguqelww.png"><br></a> <br><h3>  Abonnez-vous √† notre d√©veloppeur Instagram </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/e5/as/-l/e5as-ltfnotkemk2dsqngygimra.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460107/">https://habr.com/ru/post/fr460107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460091/index.html">Impression directe sur des T-shirts avec Epson SureColor SC - F et sa diff√©rence avec la s√©rigraphie, l'autocollant et la sublimation</a></li>
<li><a href="../fr460095/index.html">Pris une interdiction pour fork deepNude sur gitlab.com</a></li>
<li><a href="../fr460097/index.html">The Matrix vous a: un aper√ßu des projets utilisant MITRE ATT & CK</a></li>
<li><a href="../fr460099/index.html">Application de l'apprentissage automatique aux r√©seaux de neurones avec une architecture de transformateur</a></li>
<li><a href="../fr460101/index.html">Fonctionnement XSS bas√© sur les cookies | Histoire de Bug Bounty √† 2300 $</a></li>
<li><a href="../fr460109/index.html">Angulaire: lorsque vous avez besoin de voir l'application, mais que le backend n'est pas encore pr√™t</a></li>
<li><a href="../fr460111/index.html">Version mise √† jour de SAP Business One 9.3: ce qui a chang√©</a></li>
<li><a href="../fr460113/index.html">Quelques histoires de la vie de JSOC CERT, ou Unbanal forensics</a></li>
<li><a href="../fr460115/index.html">Dix ans de programmation √† Erlang</a></li>
<li><a href="../fr460117/index.html">Les plus gros clients en Russie sont-ils un gros jackpot ou un mal de t√™te? Exp√©rience AGIMA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>