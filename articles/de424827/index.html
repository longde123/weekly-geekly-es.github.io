<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏾 👩🏿‍🏭 👍🏽 Die Illusion von Raum: Wie der neue Spiderman Räume ohne Geometrie rendert 😨 🎶 👨🏿‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In dem kürzlich veröffentlichten Marvels Spider-Man-Spiel haben viele Gebäude Innenräume außerhalb der Fenster. Sie sehen toll aus, aber es scheint, d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die Illusion von Raum: Wie der neue Spiderman Räume ohne Geometrie rendert</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424827/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ss/pw/49/sspw499wnlg2zjfkih9ofjhk8ge.png"></div><br>  In dem kürzlich veröffentlichten Marvels Spider-Man-Spiel haben viele Gebäude Innenräume außerhalb der Fenster.  Sie sehen toll aus, aber es scheint, dass sie mit gerissenem Rendering implementiert wurden - die Geometrie der Innenräume existiert nicht wirklich und wird von einem Shader generiert.  Ich habe keine offiziellen Insomniac-Aussagen darüber gesehen, wie sie es gemacht haben, aber basierend auf dem Aussehen des Effekts ist es sehr wahrscheinlich, dass die <em>Innenkartierungstechnik</em> , die ich 2007 während der Arbeit an der Dissertation entwickelt habe, implementiert wurde.  Ich habe vorher noch nicht im Blog darüber geschrieben, daher ist jetzt der richtige Zeitpunkt, um den neugierigen kleinen Shader zu erklären, den ich mir ausgedacht habe. <br><br>  Beginnen wir mit Marvels Spider-Man-Gameplay.  Das Spiel sieht einfach großartig aus.  Die Kotaku-Website hat ein separates Video unter Windows aufgenommen: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/YQVHtlVEirs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Wie Sie in etwa 40 Sekunden des Videos sehen können, sind die Räume tatsächlich nicht Teil der Geometrie: Wo sich das Fenster offensichtlich befinden sollte, befindet sich die Tür.  Wenn wir einen Raum aus verschiedenen Blickwinkeln des Gebäudes betrachten, sehen wir außerdem ein anderes Interieur.  In einigen Fällen gibt es sogar eine Mauer um die Ecke des Gebäudes.  All dies macht uns verständlich, dass die Räume nachgeahmt werden.  Aus perspektivischer Sicht werden sie jedoch korrekt angezeigt und haben eine echte Tiefe. <a name="habracut"></a>  Ich denke, die Nachteile solcher Räume sind während des Spiels nicht sehr wichtig, da die Spieler die Räume normalerweise nicht so genau studieren: Innenräume sind nur eine Kulisse und kein Gegenstand sorgfältiger Studien.  Ich glaube, dass diese Art der Schaffung von Räumen der Stadt Tiefe und Leben verleiht, ohne zu viele Ressourcen aufzuwenden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b77/b8d/bc9/b77b8dbc9c2a8f05cb6e547c626ffd0b.jpg"></div><br>  <i>Um Ressourcen zu sparen, haben Gebäude in Spielen häufig keine Innenräume, wie im Screenshot von GTA V zu sehen ist</i> <br><br>  Zunächst möchte ich erklären, dass mein Beitrag keine Beschwerde ist: Ich freue mich, dass meine Ausrüstung in einem so großen Spiel verwendet wurde, und beschuldige Insomniac in keiner Weise, gestohlen zu haben.  Wie ich in der ersten Veröffentlichung zur Innenraumkartierung sagte, wäre es mir eine Ehre, wenn jemand diese Technik anwenden würde.  Wenn Insomniac meine Idee in ihrer Technik wirklich ausgenutzt hat, dann finde ich das großartig.  Wenn sie es nicht benutzt hat, scheint sie sich etwas seltsam Ähnliches ausgedacht zu haben.  Dann würde mich interessieren, wie das gemacht wurde. <br><br>  Wie funktioniert die Innenzuordnung?  Die Idee ist, dass das Gebäude selbst keine zusätzliche Geometrie enthält.  Innenräume existieren nur im Shader.  Dieser Shader führt Raycasts mit Wänden, Decken und Böden durch, um zu berechnen, was der Spieler im Innenraum sehen sollte. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af4/7e7/b8f/af47e7b8ff8b0237682a9e6573b42183.jpg"></div><br>  <i>Von links nach rechts: nur Fenster mit Reflexionen, Fenster mit Innenzuordnung, Drahtmodell - Bei der Innenzuordnung werden keine Polygone hinzugefügt.</i> <br><br>  Der für den Raycast verwendete Strahl ist einfach ein Strahl von der Kamera zum Pixel.  Das Pixel, das wir rendern, befindet sich außerhalb des Gebäudes. Daher verwenden wir nur den Teil des Strahls nach dem Pixel, da sich dieser Teil tatsächlich innerhalb des Gebäudes befindet. <br><br>  Raycasting mag wie eine komplizierte und kostspielige Operation erscheinen, aber in diesem speziellen Fall ist es tatsächlich sehr einfach und schnell.  Der Trick besteht darin, dass Sie eine einfache Einschränkung hinzufügen können: Bei der Zuordnung von Innenräumen befinden sich Decken und Böden in einem konstanten Abstand.  Wenn wir das wissen, können wir leicht berechnen, in welchem ​​Raum wir uns befinden und wo sich Boden und Decke in diesem Raum befinden.  Decken und Böden selbst sind endlose geometrische Ebenen.  Die Berechnung des Schnittpunkts zwischen einer unendlichen Ebene und einem Strahl dauert nur wenige Schritte und verbraucht wenig Ressourcen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99a/36a/cc3/99a36acc3fb2962935e9d0b76c4512d0.gif"></div><br>  Der Raum hat 6 Ebenen: Decke, Boden und 4 Wände.  Wir müssen jedoch nur drei davon berücksichtigen, da wir wissen, in welche Richtung wir schauen.  Wenn wir zum Beispiel nach oben schauen, müssen wir den Boden darunter nicht überprüfen, da wir die Decke oben sehen.  In ähnlicher Weise müssen wir anstelle von 4 Wänden nur zwei in der Richtung betrachten, in die wir schauen. <br><br>  Um zu bestimmen, was wir sehen, müssen wir den Schnittpunkt des Strahls mit jeder dieser drei Ebenen berechnen.  Der Schnittpunkt mit dem Strahl, der der Kamera am nächsten liegt, sagt uns, welche der Ebenen wir in diesem Pixel sehen.  Dann verwenden wir den Schnittpunkt als Koordinate der Textur, um die Farbe des Pixels zu ermitteln.  Wenn sich der Strahl beispielsweise an der Position (x, y, z) mit der Decke schneidet, verwenden wir (x, y) als Texturkoordinate und ignorieren z. <br><br>  Hier habe ich eine gute Optimierung hinzugefügt: Ein Teil der Schnittberechnungen für jede der drei Ebenen kann gleichzeitig durchgeführt werden.  Die verwendeten Shader arbeiteten mit float4 mit der gleichen Geschwindigkeit wie mit float, so dass dank der geschickten Packung von Variablen alle drei Strahlen gleichzeitig mit Ebenen geschnitten werden konnten.  Dies hat mir einige Ressourcen gespart und dazu beigetragen, auch 2007 eine hohe Bildrate mit Innenausstattung zu erzielen.  Mir wurde gesagt, dass moderne Grafikkarten mit Float schneller funktionieren als mit Float4.  Dies bedeutet, dass diese Optimierung auf der aktuellen Hardware nicht mehr funktioniert. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d5d/1f5/751/d5d1f57518f274783ab5b797d861a4d0.jpg"></div><br>  <i>Die Innenzuordnung ohne Fenstertexturen zeigt, dass Räume mit der richtigen Perspektive und den richtigen Texturen gerendert werden, obwohl keine zusätzliche Geometrie erforderlich ist.</i> <br><br>  Weitere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Informationen</a> zur Innenraumzuordnung finden Sie in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">meinem Artikel</a> .  Dieser Artikel wurde 2008 auf der Computer Graphics International Conference veröffentlicht. Diese von Experten begutachtete Veröffentlichung ist meine erste (und einzige) Bewerbung für den stolzen Titel eines Wissenschaftlers.  In diesem Artikel werden auch zusätzliche Experimente beschrieben, um Details hinzuzufügen, z. B. das Ändern des Abstands zwischen Wänden für Räume ungleicher Größe und das zufällige Auswählen von Texturen aus einem Texturatlas für eine größere Raumvariabilität.  Außerdem werden die beiden in den folgenden Bildern gezeigten Variationen ausführlich beschrieben. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed8/17a/28a/ed817a28adbc6f0dd9ea44ce6f61294b.jpg"></div><br>  <i>Die Beleuchtung in Räumen kann dynamisch ein- und ausgeschaltet werden, um einen Wechsel von Tag und Nacht zu simulieren.</i>  <i>Dies geschieht unter Verwendung der Rauschtextur, aus der wir lesen, wobei der Raumindex als Texturkoordinaten verwendet wird.</i> <br><br>  Da wir nur Strahlen in der Ebene aussenden, sind alle Räume einfache Quadrate mit Texturen.  Alle Möbel im Raum werden auf der Textur sein, was bedeutet, flach zu bleiben.  In Spiderman macht sich dies bemerkbar, wenn Sie sich der Kamera nähern: Die Tische in den Räumen sind eigentlich flache Texturen an den Wänden.  Wie Sie in der Abbildung unten sehen können, können wir unsere Technik durch eine oder mehrere zusätzliche Texturschichten pro Raum ergänzen. Dies ist jedoch mit zusätzlichen Leistungskosten verbunden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea2/e0d/2dc/ea2e0d2dc5b8b6783928931e15e612a5.jpg"></div><br>  <i>Durch Raytracing einer anderen Ebene parallel zur Außenfläche des Gebäudes können Sie dem Raum Möbel und Personen hinzufügen.</i>  <i>Sie bleiben jedoch weiterhin flach.</i> <br><br>  Nach der Veröffentlichung dieses Beitrags sagte mir einer der Programmierer Simcity (2013), dass die Interior-Mapping-Technik auch in diesem Spiel verwendet wurde.  Darin sieht sie sehr cool aus und die Entwickler haben ein großartiges Video darüber aufgenommen.  Sie verfeinerten meine ursprüngliche Idee, indem sie alle Texturen in einer Textur speicherten und Räume unterschiedlicher Tiefe hinzufügten.  Der innere Kartierungsteil beginnt um 1:00 Uhr morgens: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_x88tvkAGuo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Wenn Sie diese Technik genauer untersuchen möchten, können Sie <a href="">meine Demo</a> zur <a href="">Innenzuordnung</a> mit Quellcode herunterladen.  Wenn Sie in Unreal Engine 4 arbeiten, finden Sie die Innenraumzuordnung als Standard-Engine-Funktion in Form der InteriorCubeMap-Funktion. <br><br>  Nach so vielen Jahren ist es großartig zu sehen, dass meine Interieur-Mapping-Technik bei der Produktion von großen Videospielen verwendet wird!  Wenn Sie mit Spielen vertraut sind, die etwas Ähnliches verwenden, schreiben Sie mir darüber. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424827/">https://habr.com/ru/post/de424827/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424817/index.html">Digitales Produktdesign. Zweck, Rolle, Methode</a></li>
<li><a href="../de424819/index.html">Datenvalidierung - Java- und Spring-Validierung</a></li>
<li><a href="../de424821/index.html">Über Dämonen und Teleportation: Zwei Technologien, die die Quantenzukunft näher bringen</a></li>
<li><a href="../de424823/index.html">Wie kalorienarme Ernährung das Altern beeinflusst</a></li>
<li><a href="../de424825/index.html">Roboter und Kommunismus</a></li>
<li><a href="../de424831/index.html">Was ist in die digitale Wirtschaft investiert</a></li>
<li><a href="../de424835/index.html">So reduzieren Sie das Risiko von Investitionen an der Börse: 3 Diversifizierungsfaktoren</a></li>
<li><a href="../de424841/index.html">Speichern Sie ein Bildarchiv für eine Site im Azure BLOB-Speicher</a></li>
<li><a href="../de424843/index.html">Ist IBOutlet in Ihren iOS-Apps privat?</a></li>
<li><a href="../de424845/index.html">Berechnung magischer Quadrate mit einer GPU</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>