<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèª‚Äçü§ù‚Äçüßëüèª üöä üë©‚Äçüç≥ Une telle douleur, une telle douleur, l'infrastructure 1: 0 üí° üññüèº ü§∂üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous fabriquons le meilleur syst√®me de d√©tection d'emprunt en Russie et dans les pays voisins. Dans un monde id√©al, nous ne traiterions que de la conc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une telle douleur, une telle douleur, l'infrastructure 1: 0</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/antiplagiat/blog/440912/"><p>  Nous fabriquons le meilleur syst√®me de d√©tection d'emprunt en Russie et dans les pays voisins.  Dans un monde id√©al, nous ne traiterions que de la conception et du d√©veloppement du syst√®me.  Mais, h√©las, l'anti-plagiat ne fonctionne pas dans le vide, et pour que nos utilisateurs puissent utiliser nos d√©veloppements de mani√®re pratique et confortable, nous devons √©galement d√©velopper l'environnement entourant notre service.  Notre logiciel ne fonctionne pas encore sans fer, les utilisateurs doivent fournir un support technique, il est n√©cessaire de recevoir le paiement des utilisateurs sans enfreindre la loi, etc.  Bref, la routine suffit. </p><br><p>  Cet article est le premier d'une s√©rie de <strike>drames</strike> de <strike>production</strike> sur la fa√ßon dont nous avons am√©lior√© notre service gr√¢ce √† l'externalisation.  Nous partageons de vrais probl√®mes et conclusions. </p><br><h1>  Nuages, chevaux blonds ... </h1><br><img src="https://habrastorage.org/webt/zv/gk/jj/zvgkjjsz7yiiggzxydco6uvippi.png"><br>  <sup><em>(de quelque part sur Internet, je l'ai vu pour la premi√®re fois <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .)</em></sup> <br><p>  La charge sur notre syst√®me est tr√®s in√©gale: tout d'abord, pendant la journ√©e, la charge change 5 fois.  Deuxi√®mement, il y a une saisonnalit√© prononc√©e.  Le maximum quotidien de contr√¥les apr√®s la fin de la session d'√©t√© est r√©duit de 10 fois!  La session d'hiver n'est pas si brillante, mais pas non plus un cadeau.  De plus, chaque session d'√©t√© suivante est plus lourde (en termes de nombre de contr√¥les) et plus difficile (nouvelles technologies de recherche et fonctionnalit√©s) que la pr√©c√©dente.  Par cons√©quent, d'une part, je veux avoir un bon approvisionnement en ressources, d'autre part, ne payez pas trop lors d'une baisse d'activit√©.  Dans une session, vous pouvez d√©ployer plus de serveurs et, en √©t√©, r√©duire la quantit√© de ressources consomm√©es.  √âvidemment, c'est juste le cas avec les fournisseurs de cloud.  Dans cet article, je parlerai de divers aspects de l'interaction avec plusieurs fournisseurs de cloud (AWS, IT Grad, MCS, YC).  S'il semble √† quelqu'un qu'il s'agit d'un cri de l'√¢me, il ne se trompera pas beaucoup.  Alors allons-y! <br></p><a name="habracut"></a><br><h2>  Aws </h2><br><p>  Nous avons commenc√© √† utiliser les ressources cloud en f√©vrier 2013 lorsque nous avons lou√© notre premier serveur dans AWS.  En fait, Amazon est la premi√®re et la plus longue exp√©rience d'Anti-Plagiat avec les nuages.  Ensuite, nous avons commenc√© avec une seule machine, et maintenant notre budget dans AWS est un ordre de grandeur sup√©rieur √† celui de tous les clouds russes.  Le premier amour, comme vous le savez, n'est jamais oubli√©.  J'ai consid√©r√© tous les probl√®mes et opportunit√©s avec d'autres clouds dans cet article en fonction de mon exp√©rience avec AWS. </p><br><p>  Certes, il y avait aussi une mouche dans la pommade dans les relations avec Amazon.  Voici les fonctionnalit√©s ou les inconv√©nients que nous avons avec Amazon: <br><br></p><ol><li>  Vous ne pouvez pas acc√©der √† la console d'une machine virtuelle via un navigateur.  Et parfois, c'est vraiment n√©cessaire ici!  Une fois que nous avons supprim√© par erreur l'interface r√©seau, et l'acc√®s a √©t√© perdu sur l'une des machines.  Heureusement que quelqu'un avait d√©j√† rencontr√© un tel probl√®me, en une demi-heure nous avons trouv√© et appliqu√© avec succ√®s la solution.  Gr√¢ce √† la console, une telle op√©ration pourrait se faire en une minute. </li><li> Les co√ªts sont en dollars et nous gagnons en roubles.  Par cons√©quent, la rentabilit√© d√©pend du dollar. </li><li>  Il n'y a pas de centre de donn√©es en Russie, le plus proche lorsque nous avons commenc√© √©tait en Irlande.  Cela signifie un grand ping et certaines restrictions sur le stockage des donn√©es qui surviennent en raison des exigences de la loi russe. </li><li>  Roskomnadzor bloque r√©guli√®rement les adresses AWS.  Actuellement, il existe diff√©rentes disponibilit√©s de serveur dans AWS √† partir de diff√©rents sites.  Pour des raisons inconnues, la connexion √† la machine peut tomber.  Habituellement, la modification de l'adresse IP, du VPN et du proxy aide. </li><li>  Amazon est nettement plus cher que les nuages ‚Äã‚Äãrusses.  Certes, vous pouvez r√©duire les co√ªts gr√¢ce √† un programme de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sauvegarde</a> flexible et √† l'utilisation d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instances ponctuelles</a> .  Et nous utilisons activement les deux.  H√©las, nous n'avons pas encore vu une telle fonctionnalit√© dans les clouds domestiques (upd: YC a annonc√© "VMs interrompues" dans la newsletter du 18 f√©vrier, nous attendons les d√©tails). </li><li>  Le probl√®me des messages insuffisamment informatifs.  Lors du passage de la 3e g√©n√©ration de machines √† la 4e ou √† la 5e, le mat√©riel virtuel a s√©rieusement chang√©, notamment la m√©thode de connexion des disques, et les machines n'ont tout simplement pas d√©marr√© apr√®s le changement de type.  L'interface de gestion d'instance a renvoy√© un message concis: capacit√© insuffisante.  Il y avait suffisamment de limites pour cr√©er les types de machines n√©cessaires avec une marge, et pendant environ six mois, nous avons essay√© sans succ√®s le support technique gratuit pour modifier les limites.  √áa n'a pas aid√©.  En cons√©quence, ils ont googl√© la solution eux-m√™mes - une r√©cr√©ation banale des machines aide. </li><li>  √Ä quelques reprises, nous avons effac√© les SSD dans les trous: les disques ont simplement disparu du syst√®me avec toutes les donn√©es.  √âtant donn√© qu'il s'agissait de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">disques √©ph√©m√®res</a> , c'est-√†-dire  les donn√©es sont perdues lorsque la machine s'arr√™te, nous n'y avons pas stock√© quelque chose d'irrempla√ßable. </li></ol><br><p>  En principe, il √©tait possible de vivre avec ces lacunes.  Cependant, exactement au moment o√π Amazon a finalement remarqu√© le march√© russe, notre compte n'est pas devenu tr√®s pratique pour le paiement √† partir d'une carte.  Heureusement, Amazon a rapidement corrig√© la situation et nous a fourni un gestionnaire de compte qui nous a aid√©s √† passer du paiement par carte √† un contrat direct, √† payer une facture et √† r√©diger divers types d'accords.  En g√©n√©ral, il vient r√©guli√®rement en Russie, et lorsqu'il vient chez nous, il parle des opportunit√©s d'optimisation des infrastructures et des paiements.  Parfois, il apporte avec lui un architecte de solution, avec qui il peut discuter de l'architecture actuelle de notre solution, parler de ¬´liste de souhaits¬ª et des probl√®mes, et obtenir plusieurs solutions, non seulement via les services AWS.  Les employ√©s d'Amazon d√©clarent que leur objectif n'est pas de fournir plus de services, mais de faire en sorte que les services achet√©s profitent √† l'entreprise.  Il semble que ce soit vraiment vrai.  Le nombre de services, la rapidit√© de leur d√©veloppement et la profondeur de l'int√©gration mutuelle sont impressionnants.  AWS a tout pour organiser √† la fois le processus de d√©veloppement et le fonctionnement de syst√®mes hautement charg√©s de toutes tailles.  Jusqu'√† pr√©sent, un seul probl√®me mondial co√ªte cher! </p><br><h2>  IT Grad 2016 </h2><br><p>  En 2015, nous avons d√©cid√© qu'il √©tait temps pour nous d'abandonner compl√®tement notre propre fer.  Je voulais poser les probl√®mes de fiabilit√© des √©quipements sp√©cifiquement sur les autres et me concentrer davantage sur l'am√©lioration des processus de notre propre d√©veloppement.  Selon nos pr√©visions, en 2016, nous aurions eu assez de mat√©riel que nous avions en ce moment, et nous aimerions avoir une r√©serve pour chaque incendie.  Nous avons soigneusement abord√© le choix du fournisseur: nous avons pr√©par√© pour nous un test de charge et un questionnaire avec des questions importantes et avons m√©ticuleusement choisi parmi cinq fournisseurs: ActiveCloud, Cloud4Y, CloudOne, IT Grad, Softline. </p><br><p>  En cons√©quence, nous avons opt√© pour les nuages ‚Äã‚ÄãIT Grad.  Leurs avantages: <br></p><ol><li>  Position de vie active, les r√©ponses √† nos questions ont √©t√© donn√©es rapidement, il √©tait facile de communiquer. </li><li>  La pr√©sence de disques SSD rapides, jusqu'√† 30 IOPS par Go.  Le nombre d'op√©rations de lecture al√©atoire est un indicateur tr√®s important pour nous, car des valeurs √©lev√©es nous permettent de placer nos modules de scan dans le cloud. </li><li>  Plateforme VCloud avec la possibilit√© de contr√¥ler les machines et la pr√©sence d'une console pour chaque machine. </li><li>  La possibilit√© d'augmenter les ressources d'une machine virtuelle sans red√©marrer. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Facturation flexible</a> - le paiement est effectu√© pour les ressources qui √©taient utilis√©es le jour au milieu de la p√©riode de rapport (le 14-15e jour de chaque mois).  De plus, il existe une option ¬´Pay-As-You-Go¬ª, mais elle est plus ch√®re et le calcul de la quantit√© de ressources consomm√©es est effectu√© par la charge moyenne du CPU et de la RAM toutes les 2 heures. </li></ol><br><p>  En 2016, nous avons d√©m√©nag√© √† IT Grad.  Voici ce qui s'est pass√© au cours des trois ann√©es incompl√®tes de notre vie commune: <br><br></p><ol><li>  Une fois, nous avons eu un probl√®me.  Exactement √† 21h00, un √©trange recul des performances a commenc√©.  Le nombre de contr√¥les que le syst√®me pouvait effectuer est pass√© de 150 √† 20-30 par minute, alors qu'au bout de quelques heures, tout a √©t√© restaur√© et r√©solu √† une vitesse de 600 contr√¥les par minute.  Nous avons cherch√© pendant une semaine √† la maison, v√©rifi√© les utilisateurs, attrap√© des bots et des DDoS, mais nous n'avons rien trouv√©.  Nous nous sommes tourn√©s vers le support de IT-Grad, avons d√©couvert que "oh, et nous faisons des sauvegardes ici."  En cons√©quence, ils nous ont √©cras√©s avec une source de probl√®mes sur diff√©rents syst√®mes de disques et ont mis en place le travail. </li><li>  Habituellement (caract√©ristiques de l'utilisation du produit), pendant une session, notre trafic d√©passe 100 m√©gabits par seconde.  Soit dit en passant, cette valeur est souvent d√©finie par d√©faut pour le canal non r√©serv√© dans de nombreux fournisseurs de cloud.  Lorsque nous avons franchi cette fronti√®re pour la premi√®re fois, un certain nombre de probl√®mes sont survenus: l'Edge int√©gr√© ne pouvait pas faire face au VPN entre le point d'entr√©e situ√© sur notre √©quipement et la machine virtuelle du serveur Web situ√©e dans le cloud.  Comme pr√©vu, ils se sont tourn√©s vers le support, o√π on nous a propos√© d'augmenter les ressources sur Edge.  Ok, pas de doute, nous avons remplac√© sa configuration de petite √† grande, et avons √©galement √©tendu le canal √† la taille de notre trafic de pointe avec une marge.  √áa n'a pas aid√©.  En g√©n√©ral, nous n'avons pas pu trouver la solution optimale, j'ai d√ª r√©duire le volume de trafic en d√©pla√ßant une partie de la production vers d'autres sites. </li><li>  La connexion VPN au site IT Grad est parfois interrompue pendant 1 √† 2 minutes.  √Ä la question de savoir pourquoi cela se produit, ni nous ni le support technique ne pouvons trouver la r√©ponse.  Jusqu'√† pr√©sent, je dois vivre avec ce probl√®me. </li><li>  Le m√©canisme de redimensionnement des ressources fonctionne mal, √† la fois √† la vol√©e et hors tension.  Il me semble cependant que c'est plut√¥t un probl√®me avec le fournisseur de la plateforme (VMware).  N√©anmoins, nous avons d√©j√† rencontr√© le fait que pour appliquer de mani√®re fiable toutes les extensions, il √©tait n√©cessaire de red√©marrer la machine invit√©e (Windows Server 2012 R2).  Apr√®s le redimensionnement, la machine elle-m√™me n'a pas d√©marr√© plusieurs fois.  Le support a r√©solu ce probl√®me de 2 √† 4 heures du matin pendant la session - notre saison m√™me.  Il faisait chaud m√™me la nuit! </li><li>  En 2016, nous avions un √©norme monolithe, comme l'Everest, qui n√©cessitait beaucoup de ressources.  Tellement que nous devions parfois d√©passer la taille maximale des machines invit√©es recommand√©es pour un h√¥te donn√©.  Le support nous a constamment demand√© de r√©duire la taille des machines virtuelles √† au moins la moiti√© de la taille de l'h√¥te.  Nous devons rendre hommage √† IT Grad - on nous a propos√© d‚Äôutiliser un mat√©riel distinct avec la possibilit√© de l‚Äôutiliser enti√®rement pour quelques autres gros investissements, et la flexibilit√© du cloud a √©t√© perdue. </li><li>  Facturer une fois par mois pour mesurer la quantit√© de ressources consomm√©es nous a jou√© deux fois un tour.  Au tout d√©but, nous avons directement pos√© la question de l'opportunit√© de r√©duire les ressources le 14-15 du mois afin de payer moins.  On nous a r√©pondu directement que c'est ainsi que cela fonctionne.  La premi√®re fois, cela nous a frapp√© douloureusement lors du transfert d'une partie de la vente vers notre cloud.  Le facteur humain a fonctionn√© - ils ont essay√© de tout finir rapidement avant le 14, puis ils l'ont ratiss√© notamment.  La deuxi√®me fois, nous avons saisi cette opportunit√© apr√®s pr√®s de 3 ans de coop√©ration, apr√®s quoi nous avons √©t√© factur√©s en moyenne le 5, 15, 20.  Ensuite, le facteur humain a fonctionn√© pour eux - apr√®s l'appel, il s'est av√©r√© qu'ils ont fait une erreur en leur faveur (le recalcul a √©t√© fait manuellement), s'est excus√© et a accord√© une remise. </li><li>  Les performances des disques et des machines dans leur ensemble ont r√©pondu aux caract√©ristiques d√©clar√©es.  N√©anmoins, plusieurs fois, nous ne pouvions pas comprendre pourquoi tout fonctionnait si lentement, m√™me l'interface ralentissait sans piti√©.  Le support a assur√© que tout √©tait en ordre et ils n'ont eu aucun probl√®me avec l'√©quipement.  Ce qui s'est pass√© l√†-bas - notre serveur √† ce moment-l√† a migr√© vers un h√¥te voisin ou quelqu'un a fait une sauvegarde du sous-syst√®me de disque - cela reste un myst√®re pour nous. </li><li>  Les disques peuvent √™tre commut√©s entre les machines ind√©pendamment uniquement via le support.  Au d√©but de l'utilisation, il √©tait impossible d'avoir des disques de types diff√©rents dans la machine, il fallait en sortir (iSCSI, Samba et NFS).  Apr√®s un certain temps, l'utilisation de diff√©rents types de disques sur une machine est devenue possible d'abord via le support, puis de mani√®re autonome (apparemment fait dans vCloudDirector).  Soit dit en passant, la mise √† jour du syst√®me de gestion de la virtualisation a lieu r√©guli√®rement.  Nous recevons une lettre 1 √† 2 fois par mois indiquant que pendant une heure ou deux, le syst√®me de contr√¥le des machines virtuelles prend des t√¢ches techniques et ne sera pas disponible pendant un certain temps, les machines elles-m√™mes continuent de fonctionner √† ce moment. </li><li>  Le 16 f√©vrier 2018, une partie de nos ventes situ√©es √† IT Grad √©tait due √† des probl√®mes d'alimentation √©lectrique du centre de donn√©es dans lequel se trouvait l'√©quipement.  Nous avons eu connaissance de l'incident de facto; nous n'avons pas pu contacter le support technique.  J'ai d√ª appeler notre gestionnaire de compte, il a imm√©diatement dit dans une minute quoi et comment, et s'est √©teint, apparemment en disant au reste.  De l'agr√©able - nous √©tions allong√©s √† c√¥t√© de VKontakte. </li></ol><br><p>  Apr√®s avoir pass√© quelque temps dans une maison lou√©e et confront√© √† tout ce qui pr√©c√®de, en 2017, nous avons d√©cid√© qu'il √©tait bon de visiter, mais mieux √† la maison, et nous avons commenc√© √† cr√©er un cloud avec des disques NVMe rapides et la possibilit√© de tout contr√¥ler compl√®tement.  Aussit√¥t dit, aussit√¥t fait: ils ont d√©plac√© les ventes vers leur cloud de clients d'entreprise et de modules de recherche (au total plus de 90% de la charge), laissant la surveillance, les statistiques et les clients priv√©s dans IT Grad.  En 2018, tout le monde a de nouveau tout calcul√© et il s'est av√©r√© qu'il √©tait plus rentable de diviser la production: garder une partie dans le cloud lou√©, et une partie dans la leur.  Qu'est-il advenu de cela? </p><br><h2>  Solutions cloud de messagerie </h2><br><p>  Honn√™tement, je voulais, comme dans AWS, mais en Russie.  Par cons√©quent, nous avons commenc√© √† regarder vers les nuages ‚Äã‚Äãavec des ensembles de services similaires (que je trompe, au moins avec l'analogue de EC2 et S3).  La recherche a √©t√© de courte dur√©e - nous avons trouv√© "l'Amazonie russe" en la personne de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MCS</a> .  Une grande entreprise avec une large gamme de services divers, selon toutes les indications, ils devraient √™tre en mesure de pr√©parer les nuages! </p><br><p>  Le d√©but de la rencontre a √©t√© merveilleux.  Un gestionnaire de compte est venu √† notre bureau, a tout expliqu√© en d√©tail, a d√©crit les opportunit√©s et les plans actuels pour un avenir proche.  La sortie √©tait une image merveilleuse: des prix bas pour les ressources informatiques, il y a un stockage d'objets et une sortie pr√©coce de la production de bases de donn√©es (similaire √† RDS).  Nous avons √©galement re√ßu une limite de tr√©sorerie solide pour les tests (encore plus que ce qu'Azure donne). </p><br><p>  √Ä ce moment-l√†, nous avions d√©j√† la partie IaC pr√™te √† d√©ployer toutes les machines via terraform.  MCS avait openstack et il √©tait bien support√©!  Soit dit en passant, le support technique est assur√© par un canal de t√©l√©gramme - communication ¬´en direct¬ª et il est clair qu'ils veulent aider.  Il existe un syst√®me de ticket, mais nous ne l'avons pas encore utilis√©.  Le SLA du support technique fait r√©f√©rence aux demandes cr√©√©es dans le syst√®me de ticket. </p><br><p>  En d√©cembre 2018, nous avions √©crit des scripts de d√©ploiement d'infrastructure via terraform.  Il est temps de bouger.  Pour commencer, nous avons d√©cid√© de transf√©rer le syst√®me avec des clients priv√©s, qui vivaient tout ce temps sur des √©quipements en IT Grad.  Alors tout est comme dans un film: <br></p><blockquote><code>7  (), 18:00     .  ,          . <br> 10  (), 10:00   ‚Äì     . <br> 12  () ‚Äì  . <br> 10:00     terraform.     ,   ,    . <br> 12:00   ansible'.   .   ! <br> 15:30  .         30 ,            16:30. <br> 15:45      .      . <br> 15:55     .     :  ,     . <br> 16:20 ,       .   ,    . ,     -            . <br> 17:30     ,    ,    . <br> 18:00        .       1,5 . <br></code> </blockquote><br><p>  Le probl√®me identifi√© avec diff√©rents formats avec une nouvelle tentative n'aurait pas d√ª appara√Ætre, mais nous l'avons trouv√© et juste au cas o√π corrig√©. <br></p><blockquote> <code>17  (),   . <br> 15:30    .      ,      . <br> 16:00        .   . <br> 16:30      ,      100%.   -?   ! <br> 17:00       ,   ,  , , iotop, top, ProcessExplorer, PerformanceMonitor.  . <br> 21:45    ,   ,  ,    2000 . <br> 22:00  ,  . <br></code> </blockquote><br><p>  L'ancien prod sur IT Grad a facilement satisfait la demande diff√©r√©e de contr√¥les utilisateur, pas de probl√®me. </p>  Le lendemain (18 d√©cembre), nous avons r√©alis√© ce qui suit: <br><br><ol><li>  Nous ne savions pas ce qui ralentissait sp√©cifiquement le syst√®me.  Avant la frise, il n'y avait pratiquement aucune charge nulle part.  Oui, nous avons toujours des appels de blocage profonds √† l'int√©rieur du syst√®me et tr√®s probablement il y a un blocage quelque part, mais o√π exactement, nous n'avons pas pu trouver, il √©tait n√©cessaire de poursuivre l'enqu√™te. </li><li>  Notre test de charge actuel ne correspond pas au profil de charge de la prod.  C'√©tait incroyable parce que  gr√¢ce √† ce test, nous avons pr√©par√© la derni√®re session, identifi√© et √©limin√© un grand nombre de goulots d'√©tranglement.  Mais telle est la r√©alit√© - il faut refaire le test en tenant compte de l'exp√©rience acquise. </li><li>  Produite sur IT Grade avec des ressources CPU et RAM comparables, elle peut facilement supporter deux fois la charge. </li></ol><br>  Ainsi, nous avons rapidement construit un test qui atteint le m√™me r√©sultat que nous avons vu de premi√®re main.  Nous sommes all√©s au support MCS pour savoir si nous mangeons une limite de CPU, mais en g√©n√©ral, c'est la n√¥tre compl√®tement ou pas, et tout va bien avec le r√©seau.  Ils n'ont toujours pas r√©pondu √† la deuxi√®me question, ils ont trouv√© quelque chose sur la troisi√®me et nous ont recommand√© de faire des changements pour les syst√®mes multic≈ìurs.  En g√©n√©ral, nous avons d√©velopp√© une activit√© dynamique, la fin de l'ann√©e approche et tout le monde veut partir en vacances avec un sentiment d'accomplissement. <br><p>  Voici ce que nous avons fini par travailler avec MCS: <br><br></p><ol><li>  M√™me au stade de la s√©lection, on nous a envoy√© un tableau avec les caract√©ristiques du mat√©riel virtuel et du SLA par disque.  L'un des avantages √©tait qu'ils avaient promis 50 IOPS / Go (IT Grad: 30 IOPS / GB) pour le SSD.  Le contrat s'est av√©r√© diff√©rent: ¬´lecture: 5000 IOPS, √©criture: 2000 IOPS¬ª, et nous l'avons rat√©, nous ne nous y attendions pas.  Les tableaux sont identiques, la diff√©rence n'est qu'√† un seul endroit!  Soit dit en passant, nous n'avons pas vu les d√©pendances des performances sur la taille du disque.  Lorsque nous avons test√©, il s'est m√™me av√©r√© qu'avec un disque plus gros, la vitesse chute.  Le secret de ces petits indicateurs est que MCS a un c√©ph g√©o-distribu√©, ce qui signifie que jusqu'√† ce que le n≈ìud distant dise que les donn√©es ont √©t√© √©crites, le client ne sera pas inform√© que l'enregistrement est termin√©.  Soit dit en passant, personne ne semble avoir une telle fiabilit√© ¬´pr√™te √† l'emploi¬ª parmi les fournisseurs avec lesquels nous avons parl√©.  Mais pour nous, une telle fiabilit√© ne fait que mettre des b√¢tons dans les roues!  Si quelque chose se produit, nous devons rapidement passer √† un autre contr√¥leur de domaine lorsque des probl√®mes surviennent et, par cons√©quent, nous avons notre propre r√©plication asynchrone.  Nous avons <abbr title="Plan de reprise apr√®s sinistre">DRP</abbr> et nous sommes pr√™ts √† perdre une petite quantit√© de donn√©es en cas d'accident.  Il faut rendre hommage √† MCS, ils ont acc√©l√©r√© la mise en service d'une baie SSD locale, dont les performances √©taient bien sup√©rieures. </li><li>  Quant aux param√®tres des machines, ils ne sont pas arbitraires.  Il existe un certain ensemble de CPU-RAM- {SSD / HDD} (presque comme dans AWS), et d'autres types de machines ne peuvent √™tre cr√©√©s que via le support.  L'ensemble du processus prend environ 2 heures, il n'y a pas de limite sur le nombre de types, l'essentiel est que le nombre de c≈ìurs ne repr√©sente pas plus de la moiti√© de l'hyperviseur ~ 40-48 processeurs.  Lors de la cr√©ation de la machine, vous pouvez ajouter des disques vous-m√™me et les basculer entre les machines. </li><li>  Apr√®s avoir allum√© le SSD local, la modification des param√®tres de la machine a rendu impossible le d√©marrage.  Ils ne pouvaient √™tre lanc√©s que gr√¢ce au support.  Quelque part en un mois, ils ont r√©solu le probl√®me. </li><li>  Pour la premi√®re fois face √† un support technique par t√©l√©gramme.  En g√©n√©ral, c'est pratique, surtout au d√©but, quand il y a beaucoup de questions et qu'il y a du broyage dans le service.  Mais plus loin, plus les questions s'av√©raient difficiles et la vitesse de r√©ponse et le contenu de l'information diminuaient lentement.  √Ä la fin de l'ann√©e, alors que, bien s√ªr, les d√©lais √©taient respect√©s, la lenteur des r√©ponses me mettait terriblement en col√®re.  √Ä un moment donn√©, ils ont m√™me pos√© des questions sur les accords de niveau de service.  C'est l√† que la compr√©hension est venue que SLA est dans le syst√®me de ticket, et non dans le t√©l√©gramme!  Au moment du 19 f√©vrier, plusieurs de nos questions sans r√©ponse pos√©es le 24 d√©cembre se bloquaient dans cette cha√Æne ... </li><li>  Le support technique via le syst√®me de ticket ne prend pas en compte que nous sommes connect√©s et n√©cessite une notification suppl√©mentaire du num√©ro de contrat.  En r√©ponse, il envoie une lettre ¬´nous vous contacterons¬ª, mais n'indique pas le num√©ro ou le statut du billet. </li></ol><br><p>  En travaillant avec MCS, un autre cloud a commenc√© √† regarder en parall√®le. </p><br><h2>  Encore un autre cloud (Yandex Cloud) </h2><br><p>  Le premier des autres √©tait Yandex.  Fin 2018, ils ne disposaient que de machines virtuelles et de stockage d'objets, de leur propre shell de syst√®me de virtualisation, d'une API ouverte.  Le plugin terraform √©tait en alpha et approuv√© par HashiCorp.  Le support, comme d'habitude, se fait par t√©l√©gramme, mais il est moins actif que dans MCS.  La limite d'argent pour les tests est suffisamment petite et ne nous a pas permis d'effectuer des tests normaux.  J'ai d√ª conclure √† la h√¢te un accord (3 jours ouvrables) et payer les tests.  Selon les r√©sultats des tests, nous avons obtenu la m√™me chose que sur le MCS.  Il nous a sembl√© qu'il y avait deux probl√®mes: tout le monde a des lecteurs trop lents et nous avons un test trop s√©v√®re. </p><br><h2>  IT Grad 2019 </h2><br><p>  En g√©n√©ral, nous avons fix√© une date limite pour le d√©m√©nagement d√©j√† le 22 d√©cembre, afin qu'il y ait une autre semaine pour identifier et r√©soudre les probl√®mes cach√©s d'une nouvelle r√©sidence.  Ayant perdu espoir de passer √† la date limite et un peu fatigu√©s de l'abondance de nouvelles informations en la personne de MCS et YC, nous avons d√©cid√© que IT Grad n'√©tait pas si mal dans leur contexte.  Nous nous sommes m√™me sentis un peu nostalgiques et avons pens√© que tout ce qui est nouveau est bien ancien.  D√©j√† chez IT Grad, nous allons certainement bien travailler - il y a un pr√©c√©dent.  De plus, IT-Grad a augment√©: il y avait un centre de donn√©es √† Moscou, Tier III, temps de disponibilit√© au moment o√π il a toujours 100% (jamais √©chou√©), et l'√©quipement √† l'int√©rieur - Intel Xeon √©volutif √† 4 sockets (jusqu'√† 42 c≈ìurs x 3 GHz Xeon Gold 6154).  Que diable ne plaisante pas, nous donnerons une seconde chance! <br></p><blockquote> <code>28  (), 18:10   -     vDC      ,    ,          . <br> 29  ( ), 17:04    ,   .   .iso  ,          .           ,   .  ,    .   ,    . <br> 30  (), 22:00 ,            .iso,             .       ,   - . <br> 31  (), 3:15    Edge   vDC    vDC. ,              .      . <br> <br>  ,   . <br> <br> 2  (), 15:30       . <br> 2  (), 21:50 ,   Guest OS Customization  . <br> 3  (), 18:05   !</code> </blockquote> <br><p></p><ol><li>  Maintenant, lors de la pr√©paration de l'article, ils ont constat√© que l'heure exacte des demandes et des r√©ponses ne se refl√©tait pas dans le syst√®me de tickets.  Au lieu de cela, il est √©crit "il y a environ 2 mois", l'heure exacte n'est affich√©e que dans une info-bulle.  Par courrier, il est √©galement difficile de restaurer la s√©quence des √©v√©nements.  Les messages envoy√©s √† la messagerie sont logiques de mani√®re non √©vidente et ne contiennent pas de description de l'action.  Les tickets sont cr√©√©s dans le syst√®me apr√®s un certain temps au nom d'un employ√© du support technique IT Grad. </li><li>  Apr√®s un examen plus attentif de l'√©quipement apr√®s les vacances, nous y avons vu Xeon v2.  Ce n'est pas ce que nous avons convenu.  D'accord, nous avons d√©cid√© de cette question avec le gestionnaire de compte.  Il y a eu quelques difficult√©s en raison du fait que dans la nouvelle ann√©e 2019, IT Grad a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">inclus dans le MTS</a> , et juste apr√®s les vacances, il y a eu un l√©ger g√¢chis.  De vDC sur de nouveaux √©quipements dans le DC de Moscou n'√©tait pas visible vDC cr√©√© avant la nouvelle ann√©e.  Ce n'est que gr√¢ce √† l'Internet ouvert que le support technique nous a ¬´fait plaisir¬ª que la vitesse de d√©placement ne d√©passe pas 1 To / jour.  Et nous avons d√©j√† t√©l√©charg√© 7 To de donn√©es!  En cons√©quence, ils ont cr√©√© une application pour d√©m√©nager jeudi soir.  Un jour plus tard, vendredi soir, j'ai demand√© comment allez-vous et quand ont-ils l'intention de commencer (attendez pr√®s d'une semaine!)?  Un jour plus tard, samedi soir, on nous a dit que toutes les voitures avaient boug√©.  Je n'aimais pas que 2,5 jours il n'y avait aucune information sur l'avancement des travaux et que les estimations sur le d√©m√©nagement √©taient trop pessimistes. </li><li>  En septembre 2018, lorsque nous avons commenc√© √† impl√©menter l'IaC, nous avons r√©alis√© que terraform fonctionnait tr√®s mal avec vCloudDirector (upd: au moment de la r√©daction, nous avons appris que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VMware vCloud Director Provider 2.0 est apparu</a> , mais ne l'avons pas encore essay√©).  Au d√©but, nous n'avons m√™me pas √©t√© en mesure de cr√©er une machine car vCloud nous a signal√© une erreur dans l'esprit de "quelque chose s'est mal pass√©, vous avez une erreur de 512 caract√®res 136 lignes (la ligne √©tait plus courte!) Xml de la configuration de la machine".  Nous avons demand√© de l'aide.  La question a √©t√© redirig√©e vers les ing√©nieurs, √† la fin on nous a dit que la terraform n'√©tait pas prise en charge - triez-la vous-m√™me.  Quoi qu'il en soit, nous avons compris que le packer √©tait √† bl√¢mer, avec lequel nous avons collect√© l'image de la machine, il ne pouvait pas faire face au format de configuration propri√©taire VMware.  Terraform est tr√®s mauvais avec vCloudDirector, tout est filet√© lentement et le connecteur a √©t√© abandonn√© depuis longtemps et ne se d√©veloppe pas.  Personne ne nous donnerait acc√®s √† vSphere.  Si vous restez sur VMware, vous devez voir votre automatisation √† travers leur API. </li></ol><br><p>  Nous avons organis√© un banc d'essai dans un nouvel emplacement.  Le r√©sultat a √©t√© incroyable - le test a √©chou√©, les sympt√¥mes sont les m√™mes que sur le MCS.  Probablement, dans la prod actuelle dans le feu de la bataille pour la session, certains param√®tres du syst√®me d'exploitation ont √©t√© modifi√©s pour emp√™cher le syst√®me de geler, mais qui ne peuvent plus √™tre restaur√©s.  Pour √©viter que cela ne se reproduise, nous introduisons l'IaC.  Nous avons effectu√© 2 tests suppl√©mentaires: cr√©ation de nouvelles machines √† partir d'images propres des syst√®mes d'exploitation de la vente actuelle - √©chec;  sur les machines de production existantes - succ√®s.  Ainsi, il a √©t√© confirm√© que nous avons effectu√© quelques r√©glages dans le syst√®me d'exploitation ou la base de donn√©es, mais nous ne nous souvenons pas lequel.  √Ä ce stade, la solution de notre d√©veloppement est arriv√©e √† temps: les frises s'arr√™tent lorsque les sessions fiables sont d√©sactiv√©es dans WCF. </p><br><p>  Nous avons effectu√© un test de charge avec les param√®tres recommand√©s par les d√©veloppeurs en parall√®le sur MCS (2 GHz, Xeon v4) et IT Grad (3 GHz, Xeon v2) - le nombre de c≈ìurs et de m√©moire est le m√™me.  Sur MCS, le test est pass√© plus vite (d'un quart) et plus lisse (sur IT Grad, le test est devenu saccad√©, puis plus rapide, puis plus lent). </p><br><h2>  Comparaison des performances du disque </h2><br><p>  Nous √©tions tr√®s pr√©occup√©s par les performances des disques pour les bases de donn√©es et les index, c'est pourquoi nous avons test√© principalement les SSD.  Ne jugez pas strictement pour les tests, quand nous avions besoin de comprendre les performances des clouds, sur habr.com, il n'y avait pas encore plusieurs tests de disques, processeurs, ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deux</a> ) fournisseurs de cloud.  Nous √©tions limit√©s dans le temps et nous devions comparer rapidement les performances afin d'avoir une id√©e de la diff√©rence de performances.  Par cons√©quent, l'exigence pour le test √©tait une - elle peut √™tre r√©p√©t√©e rapidement sur n'importe quel site.  Nous avons utilis√© les machines au plus pr√®s des param√®tres que nous avions d√©j√† d√©ploy√©s, fio - pour tester les performances des disques, et pgbench - pour √©valuer les performances de la base de donn√©es sur ce disque.  En standard, nous avons pris des mesures de la production actuelle - MARS (parce que notre √©quipement porte le nom des h√©ros de la s√©rie anim√©e sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les souris de roche de Mars</a> ). </p><br><p>  En r√®gle g√©n√©rale, les performances du disque d√©pendent de leur taille.  Nous avons observ√© ce comportement dans IT City et dans AWS, mais dans MCS, nous n'avons pas vu une telle d√©pendance, elle n'existe pas non plus dans SLA, et les tests ont donn√© un r√©sultat paradoxal (et peut-√™tre inexact) - les performances diminuent avec l'augmentation du disque. </p><br><p>  Nous avons compt√© les iops pour les disques durs et SSD, ainsi que les tps (transactions par seconde) pour la base de donn√©es postgres sur les disques SSD.  Il existe deux types de disques dans MCS: les SSD et HDD ceph g√©o-distribu√©s et les SSD locaux (dans un seul DC) (leurs performances sont indiqu√©es entre parenth√®ses).  Toujours en janvier 2019, dans le mailing de MCS, nous avons lu qu'ils avaient augment√© les performances du disque de 20%, le r√©sultat du test est √©galement dans le tableau (MCS 2019).  En f√©vrier, une nouvelle acc√©l√©ration a √©t√© signal√©e, mais nous n'avons pas effectu√© de tests ici. </p><br><p>  R√©sultats: </p><div class="scrollable-table"><table><tbody><tr><th><br></th><th colspan="2">  HDD, iops </th><th colspan="2">  SSD, iops </th><th>  SSD, tps </th></tr><tr><th><br></th><th>  lire </th><th colspan="1">  √©crire </th><th>  lire </th><th colspan="1">  √©crire </th><th>  lire √©crire </th></tr><tr><th><p>  Mars </p></th><td>  1336 </td><td colspan="1">  445 </td><td>  17196 </td><td colspan="1">  5729 </td><td>  2000 </td></tr><tr><th><p>  IT Grad <br></p></th><td>  4544 </td><td colspan="1">  1515 </td><td>  13231 </td><td colspan="1">  4407 </td><td>  3063 </td></tr><tr><th colspan="1">  Mcs </th><td colspan="1">  1185 </td><td colspan="1">  395 </td><td colspan="1">  8931 (22857) </td><td colspan="1">  2980 (7637) </td><td colspan="1">  497 (1 402) </td></tr><tr><th colspan="1">  MCS 2019 </th><td colspan="1">  3229 </td><td colspan="1">  1080 </td><td colspan="1">  9334 (22270) </td><td colspan="1">  3113 (7418) </td><td colspan="1">  463 (1342) </td></tr><tr><th colspan="1">  Yc </th><td colspan="1">  2202 </td><td colspan="1">  735 </td><td colspan="1">  5522 </td><td colspan="1">  1843 </td><td colspan="1">  1824 </td></tr></tbody></table></div><br><h3>  M√©thodologie de test </h3><br><p>  <strong>iops a √©t√©</strong> calcul√© comme la moyenne de 4 courses fio: <br> <code>/root/fio-2.0.9/fio --randrepeat=1 --ioengine=libaio --direct=1 --gtod_reduce=1 --name=test --filename=test --bs=4k --iodepth=64 --size=4G --readwrite=randrw --rwmixread=75</code> </p> <br><p>  <strong>tps</strong> , en moyenne sur 3 s√©ries de pgbench: <br> <code>pgbench -c 10 -j 2 -t 10000 example</code> </p> <br><h3>  Description des stands </h3><br><h4>  Mars </h4><br><p>  Xeon v4, 2 GHz <strong>;</strong>  <strong>Disque dur:</strong> ceph, 3 n≈ìuds de 9x 2 To ST2000NX0253, r√©plique 2;  <strong>SSD:</strong> ceph, 3 n≈ìuds sur 2 To NVMe Intel DC P4600, r√©plique 2 </p><p>  <strong>CPU</strong> : 4, <strong>RAM</strong> : 8 Go, <strong>disque dur</strong> : 32 Go, <strong>SSD</strong> : 150 Go;  La production parall√®le tourne. </p><br><h4>  IT Grad </h4><br><p>  Xeon v4 / v2, 2 GHz <strong>;</strong>  <strong>Disque dur</strong> : 0,1 IOPS / Go <strong>;</strong>  <strong>SSD:</strong> 30 IOPS / Go </p><p>  <strong>Processeur</strong> : 4, <strong>RAM</strong> : 4 Go, <strong>disque dur</strong> : 250 Go, <strong>SSD</strong> : 200 Go </p><br><h4>  Mcs </h4><br><p>  Xeon v4;  Disque dur: r / w: 1500/1000 IOPS;  SSD: r / w: 5000/2000 IOPS </p><p>  Pour tester le <strong>disque dur: CPU</strong> : 2, <strong>RAM</strong> : 4 Go, <strong>disque dur</strong> : 50 Go </p><p>  Pour tester <strong>SSD, TPS</strong> : <strong>CPU</strong> : 8, <strong>RAM</strong> : 16 Go, <strong>SSD</strong> : 600 Go </p><br><h4>  Y </h4><br><p>  Xeon v4, 2 GHz <strong><br></strong> </p><p>  <strong>Processeur</strong> : 8, <strong>RAM</strong> : 8 Go, <strong>disque dur</strong> : 20 Go, <strong>SSD</strong> : 50 Go </p><br><h2>  Comparaison des estimations du TCO pour l'ann√©e </h2><br><p>  Nous avons compt√© le <abbr title="Co√ªt total de possession">TCO</abbr> pour quatre options.  Les valeurs relatives sont indiqu√©es dans le tableau ci-dessous.  Je dois dire que c'est un calcul pour notre cas sp√©cifique et que tout peut se passer diff√©remment pour vous. <br></p><div class="scrollable-table"><table><tbody><tr><th>  Mcs </th><th>  Yc </th><th>  IT Grad </th><th>  Aws </th></tr><tr><td>  1 </td><td>  1,23 </td><td>  1,37 </td><td>  2,28 </td></tr></tbody></table></div><br><p>  Nous avons fait le calcul comme suit.  L'ann√©e a √©t√© divis√©e en deux parties: les sessions (avec une charge de travail accrue) et le reste du temps.  Pour chaque partie, la quantit√© requise de ressources CPU et RAM a √©t√© calcul√©e.  Le volume de disque requis, en raison de la croissance constante du service, ne cro√Æt qu'avec le temps, nous avons donc pris la moyenne entre le d√©but et la fin de l'ann√©e pour l'√©valuation. </p><br><p>  L‚Äô√©valuation avec AWS n‚Äôa gu√®re pos√© de probl√®me, car  il n'y a pas de co√ªt direct pour le noyau et les gigaoctets de m√©moire.  Nous avons pris 3 machines minimales c5.large, r5.large et m5.large et calcul√© leur co√ªt aux prix MCS (en changeant proportionnellement le co√ªt du c≈ìur du processeur, puisque MCS a une fr√©quence de 2 GHz).  Cela s'est av√©r√© comme ceci: en moyenne, le co√ªt des instances AWS simples est 2,5 √† 2,8 fois plus √©lev√© que le co√ªt de MCS.  AWS publie des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prix</a> sans TVA.  Par cons√©quent, pour le co√ªt d'AWS, nous ajoutons 20%, le taux annuel moyen en dollars est de 70 roubles.  Les disques sont consid√©r√©s tout simplement aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prix EBS</a> (nous utilisons diff√©rents types de gp2, sc1, st1).  Dans certains endroits, nous avons besoin de disques NVMe des instances de la famille i3.  Leur prix par gigaoctet est calcul√© tr√®s simplement: la diff√©rence de co√ªt entre i3 et un processeur analogue et une instance de m√©moire de la famille r4, divis√©e par la quantit√© de NVMe.  Il s'av√®re que 3,1 roubles par gigaoctet en 30 jours. </p><br><p>  M√™me dans la conversation sur les budgets, je voudrais noter la diff√©rence de co√ªt d'une licence Windows pour un c≈ìur par mois pour tous les fournisseurs de cloud.  Sur AWS, la diff√©rence entre le co√ªt des instances Linux OnDemand et Windows OnDemand divis√© par le nombre de c≈ìurs est une constante d'environ 2 800 roubles par mois.  En YC, la licence Windows pour le noyau est 3 fois moins ch√®re, environ 900 roubles par mois, et en MCS, presque 9 (!) Fois moins cher, environ 300 roubles par mois.  Nous sommes encore tr√®s d√©pendants de Windows: d√©sormais, gr√¢ce au .net core, nous commen√ßons √† faire de l'anti-plagiat multi-plateforme, notamment pour r√©duire les co√ªts de maintenance. </p><p>  Le co√ªt global de YC comprend √©galement le co√ªt du trafic. </p><br><h2>  Conclusions </h2><br><h3>  √Ä travers les nuages </h3><br><p>  <strong>AWS</strong>  Ils disent qu'en Russie, il existe 4 bons fournisseurs de cloud: AWS, GCP, Azure et DO, et tous ne sont pas en Russie. <br>  <em><u>Avantages:</u></em> excellent service, √©quipements modernes de haute qualit√©, bonnes configurations dans EC2, un grand nombre de services. <br>  <em><u>Inconv√©nients:</u></em> cher (plus les risques de change) et pas en Russie (ILV, le grand pare-feu russe √† l'horizon).  Je veux vraiment que nos nuages ‚Äã‚Äãsuivent cet exemple. <br>  <em><u>Caract√©ristiques:</u></em> Le support technique gratuit peut r√©soudre un minimum de probl√®mes, mais, pour √™tre honn√™te, nous l'avons contact√© uniquement pour √©tendre les limites d'utilisation.  Soit dit en passant, co√ªte environ 10% du compte. </p><br><p>  <strong>IT Grad</strong> .  Bon service pour le cloud d'entreprise.  Il existe des analogues de EC2 et S3 bas√©s sur Swift. <br>  <em><u>Avantages:</u></em> bonnes performances (CPU 1-2-3 GHz, SSD, HDD), √©quipement frais (dans l'un des DC) parmi les clouds domestiques, configurations de machines arbitraires. <br>  <em><u>Inconv√©nients:</u></em> facturation incompr√©hensible, VMware (mal automatis√©, interface flash), un peu de chaos et de gouging dans le support technique. <br>  <em><u>Caract√©ristiques:</u></em> aiguis√© davantage sous une utilisation en entreprise (une fois configur√©, puis changements rares) que sous un syst√®me public tr√®s charg√© (mises √† jour fr√©quentes, changements constants).  Depuis 2019, l'activit√© IaaS a √©t√© vendue avec les personnes et l'√©quipement de MTS, maintenant tout peut changer dans n'importe quelle direction.  Communication via la billetterie et le t√©l√©phone, je souhaiterais une r√©action plus rapide et un message des d√©lais attendus. </p><br><p>  <strong>MCS</strong> .  Il existe des analogues des services EC2 (il existe des GPU), S3, ECS, RDS, EMR, leurs propres services: Machine Learning, Cloud Disaster Recovery, Cloud Backup <br>  <em><u>Avantages:</u></em> peu co√ªteux, en d√©veloppement actif, il existe des GPU (Tesla V100 et Grid K2). <br>  <em><u>Inconv√©nients:</u></em> disques lents, humides, mauvais karma de la soci√©t√© m√®re. <br>  <em><u>Fonctionnalit√©s:</u></em> le support technique au d√©but est utile, un grand nombre d'employ√©s se mettent en marche, l'aide se fait sentir, mais il y a ensuite une baisse d'activit√© notable (ils n'ont rien r√©pondu depuis le 24 d√©cembre, m√™me inquiet pour les gars). </p><br><p>  <strong>YC</strong> .  Nous avons tr√®s peu d'exp√©rience avec ce fournisseur, il est difficile de dire quoi que ce soit de sp√©cifique.  Il existe des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">analogues de</a> EC2, S3, RDS, DS, SQS (alfa), ELB (alfa), leurs services uniques: SpeechKit, Translate. <br>  <em><u>Avantages: Les</u></em> disques sont plus rapides que MCS. <br>  <em><u>Inconv√©nients: le</u></em> fournisseur de terraform est humide;  le logiciel du shell de virtualisation avec api ouverte n'est pas tr√®s important pour la communaut√©, ce qui signifie que jusqu'√† pr√©sent, vous ne pouvez compter que sur les forces de l'√©quipe YC dans le d√©veloppement du fournisseur de terraform. <br>  <em><u>Caract√©ristiques:</u></em> payer pour le trafic. </p><br><br><h3>  Le√ßons apprises </h3><br><ol><li>  Nous avons r√©alis√© que les tests de r√©sistance sont moralement obsol√®tes.  Ils ont mis √† jour le test, trouv√© de nouveaux goulots d'√©tranglement, les ont corrig√©s, ont am√©lior√© le produit.  Nous nous sommes souvenus que le test de charge devrait √™tre ad√©quat et qu'il devrait y avoir des configurations sur lesquelles il ne passe d√©finitivement pas afin que vous puissiez voir la limite de son applicabilit√©. </li><li>  Malgr√© la croyance r√©pandue que les logiciels ne sont pas optimis√©s en ce moment et que tous les goulots d'√©tranglement sont inond√©s de ressources, nous avons d√ª trouver et optimiser notre syst√®me.  Il s'est av√©r√© meilleur qu'il ne l'√©tait, la nouvelle version d'Anti-Plagiat n√©cessite moins de ressources et fonctionne plus rapidement.  D√©j√† d√©crit plusieurs autres endroits o√π vous pouvez r√©duire la consommation de ressources. </li><li>  Nous avons fait l'IaC, le d√©ploiement et la mise √† jour via ansible, avons appris √† passer d'un cloud √† l'autre (avec r√©plication pr√©liminaire des donn√©es) en pr√®s de 10 √† 15 minutes.  Si les donn√©es sont copi√©es et qu'une r√©plication r√©guli√®re est configur√©e, alors voici le plan de reprise apr√®s sinistre: d√©placement en une demi-heure avec perte de donn√©es au cours des 15 derni√®res minutes. </li></ol><br><h3>  Ce que nous voulons des nuages </h3><br><ol><li>  Des r√©ponses rapides du support technique.  Malheureusement, nous ne pouvons pas l'utiliser jusqu'√† pr√©sent dans AWS - il y a trop peu d'informations disponibles. </li><li>  Aide √† l'automatisation du d√©ploiement des infrastructures par le biais de fonds gratuits (terraform). </li><li>  Pr√©visibilit√© des performances.  Cela s'applique √† la facturation, aux performances du processeur, √† la RAM, aux disques. </li><li>  La pr√©sence d'analogues fonctionnels EC2, S3, RDS maintenant.  Dans un avenir proche, nous avons besoin de la prise en charge des k8 et des calculs GPU (nous l'utilisons d√©j√† sur AWS). </li></ol><br><p>  En plus de passer aux nuages, au cours des derniers mois, nous avons r√©ussi √† toucher le r√¢teau dans d'autres domaines.  Comment c'√©tait - nous le dirons un peu plus tard. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr440912/">https://habr.com/ru/post/fr440912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr440902/index.html">La moiti√© du royaume pour l'IA: combien les banques √©conomisent sur l'apprentissage automatique, les r√©seaux de neurones et les robots de discussion</a></li>
<li><a href="../fr440904/index.html">Comparaison des architectures Viper et MVVM: comment appliquer les deux</a></li>
<li><a href="../fr440906/index.html">Webinaire "167-–§–ó. Comment les banques peuvent r√©pondre aux exigences de la Banque centrale en mati√®re de syst√®mes antifraude ¬ª- 26 f√©vrier 2019, 11h00, heure de Moscou</a></li>
<li><a href="../fr440908/index.html">Servez tout</a></li>
<li><a href="../fr440910/index.html">Pourquoi les banques monopolisent-elles la blockchain?</a></li>
<li><a href="../fr440914/index.html">J'ai perdu confiance dans l'industrie, br√ªl√©, mais le culte de l'outil m'a sauv√©</a></li>
<li><a href="../fr440916/index.html">Rayonnement: unit√©s</a></li>
<li><a href="../fr440918/index.html">Security Week 08: piratage de VFEMail en direct</a></li>
<li><a href="../fr440920/index.html">Impl√©mentation de l'interface utilisateur dans iOS: meilleure, plus rapide et √©volutive</a></li>
<li><a href="../fr440922/index.html">Fonctionnement de Level Flow dans Uncharted 4 et The Last Of Us</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>