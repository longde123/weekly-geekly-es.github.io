<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯТЫ ЁЯЪ╝ ЁЯП║ рдПрдХрддрд╛ рдореЗрдВ рд╖рдЯреНрдХреЛрдг рдорд╛рдирдЪрд┐рддреНрд░: рдпреБрджреНрдз рдХрд╛ рдХреЛрд╣рд░рд╛, рдорд╛рдирдЪрд┐рддреНрд░ рдЕрдиреБрд╕рдВрдзрд╛рди, рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рдкреАрдврд╝реА ЁЯФп ЁЯеД ЁЯТ╖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рднрд╛рдЧ 1-3: рдЬрд╛рд▓, рд░рдВрдЧ рдФрд░ рд╕реЗрд▓ рдКрдБрдЪрд╛рдИ 

 рднрд╛рдЧ 4-7: рдзрдХреНрдХреЛрдВ, рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ 

 рднрд╛рдЧ 8-11: рдЬрд▓, рднреВ-рднрд╛рдЧ рдФрд░ рдкреНрд░рд╛рдЪреАрд░ 

 рднрд╛рдЧ 12-15: рдмрдЪрдд рдФрд░ рд▓реЛрдбрд┐рдВрдЧ, рдмрдирд╛рд╡рдЯ, рджреВрд░рд┐рдпрд╛рдВ 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдПрдХрддрд╛ рдореЗрдВ рд╖рдЯреНрдХреЛрдг рдорд╛рдирдЪрд┐рддреНрд░: рдпреБрджреНрдз рдХрд╛ рдХреЛрд╣рд░рд╛, рдорд╛рдирдЪрд┐рддреНрд░ рдЕрдиреБрд╕рдВрдзрд╛рди, рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рдкреАрдврд╝реА</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427003/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 1-3: рдЬрд╛рд▓, рд░рдВрдЧ рдФрд░ рд╕реЗрд▓ рдКрдБрдЪрд╛рдИ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 4-7: рдзрдХреНрдХреЛрдВ, рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 8-11: рдЬрд▓, рднреВ-рднрд╛рдЧ рдФрд░ рдкреНрд░рд╛рдЪреАрд░</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 12-15: рдмрдЪрдд рдФрд░ рд▓реЛрдбрд┐рдВрдЧ, рдмрдирд╛рд╡рдЯ, рджреВрд░рд┐рдпрд╛рдВ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 16-19: рд░рд╛рд╕реНрддрд╛ рдЦреЛрдЬрдирд╛, рдЦрд┐рд▓рд╛рдбрд╝реА рджрд╕реНрддреЗ, рдПрдирд┐рдореЗрд╢рди</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 20-23: рдХреЛрд╣рд░реЗ рдХреЗ рдпреБрджреНрдз, рдорд╛рдирдЪрд┐рддреНрд░ рдЕрдиреБрд╕рдВрдзрд╛рди, рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рдкреАрдврд╝реА</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 24-27: рдЬрд▓ рдЪрдХреНрд░, рдЕрдкрд░рджрди, рдмрд╛рдпреЛрдо, рдмреЗрд▓рдирд╛рдХрд╛рд░ рдирдХреНрд╢рд╛</a> <br><br><h1>  рднрд╛рдЧ 20: рдпреБрджреНрдз рдХрд╛ рдХреЛрд╣рд░рд╛ </h1><br><ul><li>  рдмрдирд╛рд╡рдЯ рдореЗрдВ рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХреЛ рд╕рд╣реЗрдЬреЗрдВред </li><li>  рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рдХреЗ рдмрд┐рдирд╛ рд░рд╛рд╣рдд рдкреНрд░рдХрд╛рд░ рдмрджрд▓реЗрдВред </li><li>  рд╣рдо рджреГрд╢реНрдпрддрд╛ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рддреЗ рд╣реИрдВред </li><li>  рдЕрджреГрд╢реНрдп рд╕рдм рдХреБрдЫ рдЕрдВрдзреЗрд░рд╛ред </li></ul><br>  рдЗрд╕ рднрд╛рдЧ рдореЗрдВ, рд╣рдо рдпреБрджреНрдз рдкреНрд░рднрд╛рд╡ рдХреЗ рдХреЛрд╣рд░реЗ рдХреЛ рдорд╛рдирдЪрд┐рддреНрд░ рдореЗрдВ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред <br><br>  рдЕрдм рд╢реНрд░реГрдВрдЦрд▓рд╛ рдПрдХрддрд╛ 2017.1.0 рдкрд░ рдмрдирд╛рдИ рдЬрд╛рдПрдЧреАред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/716/b6b/8a9/716b6b8a9d024dc87b2d645b5d4bdbb6.jpg"></div><br>  <i>рдЕрдм рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдирд╣реАрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред</i> <br><a name="habracut"></a><br><h2>  рд╕реЗрд▓ рдбреЗрдЯрд╛ Shader рдореЗрдВ </h2><br>  рдХрдИ рд░рдгрдиреАрддрд┐ рдЦреЗрд▓ рдпреБрджреНрдз рдЕрд╡рдзрд╛рд░рдгрд╛ рдХреЗ рдХреЛрд╣рд░реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЦрд┐рд▓рд╛рдбрд╝реА рдХреА рджреГрд╖реНрдЯрд┐ рд╕реАрдорд┐рдд рд╣реИред  рд╡рд╣ рдХреЗрд╡рд▓ рд╡рд╣реА рджреЗрдЦ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЙрд╕рдХреА рдЗрдХрд╛рдЗрдпреЛрдВ рдпрд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХреНрд╖реЗрддреНрд░ рдХреЗ рдХрд░реАрдм рд╣реИред  рд╣рд╛рд▓рд╛рдБрдХрд┐ рд╣рдо рд░рд╛рд╣рдд рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдо рдпрд╣ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рдХрд┐ рд╡рд╣рд╛рдБ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИред  рдЖрдорддреМрд░ рдкрд░ рдЕрджреГрд╢реНрдп рдЗрд▓рд╛рдХреЗ рдХреЛ рдЧрд╣рд░рд╛ рд░рдВрдЧ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕реЗ рдорд╣рд╕реВрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд╕реЗрд▓ рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЙрд╕рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЗрд╕реЗ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред <br><br>  рдЫрд┐рдкреА рд╣реБрдИ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЛ рдмрджрд▓рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рд╕рд░рд▓ рддрд░реАрдХрд╛ рдореЗрд╖ рдбреЗрдЯрд╛ рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рдореАрдЯреНрд░рд┐рдХ рдЬреЛрдбрд╝рдирд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЙрд╕реА рд╕рдордп, рджреГрд╢реНрдпрддрд╛ рдореЗрдВ рдмрджрд▓рд╛рд╡ рд╣реЛрдиреЗ рдкрд░ рд╣рдореЗрдВ рдПрдХ рдирдИ рд░рд╛рд╣рдд рддреНрд░рд┐рднреБрдЬ рд▓реЙрдиреНрдЪ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдпрд╣ рдПрдХ рдмреБрд░рд╛ рдирд┐рд░реНрдгрдп рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЦреЗрд▓ рдХреЗ рджреМрд░рд╛рди рджреГрд╢реНрдпрддрд╛ рд▓рдЧрд╛рддрд╛рд░ рдмрджрд▓ рд░рд╣реА рд╣реИред <br><br>  рдкрд╛рд░рднрд╛рд╕реА рд╕рддрд╣ рдХреА рд╕реНрдерд▓рд╛рдХреГрддрд┐ рдкрд░ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреА рддрдХрдиреАрдХ рдХрд╛ рдЕрдХреНрд╕рд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдореБрдЦреМрдЯреЗ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЦрд┐рд▓рд╛рдбрд╝реА рдХреЗ рд▓рд┐рдП рдЕрджреГрд╢реНрдп рдХрд░ рджреЗрддрд╛ рд╣реИред  рдпрд╣ рд╡рд┐рдзрд┐ рдПрдХ рд╕реАрдорд┐рдд рджреЗрдЦрдиреЗ рдХреЗ рдХреЛрдг рдХреЗ рд╕рд╛рде рд╕рдВрдпреЛрдЬрди рдореЗрдВ рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рд╕рдкрд╛рдЯ рдЗрд▓рд╛рдХреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИред  рд▓реЗрдХрд┐рди рдЪреВрдБрдХрд┐ рд╣рдорд╛рд░реЗ рдЗрд▓рд╛рдХреЗ рдореЗрдВ рдмрд╣реБрдд рдЕрд▓рдЧ-рдЕрд▓рдЧ рдКрдБрдЪрд╛рдЗрдпрд╛рдБ рдФрд░ рд╡рд╕реНрддреБрдПрдБ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╡рд┐рднрд┐рдиреНрди рдХреЛрдгреЛрдВ рд╕реЗ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдПрдХ рдЕрддреНрдпрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬреЛ рдЗрд▓рд╛рдХреЗ рдХреЗ рдЖрдХрд╛рд░ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реЛред  рдпрд╣ рд╡рд┐рдзрд┐ рдКрдкрд░ рдмрддрд╛рдП рдЧрдП рд╕рд░рд▓рддрдо рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рдЕрдзрд┐рдХ рдорд╣рдВрдЧреА рд╣реЛрдЧреАред <br><br>  рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд░рд╛рд╣рдд рдЬрд╛рд▓ рд╕реЗ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░рддрд┐рдкрд╛рджрди рдХрд░рддреЗ рд╕рдордп рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рд╢реЗрдбрд░ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПред  рдпрд╣ рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред  рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХреЛ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд▓рд╛рдХреЗ рдХреЛ рддреНрд░рд┐рдХреЛрдгреАрдп рдмрдирд╛рдиреЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрдирд╛рд╡рдЯ рдХреЛ рдмрджрд▓рдирд╛ рдмрд╣реБрдд рд╕рд░рд▓ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХрдИ рдЕрддрд┐рд░рд┐рдХреНрдд рдмрдирд╛рд╡рдЯ рдХреЗ рдирдореВрдиреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдПрдХ рдПрдХрд▓ рдкрд╛рд░рднрд╛рд╕реА рдкрд░рдд рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рддреЗрдЬрд╝ рд╣реИред <br><br><div class="spoiler">  <b class="spoiler_title">Shader рд╕рд░рдгрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?</b> <div class="spoiler_text">  рдЖрдк рд╡реИрдХреНрдЯрд░ рдХреА рдПрдХ рд╕рд░рдгреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХреЛ shader рдореЗрдВ рднреА рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдБрдХрд┐, shader рд╕рд░рдгрд┐рдпреЛрдВ рдХреА рдПрдХ рдЖрдХрд╛рд░ рд╕реАрдорд╛ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕реЗ рд╣рдЬрд╛рд░реЛрдВ рдмрд╛рдЗрдЯреНрд╕ рдореЗрдВ рдорд╛рдкрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдмрдирд╛рд╡рдЯ рдореЗрдВ рд▓рд╛рдЦреЛрдВ рдкрд┐рдХреНрд╕реЗрд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдмрдбрд╝реЗ рдорд╛рдирдЪрд┐рддреНрд░реЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред </div></div><br><h3>  рд╕реЗрд▓ рдбреЗрдЯрд╛ рдкреНрд░рдмрдВрдзрди </h3><br>  рд╣рдореЗрдВ рд╕реЗрд▓ рдбреЗрдЯрд╛ рдпреБрдХреНрдд рдмрдирд╛рд╡рдЯ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рддрд░реАрдХрд╛ рдЪрд╛рд╣рд┐рдПред  рдЪрд▓реЛ рдПрдХ рдирдпрд╛ <code>HexCellShaderData</code> рдШрдЯрдХ <code>HexCellShaderData</code> рд╣реИрдВ рдЬреЛ рдРрд╕рд╛ рдХрд░реЗрдЧрд╛ред <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexCellShaderData</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { Texture2D cellTexture; }</code> </pre> <br>  рдирдпрд╛ рдирдХреНрд╢рд╛ рдмрдирд╛рддреЗ рдпрд╛ рд▓реЛрдб рдХрд░рддреЗ рд╕рдордп, рд╣рдореЗрдВ рд╕рд╣реА рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде рдПрдХ рдирдИ рдмрдирд╛рд╡рдЯ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдПрдХ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдореЗрдердб рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдЬреЛ рдЗрд╕рдХреА рдмрдирд╛рд╡рдЯ рдмрдирд╛рддрд╛ рд╣реИред  рд╣рдо рдПрдордЖрдИрдкреАрдП рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдордЖрдИрдкреА рдмрдирд╛рд╡рдЯ рдФрд░ рд░реИрдЦрд┐рдХ рд░рдВрдЧ рдХреЗ рд╕реНрдерд╛рди рдХреЗ рдмрд┐рдирд╛ рдХрд░рддреЗ рд╣реИрдВред  рд╣рдореЗрдВ рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХреЛ рдорд┐рдХреНрд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдкреЙрдЗрдВрдЯ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдбреЗрдЯрд╛ рдХреЛ рдзреНрд╡рд╕реНрдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдмрдирд╛рд╡рдЯ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдкрд┐рдХреНрд╕реЗрд▓ рдореЗрдВ рдПрдХ рд╕реЗрд▓ рд╕реЗ рдбреЗрдЯрд╛ рд╣реЛрдЧрд╛ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { cellTexture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D( x, z, TextureFormat.RGBA32, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> ); cellTexture.filterMode = FilterMode.Point; cellTexture.wrapMode = TextureWrapMode.Clamp; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рдХреНрдпрд╛ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЖрдХрд╛рд░ рдирдХреНрд╢реЗ рдХреЗ рдЖрдХрд╛рд░ рд╕реЗ рдореЗрд▓ рдЦрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП?</b> <div class="spoiler_text">  рдирд╣реАрдВ, рдмрд╕ рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдкрд┐рдХреНрд╕реЗрд▓ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдорд╛рдирдЪрд┐рддреНрд░ рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рд╕рдЯреАрдХ рдорд┐рд▓рд╛рди рдХреЗ рд╕рд╛рде, рдПрдХ рдРрд╕реА рдмрдирд╛рд╡рдЯ рдЬрд┐рд╕рдХреЗ рдЖрдХрд╛рд░ рджреЛ (рдЧреИрд░-рд╢рдХреНрддрд┐-рджреЛ, рдПрдирдкреАрдУрдЯреА) рдХреА рд╢рдХреНрддрд┐рдпрд╛рдВ рдирд╣реАрдВ рд╣реИрдВ, рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рдмрдирд╛рдИ рдЬрд╛рдПрдЧреА, рдФрд░ рдпрд╣ рдмрдирд╛рд╡рдЯ рдкреНрд░рд╛рд░реВрдк рд╕рдмрд╕реЗ рдкреНрд░рднрд╛рд╡реА рдирд╣реАрдВ рд╣реИред  рдпрджреНрдпрдкрд┐ рд╣рдо рдмрдирд╛рд╡рдЯ рдХреЛ рджреЛ рдХреА рд╢рдХреНрддрд┐ рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рдПрдХ рдорд╛рдореВрд▓реА рдЕрдиреБрдХреВрд▓рди рд╣реИ, рдЬреЛ рд╕реЗрд▓ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдЬрдЯрд┐рд▓ рдХрд░рддрд╛ рд╣реИред </div></div><br>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдореЗрдВ рд╣рд░ рдмрд╛рд░ рдПрдХ рдирдпрд╛ рдирдХреНрд╢рд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдИ рдмрдирд╛рд╡рдЯ рдирд╣реАрдВ рдмрдирд╛рдиреА рдкрдбрд╝рддреАред  рдпрд╣ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЖрдХрд╛рд░ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ рдЕрдЧрд░ рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИред  рд╣рдореЗрдВ рдпрд╣ рднреА рдЬрд╛рдБрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рд╣реА рдЖрдХрд╛рд░ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ <code>Texture2D.Resize</code> рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╕реНрдорд╛рд░реНрдЯ рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cellTexture) { cellTexture.Resize(x, z); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cellTexture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D( cellCountX, cellCountZ, TextureFormat.RGBA32, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> ); cellTexture.filterMode = FilterMode.Point; cellTexture.wrapMode = TextureWrapMode.Clamp; } }</code> </pre> <br>  рдПрдХ рд╕рдордп рдореЗрдВ рд╕реЗрд▓ рдбреЗрдЯрд╛ рдПрдХ рдкрд┐рдХреНрд╕реЗрд▓ рд▓рдЧрд╛рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдПрдХ рд░рдВрдЧреАрди рдмрдлрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдмрд╛рд░ рдореЗрдВ рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо <code>Color32</code> рд╕рд░рдгреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рд╣рдо <code>Initialize</code> рдХреЗ рдЕрдВрдд рдореЗрдВ рдПрдХ рдирдпрд╛ рд╕рд░рдгреА рдЙрджрд╛рд╣рд░рдг рдмрдирд╛рдПрдВрдЧреЗред  рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рд╣реА рдЖрдХрд╛рд░ рдХреА рдПрдХ рд╕рд░рдгреА рд╣реИред  рддрдм рд╣рдо рдЗрд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╕рд╛рдл рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> Texture2D cellTexture; Color32[] cellTextureData; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cellTextureData == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || cellTextureData.Length != x * z) { cellTextureData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color32[x * z]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellTextureData.Length; i++) { cellTextureData[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color32(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рд░рдВрдЧ 32 рдХреНрдпрд╛ рд╣реИ?</b> <div class="spoiler_text">  рдорд╛рдирдХ рдЕрд╕рдореНрдмрджреНрдз RGBA рдмрдирд╛рд╡рдЯ рдореЗрдВ рдЪрд╛рд░-рдмрд╛рдЗрдЯ рдкрд┐рдХреНрд╕реЗрд▓ рд╣реЛрддреЗ рд╣реИрдВред  рдЪрд╛рд░ рд░рдВрдЧ рдЪреИрдирд▓реЛрдВ рдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЛ рдПрдХ рдмрд╛рдЗрдЯ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рдд, рдЙрдирдХреЗ рдкрд╛рд╕ 256 рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рди рд╣реИрдВред  рдпреВрдирд┐рдЯреА <code>Color</code> рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдЕрдВрддрд░рд╛рд▓ 0-1 рдореЗрдВ рдЗрд╕рдХреЗ рдлреНрд▓реЛрдЯрд┐рдВрдЧ-рдкреЙрдЗрдВрдЯ рдШрдЯрдХ 0255 рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ рдмрд╛рдЗрдЯреНрд╕ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред  рд╕реИрдВрдкрд▓ рд▓реЗрддреЗ рд╕рдордп, GPU рд╡реНрдпреБрддреНрдХреНрд░рдо рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдо рдХрд░рддрд╛ рд╣реИред <br><br>  <code>Color32</code> рд╕рдВрд░рдЪрдирд╛ рд╕реАрдзреЗ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡реЗ рдХрдо рдЬрдЧрд╣ рд▓реЗрддреЗ рд╣реИрдВ рдФрд░ рд░реВрдкрд╛рдВрддрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрдирдХреЗ рдЙрдкрдпреЛрдЧ рдХреА рджрдХреНрд╖рддрд╛ рдмрдврд╝ рдЬрд╛рддреА рд╣реИред  рдЪреВрдВрдХрд┐ рд╣рдо рд░рдВрдЧреЛрдВ рдХреЗ рдмрдЬрд╛рдп рд╕реЗрд▓ рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдХрдЪреНрдЪреЗ рдмрдирд╛рд╡рдЯ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рд╕реАрдзреЗ рдХрд╛рдо рдХрд░рдирд╛ рдЕрдзрд┐рдХ рддрд░реНрдХрд╕рдВрдЧрдд рд╣реЛрдЧрд╛, рдФрд░ <code>Color</code> рд╕рд╛рде рдирд╣реАрдВред </div></div><br>  <code>HexGrid</code> рдХреЛ <code>HexGrid</code> рдореЗрдВ рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдЖрд░рдВрднреАрдХрд░рдг рд╕реЗ <code>HexGrid</code> рдЪрд╛рд╣рд┐рдПред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЗрд╕рдореЗрдВ <code>cellShaderData</code> рдлрд╝реАрд▓реНрдб <code>cellShaderData</code> рдФрд░ <code>cellShaderData</code> рдЕрдВрджрд░ рдПрдХ рдШрдЯрдХ рдмрдирд╛рдПрдВрдЧреЗред <br><br><pre> <code class="cs hljs"> HexCellShaderData cellShaderData; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; HexMetrics.InitializeHashGrid(seed); HexUnit.unitPrefab = unitPrefab; cellShaderData = gameObject.AddComponent&lt;HexCellShaderData&gt;(); CreateMap(cellCountX, cellCountZ); }</code> </pre> <br>  рдПрдХ рдирдпрд╛ рдирдХреНрд╢рд╛ рдмрдирд╛рддреЗ рд╕рдордп, <code>cellShaderData</code> рдХреЛ рднреА <code>cellShaderData</code> рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { тАж cellCountX = x; cellCountZ = z; chunkCountX = cellCountX / HexMetrics.chunkSizeX; chunkCountZ = cellCountZ / HexMetrics.chunkSizeZ; cellShaderData.Initialize(cellCountX, cellCountZ); CreateChunks(); CreateCells(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><h3>  рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХрд╛ рд╕рдВрдкрд╛рджрди </h3><br>  рдЕрдм рддрдХ, рд╕реЗрд▓ рдХреЗ рдЧреБрдгреЛрдВ рдХреЛ рдмрджрд▓рддреЗ рд╕рдордп, рдПрдХ рдпрд╛ рдХрдИ рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдерд╛, рд▓реЗрдХрд┐рди рдЕрдм рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рд╕реЗрд▓рд░реНрд╕ рдХреЗ рдкрд╛рд╕ рд╢реИрдбрд░ рдореЗрдВ рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХрд╛ рд▓рд┐рдВрдХ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, <code>HexCell</code> рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдЬреЛрдбрд╝реЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexCellShaderData ShaderData { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br>  <code>HexGrid.CreateCell</code> рд╣рдо рдЗрд╕ рд╕рдВрдкрддреНрддрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ shader рдбреЗрдЯрд╛ рдШрдЯрдХ рдЕрд╕рд╛рдЗрди <code>HexGrid.CreateCell</code> ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { тАж HexCell cell = cells[i] = Instantiate&lt;HexCell&gt;(cellPrefab); cell.transform.localPosition = position; cell.coordinates = HexCoordinates.FromOffsetCoordinates(x, z); cell.ShaderData = cellShaderData; тАж }</code> </pre> <br>  рдЕрдм рд╣рдо рдЕрдкрдиреЗ shader рдбреЗрдЯрд╛ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЬрдмрдХрд┐ рд╣рдо рджреГрд╢реНрдпрддрд╛ рдкрд░ рдирдЬрд╝рд░ рдирд╣реАрдВ рд░рдЦ рд░рд╣реЗ рд╣реИрдВ, рд╣рдо рдХрд┐рд╕реА рдЕрдиреНрдп рдЪреАрдЬрд╝ рдХреЗ рд▓рд┐рдП shader рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╕реЗрд▓ рдХрд╛ рд░рд╛рд╣рдд рдкреНрд░рдХрд╛рд░ рдЗрд╕реЗ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдмрдирд╛рд╡рдЯ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рд╕реЗрд▓ рдХреА рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рд╕реЗрд▓ рдбреЗрдЯрд╛ рдореЗрдВ рдПрд▓рд┐рд╡реЗрд╢рди рдЯрд╛рдЗрдк рдЗрдВрдбреЗрдХреНрд╕ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рди рдХрд┐ рдореЗрд╖ рдбреЗрдЯрд╛ рдореЗрдВред  рдпрд╣ рд╣рдореЗрдВ рд╕реЗрд▓ рдХреА рд░рд╛рд╣рдд рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рдмрджрд▓рдиреЗ рдкрд░ рддреНрд░рд┐рднреБрдЬ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред <br><br>  рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реЗрд▓ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдХрд╛рд░реНрдп рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП <code>RefreshTerrain</code> рдПрдХ <code>HexCellShaderData</code> рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝реЗрдВред  рдЪрд▓рд┐рдП рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рдЕрднреА рдХреЗ рд▓рд┐рдП рдЦрд╛рд▓реА рдЫреЛрдбрд╝ рджреЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br>  <code>HexCell.TerrainTypeIndex</code> рдмрджрд▓реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХрд╛ рдЖрджреЗрд╢ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TerrainTypeIndex { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> terrainTypeIndex; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (terrainTypeIndex != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { terrainTypeIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Refresh(); ShaderData.RefreshTerrain(this); } } }</span></span></code> </pre> <br>  рд╣рдо рдЗрд╕реЗ рд╕реЗрд▓ рдЯреЙрдкреЛрдЧреНрд░рд╛рдлреА рдкреНрд░рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж <code>HexCell.Load</code> рдореЗрдВ рднреА рдХрд╣реЗрдВрдЧреЗред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader</span></span></span><span class="hljs-function">)</span></span> { terrainTypeIndex = reader.ReadByte(); ShaderData.RefreshTerrain(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); elevation = reader.ReadByte(); RefreshPosition(); тАж }</code> </pre> <br><h3>  рд╕реЗрд▓ рдЗрдВрдбреЗрдХреНрд╕ </h3><br>  рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ <code>HexCell</code> рдореЗрдВ <code>Index</code> рдкреНрд░реЙрдкрд░реНрдЯреА рдХреЛ <code>HexCell</code> ред  рдпрд╣ рдорд╛рдирдЪрд┐рддреНрд░ рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд╕реВрдЪреА рдореЗрдВ рд╕реЗрд▓ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдЧрд╛, рдЬреЛ рд╢реЗрдбрд░ рдореЗрдВ рджреА рдЧрдИ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЗрд╕рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреА рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Index { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br>  рдпрд╣ рд╕реВрдЪрдХрд╛рдВрдХ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА <code>HexGrid.CreateCell</code> , рдЗрд╕рд▓рд┐рдП рдмрд╕ рдЗрд╕реЗ рдмрдирд╛рдП рдЧрдП рд╕реЗрд▓ рдореЗрдВ рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { тАж cell.coordinates = HexCoordinates.FromOffsetCoordinates(x, z); cell.Index = i; cell.ShaderData = cellShaderData; тАж }</code> </pre> <br>  рдЕрдм <code>HexCellShaderData.RefreshTerrain</code> рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдЗрдВрдбреЗрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдЖрдЗрдП рдЕрдкрдиреЗ рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рдЕрд▓реНрдлрд╛ рдШрдЯрдХ рдореЗрдВ рдЙрдиреНрдирдпрди рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рдХреЗрд╡рд▓ рдмрд╛рдЗрдЯ рдХреЗ рдкреНрд░рдХрд╛рд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдХреЗ рд╕рд╣реЗрдЬреЗрдВред  рдпрд╣ 256 рдкреНрд░рдХрд╛рд░ рдХреЗ рдЗрд▓рд╛рдХреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдЧрд╛, рдЬреЛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cellTextureData[cell.Index].a = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)cell.TerrainTypeIndex; }</code> </pre> <br>  рдПрдХ рдмрдирд╛рд╡рдЯ рдореЗрдВ рдбреЗрдЯрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдФрд░ рдЗрд╕реЗ GPU рдореЗрдВ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ <code>Texture2D.SetPixels32</code> рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж <code>Texture2D.Apply</code> рдкрд░ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдЦрдВрдбреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо <code>LateUpdate</code> рдкрд░ рдЗрди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реНрдердЧрд┐рдд рдХрд░ рджреЗрдВрдЧреЗ рддрд╛рдХрд┐ рд╡реЗ рдмрджрд▓реЗ рд╣реБрдП рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛ рдлреНрд░реЗрдо рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдПрдХ рдмрд╛рд░ рд╕реЗ рдЕрдзрд┐рдХ рдмрд╛рд░ рдкреНрд░рджрд░реНрд╢рди рди рдХрд░ рд╕рдХреЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cellTextureData[cell.Index].a = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)cell.TerrainTypeIndex; enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LateUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { cellTexture.SetPixels32(cellTextureData); cellTexture.Apply(); enabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдирдпрд╛ рдорд╛рдирдЪрд┐рддреНрд░ рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж рдбреЗрдЯрд╛ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдкреНрд░рд╛рд░рдВрдн рдХреЗ рдмрд╛рдж рдШрдЯрдХ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { тАж enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><h3>  рд╕реЗрд▓ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХрд╛ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди </h3><br>  рдЪреВрдВрдХрд┐ рдЕрдм рд╣рдо рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдЙрдиреНрдирдпрди рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЕрдм рдЙрдиреНрд╣реЗрдВ рддреНрд░рд┐рднреБрдЬ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рд▓реЗрдХрд┐рди рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, shader рдХреЛ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХрд┐рд╕ рдЗрдВрдбреЗрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдЖрдкрдХреЛ рдКрдВрдЪрд╛рдИ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреА рдЬрдЧрд╣, рдЬрд╛рд▓ рдбреЗрдЯрд╛ рдореЗрдВ рд╕реЗрд▓ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рдЕрднреА рднреА рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдорд┐рд╢реНрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореЗрд╖ рдХреЗ рд░рдВрдЧ рдЪреИрдирд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рд╣рдо <code>useTerrainTypes</code> рдЕрдкреНрд░рдЪрд▓рд┐рдд рдЖрдо рдлрд╝реАрд▓реНрдб <code>useColors</code> рдФрд░ <code>useTerrainTypes</code> ред  рдЙрдиреНрд╣реЗрдВ рдПрдХ <code>useCellData</code> рд╕рд╛рде рдмрджрд▓реЗрдВред <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public bool useCollider, useColors, useUVCoordinates, useUV2Coordinates; // public bool useTerrainTypes; public bool useCollider, useCellData, useUVCoordinates, useUV2Coordinates;</span></span></code> </pre><br>  рд╣рдо <code>cellIndices</code> рд╕реВрдЪреА рдХрд╛ рдирд╛рдо рдмрджрд▓рдХрд░ <code>cellIndices</code> рдХрд░рдиреЗ рдХрд╛ <code>cellIndices</code> ред  рдЪрд▓реЛ <code>cellWeights</code> - <code>cellWeights</code> рдХреЛ <code>cellWeights</code> -рд░реАрдиреЗрдо рдирд╛рдо рднреА рджреЗрдВ - рдпрд╣ рдирд╛рдо рдмреЗрд╣рддрд░ рдХрд░реЗрдЧрд╛ред <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// [NonSerialized] List&lt;Vector3&gt; vertices, terrainTypes; // [NonSerialized] List&lt;Color&gt; colors; [NonSerialized] List&lt;Vector3&gt; vertices, cellIndices; [NonSerialized] List&lt;Color&gt; cellWeights; [NonSerialized] List&lt;Vector2&gt; uvs, uv2s; [NonSerialized] List&lt;int&gt; triangles;</span></span></code> </pre><br>  рдЪреЗрдВрдЬ <code>Clear</code> рддрд╛рдХрд┐ рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдЗрд╕реЗ рджреЛ рд╕реВрдЪрд┐рдпрд╛рдБ рдПрдХ рд╕рд╛рде рдорд┐рд▓реЗрдВ, рдФрд░ рдЕрд▓рдЧ рд╕реЗ рдирд╣реАрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.Clear(); vertices = ListPool&lt;Vector3&gt;.Get(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useCellData) { cellWeights = ListPool&lt;Color&gt;.Get(); cellIndices = ListPool&lt;Vector3&gt;.Get(); } <span class="hljs-comment"><span class="hljs-comment">// if (useColors) { // colors = ListPool&lt;Color&gt;.Get(); // } if (useUVCoordinates) { uvs = ListPool&lt;Vector2&gt;.Get(); } if (useUV2Coordinates) { uv2s = ListPool&lt;Vector2&gt;.Get(); } // if (useTerrainTypes) { // terrainTypes = ListPool&lt;Vector3&gt;.Get(); // } triangles = ListPool&lt;int&gt;.Get(); }</span></span></code> </pre> <br>  рдЕрдкреНрд▓рд╛рдИ рдореЗрдВ рдПрдХ рд╣реА рдЧреНрд░реБрдкрд┐рдВрдЧ <code>Apply</code> ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hexMesh.SetVertices(vertices); ListPool&lt;Vector3&gt;.Add(vertices); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useCellData) { hexMesh.SetColors(cellWeights); ListPool&lt;Color&gt;.Add(cellWeights); hexMesh.SetUVs(<span class="hljs-number"><span class="hljs-number">2</span></span>, cellIndices); ListPool&lt;Vector3&gt;.Add(cellIndices); } <span class="hljs-comment"><span class="hljs-comment">// if (useColors) { // hexMesh.SetColors(colors); // ListPool&lt;Color&gt;.Add(colors); // } if (useUVCoordinates) { hexMesh.SetUVs(0, uvs); ListPool&lt;Vector2&gt;.Add(uvs); } if (useUV2Coordinates) { hexMesh.SetUVs(1, uv2s); ListPool&lt;Vector2&gt;.Add(uv2s); } // if (useTerrainTypes) { // hexMesh.SetUVs(2, terrainTypes); // ListPool&lt;Vector3&gt;.Add(terrainTypes); // } hexMesh.SetTriangles(triangles, 0); ListPool&lt;int&gt;.Add(triangles); hexMesh.RecalculateNormals(); if (useCollider) { meshCollider.sharedMesh = hexMesh; } }</span></span></code> </pre> <br>  рд╕рднреА <code>AddTriangleColor</code> рдФрд░ <code>AddTriangleTerrainTypes</code> рд╣рдЯрд╛ рджреЗрдВред  рдЙрдиреНрд╣реЗрдВ рдЙрдкрдпреБрдХреНрдд <code>AddTriangleCellData</code> рд╡рд┐рдзрд┐рдпреЛрдВ рд╕реЗ рдмрджрд▓реЗрдВ, рдЬреЛ рдПрдХ рд╕рдордп рдореЗрдВ рдЕрдиреБрдХреНрд░рдорд┐рдд рдФрд░ рднрд╛рд░ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangleCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 indices, Color weights1, Color weights2, Color weights3 </span></span></span><span class="hljs-function">)</span></span> { cellIndices.Add(indices); cellIndices.Add(indices); cellIndices.Add(indices); cellWeights.Add(weights1); cellWeights.Add(weights2); cellWeights.Add(weights3); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangleCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 indices, Color weights</span></span></span><span class="hljs-function">)</span></span> { AddTriangleCellData(indices, weights, weights, weights); }</code> </pre> <br>  рдЙрдкрдпреБрдХреНрдд <code>AddQuad</code> рд╡рд┐рдзрд┐ рдореЗрдВ рд╣реА рдХрд░реЗрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 indices, Color weights1, Color weights2, Color weights3, Color weights4 </span></span></span><span class="hljs-function">)</span></span> { cellIndices.Add(indices); cellIndices.Add(indices); cellIndices.Add(indices); cellIndices.Add(indices); cellWeights.Add(weights1); cellWeights.Add(weights2); cellWeights.Add(weights3); cellWeights.Add(weights4); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 indices, Color weights1, Color weights2 </span></span></span><span class="hljs-function">)</span></span> { AddQuadCellData(indices, weights1, weights1, weights2, weights2); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 indices, Color weights</span></span></span><span class="hljs-function">)</span></span> { AddQuadCellData(indices, weights, weights, weights, weights); }</code> </pre> <br><h3>  HexGridChunk рд░рд┐рдлреИрдХреНрдЯрд┐рдВрдЧ </h3><br>  рдЗрд╕ рд╕реНрддрд░ рдкрд░, рд╣рдореЗрдВ <code>HexGridChunk</code> рдореЗрдВ рдмрд╣реБрдд рдЕрдзрд┐рдХ рдХрдВрдкрд╛рдЗрд▓рд░ рддреНрд░реБрдЯрд┐рдпрд╛рдВ <code>HexGridChunk</code> рдЬрд┐рдиреНрд╣реЗрдВ <code>HexGridChunk</code> рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╕реНрдерд┐рд░рддрд╛ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╡рдЬрди рдХреЗ рд▓рд┐рдП рд╕реНрдерд┐рд░ рд░рдВрдЧреЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рд░рдВрдЧрддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Color weights1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Color weights2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Color weights3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br>  рдЪрд▓рд┐рдП <code>TriangulateEdgeFan</code> рдХреЛ рдареАрдХ рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рдЙрд╕реЗ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА, рд▓реЗрдХрд┐рди рдЕрдм рдЙрд╕реЗ рдПрдХ рд╕реЗрд▓ рдЗрдВрдбреЗрдХреНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  <code>AddTriangleTerrainTypes</code> рдХреЛрдб рдХреЗ рд╕рд╛рде <code>AddTriangleColor</code> рдФрд░ <code>AddTriangleTerrainTypes</code> рдХреЛрдб рдХреЛ <code>AddTriangleColor</code> ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeFan</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 center, EdgeVertices edge, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span> { terrain.AddTriangle(center, edge.v1, edge.v2); terrain.AddTriangle(center, edge.v2, edge.v3); terrain.AddTriangle(center, edge.v3, edge.v4); terrain.AddTriangle(center, edge.v4, edge.v5); Vector3 indices; indices.x = indices.y = indices.z = index; terrain.AddTriangleCellData(indices, weights1); terrain.AddTriangleCellData(indices, weights1); terrain.AddTriangleCellData(indices, weights1); terrain.AddTriangleCellData(indices, weights1); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights1); // terrain.AddTriangleColor(weights1); // terrain.AddTriangleColor(weights1); // terrain.AddTriangleColor(weights1); // Vector3 types; // types.x = types.y = types.z = type; // terrain.AddTriangleTerrainTypes(types); // terrain.AddTriangleTerrainTypes(types); // terrain.AddTriangleTerrainTypes(types); // terrain.AddTriangleTerrainTypes(types); }</span></span></code> </pre> <br>  рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рдХрдИ рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЖрдЗрдП рдЙрдирдХреЗ рдКрдкрд░ рдЬрд╛рдПрдВ рдФрд░ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╕реЗрд▓ рдХрд╛ рд╕реВрдЪрдХрд╛рдВрдХ рд╡рд╣рд╛рдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рди рдХрд┐ рдЗрд▓рд╛рдХреЗ рдХрд╛ рдкреНрд░рдХрд╛рд░ред <br><br><pre> <code class="cs hljs"> TriangulateEdgeFan(center, e, cell.Index);</code> </pre> <br>  рдЕрдЧрд▓рд╛ <code>TriangulateEdgeStrip</code> ред  рдпрд╣рд╛рдВ рд╕рдм рдХреБрдЫ рдереЛрдбрд╝рд╛ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо рдЙрд╕реА рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рд░рд┐рдлреНрд▓реИрдХреНрдЯрд░-рд░реАрдиреЗрдо рдХрд╛ рдирд╛рдо <code>c1</code> рдФрд░ <code>c2</code> рд╕реЗ <code>w1</code> рдФрд░ <code>w2</code> ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, Color w1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index1, EdgeVertices e2, Color w2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span> { terrain.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); terrain.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); terrain.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); terrain.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); Vector3 indices; indices.x = indices.z = index1; indices.y = index2; terrain.AddQuadCellData(indices, w1, w2); terrain.AddQuadCellData(indices, w1, w2); terrain.AddQuadCellData(indices, w1, w2); terrain.AddQuadCellData(indices, w1, w2); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddQuadColor(c1, c2); // terrain.AddQuadColor(c1, c2); // terrain.AddQuadColor(c1, c2); // terrain.AddQuadColor(c1, c2); // Vector3 types; // types.x = types.z = type1; // types.y = type2; // terrain.AddQuadTerrainTypes(types); // terrain.AddQuadTerrainTypes(types); // terrain.AddQuadTerrainTypes(types); // terrain.AddQuadTerrainTypes(types); if (hasRoad) { TriangulateRoadSegment(e1.v2, e1.v3, e1.v4, e2.v2, e2.v3, e2.v4); } }</span></span></code> </pre> <br>  рдХреЙрд▓ рдХреЛ рдЗрд╕ рд╡рд┐рдзрд┐ рдореЗрдВ рдмрджрд▓реЗрдВ рддрд╛рдХрд┐ рд╕реЗрд▓ рдЗрдВрдбреЗрдХреНрд╕ рдЙрдирдХреЗ рдкрд╛рд╕ рдкрд╣реБрдВрдЪ рдЬрд╛рдПред  рд╣рдо рдЪрд░ рдирд╛рдореЛрдВ рдХреЛ рднреА рд╕реБрд╕рдВрдЧрдд рд░рдЦрддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"> TriangulateEdgeStrip( m, weights1, cell.Index, e, weights1, cell.Index ); тАж TriangulateEdgeStrip( e1, weights1, cell.Index, e2, weights2, neighbor.Index, hasRoad ); тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeTerraces</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices begin, HexCell beginCell, EdgeVertices end, HexCell endCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e2 = EdgeVertices.TerraceLerp(begin, end, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color w2 = HexMetrics.TerraceLerp(weights1, weights2, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> i1 = beginCell.Index; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> i2 = endCell.Index; TriangulateEdgeStrip(begin, weights1, i1, e2, w2, i2, hasRoad); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; HexMetrics.terraceSteps; i++) { EdgeVertices e1 = e2; Color w1 = w2; e2 = EdgeVertices.TerraceLerp(begin, end, i); w2 = HexMetrics.TerraceLerp(weights1, weights2, i); TriangulateEdgeStrip(e1, w1, i1, e2, w2, i2, hasRoad); } TriangulateEdgeStrip(e2, w2, i1, end, weights2, i2, hasRoad); }</code> </pre> <br>  рдЕрдм рд╣рдо рдХреЛрдг рд╡рд┐рдзрд┐рдпреЛрдВ рдкрд░ рдЪрд▓рддреЗ рд╣реИрдВред  рдпреЗ рдкрд░рд┐рд╡рд░реНрддрди рд╕рд░рд▓ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрдиреНрд╣реЗрдВ рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рдХреЛрдб рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ <code>TriangulateCorner</code> ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateCorner</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 bottom, HexCell bottomCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { terrain.AddTriangle(bottom, left, right); Vector3 indices; indices.x = bottomCell.Index; indices.y = leftCell.Index; indices.z = rightCell.Index; terrain.AddTriangleCellData(indices, weights1, weights2, weights3); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights1, weights2, weights3); // Vector3 types; // types.x = bottomCell.TerrainTypeIndex; // types.y = leftCell.TerrainTypeIndex; // types.z = rightCell.TerrainTypeIndex; // terrain.AddTriangleTerrainTypes(types); } features.AddWall(bottom, bottomCell, left, leftCell, right, rightCell); }</span></span></code> </pre> <br>  <code>TriangulateCornerTerraces</code> рдореЗрдВ рдЖрдЧреЗред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateCornerTerraces</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, HexCell beginCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { Vector3 v3 = HexMetrics.TerraceLerp(begin, left, <span class="hljs-number"><span class="hljs-number">1</span></span>); Vector3 v4 = HexMetrics.TerraceLerp(begin, right, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color w3 = HexMetrics.TerraceLerp(weights1, weights2, <span class="hljs-number"><span class="hljs-number">1</span></span>); Color w4 = HexMetrics.TerraceLerp(weights1, weights3, <span class="hljs-number"><span class="hljs-number">1</span></span>); Vector3 indices; indices.x = beginCell.Index; indices.y = leftCell.Index; indices.z = rightCell.Index; terrain.AddTriangle(begin, v3, v4); terrain.AddTriangleCellData(indices, weights1, w3, w4); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights1, w3, w4); // terrain.AddTriangleTerrainTypes(indices); for (int i = 2; i &lt; HexMetrics.terraceSteps; i++) { Vector3 v1 = v3; Vector3 v2 = v4; Color w1 = w3; Color w2 = w4; v3 = HexMetrics.TerraceLerp(begin, left, i); v4 = HexMetrics.TerraceLerp(begin, right, i); w3 = HexMetrics.TerraceLerp(weights1, weights2, i); w4 = HexMetrics.TerraceLerp(weights1, weights3, i); terrain.AddQuad(v1, v2, v3, v4); terrain.AddQuadCellData(indices, w1, w2, w3, w4); // terrain.AddQuadColor(w1, w2, w3, w4); // terrain.AddQuadTerrainTypes(indices); } terrain.AddQuad(v3, v4, left, right); terrain.AddQuadCellData(indices, w3, w4, weights2, weights3); // terrain.AddQuadColor(w3, w4, weights2, weights3); // terrain.AddQuadTerrainTypes(indices); }</span></span></code> </pre> <br>  рдлрд┐рд░ <code>TriangulateCornerTerracesCliff</code> ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateCornerTerracesCliff</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, HexCell beginCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b = <span class="hljs-number"><span class="hljs-number">1f</span></span> / (rightCell.Elevation - beginCell.Elevation); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { b = -b; } Vector3 boundary = Vector3.Lerp( HexMetrics.Perturb(begin), HexMetrics.Perturb(right), b ); Color boundaryWeights = Color.Lerp(weights1, weights3, b); Vector3 indices; indices.x = beginCell.Index; indices.y = leftCell.Index; indices.z = rightCell.Index; TriangulateBoundaryTriangle( begin, weights1, left, weights2, boundary, boundaryWeights, indices ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftCell.GetEdgeType(rightCell) == HexEdgeType.Slope) { TriangulateBoundaryTriangle( left, weights2, right, weights3, boundary, boundaryWeights, indices ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { terrain.AddTriangleUnperturbed( HexMetrics.Perturb(left), HexMetrics.Perturb(right), boundary ); terrain.AddTriangleCellData( indices, weights2, weights3, boundaryWeights ); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights2, weights3, boundaryColor); // terrain.AddTriangleTerrainTypes(indices); } }</span></span></code> </pre> <br>  рдФрд░ <code>TriangulateCornerCliffTerraces</code> рдореЗрдВ рдереЛрдбрд╝рд╛ рдЕрд▓рдЧред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateCornerCliffTerraces</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, HexCell beginCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b = <span class="hljs-number"><span class="hljs-number">1f</span></span> / (leftCell.Elevation - beginCell.Elevation); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { b = -b; } Vector3 boundary = Vector3.Lerp( HexMetrics.Perturb(begin), HexMetrics.Perturb(left), b ); Color boundaryWeights = Color.Lerp(weights1, weights2, b); Vector3 indices; indices.x = beginCell.Index; indices.y = leftCell.Index; indices.z = rightCell.Index; TriangulateBoundaryTriangle( right, weights3, begin, weights1, boundary, boundaryWeights, indices ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftCell.GetEdgeType(rightCell) == HexEdgeType.Slope) { TriangulateBoundaryTriangle( left, weights2, right, weights3, boundary, boundaryWeights, indices ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { terrain.AddTriangleUnperturbed( HexMetrics.Perturb(left), HexMetrics.Perturb(right), boundary ); terrain.AddTriangleCellData( indices, weights2, weights3, boundaryWeights ); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights2, weights3, boundaryWeights); // terrain.AddTriangleTerrainTypes(indices); } }</span></span></code> </pre> <br>  рдкрд┐рдЫрд▓реЗ рджреЛ рддрд░реАрдХреЗ <code>TriangulateBoundaryTriangle</code> рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateBoundaryTriangle</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 begin, Color beginWeights, Vector3 left, Color leftWeights, Vector3 boundary, Color boundaryWeights, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { Vector3 v2 = HexMetrics.Perturb(HexMetrics.TerraceLerp(begin, left, <span class="hljs-number"><span class="hljs-number">1</span></span>)); Color w2 = HexMetrics.TerraceLerp(beginWeights, leftWeights, <span class="hljs-number"><span class="hljs-number">1</span></span>); terrain.AddTriangleUnperturbed(HexMetrics.Perturb(begin), v2, boundary); terrain.AddTriangleCellData(indices, beginWeights, w2, boundaryWeights); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(beginColor, c2, boundaryColor); // terrain.AddTriangleTerrainTypes(types); for (int i = 2; i &lt; HexMetrics.terraceSteps; i++) { Vector3 v1 = v2; Color w1 = w2; v2 = HexMetrics.Perturb(HexMetrics.TerraceLerp(begin, left, i)); w2 = HexMetrics.TerraceLerp(beginWeights, leftWeights, i); terrain.AddTriangleUnperturbed(v1, v2, boundary); terrain.AddTriangleCellData(indices, w1, w2, boundaryWeights); // terrain.AddTriangleColor(c1, c2, boundaryColor); // terrain.AddTriangleTerrainTypes(types); } terrain.AddTriangleUnperturbed(v2, HexMetrics.Perturb(left), boundary); terrain.AddTriangleCellData(indices, w2, leftWeights, boundaryWeights); // terrain.AddTriangleColor(c2, leftColor, boundaryColor); // terrain.AddTriangleTerrainTypes(types); }</span></span></code> </pre> <br>  рдЕрдВрддрд┐рдо рд╡рд┐рдзрд┐ рдЬрд┐рд╕реЗ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд╡рд╣ рд╣реИ <code>TriangulateWithRiver</code> ред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж terrain.AddTriangle(centerL, m.v1, m.v2); terrain.AddQuad(centerL, center, m.v2, m.v3); terrain.AddQuad(center, centerR, m.v3, m.v4); terrain.AddTriangle(centerR, m.v4, m.v5); Vector3 indices; indices.x = indices.y = indices.z = cell.Index; terrain.AddTriangleCellData(indices, weights1); terrain.AddQuadCellData(indices, weights1); terrain.AddQuadCellData(indices, weights1); terrain.AddTriangleCellData(indices, weights1); <span class="hljs-comment"><span class="hljs-comment">// terrain.AddTriangleColor(weights1); // terrain.AddQuadColor(weights1); // terrain.AddQuadColor(weights1); // terrain.AddTriangleColor(weights1); // Vector3 types; // types.x = types.y = types.z = cell.TerrainTypeIndex; // terrain.AddTriangleTerrainTypes(types); // terrain.AddQuadTerrainTypes(types); // terrain.AddQuadTerrainTypes(types); // terrain.AddTriangleTerrainTypes(types); тАж }</span></span></code> </pre> <br>  рд╕рдм рдХреБрдЫ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдкреНрд░реАрдлрд╝реИрдм рдХреЗ рдЯреБрдХрдбрд╝реЗ рдХреЗ рд░рд╛рд╣рдд рдХреЗ рдмрд╛рд▓ рддрддреНрд╡ рдХреЗ рд▓рд┐рдП рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/919/b8c/731/919b8c7317b2aa3c06f1077eef27fe96.png"></div><br>  <i>рд░рд╛рд╣рдд рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред</i> <br><br>  рдЗрд╕ рд╕реНрддрд░ рдкрд░, рдореЗрд╖ рдореЗрдВ рдКрдВрдЪрд╛рдИ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреЗ рдмрдЬрд╛рдп рд╕реЗрд▓ рдЕрдиреБрдХреНрд░рдорд┐рдд рд╣реЛрддреЗ рд╣реИрдВред  рдЪреВрдБрдХрд┐ рдЗрд▓рд╛рдХрд╝реЗ рдХреА рдврд╛рд▓ рдЕрднреА рднреА рдЙрдиреНрд╣реЗрдВ рдКрдБрдЪрд╛рдИ рдХреЗ рд╕реВрдЪрдХ рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╛рдЦреНрдпрд╛рдпрд┐рдд рдХрд░рддреА рд╣реИ, рд╣рдо рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдкрд╣рд▓реА рдХреЛрд╢рд┐рдХрд╛ рдХреЛ рдкрд╣рд▓реА рдмрдирд╛рд╡рдЯ рдХреЗ рд╕рд╛рде рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реА рддрд░рд╣ рдЬрдм рддрдХ рдХрд┐ рдЕрдВрддрд┐рдо рдЗрд▓рд╛рдХреЗ рдХреА рдмрдирд╛рд╡рдЯ рдирд╣реАрдВ рдкрд╣реБрдБрдЪ рдЬрд╛рддреАред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a5/a23/ce8/8a5a23ce850af789e759dde6879f93eb.png"></div><br>  <i>рд╕реЗрд▓ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдКрдВрдЪрд╛рдИ рдмрдирд╛рд╡рдЯ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░рдирд╛ред</i> <br><br><div class="spoiler">  <b class="spoiler_title">рдореБрдЭреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рд┐рдлрд▓реЗрдХреНрдЯреЗрдб рдХреЛрдб рдирд╣реАрдВ рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИред</b>  <b class="spoiler_title">рдореИрдВ рдХреНрдпрд╛ рдЧрд▓рдд рдХрд░ рд░рд╣рд╛ рд╣реВрдБ?</b> <div class="spoiler_text">  рдПрдХ рд╕рдордп рдореЗрдВ, рд╣рдордиреЗ рдмрдбрд╝реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рддреНрд░рд┐рднреБрдЬ рдХреЛрдб рдХреЛ рдмрджрд▓ рджрд┐рдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рддреНрд░реБрдЯрд┐рдпреЛрдВ рдпрд╛ рдУрд╡рд░рд╕рд╛рдЗрдЯреНрд╕ рдХреА рдЙрдЪреНрдЪ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИред  рдпрджрд┐ рдЖрдкрдХреЛ рддреНрд░реБрдЯрд┐ рдирд╣реАрдВ рдорд┐рд▓ рд░рд╣реА рд╣реИ, рддреЛ рдЗрд╕ рдЕрдиреБрднрд╛рдЧ рд╕реЗ рдкреИрдХреЗрдЬ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдЙрдЪрд┐рдд рдлрд╛рдЗрд▓реЗрдВ рдирд┐рдХрд╛рд▓реЗрдВред  рдЖрдк рдЙрдиреНрд╣реЗрдВ рдПрдХ рдЕрд▓рдЧ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдЖрдпрд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдХреЛрдб рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </div></div><br><h3>  рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХреЛ shader рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░реЗрдВ </h3><br>  рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд▓рд╛рдХреЗ рдХреА рдЫрд╛рдпрд╛ рдХреЗ рдкрд╛рд╕ рдЙрдирдХреА рдкрд╣реБрдВрдЪ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред  рдпрд╣ shader рд╕рдВрдкрддреНрддрд┐ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕рд╕реЗ рд░рд╛рд╣рдд рдХреА рднреМрддрд┐рдХ рд╕рдВрдкрддреНрддрд┐ рдирд┐рд░реНрдзрд╛рд░рд┐рдд <code>HexCellShaderData</code> рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред  рдпрд╛ рд╣рдо рд╕рднреА рд░рдВрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реНрд╡ рд╕реНрддрд░ рдкрд░ рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдмрдирд╛рд╡рдЯ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ рдХрдИ рд╢реЗрдбреНрд╕ рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред <br><br>  рд╕реЗрд▓ рдмрдирд╛рд╡рдЯ рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдЗрд╕реЗ <code>Shader.SetGlobalTexture</code> рд╡рд┐рдзрд┐ рд╕реЗ рдХреЙрд▓ рдХрд░реЗрдВ, рддрд╛рдХрд┐ рдпрд╣ рд╡рд┐рд╢реНрд╡ рд╕реНрддрд░ рдкрд░ <em>_HexCDData рдХреЗ</em> рд░реВрдк рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗред <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cellTexture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D( x, z, TextureFormat.RGBA32, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> ); cellTexture.filterMode = FilterMode.Point; cellTexture.wrapMode = TextureWrapMode.Clamp; Shader.SetGlobalTexture(<span class="hljs-string"><span class="hljs-string">"_HexCellData"</span></span>, cellTexture); } тАж }</code> </pre> <br>  рд╢реЗрдбрд░ рдкреНрд░реЙрдкрд░реНрдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдпреВрдирд┐рдЯреА рдЯреЗрдХреНрд╕рдЪрд░ рдЖрдХрд╛рд░ рдХреЛ рдмрдирд╛рд╡рдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрд▓рдмреНрдз <em>рдХрд░рд╡рд╛рддреА рд╣реИ редName_TexelSize</em> рд╡реЗрд░рд┐рдПрдмрд▓ред  рдпрд╣ рдПрдХ рдЪрд╛рд░-рдШрдЯрдХ рд╕рджрд┐рд╢ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдорд╛рди рд╣реИрдВ рдЬреЛ рдЪреМрдбрд╝рд╛рдИ рдФрд░ рдКрдВрдЪрд╛рдИ рдХреЗ рд╡рд┐рдкрд░реАрдд рд╣реИрдВ, рд╕рд╛рде рд╣реА рд╕рд╛рде рдЪреМрдбрд╝рд╛рдИ рдФрд░ рдКрдВрдЪрд╛рдИ рднреАред  рд▓реЗрдХрд┐рди рд╡реИрд╢реНрд╡рд┐рдХ рдмрдирд╛рд╡рдЯ рд╕реЗрдЯ рдХрд░рддреЗ рд╕рдордп, рдпрд╣ рдкреНрд░рджрд░реНрд╢рди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдмрдирд╛рд╡рдЯ рдмрдирд╛рдиреЗ рдпрд╛ рдЖрдХрд╛рд░ рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рдж рдЗрд╕реЗ <code>Shader.SetGlobalVector</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реНрд╡рдпрдВ рдХрд░реЗрдВрдЧреЗред <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { cellTexture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture2D( x, z, TextureFormat.RGBA32, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> ); cellTexture.filterMode = FilterMode.Point; cellTexture.wrapMode = TextureWrapMode.Clamp; Shader.SetGlobalTexture(<span class="hljs-string"><span class="hljs-string">"_HexCellData"</span></span>, cellTexture); } Shader.SetGlobalVector( <span class="hljs-string"><span class="hljs-string">"_HexCellData_TexelSize"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector4(<span class="hljs-number"><span class="hljs-number">1f</span></span> / x, <span class="hljs-number"><span class="hljs-number">1f</span></span> / z, x, z) );</code> </pre> <br><h3>  Shader Data Access </h3><br>  рдПрдХ рдирдпрд╛ shader рдмрдирд╛рдПрдБ рд╕рд╛рдордЧреНрд░реА рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ <em>HexCellData</em> рдирд╛рдордХ рдлрд╝рд╛рдЗрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИред  рдЗрд╕рдХреЗ рдЕрдВрджрд░, рд╣рдо рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдмрдирд╛рд╡рдЯ рдФрд░ рдЖрдХрд╛рд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЪрд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рд╣рдо рджрд┐рдП рдЧрдП рд╢реАрд░реНрд╖ рдЬрд╛рд▓ рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рд╕реЗрд▓ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдлрд╝рдВрдХреНрд╢рди рднреА рдмрдирд╛рддреЗ рд╣реИрдВред <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sampler2D</span></span> _HexCellData; <span class="hljs-attribute"><span class="hljs-attribute">float4</span></span> _HexCellData_TexelSize; <span class="hljs-attribute"><span class="hljs-attribute">float4</span></span> GetCellData (appdata_full v) { }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a64/604/dbc/a64604dbc7d3ad5ff1e1578bd0c84eec.png"></div><br>  <i>рдирдИ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред</i> <br><br>  рд╕реЗрд▓ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреЛ <code>v.texcoord2</code> рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ <code>v.texcoord2</code> , рдЬреИрд╕рд╛ рдХрд┐ рдЗрд▓рд╛рдХрд╝реЗ рдХреЗ рдкреНрд░рдХрд╛рд░реЛрдВ рдореЗрдВ рд╣реЛрддрд╛ рдерд╛ред  рдкрд╣рд▓реЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ - <code>v.texcoord2.x</code> ред  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рд╣рдо рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдмрдирд╛рд╡рдЯ рдХреЗ рдирдореВрдиреЗ рдХреЗ рд▓рд┐рдП рд╕реАрдзреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдореЗрдВ рдЗрд╕реЗ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдореЗрдВ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ред <br><br>  рдпреВ рд╕рдордиреНрд╡рдп рдмрдирд╛рдиреЗ рдореЗрдВ рдкрд╣рд▓рд╛ рдХрджрдо рдмрдирд╛рд╡рдЯ рдХреА рдЪреМрдбрд╝рд╛рдИ рд╕реЗ рд╕реЗрд▓ рдЗрдВрдбреЗрдХреНрд╕ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдирд╛ рд╣реИред  рд╣рдо рдЗрд╕реЗ <code>_HexCellData_TexelSize.x</code> рджреНрд╡рд╛рд░рд╛ рдЧреБрдгрд╛ рдХрд░рдХреЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">float4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">appdata_full v</span></span></span><span class="hljs-function">)</span></span> { float2 uv; uv.x = v.texcoord2.x * _HexCellData_TexelSize.x; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо ZU рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рд╕рдВрдЦреНрдпрд╛ рд╣реЛрдЧреА, рдЬрд╣рд╛рдВ Z рдкрдВрдХреНрддрд┐ рд╕реВрдЪрдХрд╛рдВрдХ рд╣реИ рдФрд░ U, U рд╕реЗрд▓ рдХрд╛ рд╕рдордиреНрд╡рдп рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдиреАрдЪреЗ рд▓рд╛рдХрд░ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдпреВ рд╕рдордиреНрд╡рдп рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдШрдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v) { float2 uv; uv.x = v.texcoord2.x * _HexCellData_TexelSize.x; <span class="hljs-type"><span class="hljs-type">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = floor(uv.x); uv.x -= <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдмрдирд╛рд╡рдЯ рдХреА рдКрдВрдЪрд╛рдИ рд╕реЗ рд░реЗрдЦрд╛ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░ рд░рд╣рд╛ рд╣реИред </font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v) { float2 uv; uv.x = v.texcoord2.x * _HexCellData_TexelSize.x; <span class="hljs-type"><span class="hljs-type">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = floor(uv.x); uv.x -= <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>; uv.y = <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> * _HexCellData_TexelSize.y; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд▓реЗ рд░рд╣реЗ рд╣реИрдВ, рд╣рдореЗрдВ рдкрд┐рдХреНрд╕рд▓ рдХреЗ рдХреЗрдВрджреНрд░реЛрдВ рдкрд░ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рди рдХрд┐ рдЙрдирдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ред </font><font style="vertical-align: inherit;">рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╣рдо рдЧрд╛рд░рдВрдЯреА рджреЗрддреЗ рд╣реИрдВ рдХрд┐ рд╕рд╣реА рдкрд┐рдХреНрд╕рд▓ рдХрд╛ рдирдореВрдирд╛ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдмрдирд╛рд╡рдЯ рдХреЗ рдЖрдХрд╛рд░ рд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, by рдЬреЛрдбрд╝реЗрдВред</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v) { float2 uv; uv.x = (v.texcoord2.x + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.x; <span class="hljs-type"><span class="hljs-type">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = floor(uv.x); uv.x -= <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>; uv.y = (<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.y; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╣рдореЗрдВ рд╢реАрд░реНрд╖ рдбреЗрдЯрд╛ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдкрд╣рд▓реА рд╕реЗрд▓ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд▓рд┐рдП рд╕рд╣реА рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╢реАрд░реНрд╖ рдкрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рддреАрди рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реВрдЪрдХрд╛рдВрдХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЗрд╕реЗ </font></font><code>GetCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐рд╕реА рднреА рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд▓рд┐рдП рдХрд╛рдо </font><font style="vertical-align: inherit;">рдХрд░реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдореЗрдВ рдПрдХ рдкреВрд░реНрдгрд╛рдВрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛрдбрд╝реЗрдВ </font></font><code>index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рд╕реЗрд▓ рдШрдЯрдХ рдХреЗ рд╕рд╛рде рд╡реЗрдХреНрдЯрд░ рдШрдЯрдХ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) { float2 uv; uv.x = (v.texcoord2[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>] + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.x; <span class="hljs-type"><span class="hljs-type">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = floor(uv.x); uv.x -= <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>; uv.y = (<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.y; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╣реИрдВ, рддреЛ рд╣рдо рдирдореВрдирд╛ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>_HexCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рд╣рдо рд╡рд░реНрдЯреЗрдХреНрд╕ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд▓реЗ рд░рд╣реЗ рд╣реИрдВ, рд╣рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЙрд╕ рд╢реЗрдк рдХреЛ рдмрддрд╛рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font></font><code>tex2Dlod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд┐рд╕рдореЗрдВ рдЪрд╛рд░ рдмрдирд╛рд╡рдЯ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдПрдордЖрдИрдкреА-рдмрдирд╛рд╡рдЯ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЕрддрд┐рд░рд┐рдХреНрдд рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рд╢реВрдиреНрдп рдорд╛рди рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) { float2 uv; uv.x = (v.texcoord2[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>] + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.x; <span class="hljs-type"><span class="hljs-type">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> = floor(uv.x); uv.x -= <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>; uv.y = (<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> + <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * _HexCellData_TexelSize.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> data = tex2Dlod(_HexCellData, <span class="hljs-type"><span class="hljs-type">float4</span></span>(uv, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреМрдереЗ рдбреЗрдЯрд╛ рдШрдЯрдХ рдореЗрдВ рдПрдХ рдКрдВрдЪрд╛рдИ рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╕реВрдЪрдХрд╛рдВрдХ рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╣рдо рд╕реАрдзреЗ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, GPU рдиреЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЗрд╕реЗ 0-2 рдХреА рд╕реАрдорд╛ рдореЗрдВ рдПрдХ рдлреНрд▓реЛрдЯрд┐рдВрдЧ рдкреЙрдЗрдВрдЯ рдорд╛рди рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рд╡рд╛рдкрд╕ рд╕рд╣реА рдорд╛рди рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ 255 рд╕реЗ рдЧреБрдгрд╛ рдХрд░реЗрдВред рдЗрд╕рдХреЗ рдмрд╛рдж, рдЖрдк рдбреЗрдЯрд╛ рд╡рд╛рдкрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs kotlin"> float4 <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = tex2Dlod(_HexCellData, float4(uv, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.w *= <span class="hljs-number"><span class="hljs-number">255</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рд╢рд╛рдорд┐рд▓ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HexCellData</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ рдореЗрдВ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднреВ-рднрд╛рдЧ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдЬрдм рд╕реЗ рдореИрдВрдиреЗ рдЗрд╕ shader рдХреЛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Material / Terrain</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рд░рдЦрд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рдореБрдЭреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдкрде рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">../HexCellData.cginc</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред</font></font><br><br><pre> <code class="hljs lisp"> #include <span class="hljs-string"><span class="hljs-string">"../HexCellData.cginc"</span></span> UNITY_DECLARE_TEX2DARRAY(<span class="hljs-name"><span class="hljs-name">_MainTex</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реАрд░реНрд╖ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдореЗрдВ, рд╣рдо рд╢реАрд░реНрд╖ рдбреЗрдЯрд╛ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╕рднреА рддреАрди рд╕реЗрд▓ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реЗрд▓ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдлрд┐рд░ </font></font><code>data.terrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдирдХреЗ рдЙрдиреНрдирдпрди рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреЛ </font><font style="vertical-align: inherit;">рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); // data.terrain = v.texcoord2.xyz; <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell2 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">2</span></span>); data.terrain.x = cell0.w; data.terrain.y = cell1.w; data.terrain.z = cell2.w; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░, рдирдХреНрд╢рд╛ рдлрд┐рд░ рд╕реЗ рд╕рд╣реА рдЗрд▓рд╛рдХреЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рд▓рдЧрд╛ред </font><font style="vertical-align: inherit;">рдмрдбрд╝рд╛ рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рдХреЗрд╡рд▓ рдЗрд▓рд╛рдХреЗ рдХреЗ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рд╕реЗ рдирдП рддреНрд░рд┐рдХреЛрдг рдирд╣реАрдВ рдмрдирддреЗред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╕рдВрдкрд╛рджрди рдХреЗ рджреМрд░рд╛рди рдХрд┐рд╕реА рдЕрдиреНрдп рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХреЛ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреГрд╢реНрдпрддрд╛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЖрдзрд╛рд░ рдмрдирд╛рдХрд░, рд╣рдо рджреГрд╢реНрдпрддрд╛ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╢реЗрдбрд░, рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╕реНрд╡рдпрдВ рдФрд░ рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рджреГрд╢реНрдпрддрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рддреНрд░рд┐рдХреЛрдгрд╛рд╕рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рдХреБрдЫ рдирд╣реАрдВ рдЬрд╛рдирддреА рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рд╢реБрд░реБрдЖрдд рдХрд░рддреЗ рд╣реИрдВ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЗрд░реЗрди</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ </font><font style="vertical-align: inherit;">рдХреЛ рджреГрд╢реНрдпрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ </font><font style="vertical-align: inherit;">рдмрддрд╛рддреЗ рд╣реБрдП </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╢реАрд░реНрд╖ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╕реЗ рджреГрд╢реНрдпрддрд╛ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ рдФрд░ рдЗрд╕реЗ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЯреБрдХрдбрд╝рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рдкрд╛рд╕ рдХрд░реЗрдЧрд╛ </font></font><code>Input</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рддреАрди рдЕрд▓рдЧ-рдЕрд▓рдЧ рдКрдВрдЪрд╛рдИ рд╕реВрдЪрдХрд╛рдВрдХ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рддреАрди рджреГрд╢реНрдпрддрд╛ рдорд╛рди рднреА рдкрд╛рд╕ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="hljs swift"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> </span></span>{ float4 color : <span class="hljs-type"><span class="hljs-type">COLOR</span></span>; float3 worldPos; float3 terrain; float3 visibility; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреГрд╢реНрдпрддрд╛ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдкрд╣рд▓реЗ рдШрдЯрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="hljs kotlin"> void vert (inout appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Input <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { UNITY_INITIALIZE_OUTPUT(Input, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>); float4 cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); float4 cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); float4 cell2 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.terrain.x = cell0.w; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.terrain.y = cell1.w; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.terrain.z = cell2.w; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = cell0.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.y = cell1.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.z = cell2.x; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 рдХреА рджреГрд╢реНрдпрддрд╛ рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╕реЗрд▓ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЕрджреГрд╢реНрдп рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдпрд╣ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рджреГрд╢реНрдпрддрд╛ рдХрд╛ рдорд╛рди рд╣реЛрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рд╣рдо </font></font><code>GetTerrainColor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдХреЗ рд╕рдВрдЧрдд рд╡реЗрдХреНрдЯрд░ рджреНрд╡рд╛рд░рд╛ </font><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдо </font><font style="vertical-align: inherit;">рдХреЛ </font><font style="vertical-align: inherit;">рдЧреБрдгрд╛ рдХрд░рдХреЗ рдЗрд▓рд╛рдХреЗ рдХреЛ рдХрд╛рд▓рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдорд┐рд╢реНрд░рд┐рдд рд╕реЗрд▓ рдХреЗ рд░рд╛рд╣рдд рд░рдВрдЧ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float4</span></span> GetTerrainColor (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) { float3 uvw = float3(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz * <span class="hljs-number"><span class="hljs-number">0.02</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.terrain[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>]); <span class="hljs-type"><span class="hljs-type">float4</span></span> c = UNITY_SAMPLE_TEX2DARRAY(_MainTex, uvw); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c * (<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>] * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>]); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1bf/183/e69/1bf183e695a42f4691f63cec72255993.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдХрд╛рд▓реА рд╣реЛ рдЧрдИрдВред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рд╣рдо рдЗрд╕рдХреЗ рдмрдЬрд╛рдп рдХрд┐рд╕реА рд╢реАрд░реНрд╖ рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рдХреЛ рдЬреЛрдбрд╝ рдирд╣реАрдВ рд╕рдХрддреЗ рд╣реИрдВ?</font></font></b> <div class="spoiler_text">   ,           .              .           .        ,      .   ,     . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреВрд░реНрдг рд░реВрдк рд╕реЗ рдЕрдВрдзреЗрд░рд╛ рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдЕрджреГрд╢реНрдп рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣рд▓рдЪрд▓ рд╣реИред </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рд╣рдо рдЕрднреА рднреА рд░рд╛рд╣рдд рджреЗрдЦ рд╕рдХреЗрдВ, рд╣рдореЗрдВ рдЫрд┐рдкреА рд╣реБрдИ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рдВрдХреЗрддрдХ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП 0-1 рд╕реЗ 1 - 1 рддрдХ рдЪрд▓рддреЗ рд╣реИрдВ, рдЬреЛ рдХреНрд░рд┐рдпрд╛ </font></font><code>lerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЗ рдЕрдВрдд рдореЗрдВ </font><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs kotlin"> void vert (inout appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Input <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { тАж <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = cell0.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.y = cell1.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.z = cell2.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a20/090/3e2/a200903e2f31f3bdcd0c996d42f91a02.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫрд╛рдпрд╛рдВрдХрд┐рдд рдХреЛрд╢рд┐рдХрд╛рдПрдБред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрд▓ рджреГрд╢реНрдпрддрд╛ рдЯреНрд░реИрдХрд┐рдВрдЧ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЕрдкрдиреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдпрд╣ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ рддреЛ рдПрдХ рд╕реЗрд▓ рдХреИрд╕реЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ? рд╣рдо рдЗрд╕реЗ рджреЗрдЦрдиреЗ рд╡рд╛рд▓реА рд╕рдВрд╕реНрдерд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдХреЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЬрдм рдХреЛрдИ рд╡реНрдпрдХреНрддрд┐ рд╕реЗрд▓ рджреЗрдЦрдирд╛ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдЗрд╕ рд╕реЗрд▓ рдХреА рд╕реВрдЪрдирд╛ рджреЗрдиреА рдЪрд╛рд╣рд┐рдПред рдФрд░ рдЬрдм рдХреЛрдИ рд╡реНрдпрдХреНрддрд┐ рд╕реЗрд▓ рдХреЛ рджреЗрдЦрдирд╛ рдмрдВрдж рдХрд░ рджреЗрддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рднреА рд╕реВрдЪрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рд╕реЗрд▓ рдмрд╕ рдЙрди рдкрд░ рдирдЬрд░ рд░рдЦрдиреЗ рд╡рд╛рд▓реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рдирдЬрд╝рд░ рд░рдЦрддрд╛ рд╣реИ, рдЬреЛ рднреА рд╕рдВрд╕реНрдерд╛рдПрдВ рд╣реИрдВред рдпрджрд┐ рдХрд┐рд╕реА рд╕реЗрд▓ рдХрд╛ рджреГрд╢реНрдпрддрд╛ рдорд╛рди рдХрдо рд╕реЗ рдХрдо 1 рд╣реИ, рддреЛ рдпрд╣ рджреГрд╢реНрдпрдорд╛рди рд╣реИ, рдЕрдиреНрдпрдерд╛ рдпрд╣ рдЕрджреГрд╢реНрдп рд╣реИред рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд░ рдореЗрдВ рджреЛ рд╡рд┐рдзрд┐рдпрд╛рдБ рдФрд░ рдПрдХ рдЧреБрдг </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsVisible { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visibility &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; } } тАж <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> visibility; тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IncreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { visibility += <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { visibility -= <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрд╛рдж, рдЙрд╕ </font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font></font><code>RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬреЛ </font></font><code>RefreshTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рд╣реИ рд╡реИрд╕рд╛ рд╣реА </font><font style="vertical-align: inherit;">рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдбреЗрдЯрд╛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдШрдЯрдХ рдЖрд░ рдореЗрдВ рдбреЗрдЯрд╛ рд╕рд╣реЗрдЬреЗрдВред </font><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рд╣рдо рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ 0-1 рдорд╛рдиреЛрдВ рдореЗрдВ рдмрджрд▓ рдЬрд╛рддреЗ рд╣реИрдВ, рд╣рдо рджреГрд╢реНрдпрддрд╛ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>(byte)255</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { cellTextureData[cell.Index].r = cell.IsVisible ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдЗрд╕ рдкрджреНрдзрддрд┐ рдХреЛ рдмрдврд╝рддреЗ рдФрд░ рдШрдЯрддреЗ рджреГрд╢реНрдпрддрд╛ рдХреЗ рд╕рд╛рде рдХрд╣реЗрдВрдЧреЗ, 0 рдФрд░ 1 рдХреЗ рдмреАрдЪ рдХреЗ рдорд╛рди рдХреЛ рдмрджрд▓рддреЗ рд╣реБрдПред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IncreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { visibility += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visibility == <span class="hljs-number"><span class="hljs-number">1</span></span>) { ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { visibility -= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visibility == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрдХреНрд╡рд╛рдб рджреГрд╢реНрдпрддрд╛ рдмрдирд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕реЗ рдмрдирд╛рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЗрдХрд╛рдЗрдпрд╛рдБ рдЙрд╕ рдХрдХреНрд╖ рдХреЛ рджреЗрдЦ рд╕рдХреЗрдВ, рдЬрд┐рд╕ рдкрд░ рдЙрдирдХрд╛ рдХрдмреНрдЬрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ </font></font><code>IncreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рд░реНрдп рдХреЗ рджреМрд░рд╛рди рдпреВрдирд┐рдЯ рдХреЗ рдирдП рд╕реНрдерд╛рди рдкрд░ </font><font style="vertical-align: inherit;">рдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреВрд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>HexUnit.Location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдкреБрд░рд╛рдиреЗ рд╕реНрдерд╛рди рдХреЗ рд▓рд┐рдП рднреА рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ (рдпрджрд┐ рдпрд╣ рдореМрдЬреВрдж рд╣реИ) </font></font><code>DecreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexCell Location { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> location; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location) { location.DecreaseVisibility(); location.Unit = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } location = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Unit = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.IncreaseVisibility(); transform.localPosition = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Position; } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7bc/f95/a07/7bcf95a07fdf4c10ed1d53055dddf6a4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдХрд╛рдЗрдпрд╛рдБ рджреЗрдЦ рд╕рдХрддреА рд╣реИрдВ рдХрд┐ рд╡реЗ рдХрд╣рд╛рдБ рд╣реИрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ рд╣рдордиреЗ рджреГрд╢реНрдпрддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛! </font><font style="vertical-align: inherit;">рдЬрдм рдПрдХ рдорд╛рдирдЪрд┐рддреНрд░ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрдХрд╛рдЗрдпрд╛рдВ рдЕрдкрдиреЗ рд╕реЗрд▓ рдХреЛ рджреГрд╢реНрдпрдорд╛рди рдмрдирд╛рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЙрдирдХреЗ рд╕реНрдерд╛рди рдХреЛ рдЙрдирдХреЗ рдирдП рд╕реНрдерд╛рди рдкрд░ рд▓реЗ рдЬрд╛рдиреЗ рдкрд░ рдЯреЗрд▓реАрдкреЛрд░реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдирдХреНрд╢реЗ рд╕реЗ рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЛ рд╣рдЯрд╛рддреЗ рд╕рдордп рдЙрдирдХрд╛ рджрд╛рдпрд░рд╛ рд╕рдХреНрд░рд┐рдп рд░рд╣рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЛ рдирд╖реНрдЯ рдХрд░рддреЗ рд╕рдордп рдЙрдирдХреЗ рд╕реНрдерд╛рди рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рдХрдо рдХрд░ рджреЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Die</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location) { location.DecreaseVisibility(); } location.Unit = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Destroy(gameObject); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреГрд╢реНрдпрддрд╛ рд╕реАрдорд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рддрдХ, рд╣рдо рдХреЗрд╡рд▓ рдЙрд╕ рд╕реЗрд▓ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдЯреБрдХрдбрд╝реА рд╕реНрдерд┐рдд рд╣реИ, рдФрд░ рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛рдУрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИред рдХрдо рд╕реЗ рдХрдо рд╣рдореЗрдВ рдкрдбрд╝реЛрд╕реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред рд╕рд╛рдорд╛рдиреНрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЗрдХрд╛рдЗрдпрд╛рдВ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рджреВрд░реА рдХреЗ рднреАрддрд░ рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рджреЗрдЦ рд╕рдХрддреА рд╣реИрдВ, рдЬреЛ рдЗрдХрд╛рдИ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓реЛ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╕реЗрд▓ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рд╡рд╛рд▓реА рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд░реЗрдВрдЬ рдореЗрдВ рд▓реЗрддреЗ </font><font style="vertical-align: inherit;">рд╣реБрдП </font><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред рд╣рдо рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдФрд░ рдмрджрд▓рдХрд░ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>Search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдЗрд╕рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдмрджрд▓реЗрдВ рдФрд░ рдЗрд╕реЗ рдЙрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд╕реВрдЪреА рд▓реМрдЯрд╛рдПрдВ рдЬрд┐рдирдХреЗ рд▓рд┐рдП рдЖрдк рд╕реВрдЪреА рдкреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдкрд░, рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рдХреЛ рд╕реВрдЪреА рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред рдЕрдм рдХреЛрдИ рдЕрдВрддрд┐рдо рд╕реЗрд▓ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рдмрд┐рдВрджреБ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдкрд░ рдЦреЛрдЬ рдХрднреА рд╕рдорд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрдЧреАред рд╣рдореЗрдВ рдЪрд╛рд▓ рдХреЗ рддрд░реНрдХ рдФрд░ рдЪрд▓рдиреЗ рдХреА рд▓рд╛рдЧрдд рд╕реЗ рднреА рдЫреБрдЯрдХрд╛рд░рд╛ рдорд┐рд▓рддрд╛ рд╣реИред рдЧреБрдг рдмрдирд╛ рд▓реЗрдВ</font></font><code>PathFrom</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рдЕрдм рдирд╣реАрдВ рдкреВрдЫрд╛ рдЧрдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ рдЙрдирдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдФрд░ рд╣рдо рдЧреНрд░рд┐рдб рдХреЗ рд╕рд╛рде рд░рд╛рд╕реНрддреЗ рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рдг рдкрд░, рджреВрд░реА рдХреЗрд╡рд▓ 1 рд╕реЗ рдмрдврд╝рддреА рд╣реИред рдпрджрд┐ рдпрд╣ рд╕реАрдорд╛ рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рддреЛ рдпрд╣ рд╕реЗрд▓ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдФрд░ рд╣рдореЗрдВ рдПрдХ рдЦреЛрдЬ рд╣реЗрдпреБрд░рд┐рд╕реНрдЯрд┐рдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ 0. рдХреЗ рдорд╛рди рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред рдЕрд░реНрдерд╛рдд, рд╣рдо рджрд┐рдХреНрдЬрд╕реНрдЯреНрд░рд╛ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдореЗрдВ рд▓реМрдЯ рдЖрдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">List&lt;HexCell&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetVisibleCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> range</span></span></span><span class="hljs-function">)</span></span> { List&lt;HexCell&gt; visibleCells = ListPool&lt;HexCell&gt;.Get(); searchFrontierPhase += <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (searchFrontier == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { searchFrontier = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCellPriorityQueue(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { searchFrontier.Clear(); } fromCell.SearchPhase = searchFrontierPhase; fromCell.Distance = <span class="hljs-number"><span class="hljs-number">0</span></span>; searchFrontier.Enqueue(fromCell); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); current.SearchPhase += <span class="hljs-number"><span class="hljs-number">1</span></span>; visibleCells.Add(current); <span class="hljs-comment"><span class="hljs-comment">// if (current == toCell) { // return true; // } // int currentTurn = (current.Distance - 1) / speed; for (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { HexCell neighbor = current.GetNeighbor(d); if ( neighbor == null || neighbor.SearchPhase &gt; searchFrontierPhase ) { continue; } // тАж // int moveCost; // тАж int distance = current.Distance + 1; if (distance &gt; range) { continue; } // int turn = (distance - 1) / speed; // if (turn &gt; currentTurn) { // distance = turn * speed + moveCost; // } if (neighbor.SearchPhase &lt; searchFrontierPhase) { neighbor.SearchPhase = searchFrontierPhase; neighbor.Distance = distance; // neighbor.PathFrom = current; neighbor.SearchHeuristic = 0; searchFrontier.Enqueue(neighbor); } else if (distance &lt; neighbor.Distance) { int oldPriority = neighbor.SearchPriority; neighbor.Distance = distance; // neighbor.PathFrom = current; searchFrontier.Change(neighbor, oldPriority); } } } return visibleCells; }</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдорд╛ рдХреЗ рднреАрддрд░ рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпрд╛ рд╣рдо рдПрдХ рд╕рд░рд▓ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ?</font></font></b> <div class="spoiler_text"> ,          ,      . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд░реАрдХреЗ </font></font><code>IncreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font></font><code>DecreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╡реЗ рд╕реЗрд▓ рдФрд░ рд░реЗрдВрдЬ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рд╕рдВрдмрдВрдзрд┐рдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдПрдХ рд╕реВрдЪреА рд▓реЗрддреЗ рд╣реИрдВ рдФрд░ рдЙрдирдХреА рджреГрд╢реНрдпрддрд╛ рдореЗрдВ рд╡реГрджреНрдзрд┐ / рдХрдореА рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЬрдм рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрдиреНрд╣реЗрдВ рд╕реВрдЪреА рдХреЛ рдЙрд╕рдХреЗ рдкреВрд▓ рдореЗрдВ рд╡рд╛рдкрд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IncreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> range</span></span></span><span class="hljs-function">)</span></span> { List&lt;HexCell&gt; cells = GetVisibleCells(fromCell, range); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Count; i++) { cells[i].IncreaseVisibility(); } ListPool&lt;HexCell&gt;.Add(cells); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> range</span></span></span><span class="hljs-function">)</span></span> { List&lt;HexCell&gt; cells = GetVisibleCells(fromCell, range); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Count; i++) { cells[i].DecreaseVisibility(); } ListPool&lt;HexCell&gt;.Add(cells); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ </font></font><code>HexUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреНрд░рд┐рдб рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдореЗрдВ рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдЬреЛрдбрд╝реЗрдВ </font></font><code>Grid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGrid Grid { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдЖрдк рдЧреНрд░рд┐рдб рдореЗрдВ рдПрдХ рд╕реНрдХреНрд╡рд╛рдб рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдЗрд╕ рд╕рдВрдкрддреНрддрд┐ рдХреЛ рдЧреНрд░рд┐рдб рдЕрд╕рд╛рдЗрди рдХрд░реЗрдЧрд╛ </font></font><code>HexGrid.AddUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddUnit</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexUnit unit, HexCell location, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> orientation</span></span></span><span class="hljs-function">)</span></span> { units.Add(unit); unit.Grid = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; unit.transform.SetParent(transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); unit.Location = location; unit.Orientation = orientation; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рддреАрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдХреА рд╕реАрдорд╛ рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо </font></font><code>HexUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдерд┐рд░рд╛рдВрдХ </font><font style="vertical-align: inherit;">рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">, рдЬреЛ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рд╣рдореЗрд╢рд╛ рдПрдХ рдЪрд░ рдореЗрдВ рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╣рдо рдЧреНрд░рд┐рдб рдХреЗ рд▓рд┐рдП рджрд╕реНрддреЗ рдХреЗ рдЖрд╣реНрд╡рд╛рди рдХреЗ рддрд░реАрдХреЗ рдмрдирд╛рдПрдВрдЧреЗ </font></font><code>IncreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>DecreaseVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреА рджреГрд╢реНрдпрддрд╛ рд╕реАрдорд╛ рдХреЛ рднреА рдкреНрд░реЗрд╖рд┐рдд рдХрд░реЗрдВрдЧреЗ, рди рдХрд┐ рдХреЗрд╡рд▓ рдЗрд╕ рд╕реНрдерд╛рди рдкрд░ рдЬрд╛рдПрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> visionRange = <span class="hljs-number"><span class="hljs-number">3</span></span>; тАж <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexCell Location { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> location; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location) { <span class="hljs-comment"><span class="hljs-comment">// location.DecreaseVisibility(); Grid.DecreaseVisibility(location, visionRange); location.Unit = null; } location = value; value.Unit = this; // value.IncreaseVisibility(); Grid.IncreaseVisibility(value, visionRange); transform.localPosition = value.Position; } } тАж public void Die () { if (location) { // location.DecreaseVisibility(); Grid.DecreaseVisibility(location, visionRange); } location.Unit = null; Destroy(gameObject); }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8cd/c45/ccb/8cdc45ccb01449b3c7d50a7bef9b249c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рд░реЗрдВрдЬ рд╡рд╛рд▓реА рдЗрдХрд╛рдЗрдпрд╛рдБ рдЬреЛ рдУрд╡рд░рд▓реИрдк рд╣реЛ рд╕рдХрддреА рд╣реИрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪрд▓рддреЗ рд╕рдордп рджреГрд╢реНрдпрддрд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд▓рд╣рд╛рд▓, рдЪрд╛рд▓ рдХрдорд╛рдВрдб рдХреЗ рдмрд╛рдж рджрд╕реНрддреЗ рдХреА рджреГрд╢реНрдпрддрд╛ рдХрд╛ рдХреНрд╖реЗрддреНрд░ рддреБрд░рдВрдд рдЕрдВрддрд┐рдо рдмрд┐рдВрджреБ рдкрд░ рдЯреЗрд▓реАрдкреЛрд░реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЗрдХрд╛рдИ рдФрд░ рдЙрд╕рдХреА рджреГрд╢реНрдпрддрд╛ рдХрд╛ рдХреНрд╖реЗрддреНрд░ рдПрдХ рд╕рд╛рде рдЪрд▓реЗ рддреЛ рдмреЗрд╣рддрд░ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдкрд╣рд▓рд╛ рдХрджрдо рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рдЕрдм рд╕рдВрдкрддреНрддрд┐ </font></font><code>Location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧ </font><font style="vertical-align: inherit;">рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ </font></font><code>HexUnit.Travel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо </font></font><code>location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрддреНрддрд┐ рдХреЛрдб рд╕реЗ рдмрдЪрддреЗ рд╣реБрдП </font><font style="vertical-align: inherit;">рд╕реАрдзреЗ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдмрджрд▓ рджреЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдкреБрд░рд╛рдиреЗ рд╕реНрдерд╛рди рдХреЛ рд╕рд╛рдлрд╝ рдХрд░ рджреЗрдВрдЧреЗ рдФрд░ рдПрдХ рдирдП рд╕реНрдерд╛рди рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдЕрдкрд░рд┐рд╡рд░реНрддрд┐рдд рд░рд╣реЗрдЧреАред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Travel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;HexCell&gt; path</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Location = path[path.Count - 1]; location.Unit = null; location = path[path.Count - 1]; location.Unit = this; pathToTravel = path; StopAllCoroutines(); StartCoroutine(TravelPath()); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд░рдЖрдЙрдЯ рдХреЗ рдЕрдВрджрд░, </font></font><code>TravelPath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдкреВрд░реНрдг рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рд╣реА рдкрд╣рд▓реА рд╕реЗрд▓ рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рдХрдо рдХрд░ рджреЗрдВрдЧреЗ </font></font><code>LookAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, рдПрдХ рдирдП рд╕реЗрд▓ рдореЗрдВ рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдЗрд╕ рд╕реЗрд▓ рд╕реЗ рджреГрд╢реНрдпрддрд╛ рдмрдврд╝рд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдлрд┐рд░ рд╕реЗ рджреГрд╢реНрдпрддрд╛ рдХрдо рдХрд░ рджреЗрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рдЕрдВрддрд┐рдо рд╕реЗрд▓ рд╕реЗ рджреГрд╢реНрдпрддрд╛ рдмрдврд╝рд╛рдПрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TravelPath</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Vector3 a, b, c = pathToTravel[<span class="hljs-number"><span class="hljs-number">0</span></span>].Position; <span class="hljs-comment"><span class="hljs-comment">// transform.localPosition = c; yield return LookAt(pathToTravel[1].Position); Grid.DecreaseVisibility(pathToTravel[0], visionRange); float t = Time.deltaTime * travelSpeed; for (int i = 1; i &lt; pathToTravel.Count; i++) { a = c; b = pathToTravel[i - 1].Position; c = (b + pathToTravel[i].Position) * 0.5f; Grid.IncreaseVisibility(pathToTravel[i], visionRange); for (; t &lt; 1f; t += Time.deltaTime * travelSpeed) { тАж } Grid.DecreaseVisibility(pathToTravel[i], visionRange); t -= 1f; } a = c; b = location.Position; // We can simply use the destination here. c = b; Grid.IncreaseVisibility(location, visionRange); for (; t &lt; 1f; t += Time.deltaTime * travelSpeed) { тАж } тАж }</span></span></code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдХрджрдо рдкрд░ рджреГрд╢реНрдпрддрд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╕рдм рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд╕рд┐рд╡рд╛рдп рдЬрдм рдПрдХ рдирдпрд╛ рдЖрджреЗрд╢ рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрдм рдЯреБрдХрдбрд╝реА рдЪрд▓рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдЯреЗрд▓реАрдкреЛрд░реНрдЯреЗрд╢рди рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рджреГрд╢реНрдпрддрд╛ рдкрд░ рднреА рд▓рд╛рдЧреВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдорд╣рд╕реВрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЪрд▓рддреЗ рд╕рдордп рджрд╕реНрддреЗ рдХреЗ рд╡рд░реНрддрдорд╛рди рд╕реНрдерд╛рди рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> HexCell location, currentTravelLocation;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рд╕реНрдерд╛рди рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╕рдордп рд╣рд░ рдмрд╛рд░ рдЬрдм рд╣рдо рдПрдХ рдирдП рд╕реЗрд▓ рд╕реЗ рдЯрдХрд░рд╛рддреЗ рд╣реИрдВ, рдЬрдм рддрдХ рдХрд┐ рд╕реНрдХреНрд╡рд╛рдб рдЕрдВрддрд┐рдо рд╕реЗрд▓ рддрдХ рдирд╣реАрдВ рдкрд╣реБрдВрдЪ рдЬрд╛рддрд╛ред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рдЗрд╕реЗ рд░реАрд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TravelPath</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; pathToTravel.Count; i++) { currentTravelLocation = pathToTravel[i]; a = c; b = pathToTravel[i - <span class="hljs-number"><span class="hljs-number">1</span></span>].Position; c = (b + currentTravelLocation.Position) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; Grid.IncreaseVisibility(pathToTravel[i], visionRange); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; t &lt; <span class="hljs-number"><span class="hljs-number">1f</span></span>; t += Time.deltaTime * travelSpeed) { transform.localPosition = Bezier.GetPoint(a, b, c, t); Vector3 d = Bezier.GetDerivative(a, b, c, t); dy = <span class="hljs-number"><span class="hljs-number">0f</span></span>; transform.localRotation = Quaternion.LookRotation(d); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } Grid.DecreaseVisibility(pathToTravel[i], visionRange); t -= <span class="hljs-number"><span class="hljs-number">1f</span></span>; } currentTravelLocation = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдмрд╛рд░реА рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, </font></font><code>TravelPath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдкрде рдХрд╛ рдкреБрд░рд╛рдирд╛ рдордзреНрдпрд╡рд░реНрддреА рд╕реНрдерд╛рди рдЬреНрдЮрд╛рдд рд╣реИ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рд╛рдБ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕ рд╕реЗрд▓ рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рдХрдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рди рдХрд┐ рдкрде рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">IEnumerator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TravelPath</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Vector3 a, b, c = pathToTravel[<span class="hljs-number"><span class="hljs-number">0</span></span>].Position; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LookAt</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pathToTravel[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">].Position</span></span></span><span class="hljs-function">)</span></span>; Grid.DecreaseVisibility( currentTravelLocation ? currentTravelLocation : pathToTravel[<span class="hljs-number"><span class="hljs-number">0</span></span>], visionRange ); тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рд╕реНрдХреНрд╡рд╛рдб рдХреЗ рдЖрдВрджреЛрд▓рди рдХреЗ рджреМрд░рд╛рди рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд░реАрдХреЙрдореНрдкрд┐рд▓реЗрд╢рди рдХреЗ рдмрд╛рдж рджреГрд╢реНрдпрддрд╛ рдХреЛ рд╕рд╣реА рдХрд░рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдордзреНрдпрд╡рд░реНрддреА рд╕реНрдерд╛рди рдЕрднреА рднреА рдЬреНрдЮрд╛рдд рд╣реИ, рддреЛ рдЙрд╕рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рдХрдо рдХрд░реЗрдВ рдФрд░ рдЕрдВрддрд┐рдо рдмрд┐рдВрджреБ рдкрд░ рджреГрд╢реНрдпрддрд╛ рдмрдврд╝рд╛рдПрдВ, рдФрд░ рдлрд┐рд░ рдордзреНрдпрд╡рд░реНрддреА рд╕реНрдерд╛рди рд░реАрд╕реЗрдЯ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location) { transform.localPosition = location.Position; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentTravelLocation) { Grid.IncreaseVisibility(location, visionRange); Grid.DecreaseVisibility(currentTravelLocation, visionRange); currentTravelLocation = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХреЛрдВ рдФрд░ рдкрд╛рдиреА рдХреА рджреГрд╢реНрдпрддрд╛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐ рд░рд╛рд╣рдд рд░рдВрдЧ рдкрд░рд┐рд╡рд░реНрддрди рджреГрд╢реНрдпрддрд╛ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдбрд╝рдХреЛрдВ рдФрд░ рдкрд╛рдиреА рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╡реЗ рдЕрджреГрд╢реНрдп рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЙрдЬреНрдЬреНрд╡рд▓ рджрд┐рдЦрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЛрдВ рдФрд░ рдкрд╛рдиреА рдХреЗ рд▓рд┐рдП рджреГрд╢реНрдпрддрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд╕реЗрд▓ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдФрд░ рдЙрдирдХреЗ рдЬрд╛рд▓ рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рд╡рдЬрди рдорд┐рд╢реНрд░рдг рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо </font><em><font style="vertical-align: inherit;">рдкреНрд░реАрдлреИрдм</font></em><font style="vertical-align: inherit;"> рдЯреБрдХрдбрд╝рд╛ </font><font style="vertical-align: inherit;">рдХреЗ </font><em><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ</font></em><font style="vertical-align: inherit;"> , </font><em><font style="vertical-align: inherit;">рд╕рдбрд╝рдХреЛрдВ</font></em><font style="vertical-align: inherit;"> , </font><em><font style="vertical-align: inherit;">рдкрд╛рдиреА</font></em><font style="vertical-align: inherit;"> , </font><em><font style="vertical-align: inherit;">рдкрд╛рдиреА рд╢реЛрд░</font></em><font style="vertical-align: inherit;"> рдФрд░ </font><em><font style="vertical-align: inherit;">рдЕрдиреБрдорд╛рдиреЛрдВ рдХреЗ</font></em><font style="vertical-align: inherit;"> рд▓рд┐рдП </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рд╕реЗрд▓ рдбреЗрдЯрд╛</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЗ рдмрдЪреНрдЪреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдбрд╝рдХреЛрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рд╕рдбрд╝рдХреЛрдВ рд╕реЗ рд╢реБрд░реБрдЖрдд рдХрд░реЗрдВрдЧреЗред </font></font><code>HexGridChunk.TriangulateRoadEdge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рд╕рдбрд╝рдХ рдХрд╛ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рд╣рд┐рд╕реНрд╕рд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдПрдХ рд╕реЗрд▓ рдЗрдВрдбреЗрдХреНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдореЗрдВ рдПрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рддреНрд░рд┐рдХреЛрдг рдХреЗ рд▓рд┐рдП рд╕реЗрд▓ рдбреЗрдЯрд╛ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadEdge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 center, Vector3 mL, Vector3 mR, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index </span></span></span><span class="hljs-function">)</span></span> { roads.AddTriangle(center, mL, mR); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); Vector3 indices; indices.x = indices.y = indices.z = index; roads.AddTriangleCellData(indices, weights1); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХ рдмрдирд╛рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реИ </font></font><code>TriangulateRoadSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдЕрдВрджрд░ рдФрд░ рдмреАрдЪ рджреЛрдиреЛрдВ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЕрдиреБрдХреНрд░рдорд┐рддреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП, рд╕реВрдЪрдХрд╛рдВрдХ рд╡реЗрдХреНрдЯрд░ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рд╕рдбрд╝рдХ рдЦрдВрдб рдкреБрд░реНрдЬреЛрдВ рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рд╡рдЬрд╝рди рдХреЛ рднреА рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, Vector3 v5, Vector3 v6, Color w1, Color w2, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { roads.AddQuad(v1, v2, v4, v5); roads.AddQuad(v2, v3, v5, v6); roads.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); roads.AddQuadUV(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); roads.AddQuadCellData(indices, w1, w2); roads.AddQuadCellData(indices, w1, w2); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВ </font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬреЛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдЕрдВрджрд░ рд╕рдбрд╝рдХ рдмрдирд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдореЗрдВ рдПрдХ рдЗрдВрдбреЗрдХреНрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рднреА рдЬрд░реВрд░рдд рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╡рд╣ рдЗрд╕ рдбреЗрдЯрд╛ рдХреЛ рдЕрдкрдиреЗ рджреНрд╡рд╛рд░рд╛ рдХреЙрд▓ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕рдбрд╝рдХ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдкрд╛рд╕ рднреЗрдЬрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕реЗ рдЙрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП рддреНрд░рд┐рдХреЛрдг рдореЗрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 center, Vector3 mL, Vector3 mR, EdgeVertices e, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoadThroughCellEdge, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRoadThroughCellEdge) { Vector3 indices; indices.x = indices.y = indices.z = index; Vector3 mC = Vector3.Lerp(mL, mR, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); TriangulateRoadSegment( mL, mC, mR, e.v2, e.v3, e.v4, weights1, weights1, indices ); roads.AddTriangle(center, mL, mC); roads.AddTriangle(center, mC, mR); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); roads.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); roads.AddTriangleCellData(indices, weights1); roads.AddTriangleCellData(indices, weights1); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateRoadEdge(center, mL, mR, index); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ </font><font style="vertical-align: inherit;">рд╕рднреА рд╕рдВрдХрд▓рдХ рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП </font></font><code>TriangulateRoad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>TriangulateRoadEdge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>TriangulateRoadSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">рдЖрд╡рд╢реНрдпрдХ рд╡рд┐рдзрд┐ рддрд░реНрдХ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдиреА рд╣реБрдИ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithoutRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { TriangulateEdgeFan(center, e, cell.Index); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRoads) { Vector2 interpolators = GetRoadInterpolators(direction, cell); TriangulateRoad( center, Vector3.Lerp(center, e.v1, interpolators.x), Vector3.Lerp(center, e.v5, interpolators.y), e, cell.HasRoadThroughEdge(direction), cell.Index ); } } тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж TriangulateRoad(roadCenter, mL, mR, e, hasRoadThroughEdge, cell.Index); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { TriangulateRoadEdge(roadCenter, center, mL, cell.Index); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextHasRiver) { TriangulateRoadEdge(roadCenter, mR, center, cell.Index); } } тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEdgeStrip</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> тАж </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRoad) { TriangulateRoadSegment( e1.v2, e1.v3, e1.v4, e2.v2, e2.v3, e2.v4, w1, w2, indices ); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдореЗрд╖ рдбреЗрдЯрд╛ рд╕рд╣реА рд╣реИ, рдФрд░ рд╣рдо </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдб</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ рдкрд░ рдЖрдЧреЗ рдмрдврд╝реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рд╢реАрд░реНрд╖ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреА рдЬрд░реВрд░рдд рд╣реИ рдФрд░ рдЗрд╕рдореЗрдВ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HexCellData</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs css"> <span class="hljs-selector-id"><span class="hljs-selector-id">#pragma</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">surface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">surf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Standard</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fullforwardshadows</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">decal</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:blend</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vertex</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:vert</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#pragma</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">target</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#include</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">HexCellData</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cginc</span></span>"</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪреВрдВрдХрд┐ рд╣рдо рдХрдИ рд╕рд╛рдордЧреНрд░рд┐рдпреЛрдВ рдХрд╛ рдорд┐рд╢реНрд░рдг рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдЯреБрдХрдбрд╝рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рдХреЗ рдПрдХ рд╕рдВрдХреЗрддрдХ рдХреЛ рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред </font></font><br><br><pre> <code class="hljs cpp"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> {</span></span> float2 uv_MainTex; float3 worldPos; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> visibility; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рджреЛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рд╕реЗ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдП рд╡рд░реНрдЯреЗрдХреНрд╕ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рддреБрд░рдВрдд рдЙрдирдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рдорд┐рд▓рд╛рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); data.visibility = cell0.x * v.color.x + cell1.x * v.color.y; data.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЯреБрдХрдбрд╝реЗ рдХреЗ рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ, рд╣рдореЗрдВ рдХреЗрд╡рд▓ рд░рдВрдЧ рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); fixed4 c = _Color * ((noise.y * <span class="hljs-number"><span class="hljs-number">0.75</span></span> + <span class="hljs-number"><span class="hljs-number">0.25</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility); тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af8/92f/46e/af892f46e364906cc547aaecb4e50e3a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдХреЗ рд╕рд╛рде рд╕рдбрд╝рдХреЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЦреБрд▓рд╛ рдкрд╛рдиреА </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдРрд╕рд╛ рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рджреГрд╢реНрдпрддрд╛ рдкрд╣рд▓реЗ рд╣реА рдкрд╛рдиреА рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░ рдЪреБрдХреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╕рд┐рд░реНрдл рдкрд╛рдиреА рдореЗрдВ рдбреВрдмреЗ рдЗрд▓рд╛рдХреЗ рдХреА рд╕рддрд╣ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП, рджреГрд╢реНрдпрддрд╛ рдХреЛ рдЦреБрд▓реЗ рдкрд╛рдиреА рдореЗрдВ рд▓рд╛рдЧреВ рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдмрджрд▓рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ </font></font><code>HexGridChunk.TriangulateOpenWater</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateOpenWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { тАж water.AddTriangle(center, c1, c2); Vector3 indices; indices.x = indices.y = indices.z = cell.Index; water.AddTriangleCellData(indices, weights1); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE &amp;&amp; neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { тАж water.AddQuad(c1, c2, e1, e2); indices.y = neighbor.Index; water.AddQuadCellData(indices, weights1, weights2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E) { тАж water.AddTriangle( c2, e2, c2 + HexMetrics.GetWaterBridge(direction.Next()) ); indices.z = nextNeighbor.Index; water.AddTriangleCellData( indices, weights1, weights2, weights3 ); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдореЗрдВ рддрдЯреЛрдВ рдХреЗ рдкрд╛рд╕ рддреНрд░рд┐рдХреЛрдг рдХреЗ рдкреНрд░рд╢рдВрд╕рдХреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реЗрд▓ рдбреЗрдЯрд╛ рдЬреЛрдбрд╝рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { тАж water.AddTriangle(center, e1.v1, e1.v2); water.AddTriangle(center, e1.v2, e1.v3); water.AddTriangle(center, e1.v3, e1.v4); water.AddTriangle(center, e1.v4, e1.v5); Vector3 indices; indices.x = indices.y = indices.z = cell.Index; water.AddTriangleCellData(indices, weights1); water.AddTriangleCellData(indices, weights1); water.AddTriangleCellData(indices, weights1); water.AddTriangleCellData(indices, weights1); тАж }</code> </pre> <br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдЯрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдб </font><font style="vertical-align: inherit;">рдХреЛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдб</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ рдХреЗ рд╕рдорд╛рди рд╣реА рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рджреЛ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рддреАрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рдорд┐рд▓рд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред</font></font><br><br><pre> <code class="hljs pgsql"> #pragma surface surf Standard alpha vertex:vert #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "HexCellData.cginc" sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float3 worldPos; <span class="hljs-type"><span class="hljs-type">float</span></span> visibility; }; тАж <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell2 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">2</span></span>); data.visibility = cell0.x * v.color.x + cell1.x * v.color.y + cell2.x * v.color.z; data.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility); } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> waves = Waves(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); fixed4 c = saturate(_Color + waves); o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility; тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a4/c52/36c/6a4c5236c52eaae78cbde54fb2fdeeac.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдХреЗ рд╕рд╛рде рдЦреБрд▓рд╛ рдкрд╛рдиреАред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рддрдЯ рдФрд░ рдореБрд╣рд╛рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрдЯ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдлрд┐рд░ рд╕реЗ рдмрджрд▓рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ </font></font><code>HexGridChunk.TriangulateWaterShore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╣реА рдПрдХ рдЗрдВрдбреЗрдХреНрд╕ рд╡реЗрдХреНрдЯрд░ рдмрдирд╛рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдордиреЗ рдЦреБрд▓реЗ рдкрд╛рдиреА рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдПрдХ рд╕реЗрд▓ рдЗрдВрдбреЗрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рддрдЯ рдХреЛ рдкрдбрд╝реЛрд╕реА рд╕реВрдЪрдХрд╛рдВрдХ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХреЛрдб рдмрджрд▓реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> Vector3 indices; <span class="hljs-comment"><span class="hljs-comment">// indices.x = indices.y = indices.z = cell.Index; indices.x = indices.z = cell.Index; indices.y = neighbor.Index;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХреЛ рдХреНрд╡рд╛рдбреНрд╕ рдФрд░ рддрдЯ рдХреЗ рддреНрд░рд┐рдХреЛрдг рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдХреЙрд▓ рдкрд░ рдЗрдВрдбреЗрдХреНрд╕ рднреА рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>TriangulateEstuary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { TriangulateEstuary( e1, e2, cell.IncomingRiver == direction, indices ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { тАж waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadCellData(indices, weights1, weights2); waterShore.AddQuadCellData(indices, weights1, weights2); waterShore.AddQuadCellData(indices, weights1, weights2); waterShore.AddQuadCellData(indices, weights1, weights2); } HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { тАж waterShore.AddTriangleUV( тАж ); indices.z = nextNeighbor.Index; waterShore.AddTriangleCellData( indices, weights1, weights2, weights3 ); }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>TriangulateEstuary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрдЯ рдФрд░ рдореБрдВрд╣ рдХреЗ рд▓рд┐рдП рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреЗрдЦрднрд╛рд▓ </font><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдордд рднреВрд▓реЛ рдХрд┐ рдореБрдВрд╣ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рддрдЯ рдХреЗ рджреЛ рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХреЗ рд╕рд╛рде рдЯреНрд░реЗрдкреЗрдЬрд╝реЙрдЗрдб рд╕реЗ рдмрдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╡рдЬрди рд╕рд╣реА рдХреНрд░рдо рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рд╣реЛред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, EdgeVertices e2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> incomingRiver, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { waterShore.AddTriangle(e2.v1, e1.v2, e1.v1); waterShore.AddTriangle(e2.v5, e1.v5, e1.v4); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); waterShore.AddTriangleCellData(indices, weights2, weights1, weights1); waterShore.AddTriangleCellData(indices, weights2, weights1, weights1); estuaries.AddQuad(e2.v1, e1.v2, e2.v2, e1.v3); estuaries.AddTriangle(e1.v3, e2.v2, e2.v4); estuaries.AddQuad(e1.v3, e1.v4, e2.v4, e2.v5); estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); estuaries.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddQuadCellData( indices, weights2, weights1, weights2, weights1 ); estuaries.AddTriangleCellData(indices, weights1, weights2, weights2); estuaries.AddQuadCellData(indices, weights1, weights2); тАж }</code> </pre> <br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдЯрд░рд╢реЛрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ рдореЗрдВ, </font><em><font style="vertical-align: inherit;">рдЖрдкрдХреЛ рддреАрди рд╢реЗрдбреНрд╕</font></em><font style="vertical-align: inherit;"> рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рдорд┐рд▓рд╛рдХрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдЯрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ рдореЗрдВ рд╕рдорд╛рди рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ </font><font style="vertical-align: inherit;">рд╣реЛрддреА рд╣реИред</font></font><br><br><pre> <code class="hljs pgsql"> #pragma surface surf Standard alpha vertex:vert #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "HexCellData.cginc" sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float3 worldPos; <span class="hljs-type"><span class="hljs-type">float</span></span> visibility; }; тАж <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell2 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">2</span></span>); data.visibility = cell0.x * v.color.x + cell1.x * v.color.y + cell2.x * v.color.z; data.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility); } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { тАж fixed4 c = saturate(_Color + max(foam, waves)); o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility; тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scheider </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА рдХреЗ рдореБрд╣рд╛рдиреЗ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреЛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдШреЛрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рджреГрд╢реНрдпрддрд╛, рд╕рд╛рде рд╣реА рд╢реЗрдбрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдб рдЬрдирд░рд▓ рд╡рд┐рд╡рд░рдг</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рд╢реАрд░реНрд╖ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ рдирджрд┐рдпреЛрдВ рдХреЗ рдпреВрд╡реА-рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рдкреНрд░рд╕рд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="hljs pgsql"> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "HexCellData.cginc" sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float2 riverUV; float3 worldPos; <span class="hljs-type"><span class="hljs-type">float</span></span> visibility; }; half _Glossiness; half _Metallic; fixed4 _Color; <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> o) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, o); o.riverUV = v.texcoord1.xy; <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); o.visibility = cell0.x * v.color.x + cell1.x * v.color.y; o.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, o.visibility); } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { тАж fixed4 c = saturate(_Color + water); o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility; тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88f/829/254/88f829254235a293040ac755d8318bc3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдХреЗ рд╕рд╛рде рддрдЯ рдФрд░ рдореБрд╣рд╛рдирд╛ред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирджреА </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЕрдВрддрд┐рдо рдЬрд▓ рдХреНрд╖реЗрддреНрд░ рд╣реИрдВред </font></font><code>HexGridChunk.TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ </font><font style="vertical-align: inherit;">рдПрдХ </font><font style="vertical-align: inherit;">рдЗрдВрдбреЗрдХреНрд╕ рд╡реЗрдХреНрдЯрд░ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЗрд╕реЗ рдореЗрд╖ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ рддрд╛рдХрд┐ рдпрд╣ рджреЛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рдмрдирд╛рдП рд░рдЦ рд╕рдХреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { TriangulateRiverQuad(v1, v2, v3, v4, y, y, v, reversed, indices); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRiverQuad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reversed, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { тАж rivers.AddQuadCellData(indices, weights1, weights2); }</code> </pre> <br> <code>TriangulateWithRiverBeginOrEnd</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рдПрдХ рдХреНрд╡рд╛рдб рдФрд░ рдПрдХ рддреНрд░рд┐рдХреЛрдг рдХреЗ рд╕рд╛рде рдирджреА рд╕рдорд╛рдкрди рдмрд┐рдВрджреБ рдмрдирд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╕реЗрд▓ рдбреЗрдЯрд╛ рдЬреЛрдбрд╝реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiverBeginOrEnd</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.HasIncomingRiver; Vector3 indices; indices.x = indices.y = indices.z = cell.Index; TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, reversed, indices ); center.y = m.v2.y = m.v4.y = cell.RiverSurfaceY; rivers.AddTriangle(center, m.v2, m.v4); тАж rivers.AddTriangleCellData(indices, weights1); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрди рд╕реЗрд▓ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдореЗрдВ рд╣реИрдВ </font></font><code>TriangulateWithRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЙрдиреНрд╣реЗрдВ рдХреЙрд▓ рдкрд░ рдкрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>TriangulateRiverQuad</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.IncomingRiver == direction; TriangulateRiverQuad( centerL, centerR, m.v2, m.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>, reversed, indices ); TriangulateRiverQuad( m.v2, m.v4, e.v2, e.v4, cell.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, reversed, indices ); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдЙрди рдЭрд░рдиреЛрдВ рдореЗрдВ рд╕реВрдЪрдХрд╛рдВрдХ рд╕рдорд░реНрдерди рднреА рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдЬреЛ рдЧрд╣рд░реЗ рдкрд╛рдиреА рдореЗрдВ рдбрд╛рд▓рддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterfallInWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> waterY, Vector3 indices </span></span></span><span class="hljs-function">)</span></span> { тАж rivers.AddQuadCellData(indices, weights1, weights2); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЕрдВрдд рдореЗрдВ, рдЗрд╕реЗ рдмрджрд▓ рджреЗрдВ </font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рдирджрд┐рдпреЛрдВ рдФрд░ рдЭрд░рдиреЛрдВ рдХреА рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЕрдиреБрдХреНрд░рдорд┐рдд рд╣реЛ рдЬрд╛рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRiver) { e2.v3.y = neighbor.StreamBedY; Vector3 indices; indices.x = indices.z = cell.Index; indices.y = neighbor.Index; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!neighbor.IsUnderwater) { TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction, indices ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.Elevation &gt; neighbor.WaterLevel) { TriangulateWaterfallInWater( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, neighbor.WaterSurfaceY, indices ); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !neighbor.IsUnderwater &amp;&amp; neighbor.Elevation &gt; cell.WaterLevel ) { TriangulateWaterfallInWater( e2.v4, e2.v2, e1.v4, e1.v2, neighbor.RiverSurfaceY, cell.RiverSurfaceY, cell.WaterSurfaceY, indices ); } } тАж }</code> </pre> <br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рд╡рд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реИрдбрд░ </font><font style="vertical-align: inherit;">рдХреЛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдб</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реИрдбрд░ рдХреЗ рд╕рдорд╛рди рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs pgsql"> #pragma surface surf Standard alpha vertex:vert #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "HexCellData.cginc" sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; <span class="hljs-type"><span class="hljs-type">float</span></span> visibility; }; тАж <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell0 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-type"><span class="hljs-type">float4</span></span> cell1 = GetCellData(v, <span class="hljs-number"><span class="hljs-number">1</span></span>); data.visibility = cell0.x * v.color.x + cell1.x * v.color.y; data.visibility = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility); } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex, _MainTex); fixed4 c = saturate(_Color + river); o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility; тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ef/db6/76a/1efdb676afe28b61b73f317d25158505.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдХреЗ рд╕рд╛рде рдирджрд┐рдпрд╛рдБред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╕реНрддреБрдУрдВ рдФрд░ рджреГрд╢реНрдпрддрд╛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рджреГрд╢реНрдпрддрд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЙрддреНрдкрдиреНрди рдЗрд▓рд╛рдХреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЕрднреА рддрдХ рдпрд╣ рдЗрд▓рд╛рдХреЗ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рддреА рд╣реИред рдЗрдорд╛рд░рддреЗрдВ, рдЦреЗрдд рдФрд░ рдкреЗрдбрд╝ рдкреНрд░реАрдлрд╝реИрдм рд╕реЗ рдмрдирд╛рдП рдЧрдП рд╣реИрдВ, рди рдХрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рдЬреНрдпрд╛рдорд┐рддрд┐ рд╕реЗ, рдЗрд╕рд▓рд┐рдП рд╣рдо рд╕реЗрд▓ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреЛ рдирд╣реАрдВ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдирдХреЗ рд╢реАрд░реНрд╖реЛрдВ рдХреЗ рд╕рд╛рде рд╡рдЬрди рдорд┐рд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред рдЪреВрдВрдХрд┐ рдЗрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗрд╡рд▓ рдПрдХ рд╕реЗрд▓ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╡реЗ рдХрд┐рд╕ рд╕реЗрд▓ рдореЗрдВ рд╣реИрдВред рдпрджрд┐ рд╣рдо рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рд╕рдВрдмрдВрдзрд┐рдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗ рдФрд░ рджреГрд╢реНрдпрддрд╛ рд▓рд╛рдЧреВ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рджреБрдирд┐рдпрд╛ рдХреЗ XZ рдкрджреЛрдВ рдХреЛ рд╕реЗрд▓ рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдореЗрдВ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдкрд░рд┐рд╡рд░реНрддрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрд▓рд╛рдХреЗ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдФрд░ рджрд╕реНрддреЛрдВ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╕рдВрдмрдВрдзрд┐рдд рдХреЛрдб nontrivial рд╣реИред рдпрд╣ рдкреВрд░реНрдгрд╛рдВрдХ рд╕рдВрдЪрд╛рд▓рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддрд░реНрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдпрд╣ рдПрдХ shader рдХреЗ рд▓рд┐рдП рдЕрд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдПрдХ рдмрдирд╛рд╡рдЯ рдореЗрдВ рддрд░реНрдХ рдХреЗ рдереЛрдХ рдХреЛ рд╕реЗрдВрдХрдирд╛ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕реНрдерд▓рд╛рдХреГрддрд┐ рдкрд░ рдЧреНрд░рд┐рдб рдХреЛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реЗрдХреНрд╕рд╛рдЧреЛрдирд▓ рдкреИрдЯрд░реНрди рдХреЗ рд╕рд╛рде рдПрдХ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВред рдпрд╣ рдмрдирд╛рд╡рдЯ 2 ├Ч 2 рдХреЗ рд╕реЗрд▓ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИред рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЖрд╕рд╛рдиреА рд╕реЗ рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдХрд┐рд╕ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╣реИрдВред рдЙрд╕рдХреЗ рдмрд╛рдж, рдЖрдк рдЗрд╕ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП X рдФрд░ Z рдСрдлрд╕реЗрдЯ рдпреБрдХреНрдд рдмрдирд╛рд╡рдЯ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕ рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрд╕ рд╕реЗрд▓ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рд╣рдо рд╕реНрдерд┐рдд рд╣реИрдВред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдПрдХ рд╕рдорд╛рди рдмрдирд╛рд╡рдЯ рд╣реИред X рдСрдлрд╕реЗрдЯ рдХреЛ рдЙрд╕рдХреЗ рд▓рд╛рд▓ рдЪреИрдирд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ Z рдСрдлрд╕реЗрдЯ рдХреЛ рдЧреНрд░реАрди рдЪреИрдирд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЪреВрдВрдХрд┐ рдпрд╣ 2 ├Ч 2 рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдХрд╡рд░ рдХрд░рддрд╛ рд╣реИ, рд╣рдореЗрдВ 0 рдФрд░ 2 рд╕реЗ рдСрдлрд╕реЗрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЗрд╕ рддрд░рд╣ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рд░рдВрдЧреАрди рдЪреИрдирд▓ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдСрдлрд╕реЗрдЯ рдЖрдзреЗ рд╕реЗ рдХрдо рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред рд╣рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд╕реНрдкрд╖реНрдЯ рдХрд┐рдирд╛рд░реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ рдЫреЛрдЯреА рд╕реА рдмрдирд╛рд╡рдЯ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/795/63c/d3c/79563cd3c22e7aa2ca66e40b5ffe3f7e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреНрд░рд┐рдб рдХреА рдмрдирд╛рд╡рдЯ рд╕рдордиреНрд╡рдп рдХрд░рддреА рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдмрдирд╛рд╡рдЯ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдЕрдиреНрдп рдЬрд╛рд▓ рдмрдирд╛рд╡рдЯ рдХреА рддрд░рд╣, </font><em><font style="vertical-align: inherit;">рджреЛрд╣рд░рд╛рдиреЗ рдХреЗ</font></em><font style="vertical-align: inherit;"> рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЗрд╕рдХреА </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рдкреЗрдЯ рдореЛрдб</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрдЯ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдХрд┐рд╕реА рднреА рдорд┐рд╢реНрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП </font><em><font style="vertical-align: inherit;">рдмреНрд▓реЗрдВрдб рдореЛрдб рдХреЗ рд▓рд┐рдП</font></em><font style="vertical-align: inherit;"> рд╣рдо </font><em><font style="vertical-align: inherit;">рдкреНрд╡рд╛рдЗрдВрдЯ</font></em><font style="vertical-align: inherit;"> рдЪреБрдиреЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ </font><em><font style="vertical-align: inherit;">рд╕рдВрдкреАрдбрд╝рди рдХреЛ</font></em><font style="vertical-align: inherit;"> рдмрдВрдж рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдбреЗрдЯрд╛ рд╡рд┐рдХреГрдд рди рд╣реЛред </font><em><font style="vertical-align: inherit;">SRGB</font></em><font style="vertical-align: inherit;"> рдореЛрдб рдХреЛ рдмрдВрдж рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдЬрдм рд░реИрдЦрд┐рдХ рдореЛрдб рдореЗрдВ рдкреНрд░рддрд┐рдкрд╛рджрди рдХрд┐рдпрд╛ рдЬрд╛рдП, рддреЛ рдХреЛрдИ рд░рдВрдЧ рд╕реНрдерд╛рди рд░реВрдкрд╛рдВрддрд░рдг рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдФрд░ рдЕрдВрдд рдореЗрдВ, рд╣рдореЗрдВ рдПрдордЖрдИрдкреА рдмрдирд╛рд╡рдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/866/aa9/de3/866aa9de36f6953f54d4fb8197fb75ff.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрдирд╛рд╡рдЯ рдЖрдпрд╛рдд рд╡рд┐рдХрд▓реНрдкред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреГрд╢реНрдпрддрд╛ рдХреЗ рд╕рд╛рде рдСрдмреНрдЬреЗрдХреНрдЯ рд╢реИрдбрд░ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╕реНрддреБрдУрдВ рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рд╕рдорд░реНрдерди рдЬреЛрдбрд╝рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдПрдХ рдирдпрд╛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝реАрдЪрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ рдмрдирд╛рдПрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рд╡рд░реНрдЯреЗрдХреНрд╕ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рд╕рд░рд▓ рд╕рддрд╣ рд╢реЗрдбрд░ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдореЗрдВ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HexCellData</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">рдФрд░ рдлрд╝реНрд░реЗрдЧреНрдореЗрдВрдЯреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рд▓рд┐рдП рджреГрд╢реНрдпрддрд╛ рд╕рдВрдХреЗрддрдХ рдХреЛ рдкрд╛рд╕ рдХрд░реЗрдВ, рдФрд░ рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рдЗрд╕реЗ рд░рдВрдЧ рдореЗрдВ </font><em><font style="vertical-align: inherit;">рдорд╛рдиреЗрдВ</font></em><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ </font></font><code>GetCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпреЛрдВрдХрд┐ рдЖрд╡рд╢реНрдпрдХ рдЬрд╛рд▓ рдбреЗрдЯрд╛ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рджреБрдирд┐рдпрд╛ рдореЗрдВ рдПрдХ рд╕реНрдерд┐рддрд┐ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрднреА рдХреЗ рд▓рд┐рдП, рджреГрд╢реНрдпрддрд╛ рдХреЛ 1 рдХреЗ рдмрд░рд╛рдмрд░ рдЫреЛрдбрд╝ рджреЗрдВред</font></font><br><br><pre> <code class="hljs pgsql">Shader "Custom/Feature" { Properties { _Color ("Color", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex ("Albedo (RGB)", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Glossiness ("Smoothness", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.5</span></span> _Metallic ("Metallic", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> [NoTilingOffset] _GridCoordinates ("Grid Coordinates", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} } SubShader { Tags { "RenderType"="Opaque" } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM #pragma surface surf Standard fullforwardshadows vertex:vert #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "../HexCellData.cginc" sampler2D _MainTex, _GridCoordinates; half _Glossiness; half _Metallic; fixed4 _Color; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; <span class="hljs-type"><span class="hljs-type">float</span></span> visibility; }; <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); float3 pos = mul(unity_ObjectToWorld, v.vertex); data.visibility = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = tex2D (_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex) * _Color; o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; } ENDCG } FallBack "Diffuse" }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд╕реНрддреБрдУрдВ рдХреА рд╕рднреА рд╕рд╛рдордЧреНрд░рд┐рдпреЛрдВ рдХреЛ рдмрджрд▓реЗрдВ рддрд╛рдХрд┐ рд╡реЗ рдирдП рд╢реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЧреНрд░рд┐рдб рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рдмрдирд╛рд╡рдЯ рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e35/fad/546/e35fad5469e6c9e5c6a31626ba182ec8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрд╖ рдмрдирд╛рд╡рдЯ рдХреЗ рд╕рд╛рде рд╢рд╣рд░реАред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрд▓ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдБрдЪреЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реАрд░реНрд╖ рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рдЧреНрд░рд┐рдб рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдлрд┐рд░ рд╕реЗ </font></font><code>tex2Dlod</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд╛рд░-рдШрдЯрдХ рдмрдирд╛рд╡рдЯ рд╕рдордиреНрд╡рдп рд╡реЗрдХреНрдЯрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рджреЛ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ XZ рджреБрдирд┐рдпрд╛ рдХреА рд╕реНрдерд┐рддрд┐ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдиреНрдп рджреЛ рдкрд╣рд▓реЗ рдХреА рддрд░рд╣ рд╢реВрдиреНрдп рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, data); float3 pos = mul(unity_ObjectToWorld, v.vertex); <span class="hljs-type"><span class="hljs-type">float4</span></span> gridUV = <span class="hljs-type"><span class="hljs-type">float4</span></span>(pos.xz, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); data.visibility = <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреИрд╕реЗ рдХрд┐ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЗрд░реЗрди</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ рдореЗрдВ </font><font style="vertical-align: inherit;">, рд╣рдо рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рдЦреАрдВрдЪрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдмрдирд╛рд╡рдЯ рд╣реЗрдХреНрд╕рд╛рдЧреЛрдиреНрд╕ рдХреА рдЧреНрд░рд┐рдб рдХреЗ рдЕрдиреБрд░реВрдк рд╕рд╣реА рдкрд╣рд▓реВ рдЕрдиреБрдкрд╛рдд рд╣реЛред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float4</span></span> gridUV = <span class="hljs-type"><span class="hljs-type">float4</span></span>(pos.xz, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); gridUV.x *= <span class="hljs-number"><span class="hljs-number">1</span></span> / (<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-number"><span class="hljs-number">8.66025404</span></span>); gridUV.y *= <span class="hljs-number"><span class="hljs-number">1</span></span> / (<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-number"><span class="hljs-number">15.0</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ 2 ├Ч 2 рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдХрд┐рд╕ рднрд╛рдЧ рдореЗрдВ рд╣рдо рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рдорд╛рди рдХреЛ рдиреАрдЪреЗ рд▓реЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рд▓рд┐рдП рдЖрдзрд╛рд░ рдмрдирд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float4</span></span> gridUV = <span class="hljs-type"><span class="hljs-type">float4</span></span>(pos.xz, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); gridUV.x *= <span class="hljs-number"><span class="hljs-number">1</span></span> / (<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-number"><span class="hljs-number">8.66025404</span></span>); gridUV.y *= <span class="hljs-number"><span class="hljs-number">1</span></span> / (<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-number"><span class="hljs-number">15.0</span></span>); float2 cellDataCoordinates = floor(gridUV.xy);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрд╕ рдХрдХреНрд╖ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рд╕рдореЗрдВ рд╣рдо рд╣реИрдВ, рд╣рдо рдмрдирд╛рд╡рдЯ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╡рд┐рд╕реНрдерд╛рдкрди рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="hljs pgsql"> float2 cellDataCoordinates = floor(gridUV.xy) + tex2Dlod(_GridCoordinates, gridUV).rg;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪреВрдВрдХрд┐ рдЧреНрд░рд┐рдб рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдЖрдХрд╛рд░ рдореЗрдВ 2 ├Ч 2 рд╣реИ, рдФрд░ рдСрдлрд╕реЗрдЯ рдХреЛ рдЖрдзрд╛ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╣рдореЗрдВ рдЕрдВрддрд┐рдо рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдгрд╛рдо рдХреЛ рджреЛрдЧреБрдирд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">float2</span></span> cellDataCoordinates = floor(gridUV.xy) + tex2Dlod(_GridCoordinates, gridUV).rg; <span class="hljs-attribute"><span class="hljs-attribute">cellDataCoordinates</span></span> *= <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╕реЗрд▓ рдЧреНрд░рд┐рдб рдХреЗ рдПрдХреНрд╕рдЬреЗрдб рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдореЗрдВ рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдХреЗрд╡рд▓ рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рдХреЗрдВрджреНрд░реЛрдВ рдореЗрдВ рдЬрд╛рдиреЗ рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рдмрдирд╛рд╡рдЯ рдХреЗ рдЖрдХрд╛рд░ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рддреЛ рдЪрд▓рд┐рдП рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ </font><font style="vertical-align: inherit;">рдлрдВрдХреНрд╢рди </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рддреЗ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реИрдВ </font><em><font style="vertical-align: inherit;">HexCellData</font></em><font style="vertical-align: inherit;"> рдореЗрдВ </font><font style="vertical-align: inherit;">рд╡рд╣ </font><font style="vertical-align: inherit;">рдлрд╛рдЗрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИ </font><font style="vertical-align: inherit;">рдЬреЛ рд╕реИрдВрдкрд▓рд┐рдВрдЧ рдХреЛ рднреА рд╣реИрдВрдбрд▓ рдХрд░реЗрдЧреАред</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (float2 cellDataCoordinates) { float2 uv = cellDataCoordinates + <span class="hljs-number"><span class="hljs-number">0.5</span></span>; uv.x *= _HexCellData_TexelSize.x; uv.y *= _HexCellData_TexelSize.y; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tex2Dlod(_HexCellData, <span class="hljs-type"><span class="hljs-type">float4</span></span>(uv, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рд╢реАрд░реНрд╖ рд╢реЗрдбрд░ рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝реАрдЪрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред</font></font><br><br><pre> <code class="hljs haskell"> cellDataCoordinates *= <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.visibility = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetCellData</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cellDataCoordinates</span></span></span><span class="hljs-class">).x; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.visibility = lerp(0.25, 1, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">visibility</span></span></span><span class="hljs-class">);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ed/9c9/7ed/1ed9c97ed37aa88aaee6c0efd9d075d7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рд╡рд╛рд▓реА рд╡рд╕реНрддреБрдПрдВред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдВрдд рдореЗрдВ, рджреГрд╢реНрдпрддрд╛ рдкреВрд░реЗ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреА рд╣реИ, рд╣рдореЗрд╢рд╛ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рд╡рд╛рд▓реА рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рдеред рдЪреВрдВрдХрд┐ рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдХреЗ рд▓рд┐рдП рд╡рд╕реНрддреБрдУрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдлрд┐рд░ рд╕реЗрд▓ рд╕реАрдорд╛ рдкрд╛рд░ рдХрд░рдиреЗ рд╡рд╛рд▓реА рд╡рд╕реНрддреБ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдмрдВрдж рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдорд┐рд╢реНрд░рд┐рдд рд╣реЛрдЧреАред рд▓реЗрдХрд┐рди рдСрдмреНрдЬреЗрдХреНрдЯ рдЗрддрдиреЗ рдЫреЛрдЯреЗ рд╣реЛрддреЗ рд╣реИрдВ рдХрд┐ рд╡реЗ рд▓рдЧрд╛рддрд╛рд░ рдЕрдкрдиреЗ рд╕реЗрд▓ рдХреЗ рдЕрдВрджрд░ рд░рд╣рддреЗ рд╣реИрдВ, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдкрджреЛрдВ рдХреА рд╡рд┐рдХреГрддрд┐ рдХреЛ рднреА рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреБрдЫ рдЕрдиреНрдп рд╕реЗрд▓ рдореЗрдВ рдХреЛрдиреЗ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рд╣рдорд╛рд░рд╛ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕рд╕реНрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдкреВрд░реНрдг рд╣реИред рдпрд╣ рджреАрд╡рд╛рд░реЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ, рдЬрд┐рд╕рдХреА рджреГрд╢реНрдпрддрд╛ рдкрдбрд╝реЛрд╕реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреГрд╖реНрдЯрд┐ рдХреЗ рдмреАрдЪ рднрд┐рдиреНрди рд╣реЛрддреА рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/421/1c7/f7d/4211c7f7dea80bbbd13664586074c43a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдмрджрд▓рдиреЗ рд╡рд╛рд▓реА рджреАрд╡рд╛рд░реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рджреАрд╡рд╛рд░ рдЦрдВрдбреЛрдВ рдХреЛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рдо рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХреЛ рдЕрдкрдиреЗ рдЬрд╛рд▓ рдореЗрдВ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╣рдордиреЗ рд░рд╛рд╣рдд рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдЯреЙрд╡рд░ рдкреНрд░реАрдлрд╝реИрдм рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднреА рднреА рдЕрд╕рдВрдЧрддрддрд╛рдПрдВ рд╣реЛрдВрдЧреАред </font><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рд╢рдмреНрджреЛрдВ рдореЗрдВ, рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕рд░рд▓ рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдореМрдЬреВрджрд╛ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛рдлреА рдЕрдЪреНрдЫрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рд╣рдо рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдореЙрдбрд▓ рдФрд░ рджреАрд╡рд╛рд░реЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЙрдирдХреА рджреГрд╢реНрдпрддрд╛ рдХреЗ рдорд┐рд╢реНрд░рдг рдХреА рд╡рд┐рдзрд┐ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░реЗрдВрдЧреЗред </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ 21: рдорд╛рдирдЪрд┐рддреНрд░ рдЕрдиреБрд╕рдВрдзрд╛рди </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рд╕рдВрдкрд╛рджрди рдХреЗ рджреМрд░рд╛рди рд╕рдм рдХреБрдЫ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдЬрд╛рдВрдЪ рдХреА рдЧрдИ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рд╡рд╣реА рдЫрд┐рдкрд╛рддреЗ рд╣реИрдВ рдЬреЛ рдЕрднреА рднреА рдЕрдЬреНрдЮрд╛рдд рд╣реИред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЛ рдмреЗрд░реЛрдЬрд╝рдЧрд╛рд░ рдХреНрд╖реЗрддреНрд░реЛрдВ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рддреЗ рд╣реИрдВред </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд┐рдЫрд▓реЗ рднрд╛рдЧ рдореЗрдВ, рд╣рдордиреЗ рдпреБрджреНрдз рдХрд╛ рдХреЛрд╣рд░рд╛ рдЬреЛрдбрд╝рд╛, рдЬрд┐рд╕реЗ рдЕрдм рд╣рдо рдорд╛рдирдЪрд┐рддреНрд░ рдЕрдиреБрд╕рдВрдзрд╛рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рд╖реНрдХреГрдд рдХрд░реЗрдВрдЧреЗред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/81d/40e/bff/81d40ebff615fc7c4e39a15d88da016d.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рджреБрдирд┐рдпрд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИрдВред</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдореНрдкреВрд░реНрдг рдорд╛рдирдЪрд┐рддреНрд░ рдХреЛ рд╕рдВрдкрд╛рджрди рдореЛрдб рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзреНрдпрдпрди рдХрд╛ рдЕрд░реНрде рдпрд╣ рд╣реИ рдХрд┐ рдЬрдм рддрдХ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдирд╣реАрдВ рджреЗрдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрдм рддрдХ рдЕрдЬреНрдЮрд╛рдд рдирд╣реАрдВ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЕрджреГрд╢реНрдп рд╣реИред </font><font style="vertical-align: inherit;">рдЙрдиреНрд╣реЗрдВ рдЕрд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдмрд┐рд▓реНрдХреБрд▓ рднреА рдкреНрд░рджрд░реНрд╢рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЕрдиреБрд╕рдВрдзрд╛рди рд╕рд╣рд╛рдпрддрд╛ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рд╕рдВрдкрд╛рджрди рдореЛрдб рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВрдЧреЗред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреГрд╢реНрдпрддрд╛ рд╕реНрд╡рд┐рдЪрд┐рдВрдЧ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╢реЗрдбрд░реНрд╕ рдХреАрд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджреГрд╢реНрдпрддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рдЧреНрд░рд┐рдб рдкрд░ рдУрд╡рд░рд▓реЗ рдХреЗ рд╕рд╛рде рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рд╕рдВрдкрд╛рджрди рдореЛрдб рдХреА рд╕реНрдерд┐рддрд┐ </font><font style="vertical-align: inherit;">рдХреЛ </font><font style="vertical-align: inherit;">рджрд░реНрд╢рд╛рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEX_MAP_EDIT_MODE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреАрд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ </font><font style="vertical-align: inherit;">рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рдХрдИ shaders рдХреЛ рдЗрд╕ рдХреАрд╡рд░реНрдб рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд╣рдо рд╕реНрдереИрддрд┐рдХ рддрд░реАрдХреЛрдВ </font></font><code>Shader.EnableKeyWord</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font><font style="vertical-align: inherit;">рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рд╡рд┐рд╢реНрд╡ рд╕реНрддрд░ рдкрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВрдЧреЗ </font></font><code>Shader.DisableKeyword</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо </font></font><code>HexGameUI.SetEditMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрд╛рджрди рдореЛрдб рдХреЛ рдмрджрд▓рддреЗ рд╕рдордп </font><font style="vertical-align: inherit;">рдЙрдЪрд┐рдд рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetEditMode</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { enabled = !toggle; grid.ShowUI(!toggle); grid.ClearPath(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (toggle) { Shader.EnableKeyword(<span class="hljs-string"><span class="hljs-string">"HEX_MAP_EDIT_MODE"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Shader.DisableKeyword(<span class="hljs-string"><span class="hljs-string">"HEX_MAP_EDIT_MODE"</span></span>); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЛрдб рд╢реЗрдб рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEX_MAP_EDIT_MODE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ </font><em><font style="vertical-align: inherit;">рдЬрд╛рддрд╛</font></em><font style="vertical-align: inherit;"> рд╣реИ, рддреЛ рд╢реЗрдбрд░реНрд╕ рджреГрд╢реНрдпрддрд╛ рдХреА рдЕрдирджреЗрдЦреА рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ рдЗрд╕ рддрдереНрдп рдкрд░ рдЙрдмрд▓рддрд╛ рд╣реИ рдХрд┐ рд╕реЗрд▓ рджреГрд╢реНрдпрддрд╛ рдХреЛ рд╣рдореЗрд╢рд╛ 1 рдХреЗ рдмрд░рд╛рдмрд░ рдорд╛рдирд╛ рдЬрд╛рдПрдЧрд╛ред рдЪрд▓реЛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрдХреНрд╕рд╕реЗрд▓рдбреИрдЯ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢рд╛рдорд┐рд▓-рдлрд╛рдЗрд▓ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ </font><font style="vertical-align: inherit;">рдХреАрд╡рд░реНрдб рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ </font><font style="vertical-align: inherit;">рдХреЗ рд▓рд┐рдП рдПрдХ </font><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди </font><em><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рддреЗ</font></em><font style="vertical-align: inherit;"> рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs kotlin">sampler2D _HexCellData; float4 _HexCellData_TexelSize; float4 FilterCellData (float4 <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> defined(HEX_MAP_EDIT_MODE) <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.x = <span class="hljs-number"><span class="hljs-number">1</span></span>; #endif <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдЧреБрдЬрд░рддреЗ рд╣реИрдВ, </font></font><code>GetCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рд╡рд╛рдкрд╕ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ </font><font style="vertical-align: inherit;">рджреЛрдиреЛрдВ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрд░рд┐рдгрд╛рдо </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (appdata_full v, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) { тАж <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FilterCellData(data); } <span class="hljs-type"><span class="hljs-type">float4</span></span> GetCellData (float2 cellDataCoordinates) { тАж <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FilterCellData(tex2Dlod(_HexCellData, <span class="hljs-type"><span class="hljs-type">float4</span></span>(uv, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>))); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдм рдХреБрдЫ рдХреЗ рд▓рд┐рдП, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HEX_MAP_EDIT_MODE</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреАрд╡рд░реНрдб </font><font style="vertical-align: inherit;">рдкрд░рд┐рднрд╛рд╖рд┐рдд </font><font style="vertical-align: inherit;">рд╣реЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╡рд┐рдХрд▓реНрдк рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╢реЗрдбреНрд╕ рдХреЛ рдмрд╣реБ_ рдирд┐рд░реНрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЯрд╛рд░рдЧреЗрдЯ рдбрд╛рдпрд░реЗрдХреНрдЯрд┐рд╡ рдФрд░ рдкрд╣рд▓реЗ рд╢рд╛рдорд┐рд▓ рдбрд╛рдпрд░реЗрдХреНрд╢рди рдХреЗ рдмреАрдЪ </font><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">рд╢реЗрдбреНрд╕ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрд╕реНрддреЗрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝реАрдЪрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд┐рд╡рд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдб</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЗрд░реЗрди</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдЯрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реЙрдЯрд░ рд╢реЛрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рдЙрдкрдпреБрдХреНрдд рд▓рд╛рдЗрди рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs cs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> multi_compile _ HEX_MAP_EDIT_MODE</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм, рдЬрдм рдорд╛рдирдЪрд┐рддреНрд░ рд╕рдВрдкрд╛рджрди рдореЛрдб рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рддреЛ рдпреБрджреНрдз рдХрд╛ рдХреЛрд╣рд░рд╛ рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рдПрдЧрд╛ред </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрд╢рд┐рдХрд╛ рдЕрдиреБрд╕рдВрдзрд╛рди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдорд╛рдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЬрдм рдПрдХ рджрд▓ рдЙрдиреНрд╣реЗрдВ рджреЗрдЦрддрд╛ рд╣реИ рддреЛ рд╡реЗ рдЦреЛрдЬрдмреАрди рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, рдЙрдирдХреА рдЬрд╛рдВрдЪ рдЬрд╛рд░реА рд░рд╣рддреА рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЯреБрдХрдбрд╝реА рдЙрдиреНрд╣реЗрдВ рджреЗрдЦ рд╕рдХрддреА рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЯреНрд░реИрдХрд┐рдВрдЧ рдЕрдзреНрдпрдпрди рдХреА рд╕реНрдерд┐рддрд┐ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрдврд╝рд╛рдИ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВ </font></font><code>IsExplored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExplored { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзреНрдпрдпрди рдХреА рд╕реНрдерд┐рддрд┐ рд╕реЗрд▓ рджреНрд╡рд╛рд░рд╛ рд╣реА рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╕рдВрдкрддреНрддрд┐ рдХреЗрд╡рд▓ рд╕реЗрдЯ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕ рдкреНрд░рддрд┐рдмрдВрдз рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕реЗрдЯрд░ рдХреЛ рдирд┐рдЬреА рд╕реЗрдЯ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExplored { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реА рдмрд╛рд░ рдЬрдм рд╕реЗрд▓ рдХреА рджреГрд╢реНрдпрддрд╛ рд╢реВрдиреНрдп рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рд╕реЗрд▓ рдХреЛ рдЬрд╛рдВрдЪ рдорд╛рдирд╛ рдЬрд╛рдиреЗ рд▓рдЧрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рд▓рд┐рдП </font></font><code>IsExplored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдорд╛рди рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ рдХрд┐ рд╣рдо рд╕реЗрд▓ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдЬрдм рджреГрд╢реНрдпрддрд╛ рдмрдврд╝ рдЬрд╛рддреА рд╣реИред 1. рдпрд╣ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП </font></font><code>RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IncreaseVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { visibility += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visibility == <span class="hljs-number"><span class="hljs-number">1</span></span>) { IsExplored = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рдХреЗ рд▓рд┐рдП рдЕрдиреБрд╕рдВрдзрд╛рди рдХреА рд╕реНрдерд┐рддрд┐ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рд╢реЗрдбрд░ рдбреЗрдЯрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдирдХреЗ рдЕрдиреБрд╕рдВрдзрд╛рди рд░рд╛рдЬреНрдп рдХреЛ рд╢реЗрдбрд░реНрд╕ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рдпрд╣ рдХреЗрд╡рд▓ рдПрдХ рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреА рджреГрд╢реНрдпрддрд╛ рд╣реИред </font></font><code>HexCellShaderData.RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбреЗрдЯрд╛ рдЪреИрдирд▓ рдЖрд░ рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЪреИрдирд▓ рдЬреА рдбреЗрдЯрд╛ рдореЗрдВ рдЕрдзреНрдпрдпрди рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрдирд╛рдП рд░рдЦреЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = cell.Index; cellTextureData[index].r = cell.IsVisible ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; cellTextureData[index].g = cell.IsExplored ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛рд▓реА рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рд░рд╛рд╣рдд </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рд╕реЗрд▓ рдЕрдиреБрд╕рдВрдзрд╛рди рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдХрд▓реНрдкрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реЗрдбреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╕рдм рдХреБрдЫ рдЙрд╕реА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдореЗрдВ рд╕рд┐рд░реНрдл рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рднреВрднрд╛рдЧ рдХреЛ рдХрд╛рд▓рд╛ рдХрд░рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╕рдВрдкрд╛рджрди рдореЛрдб рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рдмрджрд▓ рджреЗрдВ </font></font><code>FilterCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рд╢реЛрдз рдбреЗрдЯрд╛ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░ рджреЗред</font></font><br><br><pre> <code class="hljs kotlin">float4 FilterCellData (float4 <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> defined(HEX_MAP_EDIT_MODE) <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.xy = <span class="hljs-number"><span class="hljs-number">1</span></span>; #endif <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЗрд░реЗрди</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ </font><font style="vertical-align: inherit;">рддреАрдиреЛрдВ рд╕рдВрднрд╛рд╡рд┐рдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рджреГрд╢реНрдп рдбреЗрдЯрд╛ рдХреЛ рд╡рд┐рдЦрдВрдбрди рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рднреЗрдЬрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдиреБрд╕рдВрдзрд╛рди рд░рд╛рдЬреНрдп рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╢реАрд░реНрд╖ рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдФрд░ рдХреЗрд╡рд▓ рдорд╛рди рдХреЛ рдЦрдВрдб рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font></font><code>visibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреМрдереЗ рдШрдЯрдХ рдХреЛ </font><font style="vertical-align: inherit;">рдЗрдирдкреБрдЯ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЬрдЧрд╣ рд╣реЛред</font></font><br><br><pre> <code class="hljs pgsql"> struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { <span class="hljs-type"><span class="hljs-type">float4</span></span> color : COLOR; float3 worldPos; float3 terrain; <span class="hljs-type"><span class="hljs-type">float4</span></span> visibility; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм, рд╢реАрд░реНрд╖ рдХрд╛рд░реНрдпрдХреНрд░рдо рдореЗрдВ, рдЬрдм рд╣рдо рджреГрд╢реНрдпрддрд╛ рд╕реВрдЪрдХрд╛рдВрдХ рдмрджрд▓рддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП </font></font><code>data.visibility.xyz</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> data) { тАж data.visibility.xyz = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility.xyz); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдо рдЕрдзреНрдпрдпрди рдХреЗ рд░рд╛рдЬреНрдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдФрд░ рдкрд░рд┐рдгрд╛рдо рд▓рд┐рдЦрддреЗ рд╣реИрдВ </font></font><code>data.visibility.w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдЕрдиреНрдп рд╢реЗрдбреНрд╕ рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рдХреЗ рд╕рдВрдпреЛрдЬрди рдХреЗ рд╕рдорд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдШрдЯрдХ Y рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИред</font></font><br><br><pre> <code class="hljs haskell"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.visibility.xyz = lerp(0.25, 1, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">visibility</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xyz</span></span></span><span class="hljs-class">); </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.visibility.w = cell0.y * v.color.x + cell1.y * v.color.y + cell2.y * v.color.z;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реЛрдз рдХреА рд╕реНрдерд┐рддрд┐ рдЕрдм рдЦрдВрдб рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдкрд▓рдмреНрдз рд╣реИ </font></font><code>IN.visibility.w</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЕрд▓реНрдмреЗрдбреЛ рдХреА рдЧрдгрдирд╛ рдореЗрдВ рдЗрд╕ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { тАж <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.w; o.Albedo = c.rgb * grid * _Color * explored; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b2d/de4/c18/b2dde4c1831a9ecc637550b2b8e2e134.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рд╕реНрдерд▓рд╛рдХреГрддрд┐ рдЕрдм рдХрд╛рд▓реА рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд░рд╛рд╣рдд рдореЗрдВ рдЕрдм рдПрдХ рдХрд╛рд▓рд╛ рд░рдВрдЧ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЗрд╕рдиреЗ рдЕрднреА рддрдХ рд╡рд╕реНрддреБрдУрдВ, рд╕рдбрд╝рдХреЛрдВ рдФрд░ рдкрд╛рдиреА рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ рдХрд┐ рдЕрдзреНрдпрдпрди рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмрдЪрдд рдФрд░ рд▓реЛрдбрд┐рдВрдЧ рдЕрдиреБрд╕рдВрдзрд╛рди рдХреА рд╕реНрдерд┐рддрд┐ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрдм рд╣рдордиреЗ рдЕрдиреБрд╕рдВрдзрд╛рди рд╕рд╣рд╛рдпрддрд╛ рдЬреЛрдбрд╝ рджреА рд╣реИ, рддреЛ рд╣рдореЗрдВ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдирдХреНрд╢реЗ рдХреЛ рд╕рд╣реЗрдЬрддреЗ рдФрд░ рд▓реЛрдб рдХрд░рддреЗ рд╕рдордп рдЕрдиреБрд╕рдВрдзрд╛рди рд╕реНрдерд┐рддрд┐ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдореИрдк рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ 3 рддрдХ рдмрдврд╝рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЗрди рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ </font></font><code>SaveLoadMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░рдВрддрд░ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mapFileVersion = <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рд╛рдЗрд▓ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд▓рд┐рдЦрддреЗ </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдордп рдФрд░ рдлрд╝рд╛рдЗрд▓ рд╕рдорд░реНрдерди рдХреЛ рдЪреЗрдХ рдХрд░рддреЗ рд╕рдордп </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕ рдирд┐рд░рдВрддрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ </font></font><code>Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ( BinaryWriter writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryWriter(File.Open(path, FileMode.Create)) ) { writer.Write(mapFileVersion); hexGrid.Save(writer); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!File.Exists(path)) { Debug.LogError(<span class="hljs-string"><span class="hljs-string">"File does not exist "</span></span> + path); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (BinaryReader reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryReader(File.OpenRead(path))) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> header = reader.ReadInt32(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (header &lt;= mapFileVersion) { hexGrid.Load(reader, header); HexMapCamera.ValidatePosition(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">"Unknown map format "</span></span> + header); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрддрд┐рдо рдЪрд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, </font></font><code>HexCell.Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЕрдзреНрдпрдпрди рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рд░рд┐рдХреЙрд░реНрдб рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryWriter writer</span></span></span><span class="hljs-function">)</span></span> { тАж writer.Write(IsExplored); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рд╣рдо рдЗрд╕реЗ рдЕрдВрдд рдореЗрдВ рдкрдврд╝реЗрдВрдЧреЗ </font></font><code>Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдо </font></font><code>RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзреНрдпрдпрди рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдкрд┐рдЫрд▓реЗ рдПрдХ рд╕реЗ рдЕрд▓рдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader</span></span></span><span class="hljs-function">)</span></span> { тАж IsExplored = reader.ReadBoolean(); ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреБрд░рд╛рдиреА рд╕реЗрд╡ рдлрд╛рдЗрд▓реНрд╕ рдХреЗ рд╕рд╛рде рдмреИрдХрд╡рд░реНрдб рдХрдореНрдкреИрдЯрд┐рдмрд┐рд▓рд┐рдЯреА рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд╕реЗрд╡ рд╕реНрдЯреЗрдЯ рдХреЛ рдкрдврд╝рдирд╛ рдЫреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ рдЕрдЧрд░ рдлрд╛рдЗрд▓ рд╡рд░реНрдЬрди 3 рд╕реЗ рдХрдо рд╣реИред рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╕реЗрд▓ рдореЗрдВ рд╕реНрдЯреЗрдЯ "рдЕрдирдПрдХреНрд╕рдкреНрд▓реЗрдпрд░реНрдб" рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ </font></font><code>Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрдбрд░ рдбреЗрдЯрд╛ </font><font style="vertical-align: inherit;">рдХреЛ рдПрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> header</span></span></span><span class="hljs-function">)</span></span> { тАж IsExplored = header &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> ? reader.ReadBoolean() : <span class="hljs-literal"><span class="hljs-literal">false</span></span>; ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм </font></font><code>HexGrid.Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ </font></font><code>HexCell.Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрдбрд░ рдбреЗрдЯрд╛ </font><font style="vertical-align: inherit;">рдореЗрдВ рдкрд╛рд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> header</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { cells[i].Load(reader, header); } тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм, рдирдХреНрд╢реЗ рд╕рд╣реЗрдЬрддреЗ рдФрд░ рд▓реЛрдб рдХрд░рддреЗ рд╕рдордп, рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рдПрдЧрд╛ред </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдЬреНрдЮрд╛рдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЫрд┐рдкрд╛рдПрдВ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рдЪрд░рдг рдореЗрдВ, рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдПрдХ рдХрд╛рд▓реА рд░рд╛рд╣рдд рджреНрд╡рд╛рд░рд╛ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдо рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдпреЗ рдХреЛрд╢рд┐рдХрд╛рдПрдБ рдЕрджреГрд╢реНрдп рд╣реЛрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЕрдЬреНрдЮрд╛рдд рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЕрдкрд╛рд░рджрд░реНрд╢реА рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЛ рдкрд╛рд░рджрд░реНрд╢реА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдпрд╣ рджрд┐рдЦрд╛рдИ рди рджреЗред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦреЗ рдмрд┐рдирд╛ рдпреВрдирд┐рдЯреА рд╕рд░рдлреЗрд╕ рд╢реЗрдбрд░ рдлреНрд░реЗрдорд╡рд░реНрдХ рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рд╕рдЪреНрдЪреА рдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдкреГрд╖реНрдарднреВрдорд┐ рд╕реЗ рдорд┐рд▓рд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реЗрдб рдмрджрд▓ рджреЗрдВрдЧреЗ, рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдЕрджреГрд╢реНрдп рднреА рдмрдирд╛ рджреЗрдЧрд╛ред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд┐рд╕рд╕реЗ рд░рд╛рд╣рдд рд╡рд╛рдХрдИ рдореЗрдВ рдХрд╛рд▓реА рд╣реЛ рдЬрд╛рдП </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рдЕрдзреНрдпрдпрди рд░рд╛рд╣рдд рдХрд╛рд▓реА рд╣реИ, рдлрд┐рд░ рднреА рд╣рдо рдЗрд╕реЗ рдкрд╣рдЪрд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рдЕрднреА рднреА рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рд▓рд╛рдЗрдЯрд┐рдВрдЧ рд╣реИред рдкреНрд░рдХрд╛рд╢ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЗрд╕реЗ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдореИрдЯ рдмреНрд▓реИрдХ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рд╕рддрд╣ рдХреЗ рдЕрдиреНрдп рдЧреБрдгреЛрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реНрдкреЗрдХреБрд▓рд░ рд░рдВрдЧ рдХреЛ рдХрд╛рд▓реЗ рд░рдВрдЧ рдореЗрдВ рдмрджрд▓рдирд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рд╣реИред рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдпрджрд┐ рдЖрдк рдПрдХ рд╕рддрд╣ рд╢реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдм рд╣рдо рдорд╛рдирдХ рдзрд╛рддреБ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рддреЛ рдЪрд▓рд┐рдП </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terrain</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> shader </font><font style="vertical-align: inherit;">рдХреЛ specular рдкрд░ </font><font style="vertical-align: inherit;">рд╕реНрд╡рд┐рдЪ рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рдВрдЧ рд╕рдВрдкрддреНрддрд┐ рдХреА рдЬрдЧрд╣ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_Metallic</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдВрдкрддреНрддрд┐ рдкрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_Specular</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдЗрд╕рдХрд╛ рд░рдВрдЧ рдорд╛рди (0.2, 0.2, 0.2) рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдЗрд╕рд▓рд┐рдП рд╣рдо рдЧрд╛рд░рдВрдЯреА рджреЗрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдзрд╛рддреБрдИ рд╕рдВрд╕реНрдХрд░рдг рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рд╕реЗ рдореЗрд▓ рдЦрд╛рдПрдЧрд╛ред</font></font><br><br><pre> <code class="hljs nginx"> <span class="hljs-section"><span class="hljs-section">Properties</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">_Color</span></span> (<span class="hljs-string"><span class="hljs-string">"Color"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex (<span class="hljs-string"><span class="hljs-string">"Terrain Texture Array"</span></span>, 2DArray) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} <span class="hljs-attribute"><span class="hljs-attribute">_GridTex</span></span> (<span class="hljs-string"><span class="hljs-string">"Grid Texture"</span></span>, 2D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} <span class="hljs-attribute"><span class="hljs-attribute">_Glossiness</span></span> (<span class="hljs-string"><span class="hljs-string">"Smoothness"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> // _Metallic (<span class="hljs-string"><span class="hljs-string">"Metallic"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> _Specular (<span class="hljs-string"><span class="hljs-string">"Specular"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>) }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рд╕рдВрдмрдВрдзрд┐рдд shader рдЪрд░ рдмрджрд▓реЗрдВред </font><font style="vertical-align: inherit;">рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рд╕рд░рдлреЗрд╕ рд╢реЗрдбреНрд╕ рдХреЗ рд░рдВрдЧ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ </font></font><code>fixed3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs objectivec"> half _Glossiness; <span class="hljs-comment"><span class="hljs-comment">// half _Metallic; fixed3 _Specular; fixed4 _Color;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рде pragma рд╕рддрд╣ рд╕рд░реНрдл рдмрджрд▓реЗрдВ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдЯреИрдВрдбрд░реНрдб</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StandardSpecular</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдпрд╣ рдпреВрдирд┐рдЯреА рдХреЛ рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╢реЗрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░реЗрдЧрд╛ред</font></font><br><br><pre> <code class="hljs cs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf StandardSpecular fullforwardshadows vertex:vert</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдлрд╝рдВрдХреНрд╢рди </font></font><code>surf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рджреВрд╕рд░реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>SurfaceOutputStandardSpecular</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдм рдЖрдкрдХреЛ рдореВрд▓реНрдп рдирд╣реАрдВ </font></font><code>o.Metallic</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдмрд▓реНрдХрд┐ </font><font style="vertical-align: inherit;">рдЕрд╕рд╛рдЗрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ </font></font><code>o.Specular</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandardSpecular o) { тАж <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.w; o.Albedo = c.rgb * grid * _Color * explored; // o.Metallic = _Metallic; o.Specular = _Specular; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо </font></font><code>explored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рд░рдВрдЧ рдкрд░ </font><font style="vertical-align: inherit;">рд╡рд┐рдЪрд╛рд░ рдХрд░рдХреЗ рд╣рд╛рдЗрд▓рд╛рдЗрдЯреНрд╕ рдХреЛ рдЕрд╕реНрдкрд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs"> o.Specular = _Specular * explored;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/289/d05/128/289d0512816a7d6f692b0e7639e882eb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рд▓рдХреНрд╖рд┐рдд рдкреНрд░рдХрд╛рд╢ рдХреЗ рдмрд┐рдирд╛ рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдЗрд▓рд╛рдХрд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рддрд╕реНрд╡реАрд░ рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдм рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рд░рд╛рд╣рдд рд╕реБрд╕реНрдд рдХрд╛рд▓реА рджрд┐рдЦрддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬрдм рдПрдХ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рдХреЛрдг рд╕реЗ рджреЗрдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╕рддрд╣ рдПрдХ рджрд░реНрдкрдг рдореЗрдВ рдмрджрд▓ рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕рдХреЗ рдХрд╛рд░рдг рд░рд╛рд╣рдд рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрддреА рд╣реИ, рдЕрд░реНрдерд╛рдд, рд╕реНрдХрд╛рдИрдмреЙрдХреНрд╕ред</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рддрд╣реЗрдВ рджрд░реНрдкрдг рдХреНрдпреЛрдВ рдмрди рдЬрд╛рддреА рд╣реИрдВ?</font></font></b> <div class="spoiler_text">    .  .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Rendering</a> . </div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/255/d63/627/255d636278eb947c27117d6c596a9489.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреНрд╖реЗрддреНрд░ рдЕрднреА рднреА рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрди рдкреНрд░рддрд┐рдмрд┐рдВрдмреЛрдВ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рд░рд╛рд╣рдд рдкрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ </font></font><code>explored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдбрд╝рд╛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдПрдХ рдорд╛рди рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ рдкреВрд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">, рдЬрд┐рд╕реЗ рд╣рдо рдкреНрд░рддрд┐рдмрд┐рдВрдм рдорд╛рд╕реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.w; o.Albedo = c.rgb * grid * _Color * explored; o.Specular = _Specular * explored; o.Smoothness = _Glossiness; o.Occlusion = explored; o.Alpha = ca;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/118/ab6/a5a/118ab6a5a91711eda2165433a7b99513.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд┐рдирд╛ рдкреНрд░рддрд┐рдмрд┐рдВрдм рдХреЗ рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрддред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореИрдЪрд┐рдВрдЧ рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЬрдм рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдЗрд▓рд╛рдХрд╛ рд╕рднреА рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреА рдЙрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рдкреГрд╖реНрдарднреВрдорд┐ рд╕реЗ рдореЗрд▓ рдЦрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдорд╛рд░рд╛ рдХреИрдорд░рд╛ рд╣рдореЗрд╢рд╛ рдКрдкрд░ рд╕реЗ рджрд┐рдЦрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкреГрд╖реНрдарднреВрдорд┐ рд╣рдореЗрд╢рд╛ рдЧреНрд░реЗ рд░рд╣рддреА рд╣реИред </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terrain</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> shader рдХреЛ рдпрд╣ рдмрддрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ </font><font style="vertical-align: inherit;">рдХрд┐рд╕ рд░рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_BackgroundColor</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЧреБрдг рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">, рдЬреЛ рдХрд╛рд▓реЗ рд░рдВрдЧ рдореЗрдВ рдбрд┐рдлреЙрд▓реНрдЯ рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="hljs dos"> Properties { тАж _BackgroundColor ("Background <span class="hljs-built_in"><span class="hljs-built_in">Color</span></span>", <span class="hljs-built_in"><span class="hljs-built_in">Color</span></span>) = (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) } тАж half _Glossiness; fixed3 _Specular; fixed4 _Color; half3 _BackgroundColor;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд░рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрд╕реЗ рдкреНрд░рдХрд╛рд╢ рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛрдбрд╝реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ </font></font><code>o.Emission</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдорд╛рдЗрдирд╕ рджреНрд╡рд╛рд░рд╛ рдЦреЛрдЬреЗ рдЧрдП рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдХрд▓рд░ рд╡реИрд▓реНрдпреВ рдХреЛ рдЧреБрдгрд╛ рдХрд░рдХреЗ рдкреВрд░рд╛ рдХрд┐рдпрд╛ </font><font style="vertical-align: inherit;">рдЬрд╛рддрд╛ </font><font style="vertical-align: inherit;">рд╣реИред</font></font><br><br><pre> <code class="hljs"> o.Occlusion = explored; o.Emission = _BackgroundColor * (1 - explored);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реНрдХрд╛рдИрдмреЙрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рджреГрд╢реНрдп рдкреГрд╖реНрдарднреВрдорд┐ рд░рдВрдЧ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рдорд╛рди рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдереЛрдбрд╝рд╛ рд▓рд╛рд▓ рд░рдВрдЧ рдХрд╛ рдЧреНрд░реЗ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд░рдВрдЧ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рд░рд╛рд╣рдд рд╕рд╛рдордЧреНрд░реА рд╕реЗрдЯ рдХрд░рддреЗ рд╕рдордп, рдЖрдк </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реЗрдХреНрд╕ рдХрд▓рд░ рдХреЗ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдХреЛрдб 68615BFF рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eeb/307/7dd/eeb3077dd097a7649575a371cbb361f6.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреНрд░реЗ рдкреГрд╖реНрдарднреВрдорд┐ рд░рдВрдЧ рдХреЗ рд╕рд╛рде рд░рд╛рд╣рдд рд╕рд╛рдордЧреНрд░реАред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрджрд┐ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдХрд╣рд╛рдВ рджреЗрдЦрдирд╛ рд╣реИ, рддреЛ рдЖрдк рдмрд╣реБрдд рдХрдордЬреЛрд░ рд╕рд┐рд▓реНрд╣реВрдЯ рдХреЛ рджреЗрдЦреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдЦрд┐рд▓рд╛рдбрд╝реА рдЙрдиреНрд╣реЗрдВ рджреЗрдЦ рди рд╕рдХреЗ, рдЖрдк рдЖрдХрд╛рд╢ рдХреЗ рдмрдЬрд╛рдП рдХреИрдорд░реЗ рдХреЛ 68615BFF рдХреА рдПрдХ рд╕рдорд╛рди рдкреГрд╖реНрдарднреВрдорд┐ рд░рдВрдЧ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b9/8cc/ec9/7b98ccec9228ac333cc23ec19cc6f28b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╕рдорд╛рди рдкреГрд╖реНрдарднреВрдорд┐ рд░рдВрдЧ рдХреЗ рд╕рд╛рде рдХреИрдорд░рд╛ред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдХрд╛рдИрдмреЙрдХреНрд╕ рдХреЛ рдХреНрдпреЛрдВ рдирд╣реАрдВ рд╣рдЯрд╛рдпрд╛?</font></font></b> <div class="spoiler_text">   ,   ,     environmental lighting .     ,     . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдкреГрд╖реНрдарднреВрдорд┐ рдФрд░ рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдирд╣реАрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдПрдХ рдЙрдЪреНрдЪ рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рд╕реНрдерд▓рд╛рдХреГрддрд┐ рдЕрднреА рднреА рдХрдо рдХреИрдорд░рд╛ рдХреЛрдгреЛрдВ рдкрд░ рдПрдХ рдХрдо рдЦреЛрдЬреЗ рдЧрдП рд╕реНрдерд▓рд╛рдХреГрддрд┐ рдХреЛ рдЕрд╕реНрдкрд╖реНрдЯ рдХрд░ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рднрд╛рдЧреЛрдВ рдореЗрдВ рдЕрднреА рднреА рдЫрд╛рдпрд╛ рдкрд░ рдЫрд╛рдпрд╛ рдбрд╛рд▓рд╛ рдЧрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЗрди рдиреНрдпреВрдирддрдо рд╕реБрд░рд╛рдЧреЛрдВ рдХреА рдЙрдкреЗрдХреНрд╖рд╛ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f88/764/d67/f88764d67aec0bf90267d273e1a248d5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдЕрдм рджрд┐рдЦрд╛рдИ рдирд╣реАрдВ рджреЗрддреА рд╣реИрдВред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рдПрдХ рд╕рдорд╛рди рдкреГрд╖реНрдарднреВрдорд┐ рд░рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛?</font></font></b> <div class="spoiler_text">    ,        ,      .        .      ,          .       ,     ,  ,  UV-           . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рд╛рд╣рдд рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдЫрд┐рдкрд╛рдПрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреЗрд╡рд▓ рд░рд╛рд╣рдд рдХреА рдЬрд╛рд▓реА рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдзреНрдпрдпрди рдХреА рдмрд╛рдХреА рд╕реНрдерд┐рддрд┐ рдЕрднреА рддрдХ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рд╣реБрдИ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/282/c0c/a0f/282c0ca0fb55bf26ee0bb1d43cadd42f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрднреА рддрдХ рдХреЗрд╡рд▓ рд░рд╛рд╣рдд рдЫрд┐рдкреА рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлреАрдЪрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбрд░ рдХреЛ рдмрджрд▓реЗрдВ </font><font style="vertical-align: inherit;">, рдЬреЛ рдХрд┐ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЗрд░реЗрди рдХреА</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рддрд░рд╣ рдПрдХ рдЕрдкрд╛рд░рджрд░реНрд╢реА рд╢реЗрдбрд░ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдПрдХ рд╕реНрдкреЗрдХреБрд▓рд░ рд╢реЗрдбрд░ рдореЗрдВ рдмрджрд▓реЗрдВ рдФрд░ рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдХрд▓рд░ рдХреЛ рдЗрд╕рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдЧреБрдгреЛрдВ рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs nginx"> <span class="hljs-section"><span class="hljs-section">Properties</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">_Color</span></span> (<span class="hljs-string"><span class="hljs-string">"Color"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex (<span class="hljs-string"><span class="hljs-string">"Albedo (RGB)"</span></span>, 2D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} <span class="hljs-attribute"><span class="hljs-attribute">_Glossiness</span></span> (<span class="hljs-string"><span class="hljs-string">"Smoothness"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span> // _Metallic (<span class="hljs-string"><span class="hljs-string">"Metallic"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> _Specular (<span class="hljs-string"><span class="hljs-string">"Specular"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>) _BackgroundColor (<span class="hljs-string"><span class="hljs-string">"Background Color"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) [NoScaleOffset] _GridCoordinates (<span class="hljs-string"><span class="hljs-string">"Grid Coordinates"</span></span>, 2D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╣рд▓реЗ рдХреА рддрд░рд╣ рдЖрдЧреЗ рдХреА рд╕рддрд╣ рдФрд░ рдЪрд░ред </font></font><br><br><pre> <code class="hljs cpp"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> surface surf StandardSpecular fullforwardshadows vertex:vert тАж half _Glossiness; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// half _Metallic; fixed3 _Specular; fixed4 _Color; half3 _BackgroundColor;</span></span></span></span></code> </pre> <br> <code>visibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдФрд░ рдШрдЯрдХ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝реАрдЪрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдХреЗ рд▓рд┐рдП рджреГрд╢реНрдпрддрд╛ рдХреЛ рдЬреЛрдбрд╝рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рдХреЗрд╡рд▓ рдПрдХ рдлреНрд▓реЛрдЯ рдореВрд▓реНрдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереАред </font><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рджреЛ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="hljs swift"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> </span></span>{ float2 uv_MainTex; float2 visibility; };</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рдмрджрд▓ рджреЗрдВ </font></font><code>vert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рджреГрд╢реНрдпрддрд╛ рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рд╣реЛ </font></font><code>data.visibility.x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ рдлрд┐рд░ </font></font><code>data.visibility.y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзреНрдпрдпрди рдбреЗрдЯрд╛ </font><font style="vertical-align: inherit;">рдХреЗ </font><font style="vertical-align: inherit;">рдореВрд▓реНрдп рдХреЛ </font><font style="vertical-align: inherit;">рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs kotlin"> void vert (inout appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Input <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { тАж float4 cellData = GetCellData(cellDataCoordinates); <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = cellData.x; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x); <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.y = cellData.y; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рдмрджрд▓ рджреЗрдВ </font></font><code>surf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЗрд░реЗрди рдХреА</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рддрд░рд╣ рдирдП рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandardSpecular o) { fixed4 c = tex2D (_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex) * _Color; <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.y; o.Albedo = c.rgb * (<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.x * explored); // o.Metallic = _Metallic; o.Specular = _Specular * explored; o.Smoothness = _Glossiness; o.Occlusion = explored; o.Emission = _BackgroundColor * (<span class="hljs-number"><span class="hljs-number">1</span></span> - explored); o.Alpha = ca; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d13/863/dc6/d13863dc60bbb92750cd5c8f8b69d82b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫрд┐рдкреА рд╣реБрдИ рд░рд╛рд╣рдд рдХреА рд╡рд╕реНрддреБред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╛рдиреА рдЫрд┐рдкрд╛рдУ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЖрдЧреЗ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд▓</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд▓ рдХрд┐рдирд╛рд░реЗ рд╣реИрдВ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЙрдиреНрд╣реЗрдВ рд╕реНрдкреЗрдХреБрд▓рд░ рд╢реЗрдбреНрд╕ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЙрдиреНрд╣реЗрдВ рдкреГрд╖реНрдарднреВрдорд┐ рд░рдВрдЧ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдкрд╛рд░рджрд░реНрд╢реА рд╢реЗрдб рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реВрдкрд╛рдВрддрд░рдг рдХреЗ рдмрд╛рдж, </font></font><code>visibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдФрд░ рдШрдЯрдХ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">рдФрд░ рдЙрд╕рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЗрд╕реЗ рдмрджрд▓реЗрдВ </font></font><code>vert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рджреЛрдиреЛрдВ рд╢реЗрдб рддреАрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдорд┐рд▓рд╛рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="hljs dos"> struct Input { тАж float2 visibility; }; тАж void vert (inout appdata_full v, out Input data) { тАж data.visibility.x = cell0.x * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.x + cell1.x * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.y + cell2.x * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.z; data.visibility.x = lerp(<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, data.visibility.x); data.visibility.y = cell0.y * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.x + cell1.y * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.y + cell2.y * v.<span class="hljs-built_in"><span class="hljs-built_in">color</span></span>.z; }</code> </pre> <br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд▓</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд▓ рд╢реЛрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рд╕рдВрдЪрд╛рд▓рд┐рдд </font></font><code>surf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рднрд┐рдиреНрди рдХрд╛рд░реНрдпреЛрдВ, рд▓реЗрдХрд┐рди рдПрдХ рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдЙрдирдХреА рд╕рддрд╣ рдЧреБрдг рдХрд╣рд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╡реЗ рдкрд╛рд░рджрд░реНрд╢реА рд╣реИрдВ, рд╣рдо </font></font><code>explore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд▓реНрдлрд╛ рдЪреИрдирд▓ </font><font style="vertical-align: inherit;">рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦреЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">, рдФрд░ рд╣рдо рдЙрддреНрд╕рд░реНрдЬрди рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandardSpecular o) { тАж <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.y; o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.x; o.Specular = _Specular * explored; o.Smoothness = _Glossiness; o.Occlusion = explored; o.Alpha = ca * explored; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15a/e39/390/15ae39390ccbe91f3d12f068992a7c14.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫрд┐рдкрд╛ рд╣реБрдЖ рдкрд╛рдиреАред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдирджрд┐рдпреЛрдВ, рдирджрд┐рдпреЛрдВ рдФрд░ рд╕рдбрд╝рдХреЛрдВ рдХреЛ рдЫрд┐рдкрд╛рддреЗ рд╣реИрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднреА рднреА рд╢реЗрдбреНрд╕ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрд╕реНрддреЗрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирджреА</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдбрд╝рдХ рд╣реИрдВ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рддреАрдиреЛрдВ рдкрд╛рд░рджрд░реНрд╢реА рд╣реИрдВ рдФрд░ рджреЛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдорд┐рд▓рд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрди рд╕рднреА рдХреЛ рд╕реНрдкреЗрдХреНрдпреБрд▓рд░ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░реЗрдВ, рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ </font></font><code>visibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реЛрдз рдбреЗрдЯрд╛ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="hljs kotlin"> struct Input { тАж float2 visibility; }; тАж void vert (inout appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Input <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { тАж <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = cell0.x * v.color.x + cell1.x * v.color.y; <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x = lerp(<span class="hljs-number"><span class="hljs-number">0.25</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.x); <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.visibility.y = cell0.y * v.color.x + cell1.y * v.color.y; }</code> </pre> <br><font style="vertical-align: inherit;"><em><font style="vertical-align: inherit;">рдЗрд╕реНрдЯреНрдпреВрд░реА</font></em><font style="vertical-align: inherit;"> рдФрд░ </font><em><font style="vertical-align: inherit;">рд░рд┐рд╡рд░</font></em></font><code>surf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╢реЗрдбреНрд╕ </font><font style="vertical-align: inherit;">рдХреЗ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмрджрд▓реЗрдВ </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рдирдП рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗред </font><font style="vertical-align: inherit;">рджреЛрдиреЛрдВ рдХреЛ рд╕рдорд╛рди рдмрджрд▓рд╛рд╡ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред</font></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandardSpecular o) { тАж <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.y; fixed4 c = saturate(_Color + water); o.Albedo = c.rgb * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.x; o.Specular = _Specular * explored; o.Smoothness = _Glossiness; o.Occlusion = explored; o.Alpha = ca * explored; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shader </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реЛрдб</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдереЛрдбрд╝рд╛ рдЕрд▓рдЧ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдореНрдорд┐рд╢реНрд░рдг рдореАрдЯреНрд░рд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandardSpecular o) { <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); fixed4 c = _Color * ((noise.y * <span class="hljs-number"><span class="hljs-number">0.75</span></span> + <span class="hljs-number"><span class="hljs-number">0.25</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.x); <span class="hljs-type"><span class="hljs-type">float</span></span> blend = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.x; blend *= noise.x + <span class="hljs-number"><span class="hljs-number">0.5</span></span>; blend = smoothstep(<span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>, blend); <span class="hljs-type"><span class="hljs-type">float</span></span> explored = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.visibility.y; o.Albedo = c.rgb; o.Specular = _Specular * explored; o.Smoothness = _Glossiness; o.Occlusion = explored; o.Alpha = blend * explored; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c6/1d2/c65/1c61d2c652b436385b42188c39476c14.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдм рдЫрд┐рдкрд╛ рд╣реИред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рд╕реЗ рдмрдЪрдирд╛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рд╕рдм рдХреБрдЫ рдЕрдЬреНрдЮрд╛рдд рджреГрд╖реНрдЯрд┐ рд╕реЗ рдЫрд┐рдкрд╛ рд╣реБрдЖ рд╣реИ, рдЬрдмрдХрд┐ рдПрдХ рдорд╛рд░реНрдЧ рдХреА рдЦреЛрдЬ рдХрд░рддреЗ рд╕рдордп рдЕрдзреНрдпрдпрди рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рдирд╣реАрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдирддреАрдЬрддрди, рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЛ рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдФрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдЖрджреЗрд╢ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд╛рджреБрдИ рддрд░реАрдХреЗ рд╕реЗ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рдХрд┐ рдХрд┐рд╕ рддрд░рд╣ рд╕реЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЛ рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca9/eb9/f22/ca9eb9f22cd36b917bd5f0c38028bce7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░реЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрдХреНрд╡рд╛рдб рдЪрд▓рддреА рдХреА рд▓рд╛рдЧрдд рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рд╕реЗ рдирд┐рдкрдЯрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЪрд▓реЛ рд╕реЗ рдЬрд╛рдиреЗ рдХреА рд▓рд╛рдЧрдд рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдХреЛ рдлрд┐рд░ рд╕реЗ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░реЗрдВ </font></font><code>HexUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╡рд┐рднрд┐рдиреНрди рдЖрдВрджреЛрд▓рди рдирд┐рдпрдореЛрдВ рд╡рд╛рд▓реА рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдХреЛ рд╕рд░рд▓ рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЪрд▓рддреА рдХреА рд▓рд╛рдЧрдд рдирд┐рд░реНрдзрд╛рд░рд┐рдд </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font></font><code>HexUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдзрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font></font><code>GetMoveCost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЙрд╕реЗ рдпрд╣ рдЬрд╛рдирдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдХрд┐ рдХреМрди рд╕реА рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдЙрдирдХреЗ рдмреАрдЪ рдЪрд▓рддреА рд╣реИрдВ, рд╕рд╛рде рд╣реА рджрд┐рд╢рд╛ рднреАред </font><font style="vertical-align: inherit;">рд╣рдо </font></font><code>HexGrid.Search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдкрджреНрдзрддрд┐ </font><font style="vertical-align: inherit;">рд╕реЗ рдЬрд╛рдиреЗ рдХреА рд▓рд╛рдЧрддреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрдмрдВрдзрд┐рдд рдХреЛрдб рдХреЛ рдХреЙрдкреА рдХрд░рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">рдФрд░ рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓ рдирд╛рдореЛрдВ рдХреЛ рдмрджрд▓рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMoveCost</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexCell fromCell, HexCell toCell, HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { HexEdgeType edgeType = fromCell.GetEdgeType(toCell); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (edgeType == HexEdgeType.Cliff) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> moveCost; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fromCell.HasRoadThroughEdge(direction)) { moveCost = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fromCell.Walled != toCell.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { moveCost = edgeType == HexEdgeType.Flat ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">10</span></span>; moveCost += toCell.UrbanLevel + toCell.FarmLevel + toCell.PlantLevel; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдХреЛ рдЪрд▓рдиреЗ рдХреА рд▓рд╛рдЧрдд рд╡рд╛рдкрд╕ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЕрдорд╛рдиреНрдп рдЪрд╛рд▓реЗрдВ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрд░рд╛рдиреЗ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдерд╛ </font></font><code>continue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдпрд╣рд╛рдБ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдВрджреЛрд▓рди рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ, рддреЛ рд╣рдо рдЖрдЧреЗ рдмрдврд╝рдиреЗ рдХреА рдирдХрд╛рд░рд╛рддреНрдордХ рд▓рд╛рдЧрддреЛрдВ рдХреЛ рд╡рд╛рдкрд╕ рдХрд░ рджреЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMoveCost</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexCell fromCell, HexCell toCell, HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { HexEdgeType edgeType = fromCell.GetEdgeType(toCell); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (edgeType == HexEdgeType.Cliff) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> moveCost; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fromCell.HasRoadThroughEdge(direction)) { moveCost = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fromCell.Walled != toCell.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { moveCost = edgeType == HexEdgeType.Flat ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">10</span></span>; moveCost += toCell.UrbanLevel + toCell.FarmLevel + toCell.PlantLevel; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moveCost; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рд░рд╛рд╕реНрддрд╛ рдвреВрдВрдврддреЗ рд╕рдордп, рди рдХреЗрд╡рд▓ рдЧрддрд┐, рдмрд▓реНрдХрд┐ рдЪрдпрдирд┐рдд рдЗрдХрд╛рдИ рднреАред </font><font style="vertical-align: inherit;">рдЙрд╕реА рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдмрджрд▓рд┐рдП </font></font><code>HexGameUI.DoPathFinding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoPathfinding</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UpdateCurrentCell()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentCell &amp;&amp; selectedUnit.IsValidDestination(currentCell)) { grid.FindPath(selectedUnit.Location, currentCell, selectedUnit); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { grid.ClearPath(); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рд╣рдореЗрдВ рдЕрднреА рднреА рджрд╕реНрддреЗ рдХреА рдЧрддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо </font></font><code>HexUnit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗ </font></font><code>Speed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬрдмрдХрд┐ рдпрд╣ 24 рдХрд╛ рдирд┐рд░рдВрддрд░ рдорд╛рди рд▓реМрдЯрд╛рдПрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Speed { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рд╡рд░реНрддрди </font></font><code>FindPath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ </font></font><code>Search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрддрдирд╛ рд╣реИ рдХрд┐ рд╡реЗ рд╣рдорд╛рд░реЗ рдирдП рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindPath</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, HexCell toCell, HexUnit unit</span></span></span><span class="hljs-function">)</span></span> { ClearPath(); currentPathFrom = fromCell; currentPathTo = toCell; currentPathExists = Search(fromCell, toCell, unit); ShowPath(unit.Speed); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Search</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, HexCell toCell, HexUnit unit</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> speed = unit.Speed; тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо </font></font><code>Search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреБрд░рд╛рдиреЗ рдХреЛрдб </font><font style="vertical-align: inherit;">рдХреЛ рд╣рдЯрд╛ рджреЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">рдЬреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЕрдЧрд▓реЗ рд╕реЗрд▓ рдореЗрдВ рдЬрд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдФрд░ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рдХреА рд▓рд╛рдЧрдд рдХреНрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдлреЛрди рдХрд░реЗрдВрдЧреЗ </font></font><code>HexUnit.IsValidDestination</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>HexUnit.GetMoveCost</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЕрдЧрд░ рд╕реЗрд▓рд┐рдВрдЧ рдХреА рд▓рд╛рдЧрдд рдирдХрд╛рд░рд╛рддреНрдордХ рд╣реИ, рддреЛ рд╣рдо рд╕реЗрд▓ рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { HexCell neighbor = current.GetNeighbor(d); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( neighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || neighbor.SearchPhase &gt; searchFrontierPhase ) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// if (neighbor.IsUnderwater || neighbor.Unit) { // continue; // } // HexEdgeType edgeType = current.GetEdgeType(neighbor); // if (edgeType == HexEdgeType.Cliff) { // continue; // } // int moveCost; // if (current.HasRoadThroughEdge(d)) { // moveCost = 1; // } // else if (current.Walled != neighbor.Walled) { // continue; // } // else { // moveCost = edgeType == HexEdgeType.Flat ? 5 : 10; // moveCost += neighbor.UrbanLevel + neighbor.FarmLevel + // neighbor.PlantLevel; // } if (!unit.IsValidDestination(neighbor)) { continue; } int moveCost = unit.GetMoveCost(current, neighbor, d); if (moveCost &lt; 0) { continue; } int distance = current.Distance + moveCost; int turn = (distance - 1) / speed; if (turn &gt; currentTurn) { distance = turn * speed + moveCost; } тАж }</span></span></code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЧреИрд░-рдЕрдзрд┐рдХреГрдд рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ рдХрд┐ рд╣рдо </font></font><code>HexUnit.IsValidDestination</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╛рдВрдЪ </font><font style="vertical-align: inherit;">рд▓реЗрдВ рдХрд┐ </font><font style="vertical-align: inherit;">рдХреНрдпрд╛ рд╕реЗрд▓ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЧрдИ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValidDestination</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell.IsExplored &amp;&amp; !cell.IsUnderwater &amp;&amp; !cell.Unit; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a84/831/2c6/a848312c6231a168a966e4cdafc2df38.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдзрд┐рдХ рдЗрдХрд╛рдЗрдпрд╛рдВ рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдВрдЧреАред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдЕрдм рдорд╛рдиреНрдп рд╕рдорд╛рдкрди рдмрд┐рдВрджреБ рдирд╣реАрдВ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╕рдорд╛рдкрди рдмрд┐рдВрджреБ рдкрд░ рдЬрд╛рдиреЗ рдкрд░ рд╕реНрдХреНрд╡реЙрдб рдЙрдирд╕реЗ рдмрдЪ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреНрд╖реЗрддреНрд░ рдЙрди рдмрд╛рдзрд╛рдУрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдорд╛рд░реНрдЧ рдХреЛ рд▓рдВрдмрд╛ рдХрд░рддреЗ рд╣реИрдВ рдпрд╛ рдЕрд╕рдВрднрд╡ рднреА рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдкрд╣рд▓реЗ рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЛ рдПрдХ рдЕрдЬреНрдЮрд╛рдд рдЗрд▓рд╛рдХреЗ рдХреЗ рдХрд░реАрдм рд▓рд╛рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЪрд╛рд▓ рдХреЗ рджреМрд░рд╛рди рдПрдХ рдЫреЛрдЯрд╛ рд░рд╛рд╕реНрддрд╛ рджрд┐рдЦрд╛рдИ рджреЗ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛?</font></font></b> <div class="spoiler_text">                .           ,        .       . <br><br>   ,        ,            .            ,    . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ 22: рдмрдврд╝реА рд╣реБрдИ рджреГрд╢реНрдпрддрд╛ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреГрд╢реНрдпрддрд╛ рдХреЛ рдзреАрд░реЗ-рдзреАрд░реЗ рдмрджрд▓реЗрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЧреБрдВрдЬрд╛рдЗрд╢ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд▓ рдХреА рдКрдВрдЪрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирдХреНрд╢реЗ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдЫрд┐рдкрд╛рдПрдБред </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдорд╛рдирдЪрд┐рддреНрд░ рдЕрдиреНрд╡реЗрд╖рдг рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдЬреЛрдбрд╝рдХрд░, рд╣рдо рд╕рдВрдЧрдгрдирд╛ рдФрд░ рдЧреБрдВрдЬрд╛рдЗрд╢ рдмрджрд▓рд╛рд╡реЛрдВ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░реЗрдВрдЧреЗред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d2/c4a/793/2d2c4a7939e75fe09298f96ff6125478.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЧреЗ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдКрдкрд░ рдЪрдврд╝реЗрдВред</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреГрд╢реНрдпрддрд╛ рдкрд░рд┐рд╡рд░реНрддрди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реЗрд▓ рдпрд╛ рддреЛ рджреГрд╢реНрдпрдорд╛рди рдпрд╛ рдЕрджреГрд╢реНрдп рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдпрд╛ рддреЛ рдЯреБрдХрдбрд╝реА рдХреЗ рджрд╛рдпрд░реЗ рдореЗрдВ рд╣реИ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЕрдЧрд░ рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдмреАрдЪ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЗрдХрд╛рдИ рд▓реЗрддрд╛ рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рджрд╛рдпрд░рд╛ рд╕реЗрд▓ рд╕реЗ рд╕реЗрд▓ рдореЗрдВ рддреБрд░рдВрдд рдХреВрджрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдирддреАрдЬрддрди, рдЖрд╕рдкрд╛рд╕ рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдирд╛рдЯрдХреАрдп рд░реВрдк рд╕реЗ рдмрджрд▓ рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╕реНрдХреНрд╡рд╛рдб рдореВрд╡рдореЗрдВрдЯ рд╕реБрдЪрд╛рд░реВ рд▓рдЧрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рджреГрд╢реНрдпрддрд╛ рдореЗрдВ рдмрджрд▓рд╛рд╡ рдЕрдЪрд╛рдирдХ рд╣реЛрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рджреГрд╢реНрдпрддрд╛ рдХреЛ рднреА рд╕реБрдЪрд╛рд░реВ рд░реВрдк рд╕реЗ рдмрджрд▓рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдХреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдПрдХ рдмрд╛рд░, рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдзреАрд░реЗ-рдзреАрд░реЗ рд░реЛрд╢рди рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдЗрд╕реЗ рдЫреЛрдбрд╝рдХрд░, рдзреАрд░реЗ-рдзреАрд░реЗ рдЧрд╣рд░рд╛ рд╣реЛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рддреБрд░рдВрдд рдмрджрд▓рд╛рд╡ рдкрд╕рдВрдж рдХрд░рддреЗ рд╣реИрдВ? </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЙрд╕ </font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛ рддреНрд╡рд░рд┐рдд рд╕рдВрдХреНрд░рдордг рдХреЛ рд╕реНрд╡рд┐рдЪ рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╕рдВрдХреНрд░рдордг рд╕реБрдЪрд╛рд░реВ рд╣реЛрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ImmediateMode { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдВрдХреНрд░рдордг рд╕реЗрд▓ рдЯреНрд░реИрдХрд┐рдВрдЧ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд┐рдХрдиреА рдмрджрд▓рд╛рд╡ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреЗ рд╣реБрдП рднреА, рд╕рд╣реА рджреГрд╢реНрдпрддрд╛ рдбреЗрдЯрд╛ рдЕрднреА рднреА рдмрд╛рдЗрдирд░реА рд╣реИ, рдЕрд░реНрдерд╛рдд, рдкреНрд░рднрд╛рд╡ рдХреЗрд╡рд▓ рджреГрд╢реНрдп рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рджреГрд╢реНрдпрддрд╛ рдХреЗ рд╕рдВрдХреНрд░рдордг рд╕реЗ рдирд┐рдкрдЯрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП </font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдПрдХ рд╕реВрдЪреА рджреЗрдВрдЧреЗ рдЬрд┐рд╕рдореЗрдВ рд╕рдВрдХреНрд░рдордг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдЖрд░рдВрднреАрдХрд░рдг рдкрд░ рдпрд╣ рдЦрд╛рд▓реА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexCellShaderData</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { Texture2D cellTexture; Color32[] cellTextureData; List&lt;HexCell&gt; transitioningCells = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;HexCell&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ImmediateMode { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { тАж transitioningCells.Clear(); enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд▓рд╣рд╛рд▓, рд╣рдо </font></font><code>RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдзреЗ </font><font style="vertical-align: inherit;">рд╕реЗрд▓ рдбреЗрдЯрд╛ рд╕реЗрдЯ рдХрд░ рд░рд╣реЗ </font><font style="vertical-align: inherit;">рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рддрддреНрдХрд╛рд▓ рд╕рдВрдХреНрд░рдордг рдореЛрдб рдХреЗ рд▓рд┐рдП рдЕрднреА рднреА рд╕рд╣реА рд╣реИ, рд▓реЗрдХрд┐рди рдЬрдм рдЗрд╕реЗ рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдореЗрдВ рд╕рдВрдХреНрд░рдордг рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд╕реВрдЪреА рдореЗрдВ рдПрдХ рд╕реЗрд▓ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = cell.Index; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ImmediateMode) { cellTextureData[index].r = cell.IsVisible ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; cellTextureData[index].g = cell.IsExplored ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { transitioningCells.Add(cell); } enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреГрд╢реНрдпрддрд╛ рдЕрдм рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЕрднреА рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕реВрдЪреА рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░ рд░рд╣реЗ рд╣реИрдВред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓реВрдк рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реВрдк </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реА рдорд╛рдиреЛрдВ рдХреЛ рддреБрд░рдВрдд 255 рдпрд╛ 0 рдкрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдЗрди рдореВрд▓реНрдпреЛрдВ рдХреЛ рдзреАрд░реЗ-рдзреАрд░реЗ рдмрдврд╝рд╛рдПрдВрдЧреЗ / рдШрдЯрд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдкрд░рд┐рд╡рд░реНрддрди рдХреА рдЪрд┐рдХрдирд╛рдИ рдкрд░рд┐рд╡рд░реНрддрди рдХреА рджрд░ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдмрд╣реБрдд рддреЗрдЬ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдмрд╣реБрдд рдзреАрдорд╛ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд╕реБрдВрджрд░ рдмрджрд▓рд╛рд╡ рдФрд░ рдЦреЗрд▓ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рдмреАрдЪ рдПрдХ рдЕрдЪреНрдЫрд╛ рд╕рдордЭреМрддрд╛ рдПрдХ рд╕реЗрдХрдВрдб рдХреЗ рднреАрддрд░ рдмрджрд▓рдирд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕реЗ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рд░рдВрддрд░рддрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> transitionSpeed = <span class="hljs-number"><span class="hljs-number">255f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм </font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдореВрд▓реНрдпреЛрдВ рдкрд░ рд▓рд╛рдЧреВ рдбреЗрд▓реНрдЯрд╛ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рдордп рдбреЗрд▓реНрдЯрд╛ рдХреЛ рдЧрддрд┐ рд╕реЗ рдЧреБрдгрд╛ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдкреВрд░реНрдгрд╛рдВрдХ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдирд╣реАрдВ рдЬрд╛рдирддреЗ рдХрд┐ рдпрд╣ рдХрд┐рддрдирд╛ рдмрдбрд╝рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдлреНрд░реЗрдо рджрд░ рдореЗрдВ рддреЗрдЬ рдЧрд┐рд░рд╛рд╡рдЯ рдбреЗрд▓реНрдЯрд╛ рдХреЛ 255 рд╕реЗ рдЕрдзрд┐рдХ рдмрдирд╛ рд╕рдХрддреА рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдореЗрдВ рд╕рдВрдХреНрд░рдордг рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд╣реЛрдиреЗ рдХреЗ рджреМрд░рд╛рди рдЕрджреНрдпрддрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдХреЛрдб рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрдмрдХрд┐ рд╕реВрдЪреА рдореЗрдВ рдХреБрдЫ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LateUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> delta = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(Time.deltaTime * transitionSpeed); cellTexture.SetPixels32(cellTextureData); cellTexture.Apply(); enabled = transitioningCells.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рд░реВрдк рд╕реЗ рдмрд╣реБрдд рдЙрдЪреНрдЪ рдлреНрд░реЗрдо рджрд░ рд╕рдВрднрд╡ рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рдХрдо рд╕рдВрдХреНрд░рдордг рдХреА рдЧрддрд┐ рдХреЗ рд╕рд╛рде рд╕рдВрдпреЛрдЬрди рдореЗрдВ, рдпрд╣ рд╣рдореЗрдВ 0. рдХрд╛ рдбреЗрд▓реНрдЯрд╛ рджреЗ рд╕рдХрддрд╛ рд╣реИред рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдиреНрдпреВрдирддрдо 1 рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> delta = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(Time.deltaTime * transitionSpeed); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta == <span class="hljs-number"><span class="hljs-number">0</span></span>) { delta = <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбреЗрд▓реНрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рд╕рднреА рд╕рдВрдХреНрд░рдордг рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рд▓реВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдирдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рд╣реИ </font></font><code>UpdateCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬрд┐рд╕рдХреЗ рдкреИрд░рд╛рдореАрдЯрд░ рд╕рдВрдмрдВрдзрд┐рдд рд╕реЗрд▓ рдФрд░ рдбреЗрд▓реНрдЯрд╛ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> delta = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(Time.deltaTime * transitionSpeed); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta == <span class="hljs-number"><span class="hljs-number">0</span></span>) { delta = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; transitioningCells.Count; i++) { UpdateCellData(transitioningCells[i], delta); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреБрдЫ рдмрд┐рдВрджреБ рдкрд░, рд╕реЗрд▓ рд╕рдВрдХреНрд░рдордг рдкреВрд░рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдорд╛рди рд▓реЗрдВ рдХрд┐ рд╡рд┐рдзрд┐ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рджреЗрддреА рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╕рдВрдХреНрд░рдордг рдЕрднреА рднреА рдЬрд╛рд░реА рд╣реИред </font><font style="vertical-align: inherit;">рдЬрдм рдпрд╣ рдЪрд▓рдирд╛ рдмрдВрдж рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдо рд╕реЗрд▓ рдХреЛ рд╕реВрдЪреА рд╕реЗ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреЛ рдХрдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рди рдЫреЛрдбрд╝реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; transitioningCells.Count; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!UpdateCellData(transitioningCells[i], delta)) { transitioningCells.RemoveAt(i--); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд┐рд╕ рдХреНрд░рдо рдореЗрдВ рд╕рдВрдХреНрд░рдордг рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рд╡рд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рд╡рд░реНрддрдорд╛рди рд╕реВрдЪрдХрд╛рдВрдХ рдореЗрдВ рд╕реЗрд▓ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЬреЛ </font></font><code>RemoveAt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ </font><font style="vertical-align: inherit;">рдХреЛ </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрд╛рдж рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд </font><font style="vertical-align: inherit;">рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдордЬрдмреВрд░ рдХрд░реЗрдЧрд╛ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдЕрдВрддрд┐рдо рд╕реЗрд▓ рдХреЛ рд╡рд░реНрддрдорд╛рди рд╕реВрдЪрдХрд╛рдВрдХ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдЕрдВрддрд┐рдо рдХреЛ рд╣рдЯрд╛рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!UpdateCellData(transitioningCells[i], delta)) { transitioningCells[i--] = transitioningCells[transitioningCells.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>]; transitioningCells.RemoveAt(transitioningCells.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рдПрдХ рд╡рд┐рдзрд┐ рдмрдирд╛рдиреА рд╣реЛрдЧреА </font></font><code>UpdateCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЕрдкрдирд╛ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрд╕реЗ рдПрдХ рд╕реВрдЪрдХрд╛рдВрдХ рдФрд░ рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рддреЛ рдЪрд▓реЛ рдЙрдиреНрд╣реЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░рдХреЗ рд╢реБрд░реВ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рднреА рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рд╕реЗрд▓ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦрдирд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╣рдо рдорд╛рди рд▓реЗрдВрдЧреЗ рдХрд┐ рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдХрд╛рдо рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдмрджрд▓реЗ рд╣реБрдП рдбреЗрдЯрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдФрд░ "рдЕрдкрдбреЗрдЯ рдЬрд╛рд░реА рд╣реИ" рд╕реНрдерд┐рддрд┐ рдХреЛ рд╡рд╛рдкрд╕ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = cell.Index; Color32 data = cellTextureData[index]; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> stillUpdating = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; cellTextureData[index] = data; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stillUpdating; }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрд▓ рдбреЗрдЯрд╛ рдХреЛ рдЕрджреНрдпрддрди рдХрд░рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд╕реНрддрд░ рдкрд░, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рд╕реЗрд▓ рд╣реИ рдЬреЛ рд╕рдВрдХреНрд░рдордг рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╣реИ рдпрд╛ рдЗрд╕реЗ рдкрд╣рд▓реЗ рд╣реА рдкреВрд░рд╛ рдХрд░ рдЪреБрдХрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╕реЗрд▓ рдЬрд╛рдВрдЪ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдХреЛрд╢рд┐рдХрд╛ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХрд╛ рдЬреА рдореВрд▓реНрдп 255 рдХреЗ рдмрд░рд╛рдмрд░ рдирд╣реАрдВ рд╣реИ, рддреЛ рдпрд╣ рд╕рдВрдХреНрд░рдордг рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕ рдкрд░ рдирдЬрд░ рд░рдЦреЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> stillUpdating = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsExplored &amp;&amp; data.g &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>) { stillUpdating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } cellTextureData[index] = data;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдХреНрд░рдордг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕реЗрд▓ рдХреЗ G рдорд╛рди рдореЗрдВ рдПрдХ рдбреЗрд▓реНрдЯрд╛ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЕрдВрдХрдЧрдгрд┐рдд рд╕рдВрдЪрд╛рд▓рди рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рд╡реЗ рдкрд╣рд▓реЗ рдкреВрд░реНрдгрд╛рдВрдХ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдпреЛрдЧ рдореЗрдВ рдкреВрд░реНрдгрд╛рдВрдХ рдкреНрд░рд╛рд░реВрдк рд╣реЛрдЧрд╛, рдЬрд┐рд╕реЗ рдмрд╛рдЗрдЯ рдореЗрдВ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsExplored &amp;&amp; data.g &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>) { stillUpdating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = data.g + delta; data.g = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)t; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓реЗрдХрд┐рди рд░реВрдкрд╛рдВрддрд░рдг рд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдорд╛рди 255 рд╕реЗ рдЕрдзрд┐рдХ рди рд╣реЛред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = data.g + delta; data.g = t &gt;= <span class="hljs-number"><span class="hljs-number">255</span></span> ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)t;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдЧрд▓рд╛, рд╣рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рдХреЗ рд▓рд┐рдП рдРрд╕рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬреЛ рдЖрд░ рдХреЗ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsExplored &amp;&amp; data.g &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>) { тАж } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsVisible &amp;&amp; data.r &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>) { stillUpdating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = data.r + delta; data.r = t &gt;= <span class="hljs-number"><span class="hljs-number">255</span></span> ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)t; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪреВрдВрдХрд┐ рд╕реЗрд▓ рдлрд┐рд░ рд╕реЗ рдЕрджреГрд╢реНрдп рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд╣рдореЗрдВ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЖрд░ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдХрдо рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред рдРрд╕рд╛ рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рд╕реЗрд▓ рдЕрджреГрд╢реНрдп рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЖрд░ рд╢реВрдиреНрдп рд╕реЗ рдЕрдзрд┐рдХ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsVisible) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.r &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>) { stillUpdating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = data.r + delta; data.r = t &gt;= <span class="hljs-number"><span class="hljs-number">255</span></span> ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)t; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.r &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { stillUpdating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> t = data.r - delta; data.r = t &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)t; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдпрд╣ </font></font><code>UpdateCellData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреИрдпрд╛рд░ рдФрд░ рджреГрд╢реНрдпрддрд╛ рд╕рдВрдХреНрд░рдордг рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдкрд░рд┐рд╡рд░реНрддрдиред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рд╕рдВрдХреНрд░рдордг рддрддреНрд╡реЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рд╡рд░реНрддрди рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдЖрдЗрдЯрдо рд╕реВрдЪреА рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рд╕реЗрд▓ рдХреА рджреГрд╢реНрдпрддрд╛ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рд╣реЛрддрд╛ рд╣реИ рдЬрдмрдХрд┐ рдпрд╣ рдЕрднреА рднреА рд╕рдВрдХреНрд░рдордг рдореЗрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬрдм рд╕реЗрд▓ рдХреЗрд╡рд▓ рдереЛрдбрд╝реЗ рд╕рдордп рдХреЗ рд▓рд┐рдП рджрд╕реНрддреЗ рдХреЗ рдЖрдВрджреЛрд▓рди рдХреЗ рджреМрд░рд╛рди рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рддрддреНрд╡реЛрдВ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рд╕реЗрд▓ рд╕рдВрдХреНрд░рдордг рдХреЛ рдкреНрд░рддрд┐ рдлреНрд░реЗрдо рдХрдИ рдмрд╛рд░ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рддреЗрдЬреА рд╕реЗ рд╕рдВрдХреНрд░рдордг рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд╛рдо рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рд╕реЗрд▓ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЬрд╛рдБрдЪ рдХрд░рдХреЗ рдЗрд╕реЗ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕реВрдЪреА рдореЗрдВ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рд░ рдХреЙрд▓ рдкрд░ рдПрдХ рд╕реВрдЪреА рдЦреЛрдЬ</font></font><code>RefreshVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╣рдВрдЧрд╛, рдЦрд╛рд╕рдХрд░ рдЬрдм рдХрдИ рд╕реЗрд▓ рд╕рдВрдХреНрд░рдордг рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдЪрд▓рд┐рдП рдПрдХ рдФрд░ рдЪреИрдирд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрднреА рддрдХ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╕реЗрд▓ рд╕рдВрдХреНрд░рдордг рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдорд╛рди B. рд╕реВрдЪреА рдореЗрдВ рдПрдХ рд╕реЗрд▓ рдЬреЛрдбрд╝рддреЗ рд╕рдордп, рд╣рдо рдЗрд╕реЗ рдорд╛рди 255 рдкрд░ рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдХреЗрд╡рд▓ рдЙрди рд╕реЗрд▓ рдХреЛ рдЬреЛрдбрд╝реЗрдВрдЧреЗ рдЬрд┐рдирдХрд╛ рдорд╛рди 255 рдХреЗ рдмрд░рд╛рдмрд░ рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefreshVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = cell.Index; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ImmediateMode) { cellTextureData[index].r = cell.IsVisible ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; cellTextureData[index].g = cell.IsExplored ? (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">255</span></span> : (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cellTextureData[index].b != <span class="hljs-number"><span class="hljs-number">255</span></span>) { cellTextureData[index].b = <span class="hljs-number"><span class="hljs-number">255</span></span>; transitioningCells.Add(cell); } enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд╕реЗрд▓ рд╕рдВрдХреНрд░рдордг рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж B рдХрд╛ рдорд╛рди рд░реАрд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateCellData</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!stillUpdating) { data.b = <span class="hljs-number"><span class="hljs-number">0</span></span>; } cellTextureData[index] = data; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stillUpdating; }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдХрд▓ рдХреЗ рдмрд┐рдирд╛ рд╕рдВрдХреНрд░рдордгред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рддреБрд░рдВрдд рджреГрд╢реНрдпрддрд╛ рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдкрд░рд┐рд╡рд░реНрддрди рдЕрдм рд╣рдореЗрд╢рд╛ рдХреНрд░рдорд┐рдХ рд╣реЛрддреЗ рд╣реИрдВ, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдПрдХ рдирдХреНрд╢рд╛ рд▓реЛрдб рдХрд░рддреЗ рд╕рдордп рднреАред </font><font style="vertical-align: inherit;">рдпрд╣ рдЕрддрд╛рд░реНрдХрд┐рдХ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдорд╛рдирдЪрд┐рддреНрд░ рдЙрд╕ рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдПрдБ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣рд╛рдБ рд╕рдВрдХреНрд░рдордг рдЕрдиреБрдЪрд┐рдд рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ рдмрдбрд╝реЗ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЗ рдХрдИ рджреГрд╢реНрдпрдорд╛рди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрдХреНрд░рдордг рдХрд░рдиреЗ рд╕реЗ рд▓реЛрдб рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдЦреЗрд▓ рдзреАрдорд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдФрд░ рджрд╕реНрддреЛрдВ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЖрдЗрдП </font></font><code>HexGrid.Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреБрд░рдВрдд рд╕рдВрдХреНрд░рдордг рдореЛрдб рдореЗрдВ рдЬрд╛рдПрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> header</span></span></span><span class="hljs-function">)</span></span> { тАж cellShaderData.ImmediateMode = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { cells[i].Load(reader, header); } тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреЛ рд╣рдо рддрддреНрдХрд╛рд▓ рд╕рдВрдХреНрд░рдордг рдореЛрдб рдХреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕реЗрдЯрд┐рдВрдЧ рдХреЛ рдлрд┐рд░ рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рднреА рд╣реЛред </font><font style="vertical-align: inherit;">рд╢рд╛рдпрдж рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдмрдВрдж рд╣реИ, рдпрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╡рд┐рдХрд▓реНрдк рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдореЛрдб рдХреЛ рдпрд╛рдж рд░рдЦреЗрдВрдЧреЗ рдФрд░ рдХрд╛рдо рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдЗрд╕реЗ рд╕реНрд╡рд┐рдЪ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> header</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> originalImmediateMode = cellShaderData.ImmediateMode; cellShaderData.ImmediateMode = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; тАж cellShaderData.ImmediateMode = originalImmediateMode; }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдКрдВрдЪрд╛рдИ-рдирд┐рд░реНрднрд░ рдЧреБрдВрдЬрд╛рдЗрд╢ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рддрдХ рд╣рдордиреЗ рд╕рднреА рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЗ рд▓рд┐рдП рддреАрди рдХреЗ рдирд┐рд░рдВрддрд░ рджрд╛рдпрд░реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред рд╕рд╛рдорд╛рдиреНрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдо рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рджреЛ рдХрд╛рд░рдгреЛрдВ рд╕реЗ рдирд╣реАрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: рдпрд╛ рддреЛ рдХреБрдЫ рдмрд╛рдзрд╛ рд╣рдореЗрдВ рдЗрд╕реЗ рджреЗрдЦрдиреЗ рд╕реЗ рд░реЛрдХрддреА рд╣реИ, рдпрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрд╣реБрдд рдЫреЛрдЯрд╛ рдпрд╛ рджреВрд░ рд╣реИред рд╣рдорд╛рд░реЗ рдЦреЗрд▓ рдореЗрдВ, рд╣рдо рдХреЗрд╡рд▓ рдЧреБрдВрдЬрд╛рдЗрд╢ рд╕реАрдорд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдпрд╣ рдирд╣реАрдВ рджреЗрдЦ рд╕рдХрддреЗ рдХрд┐ рдкреГрдереНрд╡реА рдХреЗ рд╡рд┐рдкрд░реАрдд рджрд┐рд╢рд╛ рдореЗрдВ рдХреНрдпрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЧреНрд░рд╣ рд╣рдореЗрдВ рдЕрд╕реНрдкрд╖реНрдЯ рдХрд░рддрд╛ рд╣реИред рд╣рдо рдХреЗрд╡рд▓ рдХреНрд╖рд┐рддрд┐рдЬ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред рдЪреВрдБрдХрд┐ рдЧреНрд░рд╣ рдХреЛ рд▓рдЧрднрдЧ рдПрдХ рдЧреЛрд▓рд╛ рдорд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рджреЗрдЦрдиреЗ рдХрд╛ рдмрд┐рдВрджреБ рдЬрд┐рддрдирд╛ рдЕрдзрд┐рдХ рд╣реЛрдЧрд╛, рдЙрддрдиреА рдЕрдзрд┐рдХ рд╕рддрд╣ рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рддреН рдХреНрд╖рд┐рддрд┐рдЬ рдКрдБрдЪрд╛рдИ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/071/788/208/0717882082a42e92b14e158876c6e28b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд╖рд┐рддрд┐рдЬ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рдКрдВрдЪрд╛рдИ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реА рдЗрдХрд╛рдЗрдпреЛрдВ рдХреА рд╕реАрдорд┐рдд рджреГрд╢реНрдпрддрд╛ рдкреГрдереНрд╡реА рдХреА рд╡рдХреНрд░рддрд╛ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП рдХреНрд╖рд┐рддрд┐рдЬ рдкреНрд░рднрд╛рд╡ рдХреА рдирдХрд▓ рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЙрдирдХреА рд╕рдореАрдХреНрд╖рд╛ рдХреА рд╕реАрдорд╛ рдЧреНрд░рд╣ рдХреЗ рдЖрдХрд╛рд░ рдФрд░ рдирдХреНрд╢реЗ рдХреЗ рдкреИрдорд╛рдиреЗ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдХрдо рд╕реЗ рдХрдо рд╡рд╣ рддрд╛рд░реНрдХрд┐рдХ рд╡реНрдпрд╛рдЦреНрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЧреБрдВрдЬрд╛рдЗрд╢ рдХрдо рдХрд░рдиреЗ рдХрд╛ рдореБрдЦреНрдп рдХрд╛рд░рдг рдЧреЗрдордкреНрд▓реЗ рд╣реИ, рдпрд╣ рдПрдХ рд╕реАрдорд╛ рд╣реИ рдЬрд┐рд╕реЗ рдпреБрджреНрдз рдХрд╛ рдХреЛрд╣рд░рд╛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рднреМрддрд┐рдХреА рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд╣реИ, рд╣рдо рдпрд╣ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдЙрдЪреНрдЪ рдмрд┐рдВрджреБ рдХрд╛ рд░рдгрдиреАрддрд┐рдХ рдореВрд▓реНрдп рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдХреНрд╖рд┐рддрд┐рдЬ рдХреЛ рджреВрд░ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЖрдкрдХреЛ рдХрдо рдмрд╛рдзрд╛рдУрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрднреА рддрдХ рд╣рдордиреЗ рдЗрд╕реЗ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдореАрдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдКрдВрдЪрд╛рдИ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджрд╛рдпрд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╕рдордп рдКрдВрдЪрд╛рдИ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдКрдВрдЪрд╛рдИ рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдЬрдореАрди рдХреА рд╕реЗрд▓ рдпрд╛ рдкрд╛рдиреА рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкрд╛рдиреА рдХреА рд╕рд╛рдорд╛рдиреНрдп рдКрдВрдЪрд╛рдИ рдпрд╛ рд╕реНрддрд░ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕реЗ </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ViewElevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation &gt;= waterLevel ? elevation : waterLevel; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдКрдВрдЪрд╛рдИ рдЧреБрдВрдЬрд╛рдЗрд╢ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреА рд╣реИ, рддреЛ рд╕реЗрд▓ рдХреА рджреЗрдЦрдиреЗ рдХреА рдКрдВрдЪрд╛рдИ рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХреЗ рд╕рд╛рде, рджреГрд╢реНрдпрддрд╛ рдХреА рд╕реНрдерд┐рддрд┐ рднреА рдмрджрд▓ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╕реЗрд▓ рдЕрд╡рд░реБрджреНрдз рд╣реЛ рдЧрдпрд╛ рд╣реИ рдпрд╛ рдЕрдм рдХрдИ рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЗ рджрд╛рдпрд░реЗ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рдЗрддрдирд╛ рдЖрд╕рд╛рди рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕реЗрд▓ рд╕реНрд╡рдпрдВ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХреА рд╕реВрдЪрдирд╛ рджреЗрдВ </font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рдЖрдкрдХреЗ </font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рд╕ рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рддрд░реАрдХрд╛ рд╣реИ </font></font><code>ViewElevationChanged</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><code>HexCell.Elevation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ рдкрд░ рдХрд╣реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elevation; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (elevation == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalViewElevation = ViewElevation; elevation = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ViewElevation != originalViewElevation) { ShaderData.ViewElevationChanged(); } тАж } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕реА рдХреЗ рд▓рд┐рдП рдЬрд╛рддрд╛ рд╣реИ </font></font><code>WaterLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> WaterLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> waterLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (waterLevel == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalViewElevation = ViewElevation; waterLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ViewElevation != originalViewElevation) { ShaderData.ViewElevationChanged(); } ValidateRivers(); Refresh(); } }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреГрд╢реНрдпрддрд╛ рд░реАрд╕реЗрдЯ рдХрд░реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рдПрдХ рд╡рд┐рдзрд┐ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>HexCellShaderData.ViewElevationChanged</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рдХрд┐ рд╕рд╛рдорд╛рдиреНрдп рджреГрд╢реНрдпрддрд╛ рдХреА рд╕реНрдерд┐рддрд┐ рдХреИрд╕реЗ рдмрджрд▓рддреА рд╣реИ, рдПрдХ рдЬрдЯрд┐рд▓ рдХрд╛рд░реНрдп рд╣реИ, рд╡рд┐рд╢реЗрд╖рдХрд░ рдЬрдм рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдХрдИ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдмрджрд▓рдирд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рдХрд┐рд╕реА рднреА рдЪрд╛рд▓ рдХреЗ рд╕рд╛рде рдирд╣реАрдВ рдЖрдПрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдмрд╕ рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рд░реАрд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмреВрд▓рд┐рдпрди рдлрд╝реАрд▓реНрдб рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдХреЗ рдЕрдВрджрд░, рд╣рдо рдЗрд╕реЗ рд╕рд╣реА рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдШрдЯрдХ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдЬреЛ рдПрдХ рд╕рд╛рде рдмрджрд▓ рдЧрдИ рд╣реИрдВ, рдЗрд╕рдХреЗ рдмрд╛рд╡рдЬреВрдж рдпрд╣ рдПрдХрд▓ рд░реАрд╕реЗрдЯ рдХреА рдУрд░ рд▓реЗ рдЬрд╛рдПрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> needsVisibilityReset; тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewElevationChanged</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { needsVisibilityReset = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рджреГрд╢реНрдпрдорд╛рди рдореВрд▓реНрдпреЛрдВ рдХреЛ рд░реАрд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЗ рдкрд╛рд╕ рдЙрдирдХреА рдкрд╣реБрдВрдЪ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рдЬреЛ рдЖрдкрдХреЗ рдкрд╛рд╕ </font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рддреЛ рдЖрдЗрдП рдЗрд╕ рдЬрд┐рдореНрдореЗрджрд╛рд░реА рдХреЛ рд╕реМрдВрдкрддреЗ рд╣реИрдВ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ </font></font><code>HexCellShaderData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ </font><font style="vertical-align: inherit;">, рдЬреЛ рдЖрдкрдХреЛ рдЧреНрд░рд┐рдб рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╣рдо </font></font><code>LateUpdate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реАрд╕реЗрдЯ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGrid Grid { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LateUpdate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (needsVisibilityReset) { needsVisibilityReset = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Grid.ResetVisibility(); } тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><code>HexGrid.Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реЗрдбрд░ рдбреЗрдЯрд╛ рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж </font><font style="vertical-align: inherit;">рдЧреНрд░рд┐рдб рдХреЗ рд▓рд┐рдП рд▓рд┐рдВрдХ рд╕реЗрдЯ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; HexMetrics.InitializeHashGrid(seed); HexUnit.unitPrefab = unitPrefab; cellShaderData = gameObject.AddComponent&lt;HexCellShaderData&gt;(); cellShaderData.Grid = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; CreateMap(cellCountX, cellCountZ); }</code> </pre> <br> <code>HexGrid</code><font style="vertical-align: inherit;"></font><code>ResetVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рддреНрдпрд╛рдЧрдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдПрдХ рд╡рд┐рдзрд┐ рднреА рдорд┐рд▓рдиреА рдЪрд╛рд╣рд┐рдП </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдмрд╕ рдЗрд╕реЗ рд▓реВрдк рдХреА рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдЬрд╛рдиреЗ рджреЗрдВ рдФрд░ рд░реАрд╕реЗрдЯ рдХреЛ рдЦреБрдж рдХреЛ рд╕реМрдВрдк рджреЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResetVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { cells[i].ResetVisibility(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>ResetVisibilty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдмрд╕ рджреГрд╢реНрдпрддрд╛ рдХреЛ рд╢реВрдиреНрдп рдХрд░ рджреЗрдЧрд╛ рдФрд░ рджреГрд╢реНрдпрддрд╛ рдЕрджреНрдпрддрди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рддрдм рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм рд╕реЗрд▓ рджреГрд╢реНрдпрддрд╛ рд╢реВрдиреНрдп рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResetVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visibility &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { visibility = <span class="hljs-number"><span class="hljs-number">0</span></span>; ShaderData.RefreshVisibility(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рднреА рджреГрд╢реНрдпрддрд╛ рдбреЗрдЯрд╛ рдХреЛ рд░реАрд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, </font></font><code>HexGrid.ResetVisibility</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕реЗ рдлрд┐рд░ рд╕реЗ рд╕рднреА рд╕реНрдХреНрд╡рд╛рдб рдореЗрдВ рджреГрд╢реНрдпрддрд╛ рд▓рд╛рдЧреВ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдЙрд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдХреНрд╡рд╛рдб рдХрд╛ рджрд╛рдпрд░рд╛ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рдпрд╣ рд╕рдВрдкрддреНрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font></font><code>VisionRange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResetVisibility</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { cells[i].ResetVisibility(); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; units.Count; i++) { HexUnit unit = units[i]; IncreaseVisibility(unit.Location, unit.VisionRange); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдХрд╛рдо рдХреЗ рд▓рд┐рдП, рд╣рдо рдирд╛рдо рдмрджрд▓рдиреЗ </font></font><code>HexUnit.visionRange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВрдЧреЗ </font></font><code>HexUnit.VisionRange</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реЗ рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ рдмрджрд▓ </font><font style="vertical-align: inherit;">рджреЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЬрдмрдХрд┐ рдЗрд╕реЗ 3 рдХрд╛ рдирд┐рд░рдВрддрд░ рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рднрд╡рд┐рд╖реНрдп рдореЗрдВ рдпрд╣ рдмрджрд▓ рдЬрд╛рдПрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> VisionRange { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рджреГрд╢реНрдпрддрд╛ рдбреЗрдЯрд╛ рд░реАрд╕реЗрдЯ рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рд╕реЗрд▓ рджреЗрдЦрдиреЗ рдХреА рдКрдБрдЪрд╛рдИ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рдж рд╕рд╣реА рд░рд╣реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╣рдо рдкреНрд▓реЗ рдореЛрдб рдореЗрдВ рдЧреБрдВрдЬрд╛рдЗрд╢ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рдиреЗ рдФрд░ рдкреБрдирд░реНрдореВрд▓реНрдпрд╛рдВрдХрди рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдореЛрдВ рдХреЛ рдмрджрд▓ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдЧреБрдВрдЬрд╛рдЗрд╢ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдмрджрд▓ рдЬрд╛рдП, рдЪрд▓реЛ рдПрдХ рд░реАрд╕реЗрдЯ рдЪрд▓рд╛рддреЗ рд╣реИрдВ </font></font><code>HexGrid.OnEnable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдкреБрдирд░реНрд╕рдВрдпреЛрдЬрди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!HexMetrics.noiseSource) { тАж ResetVisibility(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдм рдЖрдк рд╕реНрдХреЛрдк рдХреЛрдб рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкреНрд▓реЗ рдореЛрдб рдореЗрдВ рд░рд╣рддреЗ рд╣реБрдП рдкрд░рд┐рдгрд╛рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреНрд╖рд┐рддрд┐рдЬ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджрд╛рдпрд░реЗ рдХреА рдЧрдгрдирд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реИ </font></font><code>HexGrid.GetVisibleCells</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдКрдВрдЪрд╛рдИ рдЧреБрдВрдЬрд╛рдЗрд╢ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреА рд╣реИ, рд╣рдо рдмрд╕ </font></font><code>fromCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╕рд╛рд░рдг рдХреНрд╖реЗрддреНрд░ рдХреЛ рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рдкреБрдирд░реНрдкрд░рд┐рднрд╛рд╖рд┐рдд </font><font style="vertical-align: inherit;">рдХрд░рдХреЗ рджреЗрдЦрдиреЗ рдХреА рдКрдВрдЪрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВред </font><font style="vertical-align: inherit;">рддреЛ рд╣рдо рдЖрд╕рд╛рдиреА рд╕реЗ рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">List&lt;HexCell&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetVisibleCells</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell fromCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> range</span></span></span><span class="hljs-function">)</span></span> { тАж range = fromCell.ViewElevation; fromCell.SearchPhase = searchFrontierPhase; fromCell.Distance = <span class="hljs-number"><span class="hljs-number">0</span></span>; searchFrontier.Enqueue(fromCell); тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/727/032/6d3/7270326d379796f2b4f2f3c3ca65512c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рджрд╛рдпрд░реЗ рдХреЗ рд░реВрдк рдореЗрдВ рдКрдВрдЪрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреГрд╢реНрдпрддрд╛ рдореЗрдВ рдмрд╛рдзрд╛рдПрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЗрдЦрдиреЗ рдХреА рдКрдВрдЪрд╛рдИ рдХреЛ рдПрдХ рджрд╛рдпрд░реЗ рдХреЗ рд░реВрдк рдореЗрдВ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдХреЗрд╡рд▓ рддрднреА рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬрдм рдЕрдиреНрдп рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдПрдВ рд╢реВрдиреНрдп рдКрдВрдЪрд╛рдИ рдкрд░ рд╣реЛрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреГрд╖реНрдЯрд┐ рдХреЗ рд╕рдорд╛рди рдКрдВрдЪрд╛рдИ рд╣реИ, рддреЛ рджреЗрдЦрдиреЗ рдХрд╛ рдХреНрд╖реЗрддреНрд░ рд╢реВрдиреНрдп рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЙрдЪреНрдЪ рдКрдВрдЪрд╛рдЗрдпреЛрдВ рд╡рд╛рд▓реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЙрдирдХреЗ рдкреАрдЫреЗ рдХрдо рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рд░реЛрдХрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЕрдм рддрдХ, рдЗрд╕рдореЗрдВ рд╕реЗ рдХреЛрдИ рднреА рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de8/7be/a6f/de87bea6f4b88cd61765450a63f738f9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджрд╛рдпрд░рд╛ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреБрдВрдЬрд╛рдЗрд╢ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рд╕рд╣реА рддрд░реАрдХрд╛ рдХрд┐рд░рдгреЛрдВ рдХреЗ рдЙрддреНрд╕рд░реНрдЬрди рджреНрд╡рд╛рд░рд╛ рдЬрд╛рдВрдЪрдирд╛ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдЬрд▓реНрджреА рд╕реЗ рдорд╣рдВрдЧрд╛ рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЕрднреА рднреА рдЕрдЬреАрдм рдкрд░рд┐рдгрд╛рдо рджреЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдПрдХ рддреНрд╡рд░рд┐рдд рд╕рдорд╛рдзрд╛рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рдЕрдЪреНрдЫреЗ рдкрд░реНрдпрд╛рдкреНрдд рдкрд░рд┐рдгрд╛рдо рдмрдирд╛рддрд╛ рд╣реИ рдЬреЛ рд╕рд╣реА рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рд╕реНрдХреЛрдк рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рдирд┐рдпрдо рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд░рд▓, рд╕рд╣рдЬ рдФрд░ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдпреЛрдЧреНрдп рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░рд╛ рд╕рдорд╛рдзрд╛рди рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реЛрдЧрд╛ - рдЬрдм рдПрдХ рд╕реЗрд▓ рдХреА рджреГрд╢реНрдпрддрд╛ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдкрдбрд╝реЛрд╕реА рд╕реЗрд▓ рдХреА рджреЗрдЦрдиреЗ рдХреА рдКрдВрдЪрд╛рдИ рдХреЛ рдХрд╡рд░ рджреВрд░реА рддрдХ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдЬрдм рд╣рдо рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдЧреБрдВрдЬрд╛рдЗрд╢ рдХрдо рдХрд░ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рдЙрдиреНрд╣реЗрдВ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╣рдореЗрдВ рдЙрдирдХреЗ рдкреАрдЫреЗ рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> distance = current.Distance + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (distance + neighbor.ViewElevation &gt; range) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/774/44c/efe/77444cefe82d428ee32e094213e82a1a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдЪреНрдЪ рдХреЛрд╢рд┐рдХрд╛рдПрдВ рджреГрд╢реНрдп рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░рддреА рд╣реИрдВред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рд╣рдореЗрдВ рджреВрд░реА рдореЗрдВ рд▓рдореНрдмреА рдХреЛрд╢рд┐рдХрд╛рдПрдБ рдирд╣реАрдВ рджреЗрдЦрдиреА рдЪрд╛рд╣рд┐рдП?</font></font></b> <div class="spoiler_text">      ,     ,   ,   .       ,       . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрдиреЛрдВ рдХреЗ рдЖрд╕рдкрд╛рд╕ рди рджреЗрдЦреЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЙрдЪреНрдЪ рдХреЛрд╢рд┐рдХрд╛рдПрдВ рджреГрд╢реНрдп рдХреЛ рдирд┐рдореНрди рд╕реНрддрд░ рдкрд░ рд░реЛрдХрддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХрднреА-рдХрднреА рдпрд╣ рдЧреБрдВрдЬрд╛рдЗрд╢ рдЙрдирдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╡реЗрд╢ рдХрд░рддреА рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЦреЛрдЬ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдЕрднреА рднреА рдЕрд╡рд░реБрджреНрдз рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рддреЗ рд╣реБрдП рдЗрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд░рд╛рд╕реНрддрд╛ рдЦреЛрдЬрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╣рдорд╛рд░реА рджреГрд╢реНрдпрддрд╛ рдХрд╛ рдХреНрд╖реЗрддреНрд░ рдмрд╛рдзрд╛рдУрдВ рдХреЗ рдЖрд╕рдкрд╛рд╕ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╕реЗрд▓ рджреГрд╢реНрдпрддрд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╕рдордп рдХреЗрд╡рд▓ рд╕рдмрд╕реЗ рдЫреЛрдЯреЗ рд░рд╛рд╕реНрддреЛрдВ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рдПред </font><font style="vertical-align: inherit;">рдпрд╣ рдЙрди рдорд╛рд░реНрдЧреЛрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЖрд╡рд╢реНрдпрдХ рд╕реЗ рдЕрдзрд┐рдХ рд▓рдВрдмреЗ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> HexCoordinates fromCoordinates = fromCell.coordinates; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { тАж <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { тАж <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> distance = current.Distance + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (distance + neighbor.ViewElevation &gt; range || distance &gt; fromCoordinates.DistanceTo(neighbor.coordinates) ) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } тАж } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30d/bfa/1c2/30dbfa1c2df2fb6119249f00cdc3d8d8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдХреЗрд╡рд▓ рд╕рдмрд╕реЗ рдЫреЛрдЯреЗ рд░рд╛рд╕реНрддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕рд▓рд┐рдП рд╣рдордиреЗ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЧрд▓рдд рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд╕реЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рдХреЛ рдареАрдХ рдХрд░ рджрд┐рдпрд╛ред рдкрд╛рд╕ рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЙрдирдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рд╕рдмрд╕реЗ рдЫреЛрдЯреЗ рд░рд╛рд╕реНрддреЗ рд╣реИрдВред рдкрдереЛрдВ рдХреЗ рд▓рд┐рдП рджреВрд░ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдкрд╛рд╕ рдЕрдзрд┐рдХ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП, рд▓рдВрдмреА рджреВрд░реА рдкрд░, рджреГрд╢реНрдпрддрд╛ рдХрд╛ рдПрдХ рд▓рд┐рдлрд╛рдлрд╛ рдЕрднреА рднреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдПрдХ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реЛрдЧреА рдЕрдЧрд░ рджреГрд╢реНрдпрддрд╛ рдХреНрд╖реЗрддреНрд░ рдЫреЛрдЯреЗ рд░рд╣реЗрдВрдЧреЗ рдФрд░ рдЖрд╕-рдкрд╛рд╕ рдХреА рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдореЗрдВ рдЕрдВрддрд░ рдмрд╣реБрдд рдмрдбрд╝рд╛ рдирд╣реАрдВ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЕрдВрдд рдореЗрдВ, рджреЗрдЦрдиреЗ рдХреЗ рдкреНрд░реЗрд╖рд┐рдд рдХреНрд╖реЗрддреНрд░ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдЗрд╕реЗ рджреГрд╢реНрдп рдХреА рдКрдВрдЪрд╛рдИ рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред рджрд╕реНрддреЗ рдХрд╛ рдЕрдкрдирд╛ рд╕реНрд╡рдпрдВ рдХрд╛ рдХреНрд╖реЗрддреНрд░ рдЗрд╕рдХреА рдКрдБрдЪрд╛рдИ, рдЙрдбрд╝рд╛рди рдХреА рдКрдБрдЪрд╛рдИ, рдпрд╛ рдЯреЛрд╣реА рдХреНрд╖рдорддрд╛рдУрдВ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> range += fromCell.ViewElevation;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ff/1ce/a2b/3ff1cea2b833bda69990576fa8323aec.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдо рдмрд┐рдВрджреБ рдкрд░ рдкреВрд░реНрдг рджреГрд╢реНрдп рдХреЗ рд╕рд╛рде рджреЗрдЦреЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣реА рд╣реИ, рджреГрд╢реНрдпрддрд╛ рдХреЗ рдЕрдВрддрд┐рдо рдирд┐рдпрдо рджреГрд╖реНрдЯрд┐ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВ рдЬрдм рджреГрд╢реНрдп рдХреЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╕рдмрд╕реЗ рдЫреЛрдЯреЗ рдорд╛рд░реНрдЧ рдХреЗ рд╕рд╛рде рдЪрд▓рддреЗ рд╣реБрдП, рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рд╕реЗрд▓ рдКрдВрдЪрд╛рдИ рдореЗрдВ рдЕрдВрддрд░ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдПред </font><font style="vertical-align: inherit;">рдЬрдм рдПрдХ рд╕реЗрд▓ рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░ рд╕реЗ рдмрд╛рд╣рд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рдЗрд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рднреА рд░рд╛рд╕реНрддреЛрдВ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдирддреАрдЬрддрди, рдЙрдЪреНрдЪ рдЕрд╡рд▓реЛрдХрди рдмрд┐рдВрджреБ, рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рдХреБрдЫ рднреА рджреГрд╢реНрдп рдХреЛ рд░реЛрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рд░рдгрдиреАрддрд┐рдХ рд░реВрдк рд╕реЗ рдореВрд▓реНрдпрд╡рд╛рди рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╕реНрддреБрдУрдВ рдХреА рджреГрд╢реНрдпрддрд╛ рдореЗрдВ рдмрд╛рдзрд╛ рдбрд╛рд▓рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?</font></font></b> <div class="spoiler_text">  ,        ,  . ,  ,        .          . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд┐рди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЦреЛрдЬрд╛ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреГрд╢реНрдпрддрд╛ рдХреЗ рд╕рд╛рде рдЕрдВрддрд┐рдо рд╕рдорд╕реНрдпрд╛ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреА рдЪрд┐рдВрддрд╛ рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рд░рд╛рд╣рдд рдЕрдЪрд╛рдирдХ рдФрд░ рд╕рдВрдХреНрд░рдордг рдХреЗ рдмрд┐рдирд╛ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХрд┐рдирд╛рд░реЗ рдкрд░ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рдХреЛрдИ рдкрдбрд╝реЛрд╕реА рдирд╣реАрдВ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/587/217/fbb/587217fbb248ae8a13759a33e22e25ff.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдХреНрд╢реЗ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдЪрд┐рд╣реНрдирд┐рддред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреНрд╖реЗрддреНрд░реЛрдВ рдФрд░ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХрд╛ рджреГрд╢реНрдп рдкреНрд░рджрд░реНрд╢рди рд╕рдорд╛рди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рддреНрд░рд┐рдХреЛрдгреАрдп рдХрд░рддреЗ рд╕рдордп рд╣рдо рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓реЛрдВ рдХреЛ рдЬреЛрдбрд╝рдХрд░ рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрдм рдЙрдирдХреЗ рдкрд╛рд╕ рдХреЛрдИ рдкрдбрд╝реЛрд╕реА рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рддрд░реНрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдФрд░ рд╣рдореЗрдВ рд▓рд╛рдкрддрд╛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рддрд░рд╣ рдХрд╛ рдПрдХ рд╕рдорд╛рдзрд╛рди рдЕрдиреИрдЪреНрдЫрд┐рдХ рд╣реИред рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдпрд╣ рд╣реИ рдХрд┐ рдирдХреНрд╢реЗ рдХреА рд╕реАрдорд╛ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдмреЗрд░реЛрдЬрд╝рдЧрд╛рд░ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд┐рдпрд╛ рдЬрд╛рдП, рднрд▓реЗ рд╣реА рд╡реЗ рд╕реНрдХреНрд╡рд╛рдб рдХреЗ рджрд╛рдпрд░реЗ рдореЗрдВ рд╣реЛрдВред рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдпрд╣ рдЖрдкрдХреЛ рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдФрд░ рдЕрдиреНрдп рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рдиреЗ рдХреА рднреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЗ рдЕрд╕рдорд╛рди рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдЫрд┐рдкреА рд╣реБрдИ рдХреЛрд╢рд┐рдХрд╛рдПрдВ рдЖрдкрдХреЛ рд╕рдбрд╝рдХреЛрдВ рдФрд░ рдирджрд┐рдпреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВ рдЬреЛ рдирджреА рдФрд░ рд╕рдбрд╝рдХ рдХреЗ рдирдХреНрд╢реЗ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рддреА рд╣реИрдВ рдФрд░ рдЫреЛрдбрд╝ рджреЗрддреА рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдЙрдирдХреЗ рдЕрдВрддрд┐рдо рдмрд┐рдВрджреБ рджрд╛рдпрд░реЗ рд╕реЗ рдмрд╛рд╣рд░ рд╣реЛрдВрдЧреЗредрдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рд╕рдорд╛рдзрд╛рди рдХреА рдорджрдж рд╕реЗ, рдЖрдк рдорд╛рдирдЪрд┐рддреНрд░ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рдФрд░ рдЫреЛрдбрд╝рдиреЗ рд╡рд╛рд▓реА рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдЬрд╛рдВрдЪ рдХреЗ рд░реВрдк рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддреЗ рд╣реИрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдПрдХ рд╕реЗрд▓ рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font></font><code>Explorable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Explorable { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдПрдХ рд╕реЗрд▓ рджрд┐рдЦрд╛рдИ рджреЗ рд╕рдХрддрд╛ рд╣реИ рдЕрдЧрд░ рдпрд╣ рдПрдХ рдЬрд╛рдВрдЪ рд╣реИ, рддреЛ </font></font><code>IsVisible</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдЦрд╛рддреЗ рдореЗрдВ рд▓реЗрдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рд╕рдВрдкрддреНрддрд┐ </font><font style="vertical-align: inherit;">рдХреЛ </font><font style="vertical-align: inherit;">рдмрджрд▓ </font><font style="vertical-align: inherit;">рджреЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsVisible { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visibility &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; Explorable; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╣реА рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ </font></font><code>IsExplored</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдордиреЗ рдорд╛рдирдХ рд╕рдВрдкрддреНрддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХреАред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдЗрд╕реЗ рдПрдХ рд╕реНрдкрд╖реНрдЯ рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрд╕рдХреЗ рдЧреЗрдЯрдЯрд░ рдХреЗ рддрд░реНрдХ рдХреЛ рдмрджрд▓рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsExplored { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> explored &amp;&amp; Explorable; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { explored = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } тАж <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> explored;</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирдХреНрд╢реЗ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдЫрд┐рдкрд╛рдПрдБ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдк рд╡рд┐рдзрд┐ рдореЗрдВ рдПрдХ рдЖрдпрддрд╛рдХрд╛рд░ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХреЛ рдЫрд┐рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>HexGrid.CreateCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╕реЗрд▓ рдЬреЛ рдХрд┐рдирд╛рд░реЗ рдкрд░ рдирд╣реАрдВ рд╣реИрдВ, рдЬрд╛рдВрдЪ рдХреА рдЬрд╛рддреА рд╣реИ, рдмрд╛рдХреА рд╕рднреА рдмреЗрд░реЛрдЬрд╝рдЧрд╛рд░ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i</span></span></span><span class="hljs-function">)</span></span> { тАж HexCell cell = cells[i] = Instantiate&lt;HexCell&gt;(cellPrefab); cell.transform.localPosition = position; cell.coordinates = HexCoordinates.FromOffsetCoordinates(x, z); cell.Index = i; cell.ShaderData = cellShaderData; cell.Explorable = x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; z &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; x &lt; cellCountX - <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; z &lt; cellCountZ - <span class="hljs-number"><span class="hljs-number">1</span></span>; тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдХрд╛рд░реНрдб рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдХрд╛рд▓реЗ рд╣реЛ рдЧрдП рд╣реИрдВ, рдЙрдирдХреЗ рдкреАрдЫреЗ рдЫрд┐рдкреА рд╣реБрдИ рдмрдбрд╝реА рдЬрдЧрд╣ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдирддреАрдЬрддрди, рдирдХреНрд╢реЗ рдХреЗ рдЕрдзреНрдпрдпрди рдХрд┐рдП рдЧрдП рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдЖрдХрд╛рд░ рдкреНрд░рддреНрдпреЗрдХ рдЖрдпрд╛рдо рдореЗрдВ рджреЛ рд╕реЗ рдШрдЯ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/594/19f/353/59419f35345fa4eac3380c4e16461baf.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдХреНрд╢реЗ рдХреЗ рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХрд┐рдирд╛рд░реЗред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдЕрдиреБрд╕рдВрдзрд╛рди рд░рд╛рдЬреНрдп рдХреЛ рд╕рдВрдкрд╛рджрди рдпреЛрдЧреНрдп рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ?</font></font></b> <div class="spoiler_text"> ,  ,     .          . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрд╕реНрдкрд╖реНрдЯреАрдХреГрдд рдХреЛрд╢рд┐рдХрд╛рдПрдВ рджреГрд╢реНрдпрддрд╛ рдореЗрдВ рдмрд╛рдзрд╛ рдбрд╛рд▓рддреА рд╣реИрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рдпрджрд┐ рд╕реЗрд▓ рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рддреЛ рдЗрд╕реЗ рджреГрд╢реНрдпрддрд╛ рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><code>HexGrid.GetVisibleCells</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП </font><font style="vertical-align: inherit;">рдмрджрд▓реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( neighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || neighbor.SearchPhase &gt; searchFrontierPhase || !neighbor.Explorable ) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; }</code> </pre><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднрд╛рдЧ реирей: рднреВрдорд┐ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ </font></font></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрддреНрдкрдиреНрди рдкрд░рд┐рджреГрд╢реНрдп рдХреЗ рд╕рд╛рде рдирдП рдирдХреНрд╢реЗ рднрд░реЗрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдкрд╛рдиреА рдХреЗ рдКрдкрд░ рдЬрдореАрди рдмрдирд╛рддреЗ рд╣реИрдВ, рд╣рдо рдХреБрдЫ рдмрд╛рдврд╝ рдХрд░рддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдирд┐рд░реНрдорд┐рдд рднреВрдорд┐ рдХреА рдорд╛рддреНрд░рд╛, рдЗрд╕рдХреА рдКрдВрдЪрд╛рдИ рдФрд░ рдЕрд╕рдорд╛рдирддрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдЪрд░ рдорд╛рдирдЪрд┐рддреНрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдиреНрдпрд╛рд╕ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдЗрд╕реЗ рдмрдирд╛рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдПрдХ рд╣реА рдирдХреНрд╢рд╛ рдлрд┐рд░ рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛ рд╕рдХреЗред </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдХрд╛ рдпрд╣ рд╣рд┐рд╕реНрд╕рд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рдорд╛рдирдЪрд┐рддреНрд░ рдкреАрдврд╝реА рдкрд░ рдПрдХ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреА рд╢реБрд░реБрдЖрдд рд╣реЛрдЧреАред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╣рд┐рд╕реНрд╕рд╛ рдПрдХрддрд╛ 2017.1.0 рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99e/798/7bb/99e7987bbcb46f1f961b72ba76a78aa0.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдИ рдЙрддреНрдкрдиреНрди рдирдХреНрд╢реЗ рдореЗрдВ рд╕реЗ рдПрдХред</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛рд░реНрдб рдкреАрдврд╝реА </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐ рд╣рдо рдХреЛрдИ рднреА рдорд╛рдирдЪрд┐рддреНрд░ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдмрд╣реБрдд рд╕рдордп рд▓рдЧрддрд╛ рд╣реИред рдпрд╣ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрдЧрд╛ рдпрджрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЙрд╕рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдб рдмрдирд╛рдХрд░ рдбрд┐рдЬрд╛рдЗрдирд░ рдХреА рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╡рд╣ рдмрд╛рдж рдореЗрдВ рдЕрдкрдиреЗ рд╕реНрд╡рд╛рдж рдореЗрдВ рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИред рдЖрдк рдПрдХ рдФрд░ рдХрджрдо рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдбрд┐рдЬрд╛рдЗрди рдмрдирд╛рдиреЗ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЖрд╡реЗрджрди рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдирдХреНрд╢реЗ рдХреЛ рдмрдирд╛рдиреЗ рдХреА рдЬрд┐рдореНрдореЗрджрд╛рд░реА рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рдЦреЗрд▓ рдХреЛ рд╣рд░ рдмрд╛рд░ рдПрдХ рдирдП рдХрд╛рд░реНрдб рдХреЗ рд╕рд╛рде рдЦреЗрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдЦреЗрд▓ рд╕рддреНрд░ рдЕрд▓рдЧ рд╣реЛрдЧрд╛ред рдпрд╣ рд╕рдм рд╕рдВрднрд╡ рд╣реЛ рд╕рдХреЗ, рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдПрдХ рдореИрдк рдЬрдирд░реЗрд╢рди рдПрд▓реНрдЧреЛрд░рд┐рдердо рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЖрд╡рд╢реНрдпрдХ рдкреАрдврд╝реА рдХреЗ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХрд╛ рдкреНрд░рдХрд╛рд░ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдб рдХреЗ рдкреНрд░рдХрд╛рд░ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред рдХреЛрдИ рднреА рд╕рд╣реА рджреГрд╖реНрдЯрд┐рдХреЛрдг рдирд╣реАрдВ рд╣реИ, рдЖрдкрдХреЛ рд╣рдореЗрд╢рд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдФрд░ рдЦреЗрд▓рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреЗ рдмреАрдЪ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдХрд╛рд░реНрдб рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЦрд┐рд▓рд╛рдбрд╝реА рдХреЛ рдХрд╛рдлреА рд╕рдВрднрд╡ рдФрд░ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдирдХреНрд╢реЗ рдХреЛ рд╣рдорд╛рд░реЗ рдЧреНрд░рд╣ рдХреЗ рдПрдХ рднрд╛рдЧ рдХреА рддрд░рд╣ рджрд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рдПрдХ рдЕрд▓рдЧ рдЧреНрд░рд╣ рдпрд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд▓рдЧ рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдпрд╣ рдкреГрдереНрд╡реА рдХреА рд░рд╛рд╣рдд рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП, рддреЛ рдЗрд╕реЗ рдХрдо рд╕реЗ рдХрдо рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ рдЗрд╕реЗ рдЬреИрд╕рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд▓реЗрдмрд┐рд▓рд┐рдЯреА рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ рдХрд┐ рдХрд╛рд░реНрдб рдЧреЗрдордкреНрд▓реЗ рдХреЗ рдЕрдиреБрд░реВрдк рдХреИрд╕реЗ рд╣реИрдВред рдХрднреА-рдХрднреА рдпрд╣ рд╡рд┐рд╢реНрд╡рд╛рд╕рдиреАрдпрддрд╛ рдХреЗ рд╕рд╛рде рд╕рдВрдШрд░реНрд╖ рдХрд░рддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдкрд░реНрд╡рдд рд╢реНрд░реГрдВрдЦрд▓рд╛рдПрдВ рд╕реБрдВрджрд░ рджрд┐рдЦ рд╕рдХрддреА рд╣реИрдВ, рд╕рд╛рде рд╣реА рд╡реЗ рдЗрдХрд╛рдЗрдпреЛрдВ рдХреА рдЧрддрд┐ рдФрд░ рджреГрд╢реНрдп рдХреЛ рд╕реАрдорд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдпрджрд┐ рдпрд╣ рдЕрд╡рд╛рдВрдЫрдиреАрдп рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдкрд╣рд╛рдбрд╝реЛрдВ рдХреЗ рдмрд┐рдирд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЬрд┐рд╕рд╕реЗ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдХрдо рд╣реЛ рдЬрд╛рдПрдЧреА рдФрд░ рдЦреЗрд▓ рдХреА рд╕реНрдкрд╖реНрдЯрддрд╛ рд╕реАрдорд┐рдд рд╣реЛ рдЬрд╛рдПрдЧреАред рдпрд╛ рд╣рдо рдкрд╣рд╛рдбрд╝реЛрдВ рдХреЛ рдмрдЪрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЧреЗрдордкреНрд▓реЗ рдкрд░ рдЙрдирдХреЗ рдкреНрд░рднрд╛рд╡ рдХреЛ рдХрдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рднреА рдХрдо рд╣реЛ рд╕рдХрддреА рд╣реИред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╡реНрдпрд╡рд╣рд╛рд░реНрдпрддрд╛ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдЯреЗрдХреНрдЯреЛрдирд┐рдХ рдкреНрд▓реЗрдЯреНрд╕, рдХрдЯрд╛рд╡, рдмрд╛рд░рд┐рд╢, рдЬреНрд╡рд╛рд▓рд╛рдореБрдЦреА рд╡рд┐рд╕реНрдлреЛрдЯ, рдЙрд▓реНрдХрд╛рдкрд┐рдВрдб рдФрд░ рдЪрдВрджреНрд░рдорд╛ рдХреЗ рдкреНрд░рднрд╛рд╡, рдФрд░ рдЗрд╕реА рддрд░рд╣ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдХреЗ рдмрд╣реБрдд рдпрдерд╛рд░реНрдерд╡рд╛рджреА рдкреГрдереНрд╡реА рдЬреИрд╕рд╛ рдЧреНрд░рд╣ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред рд▓реЗрдХрд┐рди рдРрд╕реА рдкреНрд░рдгрд╛рд▓реА рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕рдордп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рддрд░рд╣ рдХреЗ рдЧреНрд░рд╣ рдХреЛ рдкреИрджрд╛ рдХрд░рдиреЗ рдореЗрдВ рд▓рдВрдмрд╛ рд╕рдордп рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЦрд┐рд▓рд╛рдбрд╝реА рдирдпрд╛ рдЦреЗрд▓ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреБрдЫ рдорд┐рдирдЯ рдЗрдВрддрдЬрд╛рд░ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣реЗрдВрдЧреЗред рдпрд╣реА рд╣реИ, рд╕рд┐рдореБрд▓реЗрд╢рди рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдЙрдкрдХрд░рдг рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреА рдПрдХ рдХреАрдордд рд╣реИред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЦреЗрд▓ рдЕрдХреНрд╕рд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛, рдЦреЗрд▓, рдФрд░ рд╡реНрдпрд╡рд╣рд╛рд░реНрдпрддрд╛ рдХреЗ рдмреАрдЪ рд╡реНрдпрд╛рдкрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдХрднреА-рдХрднреА рдРрд╕реЗ рд╕рдордЭреМрддреЗ рдЕрджреГрд╢реНрдп рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рд▓рдЧрддреЗ рд╣реИрдВ, рдФрд░ рдХрднреА-рдХрднреА рд╡реЗ рд╡рд┐рдХрд╛рд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рдХрд┐рдП рдЧрдП рдирд┐рд░реНрдгрдпреЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ, рдЕрд╕рдВрдЧрдд рдпрд╛ рдЕрд░рд╛рдЬрдХ рджрд┐рдЦрддреЗ рд╣реИрдВред рдпрд╣ рди рдХреЗрд╡рд▓ рдХрд╛рд░реНрдб рдкреАрдврд╝реА рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рдПрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рдХрд╛рд░реНрдб рдЬрдирд░реЗрдЯрд░ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╕рдордп, рдЖрдкрдХреЛ рдЗрд╕ рдкрд░ рд╡рд┐рд╢реЗрд╖ рдзреНрдпрд╛рди рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЖрдк рдПрдХ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдмрдирд╛рдиреЗ рдореЗрдВ рдмрд╣реБрдд рд╕рдордп рдмрд┐рддрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╕реБрдВрджрд░ рдХрд╛рд░реНрдб рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЬрд╛ рд░рд╣реЗ рдЦреЗрд▓ рдХреЗ рд▓рд┐рдП рдмреЗрдХрд╛рд░ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рд╕реАрд░реАрдЬрд╝ рдореЗрдВ, рд╣рдо рдПрдХ рднреВрдорд┐ рдЬреИрд╕реА рд░рд╛рд╣рдд рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрд╣ рдмрдбрд╝реА рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓рддрд╛ рдФрд░ рдмрдбрд╝реЗ рд╕рдЬрд╛рддреАрдп рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рд╕рд╛рде рджрд┐рд▓рдЪрд╕реНрдк рджрд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд░рд╛рд╣рдд рдХрд╛ рдкреИрдорд╛рдирд╛ рдмрдбрд╝рд╛ рд╣реЛрдЧрд╛, рдирдХреНрд╢реЗ рдПрдХ рдпрд╛ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдорд╣рд╛рджреНрд╡реАрдкреЛрдВ, рдорд╣рд╛рд╕рд╛рдЧрд░реЛрдВ рдХреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдПрдХ рдкреВрд░реЗ рдЧреНрд░рд╣ рдХреЛ рдХрд╡рд░ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рднреВрдЧреЛрд▓ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рднреВрдорд┐ рджреНрд░рд╡реНрдпрдорд╛рди, рдЬрд▓рд╡рд╛рдпреБ, рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдФрд░ рднреВ-рднрд╛рдЧ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рднрд╛рдЧ рдореЗрдВ, рд╣рдо рд╕реБрд╢реА рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдиреАрдВрд╡ рд░рдЦреЗрдВрдЧреЗред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рдВрдкрд╛рджрди рдореЛрдб рдореЗрдВ рдЖрд░рдВрдн рдХрд░рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЧреЗрдордкреНрд▓реЗ рдкрд░ рдирд╣реАрдВ рдмрд▓реНрдХрд┐ рдорд╛рдирдЪрд┐рддреНрд░ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдПрдбрд┐рдЯ рдореЛрдб рдореЗрдВ рд▓реЙрдиреНрдЪ рдХрд░рдирд╛ рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рд╣рдо рддреБрд░рдВрдд рдХрд╛рд░реНрдб рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо </font></font><code>HexMapEditor.Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрдкрд╛рджрди рдореЛрдб рдХреЛ рд╕рд╣реА рдкрд░ рд╕реЗрдЯ рдХрд░рдХреЗ рдФрд░ рдЗрд╕ рдореЛрдб рдХреЗ shader рдХреАрд╡рд░реНрдб рдХреЛ рдмрджрд▓рдХрд░ рдмрджрд▓ </font><font style="vertical-align: inherit;">рджреЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrainMaterial.DisableKeyword(<span class="hljs-string"><span class="hljs-string">"GRID_ON"</span></span>); Shader.EnableKeyword(<span class="hljs-string"><span class="hljs-string">"HEX_MAP_EDIT_MODE"</span></span>); SetEditMode(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд╛рд░реНрдб рдЬрдирд░реЗрдЯрд░ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдкреНрд░рдХреНрд░рд┐рдпрд╛рддреНрдордХ рдорд╛рдирдЪрд┐рддреНрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рдХреЛрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рд╣рдо рдЗрд╕реЗ рд╕реАрдзреЗ рдирд╣реАрдВ рдЬреЛрдбрд╝реЗрдВрдЧреЗ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдПрдХ рдирдпрд╛ рдШрдЯрдХ рдмрдирд╛рдПрдВрдЧреЗ </font></font><code>HexMapGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рдЬрд╛рди рдкрд╛рдПрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддреЛ рдпрд╣ рджреВрд╕рд░реЗ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдореЗрдВ рд╕рдВрдХреНрд░рдордг рдХреЛ рд╕рд░рд▓ рдХрд░реЗрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдирд░реЗрдЯрд░ рдХреЛ рдЧреНрд░рд┐рдб рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рд┐рдВрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕рдореЗрдВ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдлрд╝реАрд▓реНрдб рдЬреЛрдбрд╝реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝рддреЗ </font></font><code>GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрдВ рдЬреЛ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рдХрд╛рдо рд╕реЗ рдирд┐рдкрдЯреЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЗ рдЖрдпрд╛рдо рджреЗрдВрдЧреЗ, рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ рдПрдХ рдирдпрд╛ рдЦрд╛рд▓реА рдирдХреНрд╢рд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexMapGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexGrid grid; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { grid.CreateMap(x, z); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдШрдЯрдХ рдХреЛ рджреГрд╢реНрдп рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝реЗрдВ </font></font><code>HexMapGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЗрд╕реЗ рдЧреНрд░рд┐рдб рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/932/b6e/fd2/932b6efd2dd1809893af27ec7a91c620.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рдирдЪрд┐рддреНрд░ рдЬрдирд░реЗрдЯрд░ рд╡рд╕реНрддреБред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рдирдП рдирдХреНрд╢реЗ рдХрд╛ рдореЗрдиреВ рдмрджрд▓реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдмрджрд▓ рджреЗрдВрдЧреЗ </font></font><code>NewMapMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рдХрд╛рд░реНрдб рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХреЗ, рди рдХрд┐ рдХреЗрд╡рд▓ рдЦрд╛рд▓реА рд╣реА рдмрдирд╛рдПред </font><font style="vertical-align: inherit;">рд╣рдо рдмреВрд▓рд┐рдпрди рдлрд╝реАрд▓реНрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░реЗрдВрдЧреЗ </font></font><code>generateMaps</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬрд┐рд╕рдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рдореВрд▓реНрдп рд╣реИ </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕ рдлрд╝реАрд▓реНрдб рдХреЛ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдзрд┐ рдмрдирд╛рдПрдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рд╡рд┐рдХрд▓реНрдк рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдерд╛ </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдореЗрдиреВ рдореЗрдВ рдЙрдкрдпреБрдХреНрдд рд╕реНрд╡рд┐рдЪ рдЬреЛрдбрд╝реЗрдВ рдФрд░ рдЗрд╕реЗ рд╡рд┐рдзрд┐ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> generateMaps = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToggleMapGeneration</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { generateMaps = toggle; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc9/9c7/0c9/fc99c70c99095b3565104ef42254859d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╕реНрд╡рд┐рдЪ рдХреЗ рд╕рд╛рде рдПрдХ рдирдпрд╛ рдХрд╛рд░реНрдб рдХрд╛ рдореЗрдиреВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдиреВ рдХреЛ рдореИрдк рдЬрдирд░реЗрдЯрд░ рд╕реЗ рд▓рд┐рдВрдХ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╣рдо рдЗрд╕реЗ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдиреЗ рдкрд░ </font></font><code>GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдирд░реЗрдЯрд░ </font><font style="vertical-align: inherit;">рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">, рдФрд░ рди рдХреЗрд╡рд▓ </font></font><code>CreateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреНрд░рд┐рдб рдХреЛ </font><font style="vertical-align: inherit;">рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMapGenerator mapGenerator; тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (generateMaps) { mapGenerator.GenerateMap(x, z); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { hexGrid.CreateMap(x, z); } HexMapCamera.ValidatePosition(); Close(); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d1/e98/3d9/7d1e983d927d912b75d9b245219659f1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдирд░реЗрдЯрд░ рд╕реЗ рдХрдиреЗрдХреНрд╢рдиред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдирд░реЗрдЯрд░ рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХреЗ рд╣реИ </font></font><code>GetCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд┐ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдпрд╛ рд╕реНрдерд┐рддрд┐ рд╡реЗрдХреНрдЯрд░, рдпрд╛ рд╖рдЯреНрднреБрдЬ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХред </font><font style="vertical-align: inherit;">рдЬрдирд░реЗрдЯрд░ рдХреЛ рдПрдХ рдпрд╛ рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рджреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рддрд░реАрдХреЗ рдЬреЛрдбрд╝рддреЗ </font></font><code>HexGrid.GetCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрдВ рдЬреЛ рд╕реЗрд▓ рдХреЗ рдСрдлрд╕реЗрдЯ рдпрд╛ рдЗрдВрдбреЗрдХреНрд╕ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xOffset, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> zOffset</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cells[xOffset + zOffset * cellCountX]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cellIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cells[cellIndex]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдпрд╣ </font></font><code>HexMapGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╕реАрдзреЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдирдпрд╛ рдирдХреНрд╢рд╛ рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╡рд╣ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдордзреНрдп рд╕реНрддрдВрдн рдХреА рд░рд╛рд╣рдд рдХреЗ рд░реВрдк рдореЗрдВ рдШрд╛рд╕ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдШрд╛рд╕ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { grid.CreateMap(x, z); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; z; i++) { grid.GetCell(x / <span class="hljs-number"><span class="hljs-number">2</span></span>, i).TerrainTypeIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/860/aee/119/860aee119f0e000ef290f6c87e61ad05.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдирдХреНрд╢реЗ рдкрд░ рдШрд╛рд╕ рдХрд╛ рд╕реНрддрдВрднред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реБрд╢реА рдмрдирд╛рдирд╛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирдХреНрд╢рд╛ рдмрдирд╛рддреЗ рд╕рдордп, рд╣рдо рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЬрдореАрди рдХреЗ рдмрд┐рдирд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдХреЛрдИ рдХрд▓реНрдкрдирд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдкреВрд░реА рджреБрдирд┐рдпрд╛ рдПрдХ рд╡рд┐рд╢рд╛рд▓ рдорд╣рд╛рд╕рд╛рдЧрд░ рд╕реЗ рднрд░ рдЧрдИ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рдореБрджреНрд░ рддрд▓ рдХрд╛ рдПрдХ рд╣рд┐рд╕реНрд╕рд╛ рдЗрддрдирд╛ рдКрдкрд░ рдзрдХреЗрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рд╡рд╣ рдкрд╛рдиреА рд╕реЗ рдКрдкрд░ рдЙрда рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдпрд╣ рддрдп рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрд┐рддрдиреА рднреВрдорд┐ рдмрдирд╛рдИ рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП, рдпрд╣ рдХрд╣рд╛рдВ рджрд┐рдЦрд╛рдИ рджреЗрдЧреА рдФрд░ рдЗрд╕рдХрд╛ рдХреНрдпрд╛ рдЖрдХрд╛рд░ рд╣реЛрдЧрд╛ред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░рд╛рд╣рдд рдмрдврд╝рд╛рдУ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд▓реЛ рдЫреЛрдЯреА рд╢реБрд░реБрдЖрдд рдХрд░реЗрдВ - рдкрд╛рдиреА рдХреЗ рдКрдкрд░ рдЬрдореАрди рдХрд╛ рдПрдХ рдЯреБрдХрдбрд╝рд╛ рдмрдврд╝рд╛рдПрдВред </font><font style="vertical-align: inherit;">рд╣рдо </font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд▓реЙрдЯ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде </font><font style="vertical-align: inherit;">рдПрдХ рд╡рд┐рдзрд┐ рдмрдирд╛рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font></font><code>GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд┐рдЫрд▓реЗ рдкрд░реАрдХреНрд╖рдг рдХреЛрдб рдХреА рдЬрдЧрд╣, </font><font style="vertical-align: inherit;">рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЪрд▓реЛ рд╕рд╛рдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рд╕реЗ рдорд┐рд▓рдХрд░ рднреВрдорд┐ рдХреЗ рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдЯреБрдХрдбрд╝реЗ рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { grid.CreateMap(x, z); <span class="hljs-comment"><span class="hljs-comment">// for (int i = 0; i &lt; z; i++) { // grid.GetCell(x / 2, i).TerrainTypeIndex = 1; // } RaiseTerrain(7); } void RaiseTerrain (int chunkSize) {}</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рддрдХ, рд╣рдо "рдШрд╛рд╕" рдкреНрд░рдХрд╛рд░ рдХреЗ рд░рд╛рд╣рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдКрдВрдЪреЗ рднреВрдорд┐ рдХреЛ рдирд┐рд░реВрдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдореВрд▓ "рд░реЗрдд" рд░рд╛рд╣рдд рдорд╣рд╛рд╕рд╛рдЧрд░ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ </font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕реЗрд▓ рд▓реЗрдВ рдФрд░ рдЬрдм рддрдХ рд╣рдореЗрдВ рд╕рд╣реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рдЬрдореАрди рди рдорд┐рд▓ рдЬрд╛рдП, рддрдм рддрдХ рдЗрд╕рдХреА рд░рд╛рд╣рдд рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рдмрджрд▓ рджреЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рд╡рд┐рдзрд┐ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рдЬреЛ </font></font><code>GetRandomCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕реЗрд▓ рдЗрдВрдбреЗрдХреНрд╕ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЧреНрд░рд┐рдб рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RaiseTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> chunkSize</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; chunkSize; i++) { GetRandomCell().TerrainTypeIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-function"><span class="hljs-function">HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRandomCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> grid.GetCell(Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, grid.cellCountX * grid.cellCountZ)); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/396/fb8/ce6/396fb8ce67de74961b31562e275bd81a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдд рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕реБрд╢реА рдХреЛрд╢рд┐рдХрд╛рдУрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЕрдВрдд рдореЗрдВ рд╣рдореЗрдВ рдХрдИ рдмрд╛рд░ рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрдИ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдпрд╛ рд▓реВрдк рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЪрд▓реЛ рд╕реЗрд▓ рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рдирдЬрд╝рд░ рд░рдЦреЗрдВ </font></font><code>HexMapGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cellCount; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { cellCount = x * z; тАж } тАж <span class="hljs-function"><span class="hljs-function">HexCell </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetRandomCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> grid.GetCell(Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, cellCount)); }</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдПрдХ рд╕рд╛рдЗрдЯ рдХрд╛ рдирд┐рд░реНрдорд╛рдг </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рддрдХ, рд╣рдо рд╕рд╛рдд рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рднреВрдорд┐ рдореЗрдВ рдмрджрд▓ рд░рд╣реЗ рд╣реИрдВ, рдФрд░ рд╡реЗ рдХрд╣реАрдВ рднреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╡реЗ рдПрдХ рднреА рднреВрдорд┐ рдХреНрд╖реЗрддреНрд░ рдирд╣реАрдВ рдмрдирд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рд╣рдо рдХрдИ рдмрд╛рд░ рд╕рдорд╛рди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдХрдо рднреВрдорд┐ рдорд┐рд▓рддреА рд╣реИред </font><font style="vertical-align: inherit;">рджреЛрдиреЛрдВ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЗ рдмрд┐рдирд╛, рд╣рдо рдХреЗрд╡рд▓ рдкрд╣рд▓реА рд╕реЗрд▓ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ рдХреЗрд╡рд▓ рдЙрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рдЪрдпрди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ рдкрд╣рд▓реЗ рдЪреБрдиреЗ рдЧрдП рд▓реЛрдЧреЛрдВ рдХреЗ рдмрдЧрд▓ рдореЗрдВ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпреЗ рдкреНрд░рддрд┐рдмрдВрдз рдкрде рдЦреЛрдЬ рдХреА рд╕реАрдорд╛рдУрдВ рдХреЗ рд╕рдорд╛рди рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдпрд╣рд╛рдВ рдЙрд╕реА рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо </font></font><code>HexMapGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдиреА рд╕рдВрдкрддреНрддрд┐ рдФрд░ рдЦреЛрдЬ рд╕реАрдорд╛ рдХреЗ рдЪрд░рдг рдХреЗ рдХрд╛рдЙрдВрдЯрд░ рдХреЛ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝рддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдерд╛ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> HexCellPriorityQueue searchFrontier; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> searchFrontierPhase;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд╛рдБрдЪ рдХрд░реЗрдВ рдХрд┐ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдХрддрд╛рд░ рдореЗрдВ рдореМрдЬреВрдж рд╣реИ рдЬрдм рд╣рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { cellCount = x * z; grid.CreateMap(x, z); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (searchFrontier == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { searchFrontier = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCellPriorityQueue(); } RaiseTerrain(<span class="hljs-number"><span class="hljs-number">7</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдирдпрд╛ рдирдХреНрд╢рд╛ рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рд╕реАрдорд╛ рд╢реВрдиреНрдп рд╣реИред рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╣рдо рдорд╛рдирдЪрд┐рддреНрд░ рдирд┐рд░реНрдорд╛рдг рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рд╣рдо рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЙрдирдХреА рдЦреЛрдЬ рд╕реАрдорд╛ рдмрдврд╝рд╛рдПрдВрдЧреЗред рдпрджрд┐ рд╣рдо рдХрдИ рдЦреЛрдЬ рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╡реЗ рджрд░реНрдЬ рдХреА рдЧрдИ рдЦреЛрдЬ рд╕реАрдорд╛ рдХреЗ рдЪрд░рдг рд╕реЗ рдЖрдЧреЗ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рдпрд╣ рдпреВрдирд┐рдЯ рдкрдереЛрдВ рдХреА рдЦреЛрдЬ рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдорд╛рдирдЪрд┐рддреНрд░ рдирд┐рд░реНрдорд╛рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЕрдВрдд рдореЗрдВ, рд╣рдо рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдЦреЛрдЬ рдЪрд░рдг рдХреЛ рд╢реВрдиреНрдп рдкрд░ рд░реАрд╕реЗрдЯ рдХрд░ рджреЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> RaiseTerrain(<span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellCount; i++) { grid.GetCell(i).SearchPhase = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдореБрдЭреЗ </font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрдпреБрдХреНрдд рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рддрд▓рд╛рд╢ рдХрд░рдиреА рд╣реИ, рди рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдмреЗрддрд░рддреАрдм рдврдВрдЧ рд╕реЗ рдЪреБрдирдирд╛ рд╣реИред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЦреЛрдЬ рд╡рд┐рдзрд┐ рдХреЗ рд╕рдорд╛рди рд╣реИ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдо рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдмрд╛рд░ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рджреМрд░рд╛ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╣рдорд╛рд░реЗ рд▓рд┐рдП 2 рдХреЗ рдмрдЬрд╛рдп 1 рд╕реЗ рдЦреЛрдЬ рд╕реАрдорд╛ рдХреЗ рдЪрд░рдг рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред рдлрд┐рд░ рд╣рдо рдкрд╣рд▓реЗ рд╕реЗрд▓ рдХреЗ рд╕рд╛рде рд╕реАрдорд╛ рдХреЛ рдЖрд░рдВрднреАрдХреГрдд рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЪреБрдирд╛ рдЬрд╛рддрд╛ рд╣реИред рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рдЗрд╕рдХреЗ рдЦреЛрдЬ рдЪрд░рдг рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рдЗрд╕рдХреА рджреВрд░реА рдФрд░ рдЕрдиреБрдорд╛рди рдХреЛ рд╢реВрдиреНрдп рддрдХ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RaiseTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> chunkSize</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// for (int i = 0; i &lt; chunkSize; i++) { // GetRandomCell().TerrainTypeIndex = 1; // } searchFrontierPhase += 1; HexCell firstCell = GetRandomCell(); firstCell.SearchPhase = searchFrontierPhase; firstCell.Distance = 0; firstCell.SearchHeuristic = 0; searchFrontier.Enqueue(firstCell); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдмрд╛рдж, рдЦреЛрдЬ рд▓реВрдк рдЬреНрдпрд╛рджрд╛рддрд░ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдкрд░рд┐рдЪрд┐рдд рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕реАрдорд╛ рдЦрд╛рд▓реА рд╣реЛрдиреЗ рддрдХ рдЦреЛрдЬ рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд░реБрдХрдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рд╣реИ рдЬрдм рдЯреБрдХрдбрд╝рд╛ рд╡рд╛рдВрдЫрд┐рдд рдЖрдХрд╛рд░ рддрдХ рдкрд╣реБрдВрдЪ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рдЯреНрд░реИрдХ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдкрд░, рд╣рдо рдХрддрд╛рд░ рд╕реЗ рдЕрдЧрд▓реА рд╕реЗрд▓ рдирд┐рдХрд╛рд▓реЗрдВрдЧреЗ, рдЗрд╕рдХреА рд░рд╛рд╣рдд рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдВрдЧреЗ, рдЖрдХрд╛рд░ рдореЗрдВ рд╡реГрджреНрдзрд┐ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдлрд┐рд░ рдЗрд╕ рд╕реЗрд▓ рдХреЗ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╕рднреА рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЛ рдмрд╕ рд╕реАрдорд╛ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ рдЕрдЧрд░ рдЙрдиреНрд╣реЗрдВ рдЕрднреА рддрдХ рд╡рд╣рд╛рдВ рдирд╣реАрдВ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдХреЛрдИ рдмрджрд▓рд╛рд╡ рдпрд╛ рддреБрд▓рдирд╛ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рд╕реАрдорд╛ рдХреЛ рд╕рд╛рдл рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> searchFrontier.Enqueue(firstCell); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (size &lt; chunkSize &amp;&amp; searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); current.TerrainTypeIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; size += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { HexCell neighbor = current.GetNeighbor(d); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor &amp;&amp; neighbor.SearchPhase &lt; searchFrontierPhase) { neighbor.SearchPhase = searchFrontierPhase; neighbor.Distance = <span class="hljs-number"><span class="hljs-number">0</span></span>; neighbor.SearchHeuristic = <span class="hljs-number"><span class="hljs-number">0</span></span>; searchFrontier.Enqueue(neighbor); } } } searchFrontier.Clear();</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97a/f44/023/97af440236cb6909130d6a8bfaab3f5a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдПрдХ рдкрдВрдХреНрддрд┐ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рд╕рд╣реА рдЖрдХрд╛рд░ рдХрд╛ рдПрдХ рд╣реА рдкреНрд▓реЙрдЯ рдорд┐рд▓рд╛ред </font><font style="vertical-align: inherit;">рдпрд╣ рддрднреА рдЫреЛрдЯрд╛ рд╣реЛрдЧрд╛ рдЬрдм рдкрд░реНрдпрд╛рдкреНрдд рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдПрдБ рди рд╣реЛрдВред </font><font style="vertical-align: inherit;">рд╕реАрдорд╛ рдЬрд┐рд╕ рддрд░рд╣ рд╕реЗ рднрд░реА рдЬрд╛рддреА рд╣реИ, рдЙрд╕рдХреЗ рдХрд╛рд░рдг рд╣рдореЗрд╢рд╛ рдЙрддреНрддрд░-рдкрд╢реНрдЪрд┐рдо рдореЗрдВ рдЪрд▓рдиреЗ рд╡рд╛рд▓реА рдПрдХ рд░реЗрдЦрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдирдХреНрд╢реЗ рдХреЗ рдХрд┐рдирд╛рд░реЗ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдкрд░ рд╣реА рджрд┐рд╢рд╛ рдмрджрд▓рддрд╛ рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднреВрдорд┐ рдХреНрд╖реЗрддреНрд░ рд╢рд╛рдпрдж рд╣реА рдХрднреА рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рд╕рджреГрд╢ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдпрджрд┐ рд╡реЗ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╡реЗ рд╣рдореЗрд╢рд╛ рдПрдХ рд╣реА рддрд░рд╣ рд╕реЗ рдЙрдиреНрдореБрдЦ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рд╛рдЗрдЯ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕реЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреНрд▓реЙрдЯ рдХреЗ рдХреЗрдВрджреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рддрдм рдЕрдиреНрдп рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рджреВрд░реА рдЗрд╕ рдмрд┐рдВрджреБ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рд╣рдо рдЙрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рдЙрдЪреНрдЪ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдВрдЧреЗ рдЬреЛ рдХреЗрдВрджреНрд░ рдХреЗ рдХрд░реАрдм рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╕рд╛рдЗрдЯ рдПрдХ рд░реЗрдЦрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдирд╣реАрдВ рдмрд▓реНрдХрд┐ рдХреЗрдВрджреНрд░ рдХреЗ рдЖрд╕рдкрд╛рд╕ рдмрдврд╝реЗрдЧреАред</font></font><br><br><pre> <code class="cs hljs"> searchFrontier.Enqueue(firstCell); HexCoordinates center = firstCell.coordinates; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (size &lt; chunkSize &amp;&amp; searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); current.TerrainTypeIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; size += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { HexCell neighbor = current.GetNeighbor(d); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor &amp;&amp; neighbor.SearchPhase &lt; searchFrontierPhase) { neighbor.SearchPhase = searchFrontierPhase; neighbor.Distance = neighbor.coordinates.DistanceTo(center); neighbor.SearchHeuristic = <span class="hljs-number"><span class="hljs-number">0</span></span>; searchFrontier.Enqueue(neighbor); } } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/117/149/84111714960a293415b1d24edf92f56b.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рд╕рдВрдЪрдпред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдЕрдм рд╣рдорд╛рд░реЗ рд╕рд╛рдд рд╕реЗрд▓ рдПрдХ рдХреЙрдореНрдкреИрдХреНрдЯ рд╣реЗрдХреНрд╕рд╛рдЧреЛрдирд▓ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЦреВрдмрд╕реВрд░рддреА рд╕реЗ рднрд░реЗ рд╣реБрдП рд╣реИрдВ рдЕрдЧрд░ рдХреЗрдВрджреНрд░реАрдп рд╕реЗрд▓ рдирдХреНрд╢реЗ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдкрд░ рджрд┐рдЦрд╛рдИ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЕрдм 30 рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рдкреНрд▓реЙрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> RaiseTerrain(<span class="hljs-number"><span class="hljs-number">30</span></span>);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/893/c36/13e/893c3613edfe02b457cc4ee6d191072c.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30 рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рд╕реБрд╢реА рджреНрд░рд╡реНрдпрдорд╛рдиред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдлрд┐рд░ рд╕реЗ рд╡рд╣реА рдЖрдХрд╛рд░ рдорд┐рд▓рд╛, рд╣рд╛рд▓рд╛рдБрдХрд┐ рд╕рд╣реА рд╖рдЯреНрднреБрдЬ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдХреЛрд╢рд┐рдХрд╛рдПрдБ рдирд╣реАрдВ рдереАрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рднреВрдЦрдВрдб рдХрд╛ рджрд╛рдпрд░рд╛ рдмрдбрд╝рд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЗ рдХрд┐рдирд╛рд░реЗ рдХреЗ рдХрд░реАрдм рд╣реЛрдиреЗ рдХреА рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ, рдЬреЛ рдЗрд╕реЗ рдПрдХ рдЕрд▓рдЧ рдЖрдХрд╛рд░ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░реЗрдЧрд╛ред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реБрд╢реА рдпрд╛рджреГрдЪреНрдЫрд┐рдХрд░рдг </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ рдХрд┐ рд╕рднреА рдХреНрд╖реЗрддреНрд░ рд╕рдорд╛рди рджрд┐рдЦреЗрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рд╕реЗрд▓ рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдХреЛ рдереЛрдбрд╝рд╛ рдмрджрд▓ рджреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рд╣рд░ рдмрд╛рд░ рдЬрдм рд╣рдо рдПрдХ рдкрдбрд╝реЛрд╕реА рд╕реЗрд▓ рдХреЛ рд╕реАрдорд╛ рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рдЕрдЧрд░ рдЕрдЧрд▓реА рд╕рдВрдЦреНрдпрд╛ </font></font><code>Random.value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕реАрдорд╛ рдореВрд▓реНрдп рд╕реЗ рдХрдо рд╣реИ, рддреЛ рдЗрд╕ рд╕реЗрд▓ рдХрд╛ рд╣реЗрдпреБрд░рд┐рд╕реНрдЯрд┐рдХ 0 рдирд╣реАрдВ рдмрдирддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди 1. рдорд╛рди 0.5 рдХрд╛ рдЙрдкрдпреЛрдЧ рдереНрд░реЗрд╕рд╣реЛрд▓реНрдб рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░рддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рдд, рдпрд╣ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЖрдзреЗ рд╕реЗрд▓ рд╣реЛрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> neighbor.Distance = neighbor.coordinates.DistanceTo(center); neighbor.SearchHeuristic = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0.5f</span></span> ? <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; searchFrontier.Enqueue(neighbor);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43e/aec/793/43eaec79315f68e0618fe71c0f93c3f3.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рдХреГрдд рдХреНрд╖реЗрддреНрд░ред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрд▓ рдХреЗ рдЦреЛрдЬ рдЕрдиреБрдорд╛рди рдХреЛ рдмрдврд╝рд╛рдХрд░, рд╣рдордиреЗ рдмрд╛рдж рдореЗрдВ рдЙрдореНрдореАрдж рд╕реЗ рдЕрдзрд┐рдХ рдпрд╛рддреНрд░рд╛ рдХреАред рдЗрд╕реА рд╕рдордп, рдХреЗрдВрджреНрд░ рд╕реЗ рдПрдХ рдХрджрдо рдЖрдЧреЗ рд╕реНрдерд┐рдд рдЕрдиреНрдп рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рджреМрд░рд╛ рдкрд╣рд▓реЗ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрдм рддрдХ рдХрд┐ рд╡реЗ рднреА рд╡реГрджреНрдзрд┐ рдХреЛ рдмрдврд╝рд╛рддреЗ рд╣реИрдВред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЕрдЧрд░ рд╣рдо рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд╣реЗрдпреБрд░рд┐рд╕реНрдЯрд┐рдХ рдХреЛ рдПрдХ рдореВрд▓реНрдп рд╕реЗ рдмрдврд╝рд╛рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред рдпрд╣реА рд╣реИ, рдереНрд░реЗрд╢реЛрд▓реНрдб 1 рдХрд╛ рдкреНрд░рднрд╛рд╡ рдирд╣реАрдВ рд╣реЛрдЧрд╛, рдЬреИрд╕реЗ рдереНрд░реЗрд╢реЛрд▓реНрдб 0. рдФрд░ рдереНрд░реЗрд╢реЛрд▓реНрдб 0.8 0.2 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдЧрд╛ред рдпрд╣реА рд╣реИ, 0.5 рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдЦреЛрдЬ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рдмрд╕реЗ "рдХрд╛рдВрдк" рдмрдирд╛рддреА рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛрд▓рди рдХреА рдЙрдкрдпреБрдХреНрдд рдорд╛рддреНрд░рд╛ рд╡рд╛рдВрдЫрд┐рдд рдкреНрд░рдХрд╛рд░ рдХреЗ рднреВрднрд╛рдЧ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреА рд╣реИ, рддреЛ рдЪрд▓рд┐рдП рдЗрд╕реЗ рдЕрдиреБрдХреВрд▓рди рдпреЛрдЧреНрдп рдмрдирд╛рддреЗ рд╣реИрдВред рдЬрдирд░реЗрдЯрд░ рдХреЗ </font></font><code>jitterProbability</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рд╕рд╛рде </font><font style="vertical-align: inherit;">рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдлреНрд▓реЛрдЯ рдлрд╝реАрд▓реНрдб рдЬреЛрдбрд╝реЗрдВ</font></font><code>Range</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдорд╛ 0-0.5 рдореЗрдВ рд╕реАрдорд┐рдд рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕реЗ рдЗрд╕ рдЕрдВрддрд░рд╛рд▓ рдХреЗ рдФрд╕рдд рдХреЗ рдмрд░рд╛рдмрд░ рдПрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рджреЗрдВ, рдЕрд░реНрдерд╛рдд 0.25ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╣рдореЗрдВ рдпреВрдирд┐рдЯреА рдЗрдВрд╕реНрдкреЗрдХреНрдЯрд░ рд╡рд┐рдВрдбреЛ рдореЗрдВ рдЬрдирд░реЗрдЯрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(0f, 0.5f)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> jitterProbability = <span class="hljs-number"><span class="hljs-number">0.25f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/795/b50/381/795b50381d8c9cda219ff092cf64cee5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрддрд╛рд░-рдЪрдврд╝рд╛рд╡ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ред </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрдпрд╛ рдЖрдк рдЗрд╕реЗ рдЧреЗрдо UI рдореЗрдВ рдХрд╕реНрдЯрдорд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ?</font></font></b> <div class="spoiler_text">  ,       .           UI,       .          ,      UI.  ,     .         ,       . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдм, рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдирд┐рд░реНрдгрдп рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╣реЗрдпреБрд░рд┐рд╕реНрдЯрд┐рдХ 1 рдХреЗ рдмрд░рд╛рдмрд░ рдХрдм рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рд╣рдо рдирд┐рд░рдВрддрд░ рдореВрд▓реНрдп рдХреЗ рдмрдЬрд╛рдп рд╕рдВрднрд╛рд╡рдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><pre> <code class="cs hljs"> neighbor.SearchHeuristic = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; jitterProbability ? <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдо 0 рдФрд░ 1. рдорд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐ рдмрдбрд╝реЗ рдореВрд▓реНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рд╡рд░реНрдЧреЛрдВ рдХреА рд╡рд┐рдХреГрддрд┐ рдХреЛ рдмрд╣реБрдд рдЦрд░рд╛рдм рдХрд░ рджреЗрдЧрд╛, рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдзрд╛рд░рд┐рдпреЛрдВ рдХреЗ рдПрдХ рдЧреБрдЪреНрдЫрд╛ рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рдПред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреБрдЫ рдЬрдореАрди рдЙрдард╛рддреЗ рд╣реИрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рднреВрдорд┐ рдХреЗ рдПрдХ рдЯреБрдХрдбрд╝реЗ рдХреА рдкреАрдврд╝реА рддрдХ рд╕реАрдорд┐рдд рдирд╣реАрдВ рд░рд╣реЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо </font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдВрдЪ рдЦрдВрдбреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд▓реВрдк рдХреЗ рдЕрдВрджрд░ </font><font style="vertical-align: inherit;">рдХреЙрд▓ рдХрд░рддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>; i++) { RaiseTerrain(<span class="hljs-number"><span class="hljs-number">30</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d42/83f/acd/d4283facd88705107d705290c3d8e78b.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдореАрди рдХреЗ рдкрд╛рдВрдЪ рдкреНрд▓реЙрдЯред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдБрдХрд┐ рдЕрдм рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рдореЗрдВ 30 рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдкрд╛рдБрдЪ рднреВрдЦрдВрдбреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЬрд░реВрд░реА рдирд╣реАрдВ рдХрд┐ рдпрд╣ рдмрд┐рд▓реНрдХреБрд▓ 150 рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рднреВрдорд┐ рд╣реЛред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рд╕рд╛рдЗрдЯ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдмрдирд╛рдИ рдЧрдИ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡реЗ рдПрдХ-рджреВрд╕рд░реЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╡реЗ рдЕрдВрддрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЕрд▓рдЧ-рдерд▓рдЧ рд╡рд░реНрдЧреЛрдВ рдХреЗ рдПрдХ рд╕реЗрдЯ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рджрд┐рд▓рдЪрд╕реНрдк рдкрд░рд┐рджреГрд╢реНрдп рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднреВрдорд┐ рдХреА рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓рддрд╛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рднреВрдЦрдВрдб рдХрд╛ рдЖрдХрд╛рд░ рднреА рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рднреВрдЦрдВрдбреЛрдВ рдХреЗ рдиреНрдпреВрдирддрдо рдФрд░ рдЕрдзрд┐рдХрддрдо рдЖрдХрд╛рд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛ рдкреВрд░реНрдгрд╛рдВрдХ рдлрд╝реАрд▓реНрдб рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЙрдиреНрд╣реЗрдВ 20-200 рддрдХ рдкрд░реНрдпрд╛рдкреНрдд рд░реВрдк рд╕реЗ рдмрдбрд╝рд╛ рдЕрдВрддрд░рд╛рд▓ рдкреНрд░рджрд╛рди рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдореИрдВ рдорд╛рдирдХ рдХреЛ рдиреНрдпреВрдирддрдо 30 рдХреЗ рдмрд░рд╛рдмрд░ рдФрд░ рдорд╛рдирдХ рдЕрдзрд┐рдХрддрдо - 100 рдХрд░ рджреВрдВрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(20, 200)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkSizeMin = <span class="hljs-number"><span class="hljs-number">30</span></span>; [Range(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkSizeMax = <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ea/026/e43/9ea026e43e949f571be0358332447de5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдХрд╛рд░ рджреЗрдиреЗ рдХрд╛ рдЕрдВрддрд░рд╛рд▓ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрди рдХреНрд╖реЗрддреНрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдо рдмреЗрддрд░рддреАрдм рдврдВрдЧ рд╕реЗ рдЙрд╕ рдХреНрд╖реЗрддреНрд░ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВ рдЬрдм рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> RaiseTerrain(Random.Range(chunkSizeMin, chunkSizeMax + <span class="hljs-number"><span class="hljs-number">1</span></span>));</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0df/124/dab/0df124dab1f706825f75304d2862aea3.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреАрдЪ рдХреЗ рдирдХреНрд╢реЗ рдкрд░ рдкрд╛рдВрдЪ рдмреЗрддрд░рддреАрдм рдЖрдХрд╛рд░ рдХреЗ рдЦрдВрдбред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд░реНрдпрд╛рдкреНрдд рд╕реБрд╢реА рдмрдирд╛рдПрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдмрдХрд┐ рд╣рдо рдЙрддреНрдкрдиреНрди рднреВрдорд┐ рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рд╣рдо рдкреНрд▓реЙрдЯ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╡рд┐рдХрд▓реНрдк рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдкреНрд▓реЙрдЯ рд╕реНрд╡рдпрдВ рдЖрдХрд╛рд░ рдореЗрдВ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╣реИрдВ рдФрд░ рдереЛрдбрд╝рд╛ рдпрд╛ рджреГрдврд╝рддрд╛ рд╕реЗ рдУрд╡рд░рд▓реИрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╕рд╛рдЗрдЯреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рднреВрдорд┐ рдХреА рдЖрд╡рд╢реНрдпрдХ рд░рд╛рд╢рд┐ рдХреЗ рдирдХреНрд╢реЗ рдкрд░ рд░рд╕реАрдж рдХреА рдЧрд╛рд░рдВрдЯреА рдирд╣реАрдВ рджреЗрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ рдкреВрд░реНрдгрд╛рдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрдХреНрдд рдХреА рдЧрдИ рднреВрдорд┐ рдХреЗ рдкреНрд░рддрд┐рд╢рдд рдХреЛ рд╕реАрдзреЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рдХрд▓реНрдк рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ 100% рднреВрдорд┐ рдпрд╛ рдкрд╛рдиреА рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ 50 рдХреЗ рдорд╛рди рдХреЗ рд╕рд╛рде, рдЕрдВрддрд░рд╛рд▓ рдХреЛ 5-95 рддрдХ рд╕реАрдорд┐рдд рдХрд░ рджреЗрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(5, 95)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> landPercentage = <span class="hljs-number"><span class="hljs-number">50</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21e/281/912/21e281912ad5a4a5378c5e55514c639c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реБрд╢реА рдХрд╛ рдкреНрд░рддрд┐рд╢рддред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднреВрдорд┐ рдХреА рд╕рд╣реА рдорд╛рддреНрд░рд╛ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдЧрд╛рд░рдВрдЯреА рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рддрдм рддрдХ рдЗрд▓рд╛рдХреЗ рдХреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ рд╣рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рдорд╛рддреНрд░рд╛ рдореЗрдВ рдирд╣реАрдВ рдорд┐рд▓рддрд╛ред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬреЛ рднреВрдорд┐ рдХреА рдкреАрдврд╝реА рдХреЛ рдЬрдЯрд┐рд▓ рдХрд░реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЖрдЗрдП рдирдИ рдкрджреНрдзрддрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рд╕рд╛рдЗрдЯреЛрдВ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рдореМрдЬреВрджрд╛ рдЪрдХреНрд░ рдХреЛ рдмрджрд▓реЗрдВ </font></font><code>CreateLand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдкрд╣рд▓реА рд╡рд┐рдзрд┐ рдЬреЛ рдпрд╣ рдХрд░рддреА рд╣реИ, рд╡рд╣ рдЙрди рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреА рдЧрдгрдирд╛ рдХрд░рддреА рд╣реИ рдЬреЛ рднреВрдорд┐ рдмрдирдиреА рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрд╣ рд░рд╛рд╢рд┐ рд╣рдорд╛рд░реА рд╕реБрд╢реА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдХреБрд▓ рд░рд╛рд╢рд┐ рд╣реЛрдЧреАред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-comment"><span class="hljs-comment">// for (int i = 0; i &lt; 5; i++) { // RaiseTerrain(Random.Range(chunkSizeMin, chunkSizeMax + 1)); // } CreateLand(); for (int i = 0; i &lt; cellCount; i++) { grid.GetCell(i).SearchPhase = 0; } } void CreateLand () { int landBudget = Mathf.RoundToInt(cellCount * landPercentage * 0.01f); }</span></span></code> </pre> <br> <code>CreateLand</code><font style="vertical-align: inherit;"></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрдм рддрдХ </font><font style="vertical-align: inherit;">рдХрд╛рд░рдг рд╣реЛрдЧрд╛ </font><font style="vertical-align: inherit;">рдЬрдм рддрдХ рд╣рдо рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдкреВрд░реА рд░рд╛рд╢рд┐ рдЦрд░реНрдЪ рдирд╣реАрдВ рдХрд░рддреЗред </font><font style="vertical-align: inherit;">рд░рд╛рд╢рд┐ рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо </font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕реЗ </font><font style="vertical-align: inherit;">рдмрджрд▓рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рд░рд╛рд╢рд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗред </font><font style="vertical-align: inherit;">рдХрд╛рдо рдЦрддреНрдо рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЙрд╕реЗ рд╢реЗрд╖ рд░рд╛рд╢рд┐ рд╡рд╛рдкрд╕ рдХрд░рдиреА рд╣реЛрдЧреАред</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// void RaiseTerrain (int chunkSize) { int RaiseTerrain (int chunkSize, int budget) { тАж return budget; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдмрд╛рд░ рд╕реЗрд▓ рдХреЛ рд╕реАрдорд╛ рд╕реЗ рд╣рдЯрд╛рдХрд░ рднреВрдорд┐ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЗрд╕рдХреЗ рдмрд╛рдж рдкреВрд░реА рд░рд╛рд╢рд┐ рдЦрд░реНрдЪ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рд╣рдореЗрдВ рдЦреЛрдЬ рдмрдВрдж рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдФрд░ рд╕рд╛рдЗрдЯ рдХреЛ рдкреВрд░рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдХреЗрд╡рд▓ рддрдм рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рдЕрднреА рддрдХ рднреВрдорд┐ рдирд╣реАрдВ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (size &lt; chunkSize &amp;&amp; searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current.TerrainTypeIndex == <span class="hljs-number"><span class="hljs-number">0</span></span>) { current.TerrainTypeIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (--budget == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } size += <span class="hljs-number"><span class="hljs-number">1</span></span>; тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдпрд╣ </font></font><code>CreateLand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрдм рддрдХ рдЬрдореАрди рдЬреБрдЯрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рддрдХ рдпрд╣ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдкреВрд░реА рдорд╛рддреНрд░рд╛ рдЦрд░реНрдЪ рдирд╣реАрдВ рдХрд░рддрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateLand</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> landBudget = Mathf.RoundToInt(cellCount * landPercentage * <span class="hljs-number"><span class="hljs-number">0.01f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (landBudget &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { landBudget = RaiseTerrain( Random.Range(chunkSizeMin, chunkSizeMax + <span class="hljs-number"><span class="hljs-number">1</span></span>), landBudget ); } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d15/34e/7f4/d1534e7f47ba4cf87f3dbeed60aa7d00.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд┐рд▓реНрдХреБрд▓ рдЖрдзрд╛ рдирдХреНрд╢рд╛ рдЬрдореАрди рдмрди рдЧрдпрд╛ред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдКрдВрдЪрд╛рдИ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦреЗрдВ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднреВрдорд┐ рдХреЗрд╡рд▓ рд╕рдорддрд▓ рдкреНрд▓реЗрдЯ рдирд╣реАрдВ рд╣реИ, рдЬреЛ рд╕рдореБрджреНрд░ рддрдЯ рд╕реЗ рд╕реАрдорд┐рдд рд╣реИред </font><font style="vertical-align: inherit;">рдЙрд╕рдХреЗ рдкрд╛рд╕ рдПрдХ рдмрджрд▓рддреА рдКрдВрдЪрд╛рдИ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдкрд╣рд╛рдбрд╝, рдкрд╣рд╛рдбрд╝, рдШрд╛рдЯрд┐рдпрд╛рдВ, рдЭреАрд▓реЗрдВ рдЖрджрд┐ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдКрдВрдЪрд╛рдИ рдореЗрдВ рдмрдбрд╝реЗ рдЕрдВрддрд░ рдзреАрд░реЗ-рдзреАрд░реЗ рдЪрд▓рддреА рдЯреЗрдХреНрдЯреЛрдирд┐рдХ рдкреНрд▓реЗрдЯреЛрдВ рдХреА рдмрд╛рддрдЪреАрдд рдХреЗ рдХрд╛рд░рдг рдореМрдЬреВрдж рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рд╣рдо рдЗрд╕рдХрд╛ рдЕрдиреБрдХрд░рдг рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ, рд╣рдорд╛рд░реЗ рднреВрдорд┐ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдХрд┐рд╕реА рднреА рддрд░рд╣ рд╕реЗ рдРрд╕реА рдкреНрд▓реЗрдЯреЛрдВ рдХреЗ рд╕рдорд╛рди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд╕рд╛рдЗрдЯреЗрдВ рдЪрд▓рддреА рдирд╣реАрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдВрддрд░ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдФрд░ рд╣рдо рдЗрд╕рдХрд╛ рдлрд╛рдпрджрд╛ рдЙрдард╛ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрдореАрди рдХреЛ рдзрдХреЗрд▓ рджреЛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рднреВрдЦрдВрдб рд╕рдореБрджреНрд░ рдХреЗ рдиреАрдЪреЗ рд╕реЗ рдзрдХреЗрд▓ рджрд┐рдП рдЧрдП рднреВрдорд┐ рдХреЗ рдПрдХ рд╣рд┐рд╕реНрд╕реЗ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЪрд▓реЛ рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рдХреА рдКрдБрдЪрд╛рдИ рдХреЛ рд▓рдЧрд╛рддрд╛рд░ рдмрдврд╝рд╛рдПрдБ </font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> HexCell current = searchFrontier.Dequeue(); current.Elevation += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current.TerrainTypeIndex == <span class="hljs-number"><span class="hljs-number">0</span></span>) { тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b3c/f6e/d3e/b3cf6ed3e71eb737ea7246c92bdd5624.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрдБрдЪрд╛рдИ рд╡рд╛рд▓реА рднреВрдорд┐ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдКрдВрдЪрд╛рдЗрдпрд╛рдВ рдорд┐рд▓реАрдВ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рджреЗрдЦрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдк рдЙрдиреНрд╣реЗрдВ рдЕрдзрд┐рдХ рд╕реБрдкрд╛рдареНрдп рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдпрджрд┐ рдЖрдк рдКрдВрдЪрд╛рдИ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрддрд░ рдХреЗ рд▓рд┐рдП рднреМрдЧреЛрд▓рд┐рдХ рд╕реНрддрд░ рдХреА рддрд░рд╣ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдХреЗрд╡рд▓ рдРрд╕рд╛ рдХрд░реЗрдВрдЧреЗ рддрд╛рдХрд┐ рдКрдВрдЪрд╛рдЗрдпрд╛рдВ рдЕрдзрд┐рдХ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реЛрдВ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдКрдВрдЪрд╛рдИ рд╕реНрддрд░ рдХреЛ рдКрдВрдЪрд╛рдИ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдКрдВрдЪрд╛рдИ рдЗрд▓рд╛рдХрд╝реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛?</font></font></b> <div class="spoiler_text">        .        ,     . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрдВрдЪрд╛рдИ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рд╕рд╛рде рд╕реЗрд▓ рдХреЗ рдЗрд▓рд╛рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЪрд▓реЛ </font></font><code>SetTerrainType</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЗрд╡рд▓ рдПрдХ рдмрд╛рд░ рд╕рднреА рдЗрд▓рд╛рдХреЗ рдкреНрд░рдХрд╛рд░ рд╕реЗрдЯ рдХрд░рдиреЗ </font><font style="vertical-align: inherit;">рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдзрд┐ рдмрдирд╛рдПрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetTerrainType</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellCount; i++) { HexCell cell = grid.GetCell(i); cell.TerrainTypeIndex = cell.Elevation; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реБрд╢реА рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж рд╣рдо рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЛ рдХрд╣реЗрдВрдЧреЗред </font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { тАж CreateLand(); SetTerrainType(); тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╡рд╣ </font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░рд╛рд╣рдд рдХреЗ рдкреНрд░рдХрд╛рд░ рд╕реЗ рдирд╣реАрдВ рдирд┐рдкрдЯ рд╕рдХрддрд╛, рдФрд░ рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЗрд╕рдХреЗ рддрд░реНрдХ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╡рд░реНрддрдорд╛рди рд╕реЗрд▓ рдХреА рдирдИ рдКрдВрдЪрд╛рдИ 1 рд╣реИ, рддреЛ рдпрд╣ рд╕рд┐рд░реНрдл рд╕реВрдЦ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХрд╛ рдпреЛрдЧ рдХрдо рд╣реЛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╕рд╛рдЗрдЯ рдХреА рд╡реГрджреНрдзрд┐ рдкреВрд░реА рд╣реЛ рд╕рдХрддреА рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> HexCell current = searchFrontier.Dequeue(); current.Elevation += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current.Elevation == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; --budget == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// if (current.TerrainTypeIndex == 0) { // current.TerrainTypeIndex = 1; // if (--budget == 0) { // break; // } // }</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee0/eec/b9e/ee0eecb9e59f527bd27f0275e230de0a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рддреЛрдВ рдХрд╛ рд╕реНрддрд░реАрдХрд░рдгред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╛рдиреА рдбрд╛рд▓реЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдХреМрди рд╕реА рдХреЛрд╢рд┐рдХрд╛рдПрдБ рдкрд╛рдиреА рдпрд╛ рднреВрдорд┐ рд╣реИрдВ, рд╕рднреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЬрд▓ рд╕реНрддрд░ рдХреЛ 1 рдкрд░ рд╕реЗрдЯ рдХрд░рдирд╛ </font></font><code>GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рднреВрдорд┐ рдмрдирд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░реЗрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { cellCount = x * z; grid.CreateMap(x, z); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (searchFrontier == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { searchFrontier = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexCellPriorityQueue(); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellCount; i++) { grid.GetCell(i).WaterLevel = <span class="hljs-number"><span class="hljs-number">1</span></span>; } CreateLand(); тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рднреВрдорд┐ рдкрд░рддреЛрдВ рдХреЗ рдкрджрдирд╛рдо рдХреЗ рд▓рд┐рдП рд╣рдо рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рднреВрднрд╛рдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╕рднреА рдкрдирдбреБрдмреНрдмреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рд░реЗрдд рд░рд╣реЗрдЧреА, рдЬреИрд╕рд╛ рдХрд┐ рд╕рдмрд╕реЗ рдХрдо рднреВрдорд┐ рдХреЛрд╢рд┐рдХрд╛рдПрдВ рд╣реЛрдВрдЧреАред </font><font style="vertical-align: inherit;">рдпрд╣ рдКрдВрдЪрд╛рдИ рд╕реЗ рдЬрд▓ рд╕реНрддрд░ рдХреЛ рдШрдЯрд╛рдХрд░ рдФрд░ рд░рд╛рд╣рдд рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetTerrainType</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellCount; i++) { HexCell cell = grid.GetCell(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { cell.TerrainTypeIndex = cell.Elevation - cell.WaterLevel; } } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1b5/449/bc3/1b5449bc37b1c677d908484c7bcd0286.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдореАрди рдФрд░ рдкрд╛рдиреАред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрд▓ рд╕реНрддрд░ рдмрдврд╝рд╛рдПрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рдЬрд▓ рд╕реНрддрд░ рддрдХ рд╕реАрдорд┐рдд рдирд╣реАрдВ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЖрдЗрдП рдЗрд╕реЗ 1-5 рдХреЗ рдЕрдВрддрд░рд╛рд▓ рдФрд░ 3 рдХреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рдХреЗ рд╕рд╛рде рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдлрд╝реАрд▓реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреБрдХреВрд▓рди рдпреЛрдЧреНрдп рдмрдирд╛рдПрдВред </font><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рд╢реБрд░реВ рдХрд░рддреЗ рд╕рдордп рдЗрд╕ рд╕реНрддрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(1, 5)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> waterLevel = <span class="hljs-number"><span class="hljs-number">3</span></span>; тАж <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cellCount; i++) { grid.GetCell(i).WaterLevel = waterLevel; } тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c32/9cf/82f/c329cf82f9a847ac01f2754cc3252500.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/850/c9d/fe4/850c9dfe4694834486bf4be64ac1783a.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд▓ рд╕реНрддрд░ 3.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬрдм рдЬрд▓ рд╕реНрддрд░ 3 рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдЙрдореНрдореАрдж рд╕реЗ рдХрдо рдЬрдореАрди рдорд┐рд▓рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ </font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрднреА рднреА рдорд╛рдирддрд╛ рд╣реИ рдХрд┐ рдкрд╛рдиреА рдХрд╛ рд╕реНрддрд░ 1 рд╣реИред рдЪрд▓реЛ рдЗрд╕реЗ рдареАрдХ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> HexCell current = searchFrontier.Dequeue(); current.Elevation += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (current.Elevation == waterLevel &amp;&amp; --budget == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдЪреНрдЪ рдЬрд▓ рд╕реНрддрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдпрд╣ рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдХрд┐ рдХреЛрд╢рд┐рдХрд╛рдПрдВ рддреБрд░рдВрдд рднреВрдорд┐ рдирд╣реАрдВ рдмрди рдЬрд╛рддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЬрдм рдЬрд▓ рд╕реНрддрд░ 2 рд╣реЛрдЧрд╛, рддрдм рднреА рдкрд╣рд▓рд╛ рдЦрдВрдб рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд░рд╣реЗрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╕рдореБрджреНрд░ рдХреЗ рддрд▓ рдореЗрдВ рд╡реГрджреНрдзрд┐ рд╣реБрдИ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрднреА рднреА рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рд╣реИред </font><font style="vertical-align: inherit;">рдХрдо рд╕реЗ рдХрдо рджреЛ рд╡рд░реНрдЧреЛрдВ рдХреЗ рдЪреМрд░рд╛рд╣реЗ рдкрд░ рдПрдХ рднреВрдорд┐ рдХрд╛ рдЧрдарди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рднреВрдорд┐ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд▓ рд╕реНрддрд░ рдЬрд┐рддрдирд╛ рдЕрдзрд┐рдХ рд╣реЛрдЧрд╛, рдЙрддрдиреА рд╣реА рд╕рд╛рдЗрдЯреЛрдВ рдХреЛ рдкрд╛рд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЬрд▓ рд╕реНрддрд░ рдмрдврд╝рдиреЗ рдХреЗ рд╕рд╛рде, рднреВрдорд┐ рдЕрдзрд┐рдХ рдЕрд░рд╛рдЬрдХ рд╣реЛ рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрдм рдЕрдзрд┐рдХ рднреВрдЦрдВрдбреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рддреЛ рдпрд╣ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╡реЗ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рднреВрдорд┐ рдкрд░ рдЕрдВрддрд░ рдХрд░реЗрдВрдЧреЗ, рдЬрд┐рд╕рдХреЗ рдХрд╛рд░рдг рдкрд╣рд╛рдбрд╝ рдЕрдзрд┐рдХ рд╕рд╛рдорд╛рдиреНрдп рд╣реЛрдВрдЧреЗ, рдФрд░ рд╕рдкрд╛рдЯ рднреВрдорд┐ рдХрдо рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрдЧреА, рдЬреИрд╕рд╛ рдХрд┐ рдЫреЛрдЯреЗ рднреВрдЦрдВрдбреЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c39/f02/abf/c39f02abf2bfa93f01395208da92ae9a.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a9/01f/4e2/5a901f4e2785456e0784f33508be4ede.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/863/816/cc1/863816cc19c0fd7cbf172905962970d9.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd0/412/190/fd041219043df072443b00d6799f3946.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд▓ рд╕реНрддрд░ 2-5 рд╣реИ, рд╕реБрд╢реА рд╣рдореЗрд╢рд╛ 50% рд╣реИред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдКрд░реНрдзреНрд╡рд╛рдзрд░ рдЖрдВрджреЛрд▓рди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдм рддрдХ рд╣рдордиреЗ рдПрдХ рд╕рдордп рдореЗрдВ рднреВрдЦрдВрдбреЛрдВ рдХреЛ рдПрдХ рд╕реНрддрд░ рдКрдкрд░ рдЙрдард╛рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдЦреБрдж рдХреЛ рдЗрд╕ рддрдХ рд╕реАрдорд┐рдд рдирд╣реАрдВ рд░рдЦрдирд╛ рд╣реИред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрдЪреНрдЪ рд╕рд╛рдЗрдЯреЗрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджреНрдпрдкрд┐ рдкреНрд░рддреНрдпреЗрдХ рдЦрдВрдб рдЕрдкрдиреЗ рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреА рдКрдВрдЪрд╛рдИ рдХреЛ рдПрдХ рд╕реНрддрд░ рддрдХ рдмрдврд╝рд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХрддрд░рди рд╣реЛ рд╕рдХрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рджреЛ рд╡рд░реНрдЧреЛрдВ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдЫреВрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдЕрд▓рдЧ-рдерд▓рдЧ рдЪрдЯреНрдЯрд╛рдиреЗрдВ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд▓рдВрдмреА рдЪрдЯреНрдЯрд╛рди рд▓рд╛рдЗрдиреЗрдВ рджреБрд░реНрд▓рдн рд╣реЛрдВрдЧреАред </font><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдЪрд░рдгреЛрдВ рджреНрд╡рд╛рд░рд╛ рднреВрдЦрдВрдб рдХреА рдКрдВрдЪрд╛рдИ рдмрдврд╝рд╛рдХрд░ рдЙрдирдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреА рдЖрд╡реГрддреНрддрд┐ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдпрд╣ рдХреЗрд╡рд▓ рд╕рд╛рдЗрдЯреЛрдВ рдХреЗ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдЕрдиреБрдкрд╛рдд рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╕рднреА рдХреНрд╖реЗрддреНрд░ рдКрдВрдЪреЗ рдЙрдарддреЗ рд╣реИрдВ, рддреЛ рдЗрд▓рд╛рдХреЗ рдХреЗ рд╕рд╛рде рдЪрд▓рдирд╛ рдмрд╣реБрдд рдореБрд╢реНрдХрд┐рд▓ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рддреЛ рдЪрд▓рд┐рдП рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ 0.25 рдХреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рдпрд┐рдХрддрд╛ рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреБрдХреВрд▓рди рдпреЛрдЧреНрдп рдмрдирд╛рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(0f, 1f)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> highRiseProbability = <span class="hljs-number"><span class="hljs-number">0.25f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb6/485/8d7/cb64858d7531bb31842aebdd49b68304.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рдПрдХ рдордЬрдмреВрдд рд╡реГрджреНрдзрд┐ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╣рдо рдЙрдЪреНрдЪ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдКрдВрдЪрд╛рдИ рдореЗрдВ рдХрд┐рд╕реА рднреА рд╡реГрджреНрдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рдЬрд▓реНрджреА рд╕реЗ рд╣рд╛рде рд╕реЗ рдирд┐рдХрд▓ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдКрдВрдЪрд╛рдИ рдЕрдВрддрд░ 2 рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЪрдЯреНрдЯрд╛рдиреЗрдВ рдмрдирд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред </font><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рдЖрдк рдЬрд▓ рд╕реНрддрд░ рдХреЗ рдмрд░рд╛рдмрд░ рдКрдБрдЪрд╛рдИ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдореЗрдВ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рд╣реИ рдХрд┐ рд╣рдо рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ рдХрд┐ рдХреНрдпрд╛ рд╕реЗрд▓ рднреВрдорд┐ рдмрди рдЧрдИ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдпрд╣ рдЬрд▓ рд╕реНрддрд░ рд╕реЗ рдиреАрдЪреЗ рдерд╛, рдФрд░ рдЕрдм рдпрд╣ рдЙрд╕реА рд╕реНрддрд░ рдпрд╛ рдЙрд╕рд╕реЗ рдЕрдзрд┐рдХ рд╣реИ, рддреЛ рд╣рдордиреЗ рдПрдХ рдирдпрд╛ рд▓реИрдВрдб рд╕реЗрд▓ рдмрдирд╛рдпрд╛ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rise = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; highRiseProbability ? <span class="hljs-number"><span class="hljs-number">2</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (size &lt; chunkSize &amp;&amp; searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalElevation = current.Elevation; current.Elevation = originalElevation + rise; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( originalElevation &lt; waterLevel &amp;&amp; current.Elevation &gt;= waterLevel &amp;&amp; --budget == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } size += <span class="hljs-number"><span class="hljs-number">1</span></span>; тАж }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b31/8c1/ea5/b318c1ea557ced17d2cb0d9a951bcfc3.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ba/353/78b/4ba35378bc60e74b624e136b90a4a7eb.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea3/8ac/b0a/ea38acb0a5cf12835c2ba177e41d6178.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/018/0df/bd9/0180dfbd9869a0d0e0d5a1712af34fb3.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрдВрдЪрд╛рдИ рдореЗрдВ рдордЬрдмреВрдд рд╡реГрджреНрдзрд┐ рдХреА рд╕рдВрднрд╛рд╡рдирд╛рдПрдВ 0.25, 0.50, 0.75 рдФрд░ 1 рд╣реИрдВред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рднреВрдорд┐ рдХреЛ рдХрдо рдХрд░реЛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рднреВрдорд┐ рд╣рдореЗрд╢рд╛ рдмрдврд╝рддреА рдирд╣реАрдВ рд╣реИ, рдХрднреА-рдХрднреА рдЧрд┐рд░ рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЬрдм рднреВрдорд┐ рдХрд╛рдлреА рдиреАрдЪреЗ рдЧрд┐рд░ рдЬрд╛рддреА рд╣реИ, рддреЛ рдкрд╛рдиреА рднрд░ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╡рд╣ рдЦреЛ рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЕрднреА рддрдХ рд╣рдо рдРрд╕рд╛ рдирд╣реАрдВ рдХрд░ рд░рд╣реЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдо рдХреЗрд╡рд▓ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдКрдкрд░ рдзрдХреЗрд▓рддреЗ рд╣реИрдВ, рднреВрдорд┐ рдЖрдорддреМрд░ рдкрд░ рдорд┐рд╢реНрд░рд┐рдд рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рдПрдХ рд╕рдореВрд╣ рдХреА рддрд░рд╣ рджрд┐рдЦрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдо рдХрднреА-рдХрднреА рдЗрд╕ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдиреАрдЪреЗ рдХрд░ рджреЗрддреЗ рд╣реИрдВ, рддреЛ рд╣рдореЗрдВ рдЕрдзрд┐рдХ рднрд┐рдиреНрди рд░реВрдк рдорд┐рд▓рддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e4/95e/d81/9e495ed818dfffc39e5a238f273c8c5b.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдзрдБрд╕рд╛ рд╕реБрд╢реА рдХреЗ рдмрд┐рдирд╛ рдмрдбрд╝рд╛ рдирдХреНрд╢рд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рдЕрдиреНрдп рдкреНрд░рд╛рдпрд┐рдХрддрд╛ рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рднреВрдорд┐ рдЙрдкрдзрд╛рд░рд╛ рдХреА рдЖрд╡реГрддреНрддрд┐ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдХрдо рдХрд░рдирд╛ рднреВрдорд┐ рдХреЛ рдирд╖реНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдХрдо рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣рдореЗрд╢рд╛ рдЙрдард╛рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╕реЗ рдХрдо рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рднреВрдорд┐ рдХрд╛ рд╕рд╣реА рдкреНрд░рддрд┐рд╢рдд рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдмрд╣реБрдд рд▓рдВрдмрд╛ рд╕рдордп рд▓рдЧ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЖрдЗрдП 0.2 рдХреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди рдХреЗ рд╕рд╛рде 0.4 рдХреА рдЕрдзрд┐рдХрддрдо рдХрдо рд╕рдВрднрд╛рд╡рдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(0f, 0.4f)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sinkProbability = <span class="hljs-number"><span class="hljs-number">0.2f</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a11/997/e82/a11997e824700a045e9faaedaafeb121.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдо рд╣реЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рдЗрдЯ рдХреЛ рдХрдо рдХрд░рдирд╛ рдХреБрдЫ рдорддрднреЗрджреЛрдВ рдХреЗ рд╕рд╛рде, рдЙрдард╛рдиреЗ рдХреЗ рд╕рдорд╛рди рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рдо рд╡рд┐рдзрд┐ рдХреА рдирдХрд▓ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЙрд╕рдХрд╛ рдирд╛рдо рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВ </font></font><code>SinkTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЙрджрдп рдХреЗ рдкрд░рд┐рдорд╛рдг рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдореЗрдВ рдХрдо рдореВрд▓реНрдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬреЛ рд╕рдорд╛рди рддрд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕реА рд╕рдордп, рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рд╣рдо рдкрд╛рдиреА рдХреА рд╕рддрд╣ рд╕реЗ рдЧреБрдЬрд░реЗ рд╣реИрдВ, рдХреА рдЬрд░реВрд░рдд рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд░рд╛рд╣рдд рдХрдо рдХрд░рддреЗ рд╕рдордп, рд╣рдо рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рдпреЛрдЧ рддрдХ рд╕реАрдорд┐рдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдкреНрд░рддреНрдпреЗрдХ рдЦреЛрдИ рд╣реБрдИ рд╕реБрд╢реА рд╕реЗрд▓ рдЙрд╕ рдкрд░ рдЦрд░реНрдЪ рдХреА рдЧрдИ рд░рд╛рд╢рд┐ рдХреЛ рд╡рд╛рдкрд╕ рдХрд░ рджреЗрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рдмрдврд╝рд╛рддреЗ рд╣реИрдВ рдФрд░ рдХрд╛рдо рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SinkTerrain</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> chunkSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> budget</span></span></span><span class="hljs-function">)</span></span> { тАж <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sink = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; highRiseProbability ? <span class="hljs-number"><span class="hljs-number">2</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (size &lt; chunkSize &amp;&amp; searchFrontier.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { HexCell current = searchFrontier.Dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalElevation = current.Elevation; current.Elevation = originalElevation - sink; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( originalElevation &gt;= waterLevel &amp;&amp; current.Elevation &lt; waterLevel <span class="hljs-comment"><span class="hljs-comment">// &amp;&amp; --budget == 0 ) { // break; budget += 1; } size += 1; тАж } searchFrontier.Clear(); return budget; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм, рдкреНрд░рддреНрдпреЗрдХ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдкрд░, </font></font><code>CreateLand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдпрд╛ рддреЛ рдХрдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдпрд╛ рднреВрдорд┐ рдХреЛ рдКрдкрд░ рдЙрдард╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬреЛ рдХрд┐ рдХрдо рд╣реЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateLand</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> landBudget = Mathf.RoundToInt(cellCount * landPercentage * <span class="hljs-number"><span class="hljs-number">0.01f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (landBudget &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> chunkSize = Random.Range(chunkSizeMin, chunkSizeMax - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; sinkProbability) { landBudget = SinkTerrain(chunkSize, landBudget); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { landBudget = RaiseTerrain(chunkSize, landBudget); } } }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d6b/c5e/762/d6bc5e76274e4aa9c8a692f90fde3646.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2f/8ae/3e3/c2f8ae3e3a4b814b6ae954d40225149e.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e3/f5d/461/1e3f5d461421feddbb145d4e1d56c000.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/33b/39d/462/33b39d462682688fc2a8094556e4fc91.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫреЛрдбрд╝рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ 0.1, 0.2, 0.3 рдФрд░ 0.4 рд╣реИред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдКрдБрдЪрд╛рдИ рдХреА рд╕реАрдорд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рдЪрд░рдг рдореЗрдВ, рд╣рдо рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдХрдИ рд╡рд░реНрдЧреЛрдВ рдХреЛ рдУрд╡рд░рд▓реИрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХрднреА-рдХрднреА рдКрдВрдЪрд╛рдИ рдореЗрдВ рдХрдИ рд╡реГрджреНрдзрд┐ рдХреЗ рд╕рд╛рде, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдиреАрдЪреЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдлрд┐рд░ рд╕реЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ, рд╣рдо рдмрд╣реБрдд рдЕрдзрд┐рдХ рдФрд░ рдХрднреА-рдХрднреА рдмрд╣реБрдд рдХрдо рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЦрд╛рд╕рдХрд░ рдЬрдм рдЬрдореАрди рдХреЗ рдЙрдЪреНрдЪ рдкреНрд░рддрд┐рд╢рдд рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f3f/c2e/359/f3fc2e359db04b4411f2bcd06b81888b.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">90% рднреВрдорд┐ рдкрд░ рднрд╛рд░реА рдКрдВрдЪрд╛рдИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрдВрдЪрд╛рдИ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рдХрд╕реНрдЯрдо рдиреНрдпреВрдирддрдо рдФрд░ рдЕрдзрд┐рдХрддрдо рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдПрдХ рдЙрдЪрд┐рдд рдиреНрдпреВрдирддрдо рдХрд╣реАрдВ тИТ4 рдФрд░ 0 рдХреЗ рдмреАрдЪ рд╣реЛрдЧрд╛, рдФрд░ рд╕реНрд╡реАрдХрд╛рд░реНрдп рдЕрдзрд┐рдХрддрдо 6-10 рдХреА рд╕реАрдорд╛ рдореЗрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рдиреЛрдВ рдХреЛ and2 рдФрд░ 8 рд╣реЛрдиреЗ рджреЗрдВред рдорд╛рдирдЪрд┐рддреНрд░ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╕рдордп, рд╡реЗ рдЕрдиреБрдореЗрдп рд╕реАрдорд╛ рдХреЗ рдмрд╛рд╣рд░ рд╣реЛрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдЖрдк UI рд╕рдВрдкрд╛рджрдХ рдХреЗ рд╕реНрд▓рд╛рдЗрдбрд░ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдЗрд╕реЗ рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Range(-4, 0)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> elevationMinimum = <span class="hljs-number"><span class="hljs-number">-2</span></span>; [Range(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> elevationMaximum = <span class="hljs-number"><span class="hljs-number">8</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bcb/20b/efc/bcb20befc496cd2c5bffbc94b0a9d267.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреНрдпреВрдирддрдо рдФрд░ рдЕрдзрд┐рдХрддрдо рдКрдВрдЪрд╛рдИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм </font></font><code>RaiseTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдКрдБрдЪрд╛рдИ рдЕрдиреБрдореЗрдп рдЕрдзрд┐рдХрддрдо рд╕реЗ рдЕрдзрд┐рдХ рди рд╣реЛред </font><font style="vertical-align: inherit;">рдпрд╣ рдЬрд╛рдБрдЪ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╡рд░реНрддрдорд╛рди рдХреЛрд╢рд┐рдХрд╛рдПрдБ рдмрд╣реБрдд рдКрдБрдЪреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдРрд╕рд╛ рд╣реИ, рддреЛ рд╣рдо рдЙрдиреНрд╣реЗрдВ рдКрдВрдЪрд╛рдИ рдХреЛ рдмрджрд▓рдиреЗ рдФрд░ рдЕрдкрдиреЗ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрд┐рдирд╛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдЗрд╕ рддрдереНрдп рдХреЛ рдЬрдиреНрдо рджреЗрдЧрд╛ рдХрд┐ рднреВрдорд┐ рдХреНрд╖реЗрддреНрд░ рдЙрди рдХреНрд╖реЗрддреНрд░реЛрдВ рд╕реЗ рдмрдЪреЗрдВрдЧреЗ рдЬреЛ рдЕрдзрд┐рдХрддрдо рдКрдВрдЪрд╛рдИ рддрдХ рдкрд╣реБрдВрдЪ рдЧрдП рд╣реИрдВ, рдФрд░ рдЙрдирдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдмрдврд╝рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cs hljs"> HexCell current = searchFrontier.Dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalElevation = current.Elevation; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newElevation = originalElevation + rise; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newElevation &gt; elevationMaximum) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } current.Elevation = newElevation; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( originalElevation &lt; waterLevel &amp;&amp; newElevation &gt;= waterLevel &amp;&amp; --budget == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } size += <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕реА рдореЗрдВ рдХрд░реЗрдВ </font></font><code>SinkTerrain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рд▓реЗрдХрд┐рди рдиреНрдпреВрдирддрдо рдКрдВрдЪрд╛рдИ рдХреЗ рд▓рд┐рдПред</font></font><br><br><pre> <code class="cs hljs"> HexCell current = searchFrontier.Dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalElevation = current.Elevation; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newElevation = current.Elevation - sink; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newElevation &lt; elevationMinimum) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } current.Elevation = newElevation; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( originalElevation &gt;= waterLevel &amp;&amp; newElevation &lt; waterLevel ) { budget += <span class="hljs-number"><span class="hljs-number">1</span></span>; } size += <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4af/cbe/339/4afcbe339d0d697779ff0649f6c2c125.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">90% рднреВрдорд┐ рдХреЗ рд╕рд╛рде рд╕реАрдорд┐рдд рдКрдБрдЪрд╛рдИред</font></font></i> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирдХрд╛рд░рд╛рддреНрдордХ рдКрдВрдЪрд╛рдИ рд╕рдВрд░рдХреНрд╖рдг </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░, рд╕рд╣реЗрдЬреЗрдВ рдФрд░ рд▓реЛрдб рдХреЛрдб рдирдХрд╛рд░рд╛рддреНрдордХ рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓ рдирд╣реАрдВ рд╕рдХрддреЗ рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рдКрдВрдЪрд╛рдИ рдХреЛ рдмрд╛рдЗрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдмрдбрд╝реЗ рдкреЙрдЬрд┐рдЯрд┐рд╡ рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдЬрд╛рдиреЗ рдкрд░ рдПрдХ рдЛрдгрд╛рддреНрдордХ рд╕рдВрдЦреНрдпрд╛ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╣реЛ рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЬрдм рдЙрддреНрдкрдиреНрди рдирдХреНрд╢реЗ рдХреЛ рд╕рд╣реЗрдЬрдирд╛ рдФрд░ рд▓реЛрдб рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдореВрд▓ рдкрд╛рдиреА рдХреЗ рдиреАрдЪреЗ рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЗ рд╕реНрдерд╛рди рдкрд░ рдмрд╣реБрдд рдЕрдзрд┐рдХ рджрд┐рдЦрд╛рдИ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдПрдХ рдкреВрд░реНрдгрд╛рдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдХреЗ рдЛрдгрд╛рддреНрдордХ рдКрдБрдЪрд╛рдЗрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдмрд╛рдЗрдЯ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдореЗрдВ рдЕрднреА рднреА рдКрдВрдЪрд╛рдИ рдХреЗ рдХрдИ рд╕реНрддрд░реЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо 127 рдХреЛ рдЬреЛрдбрд╝рдХрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдореВрд▓реНрдп рдХреЛ рдСрдлрд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рд╣рдореЗрдВ рдПрдХ рдмрд╛рдЗрдЯ рдХреЗ рднреАрддрд░ рд░реЗрдВрдЬ тИТ127тАУ128 рдореЗрдВ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдКрдВрдЪрд╛рдЗрдпреЛрдВ рдХреЛ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред </font></font><code>HexCell.Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрд╕реА рдХреЗ рдЕрдиреБрд╕рд╛рд░ </font><font style="vertical-align: inherit;">рдмрджрд▓рд┐рдП </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryWriter writer</span></span></span><span class="hljs-function">)</span></span> { writer.Write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)terrainTypeIndex); writer.Write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(elevation + <span class="hljs-number"><span class="hljs-number">127</span></span>)); тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рд╣рдордиреЗ рдорд╛рдирдЪрд┐рддреНрд░ рдбреЗрдЯрд╛ рдХреЛ рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЛ рдмрджрд▓ рджрд┐рдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ </font></font><code>SaveLoadMenu.mapFileVersion</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 рддрдХ </font><font style="vertical-align: inherit;">рдмрдврд╝рд╛рддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mapFileVersion = <span class="hljs-number"><span class="hljs-number">4</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдЕрдВрдд рдореЗрдВ, рдЗрд╕реЗ рдмрджрд▓ рджреЗрдВ </font></font><code>HexCell.Load</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рд╕рдВрд╕реНрдХрд░рдг 4 рдлрд╛рдЗрд▓реЛрдВ рд╕реЗ рднрд░реА рд╣реБрдИ рдКрдВрдЪрд╛рдЗрдпреЛрдВ рд╕реЗ 127 рдХреЛ рдШрдЯрд╛рдПред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BinaryReader reader, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> header</span></span></span><span class="hljs-function">)</span></span> { terrainTypeIndex = reader.ReadByte(); ShaderData.RefreshTerrain(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); elevation = reader.ReadByte(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (header &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span>) { elevation -= <span class="hljs-number"><span class="hljs-number">127</span></span>; } тАж }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЙрд╕реА рдирдХреНрд╢реЗ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдирд╛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдХрдИ рддрд░рд╣ рдХреЗ рдирдХреНрд╢реЗ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдирдпрд╛ рдкрд░рд┐рдгрд╛рдо рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╕рдордп рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╣реЛрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╣рдо рдХреЗрд╡рд▓ рдХрд╛рд░реНрдб рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╕рдмрд╕реЗ рд╕рдЯреАрдХ рд░реВрдк рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдХрд┐рди рдХрднреА-рдХрднреА рд╣рдореЗрдВ рдареАрдХ рдЙрд╕реА рдирдХреНрд╢реЗ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рджреЛрд╕реНрдд рдХреЗ рд╕рд╛рде рдПрдХ рд╕реБрдВрджрд░ рдирдХреНрд╢рд╛ рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдЧреЗрдо рдбреЗрд╡рд▓рдкрдореЗрдВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рднреА рдЙрдкрдпреЛрдЧреА рд╣реИ, рддреЛ рдЖрдЗрдП рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рдЬреЛрдбрд╝реЗрдВред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмреАрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рдирдЪрд┐рддреНрд░ рдирд┐рд░реНрдорд╛рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>Random.Range</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>Random.value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдПрдХ рд╣реА рдЫрджреНрдо рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЙрд╕реА рдмреАрдЬ рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдкрд╣рд▓реЗ рднреА, рдореЗрдВ рдПрдХ рд╕рдорд╛рди рджреГрд╖реНрдЯрд┐рдХреЛрдг рд▓реЗ рдЪреБрдХреЗ рд╣реИрдВ </font></font><code>HexMetrics.InitializeHashGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдкрд╣рд▓реЗ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдмреАрдЬ рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде рдЖрд░рдВрдн рдХреА рдЧрдИ рд╕рдВрдЦреНрдпрд╛ рдЬрдирд░реЗрдЯрд░ рдХреА рд╡рд░реНрддрдорд╛рди рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрдЪрд╛рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдЕрдкрдиреА рдореВрд▓ рд╕реНрдерд┐рддрд┐ рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЙрд╕реА рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>HexMapGenerator.GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдлрд┐рд░ рд╕реЗ рдкреБрд░рд╛рдиреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдпрд╛рдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдЗрд╕реЗ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдХрд┐рд╕реА рдФрд░ рдЪреАрдЬ рдХреЗ рд╕рд╛рде рд╣рд╕реНрддрдХреНрд╖реЗрдк рди рдХрд░реЗрдВ </font></font><code>Random</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { Random.State originalRandomState = Random.state; тАж Random.state = originalRandomState; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдЧрд▓рд╛, рд╣рдореЗрдВ рдЕрдВрддрд┐рдо рдХрд╛рд░реНрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдмреАрдЬ рдХреЛ рдЙрдкрд▓рдмреНрдз рдХрд░рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдкреВрд░реНрдгрд╛рдВрдХ рдлрд╝реАрд▓реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> seed;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/41d/3b5/538/41d3b553898698698636b6bada081aa6.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреАрдЬ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдореЗрдВ рдЖрд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмреАрдЬ рдореВрд▓реНрдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>Random</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдХрд╛рд░реНрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдмреАрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рд╕рд░рд▓ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдордирдорд╛рдирд╛ рдмреАрдЬ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ </font></font><code>Random.Range</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕реНрдерд┐рддрд┐ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рди рдХрд░реЗ, рд╣рдореЗрдВ рдЗрд╕реЗ рдмрдЪрд╛рдиреЗ рдХреЗ рдмрд╛рдж рдРрд╕рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateMap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { Random.State originalRandomState = Random.state; seed = Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue); Random.InitState(seed); тАж }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рд╣рдо рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрд╣рд╛рд▓ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЕрдЧрд░ рд╣рдо рддреБрд░рдВрдд рдПрдХ рдФрд░ рдХрд╛рд░реНрдб рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рд╣рдореЗрдВ рд╕рдорд╛рди рдмреАрдЬ рдореВрд▓реНрдп рдорд┐рд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рдирд╣реАрдВ рдЬрд╛рдирддреЗ рдХрд┐ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░рд╛рдЬреНрдп рдХреЛ рдХреИрд╕реЗ рдЖрд░рдВрдн рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдПрдХ рдордирдорд╛рдирд╛ рд╢реБрд░реБрдЖрддреА рдмрд┐рдВрджреБ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рд╣рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓ рдХреЗ рд╕рд╛рде рдЗрд╕реЗ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдФрд░ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕рдВрдЦреНрдпрд╛ рдЬрдирд░реЗрдЯрд░ рдХреЛ рдЖрд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдк рдмрд╕ рдХрдИ рдордирдорд╛рдиреА рдореВрд▓реНрдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рд╡рд┐рд╕реНрддреГрдд рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рднрд┐рдиреНрди рд╣реЛрддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рдд, рдПрдХ рд╣реА рдХрд╛рд░реНрдб рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрдо рд╣реЛрдЧреАред </font><font style="vertical-align: inherit;">рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рдордп рдХреЗ рдирд┐рдЪрд▓реЗ 32 рдмрд┐рдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЪрдХреНрд░реЛрдВ рдореЗрдВ рд╡реНрдпрдХреНрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рд╕рд╛рде рд╣реА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рд╡рд░реНрддрдорд╛рди рд░рдирдЯрд╛рдЗрдо рднреАред </font><font style="vertical-align: inherit;">рдмрд┐рдЯрд╡рд╛рдЗрдЬрд╝ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ OR рдСрдкрд░реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрди рдореВрд▓реНрдпреЛрдВ рдХреЛ рдорд┐рд▓рд╛рдПрдВ рддрд╛рдХрд┐ рдкрд░рд┐рдгрд╛рдо рдмрд╣реБрдд рдмрдбрд╝рд╛ рди рд╣реЛред</font></font><br><br><pre> <code class="cs hljs"> seed = Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue); seed ^= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)System.DateTime.Now.Ticks; seed ^= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Time.unscaledTime; Random.InitState(seed);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░рд┐рдгрд╛рдореА рд╕рдВрдЦреНрдпрд╛ рдирдХрд╛рд░рд╛рддреНрдордХ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЬреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдореВрд▓реНрдп рдХреЗ рд▓рд┐рдП рдмреАрдЬ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рдирд╣реАрдВ рд▓рдЧрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдЕрдзрд┐рдХрддрдо рдкреВрд░реНрдгрд╛рдВрдХ рдорд╛рди рдХреЗ рд╕рд╛рде рдмрд┐рдЯрд╡рд╛рдЗрдЬрд╝ рдорд╛рд╕реНрдХрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рд╕рдЦреНрддреА рд╕реЗ рд╕рдХрд╛рд░рд╛рддреНрдордХ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╕рд╛рдЗрди рдмрд┐рдЯ рдХреЛ рд░реАрд╕реЗрдЯ рдХрд░реЗрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> seed ^= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Time.unscaledTime; seed &amp;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue; Random.InitState(seed);</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреБрди: рдкреНрд░рдпреЛрдЬреНрдп рдмреАрдЬ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЕрднреА рднреА рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдХрд╛рд░реНрдб рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдм рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЙрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рд▓рд┐рдП рдмреАрдЬ рдХреЗ рдореВрд▓реНрдп рдХрд╛ рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдПрдХ рд╣реА рдирдХреНрд╢реЗ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЬрдирд░реЗрдЯрд░ рдХреЛ рдирдП рдмреАрдЬ рдмрдирд╛рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдЙрд╕реА рдмреАрдЬ рдХреЗ рдореВрд▓реНрдп рдХрд╛ рдлрд┐рд░ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдЖрджреЗрд╢ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рдмреВрд▓рд┐рдпрди рдлрд╝реАрд▓реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╕реНрд╡рд┐рдЪ рдЬреЛрдбрд╝рдХрд░ рдРрд╕рд╛ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> useFixedSeed;</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/200/4c6/eed/2004c6eed8c2244bdfe660bf477d2fa3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдирд┐рд░рдВрддрд░ рдмреАрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдкред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдПрдХ рдирд┐рд░рдВрддрд░ рдмреАрдЬ рдЪреБрдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдо рдмрд╕ рдирдП рдмреАрдЬ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рдЫреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВ </font></font><code>GenerateMap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рд╣рдо рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдмреАрдЬ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдирд╣реАрдВ рдмрджрд▓рддреЗ рд╣реИрдВ, рддреЛ рдкрд░рд┐рдгрд╛рдо рдлрд┐рд░ рд╕реЗ рд╡рд╣реА рдирдХреНрд╢рд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cs hljs"> Random.State originalRandomState = Random.state; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!useFixedSeed) { seed = Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue); seed ^= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)System.DateTime.Now.Ticks; seed ^= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Time.time; seed &amp;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue; } Random.InitState(seed);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рднрд╡рд┐рд╖реНрдп рдореЗрдВ рдЗрд╕реЗ рдлрд┐рд░ рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдкрд╕рдВрдж рдХрд┐рдП рдЧрдП рдирдХреНрд╢реЗ рдХреЗ рдмреАрдЬ рдореВрд▓реНрдп рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдХрд╣реАрдВ рди рдХрд╣реАрдВ рд╕рд╣реЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдордд рднреВрд▓реЛ рдХрд┐ рд╣рдо рдПрдХ рд╣реА рдХрд╛рд░реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗ рдпрджрд┐ рд╣рдо рдмрд┐рд▓реНрдХреБрд▓ рдПрдХ рд╣реА рдЬрдирд░реЗрдЯрд░ рдорд╛рдкрджрдВрдбреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рддреН рдПрдХ рд╣реА рдХрд╛рд░реНрдб рдХрд╛ рдЖрдХрд╛рд░, рд╕рд╛рде рд╣реА рд╕рд╛рде рдЕрдиреНрдп рд╕рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╡рд┐рдХрд▓реНрдкред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЗрди рд╕рдВрднрд╛рд╡рдирд╛рдУрдВ рдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдмрджрд▓рд╛рд╡ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд▓рдЧ рдирдХреНрд╢рд╛ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдмреАрдЬ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдореЗрдВ рд╕рднреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рдпрд╛рдж рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ff/cd2/279/7ffcd2279b4dd882db924d8e1fc61d0e.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/486/6db/156/4866db15628d75936b7e19fa4841f2f5.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреАрдЬ рдорд╛рди 0 рдФрд░ 929396788 рдХреЗ рд╕рд╛рде рдмрдбрд╝реЗ рдХрд╛рд░реНрдб, рдорд╛рдирдХ рдкреИрд░рд╛рдореАрдЯрд░ред </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unitypackage</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi427003/">https://habr.com/ru/post/hi427003/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi426991/index.html">рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдбрд╛рдЗрдЬреЗрд╕реНрдЯ: рдореЙрд╕реНрдХреЛ рдореЗрдВ 10 рдЖрдЧрд╛рдореА рдЖрдИрдЯреА рдХрд╛рд░реНрдпрдХреНрд░рдо</a></li>
<li><a href="../hi426993/index.html">рдХреНрдпрд╛ рдореБрдЭреЗ рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рд╕реА рд╕реАрдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдХрдВрдкреНрдпреВрдЯрд░ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ?</a></li>
<li><a href="../hi426995/index.html">рдкреБрдирд░реНрдЪрдХреНрд░рдг рдЙрддреНрдкрд╛рджреЛрдВ рдФрд░ рдХрд░реНрдордЪрд╛рд░рд┐рдпреЛрдВ рджреЛрдиреЛрдВ рдХреЛ рдкрд░реЗрд╢рд╛рди рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi426997/index.html">MaterialShapeDrawable рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╕реНрдЯрдо рдЖрдХрд╛рд░ рдХреИрд╕реЗ рдмрдирд╛рдПрдВ</a></li>
<li><a href="../hi426999/index.html">рд░реБрдЭрд╛рди рдХреЗ рдмрд╛рдж, рдпрд╛ RxJava рдФрд░ LiveData рдХреА рдУрд░ рдмрдврд╝ рд░рд╣рд╛ рд╣реИ</a></li>
<li><a href="../hi427005/index.html">рдПрдЖрдИ рдбреЗрд╡рд▓рдкрд░реНрд╕ - рдХрд░реЛрдбрд╝рдкрддрд┐ рдХрд╛ рдкреЗрд╢рд╛?</a></li>
<li><a href="../hi427009/index.html">рдЗрд▓реЗрдХреНрдЯреНрд░реЙрди рдХрд╛ "рдЪрд▓рдирд╛": рдЕрд╕рдВрддреГрдкреНрдд рдмрдВрдзреЛрдВ рдХреА рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдЕрдВрджрд░ рдЖрд╡реЗрд╢ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рддреЛрдбрд╝</a></li>
<li><a href="../hi427011/index.html">рдореЗрд░реА "рд╣реИрд▓реЛ рд╡рд░реНрд▓реНрдб!" FPGA рдпрд╛ UART рдХреЗ рдЕрдЧрд▓реЗ рд╕рдВрд╕реНрдХрд░рдг рдкрд░</a></li>
<li><a href="../hi427013/index.html">рдЖрдордиреЗ-рд╕рд╛рдордиреЗ NeoQUEST-2018: рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдпрд╣ рдХреИрд╕рд╛ рдерд╛</a></li>
<li><a href="../hi427015/index.html">рд╡рд╛рдгрд┐рдЬреНрдпрд┐рдХ рд╕реНрдорд╛рд░реНрдЯ рдбреЗрдЯрд╛ рдХреЗрдВрджреНрд░реЛрдВ рдХреЛ рд╕реНрдорд╛рд░реНрдЯ рдкреАрдбреАрдпреВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреНрдпреЛрдВ рд╣реИ?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>