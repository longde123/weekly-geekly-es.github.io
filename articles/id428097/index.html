<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😔 👧 👦🏻 Routing rekursif dalam MikroTik melalui gateway yang ditetapkan oleh DHCP 🐵 🦈 👩🏻‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pertanyaan yang paling sering diajukan tentang penggunaan perutean rekursif adalah: "Apa yang harus saya lakukan jika penyedia utama memberi kami alam...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Routing rekursif dalam MikroTik melalui gateway yang ditetapkan oleh DHCP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428097/">  Pertanyaan yang paling sering diajukan tentang penggunaan perutean rekursif adalah: "Apa yang harus saya lakukan jika penyedia utama memberi kami alamat IP melalui dhcp, dan apakah gateway default sering berubah?" <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mn/ft/9g/mnft9gsqxl7s_v7qpucjkgeqnvw.png" alt="gambar"></div> <a name="habracut"></a><br>  Peringatan!  bahan dan skema dalam artikel ini disederhanakan menjadi primitivisme untuk memberikan gambaran umum tentang metode penyelesaian masalah.  Tidak ada pendalaman pada khususnya. <br><br>  Untuk apa perutean rekursif?  Untuk memantau ketersediaan Internet di <b>belakang gerbang penyedia</b> .  Lagi pula, sering terjadi bahwa router penyedia merespons dengan sempurna permintaan gema, tetapi tautan penyedia [ke atas] ke jaringan global telah hilang karena suatu alasan. <br><br>  Perutean rekursif memungkinkan Anda untuk mengevaluasi ketersediaan akses Internet melalui penyedia yang dipilih dan memutuskan perutean lalu lintas. <br><br>  Namun, kenyataannya adalah bahwa penggunaan perutean rekursif mengasumsikan <s>adanya</s> indikasi eksplisit langsung dari <b>alamat IP gateway yang</b> <s>dipaku dengan paku di</s> antara parameter dari rute yang dibuat.  Menentukan nama antarmuka siaran sebagai gateway tidak benar dan dalam banyak kasus tidak berfungsi, karena  membutuhkan proxy-arp dari penyedia.  Namun, alih-alih penyedia, proxy-arp dapat menghidupkan tetangga Anda tentang sakelar penyedia dan mencoba mencegat lalu lintas Anda dengan cara ini dengan mengatur MITM klasik! <br><br>  Keajaiban routing rekursif tersembunyi di balik parameter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">"lingkup" dan "target-lingkup"</a> .  Untuk rute yang berfungsi sebagai rekursif, "target-scope" -nya harus lebih besar atau sama dengan nilai "scope" dari rute statis yang dirujuk secara rekursif, dan gateway yang ditentukan dalam rute berada di luar jangkauan langsung melalui salah satu antarmuka. <br><br>  Pertimbangkan skema Active / Backup yang paling sederhana.  Router kami melakukan NAT dan terhubung ke dua penyedia melalui antarmuka Ether1-isp1 dan Ether2-isp2.  Penyedia utama (ISP-1) mendistribusikan alamat IP ke klien melalui DHCP dan tidak ada yang lain.  Penyedia kedua memberi kami alamat IP statis, tetapi kecepatannya jauh lebih rendah. <br>  Beralih ke cadangan (ISP-2) harus terjadi ketika akses ke Internet melalui penyedia utama menjadi tidak mungkin. <br><br><img src="https://habrastorage.org/webt/sp/6x/au/sp6xauunimjxvginbtlch9ehhgs.png" alt="gambar"><br><br>  Sorotan penyedia untuk skema semacam itu adalah perubahan sewenang-wenang berkala bukan hanya alamat IP klien, tetapi juga gateway default. <br><br>  Sebelum versi 6.39, saya harus melihat kruk yang sangat canggih dalam berbagai kombinasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sheduler</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">netwatch,</a> dan mekanisme serupa. <br><br>  Dimulai dengan versi 6.39, pengembang RouterOS pergi menemui pengguna tersebut dan menciptakan kemampuan untuk memanggil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">skrip</a> khusus ketika klien dhcp dipicu pada perangkat. <br><br>  Sebenarnya, solusinya terdiri dari dua bagian: <br><br><ol><li>  perlu mendapatkan protokol dhcp dari alamat IP penyedia dan alamat gateway untuk digunakan dalam rute rekursif </li><li>  jika memungkinkan, kecualikan alamat gateway yang diterima dari penyedia dari penggunaan otomatis. </li></ol><br>  Jadi, mari kita mulai dari akhir. <br><br>  Kami akan membuat rute cadangan melalui ISP-2 dengan nilai jarak lebih besar dari yang utama di masa depan.  Dalam contoh ini, saya menggunakan "distance = 2": <br><br><div class="spoiler">  <b class="spoiler_title">Cadangkan melalui ISP-2</b> <div class="spoiler_text"><code>/ip route add dst-address=0.0.0.0/0 gateway=192.0.2.1 distance=2</code> <br> </div></div><br>  Selanjutnya, untuk menerima rute default dari penyedia ISP-1, tetapi tidak untuk menggunakannya secara langsung, ada nilai khusus “distance = 255”.  Rute dengan nilai jarak ini akan menuju ke tabel perutean sistem, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tetapi tidak akan pernah menjadi aktif</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Kode</b> <div class="spoiler_text"> <code>/ip dhcp-client add comment="ISP-1 dhcp" default-route-distance=255 dhcp-options=hostname,clientid interface=Ether1-isp1</code> <br> </div></div><br>  Kami membutuhkan rute semacam itu hanya untuk membaca parameter yang dikirim oleh penyedia dan mengimplementasikannya dalam pengaturan rute rekursif melalui skrip. <br><br>  Dari parameter yang diterima, kami paling tertarik pada variabel $ gateway-address.  Seperti namanya, ini berisi alamat gateway default di jaringan penyedia.  Kami akan menggunakannya untuk memperbarui rute rekursif. <br>  Rute rekursif sendiri harus dikenali dengan benar dari skrip.  Untuk melakukan ini, pada tahap penciptaan mereka, kami akan menunjukkan "komentar" yang unik, yang akan digunakan untuk menemukan mereka di dalam tabel.  Kode untuk membuat pasangan rute rekursif: <br><br><div class="spoiler">  <b class="spoiler_title">Buat sepasang rute</b> <div class="spoiler_text"> <code>/ip route add dst-address=8.8.4.4 gateway=127.0.0.1 scope=30 target-scope=30 comment=" <b>isp1route</b> " disabled=yes <br> /ip route add dst-address=0.0.0.0/0 gateway=8.8.4.4 check-gateway=ping</code> <br> </div></div><br>  Baris pertama harus (dan akan!) Menunjuk ke gateway nyata di jaringan penyedia hanya setelah penyedia mengeluarkan parameter melalui dhcp dan mereka akan diproses menggunakan skrip dhcp-client: <br><br><div class="spoiler">  <b class="spoiler_title">Script yang disederhanakan</b> <div class="spoiler_text"> <code>/ip route set [find comment=" <b>isp1route</b> "] gateway=($"gateway-address") disabled=no</code> <br> </div></div><br><div class="spoiler">  <b class="spoiler_title">Opsi lebih lanjut</b> <div class="spoiler_text"> <code>:if ($bound=1) do={ /ip route set [find comment=" <b>isp1route</b> "] gateway=($"gateway-address")disabled=no; :log warning ("New ISP1 gateway: ".($"gateway-address")) }</code> <br> </div></div><br>  Sekarang, setelah menerima alamat IP dari penyedia ISP-1 untuk digunakan sebagai gateway default, itu akan dimasukkan dalam pasangan rute <u>bukannya 127.0.0.1.</u> <br>  Baris kedua, di mana rute menuju 0.0.0.0/0 ditunjukkan, sebenarnya melakukan semua keajaiban.  Node 8.8.4.4 yang ditentukan di sana sebagai gateway akan diperiksa untuk respons dengan opsi “check-gateway = ping” tepatnya melalui jaringan ISP-1.  Jika node 8.8.4.4 tidak merespons dua kali permintaan gema dalam waktu 20 detik, router akan mempertimbangkan koneksi ke Internet melalui rute ini (ISP-1) tidak tersedia.  Dalam hal ini, koneksi baru akan dialihkan melalui penyedia cadangan ISP-2. <br><br>  Jika semuanya dilakukan dengan benar, maka di jendela rute winbox / ip-&gt; dekat rute hingga 8.8.4.4 kata-kata “resursive via ...” akan terlihat.  Ini berarti rute dibangun persis seperti rekursif. <br><br>  Pada akhirnya, misalnya saja - winbox layar jendela: <br><br> <a href=""><img src="https://habrastorage.org/webt/cs/qp/yg/csqpygzqinf53ae-ivjaac15pk8.png" alt="gambar"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id428097/">https://habr.com/ru/post/id428097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id428085/index.html">Frontend menyerang kembali: top 10 (?) HolyJS 2018 Piter melaporkan</a></li>
<li><a href="../id428087/index.html">“Bebas kunci, atau tidak bebas kunci, itulah pertanyaannya” atau “Tidur sehat lebih buruk daripada lobak pahit”</a></li>
<li><a href="../id428089/index.html">"Kalender Tester" untuk Oktober. Umpan balik: bagaimana itu terjadi</a></li>
<li><a href="../id428091/index.html">Bagaimana siswa magang menciptakan video game paling populer di dunia, atau sejarah game Windows</a></li>
<li><a href="../id428095/index.html">Riset pasar untuk studio web dan agensi digital</a></li>
<li><a href="../id428099/index.html">Apa kesamaan dari gaun biasa dan era 5G yang akan datang?</a></li>
<li><a href="../id428101/index.html">Cara mengotomatisasi dengan bangunan Jenkins dan menggulirkan artefak model artadak metadata untuk tabel dalam repositori</a></li>
<li><a href="../id428103/index.html">Mitap di St. Petersburg: Teknik Data dan banyak lagi</a></li>
<li><a href="../id428105/index.html">Blogger merekomendasikan: memengaruhi pemasaran</a></li>
<li><a href="../id428107/index.html">Kontainerisasi aplikasi Angular 6 SPA Template ASP .NET Core 2.1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>