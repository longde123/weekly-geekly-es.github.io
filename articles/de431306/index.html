<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔐 🐤 😊 So erstellen Sie eine Pyramide im Trunk oder in testgesteuerten Entwicklungsanwendungen auf Spring Boot 🎴 📏 😴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Spring Framework wird häufig als Beispiel für das Cloud Native Framework angeführt, das für die Arbeit in der Cloud, die Entwicklung von Zwölf-Fak...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So erstellen Sie eine Pyramide im Trunk oder in testgesteuerten Entwicklungsanwendungen auf Spring Boot</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431306/"><p> <em>Das Spring Framework wird</em> häufig als Beispiel für das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cloud Native</a> Framework angeführt, das für die Arbeit in der Cloud, die Entwicklung von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zwölf-Faktor-Anwendungen</a> , Microservices und eines der stabilsten, aber gleichzeitig innovativsten Produkte entwickelt wurde.  Aber in diesem Artikel möchte ich auf eine weitere starke Seite des Frühlings eingehen: Es ist seine <em>Entwicklungsunterstützung durch Testen</em> (TDD-Fähigkeit?).  Trotz TDD-Konnektivität habe ich oft bemerkt, dass Spring-Projekte entweder einige bewährte Methoden zum Testen ignorieren, ihre eigenen Motorräder erfinden oder überhaupt keine Tests schreiben, weil sie "langsam" oder "unzuverlässig" sind.  Und ich werde Ihnen genau sagen, wie Sie <strong>schnelle</strong> und <strong>zuverlässige</strong> Tests für Anwendungen auf dem Spring Framework schreiben und die Entwicklung durch Testen durchführen.  Wenn Sie also Spring verwenden (oder starten möchten), verstehen, was Tests im Allgemeinen sind (oder verstehen möchten) oder denken, dass <code>contextLoads</code> die notwendige und ausreichende Stufe für Integrationstests ist - das wird interessant sein! </p><a name="habracut"></a><br><p>  Die "TDD" -Funktion ist sehr vieldeutig und schlecht messbar. Dennoch hat Spring viele Dinge, die von Natur aus dazu beitragen, Integrations- und Komponententests mit minimalem Aufwand zu schreiben.  Zum Beispiel: </p><br><ul><li>  Integrationstests - Sie können die Anwendung einfach starten, Komponenten sperren, Parameter neu definieren usw. </li><li>  Fokusintegrationstests - nur Zugriff auf Daten, nur Web usw. </li><li>  Sofort einsatzbereite Unterstützung - speicherinterne Datenbanken, Nachrichtenwarteschlangen, Authentifizierung und Autorisierung in Tests </li><li>  Testen durch Verträge (Spring Cloud Contract) </li><li>  Unterstützung für das Testen der Web-Benutzeroberfläche mit HtmlUnit </li><li>  Flexibilität der Anwendungskonfiguration - Profile, Testkonfigurationen, Komponenten usw. </li><li>  Und vieles mehr </li></ul><br><p>  Zunächst eine kleine, aber notwendige Einführung in TDD und das Testen im Allgemeinen. </p><br><h1 id="test-driven-development">  Testgetriebene Entwicklung </h1><br><p>  TDD basiert auf einer sehr einfachen Idee: Wir schreiben Tests, <strong>bevor</strong> wir Code schreiben.  Theoretisch klingt es beängstigend, aber nach einiger Zeit kommt ein Verständnis für Praktiken und Techniken, und die Möglichkeit, Tests <em>danach</em> zu schreiben, verursacht spürbare Beschwerden.  Eine der Schlüsselpraktiken ist die <em>Iteration</em> , d.h.  Machen Sie alles zu kleinen, fokussierten Iterationen, von denen jede als <strong>Rot-Grün-Refaktor bezeichnet wird</strong> . </p><br><p>  In der <strong>roten</strong> Phase schreiben wir einen Falltest, und es ist sehr wichtig, dass er mit einem klaren, verständlichen Grund und einer klaren Beschreibung fällt und dass der Test selbst vollständig ist und bestanden wird, wenn der Code geschrieben wird.  Der Test sollte das <em>Verhalten</em> überprüfen, nicht die <em>Implementierung</em> , d. H.  Folgen Sie dem Black-Box-Ansatz, dann werde ich erklären, warum. </p><br><p>  In der <strong>grünen</strong> Phase schreiben wir den <em>minimal erforderlichen Code</em> , um den Test zu bestehen.  Manchmal ist es interessant zu üben und es so verrückt wie möglich zu machen (obwohl es besser ist, sich nicht mitreißen zu lassen), und wenn eine Funktion je nach Zustand des Systems einen Booleschen Wert zurückgibt, kann der erste "Durchgang" einfach <code>return true</code> . </p><br><p>  In der <strong>Refactoring-</strong> Phase, die <em>nur</em> gestartet werden kann, <em>wenn alle Tests grün sind</em> , werden wir den Code refactorisieren und in den richtigen Zustand bringen.  Es ist nicht einmal für einen Code erforderlich, den wir geschrieben haben. Daher ist es wichtig, mit dem Refactoring auf einem stabilen System zu beginnen.  Der „Black Box“ -Ansatz hilft nur beim Refactoring, beim Ändern der Implementierung, aber nicht beim Berühren des Verhaltens. </p><br><p>  Ich werde in Zukunft über verschiedene Aspekte von TDD sprechen, schließlich ist dies die Idee einer Reihe von Artikeln, daher werde ich mich jetzt nicht besonders mit den Details befassen.  Bevor ich jedoch auf Standard-TDD-Kritik reagiere, werde ich einige Mythen erwähnen, die ich oft höre. </p><br><ul><li>  <em>"TDD deckt den Code zu 100% ab, gibt jedoch keine Garantie"</em> - die Entwicklung durch Tests hat überhaupt keinen Bezug zur 100% igen Abdeckung.  In vielen Teams, in denen ich gearbeitet habe, wurde diese Metrik nicht einmal gemessen und als Eitelkeitsmetrik klassifiziert.  Und ja, 100% Testabdeckung bedeutet nichts. </li><li>  <em>"TDD funktioniert nur für einfache Funktionen, eine echte Anwendung mit einer Datenbank und ein schwieriger Zustand kann damit nicht erstellt werden"</em> ist eine sehr beliebte Ausrede, die normalerweise ergänzt wird durch "Wir haben eine so komplizierte Anwendung, dass wir überhaupt keine Tests schreiben, Sie können es überhaupt nicht tun."  Ich sah einen funktionierenden TDD-Ansatz für völlig unterschiedliche Anwendungen - Web (mit und ohne SPA), Mobile, API, Microservices, Monolithen, komplexe Bankensysteme, Cloud-Plattformen, Frameworks, Einzelhandelsplattformen, die in verschiedenen Sprachen und Technologien geschrieben wurden.  Der populäre Mythos „Wir sind einzigartig, alles ist anders“ ist meistens eine Ausrede, keinen Aufwand und kein Geld in Tests zu investieren, aber kein wirklicher Grund (obwohl es auch echte Gründe geben kann). </li><li>  <em>"Es wird immer noch Fehler mit TDD geben"</em> - natürlich wie bei jeder anderen Software.  Bei TDD geht es nicht um Fehler oder deren Abwesenheit, sondern um ein Entwicklungswerkzeug.  Wie das Debuggen.  Wie eine IDE.  Wie die Dokumentation.  Keines dieser Tools garantiert das Fehlen von Fehlern, sondern hilft nur, die zunehmende Komplexität des Systems zu bewältigen. </li></ul><br><blockquote>  Das Hauptziel von TDD und allgemeinen Tests besteht darin, dem Team das <strong>Vertrauen</strong> zu geben <strong>,</strong> dass das System stabil funktioniert.  Daher bestimmt keine der Testpraktiken, wie viele und welche Tests geschrieben werden sollen.  Schreiben Sie, wie viel Sie für notwendig halten, wie viel Sie benötigen, um sicherzugehen, dass der Code jetzt <em>in Produktion gehen kann und funktioniert</em> .  Es gibt Leute, die schnelle Integrationstests als eine ultimative Black Box betrachten, die notwendig und ausreichend ist, und Unit-Tests optional.  Jemand sagt, dass e2e-Tests mit der Möglichkeit eines schnellen Rollbacks auf die vorherige Version und dem Vorhandensein kanarischer Versionen nicht so kritisch sind.  Wie viele Teams - so viele Ansätze, es ist wichtig, eigene zu finden. </blockquote><p>  Eines meiner Ziele ist es, mich vom Format <em>„Entwicklung durch Testen einer Funktion, die zwei Zahlen hinzufügt“</em> in der TDD-Story zu entfernen und eine reale Anwendung zu betrachten, eine Art Testpraxis, die auf eine minimale Anwendung reduziert wurde und in realen Projekten gesammelt wurde.  Als solches semi-reales Beispiel werde ich eine kleine Webanwendung verwenden, die ich selbst für abstrakt erfunden habe <del>  Fabriken </del>  Bäckerei - <strong>Kuchenfabrik</strong> .  Ich habe vor, kleine Artikel zu schreiben, die sich jedes Mal auf eine separate Anwendungsfunktionalität konzentrieren und durch TDD zeigen, dass Sie APIs und die interne Struktur der Anwendung entwerfen und ein konstantes Refactoring beibehalten können. </p><br><p>  Ein Beispielplan für eine Reihe von Artikeln, wie ich ihn derzeit sehe, lautet: </p><br><ol><li>  Laufskelett - Anwendungsframework, in dem Sie den Rot-Grün-Refaktor-Zyklus ausführen können </li><li>  UI-Tests und verhaltensgesteuertes Design </li><li>  Datenzugriffstests (Federdaten) </li><li>  Autorisierungs- und Authentifizierungstests (Spring Security) </li><li>  Jet Stack (WebFlux + Projektreaktor) </li><li>  Interoperabilität von (Mikro-) Diensten und Verträgen (Spring Cloud) </li><li>  Testen der Nachrichtenwarteschlange (Spring Cloud) </li></ol><br><p>  In diesem Einführungsartikel geht es um die Punkte 1 und 2 - Ich werde ein Anwendungsframework und einen grundlegenden UI-Test unter Verwendung des BDD- oder <strong>verhaltensgesteuerten Entwicklungsansatzes</strong> erstellen.  Jeder Artikel beginnt mit einer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">User Story</a> , aber ich werde nicht über den Teil „Produkt“ sprechen, um Zeit zu sparen.  Die User Story wird in englischer Sprache verfasst, es wird bald klar, warum.  Alle Codebeispiele finden Sie auf GitHub, daher werde ich nicht den gesamten Code analysieren, sondern nur die wichtigen Teile. </p><br><blockquote>  User Story ist eine Beschreibung einer Funktion einer Anwendung in natürlicher Sprache, die normalerweise im Auftrag eines Benutzers des Systems geschrieben wird. </blockquote><br><h1 id="user-story-1-polzovatel-vidit-stranicu-privetstviya">  User Story 1: Benutzer sieht Begrüßungsseite </h1><br><blockquote>  <strong>Als</strong> Alice ein neuer Benutzer <br>  <strong>Ich möchte</strong> eine Begrüßungsseite sehen, wenn <strong>ich die</strong> Cake Factory-Website besuche <br>  <strong>Damit</strong> ich weiß, wann Cake Factory startet <br><br>  Akzeptanzkriterien: <br>  Szenario: Ein Benutzer, der die Website besucht, besucht sie vor dem Startdatum <br>  Vorausgesetzt, ich bin ein neuer Benutzer <br>  Wenn ich die Cake Factory-Website besuche <br>  Dann sehe ich eine Nachricht 'Danke für Ihr Interesse' <br>  Und ich sehe eine Nachricht 'Die Website kommt bald ...' </blockquote><p>  Es wird Wissen erfordern: Was ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">verhaltensgesteuerte Entwicklung</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gurke</a> , die Grundlagen des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Spring Boot-Testens</a> . </p><br><p>  Die erste User Story ist recht einfach, aber das Ziel liegt noch nicht in der Komplexität, sondern in der Erstellung eines Laufskeletts - eine minimale Anwendung zum Starten des <strong>TDD-Zyklus</strong> . </p><br><p>  Nachdem ich ein neues Projekt auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Spring Initializr</a> mit Web- und Moustache-Modulen erstellt habe, benötige ich zunächst einige weitere Änderungen an <code>build.gradle</code> : </p><br><ul><li>  Fügen Sie <code>testImplementation('net.sourceforge.htmlunit:htmlunit')</code> testImplementation <code>testImplementation('net.sourceforge.htmlunit:htmlunit')</code> .  Sie müssen die Version nicht angeben. Das Spring Boot-Abhängigkeitsverwaltungs-Plugin für Gradle wählt automatisch die erforderliche und kompatible Version aus </li><li>  ein Projekt von JUnit 4 auf JUnit 5 migrieren (da 2018 auf dem Hof ​​liegt) </li><li>  Fügen Sie Cucumber Abhängigkeiten hinzu - eine Bibliothek, mit der ich BDD-Spezifikationen schreiben werde </li><li>  Entfernen Sie standardmäßig erstellte <code>CakeFactoryApplicationTests</code> mit unvermeidlichen <code>contextLoads</code> </li></ul><br><p>  Im Großen und Ganzen ist dies das grundlegende "Grundgerüst" der Anwendung, Sie können bereits den ersten Test schreiben. </p><br><p>  Um die Navigation im Code zu vereinfachen, werde ich kurz auf die verwendeten Technologien eingehen. </p><br><h2 id="cucumber">  Gurke </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cucumber</a> ist ein <strong>verhaltensgesteuertes Entwicklungsframework</strong> , mit dessen Hilfe "ausführbare Spezifikationen" erstellt werden können, d. H.  Führen Sie Tests (Spezifikationen) in natürlicher Sprache durch.  Das Cucumber-Plugin analysiert den Quellcode in Java (und vielen anderen Sprachen) und verwendet <em>Schrittdefinitionen</em> , um echten Code auszuführen.  <code>@Given</code> sind <code>@When</code> , die mit <code>@Given</code> , <code>@When</code> , <code>@Then</code> und anderen Annotationen versehen sind. </p><br><h2 id="htmlunit">  Htmlunit </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die</a> Projekthomepage nennt HtmlUnit "einen GUI-freien Browser für Java-Anwendungen".  Im Gegensatz zu Selenium startet HtmlUnit keinen echten Browser und rendert die Seite vor allem überhaupt nicht, da es direkt mit dem DOM arbeitet.  JavaScript wird von der Mozilla Rhino Engine unterstützt.  HtmlUnit eignet sich gut für klassische Anwendungen, ist jedoch für Single Page Apps nicht sehr geeignet.  Zunächst wird es ausreichen, und dann werde ich versuchen zu zeigen, dass auch solche Dinge wie ein Testframework Teil der Implementierung und nicht die Grundlage der Anwendung sein können. </p><br><h1 id="pervyy-test">  Erster Test </h1><br><p>  Jetzt wird mir eine auf Englisch geschriebene User Story nützlich sein.  Der beste Auslöser für den Start der nächsten TDD-Iteration sind Akzeptanzkriterien, die so geschrieben sind, dass sie mit einem Minimum an Gesten in eine ausführbare Spezifikation umgewandelt werden können. </p><br><blockquote>  Im Idealfall sollten User Stories so geschrieben werden, dass sie einfach in die BDD-Spezifikation kopiert und ausgeführt werden können.  Dies ist alles andere als immer einfach und nicht immer möglich, aber dies sollte das Ziel des Produktbesitzers und des gesamten Teams sein, wenn auch nicht immer erreichbar. </blockquote><p>  Also mein erstes Feature. </p><br><pre> <code class="plaintext hljs">Feature: Welcome page Scenario: a user visiting the web-site visit before the launch date Given a new user, Alice When she visits Cake Factory web-site Then she sees a message 'Thank you for your interest' And she sees a message 'The web-site is coming in December!'</code> </pre> <br><p>  Wenn Sie Schrittbeschreibungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erstellen</a> (das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Intellij IDEA-Plugin</a> unterstützt Gherkin sehr) und den Test ausführen, ist er natürlich grün - es wird noch nichts getestet.  Und hier kommt die wichtige Phase der Arbeit am Test - <em>Sie müssen einen Test schreiben, als ob der Hauptcode geschrieben worden wäre</em> . </p><br><p>  Für diejenigen, die anfangen, TDD zu verbannen, setzt hier oft eine Betäubung ein - es ist schwierig, die Algorithmen und die Logik von etwas, das nicht existiert, in den Kopf zu bekommen.  Daher ist es sehr wichtig, möglichst <em>kleine und fokussierte Iterationen</em> zu haben, angefangen von der User Story bis hin zur Integrations- und Einheitenebene.  Es ist wichtig, sich <strong>auf jeweils einen Test zu konzentrieren</strong> und zu versuchen, nass zu werden und Abhängigkeiten zu ignorieren, die noch nicht wichtig sind.  Manchmal ist mir aufgefallen, wie leicht Leute beiseite gehen - eine Schnittstelle oder Klasse für eine Abhängigkeit erstellen, sofort eine leere Testklasse dafür generieren, dort eine weitere Abhängigkeit hinzufügen, eine weitere Schnittstelle erstellen und so weiter. </p><br><blockquote>  Wenn die Geschichte lautet "Es wäre notwendig, den Status beim Speichern zu aktualisieren", ist es sehr schwierig, sie zu automatisieren und zu formalisieren.  In meinem Beispiel kann jeder Schritt in einer Abfolge von Schritten klar angeordnet werden, die durch Code beschrieben werden können.  Es ist klar, dass dies das einfachste Beispiel ist und nicht viel zeigt, aber ich hoffe, dass es mit zunehmender Komplexität interessanter wird. </blockquote><br><h2 id="red">  Rot </h2><br><p>  Daher habe ich für mein erstes Feature die folgenden Schrittbeschreibungen erstellt: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span>(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WelcomePage</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> WebClient webClient; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HtmlPage page; <span class="hljs-meta"><span class="hljs-meta">@LocalServerPort</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> port; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String baseUrl; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ webClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient(); baseUrl = <span class="hljs-string"><span class="hljs-string">"http://localhost:"</span></span> + port; } <span class="hljs-meta"><span class="hljs-meta">@Given</span></span>(<span class="hljs-string"><span class="hljs-string">"a new user, Alice"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aNewUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// nothing here, every user is new by default } @When("she visits Cake Factory web-site") public void sheVisitsCakeFactoryWebSite() throws IOException { page = webClient.getPage(baseUrl); } @Then("she sees a message {string}") public void sheSeesAMessageThanksForYourInterest(String expectedMessage) { assertThat(page.getBody().asText()).contains(expectedMessage); } }</span></span></code> </pre> <br><p>  Einige Punkte, die Sie beachten sollten: </p><br><ul><li>  Features werden von einer anderen Datei, <code>Features.java</code> mit <code>RunWith</code> Annotation von JUnit 4 gestartet. Cucumber unterstützt leider keine Version 5 </li><li>  <code>@SpringBootTest</code> Annotation <code>@SpringBootTest</code> wird zur Beschreibung der Schritte hinzugefügt, <code>cucumber-spring</code> nimmt sie von dort auf und konfiguriert den <code>@SpringBootTest</code> (d. H. Startet die Anwendung). </li><li>  Die Spring-Anwendung für den Test beginnt mit <code>webEnvironment = RANDOM_PORT</code> und dieser zufällige Port wird mit <code>@LocalServerPort</code> an den Test <code>@LocalServerPort</code> . Spring findet diese Anmerkung und setzt den <code>@LocalServerPort</code> auf den Server-Port </li></ul><br><p>  Und der Test stürzt erwartungsgemäß mit dem Fehler <code>404 for http://localhost:51517</code> . </p><br><blockquote>  Die Fehler, mit denen der Test abstürzt, sind unglaublich wichtig, insbesondere bei Unit- oder Integrationstests. Diese Fehler sind Teil der API.  Wenn der Test mit einer <code>NullPointerException</code> dies nicht allzu gut, aber die <code>BaseUrl configuration property is not set</code> - viel besser. </blockquote><br><h2 id="green">  Grün </h2><br><p>  Um den Test grün zu machen, habe ich einen Basis-Controller und eine Ansicht mit minimalem HTML-Code hinzugefügt: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IndexController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"index"</span></span>; } }</code> </pre> <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Cake Factory<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Thank you for your interest<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>The web-site is coming in December!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Der Test ist grün, die Anwendung funktioniert, obwohl er in der Tradition des strengen Konstruktionsdesigns hergestellt wird. </p><br><blockquote>  Bei einem echten Projekt und in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ausgeglichenen Team</a> würde ich mich natürlich mit dem Designer zusammensetzen und wir würden das bloße HTML in etwas viel Schöneres verwandeln.  Aber im Rahmen des Artikels wird kein Wunder geschehen, die Prinzessin wird ein Frosch bleiben. </blockquote><p>  Die Frage „Was für ein Teil von TDD ist Design?“ Ist nicht so einfach.  Eine der Methoden, die ich als nützlich empfunden habe, besteht darin, zunächst gar nicht auf die Benutzeroberfläche zu schauen (nicht einmal die Anwendung auszuführen, um Ihre Nerven zu schonen), einen Test zu schreiben, ihn grün zu machen - und dann mit einer stabilen Grundlage am Front-End zu arbeiten und die Tests ständig neu zu starten . </p><br><h2 id="refactor">  Refactor </h2><br><p>  In der ersten Iteration gibt es kein bestimmtes Refactoring, aber obwohl ich die letzten 10 Minuten damit verbracht habe, eine Vorlage für <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bulma auszuwählen</a> , die als Refactoring gezählt werden kann! </p><br><h1 id="v-zaklyuchenie">  Abschließend </h1><br><p>  Während die Anwendung weder über Sicherheitsarbeit noch über eine Datenbank oder eine API verfügt, sehen Tests und TDDs recht einfach aus.  Und im Allgemeinen habe ich von der Testpyramide nur die Spitze berührt, den UI-Test.  Aber zum Teil besteht das Geheimnis des Lean-Ansatzes darin, alles in kleinen Iterationen zu erledigen, eine Komponente nach der anderen.  Dies hilft, sich auf die Tests zu konzentrieren, sie zu vereinfachen und die Qualität des Codes zu kontrollieren.  Ich hoffe, dass es in den folgenden Artikeln interessanter wird. </p><br><h1 id="ssylki">  Referenzen </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub-</a> Projekt </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Concourse ci</a> </li></ul><br><p>  <em>PS Der Titel des Artikels ist nicht so verrückt, wie es am Anfang scheinen mag, ich denke, viele haben es bereits erraten.</em>  <em>"Wie man eine Pyramide in den Kofferraum baut" bezieht sich auf die Testpyramide (dazu später mehr) und Spring Boot, wobei "Boot" im britischen Englisch auch "Kofferraum" bedeutet.</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de431306/">https://habr.com/ru/post/de431306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de431296/index.html">Emotionale Rollen in Spielen. Kompetente Erzählung und Beteiligung am Fluss</a></li>
<li><a href="../de431298/index.html">Echte Eindeutigkeitsvalidierung</a></li>
<li><a href="../de431300/index.html">Drei Jahre Zertifizierung ohne Führer - normaler Flug</a></li>
<li><a href="../de431302/index.html">Aus dem Müll eine einfache Sonarantenne machen</a></li>
<li><a href="../de431304/index.html">Auf der Suche nach vielversprechenden Schatten für Roguelike</a></li>
<li><a href="../de431308/index.html">Innotrans 2018: Welche Art von Schienenverkehr wird morgen sein?</a></li>
<li><a href="../de431310/index.html">Konfigurieren Sie Firefox / Chrome für sehr langsames und begrenztes Internet</a></li>
<li><a href="../de431312/index.html">DeezLoader + PlexMediaServer. Ein Home-Musikportal erstellen</a></li>
<li><a href="../de431316/index.html">Abstimmung über die zweite Beta des überarbeiteten 7-Berichts zum algorithmischen Sprachschema (große Sprache)</a></li>
<li><a href="../de431318/index.html">Python-Transpilerkette → 11l → C ++ [um Python-Code und mehr zu beschleunigen]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>