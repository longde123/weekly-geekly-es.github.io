<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌽 🐝 👳🏿 Pergi Fakedb Emulasi basis data dalam pengujian 😈 🌍 👨🏿‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suatu hari saya menulis tes untuk modul yang berinteraksi dengan database. Saya tidak ingin menautkan modul tes ke database ini - ini menciptakan pers...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pergi Fakedb Emulasi basis data dalam pengujian</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485280/"><p> Suatu hari saya menulis tes untuk modul yang berinteraksi dengan database.  Saya tidak ingin menautkan modul tes ke database ini - ini menciptakan persyaratan tambahan untuk lingkungan tempat pengujian akan dilakukan.  Saya tidak ingin membuat instance dari sql. Tipe baris dengan pelat yang diperlukan sekaligus - bagi saya tipe ini adalah "kotak hitam", dan saya ingin tetap seperti itu.  Cari di topik juga tidak menemukan sesuatu yang menarik. </p><br><p>  Saya ingin berbagi temuan saya dengan komunitas: dalam distribusi Go utama, ada alat yang hampir siap untuk kebutuhan seperti itu: disebut FakeDb. </p><a name="habracut"></a><br><h3 id="chto-umeet-dannyy-instrument">  Apa yang bisa dilakukan alat ini? </h3><br><p>  Pada dasarnya, ini adalah basis data yang paling sederhana, tetapi berfungsi penuh sebagai objek DB, dapat membuat tabel, mengisi mereka, dan membuat sampel sederhana dari mereka.  Semua tabel yang dibuat bersifat sementara dan ada selama instance FakeDb ada.  Selain itu, menunda emulasi saat menjalankan perintah dan pengecualian emulasi tersedia. </p><br><h3 id="komandy-fakedb">  Perintah FakeDb </h3><br><p>  Perintah terdiri dari frasa yang dipisahkan oleh bilah vertikal - |.  Frasa adalah kata kunci atau ekspresi dari bentuk "key = value".  Di mana kuncinya adalah nama kolom. </p><br><p> Usap <br>  Perintah menghancurkan tabel dan mengembalikan hasil kosong.  Selain itu, ini adalah pemeriksaan bahwa tidak ada jalan buntu. <br>  Contoh panggilan: <br> <code>WIPE</code> </p> <br><p>  BUAT <br>  Perintah membuat tabel dengan kolom yang ditentukan dari jenis yang ditentukan. </p><br><p>  Format panggilan: </p><br><p> <code>CREATE|_|1=,...,N=</code> </p> <br><p>  Jenis yang didukung: </p><br><ul><li>  bool </li><li>  nullbool - boolean atau null </li><li>  int32 </li><li>  tali </li><li>  nullstring - string atau NULL </li><li>  int64 </li><li>  nullint64 - int64 atau NULL </li><li>  float64 </li><li>  nullfloat64 - float64 atau NULL </li><li>  datetime </li><li>  antarmuka kosong, mis. jenis apa pun </li></ul><br><p>  Contoh panggilan: </p><br><p> <code>CREATE|people|name=string,age=int32,photo=any,dead=bool,bdate=datetime</code> </p> <br><p>  MASUK <br>  Perintah menambahkan baris ke tabel yang dibuat. </p><br><p>  Format panggilan: <br> <code>INSERT|_|1=,...,N</code> <br>  Selanjutnya, nilainya dapat diatur dalam tiga cara: </p><br><ol><li>  Tetapkan nilai secara eksplisit, misalnya <code>123</code> . </li><li>  Tunjukkan "?", Dan berikan nilai sebagai parameter. </li><li>  Tentukan "? Parameter_name" dan berikan nilainya ke parameter yang dinamai. </li></ol><br><p>  Contoh panggilan: </p><br><p> <code>INSERT|people|name=Alice,age=?,photo=?photo</code> </p> <br><p>  PILIH <br>  Perintah ini memungkinkan Anda untuk memilih semua baris tabel, atau dengan beberapa pilihan. <br>  Format panggilan: </p><br><pre> <code class="plaintext hljs">SELECT|_|1,...,N| SELECT|_|1,...,N|1=?,...,M</code> </pre> <br><p>  Contoh panggilan: </p><br><pre> <code class="plaintext hljs">SELECT|categories|category_id,category_parent_id,category_name| SELECT|categories|category_id,category_parent_id,category_name|category_parent_id=?parent</code> </pre> <br><p>  Hasilnya adalah turunan penuh sql.Rows. </p><br><p>  TUNGGU <br>  Mensimulasikan penundaan dalam eksekusi suatu perintah.  Harus ditambahkan sebelum perintah di atas. <br>  Format panggilan: <br> <code>WAIT||</code> </p> <br><p>  Penundaan ditunjukkan sebagai kuantitas dan postfix yang menunjukkan satuan pengukuran: s - detik, n - nanodetik, u - mikrodetik, h - jam, dan sebagainya (fungsi time.ParseDuration () digunakan). </p><br><p>  Contoh panggilan: <br> <code>WAIT|1s|SELECT|categories|category_id,category_parent_id,category_name|</code> </p> <br><p>  Panik <br>  Melempar pengecualian saat menjalankan perintah. <br>  Format panggilan: <br> <code>PANIC|_|</code> </p> <br><p>  Nilai MethodName akan ditempatkan di bidang <code>stmt.panic</code> (ketik fakeStmt). </p><br><p>  Contoh panggilan: <br> <code>PANIC|blablabla|SELECT|categories|category_id,category_parent_id,category_name|</code> </p> <br><h3 id="ispolzovanie">  Gunakan </h3><br><p>  FakeDb dibuat untuk menguji paket "sql" dari pengiriman utama <a href="" rel="nofollow">sebagai skrip pengujian</a> .  Saya tidak menemukannya dalam paket terpisah.  Oleh karena itu, saya memilihnya sendiri dalam sebuah paket dan meletakkannya di sini: <a href="https://github.com/a1div0/fakedb" rel="nofollow">gihub</a> . </p><br><p>  Diperlukan suntingan kecil untuk menyoroti paket. </p><br><h3 id="primer-ispolzovaniya">  Contoh penggunaan </h3><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> packname <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"testing"</span></span> <span class="hljs-string"><span class="hljs-string">"io/ioutil"</span></span> <span class="hljs-string"><span class="hljs-string">"database/sql"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/a1div0/fakedb"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestFoo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *testing.T)</span></span></span></span> { fc := &amp;fakedb.FakeConnector{ } db := sql.OpenDB(fc) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> db.Driver() != fakedb.Fdriver { t.Error(<span class="hljs-string"><span class="hljs-string">"OpenDB should return the driver of the Connector"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> _, err := db.Exec(<span class="hljs-string"><span class="hljs-string">"WIPE"</span></span>); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { t.Error(<span class="hljs-string"><span class="hljs-string">"exec wipe: %v"</span></span>, err) } <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> db.Close() db.Exec(<span class="hljs-string"><span class="hljs-string">"CREATE|users|user_email=string,user_id=int64"</span></span>) db.Exec(<span class="hljs-string"><span class="hljs-string">"INSERT|users|user_email=?,user_id=?"</span></span>, <span class="hljs-string"><span class="hljs-string">"test@email.com"</span></span>, <span class="hljs-number"><span class="hljs-number">345</span></span>) rows, err := db.Query( <span class="hljs-string"><span class="hljs-string">"SELECT|users|user_id|user_email=?email"</span></span>, sql.Named(<span class="hljs-string"><span class="hljs-string">"email"</span></span>, user_email), ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { t.Error(err) } result, err := Foo(rows) <span class="hljs-comment"><span class="hljs-comment">//   if err != nil { t.Error(err) } if result != 123 { t.Error(" ,   Foo()   ;)") } }</span></span></code> </pre> <br><p>  Terima kasih atas perhatian anda </p><br><p>  PS: Silakan tulis di komentar - apakah Anda menggunakan emulasi basis data dalam tes?  Jika demikian, paket mana? </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id485280/">https://habr.com/ru/post/id485280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id485268/index.html">Jika .NET berfungsi di mana-mana, maka pada Windows 3.11 dan DOS juga</a></li>
<li><a href="../id485270/index.html">Retas admin</a></li>
<li><a href="../id485272/index.html">Komputer Taimyr - evolusi adalah sebaliknya</a></li>
<li><a href="../id485274/index.html">Moscow JS Meetup di Raiffeisenbank: tetap siaran</a></li>
<li><a href="../id485278/index.html">Tangan Tuhan. Bantuan Kupon</a></li>
<li><a href="../id485284/index.html">Fitur Pendidikan SPIKE ™ Prime LEGO®</a></li>
<li><a href="../id485286/index.html">Bagaimana kami menimbang barang atau ode otomatisasi kecil</a></li>
<li><a href="../id485288/index.html">Senang membenci indie gamedev'a</a></li>
<li><a href="../id485290/index.html">Panduan Distilasi BERT Sederhana</a></li>
<li><a href="../id485294/index.html">Kursus modern tentang Node.js pada tahun 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>