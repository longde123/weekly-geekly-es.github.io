<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‚ğŸ» ğŸš¢ ğŸ˜‰ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù† Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„ÙØ§Ø¹Ù„Ø©ØŸ Ù„Ù… Ù„Ø§ØŸ ğŸ‘ˆğŸ¾ ğŸ‘©ğŸ¼â€ğŸ¤â€ğŸ‘©ğŸ» ğŸ•·ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ù…Ù†Ø° Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª ØŒ ÙÙŠ Ù…Ù†Ø§Ù‚Ø´Ø© Ø­ÙˆÙ„ Ø£Ø­Ø¯ Ø¥ØµØ¯Ø§Ø±Ø§Øª SObjectizer ØŒ Ø³ÙØ¦Ù„Ù†Ø§: "Ù‡Ù„ Ù…Ù† Ø§Ù„Ù…Ù…ÙƒÙ† Ø¥Ù†Ø´Ø§Ø¡ DSL Ù„ÙˆØµÙ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ" Ø¨Ù…Ø¹Ù†Ù‰ Ø¢Ø®Ø± ØŒ Ù‡Ù„ ÙŠÙ…ÙƒÙ† ÙƒØªØ§Ø¨Ø© Ø´ÙŠØ¡...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù† Ø¹Ù„Ù‰ Ø±Ø£Ø³ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„ÙØ§Ø¹Ù„Ø©ØŸ Ù„Ù… Ù„Ø§ØŸ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460123/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  Ù…Ù†Ø° Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª ØŒ ÙÙŠ Ù…Ù†Ø§Ù‚Ø´Ø© Ø­ÙˆÙ„ Ø£Ø­Ø¯ Ø¥ØµØ¯Ø§Ø±Ø§Øª SObjectizer ØŒ Ø³ÙØ¦Ù„Ù†Ø§: "Ù‡Ù„ Ù…Ù† Ø§Ù„Ù…Ù…ÙƒÙ† Ø¥Ù†Ø´Ø§Ø¡ DSL Ù„ÙˆØµÙ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ"  Ø¨Ù…Ø¹Ù†Ù‰ Ø¢Ø®Ø± ØŒ Ù‡Ù„ ÙŠÙ…ÙƒÙ† ÙƒØªØ§Ø¨Ø© Ø´ÙŠØ¡ ÙƒØ§Ù„ØªØ§Ù„ÙŠ: </p><br><p style=";text-align:right;direction:rtl"><code>A | B | C | D</code> </p> <br><p style=";text-align:right;direction:rtl">  ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ ÙŠØ¹Ù…Ù„ Ø­ÙŠØ« ØªÙ†ØªÙ‚Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† A Ø¥Ù„Ù‰ B ØŒ Ø«Ù… Ø¥Ù„Ù‰ C ØŒ Ø«Ù… Ø¥Ù„Ù‰ D. Ù…Ø¹ Ø§Ù„ØªØ­ÙƒÙ… ØŒ ÙŠØªÙ„Ù‚Ù‰ B Ø¨Ø§Ù„Ø¶Ø¨Ø· Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø°ÙŠ ØªÙØ±Ø¬Ø¹Ù‡ A.  ÙˆÙŠØªÙ„Ù‚Ù‰ C Ø¨Ø§Ù„Ø¶Ø¨Ø· Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø°ÙŠ ÙŠØ¹ÙˆØ¯ B.  Ùˆ Ù‡ÙƒØ°Ø§. </p><br><p style=";text-align:right;direction:rtl">  Ù„Ù‚Ø¯ ÙƒØ§Ù†Øª Ù…Ù‡Ù…Ø© Ù…Ø«ÙŠØ±Ø© Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ù…Ø¹ Ø­Ù„ Ø¨Ø³ÙŠØ· Ø¨Ø´ÙƒÙ„ Ù…Ø¯Ù‡Ø´.  Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ Ù‡ÙƒØ°Ø§ ÙŠØ¨Ø¯Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pipeline = make_pipeline(env, stage(A) | stage(B) | stage(C) | stage(D));</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø£Ùˆ ÙÙŠ Ø­Ø§Ù„Ø© Ø£ÙƒØ«Ø± ØªØ¹Ù‚ÙŠØ¯Ù‹Ø§ (Ø³ÙŠØªÙ… Ù…Ù†Ø§Ù‚Ø´ØªÙ‡Ø§ Ø£Ø¯Ù†Ø§Ù‡): </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(archiving), stage(distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(alarm_initiator), stage( []( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> alarm_detected &amp; v ) { alarm_distribution( <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span>, v ); } ) ) ) );</code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‚Ø§Ù„Ø© ØŒ Ø³Ù†ØªØ­Ø¯Ø« Ø¹Ù† ØªÙ†ÙÙŠØ° Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ DSL Ù‡Ø°Ø§.  Ø³Ù†Ù†Ø§Ù‚Ø´ ÙÙŠ Ø§Ù„ØºØ§Ù„Ø¨ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© <code>stage()</code> ØŒ <code>broadcast()</code> <code>operator|()</code> ÙˆÙˆØ¸Ø§Ø¦Ù <code>operator|()</code> Ù…Ø¹ Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚ÙˆØ§Ù„Ø¨ C ++.  Ù„Ø°Ø§ Ø¢Ù…Ù„ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø£Ù…Ø± Ù…Ù…ØªØ¹Ù‹Ø§ Ø­ØªÙ‰ Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ù‚Ø±Ø§Ø¡ Ø§Ù„Ø°ÙŠÙ† Ù„Ø§ ÙŠØ¹Ø±ÙÙˆÙ† Ø¹Ù† SObjectizer (Ø¥Ø°Ø§ Ù„Ù… ØªØ³Ù…Ø¹ Ø¹Ù† SObjectizer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Ù‡Ù†Ø§</a> ÙÙ‡ÙŠ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø©). </p><a name="habracut"></a><br><h1 id="a-couple-of-words-about-the-used-demo" style=";text-align:right;direction:rtl">  Ø¨Ø¶Ø¹ ÙƒÙ„Ù…Ø§Øª Ø­ÙˆÙ„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© </h1><br><p style=";text-align:right;direction:rtl">  ØªØ£Ø«Ø± Ø§Ù„Ù…Ø«Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„Ø© Ø¨ØªØ¬Ø±Ø¨ØªÙŠ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (ÙˆØ§Ù„Ù…Ù†Ø³ÙŠØ©) ÙÙŠ Ù…Ù†Ø·Ù‚Ø© SCADA. </p><br><p style=";text-align:right;direction:rtl">  ÙÙƒØ±Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ Ù‡ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø© Ù…Ù† Ø¨Ø¹Ø¶ Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø§Ø³ØªØ´Ø¹Ø§Ø±.  ÙŠØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¬Ù‡Ø§Ø² Ø§Ø³ØªØ´Ø¹Ø§Ø± Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„ÙØªØ±Ø© ØŒ Ø«Ù… ÙŠØ¬Ø¨ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ÙŠØ¬Ø¨ ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„ØµØ­ÙŠØ­Ø©) ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ø¥Ù„Ù‰ Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ÙØ¹Ù„ÙŠØ©.  Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ© Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø© Ù…Ù† Ù…Ø³ØªØ´Ø¹Ø± Ù‚ÙŠÙ…ØªÙŠÙ† ØµØ­ÙŠØ­ØªÙŠÙ† 8 Ø¨Øª ÙˆÙŠØ¬Ø¨ ØªØ­ÙˆÙŠÙ„ ØªÙ„Ùƒ Ø§Ù„Ù‚ÙŠÙ… Ø¥Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØµÙ„Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©. </p><br><p style=";text-align:right;direction:rtl">  Ø«Ù… ÙŠÙ†Ø¨ØºÙŠ Ø£Ø±Ø´ÙØ© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ØµØ§Ù„Ø­Ø© ÙˆØ§Ù„Ù…Ø­ÙˆÙ‘Ù„Ø© ØŒ ÙˆØªÙˆØ²ÙŠØ¹Ù‡Ø§ ÙÙŠ Ù…ÙƒØ§Ù† Ù…Ø§ (Ø¹Ù„Ù‰ Ø¹Ù‚Ø¯ Ù…Ø®ØªÙ„ÙØ© Ù„Ù„ØªØ®ÙŠÙ„ ØŒ Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„) ØŒ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ "Ø¥Ù†Ø°Ø§Ø±Ø§Øª" (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ÙŠÙ… Ø®Ø§Ø±Ø¬Ø© Ø¹Ù† Ù†Ø·Ø§Ù‚Ø§Øª Ø¢Ù…Ù†Ø© ØŒ ÙÙŠØ¬Ø¨ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø°Ù„Ùƒ Ø¨Ø´ÙƒÙ„ Ø®Ø§Øµ).  Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø³ØªÙ‚Ù„Ø© ÙˆÙŠÙ…ÙƒÙ† ØªÙ†ÙÙŠØ°Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ§Ø²ÙŠ. </p><br><p style=";text-align:right;direction:rtl">  ÙŠÙ…ÙƒÙ† Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ø¥Ù†Ø°Ø§Ø± Ø§Ù„Ù…ÙƒØªØ´Ù Ø¨Ø´ÙƒÙ„ Ù…ØªÙˆØ§Ø²Ù Ø£ÙŠØ¶Ù‹Ø§: ÙŠØ¬Ø¨ Ø¨Ø¯Ø¡ "Ø§Ù„Ù…Ù†Ø¨Ù‡" (Ø­ØªÙ‰ ÙŠÙ…ÙƒÙ† Ù„Ø¬Ø²Ø¡ SCADA Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù‚Ø¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø£Ù† ÙŠØªÙØ§Ø¹Ù„ Ù…Ø¹Ù‡) ÙˆÙŠØ¬Ø¨ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­ÙˆÙ„ "Ø§Ù„Ù…Ù†Ø¨Ù‡" ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ø®Ø± (Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ : ØªØ®Ø²ÙŠÙ†Ù‡Ø§ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ§Ø±ÙŠØ®ÙŠØ© Ùˆ / Ø£Ùˆ ØªØµÙˆØ± Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø© Ù…Ø´ØºÙ„ SCADA). </p><br><p style=";text-align:right;direction:rtl">  ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø¨Ø´ÙƒÙ„ Ù†ØµÙŠ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">optional(valid_raw_data) = validate(raw_data); if valid_raw_data is not empty then { converted_value = convert(valid_raw_data); do_async archive(converted_value); do_async distribute(converted_value); do_async { optional(suspicious_value) = check_range(converted_value); if suspicious_value is not empty then { optional(alarm) = detect_alarm(suspicious_value); if alarm is not empty then { do_async initiate_alarm(alarm); do_async distribute_alarm(alam); } } } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø£Ùˆ ØŒ ÙÙŠ Ø´ÙƒÙ„ Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ©: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/5z/nm/vv/5znmvvaqnou_qwh808t8vkbrdc8.jpeg"></p><br><p style=";text-align:right;direction:rtl">  Ø¥Ù†Ù‡ Ù…Ø«Ø§Ù„ Ù…ØµØ·Ù†Ø¹ Ø¥Ù„Ù‰ Ø­Ø¯ Ù…Ø§ ØŒ ÙˆÙ„ÙƒÙ†Ù‡ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„Ù…Ø«ÙŠØ±Ø© Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ø§Ù„ØªÙŠ Ø£Ø±ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§.  Ø§Ù„Ø£ÙˆÙ„ Ù‡Ùˆ ÙˆØ¬ÙˆØ¯ Ù…Ø±Ø§Ø­Ù„ Ù…ØªÙˆØ§Ø²ÙŠØ© ÙÙŠ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ (Ø¹Ù…Ù„ÙŠØ© <code>broadcast()</code> Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙ‚Ø· Ø¨Ø³Ø¨Ø¨ Ø°Ù„Ùƒ).  ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ Ù‡Ùˆ ÙˆØ¬ÙˆØ¯ Ø¯ÙˆÙ„Ø© ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø±Ø§Ø­Ù„.  Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ alarm_detector Ù‡Ùˆ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯ÙˆÙ„Ø©. </p><br><h1 id="pipeline-capabilities" style=";text-align:right;direction:rtl">  Ù‚Ø¯Ø±Ø§Øª Ø®Ø·ÙˆØ· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ </h1><br><p style=";text-align:right;direction:rtl">  ØªÙ… Ø¨Ù†Ø§Ø¡ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ Ù…Ù† Ù…Ø±Ø§Ø­Ù„ Ù…Ù†ÙØµÙ„Ø©.  ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ù‡ÙŠ ÙˆØ¸ÙŠÙØ© Ø£Ùˆ ÙØ§Ø¹Ù„ Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ù„ÙŠ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">opt&lt;Out&gt; func(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> In &amp;);</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø£Ùˆ </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> In &amp;)</span></span></span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØªÙŠ ØªÙØ±Ø¬Ø¹ <code>void</code> Ø¥Ù„Ø§ ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ù…Ù† Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨. </p><br><p style=";text-align:right;direction:rtl">  Ù„Ø§ Ø¨Ø¯ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ ÙÙŠ Ø³Ù„Ø³Ù„Ø©.  ØªØ³ØªÙ‚Ø¨Ù„ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© ØªØ§Ù„ÙŠØ© ÙƒØ§Ø¦Ù†Ù‹Ø§ ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.  Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªÙØ±Ø¬Ø¹ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§Ø±ØºØ© ØŒ <code>opt&lt;Out&gt;</code> Ø§Ù„Ù‚ÙŠÙ…Ø© <code>opt&lt;Out&gt;</code> Ø«Ù… Ù„Ø§ ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©. </p><br><p style=";text-align:right;direction:rtl">  Ù‡Ù†Ø§Ùƒ Ù…Ø±Ø­Ù„Ø© <code>broadcast</code> Ø§Ù„Ø®Ø§ØµØ©.  Ù‡ÙŠ Ø§Ù„ØªÙŠ Ø´ÙŠØ¯Øª Ù…Ù† Ø¹Ø¯Ø© Ø®Ø·ÙˆØ· Ø£Ù†Ø§Ø¨ÙŠØ¨.  ØªØ³ØªÙ‚Ø¨Ù„ Ù…Ø±Ø­Ù„Ø© <code>broadcast</code> ÙƒØ§Ø¦Ù†Ù‹Ø§ Ù…Ù† Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆØªØ¨Ø«Ù‡ Ø¥Ù„Ù‰ ÙƒÙ„ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ ÙØ±Ø¹ÙŠ. </p><br><p style=";text-align:right;direction:rtl">  Ù…Ù† ÙˆØ¬Ù‡Ø© Ù†Ø¸Ø± Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ØŒ ØªØ¨Ø¯Ùˆ Ù…Ø±Ø­Ù„Ø© <code>broadcast</code> ÙƒØ¯Ø§Ù„Ø© Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ù„ÙŠ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> In &amp;)</span></span></span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù‚ÙŠÙ…Ø© Ø¥Ø±Ø¬Ø§Ø¹ Ù…Ù† Ù…Ø±Ø­Ù„Ø© <code>broadcast</code> ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø±Ø­Ù„Ø© <code>broadcast</code> Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© ÙÙ‚Ø· ÙÙŠ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨. </p><br><h2 id="why-does-the-pipeline-stage-return-an-optional-value" style=";text-align:right;direction:rtl">  Ù„Ù…Ø§Ø°Ø§ ØªØ±Ø¬Ø¹ Ù…Ø±Ø­Ù„Ø© Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ Ù‚ÙŠÙ…Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©ØŸ </h2><br><p style=";text-align:right;direction:rtl">  Ø°Ù„Ùƒ Ù„Ø£Ù† Ù‡Ù†Ø§Ùƒ Ø­Ø§Ø¬Ø© Ù„Ø¥Ø³Ù‚Ø§Ø· Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ÙˆØ§Ø±Ø¯Ø©.  Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ Ù„Ø§ ØªÙ‚ÙˆÙ… Ù…Ø±Ø­Ù„Ø© <code>validate</code> Ø¨Ø¥Ø±Ø¬Ø§Ø¹ Ø£ÙŠ Ø´ÙŠØ¡ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø© ØŒ ÙˆÙ„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ù…Ø¹Ù†Ù‰ Ù„Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§. </p><br><p style=";text-align:right;direction:rtl">  Ù…Ø«Ø§Ù„ Ø¢Ø®Ø±: Ù„Ø§ ØªÙ‚ÙˆÙ… Ù…Ø±Ø­Ù„Ø© <code>alarm_detector</code> Ø¨Ø¥Ø±Ø¬Ø§Ø¹ Ø£ÙŠ Ø´ÙŠØ¡ Ø¥Ø°Ø§ Ù„Ù… ØªÙ†ØªØ¬ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¹Ù† Ø­Ø§Ù„Ø© Ø¥Ù†Ø°Ø§Ø± Ø¬Ø¯ÙŠØ¯Ø©. </p><br><h1 id="implementation-details" style=";text-align:right;direction:rtl">  ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ†ÙÙŠØ° </h1><br><h2 id="types-and-functions-related-to-the-application-logic" style=";text-align:right;direction:rtl">  Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ </h2><br><p style=";text-align:right;direction:rtl">  Ù„Ù†Ø¨Ø¯Ø£ Ù…Ù† Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.  ÙÙŠ Ø§Ù„Ù…Ø«Ø§Ù„ Ø§Ù„Ø°ÙŠ ØªÙ…Øª Ù…Ù†Ø§Ù‚Ø´ØªÙ‡ ØŒ ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù† Ù…Ø±Ø­Ù„Ø© Ø¥Ù„Ù‰ Ø£Ø®Ø±Ù‰: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Raw data from a sensor. struct raw_measure { int m_meter_id; uint8_t m_high_bits; uint8_t m_low_bits; }; // Type of input for validation stage with raw data from a sensor. struct raw_value { raw_measure m_data; }; // Type of input for conversion stage with valid raw data from a sensor. struct valid_raw_value { raw_measure m_data; }; // Data from a sensor after conversion to Celsius degrees. struct calculated_measure { int m_meter_id; float m_measure; }; // The type for result of conversion stage with converted data from a sensor. struct sensor_value { calculated_measure m_data; }; // Type with value which could mean a dangerous level of temperature. struct suspicious_value { calculated_measure m_data; }; // Type with information about detected dangerous situation. struct alarm_detected { int m_meter_id; };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù‡Ù†Ø§Ùƒ Ù…Ø«ÙŠÙ„ Ù„Ù€ <code>raw_value</code> ÙŠÙ†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨Ù†Ø§.  ÙŠØ­ØªÙˆÙŠ Ù‡Ø°Ø§ <code>raw_value</code> Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡Ø§ Ù…Ù† Ø¬Ù‡Ø§Ø² Ø§Ø³ØªØ´Ø¹Ø§Ø± ÙÙŠ Ø´ÙƒÙ„ ÙƒØ§Ø¦Ù† <code>raw_measure</code> .  Ø«Ù… ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„ <code>valid_raw_value</code> Ø¥Ù„Ù‰ <code>valid_raw_value</code> .  Ø«Ù… <code>valid_raw_value</code> ØªØ­ÙˆÙ„Øª Ø¥Ù„Ù‰ <code>sensor_value</code> Ù…Ø¹ Ù‚ÙŠÙ…Ø© Ø¬Ù‡Ø§Ø² Ø§Ø³ØªØ´Ø¹Ø§Ø± Ø§Ù„ÙØ¹Ù„ÙŠ ÙÙŠ Ø´ÙƒÙ„ <code>calulated_measure</code> .  Ø¥Ø°Ø§ Ø§Ø­ØªÙˆÙ‰ Ù…Ø«ÙŠÙ„ Ù…Ù† <code>sensor_value</code> Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ù…Ø±ÙŠØ¨Ø© ØŒ ÙØ³ÙŠØªÙ… Ø¥Ù†ØªØ§Ø¬ Ù…Ø«ÙŠÙ„ Ù„Ù„Ù‚ÙŠÙ…Ø© <code>suspicious_value</code> .  ÙˆÙŠÙ…ÙƒÙ† ØªØ­ÙˆÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù‚ÙŠÙ…Ø© <code>suspicious_value</code> Ø¥Ù„Ù‰ Ù…Ø«ÙŠÙ„ <code>alarm_detected</code> Ù„Ø§Ø­Ù‚Ù‹Ø§. </p><br><p style=";text-align:right;direction:rtl">  Ø£Ùˆ Ø¨Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ø±Ø³ÙˆÙ…ÙŠØ©: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/dp/dx/rz/dpdxrzpp-rvo05zk-8rwdwucszo.jpeg"></p><br><p style=";text-align:right;direction:rtl">  Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¥Ù„Ù‚Ø§Ø¡ Ù†Ø¸Ø±Ø© Ø¹Ù„Ù‰ ØªÙ†ÙÙŠØ° Ù…Ø±Ø§Ø­Ù„ Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ Ù„Ø¯ÙŠÙ†Ø§: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // The first stage of a pipeline. Validation of raw data from a sensor. // // Returns valid_raw_value or nothing if value is invalid. // stage_result_t&lt; valid_raw_value &gt; validation( const raw_value &amp; v ) { if( 0x7 &gt;= v.m_data.m_high_bits ) return make_result&lt; valid_raw_value &gt;( v.m_data ); else return make_empty&lt; valid_raw_value &gt;(); } // // The second stage of a pipeline. Conversion from raw data to a value // in Celsius degrees. // stage_result_t&lt; sensor_value &gt; conversion( const valid_raw_value &amp; v ) { return make_result&lt; sensor_value &gt;( calculated_measure{ v.m_data.m_meter_id, 0.5f * ((static_cast&lt; uint16_t &gt;( v.m_data.m_high_bits ) &lt;&lt; 8) + v.m_data.m_low_bits) } ); } // // Simulation of the data archiving. // void archiving( const sensor_value &amp; v ) { clog &lt;&lt; "archiving (" &lt;&lt; v.m_data.m_meter_id &lt;&lt; "," &lt;&lt; v.m_data.m_measure &lt;&lt; ")" &lt;&lt; endl; } // // Simulation of the data distribution. // void distribution( const sensor_value &amp; v ) { clog &lt;&lt; "distributing (" &lt;&lt; v.m_data.m_meter_id &lt;&lt; "," &lt;&lt; v.m_data.m_measure &lt;&lt; ")" &lt;&lt; endl; } // // The first stage of a child pipeline at third level of the main pipeline. // // Checking for to high value of the temperature. // // Returns suspicious_value message or nothing. // stage_result_t&lt; suspicious_value &gt; range_checking( const sensor_value &amp; v ) { if( v.m_data.m_measure &gt;= 45.0f ) return make_result&lt; suspicious_value &gt;( v.m_data ); else return make_empty&lt; suspicious_value &gt;(); } // // The next stage of a child pipeline. // // Checks for two suspicious_value-es in 25ms time window. // class alarm_detector { using clock = chrono::steady_clock; public : stage_result_t&lt; alarm_detected &gt; operator()( const suspicious_value &amp; v ) { if( m_previous ) if( *m_previous + chrono::milliseconds(25) &gt; clock::now() ) { m_previous = nullopt; return make_result&lt; alarm_detected &gt;( v.m_data.m_meter_id ); } m_previous = clock::now(); return make_empty&lt; alarm_detected &gt;(); } private : optional&lt; clock::time_point &gt; m_previous; }; // // One of last stages of a child pipeline. // Imitates beginning of the alarm processing. // void alarm_initiator( const alarm_detected &amp; v ) { clog &lt;&lt; "=== alarm (" &lt;&lt; v.m_meter_id &lt;&lt; ") ===" &lt;&lt; endl; } // // Another of last stages of a child pipeline. // Imitates distribution of the alarm. // void alarm_distribution( ostream &amp; to, const alarm_detected &amp; v ) { to &lt;&lt; "alarm_distribution (" &lt;&lt; v.m_meter_id &lt;&lt; ")" &lt;&lt; endl; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙÙ‚Ø· ØªØ®Ø·ÙŠ Ø£Ø´ÙŠØ§Ø¡ Ù…Ø«Ù„ <code>stage_result_t</code> Ùˆ <code>make_result</code> Ùˆ <code>make_empty</code> ØŒ Ø³Ù†Ù†Ø§Ù‚Ø´Ù‡Ø§ ÙÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ØªØ§Ù„ÙŠ. </p><br><p style=";text-align:right;direction:rtl">  Ø¢Ù…Ù„ Ø£Ù† Ø±Ù…Ø² ØªÙ„Ùƒ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ ØªØ§ÙÙ‡Ø© Ø¥Ù„Ù‰ Ø­Ø¯ Ù…Ø§.  Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„ÙˆØ­ÙŠØ¯ Ø§Ù„Ø°ÙŠ ÙŠØªØ·Ù„Ø¨ Ø¨Ø¹Ø¶ Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ù‡Ùˆ ØªÙ†ÙÙŠØ° Ù…Ø±Ø­Ù„Ø© <code>alarm_detector</code> . </p><br><p style=";text-align:right;direction:rtl">  ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù†Ø¨Ù‡ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø§Ø«Ù†ÙŠÙ† Ù…Ù† Ø§Ù„Ù‚ÙŠÙ… <code>suspicious_values</code> ÙÙŠ Ù†Ø§ÙØ°Ø© Ø²Ù…Ù†ÙŠØ© ØªØ¨Ù„Øº 25 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©.  Ù„Ø°Ù„Ùƒ ÙŠØªØ¹ÙŠÙ† Ø¹Ù„ÙŠÙ†Ø§ Ø£Ù† Ù†ØªØ°ÙƒØ± ÙˆÙ‚Øª Ø§Ù„Ù…Ø«ÙŠÙ„ <code>suspicious_value</code> Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙÙŠ Ù…Ø±Ø­Ù„Ø© <code>alarm_detector</code> .  ÙˆØ°Ù„Ùƒ Ù„Ø£Ù† ØªØ·Ø¨ÙŠÙ‚ <code>alarm_detector</code> ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡ ÙƒÙ…Ø³Ø¤ÙˆÙ„ Ø°ÙŠ Ø­Ø§Ù„Ø© Ø¬ÙŠØ¯Ø© Ù…Ø¹ Ù…Ø´ØºÙ„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø©. </p><br><h2 id="stages-return-sobjectizers-type-instead-of-stdoptional" style=";text-align:right;direction:rtl">  ØªÙ‚ÙˆÙ… Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø¨Ø¥Ø±Ø¬Ø§Ø¹ Ù†ÙˆØ¹ SObjectizer Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† std :: Ø§Ø®ØªÙŠØ§Ø±ÙŠ </h2><br><p style=";text-align:right;direction:rtl">  Ù‚Ù„Øª ÙÙŠ ÙˆÙ‚Øª Ø³Ø§Ø¨Ù‚ Ø£Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ¹ÙˆØ¯ Ù‚ÙŠÙ…Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©  Ù„ÙƒÙ† <code>std::optional</code> Ù„Ø§ ÙŠØ³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© ØŒ ÙŠÙ…ÙƒÙ† Ø±Ø¤ÙŠØ© Ø§Ù„Ù†ÙˆØ¹ <code>stage_result_t</code> ÙÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø±Ø§Ø­Ù„. </p><br><p style=";text-align:right;direction:rtl">  ÙØ°Ù„Ùƒ Ù„Ø£Ù† Ø¨Ø¹Ø¶ SObjectizer Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ØªÙ„Ø¹Ø¨ Ø¯ÙˆØ±Ù‡Ø§ Ù‡Ù†Ø§.  Ø³ÙŠØªÙ… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ØªÙŠ ÙŠØªÙ… Ø¥Ø±Ø¬Ø§Ø¹Ù‡Ø§ ÙƒØ±Ø³Ø§Ø¦Ù„ Ø¨ÙŠÙ† ÙˆÙƒÙ„Ø§Ø¡ SObjectizer (ÙˆÙŠØ¹Ø±Ù Ø£ÙŠØ¶Ù‹Ø§ Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙØ§Ø¹Ù„Ø©).  ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© ÙÙŠ SObjectizer ÙƒÙƒØ§Ø¦Ù† Ù…Ø®ØµØµ Ø¨Ø´ÙƒÙ„ Ø­ÙŠÙˆÙŠ.  Ù„Ø°Ù„Ùƒ Ù„Ø¯ÙŠÙ†Ø§ Ù†ÙˆØ¹ Ù…Ù† "Ø§Ù„ØªØ­Ø³ÙŠÙ†" Ù‡Ù†Ø§: Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø±Ø¬Ø§Ø¹ <code>std::optional</code> ÙˆÙ…Ù† Ø«Ù… ØªØ®ØµÙŠØµ ÙƒØ§Ø¦Ù† Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯ ØŒ Ù†Ø­Ù† ÙÙ‚Ø· Ù†Ø®ØµØµ ÙƒØ§Ø¦Ù† Ø±Ø³Ø§Ù„Ø© ÙˆÙ†Ø¹ÙŠØ¯ Ù…Ø¤Ø´Ø± Ø°ÙƒÙŠ Ø¥Ù„ÙŠÙ‡. </p><br><p style=";text-align:right;direction:rtl">  ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ ØŒ <code>stage_result_t</code> Ù‡Ùˆ Ù…Ø¬Ø±Ø¯ typedef Ù„ anal_ptr Shared_ptr Ø§Ù„ØªÙ†Ø§Ø¸Ø±ÙŠØ©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M &gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>&lt; M &gt;;</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ùˆ <code>make_result</code> Ùˆ <code>make_empty</code> Ù‡Ù…Ø§ Ø¯Ø§Ù„Ø§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙ‚Ø· Ù„Ø¥Ù†Ø´Ø§Ø¡ <code>stage_result_t</code> Ù…Ø¹ Ø£Ùˆ Ø¨Ø¯ÙˆÙ† Ù‚ÙŠÙ…Ø© ÙØ¹Ù„ÙŠØ© Ø¨Ø¯Ø§Ø®Ù„: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Args &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt; make_result( Args &amp;&amp;... args ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt;::make(forward&lt; Args &gt;(args)...); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt; make_empty() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt;(); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù„Ù„Ø¨Ø³Ø§Ø·Ø© ØŒ ÙŠÙ…ÙƒÙ† Ø§Ù„Ù‚ÙˆÙ„ Ø£Ù† Ù…Ø±Ø­Ù„Ø© <code>validation</code> Ù…Ù† <code>validation</code> ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù†Ù‡Ø§ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt; valid_raw_value &gt; validation( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> raw_value &amp; v ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-number"><span class="hljs-number">0x7</span></span> &gt;= v.m_data.m_high_bits ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_shared&lt; valid_raw_value &gt;( v.m_data ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt; valid_raw_value &gt;{}; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙˆÙ„ÙƒÙ† Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø®ØµÙˆØµÙŠØ© SObjectizer ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… <code>std::shared_ptr</code> <code>so_5::message_holder_t</code> Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ <code>so_5::message_holder_t</code> type.  ÙˆÙ†Ø­Ù† Ù†Ø®ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙˆØ±Ø§Ø¡ <code>stage_result_t</code> Ùˆ <code>make_result</code> Ùˆ <code>make_empty</code> Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ†. </p><br><h2 id="stage_handler_t-and-stage_builder_t-separation" style=";text-align:right;direction:rtl">  stage_handler_t ÙˆØ§Ù„ÙØµÙ„ stage_builder_t </h2><br><p style=";text-align:right;direction:rtl">  ØªØªÙ…Ø«Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ ØªÙ†ÙÙŠØ° Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ÙÙŠ Ø§Ù„ÙØµÙ„ Ø¨ÙŠÙ† Ù…ÙØ§Ù‡ÙŠÙ… <em>Ù…Ø¹Ø§Ù„Ø¬</em> <em>Ø§Ù„Ù…Ø±Ø­Ù„Ø© ÙˆÙ…Ø±Ø­Ù„Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡</em> .  ÙŠØªÙ… Ø°Ù„Ùƒ Ù…Ù† Ø£Ø¬Ù„ Ø§Ù„Ø¨Ø³Ø§Ø·Ø©.  Ø³Ù…Ø­ Ù„ÙŠ ÙˆØ¬ÙˆØ¯ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø¨Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ø¯ÙŠ Ø®Ø·ÙˆØªÙŠÙ† ÙÙŠ ØªØ¹Ø±ÙŠÙ Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨. </p><br><p style=";text-align:right;direction:rtl">  ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ ØŒ ÙŠØµÙ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø±Ø§Ø­Ù„ Ø®Ø·ÙˆØ· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨.  Ù†ØªÙŠØ¬Ø© Ù„Ø°Ù„Ùƒ ØŒ Ø£ØªÙ„Ù‚Ù‰ Ù…Ø«ÙŠÙ„ <code>stage_t</code> Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙØ¸ Ø¨Ø¬Ù…ÙŠØ¹ Ù…Ø±Ø§Ø­Ù„ Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ÙÙŠ Ø§Ù„Ø¯Ø§Ø®Ù„. </p><br><p style=";text-align:right;direction:rtl">  ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ØŒ ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† ÙˆÙƒÙ„Ø§Ø¡ SObjectizer Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ.  ÙŠØªÙ„Ù‚Ù‰ Ù‡Ø¤Ù„Ø§Ø¡ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø±Ø³Ø§Ø¦Ù„ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙˆÙŠØªØµÙ„ÙˆÙ† Ø¨Ù…Ø¹Ø§Ù„Ø¬Ø§Øª <em>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> Ø§Ù„ÙØ¹Ù„ÙŠØ© ØŒ Ø«Ù… ÙŠØ±Ø³Ù„ÙˆÙ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØªØ§Ù„ÙŠØ©. </p><br><p style=";text-align:right;direction:rtl">  ÙˆÙ„ÙƒÙ† Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ ØŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„ÙƒÙ„ <em>Ù…Ø±Ø­Ù„Ø© Ù…Ù†Ø´Ø¦ Ù…Ø±Ø­Ù„Ø©</em> .  ÙŠÙ…ÙƒÙ† Ø±Ø¤ÙŠØ© <em>Ù…Ù†Ø´Ø¦ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> ÙƒÙ…ØµÙ†Ø¹ ÙŠÙ‚ÙˆÙ… Ø¨Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙƒÙŠÙ„ SObjectizer Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ. </p><br><p style=";text-align:right;direction:rtl">  Ù„Ø°Ù„Ùƒ Ù„Ø¯ÙŠÙ†Ø§ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ù…Ù† Ù…Ø±Ø§Ø­Ù„ Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ØªÙ†ØªØ¬ ÙƒØ§Ø¦Ù†ÙŠÙ†: <em>Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙØ¸ Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø±ØªØ¨Ø· <em>Ø¨Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> ØŒ <em>ÙˆÙ…Ù†Ø´Ø¦ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> Ø§Ù„Ø°ÙŠ ÙŠÙ†Ø´Ø¦ ÙˆÙƒÙŠÙ„ SObjectizer Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ <em>Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/gl/tp/nn/gltpnnqhjqslsscxvellndh6n0u.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ÙŠØªÙ… ØªÙ…Ø«ÙŠÙ„ <em>Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stage_handler_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> traits = <span class="hljs-keyword"><span class="hljs-keyword">handler_traits_t</span></span>&lt; In, Out &gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> func_type = function&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> traits::output(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> traits::input &amp;) &gt;; <span class="hljs-keyword"><span class="hljs-keyword">stage_handler_t</span></span>( func_type handler ) : m_handler( move(handler) ) {} <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Callable &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_handler_t</span></span>( Callable handler ) : m_handler( handler ) {} <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> traits::<span class="hljs-function"><span class="hljs-function">output </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">typename</span></span></span></span><span class="hljs-function"><span class="hljs-params"> traits::input &amp; a )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_handler( a ); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> : func_type m_handler; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø­ÙŠØ« ÙŠØªÙ… ØªØ¹Ø±ÙŠÙ <code>handler_traits_t</code> Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // We have to deal with two types of stage handlers: // - intermediate handlers which will return some result (eg some new // message); // - terminal handlers which can return nothing (eg void instead of // stage_result_t&lt;M&gt;); // // This template with specialization defines `input` and `output` // aliases for both cases. // template&lt; typename In, typename Out &gt; struct handler_traits_t { using input = In; using output = stage_result_t&lt; Out &gt;; }; template&lt; typename In &gt; struct handler_traits_t&lt; In, void &gt; { using input = In; using output = void; };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙˆÙŠÙ…Ø«Ù„ <em>Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> ÙÙ‚Ø· <code>std::function</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> = function&lt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp;, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>) &gt;;</code> </pre> <br><h2 id="helper-types-lambda_traits_t-and-callable_traits_t" style=";text-align:right;direction:rtl">  Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© lambda_traits_t Ùˆ callable_traits_t </h2><br><p style=";text-align:right;direction:rtl">  Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø£Ù† Ø§Ù„Ù…Ø±Ø§Ø­Ù„ ÙŠÙ…ÙƒÙ† ØªÙ…Ø«ÙŠÙ„Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© ÙˆØ¸Ø§Ø¦Ù Ù…Ø¬Ø§Ù†ÙŠØ© Ø£Ùˆ Ø¹ÙˆØ§Ù…Ù„ ØªÙˆØ¬ÙŠÙ‡ (Ù…Ø«Ù„ Ù…Ø«ÙŠÙ„Ø§Øª ÙØ¦Ø© <code>alarm_detector</code> Ø£Ùˆ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ØªØ±Ø¬Ù… Ù…Ø¬Ù‡ÙˆÙ„ ØªÙ…Ø«Ù„ lambdas) ØŒ ÙÙ†Ø­Ù† Ø¨Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ† Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø£Ù†ÙˆØ§Ø¹ ÙˆØ³ÙŠØ·Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø© ÙˆÙ‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹.  Ù„Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù…Øª Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„ØºØ±Ø¶: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // Helper type for `arg_type` and `result_type` alises definition. // template&lt; typename R, typename A &gt; struct callable_traits_typedefs_t { using arg_type = A; using result_type = R; }; // // Helper type for dealing with stateful objects with operator() // (they could be user-defined objects or generated by compiler // like lambdas). // template&lt; typename T &gt; struct lambda_traits_t; template&lt; typename M, typename A, typename T &gt; struct lambda_traits_t&lt; stage_result_t&lt; M &gt;(T::*)(const A &amp;) const &gt; : public callable_traits_typedefs_t&lt; M, A &gt; {}; template&lt; typename A, typename T &gt; struct lambda_traits_t&lt; void (T::*)(const A &amp;) const &gt; : public callable_traits_typedefs_t&lt; void, A &gt; {}; template&lt; typename M, typename A, typename T &gt; struct lambda_traits_t&lt; stage_result_t&lt; M &gt;(T::*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; M, A &gt; {}; template&lt; typename A, typename T &gt; struct lambda_traits_t&lt; void (T::*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; void, A &gt; {}; // // Main type for definition of `arg_type` and `result_type` aliases. // With specialization for various cases. // template&lt; typename T &gt; struct callable_traits_t : public lambda_traits_t&lt; decltype(&amp;T::operator()) &gt; {}; template&lt; typename M, typename A &gt; struct callable_traits_t&lt; stage_result_t&lt; M &gt;(*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; M, A &gt; {}; template&lt; typename A &gt; struct callable_traits_t&lt; void(*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; void, A &gt; {};</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø¢Ù…Ù„ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù…ÙÙ‡ÙˆÙ…Ø§ ØªÙ…Ø§Ù…Ù‹Ø§ Ù„Ù„Ù‚Ø±Ø§Ø¡ Ø§Ù„Ø°ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… Ù…Ø¹Ø±ÙØ© Ø¬ÙŠØ¯Ø© Ø¨Ù€ C ++.  Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ø£Ù…Ø± ÙƒØ°Ù„Ùƒ ØŒ ÙÙ„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ <code>lambda_traits_t</code> ØŒ <code>lambda_traits_t</code> Ø£Ù† Ø£Ø´Ø±Ø­ Ø§Ù„Ù…Ù†Ø·Ù‚ ÙˆØ±Ø§Ø¡ <code>lambda_traits_t</code> Ùˆ <code>callable_traits_t</code> Ø¨Ø§Ù„ØªÙØµÙŠÙ„. </p><br><h2 id="stage-broadcast-and-operator-functions" style=";text-align:right;direction:rtl">  Ø§Ù„Ù…Ø±Ø­Ù„Ø© () ØŒ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¨Ø« () Ùˆ | () Ø§Ù„Ù…Ø´ØºÙ„ </h2><br><p style=";text-align:right;direction:rtl">  Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø£Ù† Ù†Ù†Ø¸Ø± Ø¯Ø§Ø®Ù„ ÙˆØ¸Ø§Ø¦Ù Ø¨Ù†Ø§Ø¡ Ø®Ø·ÙˆØ· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.  ÙˆÙ„ÙƒÙ† Ù‚Ø¨Ù„ Ø°Ù„Ùƒ ØŒ Ù…Ù† Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠ Ø¥Ù„Ù‚Ø§Ø¡ Ù†Ø¸Ø±Ø© Ø¹Ù„Ù‰ ØªØ¹Ø±ÙŠÙ ÙØ¦Ø© Ø§Ù„Ù‚Ø§Ù„Ø¨ <code>stage_t</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stage_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> m_builder; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø¥Ù†Ù‡Ø§ Ø¨Ù†ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„ØºØ§ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø«ÙŠÙ„ <code>stage_bulder_t</code> ÙÙ‚Ø·.  Ù„Ø§ ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¯Ø§Ø®Ù„ <code>stage_t</code> ØŒ ÙÙ„Ù…Ø§Ø°Ø§ ØªÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯Ø© Ù‡Ù†Ø§ØŸ </p><br><p style=";text-align:right;direction:rtl">  ÙˆÙ‡ÙŠ Ø¶Ø±ÙˆØ±ÙŠØ© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆÙ‚Øª ØªØ±Ø¬Ù…Ø© ØªÙˆØ§ÙÙ‚ Ø§Ù„Ù†ÙˆØ¹ Ø¨ÙŠÙ† Ù…Ø±Ø§Ø­Ù„ Ø®Ø·ÙˆØ· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨.  Ø³Ù†Ø±Ù‰ Ø°Ù„Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹. </p><br><p style=";text-align:right;direction:rtl">  Ù„Ù†Ù„Ù‚Ù Ù†Ø¸Ø±Ø© Ø¹Ù„Ù‰ Ø£Ø¨Ø³Ø· ÙˆØ¸ÙŠÙØ© Ù„Ø¨Ù†Ø§Ø¡ Ø®Ø·ÙˆØ· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ØŒ <code>stage()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Callable, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::arg_type, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::result_type &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out &gt; stage( Callable handler ) { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [h = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(handler)]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> coop.make_agent&lt; <span class="hljs-keyword"><span class="hljs-keyword">a_stage_point_t</span></span>&lt;In, Out&gt; &gt;( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(h), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ) -&gt;so_direct_mbox(); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(builder) }; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙŠØªÙ„Ù‚Ù‰ <em>Ù…Ø¹Ø§Ù„Ø¬ Ù…Ø±Ø­Ù„Ø©</em> Ø§Ù„ÙØ¹Ù„ÙŠ ÙƒÙ…Ø¹Ù„Ù…Ø© ÙˆØ§Ø­Ø¯Ø©.  ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ù…Ø¤Ø´Ø±Ù‹Ø§ Ù„ÙˆØ¸ÙŠÙØ© Ø£Ùˆ ÙˆØ¸ÙŠÙØ© lambda Ø£Ùˆ functor.  ÙŠØªÙ… Ø§Ø³ØªÙ†Ø¨Ø§Ø· Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø±Ø¬Ø§Øª ÙÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø³Ø¨Ø¨ "Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø³Ø­Ø±" ÙˆØ±Ø§Ø¡ Ù‚Ø§Ù„Ø¨ <code>callable_traits_t</code> . </p><br><p style=";text-align:right;direction:rtl">  ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø«ÙŠÙ„ <em>Ù…Ù†Ø´Ø¦ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> Ø¯Ø§Ø®Ù„ ÙˆÙŠØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«ÙŠÙ„ ÙÙŠ ÙƒØ§Ø¦Ù† <code>stage_t</code> Ø¬Ø¯ÙŠØ¯ <code>stage_t</code> <code>stage()</code> .  ÙŠØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· <em>Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> Ø§Ù„ÙØ¹Ù„ÙŠ Ø¨ÙˆØ§Ø³Ø·Ø© Ø£Ø¯Ø§Ø© <em>Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> lambda ØŒ Ø«Ù… Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙƒÙŠÙ„ SObjectizer Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø³Ù†ØªØ­Ø¯Ø« Ø¹Ù† Ø°Ù„Ùƒ ÙÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„ØªØ§Ù„ÙŠ). </p><br><p style=";text-align:right;direction:rtl">  Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù‡ÙŠ <code>operator|()</code> Ø§Ù„Ø°ÙŠ ÙŠØ³Ù„Ø³Ù„ Ù…Ø±Ø­Ù„ØªÙŠÙ† Ù…Ø¹Ù‹Ø§ ÙˆÙŠØ¹ÙŠØ¯ Ù…Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out1, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out2 &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out2 &gt; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>|( <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out1 &gt; &amp;&amp; prev, <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; Out1, Out2 &gt; &amp;&amp; next ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span>{ [prev, next]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage ) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> m = next.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prev.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(m) ); } } }; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø¥Ù† Ø£Ø¨Ø³Ø· Ø·Ø±ÙŠÙ‚Ø© Ù„Ø´Ø±Ø­ Ù…Ù†Ø·Ù‚ <code>operator|()</code> Ù‡ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø±Ø³Ù… ØµÙˆØ±Ø©.  Ù„Ù†ÙØªØ±Ø¶ Ø£Ù† Ù„Ø¯ÙŠÙ†Ø§ Ø§Ù„ØªØ¹Ø¨ÙŠØ±: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">stage(A) | stage(B) | stage(C) | stage(B)</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jo/rr/aq/jorraqaawl6y7ju3om7zfq3java.jpeg"></p><br><p style=";text-align:right;direction:rtl">  Ù‡Ù†Ø§Ùƒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø£ÙŠØ¶Ù‹Ø§ Ø£Ù† Ù†Ø±Ù‰ ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ ÙØ­Øµ Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ø¬Ù…Ø©: ÙŠØªØ·Ù„Ø¨ ØªØ¹Ø±ÙŠÙ <code>operator|()</code> Ø£Ù† ÙŠÙƒÙˆÙ† Ù†ÙˆØ¹ Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‡Ùˆ Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©.  Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ø£Ù…Ø± ÙƒØ°Ù„Ùƒ ØŒ ÙÙ„Ù† ÙŠØªÙ… ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø´ÙØ±Ø©. </p><br><p style=";text-align:right;direction:rtl">  ÙˆØ§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¥Ù„Ù‚Ø§Ø¡ Ù†Ø¸Ø±Ø© Ø¹Ù„Ù‰ ÙˆØ¸ÙŠÙØ© Ø¨Ù†Ø§Ø¡ Ø®Ø·ÙˆØ· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ Ø§Ù„Ø£ÙƒØ«Ø± ØªØ¹Ù‚ÙŠØ¯Ù‹Ø§ ØŒ <code>broadcast()</code> .  Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù†ÙØ³Ù‡Ø§ Ø¨Ø³ÙŠØ·Ø© Ø¥Ù„Ù‰ Ø­Ø¯ Ù…Ø§: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Rest &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> &gt; broadcast( <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out &gt; &amp;&amp; first, Rest &amp;&amp;... stages ) { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [broadcasts = collect_sink_builders( move(first), forward&lt; Rest &gt;(stages)...)] ( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> ) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> &gt; mboxes; mboxes.reserve( broadcasts.size() ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp; b : broadcasts ) mboxes.emplace_back( b( coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>{} ) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">broadcast_mbox_t</span></span>::make( coop.environment(), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(mboxes) ); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(builder) }; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙˆØ§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø°Ø§Ø¹ÙŠØ© Ù‡Ùˆ Ø£Ù† Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¥Ø°Ø§Ø¹ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ØªØ­Ù…Ù„ Ù†Ø§Ù‚Ù„Ø§Øª <em>Ù…Ù†Ø´Ø¦ÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> Ø§Ù„ÙØ±Ø¹ÙŠØ©.  Ù„Ø°Ù„Ùƒ ÙŠØªØ¹ÙŠÙ† Ø¹Ù„ÙŠÙ†Ø§ Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØ¬Ù‡ ÙˆØªÙ…Ø±ÙŠØ±Ù‡ Ø¥Ù„Ù‰ <em>Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù…Ø³Ø±Ø­</em> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ <em>Ù„Ù…Ø±Ø­Ù„Ø©</em> Ø§Ù„Ø¨Ø«.  Ù„Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¨Ø¨ ØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø£Ù† Ù†Ø±Ù‰ Ø¯Ø¹ÙˆØ© Ø¥Ù„Ù‰ <code>collect_sink_builders</code> ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªÙ‚Ø§Ø· lambda Ø¯Ø§Ø®Ù„ ÙˆØ¸ÙŠÙØ© <code>broadcast()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [broadcasts = collect_sink_builders( move(first), forward&lt; Rest &gt;(stages)...)]</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø¥Ø°Ø§ Ù†Ø¸Ø±Ù†Ø§ Ø¥Ù„Ù‰ <code>collect_sink_builder</code> Ø§Ù„Ø±Ù…Ø² Ø§Ù„ØªØ§Ù„ÙŠ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // Serie of helper functions for building description for // `broadcast` stage. // // Those functions are used for collecting // `builders` functions for every child pipeline. // // Please note that this functions checks that each child pipeline has the // same In type. // template&lt; typename In, typename Out, typename... Rest &gt; void move_sink_builder_to( vector&lt; stage_builder_t &gt; &amp; receiver, stage_t&lt; In, Out &gt; &amp;&amp; first, Rest &amp;&amp;... rest ) { receiver.emplace_back( move( first.m_builder ) ); if constexpr( 0u != sizeof...(rest) ) move_sink_builder_to&lt;In&gt;( receiver, forward&lt; Rest &gt;(rest)... ); } template&lt; typename In, typename Out, typename... Rest &gt; vector&lt; stage_builder_t &gt; collect_sink_builders( stage_t&lt; In, Out &gt; &amp;&amp; first, Rest &amp;&amp;... stages ) { vector&lt; stage_builder_t &gt; receiver; receiver.reserve( 1 + sizeof...(stages) ); move_sink_builder_to&lt;In&gt;( receiver, move(first), std::forward&lt;Rest&gt;(stages)... ); return receiver; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙŠØ¹Ù…Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆÙ‚Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ Ù„Ù„ÙˆÙ‚Øª Ù‡Ù†Ø§ Ø£ÙŠØ¶Ù‹Ø§: Ù„Ø£Ù†Ù‡ ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…Ø¹Ù„Ù…Ø© <code>move_sink_builder_to</code> Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ "ÙÙŠ".  ÙŠØ¹Ù†ÙŠ Ø°Ù„Ùƒ Ø£Ù† Ø¥Ø¬Ø±Ø§Ø¡ Ù…ÙƒØ§Ù„Ù…Ø© ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ <code>collect_sink_builders(stage_t&lt;In1, Out1&gt;, stage_t&lt;In2, Out2&gt;, ...)</code> Ø³ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø­Ø¯ÙˆØ« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ù„Ø£Ù† Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ ÙŠØ­Ø¸Ø± Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© <code>move_sink_builder_to&lt;In1&gt;(receiver, stage_t&lt;In2, Out2&gt;, ...)</code> . </p><br><p style=";text-align:right;direction:rtl">  ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø£ÙŠØ¶Ù‹Ø§ Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ù†Ù‡ Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø£Ù† Ø¹Ø¯Ø¯ Ø®Ø·ÙˆØ· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ Ø§Ù„ÙØ±Ø¹ÙŠØ© <code>broadcast()</code> Ù…Ø¹Ø±ÙˆÙ ÙÙŠ ÙˆÙ‚Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© ØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… <code>std::array</code> Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† <code>std::vector</code> ÙˆÙŠÙ…ÙƒÙ† ØªØ¬Ù†Ø¨ Ø¨Ø¹Ø¶ Ø¹Ù…Ù„ÙŠØ§Øª ØªØ®ØµÙŠØµ Ø§Ù„Ø°Ø§ÙƒØ±Ø©.  Ù„ÙƒÙ† <code>std::vector</code> ÙŠØ³ØªØ®Ø¯Ù… Ù‡Ù†Ø§ ÙÙ‚Ø· Ù„Ù„Ø¨Ø³Ø§Ø·Ø©. </p><br><h2 id="relation-between-stages-and-sobjectizers-agentsmboxes" style=";text-align:right;direction:rtl">  Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø±Ø§Ø­Ù„ ÙˆÙˆÙƒÙ„Ø§Ø¡ / mboxes SObjectizer </h2><br><p style=";text-align:right;direction:rtl">  Ø§Ù„ÙÙƒØ±Ø© ÙˆØ±Ø§Ø¡ ØªÙ†ÙÙŠØ° Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ Ù‡ÙŠ Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙƒÙŠÙ„ Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ù…Ù† Ù…Ø±Ø§Ø­Ù„ Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨.  ÙŠØªÙ„Ù‚Ù‰ Ø§Ù„ÙˆÙƒÙŠÙ„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø±Ø¯Ø© ØŒ ÙˆÙŠÙ…Ø±Ø±Ù‡Ø§ Ø¥Ù„Ù‰ <em>Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ ØŒ ÙˆÙŠØ­Ù„Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© ØŒ ÙˆØ¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙØ§Ø±ØºØ© ØŒ ÙŠØ±Ø³Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒØ±Ø³Ø§Ù„Ø© ÙˆØ§Ø±Ø¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.  ÙŠÙ…ÙƒÙ† ØªÙˆØ¶ÙŠØ­Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ø®Ø·Ø· Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„ØªØ§Ù„ÙŠ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/om/pn/wy/ompnwye792gjgad7zzgphpv4ctu.png"></p><br><p style=";text-align:right;direction:rtl">  ÙŠØ¬Ø¨ Ù…Ù†Ø§Ù‚Ø´Ø© Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€ SObjectizer ØŒ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„ÙØªØ±Ø© ÙˆØ¬ÙŠØ²Ø©.  Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…Ù‡ØªÙ…Ù‹Ø§ Ø¨Ù…Ø«Ù„ Ù‡Ø°Ù‡ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ®Ø·ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø£Ø¯Ù†Ø§Ù‡ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ø³ØªÙ†ØªØ§Ø¬ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹. </p><br><h3 id="coop-is-a-group-of-agents-to-work-together" style=";text-align:right;direction:rtl">  Coop Ù‡ÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù„Ø¹Ù…Ù„ Ù…Ø¹Ù‹Ø§ </h3><br><p style=";text-align:right;direction:rtl">  ÙŠØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ ÙÙŠ SObjectizer Ù„ÙŠØ³ Ø¨Ø´ÙƒÙ„ ÙØ±Ø¯ÙŠ ÙˆÙ„ÙƒÙ† ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¨Ø§Ø³Ù… Ø­Ø¸Ø§Ø¦Ø±.  Ø­Ø¸ÙŠØ±Ø© Ù‡ÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø£Ù† ØªØ¹Ù…Ù„ Ù…Ø¹Ø§ ÙˆÙ„ÙŠØ³ Ù‡Ù†Ø§Ùƒ Ù…Ø¹Ù†Ù‰ Ù„Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„Ø¹Ù…Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø£Ø­Ø¯ ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ÙÙ‚ÙˆØ¯. </p><br><p style=";text-align:right;direction:rtl">  Ù„Ø°Ø§ ÙØ¥Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø¥Ù„Ù‰ SObjectizer ÙŠØ´Ø¨Ù‡ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø«ÙŠÙ„ Ø­Ø¸ÙŠØ±Ø© ØŒ ÙˆÙ…Ù„Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«ÙŠÙ„ Ø¨Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ÙŠÙ† Ø«Ù… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¸ÙŠØ±Ø© ÙÙŠ SObjectizer. </p><br><p style=";text-align:right;direction:rtl">  ÙˆØ¨Ø³Ø¨Ø¨ Ø°Ù„Ùƒ ØŒ ÙØ¥Ù† Ø§Ù„Ø­Ø¬Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ <em>Ù„Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù…Ø³Ø±Ø­</em> Ù‡ÙŠ Ø¥Ø´Ø§Ø±Ø© Ø¥Ù„Ù‰ Ø­Ø¸ÙŠØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©.  ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡Ø°Ø§ Ø­Ø¸ÙŠØ±Ø© ÙÙŠ ÙˆØ¸ÙŠÙØ© <code>make_pipeline()</code> (ØªÙ…Øª Ù…Ù†Ø§Ù‚Ø´ØªÙ‡Ø§ Ø£Ø¯Ù†Ø§Ù‡) ØŒ Ø«Ù… ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© <em>Ù…Ù†Ø´Ø¦ÙŠ Ø§Ù„Ù…Ø³Ø±Ø­</em> Ø«Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡Ø§ (Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙÙŠ ÙˆØ¸ÙŠÙØ© <code>make_pipeline()</code> ). </p><br><h3 id="message-boxes" style=";text-align:right;direction:rtl">  ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ </h3><br><p style=";text-align:right;direction:rtl">  ÙŠÙ†ÙØ° SObjectizer Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø§Ù„ØªØ²Ø§Ù…Ù†.  Ù…Ù…Ø«Ù„ Ù†Ù…ÙˆØ°Ø¬ ÙˆØ§Ø­Ø¯ Ù…Ù†Ù‡Ù… ÙÙ‚Ø·.  Ø¨Ø³Ø¨Ø¨ Ø°Ù„Ùƒ ØŒ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ®ØªÙ„Ù SObjectizer Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ± Ø¹Ù† Ø£Ø·Ø± Ø§Ù„ÙØ§Ø¹Ù„ Ø§Ù„Ø£Ø®Ø±Ù‰.  Ø£Ø­Ø¯ Ø§Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª Ù‡Ùˆ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù†ÙˆÙ†Ø© Ù„Ù„Ø±Ø³Ø§Ø¦Ù„. </p><br><p style=";text-align:right;direction:rtl">  Ù„Ø§ ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ SObjectizer Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„ÙØ§Ø¹Ù„Ø© ØŒ ÙˆÙ„ÙƒÙ† <em>Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</em> (mboxes).  ÙŠØªØ¹ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù…Ø«Ù„ÙŠÙ† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† mbox.  Ø¥Ø°Ø§ Ø§Ø´ØªØ±Ùƒ Ø£Ø­Ø¯ Ø§Ù„Ù…Ù…Ø«Ù„ÙŠÙ† ÙÙŠ Ù†ÙˆØ¹ Ø±Ø³Ø§Ù„Ø© Ù…Ø¹ÙŠÙ† Ù…Ù† mbox ØŒ ÙØ³ÙŠØªÙ„Ù‚Ù‰ Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/o4/bf/ee/o4bfee0lp8hdvks68cas4yjlkgu.png"></p><br><p style=";text-align:right;direction:rtl">  Ù‡Ø°Ù‡ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ø¶Ø±ÙˆØ±ÙŠØ© Ù„Ø£Ù†Ù‡ Ù…Ù† Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ù…Ø±Ø­Ù„Ø© Ø¥Ù„Ù‰ Ø£Ø®Ø±Ù‰.  ÙˆÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ù‡Ø§ mbox ÙˆØ£Ù† mbox ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø¹Ø±ÙˆÙØ© Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©. </p><br><p style=";text-align:right;direction:rtl">  ÙƒÙ„ Ù…Ù…Ø«Ù„ (Ø§Ù„Ù…Ù„Ù‚Ø¨ ÙˆÙƒÙŠÙ„) ÙÙŠ SObjectizer Ù„Ø¯ÙŠÙ‡ <em>mbox Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</em> .  ÙŠØ±ØªØ¨Ø· mbox Ù‡Ø°Ø§ Ø¨ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø· ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ù† Ù‚Ø¨Ù„ Ø£ÙŠ ÙˆÙƒÙ„Ø§Ø¡ Ø¢Ø®Ø±ÙŠÙ†.  Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… mboxes Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§ Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ. </p><br><p style=";text-align:right;direction:rtl">  ØªØ­Ø¯Ø¯ Ù…ÙŠØ²Ø© SObjectizer Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø¨Ø¹Ø¶ ØªÙØ§ØµÙŠÙ„ ØªÙ†ÙÙŠØ° Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨. </p><br><p style=";text-align:right;direction:rtl">  Ø§Ù„Ø£ÙˆÙ„ Ù‡Ùˆ Ø­Ù‚ÙŠÙ‚Ø© Ø£Ù† <em>Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù…Ø³Ø±Ø­</em> Ù„Ø¯ÙŠÙ‡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ø§Ù„ØªØ§Ù„ÙŠ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> builder(<span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp;, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† <em>Ù…Ù†Ø´Ø¦ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> ÙŠØªÙ„Ù‚Ù‰ mbox Ù…Ù† Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ÙˆÙŠØ¬Ø¨ Ø£Ù† ÙŠÙ†Ø´Ø¦ ÙˆÙƒÙŠÙ„Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ ÙŠØ±Ø³Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø¥Ù„Ù‰ Ø°Ù„Ùƒ mbox.  ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© mbox Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨ÙˆØ§Ø³Ø·Ø© <em>Ø¨Ø§Ù†ÙŠ Ø§Ù„Ù…Ø³Ø±Ø­</em> .  Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… mbox Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙƒÙŠÙ„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©. </p><br><p style=";text-align:right;direction:rtl">  ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ Ù‡Ùˆ Ø­Ù‚ÙŠÙ‚Ø© Ø£Ù† ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙƒÙ„Ø§Ø¡ Ù„Ù„Ù…Ø±Ø§Ø­Ù„ ÙÙŠ ØªØ±ØªÙŠØ¨ Ø§Ø­ØªÙŠØ§Ø·ÙŠ.  ÙˆÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù†Ù‡ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙ†Ø§ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">stage(A) | stage(B) | stage(C)</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙƒÙŠÙ„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© C Ø£ÙˆÙ„Ø§Ù‹ ØŒ Ø«Ù… Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… mbox Ø§Ù„Ø®Ø§Øµ Ø¨Ù‡ Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙƒÙŠÙ„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© B ØŒ ÙˆÙ…Ù† Ø«Ù… Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… mbox Ù…Ù† ÙˆÙƒÙŠÙ„ B- Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙƒÙŠÙ„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© A. </p><br><p style=";text-align:right;direction:rtl">  ØªØ¬Ø¯Ø± Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø¥Ù„Ù‰ Ø£Ù† <code>operator|()</code> Ù„Ø§ ÙŠÙ†Ø´Ø¦ ÙˆÙƒÙ„Ø§Ø¡: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span>{ [prev, next]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage ) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> m = next.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prev.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(m) ); } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙŠÙ†Ø´Ø¦ <code>operator|()</code> Ù…Ù†Ø´Ø¦Ù‹Ø§ ÙŠØ³ØªØ¯Ø¹ÙŠ Ù…Ù†Ø´Ø¦ÙŠÙ† Ø¢Ø®Ø±ÙŠÙ† ÙÙ‚Ø· ÙˆÙ„ÙƒÙ† Ù„Ø§ ÙŠÙ‚Ø¯Ù… Ø¹ÙˆØ§Ù…Ù„ Ø¥Ø¶Ø§ÙÙŠØ©.  Ù„Ø°Ù„Ùƒ Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ù‚Ø¶ÙŠØ©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">stage(A) | stage(B)</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙƒÙŠÙ„ÙŠÙ† ÙÙ‚Ø· (Ù„Ù„Ù…Ø±Ø­Ù„Ø© A Ùˆ B- Ø§Ù„Ù…Ø±Ø­Ù„Ø©) ÙˆØ¨Ø¹Ø¯ Ø°Ù„Ùƒ Ø³ÙŠØªÙ… Ø±Ø¨Ø·Ù‡Ù…Ø§ Ù…Ø¹Ù‹Ø§ ÙÙŠ <em>Ù…Ù†Ø´Ø¦ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø°ÙŠ</em> ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© <code>operator|()</code> . </p><br><h3 id="there-is-no-agent-for-broadcast-implementation" style=";text-align:right;direction:rtl">  Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆÙƒÙŠÙ„ Ù„ØªØ·Ø¨ÙŠÙ‚ <code>broadcast()</code> </h3><br><p style=";text-align:right;direction:rtl">  ØªØªÙ…Ø«Ù„ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„ÙˆØ§Ø¶Ø­Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¨Ø« ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙƒÙŠÙ„ Ø®Ø§Øµ ÙŠØªÙ„Ù‚Ù‰ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø±Ø¯Ø© Ø«Ù… ÙŠØ¹ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ù…Ø±Ø¨Ø¹Ø§Øª mbox Ø§Ù„Ù…Ù‚ØµÙˆØ¯Ø©.  <a href="">ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…</a> Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© <a href="">ÙÙŠ Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ø£ÙˆÙ„</a> Ù„Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ DSL Ø§Ù„Ù…ÙˆØµÙˆÙ. </p><br><p style=";text-align:right;direction:rtl">  Ù„ÙƒÙ† Ù…Ø´Ø±ÙˆØ¹Ù†Ø§ Ø§Ù„Ù…ØµØ§Ø­Ø¨ ØŒ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">so5extra</a> ØŒ Ù„Ø¯ÙŠÙ‡ Ø§Ù„Ø¢Ù† Ù†ÙˆØ¹ Ø®Ø§Øµ Ù…Ù† mbox: Ø¥Ø°Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©.  ÙŠØ¹Ù…Ù„ mbox Ø¨Ø§Ù„Ø¶Ø¨Ø· Ø¹Ù„Ù‰ Ù…Ø§ Ù‡Ùˆ Ù…Ø·Ù„ÙˆØ¨ Ù‡Ù†Ø§: ÙÙ‡Ùˆ ÙŠØ£Ø®Ø° Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙŠÙ‚ÙˆÙ… Ø¨ØªØ³Ù„ÙŠÙ…Ù‡Ø§ Ø¥Ù„Ù‰ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† mboxes Ø§Ù„ÙˆØ¬Ù‡Ø©. </p><br><p style=";text-align:right;direction:rtl">  Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø­Ø§Ø¬Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆÙƒÙŠÙ„ Ø¨Ø« Ù…Ù†ÙØµÙ„ ØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ ÙÙ‚Ø· Ø§Ø³ØªØ®Ø¯Ø§Ù… mbox Ù„Ù„Ø¨Ø« Ù…Ù† so5extra: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // A special mbox for broadcasting of a message to a set of destination // mboxes. // using broadcast_mbox_t = so_5::extra::mboxes::broadcast::fixed_mbox_template_t&lt;&gt;; ... // // Inside the broadcast() function: // stage_builder_t builder{ [broadcasts = collect_sink_builders( move(first), forward&lt; Rest &gt;(stages)...)] ( coop_t &amp; coop, mbox_t ) -&gt; mbox_t { vector&lt; mbox_t &gt; mboxes; mboxes.reserve( broadcasts.size() ); for( const auto &amp; b : broadcasts ) mboxes.emplace_back( b( coop, mbox_t{} ) ); // That is the creation of broadcasting mbox instance. return broadcast_mbox_t::make( coop.environment(), std::move(mboxes) ); } };</span></span></code> </pre> <br><h3 id="implementation-of-stage-agent" style=";text-align:right;direction:rtl">  ØªÙ†ÙÙŠØ° ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø±Ø­Ù„Ø© </h3><br><p style=";text-align:right;direction:rtl">  Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¥Ù„Ù‚Ø§Ø¡ Ù†Ø¸Ø±Ø© Ø¹Ù„Ù‰ ØªÙ†ÙÙŠØ° ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø±Ø­Ù„Ø©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // An agent which will be used as intermediate or terminal pipeline stage. // It will receive input message, call the stage handler and pass // handler result to the next stage (if any). // template&lt; typename In, typename Out &gt; class a_stage_point_t final : public agent_t { public : a_stage_point_t( context_t ctx, stage_handler_t&lt; In, Out &gt; handler, mbox_t next_stage ) : agent_t{ ctx } , m_handler{ move( handler ) } , m_next{ move(next_stage) } {} void so_define_agent() override { if( m_next ) // Because there is the next stage the appropriate // message handler will be used. so_subscribe_self().event( [=]( const In &amp; evt ) { auto r = m_handler( evt ); if( r ) so_5::send( m_next, r ); } ); else // There is no next stage. A very simple message handler // will be used for that case. so_subscribe_self().event( [=]( const In &amp; evt ) { m_handler( evt ); } ); } private : const stage_handler_t&lt; In, Out &gt; m_handler; const mbox_t m_next; }; // // A specialization of a_stage_point_t for the case of terminal stage of // a pipeline. This type will be used for stage handlers with void // return type. // template&lt; typename In &gt; class a_stage_point_t&lt; In, void &gt; final : public agent_t { public : a_stage_point_t( context_t ctx, stage_handler_t&lt; In, void &gt; handler, mbox_t next_stage ) : agent_t{ ctx } , m_handler{ move( handler ) } { if( next_stage ) throw std::runtime_error( "sink point cannot have next stage" ); } void so_define_agent() override { so_subscribe_self().event( [=]( const In &amp; evt ) { m_handler( evt ); } ); } private : const stage_handler_t&lt; In, void &gt; m_handler; };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø§Ù†Ù‡Ø§ ØªØ§ÙÙ‡Ø© Ø¥Ù„Ù‰ Ø­Ø¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒÙ†Øª ØªÙÙ‡Ù… Ø£Ø³Ø§Ø³ÙŠØ§Øª SObjectizer.  Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ø£Ù…Ø± ÙƒØ°Ù„Ùƒ ØŒ ÙØ³ÙŠÙƒÙˆÙ† Ù…Ù† Ø§Ù„ØµØ¹Ø¨ Ù„Ù„ØºØ§ÙŠØ© Ø´Ø±Ø­Ù‡ Ø¨Ø¹Ø¯Ø© ÙƒÙ„Ù…Ø§Øª (Ù„Ø°Ù„Ùƒ Ù„Ø§ ØªØªØ±Ø¯Ø¯ ÙÙŠ Ø·Ø±Ø­ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª). </p><br><p style=";text-align:right;direction:rtl">  ÙŠÙ‚ÙˆÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„ÙˆÙƒÙŠÙ„ <code>a_stage_point_t</code> Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù†ÙˆØ¹ In.  Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ ØŒ ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ <em>Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> .  ÙÙŠ Ø­Ø§Ù„Ø© Ø¥Ø±Ø¬Ø§Ø¹ <em>Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> Ù„Ù†ØªÙŠØ¬Ø© ÙØ¹Ù„ÙŠØ© ØŒ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØªÙ„Ùƒ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©). </p><br><p style=";text-align:right;direction:rtl">  ÙŠÙˆØ¬Ø¯ Ø£ÙŠØ¶Ù‹Ø§ Ø¥ØµØ¯Ø§Ø± <code>a_stage_point_t</code> Ù„Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯Ù…Ø§ ØªÙƒÙˆÙ† Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© Ù‡ÙŠ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©. </p><br><p style=";text-align:right;direction:rtl">  Ù‚Ø¯ ÙŠØ¨Ø¯Ùˆ ØªØ·Ø¨ÙŠÙ‚ <code>a_stage_point_t</code> Ù…Ø¹Ù‚Ø¯Ù‹Ø§ Ø¨Ø¹Ø¶ Ø§Ù„Ø´ÙŠØ¡ ÙˆÙ„ÙƒÙ† <code>a_stage_point_t</code> ØŒ Ø¥Ù†Ù‡ Ø£Ø­Ø¯ Ø£Ø¨Ø³Ø· Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„ØªÙŠ ÙƒØªØ¨ØªÙ‡Ø§. </p><br><h2 id="make_pipeline-function" style=";text-align:right;direction:rtl">  ÙˆØ¸ÙŠÙØ© make_pipeline () </h2><br><p style=";text-align:right;direction:rtl">  Ø­Ø§Ù† Ø§Ù„ÙˆÙ‚Øª Ù„Ù…Ù†Ø§Ù‚Ø´Ø© Ø¢Ø®Ø± ÙˆØ¸ÙŠÙØ© Ù„Ø¨Ù†Ø§Ø¡ Ø®Ø·ÙˆØ· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ØŒ <code>make_pipeline()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Args &gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> make_pipeline( <span class="hljs-comment"><span class="hljs-comment">// SObjectizer Environment to work in. so_5::environment_t &amp; env, // Definition of a pipeline. stage_t&lt; In, Out &gt; &amp;&amp; sink, // Optional args to be passed to make_coop() function. Args &amp;&amp;... args ) { auto coop = env.make_coop( forward&lt; Args &gt;(args)... ); auto mbox = sink.m_builder( *coop, mbox_t{} ); env.register_coop( move(coop) ); return mbox; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø­Ø± ÙˆÙ„Ø§ Ù…ÙØ§Ø¬Ø¢Øª Ù‡Ù†Ø§.  Ù†Ø­ØªØ§Ø¬ ÙÙ‚Ø· Ø¥Ù„Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¸ÙŠØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ØŒ ÙˆÙ…Ù„Ø¡ ØªÙ„Ùƒ Ø§Ù„Ù‚ÙˆÙ‚Ø¹Ø© Ø¨Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ <em>Ù…Ù†Ø´Ø¦ Ù…Ø±Ø­Ù„Ø© Ù…Ù†</em> Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø¹Ù„Ù‰ ØŒ ÙˆÙ…Ù† Ø«Ù… ØªØ³Ø¬ÙŠÙ„ Ø°Ù„Ùƒ Ø§Ù„Ù‚ÙØ§Ø² ÙÙŠ SObjectizer.  Ù‡Ø°Ø§ ÙƒÙ„ Ø´ÙŠØ¡. </p><br><p style=";text-align:right;direction:rtl">  Ù†ØªÙŠØ¬Ø© <code>make_pipeline()</code> Ù‡ÙŠ mbox Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙƒØ«Ø± ÙŠØ³Ø§Ø±Ù‹Ø§ (Ø§Ù„Ø£ÙˆÙ„Ù‰) Ù…Ù† Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨.  ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… mbox Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¥Ù„Ù‰ Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨. </p><br><h1 id="the-simulation-and-experiments-with-it" style=";text-align:right;direction:rtl">  Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© ÙˆØ§Ù„ØªØ¬Ø§Ø±Ø¨ Ù…Ø¹Ù‡Ø§ </h1><br><p style=";text-align:right;direction:rtl">  Ø¥Ø°Ù† Ù„Ø¯ÙŠÙ†Ø§ Ø§Ù„Ø¢Ù† Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙˆØ¸Ø§Ø¦ÙÙ‡Ø§ Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø¯ÙŠÙ†Ø§ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„ØªØ³Ù„Ø³Ù„ ØªÙ„Ùƒ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø¥Ù„Ù‰ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.  Ø¯Ø¹ÙˆÙ†Ø§ Ù†ÙØ¹Ù„ Ø°Ù„Ùƒ ÙˆÙ†Ø±Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Launch SObjectizer in a separate thread. wrapped_env_t sobj; // Make a pipeline. auto pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(archiving), stage(distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(alarm_initiator), stage( []( const alarm_detected &amp; v ) { alarm_distribution( cerr, v ); } ) ) ) ); // Send messages to a pipeline in a loop with 10ms delays. for( uint8_t i = 0; i &lt; static_cast&lt; uint8_t &gt;(250); i += 10 ) { send&lt; raw_value &gt;( pipeline, raw_measure{ 0, 0, i } ); std::this_thread::sleep_for( chrono::milliseconds{10} ); } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø¥Ø°Ø§ Ù‚Ù…Ù†Ø§ Ø¨ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«Ø§Ù„ ØŒ ÙØ³Ù†Ø±Ù‰ Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„ØªØ§Ù„ÙŠ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">archiving (0,0) distributing (0,0) archiving (0,5) distributing (0,5) archiving (0,10) distributing (0,10) archiving (0,15) distributing (0,15) archiving (0,20) distributing (0,20) archiving (0,25) distributing (0,25) archiving (0,30) distributing (0,30) ... archiving (0,105) distributing (0,105) archiving (0,110) distributing (0,110) === alarm (0) === alarm_distribution (0) archiving (0,115) distributing (0,115) archiving (0,120) distributing (0,120) === alarm (0) === alarm_distribution (0)</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ø¥Ù†Ù‡ ÙŠØ¹Ù…Ù„. </p><br><p style=";text-align:right;direction:rtl">  Ù„ÙƒÙ† ÙŠØ¨Ø¯Ùˆ Ø£Ù† Ù…Ø±Ø§Ø­Ù„ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨Ù†Ø§ ØªØ¹Ù…Ù„ Ø¨Ø§Ù„ØªØªØ§Ø¨Ø¹ ØŒ ÙˆØ§Ø­Ø¯Ø© ØªÙ„Ùˆ Ø§Ù„Ø£Ø®Ø±Ù‰ ØŒ Ø£Ù„ÙŠØ³ ÙƒØ°Ù„ÙƒØŸ </p><br><p style=";text-align:right;direction:rtl">  Ù†Ø¹Ù… Ù‡Ùˆ ÙƒØ°Ù„Ùƒ.  ÙˆØ°Ù„Ùƒ Ù„Ø£Ù† Ø¬Ù…ÙŠØ¹ ÙˆÙƒÙ„Ø§Ø¡ Ø®Ø·ÙˆØ· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ Ù…Ø±ØªØ¨Ø·ÙˆÙ† Ø¨Ù€ Ù…Ø±Ø³Ù„ SObjectizer Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ.  ÙˆÙŠØ³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±Ø³Ù„ Ø®ÙŠØ· Ø¹Ø§Ù…Ù„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ù„Ø®Ø¯Ù…Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡. </p><br><p style=";text-align:right;direction:rtl">  ÙˆÙ„ÙƒÙ† Ù‡Ø°Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ Ø¨Ø³Ù‡ÙˆÙ„Ø©.  Ù…Ø§ Ø¹Ù„ÙŠÙƒ <code>make_pipeline()</code> ØªÙ…Ø±ÙŠØ± ÙˆØ³ÙŠØ·Ø© Ø¥Ø¶Ø§ÙÙŠØ© <code>make_pipeline()</code> Ù…ÙƒØ§Ù„Ù…Ø© <code>make_pipeline()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Make a pipeline. auto pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(archiving), stage(distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(alarm_initiator), stage( []( const alarm_detected &amp; v ) { alarm_distribution( cerr, v ); } ) ) ), disp::thread_pool::make_dispatcher( sobj.environment() ).binder( disp::thread_pool::bind_params_t{}.fifo( disp::thread_pool::fifo_t::individual ) ) );</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ø¥Ù„Ù‰ Ø¥Ù†Ø´Ø§Ø¡ ØªØ¬Ù…Ø¹ Ù…Ø¤Ø´Ø±Ø§Øª ØªØ±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯ ÙˆÙŠØ±Ø¨Ø· ÙƒØ§ÙØ© Ø¹ÙˆØ§Ù…Ù„ Ø®Ø· Ø£Ù†Ø§Ø¨ÙŠØ¨ Ø¥Ù„Ù‰ Ø°Ù„Ùƒ Ø§Ù„ØªØ¬Ù…Ø¹.  Ø³ÙŠØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù„ÙƒÙ„ ÙˆÙƒÙŠÙ„ Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ‚Ù„ Ø¹Ù† Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†. </p><br><p style=";text-align:right;direction:rtl">  Ø¥Ø°Ø§ Ù‚Ù…Ù†Ø§ Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ Ø§Ù„Ù…Ø¹Ø¯Ù„ ØŒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø£Ù† Ù†Ø±Ù‰ Ø´ÙŠØ¦Ù‹Ø§ ÙƒÙ‡Ø°Ø§: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">archiving (0,0) distributing (0,0) distributing (0,5) archiving (0,5) archiving (0,10) distributing (0,10) distributing (archiving (0,15) 0,15) archiving (0,20) distributing (0,20) archiving (0,25) distributing (0,25) archiving (0,distributing (030) ,30) ... archiving (0,distributing (0,105) 105) archiving (0,alarm_distribution (0) distributing (0,=== alarm (0) === 110) 110) archiving (distributing (0,0,115) 115) archiving (distributing (=== alarm (0) === 0alarm_distribution (0) 0,120) ,120)</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù„Ø°Ù„Ùƒ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø£Ù† Ù†Ø±Ù‰ Ø£Ù† Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù„Ø®Ø· Ø§Ù„Ø£Ù†Ø§Ø¨ÙŠØ¨ ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…ØªÙˆØ§Ø²Ù. </p><br><p style=";text-align:right;direction:rtl">  ÙˆÙ„ÙƒÙ† Ù‡Ù„ Ù…Ù† Ø§Ù„Ù…Ù…ÙƒÙ† Ø§Ù„Ù…Ø¶ÙŠ Ù‚Ø¯Ù…Ù‹Ø§ ÙˆÙ„Ø¯ÙŠÙ†Ø§ Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø±Ø¨Ø· Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø¨Ø§Ù„Ù…Ø±Ø³Ù„ÙŠÙ† Ø§Ù„Ù…Ø®ØªÙ„ÙÙŠÙ†ØŸ </p><br><p style=";text-align:right;direction:rtl">  Ù†Ø¹Ù… ØŒ Ù‡Ø°Ø§ Ù…Ù…ÙƒÙ† ØŒ Ù„ÙƒÙ† ÙŠØªØ¹ÙŠÙ† Ø¹Ù„ÙŠÙ†Ø§ ØªÙ†ÙÙŠØ° ÙˆØ¸ÙŠÙØ© Ø­Ù…Ù„ Ø²Ø§Ø¦Ø¯ Ø£Ø®Ø±Ù‰ <code>stage()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Callable, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::arg_type, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::result_type &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out &gt; stage( <span class="hljs-keyword"><span class="hljs-keyword">disp_binder_shptr_t</span></span> disp_binder, Callable handler ) { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [binder = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(disp_binder), h = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(handler)]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> coop.make_agent_with_binder&lt; <span class="hljs-keyword"><span class="hljs-keyword">a_stage_point_t</span></span>&lt;In, Out&gt; &gt;( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(binder), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(h), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ) -&gt;so_direct_mbox(); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(builder) }; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  Ù„Ø§ ÙŠÙ‚Ø¨Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ù…Ù† <code>stage()</code> <em>Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±Ø­Ù„Ø©</em> ÙØ­Ø³Ø¨ ØŒ Ø¨Ù„ ÙŠÙ‚Ø¨Ù„ Ø£ÙŠØ¶Ù‹Ø§ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø±Ø³ÙÙ„. Dispatcher binder is a way to bind an agent to the particular dispatcher. So to assign a stage to a specific working context we can create an appropriate dispatcher and then pass the binder to that dispatcher to <code>stage()</code> function. Let's do that: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// An active_obj dispatcher to be used for some stages. auto ao_disp = disp::active_obj::make_dispatcher( sobj.environment() ); // Make a pipeline. auto pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(ao_disp.binder(), archiving), stage(ao_disp.binder(), distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(ao_disp.binder(), alarm_initiator), stage(ao_disp.binder(), []( const alarm_detected &amp; v ) { alarm_distribution( cerr, v ); } ) ) ), disp::one_thread::make_dispatcher( sobj.environment() ).binder() );</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> In that case stages <code>archiving</code> , <code>distribution</code> , <code>alarm_initiator</code> and <code>alarm_distribution</code> will work on own worker threads. All other stages will work on the same single worker thread. </p><br><h1 id="the-conclusion" style=";text-align:right;direction:rtl"> The conclusion </h1><br><p style=";text-align:right;direction:rtl"> This was an interesting experiment and I was surprised how easy SObjectizer could be used in something like reactive programming or data-flow programming. </p><br><p style=";text-align:right;direction:rtl"> However, I don't think that pipeline DSL can be practically meaningful. It's too simple and, maybe not flexible enough. But, I hope, it can be a base for more interesting experiments for those why need to deal with different workflows and data-processing pipelines. At least as a base for some ideas in that area. C++ language a rather good here and some (not so complicated) template magic can help to catch various errors at compile-time. </p><br><p style=";text-align:right;direction:rtl"> In conclusion, I want to say that we see SObjectizer not as a specialized tool for solving a particular problem, but as a basic set of tools to be used in solutions for different problems. And, more importantly, that basic set can be extended for your needs. Just take a look at <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SObjectizer</a> , try it, and share your feedback. Maybe you missed something in SObjectizer? Perhaps you don't like something? <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Tell us</a> , and we can try to help you. </p><br><p style=";text-align:right;direction:rtl"> If you want to help further development of SObjectizer, please share a reference to it or to this article somewhere you want (Reddit, HackerNews, LinkedIn, Facebook, Twitter, ...). The more attention and the more feedback, the more new features will be incorporated into SObjectizer. </p><br><p style=";text-align:right;direction:rtl"> And many thanks for reading this ;) </p><br><p style=";text-align:right;direction:rtl">  PS. The source code for that example can be found in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">that repository</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar460123/">https://habr.com/ru/post/ar460123/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar460113/index.html">Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ØµØµ Ù…Ù† Ø­ÙŠØ§Ø© JSOC CERT ØŒ Ø£Ùˆ Ø§Ù„Ø·Ø¨ Ø§Ù„Ø´Ø±Ø¹ÙŠ Unbanal</a></li>
<li><a href="../ar460115/index.html">Ø¹Ø´Ø± Ø³Ù†ÙˆØ§Øª Ù…Ù† Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© ÙÙŠ Erlang</a></li>
<li><a href="../ar460117/index.html">Ù‡Ù„ Ø£ÙƒØ¨Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙÙŠ Ø±ÙˆØ³ÙŠØ§ Ù‡Ùˆ Ø§Ù„ÙÙˆØ² Ø¨Ø§Ù„Ø¬Ø§Ø¦Ø²Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰ Ø£Ù… Ø§Ù„ØµØ¯Ø§Ø¹ØŸ ØªØ¬Ø±Ø¨Ø© Ø£Ø¬ÙŠÙ…Ø§</a></li>
<li><a href="../ar460119/index.html">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø®Ø·Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø«Ø§Ø¨Øª Ù„Ø£Ù†Ù‡ Ù„Ø§ ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡</a></li>
<li><a href="../ar460121/index.html">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø®Ø·Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø«Ø§Ø¨Øª Ù„Ø£Ù†Ù‡ Ù„Ø§ ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡</a></li>
<li><a href="../ar460125/index.html">Node.js Ø£Ùˆ Java: Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙˆØ§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ¯ÙÙ‚ ÙˆØ§Ù„Ø´Ø¹Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</a></li>
<li><a href="../ar460129/index.html">Ø§Ù„Ø±ÙˆØ¨ÙˆØªØ§Øª ÙˆØ§Ù„ÙØ±Ø§ÙˆÙ„Ø©: ÙƒÙŠÙ ØªØ²ÙŠØ¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ØºÙ„Ø© Ø§Ù„Ø­Ù‚Ù„ÙŠØ©</a></li>
<li><a href="../ar460131/index.html">Sophos XG Firewall: Ù…Ù† ME Ø§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ Ø¥Ù„Ù‰ NGFW Ù…Ø¹ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ø­ÙˆØ§Ø¯Ø« Ø£Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</a></li>
<li><a href="../ar460133/index.html">Kotlin / Everywhere - Ù…Ù…Ø§Ø±Ø³Ø© Ø¹Ø±Ø¶: 31 ÙŠÙˆÙ„ÙŠÙˆ</a></li>
<li><a href="../ar460135/index.html">Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£Ù…Ø§Ù† 29: Ø§Ù„ØªÙƒØ¨ÙŠØ± ØŒ Ø§Ù„Ø£Ù…Ù† ØŒ ÙˆØ¯Ø±Ø§Ù…Ø§ Ø§Ù„Ø¶Ø¹Ù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>