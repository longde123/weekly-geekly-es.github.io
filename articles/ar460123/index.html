<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐ป ๐ข ๐ ุฎุท ุฃูุงุจูุจ ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุนูู ุนูู ุฑุฃุณ ุงูุฌูุงุช ุงููุงุนูุฉุ ูู ูุงุ ๐๐พ ๐ฉ๐ผโ๐คโ๐ฉ๐ป ๐ท๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุฐ ุจุนุถ ุงูููุช ุ ูู ููุงูุดุฉ ุญูู ุฃุญุฏ ุฅุตุฏุงุฑุงุช SObjectizer ุ ุณูุฆููุง: "ูู ูู ุงููููู ุฅูุดุงุก DSL ููุตู ุฎุท ุฃูุงุจูุจ ูุนุงูุฌุฉ ุงูุจูุงูุงุชุ" ุจูุนูู ุขุฎุฑ ุ ูู ูููู ูุชุงุจุฉ ุดูุก...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฎุท ุฃูุงุจูุจ ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุนูู ุนูู ุฑุฃุณ ุงูุฌูุงุช ุงููุงุนูุฉุ ูู ูุงุ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460123/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ููุฐ ุจุนุถ ุงูููุช ุ ูู ููุงูุดุฉ ุญูู ุฃุญุฏ ุฅุตุฏุงุฑุงุช SObjectizer ุ ุณูุฆููุง: "ูู ูู ุงููููู ุฅูุดุงุก DSL ููุตู ุฎุท ุฃูุงุจูุจ ูุนุงูุฌุฉ ุงูุจูุงูุงุชุ"  ุจูุนูู ุขุฎุฑ ุ ูู ูููู ูุชุงุจุฉ ุดูุก ูุงูุชุงูู: </p><br><p style=";text-align:right;direction:rtl"><code>A | B | C | D</code> </p> <br><p style=";text-align:right;direction:rtl">  ูุงุญุตู ุนูู ุฎุท ุฃูุงุจูุจ ูุนูู ุญูุซ ุชูุชูู ุงูุฑุณุงุฆู ูู A ุฅูู B ุ ุซู ุฅูู C ุ ุซู ุฅูู D. ูุน ุงูุชุญูู ุ ูุชููู B ุจุงูุถุจุท ูุฐุง ุงูููุน ุงูุฐู ุชูุฑุฌุนู A.  ููุชููู C ุจุงูุถุจุท ูุฐุง ุงูููุน ุงูุฐู ูุนูุฏ B.  ู ููุฐุง. </p><br><p style=";text-align:right;direction:rtl">  ููุฏ ูุงูุช ูููุฉ ูุซูุฑุฉ ููุงูุชูุงู ูุน ุญู ุจุณูุท ุจุดูู ูุฏูุด.  ุนูู ุณุจูู ุงููุซุงู ุ ููุฐุง ูุจุฏู ุฅูุดุงุก ุฎุท ุฃูุงุจูุจ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pipeline = make_pipeline(env, stage(A) | stage(B) | stage(C) | stage(D));</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃู ูู ุญุงูุฉ ุฃูุซุฑ ุชุนููุฏูุง (ุณูุชู ููุงูุดุชูุง ุฃุฏูุงู): </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(archiving), stage(distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(alarm_initiator), stage( []( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> alarm_detected &amp; v ) { alarm_distribution( <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span>, v ); } ) ) ) );</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ุณูุชุญุฏุซ ุนู ุชูููุฐ ุฎุท ุงูุฃูุงุจูุจ DSL ูุฐุง.  ุณููุงูุด ูู ุงูุบุงูุจ ุงูุฃุฌุฒุงุก ุงููุชุนููุฉ <code>stage()</code> ุ <code>broadcast()</code> <code>operator|()</code> ููุธุงุฆู <code>operator|()</code> ูุน ุงูุนุฏูุฏ ูู ุงูุฃูุซูุฉ ุนูู ุงุณุชุฎุฏุงู ููุงูุจ C ++.  ูุฐุง ุขูู ุฃู ูููู ุงูุฃูุฑ ููุชุนูุง ุญุชู ุจุงููุณุจุฉ ูููุฑุงุก ุงูุฐูู ูุง ูุนุฑููู ุนู SObjectizer (ุฅุฐุง ูู ุชุณูุน ุนู SObjectizer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> ููู ูุธุฑุฉ ุนุงูุฉ ุนูู ูุฐู ุงูุฃุฏุงุฉ). </p><a name="habracut"></a><br><h1 id="a-couple-of-words-about-the-used-demo" style=";text-align:right;direction:rtl">  ุจุถุน ูููุงุช ุญูู ุงูุชุฌุฑูุจู ุงููุณุชุฎุฏูุฉ </h1><br><p style=";text-align:right;direction:rtl">  ุชุฃุซุฑ ุงููุซุงู ุงููุณุชุฎุฏู ูู ุงูููุงูุฉ ุจุชุฌุฑุจุชู ุงููุฏููุฉ (ูุงูููุณูุฉ) ูู ููุทูุฉ SCADA. </p><br><p style=";text-align:right;direction:rtl">  ููุฑุฉ ุงูุนุฑุถ ุงูุชูุถูุญู ูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงูููุฑูุกุฉ ูู ุจุนุถ ุฃุฌูุฒุฉ ุงูุงุณุชุดุนุงุฑ.  ูุชู ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ูู ุฌูุงุฒ ุงุณุชุดุนุงุฑ ูุน ุจุนุถ ุงููุชุฑุฉ ุ ุซู ูุฌุจ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช (ูุฌุจ ุชุฌุงูู ุงูุจูุงูุงุช ุบูุฑ ุงูุตุญูุญุฉ) ูุชุญููููุง ุฅูู ุจุนุถ ุงูููู ุงููุนููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูููู ุฃู ุชููู ุงูุจูุงูุงุช ุงูุฃูููุฉ ุงูููุฑูุกุฉ ูู ูุณุชุดุนุฑ ูููุชูู ุตุญูุญุชูู 8 ุจุช ููุฌุจ ุชุญููู ุชูู ุงูููู ุฅูู ุฑูู ุงููุงุตูุฉ ุงูุนุงุฆูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุซู ููุจุบู ุฃุฑุดูุฉ ุงูููู ุงูุตุงูุญุฉ ูุงููุญูููุฉ ุ ูุชูุฒูุนูุง ูู ููุงู ูุง (ุนูู ุนูุฏ ูุฎุชููุฉ ููุชุฎูู ุ ุนูู ุณุจูู ุงููุซุงู) ุ ูุงูุชุญูู ูู ูุฌูุฏ "ุฅูุฐุงุฑุงุช" (ุฅุฐุง ูุงูุช ุงูููู ุฎุงุฑุฌุฉ ุนู ูุทุงูุงุช ุขููุฉ ุ ููุฌุจ ูุนุงูุฌุฉ ุฐูู ุจุดูู ุฎุงุต).  ูุฐู ุงูุนูููุงุช ูุณุชููุฉ ููููู ุชูููุฐูุง ุนูู ุงูุชูุงุฒู. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุฅุฌุฑุงุก ุงูุนูููุงุช ุงููุชุนููุฉ ุจุงูุฅูุฐุงุฑ ุงูููุชุดู ุจุดูู ูุชูุงุฒู ุฃูุถูุง: ูุฌุจ ุจุฏุก "ุงูููุจู" (ุญุชู ูููู ูุฌุฒุก SCADA ุนูู ุงูุนูุฏุฉ ุงูุญุงููุฉ ุฃู ูุชูุงุนู ูุนู) ููุฌุจ ุชูุฒูุน ุงููุนูููุงุช ุญูู "ุงูููุจู" ูู ููุงู ุขุฎุฑ (ุนูู ุณุจูู ุงููุซุงู : ุชุฎุฒูููุง ูู ูุงุนุฏุฉ ุจูุงูุงุช ุชุงุฑูุฎูุฉ ู / ุฃู ุชุตูุฑ ุนูู ุดุงุดุฉ ูุดุบู SCADA). </p><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุชุนุจูุฑ ุนู ูุฐุง ุงูููุทู ุจุดูู ูุตู ุจูุฐู ุงูุทุฑููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">optional(valid_raw_data) = validate(raw_data); if valid_raw_data is not empty then { converted_value = convert(valid_raw_data); do_async archive(converted_value); do_async distribute(converted_value); do_async { optional(suspicious_value) = check_range(converted_value); if suspicious_value is not empty then { optional(alarm) = detect_alarm(suspicious_value); if alarm is not empty then { do_async initiate_alarm(alarm); do_async distribute_alarm(alam); } } } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃู ุ ูู ุดูู ุฑุณูู ุจูุงููุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/5z/nm/vv/5znmvvaqnou_qwh808t8vkbrdc8.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ุฅูู ูุซุงู ูุตุทูุน ุฅูู ุญุฏ ูุง ุ ููููู ูุญุชูู ุนูู ุจุนุถ ุงูุฃุดูุงุก ุงููุซูุฑุฉ ููุงูุชูุงู ุงูุชู ุฃุฑูุฏ ุนุฑุถูุง.  ุงูุฃูู ูู ูุฌูุฏ ูุฑุงุญู ูุชูุงุฒูุฉ ูู ุฎุท ุฃูุงุจูุจ (ุนูููุฉ <code>broadcast()</code> ููุฌูุฏุฉ ููุท ุจุณุจุจ ุฐูู).  ูุงูุซุงูู ูู ูุฌูุฏ ุฏููุฉ ูู ุจุนุถ ุงููุฑุงุญู.  ุนูู ุณุจูู ุงููุซุงู ุ alarm_detector ูู ูุฑุญูุฉ ุงูุฏููุฉ. </p><br><h1 id="pipeline-capabilities" style=";text-align:right;direction:rtl">  ูุฏุฑุงุช ุฎุทูุท ุงูุฃูุงุจูุจ </h1><br><p style=";text-align:right;direction:rtl">  ุชู ุจูุงุก ุฎุท ุฃูุงุจูุจ ูู ูุฑุงุญู ูููุตูุฉ.  ูู ูุฑุญูุฉ ูู ูุธููุฉ ุฃู ูุงุนู ุจุงูุชูุณูู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">opt&lt;Out&gt; func(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> In &amp;);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃู </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> In &amp;)</span></span></span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ูููู ุงุณุชุฎุฏุงู ุงููุฑุงุญู ุงูุชู ุชูุฑุฌุน <code>void</code> ุฅูุง ูู ุงููุฑุญูุฉ ุงูุฃุฎูุฑุฉ ูู ุฎุท ุงูุฃูุงุจูุจ. </p><br><p style=";text-align:right;direction:rtl">  ูุง ุจุฏ ุงููุฑุงุญู ูู ุณูุณูุฉ.  ุชุณุชูุจู ูู ูุฑุญูุฉ ุชุงููุฉ ูุงุฆููุง ุชู ุฅุฑุฌุงุนู ุจูุงุณุทุฉ ุงููุฑุญูุฉ ุงูุณุงุจูุฉ.  ุฅุฐุง ูุงูุช ุงููุฑุญูุฉ ุงูุณุงุจูุฉ ุชูุฑุฌุน ุงููููุฉ ุงููุงุฑุบุฉ ุ <code>opt&lt;Out&gt;</code> ุงููููุฉ <code>opt&lt;Out&gt;</code> ุซู ูุง ูุชู ุงุณุชุฏุนุงุก ุงููุฑุญูุฉ ุงูุชุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุงู ูุฑุญูุฉ <code>broadcast</code> ุงูุฎุงุตุฉ.  ูู ุงูุชู ุดูุฏุช ูู ุนุฏุฉ ุฎุทูุท ุฃูุงุจูุจ.  ุชุณุชูุจู ูุฑุญูุฉ <code>broadcast</code> ูุงุฆููุง ูู ุงููุฑุญูุฉ ุงูุณุงุจูุฉ ูุชุจุซู ุฅูู ูู ุฎุท ุฃูุงุจูุจ ูุฑุนู. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฌูุฉ ูุธุฑ ุฎุท ุงูุฃูุงุจูุจ ุ ุชุจุฏู ูุฑุญูุฉ <code>broadcast</code> ูุฏุงูุฉ ุจุงูุชูุณูู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> In &amp;)</span></span></span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุนุฏู ูุฌูุฏ ูููุฉ ุฅุฑุฌุงุน ูู ูุฑุญูุฉ <code>broadcast</code> ูููู ุฃู ุชููู ูุฑุญูุฉ <code>broadcast</code> ุงููุฑุญูุฉ ุงูุฃุฎูุฑุฉ ููุท ูู ุฎุท ุฃูุงุจูุจ. </p><br><h2 id="why-does-the-pipeline-stage-return-an-optional-value" style=";text-align:right;direction:rtl">  ููุงุฐุง ุชุฑุฌุน ูุฑุญูุฉ ุฎุท ุงูุฃูุงุจูุจ ูููุฉ ุงุฎุชูุงุฑูุฉุ </h2><br><p style=";text-align:right;direction:rtl">  ุฐูู ูุฃู ููุงู ุญุงุฌุฉ ูุฅุณูุงุท ุจุนุถ ุงูููู ุงููุงุฑุฏุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุง ุชููู ูุฑุญูุฉ <code>validate</code> ุจุฅุฑุฌุงุน ุฃู ุดูุก ุฅุฐุง ูุงูุช ุงููููุฉ ุงูุฃูููุฉ ุบูุฑ ุตุญูุญุฉ ุ ููุง ููุฌุฏ ุฃู ูุนูู ููุนุงูุฌุชูุง. </p><br><p style=";text-align:right;direction:rtl">  ูุซุงู ุขุฎุฑ: ูุง ุชููู ูุฑุญูุฉ <code>alarm_detector</code> ุจุฅุฑุฌุงุน ุฃู ุดูุก ุฅุฐุง ูู ุชูุชุฌ ุงููููุฉ ุงููุดุจููุฉ ุงูุญุงููุฉ ุนู ุญุงูุฉ ุฅูุฐุงุฑ ุฌุฏูุฏุฉ. </p><br><h1 id="implementation-details" style=";text-align:right;direction:rtl">  ุชูุงุตูู ุงูุชูููุฐ </h1><br><h2 id="types-and-functions-related-to-the-application-logic" style=";text-align:right;direction:rtl">  ุงูุฃููุงุน ูุงููุธุงุฆู ุงููุชุนููุฉ ุจููุทู ุงูุชุทุจูู </h2><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ูู ุฃููุงุน ุงูุจูุงูุงุช ูุงููุธุงุฆู ุงููุชุนููุฉ ุจููุทู ุงูุชุทุจูู.  ูู ุงููุซุงู ุงูุฐู ุชูุช ููุงูุดุชู ุ ูุชู ุงุณุชุฎุฏุงู ุฃููุงุน ุงูุจูุงูุงุช ุงูุชุงููุฉ ูุชูุฑูุฑ ุงููุนูููุงุช ูู ูุฑุญูุฉ ุฅูู ุฃุฎุฑู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Raw data from a sensor. struct raw_measure { int m_meter_id; uint8_t m_high_bits; uint8_t m_low_bits; }; // Type of input for validation stage with raw data from a sensor. struct raw_value { raw_measure m_data; }; // Type of input for conversion stage with valid raw data from a sensor. struct valid_raw_value { raw_measure m_data; }; // Data from a sensor after conversion to Celsius degrees. struct calculated_measure { int m_meter_id; float m_measure; }; // The type for result of conversion stage with converted data from a sensor. struct sensor_value { calculated_measure m_data; }; // Type with value which could mean a dangerous level of temperature. struct suspicious_value { calculated_measure m_data; }; // Type with information about detected dangerous situation. struct alarm_detected { int m_meter_id; };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู ูุซูู ูู <code>raw_value</code> ููุชูู ุฅูู ุงููุฑุญูุฉ ุงูุฃููู ูู ุฎุท ุฃูุงุจูุจูุง.  ูุญุชูู ูุฐุง <code>raw_value</code> ุนูู ูุนูููุงุช ุชู ุงูุญุตูู ุนูููุง ูู ุฌูุงุฒ ุงุณุชุดุนุงุฑ ูู ุดูู ูุงุฆู <code>raw_measure</code> .  ุซู ูุชู ุชุญููู <code>valid_raw_value</code> ุฅูู <code>valid_raw_value</code> .  ุซู <code>valid_raw_value</code> ุชุญููุช ุฅูู <code>sensor_value</code> ูุน ูููุฉ ุฌูุงุฒ ุงุณุชุดุนุงุฑ ุงููุนูู ูู ุดูู <code>calulated_measure</code> .  ุฅุฐุง ุงุญุชูู ูุซูู ูู <code>sensor_value</code> ุนูู ูููุฉ ูุฑูุจุฉ ุ ูุณูุชู ุฅูุชุงุฌ ูุซูู ูููููุฉ <code>suspicious_value</code> .  ููููู ุชุญููู ูุฐุง ุงููููุฉ <code>suspicious_value</code> ุฅูู ูุซูู <code>alarm_detected</code> ูุงุญููุง. </p><br><p style=";text-align:right;direction:rtl">  ุฃู ุจุงูุตูุบุฉ ุงูุฑุณูููุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/dp/dx/rz/dpdxrzpp-rvo05zk-8rwdwucszo.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููููุง ุฅููุงุก ูุธุฑุฉ ุนูู ุชูููุฐ ูุฑุงุญู ุฎุท ุงูุฃูุงุจูุจ ูุฏููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // The first stage of a pipeline. Validation of raw data from a sensor. // // Returns valid_raw_value or nothing if value is invalid. // stage_result_t&lt; valid_raw_value &gt; validation( const raw_value &amp; v ) { if( 0x7 &gt;= v.m_data.m_high_bits ) return make_result&lt; valid_raw_value &gt;( v.m_data ); else return make_empty&lt; valid_raw_value &gt;(); } // // The second stage of a pipeline. Conversion from raw data to a value // in Celsius degrees. // stage_result_t&lt; sensor_value &gt; conversion( const valid_raw_value &amp; v ) { return make_result&lt; sensor_value &gt;( calculated_measure{ v.m_data.m_meter_id, 0.5f * ((static_cast&lt; uint16_t &gt;( v.m_data.m_high_bits ) &lt;&lt; 8) + v.m_data.m_low_bits) } ); } // // Simulation of the data archiving. // void archiving( const sensor_value &amp; v ) { clog &lt;&lt; "archiving (" &lt;&lt; v.m_data.m_meter_id &lt;&lt; "," &lt;&lt; v.m_data.m_measure &lt;&lt; ")" &lt;&lt; endl; } // // Simulation of the data distribution. // void distribution( const sensor_value &amp; v ) { clog &lt;&lt; "distributing (" &lt;&lt; v.m_data.m_meter_id &lt;&lt; "," &lt;&lt; v.m_data.m_measure &lt;&lt; ")" &lt;&lt; endl; } // // The first stage of a child pipeline at third level of the main pipeline. // // Checking for to high value of the temperature. // // Returns suspicious_value message or nothing. // stage_result_t&lt; suspicious_value &gt; range_checking( const sensor_value &amp; v ) { if( v.m_data.m_measure &gt;= 45.0f ) return make_result&lt; suspicious_value &gt;( v.m_data ); else return make_empty&lt; suspicious_value &gt;(); } // // The next stage of a child pipeline. // // Checks for two suspicious_value-es in 25ms time window. // class alarm_detector { using clock = chrono::steady_clock; public : stage_result_t&lt; alarm_detected &gt; operator()( const suspicious_value &amp; v ) { if( m_previous ) if( *m_previous + chrono::milliseconds(25) &gt; clock::now() ) { m_previous = nullopt; return make_result&lt; alarm_detected &gt;( v.m_data.m_meter_id ); } m_previous = clock::now(); return make_empty&lt; alarm_detected &gt;(); } private : optional&lt; clock::time_point &gt; m_previous; }; // // One of last stages of a child pipeline. // Imitates beginning of the alarm processing. // void alarm_initiator( const alarm_detected &amp; v ) { clog &lt;&lt; "=== alarm (" &lt;&lt; v.m_meter_id &lt;&lt; ") ===" &lt;&lt; endl; } // // Another of last stages of a child pipeline. // Imitates distribution of the alarm. // void alarm_distribution( ostream &amp; to, const alarm_detected &amp; v ) { to &lt;&lt; "alarm_distribution (" &lt;&lt; v.m_meter_id &lt;&lt; ")" &lt;&lt; endl; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุท ุชุฎุทู ุฃุดูุงุก ูุซู <code>stage_result_t</code> ู <code>make_result</code> ู <code>make_empty</code> ุ ุณููุงูุดูุง ูู ุงููุณู ุงูุชุงูู. </p><br><p style=";text-align:right;direction:rtl">  ุขูู ุฃู ุฑูุฒ ุชูู ุงููุฑุงุญู ุชุงููุฉ ุฅูู ุญุฏ ูุง.  ุงูุฌุฒุก ุงููุญูุฏ ุงูุฐู ูุชุทูุจ ุจุนุถ ุงูุชูุณูุฑ ุงูุฅุถุงูู ูู ุชูููุฐ ูุฑุญูุฉ <code>alarm_detector</code> . </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐุง ุงููุซุงู ุ ูุชู ุชุดุบูู ุงูููุจู ููุท ุฅุฐุง ูุงู ููุงู ุนูู ุงูุฃูู ุงุซููู ูู ุงูููู <code>suspicious_values</code> ูู ูุงูุฐุฉ ุฒูููุฉ ุชุจูุบ 25 ูููู ุซุงููุฉ.  ูุฐูู ูุชุนูู ุนูููุง ุฃู ูุชุฐูุฑ ููุช ุงููุซูู <code>suspicious_value</code> ุงูุณุงุจู ูู ูุฑุญูุฉ <code>alarm_detector</code> .  ูุฐูู ูุฃู ุชุทุจูู <code>alarm_detector</code> ูุชู ุชุทุจููู ููุณุคูู ุฐู ุญุงูุฉ ุฌูุฏุฉ ูุน ูุดุบู ุงุณุชุฏุนุงุก ุฏุงูุฉ. </p><br><h2 id="stages-return-sobjectizers-type-instead-of-stdoptional" style=";text-align:right;direction:rtl">  ุชููู ุงููุฑุงุญู ุจุฅุฑุฌุงุน ููุน SObjectizer ุจุฏูุงู ูู std :: ุงุฎุชูุงุฑู </h2><br><p style=";text-align:right;direction:rtl">  ููุช ูู ููุช ุณุงุจู ุฃู ูุฐู ุงููุฑุญูุฉ ูููู ุฃู ุชุนูุฏ ูููุฉ ุงุฎุชูุงุฑูุฉ  ููู <code>std::optional</code> ูุง ูุณุชุฎุฏู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ูููู ุฑุคูุฉ ุงูููุน <code>stage_result_t</code> ูู ุชูููุฐ ุงููุฑุงุญู. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ูุฃู ุจุนุถ SObjectizer ุงููุญุฏุฏุฉ ุชูุนุจ ุฏูุฑูุง ููุง.  ุณูุชู ุชูุฒูุน ุงูููู ุงูุชู ูุชู ุฅุฑุฌุงุนูุง ูุฑุณุงุฆู ุจูู ูููุงุก SObjectizer (ููุนุฑู ุฃูุถูุง ุจุงุณู ุงูุนูุงุตุฑ ุงููุงุนูุฉ).  ูุชู ุฅุฑุณุงู ูู ุฑุณุงูุฉ ูู SObjectizer ููุงุฆู ูุฎุตุต ุจุดูู ุญููู.  ูุฐูู ูุฏููุง ููุน ูู "ุงูุชุญุณูู" ููุง: ุจุฏูุงู ูู ุฅุฑุฌุงุน <code>std::optional</code> ููู ุซู ุชุฎุตูุต ูุงุฆู ุฑุณุงูุฉ ุฌุฏูุฏ ุ ูุญู ููุท ูุฎุตุต ูุงุฆู ุฑุณุงูุฉ ููุนูุฏ ูุคุดุฑ ุฐูู ุฅููู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ <code>stage_result_t</code> ูู ูุฌุฑุฏ typedef ู anal_ptr Shared_ptr ุงูุชูุงุธุฑูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M &gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">message_holder_t</span></span>&lt; M &gt;;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ู <code>make_result</code> ู <code>make_empty</code> ููุง ุฏุงูุงุช ูุณุงุนุฏุฉ ููุท ูุฅูุดุงุก <code>stage_result_t</code> ูุน ุฃู ุจุฏูู ูููุฉ ูุนููุฉ ุจุฏุงุฎู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Args &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt; make_result( Args &amp;&amp;... args ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt;::make(forward&lt; Args &gt;(args)...); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> M &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt; make_empty() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_result_t</span></span>&lt; M &gt;(); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุจุณุงุทุฉ ุ ูููู ุงูููู ุฃู ูุฑุญูุฉ <code>validation</code> ูู <code>validation</code> ูููู ุงูุชุนุจูุฑ ุนููุง ุจูุฐู ุงูุทุฑููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt; valid_raw_value &gt; validation( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> raw_value &amp; v ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-number"><span class="hljs-number">0x7</span></span> &gt;= v.m_data.m_high_bits ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_shared&lt; valid_raw_value &gt;( v.m_data ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt; valid_raw_value &gt;{}; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ูุธุฑูุง ูุฎุตูุตูุฉ SObjectizer ุ ูุง ูููููุง ุงุณุชุฎุฏุงู <code>std::shared_ptr</code> <code>so_5::message_holder_t</code> ุงูุชุนุงูู ูุน <code>so_5::message_holder_t</code> type.  ููุญู ูุฎูู ุฐูู ุงููุญุฏุฏ ูุฑุงุก <code>stage_result_t</code> ู <code>make_result</code> ู <code>make_empty</code> ุงููุณุงุนุฏูู. </p><br><h2 id="stage_handler_t-and-stage_builder_t-separation" style=";text-align:right;direction:rtl">  stage_handler_t ูุงููุตู stage_builder_t </h2><br><p style=";text-align:right;direction:rtl">  ุชุชูุซู ุฅุญุฏู ุงูููุงุท ุงููููุฉ ูู ุชูููุฐ ุฎุท ุงูุฃูุงุจูุจ ูู ุงููุตู ุจูู ููุงููู <em>ูุนุงูุฌ</em> <em>ุงููุฑุญูุฉ ููุฑุญูุฉ ุงูุจูุงุก</em> .  ูุชู ุฐูู ูู ุฃุฌู ุงูุจุณุงุทุฉ.  ุณูุญ ูู ูุฌูุฏ ูุฐู ุงูููุงููู ุจุฃู ูููู ูุฏู ุฎุทูุชูู ูู ุชุนุฑูู ุฎุท ุงูุฃูุงุจูุจ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุฎุทูุฉ ุงูุฃููู ุ ูุตู ุงููุณุชุฎุฏู ูุฑุงุญู ุฎุทูุท ุงูุฃูุงุจูุจ.  ูุชูุฌุฉ ูุฐูู ุ ุฃุชููู ูุซูู <code>stage_t</code> ุงูุฐู ูุญุชูุธ ุจุฌููุน ูุฑุงุญู ุฎุท ุงูุฃูุงุจูุจ ูู ุงูุฏุงุฎู. </p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุฎุทูุฉ ุงูุซุงููุฉ ุ ูุชู ุฅูุดุงุก ูุฌููุนุฉ ูู ูููุงุก SObjectizer ุงูุฃุณุงุณู.  ูุชููู ูุคูุงุก ุงููููุงุก ุฑุณุงุฆู ุชุญุชูู ุนูู ูุชุงุฆุฌ ุงููุฑุงุญู ุงูุณุงุจูุฉ ููุชุตููู ุจูุนุงูุฌุงุช <em>ุงููุฑุญูุฉ</em> ุงููุนููุฉ ุ ุซู ูุฑุณููู ุงููุชุงุฆุฌ ุฅูู ุงููุฑุงุญู ุงูุชุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูุฅูุดุงุก ูุฐู ุงููุฌููุนุฉ ูู ุงูุนูุงูู ุ ูุฌุจ ุฃู ูููู ููู <em>ูุฑุญูุฉ ููุดุฆ ูุฑุญูุฉ</em> .  ูููู ุฑุคูุฉ <em>ููุดุฆ ุงููุฑุญูุฉ</em> ููุตูุน ูููู ุจุฅูุดุงุก ูููู SObjectizer ุงูุฃุณุงุณู. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ูุฏููุง ุงูุนูุงูุฉ ุงูุชุงููุฉ: ูู ูุฑุญูุฉ ูู ูุฑุงุญู ุฎุท ุงูุฃูุงุจูุจ ุชูุชุฌ ูุงุฆููู: <em>ูุนุงูุฌ ุงููุฑุญูุฉ</em> ุงูุฐู ูุญุชูุธ ุจุงูููุทู ุงููุฑุชุจุท <em>ุจุงููุฑุญูุฉ</em> ุ <em>ูููุดุฆ ุงููุฑุญูุฉ</em> ุงูุฐู ููุดุฆ ูููู SObjectizer ุงูุฃุณุงุณู ูุงุณุชุฏุนุงุก <em>ูุนุงูุฌ ุงููุฑุญูุฉ</em> ูู ุงูููุช ุงูููุงุณุจ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/gl/tp/nn/gltpnnqhjqslsscxvellndh6n0u.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชูุซูู <em>ูุนุงูุฌ ุงููุฑุญูุฉ</em> ุจุงูุทุฑููุฉ ุงูุชุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stage_handler_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> traits = <span class="hljs-keyword"><span class="hljs-keyword">handler_traits_t</span></span>&lt; In, Out &gt;; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> func_type = function&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> traits::output(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> traits::input &amp;) &gt;; <span class="hljs-keyword"><span class="hljs-keyword">stage_handler_t</span></span>( func_type handler ) : m_handler( move(handler) ) {} <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Callable &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_handler_t</span></span>( Callable handler ) : m_handler( handler ) {} <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> traits::<span class="hljs-function"><span class="hljs-function">output </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">typename</span></span></span></span><span class="hljs-function"><span class="hljs-params"> traits::input &amp; a )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_handler( a ); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> : func_type m_handler; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญูุซ ูุชู ุชุนุฑูู <code>handler_traits_t</code> ุจุงูุทุฑููุฉ ุงูุชุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // We have to deal with two types of stage handlers: // - intermediate handlers which will return some result (eg some new // message); // - terminal handlers which can return nothing (eg void instead of // stage_result_t&lt;M&gt;); // // This template with specialization defines `input` and `output` // aliases for both cases. // template&lt; typename In, typename Out &gt; struct handler_traits_t { using input = In; using output = stage_result_t&lt; Out &gt;; }; template&lt; typename In &gt; struct handler_traits_t&lt; In, void &gt; { using input = In; using output = void; };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููุซู <em>ุจุงูู ุงููุฑุญูุฉ</em> ููุท <code>std::function</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> = function&lt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp;, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>) &gt;;</code> </pre> <br><h2 id="helper-types-lambda_traits_t-and-callable_traits_t" style=";text-align:right;direction:rtl">  ุฃููุงุน ุงููุณุงุนุฏุฉ lambda_traits_t ู callable_traits_t </h2><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃู ุงููุฑุงุญู ูููู ุชูุซูููุง ุจูุงุณุทุฉ ูุธุงุฆู ูุฌุงููุฉ ุฃู ุนูุงูู ุชูุฌูู (ูุซู ูุซููุงุช ูุฆุฉ <code>alarm_detector</code> ุฃู ุงููุฆุงุช ุงูุชู ุชู ุฅูุดุงุคูุง ุจูุงุณุทุฉ ูุชุฑุฌู ูุฌููู ุชูุซู lambdas) ุ ููุญู ุจุญุงุฌุฉ ุฅูู ุจุนุถ ุงููุณุงุนุฏูู ูููุดู ุนู ุฃููุงุน ูุณูุทุฉ ุงููุฑุญูุฉ ููููุฉ ุงูุฅุฑุฌุงุน.  ููุฏ ุงุณุชุฎุฏูุช ุงูููุฏ ุงูุชุงูู ููุฐุง ุงูุบุฑุถ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // Helper type for `arg_type` and `result_type` alises definition. // template&lt; typename R, typename A &gt; struct callable_traits_typedefs_t { using arg_type = A; using result_type = R; }; // // Helper type for dealing with stateful objects with operator() // (they could be user-defined objects or generated by compiler // like lambdas). // template&lt; typename T &gt; struct lambda_traits_t; template&lt; typename M, typename A, typename T &gt; struct lambda_traits_t&lt; stage_result_t&lt; M &gt;(T::*)(const A &amp;) const &gt; : public callable_traits_typedefs_t&lt; M, A &gt; {}; template&lt; typename A, typename T &gt; struct lambda_traits_t&lt; void (T::*)(const A &amp;) const &gt; : public callable_traits_typedefs_t&lt; void, A &gt; {}; template&lt; typename M, typename A, typename T &gt; struct lambda_traits_t&lt; stage_result_t&lt; M &gt;(T::*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; M, A &gt; {}; template&lt; typename A, typename T &gt; struct lambda_traits_t&lt; void (T::*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; void, A &gt; {}; // // Main type for definition of `arg_type` and `result_type` aliases. // With specialization for various cases. // template&lt; typename T &gt; struct callable_traits_t : public lambda_traits_t&lt; decltype(&amp;T::operator()) &gt; {}; template&lt; typename M, typename A &gt; struct callable_traits_t&lt; stage_result_t&lt; M &gt;(*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; M, A &gt; {}; template&lt; typename A &gt; struct callable_traits_t&lt; void(*)(const A &amp;) &gt; : public callable_traits_typedefs_t&lt; void, A &gt; {};</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุขูู ุฃู ูููู ูุฐุง ุงูุฑูุฒ ูููููุง ุชูุงููุง ูููุฑุงุก ุงูุฐูู ูุฏููู ูุนุฑูุฉ ุฌูุฏุฉ ุจู C ++.  ุฅุฐุง ูู ููู ุงูุฃูุฑ ูุฐูู ุ ููุง ุชุชุฑุฏุฏ ูู <code>lambda_traits_t</code> ุ <code>lambda_traits_t</code> ุฃู ุฃุดุฑุญ ุงูููุทู ูุฑุงุก <code>lambda_traits_t</code> ู <code>callable_traits_t</code> ุจุงูุชูุตูู. </p><br><h2 id="stage-broadcast-and-operator-functions" style=";text-align:right;direction:rtl">  ุงููุฑุญูุฉ () ุ ูุธุงุฆู ุงูุจุซ () ู | () ุงููุดุบู </h2><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููููุง ุฃู ููุธุฑ ุฏุงุฎู ูุธุงุฆู ุจูุงุก ุฎุทูุท ุงูุฃูุงุจูุจ ุงูุฑุฆูุณูุฉ.  ูููู ูุจู ุฐูู ุ ูู ุงูุถุฑูุฑู ุฅููุงุก ูุธุฑุฉ ุนูู ุชุนุฑูู ูุฆุฉ ุงููุงูุจ <code>stage_t</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stage_t</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> m_builder; };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅููุง ุจููุฉ ุจุณูุทุฉ ููุบุงูุฉ ุชุญุชูู ุนูู ูุซูู <code>stage_bulder_t</code> ููุท.  ูุง ูุชู ุงุณุชุฎุฏุงู ูุนููุงุช ุงููุงูุจ ุฏุงุฎู <code>stage_t</code> ุ ูููุงุฐุง ุชููู ููุฌูุฏุฉ ููุงุ </p><br><p style=";text-align:right;direction:rtl">  ููู ุถุฑูุฑูุฉ ููุชุญูู ูู ููุช ุชุฑุฌูุฉ ุชูุงูู ุงูููุน ุจูู ูุฑุงุญู ุฎุทูุท ุงูุฃูุงุจูุจ.  ุณูุฑู ุฐูู ูุฑูุจุงู. </p><br><p style=";text-align:right;direction:rtl">  ููููู ูุธุฑุฉ ุนูู ุฃุจุณุท ูุธููุฉ ูุจูุงุก ุฎุทูุท ุงูุฃูุงุจูุจ ุ <code>stage()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Callable, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::arg_type, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::result_type &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out &gt; stage( Callable handler ) { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [h = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(handler)]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> coop.make_agent&lt; <span class="hljs-keyword"><span class="hljs-keyword">a_stage_point_t</span></span>&lt;In, Out&gt; &gt;( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(h), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ) -&gt;so_direct_mbox(); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(builder) }; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชููู <em>ูุนุงูุฌ ูุฑุญูุฉ</em> ุงููุนูู ููุนููุฉ ูุงุญุฏุฉ.  ูููู ุฃู ูููู ูุคุดุฑูุง ููุธููุฉ ุฃู ูุธููุฉ lambda ุฃู functor.  ูุชู ุงุณุชูุจุงุท ุฃููุงุน ุงููุฏุฎูุงุช ูุงููุฎุฑุฌุงุช ูู ุงููุฑุญูุฉ ุชููุงุฆููุง ุจุณุจุจ "ูุงูุจ ุงูุณุญุฑ" ูุฑุงุก ูุงูุจ <code>callable_traits_t</code> . </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุฅูุดุงุก ูุซูู <em>ููุดุฆ ุงููุฑุญูุฉ</em> ุฏุงุฎู ููุชู ุฅุฑุฌุงุน ูุฐุง ุงููุซูู ูู ูุงุฆู <code>stage_t</code> ุฌุฏูุฏ <code>stage_t</code> <code>stage()</code> .  ูุชู ุงูุชูุงุท <em>ูุนุงูุฌ ุงููุฑุญูุฉ</em> ุงููุนูู ุจูุงุณุทุฉ ุฃุฏุงุฉ <em>ุจูุงุก ุงููุฑุญูุฉ</em> lambda ุ ุซู ุณูุชู ุงุณุชุฎุฏุงูู ูุฅูุดุงุก ูููู SObjectizer ุงูุฃุณุงุณู (ุณูุชุญุฏุซ ุนู ุฐูู ูู ุงููุณู ุงูุชุงูู). </p><br><p style=";text-align:right;direction:rtl">  ุงููุธููุฉ ุงูุชุงููุฉ ูููุฑุงุฌุนุฉ ูู <code>operator|()</code> ุงูุฐู ูุณูุณู ูุฑุญูุชูู ูุนูุง ููุนูุฏ ูุฑุญูุฉ ุฌุฏูุฏุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out1, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out2 &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out2 &gt; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>|( <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out1 &gt; &amp;&amp; prev, <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; Out1, Out2 &gt; &amp;&amp; next ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span>{ [prev, next]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage ) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> m = next.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prev.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(m) ); } } }; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅู ุฃุจุณุท ุทุฑููุฉ ูุดุฑุญ ููุทู <code>operator|()</code> ูู ูุญุงููุฉ ุฑุณู ุตูุฑุฉ.  ูููุชุฑุถ ุฃู ูุฏููุง ุงูุชุนุจูุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">stage(A) | stage(B) | stage(C) | stage(B)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณูุชู ุชุญููู ูุฐุง ุงูุชุนุจูุฑ ุจูุฐู ุงูุทุฑููุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jo/rr/aq/jorraqaawl6y7ju3om7zfq3java.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ููุงู ูููููุง ุฃูุถูุง ุฃู ูุฑู ููู ูุนูู ูุญุต ููุน ุงูุชุฑุฌูุฉ: ูุชุทูุจ ุชุนุฑูู <code>operator|()</code> ุฃู ูููู ููุน ุฅุฎุฑุงุฌ ุงููุฑุญูุฉ ุงูุฃููู ูู ูุฏุฎูุงุช ุงููุฑุญูุฉ ุงูุซุงููุฉ.  ุฅุฐุง ูู ููู ุงูุฃูุฑ ูุฐูู ุ ููู ูุชู ุชุฌููุน ุงูุดูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุงูุขู ูููููุง ุฅููุงุก ูุธุฑุฉ ุนูู ูุธููุฉ ุจูุงุก ุฎุทูุท ุงูุฃูุงุจูุจ ุงูุฃูุซุฑ ุชุนููุฏูุง ุ <code>broadcast()</code> .  ุงููุธููุฉ ููุณูุง ุจุณูุทุฉ ุฅูู ุญุฏ ูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Rest &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> &gt; broadcast( <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out &gt; &amp;&amp; first, Rest &amp;&amp;... stages ) { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [broadcasts = collect_sink_builders( move(first), forward&lt; Rest &gt;(stages)...)] ( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> ) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> &gt; mboxes; mboxes.reserve( broadcasts.size() ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp; b : broadcasts ) mboxes.emplace_back( b( coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>{} ) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">broadcast_mbox_t</span></span>::make( coop.environment(), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(mboxes) ); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(builder) }; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููุฑู ุงูุฑุฆูุณู ุจูู ุงููุฑุญูุฉ ุงูุนุงุฏูุฉ ูุงููุฑุญูุฉ ุงูุฅุฐุงุนูุฉ ูู ุฃู ุงููุฑุญูุฉ ุงูุฅุฐุงุนูุฉ ูุฌุจ ุฃู ุชุญูู ูุงููุงุช <em>ููุดุฆู ุงููุฑุญูุฉ</em> ุงููุฑุนูุฉ.  ูุฐูู ูุชุนูู ุนูููุง ุฅูุดุงุก ูุฐุง ุงููุชุฌู ูุชูุฑูุฑู ุฅูู <em>ุจุงูู ุงููุณุฑุญ</em> ุงูุฑุฆูุณู <em>ููุฑุญูุฉ</em> ุงูุจุซ.  ููุฐุง ุงูุณุจุจ ุ ูููููุง ุฃู ูุฑู ุฏุนูุฉ ุฅูู <code>collect_sink_builders</code> ูู ูุงุฆูุฉ ุงูุชูุงุท lambda ุฏุงุฎู ูุธููุฉ <code>broadcast()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [broadcasts = collect_sink_builders( move(first), forward&lt; Rest &gt;(stages)...)]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุธุฑูุง ุฅูู <code>collect_sink_builder</code> ุงูุฑูุฒ ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // Serie of helper functions for building description for // `broadcast` stage. // // Those functions are used for collecting // `builders` functions for every child pipeline. // // Please note that this functions checks that each child pipeline has the // same In type. // template&lt; typename In, typename Out, typename... Rest &gt; void move_sink_builder_to( vector&lt; stage_builder_t &gt; &amp; receiver, stage_t&lt; In, Out &gt; &amp;&amp; first, Rest &amp;&amp;... rest ) { receiver.emplace_back( move( first.m_builder ) ); if constexpr( 0u != sizeof...(rest) ) move_sink_builder_to&lt;In&gt;( receiver, forward&lt; Rest &gt;(rest)... ); } template&lt; typename In, typename Out, typename... Rest &gt; vector&lt; stage_builder_t &gt; collect_sink_builders( stage_t&lt; In, Out &gt; &amp;&amp; first, Rest &amp;&amp;... stages ) { vector&lt; stage_builder_t &gt; receiver; receiver.reserve( 1 + sizeof...(stages) ); move_sink_builder_to&lt;In&gt;( receiver, move(first), std::forward&lt;Rest&gt;(stages)... ); return receiver; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุนูู ุงูุชุญูู ูู ููุช ุงูุชุญููู ุงูุจุฑูุฌู ููููุช ููุง ุฃูุถูุง: ูุฃูู ูุชู ุงุณุชุฏุนุงุก ูุนููุฉ <code>move_sink_builder_to</code> ุจุดูู ูุงุถุญ ุญุณุจ ุงูููุน "ูู".  ูุนูู ุฐูู ุฃู ุฅุฌุฑุงุก ููุงููุฉ ูู ุงููููุฐุฌ <code>collect_sink_builders(stage_t&lt;In1, Out1&gt;, stage_t&lt;In2, Out2&gt;, ...)</code> ุณูุคุฏู ุฅูู ุญุฏูุซ ุฎุทุฃ ูู ุงูุชุฑุฌูุฉ ูุฃู ุงููุญูู ุงูุจุฑูุฌู ูุญุธุฑ ุฅุฌุฑุงุก ุงูููุงููุฉ <code>move_sink_builder_to&lt;In1&gt;(receiver, stage_t&lt;In2, Out2&gt;, ...)</code> . </p><br><p style=";text-align:right;direction:rtl">  ูููููู ุฃูุถูุง ููุงุญุธุฉ ุฃูู ูุธุฑูุง ูุฃู ุนุฏุฏ ุฎุทูุท ุงูุฃูุงุจูุจ ุงููุฑุนูุฉ <code>broadcast()</code> ูุนุฑูู ูู ููุช ุงูุชุฑุฌูุฉ ุ ูููููุง ุงุณุชุฎุฏุงู <code>std::array</code> ุจุฏูุงู ูู <code>std::vector</code> ููููู ุชุฌูุจ ุจุนุถ ุนูููุงุช ุชุฎุตูุต ุงูุฐุงูุฑุฉ.  ููู <code>std::vector</code> ูุณุชุฎุฏู ููุง ููุท ููุจุณุงุทุฉ. </p><br><h2 id="relation-between-stages-and-sobjectizers-agentsmboxes" style=";text-align:right;direction:rtl">  ุงูุนูุงูุฉ ุจูู ุงููุฑุงุญู ููููุงุก / mboxes SObjectizer </h2><br><p style=";text-align:right;direction:rtl">  ุงูููุฑุฉ ูุฑุงุก ุชูููุฐ ุฎุท ุงูุฃูุงุจูุจ ูู ุฅูุดุงุก ูููู ูููุตู ููู ูุฑุญูุฉ ูู ูุฑุงุญู ุฎุท ุงูุฃูุงุจูุจ.  ูุชููู ุงููููู ุฑุณุงูุฉ ูุงุฑุฏุฉ ุ ูููุฑุฑูุง ุฅูู <em>ูุนุงูุฌ ุงููุฑุญูุฉ</em> ุงูููุงุจู ุ ููุญูู ุงููุชูุฌุฉ ุ ูุฅุฐุง ูู ุชูู ุงููุชูุฌุฉ ูุงุฑุบุฉ ุ ูุฑุณู ุงููุชูุฌุฉ ูุฑุณุงูุฉ ูุงุฑุฏุฉ ุฅูู ุงููุฑุญูุฉ ุงูุชุงููุฉ.  ูููู ุชูุถูุญู ุจูุงุณุทุฉ ูุฎุทุท ุงูุชุณูุณู ุงูุชุงูู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/om/pn/wy/ompnwye792gjgad7zzgphpv4ctu.png"></p><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ููุงูุดุฉ ุจุนุถ ุงูุฃุดูุงุก ุงููุฑุชุจุทุฉ ุจู SObjectizer ุ ุนูู ุงูุฃูู ููุชุฑุฉ ูุฌูุฒุฉ.  ุฅุฐุง ูู ุชูู ููุชููุง ุจูุซู ูุฐู ุงูุชูุงุตูู ุ ููููู ุชุฎุทู ุงูุฃูุณุงู ุฃุฏูุงู ูุงูุงูุชูุงู ุฅูู ุงูุงุณุชูุชุงุฌ ูุจุงุดุฑุฉู. </p><br><h3 id="coop-is-a-group-of-agents-to-work-together" style=";text-align:right;direction:rtl">  Coop ูู ูุฌููุนุฉ ูู ุงูุนููุงุก ููุนูู ูุนูุง </h3><br><p style=";text-align:right;direction:rtl">  ูุชู ุชูุฏูู ุงููููุงุก ูู SObjectizer ููุณ ุจุดูู ูุฑุฏู ูููู ูู ูุฌููุนุงุช ุจุงุณู ุญุธุงุฆุฑ.  ุญุธูุฑุฉ ูู ูุฌููุนุฉ ูู ุงูุนูุงูู ุงูุชู ูุฌุจ ุฃู ุชุนูู ูุนุง ูููุณ ููุงู ูุนูู ูููุงุตูุฉ ุงูุนูู ุฅุฐุง ูุงู ุฃุญุฏ ูููุงุก ุงููุฌููุนุฉ ููููุฏ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูุฅู ุฅุฏุฎุงู ุงูุนูุงูู ุฅูู SObjectizer ูุดุจู ุฅูุดุงุก ูุซูู ุญุธูุฑุฉ ุ ูููุก ูุฐุง ุงููุซูู ุจุงููููุงุก ุงูููุงุณุจูู ุซู ุชุณุฌูู ุญุธูุฑุฉ ูู SObjectizer. </p><br><p style=";text-align:right;direction:rtl">  ูุจุณุจุจ ุฐูู ุ ูุฅู ุงูุญุฌุฉ ุงูุฃููู <em>ูุจุงูู ุงููุณุฑุญ</em> ูู ุฅุดุงุฑุฉ ุฅูู ุญุธูุฑุฉ ุฌุฏูุฏุฉ.  ูุชู ุฅูุดุงุก ูุฐุง ุญุธูุฑุฉ ูู ูุธููุฉ <code>make_pipeline()</code> (ุชูุช ููุงูุดุชูุง ุฃุฏูุงู) ุ ุซู ูุชู ููุคูุง ุจูุงุณุทุฉ <em>ููุดุฆู ุงููุณุฑุญ</em> ุซู ูุชู ุชุณุฌูููุง (ูุฑุฉ ุฃุฎุฑู ูู ูุธููุฉ <code>make_pipeline()</code> ). </p><br><h3 id="message-boxes" style=";text-align:right;direction:rtl">  ุตูุงุฏูู ุงูุฑุณุงุฆู </h3><br><p style=";text-align:right;direction:rtl">  ูููุฐ SObjectizer ุงูุนุฏูุฏ ูู ุงูููุงุฐุฌ ุงููุชุนููุฉ ุงูุชุฒุงูู.  ููุซู ูููุฐุฌ ูุงุญุฏ ูููู ููุท.  ุจุณุจุจ ุฐูู ุ ูููู ุฃู ุชุฎุชูู SObjectizer ุจุดูู ูุจูุฑ ุนู ุฃุทุฑ ุงููุงุนู ุงูุฃุฎุฑู.  ุฃุญุฏ ุงูุงุฎุชูุงูุงุช ูู ูุธุงู ุงูุนูููุฉ ููุฑุณุงุฆู. </p><br><p style=";text-align:right;direction:rtl">  ูุง ูุชู ุชูุฌูู ุงูุฑุณุงุฆู ูู SObjectizer ุฅูู ุงูุฌูุงุช ุงููุงุนูุฉ ุ ูููู <em>ูุฑุจุนุงุช ุงูุฑุณุงุฆู</em> (mboxes).  ูุชุนูู ุนูู ุงูููุซููู ุงูุงุดุชุฑุงู ูู ุฑุณุงุฆู ูู mbox.  ุฅุฐุง ุงุดุชุฑู ุฃุญุฏ ุงูููุซููู ูู ููุน ุฑุณุงูุฉ ูุนูู ูู mbox ุ ูุณูุชููู ุฑุณุงุฆู ูู ูุฐุง ุงูููุน: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/o4/bf/ee/o4bfee0lp8hdvks68cas4yjlkgu.png"></p><br><p style=";text-align:right;direction:rtl">  ูุฐู ุงูุญูููุฉ ุถุฑูุฑูุฉ ูุฃูู ูู ุงูุถุฑูุฑู ุฅุฑุณุงู ุฑุณุงุฆู ูู ูุฑุญูุฉ ุฅูู ุฃุฎุฑู.  ููุฐุง ูุนูู ุฃู ูู ูุฑุญูุฉ ูุฌุจ ุฃู ูููู ููุง mbox ูุฃู mbox ูุฌุจ ุฃู ุชููู ูุนุฑููุฉ ูููุฑุญูุฉ ุงูุณุงุจูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ููุซู (ุงููููุจ ูููู) ูู SObjectizer ูุฏูู <em>mbox ุงููุจุงุดุฑ</em> .  ูุฑุชุจุท mbox ูุฐุง ุจูููู ุงููุงูู ููุท ููุง ูููู ุงุณุชุฎุฏุงูู ูู ูุจู ุฃู ูููุงุก ุขุฎุฑูู.  ุณูุชู ุงุณุชุฎุฏุงู mboxes ุงููุจุงุดุฑ ููุนูุงูู ุงูุชู ุชู ุฅูุดุงุคูุง ููุฑุงุญู ุงูุชูุงุนู ุงูุชูุงุนูู. </p><br><p style=";text-align:right;direction:rtl">  ุชุญุฏุฏ ููุฒุฉ SObjectizer ุงููุญุฏุฏุฉ ุจุนุถ ุชูุงุตูู ุชูููุฐ ุฎุท ุงูุฃูุงุจูุจ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุฃูู ูู ุญูููุฉ ุฃู <em>ุจุงูู ุงููุณุฑุญ</em> ูุฏูู ุงููููุฐุฌ ุงูุฃููู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> builder(<span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp;, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ูุนูู ุฃู <em>ููุดุฆ ุงููุฑุญูุฉ</em> ูุชููู mbox ูู ุงููุฑุญูุฉ ุงูุชุงููุฉ ููุฌุจ ุฃู ููุดุฆ ูููููุง ุฌุฏูุฏูุง ูุฑุณู ูุชุงุฆุฌ ุงููุฑุญูุฉ ุฅูู ุฐูู mbox.  ูุฌุจ ุฅุนุงุฏุฉ mbox ุงูุฎุงุต ุจุงููููู ุงูุฌุฏูุฏ ุจูุงุณุทุฉ <em>ุจุงูู ุงููุณุฑุญ</em> .  ุณูุชู ุงุณุชุฎุฏุงู mbox ูุฅูุดุงุก ูููู ูููุฑุญูุฉ ุงูุณุงุจูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุงูุซุงูู ูู ุญูููุฉ ุฃู ูุชู ุฅูุดุงุก ูููุงุก ูููุฑุงุญู ูู ุชุฑุชูุจ ุงุญุชูุงุทู.  ููุฐุง ูุนูู ุฃูู ุฅุฐุง ูุงู ูุฏููุง ุฎุท ุฃูุงุจูุจ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">stage(A) | stage(B) | stage(C)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณูุชู ุฅูุดุงุก ูููู ูููุฑุญูุฉ C ุฃููุงู ุ ุซู ุณูุชู ุงุณุชุฎุฏุงู mbox ุงูุฎุงุต ุจู ูุฅูุดุงุก ูููู ูููุฑุญูุฉ B ุ ููู ุซู ุณูุชู ุงุณุชุฎุฏุงู mbox ูู ูููู B- ุงููุฑุญูุฉ ูุฅูุดุงุก ูููู ูููุฑุญูุฉ A. </p><br><p style=";text-align:right;direction:rtl">  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู <code>operator|()</code> ูุง ููุดุฆ ูููุงุก: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span>{ [prev, next]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage ) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> m = next.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prev.m_builder( coop, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(m) ); } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุดุฆ <code>operator|()</code> ููุดุฆูุง ูุณุชุฏุนู ููุดุฆูู ุขุฎุฑูู ููุท ูููู ูุง ููุฏู ุนูุงูู ุฅุถุงููุฉ.  ูุฐูู ุจุงููุณุจุฉ ูููุถูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">stage(A) | stage(B)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณูุชู ุฅูุดุงุก ูููููู ููุท (ูููุฑุญูุฉ A ู B- ุงููุฑุญูุฉ) ูุจุนุฏ ุฐูู ุณูุชู ุฑุจุทููุง ูุนูุง ูู <em>ููุดุฆ ุงููุฑุญูุฉ ุงูุฐู</em> ุชู ุฅูุดุงุคู ุจูุงุณุทุฉ <code>operator|()</code> . </p><br><h3 id="there-is-no-agent-for-broadcast-implementation" style=";text-align:right;direction:rtl">  ูุง ููุฌุฏ ูููู ูุชุทุจูู <code>broadcast()</code> </h3><br><p style=";text-align:right;direction:rtl">  ุชุชูุซู ุฅุญุฏู ุงูุทุฑู ุงููุงุถุญุฉ ูุชุทุจูู ูุฑุญูุฉ ุงูุจุซ ูู ุฅูุดุงุก ูููู ุฎุงุต ูุชููู ุฑุณุงูุฉ ูุงุฑุฏุฉ ุซู ูุนูุฏ ุฅุฑุณุงู ูุฐู ุงูุฑุณุงูุฉ ุฅูู ูุงุฆูุฉ ุจูุฑุจุนุงุช mbox ุงูููุตูุฏุฉ.  <a href="">ุชู ุงุณุชุฎุฏุงู</a> ูุฐู ุงูุทุฑููุฉ <a href="">ูู ุงูุชูููุฐ ุงูุฃูู</a> ูุฎุท ุฃูุงุจูุจ DSL ุงูููุตูู. </p><br><p style=";text-align:right;direction:rtl">  ููู ูุดุฑูุนูุง ุงููุตุงุญุจ ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">so5extra</a> ุ ูุฏูู ุงูุขู ููุน ุฎุงุต ูู mbox: ุฅุฐุงุนุฉ ูุงุญุฏุฉ.  ูุนูู mbox ุจุงูุถุจุท ุนูู ูุง ูู ูุทููุจ ููุง: ููู ูุฃุฎุฐ ุฑุณุงูุฉ ุฌุฏูุฏุฉ ููููู ุจุชุณููููุง ุฅูู ูุฌููุนุฉ ูู mboxes ุงููุฌูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุนุฏู ูุฌูุฏ ุญุงุฌุฉ ูุฅูุดุงุก ูููู ุจุซ ูููุตู ุ ูููููุง ููุท ุงุณุชุฎุฏุงู mbox ููุจุซ ูู so5extra: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // A special mbox for broadcasting of a message to a set of destination // mboxes. // using broadcast_mbox_t = so_5::extra::mboxes::broadcast::fixed_mbox_template_t&lt;&gt;; ... // // Inside the broadcast() function: // stage_builder_t builder{ [broadcasts = collect_sink_builders( move(first), forward&lt; Rest &gt;(stages)...)] ( coop_t &amp; coop, mbox_t ) -&gt; mbox_t { vector&lt; mbox_t &gt; mboxes; mboxes.reserve( broadcasts.size() ); for( const auto &amp; b : broadcasts ) mboxes.emplace_back( b( coop, mbox_t{} ) ); // That is the creation of broadcasting mbox instance. return broadcast_mbox_t::make( coop.environment(), std::move(mboxes) ); } };</span></span></code> </pre> <br><h3 id="implementation-of-stage-agent" style=";text-align:right;direction:rtl">  ุชูููุฐ ูููู ุงููุฑุญูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููููุง ุฅููุงุก ูุธุฑุฉ ุนูู ุชูููุฐ ูููู ุงููุฑุญูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// // An agent which will be used as intermediate or terminal pipeline stage. // It will receive input message, call the stage handler and pass // handler result to the next stage (if any). // template&lt; typename In, typename Out &gt; class a_stage_point_t final : public agent_t { public : a_stage_point_t( context_t ctx, stage_handler_t&lt; In, Out &gt; handler, mbox_t next_stage ) : agent_t{ ctx } , m_handler{ move( handler ) } , m_next{ move(next_stage) } {} void so_define_agent() override { if( m_next ) // Because there is the next stage the appropriate // message handler will be used. so_subscribe_self().event( [=]( const In &amp; evt ) { auto r = m_handler( evt ); if( r ) so_5::send( m_next, r ); } ); else // There is no next stage. A very simple message handler // will be used for that case. so_subscribe_self().event( [=]( const In &amp; evt ) { m_handler( evt ); } ); } private : const stage_handler_t&lt; In, Out &gt; m_handler; const mbox_t m_next; }; // // A specialization of a_stage_point_t for the case of terminal stage of // a pipeline. This type will be used for stage handlers with void // return type. // template&lt; typename In &gt; class a_stage_point_t&lt; In, void &gt; final : public agent_t { public : a_stage_point_t( context_t ctx, stage_handler_t&lt; In, void &gt; handler, mbox_t next_stage ) : agent_t{ ctx } , m_handler{ move( handler ) } { if( next_stage ) throw std::runtime_error( "sink point cannot have next stage" ); } void so_define_agent() override { so_subscribe_self().event( [=]( const In &amp; evt ) { m_handler( evt ); } ); } private : const stage_handler_t&lt; In, void &gt; m_handler; };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููุง ุชุงููุฉ ุฅูู ุญุฏ ูุง ุฅุฐุง ููุช ุชููู ุฃุณุงุณูุงุช SObjectizer.  ุฅุฐุง ูู ููู ุงูุฃูุฑ ูุฐูู ุ ูุณูููู ูู ุงูุตุนุจ ููุบุงูุฉ ุดุฑุญู ุจุนุฏุฉ ูููุงุช (ูุฐูู ูุง ุชุชุฑุฏุฏ ูู ุทุฑุญ ุงูุฃุณุฆูุฉ ูู ุงูุชุนูููุงุช). </p><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุชุทุจูู ุงูุฑุฆูุณู ููููู <code>a_stage_point_t</code> ุจุฅูุดุงุก ุงุดุชุฑุงู ูู ุฑุณุงูุฉ ูู ุงูููุน In.  ุนูุฏ ูุตูู ุฑุณุงูุฉ ูู ูุฐุง ุงูููุน ุ ูุชู ุงุณุชุฏุนุงุก <em>ูุนุงูุฌ ุงููุฑุญูุฉ</em> .  ูู ุญุงูุฉ ุฅุฑุฌุงุน <em>ูุนุงูุฌ ุงููุฑุญูุฉ</em> ููุชูุฌุฉ ูุนููุฉ ุ ูุชู ุฅุฑุณุงู ุงููุชูุฌุฉ ุฅูู ุงููุฑุญูุฉ ุงูุชุงููุฉ (ุฅุฐุง ูุงูุช ุชูู ุงููุฑุญูุฉ ููุฌูุฏุฉ). </p><br><p style=";text-align:right;direction:rtl">  ููุฌุฏ ุฃูุถูุง ุฅุตุฏุงุฑ <code>a_stage_point_t</code> ููุญุงูุฉ ุนูุฏูุง ุชููู ุงููุฑุญูุฉ ุงูููุงุจูุฉ ูู ุงููุฑุญูุฉ ุงูููุงุฆูุฉ ููุง ูููู ุฃู ุชููู ููุงู ุงููุฑุญูุฉ ุงูุชุงููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฏ ูุจุฏู ุชุทุจูู <code>a_stage_point_t</code> ูุนูุฏูุง ุจุนุถ ุงูุดูุก ูููู <code>a_stage_point_t</code> ุ ุฅูู ุฃุญุฏ ุฃุจุณุท ุงูุนูุงูู ุงูุชู ูุชุจุชูุง. </p><br><h2 id="make_pipeline-function" style=";text-align:right;direction:rtl">  ูุธููุฉ make_pipeline () </h2><br><p style=";text-align:right;direction:rtl">  ุญุงู ุงูููุช ูููุงูุดุฉ ุขุฎุฑ ูุธููุฉ ูุจูุงุก ุฎุทูุท ุงูุฃูุงุจูุจ ุ <code>make_pipeline()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Args &gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> make_pipeline( <span class="hljs-comment"><span class="hljs-comment">// SObjectizer Environment to work in. so_5::environment_t &amp; env, // Definition of a pipeline. stage_t&lt; In, Out &gt; &amp;&amp; sink, // Optional args to be passed to make_coop() function. Args &amp;&amp;... args ) { auto coop = env.make_coop( forward&lt; Args &gt;(args)... ); auto mbox = sink.m_builder( *coop, mbox_t{} ); env.register_coop( move(coop) ); return mbox; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ููุฌุฏ ุณุญุฑ ููุง ููุงุฌุขุช ููุง.  ูุญุชุงุฌ ููุท ุฅูู ุฅูุดุงุก ุญุธูุฑุฉ ุฌุฏูุฏุฉ ููุนูุงูู ุงูุฃุณุงุณูุฉ ูุฎุท ุงูุฃูุงุจูุจ ุ ูููุก ุชูู ุงููููุนุฉ ุจุงููููุงุก ุนู ุทุฑูู ุงุณุชุฏุนุงุก <em>ููุดุฆ ูุฑุญูุฉ ูู</em> ุงููุณุชูู ุงูุฃุนูู ุ ููู ุซู ุชุณุฌูู ุฐูู ุงูููุงุฒ ูู SObjectizer.  ูุฐุง ูู ุดูุก. </p><br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉ <code>make_pipeline()</code> ูู mbox ูููุฑุญูุฉ ุงูุฃูุซุฑ ูุณุงุฑูุง (ุงูุฃููู) ูู ุฎุท ุงูุฃูุงุจูุจ.  ูุฌุจ ุงุณุชุฎุฏุงู mbox ูุฅุฑุณุงู ุงูุฑุณุงุฆู ุฅูู ุฎุท ุงูุฃูุงุจูุจ. </p><br><h1 id="the-simulation-and-experiments-with-it" style=";text-align:right;direction:rtl">  ุงููุญุงูุงุฉ ูุงูุชุฌุงุฑุจ ูุนูุง </h1><br><p style=";text-align:right;direction:rtl">  ุฅุฐู ูุฏููุง ุงูุขู ุฃููุงุน ุงูุจูุงูุงุช ููุธุงุฆููุง ูููุทู ุงูุชุทุจูู ูุฏููุง ูุงูุฃุฏูุงุช ุงููุงุฒูุฉ ูุชุณูุณู ุชูู ุงููุธุงุฆู ุฅูู ุฎุท ุฃูุงุจูุจ ููุนุงูุฌุฉ ุงูุจูุงูุงุช.  ุฏุนููุง ููุนู ุฐูู ููุฑู ุงููุชูุฌุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Launch SObjectizer in a separate thread. wrapped_env_t sobj; // Make a pipeline. auto pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(archiving), stage(distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(alarm_initiator), stage( []( const alarm_detected &amp; v ) { alarm_distribution( cerr, v ); } ) ) ) ); // Send messages to a pipeline in a loop with 10ms delays. for( uint8_t i = 0; i &lt; static_cast&lt; uint8_t &gt;(250); i += 10 ) { send&lt; raw_value &gt;( pipeline, raw_measure{ 0, 0, i } ); std::this_thread::sleep_for( chrono::milliseconds{10} ); } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูููุง ุจุชุดุบูู ูุฐุง ุงููุซุงู ุ ูุณูุฑู ุงูุฅุฎุฑุงุฌ ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">archiving (0,0) distributing (0,0) archiving (0,5) distributing (0,5) archiving (0,10) distributing (0,10) archiving (0,15) distributing (0,15) archiving (0,20) distributing (0,20) archiving (0,25) distributing (0,25) archiving (0,30) distributing (0,30) ... archiving (0,105) distributing (0,105) archiving (0,110) distributing (0,110) === alarm (0) === alarm_distribution (0) archiving (0,115) distributing (0,115) archiving (0,120) distributing (0,120) === alarm (0) === alarm_distribution (0)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅูู ูุนูู. </p><br><p style=";text-align:right;direction:rtl">  ููู ูุจุฏู ุฃู ูุฑุงุญู ุฎุท ุฃูุงุจูุจูุง ุชุนูู ุจุงูุชุชุงุจุน ุ ูุงุญุฏุฉ ุชูู ุงูุฃุฎุฑู ุ ุฃููุณ ูุฐููุ </p><br><p style=";text-align:right;direction:rtl">  ูุนู ูู ูุฐูู.  ูุฐูู ูุฃู ุฌููุน ูููุงุก ุฎุทูุท ุงูุฃูุงุจูุจ ูุฑุชุจุทูู ุจู ูุฑุณู SObjectizer ุงูุงูุชุฑุงุถู.  ููุณุชุฎุฏู ูุฐุง ุงููุฑุณู ุฎูุท ุนุงูู ูุงุญุฏ ููุท ูุฎุฏูุฉ ูุนุงูุฌุฉ ุงูุฑุณุงุฆู ูุฌููุน ุงููููุงุก. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูุฐุง ูููู ุชุบููุฑู ุจุณูููุฉ.  ูุง ุนููู <code>make_pipeline()</code> ุชูุฑูุฑ ูุณูุทุฉ ุฅุถุงููุฉ <code>make_pipeline()</code> ููุงููุฉ <code>make_pipeline()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Make a pipeline. auto pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(archiving), stage(distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(alarm_initiator), stage( []( const alarm_detected &amp; v ) { alarm_distribution( cerr, v ); } ) ) ), disp::thread_pool::make_dispatcher( sobj.environment() ).binder( disp::thread_pool::bind_params_t{}.fifo( disp::thread_pool::fifo_t::individual ) ) );</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุคุฏู ูุฐุง ุฅูู ุฅูุดุงุก ุชุฌูุน ูุคุดุฑุงุช ุชุฑุงุจุท ุฌุฏูุฏ ููุฑุจุท ูุงูุฉ ุนูุงูู ุฎุท ุฃูุงุจูุจ ุฅูู ุฐูู ุงูุชุฌูุน.  ุณูุชู ุชูุฏูู ุงูุฎุฏูุงุช ููู ูููู ุจุดูู ูุณุชูู ุนู ุงููููุงุก ุงูุขุฎุฑูู. </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูููุง ุจุชุดุบูู ุงููุซุงู ุงููุนุฏู ุ ูููููุง ุฃู ูุฑู ุดูุฆูุง ููุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">archiving (0,0) distributing (0,0) distributing (0,5) archiving (0,5) archiving (0,10) distributing (0,10) distributing (archiving (0,15) 0,15) archiving (0,20) distributing (0,20) archiving (0,25) distributing (0,25) archiving (0,distributing (030) ,30) ... archiving (0,distributing (0,105) 105) archiving (0,alarm_distribution (0) distributing (0,=== alarm (0) === 110) 110) archiving (distributing (0,0,115) 115) archiving (distributing (=== alarm (0) === 0alarm_distribution (0) 0,120) ,120)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐูู ูููููุง ุฃู ูุฑู ุฃู ุงููุฑุงุญู ุงููุฎุชููุฉ ูุฎุท ุงูุฃูุงุจูุจ ุชุนูู ุจุดูู ูุชูุงุฒู. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูู ูู ุงููููู ุงููุถู ูุฏููุง ููุฏููุง ุงููุฏุฑุฉ ุนูู ุฑุจุท ุงููุฑุงุญู ุจุงููุฑุณููู ุงููุฎุชููููุ </p><br><p style=";text-align:right;direction:rtl">  ูุนู ุ ูุฐุง ูููู ุ ููู ูุชุนูู ุนูููุง ุชูููุฐ ูุธููุฉ ุญูู ุฒุงุฆุฏ ุฃุฎุฑู <code>stage()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Callable, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> In = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::arg_type, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Out = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> <span class="hljs-keyword"><span class="hljs-keyword">callable_traits_t</span></span>&lt; Callable &gt;::result_type &gt; <span class="hljs-keyword"><span class="hljs-keyword">stage_t</span></span>&lt; In, Out &gt; stage( <span class="hljs-keyword"><span class="hljs-keyword">disp_binder_shptr_t</span></span> disp_binder, Callable handler ) { <span class="hljs-keyword"><span class="hljs-keyword">stage_builder_t</span></span> builder{ [binder = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(disp_binder), h = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(handler)]( <span class="hljs-keyword"><span class="hljs-keyword">coop_t</span></span> &amp; coop, <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> next_stage) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">mbox_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> coop.make_agent_with_binder&lt; <span class="hljs-keyword"><span class="hljs-keyword">a_stage_point_t</span></span>&lt;In, Out&gt; &gt;( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(binder), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(h), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(next_stage) ) -&gt;so_direct_mbox(); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(builder) }; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ููุจู ูุฐุง ุงูุฅุตุฏุงุฑ ูู <code>stage()</code> <em>ูุนุงูุฌ ุงููุฑุญูุฉ</em> ูุญุณุจ ุ ุจู ููุจู ุฃูุถูุง ุฑุงุจุท ุงููุฑุณูู. Dispatcher binder is a way to bind an agent to the particular dispatcher. So to assign a stage to a specific working context we can create an appropriate dispatcher and then pass the binder to that dispatcher to <code>stage()</code> function. Let's do that: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// An active_obj dispatcher to be used for some stages. auto ao_disp = disp::active_obj::make_dispatcher( sobj.environment() ); // Make a pipeline. auto pipeline = make_pipeline( sobj.environment(), stage(validation) | stage(conversion) | broadcast( stage(ao_disp.binder(), archiving), stage(ao_disp.binder(), distribution), stage(range_checking) | stage(alarm_detector{}) | broadcast( stage(ao_disp.binder(), alarm_initiator), stage(ao_disp.binder(), []( const alarm_detected &amp; v ) { alarm_distribution( cerr, v ); } ) ) ), disp::one_thread::make_dispatcher( sobj.environment() ).binder() );</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl"> In that case stages <code>archiving</code> , <code>distribution</code> , <code>alarm_initiator</code> and <code>alarm_distribution</code> will work on own worker threads. All other stages will work on the same single worker thread. </p><br><h1 id="the-conclusion" style=";text-align:right;direction:rtl"> The conclusion </h1><br><p style=";text-align:right;direction:rtl"> This was an interesting experiment and I was surprised how easy SObjectizer could be used in something like reactive programming or data-flow programming. </p><br><p style=";text-align:right;direction:rtl"> However, I don't think that pipeline DSL can be practically meaningful. It's too simple and, maybe not flexible enough. But, I hope, it can be a base for more interesting experiments for those why need to deal with different workflows and data-processing pipelines. At least as a base for some ideas in that area. C++ language a rather good here and some (not so complicated) template magic can help to catch various errors at compile-time. </p><br><p style=";text-align:right;direction:rtl"> In conclusion, I want to say that we see SObjectizer not as a specialized tool for solving a particular problem, but as a basic set of tools to be used in solutions for different problems. And, more importantly, that basic set can be extended for your needs. Just take a look at <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SObjectizer</a> , try it, and share your feedback. Maybe you missed something in SObjectizer? Perhaps you don't like something? <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Tell us</a> , and we can try to help you. </p><br><p style=";text-align:right;direction:rtl"> If you want to help further development of SObjectizer, please share a reference to it or to this article somewhere you want (Reddit, HackerNews, LinkedIn, Facebook, Twitter, ...). The more attention and the more feedback, the more new features will be incorporated into SObjectizer. </p><br><p style=";text-align:right;direction:rtl"> And many thanks for reading this ;) </p><br><p style=";text-align:right;direction:rtl">  PS. The source code for that example can be found in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">that repository</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar460123/">https://habr.com/ru/post/ar460123/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar460113/index.html">ุจุนุถ ุงููุตุต ูู ุญูุงุฉ JSOC CERT ุ ุฃู ุงูุทุจ ุงูุดุฑุนู Unbanal</a></li>
<li><a href="../ar460115/index.html">ุนุดุฑ ุณููุงุช ูู ุงูุจุฑูุฌุฉ ูู Erlang</a></li>
<li><a href="../ar460117/index.html">ูู ุฃูุจุฑ ุงูุนููุงุก ูู ุฑูุณูุง ูู ุงูููุฒ ุจุงูุฌุงุฆุฒุฉ ุงููุจุฑู ุฃู ุงูุตุฏุงุนุ ุชุฌุฑุจุฉ ุฃุฌููุง</a></li>
<li><a href="../ar460119/index.html">ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃุฎุทุงุก ุชุญููู ุงูุชุญููู ุงูุซุงุจุช ูุฃูู ูุง ูุชู ุงุณุชุฎุฏุงูู</a></li>
<li><a href="../ar460121/index.html">ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃุฎุทุงุก ุชุญููู ุงูุชุญููู ุงูุซุงุจุช ูุฃูู ูุง ูุชู ุงุณุชุฎุฏุงูู</a></li>
<li><a href="../ar460125/index.html">Node.js ุฃู Java: ุงูุฃุฏุงุก ูุงูููุงุฑุฏ ูุงูุชุญูู ูู ุงูุชุฏูู ูุงูุดุนุจูุฉ ูุงูุชุฌุฑุจุฉ ุงูุดุฎุตูุฉ</a></li>
<li><a href="../ar460129/index.html">ุงูุฑูุจูุชุงุช ูุงููุฑุงููุฉ: ููู ุชุฒูุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงูุบูุฉ ุงูุญูููุฉ</a></li>
<li><a href="../ar460131/index.html">Sophos XG Firewall: ูู ME ุงูููุงุณููู ุฅูู NGFW ูุน ุงูุงุณุชุฌุงุจุฉ ุงูุชููุงุฆูุฉ ูุญูุงุฏุซ ุฃูู ุงููุนูููุงุช</a></li>
<li><a href="../ar460133/index.html">Kotlin / Everywhere - ููุงุฑุณุฉ ุนุฑุถ: 31 ููููู</a></li>
<li><a href="../ar460135/index.html">ุฃุณุจูุน ุงูุฃูุงู 29: ุงูุชูุจูุฑ ุ ุงูุฃูู ุ ูุฏุฑุงูุง ุงูุถุนู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>