<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∑ üç± ü•° Des mesures simples et un moyen de gagner du temps lors de la recherche de probl√®mes dans l'infrastructure ‚òÅÔ∏è üßúüèæ ü§ñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il n'y a pas si longtemps, dans le centre de donn√©es dans lequel nous louons des serveurs, un autre mini-incident s'est produit. En cons√©quence, il n'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Des mesures simples et un moyen de gagner du temps lors de la recherche de probl√®mes dans l'infrastructure</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/okmeter/blog/420663/"><img align="left" width="400" src="https://habrastorage.org/webt/xd/nn/aj/xdnnajw_nxmqcrpoadpeyzgz7k8.png">  Il n'y a pas si longtemps, dans le centre de donn√©es dans lequel nous louons des serveurs, un autre mini-incident s'est produit.  En cons√©quence, il n'y a eu aucune cons√©quence grave pour notre service; selon les m√©triques disponibles, nous avons pu comprendre ce qui se passait en une minute.  Et puis j'ai imagin√© comment je devrais me creuser la t√™te s'il ne manquait que 2 mesures simples.  Sous la coupe, une petite histoire en images. <br><a name="habracut"></a><br>  Imaginez que nous ayons vu une anomalie dans la chronologie de r√©ponse d'un certain service.  Pour simplifier, nous prenons le gestionnaire / ping, qui n'acc√®de ni √† la base de donn√©es ni aux services voisins, mais renvoie simplement '200 OK' (il est n√©cessaire pour les √©quilibreurs de charge et k8 pour le service de v√©rification de l'√©tat) <br><br><img src="https://habrastorage.org/webt/u3/ci/z3/u3ciz3vudxjjvn-entj0gbkwkb8.png"><br>  Quelle est la premi√®re pens√©e?  C'est vrai, le service n'a pas assez de ressources, probablement le CPU!  Nous regardons la consommation du processeur: <br><br><img src="https://habrastorage.org/webt/k2/ii/wj/k2iiwjy9gel-bsycb2snkzkjyse.png"><br>  Oui, il y a des rafales similaires.  Ensuite, nous regardons la consommation des services sur le serveur: <br><br><img src="https://habrastorage.org/webt/xc/mg/sr/xcmgsrv65dhrn4whdrgqg74cuk0.png"><br><br>  On voit que la consommation de proca a augment√© proportionnellement pour tous les services.  Vous ne pouvez rien dire de plus explicite: vous pouvez aller voir si le profil de charge a chang√© (puisque tous les composants sont connect√©s et une augmentation des demandes d'entr√©e peut en fait entra√Æner une augmentation proportionnelle de la consommation de ressources) ou comprendre ce qu'est devenu les ressources du serveur. <br><br>  Bien s√ªr, j'ai essay√© de pr√©server l'intrigue du mieux que je pouvais, mais au d√©but de l'article, vous avez probablement d√©j√† devin√© que le serveur avait simplement r√©duit le nombre de ticks de processeur disponibles.  Dans dmesg, cela ressemble √† ceci: <br><br> <code>CPU3: Core temperature above threshold, cpu clock throttled (total events = 88981) <br></code> <br><br>  En gros, nous avons r√©duit la fr√©quence en raison de la surchauffe du processeur.  Nous regardons la temp√©rature: <br><br><img src="https://habrastorage.org/webt/tk/-b/zo/tk-bzojwdfsmzzbynhh__zautby.png"><br><br>  maintenant tout est clair.  Comme nous avons imm√©diatement eu un comportement similaire sur 6 serveurs, nous nous sommes rendu compte que le probl√®me se trouvait dans le DC, et pas dans tout, mais seulement dans certaines rang√©es de racks. <br><br>  Mais revenons aux mesures.  Nous voulons potentiellement savoir si les serveurs surchaufferont √† l'avenir, mais ce n'est pas une raison pour ajouter un graphique des temp√©ratures du processeur √† tous les tableaux de bord et le v√©rifier √† chaque fois. <br><br>  Habituellement, des d√©clencheurs sont utilis√©s pour suivre certaines mesures afin d'optimiser le processus.  Mais quel seuil dois-je choisir pour un d√©clencheur en fonction de la temp√©rature du processeur? <br><br>  <i>C'est √† cause de la difficult√© de choisir un bon seuil pour le d√©clencheur, de nombreux ing√©nieurs r√™vent d'un d√©tecteur d'anomalie, qui sans r√©glages se retrouvera, je ne sais pas quoi :)</i> <br><br>  La premi√®re pens√©e est de fixer la temp√©rature seuil √† laquelle notre service a commenc√© √† avoir des probl√®mes.  Et si vous n'avez jamais eu de surchauffe?  Bien s√ªr, vous pouvez consulter mon emploi du temps et d√©cider par vous-m√™me que 95 ¬∞ C est ce dont vous avez besoin, mais r√©fl√©chissons un peu plus. <br><br>  Le probl√®me avec nous n'est pas √† cause des degr√©s, mais parce que la fr√©quence a diminu√©!  Gardons une trace du nombre de ces √©v√©nements. <br>  Sous Linux, cela peut √™tre supprim√© de sysfs: <br><br> <code>/sys/devices/system/cpu/cpu*/thermal_throttle/package_throttle_count <br></code> <br><br><img src="https://habrastorage.org/webt/ep/oj/9p/epoj9ph-c-7yagzfnlp07twjrlc.png"><br><br>  Pour √™tre honn√™te, nous n'affichons m√™me cette statistique nulle part, nous n'avons un d√©clencheur automatique pour tous les clients qui se d√©clenche lorsque le seuil "&gt; 10 √©v√©nements / seconde" est atteint.  Selon nos statistiques, il n'y a pratiquement pas de faux positifs √† ce seuil. <br><br>  Oui, ce d√©clencheur fonctionne rarement, mais lorsque cela se produit, cela rend la vie tr√®s facile! <br><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chez okmeter.io, la</a> plupart du temps, nous sommes engag√©s dans le d√©veloppement de notre base de donn√©es d'auto-d√©clencheurs, ce qui permet √† nos clients de trouver plus facilement les probl√®mes qui leur sont inconnus.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420663/">https://habr.com/ru/post/fr420663/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420653/index.html">Cinq choses que vous devez faire pour √©quiper votre maison sur Mars</a></li>
<li><a href="../fr420655/index.html">Des robots louent des appartements via Airbnb pour apprendre √† mieux saisir les objets</a></li>
<li><a href="../fr420657/index.html">Analyse: sur l'argent duquel Elon Musk pourra retirer Tesla de la bourse</a></li>
<li><a href="../fr420659/index.html">Campagne USB de HRF (Human Rights Foundation) ¬´Flash Drives for Freedom¬ª</a></li>
<li><a href="../fr420661/index.html">Infrastructure cloud continue</a></li>
<li><a href="../fr420665/index.html">Cr√©ation d'une application sur .NET Core et Kubernetes: notre exp√©rience</a></li>
<li><a href="../fr420667/index.html">Principes de fonctionnement du protocole EIGRP</a></li>
<li><a href="../fr420669/index.html">Aper√ßu du march√© de l'automatisation d'entreprise: solutions pour les soci√©t√©s de construction et de gestion de logements et de services publics</a></li>
<li><a href="../fr420671/index.html">[Ekaterinbourg, annonce] UralJS # 9 - trois rapports sur les microservices, les tests et la journalisation des erreurs √† l'avant</a></li>
<li><a href="../fr420673/index.html">Docker pour Symfony 4 - du LAN √† la production</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>