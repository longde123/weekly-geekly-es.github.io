<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö≠ üë®üèΩ‚Äç‚öïÔ∏è ü•ú L'histoire de la fa√ßon dont j'ai mis √† jour Yandex MapKit sur iOS ou des cartes, de l'argent, 2 mappits üë®üèº‚ÄçüöÄ üë®üèª üëô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©face 

 Bonjour mes amis , au d√©but, je d√©crirai imm√©diatement le but de l'article: gagner du temps si vous devez mettre √† jour ou int√©grer des car...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>L'histoire de la fa√ßon dont j'ai mis √† jour Yandex MapKit sur iOS ou des cartes, de l'argent, 2 mappits</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427611/"><h3>  Pr√©face </h3><br><br>  <b>Bonjour</b> mes <b>amis</b> , au d√©but, je d√©crirai imm√©diatement le but de l'article: <b>gagner du temps</b> si vous devez <b>mettre</b> √† <b>jour ou int√©grer des cartes Yandex</b> dans votre client mobile iOS, ainsi que le d√©sir de partager votre exp√©rience. <br><br>  Une fois, nous avons int√©gr√© l'application YandexMapkit (environ en octobre 2017) au lieu des cartes de messagerie (rien de personnel - juste des affaires).  Apr√®s environ 3 mois, par une belle journ√©e d'hiver, la version Androyd des cartes est tomb√©e en panne le jour 2 √† cause des cl√©s, la carte s'est juste transform√©e en citrouille) Quelle est l'astuce du manuel: "Sur l'andro√Øde, les cartes ont √©t√© cass√©es, ils ne savent pas comment y rem√©dier" en tant que client iOS, cela n'a pas affect√©.  Pauvres gars sur l'andro√Øde ... cette fois, les gars n'avaient rien √† voir avec.  √Ä cette √©poque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">, de nombreuses loges sont tomb√©es</a> : le poste de Russie, l'ornithorynque, vous vous souvenez peut-√™tre? <br><br><img src="https://habrastorage.org/webt/ny/sl/uk/nysluk1xq_j6lfzmv2tmusk_gci.png"><br><br>  Je veux dire, lorsque votre application est li√©e √† des services tiers, ce serait bien d'avoir un plan ¬´B¬ª pour ce cas, par exemple, passer √† la version pr√©c√©dente de l'impl√©mentation des cartes d'Apple, et ne pas les remplacer par une autre ... <br><br>  Apr√®s encore 3 mois, quelque part en mars, une lettre est arriv√©e de Yandex qu'ils avaient finalement mis √† jour sdk, (tr√®s peu de temps s'est √©coul√©, 4-5 ans depuis la mise √† jour pr√©c√©dente): <br>  "-Mettez √† jour, √©teignez l'ancien en un an", en bref.  Avant cela, il y avait simplement une ancienne version 1.0 <br><br><img src="https://habrastorage.org/webt/mk/bn/el/mkbnelhsho-0yzuynyrwg8fw6by.png"><br><a name="habracut"></a><br>  Eh bien, bien s√ªr, apr√®s un tel avertissement, nous n'avons pas tir√© et avons imm√©diatement commenc√© la transition ... apr√®s 3 mois)) en ao√ªt. <br><br><h2>  √âtape de ¬´commenter¬ª (d√©sactivation de la fonctionnalit√©) </h2><br>  Vous dites, ha ... ce qui est mis √† jour l√†-bas, pod mis √† jour, corrig√© quelques endroits et c'est tout.  Alors non, les gars, la nouvelle API de carte n'est absolument pas compatible avec l'ancienne, et de plus, comme il s'est av√©r√© plus tard, il y a m√™me beaucoup de n√©cessit√©s vitales qui sont pr√™tes √† l'emploi dans l'ancienne version et d'autres biblioth√®ques de cartes! <br><br>  Ainsi, mapkit 3.0 (lors de la r√©daction d'un article version 3.1 a √©t√© publi√©), un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien vers la documentation</a> . <br><br>  Et pourquoi, outre un avertissement de Yandex?  En attendant, sur une version b√™ta de Xcode 10, un projet avec une vieille baleine ne va b√™tement pas, car C ++ est utilis√© quelque part √† l'int√©rieur, qui est d√©prikri√© dans la nouvelle version.  Il faut le renommer dans la sous-liste, m√™me le mettre √† jour l√†-bas, etc., bref, je ne l'ai pas fait, car au final j'ai encore besoin de le mettre √† jour <br><br>  1) Nous mettons √† jour sdk, au lieu de la version 1.0 imm√©diatement 3.0, bien s√ªr l'API a chang√©, mais tellement .... <br><br>  Donc, l'ancien protocole YMKAnnotation est tout simplement manquant <br><br><img src="https://habrastorage.org/webt/0y/ma/2j/0yma2jg0ol_cmlsv5iawysjcq4c.png"><br><br><br>  En swift, cela ressemble √† un strig forg√© de force (: ce n'est pas un bourdonnement, puis vous portez un signe "!" Pour vous-m√™me ... Exemple d'impl√©mentation de protocole: <br><br><img src="https://habrastorage.org/webt/6_/7u/uw/6_7uuw9qsz5xa0xydgf5rqeturk.png"><br><br>  Eh bien, r√©√©crivons) la n√¥tre, seulement au lieu de la m√©thode coordonn√©e (), nous cr√©erons les propri√©t√©s, tout est simple, la m√©thode est redondante;  title! () est remplac√© par un title non form√© (), d'autre part, vous pouvez cr√©er une propri√©t√©, eh bien, il y a beaucoup de choses o√π vous devez changer le projet, donc je viens de supprimer le point d'exclamation. <br><br>  Dans notre projet, il √©tait n√©cessaire de remplacer plusieurs fois 3 contr√¥leurs, d'importer CoreLocation dans un autre, car il n'est d√©sormais import√© dans aucun des en-t√™tes Yandex MapPocket. <br><br>  Afin de ne pas renommer le YMKMapCoordinate familier (vieille baleine) tout au long du projet, faites des typealias pour YMKPoint (nouvelle baleine) <br><br><img src="https://habrastorage.org/webt/bk/xi/iv/bkxiivvenzq6k_yulfn8thesay8.png"><br><br>  2) D√©clarons √©galement quelques propri√©t√©s dont nous aurons besoin √† l'avenir pour travailler avec la carte, principalement des getters: <br><br><img src="https://habrastorage.org/webt/wx/15/zu/wx15zujdm2ylkpok3cujwbagzog.png"><br><br>  3) La premi√®re chose √† cr√©er est YMKMapView (tout va bien, un tel objet est toujours disponible).  Auparavant, je l'avais initialis√© tout de suite, maintenant vous ne pouvez pas faire √ßa, √ßa va planter, car vous devez d'abord mettre la cl√©!  La cl√© actuelle ne fonctionnera pas et vous devez en demander une nouvelle.  Ajoutez √† AppDelegate, selon la documentation.  Ce n'est qu'apr√®s avoir d√©fini la cl√© que nous pouvons cr√©er YMKMapView et le configurer de la mani√®re dont nous avons besoin dans la m√©thode setupMap () <br><br><img src="https://habrastorage.org/webt/ab/fp/8b/abfp8ba-jefubna2qmqsmsxpg7q.png"><br><br>  Ce qui se passe ici, nous analyserons en d√©tail plus tard au cours de la n√©cessit√© de param√®tres appropri√©s <br><br>  4) Quelle est la prochaine √©tape?, Puis nous avons eu l'emplacement initial de CLLocation, mais maintenant pour l'utiliser, vous devez ajouter le framework CoreLocation manuellement, ou ... ou le remplacer par YMKPoint √† partir du kit de cartes Yandex <br><br><img src="https://habrastorage.org/webt/jw/eo/hj/jweohjs_xdkhqdjhg5ludux4qsi.png"><br><br>  5) De plus, la carte √©tait centr√©e sur cette coordonn√©e par une m√©thode tr√®s simple, mais maintenant il n'y a pas de <br><br><img src="https://habrastorage.org/webt/db/w_/sf/dbw_sf_pf_7nqkfk4wil_mlt8kw.png"><br><br>  Mais il y a un peu plus compliqu√© et un peu plus profond, l'objet map) ... mapView.mapWindow.map! .Move.  Nous apprenons ici l'existence d'un tel objet comme YMKCameraPosition. <br><br><img src="https://habrastorage.org/webt/6y/hd/lt/6yhdltmfe8hap6p06qzpyk7clj8.png"><br><br>  6) Ensuite, nous commentons la configuration de la carte, car il n'y a pas de telles API / propri√©t√©s.  Maintenant, nous l'omettons juste pour commencer au moins de fa√ßon minimale. <br><br>  Nous commentons l'ajout d'annotations (je ferai attention √† ce que ce soit une fonctionnalit√© standard), nous commentons √©galement √† montrer les points les plus proches (c'est d√©j√† une sorte de notre fonctionnalit√©). <br><br>  Et l'ensemble de YMKMapViewDelegate est √©galement un commentaire, que je n'ai pas trouv√© dans le nouveau cadre, et un analogue similaire aussi. <br><br><img src="https://habrastorage.org/webt/ug/jg/ix/ugjgixhzbdvdjtqnyz3g-vawas8.png"><br><br>  J'ai omis l'impl√©mentation, seulement les m√©thodes elles-m√™mes: <br><br>  - s'il faut afficher l'emplacement de l'utilisateur, <br>  - quelles vues utiliser pour les broches, <br>  - r√©action au clic sur l'annotation, <br>  - quelles l√©gendes d'annotation, <br>  - La r√©action au clic sur la l√©gende, c'est-√†-dire tout ce que nous utilisons habituellement.  √Ä la fin, il y avait une sorte de notre m√©thode, qui utilisait √©galement une carte API sp√©cifique. <br><br>  <b>TOUT</b> compris avec MapVC - c'est la classe principale o√π le mapkit a √©t√© utilis√© <br><br>  7) Un petit commentaire sur la l√©gende personnalis√©e, elle n'h√©ritera plus de YMKCalloutView, il n'y en a plus dans la nouvelle baleine. <br><br>  Hourra, maintenant que le projet est rassembl√©, j'ai pu tout d√©marrer et ... voir le cahier dans la bo√Æte, car apr√®s le d√©marrage, il faut donner le temps de "se r√©chauffer")), mais je ne le savais pas et je pensais que quelque chose n'allait pas donc, m√™me si j'ai sugg√©r√© qu'il fallait du temps pour activer la cl√©.  Il s'av√®re que l'hypoth√®se √©tait correcte.  Vous devez attendre environ une heure (peut-√™tre que quelque chose a chang√© maintenant). <br><br>  Avec une autre tentative de modifier l'ancienne API d'une nouvelle mani√®re, la carte a √©t√© affich√©e. <br><br><h2>  Deuxi√®me √©tape - ¬´recherche¬ª (comment mettre en ≈ìuvre l'ancienne fonctionnalit√© d'une nouvelle mani√®re) </h2><br>  Commen√ßons par restaurer la fonctionnalit√© perdue.  Donc, vous devez afficher le verrou utilisateur, mais √† l'ancienne, il ne suffit pas de modifier la propri√©t√© et de d√©finir le d√©l√©gu√©. <br><br>  Maintenant, cela se fait √† travers la couche, voir le point 3 de la m√©thode setupMap (). <br><br><img src="https://habrastorage.org/webt/cs/w5/c8/csw5c8t0hyasi5x87xzmgeffs60.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nous allons jeter un ≈ìil</a> √† l'exemple de la d√©mo (√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©charger sur Yandex github</a> ), car il est l√†.  Au fait, vous devez faire attention √† setAnchorWith.  Plus tard, je dirai pourquoi, il est associ√© au zoom.  L'emplacement fonctionne bien. <br><br>  2) Quelle est la prochaine, bien s√ªr, les annotations.  Vous ne pouvez pas ajouter √† l'ancienne, nous regardons √† nouveau dans la d√©mo.  Il y a une classe l√†-bas - MapObjectsViewController.  Dans la nouvelle version, pour ajouter des √©pingles √† la carte, le d√©l√©gu√© n'est pas n√©cessaire, pour cela, vous devez acc√©der √† la propri√©t√© mapObjects, appeler la m√©thode addPlacemark sur l'objet et y transmettre les coordonn√©es (il y a encore d'autres surcharges) Exemple: <br><br><img src="https://habrastorage.org/webt/-c/au/s4/-caus4cx0bkkkniwy66g8mpqi6k.png"><br><br>  Nous parcourons la collection d'annotations (par exemple, apr√®s avoir re√ßu du serveur) et en ajoutons une √† la carte.  La m√©thode, en passant, renvoie ¬´placeMark¬ª (√©tiquette de lieu), qui peut √™tre utilis√© pour effectuer des param√®tres suppl√©mentaires, par exemple, changer l'ordre d'affichage via la propri√©t√© zIndex. <br><br>  Ici, cependant, j'ai rat√© le point qu'avant cela, je suis mont√© pour chercher un d√©l√©gu√© et je ne l'ai pas trouv√© en toute s√©curit√© et pas un seul d√©l√©gu√© du tout (en fait, ils ont juste commenc√© √† √™tre appel√©s diff√©remment, maintenant ils sont des auditeurs).  Je sais par exp√©rience pr√©c√©dente avec la baleine d'Apple et la vieille baleine Yandex que les annotations sont r√©utilis√©es, tout comme avec les cellules, mais il n'y a que addPlacemark dans la d√©mo.  √Ä la question sur les cartes Yandex (une petite connaissance personnelle a aid√© ici) "- Comment optimiser l'utilisation de la m√©moire, r√©utiliser les objets?"  R√©ponse: "Pourquoi, donc √ßa marche bien" ... enfin, en quelque sorte oui, √ßa marche. <br><br>  Remarque: 1) Il est important de noter que Yandex.Maps utilise un mapkit et ne le d√©veloppe pas.  Ceci est fait par l'√©quipe de mapkit (surnom de Nikolai sur le hub - likhogrud @). <br><br>  2) Explication pourquoi les objets ne sont pas r√©utilis√©s: <br><br>  Dans la vieille baleine, les annotations √©taient des vues, elles ont √©t√© cr√©√©es par l'utilisateur, et bien s√ªr les vues doivent √™tre r√©utilis√©es, car les cr√©er n'est pas bon march√©.  Dans la nouvelle baleine, des rep√®res sont cr√©√©s par le mapkit directement dans GL ouvert.  Et peut-√™tre qu'ils sont r√©utilis√©s l√†-bas, mais c'est inexact.  Dans tous les cas, c'est beaucoup plus efficace que de cr√©er une vue. <br><br>  3) A partir du nouveau, il y a d'ailleurs la possibilit√© de modifier l'ic√¥ne d'annotation pour l'utilisateur.  Impl√©ment√© comme suit: vous devez ajouter un √©couteur (analogue du d√©l√©gu√©), impl√©menter le protocole appropri√© - 1 m√©thode sur 3, 2 simplement laisser vide. <br><br>  En m√™me temps, rechargez le rep√®re avec nos ic√¥nes. <br><br><img src="https://habrastorage.org/webt/yq/2t/cv/yq2tcvkmlgp6mxfh5hpppwqgmk4.png"><br><br>  Aussi, j'attire votre attention sur la propri√©t√© de l'ancre.  Apr√®s avoir appuy√© sur le bouton de localisation de l'utilisateur sur la carte, la cam√©ra d√©place la mise au point au centre de la position.  Mais le probl√®me est que presser √† nouveau l'action ne produit pas.  Quoi?  Nous commentons la m√©thode d'ancrage et tout fonctionne. <br><br>  4) Vous devez maintenant afficher la l√©gende, respectivement, pour d√©terminer le clic.  Il existe plusieurs m√©thodes dans les interfaces, la bonne est YMKMapObjectTapListener.  Il y a 1 m√©thode int√©ressante et importante avec laquelle j'ai d√ª me tourmenter plus tard, elle revient vraie pour ne pas s'int√©grer davantage si un abonn√© est trouv√©.  J'attire votre attention, vous devez d'abord vous abonner, mapObjects sera abonn√© (ligne 149). <br><br><img src="https://habrastorage.org/webt/ar/2j/gp/ar2jgphtrvt_or_szwtibdupw74.png"><br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Les clics sont donc satisfaisants.  <b>Hourra</b> .  Cependant, il y a eu des tentatives pour afficher les broches uniquement dans la zone visible, c'est superflu, montrons tout √† la fois, alors laissons cela (juste parce qu'il ne ralentit pas) <br><br>  5) Ensuite, je voulais faire un zoom avant / arri√®re sur les boutons pour plus de commodit√©.  Un petit copier-coller et des modifications par analogie avec le bouton de localisation, et vous avez termin√©. <br><br>  De plus, puisque nous connaissons la cam√©ra, en utilisant la m√©thode de d√©placement et, en cons√©quence, le zoom actuel + - 1 ou 0,5, selon vos besoins.  Tout va bien ici. <br><br><img src="https://habrastorage.org/webt/ar/_s/-p/ar_s-pit7r4wjzzbrbgyiylgm00.png"><br><br>  6) Nous passons √† la fonction principale - l√©gende (c'est un rectangle avec des informations suppl√©mentaires, avec un triangle en bas).  Il s'av√®re qu'il n'y a pas d'API (¬´enivrant en √©t√©¬ª - Yandex a reconnu mon discours lorsque j'ai lu des notes dans une brochure pour ne pas taper manuellement cet article). <br><br><img src="https://habrastorage.org/webt/ck/b3/ew/ckb3ewygj9uy3itbzrlq63wqtfk.png"><br><br>  Comment √ßa va?  100 500 applications utilisent une l√©gende. <br><br>  Nous √©crivons bien dans le ¬´support technique¬ª (Kolya) comment proc√©der manuellement, je d√©couvre.  Quelles sont vos options? <br><br>  <s>Convertissez la vue en image, puisque vous ne pouvez pas ajouter directement une vue</s> (ajout d'un fichier en 3.1), changez l'ic√¥ne ... <br><br><img src="https://habrastorage.org/webt/tz/w2/qd/tzw2qdppbx86whmrgmqqzmhysge.png"><br><br>  Ces b√©quilles sont obtenues sur un plat, il semblait bien plac√©. <br>  En fait, pas des b√©quilles, bien s√ªr, mais simplement l'absence je consid√®re la fonctionnalit√© de base <br><br>  7) D'accord, ajoutons d'abord une l√©gende de test, en tant que tel, nous utilisons un carr√© rouge.  Ainsi, en cliquant sur notre √©pingle, la m√©thode d√©l√©gu√© / auditeur est appel√©e, o√π le point de clic et l'objet sont transf√©r√©s.  Sans attendre une astuce, nous prenons ¬´point¬ª comme le point o√π vous souhaitez ajouter la l√©gende.  (Attention, est-ce que tout est fait correctement: "Ils ont cliqu√©, pris le point, attach√©?" Environ 80% ont r√©pondu correctement, 20% - non) <br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Et appelez la m√©thode d'assistance showCallout dans le corps de la m√©thode: <br><br><img src="https://habrastorage.org/webt/sq/aa/8w/sqaa8wmstqdunxobdbyr0xa0jg4.png"><br><br>  ligne 544 <br>  √Ä l'int√©rieur, cr√©ez une vue de test de couleur rouge quarante par quarante, convertissez-la en image, d√©clarez une constante x avec une valeur de 0,5, elle sera utilis√©e pour la position du triangle de l√©gende au milieu du point.  Il a refus√© l'id√©e de changer de position, a ensuite pr√©f√©r√© d√©placer la cam√©ra pour que la l√©gende s√©lectionn√©e s'affiche au milieu de l'√©cran du t√©l√©phone. <br><br>  Ensuite, nous d√©clarons la zone ¬´push¬ª de tappableArea, il existe une telle propri√©t√© dans le style d'ic√¥ne pour la broche.  Eh bien, vous pouvez limiter la zone de clic, et nous le ferons.  La zone varie de 0,0 √† 1,1.  nous avons besoin de la partie inf√©rieure, o√π il y a soi-disant un bouton qui a √©t√© transform√© en image auparavant (rappelez-vous).  D'accord, cela signifie la zone (0,0,5 - 1,1) puisque le bouton est en dessous. <br>  La restriction de zone fonctionne, mais il y a une nuance, telle qu'elle annule tout.  S'il y a une autre broche sous la zone non press√©e, appuyez sur pour y travailler.  La signification de cette zone?  Feraient-ils un drapeau ou quelque chose pour que le clic ne passe pas.  D'accord ... <br><br>  550 ligne <br>  cr√©ons un style pour l'ic√¥ne, vous pouvez imm√©diatement sp√©cifier la position de l'ancre dans le premier param√®tre, par exemple, je l'ai fait ci-dessous √† la ligne 557.  La position y est de 1,05 pour √©lever verticalement le triangle au-dessus de la broche <br><br>  559 ligne <br>  cr√©er notre l√©gende personnalis√©e d'une certaine taille, <br>  nous configurons les champs dont nous avons besoin en utilisant les informations de l'annotation s√©lectionn√©e selectedAnnotation, en particulier le titre et le sous-titre, l'inscription sur le bouton de cette l√©gende.  Vous pouvez alors faire ce que vous voulez.  L'annotation s√©lectionn√©e est d√©finie plus t√¥t dans le d√©l√©gu√©.  Mais pour l'instant, ajoutez le carr√© rouge cr√©√© plus t√¥t <br>  Ensuite, ajoutez une √©pingle √† la collection mapObjects, la m√©thode nous renverra le rep√®re ajout√©, enregistrez-le dans une variable, <br>  En cliquant sur la l√©gende elle-m√™me, un contr√¥leur d√©taill√© s'ouvre, et donc la nuance est que si sous la fen√™tre contextuelle une autre broche y est √©galement entr√©e, le d√©l√©gu√© fonctionnera √† nouveau, alors ici, vous devez changer l'ordre dans la hi√©rarchie via zIndex.  D√©finissez la visibilit√© et d√©placez notre l√©gende vers le centre sur la ligne 564 <br><br>  <b>Nuances</b> : le rep√®re variable est un pointeur vers la l√©gende. <br>  Au d√©but, nous ne l'avons pas, apr√®s avoir cliqu√© sur l'√©pingle, il appara√Æt, apr√®s avoir cliqu√© sur l'√©pingle suivante, nous devons supprimer notre premi√®re l√©gende et en ajouter une nouvelle.  Par cons√©quent, si le rep√®re variable! = Nil, vous devez supprimer l'ancien rep√®re de la collection mapObjects) <br><br><img src="https://habrastorage.org/webt/3r/fo/dg/3rfodg0siuahk0tsvk1qzyvydae.png"><br><br>  De plus, dans le cas de tapas sur la carte, vous devez masquer la l√©gende, donc dans la m√©thode d√©l√©gu√©e, nous attribuons un rep√®re, l'observateur fonctionne, la l√©gende est supprim√©e, et nous effa√ßons l'annotation s√©lectionn√©e <br><br>  Pour cela, nous nous sommes inscrits √† YMKMapInputListener plus t√¥t <br><br><img src="https://habrastorage.org/webt/ew/f-/a2/ewf-a2uvc7khz8okkxw-s6etxds.png"><br><br>  <s>√Ä son tour, la m√©thode de conversion des vues est la suivante.</s>  (Dans la version 3.1, ajout de la possibilit√© d'ajouter des vues √† la carte) <br>  Je ne d√©cris pas comment faire la vue), mais s'il y aura beaucoup de probl√®mes (c'est possible avec un triangle) avec √ßa, alors √©crivez, j'ajouterai cette √©tape <br><br><img src="https://habrastorage.org/webt/v1/mx/nk/v1mxnkmtkahrp5j6umoevtwadlc.png"><br><br>  La magie 20 ajout√©e √† la hauteur est n√©cessaire pour une place sous le triangle ci-dessous, que vous devrez dessiner <br><br>  Nous voulons √©galement que le popup apparaisse (soit attach√©) √† la broche √† un endroit sp√©cifique (gauche, droite, au milieu), pour cela il y a une propri√©t√© d'ancrage.  D√©fini comme suit: <br>  Nous divisons la zone visible de la carte en 3 zones verticales et d√©terminons dans laquelle nous nous trouvons, en fonction de cela, changeons la position de la reliure.  Dans l'exemple de code, nous v√©rifions si nous sommes sur le c√¥t√© gauche, par analogie, nous faisons pour le milieu, sinon la gauche et pas au milieu, respectivement, le point √† droite est <br><br><img src="https://habrastorage.org/webt/o-/xq/ii/o-xqiijbnowv2clav2ny2tl5drc.png"><br><br>  Une fonction d'aide pour v√©rifier si un point tombe dans une r√©gion: <br><br><img src="https://habrastorage.org/webt/dr/os/5e/dros5emmil06hsac_h-rdbwk_jq.png"><br><br>  Commencez.  √áa marche.  Mais il y a une nuance, il semblerait que nous essayons de zoomer, un, deux, trois, et la l√©gende s'√©loigne de la broche.  Quoi?  Comment? <br><br><img src="https://habrastorage.org/webt/9v/il/7f/9vil7fru-hbitdlkvqtu6oeyhnw.gif"><br><br>  7) Nous commen√ßons le d√©bogage, les coordonn√©es sont les m√™mes <br><br><img src="https://habrastorage.org/webt/tt/t1/u1/ttt1u1jgezg-_ld3n_ksj-e_m90.png"><br><br>  Puis il y a eu des tentatives pour comprendre ce qui se passe et comment √ßa marche, un autre retour √† la d√©mo, une recherche encore plus attentive des diff√©rences ... <br><br><img src="https://habrastorage.org/webt/oc/nb/d_/ocnbd_n89jitplbg4_dtukbnvlo.jpeg"><br><br>  Je remarque que les coordonn√©es sont transmises directement, et non celle qui est sur le robinet!  Mais j'ai d√©boulonn√©, il est clair que les coordonn√©es sont les m√™mes, c'est-√†-dire que le cercle et le carr√© ont la m√™me coordonn√©e. <br>  C'est pourquoi dans la m√©thode, je n'ai pas imm√©diatement acc√©d√© √† l'objet, mais pass√© le point, ce qui est incorrect. <br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Mais avez-vous besoin de mouler un objet, de prendre une propri√©t√© (partout o√π tout est appel√© diff√©remment, puis de coordonner, puis de pointer, ici maintenant la g√©om√©trie) est-ce une cr√©ative ou quoi)?  493 lignes <br><br><img src="https://habrastorage.org/webt/_u/oo/5h/_uoo5hjrg5okyoodbijb7s0rzzo.png"><br><br>  √âtant donn√© que nous devons traiter deux options pressantes: la premi√®re pour √©pingler, la seconde pour appeler et ne pas traiter les clics si nous avons cliqu√© √† nouveau sur la m√™me √©pingle, la <b>premi√®re</b> chose que nous faisons est de trouver l'√©pingle sur laquelle nous avons cliqu√© dans la collection d'√©pingles, en comparant coordonne la ligne 495, sinon retourne vrai, disant ainsi que nous avons trait√© le clic et n'avons pas besoin d'aller plus loin dans la hi√©rarchie <br><br>  <b>Deuxi√®mement</b> : nous le d√©terminons en cliquant sur la broche ou sur la l√©gende, nous comparerons √©galement les coordonn√©es des √©tiquettes de ligne 499.  Test d'√©galit√©: <br><br><img src="https://habrastorage.org/webt/xd/z5/lk/xdz5lkm2g-zehkggfea6rqdxkfa.png"><br><br>  <b>De plus,</b> si c'est une l√©gende et que nous voulons r√©pondre √† un clic de bouton (ou simuler, car maintenant c'est une image), et non √† toute la zone, alors nous devons faire des calculs avec des stylos :) <br><br><ol><li>  Convertir les coordonn√©es du monde en ligne d'√©cran 501 <br>  Nous nous consid√©rons: nous allons convertir les coordonn√©es de la carte en √©cran, nous savons o√π nous nous trouvons, puis en ajoutant la largeur et la hauteur de la vue, nous obtenons les points d'angle, mais pour une raison quelconque, ils ne correspondent pas et j'ai multipli√© manuellement par trois, dans mon cas pour le 10e iPhone)).  Comme il s'est av√©r√© plus tard, j'ai oubli√© et je n'ai pas pris en compte le nombre de pixels par point.  Ce que nous pouvons avoir 1x, (un point 1 pixel), 2x, 3x un point est de trois pixels. </li><li>  Calculons la hauteur du bouton - la hauteur de la l√©gende + la hauteur du triangle multipli√©e par l'√©chelle, informations sur l'√©chelle (ligne 498).  Ensuite, nous divisons tout cela en deux, car la hauteur du bouton est la moiti√© de la hauteur de la l√©gende </li><li>  Ensuite, nous calculons les coordonn√©es des angles, sur la base du fait que l'ancre (x: 0,5, y: 1), compte tenu de l'√©chelle et de l'aire du triangle)) </li><li>  Puis convertissez ces coordonn√©es d'√©cran en monde </li><li>  Cr√©er une zone visible bas√©e sur eux, est une zone de bouton </li><li>  Et nous v√©rifions si nous frappons la zone des boutons ou non.  Si vous appuyez, v√©rifiez le type d'annotation, selon le type que nous appelons une de nos m√©thodes: allez √† l'√©cran d√©taill√© ou s√©lectionnez ce magasin pour la livraison dans les cas avec StorePoint </li></ol><br>  Sinon, c'est un clic sur la broche et nous devons ajouter une l√©gende, ce que nous avons fait ci-dessus. <br><br>  C'est tout, cette premi√®re connaissance de la nouvelle baleine est termin√©e. <br><br>  <s>Ce que je veux dire d'autre, dans l'impl√©mentation actuelle des cartes mapkit, il contient beaucoup de fonctionnalit√©s qui ne sont pas utilis√©es, cela affecte √©galement la taille du binaire r√©sultant.</s>  <s>√ätes-vous pr√™t pour de tels sacrifices, √† l'avenir, les gars devraient √™tre d√©molis en modules apr√®s tout</s> .  J'ai √©galement entendu des coll√®gues de l'andro√Øde de l'atelier qu'il y avait des probl√®mes de compatibilit√© avec Kotlin. <br><br>  P.S.  Alors que j'ai d√©cid√© et commenc√© √† √©crire un article, la mise √† jour 3.1 est sortie, d'o√π les probl√®mes ci-dessus ont √©t√© r√©solus et mis en ≈ìuvre: <br><br>  Ajout√© <br><br>  Pour Android, les versions arm64 et x86 sont apparues. <br>  <b>Vous pouvez ajouter n'importe quel objet View √† la carte.</b> <b><br></b>  L'itin√©raire du v√©lo est apparu. <br>  Ajout d'annotations annulables pour Android. <br><br>  Chang√© <br><br>  <b>MapKit est divis√© en plusieurs parties:</b> <b><br></b>  MapKit - seulement une carte; <br>  MapKit Directions - itin√©raire de la voiture; <br>  MapKit Transport - itin√©raires pi√©tons, itin√©raires des transports publics et itin√©raires cyclables; <br>  Recherche MapKit - recherche et g√©ocodage; <br>  MapKit Places - panoramas. <br>  Pour iOS, les annotations annulables sont devenues plus strictes. <br><br>  Fixe <br><br>  Un certain nombre de bugs ont √©t√© corrig√©s. <br>  Am√©lioration des performances. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tech.yandex.ru/maps/doc/mapkit/3.x/concepts/versions-docpage</a> <br><br>  <b>√âcrivez vos commentaires, questions.</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr427611/">https://habr.com/ru/post/fr427611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr427601/index.html">Cas 5 + 1 o√π la sp√©cification de l'API REST joue un r√¥le √©norme</a></li>
<li><a href="../fr427603/index.html">Comment enfin commencer √† √©crire des tests et ne pas le regretter</a></li>
<li><a href="../fr427605/index.html">Comment la plateforme de crowdsourcing Yandex aide √† former des drones et √† √©valuer la qualit√© de service</a></li>
<li><a href="../fr427607/index.html">Datacenter en Suisse: travailler comme sur des roulettes</a></li>
<li><a href="../fr427609/index.html">R√©solution de l'√©quation avec division enti√®re sans force brute</a></li>
<li><a href="../fr427613/index.html">10 blogs utiles pour les programmeurs en anglais</a></li>
<li><a href="../fr427615/index.html">Arr√™tez de faire des sites de d√©filement sans fin«É</a></li>
<li><a href="../fr427617/index.html">√âvolution des wagons de chemin de fer</a></li>
<li><a href="../fr427623/index.html">3 livres sur C ++ 17 (en anglais)</a></li>
<li><a href="../fr427625/index.html">Comment √©crire un scanner de vuln√©rabilit√© et gagner de l'argent sur les exploits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>