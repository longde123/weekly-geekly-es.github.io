<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∏üèΩ üìå ‚öîÔ∏è Ein Bot f√ºr Starcraft in Rust, C oder einer anderen Sprache üë®üèæ‚Äçüè´ üé´ üßñüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="StarCraft: Brutkrieg . Dieses Spiel bedeutet mir so viel! Und f√ºr viele von Ihnen, denke ich. So sehr, dass ich mich frage, ob ich √ºberhaupt einen Lin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ein Bot f√ºr Starcraft in Rust, C oder einer anderen Sprache</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436254/"><img src="https://habrastorage.org/webt/qv/fa/ex/qvfaexsnkzmckmwrt_spqmc7nr4.png" align="left"><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">StarCraft: Brutkrieg</a> .  Dieses Spiel bedeutet mir so viel!  Und f√ºr viele von Ihnen, denke ich.  So sehr, dass ich mich frage, ob ich √ºberhaupt einen Link zu seiner Seite auf Wikipedia geben soll oder nicht. </p><br><p>  Einmal schickte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Halt</a> mir eine PM und bot an, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Rust</a> zu lernen.  Wie alle gew√∂hnlichen Menschen haben wir uns entschlossen, damit zu beginnen <del>  Hallo Welt </del>  Schreiben einer dynamischen Bibliothek f√ºr Windows, die in den Adressraum von StarCraft geladen und Einheiten verwaltet werden k√∂nnen. </p><br><p>  Der folgende Artikel beschreibt den Prozess des Findens von L√∂sungen und des Einsatzes von Technologien und Techniken, mit denen Sie neue Dinge √ºber Rust und sein √ñkosystem lernen k√∂nnen.  Sie k√∂nnen sich auch dazu inspirieren lassen, einen Bot in Ihrer Lieblingssprache zu implementieren, sei es C, C ++, Ruby, Python usw. </p><a name="habracut"></a><br><p>  Es lohnt sich auf jeden Fall, die Hymne S√ºdkoreas zu h√∂ren, w√§hrend Sie diesen Artikel lesen: </p><br><div class="spoiler">  <b class="spoiler_title">Starcraft OST</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/pNt0iVG2VOA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><h2 id="bwapi">  Bwapi </h2><br><p>  Dieses Spiel ist fast 20 Jahre alt.  Und es ist immer noch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">beliebt</a> ;  Meisterschaften zogen in den USA sogar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2017</a> viele Menschen an, wo der Kampf der Gro√ümeister Jaedong gegen Bisu stattfand.  Neben menschlichen Spielern nehmen auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">seelenlose Maschinen</a> an SC-Schlachten teil!  Und das ist wegen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BWAPI m√∂glich</a> .  Weitere n√ºtzliche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Links</a> . </p><br><p>  Seit √ºber einem Jahrzehnt gibt es eine Community von Bot-Entwicklern rund um dieses Spiel.  Enthusiasten erstellen Bots und nehmen an verschiedenen Meisterschaften teil.  Viele von ihnen studieren KI und maschinelles Lernen.  BWAPI wird von Universit√§ten verwendet, um ihre Studenten auszubilden.  Es gibt sogar einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zuckenden Kanal,</a> der solche Spiele sendet. </p><br><p>  Daher hat ein Fan-Team vor einigen Jahren das Starcraft-Backend umgekehrt und eine API in C ++ entwickelt, mit der Sie Bots erstellen, Injektionen in den Spielprozess vornehmen und elende Menschen dominieren k√∂nnen. </p><br><p>  Wie so oft vorher <del>  Beim Bau eines Hauses ist es notwendig, Erz abzubauen und Werkzeuge zu schmieden </del>  Um einen Bot zu erstellen, m√ºssen Sie eine API implementieren.  Was hat Rust zu bieten? </p><br><h2 id="ffi">  Ffi </h2><br><p>  Es ist ganz einfach, mit anderen Sprachen von Rust zu arbeiten.  Daf√ºr gibt es einen <abbr title="Fremdfunktionsschnittstelle">FFI</abbr> .  Lassen Sie mich einen kurzen Auszug aus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der Dokumentation geben</a> . </p><br><p>  Stellen Sie sich vor, wir haben eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bissige</a> Bibliothek mit einer Header-Datei <a href="">snappy-ch</a> , die Funktionsdeklarationen enth√§lt. </p><br><p>  Lassen Sie uns ein Projekt mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fracht</a> erstellen. </p><br><pre><code class="bash hljs">$ cargo new --bin snappy Created binary (application) `snappy` project $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> snappy snappy$ tree . ‚îú‚îÄ‚îÄ Cargo.toml ‚îî‚îÄ‚îÄ src ‚îî‚îÄ‚îÄ main.rs 1 directory, 2 files</code> </pre> <br><p>  Cargo hat eine Standarddateistruktur f√ºr das Projekt erstellt. </p><br><p>  In <code>Cargo.toml</code> wir die Abh√§ngigkeit von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">libc an</a> : </p><br><pre> <code class="plaintext hljs">[dependencies] libc = "0.2"</code> </pre> <br><p>  Die Datei <code>src/main.rs</code> sieht folgenderma√üen aus: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> libc; <span class="hljs-comment"><span class="hljs-comment">// To import C types, in our case for size_t use libc::size_t; #[link(name = "snappy")] // Specify the name of the library for linking the function extern { // We write the declaration of the function which we want to import // in C the declaration looks like this: // size_t snappy_max_compressed_length(size_t source_length); fn snappy_max_compressed_length(source_length: size_t) -&gt; size_t; } fn main() { let x = unsafe { snappy_max_compressed_length(100) }; println!("max compressed length of a 100 byte buffer: {}", x); }</span></span></code> </pre> <br><p>  Lassen Sie uns das Projekt erstellen und ausf√ºhren: </p><br><pre> <code class="bash hljs">snappy$ cargo build ... snappy$ cargo run Finished dev [unoptimized + debuginfo] target(s) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.02s Running `target/debug/snappy` max compressed length of a 100 byte buffer: 148</code> </pre> <br><p>  Sie k√∂nnen nur den <code>cargo build</code> aufrufen, der den <code>cargo build</code> vor dem Lauf aufruft.  Eine andere M√∂glichkeit besteht darin, das Projekt zu erstellen und die Bin√§rdatei direkt aufzurufen: </p><br><pre> <code class="bash hljs">snappy$ ./target/debug/snappy max compressed length of a 100 byte buffer: 148</code> </pre> <br><p>  Wenn die Snappy-Bibliothek installiert ist, wird der Code kompiliert (f√ºr Ubuntu sollten Sie das libsnappy-dev-Paket installieren). </p><br><pre> <code class="bash hljs">snappy$ ldd target/debug/snappy ... libsnappy.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libsnappy.so.1 (0x00007f8de07cf000)</code> </pre> <br><p>  Wie Sie sehen k√∂nnen, ist unsere Bin√§rdatei mit der gemeinsam genutzten Bibliothek libsnappy verkn√ºpft.  Ein Aufruf von <code>snappy_max_compressed_length</code> in unserem Code ist ein Funktionsaufruf aus dieser Bibliothek. </p><br><h2 id="rust-bindgen">  Rostbinder </h2><br><p>  Es w√§re sch√∂n, wenn wir unseren FFI automatisch generieren k√∂nnten.  Gl√ºcklicherweise gibt es in der Toolbox eines Rust-S√ºchtigen ein Dienstprogramm namens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">rust-bindgen</a> .  Es ist in der Lage, FFI-Bindungen an C-Bibliotheken (und einige C ++) zu generieren. </p><br><p>  Installation: </p><br><pre> <code class="bash hljs">$ cargo install bindgen</code> </pre> <br><p>  Wie sieht <strong>Rostbinden</strong> aus?  Wir nehmen die C / C ++ - Headerdateien, zeigen mit dem Dienstprogramm <strong>bindgen</strong> auf sie und die Ausgabe, die wir erhalten, wird Rust-Code mit den richtigen Deklarationen generiert, damit wir C-Strukturen und -Funktionen verwenden k√∂nnen.  <code>bindgen</code> generiert <code>bindgen</code> f√ºr bissig: </p><br><pre> <code class="rust hljs">$ bindgen /usr/include/snappy-ch | grep -C <span class="hljs-number"><span class="hljs-number">1</span></span> snappy_max_compressed_length <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">snappy_max_compressed_length</span></span></span></span>(source_length: <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>; }</code> </pre> <br><p>  Es stellt sich heraus, dass bindgen nicht mit BWAPI-Headern umgehen kann und Tonnen von nicht verwendbarem Code generiert (aufgrund von Funktionen f√ºr virtuelle Mitglieder, std :: string in einer √∂ffentlichen API usw.).  Die Sache ist, dass BWAPI in C ++ geschrieben ist.  C ++ ist im Allgemeinen selbst in C ++ - Projekten schwierig zu verwenden.  Sobald die Bibliothek zusammengestellt ist, ist es besser, sie mit demselben Linker (derselben Version) zu verkn√ºpfen. Header-Dateien sollten mit demselben Compiler (derselben Version) analysiert werden.  All diese Faktoren k√∂nnen das Ergebnis beeinflussen.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mangeln</a> zum Beispiel, das immer noch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nicht ohne Fehler</a> in GNU GCC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">implementiert werden kann</a> .  Diese Faktoren sind so bedeutend, dass selbst <abbr title="Googles C ++ - Testframework">gtest</abbr> sie nicht √ºberwinden konnte.  In der <a href="">Dokumentation</a> hei√üt es: Sie sollten gtest besser als Teil des Projekts mit demselben Compiler und demselben Linker erstellen. </p><br><h2 id="bwapi-c">  Bwapi-c </h2><br><p>  C ist die Verkehrssprache der Softwareentwicklung.  Wenn rust-bindgen f√ºr die C-Sprache gut funktioniert, warum nicht BWAPI f√ºr C implementieren und dann dessen API verwenden?  Gute Idee! </p><br><p>  Ja, es ist eine gute Idee, bis Sie sich die Innenseiten von BWAPI ansehen und die Anzahl der Klassen und Methoden sehen, die Sie implementieren sollten.  Besonders all diese Speicherlayouts, ASM-Codes, Speicher-Patches und andere "Horrors", f√ºr die wir keine Zeit haben.  Es ist notwendig, die vorhandene L√∂sung vollst√§ndig zu nutzen. </p><br><p>  Aber wir m√ºssen die Funktionen Mangling, C ++ - Code, Vererbung und virtuelle Mitglieder irgendwie √ºbertreffen. </p><br><p>  In C ++ gibt es zwei leistungsstarke Tools, mit denen wir unser Problem l√∂sen k√∂nnen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">undurchsichtige Zeiger</a> und <code>extern "C"</code> . </p><br><p>  <code>extern "C" {}</code> erm√∂glicht es C ++ - Code, sich unter C zu "maskieren". Es erm√∂glicht das Generieren von Funktionsnamen ohne Mangeln. </p><br><p>  Undurchsichtige Zeiger erm√∂glichen es uns, den Typ zu l√∂schen und einen Zeiger auf "einen Typ" zu erstellen, ohne dessen Implementierung bereitzustellen.  Da dies nur eine Deklaration eines Typs ist, ist es unm√∂glich, diesen Typ als Wert zu verwenden. Sie k√∂nnen ihn nur als Zeiger verwenden. </p><br><p>  Stellen wir uns vor, wir haben diesen C ++ - Code: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> cpp { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bar; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;bar; } }; } <span class="hljs-comment"><span class="hljs-comment">// namespace cpp</span></span></code> </pre> <br><p>  Wir k√∂nnen daraus einen C-Header machen: </p><br><pre> <code class="plaintext hljs">extern "C" { typedef struct Foo_ Foo; // Opaque pointer to Foo // call cpp::Foo::get_bar int Foo_get_bar(Foo* self); }</code> </pre> <br><p>  Und hier ist der C ++ - Teil, der die Verbindung zwischen dem C-Header und der C ++ - Implementierung darstellt: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo_get_bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Foo* self)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// cast the opaque pointer to the certain cpp::Foo and call the method ::get_bar return reinterpret_cast&lt;cpp::Foo*&gt;(self)-&gt;get_bar(); }</span></span></code> </pre> <br><p>  Nicht alle Klassenmethoden mussten auf diese Weise verarbeitet werden.  In BWAPI gibt es Klassen, die Sie mithilfe der Felder dieser Strukturen selbst implementieren k√∂nnen, z. B. <code>typedef struct Position { int x; int y; } Position;</code> <code>typedef struct Position { int x; int y; } Position;</code>  und Methoden wie <code>Position::get_distance</code> . </p><br><p>  Es gab Klassen, die ich auf besondere Weise behandeln musste.  Beispielsweise sollte AIModule ein Zeiger auf eine C ++ - Klasse mit einem bestimmten Satz virtueller Elementfunktionen sein.  Trotzdem ist hier <a href="">Header</a> und <a href="">Implementierung</a> . </p><br><p>  Nach mehreren Monaten harter Arbeit, <strong>554</strong> Methoden und einem Dutzend Klassen wurde die plattform√ºbergreifende Bibliothek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BWAPI-C</a> geboren, mit der Sie <a href="">Bots in C erstellen k√∂nnen.</a>  Ein Nebenprodukt war die M√∂glichkeit der Kreuzkompilierung und die M√∂glichkeit, die API in einer anderen Sprache zu implementieren, die FFI und die cdecl-Aufrufkonvention unterst√ºtzt. </p><br><p>  Wenn Sie eine Bibliothek schreiben, schreiben Sie bitte deren API in C. </p><br><p>  Das wichtigste Merkmal von BWAPI-C ist die gr√∂√ütm√∂gliche Integration in andere Programmiersprachen.  <code>Python</code> , <code>Ruby</code> , <code>Rust</code> , <code>PHP</code> , <code>Java</code> und viele andere k√∂nnen mit C arbeiten. Wenn Sie also die Knicke ausb√ºgeln und eigene Wrapper implementieren, k√∂nnen Sie mit deren Hilfe auch einen Bot schreiben. </p><br><h2 id="writing-a-bot-in-c">  Einen Bot in C schreiben </h2><br><p>  Dieser Teil beschreibt die allgemeinen Prinzipien der internen Organisation von Starcraft-Modulen. </p><br><p>  Es gibt zwei Arten von Bots: Modul und Client.  Schauen wir uns ein Beispiel f√ºr das Schreiben eines Moduls an. </p><br><p>  Das Modul ist eine dynamische Bibliothek.  Das allgemeine Prinzip des Ladens dynamischer Bibliotheken kann hier eingesehen <a href="">werden</a> .  Das Modul sollte zwei Funktionen exportieren: <code>newAIModule</code> und <code>gameInit</code> . </p><br><p>  <code>gameInit</code> ist einfach.  Diese Funktion wird aufgerufen, um einen Zeiger auf ein aktuelles Spiel zu √ºbergeben.  Dieser Zeiger ist sehr wichtig, da es in der Wildnis von BWAPI eine globale statische Variable gibt, die in einigen Abschnitten des Codes verwendet wird.  Beschreiben <code>gameInit</code> : </p><br><pre> <code class="plaintext hljs">DLLEXPORT void gameInit(void* game) { BWAPIC_setGame(game); }</code> </pre> <br><p>  <code>newAIModule</code> ist etwas komplizierter.  Es sollte den Zeiger auf eine C ++ - Klasse zur√ºckgeben, die eine virtuelle Methodentabelle mit Namen wie <strong>onXXXXX enth√§lt,</strong> die bei bestimmten Spielereignissen aufgerufen werden.  Deklarieren wir die Struktur des Moduls: </p><br><pre> <code class="plaintext hljs">typedef struct ExampleAIModule { const AIModule_vtable* vtable_; const char* name; } ExampleAIModule;</code> </pre> <br><p>  Das erste Feld sollte ein Zeiger auf die Methodentabelle sein (es ist eine Art Magie).  Hier ist die <code>newAIModule</code> Funktion: </p><br><pre> <code class="plaintext hljs">DLLEXPORT void* newAIModule() { ExampleAIModule* const module = (ExampleAIModule*) malloc( sizeof(ExampleAIModule) ); module-&gt;name = "ExampleAIModule"; module-&gt;vtable_ = &amp;module_vtable; return createAIModuleWrapper( (AIModule*) module ); }</code> </pre> <br><p>  <code>createAIModuleWrapper</code> ist ein weiterer Zaubertrick, der den C-Zeiger in den Zeiger auf die C ++ - Klasse verwandelt <del>  virtuelle Methoden </del>  Mitgliedsfunktionen. </p><br><p>  <code>module_vtable</code> ist eine statische Variable in der Methodentabelle. Methodenwerte werden mit Zeigern auf globale Funktionen gef√ºllt: </p><br><pre> <code class="plaintext hljs">static AIModule_vtable module_vtable = { onStart, onEnd, onFrame, onSendText, onReceiveText, onPlayerLeft, onNukeDetect, onUnitDiscover, onUnitEvade, onUnitShow, onUnitHide, onUnitCreate, onUnitDestroy, onUnitMorph, onUnitRenegade, onSaveGame, onUnitComplete }; void onEnd(AIModule* module, bool isWinner) { } void onFrame(AIModule* module) {} void onSendText(AIModule* module, const char* text) {} void onReceiveText(AIModule* module, Player* player, const char* text) {} void onPlayerLeft(AIModule* module, Player* player) {} void onNukeDetect(AIModule* module, Position target) {} void onUnitDiscover(AIModule* module, Unit* unit) {} void onUnitEvade(AIModule* module, Unit* unit) {} void onUnitShow(AIModule* module, Unit* unit) {} void onUnitHide(AIModule* module, Unit* unit) {} void onUnitCreate(AIModule* module, Unit* unit) {} void onUnitDestroy(AIModule* module, Unit* unit) {} void onUnitMorph(AIModule* module, Unit* unit) {} void onUnitRenegade(AIModule* module, Unit* unit) {} void onSaveGame(AIModule* module, const char* gameName) {} void onUnitComplete(AIModule* module, Unit* unit) {}</code> </pre> <br><p>  Wenn Sie sich den Namen der Funktionen und ihre Signaturen ansehen, ist klar, unter welchen Bedingungen und mit welchen Argumenten sie aufgerufen werden m√ºssen.  Zum <a href="">Beispiel habe</a> ich alle Funktionen au√üer leer gemacht </p><br><pre> <code class="plaintext hljs">void onStart(AIModule* module) { ExampleAIModule* self = (ExampleAIModule*) module; Game* game = BWAPIC_getGame(); Game_sendText(game, "Hello from bwapi-c!"); Game_sendText(game, "My name is %s", self-&gt;name); }</code> </pre> <br><p>  Diese Funktion wird aufgerufen, wenn das Spiel ausgef√ºhrt wird.  Das Argument ist ein Zeiger auf das aktuelle Modul.  <code>BWAPIC_getGame</code> gibt einen globalen Zeiger auf das Spiel zur√ºck, den wir mit einem Aufruf von <code>BWAPIC_setGame</code> .  Lassen Sie uns ein funktionierendes Beispiel f√ºr das Cross-Kompilieren eines Moduls zeigen: </p><br><pre> <code class="bash hljs">bwapi-c/example$ tree . ‚îú‚îÄ‚îÄ BWAPIC.dll ‚îî‚îÄ‚îÄ Dll.c 0 directories, 2 files bwapi-c/example$ i686-w64-mingw32-gcc -mabi=ms -shared -o Dll.dll Dll.c -I../include -L. -lBWAPIC bwapi-c/example$ cp Dll.dll ~/Starcraft/bwapi-data/ bwapi-c/example$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Starcraft/bwapi-data/ Starcraft$ wine bwheadless.exe -e StarCraft.exe -l bwapi-data/BWAPI.dll --headful ... ... ...</code> </pre> <br><p>  Dr√ºcke die Kn√∂pfe und starte das Spiel.  Weitere Informationen zum Kompilieren und Ausf√ºhren finden Sie auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BWAPI-</a> Website und in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BWAPI-C</a> . </p><br><p>  Das Ergebnis des Moduls: </p><br><p><img src="https://habrastorage.org/webt/cw/a-/41/cwa-41ihsyva-pj2stpef1xjn2g.png" alt="Bild"></p><br><p>  Ein etwas komplizierteres Beispiel f√ºr ein Modul, das zeigt, wie man mit Iteratoren, Einheitenverwaltung, Mineralsuche und Statistikausgabe arbeitet, finden Sie in <a href="">bwapi-c / example / Dll.c.</a> </p><br><h2 id="bwapi-sys">  bwapi-sys </h2><br><p>  Im Rust-√ñkosystem gibt es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine bestimmte M√∂glichkeit</a> , Pakete zu benennen, die mit nativen Bibliotheken verkn√ºpft sind.  Jedes Paket foo-sys f√ºhrt zwei wichtige Funktionen aus: </p><br><ul><li>  Links zur nativen Bibliothek libfoo; </li><li>  stellt Deklarationen f√ºr die Funktionen aus der libfoo-Bibliothek bereit.  Aber nur Erkl√§rungen!  √úbergeordnete Abstraktionen werden in * -sys-Kisten nicht bereitgestellt. </li></ul><br><p>  Damit das * -sys-Paket erfolgreich verkn√ºpft werden kann, m√ºssen Sie die Fracht anweisen, nach der nativen Bibliothek <a href="">zu suchen</a> und / oder die Bibliothek aus den Quellen zu <a href="">erstellen</a> . </p><br><p>  Damit das * -sys-Paket Deklarationen bereitstellt, m√ºssen Sie diese entweder selbst schreiben oder mit bindgen generieren.  Wieder bindgen.  Versuch Nummer zwei =) </p><br><p>  Die Erzeugung von Bindungen ist super einfach: </p><br><pre> <code class="bash hljs">bindgen BWAPI.h -o lib.rs \ --opaque-type <span class="hljs-string"><span class="hljs-string">".+_"</span></span> \ --blacklist-type <span class="hljs-string"><span class="hljs-string">"std.*|__.+|.+_$|Game_v(Send|Print|Draw).*|va_list|.+_t$"</span></span> \ --no-layout-tests \ --no-derive-debug \ --raw-line <span class="hljs-string"><span class="hljs-string">"#![allow(improper_ctypes, non_snake_case)]"</span></span> \ -- -I../submodules/bwapi-c/include sed -i -r -- <span class="hljs-string"><span class="hljs-string">'s/.+\s+(.+)_;/pub struct \1;/'</span></span> lib.rs</code> </pre> <br><p>  <code>BWAPI.h</code> ist eine Datei mit allen C-Headern von BWAPI-C. </p><br><p>  Beispielsweise hat bindgen bereits solche Deklarationen f√ºr die obigen Funktionen generiert: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-comment"><span class="hljs-comment">/// BWAPIC_setGame must be called from gameInit to initialize BWAPI::BroodwarPtr pub fn BWAPIC_setGame(game: *mut Game); } extern "C" { pub fn BWAPIC_getGame() -&gt; *mut Game; }</span></span></code> </pre> <br><p>  Es gibt zwei Strategien: Speichern des generierten Codes im Repository und Generieren des Codes im laufenden Betrieb w√§hrend des Builds.  Beide Ans√§tze haben ihre Vor- und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nachteile</a> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Freut mich,</a> Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kennenzulernen bwapi-sys</a> ;  Noch ein kleiner Schritt zu unserem Ziel. </p><br><p>  Erinnerst du dich daran, dass ich fr√ºher √ºber plattform√ºbergreifend gesprochen habe?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">nlinker</a> schloss sich dem Projekt an und implementierte eine listige Strategie.  Wenn der Zielhost Windows ist, laden Sie das bereits zusammengestellte BWAPIC von GitHub herunter.  Und f√ºr die verbleibenden Ziele sammeln wir BWAPI-C aus den Quellen f√ºr OpenBW (ich werde es Ihnen etwas sp√§ter erz√§hlen). </p><br><h2 id="bwapi-rs">  bwapi-rs </h2><br><p>  Jetzt haben wir die Bindungen und k√∂nnen Abstraktionen auf hoher Ebene definieren.  Wir haben zwei Arten, mit denen wir arbeiten k√∂nnen: reine Werte und undurchsichtige Zeiger. </p><br><p>  Alles ist einfach mit reinen Werten.  Nehmen wir als Beispiel Farben.  Wir m√ºssen die Verwendung von Rust-Code vereinfachen, um Farben auf bequeme und nat√ºrliche Weise verwenden zu k√∂nnen: </p><br><pre> <code class="rust hljs">game.draw_line(CoordinateType::Screen, (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>), (<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>), Color::Red); ^^^</code> </pre> <br><p>  F√ºr eine bequeme Verwendung w√§re es daher erforderlich, die Aufz√§hlung mit C ++ - <a href="">Konstanten,</a> aber auch idiomatisch f√ºr Rust, zu definieren und Methoden f√ºr die Konvertierung in bwapi_sys :: Color mit std :: convert :: From zu definieren: </p><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// FFI version #[repr(C)] #[derive(Copy, Clone)] pub struct Color { pub color: ::std::os::raw::c_int, } // Idiomatic version #[derive(PartialEq, PartialOrd, Copy, Clone)] pub enum Color { Black = 0, Brown = 19, ...</span></span></code> </pre> <br><p>  F√ºr Ihre Bequemlichkeit k√∂nnen Sie die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Enum-Primitive-Derive-</a> Kiste verwenden. </p><br><p>  Es ist auch einfach, undurchsichtige Zeiger zu verwenden.  Verwenden wir das <a href="">Newtype-</a> Muster: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Player</span></span></span></span>(*<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> sys::Player);</code> </pre> <br><p>  Dies bedeutet, dass Player eine Art Struktur mit einem privaten Feld ist - ein roher undurchsichtiger Zeiger von C. Und so k√∂nnen Sie Player :: color definieren: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Player { <span class="hljs-comment"><span class="hljs-comment">// so the method is declared Player::getColor in bwapi-sys //extern "C" { // pub fn Player_getColor(self_: *mut Player) -&gt; Color; //} pub fn color(&amp;self) -&gt; Color { // bwapi_sys::Player_getColor - wrapper function from BWAPI-C // self.0 - opaque pointer let color = unsafe { bwapi_sys::Player_getColor(self.0) }; color.into() // cast bwapi_sys::Color -&gt; Color } }</span></span></code> </pre> <br><p>  Jetzt k√∂nnen wir unseren ersten Bot in Rust schreiben! </p><br><h2 id="creating-a-bot-in-rust">  Erstellen eines Bots in Rust </h2><br><p>  Als Proof of Concept wird der Bot einem bekannten Land √§hneln: Die ganze Aufgabe besteht darin, Arbeiter einzustellen und Mineralien zu sammeln. </p><br><p><img src="https://habrastorage.org/webt/hx/r_/jm/hxr_jmj2fbsitx-tfw96p2pa2tu.png" alt="Nordkorea"></p><br><p><img src="https://habrastorage.org/webt/ww/gf/lr/wwgflrekcnxtv75thaurrwcm0g8.png" alt="S√ºdkorea"></p><br><p>  Beginnen wir mit den erforderlichen Funktionen <code>gameInit</code> und <code>newAIModule</code> : </p><br><pre> <code class="rust hljs"><span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gameInit</span></span></span></span>(game: *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> void) { bwapi_sys::BWAPIC_setGame(game <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> bwapi_sys::Game); } <span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAIModule</span></span></span></span>() -&gt; *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> void { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> module = ExampleAIModule { name: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::from(<span class="hljs-string"><span class="hljs-string">"ExampleAIModule"</span></span>) }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = wrap_handler(<span class="hljs-built_in"><span class="hljs-built_in">Box</span></span>::new(module)); result }</code> </pre> <br><p>  <code>#[no_mangle]</code> f√ºhrt die gleiche Funktion wie <code>extern "C"</code> in C ++ aus.  Innerhalb von <code>wrap_handler</code> gesamte Magie auf, wobei die virtuelle Funktionstabelle ersetzt und die C ++ - Klasse "maskiert" wird. </p><br><p>  Die Definitionen der Modulstruktur sind noch einfacher und ausgefallener als in C: </p><br><pre> <code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleAIModule</span></span></span></span> { name: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, }</code> </pre> <br><p>  F√ºgen wir einige Methoden zum Rendern der Statistiken und zum Erteilen von Befehlen hinzu: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> ExampleAIModule { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw_stat</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> game = Game::get(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> message = <span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"Frame {}"</span></span>, game.frame_count()); game.draw_text(CoordinateType::Screen, (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), &amp;message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">give_orders</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> player = Game::get().self_player(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> unit <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> player.units() { <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> unit.get_type() { UnitType::Terran_SCV | UnitType::Zerg_Drone | UnitType::Protoss_Probe =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !unit.is_idle() { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> unit.is_carrying_gas() || unit.is_carrying_minerals() { unit.return_cargo(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-literal"><span class="hljs-literal">Some</span></span>(mineral) = Game::get() .minerals() .min_by_key(|m| unit.distance_to(m)) { <span class="hljs-comment"><span class="hljs-comment">// WE REQUIRE MORE MINERALS unit.right_click(&amp;mineral, false); } } UnitType::Terran_Command_Center =&gt; { unit.train(UnitType::Terran_SCV); } UnitType::Protoss_Nexus =&gt; { unit.train(UnitType::Protoss_Probe); } UnitType::Zerg_Hatchery | UnitType::Zerg_Lair | UnitType::Zerg_Hive =&gt; { unit.train(UnitType::Zerg_Drone); } _ =&gt; {} }; } } }</span></span></code> </pre> <br><p>  Um den ExampleAIModule-Typ in ein echtes Modul umzuwandeln, m√ºssen Sie ihn auf <strong>onXXXX-</strong> Ereignisse reagieren <strong>lassen</strong> .  Dazu m√ºssen Sie den EventHandler-Typ implementieren, der analog zur virtuellen Tabelle AIModule_vtable von C ist: </p><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> EventHandler <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ExampleAIModule { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { Game::get().send_text(&amp;<span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello from Rust! My name is {}"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_end</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _is_winner: <span class="hljs-built_in"><span class="hljs-built_in">bool</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_frame</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.draw_stat(); <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.give_orders(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_send_text</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _text: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_receive_text</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _player: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Player, _text: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_player_left</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _player: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Player) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_nuke_detect</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _target: Position) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_discover</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_evade</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_show</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_hide</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_create</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_destroy</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_morph</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_renegade</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_save_game</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _game_name: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_complete</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} }</code> </pre> <br><p>  Das Erstellen und Ausf√ºhren des Moduls ist so einfach wie bei C: </p><br><pre> <code class="bash hljs">bwapi-rs$ cargo build --example dll --target=i686-pc-windows-gnu bwapi-rs$ cp ./target/i686-pc-windows-gnu/debug/examples/dll.dll ~/Starcraft/bwapi-data/Dll.dll bwapi-rs$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Starcraft/bwapi-data/ Starcraft$ wine bwheadless.exe -e StarCraft.exe -l bwapi-data/BWAPI.dll --headful ... ... ...</code> </pre> <br><p>  Und das Video der Arbeit: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/rACbnWpI01M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="openbw">  Openbw </h2><br><p>  Diese Jungs gingen noch weiter.  Sie beschlossen, eine Open-Source-Version von SC: BW zu schreiben!  Und sie sind gut darin.  Eines ihrer Ziele war die Implementierung von HD-Bildern, aber SC: Remastered war ihnen voraus = (In diesem Moment k√∂nnen Sie ihre API zum Schreiben von Bots verwenden (ja, auch in C ++), aber das Erstaunlichste ist die F√§higkeit zum Anzeigen Wiedergabe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">direkt in Ihrem Browser</a> . </p><br><h2 id="conclusion">  Fazit </h2><br><p>  Bei der Implementierung gab es ein ungel√∂stes Problem: Wir steuern die Referenzen nicht als eindeutig, sodass das Vorhandensein von <code>&amp;mut</code> und <code>&amp;</code> f√ºr dieselbe Region zu einem undefinierten Verhalten f√ºhrt, wenn das Objekt ge√§ndert wird.  Eine Art √Ñrger.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Halt</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">versuchte</a> , idiomatische Bindungen zu implementieren, fand jedoch keine L√∂sung.  Wenn Sie diese Aufgabe ausf√ºhren m√∂chten, m√ºssen Sie die C ++ - API sorgf√§ltig "hochschaufeln" und die <code>const</code> Qualifizierer korrekt <code>const</code> . </p><br><p>  Ich habe es wirklich genossen, an diesem Projekt zu arbeiten, ich habe mir die Wiederholungen angesehen deeply Ï¢ÖÏùº und tief in die Atmosph√§re eingetaucht.  Dieses Spiel hat ein Universum in Mitleidenschaft gezogen.  Kein Spiel kann aufgrund seiner Beliebtheit bei SC: BW ÎπÑÍµêÌï† Ïàò ÏóÜÎã§ sein, und seine Auswirkungen auf ÎåÄÌïúÎØºÍµ≠ Ï†ïÏπò ÏóêÍ≤å waren undenkbar.  Pro-Gamer in Korea sind ebenso beliebt wie koreanische Dorams, die zur Hauptsendezeit senden.  ÎòêÌïú, ÌïúÍµ≠ ÏóêÏÑú ÌîÑÎ°ú Í≤åÏù¥Î®∏ ÎùºÎ©¥ Íµ∞ÎåÄ Íµ∞ÎåÄ ÌäπÎ≥ÑÌïú Ïú°Íµ∞ Ïóê Ïóê ÏûÖÎåÄ Ìï† Ïàò Ïàò. </p><br><p>  Es lebe StarCraft! </p><br><h2 id="links">  Links </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">reddit</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bwapi-rs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bwapi-sys</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bwapi-c</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bwapi</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">openbw</a> </li></ul><br><hr><br><p>  Vielen Dank an Steve Klabnik, der mir bei der Durchsicht des Artikels geholfen hat. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de436254/">https://habr.com/ru/post/de436254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de436242/index.html">YOLO und andere lose Methoden</a></li>
<li><a href="../de436244/index.html">Professor Lawrences neues Gehirn</a></li>
<li><a href="../de436246/index.html">Moderne Fahrzeugtechnik - 02. Sehr These √ºber OS</a></li>
<li><a href="../de436248/index.html">Kalman Filter</a></li>
<li><a href="../de436250/index.html">Blutsauger-Bosse aus dem Zusammenhang geraten oder warum sie immer versagen</a></li>
<li><a href="../de436256/index.html">Einen Job in Deutschland zu bekommen wird einfacher sein</a></li>
<li><a href="../de436260/index.html">Fehler und Fallstricke von Startups bei der Patentierung ihres geistigen Eigentums</a></li>
<li><a href="../de436262/index.html">* Das Ethereum-Update "Konstantinopel" wird aufgrund einer potenziellen Sicherheitsl√ºcke im letzten Moment verschoben</a></li>
<li><a href="../de436264/index.html">Mono-Repositories: bitte nicht (Teil 2)</a></li>
<li><a href="../de436266/index.html">Extreme Skalierung in Alibaba JDK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>