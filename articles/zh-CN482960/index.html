<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤙🏻 🔒 🖐🏾 WCS 5.2概述-用于在线广播和视频聊天的Web开发人员的WebRTC服务器 🤘🏾 👩🏽‍🔧 👩🏻‍🎓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alice是一位经验丰富的全栈开发人员，并且能够在一周内使用php在她最喜欢的框架上编写SAAS项目框架。 在前端，他更喜欢Vue.js。 


一位客户敲了一个电报，客户一定要开发一个网站，这将是雇主和雇员进行面谈的聚会地点。 全职-意味着眼与眼，通过视频和语音实时直接进行视频联系。 
 “为什么...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WCS 5.2概述-用于在线广播和视频聊天的Web开发人员的WebRTC服务器</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flashphoner/blog/482960/"><img src="https://habrastorage.org/webt/za/go/wo/zagowolkguxr8_bdsbwjmkvyd0a.jpeg"><br><br><p>  Alice是一位经验丰富的全栈开发人员，并且能够在一周内使用php在她最喜欢的框架上编写SAAS项目框架。 在前端，他更喜欢Vue.js。 </p><br><p>一位客户敲了一个电报，客户一定要开发一个网站，这将是雇主和雇员进行面谈的聚会地点。 全职-意味着眼与眼，通过视频和语音实时直接进行视频联系。 <br>  “为什么不使用Skype？”您问。 碰巧的是，认真的项目以及每个初创企业都毫无疑问地将自己视为一个企业，出于各种原因，它们试图提供内部通信服务，包括： <a name="habracut"></a></p><br><p>  1）不要将您的用户带给第三方交流者（Skype， <br> 环聊等）。 将它们留在服务中。 </p><br><p>  2）监控通讯：通话记录，采访结果。 </p><br><p>  3）录音（当然，要通知双方录音）。 </p><br><p>  4）不要依赖于第三方服务的策略和更新。 每个人都知道这个故事：Skype更新了，它开始了... </p><br><p> 任务看起来很简单。  WebRTC是有关该主题的google，看来您可以在两个浏览器之间组织对等连接，但是问题仍然存在： </p><br><p>  1）在哪里获得STUN / TURN服务器 </p><br><p>  2）有没有他们可以做 </p><br><p>  3）如何记录对等WebRTC呼叫 </p><br><p>  4）如果您需要在呼叫中添加第三方，例如人力资源经理或雇主的另一位专家，将会发生什么。 </p><br><p> 事实证明，仅WebRTC和对等网络还不够，并且不清楚如何处理所有这些以启动服务所需的视频功能。 </p><br><h2> 文章内容 </h2><br><div class="spoiler">  <b class="spoiler_title">目录</b> <div class="spoiler_text"><ul><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">服务器和API</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">传入流</a> <br><ul><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">WebRTC</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">RTMP</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">Rtsp</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">伏特</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">SIP / RTP</a> </li></ul><br></li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">外流</a> <br><ul><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">WebRTC</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">RTMP</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">Rtsp</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">微软</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">ls</a> </li></ul><br></li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">收件箱和发件箱</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">传入流操作</a> <br><ul><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">传入流录制</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">快照删除</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">将流添加到混音器</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">流转码</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">添加水印</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">添加FPS过滤器</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">将图片旋转90、180、270度</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">输入流的控制在哪里</a> </li></ul><br></li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">流中继</a> <br><ul><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">WebRTC</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">RTMP</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">SIP / RTP</a> </li></ul><br></li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">将服务器连接到CDN内容处理网络</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">总结一下</a> </li><li>  <a href="https://habr.com/ru/company/flashphoner/blog/482960/">参考文献</a> </li></ul><br></div></div><br><br><h2><a name="serverapi"></a> 服务器和API </h2><br><p> 为了消除所有这些白点，使用了服务器解决方案和对等服务器对等体系结构。  Web Call Server 5.2进一步的WCS是服务器解决方案之一-开发平台，使您可以向项目添加此类视频功能，而不必担心STUN / TURN和对等连接的稳定性。 </p><br><p> 在最高级别，WCS是JavaScript API +服务器部分。 该API用于在浏览器端的常规JavaScript上进行开发，并且服务器处理视频流量，充当媒体流量的状态代理。 </p><br><p><img src="https://habrastorage.org/webt/7a/w0/qv/7aw0qvwyfc9tak6ij9ycdr1sju4.png"></p><br><p> 除了JavaScript API，还有Android SDK和iOS SDK，分别需要为iOS和Android开发本机移动应用程序。 </p><br><p> 例如，将流发布到服务器（从网络摄像头流向服务器的流）如下所示： </p><br><p>  Web SDK </p><br><pre><code class="plaintext hljs">session.createStream({name:”stream123”}).publish();</code> </pre> <br><p>  Android SDK </p><br><pre> <code class="plaintext hljs">publishStream = session.createStream(streamOptions) publishStream.publish();</code> </pre> <br><p>  iOS SDK </p><br><pre> <code class="plaintext hljs">FPWCSApi2Stream *stream = [session createStream:options error:&amp;error]; if(![stream publish:&amp;error]) { //published without errors }</code> </pre> <br><p> 因此，您不仅可以实现Web应用程序，还可以为支持Google Play和App Store的完整版实现视频流。 将移动SDK添加到顶层图片中。 结果会是这样的： </p><br><p><img src="https://habrastorage.org/webt/tf/z-/ya/tfz-yax_izaf-eyitcvd57y82h0.png"><br><br></p><h2><a name="Incomingstreams"></a> 传入流 </h2><br><p> 流服务器（即WCS）从传入流开始。 要分发东西，您需要拥有它。 要将视频流分发给查看者，这些流必须进入服务器，通过其RAM并通过网卡退出。 因此，熟悉媒体服务器时首先要问的一个问题是：媒体服务器接受流的协议和格式。 对于WCS，这些是以下技术：WebRTC，RTMP，RTSP，VOD，SIP / RTP。 </p><br><p><img src="https://habrastorage.org/webt/du/2r/pc/du2rpcr6ihdkicklwlyusrodjog.png"></p><br><p> 每个协议都可以由不同的客户端使用。 例如，通过WebRTC，不仅浏览器的流可以进入，而且其他服务器也可以。 我们在表格中显示传入流量的可能来源。 </p><br><p></p><div class="scrollable-table"><table><tbody><tr><td>  <strong>WebRTC</strong> </td><td>  <strong>RTMP</strong> </td><td>  <strong>Rtsp</strong> </td><td>  <strong>伏特</strong> </td><td>  <strong>SIP / RTP</strong> </td></tr><tr><td><ul><li>  Web SDK <br><ul><li> 相机+麦克风 </li><li> 帆布 </li><li> 屏幕共享 </li></ul><br></li><li>  Android SDK </li><li>  iOS SDK </li><li>  WCS <br><ul><li> 推 </li><li> 拉 </li></ul><br></li><li> 光盘 </li></ul><br></td><td><ul><li>  RTMP编码器 <br><ul><li>  ffmpeg </li><li>  Obs </li><li> 有线广播 </li></ul><br></li><li>  Adobe编码器 </li><li>  WCS <br><ul><li> 推 </li><li> 拉 </li></ul><br></li><li>  Flash播放器 </li></ul><br></td><td><ul><li> 网络摄像机 </li><li>  RTSP服务器 </li></ul><br></td><td><ul><li> 文件系统 </li><li>  AWS S3 </li></ul><br></td><td><ul><li>  SIP端点 </li><li>  SIP会议 </li></ul><br></td></tr></tbody></table></div><br><p> 如果您查看传入流量的来源，则可以添加以下内容： </p><br><br><h3><a name="inWebRTC"></a>  <strong>传入的WebRTC</strong> </h3><br><p>  Web SDK使您不仅可以捕获相机和麦克风，还可以使用浏览器API的功能来访问屏幕-屏幕共享。 此外，您可以捕获任意的Canvas元素，并在其上进行后续广播的所有内容都是canvas流。 </p><br><p> 由于移动设备的特殊性，Android SDK和iOS SDK可以即时在设备的前后摄像头之间切换。 这样，您就可以在流式传输期间切换源而不停止流。 </p><br><p> 传入的WebRTC流也可以通过以下方法从另一台WCS服务器获得：推，拉和CDN，这将在后面讨论。 </p><br><p><img src="https://habrastorage.org/webt/zn/rw/5i/znrw5ikkd8vcjuexwarfzeqkhg4.jpeg"><br></p><h3><a name="inRTMP"></a>  <strong>入站rtmp</strong> </h3><br><p>  RTMP协议已广泛用于喜欢的OBS流媒体以及其他编码器中：Wirecast，Adobe Media Ensourcer，ffmpeg等。 使用这些编码器之一，您可以捕获流并将其发送到服务器。 </p><br><p> 您也可以从另一台媒体服务器或WCS服务器中拾取RTMP流。 <br> 使用推拉方法。 在推送的情况下，发起者是远程服务器。 在拉的情况下，我们转向本地的拉流，从远端的拉流。 </p><br><p><img src="https://habrastorage.org/webt/3o/8x/f8/3o8xf84v5rx2apw_09n_lm2cjoe.jpeg"></p><br><br><h3><a name="inRTSP"></a>  <strong>传入RTSP</strong> </h3><br><p>  RTSP通信的来源通常是IP摄像机或支持RTSP协议的第三方媒体服务器。 尽管启动RTSP连接时启动器是WCS，但从IP摄像机到该方向的音频和视频流量都向WCS服务器移动。 因此，我们将来自摄像机的流视为传入流。 </p><br><p><img src="https://habrastorage.org/webt/ch/pj/qi/chpjqiof2ipgoqzmwx0zzkewrgm.jpeg"></p><br><br><h3><a name="inVOD"></a>  <strong>收视点播</strong> </h3><br><p> 乍一看，似乎VOD（视频点播）功能专门与传出的流以及浏览器对文件的播放有关。 在我们的情况下，这有点不对。  WCS诚实地将mp4文件从文件系统转换为localhost，因此，将创建传入流，就好像它是来自第三方源一样。 此外，如果我们将一个查看器限制为一个mp4文件，我们将获得经典的VOD，其中查看器从一开始就开始播放流。 如果没有限制，我们将获得VOD LIVE-VOD的一种变体，观众可以在其中播放与流相同的文件，并连接到当前所有其他文件所在的播放点（预先录制的广播电视模式）。 </p><br><p><img src="https://habrastorage.org/webt/cn/ot/tv/cnottvwwytktaxh9vnbjexlxlaq.jpeg"><br><br></p><h3><a name="inSIP-RTP"></a>  <strong>传入的SIP / RTP</strong> </h3><br><p> 要在SIP会话中接收传入的RTP通信，您需要使用第三方SIP网关建立呼叫。 如果成功建立连接，则音频和/或视频流量将来自SIP网关，该网关将包装在WCS侧的传入流中。 </p><br><p><img src="https://habrastorage.org/webt/-r/km/io/-rkmio-9lhqlfjioblwkanzuxiq.jpeg"></p><br><br><h2><a name="Outgoingstreams"></a> 外流 </h2><br><p> 在服务器上接收到流之后，可以根据请求将接收到的流复制到一个或多个查看器。 观众向播放器或其他设备请求流。 这样的流被称为传出流或“观看者流”，因为此类流的会话总是在观看者/播放器方面发起。 回放技术集包括以下协议/格式：WebRTC，RTMP，RTSP，MSE，HLS </p><br><div class="scrollable-table"><table><thead><tr><th>  WebRTC </th><th>  RTMP </th><th>  Rtsp </th><th> 微软 </th><th>  ls </th></tr></thead><tbody><tr><td><ul><li>  Web SDK </li><li>  Android SDK </li><li>  iOS SDK </li><li>  WCS <br><ul><li> 拉 </li><li> 光盘 </li></ul><br></li></ul><br></td><td><ul><li>  Flash播放器 </li><li>  RTMP播放器 </li></ul><br></td><td><ul><li>  RTSP播放器 <br><ul><li>  VLC </li><li>  WCS </li><li> 等 </li></ul><br></li></ul><br></td><td><ul><li>  Web SDK </li></ul><br></td><td><ul><li>  HLS播放器 <br><ul><li>  hls.js </li><li> 野生动物园 </li></ul><br></li></ul><br></td></tr></tbody></table></div><br><br><br><h3><a name="outWebRTC"></a>  <strong>即将发布的WebRTC</strong> </h3><br><p> 在这种情况下，Web SDK，Android SDK和iOS SDK充当播放器的API。 播放WebRTC流的示例如下所示： </p><br><p>  Web SDK </p><br><pre> <code class="plaintext hljs">session.createStream({name:”stream123”}).play();</code> </pre> <br><p>  Android SDK </p><br><pre> <code class="plaintext hljs">playStream = session.createStream(streamOptions); playStream.play();</code> </pre> <br><p>  iOS SDK </p><br><pre> <code class="plaintext hljs">FPWCSApi2Stream *stream = [session createStream:options error:nil]; if(![stream play:&amp;error]) { //published without errors }</code> </pre> <br><p> 这与发布API非常相似，唯一的区别在于 <br>  stream.publish（），stream.play（）被调用进行播放。 </p><br><p> 播放器也可以是第三方WCS服务器，它将被指示通过WebRTC使用pull方法从另一台服务器通过WebRTC接收流或在CDN内接收流。 </p><br><br><h3> <strong><a name="outRTMP"></a></strong>  <strong>即将离任的rtmp</strong> </h3><br><p><img src="https://habrastorage.org/webt/in/zq/nb/inzqnbejvsout_d4n5iiej4gozi.png"></p><br><p> 这里主要是RTMP播放器-著名的Flash Player，以及使用RTMP协议的台式机和移动应用程序，都可以接收和播放RTMP流。 事实是，尽管Flash离开了浏览器，但它却离开了RTMP协议（该协议广泛用于视频广播），并且浏览器缺乏本机支持并不妨碍在其他客户端应用程序中使用这种相当成功的协议。 众所周知，RTMP在VR播放器中广泛用于Android和iOS的移动应用程序。 </p><br><br><h3><a name="outRTSP"></a>  <strong>传出RTSP</strong> </h3><br><p><img src="https://habrastorage.org/webt/ly/xu/r9/lyxur9b3gfzwsubfmrb3afmkfh0.png"></p><br><p>  WCS服务器可以充当RTSP服务器，并通过RTSP作为常规IP摄像机分发接收到的流。 在这种情况下，播放器必须与服务器建立RTSP连接，并选择要播放的流，就好像它是IP摄像机一样。 </p><br><br><h3><a name="outMSE"></a>  <strong>即将离任的MSE</strong> </h3><br><p><img src="https://habrastorage.org/webt/lt/wh/wz/ltwhwz7b8urhlg4m5ay-blpg-d8.jpeg"></p><br><p> 在这种情况下，播放器使用Websocket协议从服务器请求流。 服务器在Web套接字上提供音频和视频数据。 由于开箱即用的本地MSE扩展，数据到达浏览器并转换为浏览器可以播放的块。 播放器最终将基于HTML5视频元素进行工作。 </p><br><br><h3><a name="outHLS"></a>  <strong>传出的HLS</strong> </h3><br><p><img src="https://habrastorage.org/webt/if/5l/5f/if5l5fdsrgbgaekle2edci9gyws.jpeg"></p><br><p> 在此，WCS充当支持HLS（HTTP实时流）的HLS服务器或Web服务器。 传入流出现在服务器上之后，将生成.m3u8格式的HLS播放列表，该列表将响应HTTP请求而提供给播放器。 播放列表描述了播放器应下载和显示的视频片段。 播放器下载视频片段，然后在浏览器页面，移动设备，台式机，Apple TV机顶盒以及要求HLS支持的任何位置播放视频片段。 </p><br><br><h2><a name="IncomingOutgoing"></a> 收件箱和发件箱 </h2><br><p> 总共我们有5个传入流和相同数量的传出流类型。 我们列出 <br> 它们在表中： </p><br><p></p><div class="scrollable-table"><table><thead><tr><th>  <strong>收件箱</strong> </th><th>  <strong>外向</strong> </th></tr></thead><tbody><tr><td>  WebRTC </td><td>  WebRTC </td></tr><tr><td>  RTMP </td><td>  RTMP </td></tr><tr><td>  Rtsp </td><td>  Rtsp </td></tr><tr><td> 伏特 </td><td> 微软 </td></tr><tr><td>  SIP / RTP </td><td>  ls </td></tr></tbody></table></div><br><br><p> 即 我们可以将流驱动到服务器，并可以连接到它们并播放适合此问题的播放器。 要播放WebRTC流，请使用Web SDK。 要将WebRTC流作为HLS播放，请使用HLS播放器等。 许多观众可以播放一个流。 一对多广播工作。 </p><br><p> 现在，我们将说明可以对流执行哪些操作。 </p><br><br><h2><a name="manipulatingincoming"></a> 传入流操作 </h2><br><p> 观众坐在那里的流出的溪流并没有受到特别的操纵。 实际上，如果查看者已经与服务器建立了会话，并且已经在进行某种形式的流，则无法在不中断会话的情况下对其进行任何更改。 因此，所有操作和更改都在传入流上进行，此时复制尚未发生。 然后，将经过更改的流循环到所有连接的查看器。 </p><br><p> 流上的操作包括： </p><br><ul><li> 记录 </li><li> 快照删除 </li><li> 将流添加到混合器 </li><li> 流转码 </li><li> 加水印 </li><li> 添加FPS过滤器 </li><li> 图像旋转90、180、270度 </li></ul><br><br><h3><a name="recording"></a>  <strong>传入流录制</strong> </h3><br><p><img src="https://habrastorage.org/webt/m_/je/j8/m_jej8-gdyvh2e2urt4s75ltsse.jpeg"></p><br><p> 也许是功能中最易理解和最常遇到的功能。 实际上，在许多情况下，流都需要记录：网络研讨会，英语课程，咨询等。 </p><br><p><img src="https://habrastorage.org/webt/kz/t0/_r/kzt0_rj0y1mvgb4rnob5ix4_bnk.jpeg"></p><br><p> 可以使用Web SDK或REST API发起记录，但有特殊要求： </p><br><pre> <code class="plaintext hljs">/stream/startRecording {}</code> </pre> <br><p> 结果保存为mp4文件在文件系统中。 </p><br><br><h3><a name="snapshot"></a>  <strong>快照删除</strong> </h3><br><p><img src="https://habrastorage.org/webt/cg/g6/yh/cgg6yhu_d8lj4tl6tecphzvgsce.jpeg"></p><br><p> 同样常见的任务是对当前流进行拍照以在站点上显示图标。 例如，一个视频监视系统中有50个流，每个流都有一个IP摄像机。 在一页上显示所有50个线程不仅对浏览器资源有问题，而且毫无意义。 在30 FPS的情况下，变化图像的总FPS将为每秒1500帧，而人眼根本不会接受该频率。 作为解决方案，您可以按需配置自动切片或进食快照，在这种情况下，您可以以任意频率（例如，每10秒1帧）在站点上显示图像。 快照可以通过REST API从SDK中删除，也可以自动切片。 </p><br><p><img src="https://habrastorage.org/webt/b9/c5/hf/b9c5hfkspnmifm7wfw96aatldl8.jpeg"></p><br><p>  WCS服务器支持以下REST方法来删除快照： </p><br><pre> <code class="plaintext hljs">/stream/snapshot</code> </pre> <br><p><img src="https://habrastorage.org/webt/5c/8z/v-/5c8zv-0i7uglnd6t5eyldejyzt0.jpeg"></p><br><br><h3><a name="mixer"></a>  <strong>将流添加到混音器</strong> </h3><br><p><img src="https://habrastorage.org/webt/o3/mx/bj/o3mxbjmxo3evugpsr5td7wko1pc.jpeg"></p><br><p> 可以将来自两个或多个源的图像合并为一个图像，以显示给最终查看者。 此过程称为混合。 基本示例：1）从一张屏幕上的多个摄像机进行视频监视。  2）电视会议，每个用户接收一个流以节省资源，其余的则混合在一起。 混音器通过REST API进行控制，并具有用于创建视频会议的MCU操作模式。 </p><br><p>  REST命令将流添加到混合器： </p><br><pre> <code class="plaintext hljs">/mixer/startup</code> </pre> <br><br><h3><a name="transcoding"></a>  <strong>流转码</strong> </h3><br><p><img src="https://habrastorage.org/webt/e8/dn/ml/e8dnmlrtcfd5dxvsnmfkrckeiqm.jpeg"></p><br><p> 有时需要压缩流，以便通过分辨率和比特率适应某些客户端设备组。 为此，使用转码。 可以通过REST API在Web SDK端启用代码转换，也可以通过CDN中的特殊代码转换节点自动启用代码转换。 例如，当输入1280x720的视频时，可以将其转码为640x360，以从传统上带宽较低的地理区域分发给客户。 您的同伴在哪里，埃隆·马斯克（Elon Musk）？ </p><br><p><img src="https://habrastorage.org/webt/yn/t2/5g/ynt25g1_9phfzcqtptzb0e0u3gq.jpeg"></p><br><p> 使用的REST方法： </p><br><pre> <code class="plaintext hljs">/transcoder/startup</code> </pre> <br><br><br><h3><a name="watermark"></a>  <strong>添加水印</strong> </h3><br><p><img src="https://habrastorage.org/webt/l_/7q/-t/l_7q-td_lifwkr5aw3mn-btem1o.png"></p><br><p> 众所周知，无论播放器获得什么保护，任何内容都可以被盗并转换为WebRip。 如果您的内容确实如此有价值，则可以在其中嵌入水印或徽标，这将大大增加其进一步使用和公开展示的难度。 要添加水印，只需上传PNG图像，它将通过转码将其插入视频流。 因此，如果您仍然决定在服务器端准备几个CPU核心， <br> 在流中添加水印。 为了不通过转码扭曲服务器上的水印，最好将其直接添加到编码器/流媒体中， <br> 通常会提供这样的机会。 </p><br><br><h3><a name="fpsfilter"></a>  <strong>添加FPS过滤器</strong> </h3><br><p><img src="https://habrastorage.org/webt/27/oi/bk/27oibkbef1jtrjulbcdcpomi_ts.png"></p><br><p> 在某些情况下，要求流具有均匀的FPS（每秒帧数）。 如果我们将流中继到第三方资源（如Youtube或Facebook），或者使用敏感的HLS播放器进行播放，则可以派上用场。 再次过滤需要转码，因此，如果计划进行此操作，请计算服务器的强度并为配置做准备，并为每个流增加2个核心。 </p><br><br><h3><a name="rotate"></a>  <strong>将图片旋转90、180、270度</strong> </h3><br><p><img src="https://habrastorage.org/webt/ou/bh/2n/oubh2n__wt2uasdqfdgtj3rmves.png"></p><br><p> 移动设备具有根据旋转角度更改已发布流的分辨率的能力。 例如，他们开始流媒体播放，水平握住iPhone，然后转身。 根据WebRTC规范，移动设备的流媒体浏览器，在这种情况下，iOS Safari应该向服务器发出转向信号。 反过来，服务器必须将此事件发送给所有订阅者。 否则，结果可能是 <br> 这样，彩带就可以将手机放到一边，但是看到的相机仍然是直立的，而观看者则是堆放在一边。 要在SDK端使用转弯功能，必须包含相应的cvoExtension扩展名。 </p><br><br><h3><a name="manage"></a>  <strong>输入流的控制在哪里</strong> </h3><br><p> 自动-配置通常是在服务器端 <br> 设置。 </p><br><div class="scrollable-table"><table><thead><tr><th> 流动作 </th><th> 网络，iOS，Android SDK </th><th>  REST API </th><th> 自动的 </th><th> 光盘 </th></tr></thead><tbody><tr><td> 记录 </td><td>  + </td><td>  + </td><td><br></td><td><br></td></tr><tr><td> 快照删除 </td><td>  + </td><td>  + </td><td>  + </td><td><br></td></tr><tr><td> 添加到混音器 </td><td>  + </td><td>  + </td><td><br></td><td><br></td></tr><tr><td> 流转码 </td><td>  + </td><td>  + </td><td><br></td><td>  + </td></tr><tr><td> 加水 <br> 标志 </td><td><br></td><td><br></td><td>  + </td><td><br></td></tr><tr><td> 添加FPS过滤器 </td><td><br></td><td><br></td><td>  + </td><td><br></td></tr><tr><td> 将图片旋转90度， <br>  180、270度 </td><td>  + </td><td><br></td><td><br></td><td><br></td></tr></tbody></table></div><br><br><h2><a name="Streamrelay"></a> 流中继 </h2><br><p> 中继也是用于操纵进入服务器的流的一种选择，其中包括将流强制到第三方服务器。 中继的同义词是：复制，推送，注入。 </p><br><p> 可以使用以下协议之一实现中继：WebRTC，RTMP，SIP / RTP。 该表显示了可以中继流的方向。 </p><br><br><div class="scrollable-table"><table><thead><tr><th>  WebRTC </th><th>  RTMP </th><th>  SIP / RTP </th></tr></thead><tbody><tr><td>  WCS </td><td>  RTMP服务器WCS </td><td>  SIP服务器 </td></tr></tbody></table></div><br><br><br><h3><a name="repubWebRTC"></a>  <strong>WebRTC中继</strong> </h3><br><p><img src="https://habrastorage.org/webt/d9/yf/cc/d9yfccsjz8zqvx3jo-3gas2nuu8.jpeg"></p><br><p> 如果出于某种原因需要将流传递到另一台服务器上，则可以将流中继到另一台WCS服务器。 通过使用/ push方法的REST API进行中继。 收到这样的REST请求后，WCS将连接到指定的服务器，并向该服务器发布服务器-服务器流。 之后，该流可用于在另一台机器上回放。 </p><br><pre> <code class="plaintext hljs">/pull/push</code> </pre> <br><p>  -使用的REST方法。 </p><br><br><h3><a name="rebubRTMP"></a>  <strong>RTMP中继</strong> </h3><br><p><img src="https://habrastorage.org/webt/y-/hv/tn/y-hvtne9e-vtgry-2or6nhmqzte.jpeg"></p><br><p> 与WebRTC中继一样，也可以将RTMP中继到另一台服务器。 区别仅在于中继协议。  RTMP中继也可以通过/ push执行，使您可以将流传输到第三方RTMP服务器和支持RTMP Ingest的服务：Youtube，Facebook流等。 因此，WebRTC流可以中继到RTMP。 在RTMP中获得相同的成功后，您可以中继进入服务器的任何其他流，例如RTSP或VOD。 </p><br><p> 使用REST调用将视频流中继到另一个RTMP服务器 </p><br><pre> <code class="plaintext hljs">/push/startup</code> </pre> <br><p>  -使用了REST调用。 </p><br><br><h3><a name="repubSIP-RTP"></a>  <strong>SIP / RTP中继</strong> </h3><br><p><img src="https://habrastorage.org/webt/sl/tt/hj/sltthjlgwbvryka0vgpqel0hcx8.jpeg"></p><br><br><p> 很少使用的功能。 最常在企业中使用。 例如，当您需要与外部SIP会议服务器建立SIP呼叫并将音频或视频流重定向到此呼叫，以便会议的观众看到一些视频内容时：“请观看此视频”或“同事，现在让我们看看使用IP-施工现场的摄像机。” 您需要了解会议本身存在，并且在这种情况下是在具有SIP支持的外部VKS服务器上进行管理的（最近我们测试了Polycom DMA的解决方案），我们只是将现有流连接并中继到该服务器。  REST API函数称为/注入，仅用于这种情况。 </p><br><p>  REST API命令： </p><br><pre> <code class="plaintext hljs">/call/inject_stream/startup</code> </pre> <br><br><h2><a name="CDN"></a> 将服务器连接到CDN内容处理网络 </h2><br><p> 一台服务器通常只有有限的资源。 因此，对于大型在线广播（观众的帐户达到数千个），必须进行扩展。 可以将多个WCS服务器组合到一个CDN内容传递网络中。 在内部，CDN将通过WebRTC来保持流式传输期间的低延迟。 </p><br><p><img src="https://habrastorage.org/webt/99/sx/gd/99sxgd8frahbmd2trrxsfltfmeg.jpeg"></p><br><p> 可以用以下角色之一配置服务器：Origin，Edge，Transcoder。 源类型服务器-接收流量并将其分发到负责将流传递给查看器的边缘服务器的边缘节点。 如果有必要以几种分辨率准备一个流，则该方案中将包含代码转换器节点，该代码转换器承担代码转换流的资源消耗任务。 </p><br><br><h2><a name="summarize"></a> 总结一下 </h2><br><p>  WCS 5.2是用于开发具有对浏览器和移动设备的实时音频和视频支持的应用程序的服务器。 提供了四个用于开发的API：Web SDK，iOS SDK，Android SDK，REST API。 您可以使用五种协议将视频流发布（馈送）到服务器：WebRTC，RTMP，RTSP，VOD，SIP / RTP。 在服务器上，您可以使用五种协议与播放器一起播放流：WebRTC，RTMP，RTSP，MSE，HLS。 可以对流进行控制和执行，这些操作包括：记录，切片快照，混合，代码转换，添加水印，过滤FPS，在移动设备上播放视频。 流可以通过WebRTC和RTMP协议中继到其他服务器，也可以重定向到SIP会议。 服务器可以集成到内容交付网络中，并可以扩展以处理任意数量的视频流。 </p><br><br><h3>  <strong>爱丽丝必须了解与服务器一起使用的知识</strong> </h3><br><p> 开发人员需要能够使用Linux。 这类团队 <br> 命令行不应引起混淆： </p><br><pre> <code class="plaintext hljs">tar -xvzf wcs5.2.tar.gz</code> </pre> <br><pre> <code class="plaintext hljs">cd wcs5.2</code> </pre> <br><pre> <code class="plaintext hljs">./install.sh</code> </pre> <br><pre> <code class="plaintext hljs">tail -f flashphoner.log</code> </pre> <br><pre> <code class="plaintext hljs">ps aux | grep WebCallServer</code> </pre> <br><pre> <code class="plaintext hljs">top</code> </pre> <br><p>  Vanilla JavaScript还需要具备以下能力： <br> 网页 </p><br><pre> <code class="plaintext hljs">//  session.createStream({name:'mystream'}).publish(); //  session.createStream({name:'mystream'}).play();</code> </pre><br><p> 使用后端的功能也很有用。 </p><br><p><img src="https://habrastorage.org/webt/3l/0a/9s/3l0a9shqbhfy4yjheu30ocammzg.jpeg"></p><br><p>  WCS不仅可以通过REST API接收控制命令，还可以发送钩子-有关发生在其上的事件的通知。 <br> 例如，当尝试从浏览器或移动应用程序建立连接时，WCS将调用/ connect挂钩，而在尝试播放流时，它将调用playStream挂钩。 因此，开发人员将不得不花些时间在后端，它能够编写一个简单的REST客户端和一个小的REST服务器来处理钩子。 </p><br><p>  REST API示例 </p><br><pre> <code class="plaintext hljs">/rest-api/stream/find_all</code> </pre> <br><p>  -用于在服务器上输出流列表的REST API的示例 </p><br><p>  REST挂钩示例 </p><br><pre> <code class="plaintext hljs">https://myback-end.com/hook/connect</code> </pre> <br><p>  -后端的REST挂钩/连接处理。 </p><br><p>  Linux，JavaScript，REST Client / Server是这三个要素 <br> 足以在WCS平台上开发有效的生产服务 <br> 视频流。 </p><br><p> 移动应用程序开发需要Java和Objective-C的知识 <br> 分别适用于Android和iOS。 </p><br><br><h3>  <strong>安装和启动</strong> </h3><br><p> 现在可以通过三种方式快速启动WCS： </p><br><p>  1）在您的Centos7或Ubuntu 16.x LTS或Ubuntu 18.x LTS上安装 <br> 等 以<a href="https://docs.flashphoner.com/pages/viewpage.action%3FpageId%3D9241019">文档中</a>的<a href="https://docs.flashphoner.com/pages/viewpage.action%3FpageId%3D9241019">文章为</a>指导。 </p><br><p> 或 </p><br><p>  2） <a href="https://flashphoner.com/podderzhka-oblachnyh-serverov-amazon-ec2-v-web-call-server/%3Flang%3Dru">在Amazon EC2上</a>拍摄<a href="https://flashphoner.com/podderzhka-oblachnyh-serverov-amazon-ec2-v-web-call-server/%3Flang%3Dru">完成的图像</a> 。 </p><br><p> 否则 </p><br><p>  3） <a href="https://flashphoner.com/podderzhka-web-call-server-v-digital-ocean-marketplace/%3Flang%3Dru">在DigitalOcean上</a>拍摄<a href="https://flashphoner.com/podderzhka-web-call-server-v-digital-ocean-marketplace/%3Flang%3Dru">完成的服务器映像</a> 。 </p><br><p> 并开始使用流视频功能进行激动人心的项目开发。 </p><br><p> 这篇评论文章非常充实。 谢谢你 <br> 阅读耐心。 </p><br><p> 拥有良好的流媒体！ </p><br><br><br><h2><a name="Links"></a> 参考文献 </h2><br><p>  <a href="https://flashphoner.com/">WCS 5.2</a> -WebRTC服务器 </p><br><h3> 安装和启动 </h3><br><p>  <a href="https://docs.flashphoner.com/pages/viewpage.action%3FpageId%3D9241019">安装并运行WCS</a> </p><br><p>  <a href="https://flashphoner.com/podderzhka-oblachnyh-serverov-amazon-ec2-v-web-call-server/%3Flang%3Dru">在Amazon AWS上启动预构建映像</a> </p><br><p> <a href="https://flashphoner.com/podderzhka-web-call-server-v-digital-ocean-marketplace/%3Flang%3Dru">    DigitalOcean</a> </p><br><h3> SDK </h3><br><p> <a href="https://docs.flashphoner.com/display/WCS52RU/Web%2BSDK">  Web SDK</a> </p><br><p> <a href="https://docs.flashphoner.com/display/WCS52RU/Android%2BSDK">  Android SDK</a> </p><br><p> <a href="https://docs.flashphoner.com/display/WCS52RU/iOS%2BSDK">  iOS SDK</a> </p><br><h3>  </h3><br><p> <a href="https://docs.flashphoner.com/pages/viewpage.action%3FpageId%3D9241216"> </a> </p><br><p> <a href="https://docs.flashphoner.com/pages/viewpage.action%3FpageId%3D9241448"> </a> </p><br><p> <a href="https://docs.flashphoner.com/pages/viewpage.action%3FpageId%3D9241404"> </a> </p><br><p> <a href="https://docs.flashphoner.com/pages/viewpage.action%3FpageId%3D9241533"> </a> </p><br><p> <a href="">WebRTC CDN   </a> </p><br><h3>  </h3><br><p> <a href="https://docs.flashphoner.com/display/WCS52RU/Web%2BCall%2BServer%2B5.2%2B-%2BRU"> Web Call Server 5.2</a> </p><br><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN482960/">https://habr.com/ru/post/zh-CN482960/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN482946/index.html">1СDSS和通过COCOMO II方法估算项目的条款和成本</a></li>
<li><a href="../zh-CN482948/index.html">“一，二，三-烧圣诞树！”或者我第一次看到CANNY 3微型控制器</a></li>
<li><a href="../zh-CN482950/index.html">Java：对于经验丰富的开发人员而言似乎有些好奇的事情</a></li>
<li><a href="../zh-CN482956/index.html">WCS 5.2-用于Webcast和Webcam开发人员的WebRTC服务器的评论</a></li>
<li><a href="../zh-CN482958/index.html">“成长规则：从初级到首席技术官”，Fedor Borshchev的网络研讨会摘要</a></li>
<li><a href="../zh-CN482968/index.html">Quarkus-云原生Java的新外观</a></li>
<li><a href="../zh-CN482970/index.html">哈克盒子-演练工艺。 我们深入研究Git，利用API中的漏洞，处理保险柜</a></li>
<li><a href="../zh-CN482974/index.html">虚拟现实的心理健康支持</a></li>
<li><a href="../zh-CN482976/index.html">股票交易中的匿名交易分析</a></li>
<li><a href="../zh-CN482978/index.html">Python中有300行的区块链解析器</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>