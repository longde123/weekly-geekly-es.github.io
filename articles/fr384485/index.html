<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛀🏻 📏 🚴🏻 Modules Laurent et Smart Home (Partie 1). Majordome 🙇🏼 📵 ⛱️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je veux attirer votre attention sur une série d'articles sur les modules de contrôle Laurent de KernelChip . Dans cette série, je vais vous expliquer ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Modules Laurent et Smart Home (Partie 1). Majordome</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384485/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je veux attirer votre attention sur une série d'articles sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> modules de contrôle Laurent </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">de KernelChip</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans cette série, je vais vous expliquer comment intégrer ces modules dans votre maison intelligente, comment apprendre à les gérer à partir du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">système</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> domotique populaire </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">MajorDoMo</font></a><font style="vertical-align: inherit;"> , des croquis Arduino, du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">système Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et même comment utiliser ces modules dans un but complètement inattendu - pour enseigner à vos enfants la programmation en traitement. </font></font><br>
<br>
<img src="https://habrastorage.org/files/915/0cb/0cb/9150cb0cbde940e588d1badce05af5bb.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, les modules qui sont assez intéressants en eux-mêmes peuvent être très utiles de manière inattendue dans les ménages si vous les approchez avec une certaine imagination et créativité.</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi Laurent?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parce que ces modules fonctionnent avec succès dans mon système Smart Home depuis longtemps (plus de trois ans) et j'ai acquis une certaine expérience dans leur utilisation et j'ai quelque chose à dire à leur sujet. </font><font style="vertical-align: inherit;">Et j'ai aussi une certaine expérience et un code prêt à l'emploi et testé pour la gestion de ces modules, que je veux partager avec vous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et vous pourrez développer vos solutions logicielles à partir de ce code, ce sera assez simple, car j'ai déjà fait l'essentiel du travail. </font><font style="vertical-align: inherit;">De plus, le code sera expliqué en détail, ce qui contribue certainement à votre compréhension de son fonctionnement, à l'apprentissage de la programmation et à la construction de systèmes de maison intelligente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modules eux-mêmes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque j'ai choisi pour moi une solution toute faite pour gérer les charges électriques à travers le réseau, Laurent m'a soudoyé avec l'exhaustivité et la simplicité de la solution. Pour commencer à contrôler le réseau et à éteindre les appareils et l'éclairage, presque rien n'était nécessaire. Il n'était pas nécessaire d'apprendre le langage de programmation, il n'était pas nécessaire de souder quoi que ce soit, il suffisait de connecter le module au réseau local, de connecter la charge aux bornes du relais (et n'oubliez pas d'alimenter le module lui-même) et c'était tout. Après cela, il a été possible d'envoyer des commandes directement à partir de l'ordinateur (à partir du programme du terminal). Le module a immédiatement commencé à allumer et éteindre docilement la lumière selon mes commandes. A cette époque, je n'en avais pas besoin de plus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je peux dire sur les modules eux-mêmes que pendant toute la période de fonctionnement, il n'y a pas eu de plantage et de gel, tout a fonctionné et fonctionne «comme une horloge», ce qui, en fait, est requis de ces modules pour fonctionner.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conception et qualité de construction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il suffit de regarder le module pour montrer clairement qu'il a été développé pour une raison, «si seulement», mais a essayé de faire quelque chose de vraiment digne. </font><font style="vertical-align: inherit;">Je n'ai également rien à redire sur la qualité de construction, tout est fait avec soin et comme il se doit: pas de pièces tordues, des taches de soudure ou quelque chose comme ça, tout est clair et soigné. </font><font style="vertical-align: inherit;">Dans l'ensemble, la qualité de construction ne diffère pas des composants informatiques "de marque" et de l'Arduino "d'usine". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La seule chose que je ferais si je libérais ces modules moi-même était d'installer des bornes multicolores pour connecter les fils au lieu de bornes monochromes, au moins de mettre en évidence les bornes de connexion d'alimentation, mais c'est ainsi, petite pioche (tout, bien sûr, est soigneusement signé).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel est le premier article de la série?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les informations sont divisées en trois articles finis logiquement. Le premier article portera sur l'intégration des modules Laurent à MajorDoMo, une plateforme domotique open source populaire. Des exemples spécifiques et du code PHP seront fournis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxième article concerne l'intégration avec l'écosystème Arduino. Vous pouvez gérer les modules à partir de vos croquis individuels ou intégrer Laurent au </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (qui est également basé sur le code Arduino) et gérer les Laurents à partir d'une interface pratique ou automatiquement, selon le programme. Des solutions toutes faites et du code testé seront également fournis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans le troisième - sur la gestion des modules Laurent à partir d'esquisses sur le traitement. C'est-à-dire directement depuis le bureau de votre ordinateur personnel. Le même article décrira comment accroître l'intérêt des enfants pour l'apprentissage des programmes et quel rôle ces modules peuvent jouer dans ce domaine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La série est consacrée à l'intégration des modules Laurent aux systèmes domotiques et ne prend pas en compte l'architecture et le fonctionnement des modules eux-mêmes. Cela a été décrit dans d'autres articles avec lesquels vous pouvez lire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et sera discuté plus tard. Ici, nous nous concentrons uniquement sur l'intégration.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cours de rédaction d'articles, le module Laurent avec firmware La01 et la version d'interface web LW1.0 a été utilisé, c'est-à-dire le module très «combat» qui fonctionne depuis trois ans. </font><font style="vertical-align: inherit;">Dans les nouvelles versions des modules, les détails d'implémentation peuvent différer légèrement, mais la compatibilité avec les équipes de contrôle est préservée, donc tout ce qui est dit ici est également vrai pour les modifications plus récentes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonctionnement de la gestion des modules</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous les échanges d'informations avec les modules sont effectués sur le réseau et pour commencer à travailler avec eux, vous devez établir une connexion TCP / IP sur le port 2424. </font><font style="vertical-align: inherit;">Une fois la connexion établie, vous pouvez envoyer des commandes de texte (dites commandes KE) qui contrôlent le module. </font><font style="vertical-align: inherit;">Le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site Web KernelChip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient une documentation détaillée, y compris une description accessible des commandes KE. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KernelChip s'est occupé des utilisateurs et a fourni à ses modules une interface Web pratique, mais il s'agit d'un «contrôle manuel», et la commodité, la valeur et l'utilité de la solution augmenteront d'une commande si nous apprenons à gérer le module à partir de notre maison intelligente. </font></font><br>
<br>
<img src="https://habrastorage.org/files/0ad/e7b/6e3/0ade7b6e3ff2446e969b922121a3c87d.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'interface Web est protégée par mot de passe par défaut et pour voir le contenu de la page Web, vous devez entrer le nom d'utilisateur "admin" et le mot de passe "Laurent".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Majordome</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le système </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MajorDoMo est</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assez populaire et je ne m'y attarderai pas ici en détail. </font><font style="vertical-align: inherit;">Il est supposé que vous avez déjà installé ce système et que vous l'avez utilisé pendant un certain temps. </font><font style="vertical-align: inherit;">Pour ceux qui ne sont pas du tout à jour, j'expliquerai qu'il s'agit d'une plate-forme domotique ouverte qui fonctionne sur Windows et Linux et qui est basée sur un serveur Web et est une sorte de CMS spécialisé (système de gestion de contenu) avec de larges capacités et "affûté" pour automatisation de la maison. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les possibilités de MajorDoMo sont vraiment infinies et la gestion des modules Laurent n'est qu'un des talents de ce système.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Détails techniques</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo incorpore le fichier laurent.class.php, qui se trouve dans le répertoire</font></font><br>
<br>
<pre><code class="dos hljs">\htdocs\lib\<font></font>
<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code complet laurent.class.php</font></font></b><div class="spoiler_text">&lt;?<br>
<br>
function laurent_command($host, $command, $password='Laurent') {<br>
<br>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);<br>
 if ($socket === false) {<br>
 echo «socket_create() failed: reason: ». socket_strerror(socket_last_error()). "\n";<br>
 return 0;<br>
 }<br>
<br>
$result = socket_connect($socket, $host, 2424);<br>
 if ($result === false) {<br>
 echo «socket_connect( $socket, $host, 2424) failed.\nReason: ($result) ». socket_strerror(socket_last_error($socket)). "\n";<br>
 return 0;<br>
 }<br>
<br>
$in='$KE'."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in='$KE,PSW,SET,'.$password."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
socket_close($socket);<br>
 return trim($res);<br>
 <br>
 }<br>
<br>
function laurent_getStat($host, $password='Laurent') {<br>
<br>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);<br>
 if ($socket === false) {<br>
 echo «socket_create() failed: reason: ». socket_strerror(socket_last_error()). "\n";<br>
 return 0;<br>
 }<br>
<br>
$result = socket_connect($socket, $host, 2424);<br>
 if ($result === false) {<br>
 echo «socket_connect( $socket, $host, 2424) failed.\nReason: ($result) ». socket_strerror(socket_last_error($socket)). "\n";<br>
 return 0;<br>
 }<br>
<br>
$in='$KE'."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in='$KE,PSW,SET,'.$password."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$command='$KE,DAT,ON';<br>
 $in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 $started=0;<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "#TIME,"))) {<br>
 if (!$started) {<br>
 $started=1;<br>
 } else {<br>
 break;<br>
 }<br>
 }<br>
 }<br>
<br>
$command='$KE,DAT,OFF';<br>
 $in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
 sleep(1);<br>
 socket_write($socket, $in, strlen($in));<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
socket_close($socket);<br>
 return trim($res);<br>
 <br>
 }<br>
<br>
?&gt;<br>
<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et contient tout ce dont vous avez besoin pour travailler avec les modules Laurent. </font><font style="vertical-align: inherit;">Ce fichier contient des fonctions dans le langage de programmation PHP et, probablement, sous forme finie ou avec des modifications minimes, peut être transféré vers n'importe quel système utilisant ce langage de programmation. </font><font style="vertical-align: inherit;">Donc, si vous avez un projet Smart Home sur une autre plateforme, vous pouvez essayer d'intégrer Laurent à votre système en utilisant ce fichier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction principale utilisée pour contrôler le module est</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'&lt; &gt;'</span>, <span class="hljs-string">'&lt;&gt;'</span>, <span class="hljs-string">'&lt;  &gt;'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
par exemple,</font></font><br>
<br>
<pre><code class="php hljs">$result = laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,INF'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, où '192.168.2.19' est l'adresse IP du module, '$ KE, INF' est la commande elle-même, 'Laurent' est le mot de passe (par défaut). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le résultat du travail de la fonction entre dans la variable $ result, c'est-à-dire la réponse du module, que vous pouvez analyser et interpréter à l'aide des outils de langage PHP standard. Le mot de passe est spécifié tel qu'il est par défaut. Si vous avez changé le mot de passe pour accéder à votre module, vous devrez le remplacer par un nouveau et dans l'appel de fonction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout doit être clair avec l'équipe, vous pouvez prendre toutes les commandes du répertoire et gérer le module comme vous le souhaitez. L'adresse IP ne devrait pas non plus poser de problème. Spécifiez simplement l'adresse IP que votre module Laurent possède réellement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez terminer la théorie avec ceci et maintenant je vais vous montrer avec un exemple pratique comment faire le contrôle de la lumière (ou d'un appareil) directement à partir du menu MajorDoMo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple pratique</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À titre d'exemple pratique, examinons la création de deux boutons «Activer» et «Désactiver» dans le menu principal du système MajorDoMo. Avec ces boutons, vous pouvez allumer ou éteindre la lumière ou tout autre appareil électrique (ici, il suffit de se rappeler que les relais installés sur le module ne sont pas en mesure de contrôler directement une charge puissante comme une cuisinière électrique ou un chauffe-eau). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, nous créons le bouton "Activer", pour cela nous allons dans le panneau d'administration de MajorDoMo et entrons le nom d'utilisateur et le mot de passe (admin / admin par défaut) et cliquez sur "OBJETS / Menu Contrôle" puis sur le gros bouton vert "Ajouter une nouvelle section". </font></font><br>
<br>
<img src="https://habrastorage.org/files/fb3/4af/d8b/fb34afd8babe4df5a78392f9b6025857.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous trouvons la liste déroulante "Type" et sélectionnons "Bouton" parmi toute la variété de types présentés et cliquez sur "Enregistrer".</font></font><br>
<br>
<img src="https://habrastorage.org/files/2de/95f/137/2de95f13747c4887b12cc1a6b51315ae.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, sélectionnez "élément de menu parent" est l'endroit où notre bouton "accroche". </font><font style="vertical-align: inherit;">Je l'ai Laurent, et vous pouvez avoir n'importe quel élément de menu pratique. </font><font style="vertical-align: inherit;">Par défaut, il y a "ROOT", ce qui signifie que le bouton sera visible immédiatement, sans cliquer sur aucun élément de menu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le champ de saisie "Titre", écrivez ce que vous voulez qu'il soit écrit sur le bouton. </font><font style="vertical-align: inherit;">Et enfin, dans le champ Code, écrivez le code de la fonction laurent_command que nous connaissons déjà:</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,1'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici c'est la même chose que dans l'exemple théorique, seule la variable $ resultat manque (on n'en a pas besoin) et la commande est remplacée par '$ KE, REL, 2,1', ce qui signifie activer le relais n ° 2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous faisons de même pour le bouton "Désactiver", n'oubliez pas de changer le nom du bouton et au lieu de '$ KE, REL, 2.1' écrire '$ KE, REL, 2.0', ce qui signifie désactiver le relais n ° 2:</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,0'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout. </font><font style="vertical-align: inherit;">Nous rechargeons la page avec l'interface MajorDoMo, deux nouveaux boutons apparaissent qui allument et éteignent les lumières (ou l'appareil) directement à partir de l'interface MajorDoMo magnifiquement et presque sans délai. </font><font style="vertical-align: inherit;">Ce que nous voulions réaliser.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contrôle automatique</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons maintenant de contrôler le module automatiquement, sans intervention humaine. </font><font style="vertical-align: inherit;">Vous verrez maintenant que c'est encore plus simple que d'utiliser les boutons pour contrôler le module. </font></font><br>
<br>
<img src="https://habrastorage.org/files/13a/34b/f74/13a34bf74e8943b5a0613e972ef09b85.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On retrouve dans le menu principal du panneau d'administration de MajorDoMo l'élément «Objets», cliquez dessus, puis on retrouve l'objet «ClockChime» et sa méthode «onNewMinute». </font><font style="vertical-align: inherit;">Nous avons besoin de lui. </font><font style="vertical-align: inherit;">Pour ceux qui ne sont pas au courant, il s'agit de la méthode «centrale» MajorDoMo, qui est appelée toutes les minutes et est très populaire. </font><font style="vertical-align: inherit;">C'est dans cette méthode qu'il existe de nombreuses fonctions et appels de script qui fournissent les fonctionnalités utilisateur du système.</font></font><br>
<br>
<img src="https://habrastorage.org/files/1c6/88b/2ea/1c688b2ead4642b4934a67a00b19d9d2.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et tout ce que nous devons faire est d'ajouter notre code à cette méthode. </font><font style="vertical-align: inherit;">Par exemple, considérez cette situation. </font><font style="vertical-align: inherit;">Votre module Laurent contrôle l'éclairage nocturne dans la cour de votre maison. </font><font style="vertical-align: inherit;">Et vous, par exemple, souhaitez que la lumière s'allume à 21h00 et s'éteigne à 7h30 du matin. </font><font style="vertical-align: inherit;">Rien de plus simple, voici le code que vous devez ajouter à la méthode onNewMinute:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">if</span> (timeIs(<span class="hljs-string">'21:00'</span>)) {<font></font>
  laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,1'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span> (timeIs(<span class="hljs-string">'7:30'</span>)) {<font></font>
  laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,0'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et c'est tout! </font><font style="vertical-align: inherit;">Vous devez admettre que ce n’est pas difficile du tout. </font><font style="vertical-align: inherit;">Ce n'est qu'un exemple, la logique du travail peut être absolument n'importe laquelle et très sophistiquée. </font><font style="vertical-align: inherit;">Et les talents des modules Laurent ne se limitent pas à allumer et éteindre des charges, leur fonctionnalité est beaucoup plus large, mais ce n'est pas le sujet de cet article, nous ne considérons ici que les problèmes d'intégration avec des exemples simples.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Réception et sortie des données du module</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et le dernier exemple sera comment obtenir et afficher les informations reçues du module Laurent sur la page Web de MajorDoMo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo est un système orienté objet et tout le travail s'y déroule à travers la création d'objets et l'utilisation de leurs données (variables) et méthodes (code programme). Un peu difficile? En fait, ça va et maintenant vous verrez par vous-même. </font></font><br>
<br>
<img src="https://habrastorage.org/files/adc/f9a/1c0/adcf9a1c0940400798e8392da8690c52.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, pour un exemple nous utiliserons l'objet déjà existant "ThisComputer" et nous lui ajouterons une nouvelle propriété "test". Pour ce faire, cliquez sur l'élément de menu "Objets" qui nous est déjà familier dans la zone d'administration de MajorDoMo, trouvez l'objet "ThisComputer" et cliquez sur l'élément "Propriétés", faites défiler vers le bas et trouvez le champ de saisie "Ajouter une nouvelle propriété", entrez "test" et cliquez sur "Actualiser" (laissez la valeur vide).</font></font><br>
<br>
<img src="https://habrastorage.org/files/81a/bd8/8f8/81abd88f8596487ca7415eb6526d6d40.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur ce point, les opérations préparatoires peuvent être considérées comme terminées, nous avons ajouté une nouvelle propriété «test» à l'objet «ThisComputer», que nous utiliserons dans nos expérimentations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, notre tâche est de demander les informations nécessaires au module Laurent et de les mettre dans la propriété (variable) du «test» de l'objet «ThisComputer». </font><font style="vertical-align: inherit;">Comment faire ça? </font><font style="vertical-align: inherit;">Très simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez ce code à la méthode onNewMinute que nous connaissons déjà:</font></font><br>
<br>
<pre><code class="php hljs">$result = laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,INF'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
setGlobal(<span class="hljs-string">'ThisComputer.test'</span>, $result); <font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et chaque minute MajorDoMo demandera au module les informations nécessaires et mettra à jour la variable «test», que nous pouvons utiliser selon nos besoins. </font><font style="vertical-align: inherit;">Par exemple, afficher sur une page Web. </font><font style="vertical-align: inherit;">Pour ce faire, nous plaçons le code suivant à n'importe quel endroit de la page dont nous avons besoin:</font></font><br>
<br>
<pre><code class="php hljs">%ThisComputer.test%<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est ce qu'on appelle. </font><font style="vertical-align: inherit;">une macro qui, lors du chargement d'une page, substitue la valeur de la variable au lieu d'elle-même, stockée dans la propriété "test" de l'objet "ThisComputer". </font><font style="vertical-align: inherit;">Et par conséquent, vous voyez des informations transmises par le module Laurent en réponse à votre demande sur la page Web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment ajouter une macro à la page? </font><font style="vertical-align: inherit;">Nous allons dans le menu d'administration et sélectionnons l'élément "Pages d'accueil" et sélectionnons n'importe quelle page que vous voulez ou créez-en une en utilisant le gros bouton vert "Nouvelle page". </font><font style="vertical-align: inherit;">Et ajoutez la macro à l'emplacement souhaité sur la page.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voilà donc tout. </font><font style="vertical-align: inherit;">Armé des informations de cet article, vous pouvez vous sentir comme un vrai maître des Laurents et intégrer ces modules dans votre système Smart Home. </font><font style="vertical-align: inherit;">Et dans le prochain article de la série, vous apprendrez à gérer les modules à partir de vos croquis sur Arduino et du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">système Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr384485/">https://habr.com/ru/post/fr384485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr384475/index.html">L'examen n'est pas un gadget. Choisir le meilleur étui d'entraînement et autres accessoires pour smartphones: pansements, sacs et poche en silicone Adidas</a></li>
<li><a href="../fr384477/index.html">La NASA testera la technologie de développement d'astéroïdes utilisant la lumière du soleil</a></li>
<li><a href="../fr384479/index.html">Développement de jeux sur Traitement avec contrôle via la carte Arduino Uno</a></li>
<li><a href="../fr384481/index.html">La guerre a forcé les scientifiques syriens à reconstituer les stocks de semences du "Doomsday Vault"</a></li>
<li><a href="../fr384483/index.html">Un téléphone expérimental alimenté par des panneaux solaires. RC 1.0</a></li>
<li><a href="../fr384487/index.html">La chanson "Joyeux anniversaire à vous" par une décision de justice a été rendue publique</a></li>
<li><a href="../fr384489/index.html">Новый самый быстрый твердотельный накопитель от корейского производителя — Samsung 950 Pro</a></li>
<li><a href="../fr384491/index.html">Les robots se garent mieux que les humains</a></li>
<li><a href="../fr384493/index.html">Montre électronique de style Qlocktwo</a></li>
<li><a href="../fr384499/index.html">Acer Revo One: un ordinateur miniature avec un large spectre d'action</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>