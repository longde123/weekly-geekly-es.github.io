<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÄüèª üìè üö¥üèª Modules Laurent et Smart Home (Partie 1). Majordome üôáüèº üìµ ‚õ±Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je veux attirer votre attention sur une s√©rie d'articles sur les modules de contr√¥le Laurent de KernelChip . Dans cette s√©rie, je vais vous expliquer ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Modules Laurent et Smart Home (Partie 1). Majordome</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384485/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je veux attirer votre attention sur une s√©rie d'articles sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> modules de contr√¥le Laurent </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">de KernelChip</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans cette s√©rie, je vais vous expliquer comment int√©grer ces modules dans votre maison intelligente, comment apprendre √† les g√©rer √† partir du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syst√®me</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> domotique populaire </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">MajorDoMo</font></a><font style="vertical-align: inherit;"> , des croquis Arduino, du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syst√®me Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et m√™me comment utiliser ces modules dans un but compl√®tement inattendu - pour enseigner √† vos enfants la programmation en traitement. </font></font><br>
<br>
<img src="https://habrastorage.org/files/915/0cb/0cb/9150cb0cbde940e588d1badce05af5bb.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En g√©n√©ral, les modules qui sont assez int√©ressants en eux-m√™mes peuvent √™tre tr√®s utiles de mani√®re inattendue dans les m√©nages si vous les approchez avec une certaine imagination et cr√©ativit√©.</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pourquoi Laurent?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parce que ces modules fonctionnent avec succ√®s dans mon syst√®me Smart Home depuis longtemps (plus de trois ans) et j'ai acquis une certaine exp√©rience dans leur utilisation et j'ai quelque chose √† dire √† leur sujet. </font><font style="vertical-align: inherit;">Et j'ai aussi une certaine exp√©rience et un code pr√™t √† l'emploi et test√© pour la gestion de ces modules, que je veux partager avec vous. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et vous pourrez d√©velopper vos solutions logicielles √† partir de ce code, ce sera assez simple, car j'ai d√©j√† fait l'essentiel du travail. </font><font style="vertical-align: inherit;">De plus, le code sera expliqu√© en d√©tail, ce qui contribue certainement √† votre compr√©hension de son fonctionnement, √† l'apprentissage de la programmation et √† la construction de syst√®mes de maison intelligente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modules eux-m√™mes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lorsque j'ai choisi pour moi une solution toute faite pour g√©rer les charges √©lectriques √† travers le r√©seau, Laurent m'a soudoy√© avec l'exhaustivit√© et la simplicit√© de la solution. Pour commencer √† contr√¥ler le r√©seau et √† √©teindre les appareils et l'√©clairage, presque rien n'√©tait n√©cessaire. Il n'√©tait pas n√©cessaire d'apprendre le langage de programmation, il n'√©tait pas n√©cessaire de souder quoi que ce soit, il suffisait de connecter le module au r√©seau local, de connecter la charge aux bornes du relais (et n'oubliez pas d'alimenter le module lui-m√™me) et c'√©tait tout. Apr√®s cela, il a √©t√© possible d'envoyer des commandes directement √† partir de l'ordinateur (√† partir du programme du terminal). Le module a imm√©diatement commenc√© √† allumer et √©teindre docilement la lumi√®re selon mes commandes. A cette √©poque, je n'en avais pas besoin de plus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je peux dire sur les modules eux-m√™mes que pendant toute la p√©riode de fonctionnement, il n'y a pas eu de plantage et de gel, tout a fonctionn√© et fonctionne ¬´comme une horloge¬ª, ce qui, en fait, est requis de ces modules pour fonctionner.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conception et qualit√© de construction</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il suffit de regarder le module pour montrer clairement qu'il a √©t√© d√©velopp√© pour une raison, ¬´si seulement¬ª, mais a essay√© de faire quelque chose de vraiment digne. </font><font style="vertical-align: inherit;">Je n'ai √©galement rien √† redire sur la qualit√© de construction, tout est fait avec soin et comme il se doit: pas de pi√®ces tordues, des taches de soudure ou quelque chose comme √ßa, tout est clair et soign√©. </font><font style="vertical-align: inherit;">Dans l'ensemble, la qualit√© de construction ne diff√®re pas des composants informatiques "de marque" et de l'Arduino "d'usine". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La seule chose que je ferais si je lib√©rais ces modules moi-m√™me √©tait d'installer des bornes multicolores pour connecter les fils au lieu de bornes monochromes, au moins de mettre en √©vidence les bornes de connexion d'alimentation, mais c'est ainsi, petite pioche (tout, bien s√ªr, est soigneusement sign√©).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quel est le premier article de la s√©rie?</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Toutes les informations sont divis√©es en trois articles finis logiquement. Le premier article portera sur l'int√©gration des modules Laurent √† MajorDoMo, une plateforme domotique open source populaire. Des exemples sp√©cifiques et du code PHP seront fournis. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le deuxi√®me article concerne l'int√©gration avec l'√©cosyst√®me Arduino. Vous pouvez g√©rer les modules √† partir de vos croquis individuels ou int√©grer Laurent au </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (qui est √©galement bas√© sur le code Arduino) et g√©rer les Laurents √† partir d'une interface pratique ou automatiquement, selon le programme. Des solutions toutes faites et du code test√© seront √©galement fournis.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et dans le troisi√®me - sur la gestion des modules Laurent √† partir d'esquisses sur le traitement. C'est-√†-dire directement depuis le bureau de votre ordinateur personnel. Le m√™me article d√©crira comment accro√Ætre l'int√©r√™t des enfants pour l'apprentissage des programmes et quel r√¥le ces modules peuvent jouer dans ce domaine. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La s√©rie est consacr√©e √† l'int√©gration des modules Laurent aux syst√®mes domotiques et ne prend pas en compte l'architecture et le fonctionnement des modules eux-m√™mes. Cela a √©t√© d√©crit dans d'autres articles avec lesquels vous pouvez lire </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et sera discut√© plus tard. Ici, nous nous concentrons uniquement sur l'int√©gration.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cours de r√©daction d'articles, le module Laurent avec firmware La01 et la version d'interface web LW1.0 a √©t√© utilis√©, c'est-√†-dire le module tr√®s ¬´combat¬ª qui fonctionne depuis trois ans. </font><font style="vertical-align: inherit;">Dans les nouvelles versions des modules, les d√©tails d'impl√©mentation peuvent diff√©rer l√©g√®rement, mais la compatibilit√© avec les √©quipes de contr√¥le est pr√©serv√©e, donc tout ce qui est dit ici est √©galement vrai pour les modifications plus r√©centes.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fonctionnement de la gestion des modules</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous les √©changes d'informations avec les modules sont effectu√©s sur le r√©seau et pour commencer √† travailler avec eux, vous devez √©tablir une connexion TCP / IP sur le port 2424. </font><font style="vertical-align: inherit;">Une fois la connexion √©tablie, vous pouvez envoyer des commandes de texte (dites commandes KE) qui contr√¥lent le module. </font><font style="vertical-align: inherit;">Le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">site Web KernelChip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient une documentation d√©taill√©e, y compris une description accessible des commandes KE. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
KernelChip s'est occup√© des utilisateurs et a fourni √† ses modules une interface Web pratique, mais il s'agit d'un ¬´contr√¥le manuel¬ª, et la commodit√©, la valeur et l'utilit√© de la solution augmenteront d'une commande si nous apprenons √† g√©rer le module √† partir de notre maison intelligente. </font></font><br>
<br>
<img src="https://habrastorage.org/files/0ad/e7b/6e3/0ade7b6e3ff2446e969b922121a3c87d.jpg" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'interface Web est prot√©g√©e par mot de passe par d√©faut et pour voir le contenu de la page Web, vous devez entrer le nom d'utilisateur "admin" et le mot de passe "Laurent".</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Majordome</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le syst√®me </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MajorDoMo est</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assez populaire et je ne m'y attarderai pas ici en d√©tail. </font><font style="vertical-align: inherit;">Il est suppos√© que vous avez d√©j√† install√© ce syst√®me et que vous l'avez utilis√© pendant un certain temps. </font><font style="vertical-align: inherit;">Pour ceux qui ne sont pas du tout √† jour, j'expliquerai qu'il s'agit d'une plate-forme domotique ouverte qui fonctionne sur Windows et Linux et qui est bas√©e sur un serveur Web et est une sorte de CMS sp√©cialis√© (syst√®me de gestion de contenu) avec de larges capacit√©s et "aff√ªt√©" pour automatisation de la maison. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les possibilit√©s de MajorDoMo sont vraiment infinies et la gestion des modules Laurent n'est qu'un des talents de ce syst√®me.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©tails techniques</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo incorpore le fichier laurent.class.php, qui se trouve dans le r√©pertoire</font></font><br>
<br>
<pre><code class="dos hljs">\htdocs\lib\<font></font>
<font></font>
</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code complet laurent.class.php</font></font></b><div class="spoiler_text">&lt;?<br>
<br>
function laurent_command($host, $command, $password='Laurent') {<br>
<br>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);<br>
 if ($socket === false) {<br>
 echo ¬´socket_create() failed: reason: ¬ª. socket_strerror(socket_last_error()). "\n";<br>
 return 0;<br>
 }<br>
<br>
$result = socket_connect($socket, $host, 2424);<br>
 if ($result === false) {<br>
 echo ¬´socket_connect( $socket, $host, 2424) failed.\nReason: ($result) ¬ª. socket_strerror(socket_last_error($socket)). "\n";<br>
 return 0;<br>
 }<br>
<br>
$in='$KE'."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in='$KE,PSW,SET,'.$password."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
socket_close($socket);<br>
 return trim($res);<br>
 <br>
 }<br>
<br>
function laurent_getStat($host, $password='Laurent') {<br>
<br>
$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);<br>
 if ($socket === false) {<br>
 echo ¬´socket_create() failed: reason: ¬ª. socket_strerror(socket_last_error()). "\n";<br>
 return 0;<br>
 }<br>
<br>
$result = socket_connect($socket, $host, 2424);<br>
 if ($result === false) {<br>
 echo ¬´socket_connect( $socket, $host, 2424) failed.\nReason: ($result) ¬ª. socket_strerror(socket_last_error($socket)). "\n";<br>
 return 0;<br>
 }<br>
<br>
$in='$KE'."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$in='$KE,PSW,SET,'.$password."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "\n"))) {<br>
 break;<br>
 }<br>
 }<br>
<br>
$command='$KE,DAT,ON';<br>
 $in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
$res='';<br>
 $started=0;<br>
 while ($out = socket_read($socket, 2048, PHP_NORMAL_READ)) {<br>
 $res.=$out;<br>
 if (is_integer(strpos($out, "#TIME,"))) {<br>
 if (!$started) {<br>
 $started=1;<br>
 } else {<br>
 break;<br>
 }<br>
 }<br>
 }<br>
<br>
$command='$KE,DAT,OFF';<br>
 $in=$command."\r\n";<br>
 socket_write($socket, $in, strlen($in));<br>
 sleep(1);<br>
 socket_write($socket, $in, strlen($in));<br>
 socket_write($socket, $in, strlen($in));<br>
<br>
socket_close($socket);<br>
 return trim($res);<br>
 <br>
 }<br>
<br>
?&gt;<br>
<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et contient tout ce dont vous avez besoin pour travailler avec les modules Laurent. </font><font style="vertical-align: inherit;">Ce fichier contient des fonctions dans le langage de programmation PHP et, probablement, sous forme finie ou avec des modifications minimes, peut √™tre transf√©r√© vers n'importe quel syst√®me utilisant ce langage de programmation. </font><font style="vertical-align: inherit;">Donc, si vous avez un projet Smart Home sur une autre plateforme, vous pouvez essayer d'int√©grer Laurent √† votre syst√®me en utilisant ce fichier. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction principale utilis√©e pour contr√¥ler le module est</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'&lt; &gt;'</span>, <span class="hljs-string">'&lt;&gt;'</span>, <span class="hljs-string">'&lt;  &gt;'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
par exemple,</font></font><br>
<br>
<pre><code class="php hljs">$result = laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,INF'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
, o√π '192.168.2.19' est l'adresse IP du module, '$ KE, INF' est la commande elle-m√™me, 'Laurent' est le mot de passe (par d√©faut). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le r√©sultat du travail de la fonction entre dans la variable $ result, c'est-√†-dire la r√©ponse du module, que vous pouvez analyser et interpr√©ter √† l'aide des outils de langage PHP standard. Le mot de passe est sp√©cifi√© tel qu'il est par d√©faut. Si vous avez chang√© le mot de passe pour acc√©der √† votre module, vous devrez le remplacer par un nouveau et dans l'appel de fonction. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tout doit √™tre clair avec l'√©quipe, vous pouvez prendre toutes les commandes du r√©pertoire et g√©rer le module comme vous le souhaitez. L'adresse IP ne devrait pas non plus poser de probl√®me. Sp√©cifiez simplement l'adresse IP que votre module Laurent poss√®de r√©ellement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez terminer la th√©orie avec ceci et maintenant je vais vous montrer avec un exemple pratique comment faire le contr√¥le de la lumi√®re (ou d'un appareil) directement √† partir du menu MajorDoMo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemple pratique</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä titre d'exemple pratique, examinons la cr√©ation de deux boutons ¬´Activer¬ª et ¬´D√©sactiver¬ª dans le menu principal du syst√®me MajorDoMo. Avec ces boutons, vous pouvez allumer ou √©teindre la lumi√®re ou tout autre appareil √©lectrique (ici, il suffit de se rappeler que les relais install√©s sur le module ne sont pas en mesure de contr√¥ler directement une charge puissante comme une cuisini√®re √©lectrique ou un chauffe-eau). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Donc, nous cr√©ons le bouton "Activer", pour cela nous allons dans le panneau d'administration de MajorDoMo et entrons le nom d'utilisateur et le mot de passe (admin / admin par d√©faut) et cliquez sur "OBJETS / Menu Contr√¥le" puis sur le gros bouton vert "Ajouter une nouvelle section". </font></font><br>
<br>
<img src="https://habrastorage.org/files/fb3/4af/d8b/fb34afd8babe4df5a78392f9b6025857.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous trouvons la liste d√©roulante "Type" et s√©lectionnons "Bouton" parmi toute la vari√©t√© de types pr√©sent√©s et cliquez sur "Enregistrer".</font></font><br>
<br>
<img src="https://habrastorage.org/files/2de/95f/137/2de95f13747c4887b12cc1a6b51315ae.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, s√©lectionnez "√©l√©ment de menu parent" est l'endroit o√π notre bouton "accroche". </font><font style="vertical-align: inherit;">Je l'ai Laurent, et vous pouvez avoir n'importe quel √©l√©ment de menu pratique. </font><font style="vertical-align: inherit;">Par d√©faut, il y a "ROOT", ce qui signifie que le bouton sera visible imm√©diatement, sans cliquer sur aucun √©l√©ment de menu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le champ de saisie "Titre", √©crivez ce que vous voulez qu'il soit √©crit sur le bouton. </font><font style="vertical-align: inherit;">Et enfin, dans le champ Code, √©crivez le code de la fonction laurent_command que nous connaissons d√©j√†:</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,1'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici c'est la m√™me chose que dans l'exemple th√©orique, seule la variable $ resultat manque (on n'en a pas besoin) et la commande est remplac√©e par '$ KE, REL, 2,1', ce qui signifie activer le relais n ¬∞ 2. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous faisons de m√™me pour le bouton "D√©sactiver", n'oubliez pas de changer le nom du bouton et au lieu de '$ KE, REL, 2.1' √©crire '$ KE, REL, 2.0', ce qui signifie d√©sactiver le relais n ¬∞ 2:</font></font><br>
<br>
<pre><code class="php hljs">laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,0'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est tout. </font><font style="vertical-align: inherit;">Nous rechargeons la page avec l'interface MajorDoMo, deux nouveaux boutons apparaissent qui allument et √©teignent les lumi√®res (ou l'appareil) directement √† partir de l'interface MajorDoMo magnifiquement et presque sans d√©lai. </font><font style="vertical-align: inherit;">Ce que nous voulions r√©aliser.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contr√¥le automatique</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essayons maintenant de contr√¥ler le module automatiquement, sans intervention humaine. </font><font style="vertical-align: inherit;">Vous verrez maintenant que c'est encore plus simple que d'utiliser les boutons pour contr√¥ler le module. </font></font><br>
<br>
<img src="https://habrastorage.org/files/13a/34b/f74/13a34bf74e8943b5a0613e972ef09b85.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
On retrouve dans le menu principal du panneau d'administration de MajorDoMo l'√©l√©ment ¬´Objets¬ª, cliquez dessus, puis on retrouve l'objet ¬´ClockChime¬ª et sa m√©thode ¬´onNewMinute¬ª. </font><font style="vertical-align: inherit;">Nous avons besoin de lui. </font><font style="vertical-align: inherit;">Pour ceux qui ne sont pas au courant, il s'agit de la m√©thode ¬´centrale¬ª MajorDoMo, qui est appel√©e toutes les minutes et est tr√®s populaire. </font><font style="vertical-align: inherit;">C'est dans cette m√©thode qu'il existe de nombreuses fonctions et appels de script qui fournissent les fonctionnalit√©s utilisateur du syst√®me.</font></font><br>
<br>
<img src="https://habrastorage.org/files/1c6/88b/2ea/1c688b2ead4642b4934a67a00b19d9d2.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et tout ce que nous devons faire est d'ajouter notre code √† cette m√©thode. </font><font style="vertical-align: inherit;">Par exemple, consid√©rez cette situation. </font><font style="vertical-align: inherit;">Votre module Laurent contr√¥le l'√©clairage nocturne dans la cour de votre maison. </font><font style="vertical-align: inherit;">Et vous, par exemple, souhaitez que la lumi√®re s'allume √† 21h00 et s'√©teigne √† 7h30 du matin. </font><font style="vertical-align: inherit;">Rien de plus simple, voici le code que vous devez ajouter √† la m√©thode onNewMinute:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-keyword">if</span> (timeIs(<span class="hljs-string">'21:00'</span>)) {<font></font>
  laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,1'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">if</span> (timeIs(<span class="hljs-string">'7:30'</span>)) {<font></font>
  laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,REL,2,0'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
}<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et c'est tout! </font><font style="vertical-align: inherit;">Vous devez admettre que ce n‚Äôest pas difficile du tout. </font><font style="vertical-align: inherit;">Ce n'est qu'un exemple, la logique du travail peut √™tre absolument n'importe laquelle et tr√®s sophistiqu√©e. </font><font style="vertical-align: inherit;">Et les talents des modules Laurent ne se limitent pas √† allumer et √©teindre des charges, leur fonctionnalit√© est beaucoup plus large, mais ce n'est pas le sujet de cet article, nous ne consid√©rons ici que les probl√®mes d'int√©gration avec des exemples simples.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©ception et sortie des donn√©es du module</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et le dernier exemple sera comment obtenir et afficher les informations re√ßues du module Laurent sur la page Web de MajorDoMo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MajorDoMo est un syst√®me orient√© objet et tout le travail s'y d√©roule √† travers la cr√©ation d'objets et l'utilisation de leurs donn√©es (variables) et m√©thodes (code programme). Un peu difficile? En fait, √ßa va et maintenant vous verrez par vous-m√™me. </font></font><br>
<br>
<img src="https://habrastorage.org/files/adc/f9a/1c0/adcf9a1c0940400798e8392da8690c52.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, pour un exemple nous utiliserons l'objet d√©j√† existant "ThisComputer" et nous lui ajouterons une nouvelle propri√©t√© "test". Pour ce faire, cliquez sur l'√©l√©ment de menu "Objets" qui nous est d√©j√† familier dans la zone d'administration de MajorDoMo, trouvez l'objet "ThisComputer" et cliquez sur l'√©l√©ment "Propri√©t√©s", faites d√©filer vers le bas et trouvez le champ de saisie "Ajouter une nouvelle propri√©t√©", entrez "test" et cliquez sur "Actualiser" (laissez la valeur vide).</font></font><br>
<br>
<img src="https://habrastorage.org/files/81a/bd8/8f8/81abd88f8596487ca7415eb6526d6d40.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur ce point, les op√©rations pr√©paratoires peuvent √™tre consid√©r√©es comme termin√©es, nous avons ajout√© une nouvelle propri√©t√© ¬´test¬ª √† l'objet ¬´ThisComputer¬ª, que nous utiliserons dans nos exp√©rimentations. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, notre t√¢che est de demander les informations n√©cessaires au module Laurent et de les mettre dans la propri√©t√© (variable) du ¬´test¬ª de l'objet ¬´ThisComputer¬ª. </font><font style="vertical-align: inherit;">Comment faire √ßa? </font><font style="vertical-align: inherit;">Tr√®s simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ajoutez ce code √† la m√©thode onNewMinute que nous connaissons d√©j√†:</font></font><br>
<br>
<pre><code class="php hljs">$result = laurent_command(<span class="hljs-string">'192.168.2.19'</span>, <span class="hljs-string">'$KE,INF'</span>, <span class="hljs-string">'Laurent'</span>);<font></font>
setGlobal(<span class="hljs-string">'ThisComputer.test'</span>, $result); <font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et chaque minute MajorDoMo demandera au module les informations n√©cessaires et mettra √† jour la variable ¬´test¬ª, que nous pouvons utiliser selon nos besoins. </font><font style="vertical-align: inherit;">Par exemple, afficher sur une page Web. </font><font style="vertical-align: inherit;">Pour ce faire, nous pla√ßons le code suivant √† n'importe quel endroit de la page dont nous avons besoin:</font></font><br>
<br>
<pre><code class="php hljs">%ThisComputer.test%<font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'est ce qu'on appelle. </font><font style="vertical-align: inherit;">une macro qui, lors du chargement d'une page, substitue la valeur de la variable au lieu d'elle-m√™me, stock√©e dans la propri√©t√© "test" de l'objet "ThisComputer". </font><font style="vertical-align: inherit;">Et par cons√©quent, vous voyez des informations transmises par le module Laurent en r√©ponse √† votre demande sur la page Web. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comment ajouter une macro √† la page? </font><font style="vertical-align: inherit;">Nous allons dans le menu d'administration et s√©lectionnons l'√©l√©ment "Pages d'accueil" et s√©lectionnons n'importe quelle page que vous voulez ou cr√©ez-en une en utilisant le gros bouton vert "Nouvelle page". </font><font style="vertical-align: inherit;">Et ajoutez la macro √† l'emplacement souhait√© sur la page.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voil√† donc tout. </font><font style="vertical-align: inherit;">Arm√© des informations de cet article, vous pouvez vous sentir comme un vrai ma√Ætre des Laurents et int√©grer ces modules dans votre syst√®me Smart Home. </font><font style="vertical-align: inherit;">Et dans le prochain article de la s√©rie, vous apprendrez √† g√©rer les modules √† partir de vos croquis sur Arduino et du </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syst√®me Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr384485/">https://habr.com/ru/post/fr384485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr384475/index.html">L'examen n'est pas un gadget. Choisir le meilleur √©tui d'entra√Ænement et autres accessoires pour smartphones: pansements, sacs et poche en silicone Adidas</a></li>
<li><a href="../fr384477/index.html">La NASA testera la technologie de d√©veloppement d'ast√©ro√Ødes utilisant la lumi√®re du soleil</a></li>
<li><a href="../fr384479/index.html">D√©veloppement de jeux sur Traitement avec contr√¥le via la carte Arduino Uno</a></li>
<li><a href="../fr384481/index.html">La guerre a forc√© les scientifiques syriens √† reconstituer les stocks de semences du "Doomsday Vault"</a></li>
<li><a href="../fr384483/index.html">Un t√©l√©phone exp√©rimental aliment√© par des panneaux solaires. RC 1.0</a></li>
<li><a href="../fr384487/index.html">La chanson "Joyeux anniversaire √† vous" par une d√©cision de justice a √©t√© rendue publique</a></li>
<li><a href="../fr384489/index.html">–ù–æ–≤—ã–π —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Ç–≤–µ—Ä–¥–æ—Ç–µ–ª—å–Ω—ã–π –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å –æ—Ç –∫–æ—Ä–µ–π—Å–∫–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è ‚Äî Samsung 950 Pro</a></li>
<li><a href="../fr384491/index.html">Les robots se garent mieux que les humains</a></li>
<li><a href="../fr384493/index.html">Montre √©lectronique de style Qlocktwo</a></li>
<li><a href="../fr384499/index.html">Acer Revo One: un ordinateur miniature avec un large spectre d'action</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>