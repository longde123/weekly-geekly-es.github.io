<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🌾 👋 👩🏻‍🎓 SwayWM - UnixPorn você mesmo 🧑 👆🏿 🧖🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Olá pessoal. Neste artigo, descreverei minha experiência em configurar e usar o sway, um gerenciador de janelas lado a lado para Linux. 
 O que é e po...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SwayWM - UnixPorn você mesmo</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484378/"><p>  Olá pessoal.  Neste artigo, descreverei minha experiência em configurar e usar o sway, um gerenciador de janelas lado a lado para Linux. <a name="habracut"></a></p><br><h1 id="chto-eto-takoe-i-zachem-ono-nuzhno">  O que é e por que é necessário? </h1><br><p>  Oficialmente, o sway é um gerenciador de janelas lado a lado, um substituto transparente para o i3wm, trabalhando em cima do Wayland. </p><br><blockquote>  Weiland, também conhecido como Wölund, etc.  - Um personagem da mitologia alemã antiga e nórdica antiga, um livro sobre o qual uma vez foi escrito pela folclorista inglesa Jessie Weston.  Agora você sabe. </blockquote><p>  No entanto, na minha opinião, a principal característica do balanço é que ele é um construtor, com todas as vantagens e desvantagens dessa abordagem.  Se você gosta do Vim (a semelhança com ele é agravada pela orientação sobre o uso do teclado), do Archlinux e de projetos similares, aconselho que você dê uma olhada mais de perto na influência.  Minha opinião pessoal é que, quando você gastar um pouco mais de tempo para configurá-lo, terá um ambiente muito estável e conveniente para você, pessoalmente, no qual nada inesperado acontecerá. </p><br><p>  Se as falhas de oscilação e Wayland (como a falta de suporte para os drivers particulares da NVidia e a necessidade de procurar análogos para muitos programas familiares) parecerem fatais para você, aconselho que você preste atenção no x3 i3wm.  As partes construtoras serão completamente diferentes, você terá que instalar o xinit, configurar várias .Xauthority, é possível lidar com o rasgo, mas a lógica geral do sistema é exatamente a mesma. </p><br><h1 id="ustanovka">  Instalação </h1><br><p> O Sway provavelmente está nos repositórios da sua distribuição.  No entanto, se você deseja instalar uma versão mais recente, é muito simples.  A página do projeto <a href="https://github.com/swaywm/sway">github</a> tem uma lista escassa de suas dependências.  Instale-os, clone o repositório, clone <code>wlroots</code> na pasta de <code>subprojects</code> : </p><br><pre> <code class="plaintext hljs">hub clone swaywm/sway hub clone swaywm/wlroots sway/subprojects/wlroots</code> </pre><br><p>  (aqui eu uso um <a href="https://github.com/github/hub">hub</a> . Uma ferramenta não-padrão, mas muito conveniente).  Depois disso, você pode configurar e criar: </p><br><pre> <code class="plaintext hljs">meson setup ./sway-build ./sway --buildtype=minsize ninja -C ./sway-build doas ninja -C ./sway-build install</code> </pre> <br><blockquote>  doas é um substituto leve do sudo para desenvolvedores do OpenBSD.  O Linux geralmente usa seu fork do <a href="https://github.com/Duncaen/OpenDoas">OpenDoas.</a> </blockquote><br><h1 id="zapusk">  Lançamento </h1><br><p>  Se você deseja controlar a partir da linha de comando sem usar gerentes como o SDDM, a única maneira correta de fazer isso é </p><br><pre> <code class="plaintext hljs">$ exec sway</code> </pre> <br><p>  Se você executar o balanço sem o <code>exec</code> , bloquear a tela com o bloqueio e a queda do balanço, você será jogado de volta à linha de comando.  A fechadura será inútil. </p><br><blockquote>  Nota para os fãs do systemd: o sway não requer nem systemd-logind nem elogind.  É verdade que, nesse caso, você terá que definir o suid bit ou configurar os recursos.  Veja o <a href="https://github.com/swaywm/sway/wiki/Running-Sway-without-systemd">wiki</a> . </blockquote><br><h2 id="peremennye-okruzheniya">  Variáveis ​​de ambiente </h2><br><p>  Existem vários lugares onde eu os prescrevo. </p><br><p>  Script de shell em <code>~/.local/bin/sway</code> - para variáveis ​​específicas ao sway.  Por exemplo, quero que os aplicativos Qt não mostrem o cenário e usem o tema de <code>qt5ct</code> : </p><br><pre> <code class="plaintext hljs">#!/bin/bash QT_QPA_PLATFORMTHEME=qt5ct \ QT_WAYLAND_DISABLE_WINDOWDECORATION=1 \ /usr/bin/sway</code> </pre> <br><p>  <code>~/.pam_environment</code> - para variáveis ​​que eu quero disponibilizar imediatamente na sessão do usuário systemd.  Um exemplo: </p><br><pre> <code class="plaintext hljs">SSH_AUTH_SOCK DEFAULT="${XDG_RUNTIME_DIR}/gnupg/S.gpg-agent.ssh"</code> </pre> <br><p>  No entanto, altere este arquivo com cuidado, especialmente se você usar outros ambientes.  Por exemplo, o KDE Plasma não gostará muito se detectar <code>$WAYLAND_DISPLAY</code> (ironicamente, o módulo <code>pam_env</code> que <code>pam_env</code> este arquivo foi criado há N anos atrás, principalmente para definir a variável <code>$DISPLAY</code> ). </p><br><p>  <code>~/.bashrc</code> - para todos os outros casos. </p><br><h1 id="nastroyka-sway">  Configuração do balanço </h1><br><h2 id="vvod">  Entrar </h2><br><p>  Tudo é bem simples no meu sistema: instalamos layouts em russo e inglês e alternamos entre eles com <code>Alt+Shift</code> .  Na configuração do balanço, fica assim: </p><br><pre> <code class="plaintext hljs">input * { xkb_layout us,ru xkb_options grp:alt_shift_toggle }</code> </pre> <br><p>  O Sway usa a biblioteca <code>libinput</code> para entrada, o mesmo que o KDE e o Gnome.  Portanto, temos muitas opções disponíveis.  Configurações do touchpad, rolagem natural, aceleração do ponteiro do mouse etc.  etc.  A lista de opções pode ser examinada em <code>man sway-input</code> e a lista de dispositivos de entrada na saída do comando </p><br><pre> <code class="plaintext hljs">swaymsg -t get_inputs</code> </pre> <br><p>  No entanto, gostaria de chamar a atenção para uma oportunidade interessante.  Se você estiver saindo de um ambiente X, basta transferir as configurações do teclado a partir daí.  Execute o comando neste ambiente </p><br><pre> <code class="plaintext hljs">$ xkbcomp $DISPLAY /path/to/keymap.xkb</code> </pre> <br><p>  e no registro de configuração do balanço </p><br><pre> <code class="plaintext hljs">input * { xkb_file /path/to/keymap.xkb }</code> </pre> <br><h2 id="hotkei">  Teclas de atalho </h2><br><p>  As teclas de atalho, como todo o resto, são definidas na configuração.  Existem 3 comandos para defini-los: </p><br><ol><li>  <code>bindswitch</code> .  É realizada ao abrir / fechar a tampa do laptop, ao modo tablet, etc. </li><li>  <code>bindcode</code> .  É executado quando uma tecla com o código especificado é pressionada.  Não depende do layout atual, especialmente útil para teclas multimídia. </li><li>  <code>bindsym</code> .  O caractere atual inserido depende do layout.  No entanto, se você adicionar o parâmetro <code>--to-code</code> , esse caractere será implicitamente convertido no código correspondente para o primeiro layout do <code>xkb_layout</code> (consulte as configurações de entrada). </li></ol><br><p>  Por exemplo, uma tecla de atalho superará a janela atual, independentemente do layout: </p><br><pre> <code class="plaintext hljs">bindsym --to-code $mod+Shift+q kill</code> </pre> <br><p>  Você pode ler mais sobre esses parâmetros em mana: <code>man 5 sway</code> . </p><br><p>  Para determinar facilmente o que foi pressionado, o autor do sway escreveu um <a href="https://git.sr.ht/~sircmpwn/wshowkeys">keylogger</a> especial (ele precisa de direitos de root para funcionar, portanto, não há necessidade de se preocupar com segurança). </p><br><h2 id="vyvod">  Conclusão </h2><br><p>  Uma lista de dispositivos de saída disponíveis pode ser obtida com o comando </p><br><pre> <code class="plaintext hljs">swaymsg -t get_outputs</code> </pre> <br><p>  Na configuração de cada um deles, você pode definir o modo de vídeo, dimensionamento (incluindo fracionário), imagem, rotação etc.  A configuração mais simples é assim: </p><br><pre> <code class="plaintext hljs">output HDMI-A-1 mode 1920x1080@60Hz output * bg /path/to/wallpaper.jpg fill</code> </pre> <br><p>  Uma lista completa de opções pode ser encontrada no mana <code>man sway-output</code> . <br>  Existe também um programa <a href="https://github.com/emersion/wlr-randr">wlr-randr</a> no qual tudo isso pode ser definido na linha de comando (ou seja, é um análogo do XRandr para Wayland). </p><br><h2 id="swaybar">  Swaybar </h2><br><p>  Barra estabilizadora - um painel no qual as informações de status são exibidas.  Data, hora, bandeja do sistema etc.  etc.  Normalmente, os ventiladores i3 e os osciladores passam mais tempo configurando esse painel específico (ou painéis, pode haver vários).  Pessoalmente, eu tenho o suficiente disso, perto da configuração mínima: </p><br><pre> <code class="plaintext hljs">bar { position top colors { statusline #ffffff background #282828E6 inactive_workspace #282936BF #282936BF #5c5c5c } font Hack 11 status_command i3blocks }</code> </pre> <br><p>  Existem muitas opções para ajustar posição, cores, fontes, bandeja, etc.  Você pode <code>man 5 sway-bar</code> sobre eles em mana - <code>man 5 sway-bar</code> . </p><br><p>  O Swaybar está comprometido em ler e analisar o json no formato i3bar, produzido pelo <code>status_command</code> .  Existem muitos programas que podem ser usados ​​aqui.  <a href="https://i3wm.org/i3status/">i3status</a> , <a href="https://github.com/Alexays/Waybar">waybar</a> , <a href="https://github.com/greshake/i3status-rust">i3status-rs</a> e muitos outros projetos.  Pessoalmente, prefiro <a href="https://github.com/vivien/i3blocks">i3blocks</a> devido à simplicidade da configuração e à facilidade de adicionar blocos personalizados. </p><br><h1 id="nastroyka-prikladnyh-programm">  Configuração do aplicativo </h1><br><h2 id="uvedomleniya">  Notificações </h2><br><p>  Isso pode ser <a href="https://github.com/emersion/mako">feito pelo</a> daemon <a href="https://github.com/emersion/mako">mako</a> (provavelmente existe na sua distribuição).  Lá você também pode ajustar cores, etc., mas tudo isso é opcional.  Basta executá-lo e ele funcionará. </p><br><p>  O Mako implementa a especificação de Notificações de área de trabalho XDG baseada em dbus.  É suportado por muitos programas, incluindo Chromium, Firefox e Telegram. </p><br><h2 id="emulyator-terminala">  Emulador de terminal </h2><br><p>  Em ambientes como o KDE, o Plasma normalmente usa emuladores embutidos que exibem menus, guias e muitos outros elementos de design.  Mas por que tudo isso influencia?  Eu prefiro o <a href="https://github.com/alacritty/alacritty">Alacritty</a> - muito rápido, graças ao uso do emulador de GPU, a propósito, escrito em Rust.  Adicionei essas teclas de atalho à seção key_bindings em sua configuração ( <code>~/.config/alacritty/alacritty.yml</code> ): </p><br><pre> <code class="plaintext hljs">- { key: T, mods: Control|Shift, action: SpawnNewInstance }</code> </pre> <br><p>  abra uma nova janela com o diretório atual.  Um ótimo substituto para as guias e o balanço cuidará do layout. </p><br><pre> <code class="plaintext hljs">- { key: Up, mods: Control|Shift, action: ScrollLineUp, mode: ~Alt } - { key: Down, mods: Control|Shift, action: ScrollLineDown, mode: ~Alt }</code> </pre> <br><p>  role para cima / baixo uma linha. </p><br><p>  Escrevemos na configuração do balanço </p><br><pre> <code class="plaintext hljs">set $term alacritty bindsym $mod+Return exec $term</code> </pre> <br><p>  O Alacritty não suporta ligaduras, pois elas afetam a velocidade de renderização.  Se você ainda precisar deles, preste atenção ao <a href="https://sw.kovidgoyal.net/kitty/">gatinho</a> - este emulador também é muito rápido e há apenas uma quantidade assustadora de recursos e configurações sob o capô. </p><br><h2 id="zapusk-prilozheniy">  Iniciar aplicativos </h2><br><p>  Os aplicativos influenciados geralmente são iniciados usando o menu de teclas de atalho.  Na configuração, eles escrevem algo como </p><br><pre> <code class="plaintext hljs">set $menu ... bindsym --to-code $mod+d exec $menu</code> </pre> <br><p>  Existem muitos programas para exibir o menu.  Alguns, como <a href="https://tools.suckless.org/dmenu/">dmenu</a> ou <a href="https://github.com/davatorium/rofi">rofi</a> , precisam do XWayland.  Entre os que trabalham no Wayland, podemos distinguir <a href="https://github.com/Cloudef/bemenu">bemenu</a> e até krunner (o que aparece no KDE pelo <code>Alt+F2</code> . Sim, este é um programa independente). </p><br><p>  No entanto, prefiro uma solução mais universal, ou seja, o <a href="https://github.com/Biont/sway-launcher-desktop">sway-launcher-desktop</a> .  Apesar do nome, ele não depende de influência e, em geral, não é um programa da GUI, mas um pequeno script de shell que funciona no console.  Este script forma um menu a partir de programas em <code>$PATH</code> , arquivos da área de trabalho instalados (de acordo com a especificação XDG Desktop Entry) e, possivelmente, fontes adicionais (configuradas na configuração).  O maravilhoso utilitário <code>fzf</code> é usado para exibir e pesquisar no menu - preste atenção nele. </p><br><p>  Assim, para exibir o menu, precisamos abrir uma janela de terminal com este programa.  Com alacritty, isso é feito assim: </p><br><pre> <code class="plaintext hljs">set $menu exec alacritty -e sway-launcher-desktop bindsym --to-code $mod+d exec $menu</code> </pre> <br><p>  Você pode fazer essa janela flutuar por padrão.  No i3 e no sway, essas regras são configuradas na configuração usando a diretiva <code>for_window</code> .  Para mapear a regra para a janela <code>sway-launcher-desktop</code> , ela precisa receber uma classe exclusiva, para mim é apenas o <code>Launcher</code> .  Lembre-se de que, devido ao uso de Wayland, os critérios listados no <a href="https://i3wm.org/docs/userguide.html">manual i3</a> não são adequados para oscilação.  Os corretos podem ser encontrados no <code>man 5 sway</code> , seção <code>CRITERIA</code> .  Nesse caso, <code>app_id</code> é bastante adequado, e a configuração final é assim: </p><br><pre> <code class="plaintext hljs">set $menu exec alacritty --class Launcher -e sway-launcher-desktop for_window [app_id="Launcher"] floating enable, border pixel 10, sticky enable bindsym --to-code $mod+d exec $menu</code> </pre> <br><h2 id="avtozapusk-prilozheniy">  Iniciar aplicativos automaticamente </h2><br><p>  Em princípio, para iniciar automaticamente um programa, você pode simplesmente escrever </p><br><pre> <code class="plaintext hljs">exec /path/to/program</code> </pre> <br><p>  na configuração de oscilação ou até mesmo criar uma unidade systemd personalizada.  No entanto, neste artigo, usarei a especificação de inicialização automática do XDG adotada pelo KDE e Gnome. </p><br><p>  A especificação é para executar arquivos da área de trabalho localizados nos diretórios <code>/etc/xdg/autostart</code> e <code>~/.config/autostart</code> .  Como regra, esses arquivos vêm em pacotes com programas, mas são fáceis de criar você mesmo. </p><br><p>  É aqui que a essência modular do balanço se manifesta.  O Sway em si não sabe nada sobre o XDG Autostart, nem sobre o XDG Desktop Entry.  Além disso, seus desenvolvedores não gostam ativamente dessas e de todas as especificações semelhantes.  No entanto, o utilitário <a href="https://github.com/jceb/dex">dex</a> console pode gerenciá-los (provavelmente, ele está no repositório da sua distribuição). </p><br><p>  Para verificar o que haverá na execução automática, digite o comando </p><br><pre> <code class="plaintext hljs">$ dex -ade Sway</code> </pre> <br><p>  <code>a</code> significa início automático, <code>d</code> - "funcionamento a seco", <code>-e Sway</code> define o nome do ambiente (pode ser qualquer) e é usado para filtrar. </p><br><p>  Provavelmente, a lista resultante não será adequada para você.  Por exemplo, eu tenho o <code>kgpg</code> .  Procedemos da seguinte maneira: copie o arquivo da área de trabalho correspondente de <code>/etc/xdg/autostart</code> para <code>~/.config/autostart</code> , adicione a linha lá </p><br><pre> <code class="plaintext hljs">NotShowIn=Sway</code> </pre> <br><p>  e verifique a execução automática novamente.  Muitos programas (especialmente aqueles escritos em Electron) podem não gostar de rodar em Wayland.  Nós fazemos o mesmo com eles.  Copiamos o arquivo da área de trabalho e alteramos a linha de lançamento lá.  Foi: </p><br><pre> <code class="plaintext hljs">Exec=/usr/bin/skypeforlinux</code> </pre> <br><p>  tornou-se: </p><br><pre> <code class="plaintext hljs">Exec=env GDK_BACKEND=x11 /usr/bin/skypeforlinux</code> </pre> <br><p>  a mesma técnica pode ser aplicada ao sway-launcher-desktop do parágrafo anterior.  Quando todos os problemas forem resolvidos, adicione a linha à configuração de oscilação </p><br><pre> <code class="plaintext hljs">exec dex -ae Sway</code> </pre> <br><p>  Ou você pode fazer o oposto: copie os arquivos da área de trabalho desejados para algum diretório não padrão e defina o dex nele com o comando </p><br><pre> <code class="plaintext hljs">exec dex -as /path/to/your/dir</code> </pre> <br><h2 id="skrinshoty">  Screenshots </h2><br><p>  Dois caixões nos ajudarão nisso.  <a href="https://github.com/emersion/slurp">O slurp</a> permite selecionar uma área retangular arbitrária na tela e o <a href="https://github.com/emersion/grim">sombrio</a> faz uma captura de tela dela.  Na minha configuração, fica assim: </p><br><pre> <code class="plaintext hljs">bindsym Print exec grim ~/Pictures/screen-"$(date +%s)".png bindsym $mod+Print exec grim -g "$(slurp)" ~/Pictures/screen-"$(date +%s)".png</code> </pre> <br><p>  <code>$mod+PrintScreen</code> - captura de tela de uma área arbitrária, <code>PrintScreen</code> - captura de tela de toda a tela. </p><br><h2 id="skrinkasty">  Screencasts </h2><br><p>  Se você precisar gravar um screencast em um arquivo ou transmiti-lo para um fluxo RTMP (por exemplo, no Twitch), o <a href="https://github.com/ammen99/wf-recorder">wf-recorder</a> ajudará nisso (também suporta slurp). </p><br><p>  Se você deseja usar o OBS Studio, existe o plugin <a href="https://hg.sr.ht/~scoopta/wlrobs">wlrobs</a> para isso. </p><br><p>  No entanto, a solução mais universal suportada, por um lado, no KDE e no Gnome e, por outro, em particular nos navegadores Chrome e Firefox, é usar o Pipewire e a especificação do XDG Desktop Portal.  Por outro lado, existe a camada necessária <a href="https://github.com/emersion/xdg-desktop-portal-wlr">xdg-desktop-portal-wlr</a> , embora eu não tenha verificado seu desempenho. </p><br><h2 id="nochnoy-rezhim">  Modo noturno </h2><br><p>  O modo noturno consiste em substituir as cores do monitor por cores mais quentes no escuro.  Os cientistas duvidam de quão útil isso realmente seja, e os desenvolvedores de Wayland decidiram que padronizar o protocolo de correção gama era inútil por razões técnicas. </p><br><p>  No entanto, eu gosto desse recurso, e também está lá.  Para o modo noturno, precisamos desta <a href="https://github.com/minus7/redshift">bifurcação do redshift</a> com suporte para o protocolo específico de oscilação. </p><br><p>  Nós o instalamos de qualquer maneira, na configuração <code>~/.config/redshift/redshift.conf</code> , selecione o protocolo desejado e especifique a longitude e latitude. </p><br><pre> <code class="plaintext hljs">[redshift] location-provider=manual adjustment-method=wayland [manual] lat=xx.xx lon=yy.yy</code> </pre> <br><h2 id="blokirovka-i-otklyuchenie-ekrana">  Bloqueio e tela desativada </h2><br><p>  Dois de outro caixão vêm em socorro aqui.  <code>swayidle</code> executa os comandos fornecidos em timeout se não houver atividade (ou vice-versa, sua aparência) e o <code>swaylock</code> bloqueia a tela e requer uma senha.  Você pode desligar a tela (ou todas as telas, se houver várias) </p><br><pre> <code class="plaintext hljs">swaymsg "output * dpms off"</code> </pre> <br><p>  Aqui está a aparência do daemon, bloqueando a tela após 300 segundos de inatividade e desativando-a após 600: </p><br><pre> <code class="plaintext hljs">swayidle -w \ timeout 300 'swaylock -f -c 000000' \ timeout 600 'swaymsg "output * dpms off"' \ resume 'swaymsg "output * dpms on"' \ before-sleep 'swaylock -f -c 000000'</code> </pre> <br><p>  Execute-o de qualquer maneira. </p><br><h2 id="i3blocks">  i3blocks </h2><br><p>  Blocos prontos com calendário, rede, status do disco etc.  etc.  pode ser emprestado do repositório <a href="https://github.com/vivien/i3blocks-contrib">i3blocks-contrib</a> .  Nos i3blocks, eles são adicionados na configuração em <code>~/.config/i3blocks/config</code> .  Por exemplo, um bloco com atualizações a cada 5 segundos pelo dia da semana, data e hora: </p><br><pre> <code class="plaintext hljs">[time] command=date +"%a %d/%m %H:%M" interval=5</code> </pre> <br><p>  Mas este era um exemplo muito simples.  De fato, os entusiastas do i3 e do sway têm um santo graal: exibir a barra de título da janela atual na barra superior.  Vamos descobrir como conseguir isso. </p><br><p>  Primeiro de tudo, começamos a ler <code>man sway-ipc</code> e descobrimos que você pode se inscrever em eventos lá.  O necessário possui o código <code>0x80000003. WINDOW</code>  <code>0x80000003. WINDOW</code> e retorna objetos json dessa estrutura: </p><br><pre> <code class="plaintext hljs">{ "change" : "focus | title | ...", "container": { focused: true | false, name: "...", ... } }</code> </pre> <br><p>  De fato, ou a própria janela pode mudar seu título ( <code>change == title</code> ), ou podemos mover o foco para outra janela ( <code>change == focus</code> ).  No entanto, a janela pode alterar o título e ficar fora de foco.  Para filtrar esses eventos, devemos verificar a propriedade <code>container.focused</code> . </p><br><p>  Você pode descrever toda essa lógica no Python ou no Go, mas existe uma maneira melhor.  <code>swaymsg</code> facilita a inscrição nos eventos desejados e a saída deles para o stdout: </p><br><pre> <code class="plaintext hljs">$ swaymsg -m -t SUBSCRIBE "['window']"</code> </pre> <br><p>  e processaremos o json resultante em <code>jq</code> .  Sem entrar nas sutilezas da sintaxe de consulta deste maravilhoso utilitário, eis o resultado: </p><br><pre> <code class="bash hljs">$ query=<span class="hljs-string"><span class="hljs-string">'select(.change == "focus" or (.change == "title" and .container.focused)) | .container.name'</span></span> $ swaymsg -m -t SUBSCRIBE <span class="hljs-string"><span class="hljs-string">"['window']"</span></span> | jq --unbuffered -r <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$query</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br><p>  Um script de duas linhas no bash, e não mais código!  O sinalizador <code>--unbuffered</code> necessário; caso contrário, o i3blocks não receberá novas linhas imediatamente, mas somente quando o buffer for limpo. </p><br><p>  Por fim, adicione o seguinte bloco à configuração do i3blocks: </p><br><pre> <code class="plaintext hljs">[active_window] command=/path/to/our/script.sh interval=persist</code> </pre> <br><p>  Lição de casa: ensine sombrio a tirar uma captura de tela da janela atual.  Eles dizem que essas coisas são impossíveis em Wayland, mas os homens duvidam disso. </p><br><p>  Trabalho de casa 2: Ensine os i3blocks a exibir o layout atual do teclado como uma bandeira.  Existem alguns blocos no i3blocks-contrib, mas eles mostram texto em vez de uma bandeira e não funcionam em Wayland. </p><br><h2 id="prochie-programmy">  Outros programas </h2><br><p>  <a href="https://github.com/bugaevc/wl-clipboard">O wl-clipboard</a> permite que você trabalhe com a área de transferência do terminal, ou seja, ela substitui o xclip e o xsel.  É especialmente útil para usuários do vim, nos quais copiar / colar começa a usar <code>"+y</code> / <code>"+p</code> (basta instalar este pacote, nenhuma configuração adicional é necessária). </p><br><p>  <a href="https://github.com/ReimuNotMoe/ydotool">ydotool</a> - substituição do xdotool. </p><br><p>  <a href="https://gitlab.freedesktop.org/mstoeckl/waypipe/">waypipe</a> - proxy para a transparência da rede.  Para ser sincero, não me lembro da última vez que alguém fez uma pergunta relacionada a esse recurso em fóruns especializados.  Talvez eles não usem nada?  Eu - definitivamente não. </p><br><p>  KDE Connect  Adicione o arquivo <code>org.kde.kdeconnect.nonplasma.desktop</code> à <code>org.kde.kdeconnect.nonplasma.desktop</code> (consulte as seções anteriores), instale o KDE Connect no seu smartphone e configure sua conexão - e você pode controlar a reprodução de música e vídeo do seu smartphone em um navegador com o plug <a href="https://addons.mozilla.org/ru/firefox/addon/plasma-integration/">-</a> in de <a href="https://addons.mozilla.org/ru/firefox/addon/plasma-integration/">integração de plasma</a> , no vlc , no cantata, no mpv com <a href="https://github.com/hoyon/mpv-mpris">o plug-in mpv-mpris</a> e também receba notificações no mako.  Meu respeito pelo projeto KDE pelo desenvolvimento de programas que não foram acertados em seus ecossistemas. </p><br><h1 id="zaklyuchenie">  Conclusão </h1><br><p>  Você pode escrever sobre como configurar tudo isso (especialmente o painel i3blocks) sem parar, mas é melhor parar por aqui.  Aqui está o que eu tenho: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/s9/qy/q0/s9qyq0rrpk9rzv4bamj1qsooceq.png"></a> </p><br><p>  <a href="https://www.reddit.com/r/unixporn/">Acesse</a> também o subreddit <a href="https://www.reddit.com/r/unixporn/">/ r / unixporn</a> e maravilhe-se com o que as pessoas estão fazendo.  (no entanto, 95% de tudo o que é apresentado lá parece bonito, mas categoricamente não é adequado para o trabalho diário :)). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484378/">https://habr.com/ru/post/pt484378/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484368/index.html">Como eu fiz um mecanismo de pesquisa para o Telegram</a></li>
<li><a href="../pt484370/index.html">Slurm SRE - aprenda a garantir a felicidade do usuário</a></li>
<li><a href="../pt484372/index.html">Casa inteligente com Xiaomi no exemplo de uma sauna</a></li>
<li><a href="../pt484374/index.html">Viagem ao centro ... imagem do docker. Ou como baixar uma imagem do registro sem janela de encaixe</a></li>
<li><a href="../pt484376/index.html">Samsung Moscow Center for Artificial Intelligence nas histórias de funcionários</a></li>
<li><a href="../pt484382/index.html">Algoritmo de Bellman-Ford</a></li>
<li><a href="../pt484386/index.html">Meetup sobre AWS_Ru em Raiffeisenbank</a></li>
<li><a href="../pt484388/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../pt484390/index.html">Glean Insights sobre as 18 melhores estruturas Java a serem usadas em 2020</a></li>
<li><a href="../pt484392/index.html">Convulsões</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>