<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✋🏽 🙉 🖖🏻 Lektion zur Optimierung von Webanwendungsservern 👩🏽‍🏭 ⏩ 👨🏿‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Mein Name ist Alexey Pristavko, ich bin der Direktor für Webprojekte bei DataLine. In meinem heutigen Artikel geht es darum, wie Sie Probl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lektion zur Optimierung von Webanwendungsservern</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/414515/"><img src="https://habrastorage.org/getpro/habr/post_images/a96/4bf/146/a964bf1461da7bcce74ab62b242aa133.png"><br><br>  Hallo Habr!  Mein Name ist Alexey Pristavko, ich bin der Direktor für Webprojekte bei DataLine.  In meinem heutigen Artikel geht es darum, wie Sie Probleme mit der Backend-Leistung von Webanwendungen beheben oder verhindern können. <br><br>  Dies konzentriert sich auf die Optimierung von Webanwendungen, die unter chronischen Problemen mit Skalierbarkeit, Leistung oder Zuverlässigkeit leiden. <br>  Interessierte - willkommen unter dem Schnitt! <br><a name="habracut"></a><br><h2>  Terminologie </h2><br>  Beginnen wir mit einem Blick auf die Terminologie.  Wenn ich über die Leistung von Webprojekten oder Websystemen spreche, meine ich hauptsächlich das Back-End und die Serverkomponente.  Was beim Laden von Seiten in einen Browser passiert, ist eine völlig andere Geschichte, die höchstwahrscheinlich einem separaten Artikel gewidmet sein wird. <br><br><ul><li>  Das Maß <b>für die</b> Anwendungsleistung ist die Anzahl der verarbeiteten Anforderungen pro Sekunde (RPS) und deren Ausführungsgeschwindigkeit (TTFB - Time to First Byte). <br></li><li>  Dementsprechend meinen wir unter Systemskalierbarkeit einen Pool von Möglichkeiten zur Erhöhung des RPS. <br></li></ul><br>  Nun zur Zuverlässigkeit.  Hier müssen zwei Konzepte getrennt werden: Fehlertoleranz und Katastrophenschutz. <br><br><ul><li> <b>Ausfallsicherheit</b> - Die Fähigkeit eines Systems <b>zum Ausfall,</b> wenn ein oder mehrere Server <b>nicht</b> innerhalb der erforderlichen Parameter weiterarbeiten. <br></li><li>  Systeme mit vollständiger Backup-Redundanz (die sogenannte zweite Schulter), die ohne starken Verlust arbeiten können, wenn eines der Rechenzentren vollständig ausfällt, gelten als <b>katastrophenresistent</b> . <br></li></ul><br>  <b>Gleichzeitig ist ein katastrophtolerantes System ein ausfallsicheres System.</b>  Eine Situation, in der ein katastrophenresistentes, aber nicht fehlertolerantes System weiterhin nur an einer „Schulter“ arbeitet, ist ganz normal.  Wenn jedoch einer der Server ausfällt, fällt auch das System aus. <br><br>  Nachdem wir die Schlüsselkonzepte herausgefunden und die aktuelle Terminologie aktualisiert haben, ist es an der Zeit, direkt zu den Grundlagen der Optimierung und der Life-Hacks überzugehen. <br><br><h2>  Wo soll ich mit der Optimierung beginnen? </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/1e9/7ed/adf/1e97edadf840f697e8a995e8a53d7269.png"><br><br>  Wie kann man verstehen, wo man mit der Optimierung beginnen soll?  Atmen Sie tief ein und recherchieren Sie die Anwendung, bevor Sie sich auf die Optimierung beeilen. <br><br>  Stellen Sie sicher, dass Sie ein detailliertes Diagramm zeichnen.  Zeigen Sie darauf alle Komponenten der Anwendung und ihre Beziehungen an.  Nachdem Sie dieses Schema untersucht haben, können Sie zuvor unauffällige Schwachstellen und potenzielle Fehlerquellen entdecken. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/996/3fb/b5a/9963fbb5a9be1336886b708fb4d071e2.png"><br><br><h3>  „Was?  Wo?  Wann? "  - Abfragen optimieren </h3><br>  Achten Sie besonders auf synchrone Anfragen.  Ich möchte Sie daran erinnern, dass dies solche Anfragen sind, wenn wir eine Anfrage im selben Thread senden und auf eine Antwort darauf warten.  Hier liegen die Gründe für die schweren Bremsen, wenn auf der anderen Seite etwas schief geht.  Wenn Sie daher die Anzahl der synchronen Anforderungen reduzieren oder durch asynchrone ersetzen können, tun Sie dies. <br><br>  Hier sind einige Tricks, mit denen Sie Ihre Anfragen verfolgen können: <br><br><ul><li>  <b>Weisen Sie jeder eingehenden Anforderung eine eindeutige Kennung zu.</b>  Nginx hat hierfür eine eingebaute Variable $ request_id.  Übergeben Sie die Kennung in den Headern des Backends und schreiben Sie in alle Protokolle.  So können Sie Anfragen bequem verfolgen. </li><li>  <b>Protokollieren Sie nicht nur das Ende der Anforderung in der externen Komponente, sondern auch deren Anfang.</b>  Sie messen also die tatsächliche Dauer des externen Anrufs.  Es kann sich erheblich von dem unterscheiden, was Sie auf dem Remote-System sehen, beispielsweise aufgrund von Netzwerkproblemen oder DNS-Bremsen. </li></ul><br>  So werden die Daten gesammelt.  Lassen Sie uns nun die Problempunkte analysieren.  Definieren Sie: <br><br><ul><li>  Wo wird die meiste Zeit verbracht? </li><li>  Woher kommen die meisten Anfragen? </li><li>  Woher kommen die längsten Anfragen? </li></ul><br>  Als Ergebnis erhalten Sie eine Liste der interessantesten Abschnitte des Systems zur Optimierung. <br><br><blockquote>  <b>Tipp:</b> Wenn ein Punkt viele kleine Abfragen "sammelt", versuchen Sie, sie zu einer großen Abfrage zu kombinieren, um den Overhead zu verringern.  Die Ergebnisse langer Abfragen sind im Cache häufig sinnvoll. </blockquote><br><h3>  Wir cachen mit Bedacht </h3><br>  Es gibt allgemeine Caching-Regeln, auf die Sie sich bei der Optimierung verlassen sollten: <br><br><ul><li>  <b>Je näher der Cache am Verbraucher liegt, desto schneller ist der Job.</b>  Für die Anwendung ist RAM der nächstgelegene Ort.  Für den Benutzer seinen Browser. </li><li>  <b>Das Caching beschleunigt die Datenerfassung und reduziert die Belastung der Quelle.</b> </li></ul><br>  Wenn zehn Webserver dieselben Datenbankabfragen durchführen, führt ein zentraler Zwischencache, beispielsweise in Redis, zu einem höheren Prozentsatz an Treffern (im Vergleich zum lokalen Cache) und verringert die Gesamtlast der Datenbank, wodurch das Gesamtbild erheblich verbessert wird. <br><br><blockquote>  <b>Tipp 1:</b> Führen Sie das Zwischenspeichern von Komponenten der fertigen Seite auf der Nginx-Seite mit Edge Side Includes durch.  Es passt gut zur Microservice / SOA-Architektur und entlastet das gesamte System, wodurch die Reaktionsgeschwindigkeit erheblich verbessert wird. <br><br>  <b>Tipp 2:</b> Verfolgen Sie die Größe der Objekte im Cache, die Trefferquote und das Schreib- / Lesevolumen.  Je größer das Objekt ist, desto länger dauert die Verarbeitung.  Wenn Sie öfter oder öfter in den Cache schreiben als Sie lesen, ist ein solcher Cache nicht Ihr Freund.  Es lohnt sich entweder zu entfernen oder darüber nachzudenken, die Wirksamkeit zu erhöhen. <br><br>  <b>Tipp 3:</b> Verwenden Sie nach Möglichkeit Ihre eigenen Datenbank-Caches.  Die richtige Konfiguration kann die Arbeit beschleunigen. </blockquote><br><h3>  Profile laden </h3><br>  Wir gehen zum Laden von Profilen über.  Wie Sie wissen, gibt es zwei Haupttypen: OLAP und OLTP. <br><br><ul><li>  <b>Für OLAP</b> (Online Analytical Processing) ist der pro Sekunde ausgegebene Datenverkehr wichtig. <br></li><li>  <b>Bei OLTP</b> (Online Transaction Processing) ist der Schlüsselindikator die Antwortgeschwindigkeit und das Millisekunden-Timing. <br></li></ul><br>  In den meisten Fällen ist es effektiv, diese beiden Lasttypen zu trennen.  Zumindest müssen Sie die Datenbank und möglicherweise andere Komponenten des Systems separat optimieren. <br><br><blockquote>  <b>Tipp:</b> Leseanforderungen aus dem Admin-Bereich werden normalerweise mit dem OLAP-Typ verarbeitet.  Erstellen Sie für diese Aufgabe eine separate Kopie der Datenbank und einen Webserver, um das Hauptsystem auszulagern. </blockquote><h3>  Datenbanken </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/753/b35/7df/753b357df47b173bb57ab2de92e02e58.png"><br><br>  Wir näherten uns natürlich einer der schwierigsten Phasen der Optimierung - der Datenbankoptimierung. <br><br>  Ich möchte Sie an die allgemeine Regel erinnern: Je kleiner die Datenbank, desto schneller funktioniert sie.  Die Organisation der Datenbank ist entscheidend für die Geschwindigkeit. <br><br>  Speichern Sie nach Möglichkeit <b>historische Daten</b> , Anwendungsprotokolle und <b>häufig verwendete</b> Daten in verschiedenen Datenbanken.  Besser noch, poste sie auf verschiedenen Servern.  Dies erleichtert nicht nur die Lebensdauer der Hauptdatenbank, sondern bietet auch mehr Platz für weitere Optimierungen. In einigen Fällen können beispielsweise unterschiedliche Indizes für unterschiedliche Lasten verwendet werden.  Außerdem vereinfacht die „Einheitlichkeit“ der Last die Lebensdauer des Schedulers und des Abfrageoptimierers des Datenbankservers. <br><br><h3>  Und noch einmal über die Bedeutung der Planung </h3><br>  Um nicht über Optimierungen zu rätseln, die nicht wirklich benötigt werden, wählen Sie die Hardware basierend auf den Aufgaben. <br><br><ul><li>  Für kleine, aber häufige Anfragen ist es besser, mehr Prozessorkerne zu verwenden. </li><li>  Für schwere Anfragen - weniger Kerne mit höherer Taktrate. </li></ul><br>  Versuchen Sie, das Arbeitsvolumen der Datenbank in den Arbeitsspeicher zu stellen.  Wenn dies nicht möglich ist oder eine große Anzahl von Schreibanforderungen vorliegt, ist es an der Zeit, die Datenbanken auf SSDs zu übertragen.  Sie erhöhen die Arbeitsgeschwindigkeit mit der Festplatte erheblich. <br><br><h2>  Skalieren </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/54b/df1/be6/54bdf1be69c1d596c882fc2d04d5c11c.png"><br><br>  Oben habe ich die wichtigsten Mechanismen zur Verbesserung der Anwendungsleistung beschrieben, ohne die physischen Ressourcen zu erhöhen. <br><br>  Jetzt werden wir darüber sprechen, wie Sie eine Skalierungsstrategie auswählen und die Ausfallsicherheit erhöhen. <br><br>  Es gibt zwei Arten der Systemskalierung: <br><br><ul><li>  <b>vertikal</b> - das Wachstum der Ressourcen unter Beibehaltung der Anzahl der Einheiten; <br></li><li>  <b>horizontal</b> - eine Zunahme der Anzahl von Entitäten. <br></li></ul><br><h3>  Wachsen Sie groß </h3><br>  Beginnen wir mit der Auswahl einer vertikalen Skalierungsstrategie. <br><br>  Betrachten Sie zunächst die <b>Erhöhung der Systemleistung</b> .  Wenn Ihr System auf einem Server funktioniert, müssen Sie wählen, ob Sie die Kapazität des aktuellen Servers erhöhen oder einen anderen kaufen möchten. <br><br>  Es scheint, dass die erste Option einfacher und sicherer ist.  Es wird jedoch weitsichtiger sein, einen weiteren Server zu kaufen und eine große Fehlertoleranz als Bonus für die Produktivität zu erhalten.  Ich habe am Anfang des Artikels darüber gesprochen. <br><br>  Wenn Ihr System über mehrere Server verfügt und Sie die Kapazität bestehender Server erhöhen oder weitere kaufen möchten, achten Sie auf die finanzielle Seite.  Beispielsweise kann ein leistungsfähiger Server teurer sein als zwei um 50% „schwächere“.  Daher ist es sinnvoll, auf die zweite Kompromissoption einzugehen.  Gleichzeitig ist bei einer großen Anzahl von Servern das Verhältnis von Leistung, Stromverbrauch und Kosten eines vollständigen Racks entscheidend. <br><br><h3>  Wachsen Sie weit </h3><br>  Bei der horizontalen Skalierung geht es um Fehlertoleranz und Clustering.  Im allgemeinen Fall ist die Fehlertoleranz der gesamten Lösung umso höher, je mehr Instanzen einer Entität vorhanden sind. <br><br>  Wahrscheinlich möchten Sie als erstes <b>Anwendungsserver</b> skalieren.  Das erste Hindernis hierfür ist die Organisation der Arbeit mit zentralisierten Datenquellen.  Neben Datenbanken sind dies auch Sitzungsdaten und statische Inhalte.  Folgendes empfehle ich Ihnen: <br><br><ul><li>  Verwenden Sie <b>zum Speichern von Sitzungen</b> Couchbase, nicht das übliche Memcached, da es mit demselben Protokoll arbeitet, aber im Gegensatz zu memcached Clustering unterstützt. <br></li><li>  <b>Alle statischen Daten</b> , insbesondere große Mengen an Bildern und Dokumenten, werden separat gespeichert und mit Nginx und nicht aus dem Anwendungscode bereitgestellt.  Dies spart Geld bei den Flows und vereinfacht das Infrastrukturmanagement. <br></li></ul><br><h3>  Datenbank "aufrufen" </h3><br>  Datenbanken sind schwer zu skalieren.  Hierfür gibt es zwei Haupttechniken: Sharding und Replikation.  Betrachten Sie sie. <br><br>  Während der <b>Replikation</b> fügen wir dem System vollständig identische Kopien der Datenbank hinzu, während wir logisch getrennte Teile und Shards teilen.  Gleichzeitig ist es äußerst wünschenswert, das Sharding parallel zur Replikation (Replikation) jedes Shards durchzuführen, um die Fehlertoleranz nicht zu verlieren. <br><br><blockquote>  <b>Denken Sie daran:</b> Oft besteht ein Datenbankcluster aus einem Masterknoten, der den Schreibstrom übernimmt, und mehreren Slaveknoten, die zum Lesen verwendet werden.  Unter dem Gesichtspunkt der Fehlertoleranz ist dies etwas besser als bei einem einzelnen Server, da die Gesamtfehlertoleranz durch das am wenigsten stabile Element des Systems bestimmt wird. </blockquote><br>  Schemata mit mehr als zwei Datenbankassistenten (Ringtopologie) ohne Bestätigung des Datensatzes auf jedem Server leiden sehr häufig unter Inkonsistenzen.  Bei einem Ausfall eines der Server ist es äußerst schwierig, die logische Integrität der Daten im Cluster wiederherzustellen. <br><br><blockquote>  <b>Tipp:</b> Wenn es in Ihrem Fall nicht sinnvoll ist, mehrere Master-Server zu haben, sollten Sie die architektonische Möglichkeit in Betracht ziehen, dass das System mindestens eine Stunde lang ohne Master arbeitet.  Im Falle eines Unfalls haben Sie Zeit, den Server ohne Ausfallzeiten des gesamten Systems auszutauschen. <br><br>  <b>Tipp:</b> Wenn Sie mehr als 2 Datenbankmaster behalten müssen, empfehlen wir Ihnen, NoSQL-Lösungen in Betracht zu ziehen, da viele von ihnen über integrierte Mechanismen verfügen, um Daten in einen konsistenten Zustand zu bringen. </blockquote><br>  Vergessen Sie beim Streben nach Fehlertoleranz auf keinen Fall, dass die Replikation Sie <b>nur gegen physische Serverausfälle</b> versichert.  Es wird nicht vor einer Beschädigung der logischen Daten aufgrund eines Benutzerfehlers gespeichert. <br><br><blockquote>  <b>Denken Sie daran:</b> Alle wichtigen Daten müssen gesichert und als unabhängige, nicht bearbeitbare Kopie gespeichert werden. </blockquote><br><h2>  Anstelle einer Schlussfolgerung </h2><br>  Zum Schluss noch ein paar Leistungstipps zum Sichern: <br><br><blockquote>  <b>Tipp 1:</b> Ziehen Sie Daten aus einem separaten Datenbankreplikat, damit der aktive Server nicht überlastet wird. <br><br>  <b>Tipp 2:</b> Halten Sie eine zusätzliche, leicht "verzögerte" zeitliche Nachbildung der Datenbank bereit.  Im Falle eines Unfalls wird dies dazu beitragen, die Menge der verlorenen Daten zu reduzieren. </blockquote><br>  Die in diesem Artikel vorgestellten Methoden und Techniken sollten niemals blind angewendet werden, ohne die aktuelle Situation zu analysieren und zu verstehen, was Sie erreichen möchten.  Möglicherweise tritt eine "Überoptimierung" auf, und das resultierende System ist nur 10% schneller, aber 50% anfälliger für Unfälle. <br><br>  Das ist alles  Wenn Sie Fragen haben, beantworte ich diese gerne in den Kommentaren. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de414515/">https://habr.com/ru/post/de414515/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de414503/index.html">Intel NUC Hades Canyon mit AMD Vega Graphics - VR oder nicht VR?</a></li>
<li><a href="../de414505/index.html">MIT-Kurs "Computer Systems Security". Vorlesung 2: „Kontrolle von Hackerangriffen“, Teil 1</a></li>
<li><a href="../de414507/index.html">Wie sich die beliebteste programmierbare Tastatur für den Handel verändert hat: die Geschichte der Bloomberg-Tastatur</a></li>
<li><a href="../de414509/index.html">Wir verbinden jeden (fast) GPS-Tracker (am Beispiel des Sinotrack ST-901) mit dem HomeAssistant Smart Home</a></li>
<li><a href="../de414513/index.html">27 großartige Open Source-Webentwicklungstools</a></li>
<li><a href="../de414517/index.html">Oxford-Wissenschaftler: Die Wahrscheinlichkeit, dass wir im vorhersehbaren Teil des Universums allein sind, ist viel höher als Null</a></li>
<li><a href="../de414519/index.html">Wie kann man 15 Minuten Scrum-Meetings in ein volles Haus verwandeln?</a></li>
<li><a href="../de414523/index.html">Vergleich der Quadcopter DJI Mavic Pro und Mavic Air</a></li>
<li><a href="../de414525/index.html">Das Buch „Effective Spark. Skalierung und Optimierung "</a></li>
<li><a href="../de414527/index.html">Was uns auf Highload ++ Sibirien erwartet, außer auf bemalten Bären</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>