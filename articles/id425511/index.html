<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😶 🌄 🙅🏼 Fitur-fitur aplikasi Rotativa yang tidak jelas untuk menghasilkan PDF dalam aplikasi ASP.NET MVC 🖇️ 🙍🏼 🕔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Banyak pengembang dihadapkan dengan tugas membuat laporan PDF untuk aplikasi web, permintaan yang sepenuhnya alami. Saya ingin menarik perhatian Anda ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fitur-fitur aplikasi Rotativa yang tidak jelas untuk menghasilkan PDF dalam aplikasi ASP.NET MVC</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425511/"><p>  Banyak pengembang dihadapkan dengan tugas membuat laporan PDF untuk aplikasi web, permintaan yang sepenuhnya alami.  Saya ingin menarik perhatian Anda pengalaman saya dengan tugas seperti itu ketika menggunakan perpustakaan Rotativa untuk menghasilkan laporan.  Ini adalah salah satu yang paling, menurut pendapat saya, perpustakaan yang nyaman untuk tujuan seperti itu di segmennya, tetapi ketika menggunakannya saya menemukan beberapa poin yang tidak jelas yang ingin saya bicarakan. </p><a name="habracut"></a><br><p>  Sejujurnya, saya ingin berbagi set garu yang saya tuju dalam proses mengintegrasikan perpustakaan ini, tanpa ragu cepat dan sangat nyaman. </p><br><p> Dalam artikel ini saya tidak akan membahas masalah memilih perpustakaan.  Setiap orang dapat memiliki alasan sendiri untuk menggunakan ini atau itu.  Saya memilih Rotativa, karena dengan biaya pemasangan minimal, semua yang diperlukan untuk memenuhi kebutuhan pelanggan.  Selain dia, saya mencoba tiga atau empat opsi lagi. </p><br><h3 id="postanovka-zadachi">  Pernyataan masalah </h3><br><p>  Aplikasi web pada ASP.NET MVC, .NET versi 4.6.  Fitur lain tidak relevan dalam konteks ini, dengan pengecualian penyebaran.  Penempatan diharapkan berlangsung di Azure.  Ini penting karena beberapa perpustakaan lain (mis. HiQPdf) tidak mentransfer instalasi dalam konfigurasi Azure tertentu, ini didokumentasikan. </p><br><p>  Saya perlu membuka laporan HTML statis tertentu dengan satu tautan, dan versi PDF dari laporan yang sama dengan tautan kedua.  Laporan itu sendiri hanyalah seperangkat beberapa tabel, bidang dan grafik untuk demonstrasi kepada pengguna.  Kedua versi memerlukan menu dengan navigasi melalui bagian-bagian laporan, keberadaan tabel, beberapa gambar (warna, ukuran teks, batas). </p><br><h3 id="primenenie-biblioteki-rotativa">  Menggunakan Perpustakaan Rotativa </h3><br><p>  Menurut saya, Rotativa semudah mungkin diterapkan. </p><br><ol><li>  Anda sudah memiliki laporan HTML siap pakai dalam bentuk templat dan controller ASP.NET MVC, seperti ini: </li></ol><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HttpGet</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;ActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> param1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> param2</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> model = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> service.GetReportDataAsync(param1, param2); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(model); }</code> </pre> <br><ol><li><p>  Instal paket Rotugva nuget </p><br></li><li><p>  Tambahkan pengontrol baru untuk laporan PDF </p><br></li></ol><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HttpGet</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;ActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pdf</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> param1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> param2</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> model = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> service.GetReportDataAsync(param1, param2); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewAsPdf(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>, model); }</code> </pre> <br><p>  Pada dasarnya mulai sekarang, Anda memiliki PDF yang dikembalikan sebagai file yang berisi semua data dari laporan HTML asli. </p><br><p>  <em>Saya tidak menjelaskan perutean di sini, tetapi dipahami bahwa Anda telah mengkonfigurasi rute untuk memanggil kedua pengontrol dengan benar</em> </p><br><p>  Menariknya, perpustakaan ini sendiri pada dasarnya adalah pembungkus atas utilitas konsol terkenal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">wkhtmltopdf</a> .  Kecepatan bekerja di ketinggian, Anda bisa bertaruh pada Azure - akan bekerja.  Tetapi ada fitur yang akan kita bicarakan. </p><br><h3 id="page-number">  Nomor Halaman </h3><br><p>  Adalah logis untuk berasumsi bahwa pelanggan akan mencetak PDF dan ingin melihat nomor halaman.  Semuanya sangat sederhana di sini, terima kasih kepada pencipta Rotativa. </p><br><p>  Menurut dokumentasi Rotativa, melalui parameter <code>CustomSwitches</code> , <code>CustomSwitches</code> dapat menentukan argumen yang akan diteruskan ke utilitas <code>wkhtmltopdf</code> .  Nah, tips online banyak sekali dengan contoh.  Panggilan berikut menambahkan nomor di bagian bawah setiap halaman: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewAsPdf(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>, model) { PageMargins = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rotativa.Options.Margins(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), PageSize = Rotativa.Options.Size.A4, PageOrientation = Rotativa.Options.Orientation.Portrait, CustomSwitches = <span class="hljs-string"><span class="hljs-string">"--page-offset 0 --footer-center [page] --footer-font-size 8 };</span></span></code> </pre> <br><p>  Ini bekerja dengan baik.  Nomor halaman itu sendiri dilewatkan menggunakan parameter <code>[page]</code> , parameter semacam ini akan diganti dengan nilai tertentu. </p><br><blockquote>  Selain <code>[page]</code> ada yang lain: <br><ul><li>  [halaman] Digantikan dengan jumlah halaman yang sedang dicetak </li><li>  [frompage] Diganti dengan nomor halaman pertama yang akan dicetak </li><li>  [topage] Diganti dengan nomor halaman terakhir yang akan dicetak </li><li>  [halaman web] Digantikan oleh URL halaman yang sedang dicetak </li><li>  [bagian] Digantikan dengan nama bagian saat ini </li><li>  [ayat] Digantikan dengan nama ayat saat ini </li><li>  [date] Digantikan oleh tanggal saat ini dalam format lokal sistem </li><li>  [isodate] Digantikan oleh tanggal saat ini dalam format diperpanjang ISO 8601 </li><li>  [waktu] Diganti oleh waktu saat ini dalam format lokal sistem </li><li>  [title] Digantikan dengan judul objek halaman saat ini </li><li>  [doctitle] Digantikan oleh judul dokumen keluaran </li><li>  [sitepage] Digantikan oleh jumlah halaman di situs saat ini sedang dikonversi </li><li>  [sitepages] Digantikan oleh jumlah halaman di situs saat ini sedang dikonversi </li></ul><br></blockquote><br><h3 id="table-of-content">  Daftar isi </h3><br><p>  Laporan multi-halaman besar membutuhkan konten PDF dan navigasi halaman.  Ini sangat mudah dan sangat penting ketika jumlah halaman dalam laporan melebihi seratus. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Manual wkhtmltopdf</a> berisi daftar lengkap semua opsi, di antaranya adalah <code>--toc</code> .  Melihat parameter ini, utilitas pada dasarnya mengumpulkan semua tag <code>&lt;h1&gt;, &lt;h2&gt;, ... &lt;h6&gt;</code> dalam dokumen dan menghasilkan daftar isi berdasarkan pada mereka.  Oleh karena itu, perlu untuk menyediakan penggunaan tag header ini dengan benar dalam template HTML Anda. </p><br><p>  Namun pada kenyataannya, menambahkan <code>--toc</code> tidak menyebabkan konsekuensi apa pun.  Seolah tidak ada parameter.  Namun, opsi lain berfungsi.  Berkat posting di beberapa forum, saya menemukan bahwa parameter ini harus dilewatkan tanpa tanda hubung: <code>toc</code> .  Memang, dalam hal ini, konten ditambahkan sebagai halaman pertama.  Ketika Anda mengklik pada baris dalam konten, Anda pergi ke halaman yang diinginkan dalam dokumen, nomor halaman sudah benar. </p><br><p>  Belum sepenuhnya jelas cara mengatur gaya, tapi saya belum melakukannya. </p><br><h3 id="javascript-execution">  Eksekusi Javascript </h3><br><p>  Poin berikutnya yang saya temui adalah kebutuhan untuk menambahkan grafik ke dalam laporan.  Halaman HTML saya berisi kode JS yang menambahkan gambar menggunakan perpustakaan <code>dc.js</code>  Berikut ini sebuah contoh: </p><br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initChart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderChart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Html.Raw(Json.Encode(Model.Chart_1_Data)</span></span></span><span class="hljs-function">), '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chartDiv_1</span></span></span><span class="hljs-function">'); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderChart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data, chartElementId)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">colors</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">['#03a9f4', '#67daff', '#8bc34a']</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">barHeight</span></span></span><span class="hljs-function"> = 45; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientHeight</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">barHeight</span></span></span><span class="hljs-function"> + 50; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clientWidth</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">document</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getElementById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chartId)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offsetWidth</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chart</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dc</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rowChart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('#' + chartElementId)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ndx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crossfilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dataToRender)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimension</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ndx</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d =&gt; d.name)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">group</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimension</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">group</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reduceSum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d =&gt; d.value)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chart</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(clientWidth)</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(clientHeight)</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">margins</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({ top: 16, right: 16, bottom: 16, left: 16 })</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ordinalColors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(colors)</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dimension)</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">group</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(group)</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xAxis</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scale</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d3.scaleLinear()</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">domain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([0, 2])</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([1, 3])</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chart</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; }</span></span></code> </pre> <br><p>  Pada saat yang sama, dalam HTML, saya memiliki elemen yang sesuai: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"chart_C2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dc-chart"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Agar kode ini berfungsi, Anda perlu mengimpor perpustakaan yang sesuai: <code>dc.js</code> , <code>d3.js</code> , <code>crossfilter.js</code> .  Panggilan ke fungsi <code>initChart</code> akan membuat grafik dan memasukkan hasilnya <br>  svg ke item yang ditentukan di pohon. </p><br><p>  Tetapi PDF tidak mengandung jejak grafik.  Serta jejak eksekusi kode JavaScript lainnya sebelum rendering PDF.  Memeriksa ini cukup mudah - cukup tambahkan kode dasar untuk membuat elemen <code>&lt;div&gt;</code> sederhana dengan teks, hanya untuk menguji fakta panggilan JavaScript. </p><br><p>  Secara empiris, ternyata lokasi kode JS untuk <code>wkhtmltopdf</code> memainkan peran penting.  Kode yang terletak di akhir <code>&lt;html&gt;</code> atau, katakanlah, di akhir <code>&lt;body&gt;</code> JS tidak akan dieksekusi.  Tampaknya utilitas itu tidak memperhatikannya, atau tidak berharap bertemu dengannya di sana. </p><br><p>  Tetapi kode di dalam <code>&lt;head&gt;</code> dijalankan.  Jadi, saya sampai pada skema ketika kode JavaScript terletak setelah deklarasi gaya di dalam <code>&lt;head&gt;</code> , dan dipanggil oleh konstruksi biasa: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"initCharts()"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Dalam hal ini, kode akan dieksekusi seperti yang diharapkan. </p><br><h3 id="javascript-limitations">  Keterbatasan JavaScript </h3><br><p>  Tapi tetap saja tidak ada grafik dalam output PDF.  Kemudian saya mulai menebak bahwa karena bukan peramban lengkap, rendering pdf dan mesin eksekusi kemungkinan besar tidak sempurna dan tidak mengerti aturan terakhir.  Sekali lagi, secara eksperimen, saya menemukan bahwa fungsi panah tidak dirasakan.  Selain itu, jika penerjemah menemukan sesuatu yang tidak dikenal untuknya, maka itu hanya berhenti bekerja. </p><br><p>  Mengganti fungsi panah dari form <code>x =&gt; x.value</code> dengan <code>function(x) { return x.value; }</code> lebih klasik <code>function(x) { return x.value; }</code>  <code>function(x) { return x.value; }</code> membantu dan semua kode dieksekusi, grafik yang dihasilkan masuk ke file PDF. </p><br><h3 id="chart-width">  Lebar bagan </h3><br><p>  Secara empiris, ternyata perlu menunjukkan dengan jelas lebar elemen induk grafik.  Untuk ini, saya menentukan gaya <code>dc-chart</code> .  Berisi lebar grafik dalam piksel.  Kalau tidak, bagan pada PDF akan sangat kecil, meskipun pada kenyataannya dalam versi HTML itu akan menempati seluruh lebar.  Menentukan lebar persentase hanya akan berfungsi untuk HTML. </p><br><h3 id="inline-javascript--css">  JavaScript sebaris / CSS </h3><br><p>  Sebagai kesimpulan, saya ingin mencatat bahwa banyak perpustakaan yang mengkonversi HTML ke PDF menerima baseUrl tertentu sebagai parameter.  Ini adalah URL yang akan digunakan konverter untuk menyelesaikan jalur relatif untuk menerima gaya CSS impor, file JavaScirpt, atau font.  Saya tidak bisa mengatakan dengan pasti bagaimana ini bekerja di Rotativa, tetapi saya datang dengan pendekatan yang berbeda. </p><br><p>  Untuk mempercepat pemuatan awal laporan dan menghilangkan sumber masalah saat menyematkan skrip atau file gaya selama konversi, saya menyematkan JS dan CSS yang diperlukan langsung ke badan template HTML. </p><br><p>  Untuk melakukan ini, buat bundel yang sesuai: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BundleConfig</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterBundles</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BundleCollection bundles</span></span></span><span class="hljs-function">)</span></span> { bundles.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StyleBundle(<span class="hljs-string"><span class="hljs-string">"~/Styles/report-html"</span></span>) .Include(<span class="hljs-string"><span class="hljs-string">"~/Styles/report-common.css"</span></span>) .Include(<span class="hljs-string"><span class="hljs-string">"~/Styles/report-html.css"</span></span>) ); bundles.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StyleBundle(<span class="hljs-string"><span class="hljs-string">"~/Styles/report-pdf"</span></span>) .Include(<span class="hljs-string"><span class="hljs-string">"~/Styles/report-common.css"</span></span>) .Include(<span class="hljs-string"><span class="hljs-string">"~/Styles/report-pdf.css"</span></span>) ); bundles.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScriptBundle(<span class="hljs-string"><span class="hljs-string">"~/Scripts/charts"</span></span>) .Include(<span class="hljs-string"><span class="hljs-string">"~/Scripts/d3/d3.js"</span></span>) .Include(<span class="hljs-string"><span class="hljs-string">"~/Scripts/crossfilter/crossfilter.js"</span></span>) .Include(<span class="hljs-string"><span class="hljs-string">"~/Scripts/dc/dc.js"</span></span>) ); } }</code> </pre> <br><p>  Tambahkan panggilan konfigurasi untuk bundel ini ke <code>Global.asax.cs</code> </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Application_Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... BundleConfig.RegisterBundles(BundleTable.Bundles); }</code> </pre> <br><p>  Dan tambahkan metode yang sesuai untuk menanamkan kode di halaman.  Itu perlu ditempatkan di namespace yang sama dengan <code>Global.asax.cs</code> sehingga metode ini dapat dipanggil dari templat HTML: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HtmlHelperExtensions</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IHtmlString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InlineStyles</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HtmlHelper htmlHelper, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bundleVirtualPath</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> bundleContent = LoadBundleContent(htmlHelper.ViewContext.HttpContext, bundleVirtualPath); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> htmlTag = <span class="hljs-string"><span class="hljs-string">$"&lt;style rel=\"stylesheet\" type=\"text/css\"&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{bundleContent}</span></span></span><span class="hljs-string">&lt;/style&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HtmlString(htmlTag); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IHtmlString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InlineScripts</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HtmlHelper htmlHelper, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bundleVirtualPath</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> bundleContent = LoadBundleContent(htmlHelper.ViewContext.HttpContext, bundleVirtualPath); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> htmlTag = <span class="hljs-string"><span class="hljs-string">$"&lt;script type=\"text/javascript\"&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{bundleContent}</span></span></span><span class="hljs-string">&lt;/script&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HtmlString(htmlTag); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadBundleContent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpContextBase httpContext, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bundleVirtualPath</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bundleContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BundleContext(httpContext, BundleTable.Bundles, bundleVirtualPath); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bundle = BundleTable.Bundles.Single(b =&gt; b.Path == bundleVirtualPath); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bundleResponse = bundle.GenerateBundleResponse(bundleContext); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bundleResponse.Content; } }</code> </pre> <br><p>  Nah, sentuhan terakhir adalah panggilan dari templat: </p><br><pre> <code class="html hljs xml">@Html.InlineStyles("~/Styles/report-pdf"); @Html.InlineScripts("~/Scripts/charts");</code> </pre> <br><p>  Akibatnya, semua CSS dan JavaScript yang diperlukan akan langsung dalam HTML, meskipun selama pengembangan Anda dapat bekerja dengan file individual. </p><br><p>  Kemungkinan besar, banyak orang akan langsung berpikir tentang ketidakefisienan pendekatan ini dalam hal permintaan caching oleh browser.  Tetapi saya memiliki dua tujuan khusus: </p><br><ul><li>  sehingga konverter PDF tidak harus membuat permintaan di suatu tempat untuk gaya atau kode, dan pengguna harus menunggu masing-masing; </li><li>  sehingga pengunduhan pertama laporan PDF dan HTML membutuhkan waktu minimal, tanpa perlu menunggu beberapa permintaan tambahan.  Dalam konteks proyek saya, ini penting; </li></ul><br><h3 id="page-breaks">  Istirahat halaman </h3><br><p>  Penataan laporan menjadi beberapa bagian dapat disertai dengan persyaratan untuk memulai bagian baru dari halaman baru.  Dalam hal ini, Anda dapat berhasil menggunakan pendekatan CSS sederhana: </p><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.page-break-before</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-before</span></span>: always; } <span class="hljs-selector-class"><span class="hljs-selector-class">.no-page-break-inside</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">page-break-before</span></span>: auto; <span class="hljs-attribute"><span class="hljs-attribute">page-break-inside</span></span>: avoid; }</code> </pre> <br><p>  Utilitas wkhtmltopdf berhasil membaca kelas-kelas ini dan memahami bahwa perlu untuk memulai halaman baru.  Kelas pertama - <code>page-break-before</code> - memberi tahu utilitas untuk selalu memulai halaman baru dengan elemen ini.  Kelas kedua - <code>no-page-break-inside</code> - harus diterapkan pada elemen-elemen yang diinginkan untuk selengkap mungkin pada halaman.  Misalnya, Anda memiliki blok informasi terstruktur berturut-turut, atau katakan tabel.  Jika dua blok cocok pada halaman - mereka akan ditemukan.  Jika yang ketiga tidak sesuai dengan halaman, itu tidak akan menjadi yang berikutnya.  Jika lebih besar dari satu halaman, maka transfernya sudah tidak terhindarkan.  Semua ini berfungsi dengan baik dan nyaman. </p><br><h3 id="flex-behavior-in-wkhtmltopdf">  Perilaku Flex di wkhtmltopdf </h3><br><p>  Nah, fitur terakhir yang saya perhatikan terkait dengan penggunaan gaya markup flexbox.  Kita semua menjadi terbiasa dengan mereka dan hampir semua markup dibuat oleh flexes.  Namun, wkhtmltopdf sedikit ketinggalan dalam hal ini.  Opsi flex horisontal tidak berfungsi (setidaknya dalam kasus saya ini tidak berhasil. Saya melihat di jaringan menyebutkan bahwa ada baiknya menduplikasi gaya flex sebagai berikut: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">display</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-webkit-flex</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">display</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">flex</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">flex-direction</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">row</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">-webkit-flex-direction</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">row</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">-webkit-box-pack</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">justify</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* wkhtmltopdf uses this one */</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-webkit-justify-content</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">space-between</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">justify-content</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">space-between</span></span>;</code> </pre> <br><p>  Namun sayangnya ini tidak mengarah pada markup yang diharapkan dalam PDF.  Saya harus mengulang tata letak beberapa elemen sehingga penempatan horisontal blok sesuai dengan persyaratan.  Jika ada yang punya pengalaman sukses mengintegrasikan flex untuk wkhtmltopdf, silakan bagikan.  Itu akan sangat membantu. </p><br><p>  Beberapa tautan: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">wkhtmltopdf</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">manual wkhtmltopdf</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Rotativa github</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Paket Rotativa</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Gaya Inline HowTo</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id425511/">https://habr.com/ru/post/id425511/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id425499/index.html">HyperX Impact DDR4 - SO-DIMM yang bisa! Atau mengapa di laptop memori 64 GB dengan frekuensi 3200 MHz?</a></li>
<li><a href="../id425501/index.html">Tes A / B di Android dari A hingga Z</a></li>
<li><a href="../id425503/index.html">Cassandra Sink untuk Streaming Terstruktur Spark</a></li>
<li><a href="../id425505/index.html">Analisis proses boot kernel Linux</a></li>
<li><a href="../id425507/index.html">Parsim Wikipedia untuk tugas NLP dalam 4 tim</a></li>
<li><a href="../id425515/index.html">Apple memblokir perbaikan independen model MacBook baru</a></li>
<li><a href="../id425517/index.html">Bagaimana Yandex membuat perkiraan curah hujan global menggunakan radar dan satelit</a></li>
<li><a href="../id425521/index.html">Metode yang Dilindungi dalam JavaScript ES5</a></li>
<li><a href="../id425525/index.html">Tim Berners-Lee melanjutkan perang: "Satu langkah kecil untuk web ..."</a></li>
<li><a href="../id425527/index.html">Daftar di Kotlin. Pendekatan Haskell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>