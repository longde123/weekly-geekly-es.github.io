<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòπ ‚ùóÔ∏è üìå Ein paar Worte zur tats√§chlichen Leistung des Hypervisors üí± üëõ üîì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Benutzer virtualisierter Systeme und insbesondere Dienstanbieter fragen sich sehr oft: "Wie kann die verf√ºgbare Hardware optimal genutzt werden?" In d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ein paar Worte zur tats√§chlichen Leistung des Hypervisors</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/virtuozzo/blog/413127/">  Benutzer virtualisierter Systeme und insbesondere Dienstanbieter fragen sich sehr oft: "Wie kann die verf√ºgbare Hardware optimal genutzt werden?"  In diesem Zusammenhang m√ºssen wir h√§ufig den KVM-Hypervisor und die Unterschiede zwischen verschiedenen Versionen von Virtuozzo diskutieren.  In diesem Beitrag werden wir √ºber eine Reihe von Tests des neuesten Virtualisierungssystems sprechen, zusammen mit Sch√§tzungen der tats√§chlichen Leistung unter typischen Belastungen sowie unter Ber√ºcksichtigung der Patches Meltdown und Spectre. <br><a name="habracut"></a><br>  Was ist f√ºr ein Hosting-Unternehmen oder eine IT-Abteilung am wichtigsten, die den Support f√ºr die maximale Anzahl von Aufgaben an vorhandenen Ger√§ten organisieren muss?  Wenn ein Unternehmen nach einem serviceorientierten Modell arbeitet oder Services verkauft, zeigt die Praxis, dass die Hauptsache der Gewinnindikator pro Server ist.  Welche Technologien gleichzeitig eingesetzt werden und aufgrund derer die Verteilungsdichte erreicht wird, sind die Unternehmensvertreter nicht so sehr besorgt. <br><br>  Die Frage, warum wir KVM in Virtuozzo 7 als Hypervisor verwenden und wie wir uns in diesem Fall von einem einfachen OpenSource-Virtualisierungssystem unterscheiden, wird jedoch sehr oft gestellt.  Und heute m√∂chte ich eine Antwort darauf geben. <br><br>  In der Vergangenheit arbeitete Virtuozzo mit einem eigenen Hypervisor, aber vor einigen Jahren haben wir festgestellt, dass die Entwicklung teurer und schwieriger ist als die Optimierung eines einigerma√üen erfolgreichen und effizienten KVM.  KVM ist jedoch kein Benchmark f√ºr die Leistung und muss wie jede OpenSource-Plattform mit einer Datei aktualisiert werden.  Dies ist Teil unserer Entwicklungsabteilung.  Wir optimieren den Code, integrieren ihn in die Datenspeicherplattform und andere Komponenten und erh√∂hen so die Produktivit√§t und Dichte. <br><br><h2>  Vergleich mit anderen Hypervisoren </h2><br>  Einer der Tests, mit denen wir die Leistung messen, ist der DVD Store.  Es verwendet eine klassische Reihe von Serversoftware: Linux, Apache, MySQL, PHP (LAMP).  In jeder virtuellen Maschine emuliert der Test den Betrieb eines Online-DVD-Speichers.  Das Ergebnis des Tests ist die Anzahl der insgesamt festgeschriebenen Transatale in allen virtuellen Maschinen (Ordinatenachse).  Die Anzahl der am Test beteiligten virtuellen Maschinen steigt nacheinander von 1 auf 100 (Abszissenachse). <br><br>  <b><i>LAMPE: OpenSource QEMU KVM gegen Virtuozzo @ CentOS 7.4 (virtuelle Maschinen)</i></b> <br><br><img src="https://habrastorage.org/webt/qi/4e/fl/qi4eflq23yuguz9ok6cmzg8raz8.jpeg">  Wie Sie in den obigen Grafiken sehen k√∂nnen, ist die Leistung von virtuellen Maschinen mit CentOS Linux 7.4, die auf dem Virtuozzo 7-Hypervisor ausgef√ºhrt werden, bis zu 30% h√∂her als beim Starten einer √§hnlichen Last auf der Standard-KVM.  Der gr√∂√üte Unterschied wird an dem Punkt des CPU-√úberschreibens beobachtet, an dem die Gesamtzahl der Prozessorkerne, die allen virtuellen Maschinen zugewiesen sind, die Anzahl der physischen Kerne des CPU-Servers erreicht.  F√ºr diesen Server entspricht dieser Punkt 20 virtuellen Maschinen.  Dar√ºber hinaus gew√§hrleisten der Virtuozzo 7-Kern und die adaptive Speicherverwaltungsrichtlinie einen stabilen Betrieb virtueller Maschinen nach dem RAM-Over-Commit-Punkt, an dem die allen virtuellen Maschinen zugewiesene Gesamtmenge an RAM die Gr√∂√üe des physischen Speichers des Servers √ºberschreitet.  Mit einer solchen Last kann die Standard-KVM die Bedingungen f√ºr den normalen Betrieb nicht schaffen. <br><br>  Ein weiterer Vergleich wurde zwischen dem Virtuozzo 7-Hypervisor und Microsoft Hyper-V 3.0 durchgef√ºhrt.  Hier wurde die Leistung mithilfe des vConsolidate-Tests bewertet, und Windows Server 2012 R2 wurde als Gastbetriebssystem f√ºr virtuelle Maschinen verwendet. <br><br>  <i><b>vConsolidate: Hyper-V gegen Virtuozzo @ Windows 2012 R2 (virtuelle Maschinen)</b></i> <br><br><img src="https://habrastorage.org/webt/oa/wr/2d/oawr2dcp8-_4yeyql9-nmze9gbs.jpeg" alt="Bild">  Im Gegensatz zum DVD Store ist in vConsolidate die Last nicht f√ºr alle virtuellen Maschinen gleich.  In diesem Test werden sie in sogenannte CSU (Consolidation Stack Units) unterteilt.  Jede CSU ist eine Gruppe von vier virtuellen Maschinen, die SPECjbb, WebBench und SysBench (OLTP) laden.  Die vierte VM in jeder CSU ist inaktiv, dh ohne Last.  Das quantitative Ergebnis ist das geometrische Mittel der Ergebnisse der drei oben genannten Tests, die insgesamt von allen virtuellen Maschinen (Ordinatenachse) erhalten wurden.  Die Anzahl der am Test beteiligten CSUs steigt nacheinander von 1 auf 24 (Abszisse). <br><br>  F√ºr beide Hypervisoren wurde der Test zweimal durchgef√ºhrt: mit Patches f√ºr die Schwachstellen Meltdown und Spectre sowie ohne diese.  Die Ann√§herung der Ergebnisse zeigt, dass Virtuozzo 7 im Durchschnitt eine um 15% h√∂here Leistung aufweist als der "native" Microsoft-Hypervisor. <br><br><h2>  Meltdown und Spectre </h2><br>  Wie Sie wissen, war die gesamte IT-Community am 4. Januar 2018 von der Entdeckung gro√üer konzeptioneller Schwachstellen in allen Intel-Prozessoren mit Ausnahme von Itanium und √§lteren Atom (bis 2013) begeistert.  Durch die Verwendung dieser Sicherheitsanf√§lligkeiten kann jeder nicht privilegierte Prozess im System auf Kerneldaten (Meltdown) oder Daten eines anderen Prozesses (Spectre) zugreifen.  Softwareentwickler konzentrierten sich auf die Ver√∂ffentlichung von Softwareupdates, um diese Schwachstellen zu beheben.  Benutzer hatten jedoch nat√ºrlich Fragen dazu, wie sich diese Updates auf die Systemleistung auswirkten. <br><br>  Am Beispiel des vConsolidate-Tests haben wir √ºberpr√ºft, wie sich Patches f√ºr Meltdown und Spectre auf die Leistung von Containern unter CentOS Linux 7.4 auswirken.  Dann haben wir eine weitere Messung durchgef√ºhrt - mit dem Kernel einen kompilierten modifizierten Compiler mit der Option ‚ÄûRetpoline‚Äú (zum Beispiel bieten GCC und Clang / LLVM eine solche M√∂glichkeit). <br><br>  <i><b>Leistung mit Retpoline: vConsolidate @ CentOS 7.4 (Container)</b></i> <br><br><img src="https://habrastorage.org/webt/5j/yq/ay/5jyqayk6xtygax1r5gdjx9gxuqw.jpeg">  Wie Sie in den obigen Grafiken sehen k√∂nnen, verringert das Anwenden von Patches gegen Meltdown und Spectre die Containerleistung erheblich.  Dar√ºber hinaus war der ‚Äûschwierigste‚Äú Patch f√ºr Spectre-V2.  Wenn Sie den Compiler jedoch mit der neuen Option Retpoline verwenden, k√∂nnen Sie diesen Patch auf Systemen mit Prozessoren, die √§lter als Skylake sind, sicher aufgeben und bis zu 25% der Leistung zur√ºckgewinnen.  Wir haben jedoch aufgrund von Patches f√ºr Meltdown und Spectre-V1 immer noch etwa 5% verloren. <br><br>  <b>Leistung mit Retpoline: vConsolidate @ CentOS 7.4 (virtuelle Maschinen)</b> <br><br><img src="https://habrastorage.org/webt/wj/ck/u0/wjcku09a37cwgbzhr8jh7jv51py.jpeg"><br>  Im Fall von CentOS Linux 7.4 ist die Situation innerhalb der virtuellen Maschinen etwas rosiger: Patches f√ºr Meltdown und Spectre beeintr√§chtigen die Leistung nur um 15%, und der Leistungsunterschied zwischen dem nicht gepatchten Kernel und dem mit Retpoline kompilierten Kernel betr√§gt nur 1-2%.  Durch den Einsatz des neuen Compilers konnte der Leistungsabfall nahezu vollst√§ndig kompensiert werden.  Es ist jedoch zu ber√ºcksichtigen, dass alle drei Messungen auf denselben virtuellen Maschinen durchgef√ºhrt wurden - mit nicht gepatchten Kerneln des Gastbetriebssystems.  Das Aktualisieren von Gastbetriebssystemen f√ºhrt zu zus√§tzlichen Leistungseinbu√üen f√ºr Benutzeranwendungen. <br><br>  <i><b>Leistung mit Retpoline: vConsolidate @ Windows 2012 R2 (virtuelle Maschinen)</b></i> <br><br><img src="https://habrastorage.org/webt/fe/nd/ca/fendcaya-er8f-4cjjafwe_mewq.jpeg"><br><br>  Das neueste Diagramm f√ºr heute ist ein √§hnlicher Vergleich, jedoch mit virtuellen Windows Server 2012 R2-Maschinen.  Hier war die Verlangsamung der Patches nicht so gro√ü und betrug ungef√§hr 10%, und die Verwendung des Kernels mit Retpoline erm√∂glichte es, den Unterschied gegen√ºber dem nicht gepatchten Kernel auf 2-3% zu reduzieren. <br><br><h2>  Fazit </h2><br>  Unmodifiziertes KVM hat nat√ºrlich seine Vorteile, und der Hauptvorteil ist seine kostenlose.  Die durchgef√ºhrten Tests belegen jedoch, dass private Verbesserungen und Modernisierungen die Rendite der verwendeten Infrastruktur verbessern k√∂nnen.  Das hei√üt, wenn Sie ein Maximum an Containern und virtuellen Maschinen platzieren m√ºssen, stellen Sie sicher, dass diese dauerhaft gespeichert sind - alle auf derselben Plattform und mit einem Minimum an schamanistischen T√§nzen -, ist die verbesserte KVM viel effektiver, insbesondere wenn die auf der Plattform ausgef√ºhrten Dienste gute Margen aufweisen und real sind das Geld.  In diesem Fall zahlen sich die Kosten f√ºr Lizenzen und Support in k√ºrzester Zeit mehr als aus. <br><br>  Die St√§rke von VZ7 liegt weiterhin in der Unterst√ºtzung verschiedener Arten von VMs und Containern auf derselben Plattform und mit einer h√∂heren Leistung f√ºr jede Kategorie virtueller Objekte.  Von einem Allheilmittel kann man aber auch hier nicht sprechen.  Wenn beispielsweise eine Erh√∂hung der Dichte dem Unternehmen keine zus√§tzlichen Finanzmittel bringt und Ihre eigenen Mitarbeiter OpenSource-L√∂sungen problemlos verwalten und fertigstellen k√∂nnen, besteht die Logik darin, offene Tools zu verwenden, einschlie√ülich CentOS und der urspr√ºnglichen KVM. <br><br>  √úbrigens werden wir im n√§chsten Beitrag √ºber die Entwicklung unseres verteilten Speichers und seine tats√§chlichen F√§higkeiten f√ºr die Arbeit mit VMs und Containern sprechen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413127/">https://habr.com/ru/post/de413127/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413117/index.html">So programmieren Sie sicher in Bash</a></li>
<li><a href="../de413119/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 317 (28. Mai - 3. Juni 2018)</a></li>
<li><a href="../de413121/index.html">Fototour von Moskau Coworking #tceh</a></li>
<li><a href="../de413123/index.html">JETZT in NoSQL-Datenbanken</a></li>
<li><a href="../de413125/index.html">Die Gentherapie gibt kleinen Patienten mit Muskelatrophie eine √úberlebenschance</a></li>
<li><a href="../de413129/index.html">25 Fehler ein Anf√§nger Programmierer</a></li>
<li><a href="../de413133/index.html">Beliebte Antimuster: Paginierung</a></li>
<li><a href="../de413135/index.html">Code-Review-Testzuweisung von Junior-React-Entwicklern</a></li>
<li><a href="../de413137/index.html">Klassifizieren Sie gro√üe Datenmengen in Apache Spark mithilfe beliebiger Modelle f√ºr maschinelles Lernen</a></li>
<li><a href="../de413139/index.html">Elektroautos: Die Revolution kommt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>