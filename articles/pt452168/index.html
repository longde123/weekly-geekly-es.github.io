<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∏ ü§ß üèª Criando um jogo de ritmo no Unity ‚úãüèæ üë©‚Äçüë©‚Äçüëß‚Äçüë¶ üìô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introdu√ß√£o 
 Ent√£o, voc√™ quer ou tentou criar um jogo de ritmo, mas os elementos do jogo e a m√∫sica rapidamente ficam fora de sincronia, e agora vo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criando um jogo de ritmo no Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452168/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98c/c5f/e21/98cc5fe21847a5826eb9fb9e396e3379.jpg" alt="imagem"></div><br><h1>  1. Introdu√ß√£o </h1><br>  Ent√£o, voc√™ quer ou tentou criar um jogo de ritmo, mas os elementos do jogo e a m√∫sica rapidamente ficam fora de sincronia, e agora voc√™ n√£o sabe o que fazer.  Este artigo ir√° ajud√°-lo com isso.  Joguei jogos de ritmo no ensino m√©dio e costumava frequentar a DDR no sal√£o de jogos locais.  Hoje estou sempre procurando novos jogos desse g√™nero, e projetos como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Crypt of the Necrodancer</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bit.Trip.Runner</a> mostram que muito mais pode ser feito nesse g√™nero.  Eu trabalhei um pouco em prot√≥tipos de jogos de ritmo no Unity e, como resultado, passei um m√™s criando um jogo de ritmo curto / quebra-cabe√ßa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atomic Beats</a> .  Neste artigo, falarei sobre as t√©cnicas de constru√ß√£o de c√≥digo mais √∫teis que aprendi na cria√ß√£o desses jogos.  N√£o consegui encontrar informa√ß√µes sobre eles em nenhum outro lugar, ou foram apresentadas com menos detalhes. <br><br>  Primeiro, devo expressar minha <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">profunda</a> gratid√£o a Yu Chao pelo post de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Music Syncing in Rhythm Games</a> [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tradu√ß√£o para Habr√©</a> ].  Yu revisou o b√°sico da sincroniza√ß√£o de tempos de √°udio com o mecanismo de jogo no Unity e fez o upload do c√≥digo-fonte do jogo Boots-Cut, o que me ajudou muito na cria√ß√£o do meu projeto.  Voc√™ pode estudar o post dele se quiser aprender uma breve introdu√ß√£o √† sincroniza√ß√£o de m√∫sicas do Unity, mas abordarei esse t√≥pico com mais detalhes e de maneira mais abrangente.  Meu c√≥digo usa ativamente as informa√ß√µes do artigo e o c√≥digo Boots-Cut. <br><a name="habracut"></a><br>  No cora√ß√£o de qualquer jogo de ritmo est√£o os hor√°rios.  As pessoas s√£o extremamente sens√≠veis a qualquer distor√ß√£o nos tempos do ritmo, por isso √© muito importante que todas as a√ß√µes, movimentos e entradas no jogo de ritmo sejam diretamente sincronizados com a m√∫sica.  Infelizmente, os m√©todos tradicionais de rastreamento de tempo do Unity, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Time.timeSinceLevelLoad</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Time.time,</a> perdem rapidamente a sincroniza√ß√£o com o som que est√° sendo reproduzido.  Portanto, acessaremos o sistema de √°udio diretamente usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AudioSettings.dspTime</a> , que usa o n√∫mero real de amostras de √°udio processadas pelo sistema de √°udio.  Devido a isso, ele sempre mant√©m a sincroniza√ß√£o com a m√∫sica que est√° sendo reproduzida (talvez n√£o seja o caso de arquivos de √°udio muito longos, quando efeitos de amostragem entram em cena, mas no caso de composi√ß√µes de tamanho normal, o sistema deve funcionar perfeitamente).  Essa fun√ß√£o ser√° o n√∫cleo do nosso rastreamento de tempo de composi√ß√£o e, com base nela, criaremos a classe principal. <br><br><h1>  Condutor de classe </h1><br>  A classe Conductor √© a principal classe de gerenciamento de composi√ß√£o, com base na qual o restante do jogo de ritmo ser√° constru√≠do.  Com ele, rastrearemos a posi√ß√£o da composi√ß√£o e gerenciaremos todas as outras a√ß√µes sincronizadas.  Para rastrear a composi√ß√£o, precisamos de algumas vari√°veis <br><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//Song beats per minute //This is determined by the song you're trying to sync up to public float songBpm; //The number of seconds for each song beat public float secPerBeat; //Current song position, in seconds public float songPosition; //Current song position, in beats public float songPositionInBeats; //How many seconds have passed since the song started public float dspSongTime; //an AudioSource attached to this GameObject that will play the music. public AudioSource musicSource;</span></span></code> </pre> <br>  Ao iniciar a cena, precisamos realizar c√°lculos para determinar as vari√°veis ‚Äã‚Äãe tamb√©m registrar para refer√™ncia o hor√°rio de in√≠cio da composi√ß√£o. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//Load the AudioSource attached to the Conductor GameObject musicSource = GetComponent&lt;AudioSource&gt;(); //Calculate the number of seconds in each beat secPerBeat = 60f / songBpm; //Record the time when the music starts dspSongTime = (float)AudioSettings.dspTime; //Start the music musicSource.Play(); }</span></span></code> </pre> <br>  Se voc√™ criar um GameObject vazio com esse script anexado e, em seguida, adicionar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fonte de √°udio</a> √† composi√ß√£o e executar o programa, ver√° que o script registrar√° a hora de in√≠cio da composi√ß√£o, mas nada mais acontecer√°.  Tamb√©m precisaremos inserir manualmente o BPM da m√∫sica que adicionamos √† fonte de √°udio. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7fc/3ac/550/7fc3ac5504438ff8bd050c50283250c6.png"></div><br>  Gra√ßas a todos esses valores, podemos acompanhar a posi√ß√£o na composi√ß√£o em tempo real ao atualizar o jogo.  Determinaremos o tempo da composi√ß√£o, primeiro em segundos e depois em fra√ß√µes.  As fra√ß√µes s√£o uma maneira muito mais conveniente de rastrear uma composi√ß√£o, porque permitem adicionar a√ß√µes e tempos no tempo paralelamente √† composi√ß√£o, por exemplo, nas fra√ß√µes 1, 3 e 5,5, sem a necessidade de calcular segundos entre as fra√ß√µes.  Adicione os seguintes c√°lculos √† fun√ß√£o Update () da classe Conductor: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//determine how many seconds since the song started songPosition = (float)(AudioSettings.dspTime - dspSongTime); //determine how many beats since the song started songPositionInBeats = songPosition / secPerBeat; }</span></span></code> </pre> <br>  Portanto, obtemos a diferen√ßa entre a hora atual de acordo com o sistema de √°udio e a hora de in√≠cio da composi√ß√£o, que fornece o n√∫mero total de segundos em que a composi√ß√£o √© reproduzida.  Vamos salv√°-lo na vari√°vel songPosition. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/84e/f20/a32/84ef20a3208c566d97332c89549c5a7a.png"></div><br>  Observe que a partitura na m√∫sica geralmente come√ßa com uma unidade com as fra√ß√µes 1-2-3-4 e assim por diante, e songPositionInBeats come√ßa em 0 e aumenta a partir desse valor; portanto, a terceira parte da composi√ß√£o corresponder√° √† songPositionInBeats, que √© 2,0, e n√£o 3,0. <br><br>  Nesse ponto, se voc√™ deseja criar um jogo tradicional no estilo Dance Dance Revolution, crie notas de acordo com a fra√ß√£o em que precisa pression√°-las, interpole sua posi√ß√£o em rela√ß√£o √† linha de clique e grave a m√∫sicaPositionInBeats quando a tecla for pressionada, e Compare o valor com a propor√ß√£o desejada de notas.  Yu Chao discute um exemplo desse esquema em seu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> .  Para n√£o me repetir, considerarei outras t√©cnicas potencialmente √∫teis que podem ser constru√≠das no topo da classe Conductor.  Eu os usei ao criar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atomic Beats</a> . <br><br><h1>  N√≥s nos adaptamos ao compartilhamento inicial </h1><br>  Se voc√™ criar sua pr√≥pria m√∫sica para um jogo de ritmo, √© f√°cil fazer com que a primeira batida corresponda exatamente ao in√≠cio da m√∫sica, que, se especificada corretamente, vincular√° com seguran√ßa a m√∫sica song da classe ConductorPositionInBeats √† composi√ß√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56a/acd/dfd/56aacddfd077d0d5890fdea4acb9d667.png"></div><br>  No entanto, se voc√™ usar m√∫sicas prontas, h√° uma alta probabilidade de que haja uma pequena pausa antes do in√≠cio da composi√ß√£o.  Se isso n√£o for levado em considera√ß√£o, a m√∫sicaPositionInBeats da classe Conductor pensar√° que a primeira batida come√ßou quando a m√∫sica come√ßou a tocar, e n√£o a batida agora.  Tudo o que estar√° mais vinculado aos valores das a√ß√µes n√£o ser√° sincronizado com a m√∫sica. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/981/9cc/e24/9819cce244fe54f954e0205345ec86fb.png"></div><br>  Para corrigir isso, voc√™ pode adicionar uma vari√°vel que leva em considera√ß√£o esse deslocamento.  Adicione o seguinte √† classe Conductor: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//The offset to the first beat of the song in seconds public float firstBeatOffset;</span></span></code> </pre> <br>  Em Update (), a vari√°vel songPosition: <br><br><pre> <code class="cs hljs">songPosition = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(AudioSettings.dspTime - dspSongTime);</code> </pre> <br>  substitu√≠do por: <br><br><pre> <code class="cs hljs">songPosition = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(AudioSettings.dspTime - dspSongTime - firstBeatOffset);</code> </pre> <br>  Agora, o songPosition calcular√° corretamente a posi√ß√£o da m√∫sica, levando em considera√ß√£o a verdadeira primeira batida.  No entanto, voc√™ precisar√° inserir manualmente o deslocamento na primeira batida; portanto, para cada arquivo, ele ser√° √∫nico.  Al√©m disso, durante esse turno, haver√° uma pequena janela na qual songPosition se tornar√° negativo.  Isso pode n√£o afetar o jogo, mas algum c√≥digo, dependendo dos valores de songPosition ou songPositionInBeats, pode n√£o ser capaz de processar n√∫meros negativos no momento. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/125/bfd/ab7/125bfdab794789a5920f1ef07bea8a26.png"><br><br><h1>  Repeti√ß√µes </h1><br>  Se voc√™ trabalha com uma composi√ß√£o que √© reproduzida do come√ßo ao fim, a classe Conductor mostrada acima ser√° suficiente para rastrear a posi√ß√£o.  Mas se voc√™ possui uma faixa curta em loop e deseja trabalhar com esse loop, precisa criar suporte ao Repeater no Conductor. <br><br>  Se voc√™ tiver um fragmento perfeitamente em loop (por exemplo, se o andamento da m√∫sica for 120bpm e o fragmento em loop tiver uma dura√ß√£o de 4 tempos, dever√° ser exatamente 8,0 segundos a 2,0 segundos por compartilhamento) carregado na classe Audio Source da classe Conductor, marque a caixa de loop.  O Conductor funcionar√° da mesma maneira que antes e transferir√° o tempo total para songPosition ap√≥s o <em>primeiro</em> in√≠cio do clipe.  Para determinar a posi√ß√£o do loop, precisamos dizer de alguma forma ao Conductor quantas a√ß√µes h√° em um loop e quantos loops j√° foram executados.  Adicione as seguintes vari√°veis ‚Äã‚Äã√† classe Conductor: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//the number of beats in each loop public float beatsPerLoop; //the total number of loops completed since the looping clip first started public int completedLoops = 0; //The current position of the song within the loop in beats. public float loopPositionInBeats;</span></span></code> </pre> <br>  Agora, a cada atualiza√ß√£o no SongPositionInBeats, tamb√©m podemos atualizar a posi√ß√£o Update () do loop. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//calculate the loop position if (songPositionInBeats &gt;= (completedLoops + 1) * beatsPerLoop) completedLoops++; loopPositionInBeats = songPositionInBeats - completedLoops * beatsPerLoop;</span></span></code> </pre> <br>  Isso nos fornece um marcador que diz ao loopPositionInBeats quantos compartilhamentos passamos pelo loop, o que √© √∫til para muitos outros itens sincronizados.  Lembre-se de inserir o n√∫mero de compartilhamentos do loop no GameObject Conductor. <br><br>  Tamb√©m devemos considerar cuidadosamente o c√°lculo das a√ß√µes.  A m√∫sica sempre come√ßa em 1; portanto, a medi√ß√£o em 4 partes assume o formato 1-2-3-4- e, em nossa classe, o loopPositionInBeats come√ßa em 0.0 e passa sobre 4.0.  Portanto, o meio exato do loop, que ao calcular as propor√ß√µes musicais ser√° 3, no loopPositionInBeats ter√° um valor de 2,0.  Voc√™ pode modificar o loopPositionInBeats para levar isso em considera√ß√£o, mas isso afetar√° todos os outros c√°lculos; portanto, tenha cuidado ao inserir notas. <br><br>  Tamb√©m para as ferramentas restantes, ser√° √∫til adicionar mais dois aspectos √† classe Conductor.  Primeiro, uma vers√£o anal√≥gica do LoopPositionInBeats chamada LoopPositionInAnalog, que mede a posi√ß√£o no loop no intervalo de 0 a 1,0.  A segunda √© uma inst√¢ncia da classe Conductor para chamadas convenientes de outras classes.  Adicione as seguintes vari√°veis ‚Äã‚Äã√† classe Conductor: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//The current relative position of the song within the loop measured between 0 and 1. public float loopPositionInAnalog; //Conductor instance public static Conductor instance;</span></span></code> </pre> <br>  Na fun√ß√£o Desperta (), adicione: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { instance = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre> <br>  e adicione √† fun√ß√£o Update (): <br><br><pre> <code class="cs hljs">loopPositionInAnalog = loopPositionInBeats / beatsPerLoop;</code> </pre> <br><h1>  Turn Sync </h1><br>  Seria muito √∫til sincronizar movimento ou rota√ß√£o com os lobos para que os elementos estejam nos lugares certos.  Nas minhas batidas at√¥micas, usei isso para girar notas dinamicamente em torno de um eixo central.  Inicialmente, eles foram colocados em torno da circunfer√™ncia de acordo com sua parte dentro do loop e, em seguida, toda a √°rea de jogo foi girada para que as notas correspondessem √† linha de depress√£o em sua parte. <br><br>  Para conseguir isso, crie um novo script chamado SyncedRotation e anexe-o ao GameObject que voc√™ deseja girar.  Adicione √† fun√ß√£o Update () do script SyncedRotation: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gameObject.transform.rotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, Mathf.Lerp(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">360</span></span>, Conductor.instance.loopPositionInAnalog)); }</code> </pre> <br>  Esse c√≥digo interpolar√° a rota√ß√£o do GameObject ao qual esse jogo est√° vinculado no intervalo de 0 a 360 graus, girando-o para que ele complete uma rota√ß√£o completa no final de cada loop.  Isso √© √∫til como exemplo, mas para anima√ß√£o em loop ou quadro a quadro, seria mais √∫til sincronizar anima√ß√µes de loop para que elas se ajustassem perfeitamente ao andamento. <br><br><h1>  Sincroniza√ß√£o de anima√ß√£o </h1><br>  O Unity <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Animator √©</a> extremamente poderoso, mas nem sempre preciso.  Para um alinhamento confi√°vel de anima√ß√µes e m√∫sicas, tive que competir com a classe Animator e sua tend√™ncia a desincronizar gradualmente com o ritmo.  Al√©m disso, era dif√≠cil ajustar as mesmas anima√ß√µes para ritmos diferentes, para que, ao alternar entre composi√ß√µes, n√£o fosse necess√°rio redefinir os quadros-chave da anima√ß√£o para o andamento atual.  Em vez disso, podemos ir diretamente para o loop de anima√ß√£o e definir a posi√ß√£o nesse loop de acordo com o local onde estamos no loop da classe Conductor. <br><br>  Primeiro, crie uma nova classe chamada SyncedAnimation e adicione as seguintes vari√°veis: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//The animator controller attached to this GameObject public Animator animator; //Records the animation state or animation that the Animator is currently in public AnimatorStateInfo animatorStateInfo; //Used to address the current state within the Animator using the Play() function public int currentState;</span></span></code> </pre> <br>  Anexe-o a um GameObject novo ou existente que voc√™ deseja animar.  Neste exemplo, simplesmente moveremos o objeto para frente e para tr√°s na tela, mas o mesmo princ√≠pio pode ser aplicado a qualquer anima√ß√£o, antes de definir a propriedade ou anima√ß√£o quadro a quadro.  Adicione um elemento Animator ao GameObject e crie um novo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Controlador Animator</a> chamado SyncedAnimController, al√©m de um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Clipe de anima√ß√£o</a> chamado BackAndForth.  Carregamos o controlador na classe Animator anexada ao GameObject e adicionamos Anima√ß√£o √† √°rvore de anima√ß√£o como a anima√ß√£o padr√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d5f/582/0e3/d5f5820e383580dbc69b18dd037a67a1.png"></div><br>  Por exemplo, configurei a anima√ß√£o para que primeiro mova o objeto para a direita em 6 unidades, depois para a esquerda em -6 e depois para 0. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dbc/d3a/0b9/dbcd3a0b909bb95cc0a91aaf2eaf65e0.png"></div><br>  Agora, para sincronizar a anima√ß√£o, adicione o seguinte c√≥digo √† fun√ß√£o Start () da classe SyncedAnimation, que inicializa informa√ß√µes sobre o Animator: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//Load the animator attached to this object animator = GetComponent&lt;Animator&gt;(); //Get the info about the current animator state animatorStateInfo = animator.GetCurrentAnimatorStateInfo(0); //Convert the current state name to an integer hash for identification currentState = animatorStateInfo.fullPathHash; }</span></span></code> </pre> <br>  Em seguida, adicione o seguinte c√≥digo a Update () para definir a anima√ß√£o: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//Start playing the current animation from wherever the current conductor loop is animator.Play(currentState, -1, (Conductor.instance.loopPositionInAnalog)); //Set the speed to 0 so it will only change frames when you next update it animator.speed = 0; }</span></span></code> </pre> <br>  Ent√£o, posicionamos a anima√ß√£o no quadro exato da anima√ß√£o em rela√ß√£o a um loop completo.  Por exemplo, se voc√™ usar a anima√ß√£o acima, quando estiver no meio do loop, a posi√ß√£o GameObject cruzar√° apenas 0. Isso pode ser aplicado a qualquer anima√ß√£o criada que voc√™ deseja sincronizar com o andamento do Conductor. <br><br>  Tamb√©m √© importante notar que, para criar um loop cont√≠nuo de anima√ß√µes, voc√™ precisa configurar as tangentes dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">quadros-chave</a> individuais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">da anima√ß√£o</a> na curva de anima√ß√£o.  A configura√ß√£o Linear criar√° uma linha reta que vai de um quadro-chave para o pr√≥ximo, e Constant manter√° a anima√ß√£o em um valor at√© o pr√≥ximo quadro-chave, o que dar√° um movimento brusco e n√≠tido. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f4c/68e/db4/f4c68edb4ab3e874379d8f6874b74fea.png"></div><br>  Embora esse m√©todo seja √∫til, ele afeta todas as transi√ß√µes da anima√ß√£o, pois faz com que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">animationState</a> permane√ßa no estado em que estava quando o script foi executado inicialmente.  Esse m√©todo √© √∫til para objetos que precisam usar apenas uma anima√ß√£o sincronizada infinitamente, mas para criar objetos mais complexos com diferentes anima√ß√µes sincronizadas, √© necess√°rio adicionar c√≥digo que processa essas transi√ß√µes e define a vari√°vel currentState de acordo com o estado de anima√ß√£o desejado. <br><br><h1>  Conclus√£o </h1><br>  Estes s√£o apenas alguns dos aspectos que me ajudaram na cria√ß√£o de Atomic Beats.  Alguns deles foram coletados de outras fontes ou criados por necessidade, mas a maioria deles n√£o consegui encontrar na forma final, ent√£o espero que isso seja √∫til!  Talvez parte do meu sistema n√£o seja mais √∫til em grandes projetos devido a limita√ß√µes da CPU ou do sistema de √°udio, mas ser√° uma boa base para jogar um game jam ou um projeto de hobby. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ae/2a4/f7b/9ae2a4f7be098cc23e5b7283d5b1b9ba.png" alt="imagem"></div><br>  Criar um jogo de ritmo, ou elementos de jogo sincronizados com a m√∫sica, pode ser dif√≠cil.  Para manter tudo em um ritmo consistente, voc√™ pode precisar de um c√≥digo complicado; um resultado que permita tocar em um ritmo constante pode ser muito atraente para o jogador.  Muito mais pode ser feito nesse g√™nero do que jogos no estilo tradicional Dance Dance Revolution, e espero que este artigo o ajude a implementar esses projetos.  Tamb√©m recomendo, se poss√≠vel, avaliar meu jogo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atomic Beats</a> .  Eu fiz em um m√™s na primavera deste ano, tem 8 faixas curtas e √© gr√°tis! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt452168/">https://habr.com/ru/post/pt452168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt452152/index.html">Que solu√ß√µes a Rostelecom possui para o IIoT</a></li>
<li><a href="../pt452154/index.html">Cubo virtual - em vez de OLAP</a></li>
<li><a href="../pt452158/index.html">TOPchik - um plugin WordPress aberto para verifica√ß√£o gratuita das posi√ß√µes do site para consultas de pesquisa, por meio da API Yandex.XML</a></li>
<li><a href="../pt452162/index.html">Bot para VK em Python com MySQL em uma hora, parte 1</a></li>
<li><a href="../pt452164/index.html">ModLook - Scanner de registro ModBus. Comemorando o 20¬∫ anivers√°rio do programa</a></li>
<li><a href="../pt452172/index.html">Sistemas complexos. Atingindo um n√≠vel cr√≠tico</a></li>
<li><a href="../pt452174/index.html">Ele n√£o precisa de voc√™</a></li>
<li><a href="../pt452178/index.html">An√°lise: 23 erros populares no ingl√™s escrito e como evit√°-los</a></li>
<li><a href="../pt452180/index.html">Aumentamos o desempenho do SSD a partir dos joelhos, onde clicar e por que</a></li>
<li><a href="../pt452182/index.html">Pesquisa de funcion√°rios. O principal erro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>