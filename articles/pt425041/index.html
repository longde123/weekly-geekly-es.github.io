<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèΩ üê© üîç O que h√° de errado com o GraphQL ü§∂üèΩ üåÇ üèóÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recentemente, o GraphQL est√° ganhando cada vez mais popularidade. Sintaxe graciosa de solicita√ß√µes, tipifica√ß√£o e assinaturas. 


 Parece: "aqui est√° ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O que h√° de errado com o GraphQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425041/"><p>  Recentemente, o GraphQL est√° ganhando cada vez mais popularidade.  Sintaxe graciosa de solicita√ß√µes, tipifica√ß√£o e assinaturas. </p><br><p>  Parece: <em>"aqui est√° - n√≥s encontramos a linguagem ideal para a troca de dados!"</em>  ... </p><br><p>  Estou desenvolvendo esse idioma h√° mais de um ano e digo: tudo est√° longe de ser tranquilo.  O GraphQL tem momentos desconfort√°veis ‚Äã‚Äãe problemas realmente fundamentais no pr√≥prio design da linguagem. </p><br><p>  Por outro lado, a maioria dessas "mudan√ßas de design" foram feitas por uma raz√£o - isso ocorreu devido a v√°rias considera√ß√µes.  De fato, o GraphQL n√£o √© para todos e pode n√£o ser a ferramenta que voc√™ precisa.  Mas as primeiras coisas primeiro. </p><a name="habracut"></a><br><blockquote> Eu acho que vale a pena fazer uma pequena observa√ß√£o sobre onde eu uso essa linguagem.  Este √© um painel de administra√ß√£o do SPA bastante complicado, a maioria das opera√ß√µes nas quais s√£o CRUDs n√£o triviais (entidades complexas).  Uma parte significativa da argumenta√ß√£o deste material est√° relacionada √† natureza do aplicativo e √† natureza dos dados processados.  Em aplicativos de um tipo diferente (ou com uma natureza diferente dos dados), esses problemas podem n√£o surgir em princ√≠pio. </blockquote><br><h2 id="1-non_null">  1. NON_NULL </h2><br><p>  Este n√£o √© um problema s√©rio.  Em vez disso, essa √© uma s√©rie de inconvenientes relacionados √† organiza√ß√£o do trabalho com anul√°vel no GraphQL. </p><br><p> Existem linguagens de programa√ß√£o funcionais (e n√£o apenas), esse paradigma √© m√¥nadas.  Portanto, existe uma m√¥nada <code>Maybe</code> (Haskel) ou <code>Option</code> (Scala) A conclus√£o √© que o valor contido nessa m√¥nada pode ou n√£o existir (ou seja, ser nulo).  Bem, ou pode ser implementado atrav√©s de enum, como no Rust. </p><br><p>  De uma forma ou de outra, e na maioria dos idiomas, esse valor, que "envolve" o original, torna nula uma op√ß√£o adicional √† principal.  E sintaticamente - √© sempre uma adi√ß√£o ao tipo principal.  Isso nem sempre √© apenas uma classe de tipo separada - em alguns idiomas, √© apenas uma adi√ß√£o na forma de sufixo ou prefixo <code>?</code>  . </p><br><p>  No GraqhQL, o oposto √© verdadeiro.  Todos os tipos s√£o anul√°veis ‚Äã‚Äãpor padr√£o - e isso n√£o est√° apenas marcando o tipo como anul√°vel, √© a m√¥nada <code>Maybe</code> , pelo contr√°rio. </p><br><p>  E se considerarmos a se√ß√£o de introspec√ß√£o do campo de <code>name</code> para esse esquema: </p><br><pre> <code class="nginx hljs"><span class="hljs-comment"><span class="hljs-comment">#       schema -  ,    schema { query: Query } type Query { #       NonNull name: String! }</span></span></code> </pre> <br><p>  n√≥s encontramos: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/15f/0ff/4ad/15f0ff4adfc31acf387165ad4adf7b5e.png" alt="imagem"></p><br><p>  Tipo de <code>String</code> <code>NON_NULL</code> em <code>NON_NULL</code> </p><br><h3 id="11-output">  1.1  SA√çDA </h3><br><p>  Porque assim?  Em resumo, ele est√° conectado ao design de linguagem "tolerante" padr√£o (entre outras coisas, √© amig√°vel √† arquitetura de microsservi√ßo). </p><br><p>  Para entender a ess√™ncia dessa "toler√¢ncia", considere um exemplo um pouco mais complexo, no qual todos os valores retornados s√£o estritamente agrupados em NON_NULL: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> User { name: String! <span class="hljs-comment"><span class="hljs-comment">#  :       . friends: [User!]! } type Query { #  :       . users(ids: [ID!]!): [User!]! }</span></span></code> </pre> <br><p>  Suponha que tenhamos um servi√ßo que retorne uma lista de usu√°rios e uma "amizade" separada de microsservi√ßo que nos retorne uma correspond√™ncia para os amigos do usu√°rio.  Ent√£o, em caso de falha do servi√ßo de "amizade", n√£o poderemos listar os usu√°rios.  Precisa corrigir a situa√ß√£o: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> User { name: String! <span class="hljs-comment"><span class="hljs-comment">#    -  null   . #    ""  -      ,    . friends: [User!] }</span></span></code> </pre> <br><p>  Essa √© a toler√¢ncia a erros internos.  Um exemplo, √© claro, exagerado.  Mas espero que voc√™ tenha entendido a ess√™ncia. </p><br><p>  Al√©m disso, voc√™ pode facilitar sua vida em outras situa√ß√µes.  Suponha que haja usu√°rios remotos e os identificadores de amigos possam ser armazenados em alguma estrutura externa n√£o relacionada.  Poder√≠amos simplesmente eliminar e devolver apenas o que possu√≠mos, mas n√£o conseguiremos entender o que exatamente foi eliminado. </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Query { <span class="hljs-comment"><span class="hljs-comment">#  null   . #                . users(ids: [ID!]!): [User]! }</span></span></code> </pre> <br><p>  <em>Est√° tudo bem.</em>  <em>E qual √© o problema?</em> <br>  Em geral, n√£o √© um problema muito grande - ent√£o o gosto.  Mas se voc√™ tem um aplicativo monol√≠tico com um banco de dados relacional, os erros mais prov√°veis ‚Äã‚Äãs√£o realmente erros, e a API deve ser o mais rigorosa poss√≠vel.  Ol√°, pontos de exclama√ß√£o!  Onde voc√™ puder. </p><br><p>  Eu gostaria de poder "inverter" esse comportamento e colocar pontos de interroga√ß√£o em vez de pontos de exclama√ß√£o) Seria mais familiar de alguma forma. </p><br><h3 id="12-input">  1.2  ENTRADA </h3><br><p>  Mas ao entrar, anul√°vel √© uma hist√≥ria completamente diferente.  Este √© um batente do n√≠vel da caixa de sele√ß√£o em HTML (acho que todo mundo se lembra dessa n√£o-obviedade quando o campo de uma caixa de sele√ß√£o desmarcada simplesmente n√£o √© enviado para tr√°s). </p><br><p>  Considere um exemplo: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Post { id: ID! title: String! <span class="hljs-comment"><span class="hljs-comment">#  :     null description: String content: String! } input PostInput { title: String! #  :     ,   description: String content: String! } type Mutation { createPost(post: PostInput!): Post! }</span></span></code> </pre> <br><p>  At√© agora, tudo bem.  Adicionar atualiza√ß√£o: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Mutation { createPost(post: PostInput!): Post! updatePost(id: ID!, post: PostInput!): Post! }</code> </pre> <br><p>  E agora a pergunta √©: o que podemos esperar do campo de descri√ß√£o ao atualizar a publica√ß√£o?  O campo pode ser nulo ou pode estar ausente por completo. </p><br><p>  Se o campo estiver faltando, o que precisa ser feito?  N√£o atualiz√°-lo?  Ou defina-o como nulo?  A linha inferior √© que permitir nulo e permitir a aus√™ncia de um campo s√£o duas coisas diferentes.  No entanto, o GraphQL √© a mesma coisa. </p><br><h2 id="2-razdelenie-vvoda-i-vyvoda">  2. Separa√ß√£o de entrada e sa√≠da </h2><br><p>  Isso √© apenas dor.  No modelo de trabalho CRUD, voc√™ obt√©m o objeto de tr√°s "torce" e envia de volta.  Grosso modo, esse √© o mesmo objeto.  Mas voc√™ s√≥ precisa descrev√™-lo duas vezes - para entrada e sa√≠da.  E nada pode ser feito com isso, exceto para escrever um gerador de c√≥digo para esse neg√≥cio.  Eu preferiria separar na "entrada e sa√≠da" n√£o os objetos em si, mas os campos do objeto.  Por exemplo, modificadores: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Post { <span class="hljs-attribute"><span class="hljs-attribute">input</span></span> output text: String! output updatedAt(format: DateFormat = W3C): Date! }</code> </pre> <br><p>  ou usando diretivas: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Post { text: String! @<span class="hljs-attribute"><span class="hljs-attribute">input</span></span> <span class="hljs-variable"><span class="hljs-variable">@output</span></span> updatedAt(format: DateFormat = W3C): Date! <span class="hljs-variable"><span class="hljs-variable">@output</span></span> }</code> </pre> <br><h2 id="3-polimorfizm">  3. Polimorfismo </h2><br><p>  Os problemas de separa√ß√£o de tipos em entrada e sa√≠da n√£o se limitam a uma descri√ß√£o dupla.  Ao mesmo tempo, para tipos gen√©ricos, voc√™ pode definir interfaces generalizadas: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">interface</span></span> Commentable { comments: [Comment!]! } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Post implements Commentable { text: String! comments: [Comment!]! } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Photo implements Commentable { src: URL! comments: [Comment!]! }</code> </pre> <br><p>  ou sindicatos </p><br><pre> <code class="plaintext hljs">type Person { firstName: String, lastName: String, } type Organiation { title: String } union Subject = Organiation | Person type Account { login: String subject: Subject }</code> </pre> <br><p>  Voc√™ n√£o pode fazer o mesmo para tipos de entrada.  Existem v√°rios pr√©-requisitos para isso, mas isso se deve em parte ao fato de o json ser usado como formato de dados para transporte.  No entanto, na sa√≠da, o campo <code>__typename</code> √© usado para especificar o tipo.  Por que era imposs√≠vel fazer o mesmo ao entrar - n√£o √© muito claro.  Parece-me que esse problema poderia ser resolvido de maneira um pouco mais elegante abandonando o json durante o transporte e inserindo seu pr√≥prio formato.  Algo no esp√≠rito: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">union</span></span> Subject = OrganiationInput | PersonInput input AccountInput { login: String! password: String! subject: Subject! }</code> </pre> <br><pre> <code class="nginx hljs"><span class="hljs-comment"><span class="hljs-comment">#     { account: AccountInput { login: "Acme", password: "***", subject: OrganiationInput { title: "Acme Inc" } } }</span></span></code> </pre> <br><pre> <code class="nginx hljs"><span class="hljs-comment"><span class="hljs-comment">#      { account: AccountInput { login: "Acme", password: "***", subject: PersonInput { firstName: "Vasya", lastName: "Pupkin", } } }</span></span></code> </pre> <br><p>  Mas isso tornaria necess√°rio escrever analisadores adicionais para esse neg√≥cio. </p><br><h2 id="4-dzheneriki">  4. Gen√©ricos </h2><br><p>  O que h√° de errado com o GraphQL com gen√©ricos?  E tudo √© simples - eles n√£o s√£o.  Vamos fazer uma consulta t√≠pica do √≠ndice CRUD com uma pagina√ß√£o ou cursor - isso n√£o √© importante.  Vou dar um exemplo com pagina√ß√£o. </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">input</span></span> Pagination { page: UInt, perPage: UInt, } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Query { users(pagination: Pagination): PageOfUsers! } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> PageOfUsers { total: <span class="hljs-attribute"><span class="hljs-attribute">UInt</span></span> items: [User!]! }</code> </pre> <br><p>  e agora para organiza√ß√µes </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Query { organizations(pagination: Pagination): PageOfOrganizations! } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> PageOfOrganizations { total: <span class="hljs-attribute"><span class="hljs-attribute">UInt</span></span> items: [Organization!]! }</code> </pre> <br><p>  e assim por diante ... como eu gostaria de ter gen√©ricos para isso </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> PageOf&lt;T&gt; { total: <span class="hljs-attribute"><span class="hljs-attribute">UInt</span></span> items: [T!]! }</code> </pre> <br><p>  ent√£o eu escrevia </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Query { users(page: UInt, perPage: UInt): PageOf&lt;User&gt;! }</code> </pre> <br><p>  Sim toneladas de aplica√ß√µes!  Devo falar sobre os gen√©ricos? </p><br><h2 id="5-neymspeysy">  5. Namespaces </h2><br><p>  Eles tamb√©m n√£o est√£o l√°.  Quando o n√∫mero de tipos no sistema √© superior a cem e meia, a probabilidade de colis√µes de nomes tende a cem por cento. </p><br><p>  E todos os tipos de <code>Service_GuideNDriving_Standard_Model_Input</code> aparecem.  N√£o estou falando de namespaces completos em diferentes pontos de extremidade, como no SOAP (sim, sim, √© terr√≠vel, mas os namespaces s√£o criados l√° perfeitamente).  E pelo menos v√°rios esquemas em um ponto de extremidade com a capacidade de "atrapalhar" tipos entre esquemas. </p><br><h2 id="itogo">  Total </h2><br><p>  O GraphQL √© uma boa ferramenta.  Ele se encaixa perfeitamente em uma arquitetura tolerante de microsservi√ßo, orientada, antes de tudo, para a sa√≠da de informa√ß√µes e para uma entrada determin√≠stica simples. </p><br><p>  Se voc√™ tiver entidades polim√≥rficas para entrar, poder√° ter problemas. <br>  A separa√ß√£o dos tipos de entrada e sa√≠da, bem como a falta de gen√©ricos - geram um monte de rabiscos do zero. </p><br><p>  Graphql n√£o √© realmente (e √†s vezes <em>nem um pouco</em> ) sobre CRUD. </p><br><p>  Mas isso n√£o significa que voc√™ n√£o pode comer :) </p><br><p>  No pr√≥ximo artigo, quero falar sobre como luto (e √†s vezes com sucesso) com alguns dos problemas descritos acima. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt425041/">https://habr.com/ru/post/pt425041/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt425027/index.html">Desenvolvimento de shaders GLSL no Kotlin</a></li>
<li><a href="../pt425031/index.html">Mais pr√°tica! Vamos ensinar Spring Framework e cria√ß√£o de perfil sem nenhuma confer√™ncia</a></li>
<li><a href="../pt425033/index.html">Construindo um Jetpack: Relat√≥rio Anual da JetPack Aviation 2017</a></li>
<li><a href="../pt425037/index.html">Not√≠cias do IT Geek Hub: como fizemos uma miss√£o de bicicleta em Praga e o que o espera na pr√≥xima reuni√£o</a></li>
<li><a href="../pt425039/index.html">Semana 37 de seguran√ßa: Facebook, Twitter e bugs infl√°veis</a></li>
<li><a href="../pt425043/index.html">Introdu√ß√£o ao desenvolvimento de uma solu√ß√£o t√≠pica de c√≥digo aberto</a></li>
<li><a href="../pt425047/index.html">Como o aconselhamento rob√≥tico funciona nos investimentos. Spoiler: simples</a></li>
<li><a href="../pt425051/index.html">An√°lise do notebook Dell XPS 13 9370: leve, bonito, r√°pido</a></li>
<li><a href="../pt425053/index.html">SSR: quando, por que e para qu√™. No exemplo do Vue</a></li>
<li><a href="../pt425055/index.html">Oculus quest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>