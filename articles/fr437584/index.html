<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👵🏿 👨🏼‍⚖️ 🎌 Les bases mathématiques de la mise en page automatique 👩🏼‍🌾 👨🏽‍✈️ 👂🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nombreux développeurs pensent que la disposition automatique est un frein et un problème, et il est extrêmement difficile de la déboguer. Et c'est ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Les bases mathématiques de la mise en page automatique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/437584/">  De nombreux développeurs pensent que la disposition automatique est un frein et un problème, et il est extrêmement difficile de la déboguer.  Et c'est bien si cette conclusion est faite sur la base de ma propre expérience, et parfois c'est juste "J'ai entendu, je n'essaierai même pas de me faire des amis". <br><br>  Mais peut-être que la raison n'est pas à l'extérieur, mais à l'intérieur.  Par exemple, les oiseaux les plus dangereux du monde du casoar n'attaqueront pas les gens sans raison, uniquement pour se défendre.  Par conséquent, essayez de supposer une seconde que ce n'est pas une mauvaise disposition automatique, que vous ne la comprenez pas assez bien et ne savez pas comment cuisiner.  C'est ce qu'Anton Sergeyev a fait et s'est plongé dans la théorie afin de tout comprendre exactement.  On nous offre une compression prête à l'emploi sur les fondements mathématiques de la mise en page automatique. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xm/53/dw/xm53dwqnl0lczpswansphdrgbpi.png" width="360"></div><br><br><a name="habracut"></a><br>  La mise en page automatique est un <strong>système de mise en page</strong> .  Avant de nous y plonger, parlons de la composition moderne en général.  Ensuite, traitons de la <strong>disposition automatique</strong> - nous déterminerons <strong>quelle tâche elle résout</strong> et comment elle le fait.  Examinons les <strong>fonctionnalités de l'implémentation de la mise en page automatique dans iOS</strong> et essayons de développer <strong>des conseils pratiques</strong> qui peuvent vous aider à travailler avec. <br><br>  Cette histoire sera très proche d'un article mathématique, donc on s'entend d'abord sur la notation pour parler le même langage. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/-eGciYD9i3I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <strong>À propos du conférencier:</strong> Anton Sergeev ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">antonsergeev88</a> ) travaille dans l'équipe Yandex.Mart, s'occupe du client mobile pour Maps sur iOS.  Avant le développement mobile, il a traité des systèmes de contrôle des centrales électriques, où le coût des erreurs dans le code est trop élevé pour être toléré. <br><br><h2>  Désignations <br></h2><br>  Les systèmes d'équations linéaires nous sont familiers depuis l'école - ils sont indiqués par un crochet et leur solution est déjà sans.  De plus, les systèmes d'équations linéaires ont des entités qui fonctionnent avec des restrictions de disposition automatique.  Ils sont indiqués par une ligne droite. <br><br><img src="https://habrastorage.org/webt/ql/qb/sa/qlqbsasmt7hb37gbgal6han6-4c.png"><br><br>  L'oiseau étrange et, comme nous le savons déjà, dangereux n'est pas accidentellement peint dans le coin supérieur du toboggan.  En l'honneur du casoar (casoar lat.), Qui, bien sûr, vit en Australie, un algorithme est nommé dans tous nos iPhones. <br><br>  La disposition automatique a ses propres limites, nous les désignerons par des couleurs par ordre de priorité: rouge - obligatoire;  jaune - haut;  bleu - bas. <br><br><h2>  Disposition <br></h2><br>  Lors de la rédaction de la présentation, j'ai placé divers éléments à l'écran, par exemple un casoar.  Pour ce faire, j'ai déterminé que le casoar était une image rectangulaire.  Vous devez l'organiser sur une feuille qui a des axes et son propre système de coordonnées, et pour cela j'ai déterminé les coordonnées du coin supérieur gauche, la largeur et la hauteur. <br><br><img src="https://habrastorage.org/webt/5s/rq/ci/5srqci-zsre1tg_nbnn3grczdno.png"><br><br>  Connaître ces quatre valeurs suffit pour représenter n'importe quelle vue. <br><br><h3>  Algorithme n ° 1 <br></h3><br>  En plaçant le casoar sur la feuille, nous avons discrètement décrit le premier algorithme de mise en page: <br><br><ul><li>  déterminer les coordonnées et les tailles; </li><li>  appliquez-les à UIView. </li></ul><br>  L'algorithme fonctionne, mais est assez difficile à utiliser, nous allons donc le simplifier davantage. <br><br>  Supposons que ci-dessous soit une solution à un système d'équations linéaires. <br><br><img src="https://habrastorage.org/webt/ca/6i/ab/ca6iabqohj0bqr1rmujisor9fv4.png"><br><br>  Le système d'équations linéaires est particulier en ce que de nombreuses opérations y sont définies: pliage de lignes, multiplication par constantes, etc.  Ces opérations sont appelées transformations linéaires et, avec leur aide, le système est réduit à une forme arbitraire. <br><br>  La beauté des transformations linéaires est qu'elles sont réversibles.  Cela nous amène à une idée intéressante et plutôt subtile avec laquelle commence toute la mise en page moderne. <br><br>  Soit une vue - un rectangle avec ses coordonnées et sa taille.  Nous voulons l'arranger pour que le centre coïncide avec le point donné.  Nous modélisons le centre à l'aide de transformations linéaires - les <strong>coordonnées du coin supérieur gauche + la moitié de la largeur</strong> . <br><br><img src="https://habrastorage.org/webt/yg/el/ic/ygelic6e5xa6orhvnaz7g5p_cki.png"><br><br>  Nous avons modélisé le centre par transformation linéaire, ce n'était pas le cas: il n'y avait que les coordonnées du point supérieur gauche, la largeur et la hauteur. <br><br>  De même, vous pouvez simuler toute autre indentation, par exemple, à 20 points du coin droit. <br><br><blockquote>  C'est l'idée de transformations linéaires qui nous permet de créer différents systèmes de composition. <br></blockquote><br>  Prenons un exemple élémentaire.  Nous écrivons un système avec lequel nous établissons les coordonnées du milieu et du côté droit, la largeur et la relation entre la largeur et la hauteur.  Nous résolvons le système et obtenons la réponse. <br><br><img src="https://habrastorage.org/webt/hc/xc/hu/hcxchuyy2qvuvati_laj8afryig.png"><br><br>  Nous arrivons donc au deuxième algorithme. <br><br><h3>  Algorithme n ° 2 <br></h3><br>  La deuxième itération de l'algorithme se compose des éléments suivants: <br><br><ul><li>  constituer un système d'équations linéaires; </li><li>  nous le résolvons; </li><li>  appliquer la solution à UIView. </li></ul><br>  Imaginez que nous étions au XXe siècle, à une époque où l'équipement informatique n'en était qu'à ses balbutiements, et que nous avons été les premiers à créer notre propre système de mise en page.  Inventé, emballé, donné à l'utilisateur, et il commence à l'utiliser - remplit les paramètres initiaux et le transfère à notre système. <br><br><img src="https://habrastorage.org/webt/8b/np/wk/8bnpwkt2ufktqh1wa7dtumctozs.png"><br><br>  Il y a un problème - ce système n'a pas de solution unique.  Le problème n'est pas exceptionnel, absolument tous les systèmes de mise en page s'y heurtent, et est appelé le <strong>manque de solution</strong> . <br><br>  Il n'y a pas tant de façons de sortir de cette situation: <br><br><ul><li>  Vous pouvez <strong>tomber</strong> - c'est une méthode très courante.  Ceux qui travaillent avec MacOS savent que NSLayoutConstraintManager fait exactement cela. </li><li>  <strong>Renvoie la valeur par défaut</strong> .  Dans le cadre de la mise en page, nous pouvons toujours retourner tous les zéros. </li><li>  Une manière plus connue et délicate consiste <strong>à empêcher une entrée incorrecte</strong> .  Cette méthode est utilisée par les systèmes de mise en page populaires, par exemple le <strong>Yoga</strong> , appelé <strong>Flex Layout</strong> .  Ces systèmes essaient de créer une interface qui ne permettra pas une entrée incorrecte. </li><li>  Il y a une autre façon de résoudre absolument tous les problèmes - de <strong>tout repenser dès le début</strong> et d'abord <strong>d'éviter l'apparition de ce problème</strong> .  La disposition automatique s'est déroulée de cette façon. </li></ul><br><h2>  Disposition automatique  Énoncé et solution du problème <br></h2><br>  Nous avons une image rectangulaire et pour l'identifier de manière unique, nous avons besoin de 4 paramètres: <br><br><ul><li>  coordonnées du coin supérieur gauche; </li><li>  largeur et hauteur. </li></ul><br><img src="https://habrastorage.org/webt/9k/m4/mn/9km4mnazc-bszyeglny7jgury1k.png"><br><br>  La mise en page automatique est très détaillée.  Comparé à un système d'équations linéaires, il est beaucoup plus difficile de tout placer sur l'écran avec lui.  Par conséquent, nous considérerons, sans perte de généralité, le cas unidimensionnel. <br><br><img src="https://habrastorage.org/webt/yy/g-/bz/yyg-bzfkdyhagrqn28bj7ruydg8.png"><br><br>  Tout est très simple: l'espace est une ligne droite, et tous les objets qui peuvent y être placés sont des points sur une ligne droite.  Une valeur: <strong>X = X <sub>P</sub></strong> suffit pour déterminer la position du point. <br><br>  Considérez l'approche de mise en page automatique.  Il existe un espace dans lequel des restrictions sont définies.  La solution que nous voulons obtenir est <strong>X = X <sub>0</sub></strong> , et aucune autre. <br><br>  Il y a un problème - nous n'avons pas défini d'opérations avec des restrictions.  Nous ne pouvons pas conclure directement de l'enregistrement que <strong>X = X <sub>0</sub></strong> , nous ne pouvons rien multiplier ou ajouter quoi que ce soit à quoi que ce soit.  Pour ce faire, nous devons transformer la contrainte en ce avec quoi nous pouvons travailler - en un système d'équations et d'inégalités. <br><br><img src="https://habrastorage.org/webt/dc/ru/gr/dcrugrl3rwq6esfcnrlz89ora8o.png"><br><br>  La disposition automatique transforme un système d'équations et d'inégalités comme suit. <br><br><ul><li>  Introduit d'abord 2 variables supplémentaires qui <strong>ne</strong> sont <strong>pas négatives</strong> et <strong>dépendent les unes des autres</strong> .  Au moins l'un d'eux est égal à zéro. </li><li>  La contrainte elle-même est convertie en notation <strong>X = X <sub>0</sub> + a <sup>+</sup> - a <sup>-</sup></strong> . </li></ul><br>  Point <strong>X <sub>0</sub></strong> <sub>&nbsp;</sub>  - solution du système: si <strong>a <sup>+</sup></strong> et <strong>a <sup>-</sup></strong> sont égaux à zéro, alors ce sera vrai.  Mais <strong>tout autre point</strong> sur cette ligne sera une solution. <br><br>  Par conséquent, il est nécessaire de trouver le meilleur parmi l'ensemble des solutions.  Pour ce faire, nous introduisons une fonction - une fonction ordinaire qui renvoie un nombre, et nous pouvons comparer les nombres.  Nous dessinons un graphique et notons que la solution que nous voulions à l'origine est un minimum. <br><br>  Vous avez <strong>un problème de programmation linéaire</strong> .  C'est exactement ce que fait Auto Layout avec les contraintes, qui sont non seulement sous forme d'égalités, mais aussi d'inégalités. <br><br><h3>  Contraintes d'inégalité <br></h3><br>  Dans le cas des restrictions d'inégalité, la transformation se produit de la même manière que pour les égalités: deux variables supplémentaires sont introduites et tout cela est collecté dans le système.  Seule la fonctionnelle est différente, et elle est égale à <strong>a <sup>-</sup></strong> . <br><br><img src="https://habrastorage.org/webt/su/lp/db/sulpdbiqpzdvnd2s23qwo3zg3p0.png"><br><br>  Le graphique ci-dessus montre pourquoi il en est ainsi - toute valeur de <strong>a <sup>+</sup></strong> avec <strong>a <sup>-</sup> = 0</strong> (de <strong>X <sub>0</sub></strong> à <strong>+ ∞</strong> ) sera la solution optimale pour le problème. <br><br>  Essayons de combiner ces deux restrictions d'équations et d'inégalités en une seule - parce que les restrictions ne vivent pas isolément, elles sont appliquées ensemble à l'ensemble du système. <br><br><img src="https://habrastorage.org/webt/kv/p4/ed/kvp4ed32qay13--nhn6neefffd0.png"><br><br>  Pour chaque contrainte, une paire de variables supplémentaires est introduite et la fonction est compilée.  Puisque nous voulons que toutes ces restrictions soient remplies simultanément, la <strong>fonctionnelle sera égale à la somme de toutes les fonctionnelles de chaque restriction</strong> . <br><br>  Nous collectons la fonction f et voyons que la solution est <strong>X <sub>1</sub></strong> .  Comme nous nous y attendions, faire des restrictions.  Nous arrivons donc au troisième algorithme. <br><br><h3>  Algorithme n ° 3 <br></h3><br>  Pour faire quelque chose, il faut: <br><br><ul><li>  créer un système de contraintes linéaires; </li><li>  le transformer en un problème de programmation linéaire; </li><li>  résoudre le problème de toute manière connue, par exemple, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">méthode simplex</a> utilisée dans la mise en page automatique; </li><li>  appliquer la solution à UIView. </li></ul><br>  Cet algorithme semble suffisant, mais considérons le cas suivant: on change l'ensemble initial de contraintes pour que la deuxième contrainte soit maintenant <strong>X ≥ X</strong> <strong><sub>2</sub></strong> . <br><br><img src="https://habrastorage.org/webt/li/dd/at/liddathmoov5umsnhvnoevax6jy.png"><br><br>  Quelle solution attendons-nous? <br><br><ul><li>  <strong>X <sub>1</sub></strong> ?  En effet, dans la première restriction, il s'écrit ainsi: <strong>X = X <sub>1</sub></strong> , et cette solution entre en conflit avec la deuxième restriction. </li><li>  <strong>X <sub>2</sub></strong> ?  Il y aura déjà un conflit avec la première restriction. </li></ul><br>  Pour sortir de la situation, nous allons effectuer des transformations que nous savons déjà faire. <br><br>  Le graphique de la nouvelle fonctionnalité est différent: tout point de l'intervalle de <strong>X <sub>1</sub></strong> à <strong>X <sub>2</sub></strong> sera la bonne solution valide du système.  C'est ce qu'on appelle l' <strong>incertitude</strong> . <br><br><h3>  Incertitude <br></h3><br>  La disposition automatique a un mécanisme pour résoudre ces problèmes - les <strong>priorités</strong> .  Je vous rappelle que le jaune indique une priorité élevée et le bleu - faible. <br><br><img src="https://habrastorage.org/webt/7e/go/is/7egoisncevkoitvo8fdxkvcdg7g.png"><br><br>  Convertir les restrictions.  Veuillez noter que le système résultant est simplement noir.  Nous savons comment travailler avec, et il n'y a aucune information sur les restrictions.  C'est dans les fonctionnalités, dont il y en aura deux.  La disposition automatique réduira d'abord le premier, puis le second. <br><br>  Dans les problèmes de programmation linéaire, nous ne recherchons pas la solution elle-même, mais la gamme de solutions réalisables.  Bien sûr, nous voulons que cette zone ne soit qu'un seul point, et la mise en page automatique agit de la même manière.  Premièrement, il minimise la fonction la plus prioritaire sur ( <strong>-</strong> <strong>∞,</strong> <strong>+ ∞)</strong> et, en sortie, reçoit un domaine de solutions réalisables.  La disposition automatique résout déjà le deuxième problème de programmation linéaire sur la plage obtenue de valeurs admissibles.  Un tel mécanisme est appelé une <strong>hiérarchie de contraintes</strong> , et dans ce problème donne le point <strong>X <sub>2</sub></strong> . <br><br><h3>  Algorithme n ° 4 <br></h3><br><ul><li>  Créez une hiérarchie de contraintes linéaires; </li><li>  le transformer en tâche de programmation linéaire; </li><li>  résoudre séquentiellement le problème de programmation linéaire - de la priorité la plus élevée à la priorité la plus faible. </li><li>  appliquer la solution à UlView. </li></ul><br>  Reprenons la tâche précédente.  Nous ne sommes pas des mathématiciens, mais des ingénieurs, et tout ingénieur doit être confondu ici. <br><br>  Il y a un grave problème ici - l' <strong>infini</strong> , et je ne sais pas ce que c'est. <br><br>  L'algorithme Cassowary sous le capot de la mise en page automatique n'était pas un mécanisme existant qui tombait commodément sur la tâche de mise en page automatique, mais a été pensé comme un outil de mise en page, et il a fourni des mécanismes spéciaux pour échapper à l'infini au tout début.  Pour cela, plusieurs types de restrictions ont été inventés: <br><br><ul><li>  <strong>Les paramètres</strong> sont les contraintes avec lesquelles nous avons travaillé.  Elles sont appelées <strong>préférences</strong> dans l'original <strong>,</strong> parfois dans la documentation Apple - <strong>contraintes facultatives</strong> . </li><li>  <strong>Exigences</strong> ou exigences - restrictions avec priorité <strong>requises</strong> . </li></ul><br>  Voyons comment les exigences avec de telles priorités sont transformées du point de vue des mathématiques. <br><br><img src="https://habrastorage.org/webt/hm/mn/my/hmmnmycwgdfq9vuip1xeylz4caq.png"><br><br>  Nous avons à nouveau une ligne droite avec deux points, et la première restriction est <strong>X = X <sub>1</sub></strong> .  Sur la diapositive, elle est rouge, c'est-à-dire cette restriction avec la priorité requise - nous l'appellerons une exigence. <br><br>  La disposition automatique la convertit en un système d'équations linéaires contenant une équation <strong>X = X <sub>1</sub></strong> .  Rien de plus - pas de tâches de programmation linéaire, pas d'optimisations. <br><br>  La situation est similaire avec les inégalités, mais un peu plus compliquée - <strong>une variable supplémentaire</strong> apparaîtra qui peut prendre toutes les valeurs supérieures à 0. Pour toute valeur supérieure à 0, cette restriction sera satisfaite.  Veuillez noter qu'ici, il n'y a pas de tâches de programmation linéaire et d'optimisations. <br><br>  Essayons de combiner tout cela ensemble, de réunir deux exigences et de les convertir en un seul système.  Un lecteur attentif a noté que nous étions arrivés au même problème que celui avec lequel nous avions commencé - les <strong>exigences devraient être cohérentes</strong> . <br><br><img src="https://habrastorage.org/webt/lj/fu/wx/ljfuwxbedffz_agc5ydwoxiv0os.png"><br><br>  Les contraintes de type <strong>requises</strong> ou exigences sont un <strong>outil très puissant,</strong> mais pas le principal, mais l'auxiliaire.  Il a été spécialement introduit dans Auto Layout pour résoudre le problème des intervalles infinis, il doit être utilisé avec précaution. <br><br>  Essayons de combiner tous les types de restrictions que nous avons rencontrées dans un seul système.  Supposons que nous voulons résoudre le problème non pas sur toute la ligne, mais seulement entre <strong>X <sub>0</sub></strong> et <strong>X <sub>3</sub> .</strong>  En transformant tout cela en un système d'équations et d'inégalités linéaires, nous obtenons ce qui suit. <br><br><img src="https://habrastorage.org/webt/nl/3k/lw/nl3klwil0nepuuqyjq-nmxxo0rs.png"><br><br>  Par rapport au système précédent, deux variables supplémentaires ont été ajoutées - <strong>c</strong> et <strong>d</strong> , mais elles n'entreront pas dans les fonctionnelles, car les restrictions du type requis n'affectent pas la fonctionnelle dans sa forme d'origine. <br><br>  Il semble que la tâche n'ait pas beaucoup changé - nous minimisons les mêmes qu'auparavant, mais la plage initiale de valeurs acceptables change, maintenant elle passe de <strong>X <sub>0</sub></strong> à <strong>X <sub>3</sub></strong> . <br><br><blockquote>  D'un point de vue mathématique, les exigences - restrictions du type requis - sont la capacité d'introduire des équations supplémentaires dans le système sans modifier ses fonctions. <br></blockquote><br>  Vous devez être très prudent avec cela, car un abus excessif des contraintes requises entraînera un <strong>problème sans solutions</strong> et la mise en page automatique ne le résoudra pas. <br><br>  Nous arrivons au dernier cinquième algorithme. <br><br><h3>  Algorithme n ° 5 <br></h3><br><ul><li>  Définir les restrictions nécessaires - les exigences de mise en page; </li><li>  créer une hiérarchie de contraintes linéaires; </li><li>  convertir toutes les contraintes en un problème de programmation linéaire; </li><li>  résoudre le problème de la programmation linéaire; </li><li>  appliquer la solution à UlView. </li></ul><br>  Nous avons examiné Cassowary - un algorithme qui est à l'intérieur de la mise en page automatique, mais quand il est implémenté, diverses fonctionnalités apparaissent. <br><br><h3>  Fonctionnalités IOS <br></h3><br>  <strong>Il n'y a aucun calcul dans layoutSubviews ()</strong> . <br><br>  Quand sont-ils produits?  Réponse: toujours, à tout moment la mise en page automatique est comptée.  Le calcul se produit exactement lorsque nous ajoutons des contraintes à notre vue ou les activons à l'aide de méthodes API modernes pour travailler avec des contraintes. <br><br><img src="https://habrastorage.org/webt/rf/rf/ca/rfrfca8zmtb5ukabvarjdfygbii.png"><br><br>  Nos vues sont des rectangles, mais le problème est que ces informations ne sont pas contenues dans le casoar, elles doivent y être en outre intégrées.  Nous avons un mécanisme pour introduire des restrictions supplémentaires.  Si nous introduisons pour chaque vue un ensemble de contraintes avec une largeur et une hauteur positives, alors nous aurons toujours des rectangles à la sortie.  C'est pourquoi nous ne pouvons pas rattraper la vue Disposition automatique avec des dimensions négatives. <br><br>  La deuxième caractéristique est <strong>intrinsicContentSize</strong> - la taille intrinsèque qui peut être définie pour chaque vue. <br><br><img src="https://habrastorage.org/webt/of/dx/dr/ofdxdrma4ob54homy7amohpvove.png"><br><br>  Il s'agit d'une interface simple pour créer 4 contraintes d'inégalité supplémentaires qui seront placées dans le système.  Ce mécanisme est très pratique, il vous permet de réduire le nombre de restrictions explicites, ce qui simplifie l'utilisation de la mise en page automatique.  Le dernier et le plus fin point qui est souvent oublié est <strong>TranslateAutoresizingMaskIntoConstraints.</strong> <br><br><img src="https://habrastorage.org/webt/xz/pz/su/xzpzsulxwqohzm-ehd5rz2kg148.png"><br><br>  Il s'agit d'une <strong>béquille qui a</strong> été introduite à l'époque d'iOS 5, afin que l'ancien code ne se casse pas après l'apparition de la mise en page automatique. <br><br>  Imaginez une situation: nous imposons une vue sur les contraintes.  À l'intérieur de la vue, nous utilisons la vue, qui ne connaît rien aux contraintes, tout se compose sur les cadres, mais à l'intérieur, elle tape la vue, qui a longtemps été traduite en contraintes. <br><br><blockquote>  Je vous rappelle qu'aucun cadre n'entre dans la tâche de mise en page automatique de Cassowary, seulement des limitations. <br></blockquote><br>  La taille et la position de la vue réduite sur les images ne sont pas entièrement déterminées par des contraintes.  Lors du calcul de la taille et de la position de toutes les autres vues, les tailles incorrectes seront prises en compte, même si après la mise en page automatique, nous y appliquerons les cadres corrects. <br><br>  Pour éviter cette situation, si la valeur de la variable TranslateAutoresizingMaskIntoConstraints est vraie, une restriction supplémentaire est appliquée à chaque vue disposée sur le cadre.  Cet ensemble de restrictions peut varier d'une exécution à l'autre.  Une seule chose est connue sur cet ensemble - sa trame sera celle qui a été transmise. <br><br>  La compatibilité entre l'ancien code écrit sans contraintes et le nouveau code écrit avec des contraintes peut souvent souffrir en raison d'une mauvaise utilisation de cette propriété.  Ces restrictions ont nécessairement la priorité des exigences, donc si nous imposons soudainement une contrainte à une telle vue, qui a une priorité très élevée, par exemple une exigence, nous pouvons accidentellement créer un système non cohérent qui n'aura pas de solutions. <br><br>  <strong>Il est important de savoir:</strong> <br><br><ul><li>  Si nous créons une vue depuis <strong>Interface Builder</strong> , la valeur par défaut de cette propriété sera <strong>false</strong> . </li><li>  Si nous créons une vue directement à partir du code, ce sera <strong>vrai</strong> . </li></ul><br>  L'idée est très simple - l'ancien code dans lequel la vue a été créée ne savait rien de la disposition automatique, et il était nécessaire de faire en sorte que si la vue était utilisée quelque part dans un nouvel endroit, cela fonctionnerait. <br><br><h2>  Conseils pratiques <br></h2><br>  Il y aura trois conseils en tout et commencer par le plus important. <br><br><h3>  Optimisation <br></h3><br><blockquote>  Il est important de localiser le problème. <br></blockquote><br>  Avez-vous déjà rencontré le problème de l'optimisation de l'écran, qui est présenté sur la disposition automatique?  Probablement pas, vous avez plus souvent rencontré le problème de l'optimisation de la disposition des cellules à l'intérieur d'un tableau ou d'une <strong>vue de collection</strong> . <br><br>  La disposition automatique est suffisamment optimisée pour créer n'importe quel écran et n'importe quelle interface, mais en faire 50 ou 100 à la fois est un problème pour elle.  Pour le localiser et l'optimiser, regardons l'expérience.  Les chiffres sont tirés d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> où Cassowary a été décrit pour la première fois. <br><img src="https://habrastorage.org/webt/jl/cb/qo/jlcbqo-0y685wxkbkniflmjlwli.png"><br><br>  La tâche est la suivante: nous créons une chaîne de vues une par une, et nous connectons chaque chaîne suivante à la précédente.  Ainsi, une séquence de 1000 éléments a été construite.  Après avoir mesuré diverses opérations, le temps est indiqué en millisecondes.  Les valeurs sont assez grandes, car la disposition automatique a été inventée à la jonction des années 80 et 90. <br><br>  En collectant une telle chaîne, vous pouvez agir comme suit: <br><br><ul><li>  <strong>Ajoutez une contrainte à la fois</strong> et décidez à chaque fois.  Cela prendra 38 secondes. </li><li>  Vous pouvez <strong>ajouter toutes les restrictions à la fois</strong> , puis résoudre le système uniquement.  Cette solution est plus efficace.  Selon les anciennes données, l'efficacité augmente de 70%, mais dans la mise en œuvre actuelle sur les appareils modernes, il n'y aura que 20%.  Mais un ajout qualitativement ponctuel de restrictions sera toujours plus efficace. </li><li>  Lorsque toute la chaîne est assemblée, vous pouvez <strong>ajouter une restriction supplémentaire</strong> .  Comme le montre le tableau, cette opération est assez bon marché. </li><li>  La chose la plus intéressante: <strong>si nous n'ajoutons aucune nouvelle restriction, mais changeons une constante dans l'une des restrictions existantes</strong> , c'est un ordre de grandeur plus efficace que la suppression ou la création d'une nouvelle restriction. </li></ul><br>  Les deux premiers points peuvent être décrits comme le calcul principal des interfaces, les deux derniers - comme le suivant. <br><br><h4>  Calcul de l'interface principale <br></h4><br>  Ici, vous pouvez utiliser les méthodes d'ajout en masse de contraintes pour l'optimisation: <br><br><ul><li>  <strong>NSLayoutConstraints.activate (_ :)</strong> - lors de la création d'une vue, collectez toutes les contraintes de manière séquentielle dans un tableau, mettez en cache et ajoutez-les ensuite à la fois. </li><li>  Ou créez des cellules dans <strong>Interface Builder.</strong>  Il fera tout pour nous et procédera à une optimisation supplémentaire, ce qui est souvent pratique. </li></ul><br><h4>  Calculs d'interface ultérieurs <br></h4><br>  L'ajout ou la modification d'une contrainte est une opération complexe. Il est donc préférable de <strong>ne pas modifier l'ensemble de contraintes, mais uniquement de modifier les constantes</strong> des contraintes existantes.     : <br><br><ul><li> <strong> UIView</strong> —     .   view   ,     Auto Layout.     ,    ,      view,     . </li><li> <strong>   </strong> <strong>— IntrinsicContentSize.</strong>  ,      ,     . </li><li> <strong>   </strong> .         , ,   . </li></ul><br>     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WWDC 2018S220 High Performance Auto Layout</a> .   — Apple         ,     . <br><br><h2>   <br></h2><br>      ,       constraints. <br><br><h3>    <br></h3><br>   required ,  —   ,       ,     .    . <br><br><blockquote>      ,    . <br></blockquote><br>     : <br><br><ul><li> <strong>  ,   </strong> .      (  loader) —     . </li><li> <strong>  ,   </strong> .     ,     . </li></ul><br><br><h3>   <br></h3><br>   ,          ,   . <br><br>   <strong>constraint   required,     </strong> .    , ,    ,       .    ,      . <br><br>   — <strong>  ,    </strong> .     ,        —     .   -    ,        ,      . Auto Layout      ,      . <br><br> <strong>     </strong> ,       .      .  ,       ,    ,   .        layout,  ,    ,      .        . <br><br><h3>   <br></h3><br> <strong> —   </strong> ,    Auto Layout,          ,     . <br><br>  ,  required,  ,    <strong>   </strong> .   : <br><br><ul><li>   ,     . </li><li>  ,   ,     . </li></ul><br>  ,       ,  <strong> ,     </strong> . <br><br>            ,      . ,     ,          ,    .  , <strong> —   </strong> .      . <br><br> <strong>   —    .</strong>      ,       ,     ,   —     ,     —   required      -. <br><br>  <b>Liens utiles:</b> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Résolution des contraintes arithmétiques linéaires pour les applications d'interface utilisateur </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La contrainte linéaire Cassowary Résoudre les contraintes de l'algorithme en </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tant que modèle de conception </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guide de mise en page automatique par Apple </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WWDC 2018 Session 220 Disposition automatique haute performance </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Magic UILabel ou mise en page automatique de l'API privée - Alexander Goremykin </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medium Blog Yandex.Map</font></font></a> <br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en passant, nous avons déjà accepté </font><font style="vertical-align: inherit;">le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapport</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d'Anton dans le programme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AppsConf 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Permettez-moi de vous rappeler que nous avons déplacé AppsConf de l'automne au printemps, et la prochaine conférence la plus utile pour les développeurs mobiles se tiendra les 22 et 23 avril. </font><font style="vertical-align: inherit;">Il est temps de réfléchir au sujet de présentation et de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soumettre un rapport</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou de discuter avec le chef de file de l'importance d'aller à la conférence et de réserver un billet.</font></font><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr437584/">https://habr.com/ru/post/fr437584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr437574/index.html">Le backend WhatsApp, Facebook Messenger, Instagram vont s'unir et ajouter un cryptage de bout en bout</a></li>
<li><a href="../fr437576/index.html">Conférence DEFCON 17. Mes échecs. Partie 1</a></li>
<li><a href="../fr437578/index.html">Conférence DEFCON 17. Mes échecs. 2e partie</a></li>
<li><a href="../fr437580/index.html">Comment se souvenir d'un manuel JavaScript en 5 jours, ou du «Palais de la mémoire» dans la vie quotidienne d'un programmeur</a></li>
<li><a href="../fr437582/index.html">Présentation de Vue.js 2.6</a></li>
<li><a href="../fr437586/index.html">Nous créons une application vocale en utilisant l'exemple de Google Assistant</a></li>
<li><a href="../fr437588/index.html">Est-ce plus amusant à développer pour les téléphones portables que pour le web?</a></li>
<li><a href="../fr437590/index.html">Numéros de latence sur iPhone</a></li>
<li><a href="../fr437592/index.html">Architecture de couche d'exécution de tâche asynchrone</a></li>
<li><a href="../fr437594/index.html">Comment j'ai éradiqué la cause du bégaiement et du saut de trame dans tous les jeux, et aussi abaissé accidentellement la température de 15 degrés</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>