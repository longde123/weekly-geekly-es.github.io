<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëµüèø üë®üèº‚Äç‚öñÔ∏è üéå Les bases math√©matiques de la mise en page automatique üë©üèº‚Äçüåæ üë®üèΩ‚Äç‚úàÔ∏è üëÇüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nombreux d√©veloppeurs pensent que la disposition automatique est un frein et un probl√®me, et il est extr√™mement difficile de la d√©boguer. Et c'est ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Les bases math√©matiques de la mise en page automatique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/437584/">  De nombreux d√©veloppeurs pensent que la disposition automatique est un frein et un probl√®me, et il est extr√™mement difficile de la d√©boguer.  Et c'est bien si cette conclusion est faite sur la base de ma propre exp√©rience, et parfois c'est juste "J'ai entendu, je n'essaierai m√™me pas de me faire des amis". <br><br>  Mais peut-√™tre que la raison n'est pas √† l'ext√©rieur, mais √† l'int√©rieur.  Par exemple, les oiseaux les plus dangereux du monde du casoar n'attaqueront pas les gens sans raison, uniquement pour se d√©fendre.  Par cons√©quent, essayez de supposer une seconde que ce n'est pas une mauvaise disposition automatique, que vous ne la comprenez pas assez bien et ne savez pas comment cuisiner.  C'est ce qu'Anton Sergeyev a fait et s'est plong√© dans la th√©orie afin de tout comprendre exactement.  On nous offre une compression pr√™te √† l'emploi sur les fondements math√©matiques de la mise en page automatique. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xm/53/dw/xm53dwqnl0lczpswansphdrgbpi.png" width="360"></div><br><br><a name="habracut"></a><br>  La mise en page automatique est un <strong>syst√®me de mise en page</strong> .  Avant de nous y plonger, parlons de la composition moderne en g√©n√©ral.  Ensuite, traitons de la <strong>disposition automatique</strong> - nous d√©terminerons <strong>quelle t√¢che elle r√©sout</strong> et comment elle le fait.  Examinons les <strong>fonctionnalit√©s de l'impl√©mentation de la mise en page automatique dans iOS</strong> et essayons de d√©velopper <strong>des conseils pratiques</strong> qui peuvent vous aider √† travailler avec. <br><br>  Cette histoire sera tr√®s proche d'un article math√©matique, donc on s'entend d'abord sur la notation pour parler le m√™me langage. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/-eGciYD9i3I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <strong>√Ä propos du conf√©rencier:</strong> Anton Sergeev ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">antonsergeev88</a> ) travaille dans l'√©quipe Yandex.Mart, s'occupe du client mobile pour Maps sur iOS.  Avant le d√©veloppement mobile, il a trait√© des syst√®mes de contr√¥le des centrales √©lectriques, o√π le co√ªt des erreurs dans le code est trop √©lev√© pour √™tre tol√©r√©. <br><br><h2>  D√©signations <br></h2><br>  Les syst√®mes d'√©quations lin√©aires nous sont familiers depuis l'√©cole - ils sont indiqu√©s par un crochet et leur solution est d√©j√† sans.  De plus, les syst√®mes d'√©quations lin√©aires ont des entit√©s qui fonctionnent avec des restrictions de disposition automatique.  Ils sont indiqu√©s par une ligne droite. <br><br><img src="https://habrastorage.org/webt/ql/qb/sa/qlqbsasmt7hb37gbgal6han6-4c.png"><br><br>  L'oiseau √©trange et, comme nous le savons d√©j√†, dangereux n'est pas accidentellement peint dans le coin sup√©rieur du toboggan.  En l'honneur du casoar (casoar lat.), Qui, bien s√ªr, vit en Australie, un algorithme est nomm√© dans tous nos iPhones. <br><br>  La disposition automatique a ses propres limites, nous les d√©signerons par des couleurs par ordre de priorit√©: rouge - obligatoire;  jaune - haut;  bleu - bas. <br><br><h2>  Disposition <br></h2><br>  Lors de la r√©daction de la pr√©sentation, j'ai plac√© divers √©l√©ments √† l'√©cran, par exemple un casoar.  Pour ce faire, j'ai d√©termin√© que le casoar √©tait une image rectangulaire.  Vous devez l'organiser sur une feuille qui a des axes et son propre syst√®me de coordonn√©es, et pour cela j'ai d√©termin√© les coordonn√©es du coin sup√©rieur gauche, la largeur et la hauteur. <br><br><img src="https://habrastorage.org/webt/5s/rq/ci/5srqci-zsre1tg_nbnn3grczdno.png"><br><br>  Conna√Ætre ces quatre valeurs suffit pour repr√©senter n'importe quelle vue. <br><br><h3>  Algorithme n ¬∞ 1 <br></h3><br>  En pla√ßant le casoar sur la feuille, nous avons discr√®tement d√©crit le premier algorithme de mise en page: <br><br><ul><li>  d√©terminer les coordonn√©es et les tailles; </li><li>  appliquez-les √† UIView. </li></ul><br>  L'algorithme fonctionne, mais est assez difficile √† utiliser, nous allons donc le simplifier davantage. <br><br>  Supposons que ci-dessous soit une solution √† un syst√®me d'√©quations lin√©aires. <br><br><img src="https://habrastorage.org/webt/ca/6i/ab/ca6iabqohj0bqr1rmujisor9fv4.png"><br><br>  Le syst√®me d'√©quations lin√©aires est particulier en ce que de nombreuses op√©rations y sont d√©finies: pliage de lignes, multiplication par constantes, etc.  Ces op√©rations sont appel√©es transformations lin√©aires et, avec leur aide, le syst√®me est r√©duit √† une forme arbitraire. <br><br>  La beaut√© des transformations lin√©aires est qu'elles sont r√©versibles.  Cela nous am√®ne √† une id√©e int√©ressante et plut√¥t subtile avec laquelle commence toute la mise en page moderne. <br><br>  Soit une vue - un rectangle avec ses coordonn√©es et sa taille.  Nous voulons l'arranger pour que le centre co√Øncide avec le point donn√©.  Nous mod√©lisons le centre √† l'aide de transformations lin√©aires - les <strong>coordonn√©es du coin sup√©rieur gauche + la moiti√© de la largeur</strong> . <br><br><img src="https://habrastorage.org/webt/yg/el/ic/ygelic6e5xa6orhvnaz7g5p_cki.png"><br><br>  Nous avons mod√©lis√© le centre par transformation lin√©aire, ce n'√©tait pas le cas: il n'y avait que les coordonn√©es du point sup√©rieur gauche, la largeur et la hauteur. <br><br>  De m√™me, vous pouvez simuler toute autre indentation, par exemple, √† 20 points du coin droit. <br><br><blockquote>  C'est l'id√©e de transformations lin√©aires qui nous permet de cr√©er diff√©rents syst√®mes de composition. <br></blockquote><br>  Prenons un exemple √©l√©mentaire.  Nous √©crivons un syst√®me avec lequel nous √©tablissons les coordonn√©es du milieu et du c√¥t√© droit, la largeur et la relation entre la largeur et la hauteur.  Nous r√©solvons le syst√®me et obtenons la r√©ponse. <br><br><img src="https://habrastorage.org/webt/hc/xc/hu/hcxchuyy2qvuvati_laj8afryig.png"><br><br>  Nous arrivons donc au deuxi√®me algorithme. <br><br><h3>  Algorithme n ¬∞ 2 <br></h3><br>  La deuxi√®me it√©ration de l'algorithme se compose des √©l√©ments suivants: <br><br><ul><li>  constituer un syst√®me d'√©quations lin√©aires; </li><li>  nous le r√©solvons; </li><li>  appliquer la solution √† UIView. </li></ul><br>  Imaginez que nous √©tions au XXe si√®cle, √† une √©poque o√π l'√©quipement informatique n'en √©tait qu'√† ses balbutiements, et que nous avons √©t√© les premiers √† cr√©er notre propre syst√®me de mise en page.  Invent√©, emball√©, donn√© √† l'utilisateur, et il commence √† l'utiliser - remplit les param√®tres initiaux et le transf√®re √† notre syst√®me. <br><br><img src="https://habrastorage.org/webt/8b/np/wk/8bnpwkt2ufktqh1wa7dtumctozs.png"><br><br>  Il y a un probl√®me - ce syst√®me n'a pas de solution unique.  Le probl√®me n'est pas exceptionnel, absolument tous les syst√®mes de mise en page s'y heurtent, et est appel√© le <strong>manque de solution</strong> . <br><br>  Il n'y a pas tant de fa√ßons de sortir de cette situation: <br><br><ul><li>  Vous pouvez <strong>tomber</strong> - c'est une m√©thode tr√®s courante.  Ceux qui travaillent avec MacOS savent que NSLayoutConstraintManager fait exactement cela. </li><li>  <strong>Renvoie la valeur par d√©faut</strong> .  Dans le cadre de la mise en page, nous pouvons toujours retourner tous les z√©ros. </li><li>  Une mani√®re plus connue et d√©licate consiste <strong>√† emp√™cher une entr√©e incorrecte</strong> .  Cette m√©thode est utilis√©e par les syst√®mes de mise en page populaires, par exemple le <strong>Yoga</strong> , appel√© <strong>Flex Layout</strong> .  Ces syst√®mes essaient de cr√©er une interface qui ne permettra pas une entr√©e incorrecte. </li><li>  Il y a une autre fa√ßon de r√©soudre absolument tous les probl√®mes - de <strong>tout repenser d√®s le d√©but</strong> et d'abord <strong>d'√©viter l'apparition de ce probl√®me</strong> .  La disposition automatique s'est d√©roul√©e de cette fa√ßon. </li></ul><br><h2>  Disposition automatique  √ânonc√© et solution du probl√®me <br></h2><br>  Nous avons une image rectangulaire et pour l'identifier de mani√®re unique, nous avons besoin de 4 param√®tres: <br><br><ul><li>  coordonn√©es du coin sup√©rieur gauche; </li><li>  largeur et hauteur. </li></ul><br><img src="https://habrastorage.org/webt/9k/m4/mn/9km4mnazc-bszyeglny7jgury1k.png"><br><br>  La mise en page automatique est tr√®s d√©taill√©e.  Compar√© √† un syst√®me d'√©quations lin√©aires, il est beaucoup plus difficile de tout placer sur l'√©cran avec lui.  Par cons√©quent, nous consid√©rerons, sans perte de g√©n√©ralit√©, le cas unidimensionnel. <br><br><img src="https://habrastorage.org/webt/yy/g-/bz/yyg-bzfkdyhagrqn28bj7ruydg8.png"><br><br>  Tout est tr√®s simple: l'espace est une ligne droite, et tous les objets qui peuvent y √™tre plac√©s sont des points sur une ligne droite.  Une valeur: <strong>X = X <sub>P</sub></strong> suffit pour d√©terminer la position du point. <br><br>  Consid√©rez l'approche de mise en page automatique.  Il existe un espace dans lequel des restrictions sont d√©finies.  La solution que nous voulons obtenir est <strong>X = X <sub>0</sub></strong> , et aucune autre. <br><br>  Il y a un probl√®me - nous n'avons pas d√©fini d'op√©rations avec des restrictions.  Nous ne pouvons pas conclure directement de l'enregistrement que <strong>X = X <sub>0</sub></strong> , nous ne pouvons rien multiplier ou ajouter quoi que ce soit √† quoi que ce soit.  Pour ce faire, nous devons transformer la contrainte en ce avec quoi nous pouvons travailler - en un syst√®me d'√©quations et d'in√©galit√©s. <br><br><img src="https://habrastorage.org/webt/dc/ru/gr/dcrugrl3rwq6esfcnrlz89ora8o.png"><br><br>  La disposition automatique transforme un syst√®me d'√©quations et d'in√©galit√©s comme suit. <br><br><ul><li>  Introduit d'abord 2 variables suppl√©mentaires qui <strong>ne</strong> sont <strong>pas n√©gatives</strong> et <strong>d√©pendent les unes des autres</strong> .  Au moins l'un d'eux est √©gal √† z√©ro. </li><li>  La contrainte elle-m√™me est convertie en notation <strong>X = X <sub>0</sub> + a <sup>+</sup> - a <sup>-</sup></strong> . </li></ul><br>  Point <strong>X <sub>0</sub></strong> <sub>&nbsp;</sub>  - solution du syst√®me: si <strong>a <sup>+</sup></strong> et <strong>a <sup>-</sup></strong> sont √©gaux √† z√©ro, alors ce sera vrai.  Mais <strong>tout autre point</strong> sur cette ligne sera une solution. <br><br>  Par cons√©quent, il est n√©cessaire de trouver le meilleur parmi l'ensemble des solutions.  Pour ce faire, nous introduisons une fonction - une fonction ordinaire qui renvoie un nombre, et nous pouvons comparer les nombres.  Nous dessinons un graphique et notons que la solution que nous voulions √† l'origine est un minimum. <br><br>  Vous avez <strong>un probl√®me de programmation lin√©aire</strong> .  C'est exactement ce que fait Auto Layout avec les contraintes, qui sont non seulement sous forme d'√©galit√©s, mais aussi d'in√©galit√©s. <br><br><h3>  Contraintes d'in√©galit√© <br></h3><br>  Dans le cas des restrictions d'in√©galit√©, la transformation se produit de la m√™me mani√®re que pour les √©galit√©s: deux variables suppl√©mentaires sont introduites et tout cela est collect√© dans le syst√®me.  Seule la fonctionnelle est diff√©rente, et elle est √©gale √† <strong>a <sup>-</sup></strong> . <br><br><img src="https://habrastorage.org/webt/su/lp/db/sulpdbiqpzdvnd2s23qwo3zg3p0.png"><br><br>  Le graphique ci-dessus montre pourquoi il en est ainsi - toute valeur de <strong>a <sup>+</sup></strong> avec <strong>a <sup>-</sup> = 0</strong> (de <strong>X <sub>0</sub></strong> √† <strong>+ ‚àû</strong> ) sera la solution optimale pour le probl√®me. <br><br>  Essayons de combiner ces deux restrictions d'√©quations et d'in√©galit√©s en une seule - parce que les restrictions ne vivent pas isol√©ment, elles sont appliqu√©es ensemble √† l'ensemble du syst√®me. <br><br><img src="https://habrastorage.org/webt/kv/p4/ed/kvp4ed32qay13--nhn6neefffd0.png"><br><br>  Pour chaque contrainte, une paire de variables suppl√©mentaires est introduite et la fonction est compil√©e.  Puisque nous voulons que toutes ces restrictions soient remplies simultan√©ment, la <strong>fonctionnelle sera √©gale √† la somme de toutes les fonctionnelles de chaque restriction</strong> . <br><br>  Nous collectons la fonction f et voyons que la solution est <strong>X <sub>1</sub></strong> .  Comme nous nous y attendions, faire des restrictions.  Nous arrivons donc au troisi√®me algorithme. <br><br><h3>  Algorithme n ¬∞ 3 <br></h3><br>  Pour faire quelque chose, il faut: <br><br><ul><li>  cr√©er un syst√®me de contraintes lin√©aires; </li><li>  le transformer en un probl√®me de programmation lin√©aire; </li><li>  r√©soudre le probl√®me de toute mani√®re connue, par exemple, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©thode simplex</a> utilis√©e dans la mise en page automatique; </li><li>  appliquer la solution √† UIView. </li></ul><br>  Cet algorithme semble suffisant, mais consid√©rons le cas suivant: on change l'ensemble initial de contraintes pour que la deuxi√®me contrainte soit maintenant <strong>X ‚â• X</strong> <strong><sub>2</sub></strong> . <br><br><img src="https://habrastorage.org/webt/li/dd/at/liddathmoov5umsnhvnoevax6jy.png"><br><br>  Quelle solution attendons-nous? <br><br><ul><li>  <strong>X <sub>1</sub></strong> ?  En effet, dans la premi√®re restriction, il s'√©crit ainsi: <strong>X = X <sub>1</sub></strong> , et cette solution entre en conflit avec la deuxi√®me restriction. </li><li>  <strong>X <sub>2</sub></strong> ?  Il y aura d√©j√† un conflit avec la premi√®re restriction. </li></ul><br>  Pour sortir de la situation, nous allons effectuer des transformations que nous savons d√©j√† faire. <br><br>  Le graphique de la nouvelle fonctionnalit√© est diff√©rent: tout point de l'intervalle de <strong>X <sub>1</sub></strong> √† <strong>X <sub>2</sub></strong> sera la bonne solution valide du syst√®me.  C'est ce qu'on appelle l' <strong>incertitude</strong> . <br><br><h3>  Incertitude <br></h3><br>  La disposition automatique a un m√©canisme pour r√©soudre ces probl√®mes - les <strong>priorit√©s</strong> .  Je vous rappelle que le jaune indique une priorit√© √©lev√©e et le bleu - faible. <br><br><img src="https://habrastorage.org/webt/7e/go/is/7egoisncevkoitvo8fdxkvcdg7g.png"><br><br>  Convertir les restrictions.  Veuillez noter que le syst√®me r√©sultant est simplement noir.  Nous savons comment travailler avec, et il n'y a aucune information sur les restrictions.  C'est dans les fonctionnalit√©s, dont il y en aura deux.  La disposition automatique r√©duira d'abord le premier, puis le second. <br><br>  Dans les probl√®mes de programmation lin√©aire, nous ne recherchons pas la solution elle-m√™me, mais la gamme de solutions r√©alisables.  Bien s√ªr, nous voulons que cette zone ne soit qu'un seul point, et la mise en page automatique agit de la m√™me mani√®re.  Premi√®rement, il minimise la fonction la plus prioritaire sur ( <strong>-</strong> <strong>‚àû,</strong> <strong>+ ‚àû)</strong> et, en sortie, re√ßoit un domaine de solutions r√©alisables.  La disposition automatique r√©sout d√©j√† le deuxi√®me probl√®me de programmation lin√©aire sur la plage obtenue de valeurs admissibles.  Un tel m√©canisme est appel√© une <strong>hi√©rarchie de contraintes</strong> , et dans ce probl√®me donne le point <strong>X <sub>2</sub></strong> . <br><br><h3>  Algorithme n ¬∞ 4 <br></h3><br><ul><li>  Cr√©ez une hi√©rarchie de contraintes lin√©aires; </li><li>  le transformer en t√¢che de programmation lin√©aire; </li><li>  r√©soudre s√©quentiellement le probl√®me de programmation lin√©aire - de la priorit√© la plus √©lev√©e √† la priorit√© la plus faible. </li><li>  appliquer la solution √† UlView. </li></ul><br>  Reprenons la t√¢che pr√©c√©dente.  Nous ne sommes pas des math√©maticiens, mais des ing√©nieurs, et tout ing√©nieur doit √™tre confondu ici. <br><br>  Il y a un grave probl√®me ici - l' <strong>infini</strong> , et je ne sais pas ce que c'est. <br><br>  L'algorithme Cassowary sous le capot de la mise en page automatique n'√©tait pas un m√©canisme existant qui tombait commod√©ment sur la t√¢che de mise en page automatique, mais a √©t√© pens√© comme un outil de mise en page, et il a fourni des m√©canismes sp√©ciaux pour √©chapper √† l'infini au tout d√©but.  Pour cela, plusieurs types de restrictions ont √©t√© invent√©s: <br><br><ul><li>  <strong>Les param√®tres</strong> sont les contraintes avec lesquelles nous avons travaill√©.  Elles sont appel√©es <strong>pr√©f√©rences</strong> dans l'original <strong>,</strong> parfois dans la documentation Apple - <strong>contraintes facultatives</strong> . </li><li>  <strong>Exigences</strong> ou exigences - restrictions avec priorit√© <strong>requises</strong> . </li></ul><br>  Voyons comment les exigences avec de telles priorit√©s sont transform√©es du point de vue des math√©matiques. <br><br><img src="https://habrastorage.org/webt/hm/mn/my/hmmnmycwgdfq9vuip1xeylz4caq.png"><br><br>  Nous avons √† nouveau une ligne droite avec deux points, et la premi√®re restriction est <strong>X = X <sub>1</sub></strong> .  Sur la diapositive, elle est rouge, c'est-√†-dire cette restriction avec la priorit√© requise - nous l'appellerons une exigence. <br><br>  La disposition automatique la convertit en un syst√®me d'√©quations lin√©aires contenant une √©quation <strong>X = X <sub>1</sub></strong> .  Rien de plus - pas de t√¢ches de programmation lin√©aire, pas d'optimisations. <br><br>  La situation est similaire avec les in√©galit√©s, mais un peu plus compliqu√©e - <strong>une variable suppl√©mentaire</strong> appara√Ætra qui peut prendre toutes les valeurs sup√©rieures √† 0. Pour toute valeur sup√©rieure √† 0, cette restriction sera satisfaite.  Veuillez noter qu'ici, il n'y a pas de t√¢ches de programmation lin√©aire et d'optimisations. <br><br>  Essayons de combiner tout cela ensemble, de r√©unir deux exigences et de les convertir en un seul syst√®me.  Un lecteur attentif a not√© que nous √©tions arriv√©s au m√™me probl√®me que celui avec lequel nous avions commenc√© - les <strong>exigences devraient √™tre coh√©rentes</strong> . <br><br><img src="https://habrastorage.org/webt/lj/fu/wx/ljfuwxbedffz_agc5ydwoxiv0os.png"><br><br>  Les contraintes de type <strong>requises</strong> ou exigences sont un <strong>outil tr√®s puissant,</strong> mais pas le principal, mais l'auxiliaire.  Il a √©t√© sp√©cialement introduit dans Auto Layout pour r√©soudre le probl√®me des intervalles infinis, il doit √™tre utilis√© avec pr√©caution. <br><br>  Essayons de combiner tous les types de restrictions que nous avons rencontr√©es dans un seul syst√®me.  Supposons que nous voulons r√©soudre le probl√®me non pas sur toute la ligne, mais seulement entre <strong>X <sub>0</sub></strong> et <strong>X <sub>3</sub> .</strong>  En transformant tout cela en un syst√®me d'√©quations et d'in√©galit√©s lin√©aires, nous obtenons ce qui suit. <br><br><img src="https://habrastorage.org/webt/nl/3k/lw/nl3klwil0nepuuqyjq-nmxxo0rs.png"><br><br>  Par rapport au syst√®me pr√©c√©dent, deux variables suppl√©mentaires ont √©t√© ajout√©es - <strong>c</strong> et <strong>d</strong> , mais elles n'entreront pas dans les fonctionnelles, car les restrictions du type requis n'affectent pas la fonctionnelle dans sa forme d'origine. <br><br>  Il semble que la t√¢che n'ait pas beaucoup chang√© - nous minimisons les m√™mes qu'auparavant, mais la plage initiale de valeurs acceptables change, maintenant elle passe de <strong>X <sub>0</sub></strong> √† <strong>X <sub>3</sub></strong> . <br><br><blockquote>  D'un point de vue math√©matique, les exigences - restrictions du type requis - sont la capacit√© d'introduire des √©quations suppl√©mentaires dans le syst√®me sans modifier ses fonctions. <br></blockquote><br>  Vous devez √™tre tr√®s prudent avec cela, car un abus excessif des contraintes requises entra√Ænera un <strong>probl√®me sans solutions</strong> et la mise en page automatique ne le r√©soudra pas. <br><br>  Nous arrivons au dernier cinqui√®me algorithme. <br><br><h3>  Algorithme n ¬∞ 5 <br></h3><br><ul><li>  D√©finir les restrictions n√©cessaires - les exigences de mise en page; </li><li>  cr√©er une hi√©rarchie de contraintes lin√©aires; </li><li>  convertir toutes les contraintes en un probl√®me de programmation lin√©aire; </li><li>  r√©soudre le probl√®me de la programmation lin√©aire; </li><li>  appliquer la solution √† UlView. </li></ul><br>  Nous avons examin√© Cassowary - un algorithme qui est √† l'int√©rieur de la mise en page automatique, mais quand il est impl√©ment√©, diverses fonctionnalit√©s apparaissent. <br><br><h3>  Fonctionnalit√©s IOS <br></h3><br>  <strong>Il n'y a aucun calcul dans layoutSubviews ()</strong> . <br><br>  Quand sont-ils produits?  R√©ponse: toujours, √† tout moment la mise en page automatique est compt√©e.  Le calcul se produit exactement lorsque nous ajoutons des contraintes √† notre vue ou les activons √† l'aide de m√©thodes API modernes pour travailler avec des contraintes. <br><br><img src="https://habrastorage.org/webt/rf/rf/ca/rfrfca8zmtb5ukabvarjdfygbii.png"><br><br>  Nos vues sont des rectangles, mais le probl√®me est que ces informations ne sont pas contenues dans le casoar, elles doivent y √™tre en outre int√©gr√©es.  Nous avons un m√©canisme pour introduire des restrictions suppl√©mentaires.  Si nous introduisons pour chaque vue un ensemble de contraintes avec une largeur et une hauteur positives, alors nous aurons toujours des rectangles √† la sortie.  C'est pourquoi nous ne pouvons pas rattraper la vue Disposition automatique avec des dimensions n√©gatives. <br><br>  La deuxi√®me caract√©ristique est <strong>intrinsicContentSize</strong> - la taille intrins√®que qui peut √™tre d√©finie pour chaque vue. <br><br><img src="https://habrastorage.org/webt/of/dx/dr/ofdxdrma4ob54homy7amohpvove.png"><br><br>  Il s'agit d'une interface simple pour cr√©er 4 contraintes d'in√©galit√© suppl√©mentaires qui seront plac√©es dans le syst√®me.  Ce m√©canisme est tr√®s pratique, il vous permet de r√©duire le nombre de restrictions explicites, ce qui simplifie l'utilisation de la mise en page automatique.  Le dernier et le plus fin point qui est souvent oubli√© est <strong>TranslateAutoresizingMaskIntoConstraints.</strong> <br><br><img src="https://habrastorage.org/webt/xz/pz/su/xzpzsulxwqohzm-ehd5rz2kg148.png"><br><br>  Il s'agit d'une <strong>b√©quille qui a</strong> √©t√© introduite √† l'√©poque d'iOS 5, afin que l'ancien code ne se casse pas apr√®s l'apparition de la mise en page automatique. <br><br>  Imaginez une situation: nous imposons une vue sur les contraintes.  √Ä l'int√©rieur de la vue, nous utilisons la vue, qui ne conna√Æt rien aux contraintes, tout se compose sur les cadres, mais √† l'int√©rieur, elle tape la vue, qui a longtemps √©t√© traduite en contraintes. <br><br><blockquote>  Je vous rappelle qu'aucun cadre n'entre dans la t√¢che de mise en page automatique de Cassowary, seulement des limitations. <br></blockquote><br>  La taille et la position de la vue r√©duite sur les images ne sont pas enti√®rement d√©termin√©es par des contraintes.  Lors du calcul de la taille et de la position de toutes les autres vues, les tailles incorrectes seront prises en compte, m√™me si apr√®s la mise en page automatique, nous y appliquerons les cadres corrects. <br><br>  Pour √©viter cette situation, si la valeur de la variable TranslateAutoresizingMaskIntoConstraints est vraie, une restriction suppl√©mentaire est appliqu√©e √† chaque vue dispos√©e sur le cadre.  Cet ensemble de restrictions peut varier d'une ex√©cution √† l'autre.  Une seule chose est connue sur cet ensemble - sa trame sera celle qui a √©t√© transmise. <br><br>  La compatibilit√© entre l'ancien code √©crit sans contraintes et le nouveau code √©crit avec des contraintes peut souvent souffrir en raison d'une mauvaise utilisation de cette propri√©t√©.  Ces restrictions ont n√©cessairement la priorit√© des exigences, donc si nous imposons soudainement une contrainte √† une telle vue, qui a une priorit√© tr√®s √©lev√©e, par exemple une exigence, nous pouvons accidentellement cr√©er un syst√®me non coh√©rent qui n'aura pas de solutions. <br><br>  <strong>Il est important de savoir:</strong> <br><br><ul><li>  Si nous cr√©ons une vue depuis <strong>Interface Builder</strong> , la valeur par d√©faut de cette propri√©t√© sera <strong>false</strong> . </li><li>  Si nous cr√©ons une vue directement √† partir du code, ce sera <strong>vrai</strong> . </li></ul><br>  L'id√©e est tr√®s simple - l'ancien code dans lequel la vue a √©t√© cr√©√©e ne savait rien de la disposition automatique, et il √©tait n√©cessaire de faire en sorte que si la vue √©tait utilis√©e quelque part dans un nouvel endroit, cela fonctionnerait. <br><br><h2>  Conseils pratiques <br></h2><br>  Il y aura trois conseils en tout et commencer par le plus important. <br><br><h3>  Optimisation <br></h3><br><blockquote>  Il est important de localiser le probl√®me. <br></blockquote><br>  Avez-vous d√©j√† rencontr√© le probl√®me de l'optimisation de l'√©cran, qui est pr√©sent√© sur la disposition automatique?  Probablement pas, vous avez plus souvent rencontr√© le probl√®me de l'optimisation de la disposition des cellules √† l'int√©rieur d'un tableau ou d'une <strong>vue de collection</strong> . <br><br>  La disposition automatique est suffisamment optimis√©e pour cr√©er n'importe quel √©cran et n'importe quelle interface, mais en faire 50 ou 100 √† la fois est un probl√®me pour elle.  Pour le localiser et l'optimiser, regardons l'exp√©rience.  Les chiffres sont tir√©s d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> o√π Cassowary a √©t√© d√©crit pour la premi√®re fois. <br><img src="https://habrastorage.org/webt/jl/cb/qo/jlcbqo-0y685wxkbkniflmjlwli.png"><br><br>  La t√¢che est la suivante: nous cr√©ons une cha√Æne de vues une par une, et nous connectons chaque cha√Æne suivante √† la pr√©c√©dente.  Ainsi, une s√©quence de 1000 √©l√©ments a √©t√© construite.  Apr√®s avoir mesur√© diverses op√©rations, le temps est indiqu√© en millisecondes.  Les valeurs sont assez grandes, car la disposition automatique a √©t√© invent√©e √† la jonction des ann√©es 80 et 90. <br><br>  En collectant une telle cha√Æne, vous pouvez agir comme suit: <br><br><ul><li>  <strong>Ajoutez une contrainte √† la fois</strong> et d√©cidez √† chaque fois.  Cela prendra 38 secondes. </li><li>  Vous pouvez <strong>ajouter toutes les restrictions √† la fois</strong> , puis r√©soudre le syst√®me uniquement.  Cette solution est plus efficace.  Selon les anciennes donn√©es, l'efficacit√© augmente de 70%, mais dans la mise en ≈ìuvre actuelle sur les appareils modernes, il n'y aura que 20%.  Mais un ajout qualitativement ponctuel de restrictions sera toujours plus efficace. </li><li>  Lorsque toute la cha√Æne est assembl√©e, vous pouvez <strong>ajouter une restriction suppl√©mentaire</strong> .  Comme le montre le tableau, cette op√©ration est assez bon march√©. </li><li>  La chose la plus int√©ressante: <strong>si nous n'ajoutons aucune nouvelle restriction, mais changeons une constante dans l'une des restrictions existantes</strong> , c'est un ordre de grandeur plus efficace que la suppression ou la cr√©ation d'une nouvelle restriction. </li></ul><br>  Les deux premiers points peuvent √™tre d√©crits comme le calcul principal des interfaces, les deux derniers - comme le suivant. <br><br><h4>  Calcul de l'interface principale <br></h4><br>  Ici, vous pouvez utiliser les m√©thodes d'ajout en masse de contraintes pour l'optimisation: <br><br><ul><li>  <strong>NSLayoutConstraints.activate (_ :)</strong> - lors de la cr√©ation d'une vue, collectez toutes les contraintes de mani√®re s√©quentielle dans un tableau, mettez en cache et ajoutez-les ensuite √† la fois. </li><li>  Ou cr√©ez des cellules dans <strong>Interface Builder.</strong>  Il fera tout pour nous et proc√©dera √† une optimisation suppl√©mentaire, ce qui est souvent pratique. </li></ul><br><h4>  Calculs d'interface ult√©rieurs <br></h4><br>  L'ajout ou la modification d'une contrainte est une op√©ration complexe. Il est donc pr√©f√©rable de <strong>ne pas modifier l'ensemble de contraintes, mais uniquement de modifier les constantes</strong> des contraintes existantes.     : <br><br><ul><li> <strong> UIView</strong> ‚Äî     .   view   ,     Auto Layout.     ,    ,      view,     . </li><li> <strong>   </strong> <strong>‚Äî IntrinsicContentSize.</strong>  ,      ,     . </li><li> <strong>   </strong> .         , ,   . </li></ul><br>     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WWDC 2018S220 High Performance Auto Layout</a> .   ‚Äî Apple         ,     . <br><br><h2>   <br></h2><br>      ,       constraints. <br><br><h3>    <br></h3><br>   required ,  ‚Äî   ,       ,     .    . <br><br><blockquote>      ,    . <br></blockquote><br>     : <br><br><ul><li> <strong>  ,   </strong> .      (  loader) ‚Äî     . </li><li> <strong>  ,   </strong> .     ,     . </li></ul><br><br><h3>   <br></h3><br>   ,          ,   . <br><br>   <strong>constraint   required,     </strong> .    , ,    ,       .    ,      . <br><br>   ‚Äî <strong>  ,    </strong> .     ,        ‚Äî     .   -    ,        ,      . Auto Layout      ,      . <br><br> <strong>     </strong> ,       .      .  ,       ,    ,   .        layout,  ,    ,      .        . <br><br><h3>   <br></h3><br> <strong> ‚Äî   </strong> ,    Auto Layout,          ,     . <br><br>  ,  required,  ,    <strong>   </strong> .   : <br><br><ul><li>   ,     . </li><li>  ,   ,     . </li></ul><br>  ,       ,  <strong> ,     </strong> . <br><br>            ,      . ,     ,          ,    .  , <strong> ‚Äî   </strong> .      . <br><br> <strong>   ‚Äî    .</strong>      ,       ,     ,   ‚Äî     ,     ‚Äî   required      -. <br><br>  <b>Liens utiles:</b> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©solution des contraintes arithm√©tiques lin√©aires pour les applications d'interface utilisateur </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La contrainte lin√©aire Cassowary R√©soudre les contraintes de l'algorithme en </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tant que mod√®le de conception </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Guide de mise en page automatique par Apple </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WWDC 2018 Session 220 Disposition automatique haute performance </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Magic UILabel ou mise en page automatique de l'API priv√©e - Alexander Goremykin </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medium Blog Yandex.Map</font></font></a> <br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en passant, nous avons d√©j√† accept√© </font><font style="vertical-align: inherit;">le </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rapport</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d'Anton dans le programme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AppsConf 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Permettez-moi de vous rappeler que nous avons d√©plac√© AppsConf de l'automne au printemps, et la prochaine conf√©rence la plus utile pour les d√©veloppeurs mobiles se tiendra les 22 et 23 avril. </font><font style="vertical-align: inherit;">Il est temps de r√©fl√©chir au sujet de pr√©sentation et de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soumettre un rapport</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou de discuter avec le chef de file de l'importance d'aller √† la conf√©rence et de r√©server un billet.</font></font><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr437584/">https://habr.com/ru/post/fr437584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr437574/index.html">Le backend WhatsApp, Facebook Messenger, Instagram vont s'unir et ajouter un cryptage de bout en bout</a></li>
<li><a href="../fr437576/index.html">Conf√©rence DEFCON 17. Mes √©checs. Partie 1</a></li>
<li><a href="../fr437578/index.html">Conf√©rence DEFCON 17. Mes √©checs. 2e partie</a></li>
<li><a href="../fr437580/index.html">Comment se souvenir d'un manuel JavaScript en 5 jours, ou du ¬´Palais de la m√©moire¬ª dans la vie quotidienne d'un programmeur</a></li>
<li><a href="../fr437582/index.html">Pr√©sentation de Vue.js 2.6</a></li>
<li><a href="../fr437586/index.html">Nous cr√©ons une application vocale en utilisant l'exemple de Google Assistant</a></li>
<li><a href="../fr437588/index.html">Est-ce plus amusant √† d√©velopper pour les t√©l√©phones portables que pour le web?</a></li>
<li><a href="../fr437590/index.html">Num√©ros de latence sur iPhone</a></li>
<li><a href="../fr437592/index.html">Architecture de couche d'ex√©cution de t√¢che asynchrone</a></li>
<li><a href="../fr437594/index.html">Comment j'ai √©radiqu√© la cause du b√©gaiement et du saut de trame dans tous les jeux, et aussi abaiss√© accidentellement la temp√©rature de 15 degr√©s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>