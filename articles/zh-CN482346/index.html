<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👷 🥀 🙋🏾 ASP.NET MVC-通过ADO.NET使用MySQL 👩🏿‍💻 🤾🏿 🌨️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="传统技术  警告：ASP.NET MVC和ADO.NET均已弃用。 建议将ASP.NET Core与现代ORM结合使用。 但是，如果您有兴趣，请阅读。 

 我大概已经三次使用ASP.NET MVC。 在使用ASP.NET WebForms十年后，切换到MVC技术有点困难，因为存在许多差异，因此列出...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ASP.NET MVC-通过ADO.NET使用MySQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482346/"><div class="spoiler">  <b class="spoiler_title">传统技术</b> <div class="spoiler_text">  <b>警告：ASP.NET MVC和ADO.NET均已弃用。</b>  <b>建议将ASP.NET Core与现代ORM结合使用。</b>  <b>但是，如果您有兴趣，请阅读。</b> <br></div></div><br> 我大概已经三次使用ASP.NET MVC。 在使用ASP.NET WebForms十年后，切换到MVC技术有点困难，因为存在许多差异，因此列出这些技术的共同点比较容易，但.NET Framework库除外。 我不会在这里写-MVC比WebForms更好或更差，它们都很好，并且您可以在这两种技术上构建良好的应用程序。 尽管我有想法，但我也把对TDD的需求留给了我。 <br><br> 现在，我将讨论最标准的任务-数据的常规工作：以表格形式查看记录列表，添加，更改和删除数据（CRUD操作）。 但是，由于某种原因，在几乎所有书籍和许多用于ASP.NET MVC的Internet解决方案中，仅通过ORM（对象关系映射）考虑该选项：实体框架（EF）或LINQ for SQL。 毫无疑问，这些技术都是极好的，最后，程序员可能不会理解-但是这种非常相关的DBMS（他最有可能使用的）通常是如何工作的，从理论上讲，甚至不再需要SQL：以EF和DBMS的连接器将相互理解。  “这里是幸福-不再有美丽。” 但是，对于那些不害怕通过ADO.NET机制直接与数据库一起工作的程序员，通常并不清楚-通常从何处开始使用ASP.NET MVC以及是否有必要。 <br><a name="habracut"></a><br> 另外，例如，对我而言，一开始它由于缺乏在网格表中显示数据的便捷组件而造成了混乱。 可以理解的是，开发人员本人必须实施所有这一切，或者从包管理器中获取适当的东西。 如果像我一样，您对ASP.NET WebForms中的GridView组件感到满意，那么对于MVC，除了Grid.mvc之外，很难找到可比的东西。 但是，我对这些组件的信任不足以将它们用于足够大的项目。 如果使用它们，则程序员开始依赖于另一个开发人员，该开发人员首先不知道如何编写此组件（是否定性？），其次，不知道何时以及如何完成该组件。 有时似乎甚至可以扩展该组件并进行进一步的观察，但是，如果开发人员完成了该组件，我们将不得不重新挖掘代码或将组件更新冻结在某个版本上。 而且，如果开发人员修复了漏洞，则仍然必须升级到新版本。 即使过渡到新版本的MySQL连接器，也会引起某些问题，尽管它仍由一家大公司开发，但是Nuget软件包管理器中的众多“自行车”又如何呢？ <br><br> 因此，在处理由MySQL DBMS处理的数据时，让我们尝试学习如何在ASP.NET MVC下编写。 所有代码都可以在<a href="https://yadi.sk/d/EArrZdGh_iVaJg" rel="nofollow">此地址获得</a> ，下面将通过小链接和解释部分呈现此代码。  <a href="https://example-mvc.azurewebsites.net/" rel="nofollow">在这里</a>您可以看到该应用程序。 <br><br><h2> 在MySQL中创建数据库 </h2><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SCHEMA</span></span> <span class="hljs-string"><span class="hljs-string">`example`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> <span class="hljs-string"><span class="hljs-string">`example`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`users`</span></span> ( <span class="hljs-string"><span class="hljs-string">`UserID`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`SupporterTier`</span></span> enum(<span class="hljs-string"><span class="hljs-string">'None'</span></span>,<span class="hljs-string"><span class="hljs-string">'Silver'</span></span>,<span class="hljs-string"><span class="hljs-string">'Gold'</span></span>,<span class="hljs-string"><span class="hljs-string">'Platinum'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'None'</span></span>, <span class="hljs-string"><span class="hljs-string">`Loginname`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-string"><span class="hljs-string">`Email`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`LastLoginDate`</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`UserID`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`i_Loginname`</span></span> (<span class="hljs-string"><span class="hljs-string">`Loginname`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`i_Language_idx`</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-string"><span class="hljs-string">`i_Language`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> <span class="hljs-string"><span class="hljs-string">`languages`</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`languages`</span></span> ( <span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`LanguageName`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`Culture`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8;</code> </pre> <br> 数据库（DB）将很简单，并且仅由两个表表示，在<code>LanguageID</code>字段中，它们之间具有一对多的关系。 这样，我将使需要使用下拉列表为用户选择一种语言的情况复杂化。 另外，为方便起见，对于用户，我们还将引入<code>SupporterTier</code>字段，该字段将确定通过枚举提供的用户支持级别。 为了在我们的项目中使用几乎所有数据类型，我们添加了“日期/时间”类型的<code>LastLoginDate</code>字段，该字段将在用户登录时由应用程序本身填充（未反映在该项目中）。 <br><br><h2> 建立专案 </h2><br><img src="https://habrastorage.org/webt/sm/4a/07/sm4a07w8etetdgvtnkhd5i-wjcu.png"><br><br> 选择“ MVC”。 可以使用“空”，但是我们经过培训，而不是实际的应用程序，因此这将立即为我们提供帮助，而无需不必要的手势，将Bootstrap和JQuery集成到我们的应用程序中。 <br><br><img src="https://habrastorage.org/webt/lg/yv/rn/lgyvrneaxmudgq9mx1ijk36jjqs.png"><br><br> 我们已经使用ASP.NET MVC包和过滤器注册在<i>App_Start</i>目录中填充了<i>Content</i> ， <i>Fonts</i> ， <i>Scripts</i>文件夹以及<i>BundleConfig.cs</i>和<i>FilterConfig.cs文件</i> 。 在一个空项目中，仅在<i>RouteConfig.cs</i>文件中注册了路由。 在<i>Global.asax.cs中，</i>还将添加这些文件中描述<i>的</i>方法调用： <br><br><pre> <code class="cpp hljs">FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters); RouteConfig.RegisterRoutes(RouteTable.Routes); BundleConfig.RegisterBundles(BundleTable.Bundles);</code> </pre> <br><h2> 我们建立了基础架构和整个捆绑 </h2><br> 要使用MySQL DBMS，请添加<i>MySql.Data</i>库：如果已经在计算机上安装了<b>mysql-connector-net-8.0.18连接器</b> ，则手动添加，或者从Nuget包管理器添加： <br><br><img src="https://habrastorage.org/webt/mk/b_/fh/mkb_fhxg6d8kx2pdnrithceoaf4.png"><br><br> 将连接字符串的配置添加到MySQL DBMS的<i>Web.config</i>文件中： <br><br><pre> <code class="cpp hljs">&lt;connectionStrings&gt; &lt;add name=<span class="hljs-string"><span class="hljs-string">"example"</span></span> providerName=<span class="hljs-string"><span class="hljs-string">"MySql.Data.MySqlClient"</span></span> connectionString=<span class="hljs-string"><span class="hljs-string">"server=localhost;Port=3306;user id=develop;Password=develop;persistsecurityinfo=True;database=example;CharSet=utf8;SslMode=none"</span></span> /&gt; &lt;/connectionStrings&gt;</code> </pre> <br> 在<code>&lt;appSettings&gt;</code>部分中添加一行，并带有指向所添加的连接字符串的链接： <code>&lt;add key="ConnectionString" value="example" /&gt;</code> <br> 我们向应用程序添加一个新的<i>Domain</i>目录，在其中创建一个新的静态<code>Base</code>类（在<i>Base.cs</i>文件中），在其中访问以下参数： <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Base</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> ConnectionString { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> System.Configuration.ConfigurationManager.AppSettings[<span class="hljs-string"><span class="hljs-string">"ConnectionString"</span></span>]; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> strConnect { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> System.Configuration.ConfigurationManager.ConnectionStrings[ConnectionString].ConnectionString; } } }</code> </pre> <br> 我喜欢在应用程序中有一个特定的基类，该类具有指向应用程序参数的链接和一些可以从整个应用程序中调用的标准函数。 <br> 连接字符串的名称是在应用程序设置中定义的，因此将来可以更轻松地将连接字符串与DBMS一起使用：在不同的数据库之间快速切换并更改连接设置。 此外，在应用程序参数中使用连接字符串名称将应用程序发布到Microsoft Azure是很方便的-您可以在其中设置用于发布的应用程序服务的参数，并在其中确定所需的连接字符串，该连接字符串在<code>&lt;connectionStrings&gt;</code>预定义。 然后，在发布时，您将无法使用<i>web.config文件</i>的转换。 <br><br> 我还喜欢在文本中使用全局资源文件中的值，以便在突然需要时不在多个位置覆盖它们。 例如： <br><br><img src="https://habrastorage.org/webt/rc/8u/qz/rc8uqzdrz9hvnd-y7swirgoh4tm.png"><br><br> 在页面布局文件<i>_Layout.cshtml</i> （通常位于<i>Views \ Shared</i>目录中，以后将在该项目的所有页面中使用）中，您现在可以使用这些变量（例如，参见<code>Example_Users.Properties.Resources.Title</code> ）： <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width=device-width, initial-scale=1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>@ViewBag.Title – @Example_Users.Properties.Resources.Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> @Styles.Render("~/Content/css") @Scripts.Render("~/bundles/modernizr") <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container body-content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"page-header"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span>@Example_Users.Properties.Resources.Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> @RenderBody() <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">footer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> @DateTime.Now.Year – @Example_Users.Properties.Resources.Author<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">footer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> @Scripts.Render("~/bundles/jquery") @Scripts.Render("~/bundles/bootstrap") @RenderSection("scripts", required: false) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br> 同样在此文件中，我们看到连接的Bootstrap和JQuery脚本库的级联样式表的附件。 所有视图的内容将在调用<code>RenderBody()</code>函数的位置生成。 <br><br><h2>  M表示型号 </h2><br> 将文件<i>UserClass.cs</i>添加到<i>Domain</i>目录中： <br><br><pre> <code class="cpp hljs">[DisplayName(<span class="hljs-string"><span class="hljs-string">"User"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserClass</span></span></span><span class="hljs-class"> {</span></span> [Key] [HiddenInput(DisplayValue=<span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> UserID { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [Required(ErrorMessage=<span class="hljs-string"><span class="hljs-string">"Please enter a login name"</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Login"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Loginname { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> LanguageClass Language { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [EmailAddress(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please enter a valid email"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Email { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [UIHint(<span class="hljs-string"><span class="hljs-string">"Enum"</span></span>)] [EnumDataType(typeof(Supporter))] [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please select supporter tier"</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Supporter"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Supporter SupporterTier { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [HiddenInput(DisplayValue = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] [ScaffoldColumn(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Last login"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTime? LastLoginDate { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [HiddenInput(DisplayValue = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsLastLogin { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> LastLoginDate != null &amp;&amp; LastLoginDate &gt; DateTime.MinValue; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> UserID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Loginname, LanguageClass Language, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Email, DateTime? LastLoginDate, Supporter SupporterTier)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.UserID = UserID; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Loginname = Loginname; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Language = Language; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Email = Email; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LastLoginDate = LastLoginDate; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SupporterTier = SupporterTier; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Supporter { [Display(Name=<span class="hljs-string"><span class="hljs-string">""</span></span>)] None = <span class="hljs-number"><span class="hljs-number">1</span></span>, Silver = <span class="hljs-number"><span class="hljs-number">2</span></span>, Gold = <span class="hljs-number"><span class="hljs-number">3</span></span>, Platinum = <span class="hljs-number"><span class="hljs-number">4</span></span> }</code> </pre> <br> 以及同一个目录中的<i>LanguageClass.cs</i>文件： <br><pre> <code class="cpp hljs">[DisplayName(<span class="hljs-string"><span class="hljs-string">"Language"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LanguageClass</span></span></span><span class="hljs-class"> {</span></span> [Key] [HiddenInput(DisplayValue = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please select a language"</span></span>)] [Range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue, ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please select a language"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LanguageID { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">"Language"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> LanguageName { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LanguageClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LanguageClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LanguageID = LanguageID; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LanguageName = LanguageName; } }</code> </pre> <br> 在这里，您可以看到类的属性重复了DBMS中“ <code>Users</code>和<code>Languages</code>表的结构。  <code>enum Supporter</code>为该枚举类型创建了一个<code>enum Supporter</code> ，以便可以将其用于数据库表中类似字段的<code>SupporterTier</code>类的属性。 对于<code>UserID</code> ， <code>LanguageID</code>字段，您可以看到它们被指定为主键，就像在数据库中一样。  <code>[Key]</code>属性用于此目的。 <br><br> 所有其他属性很可能与使用此类的视图相关。 而且，如果我们要使用助手为这些属性形成HTML标记（我个人肯定会建议这样做），那么我们将必须非常仔细地设置这些属性才能获得所需的内容。 特别是，此项目需要以下内容： <br><br><ul><li>  <b><code>[DisplayName]</code></b> -用作类的显示名称。 有时它很有用，在这个项目中，我特别添加了<code>Html.DisplayNameForModel</code>帮助器的<code>Html.DisplayNameForModel</code>进行演示。 </li><li> 具有<code>Name</code>属性的<b><code>[Display]</code></b> -用作屏幕上显示的class属性的名称。 还有一个有用的Order属性，使您可以使用助手对显示类属性的顺序进行排序（默认情况下，按定义类属性的顺序排序，因此该项目中未使用Order属性）。 </li><li> 具有<code>DisplayValue</code>属性的<b><code>[HiddenInput]</code></b> 。 它用于根本不需要在表单和列表中显示的属性（ <code>DisplayValue=false</code> ，被绘制为<code>hidden</code>类型的<code>input</code>标签），或仍需要显示但以不可变文本形式显示的属性（ <code>DisplayValue=true</code> ，已绘制）像纯文字，没有标签） </li><li>  <b><code>[ScaffoldColumn]</code></b> -指示是否在编辑<code>Html.EditorForModel</code> （例如<code>Html.EditorForModel</code> ）中显示该字段。 如果为<code>false</code> ，则不会在表格中显示对类属性的描述或其值。  <code>[HiddenInput(DisplayValue = false)]</code>不能在<code>[HiddenInput(DisplayValue = false)]</code>使用，因为在这种情况下，此类类属性的值不仅不会在信息输入表单中而且不会在表格显示中显示。 在这种情况下， <code>LastLoginDate</code>属性是必需的，该属性不是手动输入的，而是自动填充的，但是我们仍然需要查看它。 </li><li>  <b><code>[Required]</code></b> -检查是否已为class属性输入值，并在<code>ErrorMessage</code>属性中显示错误消息文本，并使用<code>AllowEmptyStrings</code>属性允许您输入空白行。 </li><li>  <b><code>[EmailAddress]</code></b> -本质上相同的属性，用于检查邮件地址的正确性。 </li></ul><br> 数据库模型的类已准备就绪，我们转向表示形式（表示模型的类别将在下面描述）。 <br><br><h2>  V-表示<s>仇杀</s>表演 </h2><br> 在<i>Views</i>目录中，为我们的视图创建<i>Users</i>目录。 我们所有的视图都使用位于<i>Views \ Shared</i>目录中的标准（在<i>Views</i>目录的<i>_ViewStart.cshtml</i>文件中定义） <i>_Layout.cshtml</i>布局。 创建一个<code>Index</code>视图（“ <i>用户”</i>目录中的<i>Index.cshtml</i>文件）： <br><br><img src="https://habrastorage.org/webt/jh/es/jn/jhesjnicwj2g1acx7yziv4f6wqy.png"><br><br> 并编写代码： <br><br><pre> <code class="xml hljs">@model Example_Users.Models.UsersGrid @{ ViewBag.Title = "Users page"; } @using (@Html.BeginForm()) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span>Users list:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> @if (TempData["message"] != null) {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-success"</span></span></span><span class="hljs-tag">&gt;</span></span>@TempData["message"]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>} @if (TempData["error"] != null) {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-warning"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert"</span></span></span><span class="hljs-tag">&gt;</span></span>ERROR:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> @TempData["error"]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>} @Html.Partial("List") <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onNewUser"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"New user"</span></span></span><span class="hljs-tag"> /&gt;</span></span> @*@Html.ActionLink("New user", "New", "Users")*@ <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> }</code> </pre> <br> 如果我们希望默认情况下启动此视图，请在<i>RouteConfig.cs</i>文件中对<code>Default</code>进行更改： <br><br><pre> <code class="cpp hljs">routes.MapRoute(name: <span class="hljs-string"><span class="hljs-string">"Default"</span></span>, url: <span class="hljs-string"><span class="hljs-string">"{controller}/{action}/{id}"</span></span>, defaults: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { controller = <span class="hljs-string"><span class="hljs-string">"Users"</span></span>, action = <span class="hljs-string"><span class="hljs-string">"Index"</span></span>, id = UrlParameter.Optional });</code> </pre> <br> 在视图本身中，您需要注意<code>Html.Partial("List")</code> 。 必须在此位置在<i>Views \ Shared</i>目录的<i>List.cshtml</i>文件中绘制一个特殊的单独的常规局部视图。 实际上，这是一个网格表，用于显示我们的<code>users</code>数据库表中的数据： <br><br><pre> <code class="xml hljs">@model Example_Users.Models.UsersGrid @using Example_Users.Domain <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table-responsive"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table table-bordered table-hover"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().Loginname).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().Loginname).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().Loginname).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().Language.LanguageName).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().Language).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().Language).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().Email).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().Email).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().Email).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().SupporterTier).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().SupporterTier).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().SupporterTier).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().LastLoginDate).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().LastLoginDate).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().LastLoginDate).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model.Users) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(item.Loginname, "Edit", "Users", new { UserID = item.UserID }, null)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelitem =&gt; item.Language.LanguageName)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelitem =&gt; item.Email)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Html.DisplayFor(modelitem =&gt; item.SupporterTier)"</span></span></span><span class="hljs-tag">&gt;</span></span>@if (item.SupporterTier != Supporter.None) {@Html.DisplayFor(modelitem =&gt; item.SupporterTier);}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@if (item.IsLastLogin) {@Html.DisplayFor(modelitem =&gt; item.LastLoginDate)}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> @if (Model.PagingInfo.totalPages &gt; 1) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"pagination"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.PageLinks(Model.PagingInfo, x =&gt; Url.Action("Index", new { page = x, sortOrder = Model.SortingInfo.currentSort })) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> }</code> </pre> <br> 可以看出，在数据表的标题中， <code>Html.DisplayNameFor</code> helper <code>Html.DisplayNameFor</code>显示列的名称，为此，您必须指定对类对象的属性的引用。 由于形成表格标题时，我们只有一个<code>Model.Users</code>对象，它是<code>UserClass</code>类型的对象列表，因此我们必须使用以下方法：选择此列表的第一行作为<code>UserClass</code>类的对象。 例如，对于用户名： <code>Model.Users.First().Loginname</code> 。 由于<code>Users</code>类的<code>Loginname</code>属性具有<code>[Display(Name = "Login")]</code>属性，因此它将在列名称中显示为“ Login”： <br><br><img src="https://habrastorage.org/webt/hv/kf/dv/hvkfdvojevmzacuid51wurye8ik.png"><br><br>  <code>List</code>视图中还有什么有趣的东西？ 当然， <code>foreach</code>块将呈现从控制器接收到的“ <code>Users</code>列表中的<code>UserClass</code>类的对象。 这里的<code>UsersGrid</code>模型中的<code>SortingInfo</code>和<code>PagingInfo</code>很有趣。 而且，我们需要这些对象来组织数据排序（在<code>&lt;th&gt;</code>标记的表头中使用）和组织信息的分页（在页面底部的表下方）。 这就是为什么我们不将<code>IEnumerable&lt;UserClass&gt;</code>类型的对象的纯列表用作模型的原因。 作为模型，我们使用<code>UsersGrid</code>类，该类位于<i>Model</i>目录的<i>UsersGrid.cs</i>文件中。 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersGrid</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;UserClass&gt; Users { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PagingInfo PagingInfo { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SortingInfo SortingInfo { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } }</code> </pre> <br>  <code>PagingInfo</code>和<code>SortingInfo</code>类本身在<code>GridInfo.cs</code>文件中的同一位置。 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PagingInfo</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">//     public int totalItems { get; set; } //     public int itemsPerPage { get; set; } //   public int currentPage { get; set; } //         public int showPages { get; set; } //   public int totalPages { get { return (int)Math.Ceiling((decimal)totalItems / itemsPerPage); } } //           public int pagesSide { get { return (int)Math.Truncate((decimal)showPages / 2); } } } public class SortingInfo { //  ,     public string currentOrder { get; set; } //   public SortDirection currentDirection { get; set; } //      public string currentSort { get { return currentDirection != SortDirection.Descending ? currentOrder : currentOrder + "_desc"; } } //       (      -   ) public string NewOrder(string columnName) { return columnName == currentOrder &amp;&amp; currentDirection != SortDirection.Descending ? columnName + "_desc" : columnName; } }</span></span></code> </pre> <br> 为了在视图中使用，特殊的帮助器已添加到<i>GridHelpers.cs</i>文件（ <i>HtmlHelpers</i>目录）： <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GridHelpers</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">//     1 ... 3 4 5 ... Last public static MvcHtmlString PageLinks(this HtmlHelper html, PagingInfo pagingInfo, Func&lt;int, string&gt; pageUrl) { StringBuilder result = new StringBuilder(); if (pagingInfo.currentPage &gt; pagingInfo.pagesSide + 1) {//   TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); TagBuilder tag = new TagBuilder("a"); tag.MergeAttribute("href", pageUrl(1)); tag.InnerHtml = "1"; li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } int page1 = pagingInfo.currentPage - pagingInfo.pagesSide; int page2 = pagingInfo.currentPage + pagingInfo.pagesSide; if (page1 &lt; 1) { page2 = page2 - page1 + 1; page1 = 1; } if (page2 &gt; pagingInfo.totalPages) page2 = pagingInfo.totalPages; if (page1 &gt; 2) {// ... TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); TagBuilder tag = new TagBuilder("span"); tag.InnerHtml = "..."; tag.AddCssClass("page-item"); tag.AddCssClass("disabled"); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } for (int i = page1; i &lt;= page2; i++) {//  TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); if (i == pagingInfo.currentPage) li.AddCssClass("active"); TagBuilder tag = new TagBuilder("a"); tag.AddCssClass("page-link"); tag.MergeAttribute("href", pageUrl(i)); tag.InnerHtml = i.ToString(); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } if (page2 &lt; pagingInfo.totalPages) {// ...    TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); TagBuilder tag = new TagBuilder("span"); tag.InnerHtml = "..."; tag.AddCssClass("page-item"); tag.AddCssClass("disabled"); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); li = new TagBuilder("li"); li.AddCssClass("page-item"); tag = new TagBuilder("a"); tag.MergeAttribute("href", pageUrl(pagingInfo.totalPages)); tag.InnerHtml = pagingInfo.totalPages.ToString(); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } return MvcHtmlString.Create(result.ToString()); } public static IHtmlString SortIdentifier(this HtmlHelper htmlHelper, string sortOrder, string field) { if (string.IsNullOrEmpty(sortOrder) || (sortOrder.Trim() != field &amp;&amp; sortOrder.Replace("_desc", "").Trim() != field)) return null; string glyph = "glyphicon glyphicon-chevron-up"; if (sortOrder.ToLower().Contains("desc")) { glyph = "glyphicon glyphicon-chevron-down"; } var span = new TagBuilder("span"); span.Attributes["class"] = glyph; return MvcHtmlString.Create(span.ToString()); } public static RouteValueDictionary ToRouteValueDictionary(this NameValueCollection collection, string newKey, string newValue) { var routeValueDictionary = new RouteValueDictionary(); foreach (var key in collection.AllKeys) { if (key == null) continue; if (routeValueDictionary.ContainsKey(key)) routeValueDictionary.Remove(key); routeValueDictionary.Add(key, collection[key]); } if (string.IsNullOrEmpty(newValue)) { routeValueDictionary.Remove(newKey); } else { if (routeValueDictionary.ContainsKey(newKey)) routeValueDictionary.Remove(newKey); routeValueDictionary.Add(newKey, newValue); } return routeValueDictionary; } }</span></span></code> </pre> <br> 由于具有数据的网格没有排序而没有分页信息是一件相当没用的事情，并且ASP.NET MVC中没有用于整个数据表的标准帮助程序，因此您必须自己创建（或采用其他人创建的）。 在这种情况下，我监视了Internet上ASP.NET MVC书籍和解决方案中的几种实现。 而且，由于某种原因，至少结合了数据排序和分页的解决方案根本没有，或者我没有找到。 我必须理解这件事，将其组合并修改为正常状态。 例如，在那些实现中的分页通常不能提供或多或少的长页面列表的输出-那么，如果会有几千个页面怎么办？ 我给出了上述解决方案的显示示例： <br><br><img src="https://habrastorage.org/webt/wj/dt/yr/wjdtyrmtbxm5f_5jfj7til_iqy0.png"><br><br> 我们还需要视图来创建和修改数据。 用于创建<code>UserClass</code>类型的对象的视图： <br><br><img src="https://habrastorage.org/webt/0u/80/-i/0u80-itckfou4ciyyxremebrqy8.png"><br><br> 并且视图代码将如下所示： <br><br><pre> <code class="cpp hljs">@model Example_Users.Models.UserModel @{ ViewBag.Title = <span class="hljs-string"><span class="hljs-string">"New "</span></span> + Html.DisplayNameForModel().ToString().ToLower(); } &lt;h2&gt;@ViewBag.Title&lt;/h2&gt; @<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (@Html.BeginForm(<span class="hljs-string"><span class="hljs-string">"New"</span></span>, <span class="hljs-string"><span class="hljs-string">"Users"</span></span>, FormMethod.Post)) { @Html.EditorFor(m =&gt; m.User); @Html.LabelFor(m =&gt; Model.User.Language)&lt;br /&gt; @Html.DropDownListFor(m =&gt; Model.User.Language.LanguageID, Model.SelectLanguages()) &lt;span/&gt;@Html.ValidationMessageFor(m =&gt; Model.User.Language.LanguageID)&lt;br /&gt; &lt;br /&gt; &lt;p&gt;&lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Add"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"button"</span></span> onclick=<span class="hljs-string"><span class="hljs-string">"history.go(-1)"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Cancel"</span></span> /&gt;&lt;/p&gt; @*&lt;p&gt;@Html.ActionLink(<span class="hljs-string"><span class="hljs-string">"Back to list"</span></span>, <span class="hljs-string"><span class="hljs-string">"Index"</span></span>)&lt;/p&gt;*@ }</code> </pre> <br> 例如，此视图显示了<code>Html.EditorFor</code>辅助程序作为生成用于编辑<code>UserClass</code>类中对象的所有属性的标记的一种方式。 显示如下： <br><br><img src="https://habrastorage.org/webt/v-/rz/kw/v-rzkwz4dtui-xhs4lo2vbjyf3s.png"><br><br> 该视图使用<code>UserModel</code>类作为模型，而不是直接使用<code>UserClass</code> 。  <code>UserModel</code>类本身位于<i>Models</i>目录的<i>UserModel.cs</i>文件中： <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserModel</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UserClass User { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IList&lt;LanguageClass&gt; Languages { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user, IList&lt;LanguageClass&gt; languages)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.User = user; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Languages = languages; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;SelectListItem&gt; SelectLanguages() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Languages != null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectList(Languages, <span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>, <span class="hljs-string"><span class="hljs-string">"LanguageName"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; } }</code> </pre> <br> 该类<code>LanguageClass</code>包含<code>UserClass</code>对象本身以及<code>LanguageClass</code>类型的其他对象列表。 我们需要此列表来创建语言的下拉列表，并在其中选择当前用户语言： <code>@Html.DropDownListFor(m =&gt; Model.User.Language.LanguageID, Model.SelectLanguages(), "")</code> <br><br> 该助手使用对<code>SelectLanguages()</code>函数的调用，该函数将语言列表转换为<code>SelectList</code>类型的对象，该对象的标识符和行名参数已设置。 将这个对象的生成放入视图中将是错误的，因为这种想法是不知道这些与字段名称的绑定。 当然，有可能直接在控制器中生成一个现成的<code>SelectList</code> ，但是我喜欢带有域类对象的私有列表和函数的选项。 <br><br> 要生成下拉列表，我们必须使用单独的助手，因为<code>Html.EditorFor(m =&gt; m.User)</code>助手将不会为<code>LanguageClass</code>类型的嵌入式对象生成编辑标记（可以通过为下拉列表编写通用模板来绕过它，但是在这里，我们我们不会这么做的...）。 <br><br> 并且由于我们在视图中使用的是<code>UserModel</code>类的对象，其中包括<code>UserClass</code>类的另一个对象，因此我们将无法使用<code>Html.EditorForModel()</code>帮助器，因为这些帮助器不是递归的，并且在这种情况下将无法使用，因此使用了<code>Html.EditorFor()</code>帮助器<code>Html.EditorFor()</code>用于<code>User</code>对象。 <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我还想注意注释掉的标记：</font></font><code>Html.ActionLink("Back to list", "Index")</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，以类似的方式实现从视图返回以编辑回数据列表的操作。实际上，首先，在我看来，它看起来很奇怪-当您在form中使用类型按钮时</font></font><code>button</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，由于某种原因，返回按钮是由链接实现的。其次，如果我们使用排序和逐页输出-我们必须明智的做法是在同一视图中返回同一页面-并且不仅要在视图中传递对象</font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，而且还要</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">返回页面的参数。有一种简单得多的方法-将选项与按钮一起使用：</font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这会将用户带回到浏览器历史记录页面。当然，这里有一些细微差别（例如，您已经尝试将对象保存在此页面上，它不起作用，现在-您已经需要双击“取消”按钮了），但是此选项作为一个整体来说效果很好。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及用于编辑类型的对象的视图</font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/a2/eo/xh/a2eoxhk3nzvbvs0h7s_nmjxuems.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">及其代码：</font></font><br><br><pre> <code class="cpp hljs">@model Example_Users.Models.UserModel @{ ViewBag.Title = <span class="hljs-string"><span class="hljs-string">"Edit "</span></span> + Html.DisplayNameForModel().ToString().ToLower(); } &lt;h2&gt;@ViewBag.Title @Model.User.Loginname&lt;/h2&gt; @<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (@Html.BeginForm(<span class="hljs-string"><span class="hljs-string">"Edit"</span></span>, <span class="hljs-string"><span class="hljs-string">"Users"</span></span>, FormMethod.Post)) { @Html.HiddenFor(m =&gt; Model.User.UserID) &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.Loginname) @Html.EditorFor(m =&gt; Model.User.Loginname) @Html.ValidationMessageFor(m =&gt; Model.User.Loginname) &lt;/div&gt; &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.Language) @Html.DropDownListFor(m =&gt; Model.User.Language.LanguageID, Model.SelectLanguages()) @Html.ValidationMessageFor(m =&gt; Model.User.Language.LanguageID) &lt;/div&gt; &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.Email) @Html.EditorFor(m =&gt; Model.User.Email) @Html.ValidationMessageFor(m =&gt; Model.User.Email) &lt;/div&gt; &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.SupporterTier) @Html.EditorFor(m =&gt; Model.User.SupporterTier) @*@Html.EnumDropDownListFor(m =&gt; Model.User.SupporterTier)*@ @*@Html.DropDownListFor(m =&gt; m.Model.User.SupporterTier, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectList(Enum.GetNames(typeof(Example_Users.Domain.Supporter))))*@ @Html.ValidationMessageFor(m =&gt; Model.User.SupporterTier) &lt;/div&gt; &lt;br /&gt; &lt;p&gt;&lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Save"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Remove"</span></span> onclick=<span class="hljs-string"><span class="hljs-string">"javascript:return confirm('Are you sure?');"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Cancel"</span></span> /&gt;&lt;/p&gt; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且在此视图中，提供了使用不同的助手为类对象的每个所需属性分别生成标签的选项。</font><font style="vertical-align: inherit;">在这种情况下，您已经可以以稍微更漂亮的方式进行显示：</font></font><br><br><img src="https://habrastorage.org/webt/3g/ew/as/3gewasn6m2whqy9odk4gvrn2l0c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此视图中，还可以使用另一种方式返回列表。</font><font style="vertical-align: inherit;">而不是使用类似的按钮：</font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同的按钮与其他操作按钮（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Save</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remove</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）一起使用：</font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且返回是在处理这些按钮的操作的controller方法内进行的（请参见下面方法的实现）。</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 枚举 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后就产生了与</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型的class属性有关的细微差别</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">事实是，如果仅使用帮助器</font></font><code>Html.EditorFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则文本信息输入字段（type tag </font></font><code>&lt;input type=”text”/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">将</font><font style="vertical-align: inherit;">显示在表单上</font><font style="vertical-align: inherit;">，但实际上我们需要一个从一组值中进行选择的字段（即</font></font><code>&lt;select&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有一组选项</font><font style="vertical-align: inherit;">的标签</font></font><code>&lt;option&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.直线使用的辅助型解决</font></font><code>Html.DropDownListFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者</font></font><code>Html.ListBoxFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，例如，在我们的例子</font></font><code>@Html.DropDownListFor(m =&gt; m.Model.User.SupporterTier, new SelectList(Enum.GetNames(typeof(Example_Users.Domain.Supporter))))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有两个缺点-每次都必须单独为助手指定处方，</font></font><code>Html.EditorForModel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否则</font></font><code>Html.EditorFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它将不起作用。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.您可以创建一个自定义类型模板</font></font><code>Editor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">Views \ Shared \ EditorTemplates文件夹中</font></i><font style="vertical-align: inherit;">创建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supporter.cshtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ： </font></font><br><br><pre> <code class="xml hljs">@model Example_Users.Domain.Supporter @Html.DropDownListFor(m =&gt; m, new SelectList(Enum.GetNames(Model.GetType()), Model.ToString()))</code> </pre> <br>      ,     <code>Html.EditorFor(m =&gt; Model.SupporterTier)</code> ,  <code>Html.EditorFor(m =&gt; Model.SupporterTier, "Supporter")</code> .    -,           <code>[UIHint("Supporter")]</code> .     ,    <code>Html.EditorForModel()</code> –     <code>Html.EditorFor(m =&gt; Model.SupporterTier, "Supporter")</code>  . <br><br>      -  ,     (  <code>New</code> )    <code>Html.EditorFor()</code>  <code>Html.EditorForModel()</code>   : « <i> ,   ,   NULL,         «Example_Users.Domain.Supporter»,    NULL.</i> »   –       ,       .    . <br><br> 3.    <code>Html.EnumDropDownListFor()</code> ,    .    ,     ,   ,        .   «»:  <code>Html.EditorForModel()</code>       <code>Html.EditorFor()</code> , ,   <code>Html.EnumDropDownListFor()</code> . ,   ,          – <code>[UIHint]</code> , <code>[DataType]</code>  <code>[EnumDataType]</code>   .        ,    None  , ,   ,       <code>Supporter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.结果，我想出了一个</font></font><a href="https://odetocode.com/Blogs/scott/archive/2012/08/29/working-with-enums-and-templates-in-asp-net-mvc.aspx" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Internet上找到</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的解决方案选项</font><font style="vertical-align: inherit;">：创建用于传输的通用模板。</font><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">Views \ Shared \ EditorTemplates文件夹中</font></i><font style="vertical-align: inherit;">创建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enum.cshtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><br><pre> <code class="xml hljs">@using System.ComponentModel.DataAnnotations @model Enum @{ Func<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object,</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">string</span></span></span><span class="hljs-tag">&gt;</span></span> GetDisplayName = o =&gt; { var result = null as string; var display = o.GetType() .GetMember(o.ToString()).First() .GetCustomAttributes(false) .OfType<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DisplayAttribute</span></span></span><span class="hljs-tag">&gt;</span></span>() .LastOrDefault(); if (display != null) result = display.GetName(); return result ?? o.ToString(); }; var values = Enum.GetValues(ViewData.ModelMetadata.ModelType).Cast<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object</span></span></span><span class="hljs-tag">&gt;</span></span>() .Select(v =&gt; new SelectListItem { Selected = v.Equals(Model), Text = GetDisplayName(v), // v.ToString(), Value = v.ToString() }); } @Html.DropDownList("", values)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总的来说，这里一切都很好：模板在任何可能的地方都很好用。</font><font style="vertical-align: inherit;">您甚至</font></font><code>[UIHint("Enum")]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法添加。</font><font style="vertical-align: inherit;">此外，此通用模板</font></font><code>[Display(Name)]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用特殊功能</font><font style="vertical-align: inherit;">读取</font><font style="vertical-align: inherit;">枚举值</font><font style="vertical-align: inherit;">的属性</font><font style="vertical-align: inherit;">。</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C表示控制器 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UsersController.cs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件添加</font><font style="vertical-align: inherit;">到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controllers</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font><font style="vertical-align: inherit;">。</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersController</span></span></span><span class="hljs-class"> :</span></span> Controller { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pageSize = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> showPages = <span class="hljs-number"><span class="hljs-number">15</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    public ViewResult Index(string sortOrder, int page = 1) { string sortName = null; System.Web.Helpers.SortDirection sortDir = System.Web.Helpers.SortDirection.Ascending; sortOrder = Base.parseSortForDB(sortOrder, out sortName, out sortDir); UsersRepository rep = new UsersRepository(); UsersGrid users = new UsersGrid { Users = rep.List(sortName, sortDir, page, pageSize, out count), PagingInfo = new PagingInfo { currentPage = page, itemsPerPage = pageSize, totalItems = count, showPages = showPages }, SortingInfo = new SortingInfo { currentOrder = sortName, currentDirection = sortDir } }; return View(users); } [ReferrerHold] [HttpPost] public ActionResult Index(string onNewUser) { if (onNewUser != null) { TempData["referrer"] = ControllerContext.RouteData.Values["referrer"]; return View("New", new UserModel(new UserClass(), Languages())); } return View(); } [ReferrerHold] public ActionResult New() { TempData["referrer"] = ControllerContext.RouteData.Values["referrer"]; return View("New", new UserModel(new UserClass(), Languages())); } [HttpPost] public ActionResult New(UserModel model) { if (ModelState.IsValid) { if (model.User == null || model.User.Language == null || model.User.Language.LanguageID == 0) RedirectToAction("Index"); UsersRepository rep = new UsersRepository(); if (rep.AddUser(model.User)) TempData["message"] = string.Format("{0} has been added", model.User.Loginname); else TempData["error"] = string.Format("{0} has not been added!", model.User.Loginname); if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString()); return RedirectToAction("Index"); } else { model = new UserModel(model.User, Languages()); // -          model.Languages,   return View(model); } } [ReferrerHold] public ActionResult Edit(int UserID) { UsersRepository rep = new UsersRepository(); UserClass user = rep.FetchByID(UserID); if (user == null) return HttpNotFound(); TempData["referrer"] = ControllerContext.RouteData.Values["referrer"]; return View(new UserModel(user, Languages())); } [HttpPost] public ActionResult Edit(UserModel model, string action) { if (action == "Cancel") { if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString()); return RedirectToAction("Index"); } if (ModelState.IsValid) { if (model.User == null || model.User.Language == null || model.User.Language.LanguageID == 0) RedirectToAction("Index"); UsersRepository rep = new UsersRepository(); if (action == "Save") { if (rep.ChangeUser(model.User)) TempData["message"] = string.Format("{0} has been saved", model.User.Loginname); else TempData["error"] = string.Format("{0} has not been saved!", model.User.Loginname); } if (action == "Remove") { if (rep.RemoveUser(model.User)) TempData["message"] = string.Format("{0} has been removed", model.User.Loginname); else TempData["error"] = string.Format("{0} has not been removed!", model.User.Loginname); } if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString()); return RedirectToAction("Index"); } else { model = new UserModel(model.User, Languages()); return View(model); } } public IList&lt;LanguageClass&gt; Languages() { IList&lt;LanguageClass&gt; languages = new List&lt;LanguageClass&gt;(); LanguagesRepository rep = new LanguagesRepository(); languages = rep.List(); return languages; } }</span></span></code> </pre> <br>   : <br><br> 1)  <code>Index</code> <br><br>     : <code>public ViewResult Index(string sortOrder, int page = 1)</code> <br><br>     <code>sortOrder</code>  <code>page</code> .  <code>page</code>  - ,    <code>sortOrder</code>       ,       SQL-     .        (     ,     <i>Base.cs</i> ): <code>sortOrder = Base.parseSortForDB(sortOrder, out sortName, out sortDir);</code> <br><br>   ,    <code>UsersRepository</code> (   ,    ),   <code>List</code>         <code>UsersGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从用户的实际列表以及组织信息分页和排序所必需的信息。此外，在调用该方法的</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同时与创建类object一起</font><font style="vertical-align: inherit;">获得totalItem的值</font></font><code>UsersGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。此外，该对象被转移以显示到表示。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还有另一个具有该属性的Index方法，</font></font><code>[HttpPost]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要</font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在视图中</font><font style="vertical-align: inherit;">进行按钮单击</font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><code>public ActionResult Index(string onNewUser)</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入参数</font></font><code>onNewUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视图中</font><font style="vertical-align: inherit;">的元素</font><font style="vertical-align: inherit;">有</font><font style="vertical-align: inherit;">一些共同点，</font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们单击此按钮时，它将参数值传递给与</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">null</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比较的函数</font><font style="vertical-align: inherit;">。如果类型按钮</font></font><code>submit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在视图中</font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几个，则必须检查值本身（在这种情况下，该值将是“ New user”）。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查之后，我们形成一个类对象</font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">该类对象</font><font style="vertical-align: inherit;">由一个新对象</font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和一系列语言</font><font style="vertical-align: inherit;">组成，以</font><font style="vertical-align: inherit;">从下拉列表中选择它们并将其传递给presentation </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。通过</font><font style="vertical-align: inherit;">如下</font></font><code>LanguageRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">从存储库中获取语言列表</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;LanguageClass&gt; Languages() { LanguagesRepository rep = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LanguagesRepository(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rep.List(); }</code> </pre> <br> 2)  <code>New</code> <br><br>  <code>New</code>         <i>New User</i>    <code>Html.ActionLink("New user", "New", "Users")</code>   <code>Index</code> .  (  <code>New</code> )   ,      ,      . <br><br>  <code>New</code>   model  <code>UserModel</code>             : <code>public ActionResult New(UserModel model)</code> <br><br>    New    <code>UserModel</code> ,    ( ,   <code>UserClass</code>  <code>LanguageClass</code> ),    <code>UsersRepository</code>       ,   <code>AddUser(model.User)</code> .       (    <code>New</code> )          . <br><br> 3)  <code>Edit</code> <br><br>  <code>Edit</code>    <code>UserID</code> ( )             : <code>public ActionResult Edit(int UserID)</code> <br><br>       <code>UsersRepository</code>      <code>FetchByID(UserID)</code>     <code>UserClass</code> .      –   <code>UserModel</code>           <code>Edit</code>  . <br><br>       <code>UserModel</code>   <code>action</code> : <code>public ActionResult Edit(UserModel model, string action)</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将类型对象传递给此方法</font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，当单击视图的按钮（处理用于发送表单数据的事件）时，它会处理操作</font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。为了了解按下了哪个按钮，使用了输入参数，该输入参数</font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在HTML type标签的名称中指示</font></font><code>input</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。因此，该方法将该参数的值与</font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些按钮</font><font style="vertical-align: inherit;">的参数值进行比较</font><font style="vertical-align: inherit;">。在检查模型的有效性之前，请检查该值</font></font><code>Cancel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以执行取消用户编辑的操作。使用此选项，而不是返回到视图中</font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">的浏览器历史记录，</font><font style="vertical-align: inherit;">并用于存储从其传递视图的页面的地址</font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。为此，控制器演示了使用其属性的技术</font></font><code>ActionFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font><i><font style="vertical-align: inherit;">ReferrerHoldAttribute.cs</font></i></font><code>ReferrerHoldAttribute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">（</font><i><font style="vertical-align: inherit;">HtmlAttribute</font></i><font style="vertical-align: inherit;">目录</font><font style="vertical-align: inherit;">）中的类：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReferrerHoldAttribute</span></span></span><span class="hljs-class"> :</span></span> ActionFilterAttribute { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActionExecutingContext filterContext)</span></span></span><span class="hljs-function"> </span></span>{ var referrer = filterContext.RequestContext.HttpContext.Request.UrlReferrer; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (referrer != null) filterContext.RouteData.Values.Add(<span class="hljs-string"><span class="hljs-string">"referrer"</span></span>, referrer); base.OnActionExecuting(filterContext); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它用于存储有关在单击“ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新用户</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” </font><font style="vertical-align: inherit;">按钮</font><font style="vertical-align: inherit;">或更改用户链接</font><font style="vertical-align: inherit;">后需要返回的页面的信息</font><font style="vertical-align: inherit;">：</font></font><code>TempData["referrer"] = ControllerContext.RouteData.Values["referrer"];</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要它，以便每次我们都不会以不同的方法编写相同的代码。可以在控制器中编写一个单独的函数，但是如果使用多个控制器，则使用特殊的属性类型更为实用。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随后，在处理视图</font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">的操作的方法的主体中</font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，提取存储的信息，并将其用于重定向回从中调用这些视图的页面：</font></font><code>if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString());</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了确定是否需要保存或删除用户，将参数</font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><font style="vertical-align: inherit;">比较</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从存储库中分别</font><i><font style="vertical-align: inherit;">删除</font></i><font style="vertical-align: inherit;">和</font></font><code>UsersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font></font><code>ChangeUser(model.User)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>RemoveUser(model.User)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后返回上一页（视图调用来自</font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），并在此处显示一条消息，指示操作成功或失败。</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ADO.NET和MySQL-存储库 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里，我们终于开始使用DBMS。</font><font style="vertical-align: inherit;">我们需要实现以下功能：将用户添加到表中</font></font><code>Users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，更改用户数据，从表中删除用户，通过ID获取用户，获取用户列表以及从表中获取语言列表</font></font><code>Languages</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，标准结构用于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL.Data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类，</font><font style="vertical-align: inherit;">使用</font></font><code>MySqlCommand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection( )) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">" "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">" "</span></span>,  ).Value =  ; connect.Open(); result = cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//        (INSERT, UPDATE, DELETE)   cmd.ExecuteScalar()         SELECT } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><code>MySqlDataReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于查询而读取表行：</font></font><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection( )) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">" "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlDataReader dr = cmd.ExecuteReader()) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">" "</span></span>,  ).Value =  ; objConnect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (dr.Read()) {<span class="hljs-comment"><span class="hljs-comment">//       } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">Models</font></i><font style="vertical-align: inherit;">目录中</font><font style="vertical-align: inherit;">创建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserRepository.cs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersRepository</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user)</span></span></span><span class="hljs-function"> </span></span>{ user.UserID = AddUser(Name: user.Loginname, LanguageID: user.Language.LanguageID, Email: user.Email, SupporterTier: user.SupporterTier); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user.UserID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Email, Supporter SupporterTier)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ID = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">"INSERT INTO `Users` (`Loginname`, `LanguageID`, `Email`, `SupporterTier`) VALUES (@Loginname, @LanguageID, @Email, @SupporterTier)"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Loginname"</span></span>, MySqlDbType.String).Value = Name; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>, MySqlDbType.Int32).Value = LanguageID; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>, MySqlDbType.String).Value = Email; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>, MySqlDbType.Int32).Value = SupporterTier; connect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { sql = <span class="hljs-string"><span class="hljs-string">"SELECT LAST_INSERT_ID() AS ID"</span></span>; cmd.CommandText = sql; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.TryParse(cmd.ExecuteScalar().ToString(), out ID); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ID; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChangeUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ChangeUser(ID: user.UserID, Name: user.Loginname, LanguageID: user.Language.LanguageID, Email: user.Email, SupporterTier: user.SupporterTier); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChangeUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Email, Supporter SupporterTier)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">"UPDATE `Users` SET `Loginname`=@Loginname, `LanguageID`=@LanguageID, `Email`=@Email, `SupporterTier`=@SupporterTier WHERE UserID=@UserID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>, MySqlDbType.Int32).Value = ID; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Loginname"</span></span>, MySqlDbType.String).Value = Name; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>, MySqlDbType.Int32).Value = LanguageID; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>, MySqlDbType.String).Value = Email; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>, MySqlDbType.Int32).Value = SupporterTier; connect.Open(); result = cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RemoveUser(user.UserID); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">"DELETE FROM `Users` WHERE `UserID`=@UserID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>, MySqlDbType.Int32).Value = ID; connect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UserClass </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FetchByID</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID)</span></span></span><span class="hljs-function"> </span></span>{ UserClass user = null; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection objConnect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> strSQL = <span class="hljs-string"><span class="hljs-string">"SELECT u.`UserID`, u.`Loginname`, l.`LanguageID`, l.`LanguageName`, u.`Email`, u.`LastLoginDate`, CAST(u.`SupporterTier` AS UNSIGNED) as `SupporterTier` FROM `Users` u LEFT JOIN `Languages` l ON l.LanguageID=u.LanguageID WHERE `UserID`=@UserID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(strSQL, objConnect)) { objConnect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> UserID = <span class="hljs-number"><span class="hljs-number">0</span></span>, LanguageID = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Loginname = null, LanguageName= null, Email = String.Empty; Supporter SupporterTier = Supporter.None; DateTime? LastLoginDate = null; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>, MySqlDbType.Int32).Value = ID; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlDataReader dr = cmd.ExecuteReader()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dr.Read()) { UserID = dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>); Loginname = dr.GetString(<span class="hljs-string"><span class="hljs-string">"Loginname"</span></span>).ToString(); LanguageID = dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>); LanguageName = dr.GetString(<span class="hljs-string"><span class="hljs-string">"LanguageName"</span></span>).ToString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dr.IsDBNull(dr.GetOrdinal(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>))) Email = dr.GetString(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>).ToString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dr.IsDBNull(dr.GetOrdinal(<span class="hljs-string"><span class="hljs-string">"LastLoginDate"</span></span>))) LastLoginDate = dr.GetDateTime(<span class="hljs-string"><span class="hljs-string">"LastLoginDate"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dr.IsDBNull(dr.GetOrdinal(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>))) SupporterTier = (Supporter)dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>); } LanguageClass language = null; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (LanguageID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) language = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LanguageClass(LanguageID: LanguageID, LanguageName: LanguageName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UserID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; language != null &amp;&amp; language.LanguageID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UserClass(UserID: UserID, Loginname: Loginname, Language: language, Email: Email, LastLoginDate: LastLoginDate, SupporterTier: (Supporter)SupporterTier); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user; } <span class="hljs-comment"><span class="hljs-comment">//       ASP.NET WebForms,             ObjectDataSource      //     ,         " "         //public IEnumerable&lt;DataRow&gt; List() //{ // using (MySqlConnection objConnect = new MySqlConnection(Base.strConnect)) // { // string strSQL = "select * from users"; // using (MySqlCommand objCommand = new MySqlCommand(strSQL, objConnect)) // { // objConnect.Open(); // using (MySqlDataAdapter da = new MySqlDataAdapter(objCommand)) // { // DataTable dt = new DataTable(); // da.Fill(dt); // return dt.AsEnumerable(); // } // } // } //} public IList&lt;UserClass&gt; List(string sortOrder, System.Web.Helpers.SortDirection sortDir, int page, int pagesize, out int count) { List&lt;UserClass&gt; users = new List&lt;UserClass&gt;(); using (MySqlConnection objConnect = new MySqlConnection(Base.strConnect)) { //     string sort = " ORDER BY "; //   ,               (inject) // ,  , MySQL        //    ,         (       ) //        ,    if (sortOrder != null &amp;&amp; sortOrder != String.Empty) { sort += "`" + sortOrder + "`"; if (sortDir == System.Web.Helpers.SortDirection.Descending) sort += " DESC"; sort += ","; } sort += "`UserID`"; //   //        ( ) string limit = ""; if (pagesize &gt; 0) { int start = (page - 1) * pagesize; limit = string.Concat(" LIMIT ", start.ToString(), ", ", pagesize.ToString()); } string strSQL = "SELECT SQL_CALC_FOUND_ROWS u.`UserID`, u.`Loginname`, l.`LanguageID`, l.`LanguageName` as `Language`, u.`Email`, u.`LastLoginDate`, CAST(u.`SupporterTier` AS UNSIGNED) as `SupporterTier` FROM `Users` u LEFT JOIN `Languages` l ON l.LanguageID=u.LanguageID" + sort + limit; using (MySqlCommand cmd = new MySqlCommand(strSQL, objConnect)) { objConnect.Open(); cmd.Parameters.Add("page", MySqlDbType.Int32).Value = page; cmd.Parameters.Add("pagesize", MySqlDbType.Int32).Value = pagesize; using (MySqlDataReader dr = cmd.ExecuteReader()) { while (dr.Read()) { LanguageClass language = new LanguageClass(LanguageID: dr.GetInt32("LanguageID"), LanguageName: dr.GetString("Language").ToString()); users.Add(new UserClass( UserID: dr.GetInt32("UserID"), Loginname: dr.GetString("Loginname"), Language: language, Email: dr.IsDBNull(dr.GetOrdinal("Email")) ? String.Empty : dr.GetString("Email"), LastLoginDate: dr.IsDBNull(dr.GetOrdinal("LastLoginDate")) ? (DateTime?) null : dr.GetDateTime("LastLoginDate"), SupporterTier: dr.IsDBNull(dr.GetOrdinal("SupporterTier")) ? (Supporter) Supporter.None : (Supporter)dr.GetInt32("SupporterTier"))); } } } using (MySqlCommand cmdrows = new MySqlCommand("SELECT FOUND_ROWS()", objConnect)) { int.TryParse(cmdrows.ExecuteScalar().ToString(), out count); } } return users; } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它包含一种</font></font><code>AddUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于添加用户，更新用户数据（</font></font><code>ChangeUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），删除（</font></font><code>RemoveUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font></font><code>FetchByID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过ID </font><font style="vertical-align: inherit;">搜索用户（</font><font style="vertical-align: inherit;">）的方法</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">以及</font><font style="vertical-align: inherit;">用于显示用户分页列表进行排序</font><font style="vertical-align: inherit;">的最有趣的方法</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我还要对功能进行评论</font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如此返回表（</font></font><code>DataTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">是不值得的</font><font style="vertical-align: inherit;">-在这种情况下，我们将失去访问视图中类的元素的能力，并且将被迫使用字符串常量来引用表行中的值。</font></font>即          SQL-.       <code>UserClass</code> . </li><li>          <code>LIMIT</code>  SQL- <code>SELECT</code> .  ,  MySQL      ,   <code>LIMIT</code>       .   ,     ,       <code>ORDER BY</code>           . ,         SQL-,     SQL   ,       ,     .       ,      ,          :         . </li><li>           SQL  <code>SELECT FOUND_ROWS()</code> ,          ,     <code>SELECT SQL_CALC_FOUND_ROWS</code>     <code>LIMIT</code> . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有其他方法都是完全普通的，与上面的标准一致。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font><i><font style="vertical-align: inherit;">Models</font></i><font style="vertical-align: inherit;">目录中</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LanguageRepository.cs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LanguagesRepository</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;LanguageClass&gt; List() { List&lt;LanguageClass&gt; languages = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;LanguageClass&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection objConnect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> strSQL = <span class="hljs-string"><span class="hljs-string">"SELECT `LanguageID`, `LanguageName` as `Language` FROM `Languages` ORDER BY `LanguageName`"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(strSQL, objConnect)) { objConnect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlDataReader dr = cmd.ExecuteReader()) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (dr.Read()) { LanguageClass language = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LanguageClass(LanguageID: dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>), LanguageName: dr.GetString(<span class="hljs-string"><span class="hljs-string">"Language"</span></span>).ToString()); languages.Add(language); } } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> languages; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它只有一个功能，可以从数据库中获取语言列表，并创建类元素列表</font></font><code>LanguageClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><h2> 合计 </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就这样-任务解决了。</font><font style="vertical-align: inherit;">显然，许多问题没有解决：依赖注入容器，单元测试，修改工具，本地化等。</font></font>等<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有些事情可以做的不同，也可以做得更好。</font><font style="vertical-align: inherit;">但是结果出来的“砖块”足够完整，足以理解ASP.NET MVC的工作原理，并且与非MS SQL的ADO.NET和DBMS一起使用也不是那么令人恐惧。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS最后：您可以在</font></font><a href="http://example-mvc.azurewebsites.net/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此地址</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看该项目的工作方式</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">而</font></font><a href="https://yadi.sk/d/EArrZdGh_iVaJg" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，你可以下载整个项目。</font><font style="vertical-align: inherit;">好了，到堆- </font></font><a href="https://dukeyusupov.wordpress.com/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的博客</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的链接</font><font style="vertical-align: inherit;">。</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN482346/">https://habr.com/ru/post/zh-CN482346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN482330/index.html">用于剖析Ruby on Rails应用程序的基本gem列表</a></li>
<li><a href="../zh-CN482336/index.html">交易者可以在公共广播之前参加英格兰中央银行的新闻发布会</a></li>
<li><a href="../zh-CN482338/index.html">Visual Studio for Mac：用键控制您的IDE</a></li>
<li><a href="../zh-CN482340/index.html">从初级到中级：解析器</a></li>
<li><a href="../zh-CN482344/index.html">准备在俄罗斯引入社会评级</a></li>
<li><a href="../zh-CN482348/index.html">毫不怀疑的游戏开发者的拓扑和综合分析：压缩单个3D向量</a></li>
<li><a href="../zh-CN482352/index.html">当我差点将150k投向风或者公寓中强制通风的安装历史时</a></li>
<li><a href="../zh-CN482354/index.html">ConfigureAwait：常见问题</a></li>
<li><a href="../zh-CN482356/index.html">从常规Windows用户的角度来看，在没有资源管理器的情况下使用Windows Server</a></li>
<li><a href="../zh-CN482358/index.html">惊慌如何在Rust中发挥作用</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>