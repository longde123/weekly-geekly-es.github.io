<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé∞ üò• ‚úåüèª ¬øPor qu√© monitorear los sistemas de almacenamiento? üòô üò∏ üêç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alguien caer√° pronto 

 Porque SHD almacena lo sagrado de los santos: datos. Si los datos ya no est√°n disponibles, huele a frito muy pronto. O si de r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øPor qu√© monitorear los sistemas de almacenamiento?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/croc/blog/413247/"><img src="https://habrastorage.org/webt/ph/hp/en/phhpenviwwkomiriz7rmdco7blo.png"><br>  <i>Alguien caer√° pronto</i> <br><br>  Porque SHD almacena lo sagrado de los santos: datos.  Si los datos ya no est√°n disponibles, huele a frito muy pronto.  O si de repente el lugar se acaba, tambi√©n es una sorpresa desagradable.  Por lo tanto, el monitoreo debe ser obligatorio y debe cubrir los sistemas de almacenamiento. <br><br>  Hay dos enfoques principales para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">monitorear el almacenamiento</a> .  Utilice un sistema de monitoreo universal como Nagios, Icinga, que recopilar√° informaci√≥n a trav√©s de SNMP, o compre software altamente especializado de los propios fabricantes de los sistemas de almacenamiento.  Por supuesto, la segunda opci√≥n proporciona un an√°lisis m√°s profundo del estado del hierro, muestra cosas espec√≠ficas como el estado de la memoria cach√©, iops, tasa de aciertos, controladores de carga, etc. Esta es la opci√≥n elegida con mayor frecuencia por nuestros clientes, que tienen matrices grandes y costosas en servicio. . <br><br>  Pero, por cierto, no todo es tan f√°cil con el software de monitoreo comercial.  Con m√°s detalle lo contar√© m√°s.  Ser√°, por as√≠ decirlo, una experiencia de primera mano.  En un momento, durante casi 2 a√±os estuve terminando uno de estos sistemas para miles de trozos de papel verde de un vendedor famoso.  Y lo recogi√≥ para que incluso el apoyo del vendedor comenzara a consultarme.  Pero algunos problemas de software fueron reemplazados por otros, as√≠ como algunos indios de apoyo fueron reemplazados por nuevos indios, y fue entonces cuando tuve la idea, si no de actuar radicalmente ... En general, todo comenz√≥ con esto. <br><a name="habracut"></a><br><h3>  ¬øQu√© hay de malo con el software del proveedor? </h3><br>  Como dije, el monitoreo del fabricante monitorea perfectamente los sistemas de almacenamiento del mismo fabricante.  Esta es su principal ventaja.  Las desventajas crecen a partir de aqu√≠: las matrices de otros fabricantes se admiten de forma limitada o no se admiten.  Resulta que si tiene varias matrices diferentes en la granja, entonces necesita varias herramientas de monitoreo diferentes.  S√≠, y no olvide cu√°l de qu√© y cu√°ndo necesita verlo la pr√≥xima vez.  Idealmente, generalmente por administrador para cada matriz. <br><br>  No es ning√∫n secreto que las herramientas de los fabricantes vendedores cuestan dinero y son bastante grandes.  Y la extensi√≥n del soporte tambi√©n cuesta un centavo.  Y algunos proveedores han dominado un nuevo enfoque: anuncian el final del ciclo de vida de su software y ofrecen simplemente comprar otro producto, sin migraci√≥n de licencias.  Fue una configuraci√≥n que ocurri√≥ hace un par de meses con uno de nuestros clientes.  No hay opciones: si desea continuar monitoreando el hardware, realice una nueva compra. <br><br>  Si profundiza en el software del proveedor, aparecer√°n otras caracter√≠sticas desagradables.  Por ejemplo, en varios productos puede ver la imagen del estado actual, pero no puede ver el historial del per√≠odo anterior.  O la historia es limitada: el registro se reescribe una vez cada 3 d√≠as.  Simplemente no hay necesidad de hablar sobre la acumulaci√≥n de estad√≠sticas.  Y a menudo se requiere el historial de eventos para pron√≥sticos, por ejemplo, la compra de repuestos, y para informar e investigar incidentes.  Por ejemplo, los frenos en algunos sistemas comerciales se pueden empujar al sistema de almacenamiento y, si no hay datos reales, no hay nada para esconderse. <br><br>  Y finalmente, uno no puede dejar de quejarse de la velocidad de las actualizaciones y los cambios en el software del proveedor.  ¬°Oh, con qu√© frecuencia me he encontrado con este problema durante mi larga pr√°ctica!  Est√°n saliendo nuevos modelos de matrices, est√°n saliendo nuevos firmwares, aparecen nuevas configuraciones.  Todo esto interrumpe f√°cilmente el monitoreo de trabajo: o alg√∫n tipo de infante deja de ser recolectado, o las matrices generalmente se caen.  En un nuevo microc√≥digo, un fabricante desactiv√≥ el soporte para versiones antiguas de SSL, y el software de monitoreo a√∫n no admit√≠a el protocolo TLS.  Y al principio nadie pudo encontrar una raz√≥n.  Despu√©s de mi propia investigaci√≥n, envi√© estas entradas al fabricante, y ya actualizaron las antiguas bibliotecas.  Sin embargo, toda esta burocracia dur√≥ indefinidamente. <br><br>  Y una vez que fallamos el piloto en el cliente.  Se propuso utilizar el software del proveedor, y al cliente le gust√≥ todo en t√©rminos de funcionalidad e interfaz.  Pero desafortunadamente, sus principales sistemas productivos no fueron compatibles.  Incluso estaban listos para esperar uno o dos meses, pero el proveedor dijo que no hab√≠a planes para incluir estos sistemas en el soporte en un futuro pr√≥ximo (y esto fue solo una actualizaci√≥n de la l√≠nea Hitachi AMS en HUS). <br><br>  En general, una gran cantidad de inconvenientes y por alguna raz√≥n por mucho dinero. <br><br><h3>  Hace mucho tiempo no recog√≠ damas ... </h3><br>  Frustrado por este estado de cosas, a menudo he pensado en c√≥mo implementar mi propio monitoreo para el almacenamiento.  Si conoce bien la matriz y posee su CLI, puede obtener r√°pidamente la informaci√≥n que necesita sobre el estado o llegar al fondo de los problemas.  Por supuesto, antes de esto, es necesario palear muchos muelles, foros de humo y bases de conocimiento de proveedores, informaci√≥n fragmentariamente diferente.  Pero cuando sabes qu√© comando escribir con qu√© tecla y qu√© significa cada columna de salida, ya eres un gur√∫.  Quedaba por construir este conocimiento en una interfaz conveniente, que continuar√° haciendo todo por usted. <br><br>  Admito que al principio plane√© escribir la interfaz desde cero tambi√©n, pero luego me encontr√© con Zabbix, una herramienta madura con una gran comunidad, que tambi√©n es f√°cil de expandir.  Ten√≠a todo lo que necesitaba: una interfaz, un modelo a seguir, notificaciones, un sistema de activaci√≥n, agentes de cliente proxy.  Solo quedaba que esta combinaci√≥n proporcionara correctamente informaci√≥n sobre los sistemas de almacenamiento y los valores de umbral de varios par√°metros.  El caso comenz√≥ a hervir.  Contamos con un equipo de especialistas en matrices.  Por supuesto, es imposible conocer todas las matrices por una persona, por lo que estamos divididos por modelo y fabricante. <br><br>  Otra dificultad en el desarrollo de su propio monitoreo es la capacidad de acceder a las piezas de hierro por s√≠ mismas y para que a√∫n no tengan miedo de cargar, romper y realizar todo tipo de experimentos.  Afortunadamente, los recursos de nuestro laboratorio permitieron todo esto. <br><br>  Lo primero que se debe monitorear es el estado de todos los componentes de hardware.  Se puede tomar algo a trav√©s de SNMP, pero en la mayor√≠a de los casos se trata de una encuesta que utiliza un protocolo especial (SMI-S, REST API, SOAP API y otros).  Debo decir que las matrices mismas te permiten configurar notificaciones sobre aver√≠as en ellas.  Y todos los clientes usan esto como m√≠nimo.  Pero, ¬øqu√© sucede si se rompe la notificaci√≥n en la matriz?  Esto sucedi√≥, y m√°s de una vez, cuando la matriz estuvo en silencio durante semanas y a todos les pareci√≥ que todo estaba en orden, estaba en silencio.  Y de repente se hizo evidente que un n√∫mero cr√≠tico de discos vol√≥ sobre √©l, pero ya era demasiado tarde. <br><br>  El segundo punto importante a monitorear es el rendimiento.  Porque cuando un rendimiento se basa en un sistema de almacenamiento con un retraso de grabaci√≥n de unos segundos, Oracle simplemente puede subir y bajar.  Ni idea  Es el rendimiento en grandes infraestructuras con muchos sistemas de almacenamiento el peor controlado.  Y Zabbix tiene un an√°lisis predictivo extremadamente conveniente: en funci√≥n del pron√≥stico, puede establecer el valor de la m√©trica, que se convertir√° en el futuro.  Por ejemplo, hicimos un disparador que funcionar√° si hay un pron√≥stico de que solo quedar√°n 3 meses para la disposici√≥n actual.  O, por ejemplo, que el tiempo de respuesta seg√∫n el pron√≥stico en 2 semanas ser√° mayor en 50 milisegundos.  El monitoreo nos da tiempo para conocer de antemano los problemas futuros y para hacer algo ya. <br><br>  En alg√∫n momento, nos dimos cuenta de que es bueno saber sobre el estado del almacenamiento, por supuesto, pero es mucho mejor entender qu√© m√°s est√° sucediendo en la red y en el lado del servidor.  Como resultado, despu√©s de varios meses de trabajo, fue posible ver los servidores, la red y los sistemas de almacenamiento en una interfaz.  No solo aparecieron complementos y conectores para almacenamiento, sino tambi√©n un enlace √∫til en forma de mapas de topolog√≠a de red.  Hasta ahora, por supuesto, el complemento tiene en cuenta nuestra experiencia y nuestras necesidades, pero si nos dice lo que necesita ver en √©l, lo modificaremos. <br><br><img src="https://habrastorage.org/webt/ut/cc/sz/utccszsrlpc89pbcvjqvzo5pr7y.png"><br>  <i>Topolog√≠a de extremo a extremo para VMware Cluster: de la m√°quina virtual al volumen de almacenamiento</i> <br><br><img src="https://habrastorage.org/webt/tu/uv/nm/tuuvnmtm6hn04e1gs4oqtqzebjm.png"><br><img src="https://habrastorage.org/webt/8q/jc/g6/8qjcg65vrycqdrzzrlxbbfsrls8.png"><br>  <i>Rendimiento</i> <br><br>  En el gr√°fico de rendimiento de la matriz, vemos que el sistema est√° muy sobrecargado.  La alta utilizaci√≥n de grupos de discos indica que los discos est√°n sobrecargados.  Hay muchas operaciones de E / S en los puertos de almacenamiento, lo que significa que los sistemas de TI cargan la matriz por su parte.  Bueno, el gr√°fico caracter√≠stico del tiempo de respuesta, as√≠ como la utilizaci√≥n de procesadores por encima de los valores recomendados.  Veredicto: se pusieron demasiadas tareas en la matriz; algunas de ellas deben migrarse. <br><br><img src="https://habrastorage.org/webt/5y/rj/_o/5yrj_osycqxzagfoddfq1y9rd5g.png"><br>  <i>Mapa de red de almacenamiento: encontrar cuellos de botella</i> <br><br><h3>  Resumen </h3><br>  Que conseguimos  Hemos equipado el popular y muy com√∫n sistema de monitoreo Zabbix con nuevas caracter√≠sticas, que incluyen: <br><br><ol><li>  Recopilaci√≥n de informaci√≥n sobre el estado de todos los componentes l√≥gicos y de hardware de matrices de discos y conmutadores de la red de almacenamiento. </li><li>  Estad√≠sticas de rendimiento para absolutamente todos los sistemas para los que creamos complementos (los proveedores tienen lagunas en este sentido). </li><li>  Mapas topol√≥gicos de una red de almacenamiento compartido y de extremo a extremo desde m√°quinas virtuales a vol√∫menes en sistemas de almacenamiento (hasta ahora solo para VMware). </li><li>  Recolecci√≥n de toda la informaci√≥n de inventario. </li><li>  La cantidad de espacio en disco. </li></ol><br>  El propio Zabbix le permite crear notificaciones muy interesantes, establecer umbrales y enviar cartas informativas sobre el problema.  Por ejemplo, si el puerto en el conmutador se cay√≥ (o el tr√°fico en el puerto se hizo muy grande), el mensaje contendr√° no solo el nombre del conmutador con el n√∫mero de puerto, sino tambi√©n informaci√≥n sobre el dispositivo conectado. <br><br>  ¬øQu√© sistemas soportamos actualmente?  Muchos diferentes: <br><br><ol><li>  Todos los arreglos de Hitachi (AMS, HUS, VSP, VSP G). </li><li>  Matrices Dell-EMC CLARiiON, VNX, Unity, ISILON, Compellent. </li><li>  Matrices HPE 3PAR, P9500, XP7. </li><li>  Matrices de IBM Storwize, DS5000. </li><li>  Matrices NetApp FAS (modo 7, modo c). </li><li>  HPE StoreOnce, EMC DataDomain Disk Libraries. </li><li>  Conmutadores Brocade Silkworm, Cisco MDS. </li></ol><br>  Tambi√©n tenemos extensiones para algunos sistemas operativos (Windows, ESX), con los cuales recopilamos datos sobre FC HBA para dibujar mapas topol√≥gicos en el futuro.  Desarrollo activo de complementos para OpenStack y sistemas de virtualizaci√≥n. <br><br>  Al desarrollar complementos, se tiene en cuenta la experiencia de nuestros ingenieros, detr√°s de la cual hay muchos casos para resolver problemas en matrices, tanto de hardware como de rendimiento.  Los nuevos complementos se desarrollan a pedido en poco tiempo debido a la gran cantidad de bibliotecas preparadas propias. <br><br>  Algunos de nuestros clientes configuran el sistema de la siguiente manera: las notificaciones con el n√∫mero del contrato, las personas de contacto y todos los par√°metros del componente defectuoso se env√≠an autom√°ticamente a nuestro correo.  Esto reduce el tiempo de reacci√≥n y el pedido de las piezas de repuesto necesarias, ya que el ingeniero de servicio no necesita llamar y aclarar mucha informaci√≥n, incluso de noche.  La aplicaci√≥n se pone inmediatamente a trabajar. <br><br>  ¬øC√≥mo resuelve los problemas de monitoreo de su infraestructura, en particular el almacenamiento?  Cu√©ntanoslo en los comentarios o en la carta al correo VRyzhevsky@croc.ru </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es413247/">https://habr.com/ru/post/es413247/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es413237/index.html">Facebook niega haber enviado a los fabricantes de dispositivos los mismos datos que el desarrollador Alexander Kogan</a></li>
<li><a href="../es413239/index.html">C√≥mo hacer que un tel√©fono inteligente sea un poco m√°s tonto</a></li>
<li><a href="../es413241/index.html">Funciones de interceptaci√≥n en el kernel de Linux usando ftrace</a></li>
<li><a href="../es413243/index.html">School of Data: c√≥mo combinar matem√°ticas y negocios</a></li>
<li><a href="../es413245/index.html">En equipos Dolby Atmos, solo sonido "nativo". Dolby proh√≠be la mezcla ascendente no nativa</a></li>
<li><a href="../es413249/index.html">Escribir un m√≥dulo de kernel de Linux: I2C</a></li>
<li><a href="../es413251/index.html">Reacci√≥n en cadena de la polimerasa y Vladivostok</a></li>
<li><a href="../es413253/index.html">Richard Hamming: Cap√≠tulo 21. Fibra √≥ptica</a></li>
<li><a href="../es413255/index.html">Richard Hamming: Cap√≠tulo 27. Datos inv√°lidos</a></li>
<li><a href="../es413261/index.html">Como funciona la b√∫squeda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>