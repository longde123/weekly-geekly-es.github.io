<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∫ üë∂üèº üîµ Visi√≥n del robot Raspberry Pi: mapa de profundidad üôáüèæ ü§Ωüèø üí®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoy, toda la tecnolog√≠a de "construcci√≥n de drones" se est√° volviendo activamente m√°s barata. Excepto por uno: obtener un mapa del espacio circundante...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Visi√≥n del robot Raspberry Pi: mapa de profundidad</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/388259/"><img src="https://habrastorage.org/files/174/cb5/63e/174cb563ec424e5aabb4fc27afb4ad23.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hoy, toda la tecnolog√≠a de "construcci√≥n de drones" se est√° volviendo activamente m√°s barata. </font><font style="vertical-align: inherit;">Excepto por uno: obtener un mapa del espacio circundante. </font><font style="vertical-align: inherit;">Existen dos extremos: o costosos lidares (miles de d√≥lares) y soluciones √≥pticas para construir un mapa de profundidad (muchos cientos de d√≥lares), o soluciones bastante centavas como tel√©metros ultras√≥nicos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por lo tanto, surgi√≥ una idea sobre la base de una Raspberry Pi econ√≥mica con una c√°mara para hacer una soluci√≥n que estar√≠a en un nicho vac√≠o y le permitir√≠a obtener un mapa de profundidad "a bajo costo". </font><font style="vertical-align: inherit;">Y para hacer esto en un lenguaje de programaci√≥n simple como Python, de modo que est√© disponible para que los principiantes experimenten. </font><font style="vertical-align: inherit;">En realidad, quer√≠a contarles sobre mis resultados. </font><font style="vertical-align: inherit;">Los scripts resultantes con fotos de muestra tambi√©n se pueden ejecutar en el escritorio.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mapa de profundidad de una c√°mara.</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primero, algunas palabras sobre la parte √≥ptica. Para crear un mapa de profundidad, siempre se utilizan dos im√°genes, desde las c√°maras izquierda y derecha. Y tenemos frambuesas con una c√°mara. Por lo tanto, se desarroll√≥ un divisor √≥ptico, que como resultado da un par est√©reo a la c√°mara. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En t√©rminos simples: si miras la foto, entonces, desde el cuadro negro, dos ojos de la c√°mara te miran. Pero en realidad la c√°mara es una. Solo un poco de magia √≥ptica.</font></font><br>
<br>
<img src="https://habrastorage.org/files/5b0/c19/5f5/5b0c195f51cb4550b910a49f925b0389.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La foto muestra la duod√©cima iteraci√≥n del dispositivo. </font><font style="vertical-align: inherit;">Tom√≥ mucho tiempo obtener un dise√±o estable confiable, que al mismo tiempo ser√≠a econ√≥mico. </font><font style="vertical-align: inherit;">La parte m√°s dif√≠cil son los espejos internos, que se fabricaron por encargo mediante deposici√≥n al vac√≠o de aluminio. </font><font style="vertical-align: inherit;">Si usa espejos est√°ndar, en los que la capa reflectante se encuentra debajo del vidrio, y no por encima de √©l, entonces en la uni√≥n forman un espacio que arruina radicalmente toda la imagen.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øEn qu√© trabajaremos?</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La imagen de frambuesa de Raspbian Wheezy se tom√≥ como base, se instalaron Python 2.7 y OpenCV 2.4, bueno, los paquetes necesarios para las peque√±as cosas: matplotlib, numpy y otros. </font><font style="vertical-align: inherit;">Todos los tipos y un enlace a la imagen final de la tarjeta se presentan al final del art√≠culo. </font><font style="vertical-align: inherit;">La descripci√≥n de los scripts en forma de lecciones se puede encontrar en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el sitio web del proyecto.</font></font></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preparando una imagen para construir un mapa de profundidad</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como nuestra soluci√≥n no est√° hecha de metal y sin una √≥ptica ultra precisa, es posible que se produzcan peque√±as desviaciones de la geometr√≠a ideal como resultado del ensamblaje. </font><font style="vertical-align: inherit;">Adem√°s, la c√°mara est√° unida al dispositivo con tornillos, por lo que su posici√≥n puede no ser la ideal. </font><font style="vertical-align: inherit;">El problema con la ubicaci√≥n de la c√°mara se resuelve manualmente, y la compensaci√≥n por la "curvatura" del ensamblaje de la estructura se realizar√° en el software.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script One - Alineaci√≥n de c√°mara</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La uni√≥n de los espejos en la imagen idealmente debe ser vertical y centrada. </font><font style="vertical-align: inherit;">Es dif√≠cil hacerlo a simple vista, por lo que se hizo el primer gui√≥n. </font><font style="vertical-align: inherit;">Simplemente captura la imagen de la c√°mara en modo de vista previa en vivo, la muestra en la pantalla y, en el centro, en la superposici√≥n, dibuja una franja blanca a lo largo de la cual se est√° alineando. </font><font style="vertical-align: inherit;">Despu√©s de que la c√°mara est√° orientada correctamente, apretamos los tornillos con m√°s fuerza y ‚Äã‚Äãse completa el montaje.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.youtube.com/embed/Kjx__P1AhKY%3Ffeature%3Doembed&amp;usg=ALkJrhics_fEGQWxl8RdfbMiFQmIlnLrsA" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo que es interesante en el c√≥digo del primer script</font></font></b><div class="spoiler_text"><ul>
<li>    ‚Äì <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a></li>
<li>           ‚Äì        ,       cv.imshow()      ,    .       ,     .   ,   ,       .</li>
<li>  ‚Äì         , ..     .   ¬´¬ª  ,  camera.hflip = True</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El segundo script: obtenemos un par est√©reo "limpio"</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nuestras im√°genes izquierda y derecha se unen en el centro de la imagen. </font><font style="vertical-align: inherit;">La uni√≥n en la foto tiene un ancho distinto de cero: puede deshacerse de ella solo quitando los espejos del dispositivo, lo que aumenta el tama√±o de la estructura. </font><font style="vertical-align: inherit;">La c√°mara de la frambuesa tiene un enfoque establecido en infinito, y los objetos ubicados cerca (en nuestro caso, esto es una uni√≥n) simplemente se "desenfocan". </font><font style="vertical-align: inherit;">Por lo tanto, solo necesita decirle al script lo que, en nuestra opini√≥n, es una zona ‚Äúmala‚Äù, para que el par est√©reo se corte en im√°genes. </font><font style="vertical-align: inherit;">Se realiz√≥ un segundo gui√≥n que muestra una imagen y le permite usar las teclas para indicar la zona que se va a cortar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve el proceso:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.youtube.com/embed/4eCGq_mEot8%3Ffeature%3Doembed&amp;usg=ALkJrhhBphli6Wf-ijKuwahJeveSNd6VqA" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo que es interesante en el c√≥digo del segundo script</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a></li>
<li> ,  ,     cv2.rectangle().   ,          ,       .  , ,    Enter     .</li>
<li>   ,         .           ,        .</li>
<li>         JSON.    ,   ,      .</li>
<li>   . ,     ,        ,      .       ,      ./src          .        .     pf_1280_720.txt ‚Äì       ,     .</li>
<li>           ,       .             .       :<br>
<pre><code class="python hljs">loadImagePath = <span class="hljs-string"><span class="hljs-string">""</span></span>
<span class="hljs-comment"><span class="hljs-comment"># loadImagePath = "./src/scene_1280x720_1.png"</span></span></code></pre></li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tercer gui√≥n: una serie de fotos para calibrar</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La ciencia b√°sica dice que para construir con √©xito un mapa de profundidad, el par est√©reo debe calibrarse. Es decir, todos los puntos clave de la imagen de la izquierda deben estar a la misma altura y en la imagen de la derecha. En esta situaci√≥n, la funci√≥n StereoBM, que es nuestro √∫nico tiempo real, puede hacer su trabajo con √©xito. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para la calibraci√≥n, necesitamos imprimir una imagen de referencia, hacer una serie de fotos y entregarla al algoritmo de calibraci√≥n, que calcular√° todas las distorsiones y guardar√° los par√°metros para que las im√°genes vuelvan a la normalidad. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, imprima el " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tablero de ajedrez</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " y p√©guelo sobre una superficie plana y dura. Para simplificar, la foto en serie se hizo un script con un temporizador de cuenta regresiva, que se muestra en la parte superior del video. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve el gui√≥n de fotograf√≠a en serie en el trabajo:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.youtube.com/embed/3COWaa2dW8s%3Ffeature%3Doembed&amp;usg=ALkJrhjGPTqRkQNNJOO8fBsqxAybB9Ec7Q" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo que es interesante en el tercer c√≥digo de script</font></font></b><div class="spoiler_text"><ul>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a></li>
<li>   . ,         . ,     ,   ¬´¬ª  .   ,          ‚Äì      ,     .          camera.capture ()  ,   use_video_port=True.</li>
<li>       ‚Äì   camera.annotate_text()          .     5  ‚Äì           .</li>
<li>-,             ,          ./src</li>
</ul><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cabe se√±alar que la "correcci√≥n" de la serie realizada es fundamental para los resultados de la calibraci√≥n. </font><font style="vertical-align: inherit;">Un poco m√°s adelante veremos el resultado que se obtiene con fotograf√≠as tomadas incorrectamente.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script 4: cortar fotos en pares est√©reo</font></font></h2><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de tomar una serie de fotos, haremos otro script de servicio que tome la serie completa de fotos y las corte en pares de im√°genes, izquierda y derecha, y las guarde en una carpeta. zonas en el centro de la imagen. </font><font style="vertical-align: inherit;">El gui√≥n es bastante ordinario, as√≠ que escond√≠ el video debajo de un spoiler.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un ejemplo de trabajo y un enlace a las fuentes del cuarto gui√≥n.</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4- </a></li>
<li>    :<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.youtube.com/embed/NvzUPVe2qvo%3Ffeature%3Doembed&amp;usg=ALkJrhhIxbVNZZjaK9lY2eIKm2mUtuphcQ" frameborder="0" allowfullscreen=""></iframe></li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lo m√°s interesante es la calibraci√≥n, el quinto script </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El script de calibraci√≥n alimenta todos los pares est√©reo desde la carpeta ./src a la funci√≥n de calibraci√≥n y se sumerge en la reflexi√≥n. </font><font style="vertical-align: inherit;">Despu√©s de su dif√≠cil trabajo (para 15 im√°genes de 1280x720 en la primera frambuesa se tarda unos 5 minutos), toma el √∫ltimo par est√©reo, "corrige" las im√°genes (rectifica) y muestra versiones ya corregidas con las que puede construir un mapa de profundidad. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve el gui√≥n en el trabajo:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.youtube.com/embed/mktMyDSskRM%3Ffeature%3Doembed&amp;usg=ALkJrhiajqZEd4jSOGBYApm2vcuytzIzJg" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo que es interesante en el c√≥digo del quinto gui√≥n</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a></li>
<li>     StereoVision. ,       ,       ,         ¬´¬ª .</li>
<li>                ,     .    .     ¬´¬ª ,    ,   </li>
<li><pre><code class="python hljs">calibrator.add_corners((imgLeft, imgRight), <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code></pre>  True  False ‚Äì    ,    .</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Algo sali√≥ mal".</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay momentos en que los resultados de la calibraci√≥n son inesperados. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ hay un par de ejemplos sorprendentes: </font></font><br>
<br>
<img src="https://habrastorage.org/files/ff2/0f1/11f/ff20f111fa8e4a59a068fb054bc13831.jpg" alt="Mapa de disparidad mala"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, la calibraci√≥n es un momento decisivo. </font><font style="vertical-align: inherit;">Lo que obtengamos en la etapa de construcci√≥n de un mapa de profundidad depende directamente de su calidad. </font><font style="vertical-align: inherit;">Despu√©s de una gran cantidad de experimentos, surgi√≥ la siguiente lista de requisitos de disparo:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La imagen del ajedrez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> debe ser paralela al plano de la foto, siempre en diferentes √°ngulos. </font><font style="vertical-align: inherit;">Pero incluso sin fanatismo: si mantiene el tablero casi perpendicular al plano de la foto, el gui√≥n simplemente no encontrar√° el ajedrez en la imagen.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luz, buena luz. </font><font style="vertical-align: inherit;">Con poca luz en la habitaci√≥n, e incluso al sacar im√°genes del video, la calidad de la imagen disminuye. </font><font style="vertical-align: inherit;">En mi caso, la luz en el 90% de los casos corrigi√≥ de inmediato la situaci√≥n.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet escribe que la pizarra debe ocupar el espacio m√°ximo en la imagen siempre que sea posible. </font><font style="vertical-align: inherit;">Realmente ayuda.</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve un par est√©reo "fijo" con buenos resultados de calibraci√≥n:</font></font><br>
<br>
<img src="https://habrastorage.org/files/b1a/080/c51/b1a080c51edc481685ad2ec4c266791f.jpg" alt="imagen"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script 6: el primer intento de construir un mapa de profundidad</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como si todo estuviera listo, ya puedes construir un mapa de profundidad. </font><font style="vertical-align: inherit;">Cargamos los resultados de la calibraci√≥n, tomamos una foto y construimos audazmente un mapa de profundidad usando cv2.StereoBM </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obtenemos algo como esto: </font></font><br>
<br>
<img src="https://habrastorage.org/files/038/1a8/87f/0381a887fa0c4e1eac31f2e810b0ee78.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
el resultado no es muy impresionante, obviamente necesitamos torcer algo. </font><font style="vertical-align: inherit;">Bueno, procedamos a una afinaci√≥n m√°s precisa en el pr√≥ximo s√©ptimo gui√≥n. </font><font style="vertical-align: inherit;">All√≠ usaremos para la construcci√≥n no 2 par√°metros, como en StereoBM (), sino casi 10, que es mucho m√°s interesante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ est√°n las fuentes </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">del sexto gui√≥n</font></font></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Script 7 - mapa de profundidad con configuraciones avanzadas </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando los par√°metros no son 2 sino 10, es incorrecto ordenar sus opciones con un reinicio constante de los scripts. </font><font style="vertical-align: inherit;">Por lo tanto, se cre√≥ un gui√≥n para una conveniente sintonizaci√≥n interactiva del mapa de profundidad. </font><font style="vertical-align: inherit;">La tarea no era complicar el c√≥digo con la interfaz, por lo que todo se hizo en matplotlib. </font><font style="vertical-align: inherit;">El dibujo de la interfaz en matplotlib en frambuesas es bastante lento, por lo que generalmente transfiero la carpeta de trabajo de frambuesas a la computadora port√°til y selecciono los par√°metros all√≠. </font><font style="vertical-align: inherit;">As√≠ es como funciona el gui√≥n:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.youtube.com/embed/cNpMje5AKTQ%3Ffeature%3Doembed&amp;usg=ALkJrhjr4btCNnypbQqmzYzf7QSEgJmMug" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de haber seleccionado los par√°metros, el script con el bot√≥n Guardar guarda el resultado en el archivo 3dmap_set.txt en formato JSON.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øQu√© es interesante en el c√≥digo de la 7ma secuencia de comandos?</font></font></b><div class="spoiler_text"><ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">7- </a></li>
<li>       . ,   -     ,        .</li>
<li>   ,         . , numOfDisparities    16,            .           update(val),            .   numOfDisparities    65.57     64.         ,            .</li>
<li>      matplotlib       ,     .</li>
</ul><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El trabajo pr√°ctico con el mapa de profundidad mostr√≥ que, en primer lugar, debe seleccionar el par√°metro minDisparity y, junto con √©l, numOfDisparities. </font><font style="vertical-align: inherit;">Bueno, recuerde que numOfDisparities en realidad cambia discretamente, con el paso 16. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de configurar este par, puede jugar con otros par√°metros. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las caracter√≠sticas de la configuraci√≥n de la tarjeta ya dependen del gusto del usuario y dependen de la tarea a resolver. </font><font style="vertical-align: inherit;">Puede llevar el mapa a una gran cantidad de partes peque√±as o mostrar √°reas ampliadas. </font><font style="vertical-align: inherit;">Para una simple evitaci√≥n de obst√°culos por parte de los robots, el segundo es m√°s adecuado. </font><font style="vertical-align: inherit;">Para una nube de puntos, la primera, pero los problemas de rendimiento aparecen aqu√≠ (volveremos a ellos).</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que queremos ver</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, quiz√°s uno de los puntos m√°s importantes es el ajuste de la "hipermetrop√≠a" de nuestro dispositivo. </font><font style="vertical-align: inherit;">Cuando configuro el mapa de profundidad, suelo colocar un objeto a una distancia de unos 30 cm, el segundo en un metro y el resto dos metros m√°s adelante. </font><font style="vertical-align: inherit;">Y al configurar los dos primeros par√°metros (minDisparity y numOfDisparities) en el s√©ptimo script, logro lo siguiente:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objeto m√°s cercano (30 cm) - rojo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objeto en medio metro - amarillo o verde</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Objetos de 2-3 metros - verde o azul claro</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, obtenemos un sistema configurado para reconocer la zona "cercana" de obst√°culos en un radio de 5-10 metros.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabajando con video sobre la marcha - gui√≥n octavo, final</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, ahora tenemos un sistema personalizado ya hecho, y tendr√≠amos que obtener un resultado pr√°ctico. </font><font style="vertical-align: inherit;">Estamos tratando de construir un mapa de profundidad en tiempo real usando el video de nuestra c√°mara y mostrarlo en tiempo real a medida que se actualiza.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.youtube.com/embed/-qTayRg8skA%3Ffeature%3Doembed&amp;usg=ALkJrhjacICcQib8kjPhbOpJt8BpfFd1ug" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo que es interesante en el c√≥digo del octavo script</font></font></b><div class="spoiler_text">  ‚Äì   .   ,     ,        overlay.      ,  :<br>
<br>
<ul>
<li>Overlay        R, G  B,      -   .    grayscale   </li>
<li><pre><code class="python hljs">disparity_color = cv2.applyColorMap(disparity_grayscale, cv2.COLORMAP_JET)</code></pre></li>
<li>  overlay    RGB,     BGR ‚Äì        cv2.cvtColor()</li>
<li>Overlay      16.     16 ‚Äî    .</li>
</ul><br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la carrera por la velocidad</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, la primera medici√≥n se realiz√≥ en la primera Raspberry con un procesador de un solo n√∫cleo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 segundos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - construyendo un mapa en la imagen de 1280x720 Esto es mucho. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.5 segundos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - en la Raspberry Pi 2, ya mejor. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El an√°lisis mostr√≥ que en este caso, solo se usa un n√∫cleo en la segunda frambuesa. L√≠o! Reconstru√≠ OpenCV usando la biblioteca de paralelizaci√≥n TBB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.5 segundos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - inicie en la segunda frambuesa usando m√∫ltiples n√∫cleos. De hecho, result√≥ que solo se usan 2 n√∫cleos, esto todav√≠a tiene que ser manipulado. Result√≥ que </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no solo me</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> encontr√© con este problema </font><font style="vertical-align: inherit;">, por lo que todav√≠a hay espacio para moverme.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A juzgar por el algoritmo, la velocidad de operaci√≥n deber√≠a depender linealmente del tama√±o de los datos procesados. </font><font style="vertical-align: inherit;">Por lo tanto, si reduce la resoluci√≥n 2 veces, entonces, en teor√≠a, todo deber√≠a funcionar 4 veces m√°s r√°pido. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.3 segundos</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o aproximadamente 3-4 FPS - con una resoluci√≥n medio reducida de 640x360. </font><font style="vertical-align: inherit;">La teor√≠a fue confirmada.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Planes adicionales</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En primer lugar, quer√≠a aprovechar al m√°ximo el multin√∫cleo de la segunda frambuesa. </font><font style="vertical-align: inherit;">Echar√© un vistazo m√°s de cerca a las fuentes de la funci√≥n StereoBM y tratar√© de entender por qu√© el trabajo no est√° funcionando del todo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente etapa promete mucha m√°s aventura: este es el uso de GPU de frambuesas para acelerar los c√°lculos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ se dibujan tres posibles caminos:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>      GPU,     10 FPS,      .     ‚Äî  ,     ¬´ ¬ª   OpenCV,    .</li>
<li>        Koichi Nakamura,    GPU    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a>.  ,     -  OpenCV,     . </li>
<li>              Jan Newmarch "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Programming AudioVideo on the Raspberry Pi GPU</a>" </li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si ten√≠a experiencia trabajando con TBB para Raspberry OpenCV, o si estaba lidiando con la codificaci√≥n de GPU de frambuesa, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le agradecer√© sugerencias adicionales</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Logr√© encontrar bastantes desarrollos listos para usar por una simple raz√≥n: las frambuesas con dos c√°maras son una ocurrencia rara. </font><font style="vertical-align: inherit;">Si conecta dos c√°maras web a trav√©s de USB, entonces vienen grandes frenos, y solo Raspberry Pi Compute puede funcionar con dos c√°maras nativas, que tambi√©n necesitan un devboard fuerte con cordones y adaptadores.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enlaces utiles:</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Guiones de trabajo:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuentes de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> los 8 scripts en github</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagen de la tarjeta ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.6GB en el archivo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configuraci√≥n de OpenCV y Python en frambuesas:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gran blog "python-OpenCV-shnik" y un manual </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para configurar Python y OpenCV en frambuesas</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Biblioteca StereoVision:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mi </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">tenedor de</font></a><font style="vertical-align: inherit;"> trabajo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en github</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Original de Egret </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en el github</font></font></a></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n del autor StereoVision en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">su blog</font></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
GPU trabajo</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liebits</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> japon√©s Koichi Nakamura </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">en github</font></a><font style="vertical-align: inherit;"> - ensamblador para python para GPU</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jan Newmarch Libro " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programaci√≥n de audio y video en la GPU Raspberry Pi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si necesita trabajar con una c√°mara de frambuesa Like a Boss: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">documentaci√≥n de</font></a></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Picamera</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"></font></a></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, un art√≠culo interesante sobre el habr sobre " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para reconocer im√°genes, no es necesario reconocerlas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es388259/">https://habr.com/ru/post/es388259/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es388243/index.html">Vigilancia dom√©stica y visualizaci√≥n remota a trav√©s de Internet.</a></li>
<li><a href="../es388245/index.html">El primer tel√©fono modular sali√≥ a la venta.</a></li>
<li><a href="../es388247/index.html">Cassini vol√≥ junto a Encelado por √∫ltima vez.</a></li>
<li><a href="../es388253/index.html">En 2015, Costa Rica recibi√≥ alrededor del 99% de su electricidad de fuentes renovables.</a></li>
<li><a href="../es388257/index.html">Polvo de bricolaje para lavavajillas: desmontamos productos industriales y mejoramos la receta</a></li>
<li><a href="../es388261/index.html">Memorias de un robot infrahumano, cap√≠tulos 3-4</a></li>
<li><a href="../es388263/index.html">Conceptos err√≥neos sobre el universo [Voiceover Vert Dider]</a></li>
<li><a href="../es388265/index.html">M√≥dem wifi para Commodore: ¬øc√≥mo se ve?</a></li>
<li><a href="../es388267/index.html">Volamos y nos sentamos con el Falcon 9R</a></li>
<li><a href="../es388271/index.html">Kruglendar 2016 - cartel diario</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>