<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÉ ‚úåÔ∏è ‚õπüèæ DEFCON-Konferenz 18. Trollim Reverse Engineering mit Mathematik üïØÔ∏è üïñ üòØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mathe-Trolling ist das, wor√ºber ich sprechen werde. Dies sind keine modischen Hacker-Tricks, sondern ein k√ºnstlerischer Ausdruck, eine lustige, intell...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DEFCON-Konferenz 18. Trollim Reverse Engineering mit Mathematik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/433280/"> Mathe-Trolling ist das, wor√ºber ich sprechen werde.  Dies sind keine modischen Hacker-Tricks, sondern ein k√ºnstlerischer Ausdruck, eine lustige, intelligente Technologie, mit der die Leute Sie als Idioten betrachten.  Jetzt werde ich pr√ºfen, ob mein Bericht bereit ist, auf dem Bildschirm angezeigt zu werden.  Alles scheint gut zu laufen, also kann ich mich vorstellen. <br><br><img src="https://habrastorage.org/webt/ez/pj/s8/ezpjs8mlxgrkekfrl6cyjia0zhu.jpeg"><a name="habracut"></a><br><br>  Mein Name ist Frank Tu, buchstabiert frank ^ 2 und @franksquared auf Twitter, weil Twitter auch eine Art Spammer namens "frank 2" hat.  Ich habe versucht, Social Engineering auf sie anzuwenden, damit sie sein Konto l√∂schen, da es sich technisch gesehen um Spam handelt und ich das Recht habe, es als meinen Klon loszuwerden.  Aber anscheinend, wenn Sie sie ehrlich behandeln, erwidern sie nichts, denn trotz meiner Bitte, das Spammer-Konto zu l√∂schen, haben sie nichts damit gemacht, also habe ich dieses verdammte Twitter zur H√∂lle geschickt. <br><br>  Viele Leute erkennen mich an meiner M√ºtze.  Ich arbeite in den regionalen Gruppen DefCon DC949 und DC310.  Ich arbeite auch mit Rapid7, aber ich kann hier nicht dar√ºber sprechen, ohne schlechte Sprache zu verwenden, und mein Manager m√∂chte nicht, dass ich schw√∂re.  Daher habe ich diese Pr√§sentation f√ºr DefCon vorbereitet und werde die Frist von 15 Minuten einhalten, obwohl dies ein ziemlich kompliziertes Thema ist.  Dies ist im Wesentlichen eine Standardpr√§sentation, die sich auf Reverse Engineering und verwandte lustige Dinge konzentriert. <br><br>  Bei der Diskussion dieses Themas auf Twitter bildeten sich zwei Lager.  Einer sagte: "Ich habe keine Ahnung, wovon dieser verdammte Frank ^ 2 spricht, aber es ist gro√üartig!"  Der zweite Reddit-Typ sah meine Folien und war ver√§rgert √ºber Links zu Dingen, die nicht mit dem Thema zu tun hatten. Ich wurde w√ºtend, dass ein so ernstes Thema nicht vollst√§ndig behandelt wurde, und w√ºnschte mir, meine Pr√§sentation h√§tte ‚Äûmehr Inhalt und weniger M√ºll‚Äú. <br><br><img src="https://habrastorage.org/webt/dw/wg/il/dwwgilfsbikiyjsa8kkr-ifito8.jpeg"><br><br>  Deshalb m√∂chte ich mich auf dieses Zitat konzentrieren.  Nichts Pers√∂nliches, Alter von Reddit - ich sage das nicht nur f√ºr den Fall, dass er in diesem Raum anwesend ist, sondern auch, weil es faire Kritik war.  Weil eine Konversation, die nicht gen√ºgend n√ºtzliche Inhalte enth√§lt, eine leere Konversation ist. <br><br>  Das Thema meines Gespr√§chs ist eine Standardroutine f√ºr Hacker, aber es scheint mir, dass die Redner normalerweise nicht versuchen, ihre Informationen auf unterhaltsame Weise zu pr√§sentieren, selbst wenn dies m√∂glich ist, und trockene, entmannte Schlussfolgerungen bevorzugen.  "Hier ist IP, hier ist ESP, hier ist, wie Sie einen Exploit durchf√ºhren k√∂nnen, hier ist mein" Zero Day ", jetzt klatschen!"  - und jeder klatscht in die H√§nde. <br><br>  Danke f√ºr den Applaus, ich wei√ü das zu sch√§tzen!  Es scheint mir, dass mein Material viele interessante Punkte enth√§lt, daher verdient es, auf unterhaltsame Weise erw√§hnt zu werden, was ich versuchen werde. <br><br>  Sie werden eine au√üergew√∂hnlich oberfl√§chliche Einstellung zur Informatik und einen v√∂llig kindischen Humor sehen. Ich hoffe, Sie wissen zu sch√§tzen, was ich hier zeigen werde.  Es tut mir leid, wenn Sie hierher gekommen sind, um ein ernstes Gespr√§ch zu suchen. <br><br>  Auf der Folie sehen Sie eine wissenschaftliche Analyse meines letzten Berichts, in der der Anteil eines streng wissenschaftlichen Ansatzes und der Anteil eines ‚ÄûArzneimittels‚Äú, das Computersicherheit bietet, verglichen werden. <br><br><img src="https://habrastorage.org/webt/sg/dy/ef/sgdyefwk3c8k5olv7tjymmpd77a.jpeg"><br><br>  Sie sehen, dass es viel mehr ‚ÄûDrogen‚Äú gibt, aber Sie m√ºssen sich keine Sorgen machen, jetzt hat der Anteil der Wissenschaft leicht zugenommen. <br><br><img src="https://habrastorage.org/webt/t8/8e/u6/t88eu666sy0qrgwbk8qxydshdfe.jpeg"><br><br>  Vor einiger Zeit schrieb mein Freund Merlin, der hier an vorderster Front sa√ü, einen erstaunlichen Bot, der auf dem IRC-Python-Skript basiert und nur eine Zeile belegt. <br><br>  Dies ist eine wirklich gro√üartige √úbung zum Erlernen der funktionalen Programmierung, mit der es wirklich Spa√ü macht, sich zu besch√§ftigen.  Sie k√∂nnen einfach eine Funktion nach der anderen hinzuf√ºgen und Kombinationen aller m√∂glichen Funktionen erhalten. All dies wird als Regenbogenwelle auf dem Bildschirm angezeigt. Im Allgemeinen ist dies eines der d√ºmmsten Dinge, die Sie tun k√∂nnen. <br><br><img src="https://habrastorage.org/webt/hc/bk/oe/hcbkoelnorhbl1idrue1ishlk7c.jpeg"><br><br>  Ich dachte, wenn Sie dieses Prinzip auf Bin√§rdateien anwenden?  Ich wei√ü nicht, woher diese Idee kam, aber sie hat sich als gro√üartig herausgestellt!  Ich m√∂chte jedoch einige grundlegende Konzepte klarstellen. <br><br>  M√∂glicherweise hat Ihr Mathematiklehrer diese Funktionen viel komplizierter dargestellt als sie wirklich sind. <br><br><img src="https://habrastorage.org/webt/fj/-q/rp/fj-qrpljhzhe4dadrmw-wpxqdyk.jpeg"><br><br>  Die Formel f (x) hat also eine sehr einfache Bedeutung und funktioniert wie gew√∂hnliche Funktionen.  Sie haben X, Sie haben Eingaben und dann erhalten Sie X 7-mal, und das entspricht Ihrem Wert.  In Python k√∂nnen Sie eine Funktion erstellen (Lambda x: x * 7).  Wenn Sie mit Java arbeiten m√∂chten - es tut mir leid, ich hoffe, Sie m√∂chten dies nie tun -, k√∂nnen Sie Folgendes tun: <br><br><pre><code class="plaintext hljs">public static int multiplyBySevenAndReturn(Integer x) { return x * 7; }</code> </pre> <br>  Sie wissen, mathematische Funktionen k√∂nnen sogar viel komplizierter sein, aber das ist alles, was wir im Moment √ºber sie wissen m√ºssen. <br><br>  Wenn Sie sich die Code-Assembly ansehen, werden Sie feststellen, dass die Anweisungen JMP und CALL nicht an bestimmte Werte gebunden sind, sondern mit einem Offset arbeiten.  Wenn Sie einen Debugger verwenden, sehen Sie, dass der JMP00401000 eher einem Befehl zum Weiterleiten von Bytes als einem bestimmten Befehl zum Springen zu 5 oder 10 Bytes √§hnelt.  Gleiches gilt f√ºr die CALL-Funktion, mit der Ausnahme, dass eine ganze Reihe von Dingen auf Ihren Stapel geschoben werden.  Die Ausnahme ist der Fall, wenn Sie die Adresse an das Register ‚Äûkleben‚Äú, dh auf eine bestimmte Adresse zugreifen.  Hier passiert alles ganz anders.  Nachdem Sie die Adresse in das Register eingebunden und so etwas wie CALL EAX ausgef√ºhrt haben, greift die Funktion auf den spezifischen Wert in EAX zu.  Das gleiche gilt f√ºr CALL [EAX] oder JMP [EAX] - es dereferenziert nur EAX und geht zu dieser Adresse.  Wenn Sie einen Debugger verwenden, k√∂nnen Sie m√∂glicherweise nicht feststellen, auf welche bestimmte Adresse CALL zugreift.  Dies kann ein Problem sein, daher sollten Sie sich dessen bewusst sein. <br>  Schauen wir uns die JMP SHORT-Kurzsprungfunktion an.  Dies ist eine spezielle Anweisung in der x86-Architektur, mit der Sie einen Offset von 1 Byte anstelle eines Offsets von 4 Byte verwenden k√∂nnen, wodurch der verwendete Speicherplatz reduziert wird.  Dies ist sp√§ter f√ºr alle Manipulationen von Bedeutung, die mit einzelnen Anweisungen durchgef√ºhrt werden.  Es ist wichtig zu beachten, dass JMP SHORT einen Bereich von 256 Bytes hat.  Es gibt jedoch keinen CALL SHORT. <br><br><img src="https://habrastorage.org/webt/qr/0o/fg/qr0ofgmfo8ypyexaxbhe-bmlcpo.jpeg"><br><br>  Betrachten wir nun die Hexerei der Informatik.  W√§hrend der Erstellung dieser Folien wurde mir klar, dass Sie eine Baugruppe tats√§chlich als Nullraum definieren k√∂nnen, dh technisch gesehen gibt es zwischen den einzelnen Anweisungen keinen Raum.  Wenn Sie sich einzelne Anweisungen ansehen, werden Sie feststellen, dass jede Anweisung nacheinander ausgef√ºhrt wird.  Technisch kann dies als bedingungsloser Sprung zum n√§chsten Befehl interpretiert werden.  Dies gibt uns einen Abstand zwischen jeder Assemblierungsanweisung, w√§hrend jede Anweisung entsprechend einem bedingungslosen Sprung zugeordnet ist. <br><br>  Wenn Sie sich dieses Assembly-Beispiel ansehen, sind dies √ºbrigens sehr einfache Dinge, die ich zum Dekodieren mit ASCII empfehle. Dies ist also nur ein Satz regul√§rer Anweisungen. <br><br><img src="https://habrastorage.org/webt/ud/ld/7n/udld7n6wwfcvyuvxr6jdd28b1by.jpeg"><br><br>  Die JMP-Nullen zwischen den einzelnen Befehlen sind bedingungslose Spr√ºnge, die Sie normalerweise nicht sehen.  Sie folgen einander nach jeder Anweisung.  Daher ist es m√∂glich, jeden einzelnen Baugruppenbefehl genau dann an einem beliebigen Speicherplatz zu platzieren, wenn jeder Einheitsbefehl von einem bedingungslosen Sprung zum n√§chsten Befehl begleitet wird.  Denn wenn Sie die Assembly √ºbertragen und denselben Code wie zuvor verwenden m√ºssen, m√ºssen Sie jeder Anweisung einen bedingungslosen Sprung hinzuf√ºgen. <br>  Schauen wir weiter.  Ein eindimensionales Array kann technisch als zweidimensionales Array interpretiert werden. Es erfordert nur ein bisschen Mathematik, Zeilen oder √§hnliches, ich werde nicht sicher sagen, aber es ist nicht allzu schwierig.  Dies gibt uns die M√∂glichkeit, den Ort im Ged√§chtnis in Form eines Gitters (x, y) zu interpretieren.  In Kombination mit der Interpretation des leeren Raums zwischen Anweisungen als bedingungslose Spr√ºnge, die miteinander in Beziehung gesetzt werden k√∂nnen, k√∂nnen wir Anweisungen buchst√§blich zeichnen.  Das ist gro√üartig! <br><br>  Um dies in die Praxis umzusetzen, m√ºssen Sie folgende Schritte ausf√ºhren: <br><br><ul><li>  Zerlegen Sie jede Anweisung, um herauszufinden, was der Code ist. </li><li>  Weisen Sie einen Speicherplatz zu, der viel gr√∂√üer als der Befehlssatz ist.  Normalerweise reserviere ich 10 Mal mehr Speicher als die Codegr√∂√üe. </li><li>  Bestimmen Sie f√ºr jede Anweisung f (x); </li><li>  Setzen Sie jeden Befehl auf die entsprechende (x, y) Stelle im Speicher. </li><li>  F√ºgen Sie der Anweisung einen bedingungslosen Sprung hinzu. </li><li>  Markieren Sie den Speicher als ausf√ºhrbar und f√ºhren Sie den Code aus. </li></ul><br>  Leider stellen sich hier viele Fragen.  Es ist wie mit der Schwerkraft, die nur in der Theorie funktioniert, aber in der Praxis sehen wir etwas ganz anderes.  Weil in Wirklichkeit x86 Ihre JMP-Anweisungen, CALL-Anweisungen, zur H√∂lle sendet, verzerrt es Ihren selbstreferenziellen Code, selbstmodifizierenden Code, der Iteration verwendet. <br><br><img src="https://habrastorage.org/webt/wi/8c/cq/wi8ccqnv606718u6worjzx7bnok.jpeg"><br><br>  Beginnen wir mit den JMP-Anweisungen.  Da JMP-Anweisungen an einer beliebigen Stelle voreingenommen sind, zeigen sie nicht mehr auf die Stelle, an die sie Ihrer Meinung nach zeigen sollten.  SHORT JMP befinden sich in einer √§hnlichen Position.  Durch Ihre Funktion (x, y) versehentlich platziert, zeigen sie nicht an, worauf Sie z√§hlen.  Im Gegensatz zu langen JMPs lassen sich kurze JMPs jedoch leichter reparieren, insbesondere wenn Sie mit einem eindimensionalen Array arbeiten.  SHORT JMP l√§sst sich leicht in regul√§res JMP konvertieren, aber dann m√ºssen Sie herausfinden, wie der neue Offset geworden ist. <br><br>  Die Arbeit mit registergest√ºtzten JMPs bereitet immer noch Kopfschmerzen. Da sie enge Offsets erfordern und zur Laufzeit berechnet werden k√∂nnen, gibt es keine einfache M√∂glichkeit, herauszufinden, wohin sie f√ºhren.  Um jedes Register automatisch zu erkennen, m√ºssen Sie eine Reihe von Kenntnissen aus der Kompilierungstheorie verwenden.  Zur Laufzeit k√∂nnen Funktionszeiger, Klassenzeiger und dergleichen vorhanden sein.  Richtig, wenn Sie keine zus√§tzliche Arbeit leisten m√∂chten, um all dies zu tun, k√∂nnen Sie dies nicht tun.  Die f (x) -Funktionen arbeiten in echtem Code nicht so elegant wie auf Papier.  Wenn Sie es richtig machen wollen, m√ºssen Sie viel arbeiten. <br><br>  Um Klassenzeiger und √§hnliches zu definieren, m√ºssen Sie mit C und C ++ zaubern.  Konvertieren Sie vor dem Speichern und w√§hrend der Demontage Ihr KURZES JMP in normales JMP, da Sie sich mit Voreingenommenheit auseinandersetzen m√ºssen. Dies ist ganz einfach. <br><br>  Der Versuch, die tats√§chlichen Verschiebungen zu berechnen, bereitet gro√üe Kopfschmerzen.  Alle Anweisungen, die Sie finden, haben Offsets, die sich verschieben, wenn sich der Code bewegt, und sollten neu berechnet werden.  Dies bedeutet, dass Sie den Anweisungen folgen m√ºssen und wissen m√ºssen, wohin sie sich als Ziele bewegen.  Es f√§llt mir schwer, es Ihnen auf den Folien zu erkl√§ren, aber ein Beispiel daf√ºr, wie dies erreicht werden kann, finden Sie auf der CD mit den Materialien dieser Konferenz. <br><br>  Nachdem Sie alle Anweisungen platziert haben, ersetzen Sie die alten Offsets durch die neuen Offsets.  Wenn Sie die Verschiebung nicht besch√§digt haben, funktioniert alles.  Nachdem Sie sich vorbereitet haben, gibt es eine echte Gelegenheit, die Idee auf h√∂chstem Niveau umzusetzen.  Dazu ben√∂tigen Sie: <br><br><ul><li>  Anweisungen zerlegen; </li><li>  einen Speicherpuffer vorbereiten; </li><li>  initialisiere die verf√ºgbaren Konstanten f (x); </li><li>  iteriere √ºber f (x) und bestimmte Datenzeiger, nach denen dein Code geschrieben wird, w√§hrend du verdammte Anweisungen verfolgst; </li><li>  Weisen Sie den entsprechenden erstellten Indizes Anweisungen zu. </li><li>  Beheben Sie alle bedingten Spr√ºnge. </li><li>  Markieren Sie die neue Speicherpartition als ausf√ºhrbar. </li><li>  Code ausf√ºhren. </li></ul><br>  Wenn Sie die Dinge an ihren Platz bringen, bekommen wir seltsame Dinge - alles wird durcheinander gebracht, Anweisungen springen in dunkle Orte der Erinnerung und all dies sieht einfach bezaubernd aus. <br><br><img src="https://habrastorage.org/webt/kv/pi/wf/kvpiwfksxaglubnkdlasc2gwcda.jpeg"><br><br>  Hat das alles eine praktische Bedeutung oder ist es nur eine Zirkusvorstellung?  Der angewendete Wert solcher Transformationen ist wie folgt.  Durch Isolieren der Montageanweisungen und einiger Schritte zur Berechnung von f (x) k√∂nnen wir diese Montageanweisungen ohne Benutzerinteraktion an einer beliebigen Stelle im Puffer platzieren.  Um die Codeausf√ºhrungspfade zu verwirren, m√ºssen Sie lediglich die Funktion und die Zeiger in einem Assembler mathematisch schreiben und sie zuf√§llig ausw√§hlen. <br><br>  Dies vereinfacht polymorphe Codierungstechniken erheblich.  Anstatt jedes Mal Code zu schreiben, der Ihren Code auf eine bestimmte Weise manipuliert, k√∂nnen Sie eine Reihe von Funktionen schreiben, die die Position Ihres Codes zuf√§llig bestimmen, und diese Funktionen dann als zuf√§llig ausw√§hlen usw. <br><br>  Anti-Reverse ist nicht so cool und frisch wie die Anti-Debugging-Technik. <br><br>  Bei Anti-Version geht es nicht darum, wie viel Spa√ü es macht, die Verwendung des IDA unm√∂glich zu machen, und nicht darum, wie viel Sie den Computer Ihres Revers mit GNAA Last Measure-Bildern zerrei√üen, obwohl es verdammt viel Spa√ü macht.  Anti-Reversal bedeutet einfach, ein Arschloch zu sein, denn wenn Sie wie das letzte Arschloch einen Reverser bekommen, einen Typen, der den Schutz verschiedener Systeme verletzt, wird er nur w√ºtend, schickt dieses b√∂sartige Programm in die H√∂lle und geht. <br><br>  In der Zwischenzeit k√∂nnen Sie alle Ihre Bots an russische Unternehmensnetzwerke verkaufen, da Sie mit Ihrer Software alle am Reverse Engineering Beteiligten ‚Äûsenken‚Äú.  Jeder wei√ü, wie man bei Google Anti-Debugging-Techniken findet, findet dort jedoch keine L√∂sung f√ºr Probleme, die sich aus kreativen Dingen ergeben.  Die kreativsten Anti-Revolver lassen Reverter ihre Finger von der Tastatur brechen und faustgro√üe L√∂cher in den W√§nden hinterlassen.  Umkehrer werden vor Wut kochen, sie werden nicht verstehen, was zum Teufel Sie getan haben, weil Ihr Code alles durcheinander gebracht hat. <br><br>  Dies ist eine Art Nervenspiel, eine psychologische Sache. Wenn Sie in dieser Angelegenheit kreativ sind und ein wirklich atemberaubendes Anti-Reverse erstellen, k√∂nnen Sie stolz darauf sein.  Aber Sie wissen, dass Sie tats√§chlich nur versuchen, sie von Ihrem Code wegzuschieben. <br><br>  Also, was soll ich tun?  Ich werde die Verschleierungsfunktionen √ºbernehmen und sie verwirren.  Dann werde ich die zweite Version der Verschleierung verschr√§nkter Funktionen verwenden und die Verschleierung erneut anwenden.  Ziehen wir also den Code.  Dies ist ein Beispiel f√ºr mathematisches Trolling, das ich als Beispiel genommen habe. <br><br><img src="https://habrastorage.org/webt/qt/rn/sx/qtrnsxmxi2hcqfrtyilcqrtxaem.jpeg"><br><br>  Also gebe ich den Befehl "Durch Formel verwirren" in das sich √∂ffnende Fenster ein. <br><br><img src="https://habrastorage.org/webt/_8/mi/gg/_8miggm7ypffnzh5pxg9wqp_mls.jpeg"><br><br>  Als n√§chstes sehen Sie Montageanleitungen, die ihre Arbeit erledigen.  Beachten Sie, dass ich hier C ++ verwende, obwohl ich bei der geringsten Gelegenheit versuche, dies zu vermeiden. <br><br><img src="https://habrastorage.org/webt/vo/rs/0n/vors0n4cbvak6erlntuxupbibyw.jpeg"><br><br>  Hier wird die aktive Funktion CALL EAX hervorgehoben, dann folgt die anzuwendende Sprunganweisung, Sie sehen eine Reihe verschiedener Dinge im Puffer, und all dies wird mit jeder einzelnen Anweisung durchgef√ºhrt. <br><br><img src="https://habrastorage.org/webt/ei/eg/ls/eiegls4lpaq-5ktwrcmvxfm7xhg.jpeg"><br><br><img src="https://habrastorage.org/webt/bb/vl/rp/bbvlrpccrihcbvjxklexk-hee7a.jpeg"><br><br>  Jetzt spule ich das Programm bis zum Ende zur√ºck und Sie werden das Ergebnis sehen.  Der Code sieht also immer noch gut aus, eine Reihe von JMP-Anweisungen werden hier kompiliert, er sieht verwirrend aus und ist tats√§chlich verwirrend. <br><br><img src="https://habrastorage.org/webt/fe/n4/-f/fen4-ff9er24oisuviqc2gpc_rg.jpeg"><br><br>  Die n√§chste Folie zeigt eine grafische Darstellung des Stapels. <br><br><img src="https://habrastorage.org/webt/zi/d9/sa/zid9sadg9n0azq5oeesabhfq2wm.jpeg"><br><br>  Jedes Mal, wenn dies passiert, generiere ich eine zuf√§llige Sinuswellenformel, die eine beliebige Form hat. Sie sehen hier eine Reihe verschiedener Formen, und das ist cool.  Ich denke, der Code beginnt irgendwo oben links, aber ich erinnere mich nicht genau.  Also dreht er alles, man kann nicht nur Sinuskurven machen, sondern auch die Spiralen drehen. <br><br><img src="https://habrastorage.org/webt/tk/hq/iq/tkhqiqo6k4yxin-xboy7wqepcic.jpeg"><br><br>  Hier funktionieren nur zwei Formeln, die ich in den Quellcode aufgenommen habe.  Auf dieser Grundlage k√∂nnen Sie so viele kreative Dinge tun, wie Sie m√∂chten. Im Wesentlichen ist es nur DIFF vom Startpuffer zum Endpuffer. <br><br>  Das Problem ist, dass dieses Codebeispiel bedingungslose Spr√ºnge verwendet, was eigentlich schlecht ist, da der Code genau derselbe sein sollte wie zuvor, dh bedingungslose Spr√ºnge folgen nur einer Richtung.  Daher m√ºssen Sie auf die gleiche Weise vom Einstiegspunkt zum Ende gehen, die Sprunganweisungen entfernen und fertig - Sie haben Ihren Code!  Was tun?  Es ist notwendig, bedingungslose Spr√ºnge in bedingte zu verwandeln.  Bedingte Spr√ºnge werden in zwei Richtungen gemacht, es ist viel besser, wir k√∂nnen sagen, dass es 50% besser ist. <br><br>  Hier haben wir ein interessantes Dilemma: Wenn wir bedingte Spr√ºnge brauchen, m√ºssen wir immer noch bedingungslose Spr√ºnge verwenden ... was zur H√∂lle?  Was machen wir also?  Undurchsichtige Pr√§dikate werden uns retten!  F√ºr diejenigen, die es nicht wissen, ist ein undurchsichtiges Pr√§dikat im Wesentlichen eine boolesche Anweisung, die unabh√§ngig von irgendetwas immer f√ºr eine bestimmte Version ausgef√ºhrt wird. <br>  Schauen wir uns also die Erweiterung des Nullraums an, die ich zuvor erw√§hnt habe.  Wenn Sie √ºber eine Reihe von Anweisungen verf√ºgen und diese bedingungslose Spr√ºnge und √úberg√§nge zwischen den einzelnen Anweisungen aufweisen, kann eine Reihe von Montageanweisungen, die sich nicht direkt auf die von uns ben√∂tigten Anweisungen auswirken, einer einzelnen Anweisung vorangehen oder folgen. <br>  Wenn Sie beispielsweise sehr spezifische Anweisungen geschrieben haben, die die Hauptbaugruppe dessen, was Sie verwirren m√∂chten, nicht √§ndern, versuchen Sie, sich nicht auf die Register einzulassen, solange Sie den Status jeder Baugruppenanweisung beibehalten.  Und das ist noch erstaunlicher. <br>  Sie k√∂nnen jede Assembly-Anweisung ber√ºcksichtigen, die wie die Pr√§ambel, die Assembly-Daten und das Postscript verwechselt werden kann.  Die Pr√§ambel ist diejenige, die der Montageanweisung vorausgeht, und das Nachskript ist diejenige, die darauf folgt.  Die Pr√§ambel wird normalerweise verwendet oder kann f√ºr zwei Dinge verwendet werden: <br><br><ul><li>  Korrektur der Folgen des undurchsichtigen Pr√§dikats der vorherigen Pr√§ambel; </li><li>  Anti-Debugging von Codefragmenten. </li></ul><br>  Die Pr√§ambel ist jedoch im Wesentlichen begrenzt, da Sie nicht zu viel tun k√∂nnen. <br>  Postscript ist eine lustigere Sache.  Es kann verwendet werden f√ºr: <br><br><ul><li>  undurchsichtige Pr√§dikate und komplizierte Spr√ºnge zu den folgenden Codeabschnitten; </li><li>  Anti-Debugging und Verschleierung der gesamten Codeausf√ºhrung; </li><li>  Ver- und Entschl√ºsselung verschiedener Codefragmente im Programm selbst. </li></ul><br>  Im Moment arbeite ich an der M√∂glichkeit, jeden einzelnen Befehl so zu verschl√ºsseln und zu entschl√ºsseln, dass er bei Ausf√ºhrung jedes Befehls den n√§chsten Abschnitt, den n√§chsten Abschnitt, den n√§chsten usw. entschl√ºsselt.  Die folgende Folie zeigt ein Beispiel daf√ºr. <br><br><img src="https://habrastorage.org/webt/co/is/tj/coistjw3lgdiwggoqth_c9hnq2y.jpeg"><br><br>  Die Pr√§ambelzeilen und der Debugger-Aufruf sind gr√ºn hervorgehoben.  Alles, was dieser Aufruf macht, ist zu √ºberpr√ºfen, ob wir einen Debugger haben, wonach wir zu einem beliebigen Abschnitt des Codes gehen. <br><br>  Unten haben wir ein sehr einfaches undurchsichtiges Pr√§dikat.  Wenn Sie den Eax-Wert im Postskriptum der oberen Anweisung beibehalten, folgen Sie dem XOR-Operator, sodass Ihre JZ denkt: ‚ÄûOK, ich kann nat√ºrlich nach links oder rechts gehen, ich denke, es ist besser, ich gehe nach rechts, weil es 0 gibt.‚Äú  Dann wird POP EAX ausgef√ºhrt, Ihr EAX geht zur√ºck, woraufhin der n√§chste Befehl verarbeitet wird und so weiter. <br><br>  Dies f√ºhrt offensichtlich zu viel gr√∂√üeren Problemen als unsere Grundstrategie, wie z. B. Resteffekte und die Komplikation der Generierung verschiedener Befehlss√§tze.  Daher ist es sehr schwierig zu bestimmen, wie sich eine Anweisung auf eine andere Anweisung auswirkt.  Sie k√∂nnen Hausschuhe auf mich werfen, weil ich dieses erstaunliche Programm noch nicht beendet habe, aber Sie k√∂nnen den Entwicklungsfortschritt in meinem Blog verfolgen. <br><br><img src="https://habrastorage.org/webt/c9/ce/el/c9ceelekpf6j1kv8f9x-qooiug8.jpeg"><br><br>  Ich stelle fest, dass unsere Formeln f (x) nicht iterativ berechnet werden m√ºssen, zum Beispiel f (1), f (2), ... f (n).  Nichts hindert sie daran, zuf√§llig berechnet zu werden.  Wenn Sie klug sind, k√∂nnen Sie bestimmen, wie viele Anweisungen Sie ben√∂tigen, und dann beispielsweise f (27), f (54), f (9) zuweisen. Dies ist der Ort, an dem Ihre Anweisung zuf√§llig platziert wird.  Wenn Sie dies tun, k√∂nnen Sie den Code abh√§ngig davon, wie Sie ihn geschrieben haben, im Voraus stoppen, und der Code bindet Ihre Anweisungen weiterhin nach dem Zufallsprinzip. <br><br>  Wenn Ihr Code auf der Grundlage einer vorhersehbaren Formel generiert wird, ist der Einstiegspunkt auch vorhersehbar. Sie k√∂nnen also eine Ebene weiter gehen, bevor Sie den Code erhalten, und den Einstiegspunkt auf die eine oder andere Weise erheblich verwirren.  Nehmen Sie zum Beispiel 300 Montageanweisungen von einem einzelnen Einstiegspunkt. <br><br>  Lassen Sie uns nun √ºber die M√§ngel sprechen. <br><br><img src="https://habrastorage.org/webt/2l/wp/7i/2lwp7iffr7n-s_mn-tdcztkkay8.jpeg"><br><br>  Diese Methode erfordert eine sorgf√§ltige Kompilierung des Codes, haupts√§chlich mit GCC oder, Gott bewahre, mit C ++.  C ++ ist aus mehreren Gr√ºnden eine ziemlich coole Sprache, aber Sie wissen, dass alle Compiler schei√üe sind.  Die Hauptsache in dieser Angelegenheit ist also eine kompetente handgemachte Zusammenstellung, denn wenn Ihr Versuch, Ihre eigene Versammlung zu verwirren, die Zustimmung der Bande hervorruft, die den Conficker-Wurm erfunden hat, haben Sie es vermasselt. <br><br>  Sie ben√∂tigen viel Speicher.  Denken Sie an das Bild mit Sinuswellen.  Rot ist der Code und Blau ist der Speicher, der erforderlich ist, damit er funktioniert, und es sollte ausreichen, damit alles so funktioniert, wie es sollte. <br><br>  Sie werden wahrscheinlich mit einem riesigen Datensatz zu tun haben, nachdem Sie den Code vervollst√§ndigt haben.  Und es wird erheblich zunehmen, wenn Sie mehr als eine Funktion verwechseln m√∂chten. <br><br>  Funktionszeiger verhalten sich unvorhersehbar - manchmal richtig, manchmal nicht.  Dies h√§ngt davon ab, was Sie tun, und es wird definitiv ein Problem geben, da Sie nicht vorhersagen k√∂nnen, wo und wann der Funktionszeiger in Ihrer Assembly ausgel√∂st wird. <br><br>  Je schwieriger Sie eine Verschleierung erzeugen und die Assembly in der Pr√§ambel und im Postscript bearbeiten, desto schwieriger ist es, sie zu reparieren und zu debuggen.  Das Schreiben eines solchen Codes ist also wie ein Gleichgewicht zwischen "Okay, ich f√ºge hier sorgf√§ltig ein oder zwei JMPs ein" und "Wie zum Teufel kann ich das alles in kurzer Zeit herausfinden"?  Sie m√ºssen also nur Anweisungen einf√ºgen und dann einige Monate lang herausfinden, was Sie getan haben. <br><br>  Ich hoffe, Sie haben heute etwas N√ºtzliches gelernt.  Meiner Meinung nach habe ich mich wirklich betrunken und verstehe daher nicht wirklich, was jetzt passiert ist.  Die n√§chste Folie zeigt meine Twitter-Kontakte, meinen Blog und meine Website. Besuchen Sie mich oder schreiben Sie. <br><br><img src="https://habrastorage.org/webt/l3/0j/ps/l30jpsxkmmgtsez-k-pxvr9vg70.jpeg"><br><br>  Das ist alles, danke f√ºrs Kommen! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/y124L75ZKAc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Vielen Dank f√ºr Ihren Aufenthalt bei uns.  Gef√§llt dir unser Artikel?  M√∂chten Sie weitere interessante Materialien sehen?  Unterst√ºtzen Sie uns, indem Sie eine Bestellung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aufgeben</a> oder Ihren Freunden empfehlen, einen <b>Rabatt von 30% f√ºr Habr-Benutzer auf ein einzigartiges Analogon von Einstiegsservern, das wir f√ºr Sie erfunden haben:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die ganze Wahrheit √ºber VPS (KVM) E5-2650 v4 (6 Kerne) 10 GB DDR4 240 GB SSD 1 Gbit / s von $ 20 oder wie teilt man den Server?</a>  (Optionen sind mit RAID1 und RAID10, bis zu 24 Kernen und bis zu 40 GB DDR4 verf√ºgbar). <br><br>  <b>VPS (KVM) E5-2650 v4 (6 Kerne) 10 GB DDR4 240 GB SSD 1 Gbit / s bis Januar kostenlos,</b> wenn Sie f√ºr einen Zeitraum von sechs Monaten bezahlen, k√∂nnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> bestellen. <br><br>  <b>Dell R730xd 2 mal g√ºnstiger?</b>  Nur wir haben <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 GB DDR4 6 x 480 GB SSD 1 Gbit / s 100 TV von 249 US-Dollar</a> in den Niederlanden und den USA!</b>  Lesen Sie mehr √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Aufbau eines Infrastrukturgeb√§udes.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Klasse mit Dell R730xd E5-2650 v4 Servern f√ºr 9.000 Euro f√ºr einen Cent?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de433280/">https://habr.com/ru/post/de433280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de433270/index.html">MapStruct-Probleml√∂sung mit ManyToMany</a></li>
<li><a href="../de433272/index.html">Interview mit David Gobel</a></li>
<li><a href="../de433274/index.html">Oleg Dokuka √ºber die reaktive Entwicklung auf jug.msk.ru</a></li>
<li><a href="../de433276/index.html">Informationen zu den Vorteilen der Einbettung von CSS in JS</a></li>
<li><a href="../de433278/index.html">WebGL-Wind- und GPU-Programmierung. Vortrag bei FrontTalks 2018</a></li>
<li><a href="../de433282/index.html">Gateways f√ºr industrielle Austauschprotokolle unter Linux. Bauen Sie sich zusammen</a></li>
<li><a href="../de433286/index.html">10 n√§chstgelegene IT-Meetings und Hackathons in Moskau</a></li>
<li><a href="../de433288/index.html">Web Security: Einf√ºhrung in HTTP</a></li>
<li><a href="../de433292/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 279 (vom 10. bis 16. Dezember)</a></li>
<li><a href="../de433294/index.html">Ein paar einfache Empfehlungen f√ºr die Teamarbeit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>