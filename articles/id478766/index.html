<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ∏Ô∏è ‚úçüèø üçã Kustomisasi pemetaan pengendali Spring MVC üöπ ü•ú üë≤üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pendahuluan 


 Baru-baru ini saya dihadapkan dengan tugas mengimplementasikan controller yang menangani situasi dengan berbagai cara di mana ada para...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kustomisasi pemetaan pengendali Spring MVC</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478766/"><h2 id="vvedenie">  Pendahuluan </h2><br><p>  Baru-baru ini saya dihadapkan dengan tugas mengimplementasikan controller yang menangani situasi dengan berbagai cara di mana ada parameter permintaan dan di mana tidak ada.  Masalahnya diperparah oleh fakta bahwa tepat dua metode yang berbeda diperlukan dalam pengontrol.  Fitur standar Spring MVC tidak memungkinkan ini.  Saya harus menggali lebih dalam.  Siapa yang peduli - selamat datang di kucing. </p><a name="habracut"></a><br><h2 id="chto-my-hotim">  Apa yang kita inginkan </h2><br><p>  Berikut ini adalah tes singkat yang menggambarkan esensi dari tugas tersebut. </p><br><div class="spoiler">  <b class="spoiler_title">TestControllerTest.java</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringJUnitWebConfig</span></span>(WebConfig.class) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestControllerTest</span></span></span><span class="hljs-class"> </span></span>{     <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span>     WebApplicationContext webApplicationContext;     <span class="hljs-meta"><span class="hljs-meta">@Test</span></span>     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHandleRequestWithoutParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{         MockMvc mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).build();         mockMvc.perform(MockMvcRequestBuilders.get(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>))                 .andExpect(status().isOk())                 .andExpect(result -&gt;                         assertEquals(TestController.HANDLE_REQUEST_WITHOUT_PARAMS, result.getResponse().getContentAsString()));     }     <span class="hljs-meta"><span class="hljs-meta">@Test</span></span>     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHandleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{         MockMvc mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).build();         mockMvc.perform(MockMvcRequestBuilders                 .get(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>)                 .param(<span class="hljs-string"><span class="hljs-string">"someparam"</span></span>, <span class="hljs-string"><span class="hljs-string">"somevalue"</span></span>))                 .andExpect(status().isOk())                 .andExpect(result -&gt;                         assertEquals(TestController.HANDLE_REQUEST_WITH_PARAMS, result.getResponse().getContentAsString()));     } }</code> </pre> </div></div><br><h2 id="nadeemsya-chto-vse-razreshitsya-samo-soboy">  Kami berharap semuanya akan diselesaikan dengan sendirinya </h2><br><div class="spoiler">  <b class="spoiler_title">TestController.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestController</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITH_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithParams"</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITHOUT_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithoutParams"</span></span>;    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SearchQuery query)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITH_PARAMS;    }    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithoutParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITHOUT_PARAMS;    } }</code> </pre> </div></div><br><p>  Namun, Spring tidak ramah seperti yang diharapkan, dan hasilnya adalah: </p><br><pre> <code class="plaintext hljs">java.lang.IllegalStateException: Ambiguous mapping. Cannot map 'getTestController' method public java.lang.String ru.pchurzin.spring.customannotations.TestController.handleRequestWithoutParams() to {GET /test}: There is already 'getTestController' bean method public java.lang.String ru.pchurzin.spring.customannotations.TestController.handleRequestWithParams(ru.pchurzin.spring.customannotations.SearchQuery) mapped.`</code> </pre> <br><h2 id="ne-sdaemsya">  Jangan menyerah </h2><br><p>  Upaya telah dilakukan untuk memisahkan pemetaan metode-metode ini melalui <code>@RequestMapping(params = "some condition")</code> , tetapi sayangnya dalam versi Spring 5.1.8 yang digunakan tidak ada cara untuk mengatur kondisi permintaan untuk berisi parameter <strong>apa pun</strong> .  Anda dapat menentukan keberadaan parameter dengan nama tertentu atau tidak adanya parameter dengan nama tertentu.  Tidak ada yang cocok, karena  parameter bisa berbeda di setiap permintaan.  Saya ingin menulis sesuatu <code>@RequestMapping(params = "*")</code> untuk menunjukkan bahwa permintaan harus berisi beberapa parameter atau @RequestMapping (params = "! *") `Untuk menunjukkan apa yang tidak boleh ada dalam permintaan tidak ada parameter. </p><br><h2 id="a-chto-v-dokumentacii">  Dan apa yang ada di dokumentasi? </h2><br><p>  Setelah merokok dokumentasi, bagian <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">CustomAnnotations</a> ditemukan, di mana kita melihat: </p><br><pre> <code class="plaintext hljs">Spring MVC also supports custom request-mapping attributes with custom request-matching logic.</code> </pre> <br><p>  Diputuskan untuk membuat anotasi, yang memungkinkan saya menentukan kondisi yang saya perlukan untuk ketersediaan parameter kueri. <br></p><br><h2 id="cel">  Tujuan </h2><br><p>  Saya ingin menambahkan penjelasan <code>@NoRequestParams</code> ke metode, yang menunjukkan bahwa metode ini memproses permintaan tanpa parameter. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.METHOD) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> NoRequestParams { }</code> </pre> <br><p>  Pengontrol dengan anotasi kami: </p><br><div class="spoiler">  <b class="spoiler_title">Testcontoller.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestController</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITH_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithParams"</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITHOUT_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithoutParams"</span></span>;    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SearchQuery query)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITH_PARAMS;    }    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoRequestParams</span></span> <span class="hljs-comment"><span class="hljs-comment">//     public String handleRequestWithoutParams() {        return HANDLE_REQUEST_WITHOUT_PARAMS;    } }</span></span></code> </pre> </div></div><br><h2 id="pristupim">  Mari kita mulai </h2><br><p>  Konfigurasi Spring-MVC standar, diaktifkan oleh anotasi <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/EnableWebMvc.html">@EnableWebMvc</a> , dijelaskan dalam kelas <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurationSupport.html">WebMvcConfigurationSupport</a> .  Itu instantiates kacang dari kelas <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/RequestMappingHandlerMapping.html">RequestMappingHandlerMapping</a> , yang mengimplementasikan pemetaan menggunakan objek dari kelas <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/method/RequestMappingInfo.html">RequestMappingInfo</a> , yang pada gilirannya merangkum informasi tentang pemetaan permintaan metode.  Informasi ini disajikan dalam bentuk kondisi - objek kelas yang mengimplementasikan antarmuka <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">RequestCondition.</a>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">Spring memiliki 6 implementasi siap pakai:</a> <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html"><br><br></a> <br></p><ul><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/PatternsRequestCondition.html">PatternsRequestCondition</a> </li><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestMethodsRequestCondition.html">RequestMethodsRequestCondition</a> </li><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/ParamsRequestCondition.html">ParamsRequestCondition</a> </li><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/HeadersRequestCondition.html">HeadersRequestCondition</a> </li><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/ConsumesRequestCondition.html">MembutuhkanKondisi Pertanyaan</a> </li><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/ProducesRequestCondition.html">MenghasilkanRequestCondition</a> </li></ul><br><p>  Selain implementasi ini, kita dapat mendefinisikan kita sendiri.  Untuk melakukan ini, kita perlu mengimplementasikan antarmuka <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">RequestCondition</a> , dan menggunakan implementasi ini untuk kebutuhan kita.  Anda dapat mengimplementasikan antarmuka secara langsung atau menggunakan kelas abstrak <br>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/AbstractRequestCondition.html">AbstractRequestCondition</a> . </p><br><div class="spoiler">  <b class="spoiler_title">NoRequestParamsCondition.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoRequestParamsCondition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractRequestCondition</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoRequestParamsCondition</span></span></span><span class="hljs-class">&gt; </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> NoRequestParamsCondition NO_PARAMS_CONDITION = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoRequestParamsCondition();    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Collection&lt;?&gt; getContent() {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Collections.singleton(<span class="hljs-string"><span class="hljs-string">"no params"</span></span>);    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getToStringInfix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>;    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> NoRequestParamsCondition </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">combine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NoRequestParamsCondition other)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> NoRequestParamsCondition </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMatchingCondition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletRequest request)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (request.getParameterMap().isEmpty()) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;        }        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>;    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compareTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NoRequestParamsCondition other, HttpServletRequest request)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;    } }</code> </pre> </div></div><br><p>  Dua metode pertama digunakan untuk merepresentasikan kondisi kita. </p><br><p>  Metode <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">T menggabungkan (T lain)</a> diperlukan untuk menggabungkan kondisi, misalnya, jika ada penjelasan tentang metode dan kelas.  Dalam hal ini, metode gabungan digunakan untuk menggabungkan.  Anotasi kami tidak menyiratkan kombinasi - oleh karena itu, kami hanya mengembalikan contoh kondisi kami saat ini. </p><br><p>  Metode <a href="&amp;xid=17259,15700023,15700043,15700186,15700190,15700259,15700271&amp;usg=ALkJrhh136Y-yI2fhttYIaesgDW8y6G8Aw#compareTo-T-javax.servlet.">int compareTo (T lainnya, permintaan HttpServletRequest)</a> digunakan untuk membandingkan kondisi dalam konteks permintaan tertentu.  Yaitu  jika ada beberapa kondisi dengan tipe yang sama untuk permintaan, itu akan mencari tahu mana yang paling spesifik.  Tetapi sekali lagi, kondisi kami adalah satu-satunya yang mungkin, oleh karena itu kami hanya mengembalikan 0, yaitu  Semua kondisi kami sama. </p><br><p>  Logika dasar pekerjaan terkandung dalam metode <a href="&amp;xid=17259,15700023,15700043,15700186,15700190,15700259,15700271&amp;usg=ALkJrhh136Y-yI2fhttYIaesgDW8y6G8Aw#getMatchingCondition-javax.servlet.">T getMatchingCondition (permintaan HttpServletRequest)</a> .  Dalam metode ini, kita harus memutuskan untuk menanyakan apakah kondisi kita berlaku atau tidak.  Jika demikian, maka kembalikan objek kondisi.  Jika tidak, kembalikan <code>null</code> .  Dalam kasus kami, kami mengembalikan objek kondisi jika permintaan tidak mengandung parameter apa pun. </p><br><p>  Sekarang kita perlu memasukkan kondisi kita dalam proses pemetaan.  Untuk melakukan ini, kami akan mewarisi dari penerapan standar <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/method/RequestMappingInfoHandlerMapping.html">RequestMappingHandlerMapping</a> <br>  dan mendefinisikan kembali metode <code>getCustomMethodCondition(Method method)</code> , yang baru saja dibuat untuk menambahkan kondisi kustom Anda sendiri.  Selain itu, metode ini digunakan untuk menentukan kondisi untuk <strong>metode</strong> pengontrol.  Ada juga metode <code>getCustomTypeCondition(Class&lt;?&gt; handlerType)</code> , yang dapat digunakan untuk menentukan kondisi berdasarkan informasi tentang kelas controller.  Dalam kasus kami, kami tidak membutuhkannya. </p><br><p>  Akibatnya, kami memiliki implementasi berikut: </p><br><div class="spoiler">  <b class="spoiler_title">CustomRequestMappingHandlerMapping.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomRequestMappingHandlerMapping</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequestMappingHandlerMapping</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> RequestCondition&lt;?&gt; getCustomMethodCondition(Method method) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method.isAnnotationPresent(NoRequestParams.class) ? NO_PARAMS_CONDITION : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>;    } }</code> </pre> </div></div><br><p>  Logikanya tidak rumit - kami memeriksa keberadaan anotasi kami dan, jika ada, kami mengembalikan objek kondisi kami. </p><br><p>  Untuk mengaktifkan implementasi pemetaan kami, kami akan memperluas konfigurasi Spring MVC standar: </p><br><div class="spoiler">  <b class="spoiler_title">Webconfig.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebMvcConfigurationSupport</span></span></span><span class="hljs-class"> </span></span>{       <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> RequestMappingHandlerMapping </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRequestMappingHandlerMapping</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomRequestMappingHandlerMapping();    }    <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TestController </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTestController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestController();    } }</code> </pre> </div></div><br><p>  Tambahkan anotasi kami ke controller: </p><br><div class="spoiler">  <b class="spoiler_title">TestController.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestController</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITH_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithParams"</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITHOUT_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithoutParams"</span></span>;    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SearchQuery query)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITH_PARAMS;    }    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-meta"><span class="hljs-meta">@NoRequestParams</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithoutParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITHOUT_PARAMS;    } }</code> </pre> </div></div><br><p>  dan periksa hasilnya: </p><br><pre> <code class="plaintext hljs">Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.851 s - in ru.pchurzin.spring.customannotations.TestControllerTest Results: Tests run: 2, Failures: 0, Errors: 0, Skipped: 0</code> </pre> <br><p>  Dengan demikian, kita dapat mengubah logika pemetaan sesuai dengan kebutuhan kita dan muncul dengan kondisi kita sendiri.  Misalnya, kondisi pada alamat IP atau agen-Pengguna yang digunakan.  Mungkin ada solusi yang lebih sederhana, tetapi dalam hal apa pun, merakit sepeda Anda terkadang juga bermanfaat. </p><br><p>  Terima kasih atas perhatian anda </p><br><p>  <a href="https://github.com/pchurzin/spring-mvc-custom-annotatations">Kode contoh Github</a> </p><p></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id478766/">https://habr.com/ru/post/id478766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id478750/index.html">Pustaka visualisasi data aktual untuk pengembang yang bereaksi</a></li>
<li><a href="../id478752/index.html">Sejarah Sistem Kontrol Versi</a></li>
<li><a href="../id478758/index.html">Panduan tag UTM yang luar biasa: cara mencari tahu dari mana pengguna berasal</a></li>
<li><a href="../id478760/index.html">"Nol" neraka dan bagaimana keluar dari situ</a></li>
<li><a href="../id478764/index.html">Kesalahan JavaScript: memperbaiki, memproses, memperbaiki</a></li>
<li><a href="../id478772/index.html">Tekstur konvolusional</a></li>
<li><a href="../id478774/index.html">Suasana Tahun Baru dari Arduino dan tongkat</a></li>
<li><a href="../id478788/index.html">Di kerajaan tertentu, tidak dalam kondisi "melonjak". Laporan Yandex</a></li>
<li><a href="../id478790/index.html">Julia dan semantik distribusi</a></li>
<li><a href="../id478796/index.html">Sarjana di AS: Cara Tidak Konvensional ke Sekolah Menengah Atas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>