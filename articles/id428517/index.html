<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßîüèΩ üìØ üçÆ GraphQL - API dengan cara baru ‚òùüèΩ üè® üêß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apa bahasa query GraphQL? Apa keuntungan yang diberikan teknologi ini dan masalah apa yang akan dihadapi pengembang saat menggunakannya? Bagaimana car...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GraphQL - API dengan cara baru</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/428517/">  Apa bahasa query GraphQL?  Apa keuntungan yang diberikan teknologi ini dan masalah apa yang akan dihadapi pengembang saat menggunakannya?  Bagaimana cara menggunakan GraphQL secara efektif?  Tentang semua ini di bawah potongan. <br><br><img src="https://habrastorage.org/webt/d4/w4/cg/d4w4cgweq81ewi6vo51e1kbw9tu.jpeg"><br><br>  Artikel ini didasarkan pada laporan tingkat pengantar oleh <b>Vladimir Tsukur</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">volodymyrtsukur</a> ) dari konferensi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Joker 2017</a> . <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/YgRmgHPTXr4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Nama saya Vladimir, saya memimpin pengembangan salah satu departemen di WIX.  Lebih dari seratus juta pengguna WIX membuat situs web dari berbagai arah - dari situs kartu nama dan toko ke aplikasi web yang kompleks di mana Anda dapat menulis kode dan logika sewenang-wenang.  Sebagai contoh nyata dari sebuah proyek di WIX, saya ingin menunjukkan kepada Anda toko situs yang sukses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">unicornadoptions.com</a> , yang menawarkan kesempatan untuk membeli kit untuk menjinakkan unicorn - hadiah yang bagus untuk seorang anak. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a9/7ec/db8/2a97ecdb8542ecb4aff1213a5b8690b9.jpg"><br><br>  Pengunjung ke situs ini dapat memilih kit yang mereka sukai untuk menjinakkan unicorn, katakan pink, lalu lihat apa sebenarnya yang ada dalam kit ini: mainan, sertifikat, lencana.  Selanjutnya, pembeli memiliki kesempatan untuk menambahkan barang ke keranjang, melihat isinya dan memesan.  Ini adalah contoh sederhana dari situs toko, dan kami memiliki banyak, ratusan ribu situs semacam itu.  Semuanya dibangun pada platform yang sama, dengan satu backend, dengan satu set klien yang kami dukung menggunakan API untuk ini.  Ini tentang API yang akan dibahas lebih lanjut. <br><br><h2>  API sederhana dan masalahnya </h2><br>  Mari kita bayangkan API tujuan umum (yaitu, satu API untuk semua toko di atas platform) yang dapat kita buat untuk menyediakan fungsionalitas toko.  Mari kita berkonsentrasi hanya pada memperoleh data. <br><br>  Untuk halaman produk di situs tersebut, nama produk, harga, gambar, deskripsi, informasi tambahan dan banyak lagi harus dikembalikan.  Dalam solusi lengkap untuk toko di WIX, ada lebih dari dua lusin bidang data tersebut.  Solusi standar untuk tugas semacam itu di atas API HTTP adalah untuk menggambarkan sumber daya <code>/products/:id</code> , yang mengembalikan data produk berdasarkan permintaan <code>GET</code> .  Berikut ini adalah contoh data respons: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"59eb83c0040fa80b29938e3f"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Combo Pack with Dreamy Eyes 12\" (Pink) Soft Toy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Spread Unicorn love amongst your friends and family by purchasing a Unicorn adoption combo pack today. You'll receive your very own fabulous adoption pack and a 12\" Dreamy Eyes (Pink) cuddly toy. It makes the perfect gift for loved ones. Go on, you know you want to, adopt today!"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sku"</span></span>:<span class="hljs-string"><span class="hljs-string">"010"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"images"</span></span>: [   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/918d8d4cc83d4e5f8680ca4edfd5b6b2.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/f343889c0bb94965845e65d3f39f8798.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/dd55129473e04f489806db0dc6468dd9.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/64eba4524a1f4d5d9f1687a815795643.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/5727549e9131440dbb3cd707dce45d0f.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/28ae9369ec3c442dbfe6901434ad15af.jpg"</span></span> ] }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/ecf/5d6/4ac/ecf5d64acd1da66df56b6aa49f5eb6be.jpg"><br><br>  Mari kita lihat halaman katalog produk sekarang.  Untuk halaman ini, Anda memerlukan koleksi sumber daya <i>/ produk</i> .  Tetapi hanya dalam menampilkan koleksi produk pada halaman katalog, tidak semua data produk diperlukan, tetapi hanya harga, nama dan gambar utama.  Misalnya, deskripsi, informasi tambahan, gambar latar belakang, dll. Tidak menarik bagi kami. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa4/82b/0ed/aa482b0edf598fcc605eee75216e963b.png"><br><br>  Misalkan, untuk kesederhanaan, kami memutuskan untuk menggunakan model data produk yang sama untuk sumber daya <code>/products</code> dan <code>/products/:id</code> .  Dalam hal kumpulan produk-produk semacam itu, kemungkinan akan ada beberapa.  Skema respons dapat direpresentasikan sebagai berikut: <br><br><pre> <code class="javascript hljs">GET /products [ {   title   price   images   description   info   ... } ]</code> </pre><br>  Sekarang mari kita lihat "muatan" dari respons dari server untuk pengumpulan produk.  Inilah yang sebenarnya digunakan oleh klien di antara lebih dari dua lusin bidang: <br><br> <code>{ <br> <s>"id": "59eb83c0040fa80b29938e3f",</s> <br> "title": "Combo Pack with Dreamy Eyes 12\" (Pink) Soft Toy", <br> "price": 26.99, <br> <s>"info": "Spread Unicorn love amongst your friends and family by purchasing a Unicorn adoption combo pack today. You'll receive your very own fabulous adoption pack and a 12\" Dreamy Eyes (Pink) cuddly toy. It makes the perfect gift for loved ones. Go on, you know you want to, adopt todayl",</s> <br> " <s>description": "Your fabulous Unicorn adoption combo pack contains:\nA 12\" Dreamy Eyes (Pink) Unicorn Soft Toy\nA blank Unicorn adoption certificate ‚Äî name your Unicorn!\nA confirmation letter\nA Unicorn badge\nA Unicorn key ring\nA Unicorn face mask (self assembly)\nA Unicorn bookmark\nA Unicorn colouring in sheet\nA A4 Unicorn posters\n2 x Unicorn postcards\n3 x Unicorn stickers",</s> <br> "images": [ <br> "http://localhost:8080/img/918d8d4cc83d4e5f8680ca4edfd5b6b2.jpg", <br> <s>"http://localhost:8080/img/f343889c0bb94965845e65d3f39f8798.jpg",</s> <br> <s>"http://localhost:8080/img/dd55129473604f489806db0dC6468dd9.jpg",</s> <br> <s>"http://localhost:8080/img/64eba4524a1f4d5d9f1687a815795643.jpg",</s> <br> <s>"http://localhost:8080/img/5727549e9l3l440dbb3cd707dce45d0f.jpg",</s> <br> <s>"http://localhost:8080/img/28ae9369ec3c442dbfe6901434ad15af.jpg"</s> <br> ], <br> <s>...</s> <br> }</code> <br> <br>  Jelas, jika saya ingin menjaga model produk tetap sederhana dengan mengembalikan data yang sama, maka saya berakhir dengan masalah pengambilan berlebihan, dalam beberapa kasus mendapatkan lebih banyak data daripada yang saya butuhkan.  Dalam hal ini, ini muncul di halaman katalog produk, tetapi secara umum, layar UI apa pun yang terhubung dengan produk akan memerlukan dari itu berpotensi hanya sebagian (dan tidak semua) data. <br><br>  Mari kita lihat halaman keranjang sekarang.  Dalam keranjang, selain produk itu sendiri, ada juga kuantitasnya (dalam keranjang ini), harga, serta total biaya seluruh pesanan: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/653/da1/ad3/653da1ad36872dff8cda2d13b28b5f45.png"><br><br>  Jika kami melanjutkan pendekatan pemodelan sederhana dari HTTP API, maka keranjang dapat diwakili melalui sumber daya <i>/ gerobak /: id</i> , presentasi yang mengacu pada sumber daya produk yang ditambahkan ke keranjang ini: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb83c0040fa80b29938e3f"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>   },   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb83c0040fa80b29938e40"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">25.98</span></span>   },   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb88bd040fa8125aa9c400"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>   } ], <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: <span class="hljs-number"><span class="hljs-number">79.96</span></span> }</code> </pre><br>  Sekarang, misalnya, untuk menggambar keranjang dengan tiga produk di ujung depan, Anda perlu membuat empat permintaan: satu untuk memuat keranjang itu sendiri, dan tiga permintaan untuk memuat data produk (nama, harga dan nomor SKU). <br><br>  Masalah kedua yang kami miliki adalah kurang mengambil.  Perbedaan tanggung jawab antara keranjang dan sumber daya produk telah menyebabkan kebutuhan untuk membuat permintaan tambahan.  Jelas ada sejumlah kelemahan di sini: karena jumlah permintaan yang lebih besar, kami mendaratkan baterai ponsel lebih cepat dan mendapatkan jawaban lengkap lebih lambat.  Dan skalabilitas solusi kami juga menimbulkan pertanyaan. <br><br>  Tentu saja, solusi ini tidak cocok untuk produksi.  Salah satu cara untuk menghilangkan masalah adalah dengan menambahkan dukungan proyeksi untuk keranjang.  Salah satu proyeksi seperti itu, selain data keranjang itu sendiri, dapat mengembalikan data produk.  Selain itu, proyeksi ini akan sangat spesifik, karena pada halaman keranjang Anda memerlukan nomor inventaris (SKU) produk.  Tidak ada tempat lain yang diperlukan SKU di tempat lain. <br><br><pre> <code class="plaintext hljs">GET /carts/1?projection=with-products</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/a5f/3d7/901/a5f3d7901a3d60622575ae1fdf6787d1.png"><br><br>  "Kesesuaian" sumber daya untuk UI tertentu biasanya tidak berakhir, dan kami mulai menghasilkan proyeksi lain: informasi singkat tentang keranjang, proyeksi keranjang untuk web seluler, dan setelah itu proyeksi untuk unicorn. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ff/6b5/dad/9ff6b5dad7ee3ec4e7d95790dcd2eb05.png"><br><br>  (Secara umum, di WIX Designer, Anda sebagai pengguna dapat mengkonfigurasi data produk mana yang ingin Anda tampilkan pada halaman produk dan data mana yang ditampilkan di keranjang) <br><br>  Dan di sini kesulitan menunggu kita: kita membingkai taman dan mencari solusi kompleks.  Ada beberapa solusi standar dari sudut pandang API untuk tugas seperti itu, dan mereka biasanya sangat bergantung pada kerangka kerja atau pustaka deskripsi sumber daya HTTP. <br><br>  Apa yang lebih penting, sekarang semakin sulit untuk bekerja, karena ketika persyaratan di sisi klien berubah, backend harus terus-menerus "mengejar" dan memuaskan mereka. <br><br>  Sebagai "cherry on the cake," mari kita lihat masalah penting lainnya.  Dalam kasus HTTP API sederhana, pengembang server tidak tahu jenis data apa yang digunakan klien.  Apakah harga digunakan?  Deskripsi?  Satu atau semua gambar? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f1/943/2d4/1f19432d49f8577cc70197bdb74a7987.png"><br><br>  Dengan demikian, beberapa pertanyaan muncul.  Bagaimana cara bekerja dengan data yang sudah usang / usang?  Bagaimana saya tahu data mana yang tidak lagi digunakan?  Bagaimana relatif aman untuk menghapus data dari respons tanpa merusak sebagian besar klien?  Tidak ada jawaban untuk pertanyaan ini dengan HTTP API biasa.  Terlepas dari kenyataan bahwa kami optimis dan API tampaknya sederhana, situasinya tidak terlihat begitu panas.  Rentang masalah API ini tidak unik untuk WIX.  Sejumlah besar perusahaan harus berurusan dengan mereka.  Sekarang menarik untuk melihat solusi potensial. <br><br><h2>  GraphQL.  Mulai </h2><br>  Pada 2012, dalam proses mengembangkan aplikasi seluler, Facebook menghadapi masalah serupa.  Insinyur ingin mencapai jumlah minimum panggilan aplikasi seluler ke server, sementara pada setiap langkah mereka hanya menerima data yang diperlukan dan tidak ada yang lain selain mereka.  Hasil dari upaya mereka adalah GraphQL, dipresentasikan pada konferensi React Conf 2015.  GraphQL adalah bahasa deskripsi kueri, serta lingkungan runtime untuk kueri ini. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/052/9fc/00c/0529fc00c59b43faf40c8cbd4064d1ac.png"><br><br>  Pertimbangkan pendekatan khas untuk bekerja dengan server GraphQL. <br><br><h3>  Kami menggambarkan skema </h3><br>  Skema data dalam GraphQL mendefinisikan jenis dan hubungan di antara mereka dan melakukannya dengan cara yang sangat diketik.  Misalnya, bayangkan model sederhana jejaring sosial.  <code>User</code> tahu tentang teman <code>friends</code> .  Pengguna tinggal di City, dan kota tahu tentang penghuninya melalui bidang <code>citizens</code> .  Berikut adalah grafik dari model seperti itu di GraphQL: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae4/5e8/2e9/ae45e82e9610ff7abb7291fbe4671062.png"><br><br>  Tentu saja, agar grafik bermanfaat, yang disebut "titik masuk" juga diperlukan.  Misalnya, titik masuk seperti itu bisa mendapatkan pengguna dengan nama. <br><br><h3>  Meminta data </h3><br>  Mari kita lihat apa inti dari bahasa query GraphQL.  Mari terjemahkan pertanyaan ini ke dalam bahasa ini: <i>"Untuk pengguna bernama Vanya Unicorn, saya ingin tahu nama teman-temannya, serta nama dan populasi kota tempat Vanya tinggal"</i> : <br><br><pre> <code class="javascript hljs">{ user(name: <span class="hljs-string"><span class="hljs-string">"Vanya Unicorn"</span></span>) {   friends {     name   }   city {     name     population   } } }</code> </pre> <br>  Dan inilah jawabannya dari server GraphQL: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"friends"</span></span>: [       { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Lena"</span></span> },       { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Stas"</span></span> }     ]     <span class="hljs-string"><span class="hljs-string">"city"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Kyiv"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"population"</span></span>: <span class="hljs-number"><span class="hljs-number">2928087</span></span>     }   } } }</code> </pre><br>  Perhatikan bagaimana formulir permintaan "konsonan" dengan formulir respons.  Ada perasaan bahwa bahasa permintaan ini dibuat untuk JSON.  Dengan ketikan yang kuat.  Dan semua ini dilakukan dalam satu permintaan HTTP POST - tidak perlu melakukan beberapa panggilan ke server. <br><br>  Mari kita lihat tampilannya dalam praktik.  Mari kita buka konsol standar untuk server GraphQL, yang disebut Graph <i>i</i> QL ("graph").  Untuk meminta keranjang, saya akan memenuhi permintaan berikut: <i>"Saya ingin mendapatkan keranjang dengan pengidentifikasi 1, saya tertarik dengan semua posisi keranjang ini dan informasi produk.</i>  <i>Dari informasi, nama, harga, nomor inventaris, dan gambar adalah penting (dan hanya yang pertama).</i>  <i>Saya juga tertarik dengan jumlah produk ini, berapa harganya dan total biaya dalam keranjang</i> . <i>"</i> <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)     }     quantity     total   }   subTotal } }</code> </pre> <br>  Setelah berhasil menyelesaikan permintaan, kami mendapatkan apa yang diminta: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf7/c04/a8e/cf7c04a8ef9d309387a6bcc935d40d10.png"><br><br><h2>  Manfaat Utama </h2><br><ul><li>  <b>Pengambilan sampel yang fleksibel.</b>  Klien dapat mengajukan permintaan sesuai dengan persyaratan spesifiknya. <br></li><li>  <b>Pengambilan sampel yang efektif.</b>  Respons hanya mengembalikan data yang diminta. <br></li><li>  <b>Pengembangan lebih cepat.</b>  Banyak perubahan pada klien dapat terjadi tanpa perlu mengubah apa pun di sisi server.  Misalnya, berdasarkan contoh kami, Anda dapat dengan mudah menampilkan tampilan keranjang yang berbeda untuk web seluler. <br></li><li>  <b>Analitik yang berguna.</b>  Karena klien harus menunjukkan bidang secara eksplisit dalam permintaan, server tahu persis bidang mana yang benar-benar diperlukan.  Dan ini adalah informasi penting untuk kebijakan depresiasi. <br></li><li>  <b>Bekerja di atas semua sumber data dan transportasi.</b>  Adalah penting bahwa GraphQL memungkinkan Anda untuk bekerja di atas semua sumber data dan transportasi apa pun.  Dalam hal ini, HTTP bukan obat mujarab, GraphQL juga dapat bekerja melalui WebSocket, dan kami akan menyentuh pada titik ini sedikit kemudian. <br></li></ul><br>  Saat ini, server GraphQL dapat dibuat dalam hampir semua bahasa.  Versi paling lengkap dari server <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GraphQL</a> adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GraphQL.js</a> untuk platform Node.  Di komunitas Java, implementasi referensi adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GraphQL Java</a> . <br><br><h2>  Buat API GraphQL </h2><br>  Mari kita lihat cara membuat server GraphQL pada contoh kehidupan nyata. <br><br>  Pertimbangkan versi sederhana dari toko online yang didasarkan pada arsitektur layanan-mikro dengan dua komponen: <br><br><ul><li>  Layanan kereta menyediakan pekerjaan dengan keranjang khusus.  Menyimpan data dalam database relasional dan menggunakan SQL untuk mengakses data.  Layanan sangat sederhana, tanpa terlalu banyak sihir :) <br></li><li>  Layanan-produk menyediakan akses ke katalog produk, yang darinya, keranjang diisi.  Menyediakan API HTTP untuk mengakses data produk. <br></li></ul><br>  Kedua layanan diimplementasikan di atas Spring Boot klasik dan sudah mengandung semua logika dasar. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5f0/1e9/560/5f01e95602be2c3d88178f1327f791c6.png"><br><br>  Kami bermaksud membuat GraphQL API di atas layanan Cart.  API ini dirancang untuk memberikan akses ke data keranjang dan produk yang ditambahkan padanya. <br><br><h3>  Versi pertama </h3><br>  Implementasi referensi GraphQL untuk ekosistem Java, yang kami sebutkan sebelumnya - GraphQL Java, akan membantu kami. <br><br>  Tambahkan beberapa dependensi ke <code>pom.xml:</code> <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>9.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-java-tools<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.2.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-spring-boot-starter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.0.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphiql-spring-boot-starter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.0.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Selain <code>graphql-java</code> disebutkan sebelumnya <code>graphql-java</code> kita akan membutuhkan <code>graphql-java-tools,</code> alat <code>graphql-java-tools,</code> serta "permulaan" Boot Spring untuk GraphQL, yang akan sangat menyederhanakan langkah-langkah pertama untuk membuat server GraphQL: <br><br><ul><li>  <i>graphql-spring-boot-starter</i> menyediakan mekanisme untuk menghubungkan GraphQL Java dengan cepat ke Spring Boot; <br></li><li>  <i>graphiql-spring-boot-starter</i> menambahkan konsol web Graph <i>i</i> QL interaktif untuk menjalankan permintaan GraphQL. <br></li></ul><br>  Langkah penting berikutnya adalah menentukan skema layanan graphQL, grafik kami.  Node dari grafik ini dijelaskan menggunakan <i>tipe</i> , dan ujungnya menggunakan <i>bidang</i> .  Definisi grafik kosong terlihat seperti ini: <br><br><pre> <code class="javascript hljs">schema { }</code> </pre> <br>  Dalam skema ini, seperti yang Anda ingat, ada "titik masuk" atau kueri tingkat atas.  Mereka didefinisikan melalui bidang <i>permintaan</i> dalam skema.  Panggil jenis kami untuk <i>titik</i> masuk <i>EntryPoints</i> : <br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: EntryPoints }</code> </pre><br>  Kami mendefinisikan di dalamnya pencarian keranjang dengan pengidentifikasi sebagai titik masuk pertama: <br><br><pre> <code class="javascript hljs">type EntryPoints { cart(id: Long!): Cart }</code> </pre><br>  <code>Cart</code> tidak lebih dari <i>bidang</i> dalam istilah GraphQL.  <code>id</code> adalah parameter bidang ini dengan tipe skalar <code>Long</code> .  Tanda seru <code>!</code>  setelah menentukan jenisnya berarti parameter tersebut diperlukan. <br><br>  Saatnya mengidentifikasi dan mengetik <code>Cart</code> : <br><br><pre> <code class="javascript hljs">type Cart { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: Long! items: [CartItem!]! subTotal: BigDecimal! }</code> </pre><br>  Selain <code>id</code> standar, keranjang mencakup elemen item dan jumlah untuk semua produk <code>subTotal</code> .  Perhatikan bahwa <i>item</i> didefinisikan sebagai daftar, seperti yang ditunjukkan oleh tanda kurung siku <code>[]</code> .  Elemen daftar ini adalah tipe <code>CartItem</code> .  Kehadiran tanda seru setelah nama tipe bidang <code>!</code>  menunjukkan bahwa bidang tersebut wajib diisi.  Ini berarti bahwa server setuju untuk mengembalikan nilai yang tidak kosong untuk bidang ini, jika diminta. <br><br>  Tetap melihat definisi tipe <code>CartItem</code> , yang mencakup tautan ke produk ( <i>productId</i> ), berapa kali ditambahkan ke keranjang ( <code>quantity</code> ) dan jumlah produk, dihitung pada jumlah ( <code>total</code> ): <br><br><pre> <code class="javascript hljs">type CartItem { <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! quantity: Int! total: BigDecimal! }</code> </pre><br>  Semuanya sederhana di sini - semua bidang jenis skalar adalah wajib. <br><br>  Skema ini tidak dipilih secara kebetulan.  Layanan Cart telah mendefinisikan keranjang Cart dan elemen <code>CartItem</code> dengan nama dan tipe bidang yang persis sama seperti dalam skema GraphQL.  Model kereta menggunakan perpustakaan Lombok untuk mendapatkan getter / setter, konstruktor, dan metode lainnya.  JPA digunakan untuk ketekunan dalam database. <br><br>  Kelas <code>Cart</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.Data; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.math.BigDecimal; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cart</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Id</span></span>   <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id;   <span class="hljs-meta"><span class="hljs-meta">@ElementCollection</span></span>(fetch = FetchType.EAGER)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;CartItem&gt; items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;();   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigDecimal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSubTotal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getItems().stream()               .map(Item::getTotal)               .reduce(BigDecimal.ZERO, BigDecimal::add);   } }</code> </pre><br>  Kelas <code>CartItem</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.AllArgsConstructor; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.Data; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.Column; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.Embeddable; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.math.BigDecimal; <span class="hljs-meta"><span class="hljs-meta">@Embeddable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartItem</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String productId;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quantity;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal total; }</code> </pre><br>  Jadi, elemen keranjang ( <code>Cart</code> ) dan elemen keranjang ( <code>CartItem</code> ) dijelaskan baik dalam diagram GraphQL dan dalam kode, dan ‚Äúkompatibel‚Äù satu sama lain sesuai dengan set bidang dan jenisnya.  Tetapi ini masih belum cukup untuk layanan kami untuk bekerja. <br><br>  Kita perlu mengklarifikasi dengan tepat bagaimana titik masuk " <code>cart(id: Long!): Cart</code> " akan berfungsi.  Untuk melakukan ini, buat konfigurasi Java yang sangat sederhana untuk Spring dengan kacang tipe GraphQLQueryResolver.  GraphQLQueryResolver hanya menjelaskan "titik masuk" dalam skema.  Kami mendefinisikan metode dengan nama yang identik dengan bidang di titik entri ( <code>cart</code> ), membuatnya kompatibel dengan jenis parameter, dan menggunakan <code>cartService</code> untuk menemukan keranjang yang sama dengan pengidentifikasi: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLQueryResolver </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">queryResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLQueryResolver () {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.findCart(id);       }   } }</code> </pre><br>  Perubahan ini cukup bagi kita untuk mendapatkan aplikasi yang berfungsi.  Setelah memulai ulang layanan Cart di konsol GraphiQL, kueri berikut akan mulai dijalankan dengan sukses: <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     productId     quantity     total   }   subTotal } }</code> </pre> <br><h3>  Catatan </h3><br><ul><li>  Kami menggunakan jenis skalar <code>Long</code> dan <code>String</code> sebagai pengidentifikasi unik untuk keranjang dan produk.  GraphQL memiliki tipe khusus untuk tujuan tersebut - <code>ID</code> .  Semantik, ini adalah pilihan yang lebih baik untuk API nyata.  Nilai <code>ID</code> tipe dapat digunakan sebagai kunci untuk caching. <br></li><li>  Pada tahap ini dalam pengembangan aplikasi kami, model domain internal dan eksternal benar-benar identik.  Kita berbicara tentang kelas <code>Cart</code> dan <code>CartItem</code> dan penggunaan langsungnya dalam resolvers GraphQL.  Dalam aplikasi tempur, model ini direkomendasikan untuk dipisahkan.  Untuk resolvers GraphQL, model yang terpisah dari area subjek internal harus ada. <br></li></ul><br><h3>  Membuat API bermanfaat </h3><br>  Jadi kami mendapat hasil pertama, dan ini luar biasa.  Tapi sekarang API kami terlalu primitif.  Misalnya, sejauh ini tidak ada cara untuk meminta data yang berguna pada suatu produk, seperti nama, harga, artikel, gambar, dan sebagainya.  Sebaliknya, hanya ada <code>productId</code> .  Mari kita buat API sangat berguna dan menambahkan dukungan penuh untuk konsep produk.  Berikut ini definisi dari diagram tersebut: <br><br><pre> <code class="javascript hljs">type Product { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! title: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! price: BigDecimal! description: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> sku: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! images: [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!]! }</code> </pre><br>  Tambahkan bidang yang diperlukan ke <code>CartItem</code> , dan <code>productId</code> bidang productId sudah usang: <br><br><pre> <code class="javascript hljs">type Item { <span class="hljs-attr"><span class="hljs-attr">quantity</span></span>: Int! product: Product! productId: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! @deprecated(reason: <span class="hljs-string"><span class="hljs-string">"don't use it!"</span></span>) total: BigDecimal! }</code> </pre> <br>  Kami menemukan skema.  Dan sekarang saatnya untuk menggambarkan bagaimana pemilihan bidang <code>product</code> akan bekerja.  Kami sebelumnya mengandalkan getter di kelas <code>Cart</code> dan <code>CartItem</code> , yang memungkinkan GraphQL Java untuk secara otomatis mengikat nilai.  Tetapi di sini harus diingat bahwa hanya properti <code>product</code> di kelas <code>CartItem</code> tidak: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Embeddable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartItem</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String productId;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quantity;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal total; }</code> </pre><br>  Kami punya pilihan: <br><br><ol><li>  Tambahkan properti <i>produk</i> ke <i>CartItem</i> dan ‚Äúajarkan‚Äù bagaimana cara menerima data produk; <br></li><li>  Tentukan cara mendapatkan <i>produk</i> tanpa mengubah kelas <i>CartItem</i> . <br></li></ol><br>  Cara kedua lebih disukai, karena model deskripsi domain internal (kelas <code>CartItem</code> ) dalam kasus ini tidak akan dibahas dengan rincian implementasi API Grafik <i>i</i> QL. <br><br>  Untuk mencapai tujuan ini, antarmuka marker GraphQLResolver akan membantu.  Dengan menerapkannya, Anda bisa menentukan (atau menimpa) cara mendapatkan nilai bidang untuk tipe <code>T</code>  Ini adalah tampilan kacang yang sesuai di konfigurasi Spring: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLResolver&lt;CartItem&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cartItemResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLResolver&lt;CartItem&gt;() {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CartItem item)</span></span></span><span class="hljs-function"> </span></span>{           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(<span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,                   Product.class,                   item.getProductId());       }   }; }</code> </pre> <br>  Nama metode <code>product</code> tidak dipilih secara kebetulan.  GraphQL Java sedang mencari metode pengunduh data berdasarkan nama bidang, dan kami hanya perlu mendefinisikan loader untuk bidang <code>product</code> !  Objek bertipe <code>CartItem</code> dilewatkan sebagai parameter menentukan konteks di mana produk dipilih.  Berikutnya adalah masalah teknologi.  Menggunakan klien <code>http</code> seperti <code>RestTemplate</code> kami membuat permintaan GET ke layanan Produk dan mengonversi hasilnya menjadi <code>Product</code> , yang terlihat seperti ini: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String id;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String title;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal price;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String description;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String sku;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;String&gt; images; }</code> </pre> <br>  Perubahan ini harus cukup untuk menerapkan sampel yang lebih menarik, yang mencakup hubungan sebenarnya antara keranjang dan produk yang ditambahkan padanya. <br><br>  Setelah memulai ulang aplikasi, Anda dapat mencoba kueri baru di konsol Graph <i>i</i> QL. <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images     }     quantity     total   }   subTotal } }</code> </pre><br>  Dan inilah hasil dari eksekusi query: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c8/778/3f4/0c87783f4f843696b9900771c2b2860e.png"><br><br>  Meskipun <code>productId</code> ditandai sebagai <code>@deprecated</code> , kueri yang mengindikasikan bidang ini akan terus berfungsi.  Tetapi konsol Graph <i>i</i> QL tidak akan menawarkan pelengkapan otomatis untuk bidang tersebut dan akan menyoroti penggunaannya dengan cara khusus: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afc/96a/d45/afc96ad45f3f4372a8e86cf78b892acd.png"><br><br>  Saatnya untuk menunjukkan Document Explorer, bagian dari konsol Graph <i>i</i> QL, yang dibangun berdasarkan skema GraphQL dan menampilkan informasi pada semua jenis yang ditentukan.  Inilah yang tampak seperti Document Explorer untuk tipe <code>CartItem</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f83/c04/38b/f83c0438b2f906b34414b764182a37fc.png"><br><br>  Namun kembali ke contoh.  Untuk mencapai fungsi yang sama seperti pada demo pertama, masih belum ada batasan yang cukup untuk jumlah gambar yang dikembalikan.  Memang, untuk keranjang, misalnya, Anda hanya perlu satu gambar untuk setiap produk: <br><br><pre> <code class="javascript hljs">images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Untuk melakukan ini, ubah skema dan tambahkan parameter baru untuk bidang <i>gambar</i> ke tipe <i>Produk</i> : <br><br><pre> <code class="javascript hljs">type Product { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: ID! title: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! price: BigDecimal! description: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> sku: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! images(limit: Int = <span class="hljs-number"><span class="hljs-number">0</span></span>): [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!]! }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan dalam kode aplikasi kita akan menggunakannya lagi </font></font><code>GraphQLResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, hanya kali ini dengan mengetik </font></font><code>Product</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLResolver&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">productResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLResolver&lt;Product&gt;() {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Product product, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit)</span></span></span><span class="hljs-function"> </span></span>{           List&lt;String&gt; images = product.getImages();           <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> normalizedLimit = limit &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? limit : images.size();           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> images.subList(<span class="hljs-number"><span class="hljs-number">0</span></span>, Math.min(normalizedLimit, images.size()));       }   }; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekali lagi saya menarik perhatian Anda bahwa nama metode ini tidak disengaja: itu bertepatan dengan nama bidang </font></font><code>images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Objek konteks </font></font><code>Product</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memberikan akses ke gambar, dan </font></font><code>limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">merupakan parameter dari bidang itu sendiri. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika klien tidak menentukan apa pun sebagai nilai untuk </font></font><code>limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, maka layanan kami akan mengembalikan semua gambar produk. </font><font style="vertical-align: inherit;">Jika klien menentukan nilai tertentu, maka layanan akan mengembalikan persis sama (tetapi tidak lebih dari yang ada dalam produk). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mengkompilasi proyek dan menunggu hingga server dimulai ulang. </font><font style="vertical-align: inherit;">Mulai ulang sirkuit di konsol dan menjalankan permintaan, kami melihat bahwa permintaan lengkap benar-benar berfungsi.</font></font><br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)     }     quantity     total   }   subTotal } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setuju, semua ini sangat keren. </font><font style="vertical-align: inherit;">Dalam waktu singkat, kami tidak hanya mengetahui apa itu GraphQL, tetapi juga mentransfer sistem layanan mikro sederhana untuk mendukung API semacam itu. </font><font style="vertical-align: inherit;">Dan tidak masalah bagi kami dari mana data berasal: SQL dan HTTP API cocok di bawah satu atap.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pendekatan Code-First dan GraphQL SPQR </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda mungkin telah memperhatikan bahwa selama proses pengembangan ada beberapa ketidaknyamanan, yaitu kebutuhan untuk terus menjaga skema GraphQL dan kode dalam sinkronisasi. Jenis perubahan selalu harus dilakukan di dua tempat. Dalam banyak kasus, lebih mudah menggunakan pendekatan kode-pertama. Esensinya adalah bahwa skema untuk GraphQL secara otomatis dihasilkan dari kode. Dalam hal ini, Anda tidak perlu merawat sirkuit secara terpisah. Sekarang saya akan menunjukkan tampilannya. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hanya fitur dasar GraphQL Java yang tidak cukup bagi kami, kami juga akan membutuhkan pustaka GraphQL SPQR. Kabar baiknya adalah bahwa GraphQL SPQR adalah add-on untuk GraphQL Java, dan bukan alternatif implementasi server GraphQL di Jawa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambahkan ketergantungan yang diinginkan ke </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>io.leangen.graphql<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spqr<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.9.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Berikut adalah kode yang mengimplementasikan fungsi berbasis GraphQL SPQR yang sama untuk keranjang: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartGraph</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CartService cartService;   <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CartGraph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CartService cartService)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cartService = cartService;   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"cart"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long id) </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.findCart(id);   } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dan untuk produk: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductGraph</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RestTemplate http;   <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProductGraph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplate http)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.http = http;   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext CartItem cartItem)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(               <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,               Product.class,               cartItem.getProductId()       );   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"images"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext Product product,                              @GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"limit"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, defaultValue = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> limit) </span></span>{       List&lt;String&gt; images = product.getImages();       <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> normalizedLimit = limit &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? limit : images.size();       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> images.subList(<span class="hljs-number"><span class="hljs-number">0</span></span>, Math.min(normalizedLimit, images.size()));   } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anotasi @GraphQLQuery digunakan untuk menandai metode pemuat bidang. </font><font style="vertical-align: inherit;">Anotasi </font></font><code>@GraphQLContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menentukan jenis seleksi untuk bidang tersebut. </font><font style="vertical-align: inherit;">Dan anotasi </font></font><code>@GraphQLArgument</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan jelas menandai parameter argumen. </font><font style="vertical-align: inherit;">Semua ini adalah bagian dari satu mekanisme yang membantu GraphQL SPQR untuk menghasilkan skema secara otomatis. </font><font style="vertical-align: inherit;">Sekarang, jika Anda menghapus skema dan konfigurasi Java yang lama, restart layanan Cart menggunakan chip baru dari GraphQL SPQR, Anda dapat memastikan bahwa semuanya berfungsi secara fungsional dengan cara yang sama seperti sebelumnya.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kami memecahkan masalah N +1 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini adalah waktu untuk melihat b </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pada</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lshih rinci bagaimana pelaksanaan seluruh permintaan "di bawah tenda". Kami dengan cepat membuat GraphQL API, tetapi apakah ini bekerja secara efisien? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pertimbangkan contoh berikut: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/05c/626/303/05c62630323d9ad9eeb97999c19fcd04.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mendapatkan keranjang </font></font><code>cart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">terjadi dalam satu query SQL ke database. Data aktif </font></font><code>items</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>subtotal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dikembalikan ke sana, karena elemen keranjang dimuat dengan seluruh koleksi, berdasarkan strategi JPA yang ingin diambil:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cart</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@ElementCollection</span></span>(fetch = FetchType.EAGER)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Item&gt; items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;();   ... }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/674/0e4/863/6740e4863b4847f782f64588e52ecc36.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ketika datang untuk mengunduh data pada produk, maka permintaan untuk layanan Produk akan dieksekusi persis seperti dalam keranjang produk ini. Jika ada tiga produk berbeda dalam keranjang, maka kami akan menerima tiga permintaan ke HTTP API dari layanan produk, dan jika ada sepuluh dari mereka, maka layanan yang sama harus menjawab sepuluh permintaan tersebut. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/92c/9c0/b1a/92c9c0b1a06c15f081c0eb9dc9ce8a1f.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berikut adalah komunikasi antara layanan Cart dan layanan Produk di Charles Proxy: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c15/8df/d08/c158dfd08badf133f49499baa43c1970.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karenanya, kami kembali ke masalah klasik N +1. Persisnya mereka berusaha keras untuk melarikan diri di awal laporan. Tidak diragukan lagi, kami memiliki kemajuan, karena tepat satu permintaan dijalankan antara klien akhir dan sistem kami. Namun dalam ekosistem server, kinerja jelas perlu ditingkatkan.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya ingin menyelesaikan masalah ini dengan mendapatkan semua produk yang tepat dalam satu permintaan. </font><font style="vertical-align: inherit;">Untungnya, layanan Produk sudah mendukung fitur ini melalui parameter </font></font><code>ids</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di sumber pengumpulan:</font></font><br><br><pre> <code class="plaintext hljs">GET /products?ids=:id1,:id2,...,:idn</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita lihat bagaimana Anda dapat mengubah kode metode sampel untuk bidang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">produk</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Versi Sebelumnya:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext CartItem cartItem)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,           Product.class,           cartItem.getProductId()   ); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ganti dengan yang lebih efektif: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Batched</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext List&lt;Item&gt; items)</span></span></span><span class="hljs-function"> </span></span>{   String productIds = items.stream()           .map(Item::getProductId)           .collect(Collectors.joining(<span class="hljs-string"><span class="hljs-string">","</span></span>));   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products?ids={ids}"</span></span>,           Products.class,           productIds   ).getProducts(); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kami melakukan tiga hal: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menandai metode bootloader dengan anotasi </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Batched</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , menjelaskan kepada GraphQL SPQR bahwa pemuatan harus terjadi dengan batch;</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengubah tipe dan parameter konteks kembali ke daftar, karena bekerja dengan bets mengasumsikan bahwa beberapa objek diterima dan dikembalikan; </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengubah tubuh metode, menerapkan pemilihan semua produk yang diperlukan pada suatu waktu. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perubahan ini cukup untuk menyelesaikan masalah N + 1 kami. </font><font style="vertical-align: inherit;">Jendela aplikasi Proxy Charles sekarang menunjukkan satu permintaan ke layanan Produk, yang mengembalikan tiga produk sekaligus:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5c2/806/98d/5c280698dfbdf383cf44052f51a09ae8.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sampel Lapangan yang Efektif </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memecahkan masalah utama, tetapi Anda dapat memilih lebih cepat! </font><font style="vertical-align: inherit;">Sekarang layanan Produk mengembalikan semua data, terlepas dari apa yang dibutuhkan pelanggan akhir. </font><font style="vertical-align: inherit;">Kami dapat meningkatkan kueri dan hanya mengembalikan bidang yang diminta. </font><font style="vertical-align: inherit;">Misalnya, jika pelanggan akhir tidak meminta gambar, mengapa kita perlu mentransfernya ke layanan Keranjang? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sangat bagus bahwa API HTTP dari layanan Produk sudah mendukung fitur ini melalui parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sertakan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk sumber daya pengumpulan yang sama:</font></font><br><br><pre> <code class="plaintext hljs">GET /products?ids=...?include=:field1,:field2,...,:fieldN</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk metode bootloader, tambahkan parameter tipe Set dengan anotasi </font></font><code>@GraphQLEnvironment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">GraphQL SPQR memahami bahwa kode dalam hal ini "meminta" daftar nama bidang yang diminta untuk produk, dan secara otomatis mengisinya:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Batched</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext List&lt;Item&gt; items,                             @GraphQLEnvironment Set&lt;String&gt; fields)</span></span></span><span class="hljs-function"> </span></span>{   String productIds = items.stream()           .map(Item::getProductId)           .collect(Collectors.joining(<span class="hljs-string"><span class="hljs-string">","</span></span>));   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products?ids={ids}&amp;include={fields}"</span></span>,           Products.class,           productIds,           String.join(<span class="hljs-string"><span class="hljs-string">","</span></span>, fields)   ).getProducts(); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sekarang sampel kami benar-benar efektif, tanpa masalah N + 1 dan hanya menggunakan data yang diperlukan: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/242/592/98f/24259298fe8acb19d21e04083689d5dd.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pertanyaan "Berat" </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bayangkan bekerja dengan grafik pengguna di jejaring sosial klasik seperti Facebook. </font><font style="vertical-align: inherit;">Jika sistem seperti itu menyediakan GraphQL API, maka tidak ada yang mencegah klien mengirim permintaan dengan sifat berikut:</font></font><br><br><pre> <code class="javascript hljs">{ user(name: <span class="hljs-string"><span class="hljs-string">"Vova Unicorn"</span></span>) {   friends {     name     friends {       name       friends {         name         friends {            name            ...         }       }     }   } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pada tingkat bersarang 5-6, implementasi penuh dari permintaan semacam itu akan mengarah pada pemilihan semua pengguna di dunia. </font><font style="vertical-align: inherit;">Server tentu tidak akan mampu mengatasi tugas seperti itu dalam sekali duduk dan kemungkinan besar itu hanya "jatuh". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ada sejumlah langkah yang harus diambil untuk melindungi diri Anda dari situasi seperti itu:</font></font><br><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batasi kedalaman permintaan. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan kata lain, pelanggan seharusnya tidak diizinkan untuk meminta data penyarangan sewenang-wenang.</font></font><br></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batasi kompleksitas permintaan. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dengan menetapkan bobot untuk setiap bidang dan menghitung jumlah bobot semua bidang dalam permintaan, Anda dapat menerima atau menolak permintaan tersebut di server.</font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Misalnya, pertimbangkan permintaan berikut: </font></font><br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title     }     quantity   }   subTotal } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jelas, kedalaman permintaan seperti itu adalah 4, karena jalur terpanjang ada di dalamnya </font></font><code>cart -&gt; items -&gt; product -&gt; title</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika kita menganggap bahwa bobot masing-masing bidang adalah 1, maka dengan memperhitungkan 7 bidang dalam kueri, kompleksitasnya juga 7. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam GraphQL Java, superposisi cek dicapai dengan menunjukkan instrumentasi tambahan saat membuat objek </font></font><code>GraphQL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="java hljs">GraphQL.newGraphQL(schema)       .instrumentation(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChainedInstrumentation(Arrays.asList(               <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaxQueryComplexityInstrumentation(<span class="hljs-number"><span class="hljs-number">20</span></span>),               <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaxQueryDepthInstrumentation(<span class="hljs-number"><span class="hljs-number">3</span></span>)       )))       .build();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instrumentasi </font></font><code>MaxQueryDepthInstrumentation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memeriksa kedalaman permintaan dan tidak memungkinkan permintaan terlalu "dalam" untuk diluncurkan (dalam hal ini, dengan kedalaman lebih dari 3). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instrumentasi </font></font><code>MaxQueryComplexityInstrumentation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sebelum mengeksekusi kueri menghitung dan memeriksa kerumitannya. Jika nomor ini melebihi nilai yang ditentukan (20), maka permintaan seperti itu ditolak. Anda dapat mendefinisikan ulang bobot untuk setiap bidang, karena beberapa di antaranya jelas "lebih keras" daripada yang lain. Misalnya, bidang produk dapat diberikan kompleksitas 10 melalui anotasi yang </font></font><code>@GraphQLComplexity,</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">didukung di GraphQL SPQR:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@GraphQLComplexity</span></span>(<span class="hljs-string"><span class="hljs-string">"10"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berikut ini adalah contoh pemeriksaan kedalaman ketika jelas melebihi nilai yang ditentukan: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/54c/c39/584/54cc39584792997b198370c40e8b2431.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Omong-omong, mekanisme instrumentasi tidak terbatas pada memaksakan pembatasan. </font><font style="vertical-align: inherit;">Itu juga dapat digunakan untuk tujuan lain, seperti logging atau tracing. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami memeriksa langkah-langkah "perlindungan" khusus untuk GraphQL. </font><font style="vertical-align: inherit;">Namun, ada sejumlah trik yang perlu diperhatikan terlepas dari jenis API:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pembatasan / pembatasan tingkat - batasi jumlah permintaan per unit waktu </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> batas waktu - batas waktu untuk operasi dengan layanan lain, basis data, dll. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pagination - dukungan pagination. </font></font><br></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mutasi data </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sejauh ini, kami telah mempertimbangkan murni pengambilan sampel data. </font><font style="vertical-align: inherit;">Tapi GraphQL memungkinkan Anda untuk mengatur secara organik tidak hanya penerimaan data, tetapi juga perubahannya. </font><font style="vertical-align: inherit;">Ada mekanisme untuk ini </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dalam skema, tempat khusus disediakan untuk ini - bidang </font></font><code>mutation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: EntryPoints, <span class="hljs-attr"><span class="hljs-attr">mutation</span></span>: Mutations }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Misalnya, menambahkan produk ke keranjang dapat diatur melalui mutasi berikut: </font></font><br><br><pre> <code class="javascript hljs">type Mutations {   addProductToCart(cartId: Long!,                    <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!,                    <span class="hljs-attr"><span class="hljs-attr">count</span></span>: Int = <span class="hljs-number"><span class="hljs-number">1</span></span>): Cart }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini mirip dengan mendefinisikan bidang, karena mutasi juga memiliki parameter dan nilai balik. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementasi mutasi dalam kode server menggunakan GraphQL SPQR adalah sebagai berikut:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLMutation</span></span>(name = <span class="hljs-string"><span class="hljs-string">"addProductToCart"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addProductToCart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(       @GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"cartId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long cartId,       @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GraphQLArgument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"productId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String productId,       @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GraphQLArgument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"quantity"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, defaultValue = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"1"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> quantity) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.addProductToCart(cartId, productId, quantity); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentu saja, sebagian besar pekerjaan yang bermanfaat dilakukan secara internal </font></font><code>cartService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dan tugas lapisan metode ini adalah untuk mengasosiasikannya dengan API. Seperti dalam kasus pengambilan sampel data, berkat anotasi, </font></font><code>@GraphQL*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sangat mudah untuk memahami skema GraphQL mana yang dihasilkan dari definisi metode ini. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di konsol GraphQL, Anda sekarang dapat melakukan permintaan mutasi untuk menambahkan produk tertentu ke keranjang kami dalam jumlah 2:</font></font><br><br><pre> <code class="javascript hljs">mutation { addProductToCart(     cartId: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-string"><span class="hljs-string">"59eb83c0040fa80b29938e3f"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">quantity</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>) {   items {     product {       title     }     quantity     total   }   subTotal } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Karena mutasi memiliki nilai kembali, dimungkinkan untuk meminta bidang dari itu sesuai dengan aturan yang sama seperti yang kami lakukan untuk sampel biasa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa tim pengembangan WIX secara aktif menggunakan GraphQL dengan Scala dan perpustakaan Sangria, implementasi utama GraphQL dalam bahasa ini. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salah satu teknik berguna yang digunakan dalam WIX adalah dukungan untuk permintaan GraphQL saat merender HTML. </font><font style="vertical-align: inherit;">Kami melakukan ini untuk menghasilkan JSON langsung di kode halaman. </font><font style="vertical-align: inherit;">Berikut ini contoh mengisi templat HTML:</font></font><br><br><pre> <code class="xml hljs">// Pre-rendered <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-embedded-graphiql</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined"> {   product(productId: $productId)     title     description     price     ...   } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dan inilah hasilnya: </font></font><br><br><pre> <code class="xml hljs">// Rendered <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.DATA = {   </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">product</span></span></span><span class="javascript">: {          </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">title</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'GraphQL Sticker'</span></span></span><span class="javascript">,          </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">description</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'High quality sticker'</span></span></span><span class="javascript">,           </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">price</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'$2'</span></span></span><span class="javascript">           ... } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kombinasi renderer HTML dan server GraphQL ini memungkinkan kami untuk menggunakan kembali API secara maksimal dan tidak membuat lapisan pengontrol tambahan. </font><font style="vertical-align: inherit;">Selain itu, teknik ini sering ternyata menguntungkan dalam hal kinerja, karena setelah memuat halaman, aplikasi JavaScript tidak perlu pergi ke backend untuk data yang diperlukan pertama - itu sudah ada di halaman.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kerugian dari GraphQL </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hari ini, GraphQL menggunakan sejumlah besar perusahaan, termasuk raksasa seperti GitHub, Yelp, Facebook dan banyak lainnya. </font><font style="vertical-align: inherit;">Dan jika Anda memutuskan untuk bergabung dengan nomor mereka, Anda harus tahu tidak hanya kelebihan GraphQL, tetapi juga kelemahannya, dan ada banyak dari mereka:</font></font><br><br><ul><li> -,  GraphQL <b>     </b> .  GraphQL      ,   HTTP API.  <i>Cache-Control</i>  <i>Last-Modified</i>    HTTP      GraphQL API.         ,  proxy  gateways (Varnish, Fastly  ).   , GraphQL    ,    ,   . <br></li><li>   GraphQL ‚Äî <b>    </b> .    ,         API,    ,       . <br></li><li> <b> </b>  GraphQL       .        . <br></li><li>  <b>     </b> . GraphQL ‚Äî       .     JSON  XML, , ,          GraphQL,       . <br></li><li>  GraphQL <b>   </b> . ,       HTTP   <i>PUT</i>     <i>POST</i>  -.   ,       .    GraphQL       .        . <br></li><li> <b>   </b> . ,     -: ¬´delete¬ª  ¬´kill¬ª, ¬´annihilate¬ª  ¬´terminate¬ª,    .   GraphQL API    .   HTTP          <i>DELETE</i> . <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Joker 2016   </a>   .  GraphQL <b>      </b> .  API-   ,   ,    ,     HATEOAS,     ,   ¬´ REST¬ª. ,     ,  GraphQL     . <br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perlu juga diingat bahwa jika Anda tidak berhasil mengembangkan HTTP API dengan baik, kemungkinan besar Anda tidak akan dapat mengembangkan GraphQL API. Lagi pula, apa yang paling penting dalam pengembangan API apa pun? Pisahkan model domain internal dari model API eksternal. Buat API berdasarkan skenario penggunaan, bukan perangkat internal aplikasi. Buka hanya informasi minimum yang diperlukan, dan tidak semuanya dalam satu baris. Pilih nama yang tepat. Jelaskan grafik dengan benar. Ada grafik sumber daya di HTTP API, dan grafik bidang di GraphQL API. Dalam kedua kasus, grafik ini harus dilakukan secara kualitatif.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ada beberapa alternatif di dunia HTTP API, dan Anda tidak harus selalu menggunakan GraphQL saat Anda membutuhkan pilihan yang kompleks. </font><font style="vertical-align: inherit;">Misalnya, ada standar OData, yang mendukung pilihan parsial dan memperluas, seperti GraphQL, dan berfungsi di atas HTTP. </font><font style="vertical-align: inherit;">Ada API JSON standar yang berfungsi dengan JSON dan mendukung hypermedia dan kemampuan pengambilan yang kompleks. </font><font style="vertical-align: inherit;">Ada juga LinkRest, yang dapat Anda pelajari lebih lanjut dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://youtu.be/EsldBtrb1Qc "&gt; laporan oleh Andrus Adamchik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> di Joker 2017. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk mereka yang ingin mencoba GraphQL, saya sangat merekomendasikan membaca artikel perbandingan dari para insinyur yang sangat berpengalaman dalam REST dan GraphQL dari sudut pandang praktis dan filosofis:</font></font><br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://philsturgeon.uk/api/2017/01/24/graphql-vs-rest-overview/</font></font></a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://blog.runscope.com/posts/you-might-not-need-graphql</font></font></a> <br></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Akhirnya tentang Langganan dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tunda</font></font></a> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraphQL memiliki satu kelebihan menarik dibandingkan API standar. </font><font style="vertical-align: inherit;">Dalam GraphQL, kedua kasus penggunaan sinkron dan asinkron dapat duduk di bawah atap yang sama. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami mempertimbangkan menerima data melalui Anda </font></font><code>query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mengubah status server melalui </font></font><code>mutation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tetapi ada satu kebaikan lagi. </font><font style="vertical-align: inherit;">Misalnya, kemampuan untuk mengatur langganan </font></font><code>subscriptions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bayangkan bahwa klien ingin menerima pemberitahuan tentang menambahkan produk ke keranjang secara tidak sinkron. </font><font style="vertical-align: inherit;">Melalui GraphQL API, ini dapat dilakukan berdasarkan skema seperti itu:</font></font><br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: Queries, <span class="hljs-attr"><span class="hljs-attr">mutation</span></span>: Mutations, <span class="hljs-attr"><span class="hljs-attr">subscription</span></span>: Subscriptions } type Subscriptions { productAdded(cartId: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!): Cart }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pelanggan dapat berlangganan melalui permintaan berikut: </font></font><br><br><pre> <code class="javascript hljs">subscription { productAdded(cart: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product ...   }   subTotal } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang, setiap kali suatu produk ditambahkan ke keranjang 1, server akan mengirim setiap klien yang berlangganan pesan di WebSocket dengan data yang diminta pada keranjang. </font><font style="vertical-align: inherit;">Sekali lagi, melanjutkan kebijakan GraphQL, hanya data yang diminta klien saat berlangganan akan datang:</font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"productAdded"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: [       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ }     ],     <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: <span class="hljs-number"><span class="hljs-number">289.33</span></span>   } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klien sekarang dapat menggambar ulang keranjang, tidak harus menggambar ulang seluruh halaman. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini nyaman karena API sinkron (HTTP) dan API asinkron (WebSocket) dapat dijelaskan melalui GraphQL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contoh lain menggunakan komunikasi asinkron adalah mekanisme </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">penundaan</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Gagasan utamanya adalah bahwa klien memilih data apa yang ingin ia terima segera (secara serempak), dan yang siap ia terima nanti (secara tidak serempak). </font><font style="vertical-align: inherit;">Misalnya, untuk permintaan seperti itu:</font></font><br><br><pre> <code class="javascript hljs">query { feedStories {   author { name }   message   comments @defer {     author { name }     message   } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Server pertama akan mengembalikan penulis dan pesan untuk setiap cerita: </font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"feedStories"</span></span>: [     {       <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,       <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶     },     {       <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,       <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶     }   ] } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Setelah itu, server, setelah menerima data tentang komentar, akan mengirimkannya ke klien melalui WebSocket secara tidak serempak, yang menunjukkan di jalur yang mana riwayat riwayat sekarang siap: </font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"feedStories"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"comments"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶   } ] }</code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sumber Sampel </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode yang digunakan untuk menyiapkan laporan ini dapat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ditemukan di GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baru-baru ini, kami mengumumkan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPoint 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang akan diadakan 5-6 April 2019. </font><font style="vertical-align: inherit;">Anda dapat mempelajari lebih lanjut tentang apa yang diharapkan dari konferensi dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pusat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kami </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Hingga 1 Desember, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiket Early Bird</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> masih tersedia </font><font style="vertical-align: inherit;">dengan harga terendah.</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id428517/">https://habr.com/ru/post/id428517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id428507/index.html">Kami menulis obrolan bot untuk VKontakte di python menggunakan longpoll</a></li>
<li><a href="../id428509/index.html">Bagaimana H&M mencoba menyelamatkan diri dengan AI dan Big Data</a></li>
<li><a href="../id428511/index.html">Energi Hidrogen: Awal yang Jauh</a></li>
<li><a href="../id428513/index.html">500 laser pointer di satu tempat</a></li>
<li><a href="../id428515/index.html">Toko 3D Top: bagaimana kami berubah sepanjang tahun - hasil 2018</a></li>
<li><a href="../id428521/index.html">Kenapa tidak ada teman di GitHub. Tentang Robbie Barrath, Obvious, dan Copyright</a></li>
<li><a href="../id428523/index.html">ShadowCloud - klien cloud universal</a></li>
<li><a href="../id428525/index.html">RecyclerView dengan kecepatan maksimum: parsing libraries</a></li>
<li><a href="../id428526/index.html">Pajak Google: 180 ¬∞ berbelok</a></li>
<li><a href="../id428528/index.html">Mengapa kaum revolusioner suka makanan pedas, atau Bagaimana cabai sampai di Cina</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>