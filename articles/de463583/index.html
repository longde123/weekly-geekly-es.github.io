<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧛🏿 👂 🤰🏾 Fantastische Plugins, vol. 1. Theorie 🙆🏼 👨🏾‍💻 👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Leben mit einem Multi-Modul-Projekt ist nicht so einfach. Um die Routine zum Erstellen eines neuen Moduls zu vermeiden, haben wir unser eigenes Pl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fantastische Plugins, vol. 1. Theorie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hh/blog/463583/"><p>  Das Leben mit einem Multi-Modul-Projekt ist nicht so einfach.  Um die Routine zum Erstellen eines neuen Moduls zu vermeiden, haben wir unser eigenes Plug-In für Android Studio erstellt.  Bei der Implementierung sind wir auf einen Mangel an praktischer Dokumentation gestoßen, haben verschiedene Ansätze ausprobiert und viele Fallstricke ausgegraben.  Es stellte sich heraus, zwei Artikel: "Theorie" und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"Praxis"</a> .  Triff mich! </p><br><p><img src="https://habrastorage.org/webt/an/fg/dp/anfgdpffwxapeeei7coineoxdvk.png" alt="Bild"></p><a name="habracut"></a><br><h1 id="o-chem-budu-govorit">  Worüber werde ich sprechen? </h1><br><ul><li>  Warum ein Plugin?  Warum ein Plugin? <br><ul><li>  Checkliste erstellen </li><li>  Checkliste Automatisierungsoptionen </li></ul></li><li>  Grundlagen der Plugin-Entwicklung <br><ul><li>  Aktionen </li><li>  UI-Entwicklung in Plugins </li><li>  Schlussfolgerungen </li></ul></li><li>  IDEA-Interna: Komponenten, PSI <br><ul><li>  IDEA Interne Einheit </li><li>  PSI </li><li>  Schlussfolgerungen </li></ul></li></ul><br><h1 id="zachem-plagin-pochemu-plagin">  Warum ein Plugin?  Warum ein Plugin? </h1><br><p>  Wenn Sie ein Android-Projekt mit mehreren Modulen entwickeln, wissen Sie, welche Routine es ist, jedes Mal ein neues Modul zu erstellen.  Sie müssen ein Modul erstellen, Gradle darin konfigurieren, Abhängigkeiten hinzufügen, auf die Synchronisierung warten und nicht vergessen, etwas im Anwendungsmodul zu reparieren - alles nimmt viel Zeit in Anspruch.  Wir wollten die Routine automatisieren und haben zunächst eine Checkliste erstellt, die zeigt, was wir jedes Mal tun, wenn wir ein neues Modul erstellen. </p><br><p>  1. Zunächst erstellen wir das Modul selbst über das Menü Datei -&gt; Neu -&gt; Neues Modul -&gt; Android-Bibliothek. </p><br><p><img src="https://habrastorage.org/webt/eo/nt/tk/eonttksy33ofpojuctkl8aoghuo.png" alt="Bild"></p><br><p>  2. Wir schreiben die Pfade zum Modul in die Datei settings.gradle, da wir verschiedene Modultypen haben - Core-Module und Feature-Module, die sich in verschiedenen Ordnern befinden. </p><br><div class="spoiler">  <b class="spoiler_title">Wir schreiben Pfade zu den Modulen</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// settings.gradle include ':analytics project(':analytics').projectDir = new File(settingsDir, 'core/framework-metrics/analytics) ... include ':feature-worknear' project(':feature-worknear').projectDir = new File(settingsDir, 'feature/feature-worknear')</span></span></code> </pre> </div></div><br><p>  3. Ändern Sie die Konstanten <em>compileSdk</em> , <em>minSdk</em> , <em>targetSdk</em> im generierten <em>build.gradle</em> : Ersetzen Sie sie durch die Konstanten, die im root <em>build.gradle</em> definiert sind. </p><br><div class="spoiler">  <b class="spoiler_title">Konstanten in build.gradle des neuen Moduls ändern</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle … android { compileSdkVersion rootProject.ext.targetSdkVersion defaultConfig { minSdkVersion rootProject.ext.minSdkVersion targetSdkVersion rootProject.ext.targetSdkVersion ... } }</span></span></code> </pre> </div></div><br><p>  Hinweis: Wir haben diesen Teil unserer Arbeit kürzlich in unser Gradle-Plugin entfernt, mit dessen Hilfe alle erforderlichen Parameter der Datei <em>build.gradle</em> in mehreren Zeilen konfiguriert werden können. </p><br><p>  4. Da wir den gesamten neuen Code in Kotlin schreiben, verbinden wir standardmäßig zwei Plugins: <em>kotlin-android</em> und <em>kotlin-kapt</em> .  Wenn das Modul irgendwie mit der Benutzeroberfläche verbunden ist, verbinden wir zusätzlich das Modul <em>kotlin-android-extensions</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Verbinden Sie Kotlin-Plugins</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle apply plugin: 'com.android.library' apply plugin: 'kotlin-android' apply plugin: 'kotlin-android-extensions' apply plugin: 'kotlin-kapt'</span></span></code> </pre></div></div><br><p>  5. Wir verbinden die allgemeinen Bibliotheken und Kernmodule.  Kernmodule sind beispielsweise Logger, Analytics, einige allgemeine Dienstprogramme und Bibliotheken - RxJava, Moxy und viele andere. </p><br><div class="spoiler">  <b class="spoiler_title">Wir verbinden gemeinsam genutzte Bibliotheken und Module</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle dependencies { def libraries = rootProject.ext.deps compileOnly project(':logger') compileOnly project(':analytics') … // Kotlin compileOnly libraries.kotlin // DI compileOnly libraries.toothpick kapt libraries.toothpickCompiler }</span></span></code> </pre></div></div><br><p>  6. Richten Sie kapt für Toothpick ein.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zahnstocher</a> ist unser zentrales DI-Framework.  Höchstwahrscheinlich wissen Sie: Um die Codegenerierung anstelle der Reflektion im Release-Build zu verwenden, müssen Sie den Anmerkungsprozessor so konfigurieren, dass er versteht, woher die Fabriken für die erstellten Objekte stammen: </p><br><div class="spoiler">  <b class="spoiler_title">Konfigurieren des Anmerkungsprozessors für Toothpick</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle defaultConfig { ... javaCompileOptions { annotationProcessorOptions { arguments = [ toothpick_registry_package_name: "ru.hh.feature_worknear" ] } } ...</span></span></code> </pre> </div></div><br><p>  Hinweis: In hh.ru verwenden wir die erste Version von Toothpick, in der zweiten haben wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die Möglichkeit zur Codegenerierung entfernt</a> . </p><br><p>  7. Wir konfigurieren kapt für Moxy im erstellten Modul.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Moxy</a> ist unser Hauptframework für die Erstellung von MVP in einer Anwendung, und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie müssen es ein wenig drehen, damit</a> es in einem Projekt mit mehreren Modulen funktioniert.  Registrieren Sie insbesondere das Paket des erstellten Moduls in den kapt-Argumenten: </p><br><div class="spoiler">  <b class="spoiler_title">Kapt für Moxy konfigurieren</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle android { ... kapt { arguments { arg("moxyReflectorPackage", "ru.hh.feature_worknear") } } ...</span></span></code> </pre></div></div><br><p>  Hinweis: Wir haben bereits auf die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">neue Version von Moxy</a> umgestellt, und dieser Teil der Codegenerierung hat seine Relevanz verloren. </p><br><p>  8. Wir generieren eine Reihe neuer Dateien.  Ich meine nicht die Dateien, die automatisch erstellt werden (AndroidManifest.xml, build.gradle, .gitignore), sondern den allgemeinen Rahmen des neuen Moduls: Interaktoren, Repositorys, DI-Module, Präsentatoren, Fragmente.  Es gibt viele dieser Dateien, sie haben am Anfang die gleiche Struktur, und das Erstellen ist eine Routine. </p><br><p><img src="https://habrastorage.org/webt/j2/f5/sz/j2f5szalxm1nmgg4yj9kivxpdfs.png" alt="Bild"></p><br><p>  9. Wir verbinden unser erstelltes Modul mit dem Anwendungsmodul.  In diesem Schritt müssen Sie daran denken, Toothpick in der Datei build.gradle des Anwendungsmoduls zu konfigurieren.  Zu diesem Zweck fügen wir das Paket des erstellten Moduls dem speziellen Argumentanmerkungsprozessor hinzu - <em>dentpick_registry_children_package_names</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Zahnstocher stimmen</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// App module build.gradle defaultConfig { … javaCompileOptions { annotationProcessorOptions { arguments = [ toothpick_registry_package_name: "ru.hh.android", toothpick_registry_children_package_names: [ "ru.hh.analytics", "ru.hh.feature_worknear", ... ].join(",") ] } } …</span></span></code> </pre></div></div><br><p>  Danach konfigurieren wir Moxy im Anwendungsmodul.  Wir haben eine Klasse, die mit der Annotation <strong>@RegisterMoxyReflectorPackages</strong> gekennzeichnet ist - dort fügen wir den Paketnamen des erstellten Moduls hinzu: </p><br><div class="spoiler">  <b class="spoiler_title">Konfigurieren Sie MoxyReflectorStub</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// App module file @RegisterMoxyReflectorPackages( "ru.hh.feature_force_update", "ru.hh.feature_profile", "ru.hh.feature_worknear" ... ) class MoxyReflectorStub</span></span></code> </pre> </div></div><br><p>  Vergessen Sie am Ende nicht, das erstellte Modul mit dem <em>Abhängigkeitsblock</em> des Anwendungsmoduls zu verbinden: </p><br><div class="spoiler">  <b class="spoiler_title">Abhängigkeiten hinzufügen</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Application module build.gradle dependencies { def libraries = rootProject.ext.deps implementation project(':logger') implementation project(':dependency-handler') implementation project(':common') implementation project(':analytics') implementation project(':feature_worknear') ...</span></span></code> </pre> </div></div><br><p>  Wir haben eine Checkliste mit neun Punkten. </p><br><p>  Da es viele Punkte gibt, wird es wahrscheinlich etwas vergessen.  Und dann fragen Sie sich stundenlang, was passiert ist und warum das Projekt nicht stattfinden wird. </p><br><p>  Wir haben beschlossen, dass Sie nicht so leben können und etwas ändern müssen. </p><br><h2 id="varianty-avtomatizacii-chek-lista">  Checkliste Automatisierungsoptionen </h2><br><p>  Nachdem wir die Checkliste zusammengestellt hatten, suchten wir nach Optionen zur Automatisierung ihrer Elemente. </p><br><p>  Die erste Option war ein Versuch, <strong>"Strg + C, Strg + V" auszuführen</strong> .  Wir haben versucht, eine Implementierung für die Erstellung des Android Library-Moduls zu finden, die uns "out of the box" zur Verfügung steht.  Im Ordner mit Android Studio (für MacOs: <em>/ Applications / Android \ Studio.app/Contents/plugins/android/lib/templates/gradle-projects/</em> ) finden Sie einen speziellen Ordner mit Vorlagen der Projekte, die bei Auswahl von Datei - <em>angezeigt werden.</em> &gt; Neu -&gt; Neues Modul.  Wir haben versucht, die NewAndroidModule-Vorlage zu kopieren, indem wir die ID in der Datei <em>template.xml.ftl</em> geändert haben.  Dann haben sie die IDE gestartet, ein neues Modul erstellt und ... Android Studio ist abgestürzt, weil die Liste der Module, die Sie im Menü zum Erstellen eines neuen Moduls sehen, fest codiert ist. Sie können sie nicht durch primitives Kopieren und Einfügen ändern.  Wenn Sie versuchen, ein Element aufzunehmen und hinzuzufügen, zu löschen oder zu ändern, stürzt Android Studio einfach ab. </p><br><p><img src="https://habrastorage.org/webt/ym/ww/sw/ymwwsw1rzibvaxwrhkqkwd5fqyk.png" alt="Bild"></p><br><p>  Die zweite Option zur Automatisierung der Checkliste war die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FreeMarker-Vorlagen-Engine</a> .  Nach einem erfolglosen Versuch des Kopierens und Einfügens haben wir uns die Modulvorlagen genauer angesehen und FreeMarker-Vorlagen unter der Haube gefunden. </p><br><p>  Ich werde Ihnen nicht im Detail sagen, was FreeMarker ist - es gibt einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">guten Artikel von RedMadRobot</a> und ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video von MosDroid von Lesha Bykov</a> .  Kurz gesagt - dies ist eine Engine zum Generieren von Dateien mithilfe von Vorlagen und speziellen Map-ki-Java-Objekten.  Sie füttern Vorlagen, Objekte und FreeMarker generiert Code an der Ausgabe. </p><br><p>  Aber schauen Sie sich noch einmal die Checkliste an: </p><br><p><img src="https://habrastorage.org/webt/nf/hl/81/nfhl811qacot1f4j_pt2fhsmm8k.png" alt="Bild"></p><br><p>  Wenn Sie genau hinschauen, können Sie sehen, dass es in zwei große Gruppen von Aufgaben unterteilt ist: </p><br><ul><li>  Die Aufgaben zum Generieren eines neuen Codes (1, 3, 4, 5, 6, 7, 8) und </li><li>  Aufgaben zum Ändern eines vorhandenen Codes (2, 7, 8, 9) </li></ul><br><p>  Und wenn FreeMarker Aufgaben der ersten Gruppe mit einem Knall bewältigt, dann bewältigt es die zweite überhaupt nicht.  Als kleines Beispiel: Wenn Sie in der aktuellen Implementierung der FreeMarker-Integration in Android Studio versuchen, eine Zeile in die Datei settings.gradle einzufügen, die nicht mit dem Wort 'include' beginnt, <a href="">stürzt</a> das <a href="">Studio ab</a> .  Hier haben wir die Traurigen gefangen und beschlossen, die Verwendung von FreeMarker aufzugeben. </p><br><p>  Nach einem Fehler mit FreeMarker kam die Idee auf, mein eigenes Konsolendienstprogramm für die Durchführung einer Checkliste zu schreiben.  In Intellij IDEA ist es möglich, ein Terminal zu verwenden. Warum also nicht?  Lassen Sie uns ein Skript über die Bash schreiben, total business: </p><br><p><img src="https://habrastorage.org/webt/t0/2h/ki/t02hki4jlkvs_7eaqisfbuqnyb0.png" alt="Bild"></p><br><p>  Da wir das erstellte Modul jedoch flexibel konfigurieren möchten, müssen wir viele verschiedene Flags eingeben, was für das Drucken in der Konsole nicht sehr bequem ist. </p><br><p>  Danach traten wir einen Schritt zurück und erinnerten uns daran, dass wir in Intellij IDEA arbeiteten.  Und wie ist es angeordnet?  Es gibt einen bestimmten Kern von Klassen, eine Engine, an die viele Plug-Ins angeschlossen sind, die die von uns benötigte Funktionalität hinzufügen. </p><br><p>  Wie viele von Ihnen sehen im Screenshot mehr als zwei verbundene Plugins? </p><br><p><img src="https://habrastorage.org/webt/rf/fr/dm/rffrdmuui00uxtruelogjpor_le.png" alt="Bild"></p><br><div class="spoiler">  <b class="spoiler_title">Wo soll man suchen? ..</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/0m/uw/ua/0muwuamgty0p8kri2ywhq3dsbaw.png" alt="Bild"></p></div></div><br><p>  Hier sind sie mindestens drei miteinander verbunden.  Wenn Sie mit Kotlin arbeiten, ist das Kotlin-Plugin aktiviert.  Wenn Sie in einem Projekt mit Gradle arbeiten, ist auch das Gradle-Plugin enthalten.  Wenn Sie in einem Projekt mit einem Versionskontrollsystem arbeiten - Git, SVN oder etwas anderem -, ist das entsprechende Plug-In für die Integration dieses VCS enthalten. </p><br><p>  Wir haben uns das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offizielle</a> JetBrains- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Plugin-Repository angesehen</a> und festgestellt, dass es bereits über 4000 offiziell registrierte Plugins gibt!  Fast die ganze Welt schreibt Plugins, und diese Plugins können alles: von der Integration einer Programmiersprache in IDEA bis hin zu spezifischen Tools, die in IDEA ausgeführt werden können. </p><br><p>  Kurz gesagt, wir haben beschlossen, unser eigenes Plugin zu schreiben. </p><br><h1 id="osnovy-razrabotki-plaginov">  Grundlagen der Plugin-Entwicklung </h1><br><p>  Wir gehen weiter zu den Grundlagen der Plugin-Entwicklung.  Um loszulegen, benötigen Sie nur drei Dinge: </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">IntelliJ IDEA</a> , minimale Community Edition (Sie können in der Ultimate-Version arbeiten, bietet jedoch keine besonderen Vorteile bei der Entwicklung von Plugins); </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Plugin DevKit</a> ist ein spezielles Plugin, das die Möglichkeit bietet, andere Plugins zu schreiben. </li><li>  Und jede JVM-Sprache, in der Sie ein Plugin schreiben möchten.  Es könnte Kotlin, Java, Groovy sein - alles. </li></ol><br><p>  Wir beginnen mit der Erstellung eines Plugin-Projekts.  Wir wählen <strong>Neues Projekt</strong> , Punkt <strong>Gradle</strong> , wir kreuzen das <strong>IntelliJ Platform Plugin an</strong> und wir erstellen das Projekt. </p><br><p><img src="https://habrastorage.org/webt/je/rf/wd/jerfwdeqfmpzdef-_cypw4wahw8.png" alt="Bild"></p><br><p>  Hinweis: Wenn das Kontrollkästchen IntelliJ Platform Plugin nicht angezeigt wird, ist das Plugin DevKit nicht installiert. </p><br><p>  Nach dem Ausfüllen der erforderlichen Felder sehen wir eine leere Plugin-Struktur. </p><br><p><img src="https://habrastorage.org/webt/i2/sy/59/i2sy59dpr0pi8nlmhfyhson20h8.png" alt="Bild"></p><br><p>  Schauen wir es uns genauer an.  Es besteht aus: </p><br><ul><li>  Ordner, in die Sie den Code für das zukünftige Projekt schreiben werden;  ( <em>main / java</em> , <em>main / kotlin</em> usw.); </li><li>  <em>build.gradle-</em> Datei, in der Sie die Abhängigkeiten Ihres Plugins von einigen Bibliotheken deklarieren und so etwas wie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em>gradle-Intellij-Plugin</em></a> konfigurieren. </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em>Gradle-Intellij-Plugin</em></a> - Gradle-Plugin, mit dem Sie Gradle als Plugin-Build-System verwenden können.  Dies ist praktisch, da fast jeder Android-Entwickler mit Gradle vertraut ist und weiß, wie man damit arbeitet.  Darüber hinaus fügt das Gradle-Intellij-Plugin Ihrem Projekt nützliche Gradle-Aufgaben hinzu, insbesondere: </p><br><ul><li>  runIde - Diese Aufgabe startet eine separate IDEA-Instanz mit einem Plugin, das Sie entwickeln, damit Sie es debuggen können. </li><li>  buildPlugin - sammelt das Zip-Archiv Ihres Plugins, damit Sie es entweder lokal oder über das offizielle IDEA-Repository verteilen können; </li><li>  verifyPlugin - Diese Aufgabe überprüft Ihr Plugin auf schwerwiegende Fehler, die es möglicherweise nicht in Android Studio oder eine andere IDEA integrieren lassen. </li></ul><br><p>  Was gibt <em>Gradle-Intellij-Plugin noch</em> ?  Mit seiner Hilfe wird es einfacher, Abhängigkeiten von anderen Plugins hinzuzufügen, aber wir werden etwas später darüber sprechen, aber im <em>Moment</em> kann ich sagen, dass das <em>Gradle-Intellij-Plugin</em> Ihr Bruder ist. Verwenden Sie es. </p><br><p>  Zurück zur Plugin-Struktur.  Die wichtigste Datei eines Plugins ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em>plugin.xml</em></a> . </p><br><div class="spoiler">  <b class="spoiler_title">plugin.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>com.experiment.simple.plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>Hello, world<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vendor</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">email</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myemail@yourcompany.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.mycompany.com"</span></span></span><span class="hljs-tag">&gt;</span></span> My company <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vendor</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>&lt;![CDATA[ My first ever plugin - try to open Hello world dialog&lt;br&gt; ]]&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>com.intellij.modules.lang<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>org.intellij.groovy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-version</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">since-build</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"163"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My actions"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyActionGroup"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My actions"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">separator</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.experiment.actions.OpenHelloWorldAction"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.experiment.actions.OpenHelloWorldAction"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Show Hello world"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Open dialog"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add-to-group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">group-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NewGroup"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">anchor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"last"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p>  Dies ist eine Datei, die enthält: </p><br><ul><li>  Ihre Plugin-Metadaten: Kennung, Name, Beschreibung, Herstellerinformationen, Änderungsprotokoll </li><li>  Beschreibung der Abhängigkeiten von anderen Plugins; </li><li>  Hier können Sie auch die IDEA-Version angeben, mit der Ihr Plugin ordnungsgemäß funktioniert </li><li>  <em>Hier</em> werden auch <em>Aktionen</em> beschrieben. </li></ul><br><h3 id="actions">  Aktionen </h3><br><p>  Was sind <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aktionen</a> ?  Angenommen, Sie öffnen ein Menü, um eine neue Datei zu erstellen.  Tatsächlich wurde jedes Element dieses Menüs durch eine Art Plugin hinzugefügt: </p><br><p><img src="https://habrastorage.org/webt/al/8y/kg/al8ykgojltbksqkuqu5l8cww4fw.png" alt="Bild"></p><br><p>  Aktionen sind die Einstiegspunkte für Benutzer in Ihr Plugin.  Jedes Mal, wenn der Benutzer auf einen Menüpunkt klickt, erhalten Sie die Kontrolle innerhalb des Plugins. Sie können auf diesen Klick reagieren und das Notwendige tun. <br>  Wie werden Aktionen erstellt?  Schreiben wir eine einfache Aktion, die einen Dialog mit der Meldung "Hallo Welt" anzeigt. </p><br><div class="spoiler">  <b class="spoiler_title">OpenHelloWorldAction</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpenHelloWorldAction</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AnAction</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionPerformed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(actionEvent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AnActionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> project = actionEvent.project Messages.showMessageDialog( project, <span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>, <span class="hljs-string"><span class="hljs-string">"Greeting"</span></span>, Messages.getInformationIcon() ) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AnActionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.update(e) <span class="hljs-comment"><span class="hljs-comment">// TODO - Here we can update our action (for example, disable it) } override fun beforeActionPerformedUpdate(e: AnActionEvent) { super.beforeActionPerformedUpdate(e) // TODO - This method calls right before 'actionPerformed' } }</span></span></code> </pre> </div></div><br><p>  Um eine Aktion zu erstellen, erstellen wir zunächst eine Klasse, die von der <em>AnAction-</em> Klasse erbt.  Zweitens müssen wir die actionPerformed-Methode neu definieren, wobei der spezielle Parameter der <em>AnActionEvent-</em> Klasse <em>kommt</em> .  Dieser Parameter enthält Informationen zum Ausführungskontext Ihrer Aktion.  Der Kontext bezieht sich auf das Projekt, in dem Sie arbeiten, die Datei, die jetzt im Code-Editor des Benutzers geöffnet ist, die im Projektbaum ausgewählten Elemente und andere Daten, die bei der Verarbeitung Ihrer Aufgaben hilfreich sein können. </p><br><p>  Um das Dialogfeld "Hallo Welt" <em>anzuzeigen</em> , <em>rufen</em> wir zuerst das Projekt ab (nur über den Parameter <em>AnActionEvent</em> ) und verwenden dann die Dienstprogrammklasse <em>Nachrichten</em> , um das Dialogfeld anzuzeigen. </p><br><p>  Welche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zusätzlichen Funktionen</a> haben wir in der Aktion?  Wir können zwei Methoden überschreiben: <em>update</em> und <em>beforeActionPerformedUpdate</em> . </p><br><p>  Die <em>Aktualisierungsmethode</em> wird jedes Mal aufgerufen, wenn sich der Ausführungskontext Ihrer Aktion ändert.  Warum es für Sie nützlich sein kann: Zum Beispiel, um den Menüpunkt zu aktualisieren, der von Ihrem Plugin hinzugefügt wurde.  Angenommen, Sie haben eine Aktion geschrieben, die nur mit Kotlin-Dateien funktioniert, und der Benutzer hat jetzt die Groovy-Datei geöffnet.  Dann können Sie in der Aktualisierungsmethode Ihre Aktion unzugänglich machen. </p><br><p>  Die <em>beforeActionPerformedUpdate-</em> Methode ähnelt der update-Methode, wird jedoch direkt vor <em>actionPerformed aufgerufen</em> .  Dies ist die letzte Gelegenheit, Ihre Aktion zu beeinflussen.  In der Dokumentation wird empfohlen, bei dieser Methode nichts „Schweres“ auszuführen, damit sie so schnell wie möglich ausgeführt wird. </p><br><p>  Sie können Aktionen auch an bestimmte Elemente der IDEA-Schnittstelle binden und diese als Standardtastenkombinationen für den Aufruf festlegen. Ich empfehle, hier mehr darüber zu lesen. </p><br><h3 id="razrabotka-ui-v-plaginah">  UI-Entwicklung in Plugins </h3><br><p>  Wenn Sie ein eigenes Dialogdesign benötigen, müssen Sie hart arbeiten.  Wir haben unsere Benutzeroberfläche entwickelt, weil wir eine praktische grafische Oberfläche haben wollten, in der es möglich sein würde, einige Ticks zu markieren, einen Selektor für Enum-Werte zu haben und so weiter. </p><br><p>  Das Plugin DevKit für die Entwicklung der Benutzeroberfläche fügt einige Aktionen hinzu, z. B. das <em>GUI-Formular</em> und den <em>Dialog</em> .  Das erste erstellt ein leeres Formular für uns, das zweite ein Formular mit zwei Schaltflächen: <em>Ok</em> und <em>Abbrechen</em> . </p><br><p><img src="https://habrastorage.org/webt/wd/bx/3r/wdbx3rhggovpfv-fey53fucs2aw.png" alt="Bild"></p><br><p>  Okay, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">es gibt einen Formulardesigner</a> , aber er ist ... so lala.  Im Vergleich dazu sieht sogar der Layout-Designer in Android Studio komfortabel und gut aus.  Die gesamte Benutzeroberfläche wird in einer Bibliothek wie Java Swing entwickelt.  Dieser Formular-Designer generiert eine für Menschen lesbare XML-Datei.  Wenn Sie im Formular-Designer nichts tun können (Beispiel: Fügen Sie mehrere Steuerelemente in dieselbe Rasterzelle ein und verbergen Sie alle Steuerelemente bis auf eines), müssen Sie zu dieser Datei gehen und sie ändern. IDEA übernimmt diese Änderungen. </p><br><p>  Fast jedes Formular besteht aus zwei Dateien: Die erste hat die Erweiterung <em>.form</em> , dies ist nur die XML-Datei, die zweite ist die sogenannte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em>Bound-Klasse</em></a> , die in Java, Kotlin, geschrieben werden kann, aber was auch immer Sie wollen.  Es fungiert als Formular-Controller.  Unerwartet, aber das Schreiben in Java ist viel einfacher als in anderen Sprachen.  Denn zum Beispiel ist das Tuning für Kotlin noch nicht so perfekt.  Wenn Sie bei der Arbeit mit der Java-Klasse neue Komponenten hinzufügen, werden diese Komponenten automatisch zur Klasse hinzugefügt. Wenn Sie den Namen der Komponente im Designer ändern, wird sie automatisch abgerufen.  Bei Kotlin werden jedoch keine Komponenten hinzugefügt - es findet keine Integration statt, Sie können etwas vergessen und nicht verstehen, warum nichts funktioniert. </p><br><h3 id="rezyumiruem-osnovy">  Wir fassen die Grundlagen zusammen </h3><br><ul><li>  Um ein Plugin zu erstellen, benötigen Sie: IDEA Community Edition, Plugin DevKit und Java, die damit verbunden sind. </li><li>  Gradle-Intellij-Plugin ist dein Bruder, es wird dein Leben stark vereinfachen, ich empfehle es zu benutzen. </li><li>  Schreiben Sie keine eigene Benutzeroberfläche, es sei denn, dies ist erforderlich.  In IDEA gibt es viele Dienstprogrammklassen, mit denen Sie sofort eine eigene Benutzeroberfläche erstellen können.  Wenn Sie etwas Kompliziertes brauchen, machen Sie sich bereit, hart zu arbeiten. </li><li>  Das Plugin kann beliebig viele Aktionen ausführen.  Das gleiche Plugin kann Ihrer IDEA viele Funktionen hinzufügen. </li></ul><br><h1 id="vnutrennosti-idea-komponenty-psi">  IDEA-Interna: Komponenten, PSI </h1><br><p>  Lassen Sie uns über den Darm von IDEA sprechen, darüber, wie er im Inneren angeordnet ist.  Ich sage Ihnen, dass nichts in Ihrem Kopf zusammenbricht, wenn ich den praktischen Teil erkläre, und dass Sie verstehen, woher er kommt. </p><br><p>  Wie ist IDEA aufgebaut?  Auf der ersten Ebene der Hierarchie befindet sich eine Klasse wie <a href=""><em>Application</em></a> .  Dies ist eine separate IDEA-Instanz.  Für jede IDEA-Instanz wird ein Anwendungsklassenobjekt erstellt.  Wenn Sie beispielsweise AppCode, Intellij IDEA und Android Studio gleichzeitig ausführen, erhalten Sie drei separate Instanzen der Anwendungsklasse.  Diese Klasse ist für den Eingabe- / Ausgabestream ausgelegt. </p><br><div class="spoiler">  <b class="spoiler_title">Platzieren Sie die Anwendung in der Hierarchie</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/rw/_y/vm/rw_yvmpfn1hyekftipxwuq-qxn8.png" alt="Bild"></p></div></div><br><p>  Die nächste Stufe ist die <a href=""><em>Projektklasse</em></a> .  Dies ist das Konzept, das dem beim Öffnen eines neuen Projekts in IDEA am nächsten kommt.  Das Projekt wird normalerweise benötigt, um andere Komponenten in IDEA zu integrieren: Dienstprogrammklassen, Manager und vieles mehr. </p><br><div class="spoiler">  <b class="spoiler_title">Projektplatz in der Hierarchie</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xv/ku/z6/xvkuz6ezzzd5w5_c9suloyafcza.png" alt="Bild"></p></div></div><br><p>  Die nächste Detailebene ist die <a href=""><em>Modulklasse</em></a> .  Im Allgemeinen ist ein Modul eine Hierarchie von Klassen, die in einem Ordner zusammengefasst sind.  Aber hier meinen wir mit Modulen Maven-Module, Gradle-Module.  Diese Klasse wird zum einen benötigt, um die Abhängigkeiten zwischen Modulen zu bestimmen, und zum anderen, um nach Klassen innerhalb dieser Module zu suchen. </p><br><div class="spoiler">  <b class="spoiler_title">Platzieren Sie das Modul in einer Hierarchie</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/zr/vs/ah/zrvsahicec7gak2sfqhox2ldts0.png" alt="Bild"></p></div></div><br><p>  Die nächste Detailebene ist die <a href=""><em>VirtualFile-</em></a> Klasse.  Dies ist eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Abstraktion über die reale Datei</a> , die sich auf Ihrer Festplatte befindet.  Mehrere <em>VirtualFile-</em> Instanzen können jeder realen Datei entsprechen, sind jedoch alle gleich.  Wenn gleichzeitig die reale Datei gelöscht wird, wird <em>VirtualFile</em> nicht selbst gelöscht, sondern wird einfach ungültig. </p><br><div class="spoiler">  <b class="spoiler_title">VirtualFile Hierarchy Place</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/z8/4y/hq/z84yhqyl6tzv-1uwc_ersyhmqv0.png" alt="Bild"></p></div></div><br><p>  Jeder <em>VirtualFile</em> ist <em>eine</em> Entität wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em>Document</em></a> zugeordnet.  Es ist eine Abstraktion über den Text Ihrer Datei.  <em>Das Dokument wird</em> benötigt, damit Sie Ereignisse verfolgen können, die sich auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Änderungen im Text der Datei</a> beziehen: Der Benutzer hat eine Zeile eingefügt, eine Zeile gelöscht usw. usw. </p><br><div class="spoiler">  <b class="spoiler_title">Dokument in Hierarchie einfügen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/fr/nc/qg/frncqgrdpc3xgtnn_txrhlvdcv0.png" alt="Bild"></p></div></div><br><p>  Ein wenig neben dieser Hierarchie steht die <a href=""><em>Editor-</em></a> Klasse - es ist ein Code-Editor.  Jedes Projekt kann einen <em>Editor haben</em> .  Es wird benötigt, damit Sie Ereignisse im Zusammenhang mit dem Code-Editor verfolgen können: Der Benutzer hat die Zeile markiert, in der sich das Caret befindet, und so weiter. </p><br><div class="spoiler">  <b class="spoiler_title">Platz des Herausgebers in der Hierarchie</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/fk/kj/l-/fkkjl-c-t5nyehcwt6j-ywdhwf0.png" alt="Bild"></p></div></div><br><p>  Das Letzte, <a href=""><em>worüber</em></a> ich sprechen wollte, ist <a href=""><em>PsiFile</em></a> .  Dies ist auch eine Abstraktion über reale Dateien, jedoch unter dem Gesichtspunkt der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Darstellung von Codeelementen</a> .  PSI steht für Program Structure Interface. </p><br><div class="spoiler">  <b class="spoiler_title">PsiFile Platz in der Hierarchie</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ho/kn/l0/hoknl08rk2giwbxure86b3pqcva.png" alt="Bild"></p></div></div><br><p>  Und woraus besteht jedes Programm?  Betrachten Sie eine reguläre Java-Klasse. </p><br><div class="spoiler">  <b class="spoiler_title">Einfache Java-Klasse</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.experiment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.inject.Inject; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> String injectedString; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">someMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(injectedString); } }</code> </pre> </div></div><br><p>  Es besteht aus der Angabe eines Pakets, von Importen, Klassen, Feldern, Methoden, Anmerkungen, Schlüsselwörtern, Datentypen, Modifikatoren, Bezeichnern, Methodenreferenzen, Ausdrücken und Token.  Und für jedes Element gibt es eine Abstraktion von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><em>PsiElement</em></a> .  Das heißt, jedes Ihrer Programme besteht aus <em>PsiElements</em> . </p><br><p><img src="https://habrastorage.org/webt/ps/oa/2t/psoa2timve59g__naf1rrskzfdm.png" alt="Bild"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PsiFile</a> ist wiederum eine Baumstruktur, in der jedes Element ein übergeordnetes Element und viele Nachkommen haben kann. </p><br><p><img src="https://habrastorage.org/webt/mi/4j/f2/mi4jf2mdcqjc1huurmu2ca0hsfi.png" alt="Bild"></p><br><p>  Ich möchte erwähnen, dass PSI nicht gleich einem <strong>abstrakten Syntaxbaum ist</strong> .  Ein abstrakter Syntaxbaum ist ein Repräsentationsbaum Ihres Programms, nachdem der Parser Ihr Programm übergeben hat, und er ist von jeder Programmiersprache getrennt.  PSI ist im Gegenteil <strong>an</strong> eine bestimmte Programmiersprache <strong>gebunden</strong> .  Wenn Sie mit einer Java-Klasse arbeiten, haben Sie es mit Java PsiElements zu tun.  Bei der Arbeit mit einer Groovy-Klasse - mit Groovy PsiElements und so weiter.   ,         PSI-  -  ,      ,   , –    . </p><br><p>      PSI –   PSI-   IDEA.            ,    ,        ,   .         . </p><br><h3 id="rezyumiruem-chast-pro-vnutrennosti-idea">     IDEA </h3><br><ul><li> PSI      IDEA; </li><li> PSI-   IDEA,            ; </li><li>         PsiElement-. </li></ul><br><p>      ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> .            . </p><br><h2 id="dopolnitelnye-materialy-po-plaginostroeniyu">     </h2><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informationen zum Erstellen eines Plugins für die Zeiterfassung</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginn einer großen Reihe von Artikeln, die die Plugin-Dokumentation ergänzen</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie Ihr eigenes Tool-Fenster</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informationen zur Erweiterung der Funktionalität des Code-Editors</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein kleines Beispiel für das Erstellen eines eigenen Plugins</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">      IntelliJ IDEA</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">       IDEA</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">      IntelliJ IDEA</a> </li><li>   , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>     .    ,     . </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  Droidcon Italy 2017</a> ,  ,   , ,        FreeMarker- .        ,      . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   KotlinConf</a> ,     Square       SQLDelight,        Java,   Kotlin. </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de463583/">https://habr.com/ru/post/de463583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de463573/index.html">Der erste Chip für Rechenzentren basierend auf der Zen 2-Architektur</a></li>
<li><a href="../de463575/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 22. Dritte CCNA: RIP weiter studieren</a></li>
<li><a href="../de463577/index.html">Plastizität und Festigkeit: Aushärtung des Intermetalls ohne Betonung der Versetzung</a></li>
<li><a href="../de463579/index.html">Windows: Finden Sie heraus, wer wo angemeldet ist</a></li>
<li><a href="../de463581/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 23. Erweiterte Routing-Technologien</a></li>
<li><a href="../de463585/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 24. IPv6</a></li>
<li><a href="../de463587/index.html">ConfigureAwait, wer ist schuld und was zu tun?</a></li>
<li><a href="../de463591/index.html">BlueKeep-2 - Alle neuen Windows-Versionen sind jetzt anfällig</a></li>
<li><a href="../de463595/index.html">Wir steuern den Fokus oder eine Prise C # und STM32 für eine Webcam</a></li>
<li><a href="../de463597/index.html">Verwenden der Kontext-API in React zum Erstellen eines reaktionsschnellen Anwendungsdesigns</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>