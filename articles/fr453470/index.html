<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç° üë± üë©üèø‚Äçüî¨ Vos monolithes distribu√©s complotent derri√®re vous üë© üñäÔ∏è üë¥üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! 

 La traduction d'aujourd'hui touche non seulement et pas tellement aux microservices - un sujet que tout le monde a sur les l√®vres au...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vos monolithes distribu√©s complotent derri√®re vous</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/453470/">  Bonjour, Habr! <br><br>  La traduction d'aujourd'hui touche non seulement et pas tellement aux microservices - un sujet que tout le monde a sur les l√®vres aujourd'hui - mais rappelle √©galement combien il est important d'appeler un chat un chat.  La transition vers une architecture de microservices est parfois n√©cessaire, mais, comme le souligne encore une fois l'auteur, elle n√©cessite un examen attentif des cons√©quences.  Bonne lecture et fructueuse! <br><br><img src="https://habrastorage.org/webt/im/q8/dr/imq8drim-mkatdxhbytwowus1ik.jpeg"><br><a name="habracut"></a><br>  De temps en temps, je pose la m√™me question. <br><blockquote>  Y a-t-il une v√©rit√© si importante que seuls quelques-uns sont d'accord avec vous?  - Peter Thiel </blockquote>  Avant de m'asseoir pour ce poste, j'ai essay√© sur cette question pendant longtemps sur un sujet, qui est aujourd'hui dans une tendance s√©rieuse - il s'agit des microservices.  Je pense que maintenant j'ai quelque chose √† dire;  certains r√©sultats sont bas√©s sur la r√©flexion, d'autres sur l'exp√©rience pratique.  Alors, je vous le dis. <br>  Commen√ßons par une v√©rit√© importante qui servira de point de r√©f√©rence pour nous le long du chemin comme une √©toile polaire. <br><br>  La plupart des impl√©mentations de microservices ne sont rien d'autre que des monolithes distribu√©s. <br><br><h4>  Epoque des monolithes </h4><br>  Tout syst√®me a commenc√© comme une application monolithique.  Je n'entrerai pas dans les d√©tails de ce sujet ici - beaucoup ont d√©j√† √©crit sur beaucoup.  Cependant, la part du lion des informations sur les monolithes est consacr√©e √† des questions telles que la productivit√© et l'√©volutivit√© des d√©veloppeurs, tout en laissant derri√®re les crochets l'atout le plus pr√©cieux de toute soci√©t√© Internet: les donn√©es. <br><br><img src="https://habrastorage.org/webt/83/75/yh/8375yhxrmoq8jmhfl-wz97u7slg.png"><br><br>  <i>Architecture d'application monolithique typique</i> <br><br>  Si les donn√©es sont si importantes, alors pourquoi toute l'attention est-elle accord√©e √† d'autres sujets, mais pas √† eux?  La r√©ponse, en g√©n√©ral, est simple: car ils ne sont pas aussi douloureux que la question des donn√©es. <br>  Peut-√™tre que le monolithe est la seule √©tape du cycle de vie du syst√®me o√π vous: <br><br><ul><li>  Comprenez parfaitement votre mod√®le de donn√©es; </li><li>  Vous pouvez coop√©rer avec les donn√©es (il est suppos√© que votre base de donn√©es est correctement s√©lectionn√©e pour votre application). </li></ul><br>  En termes de donn√©es, le monolithe est id√©al.  Et puisque les donn√©es sont l'actif le plus pr√©cieux de toute entreprise, il est pr√©f√©rable de ne pas briser le monolithe, sauf si vous avez une tr√®s bonne raison, ou une combinaison de ces raisons.  Dans la plupart des cas, la raison d√©cisive de ce type est la n√©cessit√© de l'√©chelle (puisque nous vivons dans le monde r√©el avec ses limites physiques inh√©rentes). <br><br>  Lorsque ce moment arrive, votre syst√®me entre tr√®s probablement dans une nouvelle hypostase: il <b>se transforme en un monolithe distribu√©</b> . <br><br><h4>  L'√®re des monolithes distribu√©s </h4><br>  Supposons que tout se passe bien dans votre entreprise et que l'application doit se d√©velopper.  Vous avez de plus en plus de gros clients, et vos exigences en mati√®re de facturation et de reporting ont √©volu√© √† la fois en termes d'opportunit√©s et de volume. <br><br>  Reprenant s√©rieusement la d√©molition du monolithe, en particulier, vous tenterez de mettre en place deux petits services, dont l'un fournira des rapports, et le second - la facturation.  Tr√®s probablement, ces nouveaux services fourniront une API HTTP et disposeront d'une base de donn√©es d√©di√©e pour le stockage d'√©tat √† long terme.  Apr√®s de nombreuses validations, vous, comme nous chez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Unbabel</a> , pouvez obtenir quelque chose qui ressemble √† l'illustration suivante. <br><br><img src="https://habrastorage.org/webt/lg/js/9g/lgjs9grnmyupckoplo0to5q-kjm.png"><br><br>  <i>Une vue g√©n√©rale de l'architecture du syst√®me apr√®s avoir d√©tach√© les services de facturation et de reporting de l'application monolithique principale</i> <br><br>  Tout se passe comme pr√©vu. <br><br><ul><li>  L'√©quipe continue de diviser le monolithe en syst√®mes plus petits; </li><li>  Les convoyeurs d'int√©gration / livraison en continu fonctionnent comme sur des roulettes; </li><li>  Le cluster Kubernetes est sain, les ing√©nieurs sont productifs et satisfaits de tout. </li></ul><br>  La vie est belle. <br><br>  Mais que se passe-t-il si je dis qu'en ce moment, de vils complots se tissent contre vous? <br><br>  Maintenant, en regardant votre syst√®me, vous constaterez que les donn√©es ont √©t√© r√©parties sur de nombreux syst√®mes diff√©rents.  Vous √™tes parti de l'√©tape o√π vous aviez une base de donn√©es unique o√π tous les objets de donn√©es √©taient stock√©s, et maintenant vos objets de donn√©es se sont propag√©s √† diff√©rents endroits.  Vous penserez peut-√™tre qu'il n'y a pas de probl√®me, car des microservices sont n√©cessaires pour cr√©er des abstractions et sceller des donn√©es, cachant la complexit√© interne du syst√®me. <br><br>  Vous avez absolument raison.  Mais avec une √©chelle croissante, des probl√®mes plus complexes se posent: maintenant, √† tout moment, vous √™tes oblig√© de r√©pondre aux exigences de l'entreprise (par exemple, pour suivre une m√©trique) qui n√©cessitent un acc√®s aux donn√©es situ√©es dans plusieurs syst√®mes. <br><br>  Que faire?  En fait, il existe de nombreuses options.  Mais press√©, vous devez √©galement servir une √©norme fraternit√© de clients qui se sont r√©cemment inscrits aupr√®s de vous, vous devez donc trouver un √©quilibre entre ¬´rapide¬ª et ¬´bon¬ª.  Apr√®s avoir discut√© des d√©tails, vous d√©cidez de construire un syst√®me suppl√©mentaire qui effectuerait un certain travail ETL, contribuant √† la solution des t√¢ches finales.  Ce syst√®me devra avoir acc√®s √† toutes les r√©pliques en lecture contenant les informations dont vous avez besoin.  La figure suivante montre comment un tel syst√®me pourrait fonctionner. <br><br><img src="https://habrastorage.org/webt/76/op/x0/76opx0yinpcv5fbxh9x8sais2hm.png"><br><br>  <i>Un exemple g√©n√©ralis√© d'un syst√®me ETL analytique (dans Unbabel, nous l'avons appel√© Automatic Translation Analytics)</i> <br><br>  Chez Unbabel, nous avons utilis√© cette approche, car: <br><br><ul><li>  Cela n'affecte pas trop les performances de chaque microservice; </li><li>  Il ne n√©cessite pas de changements majeurs d'infrastructure (il suffit d'ajouter un nouveau microservice); </li><li>  Nous avons pu satisfaire assez rapidement nos besoins commerciaux. </li></ul><br>  L'exp√©rience sugg√®re que pendant un certain temps, cette approche fonctionnera - jusqu'√† atteindre une certaine √©chelle.  Chez Unbabel, il nous a tr√®s bien servi jusqu'√† tr√®s r√©cemment, lorsque nous avons commenc√© √† faire face √† des d√©fis de plus en plus s√©rieux.  Voici certaines choses qui se sont transform√©es en maux de t√™te pour nous: <br><br>  <b>1. Modifications des donn√©es</b> <br><br>  L'un des principaux avantages des microservices est l'encapsulation.  La repr√©sentation interne des donn√©es peut changer, mais cela n'affecte pas les clients du syst√®me, car ils communiquent via une API externe.  Cependant, notre strat√©gie exigeait un acc√®s direct √† la repr√©sentation interne des donn√©es, et donc, d√®s que l'√©quipe n'a apport√© que quelques modifications √† la pr√©sentation des donn√©es (par exemple, renommer un champ ou changer le type de <code>text</code> en <code>uuid</code> ), nous avons √©galement d√ª changer et red√©ployer notre ETL- service. <br><br>  <b>2. La n√©cessit√© de traiter de nombreux sch√©mas de donn√©es diff√©rents</b> <br><br>  √Ä mesure que le nombre de syst√®mes auxquels nous devions nous connecter augmentait, nous devions faire face √† des fa√ßons de plus en plus h√©t√©rog√®nes de pr√©senter les donn√©es.  Il √©tait √©vident que nous ne pouvions pas mettre √† l'√©chelle tous ces sch√©mas, les relations entre eux et leurs repr√©sentations. <br><br>  <i><b>La racine de tout mal</b></i> <br><br>  Pour avoir une image compl√®te de ce qui se passe dans le syst√®me, nous avons d√ª nous arr√™ter √† une approche ressemblant √† un monolithe.  La diff√©rence √©tait que nous n'avions pas un syst√®me et une base de donn√©es, mais des dizaines de paires de ce genre, chacune avec sa propre repr√©sentation des donn√©es;  de plus, dans certains cas, les m√™mes donn√©es ont √©t√© r√©pliqu√©es sur plusieurs syst√®mes. <br><br>  Je pr√©f√®re appeler un tel syst√®me un monolithe distribu√©.  Pourquoi?  Puisqu'il est totalement inappropri√© pour suivre les changements dans le syst√®me, et la seule fa√ßon d'afficher l'√©tat du syst√®me est de collecter un service qui se connecte directement aux entrep√¥ts de donn√©es de tous les microservices.  Il est int√©ressant de voir combien de colosses d'Internet ont √©galement fait face √† des d√©fis similaires √† un moment donn√© de leur d√©veloppement.  Un bon exemple dans ce cas que j'aime toujours donner est le r√©seau LinkedIn. <br><br><img src="https://habrastorage.org/webt/bx/zv/l8/bxzvl8oaw7htdnldzu7fr3toxdm.png"><br><br>  <i>C'est le genre d'incident de donn√©es que les flux d'informations de Linkedin repr√©sentaient vers 2011 - source</i> <br><br>  En ce moment, vous vous demandez peut-√™tre: "qu'est-ce que vous allez faire avec tout √ßa?"  La r√©ponse est simple: vous devez commencer √† suivre les modifications et suivre les actions importantes au fur et √† mesure qu'elles se produisent. <br><br>  <b>Briser un monolithe distribu√© en utilisant Event Sourcing</b> <br><br>  Comme pratiquement le reste du monde, les syst√®mes sur Internet sont r√©actifs.  Ainsi, une demande √† l'API peut conduire √† l'insertion d'un nouvel enregistrement dans la base de donn√©es.  Actuellement, dans la plupart des cas, ces d√©tails ne nous d√©rangent pas, car nous souhaitons principalement mettre √† jour l'√©tat de la base de donn√©es.  La mise √† jour de l'√©tat d'une base de donn√©es est une cons√©quence conditionnelle d'un √©v√©nement (dans ce cas, une demande d'API).  Le ph√©nom√®ne √©v√©nementiel est simple et, n√©anmoins, le potentiel des √©v√©nements est tr√®s important - ils peuvent m√™me √™tre utilis√©s pour d√©truire un monolithe distribu√©. <br><br>  <b>Un √©v√©nement n'est rien de plus qu'un fait immuable d'une modification qui s'est produite dans votre syst√®me</b> .  Dans l'architecture de microservices, les √©v√©nements deviennent critiques et aident √† comprendre les flux de donn√©es et, sur leur base, √† d√©duire l'√©tat agr√©g√© de plusieurs syst√®mes.  Chaque microservice qui effectue une action int√©ressante du point de vue de l'ensemble du syst√®me doit g√©n√©rer un √©v√©nement ainsi que toutes les informations essentielles li√©es au fait que cet √©v√©nement repr√©sente. <br><br>  Vous avez peut-√™tre une question: <br>  ¬´Comment les microservices qui g√©n√®rent des √©v√©nements peuvent-ils m'aider √† r√©soudre le probl√®me du monolithe distribu√©?¬ª <br><br>  Si vous avez des syst√®mes qui g√©n√®rent des √©v√©nements, il peut y avoir un journal des faits avec les propri√©t√©s suivantes: <br><br><ul><li>  Absence de liaison √† tout entrep√¥t de donn√©es: les √©v√©nements sont g√©n√©ralement s√©rialis√©s en utilisant des formats binaires tels que JSON, Avro ou Protobufs; </li><li>  Immuabilit√©: d√®s qu'un √©v√©nement est g√©n√©r√©, il est impossible de le changer; </li><li>  Reproductibilit√©: l'√©tat du syst√®me √† un moment donn√© peut √™tre restaur√©;  pour cela, il suffit de ¬´rejouer¬ª le journal des √©v√©nements. </li></ul><br>  √Ä l'aide de ce journal, vous pouvez afficher l'√©tat √† l'aide de n'importe quel type de logique au niveau de l'application.  Vous n'√™tes plus associ√© √† aucun ensemble de microservices et <i>N</i> fa√ßons dont les donn√©es sont pr√©sent√©es.  La seule source de v√©rit√© et votre seul entrep√¥t de donn√©es est d√©sormais le r√©f√©rentiel o√π vos √©v√©nements sont stock√©s. <br><br>  Voici quelques raisons pour lesquelles le journal des √©v√©nements me semble √™tre le moyen d'aider √† briser le monolithe distribu√©: <br><br>  <b>1. La seule source de v√©rit√©</b> <br><br>  Au lieu de maintenir N sources de donn√©es qui peuvent √™tre n√©cessaires pour se connecter √† des bases de donn√©es (multiples) h√©t√©rog√®nes, dans ce nouveau sc√©nario, la v√©rit√© ultime est stock√©e dans exactement un r√©f√©rentiel: le journal des √©v√©nements. <br><br>  <b>2. Format de donn√©es universel</b> <br><br>  Dans la version pr√©c√©dente du syst√®me, nous devions g√©rer de nombreux formats de donn√©es, car nous √©tions directement connect√©s √† la base de donn√©es.  Dans la nouvelle mise en page, nous pouvons agir de mani√®re beaucoup plus flexible. <br><br>  Disons que vous avez aim√© une photo Instagram publi√©e par l'un de vos amis.  Une telle action peut √™tre d√©crite: ¬´L' <i>utilisateur X aimait l'image P</i> ¬ª.  Et voici un √©v√©nement repr√©sentant ce fait: <br><br><img src="https://habrastorage.org/webt/ff/sp/2x/ffsp2xttqkwolrptkfa3bw66mdc.png"><br><br>  <i>Un √©v√©nement correspondant √† l'approche AVO (Acteur, Verbe, Objet), simulant le fait que l'utilisateur s√©lectionne l'image qu'il aime.</i> <br><br>  <b>3. Affaiblissement de la communication entre producteurs et consommateurs</b> <br><br>  Enfin et surtout, l'un des plus grands avantages des op√©rations √©v√©nementielles est l'affaiblissement effectif de la communication entre les producteurs de donn√©es et les consommateurs.  Cette situation simplifie non seulement la mise √† l'√©chelle, mais r√©duit √©galement le nombre de d√©pendances entre elles.  Le seul contrat restant entre les syst√®mes dans ce cas est le diagramme d'√©v√©nements. <br><br><hr><br>  Au d√©but de cet article, la question a √©t√© pos√©e: existe-t-il une v√©rit√© aussi importante dans laquelle seuls quelques-uns sont d'accord avec vous? <br><br>  Permettez-moi d'y revenir en conclusion de cette excursion.  Je pense que la plupart des entreprises ne consid√®rent pas les donn√©es comme des ¬´entit√©s de premier ordre¬ª lorsqu'elles commencent la migration vers une architecture de microservices.  On fait valoir que tous les changements de donn√©es peuvent encore √™tre effectu√©s via l'API, mais cette approche conduit finalement √† une complication constante du service lui-m√™me. <br><br>  Je crois que la seule v√©ritable approche pour capturer les changements de donn√©es dans une architecture de microservices est de faire √©mettre des √©v√©nements par les syst√®mes selon un contrat strictement d√©fini.  Le fait d'avoir un journal des √©v√©nements correctement compil√© vous permet d'afficher un grand nombre de donn√©es en fonction de n'importe quel ensemble d'exigences m√©tier.  Dans ce cas, il vous suffit d'appliquer des r√®gles diff√©rentes aux m√™mes faits.  Dans certains cas, une telle fragmentation des donn√©es peut √™tre √©vit√©e si votre entreprise (en particulier vos chefs de produit) traite les donn√©es comme un produit.  Cependant, c'est un sujet pour un autre article. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr453470/">https://habr.com/ru/post/fr453470/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr453458/index.html">V√©ritable programmation r√©active dans Svelte 3.0</a></li>
<li><a href="../fr453460/index.html">Quand je suis fatigu√© du virtuel</a></li>
<li><a href="../fr453464/index.html">Futur quantique (suite)</a></li>
<li><a href="../fr453466/index.html">HolyJS 2019: d√©briefing de SEMrush (Partie 2)</a></li>
<li><a href="../fr453468/index.html">L'√©volution des applications Web Java</a></li>
<li><a href="../fr453472/index.html">V√©lo √† partir du moniteur d'√©nergie PZEM004T et ESP8266, avec People's Monitoring</a></li>
<li><a href="../fr453474/index.html">Contr√¥lez un ordinateur via la t√©l√©commande d'un amplificateur √† l'aide d'Arduino et de Node.js</a></li>
<li><a href="../fr453478/index.html">Nous √©tudions la sant√© des satellites Starlink Ilona Mask</a></li>
<li><a href="../fr453482/index.html">Introduction √† l'apprentissage en profondeur √† l'aide de TensorFlow</a></li>
<li><a href="../fr453484/index.html">Compteur BCD 4 bits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>