<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïõ üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø üç∞ Protocole MQTT et projet client ouvert MQTT sur Delphi üñïüèæ üèπ üòÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le protocole MQTT est utilis√© pour la messagerie sur Internet des objets. Tout d'abord, il est int√©ressant car il est pris en charge par les plus gran...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Protocole MQTT et projet client ouvert MQTT sur Delphi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/388231/"><img align="left" src="https://habrastorage.org/files/335/d26/6d4/335d266d4c4943fcb2b3dd3c3aec0cef.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le protocole </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est utilis√© pour la messagerie sur Internet des objets. </font><font style="vertical-align: inherit;">Tout d'abord, il est int√©ressant car il est pris en charge par les plus grands fournisseurs de services cloud, tels qu'IBM, Microsoft, Amazon. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vous pouvez obtenir gratuitement un compte dans ces services, y configurer un service pour recevoir des messages MQTT et surveiller la vie de vos appareils via ces services, par exemple, dans une maison intelligente. </font><font style="vertical-align: inherit;">De plus, gr√¢ce √† ces services, les appareils peuvent communiquer entre eux. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une d√©monstration de la connexion client au service MQTT du cloud IBM Bluemix est incluse.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Br√®ve description.</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MQTT est extr√™mement primitif: avec un en-t√™te court, sans contr√¥le d'int√©grit√©, il n'impose aucune restriction sur la structure, le codage ou le sch√©ma de donn√©es. </font><font style="vertical-align: inherit;">La seule exigence de donn√©es dans chaque paquet est qu'elles doivent √™tre accompagn√©es d'un identifiant pour le canal d'information. </font><font style="vertical-align: inherit;">Cet identificateur dans la sp√©cification est appel√© nom de rubrique ou une rubrique plus simple. </font><font style="vertical-align: inherit;">Les donn√©es sont transmises aux paquets via TCP. </font><font style="vertical-align: inherit;">La quantit√© de donn√©es dans un paquet peut aller d'un octet √† 268 435 455 octets. </font><font style="vertical-align: inherit;">Tr√®s flexible! </font><font style="vertical-align: inherit;">Bien que les services de cloud public imposent des restrictions plus strictes, jusqu'√† plusieurs kilo-octets.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le protocole MQTT n√©cessite un courtier de donn√©es. </font><font style="vertical-align: inherit;">Telle est l'id√©e centrale de la technologie. </font><font style="vertical-align: inherit;">Tous les appareils envoient des donn√©es uniquement au courtier et ne re√ßoivent √©galement des donn√©es que de lui. </font><font style="vertical-align: inherit;">Un courtier est un programme qui agit comme un serveur TCP avec une base de donn√©es dynamique.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La base de donn√©es du courtier contient en particulier une table avec tous les packages re√ßus avec une indexation par th√®mes de ces packages. </font><font style="vertical-align: inherit;">D√®s r√©ception du package, le courtier l'envoie √† tous les appareils du r√©seau en fonction de leur abonnement. </font><font style="vertical-align: inherit;">Pour que l'appareil re√ßoive quelque chose du courtier, il doit s'abonner au sujet. </font><font style="vertical-align: inherit;">Les sujets surgissent dynamiquement lors de l'abonnement ou √† l'arriv√©e d'un package avec ce sujet. </font><font style="vertical-align: inherit;">Vous pouvez √©galement vous d√©sinscrire du sujet. </font><font style="vertical-align: inherit;">Ainsi, les sujets sont un m√©canisme pratique pour organiser des relations de diff√©rents types: un √† plusieurs, plusieurs √† un et plusieurs √† plusieurs. </font><font style="vertical-align: inherit;">Si le package n'a pas d'abonn√©, il est supprim√©. </font><font style="vertical-align: inherit;">Si l'abonn√© n'est pas connect√©, le package est soit imm√©diatement supprim√© dans la base de donn√©es du courtier, soit il attend que l'abonn√© se connecte pendant un certain temps sp√©cifi√© dans la configuration. </font><font style="vertical-align: inherit;">Le comportement est d√©termin√© par l'attribut QoS du paquet.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quoi d'autre est important ici.</font></font></h1> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ Les appareils sont les premiers √† √©tablir un contact avec un courtier. C'est-√†-dire les p√©riph√©riques peuvent √™tre situ√©s derri√®re les traducteurs d'adresses r√©seau (NAT) et peuvent ne pas avoir d'adresses IP statiques, ce qui n'interf√®re pas avec la communication. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ SSL peut √™tre utilis√© pour crypter le trafic. Mais vous pouvez travailler sans SSL m√™me avec les services IBM, ce qui facilite le d√©bogage. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ Dans les cas extr√™mement difficiles, les courtiers MQTT vous permettent de vous y connecter via le protocole WebSocket sur le port 80. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ Le port du protocole MQTT standard peut √©galement √™tre modifi√© arbitrairement. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ Le client / les clients avec une interface utilisateur graphique et le courtier peuvent √™tre situ√©s sur le m√™me ordinateur. C'est-√†-dire la solution peut √™tre absolument locale et √©voluer √† l'√©chelle mondiale en un seul clic.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ Diff√©rents courtiers peuvent se connecter les uns aux autres en s'abonnant aux messages les uns des autres. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ Le concept de sujets correspond bien √† la technologie de base de donn√©es NoSQL. </font><font style="vertical-align: inherit;">Dans le m√™me but, les services cloud encouragent les utilisateurs √† utiliser le codage de donn√©es JSON.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projets ouverts</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le choix des courtiers MQTT est assez large. Mais curieusement, il n'y a pratiquement pas de clients pratiques avec une interface utilisateur Windows sous Windows. Et un tel client pour ma√Ætriser le protocole MQTT est tout simplement n√©cessaire car il existe de nombreuses nuances pratiques du travail des courtiers au-del√† des sp√©cifications et toutes doivent √™tre √©tudi√©es et test√©es d'une mani√®re ou d'une autre. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a √©t√© d√©cid√© d'impl√©menter le client MQTT sur Delphi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Google pour Delphi ne peut proposer que le composant TMQTTClient. Mais c'est un composant ancien et qui ne fonctionne pas. La plupart des autres clients √©crits en Java, Erlang, Haskell, Javscript en Delphi sont tr√®s difficiles √† int√©grer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trouv√© le seul projet appropri√© - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√âcrit en pur C-i. </font><font style="vertical-align: inherit;">Il compile pour diff√©rents syst√®mes d'exploitation. </font><font style="vertical-align: inherit;">Il a des scripts de g√©n√©ration de projet pour Visual Studio. </font><font style="vertical-align: inherit;">√Ä la sortie sous Windows, nous obtenons des fichiers dll avec l'impl√©mentation des fonctionnalit√©s client et courtier. </font><font style="vertical-align: inherit;">L'utilisation de C est encourageante en termes de vitesse. </font><font style="vertical-align: inherit;">Et les biblioth√®ques dynamiques √©crites en C se connectent facilement aux programmes Delphi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Delphi lui-m√™me, repr√©sent√© par Embarcadero RAD Studio XE8, est un outil tr√®s puissant pour cr√©er des interfaces utilisateur flexibles et pratiques pour Windows, surtout s'il est √©quip√© de DevExpress, TeeChart, RxLib, FireDAC, etc.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outils n√©cessaires</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous aurons besoin de l'environnement de d√©veloppement </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS Visual Studio 2015</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il compilera le projet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et tous les projets d'appui dont </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©pend </font><font style="vertical-align: inherit;">. Sinon, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut √™tre compil√© √† l'aide du package </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cygwin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mais Visual Studio semblait plus pratique. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour g√©n√©rer des fichiers de projet Visual Studio, vous devez t√©l√©charger et installer l'utilitaire </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cmake</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Source </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmake.org</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Et bien s√ªr, vous avez besoin de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAD Studio XE8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . De plus, dans RAD Studio, la </font><font style="vertical-align: inherit;">version du </font><font style="vertical-align: inherit;">package de composants </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DevExpress VCL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> non inf√©rieure √† </font><b><font style="vertical-align: inherit;">14.2.2</font></b><font style="vertical-align: inherit;"> doit √™tre install√©e</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Bien que cela ne soit pas d'une importance fondamentale, la conception de l'interface utilisateur peut √™tre facilement refaite pour les composants RAD Studio standard.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proc√©dure d'installation du logiciel</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mosquitto d√©pend de plusieurs projets tiers, √† savoir: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenSSL v 1.0.2e</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Source - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://slproweb.com/download/Win32OpenSSL-1_0_2e.exe</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
‚Ä¢ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pthreads v 2.9.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Source - </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp://sourceware.org/pub/pthreads-win32/pthreads-w32-2-9-1-release.zip</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
‚Ä¢ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Libwebsockets v 1.4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Source - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/warmcat/libwebsockets</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
T√©l√©chargez ces projets. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne compilons pas </font><b><font style="vertical-align: inherit;">OpenSSL</font></b><font style="vertical-align: inherit;"> , mais prenons imm√©diatement les deux fichiers n√©cessaires √† partir de l√†: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libeay32.dll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssleay32.dll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du r√©pertoire </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il arrive souvent qu'ils soient d√©j√† install√©s sur l'ordinateur √† partir d'autres projets. Cela doit √™tre v√©rifi√©. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pthreads</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pas non plus </font><font style="vertical-align: inherit;">compiler et prendre le fichier d√©j√† compil√© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pthreadVC2.dll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† partir du </font><font style="vertical-align: inherit;">r√©pertoire </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dll \ x86</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Libwebsockets</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est livr√© sans fichiers pr√©compil√©s et sans projet pour Visual Studio, mais il a un fichier de configuration </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMakeLists.txt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans ce cas, √† l'aide de l'utilitaire </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cmake</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><b><font style="vertical-align: inherit;">nous</font></b><font style="vertical-align: inherit;"> g√©n√©rons le fichier de projet Visual Studio dans un r√©pertoire s√©par√© (r√©pertoire libwebsockets_VS_proj). Et puis en ouvrant le fichier de projet g√©n√©r√© dans Visual Studio, nous compilons. Nous </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtenons le</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fichier </font><b><font style="vertical-align: inherit;">websockets.dll dont</font></b><font style="vertical-align: inherit;"> nous avons </font><b><font style="vertical-align: inherit;">besoin</font></b><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s toutes les √©tapes pr√©c√©dentes, vous pouvez compiler le projet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ici, vous devez √©galement d'abord g√©n√©rer le fichier de projet Visual Studio (r√©pertoire Mosquitto_VS_proj) √† partir du fichier de configuration </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMakeLists.txt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attach√© </font><font style="vertical-align: inherit;">. Le projet g√©n√©r√© ne fonctionne pas tout √† fait, vous devrez modifier les chemins d'acc√®s √† certains fichiers d'en-t√™te et biblioth√®ques externes, inclure des macros dans le projet et modifier l√©g√®rement les textes source. Par cons√©quent, nous obtenons le fichier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mosquitto.dll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par souci de simplicit√©, tous les fichiers et la structure de r√©pertoires avec les projets mentionn√©s sont contenus dans le fichier archive joint √† l'article. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec la biblioth√®que cliente, la compilation du projet </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous donne le fichier ex√©cutable du courtier MQTT - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mosquitto.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, nous obtenons imm√©diatement √† la fois le client et le courtier MQTT, c'est-√†-dire </font><font style="vertical-align: inherit;">presque tout ce dont vous avez besoin pour organiser un Internet des objets efficace.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©ation d'un projet client MQTT dans Delphi</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour int√©grer la biblioth√®que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mosquitto.dll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans Delphi, </font><b><font style="vertical-align: inherit;">vous</font></b><font style="vertical-align: inherit;"> devez cr√©er un module de d√©clarations de fonctions de biblioth√®que sur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Object Pascal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pour ce faire, la conversion du fichier a √©t√© effectu√© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mosquitto.h</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fichier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOSQUITTO.PAS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le projet client est tr√®s simple, ne comprend que 4 fichiers sources. </font><font style="vertical-align: inherit;">Le client d√©montre la connexion et la d√©connexion, la formation d'un testament ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testament</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), l'envoi de donn√©es avec le package </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLISH au</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> courtier, la r√©ception de donn√©es avec le package </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLISH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> du courtier, l'inscription et la d√©sinscription.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le programme enregistre tous les attributs de connexion, d√©sign√©s par le terme profil dans la table des profils stock√©e sur le disque. </font><font style="vertical-align: inherit;">Les journaux des paquets </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLISH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> re√ßus et envoy√©s sont √©galement enregistr√©s sur le disque s√©par√©ment </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©thode d'utilisation par le client</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ex√©cutez le fichier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMQTTC.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afin d'avoir quelqu'un pour communiquer l'√©quipe de courtier en essai </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run_mosquitto.cmd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le </font><font style="vertical-align: inherit;">r√©pertoire </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto_1_4_5_bin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour plus de commodit√©, le courtier est configur√© pour se connecter sans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ni v√©rification de mot de passe. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Remplissez les champs comme dans la capture d'√©cran. </font></font><br>
<br>
<img width="1000" src="https://habrastorage.org/files/6df/303/805/6df303805cb246feb6acc16236e0277a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le mot de passe et le nom d'utilisateur sont facultatifs. Dans le navigateur, cliquez sur le bouton de validation pour enregistrer les donn√©es dans le tableau. Cliquez ensuite sur le bouton </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connecter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s la connexion, les commandes de publication et d'abonnement deviennent disponibles. Les </font><font style="vertical-align: inherit;">commandes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PING</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> client </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mosquitto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> g√©n√®re automatiquement.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour que le client obtienne quelque chose, vous devez √† nouveau ex√©cuter le programme </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMQTTC.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec un identifiant client diff√©rent et abonner un client pour recevoir des donn√©es d'un autre.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connectez-vous √† IBM Bluemix</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La premi√®re chose √† faire est d'obtenir un compte dans </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bluemix</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Apr√®s avoir re√ßu un compte, nous allons sur notre panneau de contr√¥le sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bluemix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ici, vous devez imm√©diatement passer √† la r√©gion </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sud des √âtats-Unis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Pour ce faire, cliquez sur l'ic√¥ne de compte dans le coin sup√©rieur droit et modifiez la valeur dans le champ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R√©gion</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Il y a trois r√©gions au total, mais </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le sud des √âtats-Unis</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous donne la possibilit√© de d√©couvrir la plupart des services. Ensuite, cr√©ez de l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espace</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . L'√©cran devrait ressembler √† un crinshot ci-dessous. Ici, l'organisation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEMSYS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Space </font></font></b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEMSYS SPACE sont cr√©√©es</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<img width="800" src="https://habrastorage.org/files/e8e/a9d/daf/e8ea9ddaf89c47b299f6766b5012948c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, cliquez sur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CATALOGUE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le menu sup√©rieur. Nous descendons vers le bas et choisissons</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fondation Internet des objets</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<img width="800" src="https://habrastorage.org/files/b34/edd/4d1/b34edd4d15b848cb9a70d5b53a218538.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous ne modifions pas les champs propos√©s par d√©faut et cliquons sur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©er la </font></font></b><br>
<img width="800" src="https://habrastorage.org/files/615/b4f/d12/615b4fd125b44adebeba93ec77725d8e.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fondation Internet des Objets</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - il s'agit d'un service qui inclut le courtier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et l'interface utilisateur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apr√®s avoir cr√©√© dans la fen√™tre qui appara√Æt, cliquez sur le bouton intitul√© </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancer le tableau de bord</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img width="800" src="https://habrastorage.org/files/b9e/00f/6e1/b9e00f6e1f7d4381ab7d95220998f722.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'agit d'un panneau de contr√¥le IoT. Maintenant, nous devons cr√©er des appareils. Cliquez sur </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajouter un appareil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans les bo√Ætes de dialogue qui s'affichent, cr√©ez un type d'appareil ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cr√©er un type d'appareil</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Donnez-lui le nom Type1, ne remplissez pas les champs restants pour plus de simplicit√©. Cliquez sur Suivant -&gt; Suivant -&gt; Cr√©er -&gt; Suivant. Donnez le nom au p√©riph√©rique Device1. Suivant Suivant -&gt; Suivant -&gt; Suivant -&gt; Ajouter. En cons√©quence, nous obtenons la fen√™tre suivante:</font></font><br>
<img width="800" src="https://habrastorage.org/files/ce8/dcc/0b2/ce8dcc0b2a7f41d39f1545be3a0ee014.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voil√†, nous avons ici tous les d√©tails pour connecter notre premier appareil au </font><font style="vertical-align: inherit;">courtier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT </font></font></b><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bluemix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous testerons si notre client peut s'y connecter. Entrez les d√©tails dans la fen√™tre client. </font></font><br>
<img width="1000" src="https://habrastorage.org/files/23e/469/94b/23e46994b94b4621b8aeb93a17fd5c5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme vous pouvez le voir, le client s'est connect√© avec succ√®s √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bluemix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ici, vous devez faire attention au nom d'h√¥te. Cela commence par l' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID d'organisation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> obtenu lors de la cr√©ation de la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fondation Internet des objets</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le champ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID utilisateur</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><font style="vertical-align: inherit;">√©galement composite et est cod√© comme suit: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : &lt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID organisation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt;: &lt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Type de p√©riph√©rique</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt;: &lt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID p√©riph√©rique</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt;. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> champ </font><b><font style="vertical-align: inherit;">Nom d'utilisateur</font></b><font style="vertical-align: inherit;"> contient une cha√Æne fixe</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use-token-auth</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les sujets de message pour le courtier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bluemix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , contrairement au courtier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne peuvent pas contenir de donn√©es arbitraires. </font><font style="vertical-align: inherit;">Ils sont cod√©s selon certaines r√®gles. </font><font style="vertical-align: inherit;">Ces r√®gles doivent √™tre √©tudi√©es dans la documentation de la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fondation Internet des Objets</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La capture d'√©cran montre l'un des sujets valides possibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
R√©f√©rentiel de projets: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/Indemsys/Delphi_MQTT_mosquitto</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr388231/">https://habr.com/ru/post/fr388231/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr388221/index.html">Seagate: Winchesters restera avec nous pendant encore 20 ans</a></li>
<li><a href="../fr388223/index.html">M√©moires d'un robot subhumain, chapitres 1-2, deuxi√®me tentative</a></li>
<li><a href="../fr388225/index.html">Qu'est-ce que la cristallographie √©volutive et pourquoi l'avenir est-il derri√®re elle? √Ä peu pr√®s compliqu√©</a></li>
<li><a href="../fr388227/index.html">Recherche infographique: e-shop du Nouvel An en ligne</a></li>
<li><a href="../fr388229/index.html">Utilisation d'iRidium pour contr√¥ler les syst√®mes d'automatisation bas√©s sur le protocole Z-Wave</a></li>
<li><a href="../fr388233/index.html">Voyage √† travers la Russie micro√©lectronique (partie acad√©mique)</a></li>
<li><a href="../fr388235/index.html">Volkswagen a propos√© des mesures correctives pour les moteurs diesel prises par des responsables europ√©ens</a></li>
<li><a href="../fr388237/index.html">La police britannique a mis en place un ¬´gang de karaok√©¬ª de trois amateurs de karaok√© √¢g√©s</a></li>
<li><a href="../fr388241/index.html">Pourquoi les entreprises proc√®dent-elles √† des introductions en bourse: avantages et inconv√©nients</a></li>
<li><a href="../fr388243/index.html">Surveillance √† domicile et visualisation √† distance sur Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>