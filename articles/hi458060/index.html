<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯМ╕ ЁЯРЖ ЁЯдЫЁЯП┐ рдпреВрдирд┐рдЯреА рдЗрдВрдЬрди рдореЗрдВ рдЧреНрд░рд╛рд╕ рд╢реИрдбрд░ рдмрдирд╛рдирд╛ ЁЯЦ▓я╕П ЁЯТ│ ЁЯЫА</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдпрд╣ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдЖрдкрдХреЛ рджрд┐рдЦрд╛рдПрдЧрд╛ рдХрд┐ рдЖрдиреЗ рд╡рд╛рд▓реА рдЬрд╛рд▓реА рдХреЗ рд╢реАрд░реНрд╖ рд╕реЗ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЬреНрдпрд╛рдорд┐рддреАрдп рд╢реЗрдбрд░ рдХреИрд╕реЗ рд▓рд┐рдЦрдирд╛ рд╣реИ рдФрд░ рдШрд╛рд╕ рдХреЗ рдШрдирддреНрд╡ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдпреВрдирд┐рдЯреА рдЗрдВрдЬрди рдореЗрдВ рдЧреНрд░рд╛рд╕ рд╢реИрдбрд░ рдмрдирд╛рдирд╛</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458060/"><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  рдпрд╣ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдЖрдкрдХреЛ рджрд┐рдЦрд╛рдПрдЧрд╛ рдХрд┐ рдЖрдиреЗ рд╡рд╛рд▓реА рдЬрд╛рд▓реА рдХреЗ рд╢реАрд░реНрд╖ рд╕реЗ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЬреНрдпрд╛рдорд┐рддреАрдп рд╢реЗрдбрд░ рдХреИрд╕реЗ рд▓рд┐рдЦрдирд╛ рд╣реИ рдФрд░ рдШрд╛рд╕ рдХреЗ рдШрдирддреНрд╡ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреЗрд╕реЗрд▓реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред <br><br>  рд▓реЗрдЦ рдореЗрдВ рдПрдХрддрд╛ рдореЗрдВ рдШрд╛рд╕ рдХрд╛рдЯрдиреЗ рдХреА рдорд╢реАрди рд▓рд┐рдЦрдиреЗ рдХреА рдЪрд░рдг-рджрд░-рдЪрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рд╡рд░реНрдгрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╢реЗрдбрд░ рдЖрд╡рдХ рдЬрд╛рд▓ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдореЗрд╖ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рд╕реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреНрдпрд╛рдорд┐рддреАрдп shader</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдШрд╛рд╕ рдХрд╛ рдПрдХ рдмреНрд▓реЗрдб рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред  рдмреНрдпрд╛рдЬ рдФрд░ рдпрдерд╛рд░реНрдерд╡рд╛рдж рдХреЗ рд▓рд┐рдП, рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдбреЛрдВ рдореЗрдВ рдПрдХ <strong>рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЖрдХрд╛рд░</strong> рдФрд░ <strong>рд░реЛрдЯреЗрд╢рди рд╣реЛрдЧрд╛</strong> , рдФрд░ рд╡реЗ <strong>рд╣рд╡рд╛</strong> рд╕реЗ рднреА рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реЛрдВрдЧреЗред  рдШрд╛рд╕ рдХреЗ рдШрдирддреНрд╡ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЬрд╛рд▓ рдХреЛ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреЗрд╕реЗрд▓реЗрд╢рди</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдШрд╛рд╕ рдЫрд╛рдпрд╛ <strong>рдбрд╛рд▓рдиреЗ</strong> рдФрд░ <strong>рдкреНрд░рд╛рдкреНрдд</strong> рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧреАред <br><br>  <strong>рддреИрдпрд╛рд░ рдкрд░рд┐рдпреЛрдЬрдирд╛</strong> рд▓реЗрдЦ рдХреЗ рдЕрдВрдд рдореЗрдВ рдкреЛрд╕реНрдЯ рдХреА рдЧрдИ рд╣реИред  рдЙрддреНрдкрдиреНрди shader рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдВ рд╣реИрдВ рдЬреЛ рд╕рдордЭ рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рддреА рд╣реИрдВред <br><a name="habracut"></a><br><h3>  рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ </h3><br>  рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдпреВрдирд┐рдЯреА рдЗрдВрдЬрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЬреНрдЮрд╛рди рдФрд░ рд╕рд┐рдВрдЯреИрдХреНрд╕ рдХреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕рдордЭ рдФрд░ рд╢реЗрдбрд░реНрд╕ рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред <br><br>  <a href="">рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдкреНрд░рд╛рд░реВрдк (.zip) рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ</a> ред <br><br><h2>  рдХрд╛рдо рдкрд░ рд▓рдЧрдирд╛ </h2><br>  рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдкреНрд░рд╛рд░реВрдк рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдПрдХрддрд╛ рд╕рдВрдкрд╛рджрдХ рдореЗрдВ рдЦреЛрд▓реЗрдВред  <code>Main</code> рджреГрд╢реНрдп рдЦреЛрд▓реЗрдВ, рдФрд░ рдлрд┐рд░ рдЕрдкрдиреЗ рдХреЛрдб рд╕рдВрдкрд╛рджрдХ рдореЗрдВ <code>Grass</code> рд╢реЗрдбрд░ рдЦреЛрд▓реЗрдВред <br><br>  рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рд╢реЗрдбрд░ рд╣реИ рдЬреЛ рд╕рдлреЗрдж рд░рдВрдЧ рдХрд╛ рдЙрддреНрдкрд╛рджрди рдХрд░рддрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рдХреБрдЫ рдлрд╝рдВрдХреНрд╢рди рдЬреЛ рд╣рдо рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдЗрди рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рд╢реАрд░реНрд╖ shader рдХреЛ <code>CGINCLUDE</code> <em>рдмрд╛рд╣рд░</em> рд╕реНрдерд┐рдд <code>CGINCLUDE</code> рдмреНрд▓реЙрдХ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЗрд╕ рдмреНрд▓реЙрдХ рдореЗрдВ рд░рдЦрд╛ рдХреЛрдб <strong>рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕рднреА рдкрд╛рд╕реЛрдВ</strong> рдореЗрдВ <strong>рд╢рд╛рдорд┐рд▓</strong> рд╣реЛ рдЬрд╛рдПрдЧрд╛;  рдпрд╣ рдмрд╛рдж рдореЗрдВ рдХрд╛рдо рдЖрдПрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░реЗ рд╢реЗрдбрд░ рдореЗрдВ рдХрдИ рдкрд╛рд╕ рд╣реЛрдВрдЧреЗред <br><br>  рд╣рдо рдПрдХ <strong>рдЬреНрдпрд╛рдорд┐рддреАрдп shader</strong> рд▓рд┐рдЦрдХрд░ рд╢реБрд░реВ рдХрд░реЗрдВрдЧреЗ рдЬреЛ рд╣рдорд╛рд░реЗ рдЬрд╛рд▓ рдХреА рд╕рддрд╣ рдкрд░ рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рд╕реЗ рддреНрд░рд┐рдХреЛрдг рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред <br><br><h2>  1. рдЬрд┐рдпреЛрдореЗрдЯреНрд░рд┐рдХ рд╢реЗрдбреНрд╕ </h2><br>  рдЬреНрдпрд╛рдорд┐рддреАрдп рд╢реЗрдбреНрд╕ рд░реЗрдВрдбрд░рд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХрд╛ рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИрдВред  рд╡реЗ рд╢реАрд░реНрд╖ рд╢реАрд░реНрд╖ рдХреЗ <strong>рдмрд╛рдж</strong> рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ (рдпрд╛ рдЯреЗрд╕рд▓реЗрд╢рди рд╢реЗрдбрд░ рдЕрдЧрд░ рдЯреЗрд╕рд▓реЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рдФрд░ рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдЦрдВрдбреЛрдВ рдХреЛ рдЯреБрдХрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef7/c01/458/ef7c01458cadf7cd0cf46695d7114f96.jpg"></div><br>  <i>Direct3D рдЧреНрд░рд╛рдлрд╝рд┐рдХреНрд╕ рдкрд╛рдЗрдкрд▓рд╛рдЗрди 11ред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕ рдЖрд░реЗрдЦ рдореЗрдВ рдЯреБрдХрдбрд╝рд╛ shader рдХреЛ <em>рдкрд┐рдХреНрд╕реЗрд▓ shader</em> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред</i> <br><br>  рдЬреНрдпрд╛рдорд┐рддреАрдп рд╢реЗрдбреНрд╕ рдЗрдирдкреБрдЯ рдкрд░ рдПрдХ рдПрдХрд▓ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрджрд┐рдо</a> рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╢реВрдиреНрдп, рдПрдХ рдпрд╛ рдХрдИ рдкреНрд░рд╛рдЗрдореЗрдЯрд┐рд╡ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдо рдПрдХ рдЬреНрдпрд╛рдорд┐рддреАрдп shader рд▓рд┐рдЦрдХрд░ рд╢реБрд░реВ рдХрд░реЗрдВрдЧреЗ рдЬреЛ рдЗрдирдкреБрдЯ рдкрд░ рдПрдХ <strong>рд╢реАрд░реНрд╖</strong> (рдпрд╛ <em>рдмрд┐рдВрджреБ</em> ) рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЬреЛ <strong>рдПрдХ рддреНрд░рд┐рдХреЛрдг</strong> рдХреЛ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add inside the CGINCLUDE block. struct geometryOutput { float4 pos : SV_POSITION; }; [maxvertexcount(3)] void geo(triangle float4 IN[3] : SV_POSITION, inout TriangleStream&lt;geometryOutput&gt; triStream) { } тАж // Add inside the SubShader Pass, just below the #pragma fragment frag line. #pragma geometry geo</span></span></code> </pre> <br>  рдКрдкрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдХреЛрдб рджреЛ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде <code>geo</code> рдирд╛рдордХ рдПрдХ рдЬреНрдпрд╛рдорд┐рддреАрдп рд╢реЗрдбрд░ рдШреЛрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдкрд╣рд▓рд╛, <code>triangle float4 IN[3]</code> , рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ рддреНрд░рд┐рднреБрдЬ (рддреАрди рдмрд┐рдВрджреБрдУрдВ рд╕реЗ рдпреБрдХреНрдд) рдХреЛ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЗрдЧрд╛ред  <code>TriangleStream</code> рдЬреИрд╕реА рджреВрд╕рд░реА, рддреНрд░рд┐рдХреЛрдг рдХреА рдПрдХ рдзрд╛рд░рд╛ рдХреЛ рдЖрдЙрдЯрдкреБрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╢реИрдбрд░ рд╕реЗрдЯ рдХрд░рддреА рд╣реИ рддрд╛рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдЕрдкрдиреЗ рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрдЪрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>geometryOutput</code> рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗред <br><br><div class="spoiler">  <b class="spoiler_title">рд╣рдордиреЗ рдКрдкрд░ рдХрд╣рд╛ рд╣реИ рдХрд┐ рд╢реЗрдбрд░ рдХреЛ рдПрдХ рд╢реАрд░реНрд╖ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛ рдФрд░ рдШрд╛рд╕ рдХреЗ рдПрдХ рдмреНрд▓реЗрдб рдХрд╛ рдЙрддреНрдкрд╛рджрди рдХрд░реЗрдЧрд╛ред</b>  <b class="spoiler_title">рдлрд┐рд░ рд╣рдореЗрдВ рдПрдХ рддреНрд░рд┐рдХреЛрдг рдХреНрдпреЛрдВ рдорд┐рд▓рддрд╛ рд╣реИ?</b> <div class="spoiler_text">  рдПрдХ <code></code> рдХреЛ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЗрдирд╛ рдХрдо рдЦрд░реНрдЪреАрд▓рд╛ рд╣реЛрдЧрд╛ред  рдЗрд╕реЗ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">geo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(point vertexOutput IN[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">], inout TriangleStream&lt;geometryOutput&gt; triStream)</span></span></span></span></code> </pre> <br>  рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╣рдорд╛рд░реЗ рдЗрдирдХрдорд┐рдВрдЧ рдореЗрд╢ (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ <code>GrassPlane10x10</code> , <code>Mesh</code> рдлреЛрд▓реНрдбрд░ рдореЗрдВ рд╕реНрдерд┐рдд) рдореЗрдВ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рддреНрд░рд┐рдХреЛрдг рдЯреЛрдкреЛрд▓реЙрдЬреА рд╣реИ</a> , рдЗрд╕рд╕реЗ рдЗрдирдХрдорд┐рдВрдЧ рдореЗрд╢ рдЯреЛрдкреЛрд▓реЙрдЬреА рдФрд░ рдЖрд╡рд╢реНрдпрдХ рдЗрдирдкреБрдЯ <code>GrassPlane10x10</code> рдмреАрдЪ рдПрдХ рдмреЗрдореЗрд▓ рд╕рдВрдмрдВрдз рд╣реЛрдЧрд╛ред  рд╣рд╛рд▓рд╛рдБрдХрд┐ DirectX HLSL рдореЗрдВ рдЗрд╕рдХреА <strong>рдЕрдиреБрдорддрд┐</strong> рд╣реИ, рд▓реЗрдХрд┐рди <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">OpenGL рдореЗрдВ</a> рдЗрд╕рдХреА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдиреБрдорддрд┐</a> рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ рддреНрд░реБрдЯрд┐ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХреА рдЬрд╛рдПрдЧреАред </div></div><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдо рдлрд╝рдВрдХреНрд╢рди рдШреЛрд╖рдгрд╛ рдХреЗ рдКрдкрд░ рд╡рд░реНрдЧ рдХреЛрд╖реНрдардХ рдореЗрдВ рдЕрдВрддрд┐рдо рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ: <code>[maxvertexcount(3)]</code> ред  рд╡рд╣ GPU рдХреЛ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдЖрдЙрдЯрдкреБрдЯ рдХрд░реЗрдВрдЧреЗ (рд▓реЗрдХрд┐рди рдХрд░рдиреЗ рдХреА <strong>рдЖрд╡рд╢реНрдпрдХрддрд╛</strong> рдирд╣реАрдВ рд╣реИ) 3 <em>рд╕реЗ рдЕрдзрд┐рдХ</em> рдХреЛрдиреЗ рдирд╣реАрдВ рд╣реИрдВред  рд╣рдо <code>SubShader</code> рдХреЛ <code>Pass</code> рдЕрдВрджрд░ рдШреЛрд╖рд┐рдд рдХрд░рдХреЗ рдПрдХ рдЬреНрдпрд╛рдорд┐рддреАрдп рд╢реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред <br><br>  рд╣рдорд╛рд░реЗ рдЬреНрдпрд╛рдорд┐рддреАрдп shader рдЕрднреА рддрдХ рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░ рд░рд╣реЗ рд╣реИрдВ;  рддреНрд░рд┐рдХреЛрдг рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЬреНрдпрд╛рдорд┐рддреАрдп рдЫрд╛рдпрд╛ рдХреЗ рдЕрдВрджрд░ рдирд┐рдореНрди рдХреЛрдб рдЬреЛрдбрд╝реЗрдВред <br><br><pre> <code class="cpp hljs">geometryOutput o; o.pos = float4(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); triStream.Append(o); o.pos = float4(<span class="hljs-number"><span class="hljs-number">-0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); triStream.Append(o); o.pos = float4(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); triStream.Append(o);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0db/534/ac1/0db534ac10c125955829fd53b9923cd7.gif"></div><br>  рдЗрд╕рдиреЗ рдмрд╣реБрдд рд╣реА рдЕрдЬреАрдм рдкрд░рд┐рдгрд╛рдо рджрд┐рдПред  рдЬрдм рдЖрдк рдХреИрдорд░реЗ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ <strong>рд╕реНрдХреНрд░реАрди рд╕реНрдкреЗрд╕</strong> рдореЗрдВ рддреНрд░рд┐рдХреЛрдг рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ <strong>рд╣реИ</strong> ред  рдпрд╣ рддрд╛рд░реНрдХрд┐рдХ рд╣реИ: рдЪреВрдВрдХрд┐ рдЬреНрдпрд╛рдорд┐рддреАрдп рд╢реЗрдбрд░ рдХреЛ рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рд╕реЗ рддреБрд░рдВрдд рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣ рд╡рд░реНрдЯреАрдХрд▓ рд╢реЗрдбрд░ рд╕реЗ рджреВрд░ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ, <strong>рдХреНрдпреЛрдВрдХрд┐ рдЯреНрд░рд┐рдВрдХреЗрдЯ рд╕реНрдкреЗрд╕</strong> рдореЗрдВ рдХреЛрдиреЗ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреА рдЬрд┐рдореНрдореЗрджрд╛рд░реА <strong>рд╣реИ</strong> ред  рд╣рдо рдЗрд╕реЗ рджрд░реНрд╢рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ рдХреЛрдб рдмрджрд▓реЗрдВрдЧреЗред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Update the return call in the vertex shader. //return UnityObjectToClipPos(vertex); return vertex; тАж // Update each assignment of o.pos in the geometry shader. o.pos = UnityObjectToClipPos(float4(0.5, 0, 0, 1)); тАж o.pos = UnityObjectToClipPos(float4(-0.5, 0, 0, 1)); тАж o.pos = UnityObjectToClipPos(float4(0, 1, 0, 1));</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/221/912/b3e/221912b3e6bc0581126a0f415b6e79c5.png"></div><br>  рдЕрдм рд╣рдорд╛рд░рд╛ рддреНрд░рд┐рдХреЛрдг рджреБрдирд┐рдпрд╛ рдореЗрдВ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдХреЗрд╡рд▓ рдПрдХ рд╣реА рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдорд╛рд░реЗ рдЬрд╛рд▓ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдХреЗ рд▓рд┐рдП рдПрдХ рддреНрд░рд┐рднреБрдЬ <em>рдЦреАрдВрдЪрд╛</em> рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рддреНрд░рд┐рднреБрдЬ рдХреЗ рд╢реАрд░реНрд╖реЛрдВ рдХреЛ рджрд┐рдП рдЧрдП рдкрдж <strong>рд╕реНрдерд┐рд░</strong> рд╣реЛрддреЗ рд╣реИрдВ - рд╡реЗ рдкреНрд░рддреНрдпреЗрдХ рдЖрдиреЗ рд╡рд╛рд▓реЗ рд╢реАрд░реНрд╖ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдмрджрд▓рддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рд╕рднреА рддреНрд░рд┐рдХреЛрдг рдПрдХ рдХреЗ рдКрдкрд░ рдПрдХ рд╕реНрдерд┐рдд рд╣реЛрддреЗ рд╣реИрдВред <br><br>  рд╣рдо рдЗрд╕реЗ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдмрд┐рдВрджреБ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдЖрдЙрдЯрдЧреЛрдЗрдВрдЧ рд╡рд░реНрдЯреЗрдХреНрд╕ рдкреЛрдЬреАрд╢рди <strong>рдСрдлрд╝рд╕реЗрдЯ</strong> рдмрдирд╛рдХрд░ рдареАрдХ рдХрд░реЗрдВрдЧреЗред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the top of the geometry shader. float3 pos = IN[0]; тАж // Update each assignment of o.pos. o.pos = UnityObjectToClipPos(pos + float3(0.5, 0, 0)); тАж o.pos = UnityObjectToClipPos(pos + float3(-0.5, 0, 0)); тАж o.pos = UnityObjectToClipPos(pos + float3(0, 1, 0));</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6b2/ac4/84c/6b2ac484c5a033b18e88400e10191779.png"></div><br><div class="spoiler">  <b class="spoiler_title">рдХреБрдЫ рдХреЛрдиреЗ рддреНрд░рд┐рдХреЛрдг рдХреНрдпреЛрдВ рдирд╣реАрдВ рдмрдирд╛рддреЗ рд╣реИрдВ?</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cab/447/d9c/cab447d9c4c82d8208a28e7cee2f7807.png"></div><br>  рдпрджреНрдпрдкрд┐ рд╣рдордиреЗ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рд╣реИ рдХрд┐ рдЖрдиреЗ рд╡рд╛рд▓реА рдЖрджрд┐рдо рдПрдХ <strong>рддреНрд░рд┐рдХреЛрдг</strong> рд╣реЛрдЧреА, <strong>рддреНрд░рд┐рдХреЛрдг</strong> рдХреЗ рдПрдХ рдмрд┐рдВрджреБ рд╕реЗ рдХреЗрд╡рд▓ рдШрд╛рд╕ рдХрд╛ рдПрдХ рдмреНрд▓реЗрдб рдкреНрд░реЗрд╖рд┐рдд рд╣реЛрддрд╛ рд╣реИ, рдЕрдиреНрдп рджреЛ рдХреЛ рддреНрдпрд╛рдЧ рджреЗрддрд╛ рд╣реИред  рдмреЗрд╢рдХ, рд╣рдо рдЖрдиреЗ рд╡рд╛рд▓реЗ рддреАрди рдмрд┐рдВрджреБрдУрдВ рд╕реЗ рдШрд╛рд╕ рдХреЗ рдПрдХ рдмреНрд▓реЗрдб рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдЗрд╕ рддрдереНрдп рдХреЛ рдЬрдиреНрдо рджреЗрдЧрд╛ рдХрд┐ рдкрдбрд╝реЛрд╕реА рддреНрд░рд┐рдХреЛрдг рдПрдХ рджреВрд╕рд░реЗ рдХреЗ рдКрдкрд░ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЛ рдЕрддреНрдпрдзрд┐рдХ рдмрдирд╛рддреЗ рд╣реИрдВред <br><br>  рдпрд╛ рдЖрдк рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдЬреНрдпреЛрдореЗрдЯреНрд░рд┐рдХ рд╢реЗрдбрд░ рдХреЗ рдЗрдирдХрдорд┐рдВрдЧ рдореЗрд╢ рдХреЗ рд░реВрдк рдореЗрдВ рдЯреЛрдкреЛрд▓реЙрдЬреА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреЙрдЗрдВрдЯреНрд╕</a> рдХреЗ рдкреНрд░рдХрд╛рд░ рд╣реЛрдиреЗ рд╕реЗ рд╣рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </div></div><br>  рддреНрд░рд┐рдХреЛрдг рдЕрдм рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдЦреАрдВрдЪреЗ рдЧрдП рд╣реИрдВ, рдФрд░ рдЙрдирдХрд╛ рдЖрдзрд╛рд░ рдЙрдиреНрд╣реЗрдВ рдЙрддреНрд╕рд░реНрдЬрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╢рд┐рдЦрд░ рдкрд░ рд╕реНрдерд┐рдд рд╣реИред  рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, <code>GrassPlane</code> рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рджреГрд╢реНрдп рдореЗрдВ <strong>рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░реЗрдВ</strong> , рдФрд░ <code>GrassBall</code> рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ <strong>рд╕рдХреНрд░рд┐рдп рдХрд░реЗрдВ</strong> ред  рд╣рдо рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдШрд╛рд╕ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреА рд╕рддрд╣реЛрдВ рдкрд░ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛ, рдЗрд╕рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдЖрдХрд╛рд░реЛрдВ рдХреЗ рдореЗрд╢ рдкрд░ рдЗрд╕рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/19b/f67/8fb/19bf678fbb6ce3c03956dbdf068004f0.png"></div><br>  рдЕрдм рддрдХ, рд╕рднреА рддреНрд░рд┐рдХреЛрдг рдПрдХ рджрд┐рд╢рд╛ рдореЗрдВ рдЙрддреНрд╕рд░реНрдЬрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдЧреЛрд▓реЗ рдХреА рд╕рддрд╣ рд╕реЗ рдмрд╛рд╣рд░ рдХреА рдУрд░ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред  рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ <strong>рд╕реНрдкрд░реНрд╢ рд╕реНрдерд╛рди</strong> рдореЗрдВ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдмрдирд╛рдПрдВрдЧреЗред <br><br><h2>  2. рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╕реНрдерд╛рди </h2><br>  рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рд╣рдо рдПрдХ рдЕрд▓рдЧ рдЪреМрдбрд╝рд╛рдИ, рдКрдВрдЪрд╛рдИ, рд╡рдХреНрд░рддрд╛ рдФрд░ рдШреБрдорд╛рд╡ рд╕реЗрдЯ рдХрд░рдХреЗ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЙрд╕ рд╕рддрд╣ рдХреЗ рдХреЛрдг рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рдирд╣реАрдВ рд░рдЦрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рд╕реЗ рдШрд╛рд╕ рдХрд╛ рдмреНрд▓реЗрдб рдЙрддреНрд╕рд░реНрдЬрд┐рдд рд╣реЛрддрд╛ рд╣реИред  рд╕реАрдзреЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рд╣рдо рдПрдХ рд╕реНрдерд╛рди рдкрд░ рдШрд╛рд╕ рдХреЗ рдПрдХ рдмреНрд▓реЗрдб рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ рд╣реБрдП <strong>рд╕реНрдерд╛рдиреАрдп</strong> рд╕реНрдерд╛рди рдкрд░ <strong>рдЫреЛрдбрд╝рддреЗ рд╣реИрдВ</strong> , рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдпрд╣ <strong>рдЬрд╛рд▓ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдиреАрдп рд╣реЛ</strong> ред  рдЗрд╕ рд╕реНрдерд╛рди рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╕реНрдерд╛рди</a> рдХрд╣рд╛ рдЬрд╛рддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3fd/8f7/c39/3fd8f7c394bf4eb18cb988aceafe342b.png"></div><br>  <i>рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╕реНрдерд╛рди рдореЗрдВ, <strong>X</strong> , <strong>Y</strong> рдФрд░ <strong>Z</strong> рдЕрдХреНрд╖ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдФрд░ рд╕рддрд╣ рдХреА рд╕реНрдерд┐рддрд┐ (рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдХреЛрдиреЗ) рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред</i> <br><br>  рдХрд┐рд╕реА рднреА рдЕрдиреНрдп рд╕реНрдерд╛рди рдХреА рддрд░рд╣, рд╣рдо рддреАрди рд╡реИрдХреНрдЯрд░ рдХреЗ рд╕рд╛рде рдПрдХ рд╢реАрд░реНрд╖ рд╕реНрдерд╛рди рдХреЗ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╕реНрдерд╛рди рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <strong>рд╕рд╣реА</strong> , <strong>рдЖрдЧреЗ</strong> рдФрд░ <strong>рдКрдкрд░</strong> ред  рдЗрди рд╡реИрдХреНрдЯрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдо рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╕реЗ рд╕реНрдерд╛рдиреАрдп рд╕реНрдерд╛рди рддрдХ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЛ рдореЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЖрдк рдирдП рдЗрдирдкреБрдЯ рд╡рд░реНрдЯреЗрдХреНрд╕ рдбреЗрдЯрд╛ рдХреЛ рдЬреЛрдбрд╝рдХрд░ <strong>рд╕рд╣реА</strong> рдФрд░ <strong>рдКрдкрд░</strong> рд╡реИрдХреНрдЯрд░ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the CGINCLUDE block. struct vertexInput { float4 vertex : POSITION; float3 normal : NORMAL; float4 tangent : TANGENT; }; struct vertexOutput { float4 vertex : SV_POSITION; float3 normal : NORMAL; float4 tangent : TANGENT; }; тАж // Modify the vertex shader. vertexOutput vert(vertexInput v) { vertexOutput o; o.vertex = v.vertex; o.normal = v.normal; o.tangent = v.tangent; return o; } тАж // Modify the input for the geometry shader. Note that the SV_POSITION semantic is removed. void geo(triangle vertexOutput IN[3], inout TriangleStream&lt;geometryOutput&gt; triStream) тАж // Modify the existing line declaring pos. float3 pos = IN[0].vertex;</span></span></code> </pre> <br>  рддреАрд╕рд░реЗ рд╡реЗрдХреНрдЯрд░ рдХреА рдЧрдгрдирд╛ рджреЛ рдЕрдиреНрдп рд▓реЛрдЧреЛрдВ рдХреЗ рдмреАрдЪ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡реЗрдХреНрдЯрд░ рдЙрддреНрдкрд╛рдж</a> рдХреЛ рд▓реЗ рдХрд░ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред  рдПрдХ рд╡реЗрдХреНрдЯрд░ рдЙрддреНрдкрд╛рдж рджреЛ рдЖрдиреЗ рд╡рд╛рд▓реЗ рд╡реИрдХреНрдЯрд░ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реЗрдХреНрдЯрд░ <strong>рд▓рдВрдмрд╡рдд</strong> рджреЗрддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Place in the geometry shader, below the line declaring float3 pos. float3 vNormal = IN[0].normal; float4 vTangent = IN[0].tangent; float3 vBinormal = cross(vNormal, vTangent) * vTangent.w;</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">рд╡реЗрдХреНрдЯрд░ рдЙрддреНрдкрд╛рдж рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреЛ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ w рдХреЗ рд╕рдордиреНрд╡рдп рд╕реЗ рдЧреБрдгрд╛ рдХреНрдпреЛрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ?</b> <div class="spoiler_text">  рдЬрдм рдПрдХ 3D рд╕рдВрдкрд╛рджрдХ рд╕реЗ рдПрдХ рдЬрд╛рд▓ рдХрд╛ рдирд┐рд░реНрдпрд╛рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдореЗрдВ рдЖрдорддреМрд░ рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╕рдВрдЧреНрд░рд╣реАрдд рдбреЗрдЯрд╛ рдореЗрдВ рджреНрд╡рд┐рдиреЗрддреНрд░ (рдЬрд┐рд╕реЗ <em>рджреЛ рдмрд┐рдВрджреБрдУрдВ рдкрд░ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛</em> рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ) рд╣реЛрддрд╛ рд╣реИред  рдЗрди рджреНрд╡рд┐рдкрд╛рджреЛрдВ рдХреЛ рдЖрдпрд╛рдд рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдПрдХрддрд╛ рдмрд╕ рдкреНрд░рддреНрдпреЗрдХ рджреНрд╡рд┐рдкрдж рдХреА рджрд┐рд╢рд╛ рд▓реЗрддреА рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ <strong>w</strong> рдХреЗ рд╕рдордиреНрд╡рдп рдХреЗ рд▓рд┐рдП рдирд┐рдпрдд рдХрд░рддреА рд╣реИред  рдпрд╣ рдЖрдкрдХреЛ рд╕реНрдореГрддрд┐ рдХреЛ рдмрдЪрд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрдмрдХрд┐ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рд╕рд╣реА рджреНрд╡рд┐рдкрдж рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рдЗрд╕ рд╡рд┐рд╖рдп рдХреА рд╡рд┐рд╕реНрддреГрдд рдЪрд░реНрдЪрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ</a> рдорд┐рд▓ рд╕рдХрддреА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ред </div></div><br>  рддреАрдиреЛрдВ рд╡реИрдХреНрдЯрд░ рд╣реЛрдиреЗ рд╕реЗ, рд╣рдо рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рдФрд░ рд╕реНрдерд╛рдиреАрдп рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдХреЗ рдмреАрдЪ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рд▓рд┐рдП рдПрдХ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдо рдЗрд╕ рдореИрдЯреНрд░рд┐рдХреНрд╕ рджреНрд╡рд╛рд░рд╛ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдХреЛ <code>UnityObjectToClipPos</code> рд╕реЗ рдЧреБрдЬрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЧреБрдгрд╛ рдХрд░реЗрдВрдЧреЗ, рдЬреЛ рд╕реНрдерд╛рдиреАрдп рд╕реНрдерд╛рди рдореЗрдВ рдПрдХ рд╢реАрд░реНрд╖ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the lines declaring the three vectors. float3x3 tangentToLocal = float3x3( vTangent.x, vBinormal.x, vNormal.x, vTangent.y, vBinormal.y, vNormal.y, vTangent.z, vBinormal.z, vNormal.z );</span></span></code> </pre> <br>  рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рд╡рд░реНрдЯреЗрдХреНрд╕ рдЖрдЙрдЯрдкреБрдЯ рдХреЛрдб рдХреЛ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдЯреНрд░рд╛рдВрд╕рдлрд░ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдХреЛрдб рдХреА рд╕рдорд╛рди рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдмрд╛рд░-рдмрд╛рд░ рди рд▓рд┐рдЦрд╛ рдЬрд╛рдПред  рдЗрд╕реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">DRY рд╕рд┐рджреНрдзрд╛рдВрдд</a> рдХрд╣рд╛ рдЬрд╛рддрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> , рдпрд╛ <strong>рдЦреБрдж рдХреЛ рджреЛрд╣рд░рд╛рдПрдВ рдирд╣реАрдВ</strong> ред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the CGINCLUDE block. geometryOutput VertexOutput(float3 pos) { geometryOutput o; o.pos = UnityObjectToClipPos(pos); return o; } тАж // Remove the following from the geometry shader. //geometryOutput o; //o.pos = UnityObjectToClipPos(pos + float3(0.5, 0, 0)); //triStream.Append(o); //o.pos = UnityObjectToClipPos(pos + float3(-0.5, 0, 0)); //triStream.Append(o); //o.pos = UnityObjectToClipPos(pos + float3(0, 1, 0)); //triStream.Append(o); // ...and replace it with the code below. triStream.Append(VertexOutput(pos + float3(0.5, 0, 0))); triStream.Append(VertexOutput(pos + float3(-0.5, 0, 0))); triStream.Append(VertexOutput(pos + float3(0, 1, 0)));</span></span></code> </pre> <br>  рдЕрдВрдд рдореЗрдВ, рд╣рдо <code>tangentToLocal</code> рдореИрдЯреНрд░рд┐рдХреНрд╕ рджреНрд╡рд╛рд░рд╛ рдЖрдЙрдЯрдкреБрдЯ рдХреЛрдиреЗ рдХреЛ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЙрдиреНрд╣реЗрдВ рдЙрдирдХреЗ рдЗрдирдкреБрдЯ рдмрд┐рдВрджреБ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рдХреЗ рд╕рд╛рде рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs">triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)))); triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(<span class="hljs-number"><span class="hljs-number">-0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)))); triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>))));</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c95/3f8/286/c953f828675a9d4e202c0c9349d37f9d.png" alt="рдЫрд╡рд┐"></div><br>  рдпрд╣ рдЕрдзрд┐рдХ рд╣реИ рдЬреЛ рд╣рдореЗрдВ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдмрд┐рд▓реНрдХреБрд▓ рд╕рд╣реА рдирд╣реАрдВ рд╣реИред  рдпрд╣рд╛рдБ рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╢реБрд░реВ рдореЗрдВ рд╣рдордиреЗ <strong>Y</strong> рдЕрдХреНрд╖ рдХреА рджрд┐рд╢рд╛ "рдЕрдк" (рдЕрдк) рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдерд╛;  рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╕реНрдерд╛рди рдореЗрдВ, рдКрдкрд░ рдХреА рджрд┐рд╢рд╛ рдЖрдорддреМрд░ рдкрд░ <strong>Z</strong> рдЕрдХреНрд╖ рдХреЗ рд╕рд╛рде рд╕реНрдерд┐рдд рд╣реЛрддреА рд╣реИред  рдЕрдм рд╣рдо рдпреЗ рдмрджрд▓рд╛рд╡ рдХрд░реЗрдВрдЧреЗред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Modify the position of the third vertex being emitted. triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(0, 0, 1))));</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0cf/f51/ddb/0cff51ddbea12280cb78a1db9ada1786.png"></div><br><h2>  3. рдШрд╛рд╕ рдХрд╛ рджрд┐рдЦрдирд╛ </h2><br>  рддреНрд░рд┐рднреБрдЬреЛрдВ рдХреЛ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреА рддрд░рд╣ рдЕрдзрд┐рдХ рджрд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рд░рдВрдЧреЛрдВ рдФрд░ рд╡рд┐рд╡рд┐рдзрддрд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд╣рдо рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЗ рдКрдкрд░ рд╕реЗ рдиреАрдЪреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдПрдХ <strong>рдврд╛рд▓</strong> рдХреЛ рдЬреЛрдбрд╝рдХрд░ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред <br><br><h3>  3.1 рд░рдВрдЧ рдврд╛рд▓ </h3><br>  рд╣рдорд╛рд░рд╛ рд▓рдХреНрд╖реНрдп рдХрд▓рд╛рдХрд╛рд░ рдХреЛ рджреЛ рд░рдВрдЧ - рд╢реАрд░реНрд╖ рдФрд░ рдиреАрдЪреЗ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рд╣реИ, рдФрд░ рдЗрди рджреЛ рд░рдВрдЧреЛрдВ рдХреЗ рдмреАрдЪ рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рдХрд░рдирд╛ рд╡рд╣ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЯрд┐рдк рдХрд░рддрд╛ рд╣реИред  рдпреЗ рд░рдВрдЧ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА shader рдлрд╝рд╛рдЗрд▓ рдореЗрдВ <code>_TopColor</code> рдФрд░ <code>_BottomColor</code> рд░реВрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВред  рдЙрдирдХреЗ рдЙрдЪрд┐рдд рдирдореВрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ <strong>рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ</strong> рдХреЛ рдЯреБрдХрдбрд╝рд╛ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛ рдкрд╛рд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the geometryOutput struct. float2 uv : TEXCOORD0; тАж // Modify the VertexOutput function signature. geometryOutput VertexOutput(float3 pos, float2 uv) тАж // Add to VertexOutput, just below the line assigning o.pos. o.uv = uv; тАж // Modify the existing lines in the geometry shader. triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(0.5, 0, 0)), float2(0, 0))); triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(-0.5, 0, 0)), float2(1, 0))); triStream.Append(VertexOutput(pos + mul(tangentToLocal, float3(0, 0, 1)), float2(0.5, 1)));</span></span></code> </pre> <br>  рд╣рдордиреЗ рдПрдХ рддреНрд░рд┐рднреБрдЬ рдХреЗ рдЖрдХрд╛рд░ рдореЗрдВ рдШрд╛рд╕ рдХреЗ рдПрдХ рдмреНрд▓реЗрдб рдХреЗ рд▓рд┐рдП рдпреВрд╡реА-рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдмрдирд╛рдпрд╛, рдЬрд┐рд╕рдХреЗ рдЖрдзрд╛рд░ рдХреЗ рджреЛ рдХреЛрдиреЗ рдирд┐рдЪрд▓реЗ рдмрд╛рдПрдБ рдФрд░ рджрд╛рдПрдБ рдкрд░ рд╕реНрдерд┐рдд рд╣реИрдВ, рдФрд░ рд╢реАрд░реНрд╖ рдкрд░ рдХреЗрдВрджреНрд░ рдореЗрдВ рдЯрд┐рдк рд╢реАрд░реНрд╖ рд╕реНрдерд┐рдд рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/165/e39/932/165e399323aaa07e7c4cee728c0c9988.png"></div><br>  <i>рдпреВрд╡реА рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЗ рддреАрди рдХреЛрдиреЗ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХред</i>  <i>рдпрджреНрдпрдкрд┐ рд╣рдо рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдврд╛рд▓ рдХреЗ рд╕рд╛рде рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЛ рдЪрд┐рддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдмрдирд╛рд╡рдЯ рдХреА рдПрдХ рд╕рдорд╛рди рд╡реНрдпрд╡рд╕реНрдерд╛ рдЖрдкрдХреЛ рдмрдирд╛рд╡рдЯ рдХреЛ рдУрд╡рд░рд▓реЗ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред</i> <br><br>  рдЕрдм рд╣рдо рдпреВрд╡реА рдХреЗ рд╕рд╛рде рдЯреБрдХрдбрд╝реЗ <code>lerp</code> рдореЗрдВ рдКрдкрд░ рдФрд░ рдиреАрдЪреЗ рдХреЗ рд░рдВрдЧреЛрдВ рдХрд╛ рдирдореВрдирд╛ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ <code>lerp</code> рд╕рд╛рде рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рдХрд░ <code>lerp</code> ред  рд╣рдо рднреА рдЯреБрдХрдбрд╝рд╛ shader рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ <code>geometryOutput</code> рдмрдирд╛ рд░рд╣реА <code>geometryOutput</code> , рдФрд░ рди рдХреЗрд╡рд▓ <code>float4</code> рдХреА рд╕реНрдерд┐рддрд┐ред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Modify the function signature of the fragment shader. float4 frag (geometryOutput i, fixed facing : VFACE) : SV_Target тАж // Replace the existing return call. return float4(1, 1, 1, 1); return lerp(_BottomColor, _TopColor, i.uv.y);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/596/510/51f/59651051f474907a88740e83bc9d4532.png"></div><br><h3>  3.2 рд░реИрдВрдбрдо рдмреНрд▓реЗрдб рджрд┐рд╢рд╛ </h3><br>  рдкрд░рд┐рд╡рд░реНрддрдирд╢реАрд▓рддрд╛ рдмрдирд╛рдиреЗ рдФрд░ рдШрд╛рд╕ рдХреЛ рдФрд░ рдЕрдзрд┐рдХ рдкреНрд░рд╛рдХреГрддрд┐рдХ рд░реВрдк рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдШрд╛рд╕ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдмреНрд▓реЗрдб рдХреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рджрд┐рд╢рд╛ рдореЗрдВ рдмрдирд╛рдПрдВрдЧреЗред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рд░реЛрдЯреЗрд╢рди рдореИрдЯреНрд░рд┐рдХреНрд╕ рдмрдирд╛рдиреЗ рдХреА рдЬрд╝рд░реВрд░рдд рд╣реИ рдЬреЛ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЛ рдЕрдкрдиреА рдзреБрд░реА рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдорд╛рддреНрд░рд╛ рдореЗрдВ рдШреБрдорд╛рддреА рд╣реИред <br><br>  Shader рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рджреЛ рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВ рдЬреЛ рд╣рдореЗрдВ рдРрд╕рд╛ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдВрдЧреЗ: <code>rand</code> , рдЬреЛ рддреАрди-рдЖрдпрд╛рдореА рдЗрдирдкреБрдЯ рд╕реЗ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕рдВрдЦреНрдпрд╛ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ, рдФрд░ <code>AngleAxis3x3</code> , рдЬреЛ рдХреЛрдг ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд░реЗрдбрд┐рдпрди рдореЗрдВ</a> ) рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдореИрдЯреНрд░рд┐рдХреНрд╕ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдЗрд╕ рдорд╛рди рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЕрдХреНрд╖ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдШреБрдорд╛рддрд╛ рд╣реИред  рдЙрддреНрддрд░рд╛рд░реНрджреНрдз рдлрд╝рдВрдХреНрд╢рди рдмрд┐рд▓реНрдХреБрд▓ C # <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Quaternion.AngleAxis</a> рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рдорд╛рди рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ (рдХреЗрд╡рд▓ <code>AngleAxis3x3</code> рдПрдХ рдореИрдЯреНрд░рд┐рдХреНрд╕ рд▓реМрдЯрд╛рддрд╛ рд╣реИ, рди рдХрд┐ рдПрдХ <code>AngleAxis3x3</code> )ред <br><br>  <code>rand</code> рдлрд╝рдВрдХреНрд╢рди 0 ... 1 рдореЗрдВ рдПрдХ рд╕рдВрдЦреНрдпрд╛ рджреЗрддрд╛ рд╣реИ;  рдХреЛрдгреАрдп рдореВрд▓реНрдпреЛрдВ рдХреА рдкреВрд░реА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдордиреЗ рдЗрд╕реЗ <strong>2 рдкрд╛рдИ</strong> рд╕реЗ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring the tangentToLocal matrix. float3x3 facingRotationMatrix = AngleAxis3x3(rand(pos) * UNITY_TWO_PI, float3(0, 0, 1));</span></span></code> </pre> <br>  рд╣рдо рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реЛрдЯреЗрд╢рди рдХреЗ рд▓рд┐рдП рдмреАрдЬ рдХреЗ рд░реВрдк рдореЗрдВ рдЖрдиреЗ рд╡рд╛рд▓реА <code>pos</code> рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рдШрд╛рд╕ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдмреНрд▓реЗрдб рдХрд╛ рдЕрдкрдирд╛ рд░реЛрдЯреЗрд╢рди рд╣реЛрдЧрд╛, рдкреНрд░рддреНрдпреЗрдХ рдлреНрд░реЗрдо рдореЗрдВ рд╕реНрдерд┐рд░ рд╣реЛрдЧрд╛ред <br><br>  рдмрдирд╛рдП рдЧрдП <code>tangentToLocal</code> рдореИрдЯреНрд░рд┐рдХреНрд╕ рджреНрд╡рд╛рд░рд╛ рдЗрд╕реЗ рдЧреБрдгрд╛ рдХрд░рдХреЗ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдкрд░ <code>tangentToLocal</code> рд╣реИред  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдЧреБрдгрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрдореНрдпреВрдЯреЗрдЯрд┐рд╡</a> <strong>рдирд╣реАрдВ</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИ</a> ;  рдСрдкрд░реЗрдВрдб рдХрд╛ рдХреНрд░рдо <strong>рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ</strong> ред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring facingRotationMatrix. float3x3 transformationMatrix = mul(tangentToLocal, facingRotationMatrix); тАж // Replace the multiplication matrix operand with our new transformationMatrix. triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(0.5, 0, 0)), float2(0, 0))); triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(-0.5, 0, 0)), float2(1, 0))); triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(0, 0, 1)), float2(0.5, 1)));</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/09f/c2f/e80/09fc2fe8028b51f78989954e65812cd3.png"></div><br><h3>  3.3 рдмреЗрддрд░рддреАрдм рдЖрдЧреЗ рдЭреБрдХрдирд╛ </h3><br>  рдпрджрд┐ рдШрд╛рд╕ рдХреЗ рд╕рднреА рдмреНрд▓реЗрдб рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЧрдардмрдВрдзрди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рд╡реЗ рд╕рдорд╛рди рджрд┐рдЦрд╛рдИ рджреЗрдВрдЧреЗред  рдпрд╣ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рддреИрдпрд╛рд░ рдШрд╛рд╕ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдЫрдВрдЯрдиреА рд╡рд╛рд▓реЗ рд▓реЙрди рдкрд░, рд▓реЗрдХрд┐рди рдкреНрд░рдХреГрддрд┐ рдореЗрдВ рдШрд╛рд╕ рдЙрд╕ рддрд░рд╣ рдирд╣реАрдВ рдмрдврд╝рддреА рд╣реИред  рд╣рдо <strong>рдПрдХреНрд╕</strong> рдЕрдХреНрд╖ рдХреЗ рд╕рд╛рде рдШрд╛рд╕ рдХреЛ рдШреБрдорд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдмрдирд╛рдПрдВрдЧреЗ, рд╕рд╛рде рд╣реА рдЗрд╕ рд░реЛрдЯреЗрд╢рди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдкрддреНрддрд┐ рднреА рдмрдирд╛рдПрдВрдЧреЗред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as a new property. _BendRotationRandom("Bend Rotation Random", Range(0, 1)) = 0.2 тАж // Add to the CGINCLUDE block. float _BendRotationRandom; тАж // Add to the geometry shader, below the line declaring facingRotationMatrix. float3x3 bendRotationMatrix = AngleAxis3x3(rand(pos.zzx) * _BendRotationRandom * UNITY_PI * 0.5, float3(-1, 0, 0));</span></span></code> </pre> <br>  рдлрд┐рд░ рд╕реЗ рд╣рдо рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреА рд╕реНрдерд┐рддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдмреАрдЬ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕ рдмрд╛рд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд╕реЗ</a> рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдмреАрдЬ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡реНрдпрд╛рдкрдХ рд░реВрдк</a> рд╕реЗ рдХрд░рддреЗ рд╣реИрдВред  рд╣рдо рднреА <code>UNITY_PI</code> рдХреЛ <strong>0.5 рд╕реЗ</strong> рдЧреБрдгрд╛ рдХрд░реЗрдВрдЧреЗ;  рдпрд╣ рд╣рдореЗрдВ 0 ... 90 рдбрд┐рдЧреНрд░реА рдХрд╛ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЕрдВрддрд░рд╛рд▓ рджреЗрдЧрд╛ред <br><br>  рд╣рдо рдлрд┐рд░ рд╕реЗ рдЗрд╕ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рд░реЛрдЯреЗрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, рд╕рдм рдХреБрдЫ рд╕рд╣реА рдХреНрд░рдо рдореЗрдВ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Modify the existing line. float3x3 transformationMatrix = mul(mul(tangentToLocal, facingRotationMatrix), bendRotationMatrix);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49c/122/534/49c122534d7298c0f9c646501a708daa.gif"></div><br><h3>  рей.рек рдЪреМрдбрд╝рд╛рдИ рдФрд░ рдКрдБрдЪрд╛рдИ </h3><br>  рдЬрдмрдХрд┐ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХрд╛ рдЖрдХрд╛рд░ 1 рдпреВрдирд┐рдЯ рдХреА рдЪреМрдбрд╝рд╛рдИ рдФрд░ 1 рдпреВрдирд┐рдЯ рдХреА рдКрдВрдЪрд╛рдИ рддрдХ рд╕реАрдорд┐рдд рд╣реИред  рд╣рдо рдЖрдХрд╛рд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреБрдг рдЬреЛрдбрд╝реЗрдВрдЧреЗ, рд╕рд╛рде рд╣реА рд╕рд╛рде рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рднрд┐рдиреНрдирддрд╛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреБрдг рднреА рдЬреЛрдбрд╝реЗрдВрдЧреЗред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as new properties. _BladeWidth("Blade Width", Float) = 0.05 _BladeWidthRandom("Blade Width Random", Float) = 0.02 _BladeHeight("Blade Height", Float) = 0.5 _BladeHeightRandom("Blade Height Random", Float) = 0.3 тАж // Add to the CGINCLUDE block. float _BladeHeight; float _BladeHeightRandom; float _BladeWidth; float _BladeWidthRandom; тАж // Add to the geometry shader, above the triStream.Append calls. float height = (rand(pos.zyx) * 2 - 1) * _BladeHeightRandom + _BladeHeight; float width = (rand(pos.xzy) * 2 - 1) * _BladeWidthRandom + _BladeWidth; тАж // Modify the existing positions with our new height and width. triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(width, 0, 0)), float2(0, 0))); triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(-width, 0, 0)), float2(1, 0))); triStream.Append(VertexOutput(pos + mul(transformationMatrix, float3(0, 0, height)), float2(0.5, 1)));</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/35b/22e/f34/35b22ef34945a576100a152a0e25eec5.png"></div><br>  рддреНрд░рд┐рдХреЛрдг рдЕрдм рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб, рд▓реЗрдХрд┐рди рдмрд╣реБрдд рдХрдоред  рдШрдиреАрднреВрдд рдЕрддрд┐рд╡реГрджреНрдзрд┐ рдХреНрд╖реЗрддреНрд░ рдХреА рдЫрд╛рдк рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдиреЗ рд╡рд╛рд▓реА рдЬрд╛рд▓реА рдореЗрдВ рдмрд╕ рдкрд░реНрдпрд╛рдкреНрдд рдЪреЛрдЯрд┐рдпрд╛рдВ рдирд╣реАрдВ рд╣реИрдВред <br><br>  рдПрдХ рд╕рдорд╛рдзрд╛рди рдПрдХ рдирдпрд╛, рд╕рдШрди рдЬрд╛рд▓ рдмрдирд╛рдирд╛ рд╣реИ, рдпрд╛ рддреЛ C # рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╛ рдПрдХ 3D рд╕рдВрдкрд╛рджрдХ рдореЗрдВред  рдпрд╣ рдХрд╛рдо рдХрд░реЗрдЧрд╛, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдШрд╛рд╕ рдХреЗ рдШрдирддреНрд╡ рдХреЛ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрдЧрд╛ред  рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо <strong>рдЯреЗрд╕реНрдпреВрд▓реЗрд╢рди</strong> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЬрд╛рд▓ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░реЗрдВрдЧреЗред <br><br><h2>  4. рдЯреЗрд╢рди </h2><br>  <strong>рдЯреЗрд╕реЗрд▓реЗрд╢рди</strong> рд░реЗрдВрдбрд░рд┐рдВрдЧ рдкрд╛рдЗрдк рд▓рд╛рдЗрди рдХрд╛ рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рдЪрд░рдг рд╣реИ, рдЬреЛ рдХрд┐ рд╡рд░реНрдЯрд┐рдХрд▓ рд╢реЗрдбрд░ рдХреЗ рдмрд╛рдж рдФрд░ рдЬреНрдпрд╛рдорд┐рддреАрдп рд╢реЗрдбрд░ (рдпрджрд┐ рдХреЛрдИ рд╣реЛ) рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдХрд╛рд░реНрдп рдПрдХ рдЖрдиреЗ рд╡рд╛рд▓реА рд╕рддрд╣ рдХреЛ рдХрдИ рдкреНрд░рд╛рдЗрдореЗрдЯрд┐рд╡ рдореЗрдВ рдмрджрд▓рдирд╛ рд╣реИред  рдЯреЗрд╕рд▓реЗрд╢рди рдХреЛ рджреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЪрд░рдгреЛрдВ рдореЗрдВ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрддрд╡рд╛рд░</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбреЛрдореЗрди</a> рд╢реЗрдбред <br><br>  рднреВрддрд▓ рд╢реЗрдбреНрд╕ рдХреЗ рд▓рд┐рдП, рдпреВрдирд┐рдЯреА рдореЗрдВ рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдВрддрд░реНрдирд┐рд░реНрдорд┐рдд рдЯреЗрд╕реЗрд▓реЗрд╢рди рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИ</a> ред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЪреВрдВрдХрд┐ рд╣рдо рд╕рддрд╣ рд╢реЗрдб рдХрд╛ <strong>рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ</strong> , рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдЕрдкрдирд╛ рд╢реЗрд▓ рдФрд░ рдбреЛрдореЗрди рд╢реЗрдб рд▓рд╛рдЧреВ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ, рдореИрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ tessellation рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдкрд░ рдЪрд░реНрдЪрд╛ рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛, рдФрд░ рд╣рдо рдмрд╕ рдореМрдЬреВрджрд╛ <code>CustomTessellation.cginc</code> рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдпрд╣ рдлрд╝рд╛рдЗрд▓ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреИрдЯрд▓рд╛рдЗрдХ рдХреЛрдбрд┐рдВрдЧ рд▓реЗрдЦ</a> рд╕реЗ рдЕрдиреБрдХреВрд▓рд┐рдд рд╣реИ, рдЬреЛ рдПрдХрддрд╛ рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреЗрд╕реЗрд▓реЗрд╢рди</a> рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдПрдХ рдЙрддреНрдХреГрд╖реНрдЯ рд╕реНрд░реЛрдд рд╣реИред <br><br>  рдпрджрд┐ рд╣рдо рджреГрд╢реНрдп рдореЗрдВ <code>TessellationExample</code> рдСрдмреНрдЬреЗрдХреНрдЯ рд╢рд╛рдорд┐рд▓ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдЗрд╕рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рд╛рдордЧреНрд░реА рд╣реИ рдЬреЛ tessellation рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреА рд╣реИред  <strong>Tessellation рдпреВрдирд┐рдлрд╝реЙрд░реНрдо</strong> рдкреНрд░реЙрдкрд░реНрдЯреА рдХреЛ рдмрджрд▓рдиреЗ рд╕реЗ рдЙрдкрд╡рд┐рднрд╛рдЬрди рдкреНрд░рднрд╛рд╡ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрддрд╛ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d8/8a7/f01/2d88a7f01e3a7462ffd0c8f20953b5ca.gif"></div><br>  рд╣рдо рдкреНрд▓реЗрди рдХреЗ рдШрдирддреНрд╡ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдШрд╛рд╕ рдХреА рдЫрд╛рдпрд╛ рдореЗрдВ рдЯреЗрд╕рд▓реЗрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЙрддреНрдкрдиреНрди рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ <code>CustomTessellation.cginc</code> рдлрд╛рдЗрд▓ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред  рд╣рдо рдЗрд╕реЗ рдЕрдкрдиреЗ <em>рд╕рдВрдмрдВрдзрд┐рдд</em> рдкрде рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░реЗрдВрдЧреЗред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add inside the CGINCLUDE block, below the other #include statements. #include "Shaders/CustomTessellation.cginc"</span></span></code> </pre> <br>  рдпрджрд┐ рдЖрдк <code>CustomTessellation.cginc</code> рдЦреЛрд▓рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ <code>vertexInput</code> рдФрд░ <code>vertexOutput</code> , рд╕рд╛рде рд╣реА рд╕рд╛рде рд╢реАрд░реНрд╖ <code>vertexOutput</code> , рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрд╕рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реИрдВред  рд╣рдорд╛рд░реЗ рдШрд╛рд╕ рдХреА рдЫрд╛рдпрд╛ рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рдлрд┐рд░ рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ;  рдЙрдиреНрд╣реЗрдВ рд╣рдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*struct vertexInput { float4 vertex : POSITION; float3 normal : NORMAL; float4 tangent : TANGENT; }; struct vertexOutput { float4 vertex : SV_POSITION; float3 normal : NORMAL; float4 tangent : TANGENT; }; vertexOutput vert(vertexInput v) { vertexOutput o; o.vertex = v.vertex; o.normal = v.normal; o.tangent = v.tangent; return o; }*/</span></span></code> </pre> <br>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ <code>CustomTessellation.cginc</code> рдореЗрдВ <code>CustomTessellation.cginc</code> рд╢реЗрдбрд░ рд╕реАрдзреЗ рдЗрдирдкреБрдЯ рдХреЛ рдЯреЗрд╕реЗрд▓реЗрд╢рди рдЪрд░рдг рдореЗрдВ рдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИ;  <code>vertexOutput</code> рдлрд╝рдВрдХреНрд╢рди, рдЬрд┐рд╕реЗ рдбреЛрдореЗрди рд╢реЗрдбрд░ рдХреЗ рдЕрдВрджрд░ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, <code>vertexOutput</code> рд╕рдВрд░рдЪрдирд╛ рдмрдирд╛рдиреЗ рдХрд╛ рдХрд╛рд░реНрдп <code>vertexOutput</code> рд╣реИред <br><br>  рдЕрдм рд╣рдо <strong>рд╢реЗрд▓</strong> рдФрд░ <strong>рдбреЛрдореЗрди</strong> рд╢реЗрдбреНрд╕ рдХреЛ рдШрд╛рд╕ рд╢реЗрдбрд░ рдореЗрдВ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдо рдпреВрдирд┐рдЯ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ <code>_TessellationUniform</code> рдЧреБрдг рднреА рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗ - рдЗрд╕ рдЧреБрдг рдХреЗ рдЕрдиреБрд░реВрдк рдЪрд░ рдХреЛ рдкрд╣рд▓реЗ рд╣реА <code>CustomTessellation.cginc</code> рдореЗрдВ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рдЪреБрдХрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as a new property. _TessellationUniform("Tessellation Uniform", Range(1, 64)) = 1 тАж // Add below the other #pragma statements in the SubShader Pass. #pragma hull hull #pragma domain domain</span></span></code> </pre> <br>  рдЕрдм <strong>Tessellation рдпреВрдирд┐рдлрд╝реЙрд░реНрдо</strong> рдкреНрд░реЙрдкрд░реНрдЯреА рдХреЛ рдмрджрд▓рдиреЗ рд╕реЗ рд╣рдо рдШрд╛рд╕ рдХреЗ рдШрдирддреНрд╡ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдореИрдВрдиреЗ рдкрд╛рдпрд╛ рдХрд┐ <strong>5 рдХреЗ</strong> рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде рдЕрдЪреНрдЫреЗ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреЗ рд╣реИрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/280/d93/c14/280d93c1420a9744bd56f2d2496f96ab.gif"></div><br><h2>  5. рд╣рд╡рд╛ </h2><br>  рд╣рдо <strong>рд╡рд┐рд░реВрдкрдг рдмрдирд╛рд╡рдЯ рдХрд╛</strong> рдирдореВрдирд╛ рд▓реЗрдХрд░ рд╣рд╡рд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВред  рдпрд╣ рдмрдирд╛рд╡рдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢реЗ рдХреА</a> рддрд░рд╣ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рджрд┐рдЦреЗрдЧреА</a> , рдЗрд╕рдореЗрдВ рдХреЗрд╡рд▓ рддреАрди рдЪреИрдирд▓реЛрдВ рдХреЗ рдмрдЬрд╛рдп рдХреЗрд╡рд▓ рджреЛ рд╣реА рд╣реЛрдВрдЧреЗред  рд╣рдо <strong>рдПрдХреНрд╕</strong> рдФрд░ <strong>рд╡рд╛рдИ рдХреЗ</strong> рд╕рд╛рде рдЗрди рджреЛ рдЪреИрдирд▓реЛрдВ рдХреЛ рд╣рд╡рд╛ рдХреЗ рджрд┐рд╢рд╛рдУрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ <strong>ред</strong> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a58/aaa/687/a58aaa68742934ff1bddf1cbaf9564f5.png"></div><br>  рдкрд╡рди рдХреА рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рдПрдХ рдпреВрд╡реА рд╕рдордиреНрд╡рдп рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЬрд╛рд▓ рдХреЛ рд╕реМрдВрдкреЗ рдЧрдП рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдЖрдиреЗ рд╡рд╛рд▓реЗ рдмрд┐рдВрджреБ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рдЕрдЧрд░ рджреБрдирд┐рдпрд╛ рдореЗрдВ рдХрдИ рдШрд╛рд╕ рдХреЗ рдЬрд╛рд▓ рд╣реИрдВ, рддреЛ рднреНрд░рдо рдкреИрджрд╛ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдХрд┐ рд╡реЗ рд╕рднреА рдПрдХ рд╣реА рд╣рд╡рд╛ рдкреНрд░рдгрд╛рд▓реА рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИрдВред  рдШрд╛рд╕ рдХреА рд╕рддрд╣ рдХреЗ рд╕рд╛рде рд╣рд╡рд╛ рдХреА рдмрдирд╛рд╡рдЯ рдХреЛ рд╕реНрдХреНрд░реЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо <code>_Time</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╢реЗрдбрд░ рдмрд┐рд▓реНрдЯ-рдЗрди рд╡реИрд░рд┐рдПрдмрд▓</a> рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as new properties. _WindDistortionMap("Wind Distortion Map", 2D) = "white" {} _WindFrequency("Wind Frequency", Vector) = (0.05, 0.05, 0, 0) тАж // Add to the CGINCLUDE block. sampler2D _WindDistortionMap; float4 _WindDistortionMap_ST; float2 _WindFrequency; тАж // Add to the geometry shader, just above the line declaring the transformationMatrix. float2 uv = pos.xz * _WindDistortionMap_ST.xy + _WindDistortionMap_ST.zw + _WindFrequency * _Time.y;</span></span></code> </pre> <br>  рд╣рдо рд╕реНрдерд┐рддрд┐ рдореЗрдВ <code>_WindDistortionMap</code> рдХреЗ рдкреИрдорд╛рдиреЗ рдФрд░ рдСрдлрд╕реЗрдЯ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ <code>_Time.y</code> рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ <code>_Time.y</code> , <code>_Time.y</code> рд╕реНрдХреЗрд▓ рдХрд┐рдпрд╛ <code>_WindFrequency</code> ред  рдЕрдм рд╣рдо рдЗрди рдпреВрд╡реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрдиреЗ рдФрд░ рд╣рд╡рд╛ рдХреА рддрд╛рдХрдд рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as a new property. _WindStrength("Wind Strength", Float) = 1 тАж // Add to the CGINCLUDE block. float _WindStrength; тАж // Add below the line declaring float2 uv. float2 windSample = (tex2Dlod(_WindDistortionMap, float4(uv, 0, 0)).xy * 2 - 1) * _WindStrength;</span></span></code> </pre> <br>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╣рдо рдмрдирд╛рд╡рдЯ рд╕реЗ рдирдореВрдирд╛ рдорд╛рди рдХреЛ рдЕрдВрддрд░рд╛рд▓ 0 ... 1 рд╕реЗ рдЕрдВрддрд░рд╛рд▓ -1 рддрдХ рд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВ ... 1ред  рдЕрдЧрд▓рд╛, рд╣рдо рд╣рд╡рд╛ рдХреА рджрд┐рд╢рд╛ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реБрдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╡реЗрдХреНрдЯрд░ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring float2 windSample. float3 wind = normalize(float3(windSample.x, windSample.y, 0));</span></span></code> </pre> <br>  рдЕрдм рд╣рдо рдЗрд╕ рд╡реЗрдХреНрдЯрд░ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдШреВрдордиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рд╣рдорд╛рд░реЗ <code>transformationMatrix</code> рдЧреБрдгрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring float3 wind. float3x3 windRotation = AngleAxis3x3(UNITY_PI * windSample, wind); тАж // Modify the existing line. float3x3 transformationMatrix = mul(mul(mul(tangentToLocal, windRotation), facingRotationMatrix), bendRotationMatrix);</span></span></code> </pre> <br>  рдЕрдВрдд рдореЗрдВ, рд╣рдо рдпреВрдирд┐рдЯреА рд╕рдВрдкрд╛рджрдХ рдореЗрдВ рдШрд╛рд╕ рд╕рд╛рдордЧреНрд░реА рдХреЗ <strong>рд╡рд┐рдВрдб рд╡рд┐рд░реВрдкрдг рдорд╛рдирдЪрд┐рддреНрд░</strong> рдХреНрд╖реЗрддреНрд░ рдХреЗ рд▓рд┐рдП <code>Wind</code> рдЯреЗрдХреНрд╕рдЪрд░ (рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рд░реВрдЯ рдкрд░ рд╕реНрдерд┐рдд) рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рд╣рдордиреЗ <code>0.01, 0.01</code> рдмрдирд╛рд╡рдЯ рдХреЗ <strong>рдЯрд╛рдЗрд▓рд┐рдВрдЧ</strong> рдкреИрд░рд╛рдореАрдЯрд░ рднреА рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдП рд╣реИрдВред <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  рдпрджрд┐ <strong>рджреГрд╢реНрдп</strong> рд╡рд┐рдВрдбреЛ рдореЗрдВ рдШрд╛рд╕ рдПрдирд┐рдореЗрдЯреЗрдб рдирд╣реАрдВ рд╣реИ, рддреЛ рдПрдирд┐рдореЗрдЯреЗрдб рд╕рд╛рдордЧреНрд░реА рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <strong>рдЯреЙрдЧрд▓ рд╕реНрдХрд╛рдИрдмреЙрдХреНрд╕, рдХреЛрд╣рд░реЗ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рдЕрдиреНрдп рдкреНрд░рднрд╛рд╡</strong> рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджреВрд░ рд╕реЗ, рдШрд╛рд╕ рд╕рд╣реА рджрд┐рдЦрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╣рдо рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЛ рдХрд░реАрдм рд╕реЗ рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдШрд╛рд╕ рдХрд╛ рдкреВрд░рд╛ рдмреНрд▓реЗрдб рдореБрдбрд╝ рд░рд╣рд╛ рд╣реИ, рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рдЖрдзрд╛рд░ рдЕрдм рдЬрдореАрди рд╕реЗ рдЬреБрдбрд╝рд╛ рдирд╣реАрдВ рд╣реИред </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e9/148/51e/6e914851e888c448c30080a7abefae33.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХрд╛ рдЖрдзрд╛рд░ рдЕрдм рдЬрдореАрди рд╕реЗ рдЬреБрдбрд╝рд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдЪреНрдЫреЗрджрди ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд╛рд▓ рд░рдВрдЧ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ </font><font style="vertical-align: inherit;">), рдФрд░ рдЬрдореАрди рдХреЗ рд╡рд┐рдорд╛рди рдХреЗ рдКрдкрд░ рд▓рдЯрдХрд╛ рд╣реБрдЖ рд╣реИ ( </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд░реА</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд░реЗрдЦрд╛ </font><font style="vertical-align: inherit;">рджреНрд╡рд╛рд░рд╛ рджрд░реНрд╢рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ </font><font style="vertical-align: inherit;">)ред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рджреВрд╕рд░реЗ рдкрд░рд┐рд╡рд░реНрддрди рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдХреЗ рдареАрдХ рдХрд░реЗрдВрдЧреЗ, рдЬреЛ рдЖрдзрд╛рд░ рдХреЗ рдХреЗрд╡рд▓ рджреЛ рдХреЛрдиреЗ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореИрдЯреНрд░рд┐рдХреНрд╕ рд╢рд╛рдорд┐рд▓ </font></font><code>windRotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>bendRotationMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдзрдиреНрдпрд╡рд╛рдж рдЬреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдзрд╛рд░ рдШрд╛рд╕ рдХреА рд╕рддрд╣ рд╕реЗ рдЬреБрдбрд╝реА рд╣реИред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring float3x3 transformationMatrix. float3x3 transformationMatrixFacing = mul(tangentToLocal, facingRotationMatrix); тАж // Modify the existing lines outputting the base vertex positions. triStream.Append(VertexOutput(pos + mul(transformationMatrixFacing, float3(width, 0, 0)), float2(0, 0))); triStream.Append(VertexOutput(pos + mul(transformationMatrixFacing, float3(-width, 0, 0)), float2(1, 0)));</span></span></code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреА рд╡рдХреНрд░рддрд╛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдШрд╛рд╕ рдХреЗ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдмреНрд▓реЗрдб рдПрдХ рддреНрд░рд┐рдХреЛрдг рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВред рдмрдбрд╝реА рджреВрд░реА рдкрд░, рдпрд╣ рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЗ рдкрд╛рд╕ рд╡реЗ рдЬреИрд╡рд┐рдХ рдФрд░ рдЬреАрд╡рдВрдд рд╣реЛрдиреЗ рдХреЗ рдмрдЬрд╛рдп рдмрд╣реБрдд рдХрдареЛрд░ рдФрд░ рдЬреНрдпрд╛рдорд┐рддреАрдп рджрд┐рдЦрддреЗ рд╣реИрдВред рд╣рдо рдЗрд╕реЗ рдХрдИ рддреНрд░рд┐рдХреЛрдгреЛрдВ рд╕реЗ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЗ рдирд┐рд░реНрдорд╛рдг рдФрд░ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рдХреНрд░ рдХреЗ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рд╛рде рдЭреБрдХрд╛рдХрд░ рдареАрдХ рдХрд░реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШрд╛рд╕ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдмреНрд▓реЗрдб рдХреЛ рдХрдИ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЦрдВрдбреЛрдВ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ </font><font style="vertical-align: inherit;">ред рдкреНрд░рддреНрдпреЗрдХ рдЦрдВрдб рдореЗрдВ рдПрдХ рдЖрдпрддрд╛рдХрд╛рд░ рдЖрдХрд╛рд░ рд╣реЛрдЧрд╛ рдФрд░ рджреЛ рддреНрд░рд┐рдХреЛрдг рд╢рд╛рдорд┐рд▓ рд╣реЛрдВрдЧреЗ, рдКрдкрд░реА рдЦрдВрдб рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде - рдпрд╣ рдПрдХ рддреНрд░рд┐рдХреЛрдг рд╣реЛрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЗ рд╕рд┐рд░реЗ рдХреЛ рджрд░реНрд╢рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рддрдХ, рд╣рдордиреЗ рдХреЗрд╡рд▓ рддреАрди рд╕рд┐рд░реЛрдВ рдХреЛ рдЦреАрдВрдЪрд╛ рд╣реИ, рдПрдХ рддреНрд░рд┐рднреБрдЬ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд┐рдпрд╛ рд╣реИред рдХреИрд╕реЗ, рдлрд┐рд░, рдпрджрд┐ рдЕрдзрд┐рдХ рд▓рдВрдмрд╡рдд рд╣реИрдВ, рддреЛ рдЬреНрдпрд╛рдорд┐рддреАрдп рд╢реЗрдбрд░ рдХреЛ рдкрддрд╛ рд╣реИ рдХрд┐ рдХрд┐рди рд▓реЛрдЧреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рд╣реЛрдирд╛ рдФрд░ рддреНрд░рд┐рдХреЛрдг рдмрдирд╛рдирд╛ рд╣реИ? рдЗрд╕рдХрд╛ рдЬрд╡рд╛рдм рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рд╣реИ</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреНрд░рд┐рдХреЛрдг рдХреА рдкрдЯреНрдЯреА</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред рдкрд╣рд▓реЗ рддреАрди рдХреЛрдиреЗ рдЬреБрдбрд╝рддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рддреНрд░рд┐рдХреЛрдг рдмрдирд╛рддреЗ рд╣реИрдВ, рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдирдпрд╛ рд╢реАрд░реНрд╖ рдкрд┐рдЫрд▓реЗ рджреЛ рдХреЗ рд╕рд╛рде рдПрдХ рддреНрд░рд┐рдХреЛрдг рдмрдирд╛рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/871/8ec/676/8718ec676d7efd819718bd25d5b27b54.gif"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШрд╛рд╕ рдХреА рдПрдХ рдЙрдк-рд╡рд┐рднрд╛рдЬрд┐рдд рдмреНрд▓реЗрдб, рдЬрд┐рд╕реЗ рддреНрд░рд┐рдХреЛрдг рдкрдЯреНрдЯреА рдХреЗ рд░реВрдк рдореЗрдВ рджрд░реНрд╢рд╛рдпрд╛ рдЧрдпрд╛ рдФрд░ рдПрдХ рд╕рдордп рдореЗрдВ рдПрдХ рд╢реАрд░реНрд╖ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ред рдкрд╣рд▓реЗ рддреАрди рдХреЛрдиреЗ рдХреЗ рдмрд╛рдж, рдкреНрд░рддреНрдпреЗрдХ рдирдпрд╛ рд╢реАрд░реНрд╖ рдкрд┐рдЫрд▓реЗ рджреЛ рдХреЛрдиреЗ рдХреЗ рд╕рд╛рде рдПрдХ рдирдпрд╛ рддреНрд░рд┐рдХреЛрдг рдмрдирд╛рддрд╛ рд╣реИред</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрд╣ рди рдХреЗрд╡рд▓ рд╕реНрдореГрддрд┐ рдЙрдкрдпреЛрдЧ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЕрдзрд┐рдХ рдХреБрд╢рд▓ рд╣реИ, рдмрд▓реНрдХрд┐ рдЖрдкрдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдФрд░ рдЬрд▓реНрджреА рд╕реЗ рдЕрдкрдиреЗ рдХреЛрдб рдореЗрдВ рддреНрд░рд┐рдХреЛрдг рдЕрдиреБрдХреНрд░рдо рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрджрд┐ рд╣рдо рддреНрд░рд┐рдХреЛрдг рдХреА рдХрдИ рдзрд╛рд░рд┐рдпрд╛рдБ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо </font></font><code>TriangleStream</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RestartStrip</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо рдЬреНрдпрд╛рдорд┐рддреАрдп рдЫрд╛рдпрд╛ рд╕реЗ рдЕрдзрд┐рдХ рд▓рдВрдмрд╡рдд рдЦреАрдВрдЪрдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ, рд╣рдореЗрдВ рдЗрд╕реЗ рдмрдврд╝рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>maxvertexcount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд╣рдо </font></font><code>#define</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реЗрдбрд░ рд▓реЗрдЦрдХ рдХреЛ рд╕реЗрдЧрдореЗрдВрдЯ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдФрд░ рдЙрд╕рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХреЛрдиреЗ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди </font><font style="vertical-align: inherit;">рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the CGINCLUDE block. #define BLADE_SEGMENTS 3 тАж // Modify the existing line defining the maxvertexcount. [maxvertexcount(BLADE_SEGMENTS * 2 + 1)]</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, рд╣рдо рд╕реЗрдЧрдореЗрдВрдЯ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 рдкрд░</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╕реЗрдЧрдореЗрдВрдЯ </font></font><code>maxvertexcount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рд░реНрдЯрд┐рдХрд▓ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдЕрдкрдбреЗрдЯ </font><font style="vertical-align: inherit;">рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШрд╛рд╕ рдХрд╛ рдПрдХ рдЦрдВрдбрд┐рдд рдмреНрд▓реЗрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рдЪрдХреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред рд▓реВрдк рдХрд╛ рдкреНрд░рддреНрдпреЗрдХ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреЛ рдХреЛрдиреЗ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬреЛрдбрд╝ рджреЗрдЧрд╛ </font><font style="vertical-align: inherit;">: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рдПрдВ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджрд╛рдПрдВ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред рдЯрд┐рдк рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреА рдиреЛрдХ рдкрд░ рдЕрдВрддрд┐рдо рд╢реАрд░реНрд╖ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рд╣рдо рдРрд╕рд╛ рдХрд░рддреЗ рд╣реИрдВ, рдХреЛрдб рдХреЗ рдШрд╛рд╕ рдмреНрд▓реЗрдб рдХреЗ рдХреЛрдиреЗ рдореЗрдВ рдХрдВрдкреНрдпреВрдЯрд┐рдВрдЧ рд╕реНрдерд┐рддрд┐ рдХреЗ рднрд╛рдЧ рдХреЛ рдХрд╛рд░реНрдп рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рд╣рдо рд▓реВрдк рдХреЗ рдЕрдВрджрд░ рдФрд░ рдмрд╛рд╣рд░ рдХрдИ рдмрд╛рд░ рдЗрд╕ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред рдмреНрд▓реЙрдХ рдореЗрдВ </font></font><code>CGINCLUDE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">geometryOutput </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateGrassVertex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(float3 vertexPosition, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, float2 uv, float3x3 transformMatrix)</span></span></span><span class="hljs-function"> </span></span>{ float3 tangentPoint = float3(width, <span class="hljs-number"><span class="hljs-number">0</span></span>, height); float3 localPosition = vertexPosition + mul(transformMatrix, tangentPoint); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> VertexOutput(localPosition, uv); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рд╕рдорд╛рди рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЙрди рддрд░реНрдХреЛрдВ </font></font><code>VertexOutput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ </font><font style="vertical-align: inherit;">рдкрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╣рдордиреЗ рдкрд╣рд▓реЗ </font><font style="vertical-align: inherit;">рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЗ рдХреЛрдиреЗ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рдкрд╛рд░рд┐рдд </font><font style="vertical-align: inherit;">рдХрд┐рдП рдереЗред </font><font style="vertical-align: inherit;">рдПрдХ рд╕реНрдерд┐рддрд┐, рдКрдВрдЪрд╛рдИ рдФрд░ рдЪреМрдбрд╝рд╛рдИ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛, рдпрд╣ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╕рдВрдЪрд░рд┐рдд рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╢реАрд░реНрд╖ рдХреЛ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдПрдХ рдпреВрд╡реА рд╕рдордиреНрд╡рдп рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдареАрдХ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореМрдЬреВрджрд╛ рдХреЛрдб рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Update the existing code outputting the vertices. triStream.Append(GenerateGrassVertex(pos, width, 0, float2(0, 0), transformationMatrixFacing)); triStream.Append(GenerateGrassVertex(pos, -width, 0, float2(1, 0), transformationMatrixFacing)); triStream.Append(GenerateGrassVertex(pos, 0, height, float2(0.5, 1), transformationMatrix));</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди рдиреЗ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛, рдФрд░ рд╣рдо рд╢реАрд░реНрд╖ рдкреАрдврд╝реА рдХреЛрдб рдХреЛ рд▓реВрдк рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИрдВ </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд▓рд╛рдЗрди рдХреЗ рдиреАрдЪреЗ </font></font><code>float width</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝реЗрдВ </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; BLADE_SEGMENTS; i++) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t = i / (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)BLADE_SEGMENTS; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рдЪрдХреНрд░ рдХреА рдШреЛрд╖рдгрд╛ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдШрд╛рд╕ рдЦрдВрдб рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдмреНрд▓реЗрдб рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рд░ рдЪрд▓рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рд▓реВрдк рдХреЗ рдЕрдВрджрд░, рдПрдХ рдЪрд░ рдЬреЛрдбрд╝реЗрдВ </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рдЪрд░ 0 0 ... 1 рдХреА рд╢реНрд░реЗрдгреА рдореЗрдВ рдПрдХ рдорд╛рди рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдЧрд╛, рдЬреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ рд╣рдо рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЗ рд╕рд╛рде рдХрд┐рддрдиреА рджреВрд░ рдЪрд▓реЗ рдЧрдП рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реВрдк рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдореЗрдВ рдЦрдВрдб рдХреА рдЪреМрдбрд╝рд╛рдИ рдФрд░ рдКрдВрдЪрд╛рдИ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рдЗрд╕ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring float t. float segmentHeight = height * t; float segmentWidth = width * (1 - t);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдШрд╛рд╕ рдХрд╛ рдПрдХ рдмреНрд▓реЗрдб рдКрдкрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдКрдВрдЪрд╛рдИ рдмрдврд╝ рдЬрд╛рддреА рд╣реИ рдФрд░ рдЪреМрдбрд╝рд╛рдИ рдХрдо рд╣реЛ рдЬрд╛рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдм рд╣рдо </font></font><code>GenerateGrassVertex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддреНрд░рд┐рднреБрдЬреЛрдВ рдХреА рдзрд╛рд░рд╛ рдореЗрдВ рдХреЛрдиреЗ рдЬреЛрдбрд╝рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рд▓реВрдк рдореЗрдВ рдХреЙрд▓ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо </font></font><code>GenerateGrassVertex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреА рдиреЛрдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд▓реВрдк рдХреЗ рдмрд╛рд╣рд░ </font><font style="vertical-align: inherit;">рдПрдХ рдХреЙрд▓ рднреА рдЬреЛрдбрд╝реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the line declaring float segmentWidth. float3x3 transformMatrix = i == 0 ? transformationMatrixFacing : transformationMatrix; triStream.Append(GenerateGrassVertex(pos, segmentWidth, segmentHeight, float2(0, t), transformMatrix)); triStream.Append(GenerateGrassVertex(pos, -segmentWidth, segmentHeight, float2(1, t), transformMatrix)); тАж // Add just below the loop to insert the vertex at the tip of the blade. triStream.Append(GenerateGrassVertex(pos, 0, height, float2(0.5, 1), transformationMatrix)); тАж // Remove the existing calls to triStream.Append. //triStream.Append(GenerateGrassVertex(pos, width, 0, float2(0, 0), transformationMatrixFacing)); //triStream.Append(GenerateGrassVertex(pos, -width, 0, float2(1, 0), transformationMatrixFacing)); //triStream.Append(GenerateGrassVertex(pos, 0, height, float2(0.5, 1), transformationMatrix));</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШреЛрд╖рдгрд╛ рдХреЗ рд╕рд╛рде рд▓рд╛рдЗрди рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ </font></font><code>float3x3 transformMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдпрд╣рд╛рдВ рд╣рдо рджреЛ рдкрд░рд┐рд╡рд░реНрддрди рдореИрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╣реИрдВ: рд╣рдо </font></font><code>transformationMatrixFacing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдзрд╛рд░ рдХреЗ рдХреЛрдиреЗ рдФрд░ </font></font><code>transformationMatrix</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреНрдп рд╕рднреА рдХреЗ рд▓рд┐рдП </font><font style="vertical-align: inherit;">рд▓реЗрддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02b/211/61c/02b21161cd4afc0cca35ae71ffe2570e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдЕрдм рдХрдИ рдЦрдВрдбреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рд╣реИрдВ, рд▓реЗрдХрд┐рди рдмреНрд▓реЗрдб рдХреА рд╕рддрд╣ рдЕрднреА рднреА рд╕рдкрд╛рдЯ рд╣реИ - рдирдП рддреНрд░рд┐рдХреЛрдг рдЕрднреА рддрдХ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдШрд╛рд╕ рд╡рдХреНрд░рддрд╛ рдХреА рдПрдХ рдкрддреНрддреА рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП, рдХреЗ рд╢рд┐рдЦрд░ рдХреА рд╕реНрдерд┐рддрд┐ рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рд╣реЛрдЧрд╛ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдИ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ </font></font><code>GenerateGrassVertex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдЗрд╕реЗ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдИ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рдПрдХ рдСрдлрд╕реЗрдЯ рдорд┐рд▓реЗ </font><font style="vertical-align: inherit;">, рдЬрд┐рд╕реЗ рд╣рдо рдХреЙрд▓ рдХрд░реЗрдВрдЧреЗ </font></font><code>forward</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Update the function signature of GenerateGrassVertex. geometryOutput GenerateGrassVertex(float3 vertexPosition, float width, float height, float forward, float2 uv, float3x3 transformMatrix) тАж // Modify the Y coordinate assignment of tangentPoint. float3 tangentPoint = float3(width, forward, height);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдХреЗ рд╡рд┐рд╕реНрдерд╛рдкрди рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдПрдХ </font></font><code>pow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рди </font><font style="vertical-align: inherit;">рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдирд┐рд░реНрдорд╛рдг рдХреЗ рдмрд╛рдж </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЧреЗ рдкреВрд░реНрд╡рд╛рдЧреНрд░рд╣ рдкрд░ рдЙрд╕рдХреЗ рдкреНрд░рднрд╛рд╡ рдХреА рдбрд┐рдЧреНрд░реА рдореЗрдВ рд╣реИ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд░реЗрдЦреАрдп</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдШрд╛рд╕ рдХреА рдПрдХ рдЕрд╡рд╕реНрдерд╛ рдореЗрдВ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add as new properties. _BladeForward("Blade Forward Amount", Float) = 0.38 _BladeCurve("Blade Curvature Amount", Range(1, 4)) = 2 тАж // Add to the CGINCLUDE block. float _BladeForward; float _BladeCurve; тАж // Add inside the geometry shader, below the line declaring float width. float forward = rand(pos.yyz) * _BladeForward; тАж // Add inside the loop, below the line declaring segmentWidth. float segmentForward = pow(t, _BladeCurve) * forward; тАж // Modify the GenerateGrassVertex calls inside the loop. triStream.Append(GenerateGrassVertex(pos, segmentWidth, segmentHeight, segmentForward, float2(0, t), transformMatrix)); triStream.Append(GenerateGrassVertex(pos, -segmentWidth, segmentHeight, segmentForward, float2(1, t), transformMatrix)); тАж // Modify the GenerateGrassVertex calls outside the loop. triStream.Append(GenerateGrassVertex(pos, 0, height, forward, float2(0.5, 1), transformationMatrix));</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдХреЛрдб рдХрд╛ рдПрдХ рдХрд╛рдлреА рдмрдбрд╝рд╛ рдЯреБрдХрдбрд╝рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреА рдЪреМрдбрд╝рд╛рдИ рдФрд░ рдКрдВрдЪрд╛рдИ рдХреЗ рд▓рд┐рдП рдЬреЛ рдХреБрдЫ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЙрд╕реА рддрд░рд╣ рд╕рднреА рдХрд╛рдо рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдХрдо рдореВрд▓реНрдпреЛрдВ рдХреЗ рд╕рд╛рде </font></font><code>_BladeForward</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ </font></font><code>_BladeCurve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдореЗрдВ рдПрдХ рд╕реБрд╡реНрдпрд╡рд╕реНрдерд┐рдд, рд╕реБрд╡реНрдпрд╡рд╕реНрдерд┐рдд рд▓реЙрди рдорд┐рд▓рддрд╛ рд╣реИ, рдФрд░ рдмрдбрд╝реЗ рдореВрд▓реНрдп рд╡рд┐рдкрд░реАрдд рдкреНрд░рднрд╛рд╡ рджреЗрдВрдЧреЗред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c1f/cbc/e43/c1fcbce43fa5e1c1be319dc1f5190f3d.png"></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. рдкреНрд░рдХрд╛рд╢ рдФрд░ рдЫрд╛рдпрд╛ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реЗрдбрд░ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдВрддрд┐рдо рдЪрд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдо </font><font style="vertical-align: inherit;">рдЫрд╛рдпрд╛ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрд╛рд▓рдиреЗ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╛рдкреНрдд</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рджрд┐рд╢рд╛рддреНрдордХ рдкреНрд░рдХрд╛рд╢ рдХреЗ рдореБрдЦреНрдп рд╕реНрд░реЛрдд рд╕реЗ рд╕рд░рд▓ рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рднреА рдЬреЛрдбрд╝реЗрдВрдЧреЗред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7.1 рдХрд╛рд╕реНрдЯрд┐рдВрдЧ рдЫрд╛рдпрд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХрддрд╛ рдореЗрдВ рдЫрд╛рдпрд╛ рдбрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЫрд╛рдпрд╛рдХрд╛рд░ рдХреЛ рджреВрд╕рд░рд╛ рдкрд╛рд╕ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЗрд╕ рдорд╛рд░реНрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЫрд╛рдпрд╛ рдмрдирд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрддреЛрдВ рджреНрд╡рд╛рд░рд╛ рджреГрд╢реНрдп рдореЗрдВ рдЙрдирдХреЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЫрд╛рдпрд╛ рдорд╛рдирдЪрд┐рддреНрд░</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рдШрд╛рд╕ рдХреА рдЧрд╣рд░рд╛рдИ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ </font><font style="vertical-align: inherit;">ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдЬреНрдпрд╛рдорд┐рддреАрдп рдЫрд╛рдпрд╛ рдХреЛ рдЫрд╛рдпрд╛ рдорд╛рд░реНрдЧ рдореЗрдВ рд▓реЙрдиреНрдЪ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рддрд╛рдХрд┐ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдЫрд╛рдпрд╛ рдбрд╛рд▓ рд╕рдХреЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдВрдХрд┐ рдЬреНрдпрд╛рдорд┐рддреАрдп рд╢реЗрдбрд░ рдмреНрд▓реЙрдХреЛрдВ рдХреЗ рдЕрдВрджрд░ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>CGINCLUDE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕реЗ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдХрд┐рд╕реА рднреА рдкрд╛рд╕ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдПрдХ рджреВрд╕рд░рд╛ рдкрд╛рд╕ рдмрдирд╛рдПрдВ рдЬреЛ рдкрд╣рд▓реЗ рдХреЗ рд╕рдорд╛рди рд╢реЗрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛, рдЯреБрдХрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде - рд╣рдо рдПрдХ рдирдП рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВрдЧреЗ рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдПрдХ рдореИрдХреНрд░реЛ рд▓рд┐рдЦреЗрдВрдЧреЗ рдЬреЛ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add below the existing Pass. Pass { Tags { "LightMode" = "ShadowCaster" } CGPROGRAM #pragma vertex vert #pragma geometry geo #pragma fragment frag #pragma hull hull #pragma domain domain #pragma target 4.6 #pragma multi_compile_shadowcaster float4 frag(geometryOutput i) : SV_Target { SHADOW_CASTER_FRAGMENT(i) } ENDCG }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдирдпрд╛ рдЯреБрдХрдбрд╝рд╛ рдмрдирд╛рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдорд╛рд░реНрдЧ рдореЗрдВ рдХреБрдЫ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЕрдВрддрд░ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд▓реЗрдмрд▓ </font></font><code>LightMode</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рдпрдиреЗ рд░рдЦрддрд╛ рд╣реИ </font></font><code>ShadowCaster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдирд╣реАрдВ </font></font><code>ForwardBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдпрд╣ рдПрдХрддрд╛ рдХреЛ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕ рдорд╛рд░реНрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЫрд╛рдпрд╛ рдирдХреНрд╢реЗ рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ рдПрдХ рдкреВрд░реНрд╡рдкреНрд░рдХреНрд░рдордХ рдирд┐рд░реНрджреЗрд╢ рднреА рд╣реИ </font></font><code>multi_compile_shadowcaster</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЫрд╛рдпрд╛ рдЫрд╛рдпрд╛ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЦреЗрд▓ рд╡рд╕реНрддреБ </font><font style="vertical-align: inherit;">рдХреЛ рджреГрд╢реНрдп рдореЗрдВ </font></font><code>Fence</code> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдХреНрд░рд┐рдп</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдмрдирд╛рдПрдВ </font><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП рд╣рдореЗрдВ рдПрдХ рд╕рддрд╣ рдорд┐рд▓рддреА рд╣реИ рдЬрд┐рд╕ рдкрд░ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдПрдХ рдЫрд╛рдпрд╛ рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c57/640/6cf/c576406cf284fe41e4b04d8af264d96e.png"></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7.2 рдЫрд╛рдпрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм рдПрдХрддрд╛ рдЫрд╛рдпрд╛ рдмрдирд╛рдиреЗ рдХреЗ рдкреНрд░рдХрд╛рд╢ рд╕реНрд░реЛрдд рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рдЫрд╛рдпрд╛ рдорд╛рдирдЪрд┐рддреНрд░ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреА рд╣реИ, рддреЛ рдпрд╣ рдПрдХ рдкрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЫрд╛рдпрд╛ рдХреЛ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдХреНрд░реАрди рд╕реНрдкреЗрд╕</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреА рдмрдирд╛рд╡рдЯ рдореЗрдВ "рдПрдХрддреНрд░рд┐рдд" рдХрд░рддрд╛ </font><strong><font style="vertical-align: inherit;">рд╣реИ</font></strong><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдЗрд╕ рдмрдирд╛рд╡рдЯ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд╕реНрдХреНрд░реАрди рд╕реНрдкреЗрд╕ рдореЗрдВ рдХреЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЯреБрдХрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the geometryOutput struct. unityShadowCoord4 _ShadowCoord : TEXCOORD1; тАж // Add to the VertexOutput function, just above the return call. o._ShadowCoord = ComputeScreenPos(o.pos);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рд░реНрдЧ рдХреЗ рдЯреБрдХрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ, </font></font><code>ForwardBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рдореИрдХреНрд░реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ </font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ </font><font style="vertical-align: inherit;">рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">рдХрд┐ рд╕рддрд╣ рдЫрд╛рдпрд╛ рдореЗрдВ рд╣реИ рдпрд╛ рдирд╣реАрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдорд╛рди 0 ... 1 рд╢реНрд░реЗрдгреА рдореЗрдВ рд╣реИ, рдЬрд╣рд╛рдВ 0 рдкреВрд░реНрдг рдЫрд╛рдпрд╛рдВрдХрди рд╣реИ, 1 рдкреВрд░реНрдг рд░реЛрд╢рдиреА рд╣реИред</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдХреНрд░реАрди рд╕реНрдкреЗрд╕ рдХреЗ UV рд╕рдордиреНрд╡рдп рдХреЛ _ShadowCoord рдХреНрдпреЛрдВ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ? </font><font style="vertical-align: inherit;">рдпрд╣ рдкрд┐рдЫрд▓реЗ рдирд╛рдордХрд░рдг рд╕рдореНрдореЗрд▓рдиреЛрдВ рдХрд╛ рдЕрдиреБрдкрд╛рд▓рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред</font></font></b> <div class="spoiler_text">    Unity           (       ).          <code>SHADOW_ATTENUATION</code> .         <code>Autolight.cginc</code> ,  ,       . <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SHADOW_ATTENUATION(a) unitySampleShadow(a._ShadowCoord)</span></span></code> </pre> <br>              -    ,            . </div></div><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the ForwardBase pass's fragment shader, replacing the existing return call. return SHADOW_ATTENUATION(i); //return lerp(_BottomColor, _TopColor, i.uv.y);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рд╣рдореЗрдВ рдЫрд╛рдпрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реЗрдбрд░ рдХреЛ рдареАрдХ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдкрд╛рд╕ рдореЗрдВ рдПрдХ </font></font><code>ForwardBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреВрд░реНрд╡рдкреНрд░рдХреНрд░рдордХ рдирд┐рд░реНрджреЗрд╢ </font><font style="vertical-align: inherit;">рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдпрд╣ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ shader рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░ рд╕рдХреЗред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the ForwardBase pass's preprocessor directives, below #pragma target 4.6. #pragma multi_compile_fwdbase</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90a/491/468/90a491468a1ad129d35bea03b0b51898.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреИрдорд░реЗ рдХреЛ рдХрд░реАрдм рд▓рд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреА рд╕рддрд╣ рдкрд░ рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ рдХреЛ рдиреЛрдЯрд┐рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ; </font><font style="vertical-align: inherit;">рд╡реЗ рдЗрд╕ рддрдереНрдп рдХреЗ рдХрд╛рд░рдг рд╣реЛрддреЗ рд╣реИрдВ рдХрд┐ рдШрд╛рд╕ рдХреЗ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдмреНрд▓реЗрдб рдЦреБрдж рдкрд░ рдЫрд╛рдпрд╛ рдбрд╛рд▓рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕реЗ рдПрдХ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реИрдЦрд┐рдХ рдмрджрд▓рд╛рд╡</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓рд╛рдЧреВ рдХрд░рдХреЗ </font><font style="vertical-align: inherit;">рдпрд╛ рд╕реНрдХреНрд░реАрди рд╕реЗ рдереЛрдбрд╝реА рджреВрд░ рдЯреНрд░рдВрдХреЗрд╢рди рд╕реНрдкреЗрд╕ рдореЗрдВ рдХреЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ </font><em><font style="vertical-align: inherit;">рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд</font></em><font style="vertical-align: inherit;"> рдХрд░рдХреЗ рдареАрдХ рдХрд░ рд╕рдХрддреЗ </font><font style="vertical-align: inherit;">рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХрддрд╛ рдореИрдХреНрд░реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдЗрд╕реЗ рдбрд┐рдЬрд╛рдЗрди рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВрдЧреЗ </font></font><code>#if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд╛рдХрд┐ рдСрдкрд░реЗрд╢рди рдХреЗрд╡рд▓ рдЫрд╛рдпрд╛ рдкрде рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add at the end of the VertexOutput function, just above the return call. #if UNITY_PASS_SHADOWCASTER // Applying the bias prevents artifacts from appearing on the surface. o.pos = UnityApplyLinearShadowBias(o.pos); #endif</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dca/ec0/d88/dcaec0d88eea1893b6a07eb45724a0b6.gif"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реИрдЦрд┐рдХ рдЫрд╛рдпрд╛ рдмрджрд▓рд╛рд╡ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдзрд╛рд░рд┐рдпреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдЫрд╛рдпрд╛ рдХрд▓рд╛рдХреГрддрд┐рдпрд╛рдВ рддреНрд░рд┐рдХреЛрдг рдХреА рд╕рддрд╣ рд╕реЗ рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рддреА рд╣реИрдВред</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдШрд╛рд╕ рдХреЗ рдЫрд╛рдпрд╛рдВрдХрд┐рдд рдмреНрд▓реЗрдб рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдХрд▓рд╛рдХреГрддрд┐рдпрд╛рдВ рдХреНрдпреЛрдВ рд╣реИрдВ?</font></font></b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08a/12e/af1/08a12eaf1af17fc9b35de7d07a64afca.png"></div><br>      (multisample anti-aliasing <strong>MSAA</strong> ) Unity <em> </em>     ,        .        ,  . <br><br>    тАФ  ,    ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  Unity</a> .      (     );     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">    Unity</a> . </div></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lighting.рей рдкреНрд░рдХрд╛рд╢ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдо рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ рдФрд░ рдЖрдо рд╡рд┐рд╕рд░рд┐рдд рдкреНрд░рдХрд╛рд╢ рдЧрдгрдирд╛ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗрдВрдЧреЗред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/404/3ae/452/4043ae452046c0b4b405aa88afe8d2b7.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... рдЬрд╣рд╛рдВ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕рддрд╣ рдкрд░ рд╕рд╛рдорд╛рдиреНрдп рд╣реИ, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджрд┐рд╢рд╛рддреНрдордХ рдкреНрд░рдХрд╛рд╢ рдХреЗ рдореБрдЦреНрдп рд╕реНрд░реЛрдд рдХрд╛ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рджрд┐рд╢рд╛ рд╣реИ, рдФрд░ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрдВ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЧрдгрдирд╛ рдХреА рдЧрдИ рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ рд╣рдо </font><font style="vertical-align: inherit;">рдЕрдкреНрд░рддреНрдпрдХреНрд╖ рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреЛ рд▓рд╛рдЧреВ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд▓рд╣рд╛рд▓, рдорд╛рдирджрдВрдбреЛрдВ рдХреЛ рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЗ рдХреЛрдиреЗ рддрдХ рдирд╣реАрдВ рд╕реМрдВрдкрд╛ рдЧрдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╢реАрд░реНрд╖ рдкрджреЛрдВ рдХреЗ рд╕рд╛рде, рд╣рдо рдкрд╣рд▓реЗ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╕реНрдерд╛рди</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рдорд╛рдирджрдВрдбреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ </font><strong><font style="vertical-align: inherit;">рд╣реИрдВ</font></strong><font style="vertical-align: inherit;"> рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рд╕реНрдерд╛рдиреАрдп рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреНрд▓реЗрдб рд╡рдХреНрд░рддрд╛ рд░рд╛рд╢рд┐</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд░ рд╕реЗрдЯ рд╣реИ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , рдПрдХ рд╣реА рджрд┐рд╢рд╛ рдореЗрдВ рд╕реНрдкрд░реНрд╢ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рд╕рднреА рдШрд╛рд╕: рдЕрдХреНрд╖ рдХреЗ рд╡рд┐рдкрд░реАрдд </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рд╕рдорд╛рдзрд╛рди рдХреЗ рдкрд╣рд▓реЗ рдкрд╛рд╕ рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдо рдХреЛрдИ рд╡рдХреНрд░рддрд╛ рдорд╛рдирддреЗ рд╣реБрдП, рд╕рд╛рдорд╛рдиреНрдп рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the GenerateGrassVertex function, belowing the line declaring tangentPoint. float3 tangentNormal = float3(0, -1, 0); float3 localNormal = mul(transformMatrix, tangentNormal);</span></span></code> </pre> <br> <code>tangentNormal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реАрдзреЗ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдИ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдХреНрд╖ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ </font><font style="vertical-align: inherit;">рдЧрдпрд╛ рд╣реИ, рдЙрд╕реА рдореИрдЯреНрд░рд┐рдХреНрд╕ рджреНрд╡рд╛рд░рд╛ рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдо рд╕реНрдерд╛рдиреАрдп рд╕реНрдерд╛рди рдкрд░ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рдмрд┐рдВрджреБрдУрдВ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рдереЗред </font><font style="vertical-align: inherit;">рдЕрдм рд╣рдо рдЗрд╕реЗ рдПрдХ рдлрдВрдХреНрд╢рди рдореЗрдВ рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font></font><code>VertexOutput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдФрд░ рдлрд┐рд░ рдПрдХ рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдореЗрдВ </font></font><code>geometryOutput</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Modify the return call in GenerateGrassVertex. return VertexOutput(localPosition, uv, localNormal); тАж // Add to the geometryOutput struct. float3 normal : NORMAL; тАж // Modify the existing function signature. geometryOutput VertexOutput(float3 pos, float2 uv, float3 normal) тАж // Add to the VertexOutput function to pass the normal through to the fragment shader. o.normal = UnityObjectToWorldNormal(normal);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдирд┐рд╖реНрдХрд░реНрд╖ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рд╕рд╛рдорд╛рдиреНрдп рдХреЛ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реНрд╡ рдЕрдВрддрд░рд┐рдХреНрд╖</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореЗрдВ рдмрджрд▓ рджреЗрддреЗ </font><strong><font style="vertical-align: inherit;">рд╣реИрдВ</font></strong><font style="vertical-align: inherit;"> ; </font><font style="vertical-align: inherit;">рдПрдХрддрд╛ рд╡рд┐рд╢реНрд╡ рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рджрд┐рд╢рд╛рддреНрдордХ рдкреНрд░рдХрд╛рд╢ рдХреЗ рдореБрдЦреНрдп рд╕реНрд░реЛрдд рдХреА рджрд┐рд╢рд╛ рдХреЛ рдврд╛рд▓ рджреЗрддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдкрд░рд┐рд╡рд░реНрддрди рдЖрд╡рд╢реНрдпрдХ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рд╣рдо </font></font><code>ForwardBase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдкрдиреЗ рдХрд╛рдо рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП shader рдХреЗ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рдорд╛рдирджрдВрдбреЛрдВ рдХреА рдХрд▓реНрдкрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the ForwardBase fragment shader. float3 normal = facing &gt; 0 ? i.normal : -i.normal; return float4(normal * 0.5 + 0.5, 1); // Remove the existing return call. //return SHADOW_ATTENUATION(i);</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪреВрдБрдХрд┐ рд╣рдорд╛рд░реА рдЫрд╛рдпрд╛ рдореЗрдВ рдПрдХ </font></font><code>Cull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорд╛рди рдирд┐рд░реНрджрд┐рд╖реНрдЯ </font><font style="vertical-align: inherit;">рдХрд┐рдпрд╛ </font><font style="vertical-align: inherit;">рдЬрд╛рддрд╛ рд╣реИ </font></font><code>Off</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЗрд╕рд▓рд┐рдП рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЗ рджреЛрдиреЛрдВ рдХрд┐рдирд╛рд░реЛрдВ рдХрд╛ рдкреНрд░рддрд┐рдкрд╛рджрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рд╛рдорд╛рдиреНрдп рдХреЛ рд╕рд╣реА рджрд┐рд╢рд╛ рдореЗрдВ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рд╕рд╣рд╛рдпрдХ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ </font></font><code>VFACE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдЯреБрдХрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛрдбрд╝рд╛ рдерд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рддрд░реНрдХ </font></font><code>fixed facing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рдкрд╕ рдЖ рдЬрд╛рдПрдЧреА </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рд╕рдХрд╛рд░рд╛рддреНрдордХ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдЧрд░ рд╣рдо рд╕рддрд╣ рдХреЗ рд╕рд╛рдордиреЗ рдЪреЗрд╣рд░рд╛, рдФрд░ рдкреНрд░рджрд░реНрд╢рд┐рдд рдирдВрдмрд░ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдирдХрд╛рд░рд╛рддреНрдордХ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реИ, рддреЛ рд░рд┐рд╡рд░реНрд╕ рд╕рдВрдЦреНрдпрд╛ред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ рд╣рдо рд╕рд╛рдорд╛рдиреНрдп рдХреЛ рдлреНрд▓рд┐рдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдКрдкрд░ рджрд┐рдП рдЧрдП рдХреЛрдб рдореЗрдВ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1b/8ca/965/e1b8ca965ed8e80b539a9773d1adeb0c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрдм </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреНрд▓реЗрдб рдХреА рд╡рдХреНрд░рддрд╛ рд░рд╛рд╢рд┐</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛрддреА рд╣реИ, рддреЛ </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ </font><font style="vertical-align: inherit;">рдХреА рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрдерд┐рддрд┐ </font></font><code>forward</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд╝рдВрдХреНрд╢рди </font><font style="vertical-align: inherit;">рджреНрд╡рд╛рд░рд╛ </font><font style="vertical-align: inherit;">рдкрд╛рд░рд┐рдд </font><font style="vertical-align: inherit;">рд░рд╛рд╢рд┐ рджреНрд╡рд╛рд░рд╛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рджреА рдЬрд╛рдПрдЧреА </font></font><code>GenerateGrassVertex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╣рдо рдорд╛рдиреЛрдВ рдХреЗ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдХреНрд╖ рдХреЛ рдЖрдиреБрдкрд╛рддрд┐рдХ рд░реВрдк рд╕реЗ рд╕реНрдХреЗрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Modify the existing line in GenerateGrassVertex. float3 tangentNormal = normalize(float3(0, -1, forward));</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рдЫрд╛рдпрд╛, рджрд┐рд╢рд╛рддреНрдордХ рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рдФрд░ рдкрд░рд┐рд╡реЗрд╢ рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреЛ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдХреЛ рдЯреБрдХрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдореИрдВ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреВрди рд╢реЗрдбреНрд╕ рдкрд░</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдкрдиреЗ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓</font></a><font style="vertical-align: inherit;"> рдореЗрдВ рд╢реЗрдбреНрд╕ рдореЗрдВ рдХрд╕реНрдЯрдо рд▓рд╛рдЗрдЯрд┐рдВрдЧ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдЕрдзреНрдпрдпрди рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдВ </font><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Add to the ForwardBase fragment shader, below the line declaring float3 normal. float shadow = SHADOW_ATTENUATION(i); float NdotL = saturate(saturate(dot(normal, _WorldSpaceLightPos0)) + _TranslucentGain) * shadow; float3 ambient = ShadeSH9(float4(normal, 1)); float4 lightIntensity = NdotL * _LightColor0 + float4(ambient, 1); float4 col = lerp(_BottomColor, _TopColor * lightIntensity, i.uv.y); return col; // Remove the existing return call. //return float4(normal * 0.5 + 0.5, 1);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c14/894/d14/c14894d14edc336b770f4b94bedd3708.png"></div><br><h2>  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ, рдШрд╛рд╕ 10x10 рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЗ рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдХрд╡рд░ рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдЙрдЪреНрдЪ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдмрдирд╛рдП рд░рдЦрддреЗ рд╣реБрдП рдмрдбрд╝реЗ рдЦреБрд▓реЗ рд╕реНрдерд╛рдиреЛрдВ рдХреЛ рдХрд╡рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП shader рдХреЗ рд▓рд┐рдП, рдЕрдиреБрдХреВрд▓рди рдХрд╛ рдкрд░рд┐рдЪрдп рджрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЖрдк рджреВрд░реА рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЯреЗрд╕рд▓реЗрд╢рди рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдХреИрдорд░реЗ рд╕реЗ рджреВрд░ рдШрд╛рд╕ рдХреЗ рдХрдо рдмреНрд▓реЗрдб рдкреНрд░рджрд╛рди рдХрд┐рдП рдЬрд╛рдПрдВред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд▓рдВрдмреА рджреВрд░реА рдкрд░, рдШрд╛рд╕ рдХреЗ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдмреНрд▓реЗрдб рдХреЗ рдмрдЬрд╛рдп, рдШрд╛рд╕ рдХреЗ рд╕рдореВрд╣реЛрдВ рдХреЗ рд╕рдореВрд╣ рдХреЛ рдПрдХ рд╢рд╛рдирджрд╛рд░ рдмрдирд╛рд╡рдЯ рдХреЗ рд╕рд╛рде рдПрдХ рдПрдХрд▓ рдЪрддреБрд░реНрднреБрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЦреАрдВрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a7/a05/e86/5a7a05e8690c152f9196bb3c94fada19.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХрддрд╛ рдЗрдВрдЬрди рдХреЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдЯреИрдВрдбрд░реНрдб рдПрд╕реЗрдЯ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреИрдХреЗрдЬ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдШрд╛рд╕ рдХреА рдмрдирд╛рд╡рдЯ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдШрд╛рд╕ рдХреЗ рдХрдИ рдмреНрд▓реЗрдб рдПрдХ рдЪрддреБрд░реНрднреБрдЬ рдкрд░ рдЦреАрдВрдЪреЗ рдЬрд╛рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рджреГрд╢реНрдп рдореЗрдВ рддреНрд░рд┐рдХреЛрдгреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХрдо рд╣реЛ рдЬрд╛рддреА рд╣реИред </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рд╛рд▓рд╛рдВрдХрд┐ рдореВрд▓ рд░реВрдк рд╕реЗ рд╣рдо рд╕рддрд╣ рд╢реЗрдб рдХреЗ рд╕рд╛рде рдЬреНрдпрд╛рдорд┐рддреАрдп рд╢реЗрдбреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рдФрд░ рдЫрд╛рдпрд╛рдВрдХрди рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдореЗрдВ рд╕реБрдзрд╛рд░ рдпрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреЛ рдорд╛рдирдХ рдПрдХрддрд╛ рдкреНрд░рдХрд╛рд╢ рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдЖрдк </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдзреНрдпрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">, рдЬреЛ рдЬреА-рдмрдлрд░реНрд╕ тАЛтАЛрдХреЗ рд╡рд┐рд▓рдВрдмрд┐рдд рдФрд░ рдореИрдиреНрдпреБрдЕрд▓ рднрд░рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рд╕рдорд╕реНрдпрд╛ рдХреЗ рд╕рдорд╛рдзрд╛рди рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИред </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ Shader рд╕реНрд░реЛрдд рдХреЛрдб</font></font></a> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЬреЛрдбрд╝: рд╕рд╣рдпреЛрдЧ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдВрдЯрд░рдСрдкрд░реЗрдмрд┐рд▓рд┐рдЯреА рдХреЗ рдмрд┐рдирд╛, рдЧреНрд░рд╛рдлрд┐рдХ рдкреНрд░рднрд╛рд╡ рдЦрд┐рд▓рд╛рдбрд╝рд┐рдпреЛрдВ рдХреЛ рд╕реНрдерд┐рд░ рдпрд╛ рдмреЗрдЬрд╛рди рд▓рдЧ рд╕рдХрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдмрд╣реБрдд рд▓рдВрдмрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рдШрд╛рд╕ рдХреЗ рд╕рд╛рде рджреБрдирд┐рдпрд╛ рдХреА рд╡рд╕реНрддреБрдУрдВ рдХреА рдмрд╛рддрдЪреАрдд рдкрд░ рдПрдХ рдЦрдВрдб рдирд╣реАрдВ рдЬреЛрдбрд╝рд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрд╡рд╛рджрд╛рддреНрдордХ рдЬрдбрд╝реА-рдмреВрдЯрд┐рдпреЛрдВ рдХреЗ рдПрдХ рднреЛрд▓реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рджреЛ рдШрдЯрдХ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВрдЧреЗ: рдЦреЗрд▓ рдХреА рджреБрдирд┐рдпрд╛ рдореЗрдВ рдРрд╕рд╛ рдХреБрдЫ </font><font style="vertical-align: inherit;">рдЬреЛ рдЫрд╛рдпрд╛рджрд╛рд░ рдХреЛ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбреЗрдЯрд╛ рд╕рдВрдЪрд╛рд░рд┐рдд</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд░ рд╕рдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">рдпрд╣ рдмрддрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдШрд╛рд╕ рдХреЗ рдХрд┐рд╕ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХреА рдЬрд╛ рд░рд╣реА рд╣реИ, рдФрд░ </font><font style="vertical-align: inherit;">рдЗрд╕ рдбреЗрдЯрд╛ рдХреА </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡реНрдпрд╛рдЦреНрдпрд╛</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЫрд╛рдпрд╛ рдореЗрдВ рдХреЛрдб </font><font style="vertical-align: inherit;">рдХрд░реЗрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдиреА рдХреЗ рд╕рд╛рде рдЗрд╕реЗ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;">рд╣реИ</font></a><font style="vertical-align: inherit;"> ред </font><font style="vertical-align: inherit;">рдЗрд╕реЗ рдШрд╛рд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ; </font><font style="vertical-align: inherit;">рдЙрд╕ рд╕реНрдерд╛рди рдкрд░ рддрд░рдВрдЧреЛрдВ рдХреЛ рдЦреАрдВрдЪрдиреЗ рдХреЗ рдмрдЬрд╛рдп рдЬрд╣рд╛рдВ рдЖрдк рдкрд╛рддреНрд░ рд╣реИрдВ, рдЖрдк рдЪрд░рдгреЛрдВ рдХреЗ рдкреНрд░рднрд╛рд╡реЛрдВ рдХреЛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдШрд╛рд╕ рдХреЗ рдмреНрд▓реЗрдб рдХреЛ рдиреАрдЪреЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi458060/">https://habr.com/ru/post/hi458060/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi458046/index.html">рдЫрд▓ рдЫрд▓ рдЪрд╛рджрд░</a></li>
<li><a href="../hi458048/index.html">рдкреНрд░рдмрдВрдзрдХ рдЙрдкрдХрд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рддрд┐рдирд┐рдзрд┐рдордВрдбрд▓</a></li>
<li><a href="../hi458050/index.html">рдХреИрд╕рд╛ рдерд╛ рдореЛрдмрд┐рдпрд╕ 2019 рдкрд╛рдЗрдЯрд░ (рдФрд░ рдЕрдЧрд▓реЗ рдореЛрдмрд┐рдпрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝рд╛ рд╕рд╛)</a></li>
<li><a href="../hi458052/index.html">рд╣рдореНрдм рдХреЗ рд╕рд╛рде рдПрдПрдордП ред10ред рдЕрдВрддрд┐рдо * рдореБрджреНрджрд╛</a></li>
<li><a href="../hi458056/index.html">рдорд╛рд░реНрдЯрд┐рди рдХреНрд▓реЗрдкрдореИрди рдХреЗ рд╕рд╛рде рдмрдбрд╝рд╛ рд╕рд╛рдХреНрд╖рд╛рддреНрдХрд╛рд░: "рд╡рд┐рддрд░рд┐рдд рдбреЗрдЯрд╛ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рднрд╡рд┐рд╖реНрдп рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛"</a></li>
<li><a href="../hi458062/index.html">рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдЧреЗрдЯ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдЕрд╡рд▓реЛрдХрди</a></li>
<li><a href="../hi458064/index.html">рдкреАрд╡реАрдПрд╕-рд╕реНрдЯреВрдбрд┐рдпреЛ рдЗрди рдж рдХреНрд▓рд╛рдЙрдбреНрд╕ - рд░рдирд┐рдВрдЧ рдПрдирд╛рд▓рд┐рд╕рд┐рд╕ рдСрди рдЯреНрд░реИрд╡рд┐рд╕ рд╕реАрдЖрдИ</a></li>
<li><a href="../hi458068/index.html">рджреГрд╢реНрдп рд╕реНрдЯреВрдбрд┐рдпреЛ рдХреЗ рд▓рд┐рдП рдкреАрд╡реАрдПрд╕-рд╕реНрдЯреВрдбрд┐рдпреЛ</a></li>
<li><a href="../hi458070/index.html">рджреГрд╢реНрдп рд╕реНрдЯреВрдбрд┐рдпреЛ рдХреЗ рд▓рд┐рдП рдкреАрд╡реАрдПрд╕-рд╕реНрдЯреВрдбрд┐рдпреЛ</a></li>
<li><a href="../hi458072/index.html">рдкреАрд╡реАрдПрд╕-рд╕реНрдЯреВрдбрд┐рдпреЛ рдмрд╛рджрд▓реЛрдВ рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИ - рдЯреНрд░реИрд╡рд┐рд╕ рд╕реАрдЖрдИ рдкрд░ рд▓реЙрдиреНрдЪ рд╡рд┐рд╢реНрд▓реЗрд╖рдг</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>