<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÖ üéÇ üë©üèø‚Äçü§ù‚Äçüë®üèΩ Como escalar data centers. Relat√≥rio Yandex üëºüèæ üëºüèº üç•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Desenvolvemos um design de uma rede de data centers, que permite implantar clusters de computa√ß√£o com mais de 100 mil servidores com uma largura de ba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como escalar data centers. Relat√≥rio Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/476146/"> Desenvolvemos um design de uma rede de data centers, que permite implantar clusters de computa√ß√£o com mais de 100 mil servidores com uma largura de banda de bissec√ß√£o de mais de um petabit por segundo. <br><br>  No relat√≥rio de Dmitry Afanasyev, voc√™ aprender√° sobre os princ√≠pios b√°sicos do novo design, dimensionamento de topologias que surgem com esses problemas, solu√ß√µes para eles, sobre os recursos de roteamento e dimensionamento das fun√ß√µes do plano de encaminhamento de dispositivos de rede modernos em dispositivos de rede modernos em topologias "densamente conectadas" com um grande n√∫mero de rotas ECMP .  Al√©m disso, Dima falou brevemente sobre a organiza√ß√£o da conectividade externa, o n√≠vel f√≠sico, o sistema de cabos e maneiras de aumentar ainda mais a capacidade. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/rd/dy/sc/rddysciofis_rkvkotpo1tr52i0.jpeg"></a> <br><br>  Boa tarde a todos!  Meu nome √© Dmitry Afanasyev, sou arquiteto de redes da Yandex e lida principalmente com o design de redes de data center. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/zv/gl/5v/zvgl5vyexhel7a_6_mxp8wm4qoe.jpeg"><br><br>  Minha hist√≥ria ser√° sobre a rede atualizada do data center Yandex.  Isso √© basicamente uma evolu√ß√£o do design que t√≠nhamos, mas ao mesmo tempo existem alguns elementos novos.  Esta √© uma apresenta√ß√£o de revis√£o, uma vez que era necess√°rio reunir muitas informa√ß√µes em pouco tempo.  Come√ßamos escolhendo uma topologia l√≥gica.  Depois, haver√° uma vis√£o geral do plano de controle e os problemas com a escalabilidade do plano de dados, a escolha do que acontecer√° no n√≠vel f√≠sico, vejamos alguns recursos dos dispositivos.  Tamb√©m abordaremos o que est√° acontecendo no data center com o MPLS, sobre o qual falamos h√° algum tempo. <br><br><img src="https://habrastorage.org/webt/ew/lm/rc/ewlmrcydwmv1s3gz2irvhuyev-q.jpeg"><br><br>  Ent√£o, o que √© o Yandex em termos de cargas de trabalho e servi√ßos?  Yandex √© um hiperscaler t√≠pico.  Se voc√™ olhar na dire√ß√£o dos usu√°rios, processamos principalmente solicita√ß√µes de usu√°rios.  Al√©m disso, v√°rios servi√ßos de streaming e sa√≠da de dados, porque tamb√©m temos servi√ßos de armazenamento.  Se estiver mais pr√≥ximo do back-end, as cargas e os servi√ßos de infraestrutura aparecer√£o, como armazenamentos de objetos distribu√≠dos, replica√ß√£o de dados e, √© claro, filas persistentes.  Um dos principais tipos de cargas √© o MapReduce e similares, processamento de streaming, aprendizado de m√°quina etc. <br><br><img src="https://habrastorage.org/webt/qi/71/qd/qi71qdjq7zbaxhmfmqbd6y66fba.jpeg"><br><br>  Como est√° a infraestrutura em cima da qual tudo isso acontece?  Novamente, somos um hiperskaler muito t√≠pico, embora talvez estejamos um pouco mais perto do lado do espectro onde os hiperskalers menores est√£o localizados.  Mas temos todos os atributos.  Utilizamos hardware comum e escala horizontal sempre que poss√≠vel.  Temos um crescimento total do pool de recursos: n√£o trabalhamos com m√°quinas separadas, racks separados, mas as combinamos em um grande pool de recursos intercambi√°veis ‚Äã‚Äãcom alguns servi√ßos adicionais envolvidos no planejamento e aloca√ß√£o, e trabalhamos com todo esse pool. <br><br>  Portanto, temos o pr√≥ximo n√≠vel - o cluster de computa√ß√£o no n√≠vel do sistema operacional.  √â muito importante que controlemos completamente a pilha de tecnologia que usamos.  Controlamos pontos finais (hosts), rede e pilha de software. <br><br>  Temos v√°rios grandes centros de dados na R√∫ssia e no exterior.  Eles s√£o unidos por um backbone usando a tecnologia MPLS.  Nossa infraestrutura interna √© quase toda baseada em IPv6, mas como precisamos lidar com o tr√°fego externo, que ainda √© entregue principalmente via IPv4, precisamos entregar as solicita√ß√µes que chegam via IPv4 aos servidores front-end e ainda vamos um pouco ao IPv4 externo. Internet - por exemplo, para indexa√ß√£o. <br><br>  As √∫ltimas itera√ß√µes do design de rede do datacenter usam topologias Clos de v√°rios n√≠veis e apenas L3 √© usado nelas.  Sa√≠mos de L2 h√° algum tempo e respiramos aliviados.  Por fim, nossa infraestrutura inclui centenas de milhares de inst√¢ncias de computa√ß√£o (servidor).  O tamanho m√°ximo do cluster h√° algum tempo era de cerca de 10 mil servidores.  Isso se deve em grande parte √† maneira como os mesmos sistemas operacionais em n√≠vel de cluster - agendadores, aloca√ß√£o de recursos etc. - Como o progresso ocorreu no lado do software de infraestrutura, agora o destino √© de cerca de 100 mil servidores em um cluster de computa√ß√£o e tivemos uma tarefa - poder construir f√°bricas de rede que permitissem um pool eficiente de recursos nesse cluster. <br><br><img src="https://habrastorage.org/webt/ra/co/cb/racocb4wtrqihsf4qcpswzzihhc.jpeg"><br><br>  O que queremos de uma rede de data center?  Primeiro de tudo - muita largura de banda barata e uniformemente distribu√≠da.  Porque a rede √© aquele substrato atrav√©s do qual podemos fazer o pool de recursos.  O novo tamanho de destino √© de cerca de 100 mil servidores em um cluster. <br><br>  Al√©m disso, √© claro, queremos um plano de controle escal√°vel e est√°vel, porque em uma infraestrutura t√£o grande surgem muitas dores de cabe√ßa, mesmo a partir de eventos aleat√≥rios, e n√£o queremos que o plano de controle nos cause dor de cabe√ßa.  Ao mesmo tempo, queremos minimizar o estado nele.  Quanto menor a condi√ß√£o, melhor e mais est√°vel tudo funciona, mais f√°cil √© diagnosticar. <br><br>  Obviamente, precisamos de automa√ß√£o, porque √© imposs√≠vel gerenciar essa infraestrutura manualmente, e isso era imposs√≠vel h√° algum tempo.  Sempre que poss√≠vel, precisamos de suporte operacional e de CI / CD, na medida do poss√≠vel. <br><br>  Com esses tamanhos de datacenters e clusters, a tarefa de oferecer suporte √† implanta√ß√£o e expans√£o incrementais sem interrup√ß√£o do servi√ßo tornou-se bastante aguda.  Se em clusters o tamanho de mil carros √© provavelmente pr√≥ximo a dez mil m√°quinas, eles ainda podem ser implementados como uma opera√ß√£o - ou seja, estamos planejando expandir a infraestrutura e v√°rios milhares de m√°quinas s√£o adicionados como uma opera√ß√£o, e um cluster do tamanho de cem mil carros n√£o assim, ele foi constru√≠do por algum tempo.  E √© desej√°vel que todo esse tempo o que j√° foi divulgado, a infraestrutura implantada, esteja dispon√≠vel. <br><br>  E um requisito que t√≠nhamos e deixamos: o suporte √† multiloca√ß√£o, ou seja, virtualiza√ß√£o ou segmenta√ß√£o de rede.  Agora, n√£o precisamos fazer isso no n√≠vel da f√°brica de rede, porque a segmenta√ß√£o foi para os hosts, e isso facilitou muito o dimensionamento.  Gra√ßas ao IPv6 e a um grande espa√ßo de endere√ßo, n√£o precisamos usar endere√ßos duplicados na infraestrutura interna, todo o endere√ßamento j√° era exclusivo.  E devido ao fato de levarmos a filtragem e a segmenta√ß√£o de rede para os hosts, n√£o precisamos criar nenhuma entidade de rede virtual nas redes do data center. <br><br><img src="https://habrastorage.org/webt/nx/hi/9l/nxhi9l-ggxw-kvhbuoeldgkhnno.jpeg"><br><br>  Uma coisa muito importante √© que n√£o precisamos.  Se algumas fun√ß√µes puderem ser removidas da rede, isso simplifica muito a vida e, via de regra, expande a escolha do hardware e software dispon√≠vel e simplifica muito o diagn√≥stico. <br><br>  Ent√£o, do que n√£o precisamos, do que fomos capazes de recusar, nem sempre com alegria no momento em que isso aconteceu, mas com grande al√≠vio quando o processo foi conclu√≠do? <br><br>  Primeiro de tudo, a rejei√ß√£o de L2.  N√£o precisamos de L2 real ou emulado.  N√£o √© utilizado em grande parte devido ao fato de controlarmos a pilha de aplicativos.  Nossos aplicativos s√£o dimensionados horizontalmente, trabalham com endere√ßamento L3, n√£o se preocupam com o fato de uma inst√¢ncia espec√≠fica estar desativada, apenas lan√ßam uma nova, n√£o precisam ser lan√ßadas no endere√ßo antigo, porque existe um n√≠vel separado de descoberta de servi√ßo e monitoramento de m√°quinas localizadas no cluster .  N√£o transferimos essa tarefa para a rede.  A tarefa da rede √© entregar pacotes do ponto A ao ponto B. <br><br>  Al√©m disso, n√£o temos situa√ß√µes em que endere√ßos se movam dentro da rede, e isso precisa ser monitorado.  Em muitos projetos, isso geralmente √© necess√°rio para dar suporte √† mobilidade da VM.  N√£o usamos a mobilidade de m√°quinas virtuais na infraestrutura interna exatamente do grande Yandex e, al√©m disso, acreditamos que, mesmo que isso seja feito, isso n√£o deve acontecer com o suporte de rede.  Se voc√™ realmente precisar fazer isso, precisar√° fazer isso no n√≠vel do host e direcionar os endere√ßos que podem ser migrados para sobreposi√ß√µes para n√£o tocar ou fazer muitas altera√ß√µes din√¢micas no subjacente do pr√≥prio sistema de roteamento (rede de transporte). <br><br>  Outra tecnologia que n√£o usamos √© o multicast.  Eu posso lhe dizer em detalhes o porqu√™.  Isso facilita muito a vida, porque se algu√©m lida com ele e observa como √© exatamente o plano de controle de um multicast - em todas as instala√ß√µes, exceto a mais simples, √© uma grande dor de cabe√ßa.  Al√©m disso, √© dif√≠cil encontrar uma implementa√ß√£o de c√≥digo aberto que funcione bem, por exemplo. <br><br>  Por fim, projetamos nossas redes para que elas n√£o tenham muitas mudan√ßas.  Podemos contar com o fato de que o fluxo de eventos externos no sistema de roteamento √© pequeno. <br><br><img src="https://habrastorage.org/webt/qa/nz/e3/qanze3l9jiktreg59urwgnfmpec.jpeg"><br><br>  Quais problemas surgem e quais limita√ß√µes devem ser levadas em considera√ß√£o quando desenvolvemos uma rede de data center?  Custo do curso.  Escalabilidade, em que n√≠vel queremos crescer.  A necessidade de expans√£o sem interromper o servi√ßo.  Disponibilidade de largura de banda.  A visibilidade do que est√° acontecendo na rede, para sistemas de monitoramento, para equipes operacionais.  O suporte √† automa√ß√£o √©, novamente, o m√°ximo poss√≠vel, pois tarefas diferentes podem ser resolvidas em diferentes n√≠veis, incluindo a introdu√ß√£o de camadas adicionais.  Bem e n√£o - sempre que poss√≠vel - depend√™ncia de fornecedores.  Embora em per√≠odos hist√≥ricos diferentes, dependendo de qual se√ß√£o examinar, essa independ√™ncia foi mais f√°cil ou mais dif√≠cil de alcan√ßar.  Se pegarmos uma fatia dos chips de dispositivos de rede, at√© recentemente, falaremos sobre independ√™ncia dos fornecedores; se tamb√©m desej√°ssemos chips com alto rendimento, isso poderia ser muito arbitr√°rio. <br><br><img src="https://habrastorage.org/webt/fd/bq/s1/fdbqs1_kegdd7s4twvg144y0rus.jpeg"><br><br>  Que topologia l√≥gica usaremos para construir nossa rede?  Este ser√° um Clos de v√°rios n√≠veis.  De fato, atualmente n√£o h√° alternativas reais.  E a topologia Clos √© boa o suficiente, mesmo se a compararmos com v√°rias topologias avan√ßadas que agora est√£o mais na esfera do interesse acad√™mico, se tivermos comutadores com uma grande raiz. <br><br><img src="https://habrastorage.org/webt/4y/pk/tt/4ypkttuvzezqubmxx3te-envyzo.jpeg"><br><br>  Como a rede Clos em camadas √© aproximadamente estruturada e como s√£o chamados os diferentes elementos nela?  Primeiro de tudo, o vento aumentou, para descobrir onde o norte, onde o sul, onde o leste, onde o oeste.  Redes desse tipo geralmente s√£o constru√≠das por aqueles que t√™m um tr√°fego muito grande oeste - leste.  Quanto ao restante dos elementos, um comutador virtual montado a partir de comutadores menores √© mostrado na parte superior.  Essa √© a id√©ia b√°sica de criar recursivamente redes Clos.  Pegamos elementos com algum tipo de raiz e os conectamos para que o que aconteceu possa ser considerado como um interruptor com uma raiz maior.  Se voc√™ precisar ainda mais, o procedimento pode ser repetido. <br><br>  Nos casos, por exemplo, no Clos de dois n√≠veis, quando √© poss√≠vel distinguir claramente os componentes verticais no meu diagrama, eles geralmente s√£o chamados de planos.  Se constru√≠mos o Clos com tr√™s n√≠veis de spine switches (todos que n√£o s√£o lim√≠trofes e nem ToR-switches e que s√£o usados ‚Äã‚Äãapenas para tr√¢nsito), os avi√µes pareceriam mais complicados, os dois n√≠veis seriam assim.  O bloco de ToR ou interruptores de folha e os interruptores associados da coluna de primeiro n√≠vel que chamamos de Pod.  Os interruptores de n√≠vel 1 da coluna na parte superior do Pod s√£o a parte superior do Pod, a parte superior do Pod.  Os comutadores localizados na parte superior de toda a f√°brica s√£o a camada superior da f√°brica, a parte superior do tecido. <br><br><img src="https://habrastorage.org/webt/k-/sk/dd/k-skddvn98f6y-jk2e_5zzvlm4a.jpeg"><br><br>  Obviamente, surge a pergunta: as redes Clos foram criadas h√° algum tempo, a id√©ia em si geralmente vem dos dias da telefonia cl√°ssica, das redes TDM.  Talvez algo melhor apareceu, talvez voc√™ possa fazer algo melhor de alguma forma?  Sim e n√£o  Teoricamente, sim, na pr√°tica, em um futuro pr√≥ximo, definitivamente n√£o.  Como existem v√°rias topologias interessantes, algumas delas s√£o usadas at√© na produ√ß√£o, por exemplo, o Dragonfly √© usado em aplicativos HPC;  Tamb√©m existem topologias interessantes, como Xpander, FatClique, Jellyfish.  Se voc√™ olhar relat√≥rios em confer√™ncias como SIGCOMM ou NSDI nos √∫ltimos tempos, poder√° encontrar um n√∫mero bastante grande de artigos sobre topologias alternativas que possuem melhores propriedades (uma ou outra) que Clos. <br><br>  Mas todas essas topologias t√™m uma propriedade interessante.  Isso impede sua implementa√ß√£o nas redes de data centers, que estamos tentando construir em hardware comum e que custam dinheiro razoavelmente razo√°vel.  Em todas essas topologias alternativas, infelizmente, a maioria da banda n√£o √© acess√≠vel pelos caminhos mais curtos.  Portanto, perdemos imediatamente a capacidade de usar o plano de controle tradicional. <br><br>  Teoricamente, a solu√ß√£o para o problema √© conhecida.  Essas s√£o, por exemplo, modifica√ß√µes do estado do link usando o caminho mais curto k, mas, novamente, n√£o h√° protocolos que seriam implementados na produ√ß√£o e dispon√≠veis massivamente nos equipamentos. <br><br>  Al√©m disso, como a maior parte da capacidade n√£o √© acess√≠vel pelos caminhos mais curtos, precisamos modificar n√£o apenas o plano de controle para selecionar todos esses caminhos (e, a prop√≥sito, esse √© um estado muito maior no plano de controle).  Ainda precisamos modificar o plano de encaminhamento e, em regra, s√£o necess√°rios pelo menos dois recursos adicionais.  Esta √© uma oportunidade para tomar todas as decis√µes sobre o encaminhamento de pacotes uma vez, por exemplo, em um host.  Na verdade, esse √© o roteamento de origem, √†s vezes na literatura sobre redes de interconex√£o √© chamado de decis√µes de encaminhamento de uma vez.  E o roteamento adapt√°vel j√° √© uma fun√ß√£o que precisamos nos elementos da rede, que se resume, por exemplo, ao fato de selecionar o pr√≥ximo salto com base em informa√ß√µes sobre a menor carga na fila.  Como exemplo, outras op√ß√µes s√£o poss√≠veis. <br><br>  Portanto, a dire√ß√£o √© interessante, mas, infelizmente, n√£o podemos aplic√°-la agora. <br><br><img src="https://habrastorage.org/webt/5d/ki/zy/5dkizyihr8k0owfwar8yjdkx5m0.jpeg"><br><br>  Ok, resolvemos a topologia l√≥gica de Clos.  Como vamos escalar isso?  Vamos ver como funciona e o que pode ser feito. <br><br><img src="https://habrastorage.org/webt/ap/dy/-2/apdy-2dnjdljys76pfv4rw7sr-k.jpeg"><br><br>  Na rede Clos, existem dois par√¢metros principais que podemos, de alguma forma, variar e obter certos resultados: elementos de base e o n√∫mero de n√≠veis na rede.  Descrevo esquematicamente como um e outro afetam o tamanho.  Idealmente, combinamos ambos. <br><br><img src="https://habrastorage.org/webt/5d/ki/zy/5dkizyihr8k0owfwar8yjdkx5m0.jpeg"><br><br>  Pode-se observar que a largura total da rede Clos √© um produto de todos os n√≠veis de comutadores da coluna do radix sul, quantos links temos, como ele se ramifica.  √â assim que dimensionamos o tamanho da rede. <br><br><img src="https://habrastorage.org/webt/ap/dy/-2/apdy-2dnjdljys76pfv4rw7sr-k.jpeg"><br><br>  Quanto √† capacidade, especialmente nos switches ToR, existem duas op√ß√µes de dimensionamento.  Enquanto mantemos a topologia geral, podemos usar links mais r√°pidos ou podemos adicionar mais planos. <br><br>  Se voc√™ olhar a vers√£o detalhada da rede Clos (no canto inferior direito) e retornar a esta imagem com a rede Clos abaixo ... <br><br><img src="https://habrastorage.org/webt/4y/pk/tt/4ypkttuvzezqubmxx3te-envyzo.jpeg"><br><br>  ... ent√£o essa √© exatamente a mesma topologia, mas neste slide ela √© recolhida de forma mais compacta e os planos de f√°brica s√£o sobrepostos.  √â um e o mesmo. <br><br><img src="https://habrastorage.org/webt/n9/ny/zd/n9nyzdzmz4i8o_c-adybirjhfos.jpeg"><br><br>  Como √© o dimensionamento de uma rede Clos em n√∫meros?  Aqui eu tenho dados sobre qual a largura m√°xima que uma rede pode obter, qual o n√∫mero m√°ximo de racks, ToR-switches ou leaf-switches, se eles n√£o estiverem em racks, podemos obter dependendo da quantidade de switches que usamos para espinhos n√≠veis e quantos n√≠veis usamos. <br><br>  Ele mostra quantos racks podemos ter, quantos servidores e quanto tudo isso pode consumir √† taxa de 20 kW por rack.  Um pouco antes, mencionei que buscamos um tamanho de cluster de cerca de 100 mil servidores. <br><br>  Pode-se observar que em toda essa constru√ß√£o duas op√ß√µes e meia s√£o de interesse.  Existe uma op√ß√£o com duas camadas de espinhos e comutadores de 64 portas, o que √© um pouco curto.  Em seguida, op√ß√µes perfeitamente ajustadas para spine switches de 128 portas (com 128 radix) com dois n√≠veis ou switches com um radix 32 com tr√™s n√≠veis.  E em todos os casos em que h√° mais radix e mais n√≠veis, voc√™ pode criar uma rede muito grande, mas, se observar o consumo esperado, em regra, h√° gigawatts.  Voc√™ pode colocar o cabo, mas √© improv√°vel que obtenhamos tanta eletricidade em um site.  Se voc√™ olhar para estat√≠sticas, dados p√∫blicos sobre data centers - muito poucos data centers podem ser encontrados para uma capacidade estimada de mais de 150 MW.  Al√©m disso, como regra, campus de data center, v√°rios grandes data centers localizados bem pr√≥ximos um do outro. <br><br>  H√° outro par√¢metro importante.  Se voc√™ olhar para a coluna da esquerda, a largura de banda utiliz√°vel √© indicada l√°.  √â f√°cil perceber que em uma rede Clos, uma parte significativa das portas √© gasta na conex√£o dos comutadores entre si.  Largura de banda utiliz√°vel √© o que voc√™ pode distribuir para os servidores.  Naturalmente, estou falando sobre portas condicionais e sobre a faixa.  Como regra, os links dentro da rede s√£o mais r√°pidos que os links para os servidores, mas por unidade de banda, na medida em que podemos distribu√≠-lo aos nossos equipamentos de servidor, ainda existem mais bandas na pr√≥pria rede.  E quanto mais n√≠veis fizermos, maiores ser√£o os custos unit√°rios para fornecer essa faixa para o exterior. <br><br>  Al√©m disso, mesmo essa banda extra n√£o √© exatamente a mesma.  Embora os v√£os sejam curtos, podemos usar algo como DAC (cobre de conex√£o direta, ou seja, cabos twinax) ou √≥ptica multimodo, que custa ainda mais ou menos dinheiro razo√°vel.  Assim que passamos a abranger de forma mais autentica - em regra, trata-se de √≥ptica de modo √∫nico e o custo dessa banda adicional aumenta acentuadamente. <br><br>  E, voltando ao slide anterior, se fizermos uma rede Clos sem precisar se inscrever novamente, ser√° f√°cil olhar para o diagrama, ver como a rede √© constru√≠da - adicionando cada n√≠vel de switches da coluna, repetimos toda a faixa abaixo.  N√≠vel positivo - mais a mesma banda, o mesmo n√∫mero de portas nos comutadores que no n√≠vel anterior, o mesmo n√∫mero de transceptores.  Portanto, √© muito desej√°vel minimizar o n√∫mero de n√≠veis de comutadores da coluna. <br><br>  Com base nesta imagem, √© claro que realmente queremos construir algo como switches com um radix de 128. <br><br><img src="https://habrastorage.org/webt/lh/hu/qu/lhhuquq763qnw40v3n66copxa5w.jpeg"><br><br>  Aqui, em princ√≠pio, tudo √© o mesmo que acabei de dizer, √© mais prov√°vel que esse slide seja considerado mais tarde. <br><br><img src="https://habrastorage.org/webt/ci/yy/zi/ciyyzijzbhajnlsarxtn-tcoybo.jpeg"><br><br>   ,        ?     ,     -      .    ,     . ,      .  ,    .  ,   ,  ,  , .        ( ),       control plane    , , ,     ,       .        ,    ,     . <br><br> , ,    ,         SerDes- ‚Äî  -   .          forwarding .  ,    ,     ,  ,  ,     Clos-,     .      . <br><br>       ,    ,      .     ,      ,   ,    ,     ,      ,        ,    ,       ,   . <br><br><img src="https://habrastorage.org/webt/8y/in/ym/8yinymhp1wcbtuhl6tbvooghq24.jpeg"><br><br>      ‚Äî   , .  ,  ,   .     ,    ,  ,    -           ,    . ,    ,   ,  ,    . <br><br> ,  ,     ,   . -,    ,    .    ,    ,   128 ,              . <br><br>       ,  , ,    data plane.  . ,  ,   .  ,          ,      ,     . ,   ,   , ,    128    ,       .            .       .          . <br><br>   ,    -  ,    .   ( ),   ,    ‚Äî ToR-  leaf-,        .     -   ,    ,            , , -    .   ,     ,         ,    -    . <br><br><img src="https://habrastorage.org/webt/wc/yl/hl/wcylhl91sqnrvns5wqmembthdaa.jpeg"><br><br> ,        ,    . <br><br><img src="https://habrastorage.org/webt/uz/mo/ng/uzmongpipgv1bxt94ksbvlkruvi.jpeg"><br><br>     ?   .       ,       ,   ,       :    leaf-,   1,   2. ,     ‚Äî  twinax, multimode, single mode.    ,   ,    ,   ,    ,     . <br><br>       .    ,   ,   multimode ,      ,  ,  100-  .  , ,  ,  single mode ,    ,   single mode,  -      CWDM,   single mode (PSM)    ,     ,      ,      . <br><br>   :  ,      100  425  .      SFP28    ,  QSFP28  100 .     multimode   . <br><br>    - ,  -   , -    -   .  ,         .  , -   Pods      twinax- ( ). <br><br>  ,         ,     ,          CWDM.     . <br><br><img src="https://habrastorage.org/webt/ea/ci/pf/eacipf4xy2usawno2ccx4ucuwsm.jpeg"><br><br>   ,   ,      . ,   ,      50- SerDes      .  ,   ,           400G,      50G SerDes-   ,       100 Gbps per lane.   ,     50    100- SerDes  100 Gbps per lane,           . ,  50G SerDes   , ,    ,   100G SerDes         .   -    , ,    . <br><br><img src="https://habrastorage.org/webt/uz/mo/ng/uzmongpipgv1bxt94ksbvlkruvi.jpeg"><br><br>      .  ,      400-  200-    50G SerDes.  ,      ,  ,    ,       ,   , .   128.            ,  , , ,  . <br><br>         ,      ,    .     ,     ,    ,        , ,    100- ,       . <br><br><img src="https://habrastorage.org/webt/0b/r0/or/0br0oryllu-b_r4p9fcbino5bks.jpeg"><br><br>   ‚Äî   ,       . ,     .   leaf-     ‚Äî     ,     .       , ,    ‚Äî            . <br><br> ,  ,     ,      -. ,           ,   -       -,      .     .      ,  ,   ,       .           -  -,                -,     ,       ,  ,       .      :        .   -   , ¬´ ¬ª,      Clos-,      .     ,    ,   . <br><br><img src="https://habrastorage.org/webt/1t/hu/rq/1thurqskba0vbopspd3nhpfgsus.jpeg"><br><br>          .        -  ,   ,       ,      ,    -2-. <br><br>    .       ,      - 512  512 ,    ,      ,     -2.            Pods   -1,      -,      -2. <br><br><img src="https://habrastorage.org/webt/c6/gv/mr/c6gvmrqk7tjkdwxuvopyn76gvn8.jpeg"><br><br>  Aqui est√° como fica.      -2 ()   -.  ,      .            -,  .    ,   ,   . <br><br><img src="https://habrastorage.org/webt/ip/gh/sd/ipghsdpwb_goedtygn0bpaj89kq.jpeg"><br><br>  :   ,  .    control plane-?      ,  -  ,  link state  ,    , ,  ,       .     ,    ‚Äî  ,     link state .     ,   ,    , ,        fanout,     control plane .          link state    . <br><br>  ‚Äî  BGP.    ,   RFC 7938   BGP   -.   :            ,  ,   ,   path hunting.    ,    , ,   valley free.  ,  ,   ,    .    ,   ,     .    .   . <br><br>   ,     ,     BGP.      eBGP,   link local,      :    ToR,      -1-  Pod,       Top of Fabric.      ,       BGP     ,   . <br><br><img src="https://habrastorage.org/webt/hw/ep/kf/hwepkfz0cr9y5fhmdix0xbvhv00.jpeg"><br><br> ,       ,      ,   ,     control plane. L3      ,       ,         .     ‚Äî  ,  ,  ,      multi-path,       multi-path   ,  ,    ,    .  ,          ,     ,    ,      ,   .     ,    multi-path,     ToR-. <br><br><img src="https://habrastorage.org/webt/md/ce/zb/mdcezbkgiaxpdjcs1llfgnsvvps.jpeg"><br><br>   ,  ,   ‚Äî           .     ,   ,    ,        ,     BGP,    .  ,  corner cases    ,     BGP        . <br><br>           RIFT,       . <br><br><img src="https://habrastorage.org/webt/0u/h7/uq/0uh7uqwufze4nmj1oqrb6kun2jm.jpeg"><br><br>     ‚Äî  ,   data plane   ,        .       : ECMP ,       Next Hop. <br><br>    ,  ,     Clos- ,     ,   ,   ,  ,   .       ,     ECMP,  single path-.  .   ,   Clos-   ,      Top of fabric,   ,        .      ,            ,     .     ,     ECMP     state. <br><br>    data plane   ?    LPM (longest prefix match),   ,  100 .    Next Hop ,   , 2-4 .    ,    Next Hops ( adjacencies),   -  16  64.     .       :     MPLS  -?  ,    . <br><br><img src="https://habrastorage.org/webt/ze/ub/bj/zeubbjnb97nq_gvoprd374lotda.jpeg"><br><br>   .     ,        .                 white boxes  MPLS.   MPLS,   ,   ,  ,     ECMP.  E aqui est√° o porqu√™. <br><br><img src="https://habrastorage.org/webt/fc/za/pr/fczaprpywdv5b1jhoqrn9lxq8ti.jpeg"><br><br>    ECMP-  IP.                 Next Hops ( adjacencies,          -).   ,           -,     Next Hop.  IP   ,             ,      Next Hops. <br><br><img src="https://habrastorage.org/webt/n5/bl/jw/n5bljwqyrivakkgc2_f8cl4oifw.jpeg"><br><br>   MPLS ,            .          Next Hops    .  , ,  . <br><br>  ,         4000 ToR-,   ‚Äî 64  ECMP,    -1   -2.    ,  ,    ECMP-,      ToR ,       Next Hops. <br><br><img src="https://habrastorage.org/webt/ut/rz/jf/utrzjfe-ddmgf0dxjbq5ipxukcs.jpeg"><br><br>   ,     Segment Routing   .          Next Hops.      wild card:           .   ,       . <br><br>  ,    -   .   ?     Clos- .     ,       Top of fabric.          .  ,         ,       Top of fabric,      , ,          . ,   ,      ,     ,      . <br><br>   ‚Äî    .  ,  Clos-  ,  ,  ,     ToR,       Top of fabric   ,   .      Pod, Edge Pod,    . <br><br>    . , ,  Facebook.     Fabric Aggregator  HGRID.   -,    -.   ,           .   ,   touch points,  .  ,       ,    -.      ,    -  ,       ,       .  , ,    .    overlays,    . <br><br><img src="https://habrastorage.org/webt/mw/sj/ci/mwsjcikq0-fdqoklr0nal6vtjtg.jpeg"><br><br>     ?    ‚Äî   CI/CD-.    ,   ,   ,  .     ,    ,     .  ,       ,     . <br><br>  ,       .       .      ‚Äî  . <br><br>      .      ,  RIFT.        congestion control , , ,      ,  RDMA   . <br><br>        ,    , , ,   overhead.    ‚Äî        HPC Cray Slingshot,     commodity Ethernet,        .   overhead . <br><br><img src="https://habrastorage.org/webt/ja/-z/yx/ja-zyxc9orfwrz1lryew_4jt7r4.jpeg"><br><br>     ,  ,   .  ‚Äî  .     ‚Äî  .   -  scale out ‚Äî .  ,     .    .  Obrigada </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt476146/">https://habr.com/ru/post/pt476146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt476134/index.html">MONQ - monitoramento e AIOps origin√°rios da R√∫ssia</a></li>
<li><a href="../pt476138/index.html">Os astr√¥nomos acreditam que os sat√©lites de comunica√ß√£o SpaceX, OneWeb e outras empresas amea√ßam o futuro da astronomia</a></li>
<li><a href="../pt476140/index.html">Como melhorar a audi√ß√£o se voc√™ conhece 7.000 palavras, mas n√£o entende de ouvido?</a></li>
<li><a href="../pt476142/index.html">Por que evitar usar exce√ß√µes para controlar seu fluxo em Java</a></li>
<li><a href="../pt476144/index.html">Como voc√™ precisa e n√£o precisa escrever um chat para bots usando o exemplo do meu bot para jogar Secret Santa</a></li>
<li><a href="../pt476148/index.html">postfix + dovecot + mysql no FreeBSD</a></li>
<li><a href="../pt476156/index.html">Resposta de solicita√ß√£o s√≠ncrona usando Apache Kafka</a></li>
<li><a href="../pt476160/index.html">O nascimento do software educacional e sua hist√≥ria: das m√°quinas mec√¢nicas aos primeiros computadores</a></li>
<li><a href="../pt476162/index.html">Criamos uma aplica√ß√£o web moderna. Familiaridade com o projeto e prepara√ß√£o para o trabalho. Parte 1</a></li>
<li><a href="../pt476164/index.html">"Isso tamb√©m √© an√°lise de dados." Fale sobre bioinform√°tica com Mikhail Gelfand</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>