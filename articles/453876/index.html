<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úãüèΩ üî∞ üó°Ô∏è Como en Yandex.Practicum, gan√≥ la desincronizaci√≥n frontal: un n√∫mero acrob√°tico con Redux-Saga, postMessage y Jupyter ü§º üçÑ üå≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mi nombre es Artyom Nesmiyanov, soy un desarrollador de pila completa en Yandex.Practicum, principalmente trato con la interfaz. Creemos que es posibl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como en Yandex.Practicum, gan√≥ la desincronizaci√≥n frontal: un n√∫mero acrob√°tico con Redux-Saga, postMessage y Jupyter</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/453876/">  Mi nombre es Artyom Nesmiyanov, soy un desarrollador de pila completa en Yandex.Practicum, principalmente trato con la interfaz.  Creemos que es posible y necesario estudiar programaci√≥n, an√°lisis de datos y otras manualidades digitales con placer.  Y comienza a aprender y contin√∫a.  Cualquier desarrollador que no se haya rendido a s√≠ mismo siempre est√° "continuando".  Nosotros tambi√©n  Por lo tanto, percibimos las tareas laborales como un formato de aprendizaje.  Y uno de los recientes nos ayud√≥ a m√≠ y a los muchachos a comprender mejor en qu√© direcci√≥n desarrollar nuestra pila de frontend. <br><br><img src="https://habrastorage.org/webt/u2/uh/nx/u2uhnxzsc0hv3v7clkqskbzwnc0.png"><br><br><h3>  De qui√©n y de qu√© est√° hecho el taller </h3><br>  Nuestro equipo de desarrollo es extremadamente compacto.  Solo hay dos personas en el backend, en el front-end: cuatro, consider√°ndome, una pila completa.  De vez en cuando, chicos de Yandex. Tutorial se unen a nosotros en refuerzo.  Trabajamos en Scrum con sprints de dos semanas. <br><a name="habracut"></a><br>  Nuestro frontend se basa en React.js junto con Redux / Redux-Saga, utilizamos Express para comunicarnos con el backend.  La parte del backend de la pila est√° en Python (m√°s precisamente, Django), la base de datos es PostgreSQL y, para algunas tareas, Redis.  Usando Redux, almacenamos almacenamientos de informaci√≥n, enviamos acciones procesadas por Redux y Redux-Saga.  Todos los efectos secundarios, como las solicitudes del servidor, las llamadas a Yandex.Metrica y las redirecciones, se procesan solo en Redux-Saga.  Y todas las modificaciones de datos ocurren en los reductores Redux. <br><br><h3>  C√≥mo no pasar por alto un registro en su iframe </h3><br>  Ahora en nuestra plataforma, la capacitaci√≥n est√° abierta en tres profesiones: desarrollador front-end, desarrollador web, analista de datos.  Y estamos aserrando activamente herramientas para cada curso. <br><br>  Para el curso de seis meses " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Analista de datos</a> ", creamos un simulador interactivo, donde ense√±amos a los usuarios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥mo usar el Jupyter Notebook</a> .  Este es un shell genial para la computaci√≥n interactiva, que es amado por los cient√≠ficos de datos.  Todas las operaciones en el entorno se realizan dentro del cuaderno, pero de una manera simple: un cuaderno (como lo llamar√© m√°s adelante). <br><br>  Experimente indicaciones, y estamos seguros: es importante que las tareas de capacitaci√≥n sean casi reales.  Incluido en t√©rminos del entorno laboral.  Por lo tanto, era necesario asegurarse de que dentro de la lecci√≥n se pudiera escribir, ejecutar y verificar todo el c√≥digo directamente en el cuaderno. <br><br>  Con la implementaci√≥n b√°sica de las dificultades no surgieron.  Instal√≥ el cuaderno en un iframe separado, prescribi√≥ la l√≥gica de su verificaci√≥n en el backend. <br><br><img src="https://habrastorage.org/webt/2z/_9/iy/2z_9iyuj7pmha0ielvj4evuyhic.png"><br>  <i>El cuaderno de estudiantes en s√≠ (a la derecha) es solo un iframe cuya URL conduce a un cuaderno espec√≠fico en JupyterHub.</i> <br><br>  En una primera aproximaci√≥n, todo funcion√≥ sin problemas, sin problemas.  Sin embargo, durante las pruebas, salieron a la luz los absurdos.  Por ejemplo, tiene la garant√≠a de conducir la versi√≥n correcta del c√≥digo a una computadora port√°til, sin embargo, despu√©s de hacer clic en el bot√≥n "Probar tarea", el servidor responde que la respuesta es supuestamente incorrecta.  Y por qu√©, un misterio. <br><br>  Bueno, lo que est√° sucediendo, nos dimos cuenta el mismo d√≠a en que encontramos un error: result√≥ que la soluci√≥n que no estaba volando era la actual, la soluci√≥n simplemente se introdujo en el formulario Jupyter Notebook, pero la anterior ya hab√≠a sido borrada.  El cuaderno en s√≠ no tuvo tiempo de sobrevivir, y ralentizamos el backend para que revisara la tarea en √©l.  Lo que, por supuesto, no pod√≠a hacer. <br><br>  Tuvimos que deshacernos del rassinhron entre guardar el cuaderno y enviar una solicitud al servidor para verificarlo.  El problema era que era necesario hacer que el marco flotante del cuaderno se comunicara con la ventana principal, es decir, con la interfaz en la que giraba la lecci√≥n en su conjunto.  Por supuesto, era imposible reenviar cualquier evento entre ellos directamente: viven en diferentes dominios. <br><br>  Buscando una soluci√≥n, descubr√≠ que Jupyter Notebook permite conectar sus complementos.  Hay un objeto J√∫piter, un cuaderno, con el que puede operar.  Trabajar con √©l implica eventos, incluida la preservaci√≥n del cuaderno, as√≠ como la llamada a la acci√≥n adecuada.  Habiendo descubierto el interior de Jupyter (ten√≠a que hacerlo: no hay documentaci√≥n normal para ello), los chicos y yo lo hicimos: construimos nuestro propio complemento y, utilizando el mecanismo postMessage, logramos el trabajo coordinado de los elementos a partir de los cuales se ensambl√≥ la lecci√≥n del taller. <br><br>  Resolvimos una soluci√≥n teniendo en cuenta el hecho de que nuestra pila inicialmente incluye la Redux-Saga ya mencionada, para decirlo simplemente, middleware sobre Redux, lo que hace posible trabajar de manera m√°s flexible con efectos secundarios.  Por ejemplo, guardar una computadora port√°til es algo as√≠ como este efecto secundario.  Enviamos algo al backend, esperamos algo, conseguimos algo.  Todo este movimiento se procesa dentro de Redux-Saga: arroja eventos a la interfaz, dici√©ndole c√≥mo mostrar qu√© en la interfaz de usuario. <br><br>  Cual es el resultado?  PostMessage se crea y se env√≠a al iframe con un cuaderno.  Cuando un iframe ve que algo proviene del exterior, analiza la cadena recibida.  Al darse cuenta de que necesita conservar el cuaderno, realiza esta acci√≥n y, a su vez, env√≠a una respuesta postMessage sobre la ejecuci√≥n de la solicitud. <br><br>  Cuando hacemos clic en el bot√≥n "Verificar tarea", el evento correspondiente se env√≠a a la tienda Redux: "De modo regular, fuimos a ser revisados".  Redux-Saga ve llegar la acci√≥n y hacer postMessage en un iframe.  Ahora est√° esperando que el iframe responda.  Mientras tanto, nuestro estudiante ve el indicador de descarga en el bot√≥n "Verificar la tarea" y entiende que el simulador no se cuelga, sino que "piensa".  Y solo cuando postMessage regresa diciendo que el guardado se ha completado, Redux-Saga contin√∫a trabajando y env√≠a una solicitud al backend.  En el servidor, se verifica la tarea: la soluci√≥n correcta o no, si se cometen errores, cu√°l, etc., y esta informaci√≥n se almacena de forma ordenada en Redux Store.  Y a partir de ah√≠, el script front-end lo lleva a la interfaz de la lecci√≥n. <br><br>  Aqu√≠ est√° el diagrama que sali√≥ al final: <br><br><img src="https://habrastorage.org/webt/ks/gc/eu/ksgceup6hokoh9jtvqoajegbjfc.png"><br><br>  <i>(1) Presionamos el bot√≥n "Verificar tarea" (Verificar) ‚Üí (2) Enviamos la acci√≥n CHECK_NOTEBOOK_REQUEST ‚Üí (3) Enviamos la acci√≥n del cheque ‚Üí (2) Enviamos la acci√≥n SAVE_NOTEBOOK_REQUEST ‚Üí (3) Capturamos la acci√≥n y enviamos postMessage en el iframe ‚Üí guardar evento (4) Recibir el mensaje ‚Üí (5) El cuaderno est√° guardado ‚Üí (4) Recibir el evento de la API de Jupyter de que el cuaderno ha sido guardado y enviar postMessage guardado en el cuaderno ‚Üí (1) Recibir el evento ‚Üí (2) Enviar la acci√≥n SAVE_NOTEBOOK_SUCCESS ‚Üí (3) Capturamos la acci√≥n y env√≠e una solicitud para verificar el cuaderno ‚Üí (6) ‚Üí (7) Verifique que este cuaderno est√© en la base de datos ‚Üí (8) ‚Üí (7) Busque el c√≥digo del cuaderno ‚Üí (5) Devuelva el c√≥digo ‚Üí (7) Ejecute la verificaci√≥n del c√≥digo ‚Üí (9 ) ‚Üí (7) Obtenemos un corte</i>  <i>cheque tat ‚Üí (6) ‚Üí (3) enviamos CHECK_NOTEBOOK_SUCCESS acci√≥n ‚Üí (2) hacia abajo para verificar la respuesta cara ‚Üí (1) resultado del sorteo</i> <br><br>  Veamos c√≥mo funciona todo esto en el contexto del c√≥digo. <br><br>  Tenemos en la parte delantera trainer_type_jupyter.jsx: el gui√≥n de la p√°gina donde se dibuja nuestro cuaderno. <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"trainer__right-column"</span></span></span><span class="hljs-tag">&gt;</span></span> {notebookLinkIsLoading ? ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"trainer__jupiter-frame"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{this.onIframeRef}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{notebookLink}</span></span></span><span class="hljs-tag"> /&gt;</span></span> ) : ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Spin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"l"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mix</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"trainer__jupiter-spin"</span></span></span><span class="hljs-tag"> /&gt;</span></span> )} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Despu√©s de hacer clic en el bot√≥n "Verificar trabajo", se llama al m√©todo handleCheckTasks. <br><br><pre> <code class="xml hljs">handleCheckTasks = () =&gt; { const {checkNotebook, lesson} = this.props; checkNotebook({id: lesson.id, iframe: this.iframeRef}); };</code> </pre> <br>  De hecho, handleCheckTasks sirve para invocar la acci√≥n de Redux con los par√°metros pasados. <br><br><pre> <code class="xml hljs">export const checkNotebook = getAsyncActionsFactory(CHECK_NOTEBOOK).request;</code> </pre> <br>  Esta es una acci√≥n com√∫n dise√±ada para Redux-Saga y m√©todos asincr√≥nicos.  Aqu√≠ getAsyncActionsFactory genera tres acciones: <br><br>  // utils / store-helpers / async.js <br><br><pre> <code class="xml hljs">export function getAsyncActionsFactory(type) { const ASYNC_CONSTANTS = getAsyncConstants(type); return { request: payload =&gt; ({type: ASYNC_CONSTANTS.REQUEST, payload}), error: (response, request) =&gt; ({type: ASYNC_CONSTANTS.ERROR, response, request}), success: (response, request) =&gt; ({type: ASYNC_CONSTANTS.SUCCESS, response, request}), } }</code> </pre> <br>  En consecuencia, getAsyncConstants genera tres constantes de la forma * _REQUEST, * _SUCCESS y * _ERROR. <br><br>  Ahora veamos c√≥mo nuestra Redux-Saga manejar√° toda esta econom√≠a: <br><br>  // trainer.saga.js <br><br><pre> <code class="xml hljs">function* watchCheckNotebook() { const watcher = createAsyncActionSagaWatcher({ type: CHECK_NOTEBOOK, apiMethod: Api.checkNotebook, preprocessRequestGenerator: function* ({id, iframe}) { yield put(trainerActions.saveNotebook({iframe})); yield take(getAsyncConstants(SAVE_NOTEBOOK).SUCCESS); return {id}; }, successHandlerGenerator: function* ({response}) { const {completed_tests: completedTests} = response; for (let id of completedTests) { yield put(trainerActions.setTaskSolved(id)); } }, errorHandlerGenerator: function* ({response: error}) { yield put(appActions.setNetworkError(error)); } }); yield watcher(); }</code> </pre> <br>  La magia?  Nada extraordinario  Como puede ver, createAsyncActionSagaWatcher simplemente crea un marcador de agua que puede preprocesar los datos que entran en la acci√≥n, hacer una solicitud en una URL espec√≠fica, enviar la acci√≥n * _REQUEST y enviar * _SUCCESS y * _ERROR despu√©s de una respuesta exitosa del servidor.  Adem√°s, por supuesto, para cada opci√≥n, se proporcionan controladores dentro del reloj. <br><br>  Probablemente haya notado que en el preprocesador de datos llamamos a otra Redux-Saga, espere hasta que termine con √âXITO, y solo entonces contin√∫e trabajando.  Y, por supuesto, los iframes no necesitan enviarse al servidor, por lo que solo proporcionamos la identificaci√≥n. <br><br>  Eche un vistazo m√°s de cerca a la funci√≥n saveNotebook: <br><br><pre> <code class="xml hljs">function* saveNotebook({payload: {iframe}}) { iframe.contentWindow.postMessage(JSON.stringify({ type: 'save-notebook' }), '*'); yield; }</code> </pre> <br>  Hemos alcanzado el mecanismo m√°s importante en la interacci√≥n de los iframes con la interfaz: postMessage.  El fragmento de c√≥digo proporcionado env√≠a una acci√≥n con el tipo guardar cuaderno, que se procesa dentro del iframe. <br><br>  Ya mencion√© que necesit√°bamos escribir un complemento para el Jupyter Notebook, que se cargar√≠a dentro del notebook.  Estos complementos se parecen a esto: <br><br><pre> <code class="xml hljs">define([ 'base/js/namespace', 'base/js/events' ], function( Jupyter, events ) {...});</code> </pre><br>  Para crear tales extensiones, debe lidiar con la API de Jupyter Notebook.  Desafortunadamente, no hay documentaci√≥n clara al respecto.  Pero los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digos fuente</a> est√°n disponibles, y profundic√© en ellos.  Es bueno que el c√≥digo sea legible all√≠. <br><br>  Se debe ense√±ar al complemento a comunicarse con la ventana principal en la parte frontal de la lecci√≥n: despu√©s de todo, la desincronizaci√≥n entre ellos es la causa del error con la verificaci√≥n de la tarea.  En primer lugar, nos suscribimos a todos los mensajes que recibimos: <br><br><pre> <code class="xml hljs">window.addEventListener('message', actionListener);</code> </pre> <br>  Ahora proporcionaremos su procesamiento: <br><br><pre> <code class="xml hljs">function actionListener({data: eventString}) { let event = ''; try { event = JSON.parse(eventString); } catch(e) { return; } switch (event.type) { case 'save-notebook': Jupyter.actions.call('jupyter-notebook:save-notebook'); Break; ... default: break; } }</code> </pre> <br>  Todos los eventos que no se ajustan a nuestro formato se ignoran audazmente. <br><br>  Vemos que nos llega el evento guardar cuaderno y llamamos a la acci√≥n para guardar el cuaderno.  Solo queda enviar un mensaje de que el cuaderno se ha conservado: <br><br><pre> <code class="xml hljs">events.on('notebook_saved.Notebook', actionDispatcher); function actionDispatcher(event) { switch (event.type) { case 'select': const selectedCell = Jupyter.notebook.get_selected_cell(); dispatchEvent({ type: event.type, data: {taskId: getCellTaskId(selectedCell)} }); return; case 'notebook_saved': default: dispatchEvent({type: event.type}); } } function dispatchEvent(event) { return window.parent.postMessage( typeof event === 'string' ? event : JSON.stringify(event), '*' ); }</code> </pre><br>  En otras palabras, simplemente env√≠e {type: 'notebook_saved'} hacia arriba.  Esto significa que el cuaderno ha sido preservado. <br><br>  Volvamos a nuestro componente: <br><br>  //trainer_type_jupyter.jsx <br><br><pre> <code class="xml hljs">componentDidMount() { const {getNotebookLink, lesson} = this.props; getNotebookLink({id: lesson.id}); window.addEventListener('message', this.handleWindowMessage); }</code> </pre> <br>  Al montar el componente, le pedimos al servidor un enlace al cuaderno y suscribimos todas las acciones que pueden volar hacia nosotros: <br><br><pre> <code class="xml hljs">handleWindowMessage = ({data: eventString}) =&gt; { const {activeTaskId, history, match: {params}, setNotebookSaved, tasks} = this.props; let event = null; try { event = JSON.parse(eventString); } catch(e) { return; } const {type, data} = event; switch (type) { case 'app_initialized': this.selectTaskCell({taskId: activeTaskId}) return; case 'notebook_saved': setNotebookSaved(); return; case 'select': { const taskId = data &amp;&amp; data.taskId; if (!taskId) { return } const task = tasks.find(({id}) =&gt; taskId === id); if (task &amp;&amp; task.status === TASK_STATUSES.DISABLED) { this.selectTaskCell({taskId: null}) return; } history.push(reversePath(urls.trainerTask, {...params, taskId})); return; } default: break; } };</code> </pre> <br>  Aqu√≠ es donde se llama el despacho de acci√≥n setNotebookSaved, que permitir√° a Redux-Saga continuar trabajando y guardar el cuaderno. <br><br><h3>  Glitches de elecci√≥n </h3><br>  Sobrellevamos el error de preservaci√≥n del cuaderno.  E inmediatamente cambi√≥ a un nuevo problema.  Era necesario aprender a bloquear tareas (tareas), a las que el estudiante a√∫n no hab√≠a llegado.  En otras palabras, era necesario sincronizar la navegaci√≥n entre nuestro simulador interactivo y el Jupyter Notebook: dentro de una lecci√≥n, ten√≠amos un cuaderno con varias tareas en el iframe, las transiciones entre las cuales ten√≠an que coordinarse con los cambios en la interfaz de la lecci√≥n en su conjunto.  Por ejemplo, para que al hacer clic en la segunda tarea en la interfaz de la lecci√≥n en el cuaderno, se realice el cambio a la celda correspondiente a la segunda tarea.  Y viceversa: si en el marco de Jupyter Notebook selecciona una celda vinculada a la tercera tarea, la URL en la barra de direcciones del navegador debe cambiar inmediatamente y, en consecuencia, el texto que acompa√±a a la teor√≠a de la tercera tarea debe mostrarse en la interfaz de la lecci√≥n. <br><br>  Hab√≠a una tarea m√°s dif√≠cil.  El hecho es que nuestro programa de capacitaci√≥n est√° dise√±ado para el paso constante de lecciones y tareas.  Mientras tanto, por defecto, en el cuaderno de J√∫piter, nada impide que el usuario abra ninguna celda.  Y en nuestro caso, cada celda es una tarea separada.  Result√≥ que puede resolver la primera y la tercera tarea, y omitir la segunda.  El riesgo de paso no lineal de la lecci√≥n tuvo que ser eliminado. <br><br>  La soluci√≥n se bas√≥ en el mismo postMessage.  Solo que ten√≠amos que profundizar en la API de Jupyter Notebook, m√°s espec√≠ficamente, en lo que el objeto Jupiter puede hacer.  Y encuentre un mecanismo para verificar a qu√© tarea est√° conectada la celda.  En su forma m√°s general, es como sigue.  En la estructura del cuaderno, las celdas van secuencialmente una tras otra.  Pueden tener metadatos.  El campo "Etiquetas" se proporciona en los metadatos, y las etiquetas son solo identificadores de tareas dentro de la lecci√≥n.  Adem√°s, al usar celdas de etiquetado, puede determinar si el estudiante debe bloquearlas hasta ahora.  Como resultado, de acuerdo con el modelo actual del simulador, al hacer clic en la celda, comenzamos a enviar postMessage desde el iframe a nuestra interfaz, que, a su vez, va a la Tienda Redux y comprueba, en funci√≥n de las propiedades de la tarea, si est√° disponible para nosotros ahora.  Si no est√° disponible, cambiamos a la celda activa anterior. <br><br>  Por lo tanto, hemos logrado que sea imposible seleccionar una celda en una computadora port√°til a la que no se pueda acceder en la l√≠nea de tiempo de capacitaci√≥n.  Es cierto que esto dio lugar a un error no cr√≠tico, pero cr√≠tico: intenta hacer clic en una celda con una tarea inaccesible y r√°pidamente "parpadea": est√° claro que se activ√≥ por un momento, pero se bloque√≥ de inmediato.  Si bien no hemos eliminado esta aspereza, no interfiere con la toma de lecciones, pero en el fondo seguimos pensando c√≥mo lidiar con eso (por cierto, ¬øhay alguna idea?). <br><br>  Un poco sobre c√≥mo modificamos nuestra interfaz para resolver el problema.  Volvamos a trainer_type_jupyter.jsx nuevamente: nos centraremos en app_initialized y select. <br><br>  Con app_initialized, todo es elemental: el port√°til se ha cargado y queremos hacer algo.  Por ejemplo, seleccione la celda actual seg√∫n la tarea seleccionada.  El complemento se describe para que pueda pasar taskId y cambiar a la primera celda correspondiente a este taskId. <br><br>  A saber: <br><br>  // trainer_type_jupyter.jsx <br><br><pre> <code class="xml hljs">selectTaskCell = ({taskId}) =&gt; { const {selectCell} = this.props; if (!this.iframeRef) { return; } selectCell({iframe: this.iframeRef, taskId}); };</code> </pre> <br>  // trainer.actions.js <br><br><pre> <code class="xml hljs">export const selectCell = ({iframe, taskId}) =&gt; ({ type: SELECT_CELL, iframe, taskId });</code> </pre> <br>  // trainer.saga.js <br><br><pre> <code class="xml hljs">function* selectCell({iframe, taskId}) { iframe.contentWindow.postMessage(JSON.stringify({ type: 'select-cell', data: {taskId} }), '*'); yield; } function* watchSelectCell() { yield takeEvery(SELECT_CELL, selectCell); }</code> </pre> <br>  // custom.js (complemento de Jupyter) <br><br><pre> <code class="xml hljs">function getCellTaskId(cell) { const notebook = Jupyter.notebook; while (cell) { const tags = cell.metadata.tags; const taskId = tags &amp;&amp; tags[0]; if (taskId) { return taskId; } cell = notebook.get_prev_cell(cell); } return null; } function selectCell({taskId}) { const notebook = Jupyter.notebook; const selectedCell = notebook.get_selected_cell(); if (!taskId) { selectedCell.unselect(); return; } if (selectedCell &amp;&amp; selectedCell.selected &amp;&amp; getCellTaskId(selectedCell) === taskId) { return; } const index = notebook.get_cells() .findIndex(cell =&gt; getCellTaskId(cell) === taskId); if (index <span class="hljs-tag"><span class="hljs-tag">&lt; </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span><span class="hljs-tag">) { </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">return</span></span></span><span class="hljs-tag">; } </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">notebook.select</span></span></span><span class="hljs-tag">(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span><span class="hljs-tag">); </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cell</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">notebook.get_cell(index);</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cell.element</span></span></span><span class="hljs-tag">[</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span><span class="hljs-tag">]</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">.scrollIntoView</span></span></span><span class="hljs-tag">({ </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">behavior:</span></span></span><span class="hljs-tag"> '</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">smooth</span></span></span><span class="hljs-tag">', </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">block:</span></span></span><span class="hljs-tag"> '</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">start</span></span></span><span class="hljs-tag">' }); } </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">actionListener</span></span></span><span class="hljs-tag">({</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data:</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">eventString</span></span></span><span class="hljs-tag">}) { </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">case</span></span></span><span class="hljs-tag"> '</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select-cell</span></span></span><span class="hljs-tag">'</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectCell</span></span></span><span class="hljs-tag">(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">event.data</span></span></span><span class="hljs-tag">); </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">break</span></span></span><span class="hljs-tag">;</span></span></code> </pre> <br>  Ahora puede cambiar celdas y aprender del iframe que la celda se ha cambiado. <br><br>  Al cambiar la celda, cambiamos la URL y caemos en otra tarea.  Solo queda hacer lo contrario: al elegir otra tarea en la interfaz, cambie la celda.  F√°cil: <br><br><pre> <code class="xml hljs">componentDidUpdate({match: {params: {prevTaskId}}) { const {match: {params: {taskId}}} = this.props; if (taskId !== prevTaskId) { this.selectTaskCell({taskId});</code> </pre> <br><h3>  Caldera separada para perfeccionistas. </h3><br>  Ser√≠a genial alardear de lo bien que estamos.  La soluci√≥n en la l√≠nea de fondo es efectiva, aunque parece un poco desordenada: para resumir, tenemos un m√©todo que procesa cualquier mensaje proveniente del exterior (en nuestro caso, de un iframe).  Pero en el sistema que nosotros mismos construimos, hay cosas que a m√≠ y a mis colegas no nos gustan realmente. <br><br>  ‚Ä¢ No existe flexibilidad en la interacci√≥n de los elementos: cada vez que queramos agregar una nueva funcionalidad, tendremos que cambiar el complemento para que admita el formato de comunicaci√≥n antiguo y el nuevo.  No existe un mecanismo aislado √∫nico para trabajar entre el iframe y nuestro componente front-end, que representa el Jupyter Notebook en la interfaz de la lecci√≥n y funciona con nuestras tareas.  A nivel mundial, existe el deseo de crear un sistema m√°s flexible para que en el futuro sea f√°cil agregar nuevas acciones, eventos y procesarlos.  Y en el caso no solo del cuaderno J√∫piter, sino tambi√©n con cualquier iframe en los simuladores.  Por lo tanto, estamos buscando pasar el c√≥digo del complemento a trav√©s de postMessage y representarlo (eval) dentro del complemento. <br><br>  ‚Ä¢ Los fragmentos de c√≥digo que resuelven problemas est√°n dispersos por todo el proyecto.  La comunicaci√≥n con iframes se realiza tanto desde Redux-Saga como desde el componente, lo que ciertamente no es √≥ptimo. <br><br>  ‚Ä¢ El iframe en s√≠ mismo con la representaci√≥n de Jupyter Notebook se encuentra en otro servicio.  La edici√≥n es un poco problem√°tica, especialmente en cumplimiento del principio de compatibilidad con versiones anteriores.  Por ejemplo, si queremos cambiar alg√∫n tipo de l√≥gica en el front-end y en el cuaderno mismo, tenemos que hacer doble trabajo. <br><br>  ‚Ä¢ A muchos les gustar√≠a implementarlo m√°s f√°cilmente.  Toma al menos Reaccionar.  Tiene un mont√≥n de m√©todos de ciclo de vida, y cada uno de ellos necesita ser procesado.  Adem√°s, estoy confundido por la uni√≥n a React en s√≠.  Idealmente, me gustar√≠a poder trabajar con nuestros iframes sin importar cu√°l sea su marco front-end.  En general, la intersecci√≥n de las tecnolog√≠as que hemos elegido impone limitaciones: la misma Redux-Saga espera acciones de Redux de nosotros, no postMessage. <br><br>  As√≠ que definitivamente no nos detendremos en lo que se ha logrado.  Un dilema de los libros de texto: puedes ir al lado de la belleza, pero sacrificar la optimizaci√≥n del rendimiento, o viceversa.  Todav√≠a no hemos encontrado la mejor soluci√≥n. <br><br>  ¬øQuiz√°s te surjan ideas? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/453876/">https://habr.com/ru/post/453876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453866/index.html">Solicitud API con React Hooks, HOC o Render Prop</a></li>
<li><a href="../453868/index.html">Mini interruptor t√°ctil con panel de vidrio en nRF52832</a></li>
<li><a href="../453870/index.html">Escribimos Reverse socks5 proxy en powershell. Parte 1</a></li>
<li><a href="../453872/index.html">Restaurar fotos usando redes neuronales</a></li>
<li><a href="../453874/index.html">De la ruleta rusa a Safe LOTO: c√≥mo proteger al personal del centro de datos</a></li>
<li><a href="../453882/index.html">Una gran gu√≠a sobre la profesi√≥n de arquitecto de soluciones (+ lista de enlaces √∫tiles)</a></li>
<li><a href="../453884/index.html">¬øC√°mara HYIP o reemplazo de DSLR?</a></li>
<li><a href="../453886/index.html">El programa funciona</a></li>
<li><a href="../453890/index.html">Sue√±os sovi√©ticos del futuro</a></li>
<li><a href="../453892/index.html">Certificaci√≥n ISTQB. Parte 2: ¬øC√≥mo prepararse para la certificaci√≥n ISTQB? Practica historias</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>