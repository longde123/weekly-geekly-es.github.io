<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍹 🤱🏾 🔞 Jenkins for Android使用Docker构建 🔡 👩🏾‍🤝‍👨🏿 💳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="大家好！ 

 我是一名Android开发人员，不久前，我们在项目中遇到了一些想要自动化的例行任务。 例如，我们有5种不同的口味，对于每种口味，我们都需要将我们的作品上载到织物上，有时每天需要多次使用不同的购物车。 是的，也可以使用gradle任务完成此任务，但是我不想在开发人员的计算机上启动此过程...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jenkins for Android使用Docker构建</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443606/"> 大家好！ <br><br> 我是一名Android开发人员，不久前，我们在项目中遇到了一些想要自动化的例行任务。 例如，我们有5种不同的口味，对于每种口味，我们都需要将我们的作品上载到织物上，有时每天需要多次使用不同的购物车。 是的，也可以使用gradle任务完成此任务，但是我不想在开发人员的计算机上启动此过程，而是以某种方式集中进行。 或者，例如，将Google Play中的版本自动上传到Beta。 好吧，我只是想选择CI系统。 这篇文章的结果是什么，以及我们如何设置它，为什么还有Docker。 <br><br><img src="https://habrastorage.org/webt/at/pi/_v/atpi_veqcyb-lryxth_ia4m0uag.png"><br><a name="habracut"></a><br> 据我了解，整个任务大致分为两个阶段： <br><br><ol><li> 使用Android SDK安装和配置Jenkins本身 </li><li> 设置詹金斯内部已经存在的任务 </li></ol><br> 在本文中，我想谈谈第一点，如果对任何人都感兴趣，那么在下一篇文章中，我将描述在Jenkins本身中设置组装任务的过程。 <br><br><h2> 因此，第一点是Jenkins系统的安装和配置 </h2><br>  <i>哈布雷（Habré）在该主题上已经有一篇精彩的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文章</a> ，但是她已经有几年了，其中的一些内容已经有些过时了（例如sdkmanager），尽管她在最初阶段帮了我很多忙，弄清楚了怎么做和如何做。</i> <br><br> 如果您查看安装Jenkins的官方<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档</a> ，我们将看到三种不同的方法来执行此操作：启动现成的Docker映像，下载并运行war文件，以及仅以旧方式在系统中安装jenkins（例如，使用ubuntu作为示例来<code>apt-get install jenkins</code> ）。 第一个选项是最正确的，因为它不对我们的主机系统进行任何不必要的设置和依赖，并且即使在出现问题的任何时候，删除所有内容并重新启动都很容易。 但是jenkins的标准docker映像包含一些我们不需要的数据（例如，blueocean插件），也不包含我们绝对需要的数据（例如，android sdk）。 决定创建自己的docker映像，在其中下载并运行war文件，下载并安装android sdk，以及配置我们需要的所有其他设置。 为了稍后启动，我们需要安装了docker的主机系统。 我建议在这里不要重蹈覆辙，而是使用DigitalOcean。 <br><br><h4> 创建和配置虚拟机 </h4><br> 首先，如果其他人未在此处注册，则建议<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">注册</a> （在撰写本文时，这里有引荐链接，但在阅读规则后我将其抛弃了）。 注册后，您可以在互联网上搜索一个或另一个促销代码，并获得约10美元的启动费。 <br><br> 之后，我们需要获得新的液滴。 选择项目Droplets，然后选择<b>创建Droplet</b> 。 <br><br><img src="https://habrastorage.org/webt/gx/5m/th/gx5mthmcjzw-okm6ktxpfekimn8.png" alt="图片"><br><br> 主机系统是Ubuntu 18.04。 您可以选择已安装并配置了Docker的映像，但是我们将自行完成所有操作。 由于android构建的组装仍然需要大量资源，因此我们需要选择至少20美元的配置，以便正常且相对较快地收集构建。 <br><br><img src="https://habrastorage.org/webt/1e/y_/z1/1ey_z1uyjffbqocqz6i4ef8ium8.png" alt="图片"><br><br> 我们将选择更靠近的位置（例如，在德国）。 然后，有两种方法可以连接到虚拟服务器。 我们可以添加ssh密钥，也可以不使用它。 如果在此位置我们未指明要使用哪个密钥，那么root用户的密码将发送到我们的邮件中。 <br><br><img src="https://habrastorage.org/webt/eg/qd/hu/egqdhuamgiddwijvsfidcxu7ieq.png" alt="图片"><br><br> 在这里，我们可以更改服务器名称，并单击“ <b>创建”</b>按钮完成<b>创建</b> 。 <br><br><img src="https://habrastorage.org/webt/ad/mw/6w/admw6wwv2zyontaxpzx-fgp-rfg.png" alt="图片"><br><br> 现在，我们进入创建的Droplet，并复制自己的IP地址，以进行进一步的连接和配置。 <br><br><img src="https://habrastorage.org/webt/q7/th/yv/q7thyvgm-hppvgrured6dogeqva.png" alt="图片"><br><br> 我们需要一个ssh客户。 如果您在罂粟下工作，则可以使用标准终端，如果在Windows下<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">工作</a> ，则可以使用腻子<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">工作</a>或使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Linux子系统</a> （仅适用于Windows 10）。 我个人使用后一种选择，它完全适合我。 <br><br> 使用以下命令连接到我们的服务器 <br><br><pre> <code class="bash hljs">ssh root@YOUR_IP_ADDRESS</code> </pre> <br> 控制台将为您提供保存密钥，我们对此表示同意。 连接后，我们将为自己创建一个新用户，将其添加到超级用户中（让他有机会使用不带密码的sudo），将其复制通过ssh访问的密钥并说他是这些文件的所有者（否则它将不起作用）。  <b>用户名已</b>更改为方便您使用的名称。 <br><br><pre> <code class="bash hljs">useradd -m -s /bin/bash username \ &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'username ALL=(ALL) NOPASSWD:ALL'</span></span> &gt;&gt; /etc/sudoers \ &amp;&amp; mkdir /home/username/.ssh \ &amp;&amp; cp /root/.ssh/authorized_keys /home/username/.ssh/authorized_keys \ &amp;&amp; chown username:username -R /home/username/.ssh</code> </pre><br> 使用命令从根断开连接 <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br> 我们将在创建的新用户的帮助下重新连接 <br><br><pre> <code class="bash hljs">ssh username@YOUR_IP_ADDRESS</code> </pre> <br> 在更新系统并重新启动服务器之后（如果在更新过程中系统会询问您一些信息，在这种情况下始终选择默认值就足够了）。 <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt full-upgrade -y &amp;&amp; sudo apt autoremove -y &amp;&amp; sudo reboot</code> </pre> <br> 基本设置完成。 从作战系统的角度来看，它不是很安全，但是在本文的框架内，它是完全合适的。 <br><br><h4> 安装Docker </h4><br> 要将Docker安装到我们的系统中，我们将使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">官方文档</a> 。 因为我们有一个新安装的系统，所以我们将跳过这一点，如果您的系统已经运行了很长一段时间，则根据Docker团队的建议，删除可能的旧版本 <br><br><pre> <code class="bash hljs">sudo apt-get remove docker docker-engine docker.io containerd runc</code> </pre> <br> 不要忘记先通过ssh连接回我们的服务器。 文档中对Docker本身的安装进行了详细描述，我将提供常规命令来简化安装过程。 他们所做的可以在这里阅读。 首先添加存储库。 <br><br><pre> <code class="bash hljs">sudo apt update \ &amp;&amp; sudo apt install -y apt-transport-https ca-certificates \ curl gnupg-agent software-properties-common \ &amp;&amp; curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - \ &amp;&amp; sudo apt-key fingerprint 0EBFCD88 \ &amp;&amp; sudo add-apt-repository <span class="hljs-string"><span class="hljs-string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(lsb_release -cs)</span></span></span><span class="hljs-string"> stable"</span></span></code> </pre> <br> 然后安装Docker本身： <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt install -y docker-ce docker-ce-cli containerd.io</code> </pre> <br> 因此，将来我们可以调用不带sudo前缀的docker命令，执行以下命令（说明中也对此进行了详细介绍）。 <br><br><pre> <code class="bash hljs">sudo usermod -aG docker username</code> </pre> <br> 之后，您需要重新登录（使用exit命令并重新连接到服务器），以使其正常工作。 <br><br>  Docker本身已安装，我们可以使用以下命令进行检查 <br><br><pre> <code class="bash hljs">docker run hello-world</code> </pre> <br> 她下载测试图像，然后在容器中运行它。 启动后，该容器将打印参考消息并退出。 <br><br> 恭喜，我们已经完成服务器准备工作的阶段！ <br><br><h4> 创建您的Docker映像 </h4><br> 我们将通过编写我们自己的Dockerfile来创建Docker映像。 如何在互联网，旅行车和小型手推车上正确执行此操作的示例，我将显示完成的版本，并尝试对它进行尽可能多的评论。  docker本身还有一本<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用手册</a> ，其中包含有关dockerfile的正确和规范拼写的示例。 <br><br> 创建并打开您的Dockerfile进行编辑 <br><br><pre> <code class="bash hljs">touch Dockerfile &amp;&amp; nano Dockerfile</code> </pre> <br> 例如，在其中，我们将放置Dockerfile的内容 <br><br><div class="spoiler">  <b class="spoiler_title">我整个带有评论的dockerfile</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    . FROM ubuntu:18.04 #      LABEL author="osipovaleks" LABEL maintainer="osipov.aleks.kr@gmail.com" LABEL version="1.0" LABEL description="Docker image for Jenkins with Android SDK" #  ,  Jenkins    ENV TZ=Europe/Kiev RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone # i386    ia32-libs RUN dpkg --add-architecture i386 #      RUN apt-get update &amp;&amp; apt-get install -y git \ wget \ unzip \ sudo \ tzdata \ locales\ openjdk-8-jdk \ libncurses5:i386 \ libstdc++6:i386 \ zlib1g:i386 #  ,       RUN apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists /var/cache/apt #  RUN locale-gen en_US.UTF-8 ENV LANG en_US.UTF-8 ENV LANGUAGE en_US:en ENV LC_ALL en_US.UTF-8 #   Android Sdk     ARG android_home_dir=/var/lib/android-sdk/ ARG sdk_tools_zip_file=sdk-tools-linux-4333796.zip RUN mkdir $android_home_dir RUN wget https://dl.google.com/android/repository/$sdk_tools_zip_file -P $android_home_dir -nv RUN unzip $android_home_dir$sdk_tools_zip_file -d $android_home_dir RUN rm $android_home_dir$sdk_tools_zip_file &amp;&amp; chmod 777 -R $android_home_dir # environment    ENV ANDROID_HOME=$android_home_dir ENV PATH="${PATH}:$android_home_dir/tools/bin:$android_home_dir/platform-tools" ENV JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/ #   Android SDK RUN yes | sdkmanager --licenses #    Jenkins ENV JENKINS_HOME=/var/lib/jenkins RUN mkdir $JENKINS_HOME &amp;&amp; chmod 777 $JENKINS_HOME #     jenkins,   ,         RUN useradd -m jenkins &amp;&amp; echo 'jenkins ALL=(ALL) NOPASSWD:ALL' &gt;&gt; /etc/sudoers USER jenkins WORKDIR /home/jenkins #   war     Jenkins RUN wget http://mirrors.jenkins.io/war-stable/latest/jenkins.war -nv CMD java -jar jenkins.war #      EXPOSE 8080/tcp</span></span></code> </pre><br></div></div><br> 一些澄清： <br><br><ul><li> 最初，人们希望使用较轻的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Alpine</a>代替ubuntu，但它不具有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ia32-libs</a>支持，这是使用Android SDK构建项目所必需的。 </li><li> 我们安装openjdk-8-jdk而不是安装更轻巧的openjdk-8-jdk-headless，因为某些Jenkins功能需要一个完整的系统（例如，显示单元测试结果）。 </li><li> 由于某些项目没有它们，gradle程序集崩溃而没有明确的错误和日志，因此有必要安装语言环境，而我花了几天时间才探究这个原因（在不在docker中的常规ubuntu上，默认情况下所有语言环境都被填充） 。 </li><li> 我们需要立即接受Android SDK的所有许可，以便在构建过程中Jenkins可以独立安装其所需的组件（例如，不同版本的api所需的SDK）。 如有必要，稍后可以在docker容器内部使用sdkmanager管理SDK，例如<code>sdkmanager --list</code>允许<code>sdkmanager --list</code>查看所有可用的和所有已安装的组件，而<code>sdkmanager --install "platforms;android-26"</code> api版本26安装SDK。 </li><li> 通常，可能不启动用户詹金斯，而是与root用户在一起，但是由于某种原因，这不太正确，您也无法授予他超级用户权限，但是这样做是出于方便的考虑，如果需要安装某些东西在设置和调试阶段。 </li><li> 图像的基本大小非常大（将近800 mb），但总的来说，我得出的结论是，这对我来说不是很关键，并且以这种形式下载图像比花时间搜索和删除不需要的软件包更容易。 </li></ul><br> 编写Dockerfile之后，我们需要根据要创建的容器将其转换为Docker的现成映像。 这是简单地由团队完成的 <br><br><pre> <code class="bash hljs">docker build -t jenkins-image</code> </pre> <br> 其中<code>-t jenkins-image</code>参数负责<code>-t jenkins-image</code>的名称，命令末尾的点表示您需要在此目录中查找程序集的Dockerfile。 组装过程本身会花费一些时间，并且组装后控制台中应该有类似的内容。 <br><blockquote> 成功构建9fd8f5545c27 <br> 成功标记詹金斯图像：最新 </blockquote> 这说明我们的形象已经成功组合，我们可以继续下一步，即启动容器 <br><br><h4>  Docker Hub和现成的映像 </h4><br> 是的，当然，我们可以使用现成的映像来启动容器，但是如果我们需要在多个设备上执行此操作，则每次创建一个Dockerfile并从中构建现成的映像将不是很方便。 而且，如果我们还更新了Dockerfile的内容，那么在所有节点上展开更改将根本不方便。 为此，有一个公共的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Docker Hub</a>映像存储库。 它使您不必每次都在每个节点上收集映像，而只是从公共存储库中将其下载到您自己，并在所有计算机上均等地使用它。 例如，在名为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">osipovaleks / docker-jenkins-android</a>的存储库中提供了作为本文示例的图像，在本文的后面，我们将使用它。 <br><br> 本文并不意味着对Docker Hub进行了详细的研究，我们将不了解如何在其中上传映像（尽管这不是很困难）以及在那里可以做什么，我们也将不了解仍然可能存在您自己的私有公共或私有存储库，如有必要，所有这些都可以独立进行分类。 <br><br><h4> 集装箱下水 </h4><br> 有两种启动容器的方法。 <br><br><ol><li> 第一种方法，只需使用<code>docker run</code> ，即可通过以下方式轻松快速地执行此操作 <br><br><pre> <code class="bash hljs">docker run --name jenkins -d -it -v jenkins-data:/var/lib/jenkins -v jenkins-home:/home/jenkins -p 8080:8080 --restart unless-stopped osipovaleks/docker-jenkins-android</code> </pre> <br> 其中<code>run</code>命令具有以下参数 <br><br><ul><li>  <code>--name jenkins</code>未来容器的名称 </li><li>  <code>-d</code>在后台启动容器 </li><li>  <code>-it</code>用于STDIN和tty的标志 </li><li>  <code>-v jenkins-data:/var/lib/jenkins</code>和<code>-v jenkins-home:/home/jenkins</code>创建（如果未创建）并将特殊的卷文件映射到容器的内部部分，这将使我们即使在重建后也可以保存自定义的Jenkins货柜 </li><li>  <code>-p 8080:8080</code>将主机端口映射到容器端口，以便我们可以访问Web界面（是的，这是我们在Dockerfile中指定的端口） </li><li>  <code>--restart unless-stopped</code>该选项确定重新引导主机后的容器自动运行策略（在这种情况下，如果未手动关闭容器，则自动启动） </li><li>  <code>osipovaleks/docker-jenkins-android</code>用于部署的映像。 </li></ul><br> 在Docker控制台的出口处，我们应该获取已创建容器的ID，并显示有关如何将映像加载到系统中的信息（当然，如果尚未加载），类似这样 <br><blockquote> 无法在本地找到图像'osipovaleks / docker-jenkins-android：Latest' <br> 最新：从osipovaleks / docker-jenkins-android中拉出 <br>  6cf436f81810：拉出完成 <br>  987088a85b96：拉出完成 <br>  b4624b3efe06：拉出完成 <br>  d42beb8ded59：拉动完成 <br>  b3896048bb8c：拉完整 <br>  8eeace4c3d64：拉完整 <br>  d9b74624442c：拉完整 <br>  36bb3b7da419：拉动完成 <br>  31361bd508cb：拉出完成 <br>  cee49ae4c825：拉完成 <br>  868ddf54d4c1：拉出完成 <br>  361bd7573dd0：拉出完成 <br>  bb7b15e36ae8：拉动完成 <br>  97f19daace79：拉完整 <br>  1f5eb3850f3e：拉动完成 <br>  651e7bbedad2：拉出完成 <br>  a52705a2ded7：拉出完成 <br> 摘要：sha256：321453e2f2142e433817cc9559443387e9f680bb091d6369bbcbc1e0201be1c5 <br> 状态：为osipovaleks / docker-jenkins-android下载的较新映像：最新 <br>  ef9e5512581da66d66103d9f6ea6ccd74e5bdb3776747441ce6a88a98a12b5a4 </blockquote></li><li> 第二种启动方式包括编写一个特殊的compose文件，其中运行命令仅使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">YAML</a>语言简单描述，并使用Docker Compose启动。 <br><br> 为此，我们需要安装它： <br><br><pre> <code class="bash hljs">sudo apt update &amp;&amp; sudo apt install -y docker-compose</code> </pre> <br> 接下来，为项目创建一个目录（如果您关心将为容器自动创建的卷将被调用的内容，这将非常重要）并转到该目录 <br><br><pre> <code class="bash hljs">mkdir jenkinsProject &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> jenkinsProject</code> </pre> <br> 在内部，我们自己创建撰写文件并进入编辑模式 <br><br><pre> <code class="bash hljs">touch docker-compose.yml &amp;&amp; nano docker-compose.yml</code> </pre> <br> 并放入以下内容 <br><br><pre> <code class="markdown hljs">version: '3' services: jenkins: container_name: jenkins image: osipovaleks/docker-jenkins-android ports: - "8080:8080" restart: unless-stopped volumes: - "jenkins-data:/var/lib/jenkins" - "jenkins-home:/home/jenkins" volumes: jenkins-data: jenkins-home:</code> </pre> <br> 在其中，也许只有第一行引发问题（ <code>version: '3'</code> ），该问题指示撰写文件<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a>功能的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">版本</a> ，以及带有<code>volumes</code>块的部分，列出了此容器中使用的文件 <br><br> 使用以下命令运行容器： <br><br><pre> <code class="bash hljs">docker-compose up -d</code> </pre> <br>  <code>-d</code>标志还指示该容器将在后台创建并启动。 结果，Docker应该显示如下内容： <br><blockquote> 使用默认驱动程序创建卷“ jenkinsproject_jenkins-data” <br> 使用默认驱动程序创建卷“ jenkinsproject_jenkins-home” <br> 拉詹金斯（osipovaleks / docker-jenkins-android：最新）... <br> 最新：从osipovaleks / docker-jenkins-android中拉出 <br>  6cf436f81810：拉出完成 <br>  987088a85b96：拉出完成 <br>  b4624b3efe06：拉出完成 <br>  d42beb8ded59：拉动完成 <br>  b3896048bb8c：拉完整 <br>  8eeace4c3d64：拉完整 <br>  d9b74624442c：拉完整 <br>  36bb3b7da419：拉动完成 <br>  31361bd508cb：拉出完成 <br>  cee49ae4c825：拉完成 <br>  868ddf54d4c1：拉出完成 <br>  361bd7573dd0：拉出完成 <br>  bb7b15e36ae8：拉动完成 <br>  97f19daace79：拉完整 <br>  1f5eb3850f3e：拉动完成 <br>  651e7bbedad2：拉出完成 <br>  a52705a2ded7：拉出完成 <br> 摘要：sha256：321453e2f2142e433817cc9559443387e9f680bb091d6369bbcbc1e0201be1c5 <br> 状态：为osipovaleks / docker-jenkins-android下载的较新映像：最新 <br> 创建詹金斯... <br> 创建詹金斯...完成 </blockquote> 记住，我说过创建的卷的名称取决于项目的名称吗？ 运行命令： <br><br><pre> <code class="bash hljs">docker volume ls</code> </pre> <br> 我们得到这样的输出 <br><blockquote> 驾驶员卷名 <br> 本地jenkinsproject_jenkins数据 <br> 本地jenkinsproject_jenkins-home </blockquote>  <code>jenkins-home</code>我们可以看到，尽管实际上volume的名称是由<code>jenkins-home</code>选择的， <code>jenkins-home</code>实际上，项目名称的前缀<code><b>jenkinsproject</b> _jenkins-home</code>在其中，而volume的名称却是<code><b>jenkinsproject</b> _jenkins-home</code> </li></ol><br><br> 使用哪个启动选项？ 在这里，您可以自己选择，相信Docker Compose可以是一次启动相互关联的多个容器的工具，如果只需要运行一个容器，则可以使用<code>docker run</code> 。 <br><br> 现在，在完成了用于启动和配置服务器以及使用Jenkins启动容器的这些子步骤之后，我们可以继续进行其初始配置。 <br><br><h4>  Jenkins的初始设置 </h4><br> 取得我们服务器的IP地址，将我们指示的端口8080添加到它，然后在浏览器中单击此链接。 <br><br> <code>http://YOUR_IP_ADDRESS:8080/</code> <br> <br> 如果在此之前一切均已配置并正确启动，那么在这里我们将看到以下图片 <br><br><img src="https://habrastorage.org/webt/za/a5/bi/zaa5bi-5vkvscc-ww7gd2ouxjte.png"><br><br> 对于第一次设置，我们需要输入系统在安装过程中生成的密码。 为此，我们只需要查看文件<code>/var/lib/jenkins/secrets/initialAdminPassword</code> 。 但是这个文件在我们正在运行的容器中，为了读取它，我们需要使用以下命令连接到容器： <br><br><pre> <code class="bash hljs">docker <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> -it jenkins /bin/bash</code> </pre> <br> 其中<code>jenkins</code>选项类似于运行<code>jenkins</code> <code>docker run</code> ， <code>jenkins</code>是我们的容器的名称， <code>/bin/bash</code>将在容器中为我们运行<code>/bin/bash</code>并为其提供访问权限。 之后，我们可以看到詹金斯的初始密码： <br><br><pre> <code class="bash hljs">cat /var/lib/jenkins/secrets/initialAdminPassword</code> </pre> <br> 控制台中显示以下内容 <br><blockquote>  91092b18d6ca4492a2759b1903241d2a </blockquote> 这是密码。 <br><br>  <i>用户<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">ALexhha</a>建议使用一个更简单的选项来读取此密码，而无需连接到容器本身。</i>  <i>事实是，在启动Jenkins本身时，此密码显示在日志中。</i>  <i>事实证明，我们所需要做的只是读取容器日志。</i>  <i>在我们的例子中，这是通过以下命令完成的：</i> <br><br><pre> <code class="bash hljs">docker logs jenkins</code> </pre> <br><br>  <i>其中</i> <code>jenkins</code> <i>我们容器</i> <code>jenkins</code> <i>名称，在日志中，您可以看到以下内容：</i> <br><br><blockquote>  ********************************************************** *********** <br>  ********************************************************** *********** <br>  ********************************************************** *********** <br><br>  Jenkins的初始设置是必需的。 已创建管理员用户，并已生成密码。 <br> 请使用以下密码继续安装： <br><br>  91092b18d6ca4492a2759b1903241d2a <br><br> 这也可以在以下位置找到：/ var / lib / jenkins / secrets / initialAdminPassword <br><br>  ********************************************************** *********** <br>  ********************************************************** *********** </blockquote><br>  ******************************************************** *********** <br><br>  <i>此选项更简单，更快捷。</i> <br><br> 复制它，将其粘贴到Web界面的<b>Administrator password</b>字段中，然后单击<b>Continue</b> 。 在下一个屏幕上，选择“ <b>安装建议的插件”</b>并安装一组默认插件。 <br><br><img src="https://habrastorage.org/webt/bs/9d/xs/bs9dxsxd6-cddmut2bww9utxjw4.png"><br><br><img src="https://habrastorage.org/webt/r5/-m/u-/r5-mu-bgyaqswxcqnyrpds0qhic.png"><br><br> 安装插件后，为自己创建一个用户，然后单击“ <b>保存并完成”</b> <br><br><img src="https://habrastorage.org/webt/iy/ap/jd/iyapjd__vdbys6jsjiinvzcp58q.png"><br><br> 我们同意“实例配置”部分，在该部分中，我们要求填写Jenkins可以使用的URL（在我们的情况下，请保留所有内容） <br><br><img src="https://habrastorage.org/webt/4v/w1/ie/4vw1ieq0o_tm5bkrgn4sb-m__kk.png"><br><br> 然后在下一个屏幕上，单击珍贵的“ <b>开始使用Jenkins”</b> <br><br><img src="https://habrastorage.org/webt/4a/iw/yq/4aiwyqwkzbxjdkjwyzowxyvsktc.png"><br><br> 因此，我们安装并启动了Jenkins！ <br><br><img src="https://habrastorage.org/webt/9a/4z/tu/9a4ztunwk1gxuc8rsho2ql9-tou.png"><br><br> 已经可以使用它了，但是为了收集我们的Android版本，您需要再配置一些点。  Jenkins的本地化与您的浏览器选择的语言有关，当然，俄语翻译还没有完全完成，我们得到了俄文和英文的混合。 如果您以完全相同的方式获得成功，并且激怒了您，则可以使用特殊的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">插件</a>并设置默认界面语言。 好吧，或者将浏览器切换到英文界面。 <br><br> 转到Jenkins设置，然后选择<b>系统配置。</b> <br><br><img src="https://habrastorage.org/webt/pk/xo/1d/pkxo1diloanswc7tciicxhaiidq.png"><br><br> 我们在<b>环境变量上</b>打勾，并在字段中输入名称<b>ANDROID_HOME</b> ，并在字段中指定<b>/ var / lib / android-sdk /</b> （我们在Dockerfile中将此数据指定为Android SDK的主目录）。 <br><br><img src="https://habrastorage.org/webt/on/af/4j/onaf4jfhel5_ys078k5ohrxwxuu.png"><br><br> 单击“ <b>保存”</b>按钮，退出此设置部分，然后转到“ <b>全局工具配置</b> ”部分。 <br><br><img src="https://habrastorage.org/webt/b9/3i/zx/b93izxlndc-utyrnewgv5kluug0.png"><br><br> 设置<b>JDK</b>分区（我们也在Dockerfile中填充了JAVA_HOME变量，我们可以使用其值<b>/ usr / lib / jvm / java-8-openjdk-amd64 / here</b> ）。 <br><br><img src="https://habrastorage.org/webt/0l/wn/2p/0lwn2prv62virmofscvskc5e6_8.png"><br><br> 同样在这里，我们仍然需要填写<b>Gradle</b>部分。 我们选择并安装在您将使用此CI系统构建的那些项目中使用的Gradle版本。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以有多个版本。例如，如果存储库中有gradlew，则也根本无法启动Gradle变量，并且可以使用它来构建它。</font></font><br><br><img src="https://habrastorage.org/webt/0q/fe/wj/0qfewj73fbwr3vzudpk8woyrsmy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样，我们可以结束我们的第一阶段。 Jenkins系统已全面运行，我们可以继续自行定制构建任务。请注意，系统已根据我们的需求进行了调整，此处可能无法满足您的需求-例如，没有用于测试和NDK的android模拟器。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果本文感兴趣，那么我将在第二部分继续介绍一个或两个麻烦的示例，我将描述Jenkins和Bitbucket的集成（是他，而不是Github，因为使用免费的私有存储库和Internet上的文章更容易些）它虽然更小，但也许会更有趣），我将告诉您如何使用存储库中容器的ssh键，如何发送电子邮件通知以及其他几种芯片来结交朋友。</font><font style="vertical-align: inherit;">通常，关于我们已配置的所有内容。</font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我要求你不要踢太多，这是我关于哈勃尔的第一篇文章。</font><font style="vertical-align: inherit;">对所有人都好！</font></font></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN443606/">https://habr.com/ru/post/zh-CN443606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN443594/index.html">测试与架构的十字路口：尼尔·福特访谈</a></li>
<li><a href="../zh-CN443598/index.html">从各种CA大量撤消了TLS证书，这是错误地在63位RNG而非64位RNG上生成的</a></li>
<li><a href="../zh-CN443600/index.html">MWC 2019的最佳和最坏趋势</a></li>
<li><a href="../zh-CN443602/index.html">什么是严格别名，为什么我们要关心？ 第二部分</a></li>
<li><a href="../zh-CN443604/index.html">行动第一：OZON的Hackathon</a></li>
<li><a href="../zh-CN443608/index.html">Lazurite的智能家居/更新</a></li>
<li><a href="../zh-CN443612/index.html">我们使用旧的坏硬盘</a></li>
<li><a href="../zh-CN443614/index.html">YouTrack 2019.1：选择敏捷板，敏捷板上的可自定义卡字段等</a></li>
<li><a href="../zh-CN443616/index.html">替代数据的股票回报率为35％</a></li>
<li><a href="../zh-CN443618/index.html">浏览器中的80年代计算机模拟器</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>