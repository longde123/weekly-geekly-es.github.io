<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèº üôåüèª ü¶ä Lecci√≥n de optimizaci√≥n del servidor de aplicaciones web ü•Å üññüèø üï¥Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! Mi nombre es Alexey Pristavko, soy el director de proyectos web en DataLine. Mi art√≠culo de hoy trata sobre c√≥mo solucionar o prevenir prob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lecci√≥n de optimizaci√≥n del servidor de aplicaciones web</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/414515/"><img src="https://habrastorage.org/getpro/habr/post_images/a96/4bf/146/a964bf1461da7bcce74ab62b242aa133.png"><br><br>  Hola Habr!  Mi nombre es Alexey Pristavko, soy el director de proyectos web en DataLine.  Mi art√≠culo de hoy trata sobre c√≥mo solucionar o prevenir problemas de rendimiento del backend de la aplicaci√≥n web. <br><br>  Esto se centrar√° en c√≥mo optimizar las aplicaciones web que sufren problemas cr√≥nicos de escalabilidad, rendimiento o confiabilidad. <br>  Cualquier persona interesada: ¬°bienvenido bajo el corte! <br><a name="habracut"></a><br><h2>  Terminolog√≠a </h2><br>  Comencemos con un vistazo a la terminolog√≠a.  Hablando sobre el rendimiento de proyectos web o sistemas web, me refiero principalmente al back-end y al componente del servidor.  Lo que sucede al cargar p√°ginas en un navegador es una historia completamente diferente, que, muy probablemente, se dedicar√° a un art√≠culo separado. <br><br><ul><li>  La medida <b>del rendimiento de la</b> aplicaci√≥n ser√° el n√∫mero de solicitudes procesadas por segundo (RPS) y su velocidad de ejecuci√≥n (TTFB - Tiempo hasta el primer byte). <br></li><li>  En consecuencia, por <b>escalabilidad del</b> sistema nos referimos a un conjunto de oportunidades para aumentar el RPS. <br></li></ul><br>  Ahora sobre la fiabilidad.  Aqu√≠ es necesario separar dos conceptos: tolerancia a fallas y tolerancia a desastres. <br><br><ul><li> <b>Resiliencia ante fallas</b> : la capacidad de un sistema <b>de fallar</b> si uno o m√°s servidores <b>no</b> pueden continuar trabajando dentro de los par√°metros requeridos. <br></li><li>  Los sistemas con redundancia de copia de seguridad completa (el llamado segundo hombro) y capaces de funcionar sin una fuerte reducci√≥n con la falla completa de uno de los centros de datos se consideran <b>resistentes a los desastres</b> . <br></li></ul><br>  <b>Al mismo tiempo, un sistema tolerante a desastres es un sistema a prueba de fallas.</b>  Una situaci√≥n en la que un sistema tolerante a desastres, pero no tolerante a fallas contin√∫a trabajando en un solo "hombro" es bastante normal.  Pero si uno de los servidores falla, el sistema tambi√©n fallar√°. <br><br>  Ahora que hemos descubierto los conceptos clave y actualizado la terminolog√≠a actual, es hora de pasar directamente a los conceptos b√°sicos de optimizaci√≥n y trucos de la vida. <br><br><h2>  Donde comenzar la optimizaci√≥n </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/1e9/7ed/adf/1e97edadf840f697e8a995e8a53d7269.png"><br><br>  ¬øC√≥mo entender d√≥nde comenzar la optimizaci√≥n?  Antes de apresurarse a optimizar, respire profundamente y pase tiempo investigando la aplicaci√≥n. <br><br>  Aseg√∫rese de dibujar un diagrama detallado.  Muestre en √©l todos los componentes de la aplicaci√≥n y sus relaciones.  Despu√©s de examinar este esquema, puede descubrir vulnerabilidades previamente discretas y puntos potenciales de falla. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/996/3fb/b5a/9963fbb5a9be1336886b708fb4d071e2.png"><br><br><h3>  "¬øQu√©?  Donde  ¬øCu√°ndo?  - optimizar consultas </h3><br>  Presta especial atenci√≥n a las solicitudes sincr√≥nicas.  Perm√≠tame recordarle, estas son solicitudes cuando enviamos una solicitud en el mismo hilo y esperamos una respuesta.  Aqu√≠ es donde se encuentran las razones de los frenos graves cuando algo sale mal del otro lado.  Por lo tanto, si puede reducir el n√∫mero de solicitudes sincr√≥nicas o reemplazarlas por otras as√≠ncronas, h√°galo. <br><br>  Aqu√≠ hay algunos trucos para ayudarlo a rastrear sus solicitudes: <br><br><ul><li>  <b>Asigne un identificador √∫nico a cada solicitud entrante.</b>  Nginx tiene una variable incorporada $ request_id para esto.  Pase el identificador en los encabezados del back-end y escriba en todos los registros.  Para que pueda rastrear convenientemente las solicitudes. </li><li>  <b>Registre no solo el final de la solicitud en el componente externo, sino tambi√©n su comienzo.</b>  Entonces, mide la duraci√≥n real de la llamada externa.  Puede diferir significativamente de lo que ve en el sistema remoto, por ejemplo, debido a problemas de red o frenos DNS. </li></ul><br>  Entonces, los datos se recopilan.  Ahora analicemos los puntos problem√°ticos.  Definir: <br><br><ul><li>  ¬øD√≥nde pasa m√°s tiempo? </li><li>  ¬øDe d√≥nde provienen la mayor√≠a de las solicitudes? </li><li>  ¬øDe d√≥nde vienen las solicitudes m√°s largas? </li></ul><br>  Como resultado, obtendr√° una lista de las secciones m√°s interesantes del sistema para la optimizaci√≥n. <br><br><blockquote>  <b>Consejo:</b> Si alg√∫n punto "recopila" muchas consultas peque√±as, intente combinarlas en una consulta grande para reducir la sobrecarga.  Los resultados de consultas largas a menudo tienen sentido en la memoria cach√©. </blockquote><br><h3>  Nos almacenamos sabiamente </h3><br>  Existen reglas generales de almacenamiento en cach√© en las que debe confiar al optimizar: <br><br><ul><li>  <b>Cuanto m√°s cerca est√© el cach√© del consumidor, m√°s r√°pido ser√° el trabajo.</b>  Para la aplicaci√≥n, el lugar "m√°s cercano" ser√° RAM.  Para el usuario, su navegador. </li><li>  <b>El almacenamiento en cach√© acelera la adquisici√≥n de datos y reduce la carga en la fuente.</b> </li></ul><br>  Si diez servidores web realizan las mismas consultas a la base de datos, un cach√© intermedio centralizado, por ejemplo en Redis, dar√° un mayor porcentaje de visitas (en comparaci√≥n con el cach√© local) y reducir√° la carga general en la base de datos, lo que mejorar√° significativamente la imagen general. <br><br><blockquote>  <b>Consejo 1:</b> Realice el almacenamiento en cach√© de componentes de la p√°gina terminada en el lado de Nginx con Edge Side incluye.  Se adapta bien a la arquitectura de microservicios / SOA y descarga el sistema en su conjunto, mejorando en gran medida la velocidad de respuesta. <br><br>  <b>Consejo 2:</b> realice un seguimiento del tama√±o de los objetos en la memoria cach√©, la proporci√≥n de aciertos y los vol√∫menes de escritura / lectura.  Cuanto m√°s grande sea el objeto, m√°s tardar√° en procesarse.  Si escribe en el cach√© con m√°s frecuencia o m√°s de lo que lee, ese cach√© no es su amigo.  Vale la pena eliminarlo o pensar en aumentar su efectividad. <br><br>  <b>Consejo 3:</b> use sus propias cach√©s de bases de datos cuando sea posible.  La configuraci√≥n adecuada puede acelerar el trabajo. </blockquote><br><h3>  Cargar perfiles </h3><br>  Pasamos a cargar perfiles.  Como sabes, hay dos tipos principales: OLAP y OLTP. <br><br><ul><li>  <b>Para OLAP</b> (procesamiento anal√≠tico en l√≠nea), la cantidad de tr√°fico gastado por segundo es importante. <br></li><li>  <b>Para OLTP</b> (procesamiento de transacciones en l√≠nea), el indicador clave es la velocidad de respuesta, tiempos de milisegundos. <br></li></ul><br>  Muy a menudo, es efectivo separar estos dos tipos de carga.  Como m√≠nimo, necesitar√° un ajuste separado de la base de datos y, posiblemente, de otros componentes del sistema. <br><br><blockquote>  <b>Consejo: las</b> solicitudes de lectura desde el panel de administraci√≥n generalmente se procesan con el tipo OLAP.  Cree una copia separada de la base de datos y un servidor web para que esta tarea descargue el sistema principal. </blockquote><h3>  Bases de datos </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/753/b35/7df/753b357df47b173bb57ab2de92e02e58.png"><br><br>  Entonces, naturalmente, nos acercamos a una de las etapas m√°s dif√≠ciles de optimizaci√≥n, a saber, la optimizaci√≥n de la base de datos. <br><br>  Perm√≠tame recordarle la regla general: cuanto m√°s peque√±a es la base de datos, m√°s r√°pido funciona.  La organizaci√≥n misma de la base de datos es crucial cuando se trata de velocidad. <br><br>  Si es posible, almacene <b>datos hist√≥ricos</b> , registros de aplicaciones y datos <b>utilizados con frecuencia</b> en diferentes bases de datos.  Mejor a√∫n, publ√≠quelos en diferentes servidores.  Esto no solo facilitar√° la vida de la base de datos principal, sino que tambi√©n dar√° m√°s espacio para una mayor optimizaci√≥n, por ejemplo, en algunos casos permitir√° el uso de diferentes √≠ndices para diferentes cargas.  Adem√°s, la "uniformidad" de la carga simplifica la vida del planificador y el optimizador de consultas del servidor de bases de datos. <br><br><h3>  Y nuevamente sobre la importancia de planificar </h3><br>  Para no confundir la optimizaci√≥n donde realmente no es necesaria, elija el hardware en funci√≥n de las tareas. <br><br><ul><li>  Para solicitudes peque√±as, pero frecuentes, es mejor tomar m√°s n√∫cleos de procesador. </li><li>  Para solicitudes pesadas: menos n√∫cleos con una mayor velocidad de reloj. </li></ul><br>  Intente poner el volumen de trabajo de la base de datos en la RAM.  Si esto no es posible o hay una gran cantidad de solicitudes de escritura, es hora de buscar transferir las bases de datos a SSD.  Dar√°n un aumento significativo en la velocidad de trabajo con el disco. <br><br><h2>  Escalamiento </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/54b/df1/be6/54bdf1be69c1d596c882fc2d04d5c11c.png"><br><br>  Arriba, describ√≠ la mec√°nica clave para mejorar el rendimiento de la aplicaci√≥n sin aumentar sus recursos f√≠sicos. <br><br>  Ahora hablaremos sobre c√≥mo elegir una estrategia de escala y aumentar la resistencia. <br><br>  Hay dos tipos de escalado del sistema: <br><br><ul><li>  <b>vertical</b> : el crecimiento de los recursos mientras se mantiene el n√∫mero de entidades; <br></li><li>  <b>horizontal</b> : un aumento en el n√∫mero de entidades. <br></li></ul><br><h3>  Crecer alto </h3><br>  Comencemos eligiendo una estrategia de escala vertical. <br><br>  Primero, considere el <b>aumento de la potencia del sistema</b> .  Si su sistema funciona dentro de un servidor, tendr√° que elegir entre aumentar la capacidad del servidor actual o comprar otro. <br><br>  Puede parecer que la primera opci√≥n es m√°s f√°cil y segura.  Pero ser√° m√°s previsible comprar un servidor m√°s y recibir una gran tolerancia a fallas como un bono a la productividad.  Habl√© sobre esto al comienzo del art√≠culo. <br><br>  Si su sistema tiene varios servidores y la opci√≥n es aumentar la capacidad de los existentes o comprar algunos m√°s, preste atenci√≥n a la parte financiera.  Por ejemplo, un servidor potente puede ser m√°s costoso que dos 50% "m√°s d√©biles".  Por lo tanto, ser√° razonable detenerse en la segunda opci√≥n de compromiso.  Al mismo tiempo, con una gran cantidad de servidores, la relaci√≥n de rendimiento, consumo de energ√≠a y el costo de un rack completo es crucial. <br><br><h3>  Crecer de ancho </h3><br>  La escala horizontal es una historia sobre tolerancia a fallas y agrupamiento.  En el caso general, mientras m√°s instancias tengamos de una entidad, mayor ser√° la tolerancia a fallas de toda la soluci√≥n. <br><br>  Probablemente lo primero que desea escalar son <b>los servidores de aplicaciones</b> .  El primer obst√°culo para esto es la organizaci√≥n del trabajo con fuentes de datos centralizadas.  Adem√°s de las bases de datos, tambi√©n son datos de sesi√≥n y contenido est√°tico.  Esto es lo que te recomiendo que hagas: <br><br><ul><li>  <b>Para almacenar sesiones,</b> use Couchbase, no el Memcached habitual, ya que funciona con el mismo protocolo, pero, a diferencia de memcached, admite la agrupaci√≥n en cl√∫ster. <br></li><li>  <b>Todas las estad√≠sticas</b> , especialmente los grandes vol√∫menes de im√°genes y documentos, se almacenan por separado y se sirven con Nginx, y no desde el c√≥digo de la aplicaci√≥n.  Esto le ahorrar√° dinero en flujos y simplificar√° la administraci√≥n de la infraestructura. <br></li></ul><br><h3>  "Levantando" la base de datos </h3><br>  Dif√≠cil de escalar bases de datos.  Hay dos t√©cnicas principales para esto: fragmentaci√≥n y replicaci√≥n.  Consid√©ralos. <br><br>  Durante la <b>replicaci√≥n,</b> agregamos copias completamente id√©nticas de la base de datos al sistema, mientras <b>fragmentamos</b> , partes separadas l√≥gicamente, fragmentos.  Al mismo tiempo, es altamente deseable llevar a cabo el fragmentaci√≥n en paralelo con la replicaci√≥n (replicaci√≥n) de cada fragmento para no perder la tolerancia a fallas. <br><br><blockquote>  <b>Recuerde: a</b> menudo, un cl√∫ster de base de datos consta de un nodo maestro que se hace cargo de la secuencia de escritura y varios nodos esclavos utilizados para la lectura.  Desde el punto de vista de la tolerancia a fallas, esto es ligeramente mejor que un solo servidor, ya que la tolerancia a fallas general est√° determinada por el elemento menos estable del sistema. </blockquote><br>  Los esquemas con m√°s de dos asistentes de base de datos (topolog√≠a en anillo) sin confirmar el registro en cada servidor, a menudo sufren inconsistencias.  En caso de falla de uno de los servidores, ser√° extremadamente dif√≠cil restaurar la integridad l√≥gica de los datos en el cl√∫ster. <br><br><blockquote>  <b>Consejo:</b> Si en su caso no es racional tener varios servidores maestros, considere la posibilidad arquitect√≥nica de que el sistema funcione sin un maestro durante al menos una hora.  En caso de accidente, esto le dar√° tiempo para reemplazar el servidor sin tiempo de inactividad de todo el sistema. <br><br>  <b>Consejo:</b> Si necesita mantener m√°s de 2 maestros de bases de datos, le recomiendo que considere las soluciones NoSQL, ya que muchas de ellas tienen mecanismos incorporados para llevar los datos a un estado consistente. </blockquote><br>  En la b√∫squeda de la tolerancia a fallas, en ning√∫n caso no olvide que la replicaci√≥n le asegura <b>solo contra fallas f√≠sicas del servidor</b> .  No se guardar√° de la corrupci√≥n de datos l√≥gicos debido a un error del usuario. <br><br><blockquote>  <b>Recuerde: todos los</b> datos importantes deben ser respaldados y almacenados como una copia independiente no editable. </blockquote><br><h2>  En lugar de una conclusi√≥n </h2><br>  Por √∫ltimo, un par de consejos de rendimiento para realizar copias de seguridad: <br><br><blockquote>  <b>Consejo 1:</b> Extraiga datos de una r√©plica de base de datos separada para no sobrecargar el servidor activo. <br><br>  <b>Consejo 2:</b> Tenga a mano una r√©plica adicional, ligeramente "retrasada" en el tiempo de la base de datos.  En caso de accidente, esto ayudar√° a reducir la cantidad de datos perdidos. </blockquote><br>  Los m√©todos y t√©cnicas presentados en este art√≠culo nunca deben usarse a ciegas, sin analizar la situaci√≥n actual y comprender lo que le gustar√≠a lograr.  Puede encontrar "sobre-optimizaci√≥n", y el sistema resultante ser√° solo un 10% m√°s r√°pido, pero un 50% m√°s vulnerable a los accidentes. <br><br>  Eso es todo  Si tiene alguna pregunta, me complacer√° responderla en los comentarios. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414515/">https://habr.com/ru/post/es414515/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414503/index.html">Intel NUC Hades Canyon con AMD Vega Graphics: ¬øVR o no VR?</a></li>
<li><a href="../es414505/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 2: "Control de ataques de hackers", parte 1</a></li>
<li><a href="../es414507/index.html">C√≥mo ha cambiado el teclado programable m√°s popular para el comercio: la historia del teclado Bloomberg</a></li>
<li><a href="../es414509/index.html">Conectamos cualquier (casi) rastreador GPS (usando el Sinotrack ST-901 como ejemplo) a la casa inteligente HomeAssistant</a></li>
<li><a href="../es414513/index.html">27 excelentes herramientas de desarrollo web de c√≥digo abierto</a></li>
<li><a href="../es414517/index.html">Cient√≠ficos de Oxford: la probabilidad de que estemos solos en la parte previsible del universo es mucho mayor que cero</a></li>
<li><a href="../es414519/index.html">¬øC√≥mo convertir 15 minutos de reuniones de Scrum en una casa llena?</a></li>
<li><a href="../es414523/index.html">Comparaci√≥n de quadcopters DJI Mavic Pro y Mavic Air</a></li>
<li><a href="../es414525/index.html">El libro "Eficaz chispa. Escalado y optimizaci√≥n "</a></li>
<li><a href="../es414527/index.html">Lo que nos espera en Highload ++ Siberia, excepto los osos pintados</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>