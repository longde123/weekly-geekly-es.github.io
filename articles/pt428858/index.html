<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñüèΩ üö¨ ‚ôéÔ∏è Confer√™ncia DEFCON 17. Ria dos seus v√≠rus! Parte 1 üè® üåä üë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Michael: Congratulo - me com todos, sou Michael Lai, este √© Matthew Richard, voc√™ pode cham√°-lo de Matt ou Richard, porque ele tem dois nomes, mas iss...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Confer√™ncia DEFCON 17. Ria dos seus v√≠rus! Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/428858/"> <b>Michael: Congratulo</b> - <b>me</b> com todos, sou Michael Lai, este √© Matthew Richard, voc√™ pode cham√°-lo de Matt ou Richard, porque ele tem dois nomes, mas isso n√£o importa. <br><br>  <b>Matt:</b> O t√≥pico de nossa conversa hoje √© rid√≠culo de malware, e √© exatamente isso que estamos tentando fazer. <br><br><img src="https://habrastorage.org/webt/dg/yd/dw/dgyddwjbkvhvkngc1lug68ifhb8.jpeg"><br><br>  Portanto, nem todo mundo que escreve o c√≥digo faz isso bem, as pessoas cometem muitos erros.  E nem todo mundo que usa o v√≠rus faz certo.  Tamb√©m h√° pessoas que falham nesses dois casos.  Portanto, sente-se com mais conforto, relaxe e ou√ßa, talvez essa informa√ß√£o seja √∫til para voc√™. <br><br>  Por precau√ß√£o, inclu√≠mos material t√©cnico factual na apresenta√ß√£o para que voc√™ pelo menos aprenda algo se a conversa n√£o lhe parecer engra√ßada.  Observo que esta √© apenas a nossa opini√£o, que pode n√£o coincidir com a opini√£o de nossos empregadores. <a name="habracut"></a><br><br>  <b>Michael: A</b> primeira hist√≥ria se chama "Querida, reduzi a entropia!"  Ela fala sobre como o autor do Silent Banker, um algoritmo de criptografia muito complexo, esqueceu de criar entropia usando o PRNG - um gerador de n√∫meros pseudo-aleat√≥rios.  No slide, voc√™ v√™ um snippet de c√≥digo Zeus de setembro de 2007 no qual o PRNG √© usado para impedir a detec√ß√£o baseada em hash.  A gera√ß√£o consiste em iniciar essa vari√°vel global chamada ddTickCount: primeiro, coloca-a no registro EAX, de onde a fun√ß√£o √© chamada pela primeira vez.  Em seguida, √© verificado se o valor da fun√ß√£o √© igual a zero e, se n√£o for igual, o TickCount √© chamado para gerar o SEED, ou seja, para iniciar um n√∫mero pseudo-aleat√≥rio, usando o comando GetTickCount. <br><br><img src="https://habrastorage.org/webt/eq/lo/pv/eqlopvhuevvaq3r9k1oqbkdygy0.jpeg"><br><br>  N√£o ficamos surpresos quando vimos as semelhan√ßas com esse c√≥digo no arquivo bin√°rio do Silent Banker de fevereiro de 2008.  Ele usa o PRNG para gerar nomes de arquivos tempor√°rios.  Aqui tamb√©m existe a mesma vari√°vel global ddTickCount, que verifica se existe um zero e, se houver, um n√∫mero pseudo-aleat√≥rio √© iniciado usando GetTickCount.  Primeiro, antes de ver o msvsrt rand, o gerador de n√∫meros pseudo-aleat√≥rios usado pela fun√ß√£o rand () da biblioteca Microsoft C Runtime Windows, pensei que havia uma conex√£o entre o autor do Zeus e o autor do Silent Banker, apenas com base nos n√∫meros HEX que foram codificados em um arquivo bin√°rio .  Mas, na verdade, os dois estavam apenas estaticamente vinculados ao msvsrt. <br><br>  Agora chegamos √† receita do desastre.  Este √© um trecho de c√≥digo da vers√£o Silent Banker de julho de 2008, lan√ßado alguns meses ap√≥s a vers√£o de fevereiro. <br><br><img src="https://habrastorage.org/webt/z9/wh/fr/z9whfrngqr3rhppqfx1xdficwio.jpeg"><br><br>  Eles atualizaram seu c√≥digo e publicaram uma nova vers√£o do Silent Banker, que era significativamente diferente do que vimos anteriormente.  Neste programa, o PRNG √© usado para gerar uma chave de criptografia.  Aqui voc√™ n√£o v√™ mais que uma vari√°vel global chamada CurrentSeed √© verificada quanto √† igualdade de zero e um n√∫mero pseudo-aleat√≥rio √© gerado dependendo disso, √© simplesmente usado neste c√≥digo. <br><br><img src="https://habrastorage.org/webt/tz/ig/ny/tzignymsyqo08w5wjth2zugzo38.jpeg"><br><br>  √â poss√≠vel que em algum lugar do arquivo bin√°rio, mesmo antes deste local, o valor dessa vari√°vel global seja gerado na forma de algum tipo de n√∫mero.  Ent√£o, passo a desmontar esse c√≥digo e ver se o valor CurrentSeed √© usado em outro lugar do programa antes de ser usado nessa fun√ß√£o rand ().  Voc√™ v√™ que o dd inicialmente come√ßa do zero e verificaremos as refer√™ncias cruzadas para essa vari√°vel. <br><br><img src="https://habrastorage.org/webt/xb/gw/uh/xbgwuhestru6xn4re261ayainnk.jpeg"><br><br>  Na coluna T, o valor w significa que h√° apenas uma opera√ß√£o v√°lida para essa vari√°vel global em todo o arquivo bin√°rio - esta √© a pr√≥pria fun√ß√£o rand.  Analisarei essas coisas fluentemente, porque elas j√° foram mencionadas no DefCon do ano passado.  No slide ‚ÄúReceita para desastres‚Äù, a linha Semear o PRNG, ou ‚ÄúInicia√ß√£o de um gerador de n√∫meros pseudo-aleat√≥rios‚Äù, √© mostrada em cinza para indicar que o autor do Silent Banker n√£o fez essa inicia√ß√£o. <br><br><img src="https://habrastorage.org/webt/bp/aj/n9/bpajn9ym0w4nhtdxaboum9cm2oe.jpeg"><br><br>  O pr√≥ximo passo √© que eles gerem uma chave de 16 bytes, fazendo 1000 chamadas do sistema para a fun√ß√£o MyRand ().  Em seguida, a partir de uma chave de 16 bytes, eles geram um n√∫mero de 8 bytes - a chave, usando uma f√≥rmula espec√≠fica. <br><br>  Depois disso, eles geram outro n√∫mero de 8 bytes para criar uma chave secund√°ria a partir do primeiro n√∫mero de 8 bytes, adicionam um valor arbitr√°rio a partir do arquivo de configura√ß√£o INI e obt√™m uma chave terci√°ria, que tamb√©m √© um n√∫mero de 8 bytes.  Finalmente, eles usam uma fun√ß√£o matem√°tica de precis√£o arbitr√°ria para transformar uma chave de 8 bytes em uma de 32 bytes. <br><br>  Depois disso, eles criptografam os dados roubados, como a senha do usu√°rio, usando a chave original de 16 bytes.  Mas eles n√£o passam esse n√∫mero de "16" bytes para o invasor "deles" com os dados roubados, porque enviar a chave junto com a mensagem criptografada n√£o √© uma boa ideia.  Em vez disso, o autor do Silent Banker coloca um n√∫mero de 32 bytes dentro dos dados roubados e o envia ao destinat√°rio, que deve ter um programa que converta esse n√∫mero de volta na chave original de 16 bytes.  No entanto, n√£o temos este programa! <br><br>  O pr√≥ximo slide mostra uma receita de como usar esse desastre com o n√∫mero 1 - a falta de um gerador de PRNG - para sua vantagem. <br><br><img src="https://habrastorage.org/webt/al/wp/lm/alwplmsbxy8ej3auux-aa0v6qbk.jpeg"><br><br>  Para come√ßar, igualamos o valor de PRNG a zero.  Podemos automatizar as pr√≥ximas quatro etapas usando um script Python para o depurador, porque temos uma f√≥rmula que calcula uma chave de 16 bytes, uma chave de 8 bytes, a pr√≥xima chave de 8 bytes e uma chave de 32 bytes.  Essa f√≥rmula n√£o est√° no c√≥digo C, mas a temos porque temos uma c√≥pia do arquivo bin√°rio do Silent Banker no qual ela existe. <br><br>  Vou mostrar uma demonstra√ß√£o de como esse script Python funciona.  Temos um bom cen√°rio: aqui tenho o Silent Banker e um depurador independente ao qual estou conectado, bem como o Internet Explorer, no qual o Silent Banker est√° sendo executado.  Observei quatro recursos que geram chaves de criptografia.  Eu incluo este script Python mostrado no slide anterior, que eu chamo com o comando bang keygen.  Voc√™ pode ver que o depurador simplesmente "perde" essas poucas fun√ß√µes que eu quero executar para esta demonstra√ß√£o 5 vezes.  Mas na vida real, realizamos essa a√ß√£o 5.000 vezes para obter um conjunto maior de chaves. <br><br>  No painel de log, voc√™ pode ver que, para cada itera√ß√£o do loop, √© emitida uma chave prim√°ria de 16 bytes, que √© ent√£o associada a uma chave de 32 bytes.  Ao mesmo tempo em que o script imprime informa√ß√µes no log, tamb√©m √© criado um arquivo de texto no disco, que inclui pares de chaves relacionadas de 16 e 32 bytes.  √â apenas um arquivo hexadecimal HEX, para que possamos usar nosso script Python para processar esse arquivo, tamb√©m temos um diret√≥rio de log que recuperamos do n√≥ de comando e controle roubado. <br><br><img src="https://habrastorage.org/webt/3l/s8/q5/3ls8q5neoqhw_1vzzbx9iadyvuy.jpeg"><br><br>  Na parte superior, voc√™ v√™ v√°rios certificados de chaves privadas criptografadas e, abaixo deles, v√°rios arquivos de texto que cont√™m dados criptografados.  Podemos simplesmente executar o programa e pesquisar dentro desses arquivos de texto extraindo essa chave de 32 bytes e a chave original de 16 bytes associada a ele. <br><br>  Assim que o programa encontra uma chave de 16 bytes, descriptografa as informa√ß√µes nele contidas e as apresenta na forma de um arquivo de texto.  Voc√™ v√™ esse arquivo na tela e √© imposs√≠vel l√™-lo. <br><br><img src="https://habrastorage.org/webt/_l/65/sk/_l65skt8szevodoual8wimixbhi.jpeg"><br><br>  Mas temos um monte de arquivos tempor√°rios .tmp leg√≠veis, de onde podemos obter essas informa√ß√µes e devolv√™-las aos propriet√°rios "leg√≠timos".  Portanto, todo o trabalho duro para proteger as informa√ß√µes foi realizado em v√£o pelo Silent Banker, porque eles esqueceram de iniciar um gerador de n√∫meros pseudo-aleat√≥rios. <br><br><img src="https://habrastorage.org/webt/bm/kj/qn/bmkjqnl8fuofa6yhjzjfhg2golq.jpeg"><br><br>  Agora vou mostrar a melhor parte do exposto acima - esta √© a fun√ß√£o Silent Banker, que chamei de Why_Not_Use_This (por que n√£o us√°-la?). <br><br><img src="https://habrastorage.org/webt/nz/yi/-l/nzyi-lwhkvyqil67khx6wt6zeiy.jpeg"><br><br>  De fato, dentro de seu pr√≥prio programa, eles t√™m a fun√ß√£o GetCursorPos (determinar a posi√ß√£o do cursor) para gerar entropia, que pode ser usada para iniciar o PRNG, e podemos verificar refer√™ncias cruzadas para essa fun√ß√£o dentro do programa. <br><br><img src="https://habrastorage.org/webt/eb/7z/pu/eb7zpunaanojkiys5gc6wx8cgvi.jpeg"><br><br>  Vemos que ele √© usado em 10 a 15 outros lugares no c√≥digo.  Assim, verifica-se que os autores do Silent Banker n√£o esqueceram de inserir um gerador de n√∫meros pseudo-aleat√≥rios no programa, simplesmente esqueceram de executar essa fun√ß√£o no processo de criptografia usando o operador de chamada. <br><br><img src="https://habrastorage.org/webt/lp/_n/e-/lp_ne-pmgawe-72jw9_x0fvj6ym.jpeg"><br><br>  O pr√≥ximo slide √© chamado "Isso escapou ..." e mostra como esse programa funcionaria se o autor n√£o tivesse esquecido nada. <br><br><img src="https://habrastorage.org/webt/x0/wn/kb/x0wnkb_6crrojmz0r7twgomdav0.jpeg"><br><br>  A pr√≥xima hist√≥ria, intitulada "DES ou n√£o DES", √© sobre um autor de malware que nem sabe como usar adequadamente a interface de programa√ß√£o do Windows ou n√£o sabe qual √© o tamanho m√°ximo da chave DES.  Como resultado, devido ao tamanho inv√°lido dessa chave, seu Trojan √© usado por padr√£o com o operador l√≥gico xor. <br><br>  Portanto, para a fun√ß√£o de interface do programa CryptDeriveKey, os dois bytes baixos do par√¢metro dwFlags, sinalizadores que definem a apar√™ncia da URL resultante, determinam o tamanho da sua chave de criptografia. <br><br><img src="https://habrastorage.org/webt/2a/jt/-q/2ajt-qrub9dk2qkyhbea_panhly.jpeg"><br><br>  Portanto, se os bytes baixos forem 0080, a chave de criptografia solicitada ser√° uma chave RC4 de 128 bits.  √â o mesmo que dar um tiro no pr√≥prio p√©, e eu vou lhe mostrar o porqu√™. <br><br><img src="https://habrastorage.org/webt/02/fm/ev/02fmevcyb9eos_-2a5qcpofweqq.jpeg"><br><br>  No slide, voc√™ v√™ uma linha com o tamanho errado da chave dwFlags de 128 bits - 800000 e uma linha com o valor incorreto do MSCryptoAPI.  Eu vou te mostrar a desmontagem dessa coisa.  Voc√™ v√™ uma fun√ß√£o chamada ‚Äúinicializa√ß√£o do subsistema de criptografia‚Äù: o trojan chama o contexto criptografado e cria um cont√™iner para o hash MD5, ap√≥s o qual cria um hash MD5 da senha codificada no arquivo bin√°rio e tenta usar a sa√≠da dessa fun√ß√£o hash para criar uma chave DES de 128 bits.  No entanto, nenhuma chave √© criada nesse caso, porque n√£o existe uma chave DES de 128 bits. <br><br><img src="https://habrastorage.org/webt/cp/kv/os/cpkvosn5t2fsqsxbgd3kjdrb5-c.jpeg"><br><br>  Se alguma dessas fun√ß√µes da API falhar, ela pula para este local, que eu marquei em amarelo, e exibe uma mensagem de que a chave n√£o pode ser recebida.  E este lugar √© aqui, onde ele move o valor que est√° em ebp e naquele momento √© 0, ou seja, diretamente para esse valor booleano bUseMSCryptoAPI. <br><br>  Vamos ver o efeito que isso causa durante a execu√ß√£o do programa.  Seguiremos esse elemento da estrutura de c√≥digo para ver onde mais ele √© usado no programa e qu√£o diferente esse trojan exibe se comporta quando a fun√ß√£o √© verdadeira e quando a ferida √© falsa. <br><br><img src="https://habrastorage.org/webt/-4/0d/m1/-40dm1wrxg7y9pjzfdyv5wp_ov8.jpeg"><br><br>  Vemos que o valor l√≥gico √© verificado na fun√ß√£o que chamei de criptografar dados, ‚Äúcriptografia de dados‚Äù e, se for verdade, chega a esse bloco, onde s√£o usadas a criptografia DES e o MSAPI CryptEncrypt. <br><br><img src="https://habrastorage.org/webt/bf/14/oz/bf14oz0sgb2bwpj9fkorcziwhhw.jpeg"><br><br>  No entanto, se esse valor for 0 e, como sabemos, sempre ser√° zero, a fun√ß√£o vai para esse bloco, que por padr√£o √© xor. <br><br><img src="https://habrastorage.org/webt/3i/y2/go/3iy2gollhuccdcjwuclgygehxsq.jpeg"><br><br>  Fiquei curioso para saber em que momento o autor do programa malicioso decidiu fazer backup de tudo isso.  Talvez as pessoas o pressionassem de cima para baixo, ent√£o ele foi for√ßado a se livrar do malware, mas no √∫ltimo minuto ele percebeu que seu DES n√£o funcionava, ent√£o ele usou o xor para grava√ß√£o de backup.  No geral, foi bem engra√ßado, ent√£o a moral dessa hist√≥ria √© sempre fazer backups! <br><br>  A hist√≥ria a seguir √© chamada "O que voc√™ fez com o qu√™?".  Tentei criar um termo que descrevesse como a criptografia do Trojan Coreflood funciona e decidi cham√°-lo de "criptografia dependente da localiza√ß√£o".  Em suma, os autores deste Trojan inventaram um novo m√©todo de criptografia.  Eu pensei, talvez algu√©m j√° tenha escrito um artigo sobre isso e deveria ser "google"?  O Google me deu um link para um site de patentes nos EUA onde algu√©m registrou uma patente para "criptografia dependente da localiza√ß√£o".  Esse esquema √© bastante confuso, portanto levar√° muito tempo para estud√°-lo.  Eis como funciona: Estou enviando uma mensagem criptografada e, para decifr√°-la e l√™-la, voc√™ precisa pegar um dispositivo GPS e ir at√© um ponto com a latitude e longitude indicadas por mim.  Normalmente, a criptografia √© um compromisso entre seguran√ßa e usabilidade, mas n√£o existe um nem outro nesse m√©todo. <br><br><img src="https://habrastorage.org/webt/ff/s5/bk/ffs5bkfdwagmbngmoms8efnmcje.jpeg"><br><br>  Definitivamente, isso n√£o √© seguro e exige que voc√™ v√° para onde o remetente aponta para ler a mensagem.  Matt brincou dizendo que, se voc√™ est√° lutando online por e-mail e realmente quer se livrar de algu√©m, envie a ele uma mensagem criptografada que ele pode ler em algum lugar do Iraque e voc√™ n√£o ter√° mais problemas com ele. <br><br>  Como esse m√©todo √© usado no Trojan Coreflood?  O slide mostra um fragmento de c√≥digo do qual se conclui que, ap√≥s o cavalo de Troia ter roubado informa√ß√µes do usu√°rio, ele √© criptografado e gravado no disco para que o cavalo de Tr√≥ia possa posteriormente receber essas informa√ß√µes e fazer upload de comando e controle em seu site. <br><br>  Essa fun√ß√£o √© chamada SetFilePointer (define o ponteiro do arquivo) e seu valor de retorno √© dWord, indicando o deslocamento no arquivo no qual o ponteiro foi definido, se excedido.  Em seguida, a fun√ß√£o pega o n√∫mero de bytes para criptografar nNumberOfBitesToWrite e o move para o registro ecx.  Ela ent√£o pega o ponteiro de dados para criptografia e o move para o registro edx. <br><br><img src="https://habrastorage.org/webt/rg/lp/tu/rglptunvnn4tddlxgtivifxdg6w.jpeg"><br><br>  Depois disso, √© utilizado o operador xor, que coloca cada byte no buffer al e ah, o que significa bytes de n√≠vel alto e baixo retornados do SetFilePointer.  Portanto, a chave de criptografia nesse esquema √© o deslocamento no arquivo em que os dados existem.  Isso √© incr√≠vel! <br><br>  O pr√≥ximo slide √© chamado "Como redefinir um dump principal".  Ele descreve o programa dumpCore que acabei de escrever, que acabou de sair.  Voc√™ pode baix√°-lo, existe todo o c√≥digo fonte.  Este programa ajudar√° voc√™ se o computador estiver infectado com o v√≠rus Coreflood, que por algum motivo n√£o p√¥de acessar o servidor de comando e controle para baixar os dados roubados.  Para que voc√™ possa obter esses arquivos que ele salvou em disco e descriptograf√°-los usando o meu programa para descobrir o que foi roubado de voc√™, por exemplo, se precisar informar o cliente sobre isso. <br><br>  Os registros dos dados roubados est√£o circulados em vermelho no slide. <br><br><img src="https://habrastorage.org/webt/xb/ib/c6/xbibc6gjkihoami36sqhcopedky.jpeg"><br><br>  O que ainda √© interessante no Coreflood: embora tenha um algoritmo de criptografia bastante fraco, ele ainda tenta transferir todas as informa√ß√µes roubadas sobre a configura√ß√£o do computador da v√≠tima, todas as informa√ß√µes de destino de bancos e cooperativas de cr√©dito e assim por diante.  Portanto, outra maneira de remover um core dump √© chamada "Como remover um core dump usando o Wireshark".  O Wireshark √© um programa que analisa o tr√°fego da rede Ethernet ou o fluxo de dados TCP. <br><br><img src="https://habrastorage.org/webt/ii/9h/4d/ii9h4d6emu0hiquq3xs1hxab78i.jpeg"><br><br>  O slide a seguir mostra como o Coreflood funciona.  Essas s√£o dlls inseridas no Explorer e no Internet Explorer.  Eles modificam o registro, exigem uma reinicializa√ß√£o do aplicativo, mas n√£o requerem uma reinicializa√ß√£o do sistema.  Existem v√°rias maneiras de injetar essas DLLs em um processo. <br><br><img src="https://habrastorage.org/webt/ak/gk/hb/akgkhblgwmnu5tq_l2fcg7wrags.jpeg"><br><br>  Importante para os hackers que desejam invadir o v√≠rus despercebido √© como o v√≠rus entra no computador do usu√°rio: requer uma reinicializa√ß√£o do sistema para que o malware tenha efeito ou √© suficiente que o usu√°rio simplesmente reinicie o aplicativo, neste caso o Explorer. <br><br>  E agora est√° quieto para que ningu√©m possa ouvir! <br><br><img src="https://habrastorage.org/webt/yk/-q/97/yk-q97lw3wqjqp741oiik2yxudu.jpeg"><br><br>  Este √© o c√≥digo que reconstru√≠mos usando engenharia reversa.  Isso mostra como o Coreflood desliga manualmente o Explorer para que as altera√ß√µes entrem em vigor imediatamente.  Voc√™ provavelmente est√° familiarizado com o que acontece quando o Explorer falha no computador - a barra de tarefas desaparece, as janelas de todos os aplicativos abertos, todos os √≠cones na √°rea de trabalho desaparecem e, um a um, eles come√ßam a voltar ao seu lugar. <br><br>  Os autores do Coreflood obviamente sabiam disso, ent√£o fizeram uma chamada de sistema neste local para definir o modo de erro "correto" do condutor logo antes da chamada do OpenProcess. <br><br>  O que a fun√ß√£o SetErrorMode faz?  Evita uma falha espec√≠fica das notifica√ß√µes enviadas ao sistema que criam uma pequena janela pop-up e enviam uma mensagem de erro que levou ao encerramento do aplicativo.  Tudo o que fizeram com essa mensagem de erro foi impedir que uma janela pop-up aparecesse para o usu√°rio antes da falha do Explorer.  Diga-me o que parece mais suspeito para o usu√°rio: uma pequena janela pop-up acompanhada pelo desaparecimento de tudo o que aparece na tela e depois reaparece, ou o desaparecimento e a apar√™ncia de tudo sem nenhuma mensagem de erro?  Ouvi voc√™ dizer: "ambos os eventos". <br><br>  No pr√≥ximo slide, chamei "Com bra√ßos e pernas, mas sem cabe√ßa".  O Coreflood, quando carregado como uma DLL, n√£o aparece na lista de m√≥dulos carregados.  Ele aloca um pouco de mem√≥ria na pilha e se copia para esse local - eu coloco em uma moldura vermelha. <br><br><img src="https://habrastorage.org/webt/ns/zf/em/nszfemfch9kulz_ualmhjd-5cf4.jpeg"><br><br>  Em seguida, ele exclui o cabe√ßalho do PE. Portanto, se voc√™ encontrar um computador infectado com esse cavalo de Troia, diga: "minha pr√≥xima etapa deve despejar esse arquivo execut√°vel e envi√°-lo ao IDA para an√°lise", mas √© muito dif√≠cil despejar o arquivo execut√°vel se n√£o houver seu cabe√ßalho PE.  Portanto, quando o Coreflood chama aloca√ß√£o virtual, define o sinalizador mem de cima para baixo, o que faz com que o sistema retorne o endere√ßo mais alto, e n√£o o mais baixo dispon√≠vel.  Isso permite que o Trojan oculte as aspas de abertura / fechamento em uma √°rea de mem√≥ria mais alta do modo de usu√°rio entre outras DLLs do sistema.  Portanto, na pr√≥xima demonstra√ß√£o, chamei "Como tornar in√∫til tudo o que est√° oculto". <br><br><img src="https://habrastorage.org/webt/wz/h8/1u/wzh81uifnp2xp6vl-xak505logk.jpeg"><br><br>  Quando voc√™ se deparar com algo como o Coreflood, que usa furtividade, e n√£o h√° ferramentas prontas para trabalhar com esses v√≠rus, voc√™ deve criar o seu. <br>  Se voc√™ estiver familiarizado com a descompacta√ß√£o, √© comum usar um depurador.  Especialmente se n√£o houver desempacotador autom√°tico, pois esse n√£o √© um algoritmo comum.  Nesse caso, voc√™ pode usar o depurador para ir para o ponto de entrada original e remover o despejo do Trojan usando ProcDump ou outro utilit√°rio.       PE     Import Reconstructor,  ,          ,     . <br><br>      ,    .           .       Volatility,       Internet Explorer  .    ,   Coreflood,       ,    .  ,      7FF81000. <br><br><img src="https://habrastorage.org/webt/-d/zw/9b/-dzw9b_qihk8hpoouzgomi3hv2c.jpeg"><br><br>       ,    HEX    ,     Coreflood.    ,      ,          .               . <br><br> ,     ,  Coreflood,       Volatility  .     ,     ID  Internet Explorer.     ,   ,   PID  1732.     Malfind,      ,      ,         ,   .          VAD  ,  ,     .    ,    . <br><br><img src="https://habrastorage.org/webt/aq/mg/_m/aqmg_mfa2sy70g_y-pk77lw-hek.jpeg"><br><br>   ,      ,      7FF81000. ,          Fix IAT,     PID 1732 Internet Explorer      ,   Coreflood. <br><br>     dll,    Internet Explorer,             ,   RBA ,    ,   . <br><br>     ,       7FF81000,    ,        .  ,        PE .  ,        Import Reconstructor:   ,     ,   .     Fix IAT    ,        PE modify viewer   ,     . <br><br><img src="https://habrastorage.org/webt/yz/9w/no/yz9wno8uv0z5jpt5922gwrhvofw.jpeg"><br><br> 21:15 <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> DEFCON 17.    !</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 2</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/OeG4KBWB-EY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Obrigado por ficar conosco.  Voc√™ gosta dos nossos artigos?  Deseja ver materiais mais interessantes?  Ajude-nos fazendo um pedido ou recomendando a seus amigos, um <b>desconto de 30% para os usu√°rios da Habr em um an√°logo exclusivo de servidores b√°sicos que inventamos para voc√™:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Toda a verdade sobre o VPS (KVM) E5-2650 v4 (6 n√∫cleos) 10GB DDR4 240GB SSD 1Gbps de US $ 20 ou como dividir o servidor?</a>  (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). <br><br>  <b>VPS (KVM) E5-2650 v4 (6 n√∫cleos) 10GB DDR4 240GB SSD de 1Gbps at√© dezembro de gra√ßa</b> quando pagar por um per√≠odo de seis meses, voc√™ pode fazer o pedido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  <b>Dell R730xd 2 vezes mais barato?</b>  Somente n√≥s temos <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2 TVs Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 a partir de US $ 249</a> na Holanda e nos EUA!</b>  Leia sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como criar um pr√©dio de infraestrutura.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">classe usando servidores Dell R730xd E5-2650 v4 custando 9.000 euros por um centavo?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt428858/">https://habr.com/ru/post/pt428858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt428848/index.html">Notas do provedor de IoT: como criar uma rede LoRa em uma cidade sem rede em um dia?</a></li>
<li><a href="../pt428850/index.html">Gerenciamento de desenvolvimento em um grande projeto</a></li>
<li><a href="../pt428852/index.html">Transmiss√£o aberta do sal√£o principal HighLoad ++ 2018</a></li>
<li><a href="../pt428854/index.html">Como cortar a luz em um pequeno data center: uma maneira barata de implantar emerg√™ncias</a></li>
<li><a href="../pt428856/index.html">Um truque maravilhoso para tornar um mantenedor de projeto de c√≥digo aberto por dia</a></li>
<li><a href="../pt428860/index.html">Confer√™ncia DEFCON 17. Ria dos seus v√≠rus! Parte 2</a></li>
<li><a href="../pt428864/index.html">Vamos tornar a web √≥tima novamente</a></li>
<li><a href="../pt428866/index.html">7 princ√≠pios de design, atitude em rela√ß√£o √†s tend√™ncias de design, portf√≥lio de designers UX, ...</a></li>
<li><a href="../pt428868/index.html">JARs de v√°rias vers√µes - Ruim ou Bom?</a></li>
<li><a href="../pt428870/index.html">Mrr: FRP total para reagir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>