<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ถ ๐ ๐ UHCI ุ ุฃู ุฃูู USB ๐งโ๐คโ๐ง โท๏ธ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููู ุฌูุฏ ุนุฒูุฒู ุงููุงุฑุฆ! ุทููุจ ููู ุฃู ุฃูุชุจ ุนู UHCI - ุญุณููุง ุ ุฃูุง ุฃูุชุจ. 

 ูุฏ ุชุฌุฏ ูุฐู ุงูููุงูุฉ ูููุฏุฉ ุฅุฐุง ูู ุชูู ูุฏูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ููุงุฑุงุช ูุชุงุจุฉ ูุงููุฉ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>UHCI ุ ุฃู ุฃูู USB</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429422/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/89/wk/ye/89wkyeuwi_jbnzlge2bawtlabum.png"><br><br>  ููู ุฌูุฏ ุนุฒูุฒู ุงููุงุฑุฆ!  ุทููุจ ููู ุฃู ุฃูุชุจ ุนู UHCI - ุญุณููุง ุ ุฃูุง ุฃูุชุจ. <br><br>  ูุฏ ุชุฌุฏ ูุฐู ุงูููุงูุฉ ูููุฏุฉ ุฅุฐุง ูู ุชูู ูุฏูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ููุงุฑุงุช ูุชุงุจุฉ ูุงููุฉ ูุจุฑุงูุฌ ุงูุชุดุบูู ููุฑุงุกุฉ ูุซุงุฆู ุฃุญุฏ ุงูุฃุฌูุฒุฉ.  ูุซุงู ุจุณูุท: ุชุฑูุฏ ูุชุงุจุฉ ูุธุงู ุงูุชุดุบูู ุงูุฎุงุต ุจู ูุฌูุงุฒ ููุจููุชุฑ ุตุบูุฑ ุ ุจุญูุซ ูุง ุชููู ุจุนุถ ุฃูุธูุฉ ุชุดุบูู Windows ุฃู ุชูุฒูุนุงุช Linux ุงูุฃุฎุฑู ุจุชูุฒูู ุงูุญุฏูุฏ ุ ูุฃูุช ุชุณุชุฎุฏู ูู ุทุงูุชูุง ุญุตุฑููุง ูุฃุบุฑุงุถู ุงูุฎุงุตุฉ. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ูุง ูู UHCIุ </h2><br>  ุฃุนุชูุฏ ุฃูู ุ ุญุชู ูุง ุชุฑุด ูุฑุฉ ุฃุฎุฑู ุญูู ููุถูุน ูุงุฐุง ูููุงุฐุง ุ ููุท ุงุชุฑู ุฑุงุจุทูุง ูููุงูุชู ุงูุณุงุจูุฉ ุญูู EHCI.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฒุฉ ููุง</a> <br>  UHCI - ุชุนูู ูุงุฌูุฉ ูุญุฏุฉ ุชุญูู ุงููุถูู ุงูุนุงููู ูุฌูุงุฒ PCI ุ ูููู ุจุฎูุงู EHCI ุชุณุชุฎุฏู ุงูููุงูุฐ ุจุฏูุงู ูู MMIO (Memory-Mapped-IO). <br><br><img src="https://habrastorage.org/webt/nk/bl/--/nkbl--cqrxvs21lcitfothfcw4k.png"><br><br><h2 style=";text-align:right;direction:rtl">  ุงููุตุทูุญุงุช ุงููุงุฌุจ ุงุณุชุฎุฏุงููุง ูููุง ุจุนุฏ </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุฑูุงูุฌ ุชุดุบูู USB (USBD) - ุจุฑูุงูุฌ ุชุดุบูู USB ููุณู </li><li style=";text-align:right;direction:rtl">  HC (ูุญุฏุฉ ุชุญูู ุงููุถูู) - ูุญุฏุฉ ุชุญูู ูุถูู ุ ุฃู UHCI ููุท </li><li style=";text-align:right;direction:rtl">  ุจุฑูุงูุฌ ุชุดุบูู ูุญุฏุฉ ุชุญูู ุงููุถูู (HCD) - ุจุฑูุงูุฌ ูููู ุจุชูุตูู ุงูุฃุฌูุฒุฉ ู USBD </li><li style=";text-align:right;direction:rtl">  ุฌูุงุฒ USB - ุฌูุงุฒ USB ููุณู </li></ul><br><h2 style=";text-align:right;direction:rtl">  ุฃููุงุน ููู ุงูุจูุงูุงุช </h2><br>  ูุชุฒุงูู - ุงูุฅุฑุณุงู ุงููุชุฒุงูู ุ ุงูุฐู ูู ุชุฑุฏุฏ ูุนูู ูููู ุงูุจูุงูุงุช.  ูููู ุงุณุชุฎุฏุงูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ููููุฑููููุงุช USB ุ ุฅูุฎ. <br><br>  ุงูููุงุทุนุฉ - ุนูููุงุช ููู ุงูุจูุงูุงุช ุงูุตุบูุฑุฉ ูุงูุนูููุฉ ูู ุงูุฌูุงุฒ.  ูุฏุนู ููุน ุฅุฑุณุงู ุงูููุงุทุนุฉ ุงูุฃุฌูุฒุฉ ุงูุชู ุชุชุทูุจ ูุชุฑุฉ ุฎุฏูุฉ ูููู ุงูุชูุจุค ุจูุง ูููููุง ูุง ุชููุฑ ุจุงูุถุฑูุฑุฉ ุฏูู ุจูุงูุงุช ูููู ุงูุชูุจุค ุจู.  ูุดูุน ุงุณุชุฎุฏุงูู ููุฃุฌูุฒุฉ ูุซู ููุญุงุช ุงูููุงุชูุญ ูุฃุฌูุฒุฉ ุงูุชุฃุดูุฑ ุงูุชู ูุฏ ูุง ุชููุฑ ุจูุงูุงุช ููุชุฑุงุช ุฒูููุฉ ุทูููุฉ ุ ูููููุง ุชุชุทูุจ ุงุณุชุฌุงุจุฉ ุณุฑูุนุฉ ุนูุฏูุง ูููู ูุฏููู ุจูุงูุงุช ูุฅุฑุณุงููุง. <br><br>  ุงูุชุญูู - ููุน ุฅุฑุณุงู ุงููุนูููุงุช ุญูู ุญุงูุฉ ุงูุฌูุงุฒ ูุญุงูุชู ูุชููููู.  ูุชู ุงุณุชุฎุฏุงู ููุน ููู ุงูุชุญูู ูุชูููุฑ ููุงุฉ ุชุญูู ูู Host ุฅูู ุฃุฌูุฒุฉ USB.  ุชุชููู ุฅุฑุณุงูุงุช ุงูุชุญูู ุฏุงุฆููุง ูู ูุฑุญูุฉ ุงูุฅุนุฏุงุฏ ู ุตูุฑ ุฃู ุฃูุซุฑ ูู ูุฑุงุญู ุงูุจูุงูุงุช ูุชุจูุนุฉ ุจูุฑุญูุฉ ุงูุญุงูุฉ.  ูู ุงูุถุฑูุฑู ูุนุงูุฌุฉ ููู ุงูุชุญูู ุฅูู ููุทุฉ ููุงูุฉ ูุนููุฉ ูู ูุถุน FIFO.  ุฅุฐุง ุชู ุชูุฑูุฑ ุงูุชุญูู ุฅูู ููุณ ููุทุฉ ุงูููุงูุฉ ุ ููุฏ ูุคุฏู ุงูุชุดุฐูุฑ ุฅูู ุณููู ุบูุฑ ูุชููุน. <br><br>  ูุชูุฉ - ููุน ูู ููู ุตูุงุฆู ุงูุจูุงูุงุช.  ุชุณุชุฎุฏู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฃุฌูุฒุฉ MassStorage. <br><br><img src="https://habrastorage.org/webt/j1/d5/4a/j1d54aqfs0iicr_-dfpmkwx8d_e.png"><br><br>  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ูุจุฏู ุจูุง ุชูุฒูุน ุงูููุช ุจููุฏุงุฑ 1 ูููู ุซุงููุฉ - ูุนุงูุฌุฉ ุฅุทุงุฑ ูุงุญุฏ. <br><br><h2 style=";text-align:right;direction:rtl">  ุชูุฒูุน ุงูููุช </h2><br>  ุชุฏุนู ูุญุฏุฉ ุงูุชุญูู ุงููุถููุฉ ุชุณููู ุงูุจูุงูุงุช ูู ุงูููุช ุงููุนูู ุนู ุทุฑูู ุฅูุดุงุก ุญุฒูุฉ Start Of Frame (SOF) ูู 1 ูููู ุซุงููุฉ.  ูุชู ุฅูุดุงุก ุญุฒูุฉ SOF ุนูุฏ ุงูุชูุงุก ุตูุงุญูุฉ ุนุฏุงุฏ SOF ูู ูุญุฏุฉ ุชุญูู ุงููุถูู (ุงูุดูู 3).  ูููู ุฌูุงุฒ ุงูุชุญูู ุงููุถูู ุจุชููุฆุฉ ุนุฏุงุฏ SOF ููุฏุฉ ุฅุทุงุฑ 1 ูููู ุซุงููุฉ.  ูููู ุฅุฌุฑุงุก ุชุบููุฑุงุช ุจุณูุทุฉ ุนูู ูุฐู ุงููููุฉ (ูุจุงูุชุงูู ุงููุชุฑุฉ ุงูุฒูููุฉ ููุฅุทุงุฑ) ูู ุฎูุงู ุจุฑูุฌุฉ ุณุฌู ุชุบููุฑ SOF.  ุชุณูุญ ูู ูุฐู ุงูููุฒุฉ ุจุฅุฌุฑุงุก ุชุบููุฑุงุช ุทูููุฉ ุนูู ุงููุชุฑุฉ ุงูุฒูููุฉ ููุฅุทุงุฑ ุ ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ููุญูุงุธ ุนูู ุงูุชุฒุงูู ูู ุงูููุช ุงูุญูููู ุนุจุฑ ูุธุงู USB ุจุงููุงูู. <br><br>  ุชุชุถูู ูุญุฏุฉ ุงูุชุญูู ุงููุถููุฉ ุฑูู ุงูุฅุทุงุฑ ูู ูู ุญุฒูุฉ SOF.  ูุญุฏุฏ ุฑูู ุงูุฅุทุงุฑ ูุฐุง ุจุดูู ูุฑูุฏ ูุชุฑุฉ ุงูุฅุทุงุฑ ูู ุงูููุช ุงููุนูู.  ุชุญุฏุซ ููุงูุฉ ุญุงูุฉ ุงูุฅุทุงุฑ (EOF) ูู ููุงูุฉ ุงููุชุฑุฉ ุงูุฒูููุฉ ุงูุจุงูุบุฉ 1 ูููู ุซุงููุฉ ุนูุฏูุง ูุจุฏุฃ ุฌูุงุฒ ุงูุชุญูู ุงููุถูู ููุช ุงูุฅุทุงุฑ ุงูุชุงูู ุ ููุง ูุคุฏู ุฅูู ุฅูุดุงุก ุญุฒูุฉ SOF ุฃุฎุฑู ุจุฑูู ุงูุฅุทุงุฑ ุงูููุงุจู.  ุฎูุงู ูุชุฑุฉ ุงูุฅุทุงุฑ ุ ูุชู ุฅุฑุณุงู ุงูุจูุงูุงุช ูุญุฒู ูุนูููุงุช.  ูุชู ูุฑุถ ุงููุชุฑุฉ ุงูุฒูููุฉ ููุฅุทุงุฑ ุจุดูู ุตุงุฑู ุจูุงุณุทุฉ ูุญุฏุฉ ุชุญูู ุงููุถูู ุ ููุง ูููู ุฃู ุชุชุฌุงูุฒ ุญุฒู ุงูุจูุงูุงุช ูู ุงูุฅุทุงุฑ ุงูุญุงูู EOF (ุฑุงุฌุน ุงููุตู 11 ูู ููุงุตูุงุช USB).  ุชุฏุนู ูุญุฏุฉ ุงูุชุญูู ุงููุถููุฉ ูุฒุงููุฉ ุฅุฑุณุงู ุงูุจูุงูุงุช ุจูู ุงูุฅุทุงุฑุงุช ูู ุงูููุช ุงููุนูู ุ ูุฑุจุท ุฑูู ุงูุฅุทุงุฑ ูุฅุฌุฑุงุก ุฅุฏุฎุงู ูุญุฏุฏ ูู ูุงุฆูุฉ ุงูุฅุทุงุฑุงุช.  ูููู ุนุฏุงุฏ ุฅุทุงุฑ ูุญุฏุฉ ุชุญูู ุงููุถูู ุจุฅูุดุงุก ุฑูู ุฅุทุงุฑ (ูููุฉ 11 ุจุช) ูุฅุฏุฑุงุฌู ูู ูู ุญุฒูุฉ SOF.  ูุชู ุจุฑูุฌุฉ ุงูุนุฏุงุฏ ูู ุฎูุงู ุงูุณุฌูุงุช ููู ูุชุฑุฉ ุฅุทุงุฑ ุชุฒุฏุงุฏ.  ูุณุชุฎุฏู ุฌูุงุฒ ุงูุชุญูู ุงููุถูู 10 ุจุชุงุช ุฃูู ูู ุฑูู ุงูุฅุทุงุฑ ูููุฑุณ ูู ูุงุฆูุฉ ุงูุฅุทุงุฑุงุช ูุน 1024 ุฅุทุงุฑูุง ุ ูุงูุชู ูุชู ุชุฎุฒูููุง ูู ุฐุงูุฑุฉ ุงููุธุงู.  ูุจุงูุชุงูู ุ ูุธุฑูุง ูุฃู ุนุฏุงุฏ ุงูุฅุทุงุฑ ูุชุญูู ูู ุชุญุฏูุฏ ุฅุฏุฎุงู ูู ูุงุฆูุฉ ุงูุฅุทุงุฑุงุช ุ ูุฅู ูุญุฏุฉ ุชุญูู ุงููุถูู ุชููู ุจูุนุงูุฌุฉ ูู ุฅุฏุฎุงู ูู ุงููุงุฆูุฉ ูู ูุชุฑุฉ ุฅุทุงุฑ ูุนููุฉ.  ูุชู ุชูุณูุน ูุญุฏุฉ ุชุญูู ุงููุถูู ุฅูู ุงูุฅุฏุฎุงู ุงูุชุงูู ูู ูุงุฆูุฉ ุงูุฅุทุงุฑุงุช ููู ุฅุทุงุฑ ุฌุฏูุฏ.  ููุฐุง ูุถูู ุชูููุฐ ุนูููุงุช ุงูุฅุฑุณุงู ุงููุชุฒุงููุฉ ูู ุฅุทุงุฑ ูุนูู. <br><br>  ุงูุดูู 3: <br><br><img src="https://habrastorage.org/webt/d8/pj/iw/d8pjiwyjanx3yse7tmmtnyeooqe.png"><br><br><h2 style=";text-align:right;direction:rtl">  ูููู UHCI </h2><br>  ูู ุดูุก ุชูุงููุง ููุง ูู ุงูุญุงู ูุน EHCI.  ุทูุจุงุช ูุซุงู ูู HC: <br><br><img src="https://habrastorage.org/webt/io/1d/sm/io1dsmtielklqhm84nhekufybj4.png"><br><br><h2 style=";text-align:right;direction:rtl">  ุชูููู ูุงููุตูู ุฅูู UHCI </h2><br>  ูููุฐุง ุ ููุง ููุช ุณุงุจููุง ุ ุชุนูู UHCI ูู ุฎูุงู ุงูููุงูุฐ ุ ูุฐุง ูู PCI ูุญุชุงุฌ ุฅูู ูุนุฑูุฉ ูุงุนุฏุฉ ุชุณุฌููุงุช UHCI. <br><br><img src="https://habrastorage.org/webt/gz/ql/3f/gzql3fejuar2ko92q8dnok-ehpi.png"><br><br>  ุนูุฏ ุงูุฅุฒุงุญุฉ 0x20 ููุงู 4 ุจุงูุช - ูุงุนุฏุฉ IO.  ูููุง ูุชุนูู ุจูุงุนุฏุฉ ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ ุ ูููููุง ุงุณุชุฎุฏุงู ุงูุณุฌูุงุช ุงูุชุงููุฉ: <br><br><img src="https://habrastorage.org/webt/jk/a5/od/jka5odl_cbgmqxcdsix8e-1tkl0.png"><br><br><h2 style=";text-align:right;direction:rtl">  ุณุฌูุงุช UHCI </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  USBCMD ูู ุณุฌู ููุชุญูู ูู HC.  ุงูุจุชุงุช: <ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Bit 6 ูู ุนูุงูุฉ ุนูู ุฃูู ุชู ุชูููู ุงูุฌูุงุฒ ูุชููุฆุชู ุจูุฌุงุญ. </li><li style=";text-align:right;direction:rtl">  ุจุช 1 - ุฅุนุงุฏุฉ ุชุนููู HC.  ุชุนููู ูุฅุนุงุฏุฉ HC. </li><li style=";text-align:right;direction:rtl">  ุจุช 0 - ุชุดุบูู / ุฅููุงู.  ูุนุฑุถ ุญุงูุฉ HC.  1 - ูุนูู ุ 0 - ูุง. </li></ul></li><li style=";text-align:right;direction:rtl">  USBSTS - ุชุณุฌูู ุงูุญุงูุฉ.  ุงูุจุชุงุช: <ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุช 5 - ุชููู HC.  ุญุฏุซ ุฎุทุฃ ุ ุฃู ุฃูููุช ูุญุฏุฉ ุงูุชุญูู ุจูุฌุงุญ ุฅุนุงุฏุฉ ุชุนููู HC. </li><li style=";text-align:right;direction:rtl">  ุจุช 4 - ุฎุทุฃ ูู ุนูููุฉ ุชุญูู ุงููุถูู.  ูุชู ุชุนููู ุงูุจุช ุฅูู 1 ุนูุฏ ุญุฏูุซ ุฎุทุฃ ูุงุฏุญ ููุง ูููู HC ูุชุงุจุนุฉ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ู TD. </li><li style=";text-align:right;direction:rtl">  ุจุช 3 - ุฎุทุฃ ูู ุงููุธุงู ุงููุถูู.  ุฎุทุฃ PCI. </li><li style=";text-align:right;direction:rtl">  ุจุช 1 - ููุงุทุนุฉ ุงูุฎุทุฃ.  ูุดูุฑ ุฅูู ุญุฏูุซ ุฎุทุฃ ูุชููุฏ HC ููุงุทุนุฉ. </li><li style=";text-align:right;direction:rtl">  ุจุช 0 - ุงูููุงุทุนุฉ.  ูุดูุฑ ุฅูู ุฃู HC ุฃุฏู ุฅูู ููุงุทุนุฉ. </li></ul></li><li style=";text-align:right;direction:rtl">  USBINTR - ุชุณุฌูู ุฅุนุฏุงุฏุงุช ุงูููุงุทุนุฉ.  ุงูุจุชุงุช: <ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุช 2 - IOC - ุงูููุงุทุนุฉ ุนูุฏ ุงูุชูุงููุง - ุชูุดุฆ ููุงุทุนุฉ ูู ููุงูุฉ ุงููุนุงููุฉ. </li></ul></li><li style=";text-align:right;direction:rtl">  FRNUM - ุฑูู ุงูุฅุทุงุฑ ุงูุญุงูู (ุฎุฐ &amp; 0x3FF ูููููุฉ ุงูุตุญูุญุฉ). </li><li style=";text-align:right;direction:rtl">  FLBASEADD - ุงูุนููุงู ุงูุฃุณุงุณู ููุงุฆูุฉ ุงูุฅุทุงุฑุงุช - ุนููุงู ูุงุฆูุฉ ุงูุฅุทุงุฑุงุช. </li><li style=";text-align:right;direction:rtl">  PORTSC - ุญุงูุฉ ุงููููุงุก ูุงูุชุญูู ููู - ุณุฌู ุงูุญุงูุฉ ููุฑุงูุจุฉ ุงููููุฐ.  ุงูุจุชุงุช: <ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุช 9 - ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐ - 1 - ูููุฐ ูุฅุนุงุฏุฉ ุงูุชุนููู. </li><li style=";text-align:right;direction:rtl">  ุจุช 8 - ูุดูุฑ ุฅูู ุฃู ุฌูุงุฒ ููุฎูุถ ุงูุณุฑุนุฉ ูุชุตู ุจุงููููุฐ </li><li style=";text-align:right;direction:rtl">  ุจุช 3 - ูุดูุฑ ุฅูู ุฃู ุงููููุฐ ูู ุญุงูุฉ ุชุบูุฑ </li><li style=";text-align:right;direction:rtl">  Bit 2 - ูุดูุฑ ุฅูู ูุง ุฅุฐุง ูุงู ุงููููุฐ ููููููุง </li><li style=";text-align:right;direction:rtl">  Bit 1 - ูุดูุฑ ุฅูู ุฃู ุญุงูุฉ ุงูุฌูุงุฒ ูุชุตูุฉ ุจุงููููุฐ </li><li style=";text-align:right;direction:rtl">  ุจุช 0 - ูุดูุฑ ุฅูู ุฃู ุงูุฌูุงุฒ ูุชุตู ุจุงููููุฐ. </li></ul></li></ul><br><h2 style=";text-align:right;direction:rtl">  ุงูููุงูู </h2><br><h3 style=";text-align:right;direction:rtl">  ูุคุดุฑ ูุงุฆูุฉ ุงูุฅุทุงุฑุงุช </h3><br><img src="https://habrastorage.org/webt/oc/y8/a6/ocy8a6is-xd60i9bxmtdjjyqcdy.png"><br><br><h3 style=";text-align:right;direction:rtl">  ููู ูุงุตู </h3><br><img src="https://habrastorage.org/webt/jz/sh/bl/jzshblpig4inzxxtzkzxlmvsvq8.png"><br><br><h5 style=";text-align:right;direction:rtl">  TD ุงูุชุญูู ูุญุงูุฉ </h5>  .  ุงูุจุชุงุช: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุช 28-27 - ุนุฏุงุฏ ุงูุฎุทุฃ ุ ุนูู ุบุฑุงุฑ EHCI. </li><li style=";text-align:right;direction:rtl"><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุช 26-1 = ุฌูุงุฒ ููุฎูุถ ุงูุณุฑุนุฉ ุ 0 = ุฌูุงุฒ ูุงูู ุงูุณุฑุนุฉ. </li><li style=";text-align:right;direction:rtl">  ุจุช 25-1 = TD ูุชุฒุงูู </li><li style=";text-align:right;direction:rtl">  ุจุช 24 - ุงููุฌูุฉ ุงูุฃูููุจูุฉ ุงูุฏูููุฉ </li><li style=";text-align:right;direction:rtl">  ุจุช 23-16 - ุงูุญุงูุฉ: </li><li style=";text-align:right;direction:rtl">  ุจุช 23 - ูุดูุฑ ุฅูู ุฃูู TD ูุดุท </li><li style=";text-align:right;direction:rtl">  ุจุช 22 - ูุชููู </li><li style=";text-align:right;direction:rtl">  ุจุช 21 - ุฎุทุฃ ูุฎุฒู ุงูุจูุงูุงุช </li><li style=";text-align:right;direction:rtl">  ุจุช 20 - ุชู ุงูุชุดุงู ุจุงุจู </li><li style=";text-align:right;direction:rtl">  ุจุช 19 - NAK </li></ul></li><li style=";text-align:right;direction:rtl">  ุงูุจุชุงุช 10โ0: ุนุฏุฏ ูุญุฏุงุช ุงูุจุงูุช ุงููุฑุณูุฉ ุจูุงุณุทุฉ ูุญุฏุฉ ุชุญูู ุงููุถูู. </li></ul><br><h5 style=";text-align:right;direction:rtl">  ุฑูุฒ TD </h5><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุช 31:21 - ูุงูุณ ุจุงููุช ููู ุ ุนูู ุบุฑุงุฑ EHCI </li><li style=";text-align:right;direction:rtl">  ุจุช 19 - ุชุจุฏูู ุงูุจูุงูุงุช ุ ุนูู ุบุฑุงุฑ EHCI </li><li style=";text-align:right;direction:rtl">  ุจุช 18:15 - ุฑูู ููุทุฉ ุงูููุงูุฉ </li><li style=";text-align:right;direction:rtl">  ุจุช 18:14 - ุนููุงู ุงูุฌูุงุฒ </li><li style=";text-align:right;direction:rtl">  ุจุช 7: 0 - PID.  In = 0x69 ุ Out = 0xE1 ุ ุงูุฅุนุฏุงุฏ = 0x2D </li></ul><br><h3 style=";text-align:right;direction:rtl">  ุฑุฃุณ ุงูุทุงุจูุฑ </h3><br><img src="https://habrastorage.org/webt/-4/pb/ia/-4pbiakp01iozcmkne4q1tums4i.png"><br><br><h2 style=";text-align:right;direction:rtl">  ููุฏ </h2><br>  ุชููุฆุฉ ูุชูููู HC: <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs">PciBar bar; PciGetBar(&amp;bar, id, <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (~bar.flags &amp; PCI_BAR_IO) { <span class="hljs-comment"><span class="hljs-comment">// Only Port I/O supported return; } unsigned int ioAddr = bar.u.port; UhciController *hc = VMAlloc(sizeof(UhciController)); hc-&gt;ioAddr = ioAddr; hc-&gt;frameList = VMAlloc(1024 * sizeof(u32) + 8292); hc-&gt;frameList = ((int)hc-&gt;frameList / 4096) * 4096 + 4096; hc-&gt;qhPool = (UhciQH *)VMAlloc(sizeof(UhciQH) * MAX_QH + 8292); hc-&gt;qhPool = ((int)hc-&gt;qhPool / 4096) * 4096 + 4096; hc-&gt;tdPool = (UhciTD *)VMAlloc(sizeof(UhciTD) * MAX_TD + 8292); hc-&gt;tdPool = ((int)hc-&gt;tdPool / 4096) * 4096 + 4096; memset(hc-&gt;qhPool, 0, sizeof(UhciQH) * MAX_QH); memset(hc-&gt;tdPool, 0, sizeof(UhciTD) * MAX_TD); memset(hc-&gt;frameList, 0, 4 * 1024); // Frame list setup UhciQH *qh = UhciAllocQH(hc); qh-&gt;head = TD_PTR_TERMINATE; qh-&gt;element = TD_PTR_TERMINATE; qh-&gt;transfer = 0; qh-&gt;qhLink.prev = &amp;qh-&gt;qhLink; qh-&gt;qhLink.next = &amp;qh-&gt;qhLink; hc-&gt;asyncQH = qh; for (uint i = 0; i &lt; 1024; ++i) hc-&gt;frameList[i] = 2 | (u32)(uintptr_t)qh; IoWrite16(hc-&gt;ioAddr + REG_INTR, 0); IoWrite16(hc-&gt;ioAddr + REG_CMD, IoRead16(hc-&gt;ioAddr + REG_CMD)&amp;(~1)); unsigned short cfg = PciRead16(id, 4); PciWrite16(id, 4, cfg &amp; (~1)); PciWrite16(id, 0x20, (short)-1); unsigned short size = ~(PciRead16(id, 0x20)&amp;(~3)) + 1; PciWrite16(id, 0x20, hc-&gt;ioAddr); PciWrite16(id, 4, cfg | 5); // Disable Legacy Support IoWrite16(hc-&gt;ioAddr + REG_LEGSUP, 0x8f00); // Disable interrupts IoWrite16(hc-&gt;ioAddr + REG_INTR, 0); // Assign frame list IoWrite16(hc-&gt;ioAddr + REG_FRNUM, 0); IoWrite32(hc-&gt;ioAddr + REG_FRBASEADD, (int)hc-&gt;frameList); IoWrite16(hc-&gt;ioAddr + REG_SOFMOD, 0x40); // Clear status IoWrite16(hc-&gt;ioAddr + REG_STS, 0xffff); // Enable controller IoWrite16(hc-&gt;ioAddr + REG_CMD, 0x1); // Probe devices UhciProbe(hc, size);</span></span></code> </pre> <br>  ุทูุจุงุช ููุทุฉ ุงูููุงูุฉ ูุงูุชุญูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ------------------------------------------------------------------------------------------------ static void UhciDevControl(UsbDevice *dev, UsbTransfer *t) { UhciController *hc = (UhciController *)dev-&gt;hc; UsbDevReq *req = t-&gt;req; // Determine transfer properties uint speed = dev-&gt;speed; uint addr = dev-&gt;addr; uint endp = 0; uint maxSize = dev-&gt;maxPacketSize; uint type = req-&gt;type; uint len = req-&gt;len; // Create queue of transfer descriptors UhciTD *td = UhciAllocTD(hc); if (!td) { return; } UhciTD *head = td; UhciTD *prev = 0; // Setup packet uint toggle = 0; uint packetType = TD_PACKET_SETUP; uint packetSize = sizeof(UsbDevReq); UhciInitTD(td, prev, speed, addr, endp, toggle, packetType, packetSize, req); prev = td; // Data in/out packets packetType = type &amp; RT_DEV_TO_HOST ? TD_PACKET_IN : TD_PACKET_OUT; u8 *it = (u8 *)t-&gt;data; u8 *end = it + len; while (it &lt; end) { td = UhciAllocTD(hc); if (!td) { return; } toggle ^= 1; packetSize = end - it; if (packetSize &gt; maxSize) { packetSize = maxSize; } UhciInitTD(td, prev, speed, addr, endp, toggle, packetType, packetSize, it); it += packetSize; prev = td; } // Status packet td = UhciAllocTD(hc); if (!td) { return; } toggle = 1; packetType = type &amp; RT_DEV_TO_HOST ? TD_PACKET_OUT : TD_PACKET_IN; UhciInitTD(td, prev, speed, addr, endp, toggle, packetType, 0, 0); // Initialize queue head UhciQH *qh = UhciAllocQH(hc); UhciInitQH(qh, t, head); // Wait until queue has been processed UhciInsertQH(hc, qh); UhciWaitForQH(hc, qh); } // ------------------------------------------------------------------------------------------------ static void UhciDevIntr(UsbDevice *dev, UsbTransfer *t) { UhciController *hc = (UhciController *)dev-&gt;hc; // Determine transfer properties uint speed = dev-&gt;speed; uint addr = dev-&gt;addr; uint endp = t-&gt;endp-&gt;desc-&gt;addr &amp; 0xf; // Create queue of transfer descriptors UhciTD *td = UhciAllocTD(hc); if (!td) { t-&gt;success = false; t-&gt;complete = true; return; } UhciTD *head = td; UhciTD *prev = 0; // Data in/out packets uint toggle = t-&gt;endp-&gt;toggle; uint packetType = TD_PACKET_IN; //Here for compiler, on some last expression hadn't worked if (t-&gt;endp-&gt;desc-&gt;addr &amp; 0x80) packetType = TD_PACKET_IN; else packetType = TD_PACKET_OUT; uint packetSize = t-&gt;len; UhciInitTD(td, prev, speed, addr, endp, toggle, packetType, packetSize, t-&gt;data); // Initialize queue head UhciQH *qh = UhciAllocQH(hc); UhciInitQH(qh, t, head); // Schedule queue UhciInsertQH(hc, qh); if(t-&gt;w) UhciWaitForQH(hc, qh); }</span></span></code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar429422/">https://habr.com/ru/post/ar429422/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../486156/index.html">Como enseรฑรฉ, y luego escribรญ un manual de entrenamiento en Python</a></li>
<li><a href="../486158/index.html">Visualizaciรณn de traducciรณn automรกtica neural (modelos seq2seq con mecanismo de atenciรณn)</a></li>
<li><a href="../486164/index.html">Coronavirus 2019-nCoV. Preguntas frecuentes sobre protecciรณn respiratoria y desinfecciรณn</a></li>
<li><a href="../486174/index.html">Tengo cero rotaciรณn</a></li>
<li><a href="../ar429420/index.html">ูุณุชุฎุฏู PlayStation Classic ูุญุงูู PCSX ReARMed ููุชุดุบูู ุ ุจุฏูู ุญููู ุฎุงุตุฉ</a></li>
<li><a href="../ar429424/index.html">ุณูุธูุฑ Robotaxi ูู Daimler ู Bosch ูู ูุงููููุฑููุง</a></li>
<li><a href="../ar429426/index.html">QGIS ูุชุตุฏูุฑ ุงูุจูุงุท</a></li>
<li><a href="../ar429448/index.html">ููุชุจ ูุญูู FPGA ูู LabVIEW. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar429450/index.html">ุชูููุงุช ุงูุจุฑูุฌุฉ ุงููุนููุฉ ูู Rust: ููู ุชุฑุฌููุง Exonum ูู Iron ุฅูู actix-web</a></li>
<li><a href="../ar429452/index.html">ุจุฏุฃ ุงูุจูุชุงุบูู ูู ุฑูุน ุงูุณุฑูุฉ ุนู ุงูุจุฑุงูุฌ ุงูุถุงุฑุฉ ูุฃุดุฎุงุต ุขุฎุฑูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>