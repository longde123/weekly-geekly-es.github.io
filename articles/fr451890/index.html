<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìµ ‚¨õÔ∏è ü•¢ D√©l√©gation d'une zone de sous-r√©seau inverse inf√©rieure √† / 24 dans BIND. Comment √ßa marche üçä üíÖüèº üëèüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une fois, j'ai √©t√© confront√© √† la t√¢che de donner √† l'un des clients le droit de modifier les enregistrements PTR du sous-r√©seau qui lui √©tait attribu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©l√©gation d'une zone de sous-r√©seau inverse inf√©rieure √† / 24 dans BIND. Comment √ßa marche</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451890/">  Une fois, j'ai √©t√© confront√© √† la t√¢che de donner √† l'un des clients le droit de modifier les enregistrements PTR du sous-r√©seau qui lui √©tait attribu√© / 28.  Je n'ai pas d'automatisation pour √©diter les param√®tres BIND de l'ext√©rieur.  J'ai donc d√©cid√© d'aller dans l'autre sens - de d√©l√©guer au client un morceau de la zone de sous-r√©seau PTR / 24. <br><br>  Il semblerait - quoi de plus simple?  Nous prescrivons simplement le sous-r√©seau de la bonne mani√®re et le dirigeons vers le NS souhait√© comme cela se fait avec le sous-domaine.  Mais non.  Ce n'est pas si simple (bien qu'en r√©alit√© c'est g√©n√©ralement primitif, mais l'intuition n'aidera pas), c'est pourquoi j'√©cris cet article. <br><br>  Qui veut le d√©couvrir lui-m√™me peut lire le <a href="">RFC</a> <br>  Qui veut une solution toute faite, bienvenue chez cat. <br><a name="habracut"></a><br>  Afin de ne pas retarder ceux qui aiment la m√©thode du copier-coller, je posterai d'abord la partie pratique, puis la partie th√©orique. <br><br>  <b>1. Pratique.</b>  <b>Zone de d√©l√©gation / 28</b> <br><br>  Disons que nous avons un sous-r√©seau de <b>7.8.9.0/24</b> .  Nous devons d√©l√©guer le sous-r√©seau <b>7.8.9.240/28</b> au client DNS <b>7.8.7.8</b> ( <b>ns1.client.domain</b> ). <br><br>  Sur le DNS du fournisseur, vous devez trouver un fichier qui d√©crit la zone inverse de ce sous-r√©seau.  Que ce soit <b>9.8.7.in-addr.arpa</b> . <br>  Les messages de 240 √† 255 sont comment√©s, le cas √©ch√©ant.  Et √† la fin du fichier, √©crivez ce qui suit: <br><br><pre><code class="plaintext hljs">255-240 IN NS 7.8.7.8 $GENERATE 240-255 $ CNAME $.255-240</code> </pre> <br>  n'oubliez pas d'augmenter les zones s√©rie et de faire <br><br><pre> <code class="plaintext hljs">rndc reload</code> </pre> <br>  Sur ce point, la partie fournisseur est termin√©e.  Nous passons au client DNS. <br><br>  Cr√©ez d' <b>abord le</b> fichier <b>/etc/bind/master/255-240.9.8.7.in-addr.arpa avec le</b> contenu suivant: <br><br><pre> <code class="plaintext hljs">$ORIGIN 255-240.9.8.7.in-addr.arpa. $TTL 1W @ 1D IN SOA ns1.client.domain. root.client.domain. ( 2008152607 ; serial 3H ; refresh 15M ; retry 1W ; expiry 1D ) ; minimum @ IN NS ns1.client.domain. @ IN NS ns2.client.domain. 241 IN PTR test.client.domain. 242 IN PTR test2.client.domain. 245 IN PTR test5.client.domain.</code> </pre><br>  Et dans <b>named.conf,</b> ajoutez la description de notre nouveau fichier: <br><br><pre> <code class="plaintext hljs">zone "255-240.9.8.7.in-addr.arpa." IN { type master; file "master/255-240.9.8.7.in-addr.arpa"; };</code> </pre> <br>  B red√©marrez le processus de liaison. <br><br><pre> <code class="plaintext hljs">/etc/init.d/named restart</code> </pre> <br>  C‚Äôest tout.  Vous pouvez maintenant v√©rifier. <br><br><pre> <code class="plaintext hljs">#&gt; host 7.8.9.245 245.9.8.7.in-addr.arpa is an alias for 245.255-240.9.8.7.in-addr.arpa. 245.255-240.9.8.7.in-addr.arpa domain name pointer test5.client.domain.</code> </pre> <br>  Veuillez noter que non seulement l'enregistrement PTR est fourni, mais √©galement CNAME.  Il devrait en √™tre ainsi.  Si vous vous demandez pourquoi, bienvenue dans le chapitre suivant. <br><br>  <b>2. Th√©orie.</b>  <b>Comment √ßa marche?</b> <br><br>  Il est difficile de configurer et de d√©boguer une bo√Æte noire.  Beaucoup plus facile si vous comprenez ce qui se passe √† l'int√©rieur. <br><br>  Lorsque nous d√©l√©guons un sous-domaine dans le <b>domaine</b> , nous √©crivons quelque chose comme ceci: <br><br><pre> <code class="plaintext hljs">client.domain. NS ns1.client.domain. ns1.client.domain. A 7.8.7.8</code> </pre> <br>  Nous disons √† tout le monde que nous ne sommes pas responsables de ce site et nous disons qui est responsable.  Et toutes les demandes vers <b>client.domain sont</b> redirig√©es vers 7.8.7.8.  Lors de la v√©rification, nous voyons l'image suivante (omettez ce que le client a l√†. Cela n'a pas d'importance): <br><br><pre> <code class="plaintext hljs"># host test.client.domain test.client.domain has address 7.8.9.241</code> </pre> <br>  C'est-√†-dire  nous avons √©t√© inform√©s qu'il existe un tel enregistrement A et son ip 7.8.9.241.  Aucune information inutile. <br><br>  <b>Mais comment faire la m√™me chose avec un sous-r√©seau?</b> <br><br>  Parce que  √âtant donn√© que notre serveur DNS est enregistr√© dans RIPE, lors de la demande d'une adresse IP PTR √† partir de notre r√©seau, la premi√®re demande nous sera toujours envoy√©e.  La logique est la m√™me que pour les domaines.  Mais comment entrer le sous-r√©seau dans le fichier de zone? <br><br>  Nous essayons de le saisir comme ceci: <br><br><pre> <code class="plaintext hljs">255-240 IN NS 7.8.7.8</code> </pre> <br>  Et ... un miracle ne s'est pas produit.  Nous ne recevons aucune redirection de demande.  Le fait est que bind n'est pas du tout conscient que ces entr√©es dans le fichier de zone inverse sont des adresses IP et plus encore, elles ne comprennent pas l'entr√©e de plage.  Pour lui, ce n'est qu'un sous-domaine symbolique.  C'est-√†-dire  pour bind, il n'y aura pas de diff√©rence entre " <b>255-240</b> " et " <b>oursuperclient</b> ".  Et la demande pour que la demande aille l√† o√π elle devrait √™tre, l'adresse dans la demande devrait ressembler √† ceci: <b>241.255-240.9.8.7.in-addr.arpa</b> .  Ou comme ceci si nous utilisons un sous-domaine de caract√®res: <b>241.oursuperclient.9.8.7.in-addr.arpa</b> .  C'est diff√©rent de l'habituel: <b>241.9.8.7.in-addr.arpa</b> . <br><br>  Mains une telle demande sera probl√©matique.  Et si cela fonctionne, on ne sait toujours pas comment l'appliquer dans la vie r√©elle.  Apr√®s tout, √† la demande du <b>7.8.9.241</b> , le fournisseur DNS, et non le client, nous r√©pond toujours. <br><br>  Et ici <b>CNAME</b> entre en jeu. <br><br>  Du c√¥t√© du fournisseur, vous devez cr√©er un alias pour toutes les adresses IP du sous-r√©seau dans un format qui transmettra la demande au DNS client. <br><br><pre> <code class="plaintext hljs">255-240 IN NS ns1.client.domain. 241 IN CNAME 241.255-240 242 IN CNAME 242.255-240  ..</code> </pre><br>  C'est pour travailler dur =). <br><br>  Et pour les paresseux, le design ci-dessous est plus adapt√©: <br><br><pre> <code class="plaintext hljs">255-240 IN NS ns1.client.domain. $GENERATE 240-255 $ CNAME $.255-240</code> </pre> <br>  √Ä pr√©sent, une demande d'informations au <b>7.8.9.241</b> de <b>241.9.8.7.in-addr.arpa</b> sur le serveur DNS du fournisseur sera convertie en <b>241.255-240.9.8.7.in-addr.arpa</b> et ira au client DNS. <br><br>  Le client devra traiter ces demandes.  En cons√©quence, nous cr√©ons une zone de <b>255-240.9.8.7.in-addr.arpa</b> .  Dans ce document, nous pouvons essentiellement publier des enregistrements invers√©s pour n'importe quelle adresse IP de l'ensemble du sous-r√©seau / 24, mais nous ne serons interrog√©s que sur ceux que le fournisseur nous redirigera, de sorte que vous ne pourrez pas jouer avec =). <br>  Pour illustrer, je vais donner un exemple du contenu du fichier de zone inverse c√¥t√© client: <br><br><pre> <code class="plaintext hljs">$ORIGIN 255-240.9.8.7.in-addr.arpa. $TTL 1W @ 1D IN SOA ns1.client.domain. root.client.domain. ( 2008152607 ; serial 3H ; refresh 15M ; retry 1W ; expiry 1D ) ; minimum @ IN NS ns1.client.domain. @ IN NS ns2.client.domain. 241 IN PTR test.client.domain. 242 IN PTR test2.client.domain. 245 IN PTR test5.client.domain.</code> </pre><br>  Ici, du fait que nous utilisons CNAME de la part du fournisseur, nous recevons deux enregistrements en r√©ponse √† une demande de donn√©es par adresse IP, et non un. <br><br><pre> <code class="plaintext hljs">#&gt; host 7.8.9.245 245.9.8.7.in-addr.arpa is an alias for 245.255-240.9.8.7.in-addr.arpa. 245.255-240.9.8.7.in-addr.arpa domain name pointer test5.client.domain.</code> </pre> <br>  <i><b>Et n'oubliez pas de configurer correctement l'ACL.</b></i>  <i><b>Parce que cela n'a aucun sens de prendre une zone PTR pour vous-m√™me et de ne r√©pondre √† personne de l'ext√©rieur =).</b></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr451890/">https://habr.com/ru/post/fr451890/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr451876/index.html">Centre de donn√©es de Francfort: Centre de donn√©es Telehouse</a></li>
<li><a href="../fr451878/index.html">Diffusion en direct de vid√©o st√©r√©o sur des lunettes VR (Oculus Go)</a></li>
<li><a href="../fr451880/index.html">DevPRO'19: vue depuis le stand Wrike</a></li>
<li><a href="../fr451884/index.html">Sept ans de travail en tant que d√©veloppeur: quelles le√ßons ai-je tir√©es</a></li>
<li><a href="../fr451886/index.html">Utilisation de math√©matiques discr√®tes dans les tests</a></li>
<li><a href="../fr451894/index.html">Un aper√ßu bref et dynamique de l'architecture du compilateur</a></li>
<li><a href="../fr451896/index.html">Un eyeDisk ¬´incassable¬ª est prot√©g√© par un balayage d'iris, mais transmet un mot de passe en texte clair</a></li>
<li><a href="../fr451898/index.html">Innovation en russe</a></li>
<li><a href="../fr451900/index.html">Premi√®re contribution √† l'API du navigateur de Facebook</a></li>
<li><a href="../fr451902/index.html">Camp de d√©veloppeurs Microsoft Azure Russie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>