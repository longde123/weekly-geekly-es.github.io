<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😒 📡 👂🏾 Entwicklung von Modulen für Puppen mit Puppenentwicklungskit 👇🏼 🕵🏼 👩🏾‍🤝‍👨🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor ungefähr einem Monat hatte ich die Wahl: ob ich das Modul für Puppet "auf den Tisch" (dh für die interne Infrastruktur) schreiben oder universell ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entwicklung von Modulen für Puppen mit Puppenentwicklungskit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435954/"><p>  Vor ungefähr einem Monat hatte ich die Wahl: ob ich das Modul für Puppet "auf den Tisch" (dh für die interne Infrastruktur) schreiben oder universell machen, die Quelle öffnen und auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Puppet Forge</a> veröffentlichen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">möchte</a> .  Natürlich wäre es schneller und einfacher, schnell 2-3 Noten für sich selbst zu skizzieren und sich zu beruhigen, aber die Erfahrungen, die bei der Veröffentlichung des Moduls gesammelt wurden, sind wertvoll und ich möchte sie teilen.  In RuNet gibt es keine Informationen zur Verwendung des Puppenentwicklungskits (im Folgenden: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PDK</a> ). Sie können dies also als eine Art Tutorial betrachten. </p><br><h2 id="o-chyom-statya">  Worum geht es in dem Artikel? </h2><br><p>  Bei der Entwicklung eines Moduls (oder besser gesagt zweier) habe ich PDK entdeckt, das sowohl die Entwicklung als auch die Wartung von Modulen erheblich erleichtert.  Nämlich: </p><br><ul><li> Formatieren Sie <code>metadata.json</code> beim letzten Update automatisch </li><li>  Konfigurationsgenerierung für verschiedene CI-Systeme, die Folgendes tun können: <br><ul><li>  Rubincode mit Rubocop Linter prüfen </li><li>  Unit-Tests ausführen </li><li>  Unter bestimmten Bedingungen - automatisches Ausfüllen des Arbeitscodes für Puppenschmieden </li></ul></li><li>  Generieren von tagbasierter Dokumentation in Kommentaren mithilfe von Yard </li><li>  Platte <code>[PDK]</code> für das Modul auf Puppenschmiede.  Eine Kleinigkeit, aber schön! </li></ul><br><p>  Alle interessiert <a name="habracut"></a>  Ich bitte um eine Katze! </p><br><h4 id="v-kachestve-primerov">  Als Beispiele </h4><br><p>  Wenn Sie sehen und fühlen möchten, was während des Lesevorgangs gemeint ist, können Sie eines der beiden (oder beide) genannten Module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">öffnen</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">clickhouse</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">xmlsimple</a> .  Beide wurden mit dem PDK und anderen im Artikel beschriebenen Tools entwickelt. </p><br><h2 id="soderzhanie">  Inhalt </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Worum geht es in dem Artikel?</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Als Beispiele</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Was ist PDK?</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Installation</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PDK-Inhalt</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erstellen Sie ein Modul</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">neue Klasse</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">neuer definierter_Typ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">neuer Anbieter &amp; Aufgabe</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation mit Marionettenschnüren erstellen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vorlagenanpassung</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verschiedene CI ausführen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bonus: Wir schreiben Unit-Tests für Klassen, Typen und Funktionen</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anstelle von Ausgabe</a> </li></ul><br><h1 id="chto-zhe-takoe-pdk">  Was ist PDK? </h1><br><p>  Aus der offiziellen Dokumentation: </p><br><blockquote>  Erstellen Sie ein vollständiges Modul mit Klassen, definierten Typen und Aufgaben und testen und validieren Sie Ihre Arbeit unterwegs.  PDK bietet eine vollständige Modulstruktur, Vorlagen für Klassen, definierte Typen und Aufgaben sowie eine Testinfrastruktur.  Sie können Ihr Modul anhand verschiedener Betriebssysteme und mehrerer Puppet-Versionen validieren und testen. </blockquote><p>  In meiner kostenlosen Übersetzung: </p><br><blockquote>  Ermöglicht das Erstellen eines vollständigen Moduls mit Klassen, Typen, Aufgaben und Tests, um den Betrieb des Moduls zu überprüfen.  PDK bietet eine vollständige Struktur und Vorlagen für alle oben genannten.  Mit diesem Tool können Sie die Funktion des Moduls mit verschiedenen Versionen von Puppet sowie in verschiedenen Betriebssystemen überprüfen. </blockquote><p>  Hört sich gut an?  So ist es wirklich.  Bis zu dem Zeitpunkt, als ich mit der Arbeit an dem Modul begann, das sofort für Open Source geschrieben werden sollte, ahnte ich dieses Tool nicht und beabsichtige nun, die gesamte interne Infrastruktur für die Verwendung des PDK zu übertragen. </p><br><p>  Ich werde beschreiben, wie es zu setzen ist und welche Werkzeuge und Befehle es enthält. </p><br><h2 id="ustanovka">  Installation </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die offizielle Installationsseite</a> .  Über diesen Link finden Sie fast garantiert den richtigen Weg, um PDK auf Ihrem Host zu installieren.  Wenn Sie aus irgendeinem Grund kein Glück haben und Ihr Betriebssystem nicht vorhanden ist, gibt es immer einen Kreisverkehr in der Form: </p><br><pre> <code class="bash hljs">gem install pdk</code> </pre> <br><p>  In der Tat ist PDK nur ein Juwel, und es ist so eingestellt. </p><br><h2 id="soderzhimoe-pdk">  PDK-Inhalt </h2><br><p>  Im Allgemeinen ist PDK nichts anderes als eine Reihe von Edelsteinen, um die Modulentwicklung zu erleichtern.  Es enthält die folgenden Tools: </p><br><table><thead><tr><th>  Dienstprogramm </th><th>  Beschreibung </th></tr></thead><tbody><tr><td>  metadata-json-lint </td><td>  Überprüft metadata.json auf passende Puppenstil-Anleitungen </td></tr><tr><td>  pdk </td><td>  Ein Tool zum Generieren und Testen von Modulen und deren Inhalten (Klassen, Typen usw.) über die Befehlszeile </td></tr><tr><td>  Marionettenfussel </td><td>  Überprüft den Puppencode auf Puppet Language Style Guides </td></tr><tr><td>  Puppensyntax </td><td>  Überprüfen Sie die Syntax des Manifests </td></tr><tr><td>  Puppetlabs_spec_helper </td><td>  Bietet Rake-Klassen, Methoden und Aufgaben für Spezifikationstests von Puppet-Code </td></tr><tr><td>  rspec-Marionette </td><td>  Testet das Verhalten von Puppen beim Kompilieren von Manifesten im Ressourcenverzeichnis (?) </td></tr><tr><td>  rspec-Marionetten-Fakten </td><td>  Ermöglicht das Ausführen von rspec-puppet mit benutzerdefinierten Puppet-Fakten </td></tr></tbody></table><br><h2 id="sozdayom-modul">  Erstellen Sie ein Modul </h2><br><p>  PDK installiert, jetzt können Sie herumspielen.  Der einfachste <code>pdk help</code> zeigt die verfügbaren Befehle an.  Angenommen, wir befinden uns in dem Ordner, in dem Sie alle anderen Module haben.  Dann erstellen wir eine neue: </p><br><pre> <code class="plaintext hljs">$ pdk new module --template-url=https://github.com/puppetlabs/pdk-templates.git *** We need to create the metadata.json file for this module, so we're going to ask you 5 questions. *** [Q 1/5] If you have a name for your module, add it here. --&gt; dummy [Q 2/5] If you have a Puppet Forge username, add it here. --&gt; felixoid [Q 3/5] Who wrote this module? --&gt; Mikhail f. Shiryaev [Q 4/5] What license does this module code fall under? --&gt; MIT [Q 5/5] What operating systems does this module support? --&gt; RedHat based Linux, Debian based Linux, Windows Metadata will be generated based on this information, continue? Yes pdk (INFO): Module 'dummy' generated at path '/tmp/dummy', from template 'https://github.com/puppetlabs/pdk-templates.git'.</code> </pre> <br><p>  Das Dienstprogramm stellt Fragen zum Ausfüllen der Datei metadata.json, und die Ausgabe enthält genau das, was angezeigt wird: das Modul und die Zusatzdateien, die aus Vorlagen aus dem Git kompiliert wurden. </p><br><p>  Eine kleine Bemerkung - Temlites ändern sich ziemlich oft, einschließlich einiger kritischer Fehler, die kürzlich behoben wurden.  Daher ist es besser, nicht die Standardeinstellungen des installierten PDK zu verwenden, sondern die neueste Version.  Es <code>--template-url</code> , es gibt eine Kehrseite: Wenn PDK das Argument <code>--template-url</code> , fügt es diesen Parameter der <code>~.pdk/cache/answers.json</code> und versucht, <code>pdk</code> an den Verzögerungen bei der weiteren Ausführung eines der <code>pdk</code> Befehle, diese herunterzuladen.  Entfernen Sie diesen Parameter entweder aus <code>answers.json</code> oder verwenden Sie ihn nicht beim Erstellen eines Moduls und ändern Sie ihn in <code>metadata.json</code> . </p><br><p>  Lassen Sie uns die weiteren Schritte durchgehen, die mit dem PDK ausgeführt werden können. </p><br><h3 id="new-class">  neue Klasse </h3><br><pre> <code class="plaintext hljs">$ pdk new class dummy::class pdk (INFO): Creating '/tmp/dummy/manifests/class.pp' from template. pdk (INFO): Creating '/tmp/dummy/spec/classes/class_spec.rb' from template. $ cat manifests/class.pp # A description of what this class does # # @summary A short summary of the purpose of this class # # @example # include dummy::class class dummy::class { } $ cat spec/classes/class_spec.rb require 'spec_helper' describe 'dummy::class' do on_supported_os.each do |os, os_facts| context "on #{os}" do let(:facts) { os_facts } it { is_expected.to compile } end end end</code> </pre> <br><p>  Dieser Befehl erstellt zwei Dateien: das Manifest selbst für die Klasse und die Spezifikationsdatei zum Testen.  Ich werde später genauer auf die Tags zur Dokumentation eingehen. </p><br><h3 id="new-defined_type">  neuer definierter_Typ </h3><br><pre> <code class="plaintext hljs">$ pdk new defined_type type pdk (INFO): Creating '/tmp/dummy/manifests/type.pp' from template. pdk (INFO): Creating '/tmp/dummy/spec/defines/type_spec.rb' from template.</code> </pre> <br><p>  Trotzdem: Manifest für Ressourcentyp und Spezifikationsdatei. </p><br><h4 id="new-provider--task">  neuer Anbieter &amp; Aufgabe </h4><br><p>  PDK kann auch einen neuen Anbieter oder eine neue Aufgabe erstellen, aber ich habe nicht eng mit ihnen zusammengearbeitet. Daher kann ich ehrlich sagen, dass es besser ist, dieses Thema bei Bedarf eingehender zu untersuchen. </p><br><h2 id="generaciya-dokumentacii-pri-pomoschi-puppet-strings">  Dokumentation mit Marionettenschnüren erstellen </h2><br><p>  Ich verstehe nicht wirklich, warum <code>puppet strings</code> nicht Teil des PDK-Toolkits sind, dies ist jedoch la la.  Wenn Sie während der Entwicklung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tags</a> für den Hof korrekt platziert haben, gibt es zwei Möglichkeiten, dem Benutzer Dokumentation zur Verfügung zu stellen: </p><br><ul><li>  Generieren Sie es als HTML / Markdown / JSON und platzieren Sie es neben dem Code.  Dies geschieht mit dem Befehl " <code>puppet string generate [--format FORMAT]</code> , bei dem das Format weggelassen oder auf " <code>json</code> / <code>puppet string generate [--format FORMAT]</code> werden kann. <br><ul><li>  Es ist üblich, die Datei <code>REFERENCE.md</code> im Stammverzeichnis des Repositorys als Dokumentationsstandard zu haben, der mit dem <code>puppet strings generate --format markdown</code> . </li></ul></li><li>  Veröffentlichen Sie im Repository mit Code (vorausgesetzt, es befindet sich auf Github) Github-Seiten.  Dies ist ganz einfach, Sie benötigen 3 Befehle: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  Gemfile.lock,    PDK rm -f Gemfile.lock #     Gemfile   bundle bundle install --path vendor/bundle #   gh-pages   rake-task bundle exec rake strings:gh_pages:update</span></span></code> </pre> </li></ul><br><p>  Es scheint keine Magie zu sein, aber am Ausgang haben wir ein Modul mit Anweisungen.  Das Plus ist, dass die Ausgabe auch dann eine Klasse / ein Typ / eine Funktion mit einer minimalen Beschreibung der Parameter mit dem Typ und dem Standardwert ist, wenn Sie beispielsweise nicht jeden der Parameter mit dem <code>@param</code> Tag beschreiben.  Meiner bescheidenen Meinung nach ist sogar dies besser als nichts und wird das Modul für den Einsatz attraktiver machen. </p><br><p>  All dies kann natürlich automatisiert und als CI-Stufe hinzugefügt werden.  Das wäre perfekt.  Meine Hände haben noch nicht erreicht, aber es sammelt sich Staub im Rückstand.  Wenn plötzlich jemand etwas zu diesem Thema zu sagen hat, bin ich dankbar.  Als Gedanken: Fügen Sie mindestens einen Check hinzu, um festzustellen, ob sich REFERENCE.md nach dem Ausführen von Puppet-Strings ändert.  Wenn ja, denken Sie daran, dass die Tests fehlgeschlagen sind. </p><br><h2 id="nastroyka-shablonov">  Vorlagenanpassung </h2><br><p>  Die Dokumentation für Vorlagen befindet sich im Repository von <a href="">pdk-templates</a> .  Kurz gesagt, alles wird mithilfe der Datei <code>.sync.yml</code> im Stammverzeichnis des Moduls konfiguriert, und die Änderungen werden mit dem Befehl <code>pdk update</code> .  Jeder der Parameter dieser Datei ist der Name einer anderen Datei im Verzeichnis des Moduls, die auf die eine oder andere Weise geändert werden muss.  Die meisten Parameter für jede der Vorlagen musste ich "per Berührung" auswählen und dabei häufig den Quellcode betrachten - durch Ausprobieren.  Die Dokumentation hier bleibt manchmal weit zurück.  Leider gibt es fast nichts mehr zu sagen, außer einen Link zu <a href="">einem Beispiel</a> aus Ihrem eigenen Repository zu geben. </p><br><p>  Ich werde sehr schnell einige Parameter beschreiben, die ich mithilfe der <code>.sync.yml</code> aus dem obigen Beispiel geändert habe: </p><br><ul><li>  <code>Gemfile</code> : Zwei <code>Gemfile</code> wurden als Abhängigkeiten in verschiedenen Gruppen hinzugefügt: pdk in der Entwicklungsgruppe;  xml-simple in der Abhängigkeitsgruppe.  Beim Starten der Tests ist die Gruppe system_tests nicht installiert, daher füge ich die Abhängigkeit einer anderen Gruppe hinzu. </li><li>  <code>spec/spec_helper.rb</code> : Die Rauchmethode wurde geändert, der Mindestschwellenwert für die Testabdeckung wurde hinzugefügt, unterhalb dessen die Tests als fehlgeschlagen gelten. </li><li>  <code>.travis.yml</code> : Diese Datei wurde lange Zeit poliert, da sie zum Überprüfen der Codebasis und zum Laden des fertigen Moduls in Puppet-Forge verwendet wird.  Änderungen: <br><ul><li>  Benutzer und verschlüsseltes Passwort zum Ausfüllen des Moduls in Puppet-Forge.  Weitere Informationen zum Einsatz von Puppet-Forge bei Travis finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </li><li>  Eine Testsequenz wurde erstellt → Bereitstellung mit dem Start der letzteren nur bei erfolgreichen Tests. </li><li>  Die Phase der Bereitstellung des Moduls für Puppet-Forge wurde hinzugefügt, vorausgesetzt, das CI wird über das Tag gestartet, das mit dem Zeichen "v" beginnt. </li></ul></li><li>  <code>Rakefile</code> : Einige Ausnahmen für den Linter wurden hinzugefügt. </li></ul><br><h2 id="zapusk-razlichnyh-ci">  Verschiedene CI ausführen </h2><br><p>  Hier ist alles ganz einfach.  Unmittelbar nach dem Generieren des Moduls mit dem PDK beginnt die Validierung in Appveyor, Travis und Gitlab-CI.  Um die Tests auszuführen, ist alles <code>.sync.yml</code> einsatzbereit. Für die <code>.sync.yml</code> dieselbe <code>.sync.yml</code> .  Ich habe keine besonderen Vorlieben, daher werde ich nichts empfehlen.  Verwenden Sie einfach das, was bequemer ist. </p><br><h2 id="bonus-pishem-yunit-testy-dlya-klassov-tipov-i-funkciy">  Bonus: Wir schreiben Unit-Tests für Klassen, Typen und Funktionen </h2><br><p>  Dieser Punkt geht weit über das Grundmaterial hinaus, das ich beschreiben wollte, aber er scheint mir sehr nützlich zu sein. </p><br><p>  Wir haben also ein Modul mit Manifesten und eine Bibliothek, die wiederum Klassen, Typen und Funktionen enthält (wir vergessen auch nicht Aufgaben und Anbieter, aber ich habe kein Fachwissen in diesem Teil).  Da jeder Code zum Ändern vorhanden ist, wäre es natürlich schön, ihn mit Tests zu überlagern, um zwei Dinge sicherzustellen: </p><br><ul><li>  Änderungen unterbrechen nicht das aktuelle Verhalten (oder Verhaltensänderungen bei Tests) </li><li>  Ihre Manifeste tun genau das, was Sie erwarten, und nutzen alle Ressourcen, die Sie erwarten. </li></ul><br><p>  Puppetlabs bietet eine Erweiterung für das Rspec-Framework <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Puppet-Rspec</a> .  Links zur Dokumentation zum Testen von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Klassen</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Typen</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Funktionen</a> .  Seien Sie nicht zu faul, um genau hinzuschauen, es gibt andere Abschnitte. </p><br><p>  Es ist ganz einfach, es zu benutzen, ohne Rubin zu kennen.  Wenn Klassen oder Typen wie oben gezeigt mit <code>pdk new &lt;thing&gt;</code> , ist auch die Datei <code>*_spec.rb</code> bereits vorhanden.  Nehmen wir also an, wir haben eine <code>dummy::class</code> .  Zum Testen muss eine Datei <code>spec/classes/class_spec.rb</code> mit den folgenden Inhalten erstellt werden: </p><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'spec_helper'</span></span> describe <span class="hljs-string"><span class="hljs-string">'dummy::class'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> on_supported_os.each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|os, os_facts|</span></span> context <span class="hljs-string"><span class="hljs-string">"on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{os}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> let(<span class="hljs-symbol"><span class="hljs-symbol">:facts</span></span>) { os_facts } it { is_expected.to compile } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Sie können dies überprüfen, indem Sie die <code>pdk test unit</code> im Stammverzeichnis des Moduls <code>pdk test unit</code> . </p><br><p>  Das ist fast alles was wir brauchen.  Nun bleibt es, <code>class_spec.rb</code> erforderlichen <code>is_expected</code> mit den entsprechenden Bedingungen zu ergänzen.  Um beispielsweise zu überprüfen, ob die Klasse die Ressource <code>file {'/file/path': }</code> mit bestimmten Parametern enthält, können Sie Folgendes tun: </p><br><pre> <code class="ruby hljs">it <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> is_expected.to contain_file(<span class="hljs-string"><span class="hljs-string">'/file/path'</span></span>).with( <span class="hljs-string"><span class="hljs-string">'ensure'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'file'</span></span>, <span class="hljs-string"><span class="hljs-string">'mode'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0644'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Sie können Klassenparameter mit <code>let(:params) { {'param1' =&gt; 'value'} }</code> Es ist möglich, Tests unter verschiedenen Eingabebedingungen durchzuführen, indem Sie sie jeweils in die ausgewählten Abschnitte des <code>context 'some description' {}</code> .  Sie können beide Abhängigkeiten zwischen Ressourcen und zwischen Klassen überprüfen: Wenn beispielsweise angenommen wird, dass eine <code>is_expected.to contain_class('parent_class_name')</code> enthält, können Sie die <code>is_expected.to contain_class('parent_class_name')</code> hinzufügen.  Müssen Sie das Verhalten in verschiedenen Betriebssystemen überprüfen?  Es ist auch möglich: Wir geben einfach in einem separaten Kontext die notwendigen Fakten an: </p><br><pre> <code class="ruby hljs">context <span class="hljs-string"><span class="hljs-string">'with Debian'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> let(<span class="hljs-symbol"><span class="hljs-symbol">:facts</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">os:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">architecture:</span></span> <span class="hljs-string"><span class="hljs-string">'amd64'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">distro:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">codename:</span></span> <span class="hljs-string"><span class="hljs-string">'stretch'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">release:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">full:</span></span> <span class="hljs-string"><span class="hljs-string">'9.6'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">major:</span></span> <span class="hljs-string"><span class="hljs-string">'9'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">minor:</span></span> <span class="hljs-string"><span class="hljs-string">'6'</span></span>, }, }, <span class="hljs-symbol"><span class="hljs-symbol">family:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">name:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">release:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">full:</span></span> <span class="hljs-string"><span class="hljs-string">'9.6'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">major:</span></span> <span class="hljs-string"><span class="hljs-string">'9'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">minor:</span></span> <span class="hljs-string"><span class="hljs-string">'6'</span></span>, }, <span class="hljs-symbol"><span class="hljs-symbol">selinux:</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">enabled:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }, }, <span class="hljs-symbol"><span class="hljs-symbol">osfamily:</span></span> <span class="hljs-string"><span class="hljs-string">'Debian'</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> it { is_expected.to something } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Soweit ich beim Schreiben von Tests festgestellt habe, können Sie mit dem Framework im Allgemeinen fast alles überprüfen, was möglicherweise benötigt wird.  Das Vorhandensein von Tests hat mir einmal geholfen, als einige Parameter von den untergeordneten Klassen in die oberste Klasse des Moduls verschoben wurden: Sie zeigten, dass das Refactoring nichts kaputt machte und sich das Verhalten des gesamten Moduls nicht änderte. </p><br><h1 id="vmesto-vyvoda">  Anstelle von Ausgabe </h1><br><p>  Wie bereits aus der allgemeinen Intonation des Artikels hervorgeht, bin ich sehr ermutigt darüber, wie sehr Puppet die Arbeit mit Modulen und Manifesten dank PDK erleichtert hat.  Routinemaßnahmen werden automatisiert, Vorlagen werden nach Möglichkeit verwendet, Konfigurationen für gängige CI sind sofort verfügbar.  Es mag wie eine Art Overhead erscheinen, und die Verwendung bringt möglicherweise nicht die erwarteten Früchte, aber es lohnt sich auf jeden Fall.  Wenn Sie vergleichen, wie man Module ohne und mit PDK entwickelt, dann sieht es für mich so aus: </p><br><table><thead><tr><th>  Entwicklung ohne <del>  Bärte </del>  PDK </th><th>  PDK-Entwicklung </th></tr></thead><tbody><tr><td><img src="https://habrastorage.org/webt/hb/gg/xd/hbggxdj1znic1fgofyl-sb3oz0c.jpeg" width="300"></td><td><img src="https://habrastorage.org/webt/rw/4n/j-/rw4nj-vux8ricpk46hih5iu_3js.jpeg" width="300"></td></tr></tbody></table><br><p>  Versuchen Sie, setzen Sie, machen Sie sich und Ihren Kollegen das Leben leichter.  Gerne beantworte ich mögliche Fragen. </p><br><p>  Möge die Atomatisierung bei uns sein! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de435954/">https://habr.com/ru/post/de435954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de435944/index.html">Food Design Digest, Dezember 2018</a></li>
<li><a href="../de435946/index.html">DIY Wärmebildkamera auf Raspberry PI oder "Jetzt denke ich, ich weiß, was ich diesen Sommer tun werde"</a></li>
<li><a href="../de435948/index.html">MIT-Kurs "Computer Systems Security". Vorlesung 23: Sicherheitsökonomie, Teil 3</a></li>
<li><a href="../de435950/index.html">Modulares Rechenzentrum im Dienste des Large Hadron Collider</a></li>
<li><a href="../de435952/index.html">Wer sind "ungewaschene Hoster"?</a></li>
<li><a href="../de435956/index.html">PHP Digest Nr. 147 (1. - 14. Januar 2019)</a></li>
<li><a href="../de435958/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends für die letzte Woche Nr. 347 (7. - 13. Januar 2019)</a></li>
<li><a href="../de435960/index.html">Gedankenexperiment: Flattern unterwegs</a></li>
<li><a href="../de435962/index.html">25 Jahre Aeron: Sensationen und Eindrücke der aktualisierten Version von Aeron Remastered</a></li>
<li><a href="../de435964/index.html">Ethereum plant, 99% wirtschaftlicher zu sein</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>