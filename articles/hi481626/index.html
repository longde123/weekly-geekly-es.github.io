<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСИЁЯП╛ ЁЯШ┐ тЩЙя╕П IOS рдореЗрдВ рдЬрдЯрд┐рд▓ рдкреНрд░рджрд░реНрд╢рди рд╕рдВрдЧреНрд░рд╣: VKontakte рдлрд╝реАрдб рдХреЗ рдЙрджрд╛рд╣рд░рдг рдкрд░ рд╕рдорд╕реНрдпрд╛рдПрдВ рдФрд░ рд╕рдорд╛рдзрд╛рди ЁЯТД тЩНя╕П ЁЯСйЁЯП╝тАНЁЯФм</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдирдорд╕реНрддреЗ! рдореЗрд░рд╛ рдирд╛рдо рд╕рд╛рд╢рд╛ рд╣реИ, рдореИрдВ рдЯреАрдо рдореЗрдВ рдПрдХ iOS рдбреЗрд╡рд▓рдкрд░ рд╣реВрдВ рдЬреЛ VKontakte рдлреАрдб рдмрдирд╛рддрд╛ рд╣реИред рдЕрдм рдореИрдВ рдЖрдкрдХреЛ рдмрддрд╛рддрд╛ рд╣реВрдБ рдХрд┐ рд╣рдо рдХрд┐рд╕ рддрд░рд╣ рд╕реЗ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдЕрдиреБрдХ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IOS рдореЗрдВ рдЬрдЯрд┐рд▓ рдкреНрд░рджрд░реНрд╢рди рд╕рдВрдЧреНрд░рд╣: VKontakte рдлрд╝реАрдб рдХреЗ рдЙрджрд╛рд╣рд░рдг рдкрд░ рд╕рдорд╕реНрдпрд╛рдПрдВ рдФрд░ рд╕рдорд╛рдзрд╛рди</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vk/blog/481626/"><p>  рдирдорд╕реНрддреЗ!  рдореЗрд░рд╛ рдирд╛рдо рд╕рд╛рд╢рд╛ рд╣реИ, рдореИрдВ рдЯреАрдо рдореЗрдВ рдПрдХ iOS рдбреЗрд╡рд▓рдкрд░ рд╣реВрдВ рдЬреЛ VKontakte рдлреАрдб рдмрдирд╛рддрд╛ рд╣реИред  рдЕрдм рдореИрдВ рдЖрдкрдХреЛ рдмрддрд╛рддрд╛ рд╣реВрдБ рдХрд┐ рд╣рдо рдХрд┐рд╕ рддрд░рд╣ рд╕реЗ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рд╕реЗ рдЬреБрдбрд╝реА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪрддреЗ рд╣реИрдВред <br>  рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдХрд▓реНрдкрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╡реАрдХреЗ рдЯреЗрдк рдХреНрдпрд╛ рд╣реИред  рдпрд╣ рдПрдХ рд╕реНрдХреНрд░реАрди рд╣реИ рдЬрд╣рд╛рдВ рдЖрдк рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреА рд╕рд╛рдордЧреНрд░реА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: рдЧреНрд░рдВрде, рд╕реНрдерд┐рд░ рдЪрд┐рддреНрд░, рдПрдирд┐рдореЗрдЯреЗрдб GIF, рдПрдореНрдмреЗрдбреЗрдб рддрддреНрд╡ (рд╡реАрдбрд┐рдпреЛ рдФрд░ рд╕рдВрдЧреАрдд)ред  рдпрд╣ рд╕рдм рдЖрд╕рд╛рдиреА рд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдкрд░ рдЙрдЪреНрдЪ рдорд╛рдВрдЧред </p><br><p>  рдЕрдм рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдореИрдкрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдорд╛рдирдХ рдорд╛рдирдХ рдХреНрдпрд╛ рд╣реИрдВ рдФрд░ рдХрд┐рди рд╕реАрдорд╛рдУрдВ рдпрд╛ рд▓рд╛рднреЛрдВ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><p>  рдпрджрд┐ рдЖрдк рдкрдврд╝рдиреЗ рд╕реЗ рдЕрдзрд┐рдХ рд╕реБрдирдирд╛ рдкрд╕рдВрдж рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд░рд┐рдкреЛрд░реНрдЯ рдХреА рд╡реАрдбрд┐рдпреЛ рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ <a href="https://vk.com/video-147415323_456239051">рдпрд╣рд╛рдВ рд╣реИ</a> ред </p><br><p><img src="https://habrastorage.org/webt/6u/np/1d/6unp1dycdkq5wxkhtv-6ixrmv-q.png"></p><a name="habracut"></a><br><h1 id="soderzhanie">  рд╕рд╛рдордЧреНрд░реА </h1><br><ol><li> рд╡рд┐рд╡рд░рдг рдФрд░ рд▓реЗрдЖрдЙрдЯ рдХреА рдЧрдгрдирд╛ <br>  1.1ред  рдСрдЯреЛ рд▓реЗрдЖрдЙрдЯ <br>  1.2ред  рдореИрдиреБрдЕрд▓ <code>frame</code> рдЧрдгрдирд╛ </li><li>  рдкрд╛рда рдХрд╛ рдЖрдХрд╛рд░ рдЧрдгрдирд╛ <br>  2.1ред  <code>UILabel</code> / <code>UITextView</code> / <code>UITextField</code> рдХреЗ рдЖрдХрд╛рд░ рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рддрд░реАрдХреЗ <br>  2.2ред  <code>NSAttributedString</code> / <code>NSString</code> рддрд░реАрдХреЗ <br>  2.3ред  TextKit <br>  2.4ред  CoreText </li><li>  VKontakte рдлреАрдб рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ? </li><li>  рдмреЗрд╣рддрд░ рдкреНрд░рджрд░реНрд╢рди рдХреИрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ <br>  4.1 рдкреНрд░рджрд░реНрд╢рди рдХреА рд╕рдорд╕реНрдпрд╛рдПрдВ рдХреНрдпреЛрдВ <br>  4.2ред <code>CATransaction.commit</code> <br>  4.3ред  рд░реЗрдВрдбрд░рд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди <br>  4.4ред  рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдХрдордЬреЛрд░ рд╕реНрдерд╛рди </li><li>  рдорд╛рдк рдЙрдкрдХрд░рдг <br>  5.1ред  рдзрд╛рддреБ рдкреНрд░рдгрд╛рд▓реА рдЯреНрд░реЗрд╕ <br>  5.2ред  рд╣рдо рдХреЛрдб рдореЗрдВ рдкреНрд░рджрд░реНрд╢рди рдХреА рдХрдореА рдХреЛ рдареАрдХ рдХрд░рддреЗ рд╣реИрдВ, рдЬрдмрдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЪрд▓ рд░рд╣рд╛ рд╣реИ </li></ol><br><ul><li>  рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рдЕрдиреБрд╕рдВрдзрд╛рди рдХреИрд╕реЗ рдХрд░реЗрдВред  рд╕рд┐рдлрд╛рд░рд┐рд╢реЗрдВ </li><li>  рдирд┐рд╖реНрдХрд░реНрд╖ </li><li>  рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕реНрд░реЛрдд </li></ul><br><h1 id="1-opisanie-i-vychislenie-layout">  <strong>1. рд▓реЗрдЖрдЙрдЯ рдХрд╛ рд╡рд┐рд╡рд░рдг рдФрд░ рдЧрдгрдирд╛</strong> </h1><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЖрдЗрдП рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдирд┐рдпрдорд┐рдд рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рдЬрд╝реБрдЕрд▓ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рд╕рдВрд░рдЪрдирд╛ ( <em>рд▓реЗрдЖрдЙрдЯ</em> ) рдХреИрд╕реЗ рдмрдирд╛рдПрдВред  рдЕрдВрддрд░рд┐рдХреНрд╖ рдХреЛ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рдХреЗ рдмрд┐рдирд╛ рдХрд░реЗрдВрдЧреЗ - рдореИрдВ рдмрд╕ рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░реВрдВрдЧрд╛ рдФрд░ рдЙрдирдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рд╕рдордЭрд╛рдКрдВрдЧрд╛ред </p><br><h2 id="11-auto-layout">  <strong>1.1ред</strong>  <strong>рдСрдЯреЛ рд▓реЗрдЖрдЙрдЯ</strong> </h2><br><p>  рд╢рд╛рдпрдж iOS рдореЗрдВ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдмрдирд╛рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рд▓реЛрдХрдкреНрд░рд┐рдп рддрд░реАрдХрд╛ Apple рдХреЗ <a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/index.html">рдСрдЯреЛ рд▓реЗрдЖрдЙрдЯ</a> рд▓реЗрдЖрдЙрдЯ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред  рдпрд╣ <a href="https://constraints.cs.washington.edu/cassowary/">рдХреИрд╕реЛрд╡реЗрд░реА</a> рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо <a href="https://habr.com/ru/company/oleg-bunin/blog/437584/">рдкрд░ рдЖрдзрд╛рд░рд┐рдд</a> рд╣реИ, рдЬреЛ <em>рдмрд╛рдзрд╛рдУрдВ</em> рдХреА рдЕрд╡рдзрд╛рд░рдгрд╛ рдХреЗ рд╕рд╛рде <a href="https://constraints.cs.washington.edu/cassowary/">рд╕рдВрдпреБрдХреНрдд</a> рд░реВрдк рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИ <em>ред</em> </p><br><p>  <em>рдЕрднреА рдХреЗ рд▓рд┐рдП, рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдСрдЯреЛ рд▓реЗрдЖрдЙрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдкрд░ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред</em> </p><br><p>  <strong>рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ:</strong> </p><br><ul><li>  рдмрд╛рдзрд╛ рдкреНрд░рдгрд╛рд▓реА <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B8%25D0%25BD%25D0%25B5%25D0%25B9%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">рдПрдХ рд░реИрдЦрд┐рдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рд╕рдорд╕реНрдпрд╛</a> рдореЗрдВ рдмрджрд▓ рдЬрд╛рддреА <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B8%25D0%25BD%25D0%25B5%25D0%25B9%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">рд╣реИ</a> ред </li><li>  <a href="https://constraints.cs.washington.edu/solvers/cassowary-tochi.pdf">рдХреИрд╕реЛрд╡реЗрд░реА</a> <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D0%25BC%25D0%25BF%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581-%25D0%25BC%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4">рд╕рд┐рдореНрдкреНрд▓реЗрдХреНрд╕ рд╡рд┐рдзрд┐</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд░рд┐рдгрд╛рдореА рдЕрдиреБрдХреВрд▓рди рд╕рдорд╕реНрдпрд╛ рдХреЛ <a href="https://constraints.cs.washington.edu/solvers/cassowary-tochi.pdf">рд╣рд▓ рдХрд░рддрд╛ рд╣реИ</a> ред  рдЗрд╕ рд╡рд┐рдзрд┐ рдореЗрдВ рдШрд╛рддреАрдп рд╕реНрдкрд░реНрд╢реЛрдиреНрдореБрдЦ рдЬрдЯрд┐рд▓рддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдХреНрдпрд╛ рдорддрд▓рдм рд╣реИ?  рдЬреИрд╕рд╛ рдХрд┐ рд▓реЗрдЖрдЙрдЯ рдореЗрдВ рдмрд╛рдзрд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдмрдврд╝ рдЬрд╛рддреА рд╣реИ, рд╕рдмрд╕реЗ рдЦрд░рд╛рдм рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЧрдгрдирд╛ рддреЗрдЬреА рд╕реЗ рдзреАрдорд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред </li><li>  <a href="https://developer.apple.com/documentation/uikit/uiview"><code>UIView</code></a> рд▓рд┐рдП рдкрд░рд┐рдгрд╛рдореА <a href="https://developer.apple.com/documentation/uikit/uiview/1622621-frame"><code>frame</code></a> рдорд╛рди рд╕рдВрдЧрдд рдЕрдиреБрдХреВрд▓рди рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рдорд╛рдзрд╛рди рд╣реИрдВред </li></ul><br><p>  <strong>рдСрдЯреЛ рд▓реЗрдЖрдЙрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд╛рдн:</strong> </p><br><ul><li>  <a href="https://developer.apple.com/videos/play/wwdc2018/220">рд╕рд░рд▓ рдореИрдкрд┐рдВрдЧ рдкрд░, рд░реИрдЦрд┐рдХ рдХрдореНрдкреНрдпреВрдЯреЗрд╢рдирд▓ рдЬрдЯрд┐рд▓рддрд╛ рд╕рдВрднрд╡ рд╣реИ</a> ред </li><li>  рдпрд╣ рд╕рднреА рдорд╛рдирдХ рддрддреНрд╡реЛрдВ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ Apple рдХреА "рджреЗрд╢реА" рддрдХрдиреАрдХ рд╣реИред </li><li>  рдмреЙрдХреНрд╕ рдХреЗ рдмрд╛рд╣рд░ <code>UIView</code> рд╕рд╛рде рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </li><li>  рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдмрд┐рд▓реНрдбрд░ рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИ, рдЬреЛ рдЖрдкрдХреЛ рд╕реНрдЯреЛрд░реАрдмреЛрд░реНрдб рдпрд╛ XIB рдореЗрдВ рд▓реЗрдЖрдЙрдЯ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </li><li>  рдпрд╣ рд╕рдВрдХреНрд░рдордг рдХреЗ рджреМрд░рд╛рди рднреА рдЕрджреНрдпрддрд┐рдд рд╕рдорд╛рдзрд╛рди рдХреА рдЧрд╛рд░рдВрдЯреА рджреЗрддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ <code>UIView</code> <code>frame</code> рдореВрд▓реНрдп рд╣рдореЗрд╢рд╛ (!) рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд▓реЗрдЖрдЙрдЯ рдХрд╛рд░реНрдп рдХрд╛ рдПрдХ рд╕рдорд╛рдзрд╛рди рд╣реИред </li></ul><br><p>  рдЕрдзрд┐рдХрд╛рдВрд╢ рдкреНрд░рджрд░реНрд╢рдиреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо рдХреНрд╖рдорддрд╛рдПрдВ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИрдВред  рд▓реЗрдХрд┐рди рднрд╛рд░реА рдорд╛рддреНрд░рд╛ рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдЯреЗрдк рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЙрдкрдпреБрдХреНрдд рдирд╣реАрдВ рд╣реИред  рдХреНрдпреЛрдВ? </p><br><p>  <strong>рдпрд╣ рдпрд╛рдж рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдСрдЯреЛ рд▓реЗрдЖрдЙрдЯ:</strong> </p><br><ul><li>  <em>рдХреЗрд╡рд▓ рдореБрдЦреНрдп рд╕реВрддреНрд░ рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ</em> ред  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ Apple рдЗрдВрдЬреАрдирд┐рдпрд░реЛрдВ рдиреЗ рдореЗрдирд╕реНрдЯреНрд░реАрдо рдХреЛ рдСрдЯреЛ рд▓реЗрдЖрдЙрдЯ рд╕рдорд╛рдзрд╛рди рдХреЗ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реЗрд╢рди рдмрд┐рдВрджреБ рдФрд░ рд╕рднреА <code>UIView</code> рдХреЗ рдлреНрд░реЗрдо рд╡реИрд▓реНрдпреВ рдХреЗ рд░реВрдк рдореЗрдВ рдЪреБрдирд╛ <code>UIView</code> ред  рдЗрд╕рдХреЗ рдмрд┐рдирд╛, рдЖрдкрдХреЛ рдСрдЯреЛ рд▓реЗрдЖрдЙрдЯ рдХреЛ рдПрдХ рдЕрд▓рдЧ рдзрд╛рдЧреЗ рдореЗрдВ рдЧрдгрдирд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдореБрдЦреНрдп рдзрд╛рдЧреЗ рдХреЗ рд╕рд╛рде рдореВрд▓реНрдпреЛрдВ рдХреЛ рд▓рдЧрд╛рддрд╛рд░ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </li><li>  <em>рдпрд╣ рдзреАрд░реЗ-рдзреАрд░реЗ рдЬрдЯрд┐рд▓ рдЕрднреНрдпрд╛рд╡реЗрджрди рдкрд░ рдХрд╛рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ</em> , рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ рдХреНрд░реВрд░ рдмрд▓ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ рдЬрд┐рд╕рдХреА рд╕рдмрд╕реЗ рдЦрд░рд╛рдм рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЬрдЯрд┐рд▓рддрд╛ рдШрд╛рддреАрдп рд╣реИред </li><li>  <em>IOS 6.0 рдХреЗ рд╕рд╛рде</em> <em>рдЙрдкрд▓рдмреНрдз рд╣реИ</em> ред  рдЕрдм рдпрд╣ рд╢рд╛рдпрдж рд╣реА рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд╡рд┐рдЪрд╛рд░ рдХрд░рдиреЗ рд▓рд╛рдпрдХ рд╣реИред </li></ul><br><p>  <em>рдирд┐рд╖реНрдХрд░реНрд╖: рдСрдЯреЛ рд▓реЗрдЖрдЙрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрдЧреНрд░рд╣ рдХреЗ рдмрд┐рдирд╛ рдпрд╛ рдЙрд╕рдХреЗ рд╕рд╛рде рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдирд╛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ, рд▓реЗрдХрд┐рди рддрддреНрд╡реЛрдВ рдХреЗ рдмреАрдЪ рдЬрдЯрд┐рд▓ рд╕рдВрдмрдВрдзреЛрдВ рдХреЗ рдмрд┐рдирд╛ред</em> </p><br><h2 id="12-raschyot-frame-vruchnuyu">  <strong>1.2ред</strong>  <strong>рдореИрдиреБрдЕрд▓ <code>frame</code> рдЧрдгрдирд╛</strong> </h2><br><p>  рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рд╕рд╛рд░: рд╣рдо рд╕рднреА <code>frame</code> рдореВрд▓реНрдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдЦреБрдж рдХрд░рддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо рддрд░реАрдХреЗ <a href="https://developer.apple.com/documentation/uikit/uiview/1622625-sizethatfits"><code>sizeThatFits</code></a> рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, <a href="https://developer.apple.com/documentation/uikit/uiview/1622625-sizethatfits"><code>sizeThatFits</code></a> , <a href="https://developer.apple.com/documentation/uikit/uiview/1622625-sizethatfits"><code>sizeThatFits</code></a> ред  рдпрд╣реА рд╣реИ, <code>sizeThatFits</code> рдореЗрдВ <code>layoutSubviews</code> рд╕реНрд╡рдпрдВ рд╕рднреА рдмрд╛рд▓ рддрддреНрд╡реЛрдВ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЖрдХрд╛рд░ рдореЗрдВ рд╣рдо рдмрдЪреНрдЪреЗ рддрддреНрд╡реЛрдВ рдФрд░ рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╡рд╛рдВрдЫрд┐рдд рд╕реНрдерд╛рди рдХреЗ рдЕрдиреБрд░реВрдк рдЖрдХрд╛рд░ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рдпрд╣ рдХреНрдпрд╛ рджреЗрддрд╛ рд╣реИ?  рд╣рдо рдЬрдЯрд┐рд▓ рдЧрдгрдирд╛ рдХреЛ рдкреГрд╖реНрдарднреВрдорд┐ рдзрд╛рд░рд╛ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рд╕рд░рд▓ рдЧрдгрдирд╛ рдореБрдЦреНрдп рдзрд╛рд░рд╛ рдореЗрдВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред </p><br><p>  рдХреНрдпрд╛ рд╕рдорд╕реНрдпрд╛ рд╣реИ?  рдЖрдкрдХреЛ рд╕реНрд╡рдпрдВ рдЧрдгрдирд╛рдУрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЧрд▓рддреА рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред  рдЖрдкрдХреЛ рдпрд╣ рднреА рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдмрдЪреНрдЪреЛрдВ рдХреА рд╕реНрдерд┐рддрд┐ рдФрд░ рдЖрдХрд╛рд░ рдЖрдХрд╛рд░ рдореЗрдВ рд╡рд╛рдкрд╕ рдЖрдП рдкрд░рд┐рдгрд╛рдо <code>sizeThatFits</code> ред </p><br><p>  <strong>рд╕реНрд╡-рдореВрд▓реНрдпрд╛рдВрдХрди рдЙрдЪрд┐рдд рд╣реИ рдпрджрд┐:</strong> </p><br><ul><li>  рд╣рдордиреЗ рд╕рд╛рдордирд╛ рдХрд┐рдпрд╛ рд╣реИ рдпрд╛ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдпрд╛ рд╣реИ рдХрд┐ рд╣рдо рдСрдЯреЛ рд▓реЗрдЖрдЙрдЯ рдкреНрд░рджрд░реНрд╢рди рд╕реАрдорд╛рдУрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░реЗрдВрдЧреЗред </li><li>  рдЖрд╡реЗрджрди рдореЗрдВ рдПрдХ рдЬрдЯрд┐рд▓ рд╕рдВрдЧреНрд░рд╣ рд╣реИ, рдФрд░ рдПрдХ рдЕрдЪреНрдЫрд╛ рдореМрдХрд╛ рд╣реИ рдХрд┐ рд╡рд┐рдХрд╕рд┐рдд рддрддреНрд╡ рдЗрд╕рдХреА рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдореЗрдВ рдЧрд┐рд░ рдЬрд╛рдПрдЧрд╛; </li><li>  рд╣рдо рдкреГрд╖реНрдарднреВрдорд┐ рдереНрд░реЗрдб рдореЗрдВ рддрддреНрд╡ рдХреЗ рдЖрдХрд╛рд░ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ; </li><li>  рд╣рдо рд╕реНрдХреНрд░реАрди рдкрд░ рдЧреИрд░-рдорд╛рдирдХ рддрддреНрд╡ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рд╕рд╛рдордЧреНрд░реА рдпрд╛ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд▓рдЧрд╛рддрд╛рд░ рдкреБрдирд░реНрдЧрдард┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><img src="https://habrastorage.org/webt/tg/-l/nl/tg-lnlwfkzfzkqir1xdd2dun6la.png"></li></ul><br><p>  <strong>рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИред</strong>  рдЯреВрд▓рдЯрд┐рдкреНрд╕ рдбреНрд░рд╛ рдХрд░реЗрдВ рдЬреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдлрд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреЗрд▓ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕ рдХрд╛рд░реНрдп рдореЗрдВ рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╣рд┐рд╕реНрд╕рд╛ рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдЯреВрд▓рдЯрд┐рдк рдореЗрдВ рдкрд╛рда рдХреЗ рджреГрд╢реНрдп рдЖрдХрд╛рд░ рдХреА рдЧрдгрдирд╛ рдХреИрд╕реЗ рдХреА рдЬрд╛рдПред </p><br><hr><br><h1 id="2-vychislenie-razmera-teksta">  <strong>2. рдкрд╛рда рдЖрдХрд╛рд░ рдХреА рдЧрдгрдирд╛</strong> </h1><br><p>  рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдХрдо рд╕реЗ рдХрдо рдЪрд╛рд░ рддрд░реАрдХреЛрдВ рд╕реЗ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рддрд░реАрдХреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред  рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдХреА рдЕрдкрдиреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдФрд░ рд╕реАрдорд╛рдПрдВ рд╣реИрдВред </p><br><h2 id="21-standartnye-metody-vychisleniya-razmera-uilabeluitextviewuitextfield">  <strong>2.1ред</strong>  <strong><code>UILabel</code> / <code>UITextView</code> / <code>UITextField</code> рдХреЗ рдЖрдХрд╛рд░ рдХреА рдЧрдгрдирд╛ рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рддрд░реАрдХреЗ</strong> </h2><br><p>  <a href="https://developer.apple.com/documentation/uikit/uiview/1622625-sizethatfits"><code>sizeThatFits</code></a> ( <a href="https://developer.apple.com/documentation/uikit/uiview/1622625-sizethatfits"><code>sizeThatFits</code></a> рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рдФрд░ <a href="https://developer.apple.com/documentation/uikit/uiview/1622600-intrinsiccontentsize"><code>intrinsicContentSize</code></a> (рдСрдЯреЛ рд▓реЗрдЖрдЙрдЯ рдореЗрдВ рдкреНрд░рдпреБрдХреНрдд) <a href="https://developer.apple.com/documentation/uikit/uiview/1622600-intrinsiccontentsize"><code>intrinsicContentSize</code></a> рд╕рд╛рдордЧреНрд░реА рджреГрд╢реНрдп рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдкрд╕рдВрджреАрджрд╛ рдЖрдХрд╛рд░ рд▓реМрдЯрд╛рддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЙрдирдХреА рдорджрдж рд╕реЗ рд╣рдо рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ <code>UILabel</code> рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП рдкрд╛рда рдореЗрдВ рдХрд┐рддрдирд╛ рд╕реНрдерд╛рди <code>UILabel</code> ред </p><br><p>  рдирдХрд╛рд░рд╛рддреНрдордХ рдкрдХреНрд╖ рдпрд╣ рд╣реИ рдХрд┐ рджреЛрдиреЛрдВ рд╡рд┐рдзрд┐рдпрд╛рдВ рдХреЗрд╡рд▓ рдореБрдЦреНрдп рдзрд╛рдЧреЗ рдореЗрдВ рдХрд╛рдо рдХрд░рддреА рд╣реИрдВ - рдЙрдиреНрд╣реЗрдВ рдкреГрд╖реНрдарднреВрдорд┐ рд╕реЗ рдирд╣реАрдВ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  <strong>рдорд╛рдирдХ рддрд░реАрдХреЗ рдХрдм рдЙрдкрдпреЛрдЧреА рд╣реИрдВ?</strong> </p><br><ul><li>  рдпрджрд┐ рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА <code>sizeToFit</code> рдпрд╛ Auto Layout рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред </li><li>  рдЬрдм рдкреНрд░рджрд░реНрд╢рди рдореЗрдВ рдорд╛рдирдХ рддрддреНрд╡ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рд╣рдо рдХреЛрдб рдореЗрдВ рдЙрдирдХрд╛ рдЖрдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред </li><li>  рдЬрдЯрд┐рд▓ рд╕рдВрдЧреНрд░рд╣ рдХреЗ рдмрд┐рдирд╛ рдХрд┐рд╕реА рднреА рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдПред </li></ul><br><h2 id="22-metody-nsattributedstringnsstring">  <strong>2.2ред</strong>  <strong>NSAttributedString / NSString рддрд░реАрдХреЗ</strong> </h2><br><p>  <a href="https://developer.apple.com/documentation/foundation/nsstring/1524729-boundingrect"><code>boundingRect</code></a> рдФрд░ <a href="https://developer.apple.com/documentation/foundation/nsstring/1531844-sizewithattributes%3Flanguage%3Dobjc"><code>sizeWithAttributes</code></a> рдзреНрдпрд╛рди рджреЗрдВред  рдореИрдВ <code>UILabel</code> / <code>UITextView</code> / <code>UITextField</code> рдХреА рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЖрдХрд╛рд░ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рдирд╣реАрдВ рджреЗрддрд╛ред  рдореБрдЭреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдХреА рдЬрд╛рдирдХрд╛рд░реА рдореЗрдВ рдХрд╣реАрдВ рднреА рдпрд╣ рдирд╣реАрдВ рдорд┐рд▓рд╛ рдХрд┐ <code>NSString</code> рддрд░реАрдХреЗ рдФрд░ <code>UIView</code> рддрддреНрд╡реЛрдВ рдХреЗ рд▓реЗрдЖрдЙрдЯ рддрд░реАрдХреЗ рдПрдХ рд╣реА рдХреЛрдб (рд╕рдорд╛рди рдХрдХреНрд╖рд╛рдПрдВ) рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИрдВред  рд╡рд░реНрдЧреЛрдВ рдХреЗ рдпреЗ рджреЛ рд╕рдореВрд╣ рдХреНрд░рдорд╢рдГ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд░реВрдкрд░реЗрдЦрд╛рдУрдВ рдХреЗ рд╣реИрдВ: рдлрд╛рдЙрдВрдбреЗрд╢рди рдФрд░ рдпреВрдЖрдИрдХрд┐рдЯред  рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА <code>UILabel</code> рдЖрдХрд╛рд░ рдХреЗ рд▓рд┐рдП рдмрд╛рдЙрдВрдбрд┐рдВрдЧрдЖрд░рдХреНрдЯ рдкрд░рд┐рдгрд╛рдо рдлрд┐рдЯ рдХрд░рдирд╛ рдерд╛?  рдпрд╛ рдХреНрдпрд╛ рдЖрдк рдЗрд╕ рддрдереНрдп рд╕реЗ <a href="https://stackoverflow.com/questions/15965525/how-to-get-nsstring-size-when-nsstring-includes-emojis"><code> NSString</code></a> рдХрд┐ <a href="https://stackoverflow.com/questions/15965525/how-to-get-nsstring-size-when-nsstring-includes-emojis"><code> NSString</code> рдЗрдореЛрдЬреА рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рдирд╣реАрдВ рд░рдЦрддреЗ рд╣реИрдВ</a> ?  рдпреЗ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ рдорд┐рд▓ рд╕рдХрддреА рд╣реИрдВред </p><br><p>  рдореИрдВ рдЖрдкрдХреЛ рдпрд╣ рднреА рдмрддрд╛рдКрдВрдЧрд╛ рдХрд┐ <code>UILabel</code> / <code>UITextView</code> / <code>UITextField</code> рдореЗрдВ рдкрд╛рда рдЦреАрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХреМрди рд╕реА рдХрдХреНрд╖рд╛рдПрдВ рдЬрд╝рд┐рдореНрдореЗрджрд╛рд░ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрднреА рдХреЗ рддрд░реАрдХреЛрдВ рдкрд░ рд▓реМрдЯрдиреЗ <code>UITextField</code> ред </p><br><p>  <strong>рдпрджрд┐ рд╣рдо рд╣реИрдВ рддреЛ рдЗрд╕рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рдирд╛ред</strong> </p><br><ul><li>  рд╣рдо <a href="https://developer.apple.com/documentation/foundation/nsstring/1529855-drawinrect"><code>drawInRect</code></a> , <a href="https://developer.apple.com/documentation/foundation/nsstring/1533109-drawatpoint"><code>drawAtPoint</code></a> рдпрд╛ <code>NSString</code> / <code>NSAttributedString</code> рдЕрдиреНрдп рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧреИрд░-рдорд╛рдирдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рддрддреНрд╡реЛрдВ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВред </li><li>  рд╣рдо рдкреГрд╖реНрдарднреВрдорд┐ рд╕реНрдЯреНрд░реАрдо рдореЗрдВ рддрддреНрд╡реЛрдВ рдХреЗ рдЖрдХрд╛рд░ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдлрд┐рд░, рдпрд╣ рдХреЗрд╡рд▓ рдЙрдЪрд┐рдд рд░реЗрдВрдбрд░рд┐рдВрдЧ рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рд╣реИред </li><li>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдордирдорд╛рдирд╛ <a href="https://developer.apple.com/documentation/coregraphics/cgcontextref%3Flanguage%3Dobjc">рд╕рдВрджрд░реНрдн</a> рдмрдирд╛рдПрдВ, рдЫрд╡рд┐ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рдПрдХ рд░реЗрдЦрд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВред </li></ul><br><h2 id="23-textkit">  <strong>2.3ред</strong>  <strong>TextKit</strong> </h2><br><p>  рдЗрд╕ рдЙрдкрдХрд░рдг рдореЗрдВ рдорд╛рдирдХ рдХреНрд▓рд╛рд╕реЗрд╕ <a href="https://developer.apple.com/documentation/uikit/nslayoutmanager"><code>NLayoutManager</code></a> , <a href="https://developer.apple.com/documentation/uikit/nstextstorage"><code>NSTextStorage</code></a> рдФрд░ <a href="https://developer.apple.com/documentation/uikit/nstextcontainer"><code>NSTextContainer</code></a> ред  рд▓реЗрдЖрдЙрдЯ <code>UILabel</code> / <code>UITextView</code> / <code>UITextField</code> рднреА <code>UITextField</code> рдкрд░ <a href="https://developer.apple.com/library/archive/documentation/StringsTextFonts/Conceptual/TextAndWebiPhoneOS/CustomTextProcessing/CustomTextProcessing.html">рдЖрдзрд╛рд░рд┐рдд</a> рд╣реИред </p><br><p>  TextKit рдмрд╣реБрдд рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИ рдЬрдм рдЖрдкрдХреЛ рдкрд╛рда рдХреЗ рд╕реНрдерд╛рди рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдФрд░ <a href="https://developer.apple.com/documentation/uikit/nstextcontainer/1444569-exclusionpaths">рд╕рдВрдХреЗрдд рдорд┐рд▓рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХрд┐рд╕ рдЖрдХрд╛рд░ рдореЗрдВ</a> рдШреВрдореЗрдЧрд╛: </p><br><p><img src="https://habrastorage.org/webt/g8/m1/hi/g8m1hixof_ic7gpugctcvug9gsk.png"></p><br><p>  TextKit рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк рдкреГрд╖реНрдарднреВрдорд┐ рдХрддрд╛рд░ рдореЗрдВ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рддрддреНрд╡реЛрдВ рдХреЗ рдЖрдХрд╛рд░, рд╕рд╛рде рд╣реА <a href="https://developer.apple.com/documentation/uikit/nslayoutmanager/1403160-enumeratelinefragments">рд▓рд╛рдЗрдиреЛрдВ / рд╡рд░реНрдгреЛрдВ</a> рдХреА <a href="https://developer.apple.com/documentation/uikit/nslayoutmanager/1403160-enumeratelinefragments"><code>  frame</code></a> рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд░реВрдкрд░реЗрдЦрд╛ рдЖрдкрдХреЛ <a href="https://developer.apple.com/documentation/uikit/nslayoutmanager/1403158-drawglyphs">рдЧреНрд▓рд┐рдлрд╝ рдЦреАрдВрдЪрдиреЗ</a> рдФрд░ рдореМрдЬреВрджрд╛ рд▓реЗрдЖрдЙрдЯ рдХреЗ рднреАрддрд░ рдкрд╛рда рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред  рдпрд╣ рд╕рдм iOS 7.0 рдФрд░ рдЙрдЪреНрдЪрддрд░ рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </p><br><p>  <strong>TextKit рдЙрдкрдпреЛрдЧреА рд╣реИ рдЬрдм рдЖрдк рдХреА рдЬрд░реВрд░рдд рд╣реИ:</strong> </p><br><ul><li>  рдЬрдЯрд┐рд▓ рд▓реЗрдЖрдЙрдЯ рдХреЗ рд╕рд╛рде рдкреНрд░рджрд░реНрд╢рди рдкрд╛рда; </li><li>  рдЫрд╡рд┐рдпреЛрдВ рдкрд░ рдкрд╛рда рдЖрдХрд░реНрд╖рд┐рдд рдХрд░реЗрдВ; </li><li>  рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╕рдмрд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдЖрдХрд╛рд░ рдХреА рдЧрдгрдирд╛ рдХрд░реЗрдВ; </li><li>  рд▓рд╛рдЗрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдЧрд┐рдиреЗрдВ; </li><li>  рдПрдХ <code>UITextView</code> рдореЗрдВ рдЧрдгрдирд╛ рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </li></ul><br><p>  рдореИрдВ рдлрд┐рд░ рдЬреЛрд░ рджреЗрддрд╛ рд╣реВрдВред  рдпрджрд┐ рдЖрдкрдХреЛ <code>UITextView</code> рдХреЗ рдЖрдХрд╛рд░ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рд╣рдо рдкрд╣рд▓реЗ <code>NSLayoutManager</code> , <code>NSTextStorage</code> рдФрд░ <code>NSTextContainer</code> рдХреЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ <code>NSTextContainer</code> , рдФрд░ рдлрд┐рд░ <a href="https://developer.apple.com/documentation/uikit/uitextview/1618602-layoutmanager">рдЗрди рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рд╕рдВрдмрдВрдзрд┐рдд</a> <code>NSTextContainer</code> <a href="https://developer.apple.com/documentation/uikit/uitextview/1618602-layoutmanager">рдкрд╛рд╕ рджреЗрддреЗ рд╣реИрдВ</a> , рдЬрд╣рд╛рдБ рд╡реЗ рд▓реЗрдЖрдЙрдЯ рдХреЗ рд▓рд┐рдП рдЬрд╝рд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрдВрдЧреЗред  рдХреЗрд╡рд▓ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╣рдо рд╕рднреА рдореВрд▓реНрдпреЛрдВ рдХреЗ рдкреВрд░реНрдг рд╕рдВрдпреЛрдЧ рдХреА рдЧрд╛рд░рдВрдЯреА рджреЗрддреЗ рд╣реИрдВред </p><br><p>  <code>UILabel</code> рдФрд░ <code>UITextField</code> рд╕рд╛рде TextKit рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВ!  рдЙрдирдХреЗ рд▓рд┐рдП ( <code>UITextView</code> рд╡рд┐рдкрд░реАрдд) рдЖрдк <code>NSLayoutManager</code> , <code>NSTextStorage</code> рдФрд░ <code>NSTextContainer</code> рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред </p><br><h2 id="24-coretext">  <strong>2.4ред</strong>  <strong>CoreText</strong> </h2><br><p>  рдпрд╣ iOS рдореЗрдВ рд╕рдмрд╕реЗ рдирд┐рдЪрд▓рд╛ рд╕реНрддрд░ рдХрд╛ рдЯреЗрдХреНрд╕реНрдЯ рдЯреВрд▓ рд╣реИред  рдпрд╣ рдлреЛрдВрдЯ, рдкрд╛рддреНрд░реЛрдВ, рд▓рд╛рдЗрдиреЛрдВ, рдЗрдВрдбреЗрдВрдЯ рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдкрд░ рдЕрдзрд┐рдХрддрдо рдирд┐рдпрдВрддреНрд░рдг рджреЗрддрд╛ рд╣реИред  рдФрд░ рд╡рд╣, TextKit рдХреА рддрд░рд╣, рдЖрдкрдХреЛ рдкрд╛рда рдХреЗ рдЯрд╛рдЗрдкреЛрдЧреНрд░рд╛рдлрд┐рдХ рдорд╛рдкрджрдВрдбреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдЖрдзрд╛рд░рднреВрдд рдФрд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рдлреНрд░реЗрдо рдЖрдХрд╛рд░ред </p><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ, рдЬрд┐рддрдиреА рдЕрдзрд┐рдХ рд╕реНрд╡рддрдВрддреНрд░рддрд╛, рдЙрддрдиреА рд╣реА рдЕрдзрд┐рдХ рдЬрд┐рдореНрдореЗрджрд╛рд░реАред  рдФрд░ CoreText рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдЪреНрдЫреЗ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЗрд╕рдХреЗ рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  CoreText рдЕрдзрд┐рдХрд╛рдВрд╢ рд╡рд╕реНрддреБрдУрдВ рдкрд░ рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд▓рд┐рдП рдереНрд░реЗрдб рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рд╡рд┐рднрд┐рдиреНрди рдереНрд░реЗрдбреНрд╕ рд╕реЗ рдЗрд╕рдХреЗ рддрд░реАрдХреЛрдВ рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рддреБрд▓рдирд╛ рдХреЗ рд▓рд┐рдП, TextKit рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп, рдЖрдкрдХреЛ рд╕реНрд╡рдпрдВ рд╡рд┐рдзрд┐ рдХреЙрд▓ рдХреЗ рдЕрдиреБрдХреНрд░рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪрдирд╛ рд╣реЛрдЧрд╛ред </p><br><p>  CoreText рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдпрджрд┐: </p><br><ul><li>  рдкрд╛рда рдорд╛рдкрджрдВрдбреЛрдВ рддрдХ рд╕реАрдзреА рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддреНрдпрдВрдд рд╕рд░рд▓ рдирд┐рдореНрди-рд╕реНрддрд░реАрдп рдПрдкреАрдЖрдИ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдореБрдЭреЗ рддреБрд░рдВрдд рдХрд╣рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЕрдзрд┐рдХрд╛рдВрд╢ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП, TextKit рдХреА рдХреНрд╖рдорддрд╛рдПрдВ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИрдВред </li><li>  рд╡реНрдпрдХреНрддрд┐рдЧрдд рд▓рд╛рдЗрдиреЛрдВ ( <a href="https://developer.apple.com/documentation/coretext/ctline-61l"><code>CTLine</code></a> ) рдФрд░ рдкрд╛рддреНрд░реЛрдВ / рддрддреНрд╡реЛрдВ рдХреЗ рд╕рд╛рде рдмрд╣реБрдд рдХрд╛рдо рдХрд░рдирд╛ рд╣реИред </li><li>  IOS 6.0 рдореЗрдВ рд╕рдорд░реНрдерди рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред </li></ul><br><p>  VKontakte рдлрд╝реАрдб рдХреЗ рд▓рд┐рдП, рд╣рдордиреЗ CoreText рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред  рдХреНрдпреЛрдВ?  рдмрд╕ рдЙрд╕ рд╕рдордп рдЬрдм рд╣рдордиреЗ рдкрд╛рда рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдмреБрдирд┐рдпрд╛рджреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛, TextKit рдЕрднреА рддрдХ рдирд╣реАрдВ рдерд╛ред </p><br><hr><br><h1 id="3-kak-rabotaet-lenta-vkontakte">  <strong>3. VKontakte рдлреАрдб рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ?</strong> </h1><br><p>  рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рд╣рдо рд╕рд░реНрд╡рд░ рд╕реЗ рдбреЗрдЯрд╛ рдХреИрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдЖрдЙрдЯ рдФрд░ рдбрд┐рд╕реНрдкреНрд▓реЗ рдмрдирд╛рддреЗ рд╣реИрдВред </p><br><p><img src="https://habrastorage.org/webt/7g/kx/pt/7gkxptt4lpgjhjzbtyl3prm4vxy.png"></p><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдкреГрд╖реНрдарднреВрдорд┐ рдХрддрд╛рд░ рдореЗрдВ рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрдпреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред  рд╣рдо рд╕рд░реНрд╡рд░ рд╕реЗ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдмрд╛рдж рдореЗрдВ рдбрд┐рд╕реНрдкреНрд▓реЗ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕ рд╕реНрддрд░ рдкрд░, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднреА рддрдХ <code>UIView</code> рдЙрджрд╛рд╣рд░рдг рдирд╣реАрдВ рд╣реИрдВ, рд╣рдо рдХреЗрд╡рд▓ рдЕрдкрдиреЗ рдШреЛрд╖рдгрд╛рддреНрдордХ рдЙрдкрдХрд░рдг рдХреЗ рд╕рд╛рде рднрд╡рд┐рд╖реНрдп рдХреЗ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдирд┐рдпрдореЛрдВ рдФрд░ рд╕рдВрд░рдЪрдирд╛ рдХреЛ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рдХреБрдЫ рд╣рдж рддрдХ <a href="https://developer.apple.com/xcode/swiftui/">рд╕реНрд╡рд┐рдлреНрдЯрдпреВрдЖрдИ рдХреЗ</a> рд╕рдорд╛рди рд╣реИред  рд▓реЗрдЖрдЙрдЯ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд╡рд░реНрддрдорд╛рди рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП рдкреВрд░реЗ <code>frame</code> рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕реНрдХреНрд░реАрди рдХреА рдЪреМрдбрд╝рд╛рдИред  рд╣рдо рд╡рд░реНрддрдорд╛рди <code>dataSource</code> ( <code>dataSourceUpdate</code> ) рдХрд╛ рдЕрджреНрдпрддрди рдХрд░рддреЗ рд╣реИрдВред  рдпрд╣рд╛рдВ, рдкреГрд╖реНрдарднреВрдорд┐-рдХрддрд╛рд░ рдореЗрдВ, рд╣рдо рдЪрд┐рддреНрд░ рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ: рд╡рд┐рдШрдЯрди рдХрд░рддреЗ рд╣реИрдВ (рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП рдкреНрд░рджрд░реНрд╢рди рдЕрдиреБрднрд╛рдЧ рджреЗрдЦреЗрдВ), рдЫрд╛рдпрд╛, рдЧреЛрд▓ рдФрд░ рдЕрдиреНрдп рдкреНрд░рднрд╛рд╡ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░реЗрдВред </p><br><p>  рдЕрдм рдореЗрди рдХрддрд╛рд░ рдореЗрдВ рдЬрд╛рдПрдВред  <code>dataSourceUpdate</code> рдкреНрд░рд╛рдкреНрдд <code>dataSourceUpdate</code> рдХреЛ <code>dataSourceUpdate</code> , <code>UITableView</code> рдореЗрдВ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдШрдЯрдирд╛рдУрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░реЗрдВ, рдХреЛрд╢рд┐рдХрд╛рдУрдВ рдХреЛ рднрд░реЗрдВред </p><br><p>  рд╣рдорд╛рд░реЗ рд▓реЗрдЖрдЙрдЯ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рдЕрд▓рдЧ рд▓реЗрдЦ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рдореИрдВ рдЗрд╕рдХреА рдореБрдЦреНрдп рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░реВрдВрдЧрд╛: </p><br><ul><li>  рдПрдХ рдШреЛрд╖рдгрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдирд┐рдпрдореЛрдВ рдХрд╛ рдПрдХ рд╕рдореВрд╣ рд╣реИ рдЬрд┐рд╕ рдкрд░ рдПрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред </li><li>  рдмреБрдирд┐рдпрд╛рджреА рдШрдЯрдХ рдПрдХ рдкреЗрдбрд╝ ( <code>nodes</code> ) рдмрдирд╛рддреЗ рд╣реИрдВред </li><li>  рдмреБрдирд┐рдпрд╛рджреА рдШрдЯрдХреЛрдВ рдореЗрдВ рд╕рд░рд▓ рдЧрдгрдирд╛ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕реВрдЪрд┐рдпреЛрдВ рдореЗрдВ, рд╣рдо рдХреЗрд╡рд▓ <code>origin</code> рдСрдлрд╕реЗрдЯ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ <code>origin</code> , рд╕рднреА рдмрдЪреНрдЪреЛрдВ рдХреА рдЪреМрдбрд╝рд╛рдИ / рдКрдВрдЪрд╛рдИ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдПред </li><li>  рдореВрд▓ рддрддреНрд╡ рдкрджрд╛рдиреБрдХреНрд░рдо рдореЗрдВ <code>UIView</code> рдЕрдирд╛рд╡рд╢реНрдпрдХ "рдХрдВрдЯреЗрдирд░реЛрдВ" рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕реВрдЪреА рдШрдЯрдХ рдЕрддрд┐рд░рд┐рдХреНрдд <code>UIView</code> рдирд╣реАрдВ рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдореЗрдВ рдмрдЪреНрдЪреЛрдВ рдХреЛ рдирд╣реАрдВ рдЬреЛрдбрд╝рддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рд╣рдо рдореВрд▓ (рд╕реВрдЪреА рдХреЗ рд▓рд┐рдП) рддрддреНрд╡ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдмрдЪреНрдЪреЛрдВ рдХреА <code>origin</code> рдСрдлрд╕реЗрдЯ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ <code>origin</code> ред </li><li>  CoreText рдХреЗ рд╕рд╛рде рдирд┐рдореНрди рд╕реНрддрд░ рдХрд╛ рдкрд╛рда рдкреНрд░рдмрдВрдзрдиред </li></ul><br><p>  рд▓реЗрдХрд┐рди рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рде рднреА, рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдореБрджреНрджреЛрдВ рдХреЗ рдХрд╛рд░рдг рдЯреЗрдк рджреЗрдЦрдиреЗ рдореЗрдВ рдЖрд╕рд╛рдиреА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИред  рдХреНрдпреЛрдВ? </p><br><p>  рдкреНрд░рддреНрдпреЗрдХ рдХреЛрд╢рд┐рдХрд╛ рдореЗрдВ <code>nodes</code> рдХрд╛ рдПрдХ рдЬрдЯрд┐рд▓ рдкрджрд╛рдиреБрдХреНрд░рдо рд╣реЛрддрд╛ рд╣реИред  рдФрд░ рдпрджреНрдпрдкрд┐ рдореВрд▓ рддрддреНрд╡ рдЕрдирд╛рд╡рд╢реНрдпрдХ рдХрдВрдЯреЗрдирд░реЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдирд╣реАрдВ рдХрд░рддреЗ <code>UIView</code> рднреА рдмрд╣реБрдд рд╕рд╛рд░реЗ <code>UIView</code> рд░рд┐рдмрди рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд <code>UIView</code> ред  рдФрд░ рдореЗрди-рдХрддрд╛рд░ рдореЗрдВ "рдиреЛрдбреНрд╕" (рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рджреЗрдЦреЗрдВ) рдХреЗ рд╕рд╛рде рдкрджрд╛рдиреБрдХреНрд░рдо рдХреЛ рднрд░рдиреЗ рдкрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд╛рдо рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рджреВрд░ рд╣реЛрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИред </p><br><p>  рд╣рдордиреЗ рдкреГрд╖реНрдарднреВрдорд┐ рдХрддрд╛рд░ рдореЗрдВ рдЕрдзрд┐рдХ рд╕реЗ рдЕрдзрд┐рдХ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдФрд░ рдЕрдм рднреА рдРрд╕рд╛ рдХрд░рдирд╛ рдЬрд╛рд░реА рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕реАрдкреАрдпреВ-рд╕рдШрди рдФрд░ рдЬреАрдкреАрдпреВ-рдЧрд╣рди рд╕рдВрдЪрд╛рд▓рди рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдЗрд╕реЗ рджрд░рдХрд┐рдирд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><hr><br><h1 id="4-kak-dobitsya-luchshey-proizvoditelnosti">  <strong>4. рдмреЗрд╣рддрд░ рдкреНрд░рджрд░реНрд╢рди рдХреИрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</strong> </h1><br><p>  рд╕рдмрд╕реЗ рд╕рд░рд▓ рдЙрддреНрддрд░ рдореБрдЦреНрдп рдзрд╛рдЧреЗ, рд╕реАрдкреАрдпреВ рдФрд░ рдЬреАрдкреАрдпреВ рдХреЛ рдмрдВрдж рдХрд░рдирд╛ рд╣реИред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЖрдИрдУрдПрд╕-рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдХрд╛рдо рдХреЛ рдЧрд╣рд░рд╛рдИ рд╕реЗ рд╕рдордЭрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдФрд░ рд╕рдмрд╕реЗ рдКрдкрд░, рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рд╕реНрд░реЛрддреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдВред </p><br><h2 id="41-pochemu-voznikayut-problemy-s-proizvoditelnostyu">  <strong>4.1 рдкреНрд░рджрд░реНрд╢рди рдХреА рд╕рдорд╕реНрдпрд╛рдПрдВ рдХреНрдпреЛрдВ</strong> </h2><br><p>  <strong>рдХреЛрд░ рдПрдирд┐рдореЗрд╢рди, <code>RunLoop</code> рдФрд░ рд╕реНрдХреНрд░реЙрд▓</strong> <br>  рдЖрдЗрдП рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ iOS рдореЗрдВ рдХреИрд╕реЗ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╢реАрд░реНрд╖ рд╕реНрддрд░ рдкрд░, <a href="https://developer.apple.com/documentation/uikit">UIKit рд╣реИ</a> , рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╝рд┐рдореНрдореЗрджрд╛рд░ рд╣реИ: рдЗрд╢рд╛рд░рд╛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг, рдиреАрдВрдж рд╕реЗ рдЖрд╡реЗрджрди рдЬрд╛рдЧрдирд╛, рдФрд░ рдЗрд╕реА рддрд░рд╣ рдХреА рдЪреАрдЬреЗрдВред  рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рдирд┐рдореНрди-рд╕реНрддрд░реАрдп рдЙрдкрдХрд░рдг рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИ - <a href="https://developer.apple.com/documentation/quartzcore">рдХреЛрд░ рдПрдирд┐рдореЗрд╢рди</a> (рдЬреИрд╕рд╛ рдХрд┐ macOS рдореЗрдВ)ред  рдпрд╣ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/CoreAnimationBasics/CoreAnimationBasics.html">рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рд╡рд┐рд╡рд░рдг рдкреНрд░рдгрд╛рд▓реА рдХреЗ</a> рд╕рд╛рде рдПрдХ рд░реВрдкрд░реЗрдЦрд╛ <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/CoreAnimationBasics/CoreAnimationBasics.html">рд╣реИ</a> ред  рдПрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреА рдореВрд▓ рдЕрд╡рдзрд╛рд░рдгрд╛рдУрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред </p><br><p>  рдХреЛрд░ рдПрдирд┐рдореЗрд╢рди рдХреЗ рд▓рд┐рдП, рд╕рдВрдкреВрд░реНрдг рдЗрдВрдЯрд░рдлрд╝реЗрд╕ <a href="https://developer.apple.com/documentation/quartzcore/calayer"><code>CALayer</code></a> рд▓реЗрдпрд░реНрд╕ рд╣реИред  рд╡реЗ рдПрдХ рд░реЗрдВрдбрд░ рдЯреНрд░реА рдмрдирд╛рддреЗ рд╣реИрдВ, рдЬрд┐рд╕реЗ <a href="https://developer.apple.com/documentation/quartzcore/catransaction"><code>CATransaction</code></a> рд▓реЗрдирджреЗрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рд▓реЗрди-рджреЗрди рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХрд╛ рдПрдХ рд╕рдореВрд╣ рд╣реИ, рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рд░реВрдк рд╕реЗ, рдкреНрд░рджрд░реНрд╢рд┐рдд рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдореЗрдВ рдХреБрдЫ рдЕрджреНрдпрддрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реАред  <code>frame</code> рдпрд╛ рдЕрдиреНрдп рдкрд░рдд рдорд╛рдкрджрдВрдбреЛрдВ рдореЗрдВ рдХреЛрдИ рднреА рдкрд░рд┐рд╡рд░реНрддрди рд╡рд░реНрддрдорд╛рди рд▓реЗрдирджреЗрди рдореЗрдВ рдЖрддрд╛ рд╣реИред  рдпрджрд┐ рдкрд╣рд▓реЗ рд╕реЗ рдирд╣реАрдВ рд╣реИ, рддреЛ рд╕рд┐рд╕реНрдЯрдо рд╕реНрд╡рдпрдВ рдПрдХ <a href="https://developer.apple.com/documentation/quartzcore/catransaction%3Flanguage%3Dobjc"><em>рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд▓реЗрдирджреЗрди</em></a> рдмрдирд╛рддрд╛ рд╣реИред </p><br><p>  рдХрдИ рд▓реЗрдирджреЗрди рдПрдХ рд╕реНрдЯреИрдХ рдмрдирд╛рддреЗ рд╣реИрдВред  рддрд╛рдЬрд╛ рдЕрдкрдбреЗрдЯ рд╕реНрдЯреИрдХ рдХреЗ рд╢реАрд░реНрд╖ рд▓реЗрдирджреЗрди рдореЗрдВ рдЖрддреЗ рд╣реИрдВред </p><br><p>  <em>рдЕрдм рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╕реНрдХреНрд░реАрди рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рд▓реЗрдпрд░ рдЯреНрд░реА рдХреЗ рд▓рд┐рдП рдирдП рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде рд▓реЗрдирджреЗрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред</em> </p><br><p><img src="https://habrastorage.org/webt/84/2n/q5/842nq5jznw5i30ybdmqjrngqhiw.png"></p><br><p>  <strong>рд▓реЗрди-рджреЗрди рдХрдм рдФрд░ рдХреИрд╕реЗ рдХрд░реЗрдВ?</strong>  рд╣рдорд╛рд░реЗ рдЖрд╡реЗрджрди рдореЗрдВ, рдереНрд░реЗрдбреНрд╕ рдореЗрдВ <a href="https://developer.apple.com/documentation/foundation/runloop"><code>RunLoop</code></a> рдирд╛рдордХ рдПрдХ <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html">рдЗрдХрд╛рдИ рд╣реИ</a> ред  рд╕рд░рд▓ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдпрд╣ рдПрдХ рдЕрдирдВрдд рд▓реВрдк рд╣реИ, рдЬрд┐рд╕рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ <a href="https://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B8%25D0%25BA%25D0%25BB_%25D1%2581%25D0%25BE%25D0%25B1%25D1%258B%25D1%2582%25D0%25B8%25D0%25B9">рдкрд░ рдШрдЯрдирд╛рдУрдВ</a> рдХреА рд╡рд░реНрддрдорд╛рди <a href="https://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B8%25D0%25BA%25D0%25BB_%25D1%2581%25D0%25BE%25D0%25B1%25D1%258B%25D1%2582%25D0%25B8%25D0%25B9">рдХрддрд╛рд░</a> рд╕рдВрд╕рд╛рдзрд┐рдд рд╣реЛрддреА рд╣реИред </p><br><p>  рдореБрдЦреНрдп рд╕реВрддреНрд░ рдореЗрдВ, <code>RunLoop</code> рд╡рд┐рднрд┐рдиреНрди рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдШрдЯрдирд╛рдУрдВ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ <code>RunLoop</code> рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдПрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ (рдЗрд╢рд╛рд░реЗ), рдЯрд╛рдЗрдорд░, рдпрд╛, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="https://developer.apple.com/documentation/foundation/nsstream"><code>NSStream</code></a> рдФрд░ <a href="https://developer.apple.com/documentation/foundation/nsport"><code>NSPort</code></a> рд╕реЗ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрдВрдбрд▓рд░ред </p><br><p><img src="https://habrastorage.org/webt/rd/f_/_m/rdf__mlll7k8wkiz6ijg8cnhhba.png"></p><br><p>  рдХреЛрд░ рдПрдирд┐рдореЗрд╢рди рдФрд░ <code>RunLoop</code> рдХреИрд╕реЗ <code>RunLoop</code> ?  рд╣рдордиреЗ рдКрдкрд░ рдкрд╛рдпрд╛ рдХрд┐ рд░реЗрдВрдбрд░ рдЯреНрд░реА рдореЗрдВ рдПрдХ рдкрд░рдд рдХреЗ рдЧреБрдгреЛрдВ рдХреЛ рдмрджрд▓рддреЗ рд╕рдордп, рд╕рд┐рд╕реНрдЯрдо рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ рдирд┐рд╣рд┐рдд рд▓реЗрдирджреЗрди рдмрдирд╛рддрд╛ рд╣реИ (рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдХреБрдЫ рдХреЛ рдлрд┐рд░ рд╕реЗ <a href="https://developer.apple.com/documentation/quartzcore/catransaction/1448282-begin"><code>CATransaction.begin</code></a> рд▓рд┐рдП <a href="https://developer.apple.com/documentation/quartzcore/catransaction/1448282-begin"><code>CATransaction.begin</code></a> рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ)ред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреНрд░рддреНрдпреЗрдХ <code>RunLoop</code> рдЪрд▓рдирд╛ рдкрд░ <code>RunLoop</code> рд╕рд┐рд╕реНрдЯрдо рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЦреБрд▓реЗ рд▓реЗрдирджреЗрди рдХреЛ рдмрдВрдж рдХрд░ рджреЗрддрд╛ рд╣реИ рдФрд░ рдХрд┐рдП рдЧрдП рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ ( <a href="https://developer.apple.com/documentation/quartzcore/catransaction/1448255-commit"><code>CATransaction.commit</code></a> ) рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред </p><br><p>  <strong>рдзреНрдпрд╛рди рджреЛ!</strong>  рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ <code>RunLoop</code> рд╕реНрдХреНрд░реАрди рдХреА рддрд╛рдЬрд╝рд╛ рджрд░ рдкрд░ рдирд┐рд░реНрднрд░ рдирд╣реАрдВ рдХрд░рддреА рд╣реИред  рдЪрдХреНрд░ рд╕реНрдХреНрд░реАрди рдХреЗ рд╕рд╛рде рд╕рдордХрд╛рд▓рд┐рдХ рдирд╣реАрдВ рд╣реИ рдФрд░ "рдЕрдВрддрд╣реАрди <code>while()</code> " рдХреА рддрд░рд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдЕрдм рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╕реНрдХреНрд░реЙрд▓ рдХреЗ рджреМрд░рд╛рди рдореБрдЦреНрдп рдереНрд░реЗрдб рдкрд░ <code>RunLoop</code> рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ: </p><br><pre> <code class="plaintext hljs"> ... if (dispatchBlocks.count &gt; 0) { //   MainQueue doBlocks() } ... if (hasPanEvent) { handlePan() // UIScrollView change content offset -&gt; change bounds } ... if (hasCATransaction) { CATransaction.commit() } ...</code> </pre> <br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдкреНрд░реЗрд╖рдг_ <a href="https://developer.apple.com/documentation/dispatch/1453057-dispatch_async"><code>dispatch_async</code></a> / <a href="https://developer.apple.com/documentation/dispatch/1452870-dispatch_sync"><code>dispatch_sync</code></a> рдорд╛рдзреНрдпрдо рд╕реЗ рдореБрдЦреНрдп рдХрддрд╛рд░ рдореЗрдВ рдЬреЛрдбрд╝реЗ рдЧрдП рдмреНрд▓реЙрдХ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдФрд░ рдЬрдм рддрдХ рд╡реЗ рдкреВрд░рд╛ рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддреЗ, рддрдм рддрдХ рдХрд╛рд░реНрдпрдХреНрд░рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдирд╣реАрдВ рдмрдврд╝рддрд╛ рд╣реИред </p><br><p>  рдЗрд╕рдХреЗ рдмрд╛рдж, UIKit рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ <a href="https://developer.apple.com/documentation/uikit/uipangesturerecognizer">рдкреИрди-рдЬреЗрд╕реНрдЪрд░</a> рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢реБрд░реВ <a href="https://developer.apple.com/documentation/uikit/uipangesturerecognizer">рдХрд░рддрд╛ рд╣реИ</a> ред  рдЗрд╕ рдЗрд╢рд╛рд░реЗ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рднрд╛рдЧ рдХреЗ рд░реВрдк рдореЗрдВ, <a href="https://developer.apple.com/documentation/uikit/uiscrollview/1619404-contentoffset"><code>UIScrollView.contentOffset</code></a> рдмрджрд▓рддрд╛ рд╣реИ, рдФрд░ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, <a href="https://developer.apple.com/documentation/uikit/uiview/1622580-bounds"><code>UIScrollView.bounds</code></a> ред  <a href="https://developer.apple.com/documentation/uikit/uiscrollview"><code>UIScrollView</code></a> рдХреА <code>bounds</code> рдмрджрд▓рдирд╛ (рдХреНрд░рдорд╢рдГ, рдФрд░ рдЗрд╕рдХреЗ рд╡рдВрд╢рдЬ <a href="https://developer.apple.com/documentation/uikit/uitableview"><code>UITableView</code></a> , <a href="https://developer.apple.com/documentation/uikit/uicollectionview"><code>UICollectionView</code></a> ) рд╕рд╛рдордЧреНрд░реА рдХреЗ рджреГрд╢реНрдп рднрд╛рдЧ ( <code>viewport</code> ) рдХреЛ рдЕрджреНрдпрддрди рдХрд░рддрд╛ рд╣реИред </p><br><p>  <code>RunLoop</code> рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреЗ рдЕрдВрдд рдореЗрдВ, рдпрджрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЦреБрд▓рд╛ рд▓реЗрдирджреЗрди рд╣реИ, рддреЛ <code>commit</code> рдпрд╛ <a href="https://developer.apple.com/documentation/quartzcore/catransaction/1448270-flush"><code>flush</code></a> рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╣реЛрддрд╛ рд╣реИред </p><br><p>  рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрдЪрд┐рдд рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рд▓рдЧрд╛рдПрдВред <br>  рдпрд╣рд╛рдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдЬреЗрд╕реНрдЪрд░ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреИрд╕рд╛ рджрд┐рдЦреЗрдЧрд╛: </p><br><p><img src="https://habrastorage.org/webt/9c/kw/08/9ckw08wo9cay2nhxqm7qikm1n4w.png"></p><br><p>  рдФрд░ рдпрд╣рд╛рдБ <code>handlePan</code> рдмрд╛рдж <code>handlePan</code> : </p><br><p><img src="https://habrastorage.org/webt/0k/h0/xc/0kh0xcaq1yx04htvepmilc_przq.png"></p><br><p>  рд╕реНрдХреНрд░реЙрд▓ <a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink"><code>CADisplayLink</code></a> рджреМрд░рд╛рди, <code>UIScrollView</code> рд╕реНрдХреНрд░реАрди рд░рд┐рдлреНрд░реЗрд╢ рджрд░ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб <a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink"><code>CADisplayLink</code></a> рдмрджрд▓рд╛рд╡ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ <a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink"><code>CADisplayLink</code></a> рдЯрд╛рдЗрдорд░ рдмрдирд╛рддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/42/gz/5x/42gz5xmatumqfi9jpcl3z1gabic.png"></p><br><p>  рд╣рдо <code>CATransaction.commit</code> рдХрд┐ <code>RunLoop</code> рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреЗ рдЕрдВрдд рдореЗрдВ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╕реАрдзреЗ <code>CADisplayLink</code> рдЯрд╛рдЗрдорд░ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рд╣реЛрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдЗрд╕рд╕реЗ рдХреЛрдИ рдлрд░реНрдХ рдирд╣реАрдВ рдкрдбрд╝рддрд╛: </p><br><p><img src="https://habrastorage.org/webt/oq/si/f0/oqsif0ek7f1-w4f4lguvp_eun20.png"></p><br><h2 id="42-catransactioncommit">  <strong>4.2ред</strong> <strong><code>CATransaction.commit</code></strong> </h2><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, <code>CATransaction.commit</code> рдЕрдВрджрд░ рдХреЗ рд╕рднреА рдСрдкрд░реЗрд╢рди рдХреЛ <code>CALayer</code> рд▓реЗрдпрд░реНрд╕ рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд▓реЗрдЖрдЙрдЯ ( <a href="https://developer.apple.com/documentation/quartzcore/calayerdelegate/2097262-draw"><code>drawLayer</code></a> ) рдФрд░ рдЫрд╡рд┐ ( <a href="https://developer.apple.com/documentation/quartzcore/calayerdelegate/2097262-draw"><code>drawLayer</code></a> ) рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410935-layoutsublayers%3Flanguage%3Dobjc"><code>layoutSublayers</code></a> рдХреА рдЕрдкрдиреА рд╡рд┐рдзрд┐рдпрд╛рдБ рд╣реИрдВред  рдЗрди рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410984-delegate">рдкреНрд░рддрд┐рдирд┐рдзрд┐</a> рдкрджреНрдзрддрд┐ рдХреЙрд▓ рд╣реЛрддреА рд╣реИред  <code>UIView</code> рдХреА рдирдИ рдЖрд╡реГрддреНрддрд┐ рдХреЛ <code>UIView</code> рдкрджрд╛рдиреБрдХреНрд░рдо рдореЗрдВ рдЬреЛрдбрд╝рдХрд░, рд╣рдо рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдХреЛрд░ рдПрдирд┐рдореЗрд╢рди рдкрд░рдд рдкрджрд╛рдиреБрдХреНрд░рдо рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рдкрд░рдд рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, <code>UIView</code> рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдкрдиреА рдкрд░рдд рдХрд╛ рдПрдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐ рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдХреЙрд▓ рд╕реНрдЯреИрдХ рд╕реЗ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, <code>UIView</code> <code>CALayer</code> рдкреНрд░рддрд┐рдирд┐рдзрд┐ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рднрд╛рдЧ рдХреЗ рд░реВрдк рдореЗрдВ, рдЕрдкрдиреЗ рддрд░реАрдХреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕ рдкрд░ рдЪрд░реНрдЪрд╛ рдХреА рдЬрд╛рдПрдЧреА: </p><br><p><img src="https://habrastorage.org/webt/oq/si/f0/oqsif0ek7f1-w4f4lguvp_eun20.png"></p><br><p>  рдЪреВрдБрдХрд┐ рд╣рдо рдЖрдорддреМрд░ рдкрд░ <code>UIView</code> рдкрджрд╛рдиреБрдХреНрд░рдо рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╡рд┐рд╡рд░рдг <code>UIView</code> рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдЖрдЧреЗ рдмрдврд╝реЗрдЧрд╛ред </p><br><p>  <a href="https://developer.apple.com/documentation/uikit/uiview/1622601-setneedslayout"><code>setNeedsLayout</code></a> рджреМрд░рд╛рди, <a href="https://developer.apple.com/documentation/uikit/uiview/1622601-setneedslayout"><code>setNeedsLayout</code></a> рдХреЗ рд╕рд╛рде рдЪрд┐рд╣реНрдирд┐рдд рд╕рднреА <code>UIView</code> рдХреЗ рд▓реЗрдЖрдЙрдЯ <a href="https://developer.apple.com/documentation/uikit/uiview/1622601-setneedslayout"><code>setNeedsLayout</code></a> ред  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдПрдХ рдмрд╛рд░ рдлрд┐рд░ рд╣рдо рдЦреБрдж <a href="https://developer.apple.com/documentation/uikit/uiview/1622507-layoutifneeded"><code>layoutIfNeeded</code></a> рдЕрдВрджрд░ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЙрдирдХреЗ рдЧрд╛рд░рдВрдЯреАрдХреГрдд рдЖрд╕реНрдердЧрд┐рдд рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдХрд╛рд░рдг <a href="https://developer.apple.com/documentation/uikit/uiview/1622507-layoutifneeded"><code>layoutIfNeeded</code></a> рдпрд╛ <a href="https://developer.apple.com/documentation/uikit/uiview/1622507-layoutifneeded"><code>layoutIfNeeded</code></a> рдирд╣реАрдВ рдХрд╣рддреЗ рд╣реИрдВред  рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЕрдЧрд░ рдПрдХ рд▓реЗрди-рджреЗрди рдореЗрдВ ( <code>setNeedsLayout</code> рдФрд░ <code>setNeedsLayout</code> рд▓рд┐рдП рдХреЙрд▓ рдХреЗ рдмреАрдЪ) рдЖрдк рдХрдИ рдмрд╛рд░ <code>frame</code> рдмрджрд▓рддреЗ рд╣реИрдВ рдФрд░ <code>setNeedsLayout</code> рдХреЙрд▓ <code>setNeedsLayout</code> , рддреЛ рдкреНрд░рддреНрдпреЗрдХ рдкрд░рд┐рд╡рд░реНрддрди рддреБрд░рдВрдд рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рдЕрдВрддрд┐рдо рдкрд░рд┐рд╡рд░реНрддрди рдХреЗрд╡рд▓ <code>CATransaction.commit</code> рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдкреНрд░рднрд╛рд╡реА рд╣реЛрдВрдЧреЗред  рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ <code>CALayer</code> рд╡рд┐рдзрд┐рдпрд╛рдБ: <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410946-setneedslayout%3Flanguage%3Dobjc"><code>setNeedsLayout</code></a> , <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410873-layoutifneeded%3Flanguage%3Dobjc"><code>layoutIfNeeded</code></a> рдФрд░ <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410873-layoutifneeded%3Flanguage%3Dobjc"><code>layoutIfNeeded</code></a> ред </p><br><p>  рдбреНрд░реЙрдЗрдВрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдорд╛рди рдЧреБрдЪреНрдЫрд╛ <a href="https://developer.apple.com/documentation/uikit/uiview/1622437-setneedsdisplay"><code>setNeedsDisplay</code></a> рдФрд░ <a href="https://developer.apple.com/documentation/uikit/uiview/1622437-setneedsdisplay"><code>setNeedsDisplay</code></a> рд╡рд┐рдзрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред  <code>CALayer</code> рдпрд╣ <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410855-setneedsdisplay"><code>setNeedsDisplay</code></a> , <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410813-displayifneeded"><code>displayIfNeeded</code></a> рдФрд░ <a href="https://developer.apple.com/documentation/quartzcore/calayerdelegate/2097262-draw"><code>drawLayer</code></a> ред  <code>CATransaction.commit</code> рдХрд┐рдП рдЧрдП рд╕рднреА рддрд░реАрдХреЛрдВ рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ рдЬреЛ <code>setNeedsDisplay</code> рдХреЗ рд╕рд╛рде рдЪрд┐рд╣реНрдирд┐рдд рд╣реИрдВред  рдЗрд╕ рдХрджрдо рдХреЛ рдХрднреА-рдХрднреА рдСрдлрд╕реНрдХреНрд░реАрди-рдбреНрд░рд╛рдЗрдВрдЧ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  <strong>рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ</strong> ред  рд╡рд┐рд╢рд┐рд╖реНрдЯрддрд╛ рдФрд░ рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП, <code>UITableView</code> : </p><br><pre> <code class="plaintext hljs"> ... // Layout UITableView.layoutSubviews() //  ,   .. ... // Offscreen drawing UITableView.drawRect() //    ...</code> </pre> <br><p>  UIKit <code>UICollectionView</code> <code>UITableView</code> / <code>UICollectionView</code> рдХрд╛ <code>UICollectionView</code> : рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред <code>willDisplayCell</code> : <code>willDisplayCell</code> рдкреНрд░рддрд┐рдирд┐рдзрд┐ <code>willDisplayCell</code> рдФрд░ рдЗрддрдиреЗ рдкрд░ред  <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410757-drawincontext%3Flanguage%3Dobjc"><code>drawInContext</code></a> рджреМрд░рд╛рди, <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410757-drawincontext%3Flanguage%3Dobjc"><code>drawInContext</code></a> -рдбреНрд░реЙрдЗрдВрдЧ рд╣реЛрддреА рд╣реИ: рд╕рднреА рд▓реЗрдпрд░реНрд╕ рдХреЗ <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410757-drawincontext%3Flanguage%3Dobjc"><code>drawInContext</code></a> рдореЗрдердбреНрд╕ рдпрд╛ <a href="https://developer.apple.com/documentation/uikit/uiview/1622437-setneedsdisplay"><code>setNeedsDisplay</code></a> рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рд╕рднреА <code>UIView</code> <a href="https://developer.apple.com/documentation/uikit/uiview/1622437-setneedsdisplay"><code>setNeedsDisplay</code></a> рдХреЛ <a href="https://developer.apple.com/documentation/uikit/uiview/1622437-setneedsdisplay"><code>setNeedsDisplay</code></a> ред  рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЬрдм рд╣рдо рдХреБрдЫ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдореБрдЦреНрдп рдзрд╛рдЧреЗ рдкрд░ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рд╣рдореЗрдВ рддрддреНрдХрд╛рд▓ рдПрдХ рдирдП рдлреНрд░реЗрдо рдХреЗ рд▓рд┐рдП рдкрд░рддреЛрдВ рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рдЗрд╕ рддрд░рд╣ рдХрд╛ рд╕рдорд╛рдзрд╛рди рдмрд╣реБрдд рдЕрдХреНрд╖рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </p><br><p>  <code>CATransaction.commit</code> рдореЗрдВ рдЖрдЧреЗ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ?  рд░реЗрдВрдбрд░ рдЯреНрд░реА рд░реЗрдВрдбрд░ рд╕рд░реНрд╡рд░ рдХреЛ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><h2 id="43-rendering-pipeline">  <strong>4.3ред</strong>  <strong>рд░реЗрдВрдбрд░рд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди</strong> </h2><br><p>  IOS рдореЗрдВ рдПрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдлреНрд░реЗрдо рдмрдирд╛рдиреЗ рдХреА рдкреВрд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдпрд╛рдж рдХрд░реЗрдВ (рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░реЗрдВ [WWDC 2014 рд╕рддреНрд░ 419ред iOS рдРрдк рдХреЗ рд▓рд┐рдП рдЙрдиреНрдирдд рдЧреНрд░рд╛рдлрд┐рдХреНрд╕ рдФрд░ рдПрдирд┐рдореЗрд╢рди): </p><br><p><img src="https://habrastorage.org/webt/wh/ac/dj/whacdjlwdz9p3yxk4q2lonad4ag.png"></p><br><p>  рдлреНрд░реЗрдо рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рди рдХреЗрд╡рд▓ рд╣рдорд╛рд░реЗ рдЖрд╡реЗрджрди рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИ - рдХреЛрд░ рдПрдиреАрдореЗрд╢рди рдПрдХ рдЕрд▓рдЧ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рднреА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рд░реЗрдВрдбрд░ рд╕рд░реНрд╡рд░ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  <strong>рдлреНрд░реЗрдо рдХреИрд╕реЗ рдмрдирддрд╛ рд╣реИред</strong>  рд╣рдо (рдпрд╛ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо) рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рд╡рд┐рд╡рд░рдг рдХреЗ рд╕рд╛рде рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдПрдХ рдирдпрд╛ рд▓реЗрдирджреЗрди ( <code>CATransaction</code> ) рдмрдирд╛рддреЗ рд╣реИрдВ, рдЗрд╕реЗ "рдкреНрд░рддрд┐рдмрджреНрдз" рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рд░реЗрдВрдбрд░ рд╕рд░реНрд╡рд░ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рд╕рдм рдХреБрдЫ, рдЖрд╡реЗрджрди рдкрдХреНрд╖ рдкрд░, рдХрд╛рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЕрдЧрд▓рд╛, рд░реЗрдВрдбрд░ рд╕рд░реНрд╡рд░ рд▓реЗрдирджреЗрди (рд░реЗрдВрдбрд░ рдЯреНрд░реА) рдХреЛ рдбреАрдХреЛрдб рдХрд░рддрд╛ рд╣реИ, рд╡реАрдбрд┐рдпреЛ рдЪрд┐рдк рдкрд░ рдЖрд╡рд╢реНрдпрдХ рдХрдорд╛рдВрдб рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рдПрдХ рдирдпрд╛ рдлреНрд░реЗрдо рдЦреАрдВрдЪрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╕реНрдХреНрд░реАрди рдкрд░ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИред </p><br><p>  рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ, рдлреНрд░реЗрдо рдмрдирд╛рддреЗ рд╕рдордп, рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд "рдорд▓реНрдЯреАрдереНрд░реЗрдбрд┐рдВрдЧ" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рд╕реНрдХреНрд░реАрди рд░рд┐рдлреНрд░реЗрд╢ рджрд░ 60 рдлреНрд░реЗрдо рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб рд╣реИ, рддреЛ рдПрдХ рдирдпрд╛ рдлреНрд░реЗрдо рдХреБрд▓ рдорд┐рд▓рд╛рдХрд░ 1/60 рдореЗрдВ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдПрдХ рд╕реЗрдХрдВрдб рдХреЗ 1/30 рдореЗрдВ рдмрдирддрд╛ рд╣реИред  рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдирдпрд╛ рдлрд╝реНрд░реЗрдо рддреИрдпрд╛рд░ рдХрд░ рд░рд╣рд╛ рд╣реИ, рд░реЗрдВрдбрд░ рд╕рд░реНрд╡рд░ рдЕрднреА рднреА рдкрд┐рдЫрд▓реЗ рдПрдХ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░ рд░рд╣рд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/vz/cp/oa/vzcpoae_zvhzw0zkhll1_tjuwwy.png"></p><br><p>  рдореЛрдЯреЗ рддреМрд░ рдкрд░, рд╕реНрдХреНрд░реАрди рдкрд░ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдлреНрд░реЗрдо рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХрд╛ рдХреБрд▓ рд╕рдордп рд▓реЗрдирджреЗрди рдХреЗ рдЧрдарди рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ 1/60 рд╕реЗрдХрдВрдб рдФрд░ рд▓реЗрдирджреЗрди рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рджреМрд░рд╛рди рд░реЗрдВрдбрд░ рд╕рд░реНрд╡рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ 1/60 рд╕реЗрдХрдВрдб рдХрд╛ рд╣реЛрддрд╛ рд╣реИред </p><br><p>  рдореИрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЯрд┐рдкреНрдкрдгреА рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ред  <strong>рд╣рдо рдЦреБрдж рдкрд░рддреЛрдВ рдХреА рдбреНрд░рд╛рдЗрдВрдЧ рдХреЛ рд╕рдорд╛рдирд╛рдВрддрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ</strong> рдФрд░ рдкреГрд╖реНрдарднреВрдорд┐ рд╕реНрдЯреНрд░реАрдо рдореЗрдВ <code>UIImage</code> / <code>CGImage</code> <a href="https://developer.apple.com/documentation/uikit/1623912-uigraphicsbeginimagecontextwitho">рдХреА</a> рд╕рд╛рдордЧреНрд░реА рдХреЛ <a href="https://developer.apple.com/documentation/uikit/1623912-uigraphicsbeginimagecontextwitho">рдкреНрд░рд╕реНрддреБрдд рдХрд░</a> рд╕рдХрддреЗ рд╣реИрдВред  рдЙрд╕рдХреЗ рдмрд╛рдж, рдореБрдЦреНрдп рдзрд╛рдЧреЗ рдореЗрдВ, рдЖрдкрдХреЛ рдмрдирд╛рдИ рдЧрдИ рдЫрд╡рд┐ рдХреЛ <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410773-contents"><code>CALayer.contents</code></a> рд╕рдВрдкрддреНрддрд┐ рдореЗрдВ рдЕрд╕рд╛рдЗрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИред  рдпрд╣ рдбреЗрд╡рд▓рдкрд░реНрд╕ рд╣реИ рдЬреЛ рдЗрд╕реЗ <a href="https://texturegroup.org/">рдмрдирд╛рд╡рдЯ рдХрд╛</a> рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдЪреВрдБрдХрд┐ рд╣рдо рдЕрдкрдиреЗ рдЖрд╡реЗрджрди рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд▓реЗрди-рджреЗрди рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреЗрд╡рд▓ <code>CALayer.contents</code> рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ 1/30 рд╕реЗрдХрдВрдб (рд░реЗрдВрдбрд░ рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рд░реЗрдВрдбрд░рд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ рд╕рдорд╛рдирд╛рдВрддрд░ рдФрд░ рдЦрд╛рддреЗ рдХреЗ рдЕрдиреБрдХреВрд▓рди рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП) рдПрдХ рдирдИ рдЫрд╡рд┐ рдмрдирд╛рдиреЗ рдФрд░ рд╕реНрдерд╛рдирд╛рдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ 60 рдлреНрд░реЗрдо рдкрд░ 1/60 рд╕реЗрдХрдВрдб рд╣реИрдВред )ред </p><br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд░реЗрдВрдбрд░ рд╕рд░реНрд╡рд░ рдЕрднреА рднреА рд╕рдореНрдорд┐рд╢реНрд░рдг (рдиреАрдЪреЗ рджреЗрдЦреЗрдВ) рдФрд░ рд╢реЙрд░реНрдЯ-рдЯрд░реНрдо рд▓реЗрдпрд░ рдХреИрд╢рд┐рдВрдЧ [iOS рдХреЛрд░ рдПрдирд┐рдореЗрд╢рди: рдПрдбрд╡рд╛рдВрд╕реНрдб рдЯреЗрдХреНрдиреАрдХреНрд╕ рдХреЛ рд╕рдВрднрд╛рд▓ рд╕рдХрддрд╛ рд╣реИред Nick Lockwood].        1/60      <code>CALayer.contents</code> ,         .     . </p><br><p> <em>:    ,     .</em> </p><br><h2 id="44-samye-uyazvimye-po-proizvoditelnosti-mesta"> <strong>4.4.     </strong> </h2><br><p> <strong>Main-thread</strong> </p><br><p><img src="https://habrastorage.org/webt/yt/c7/2n/ytc72nywgvqohz44yx_lsr9jhti.png"></p><br><p> <strong><em> 1.     ( <code>CATransaction.commit</code> )</em></strong> -   <code>UIView.layoutSubviews</code>     <code>UIView</code> (,  <code>CALayer</code> ).   ,         <code>layoutSubviews</code> / <code>cellForRow</code> / <code>willDisplayCell</code> . </p><br><p> <strong><em> 2.    <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410757-drawincontext%3Flanguage%3Dobjc"><code>drawInContext</code></a> / <a href="https://developer.apple.com/documentation/uikit/uiview/1622529-drawrect"><code>drawRect</code></a> .</em></strong>  -  Main-      ( <code>CATransaction.commit</code> ) тАФ  .                 ,    . </p><br><p> <strong><em> 3.     </em></strong> .          .        <code>CATransaction.commit</code> ,        ,  <a href="https://developer.apple.com/documentation/uikit/uiimage/1624092-draw"></a>    . </p><br><p> <strong><em> 4.   .</em></strong>                <code>UIImage</code> / <code>CGImage</code> . </p><br><p> <strong><em> 5.  </em></strong> .     Main-thread   ,     scroll.           -  ,       UI. </p><br><p> <strong><em> 6.    Main-.</em></strong>    , <code>RunLoop</code>  Main-   ,     ,   Main-.         . </p><br><p> <strong>GPU</strong> </p><br><p><img src="https://habrastorage.org/webt/xx/gl/cq/xxglcqd-3yjgmjsuxkppjbzbc38.png"></p><br><p> <strong><em>Blending</em></strong> .        GPU       (  Render Server       GPU,         ).   ,      ,      Background-. </p><br><p> <strong><em> </em></strong> . ,    <a href="https://developer.apple.com/documentation/uikit/uiblureffect"><code>UIBlurEffect</code></a> , <a href="https://developer.apple.com/documentation/uikit/uivibrancyeffect"><code>UIVibrancyEffect</code></a>    ,  ,    (Render Pass).      ,       ,    . </p><br><p> <strong>Offscreen rendering (Render Server)</strong> </p><br><p><img src="https://habrastorage.org/webt/zm/ru/b4/zmrub4eko8bdeelh2lbivcem8bi.png"></p><br><p> Render Server        .        , ,     : </p><br><ul><li> <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410818-cornerradius"><code>cornerRadius</code></a> тАФ  Render Server      ,         ; </li><li> <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410819-shadowradius"><code>shadowRadius</code></a> тАФ   Render Server    ,   ; </li><li> <a href="https://developer.apple.com/documentation/quartzcore/calayer/1410861-mask"><code>mask</code></a> тАФ        . </li></ul><br><p>    <code>CALayer</code> ,       ,    Offscreen rendering.    ,     <a href="https://developer.apple.com/documentation/uikit/uivisualeffect"><code>UIVisualEffect</code></a> (   ,     Render Server  CPU,   GPU). </p><br><p>  ,       . </p><br><hr><br><h1 id="5-instrumenty-izmereniy"> <strong>5.  </strong> </h1><br><p>    ,    ,    Time Profiler.   <a href="https://developer.apple.com/documentation/metal/using_metal_system_trace_in_instruments_to_profile_your_app">Metal System Trace</a> тАФ         Time Profiler    . </p><br><h2 id="51-metal-system-trace"> <strong>5.1. Metal System Trace</strong> </h2><br><p>  ,          ( ).   ,    : ,    . </p><br><p>  ,   Metal System Trace  ,           .     ,       Render Server.       ,      Main-,   тАФ ,     . </p><br><p><img src="https://habrastorage.org/webt/gy/pv/ay/gypvay-wwr1f0ldbjazina-ewtg.png"></p><br><p>      - ,   : </p><br><p><img src="https://habrastorage.org/webt/0r/af/6e/0raf6e-cvoukj_6jzt1o6frzjom.png"></p><br><p>  Metal System Trace   .     64- ,     iPhone 5s.  ,    <em></em>    .   , -   ,  ,          UI. </p><br><h2 id="52-fiksiruem-prosadki-proizvoditelnosti-v-kode-vo-vremya-raboty-prilozheniya"> <strong>5.2.         </strong> </h2><br><p>         . ,   - -  .         ,    <a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink"><code>CADisplayLink</code></a> . </p><br><p>   <code>CADisplayLink</code>   <a href="https://developer.apple.com/documentation/quartzcore/cadisplaylink/1621257-timestamp"><code>timestamp</code></a> тАФ     (    Render Server).         <code>CADisplayLink.timestamp</code>     <code>timestamp</code> .   ,          (, 1/60 )  : </p><br><pre> <code class="plaintext hljs"> //  CADisplayLink. link = [CADisplayLink displayLinkWithTarget:target selector:selector] [link addToRunLoop:[NSRunLoop mainRunLoop] forMode:UITrackingRunLoopMode] //    CADisplayLink : diff = prevTimestamp - link.timestamp if (diff &gt; 1/fps) { //  freeze } prevTimestamp = link.timestamp</code> </pre> <br><p> <code>CADisplayLink</code>   <a href="https://developer.apple.com/documentation/uikit/uitrackingrunloopmode%3Flanguage%3Dobjc"><code>UITrackingRunLoopMode</code></a> ,       . </p><br><p>     Rendering Pipeline: <br><img src="https://habrastorage.org/webt/yv/ca/t3/yvcat3yxparod3whs19qzwwjzhw.png"></p><br><p>      UI-,         .    ┬л┬╗     <code>freezeFrameTimeRate</code> : </p><br><pre> <code class="plaintext hljs">scrollTime //    Scroll freezeFrameTime //    ,  "",       freezeFrameTimeRate = freezeFrameTime / scrollTime</code> </pre> <br><p>  ,            -    <code>UIView</code> .   ,      ┬л┬╗: </p><br><p><img src="https://habrastorage.org/webt/ws/l7/tr/wsl7trcro6gr-t7ax-paqn_rxls.png"></p><br><p>  ,          ,    ┬л <code>UIView</code> ┬╗         .  рдХреНрдпреЛрдВ?   ,   . , ,      ,     : <code>CADisplayLink</code> ,       Render Server    <code>link.timetamp</code> ,    Render Server     ,      .   60     UI-,         Render Server.   Render Server      ,     . </p><br><p>  ,     ,   ,  Render Server    .    <a href="https://developer.apple.com/documentation/metal/mtlcommandbuffer/1442997-addcompletedhandler%3Flanguage%3Dobjc">Metal</a> ,        Render Server. ,  ,       iOS,   Render Server            . </p><br><h2 id="kak-issledovat-problemy-rekomendacii"> <strong>  . </strong> </h2><br><p>   ,   ,      .             ,        . </p><br><p> :   тАФ   !          тАФ        . </p><br><hr><br><h1 id="zaklyuchenie">  <strong>рдирд┐рд╖реНрдХрд░реНрд╖</strong> </h1><br><p>   тАФ               .    ,     ,      . </p><br><hr><br><h1 id="istochniki-informacii"> <strong> </strong> </h1><br><p>  ,        тАФ        .        ,   . </p><br><p>  ,        : </p><br><ol><li> <a href="https://developer.apple.com/documentation"> Apple</a> . </li><li> <a href="https://habr.com/ru/company/oleg-bunin/blog/437584/">    Auto Layout</a> . </li><li> <a href="https://constraints.cs.washington.edu/solvers/cassowary-tochi.pdf">The Cassowary Linear Arithmetic Constraint Solving Algorithm</a> . </li><li> iOS Core Animation: Advanced Techniques. Nick Lockwood. </li><li> WWDC 2014 Session 419. Advanced Graphics and Animations for iOS Apps. </li></ol><br><p><img src="https://habrastorage.org/webt/ij/vj/ex/ijvjexv2ppdy6bdkepcwbqk7wy8.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi481626/">https://habr.com/ru/post/hi481626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi481612/index.html">рдПрд╡рд░реЛрдирд┐рдпрд╛ рдпреВрдЖрдИ рдХреА рдлрд╛рдЗрдЯ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реА рдЫреЛрдЯреА рдпреЛрдЧрджрд╛рди</a></li>
<li><a href="../hi481616/index.html">рдЬрд┐рдпреЛрдбреЗрд╕рд┐рдХ рдЧреБрдВрдмрджред рдбрд┐рд╡рд╛рдЗрд╕ рдФрд░ рдЧрдгрдирд╛ рдХреЗ рдореЗрд░реЗ рдЕрдиреБрднрд╡ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ</a></li>
<li><a href="../hi481618/index.html">рдПрдХрддрд╛ рдореЗрдВ рдПрдорд╡реАрдкреА рдпрд╛ рдЬреАрд╡рди рдХреЛ рдХреИрд╕реЗ рд╕рд░рд▓ рдмрдирд╛рдпрд╛ рдЬрд╛рдП</a></li>
<li><a href="../hi481620/index.html">рдЬреБрдирд┐рдкрд░ рдПрд╕рдЖрд░рдПрдХреНрд╕ рдФрд░ рд╕рд┐рд╕реНрдХреЛ рдПрдПрд╕рдП: рдЕрдЧрд▓реА рд╢реНрд░реГрдВрдЦрд▓рд╛</a></li>
<li><a href="../hi481624/index.html">Redux рдХреЗ рд╕рд╛рде рд╕рдВрдпреЛрдЬрди рдореЗрдВ рд╕реНрдкрдВрджрди рдкрд░ рдПрдХ рдЖрд╡реЗрджрди рдкрддреНрд░ рд▓рд┐рдЦрдирд╛</a></li>
<li><a href="../hi481628/index.html">рдкрд░реАрдХреНрд╖рдг рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЪрд░рдг рд▓рд┐рдЦрдиреЗ рдХреЗ рдирд┐рдпрдо</a></li>
<li><a href="../hi481630/index.html">2019 рдореЗрдВ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдХреЛ рд╕реНрдорд╛рд░реНрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЙрдкрдпреЛрдЧреА рдЙрдкрдХрд░рдг рдФрд░ рд╕рдВрд╕рд╛рдзрди</a></li>
<li><a href="../hi481632/index.html">рдХреНрд▓рд╛рдЙрдб рдкреНрд░рджрд╛рддрд╛: рдмрд╛рдЬрд╛рд░ рдореЗрдВ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдХреМрди рд╣реИ?</a></li>
<li><a href="../hi481634/index.html">рдлреВрдб рдбрд┐рдЬрд╛рдЗрди рдбрд╛рдЗрдЬреЗрд╕реНрдЯ, рдирд╡рдВрдмрд░ 2019</a></li>
<li><a href="../hi481638/index.html">рдХреНрдпреЛрдВ рдЬрдЯрд┐рд▓ рдЙрддреНрдкрд╛рджрди рдХреЗ 3 рдбреА рдореЙрдбрд▓ рдЙрдкрдпреЛрдЧреА рд╣реИрдВ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>