<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤷 🕧 🛠️ 从Hydra会议解析任务-负载平衡和内存中存储 🈁 💖 👵🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="几天前举行了一次九头蛇会议 。 JUG.ru集团的成员邀请了梦想中的演讲者（莱斯莉·兰普波特！克里夫·喀特！马丁·克莱普曼！），并花了两天时间致力于分布式系统和计算。 Contour是三个会议合作伙伴之一。 我们在展台上交谈，谈论了我们的分布式存储设施，玩了宾果游戏，解决了问题。 


 这是一篇文...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>从Hydra会议解析任务-负载平衡和内存中存储</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skbkontur/blog/459958/"><p> 几天前<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">举行</a>了一次<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">九头蛇会议</a> 。  JUG.ru集团的成员邀请了梦想中的演讲者（莱斯莉·兰普波特！克里夫·喀特！马丁·克莱普曼！），并花了两天时间致力于分布式系统和计算。  Contour是三个会议合作伙伴之一。 我们在展台上交谈，谈论了我们的分布式存储设施，玩了宾果游戏，解决了问题。 </p><br><p> 这是一篇文章，作者分析了Contour展位上的任务。 谁在Hydra上是您回想令人愉快的印象的原因，而谁却不是-可以使您的大脑<em>大张O</em>标记的机会。 </p><br><p> 甚至有参与者将活动挂图分解成幻灯片以记录他们的决定。 我不是在开玩笑-他们交出了这张纸以供检查： </p><br><p><img src="https://habrastorage.org/webt/6k/m8/59/6km859kxtxuu_21czx2sn-l5do0.jpeg"></p><br><p> 总共有三项任务： </p><br><ul><li> 选择用于权重的副本以实现负载平衡 </li><li> 有关将查询结果排序到内存数据库的信息 </li><li> 环形拓扑的分布式系统中的状态转移 </li></ul><a name="habracut"></a><br><h1 id="zadacha-1-clusterclient"> 任务1. ClusterClient </h1><br><p> 有必要提出一种从分布式系统的N个加权副本中有效选择K的算法： </p><br><blockquote> 您的团队的任务是为大型分布式N节点集群开发客户端库。 库将跟踪与节点关联的各种元数据（例如，它们的延迟，4xx / 5xx响应率等​​），并为它们分配浮点权重W <sub>1</sub> ..W <sub>N。</sub> 为了支持并发执行策略，库应该能够随机选择K个N个节点-被选择的机会应与节点的权重成正比。 <br><br> 提出一种有效选择节点的算法。 使用大O表示法估算其计算复杂度。 </blockquote><br><div class="spoiler">  <b class="spoiler_title">为什么一切都是英文的？</b> <div class="spoiler_text"><p> 因为以这种形式，会议的参加者与他们抗争，并且因为英语是九头蛇的官方语言。 任务如下所示： </p><br><p><img src="https://habrastorage.org/webt/to/5s/0a/to5s0amsnoyj1q_hxhl0z3gczzy.png"></p></div></div><br><p> 带上纸和笔，想一想，不要着急立即打开扰流板:) </p><br><div class="spoiler">  <b class="spoiler_title">汇报（视频）</b> <div class="spoiler_text"><p> 从5:53开始，仅需4分钟： </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/HAiQ2llS0bE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p> 那些拿着活动挂图的家伙如何提出他们的决定： </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/U_yfKDwXppg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><div class="spoiler">  <b class="spoiler_title">决策分析（文本）</b> <div class="spoiler_text"><p>从表面上看，有一个解决方案：对所有副本的权重求和，生成一个从0到所有权重之和的随机数，然后选择一个i副本，以使从0到第（i-1）的副本权重之和小于随机数，并且副本权重之和从0到第i-大于它。 结果是选择一个副本，然后选择下一个副本，您需要重复整个过程而不考虑所选副本。 使用这种算法，选择一个副本的复杂度为O（N），选择K个副本的复杂度为O（N·K）〜O（N <sup>2</sup> ）。 </p><br><p><img src="https://habrastorage.org/webt/cq/1w/hg/cq1whgt1skw7dcwo3ck7wh6rbto.png"></p><br><p> 二次复杂度不好，但是可以改善。 为此，为权重之和构建一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">分段树</a> 。 这将产生一棵深度为N的树，在树的叶子中将有复制权重，而在其余节点中，将是部分和，直至树根中所有权重的和。 接下来，我们生成一个从0到所有权重之和的随机数，找到第i个副本，将其从树中删除，然后重复该过程以搜索剩余的副本。 使用这种算法，构造树的复杂度为O（N），找到第i个副本并将其从树中删除的复杂度为O（log N），选择K个副本的复杂度为O（N + K log N）〜O（N log N） 。 </p><br><p><img src="https://habrastorage.org/webt/u-/23/tx/u-23txhrw-1dl14qilobw3laro4.png"></p><br><p> 线性对数复杂度比二次复杂度好，尤其是对于大K而言。 </p><br><p> 该算法在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Vostok</a>项目的ClusterClient库<a href="">的代码中实现</a> 。 </p></div></div><br><h1 id="zadacha-2-zebra"> 任务2.斑马 </h1><br><p> 有必要提出一种算法，用于通过任意非索引字段对内存中的文档进行有效排序： </p><br><blockquote> 您的团队的任务是开发内存中的分片文档数据库。 常见的工作是从大小为M（通常N &lt;100 &lt;&lt; M）的集合中选择按任意（非索引）数字字段排序的前N个文档。 较少的常见工作量是在跳过前S个文档（S〜N）之后选择前N个。 <br><br> 提出一种算法来有效执行此类查询。 在平均情况和最坏情况下，使用大O表示法估算其计算复杂度。 </blockquote><br><div class="spoiler">  <b class="spoiler_title">汇报（视频）</b> <div class="spoiler_text"><p> 从34:50开始，仅需6分钟： </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/HAiQ2llS0bE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><div class="spoiler">  <b class="spoiler_title">决策分析（文本）</b> <div class="spoiler_text"><p> 解决方案是表面上的：对所有文档进行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">排序</a> （例如，使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">quicksort</a> ），然后获取N + S个文档。 在这种情况下，平均排序的复杂度为O（M lg M），最差的情况为-O（M <sup>2</sup> ）。 </p><br><p> 显然，对所有M个文档进行排序以仅获取其中的一小部分效率低下。 为了不对所有文档进行排序，使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">quickselect</a>算法是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">合适的</a> ，该算法选择N + S个必需的文档（它们可以通过任何算法进行排序）。 在这种情况下，复杂度平均降低到O（M），最坏的情况保持不变。 </p><br><p> 但是，您可以更加有效地进行操作-使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">二进制堆流</a>算法。 在这种情况下，将前N + S个文档添加到最小或最大堆中（取决于排序方向），然后将每个后续文档与树的根进行比较，该树的根包含当前的最小或最大文档，并在必要时添加到树中。 在这种情况下，最坏情况下的复杂度是必须不断重建树-O（M lg（N + S）），与快速选择一样，平均复杂度为O（M）。 </p><br><p> 但是，由于实际上在与根元素进行一次比较之后，实际上可以丢弃大多数文档而无需重建堆，因此堆流更为有效。 这种分类是在电路中开发和使用的Zebra文档内存数据库中实现的。 </p></div></div><br><h1 id="zadacha-3-state-swaps"> 任务3.状态交换 </h1><br><p> 有必要提出一种最有效的状态转移算法： </p><br><blockquote> 您的团队的任务是为N个节点的分布式集群开发一种幻想状态交换机制。 第i个节点的状态应传输到第（i + 1）个节点，第N个节点的状态应传输到第一个节点。 当两个节点原子交换其状态时，唯一支持的操作是状态交换。 已知状态交换需要M毫秒。 每个节点都可以在任何给定时刻参与单个状态交换。 <br><br> 转移集群中所有节点的状态需要多长时间？ </blockquote><br><div class="spoiler">  <b class="spoiler_title">决策分析（文本）</b> <div class="spoiler_text"><p> 表面上的解决方案：交换第一个和第二个元素的状态，然后交换第一个和第三个元素的状态，然后交换第一个和第四个元素的状态，依此类推。 每次交换后，一个元素的状态将处于所需位置。 您必须进行O（N）个排列并花费O（N·M）时间。 </p><br><p><img src="https://habrastorage.org/webt/lx/f6/8p/lxf68pgl8xz2tqhhc58r_1m03y4.png"></p><br><p> 线性时间很长，因此您可以成对交换元素的状态：第一个与第二个交换，第三个与第四个交换，依此类推。 每次交换后，每个第二元素的状态将处于所需位置。 我们将不得不进行O（对数N）的排列，并花费O（对数N N）的时间。 </p><br><p><img src="https://habrastorage.org/webt/mm/5n/jq/mm5njqmglg6ma2nlrkxsd14coeu.png"></p><br><p> 但是，您可以使转换更加有效-不是线性的，而是恒定的时间。 为此，在第一步中，您需要将第一个元素的状态与最后一个交换，将第二个元素的倒数第二个交换，依此类推。 最后一个元素的状态将处于所需位置。 现在，您需要与第二个元素交换第二个元素的状态，与倒数第二个交换第三个元素的状态，依此类推。 经过这一轮的交换，所有元素的状态将处于正确的位置。 总共将进行O（2M）〜O（1）个排列。 </p><br><p><img src="https://habrastorage.org/webt/ul/gz/os/ulgzosuwmplrlvpyxh_1fh7fndg.png"></p><br><p> 这样的解决方案不会令数学家感到惊讶，他仍然记得旋转是两个轴向对称的组合。 顺便说一句，一般来说，它不移位1，而是移位K &lt;N个位置。  （在注释中确切写出方法。） </p></div></div><br><p> 你喜欢拼图吗？ 您知道其他解决方案吗？ 分享评论。 </p><br><p> 最后是一些有用的链接： </p><br><ul><li> 了解有关Circuit的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">基础设施开发的</a>更多信息 </li><li> 查看内部<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">传单的</a>记录以及有关分布式系统的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">报告</a> </li><li> 观看视频讲座系列“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">普通人的不寻常算法</a> ” </li><li> 订阅我们<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的电报频道</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN459958/">https://habr.com/ru/post/zh-CN459958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN459936/index.html">使用Visual Studio的9种技巧</a></li>
<li><a href="../zh-CN459948/index.html">像Horizo​​n Zero Dawn一样实现物理上正确的体积云</a></li>
<li><a href="../zh-CN459952/index.html">关于备份和存储的一点经验</a></li>
<li><a href="../zh-CN459954/index.html">为什么最大的IT公司之一加入CNCF-开发云基础架构的基金</a></li>
<li><a href="../zh-CN459956/index.html">由于不及时去看牙医而导致牙齿完全没有植入</a></li>
<li><a href="../zh-CN459960/index.html">从构思到发布。 详细的市场前端经验</a></li>
<li><a href="../zh-CN459964/index.html">8种简单的UI技巧，无需借助动画即可使原型设计动态化</a></li>
<li><a href="../zh-CN459968/index.html">失踪的马来西亚波音公司真正发生了什么（第3/3部分）</a></li>
<li><a href="../zh-CN459970/index.html">承诺全部解决</a></li>
<li><a href="../zh-CN459972/index.html">Docker开发。 当地环境。 第一部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>