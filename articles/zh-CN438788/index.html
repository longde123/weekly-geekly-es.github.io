<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛐 👰🏿 😓 服务器机房中的环境监控（Bolid + Zabbix） 🗞️ ➖ 🕺🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="对于IT专业人员来说，解决服务器机房中环境监控问题的最简单方法可能是使用具有SNMP输出的专用控制器（例如，NetBotz或NetPing）。 但是对于那些不惧怕困难并希望获得工业级廉价解决方案（通过批量生产设备）的人来说，Modbus协议有一个有趣的选择。 



 下面，我将描述基于俄罗斯制造的...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>服务器机房中的环境监控（Bolid + Zabbix）</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438788/"> 对于IT专业人员来说，解决服务器机房中环境监控问题的最简单方法可能是使用具有SNMP输出的专用控制器（例如，NetBotz或NetPing）。 但是对于那些不惧怕困难并希望获得工业级廉价解决方案（通过批量生产设备）的人来说，Modbus协议有一个有趣的选择。 <br><br><img src="https://habrastorage.org/webt/wu/uc/mi/wuucmi1fiyi7sglvrsekrvey0pk.png"><br><a name="habracut"></a><br> 下面，我将描述基于俄罗斯制造的组件-NVP Bolid的监视系统，我们将“合并” Zabbix 4.0中的数据。  NVP“ Bolid”在消防自动化设备领域广为人知，经过考虑的解决方案将带有这种“烙印”。 坦率地说，他们的装置在外壳的设计和周到性上没有什么不同，但是……价格足以弥补所有这些缺点。 值得注意的是非常好的文档以及或多或少的常规免费技术支持。 <br><br><h2> 协议和接口 </h2><br> 在继续使用硬件之前，我们将简要介绍所使用的协议和接口： <br><br>  <b>Modbus</b> ：一种基于“主站”-“从站”原理的工业协议。  Modbus网络上只能有一个主站，它轮询从站并“告诉”该做什么。 作为传输介质，它可以使用RS-485（Modbus RTU）或以太网（Modbus TCP）接口。 理论上，最大设备数为247。 <br><br>  <b>Orion</b> ：NVP“ Bolid”公司的专有协议，建立在“ Master”（主）-“ Slave”（从）的原则上。 显然，修改后的RS-485接口用作数据传输介质，因此最大线路长度可以达到3 km（！）。 设备的最大数量为127。 <br><br>  <b>DLS</b> （两线通信线）：NVP“ Bolid”公司的专有协议，建立在“主”-“从”（主）的原则上。 它使用铜对电缆作为数据传输介质（建议使用双绞电缆）。 设备的最大数量为127 + 1。 拓扑-带有分支的总线（或环形），最大线路长度可以达到1.5 km（取决于电缆的类型，电缆导体的横截面和所连接设备的数量）。 <br><br>  <b>RS-485</b> ：物理层接口，使用“双绞线”（一对“ 2线”或两对“ 4线”对进行数据传输，第二个不常见）。 声明的最大线长为1.2公里。 拓扑是公共汽车。 <br><br> 如您所见，使用了相当“远程”的通信线路。 在所有协议中，设备寻址都由“句柄”（预配置）设置。 <br><br><h2> 感测器 </h2><br> 该系统涉及连接“专用”（专有）地址传感器（更严格地说是“检测器”，即具有内置传感器的设备），但是您也可以使用地址扩展器（1至8个输入）连接“普通”非地址。 可寻址检测器的使用具有两个优点：几乎所有可寻址设备都通过信号线接收电源（即，不必提供单独的12V电源线），也不需要将地址扩展器放在任何地方。 传感器连接到<abbr title="两线通讯线">DPS</abbr> 。 <br>  “终端”设备的范围非常广泛，但是我将给出解决我们的问题时可能需要的设备： <br><br><ul><li>  S2000-VT-室内温度和湿度组合传感器（IP41）。 拥有测量仪器证书，误差仅为0.5°C，建议零售价仅为1200卢布！ </li><li>  S2000-SM​​K（及其变型）-“开门”传感器（电磁接触检测器，簧片开关）。 建议零售价-300卢布。 </li><li>  S2000-DZ-点淹没传感器（与Realty一起完成，因此是“未格式化”）。 建议零售价-800卢布。 </li><li>  2000-1，2000-2，2000-8-用于1、2和8连接的地址扩展器，可用作其他设备（例如，灭火设备）“干触点”类型信号（开/关）的“接收器”或空调泵）； </li><li>  S2000-SP2-继电器块（用于2个输出），可用于控制设备（例如，警报灯-指示灯）。 建议零售价-1200卢布。 </li></ul><br><div class="spoiler">  <b class="spoiler_title">传感器外观</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wy/ff/2k/wyff2kk8bfwz0bcq5feyh-kvja4.png"><br><br></div></div><br> 有关设备的完整列表，请参见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">制造商</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">官方网站</a> 。 <br><br><h2> 控制者 </h2><br> 我可以这么说，控制器的“线”由三个模型组成： <br><br><ul><li>  S2000-KDL-基本模型（名称代表“ System 2000-两线通信线的控制器”）； </li><li>  S2000-KDL-2I-为RS-485和DPS增加了电流隔离； </li><li>  S2000-KDL-Modbus-S2000-KDL-2I设计中已添加Modbus S2000-PP协议转换器。 </li></ul><br><div class="spoiler">  <b class="spoiler_title">控制器的外观</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gw/wu/nb/gwwunbbgi8jsdrp4lirdesxxoyi.png"><br></div></div><br> 最好使用S2000-KDL-Modbus，但也可以将S2000-KDL / C2000-KDL-2I与附近安装了S2000-PP协议转换器并采用面板安装式外壳的设计一起使用。 <br><br> 控制器在<abbr title="两线通讯线">DLS</abbr>线路中扮演“领导者”的角色（只能将一条DPS线路连接到一个控制器），在RS-485 Orion线路上，它已经充当“从属”，并且将无法“直接”从其收集数据。 为了在RS-485 Orion线路中收集数据，使用了所谓的2000或2000-控制台（包括内置版本），这些控制台已经标准化了数据传输接口。 <br><br> 以下控制器还可以区分以下特征： <br><br><ul><li> 指的是可配置的类型，而不是可编程的类型（即，您只需要配置参数，而无需开发程序）； </li><li> 在<abbr title="两线通讯线">DPS中</abbr>最多支持127个可寻址设备（S2000-VT有两个地址），许多专员不建议使用100-110以上的设备； </li><li> 电源DC 12-24V的双输入; </li><li> 不太方便的外壳设计（所有连接的导线都不能隐藏在设备外壳中，您必须将它们从设备背面卸下）。 </li></ul><br> 对于系统容错，您可以使用以下措施（可选）： <br><br><ul><li> 环形环路-一处出现环路中断不会影响可寻址传感器发出的信号； </li><li> 使用分支隔离块（BRIZ）-允许您进行径向分支，并隔离其中存在短路“ DPS +”和“ DPS-”的环路段。 </li></ul><br> 重要信息：控制器不断推出新的固件，以消除错误并增加功能，并且C2000-KDL和C2000-KDL-2I固件不兼容。 <br><br><h2>  Modbus连接 </h2><br> 如前所述，可以使用C2000-Modbus控制器或C2000-PP转换器。 两种方案均使用Modbus RTU 2线协议（使用RS-485作为从设备）来发出信号（我们的主机是Zabbix或某些SCADA系统）。 可以使用两种方法连接到服务器： <br><br><ul><li> 首选-Modbus RTU / Modbus TCP转换器，可连接到我们装有软件的服务器所在的本地网络； </li><li> 便宜-带直接连接到服务器的RS-485 / USB转换器。 我注意到有很多关于这些USB记忆棒可靠性的抱怨（您几乎可以接受，我从中国订购了100卢布，使用了一堆RS-232 / RS-485转换器和一个USB / RS-232适配器，并且一切继续进行！） </li></ul><br> 可以使用两种方案将事件传输到Modbus协议： <br><br><ul><li> 当这些设备在“ Orion-Master”模式（由板上的跳线选择）下运行并充当“ Orion”系统的询问器时，直接从2000-/C2000--Modbus获得。 </li><li> 使用“ S2000M”遥控器时，它会从控制器收集信息，然后才通过C2000-/C2000--Modbus（“猎户模式”从属模式）将其发送到Modbus。 该方案的优点在于，可以将远程终端用作“本地终端”（请参阅​​内置LCD屏幕上的事件），并且在服务器发生故障时，可以使用监视软件继续记录事件。 缺点：设置稍微复杂一点，并且遥控器具有非常特定的外观。 </li></ul><br><div class="spoiler">  <b class="spoiler_title">系统电路示例</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/u6/se/lr/u6selr6hievry0qlrqy77naclpm.png"><br><br><img src="https://habrastorage.org/webt/lr/mr/ny/lrmrnydyc3k7okcrwtfinacdvj8.png"><br><br><img src="https://habrastorage.org/webt/fz/hb/gf/fzhbgfqp5l5crnlkazfbvabmemg.png"><br></div></div><br><h2> 电源和安装 </h2><br> 对于电源，需要12V直流电源，最好稳定并安装在DIN导轨上。 可以从1个控制器-500 mA的计算中大致选择其功率（通常以mA或A表示）。 我建议仅在使用S2000M遥控器时才使用冗余电源（带内置电池，RIP）。 并确保将电源连接到与监视系统服务器相同的不间断电源（UPS）。 <br><br> 当然，您可以将所有这些安装在墙上，但留给火警和安全警报安装人员使用，我们将使用3U DIN导轨将其安装在19英寸的机壳中（例如，PSM-3U或Cabeus CMO与同一物品一起使用，您必须扔掉前面板）。在使用S2000-M遥控器的情况下，可以使用19英寸4U插头（最好是带孔的），该插头将用作安装面板，并且端子和控制器的DIN导轨已经固定在该插头上。 减去决定-设备代表安装19英寸飞机。 <br><br> 组装和安装组件系统不会引起任何问题，但我提请注意以下几点： <br><br><ul><li> 大多数传感器都有一小段突出的电缆。 要增加电缆的长度，可以使用具有热收缩作用的焊料，也可以使用两对摆动盒KS-2（紧凑型，但是做工是“ lam缝”），或者使用RJ11（RJ45）连接； </li><li> 在安装传感器之前，必须先注册它们的地址（如下所述）并标记； </li><li> 连接传感器时，必须注意“ DLS +”和“ DLS-”的极性（请参阅文档-DLS +具有什么颜色，通常是彩色的）-如果将其混合，则系统中将不会检测到传感器。 </li></ul><br> 对于那些不想焊接但想要挤压“芯片”的人，可以使用下面描述的选项（可能比RJ11更好-以便不将DPS线路意外地连接到服务器）。 <br><br> 要求： <br><br><ul><li> 双绞线2对，无屏蔽； </li><li>  RJ11连接器（6P4C或6P6C）的“袋”； </li><li> 带插座型输入的RJ11分配器（价格合理的多种选择）。 </li></ul><br> 在一对上，我们启动DPS，在另一对上，例如12V DC。 通过分离器连接传感器。 <br><br><div class="spoiler">  <b class="spoiler_title">解释图片</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xf/v-/93/xfv-93ihmj39n_uhdyhhlqidgjg.png"><br></div></div><br><h2> 组装架 </h2><br> 在“实用”部分，组装了一个支架，其中包括： <br><br><ul><li>  NVP Bolid制造的协议转换器C2000-PP； </li><li>  NVP“ Bolid”生产的控制器S2000-KDL； </li><li>  NVP Bolid制造的温湿度计（组合式温湿度传感器）C2000-VT； </li><li>  NVP“ Bolid”制造的磁接触检测器S2000-SM​​K； </li><li>  Rielta制造的点泄漏传感器S2000-DZ； </li><li> 地址扩展器S2000-AP1 isp。  02生产NVP“ Bolid”； </li><li>  “ Rielta”制造的体积检测器Photon-10M（如“堆”）； </li><li>  AccordTec生产的12V-AT / 12 / 1.5 DIN电源单元; </li><li> 在<a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">速卖通</a>上购买的RS-485 / USB适配器（在常见的CH340G芯片上，Linux将其定义为“ QinHeng Electronics HL-340 USB串行适配器”）。 该系统如何以最便宜的配置工作变得很有趣。 </li><li> 来自TONK集团公司的TONK 1811瘦客户机（在avito上以500卢布的价格购买）在具有集成GMA950图形的Intel Atom N270处理器上。 </li></ul><br><img src="https://habrastorage.org/webt/6b/kr/ed/6bkred606ln2axp3wlcrztumlly.png"><br><br><div class="spoiler">  <b class="spoiler_title">完善瘦客户机和支架的外观</b> <div class="spoiler_text"> 瘦客户机有点“完成”： <br><br><ul><li> 安装了Windows XP嵌入式系统的2GB DOM模块已由旧笔记本电脑中的2.5个ATA 60GB HDD取代（我不得不购买电缆，由于某些原因SATA-HDD无法启动-它在BIOS中包括了SATA端口）； </li><li>  DDR2 SO-DIMM RAM从1GB增加到2GB； </li><li> 安装了Linux Mint 19.1“ Tessa” Xfce Edition，并使用TightVNC配置了远程桌面； </li><li> 冷却系统经过“精制”-减少了散热片，因此HDD几乎可以与外壳“齐平”，卸下顶盖，并在顶部“增加”一些通过电阻连接的120毫米风扇。 立刻所有的“刹车”消失了，工作变得非常合理。 </li></ul><br><br><img src="https://habrastorage.org/webt/ct/ri/5v/ctri5vgqehkummqppp22cd3k2uw.jpeg"><br></div></div><br><h2> 配置Bolid设备 </h2><br> 所有设置都在Windows环境中进行；因此，在开始工作之前，您需要在RS-485 / USB适配器上安装驱动程序，以及NVP Bolid上的两个“超级”程序，这些程序是免费提供的： <strong>Orion-prog</strong>和<strong>Uprog</strong> 。 此外，设备分别通过RS-485 / USB适配器连接到Orion AB的RS-485端口（使用直接布局，与COM端口不同）。 <br><br> 重要说明：在S2000-PP上执行所有后续步骤后，必须卸下板上的XP1跳线。 <br><br> 步骤1.将RS-485 / USB适配器插入USB接口，然后在设备管理器中查看为适配器分配了COM端口号的设备。 适配器的驱动程序必须在“设备管理器”中安装，而不带有感叹号。 <br><br> 步骤2.代表管理员，运行Orion-prog，选择所需的COM端口并执行搜索，以查看设备的固件版本。 请访问制造商的官方网站，并检查是否有更新的固件，并在必要时（很可能是必需的）进行更新（在撰写本文时：S2000-PP为1.32，S2000-KDL为2.22）。 <br><br><div class="spoiler">  <b class="spoiler_title">图片中的仪器固件</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/6i/lm/py/6ilmpyshwlwgygxsep6myrt-yzm.gif"><br></div></div><br>  *实际上是固件1.32，我是“弯曲地”安装的-在Uprog中，未从设备读取配置。 因此，它“回滚”到1.31。 <br><br> 步骤3.设置设备的地址（首先使用S2000-PP，例如2，然后使用S2000-KDL-3）。 为此，请运行Uprog-所有设备的默认地址均为127，因此您需要一次在起始设备上进行配置。 有关制造商的详细视频，请访问<a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">YouTube</a> 。 <br><br> 步骤4.在S2000-KDL上设置地址后，有必要在两线通信线（DLS）中设置传感器的地址。 它们还具有默认地址127（并且Uprog中带有传感器的圆圈未突出显示）。 我们读取设备的配置（Ctrl + F3），然后将传感器顺序连接到DLS的输出，设置地址。 在上下文菜单“请求AU类型”中指向传感器时，可以指定传感器的类型或“对ADC AU的请求”-查找传感器是否正常工作（例如，对于ADC的磁接触检测器，关闭时：100，打开时：50）。 实际上，我具有以下地址配置：1-C2000-SM​​K簧片开关，2-C2000-VT温度，3-C2000-VT湿度，4-C2000-DZ泄漏，5-C2000-AP1地址扩展器isp。  02（已连接Photon-10M体积检测器）。 <br><br><div class="spoiler">  <b class="spoiler_title">寻址图片中的传感器</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j9/vo/dk/j9vodkzjmmydzvrsk377m3zinok.gif"><br></div></div><br> 接下来，转到“输入”选项卡并执行以下操作： <br><br><ul><li> 指示传感器的类型：温度-10，湿度测量-15，所有其他传感器-6（技术）； </li><li> 对于技术输入，我们设置“恢复时间s”-这是环路在收到“违规”状态后将返回“正常”状态的时间。 必须指出至少Zabbix的轮询间隔数（我花了10秒）； </li><li> 为了简化设置，请关闭“ AU指示的控制”（0），“监视开路和短路”和“监视备用电池的状态”。 </li></ul><br><div class="spoiler">  <b class="spoiler_title">在图片中配置到S2000-KDL的输入</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/90/cn/68/90cn68wqswa16_nt7pqxzy830de.gif"><br></div></div><br> 用C2000-KDL完成所有“操作”后，我们执行“仪器中的配置记录”。 <br><br> 步骤5.配置S2000-PP。 <br> 在“设备”选项卡上，设置显示在图片中（这些是“运行”次数最多的设置，大多数设备默认使用这些设置）。  RS-485 / USB适配器的COM端口以及连接到Modbus网络的任何其他设备应具有相似的设置。 我为Modbus网络上的S2000-PP设备选择了地址11（Orion系统中的地址为2！）。 <br><br><img src="https://habrastorage.org/webt/ej/6y/31/ej6y31hxzfnze6nzx29rjcnsfwk.png"><br><br> 然后，我们转到“设备”选项卡并开始填写“区域表”： <br><br><ul><li> 我在第一列表示“ 3”-这是Orion系统中S2000-KDL设备的地址； </li><li> 警报回路号（“警报回路”）-这些是传感器的地址（实际上是警报回路=地址，如果我们不想从中获取信息，可以跳过几个地址）； </li><li>  Modbus部件号-您可以将我们的传感器分组。 为了简化-我没有这样做，而是将其归于每个人1部分； </li><li> 区域类型是一个非常重要的参数。 我们根据传感器的类型选择它。 </li></ul><br><img src="https://habrastorage.org/webt/8g/bo/ea/8gboea_ibzpk6nr04myidkbgtru.png"><br><br> 设置完S2000-PP之后，我们执行“仪器中的配置记录”。 <br><br> 步骤6.通过RS-485 Orion将C2000-PP和C2000-KDL组合成网络，将传感器连接到C2000-KDL（可以使用两个端子），然后将RS-485 / USB适配器连接到Modbus C2000-PP输出。 我们将XP1跳线设置为关闭位置（重要：安装跳线后，必须通过重置电源电压来重启设备）。 一切-系统已准备就绪。 <br><br> 我们在免费控制台程序<a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Modpoll Modbus Master Simulator</a> （以下称为“ Modpoll”）中检查“可操作性”，例如，在固件地址“ S2000-PP”或通过从S2000-KDL向“ 40000”发送信息-这是第一个传感器： <br><br><img src="https://habrastorage.org/webt/ij/hv/go/ijhvgoynxeyxwua5abdcgvapi3u.png"><br><br> 可以在<a href="">此处</a>下载“熟悉”固件。 <br><br><h2>  Zabbix设定 </h2><br>  <font color="red">警告：像Linux Mint一样，首次配置了Zabbix（因为Windows上没有Zabbix）：）</font> <br><br> 安装Zabbix之后，您需要安装软件包<i>autoconf</i> ， <i>automake</i> ， <i>libtool</i> ， <i>pkg-config</i> ，然后安装扩展模块<i>-libzbxmodbus</i> 。 在<a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Habré</a>上有另一篇关于他的文章（我会不断提及），并且最近已更新，仅用于Zabbix 4.0。 本文还提供了有关Modbus协议的更多详细信息。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该模块本身以及或多或少的详细说明在</font></font><a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与GitHub上指定的安装方式之间的微小差异：</font></font><br><br><pre><code class="plaintext hljs">... ./configure --prefix=/etc/zabbix --enable-zabbix-3.2 ... sudo make install</code> </pre> <br> 在研究<i>libzbxmodbus</i>模块的操作时， <i>很</i>明显不可能将方案与S2000M遥控器一起使用，因为在这种情况下，来自温湿度计的数据如下所示：在寄存器46179中写入所需区域的编号，然后从寄存器46328中收集数据-即 非常平凡的（例如，在“大型” SCADA系统中，可以在MasterSCADA中实现）。 <br><br> 在配置文件<i>etc / zabbix / zabbix_server.conf中，我们编写了扩展</i>链接，并使用Zabbix将硬件连接到服务器。 我不必安装用于RS-485 / USB适配器的驱动程序，但我仍然不明白如何确定要使用哪个USB编号，可以很好地连接到<i>/ dev / ttyUSB0</i> （您可以使用<i>lsusb</i>命令在系统中找到该设备）。 <br><br> 与Windows一样，我们使用Modpoll实用程序（我运行linux i386）检查是否已连接硬件，并且可以从中获取信息： <br><br><img src="https://habrastorage.org/webt/wn/8_/zz/wn8_zz98bldyf7hzc5zdkc90v80.png"><br><br> 由于本文使用Zabbix 2.2示例描述了配置过程-界面略有不同，因此我将提供设置的说明和图片。 <br><br><p> 步骤1.我们创建一个网络节点和一个将要包含我们的节点的组（例如，一个节点-“环境监控”和一个组-“工程基础架构”）： <br> 设置&gt;主机&gt;创建主机&gt;输入我们的名称&gt;添加 <br><br><img src="https://habrastorage.org/webt/vj/cd/fi/vjcdfibmwzvcm7vudrfubf4nuaa.png"><br><br> 步骤2.创建数据元素。 本文建议创建模板，但是由于我们的系统不包含重复的元素，因此我将跳过此步骤。 例如，如果我们有几台通过Modbus连接的空调，那么我们可以使用系统功能。 <br><br> 设置&gt;网络节点&gt;在包含我们节点“环境监控”名称的行中，单击“数据元素”&gt;，在出现的窗口中，单击“创建数据元素”。 <br><br> 我们开始“锤击”我们的传感器： <br><br><img src="https://habrastorage.org/webt/j_/ei/9n/j_ei9nphfowd7sgjp6r8u3r9xyk.png"><br><br> 细微差别： <br><br></p><ul><li> 本文使用了<em>“ modbus_read_registers”</em>函数的语法，并且根据GitHub的描述<em>“ modbus_read”</em> -第二个选项更短且有效； </li><li> 您可以用<em>/ dev / ttyUSB0</em>和“ <em>11</em> ”形式指定端口，而不是宏<em>{$ MODBUS_PORT}</em>和<em>{$ MODBUS_SLAVE}，</em>但是如果以后需要更改S2000-PP的USB端口或地址，将会<em>很不</em>方便； </li><li> 该文档指出，要请求S2000-PP上的区域状态（列“ Modbus区域号”），您必须联系：“注册地址40000 + M，其中M =（区域号–1）” –这是进度：“区域号。 <strong>负</strong> 1“ </li><li> 不要进行非常频繁的时间调查：S2000-PP开始返回“异常错误15”错误-设备没有时间准备数据（这通过设备上的指示器持续发光表示）； </li><li> 通过寄存器3000 -...获取温度和湿度数据 </li><li> 在“数据元素”窗口中，还有所需的“预处理”选项卡。 您可以在此处编辑“最后”显示的内容。 根据读数值获得温度和湿度，该值必须除以256：“用户系数”-0.0039（即1/256）； </li><li> 用于离散簧片开关，泄漏传感器等 您还需要使用“值显示”，这是由于提供信息的方式所致。 </li></ul><br><div class="spoiler">  <b class="spoiler_title">在图片中设置数据转换</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pj/g1/yr/pjg1yrlg-hfu83bgzuch6rke-xg.png"><br><br><img src="https://habrastorage.org/webt/k4/7o/hu/k47ohudcuf9ycomoxbdebii6kvu.png"><br></div></div><br> 有关轮询区域时如何提供数据的一些知识。 <br> 假设您收到的响应为十进制格式9148（D）。 我们将其转换为十六进制格式（HEX）：得到23BC-根据S2000-PP设备的说明，这是两个事件，代码分别为23（HEX）/ 35（D）和BC（HEX）/ 188（D）。 接下来，请参阅表5。“ Orion系统的事件列表（AL状态）”。 在其中找到35个“恢复技术输入”和188个“恢复与输入的通信”。 无需转换D-HEX-D，第一个事件是接收值除以256的整数部分，其余是第二个事件（ <strong>9148</strong> = <strong>35</strong> * 256 + <strong>188</strong> ）。 在采访技术投入时，我们只会选择第一个事件（优先级），“应该”采用状态35和36（“恢复技术投入”和“违反技术投入”）。 我们将使用数据元素设置“信息类型：数字（正整数）”丢弃小数部分（第二个事件）。 <br><br> 步骤3.填写端口宏和设备号： <br> 设置&gt;网络节点&gt;“环境监控”&gt;选择“宏” <br><br><img src="https://habrastorage.org/webt/h1/r-/qg/h1r-qgd4rrdym-txvbmnhsqwgre.png"><br><br> 步骤4.在控制面板上显示读数： <br> 开始屏幕&gt;所有面板，在出现的窗口中选择“创建面板”&gt;，设置“面板名称”和该面板可用的用户&gt;单击“创建新的小部件”&gt;键入“数据概述”，更新间隔“ 10秒”，组工程基础结构网络的节点&gt;添加&gt;调整面板大小，然后单击“保存更改”： <br><br><img src="https://habrastorage.org/webt/wl/ge/la/wlgelajwrwuuta5phssi2b5rx38.gif"><br><br><h2> 结论 </h2><br> 通过使用“远程”协议，所得的系统可以成为监视服务器和一对交叉办公区域（就监视温度和湿度条件而言）甚至小型数据中心的绝佳解决方案。 有人可能会说“ fu fu fu，汽车仍然令人作呕，您需要使用XXX（代替工业自动化中的某些东西）”也是一种选择，但我认为这将是非常多余的，而且也更昂贵。 还有一点细微差别：如您所见，Bolid上的系统非常简单（尽管逻辑有些奇怪），但是“完成”了舞会上的决定。 控制器-有时他仍然是个“黑子”。 <br><br>  PS：本文是对我博客上的两篇文章的改编： <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">对服务器机房的廉价监控（第1部分-入门）</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">对服务器机房进行廉价监控（第2部分-实用）</a> <br><br>  UPD 工作3天后，RS485-USB适配器脱落。 它被认为是不稳定的，但适合调试。 它被MOXA生产的单端口转换器MGate MB3170取代（取自现有产品），一切都变得稳定。 <br> 您需要了解，本文只是如何与Zabbix和Bolid“交朋友”的示例。 对于实际的实现，您可以添加更多受监视的DPS状态，例如负温度（它们的处理方式有所不同）。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN438788/">https://habr.com/ru/post/zh-CN438788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN438774/index.html">一切顺利。 LANIT博客关于哈布雷的最生动文章-2018</a></li>
<li><a href="../zh-CN438776/index.html">我的电报频道@pythonetc的提示和技巧，2019年1月</a></li>
<li><a href="../zh-CN438778/index.html">@Pythonetc 2019年1月</a></li>
<li><a href="../zh-CN438782/index.html">FSB建议发行俄罗斯SIM卡并使用5G的国内加密技术</a></li>
<li><a href="../zh-CN438784/index.html">使用Yandex.Metrica服务时遇到的问题</a></li>
<li><a href="../zh-CN438790/index.html">QuadrigaCX加密货币交易所不会捐出1.37亿美元，只有总监知道商店中的密码，他才去世</a></li>
<li><a href="../zh-CN438792/index.html">在VDI项目中使用AccelStor所有闪存阵列</a></li>
<li><a href="../zh-CN438794/index.html">JavaScript对象详细信息</a></li>
<li><a href="../zh-CN438796/index.html">学习Docker第1部分：基础</a></li>
<li><a href="../zh-CN438798/index.html">如何处理网络情报数据：我们学会收集和识别系统危害的指标</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>