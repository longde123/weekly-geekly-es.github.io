<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💝 👶🏾 🔪 内部剧本。 新的Ansible Engine 2.9中的网络功能 👨🏿‍🤝‍👨🏼 👩🏼‍🎤 👨‍👨‍👦‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="即将发布的Red Hat Ansible Engine 2.9版本正等待您进行令人印象深刻的改进，本文中对其中一些进行了描述。 与往常一样，我们在社区支持下公开开发了Ansible Network改进。 加入- 在GitHub上查看任务板，并在Ansible Network的Wiki页面上研究Red...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>内部剧本。 新的Ansible Engine 2.9中的网络功能</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/471896/"><p><img src="https://habrastorage.org/webt/db/2m/xd/db2mxdllzxasqtz4syfggtayzw4.jpeg"></p><br><p> 即将发布的Red Hat Ansible Engine 2.9版本正等待您进行令人印象深刻的改进，本文中对其中一些进行了描述。 与往常一样，我们在社区支持下公开开发了Ansible Network改进。 加入- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在GitHub上</a>查看<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">任务板，</a>并在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ansible Network</a>的Wiki页面上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">研究Red Hat Ansible Engine 2.9发行版</a>的开发计划。 </p><br><p> 正如我们最近宣布的那样， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">红帽Ansible自动化平台</a>现在包括Ansible Tower，Ansible Engine和所有Ansible Network内容。 现在，大多数流行的网络平台都是通过Ansible模块实现的。 例如： </p><br><ul><li>  Arista Eos </li><li> 思科IOS </li><li> 思科IOS XR </li><li> 思科NX-OS </li><li> 杜松朱诺斯 </li><li> 维约斯 </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处提供</a>了Red Hat通过Ansible Automation完全支持的平台的完整列表。 </p><a name="habracut"></a><br><h2 id="chemu-my-nauchilis"> 我们学到了什么 </h2><br><p>在过去的四年中，我们学到了很多有关开发网络自动化平台的知识。 我们还学习了最终用户如何在Ansible剧本和角色中扮演平台工件。 这是我们发现的： </p><br><ul><li> 组织不仅使设备自动化，而且使许多供应商自动化。 </li><li> 自动化不仅是一种技术现象，而且是一种文化现象。 </li><li> 由于自动化设计的基本体系结构原理，网络的大规模自动化比看起来要复杂得多。 </li></ul><br><p> 当我们在一年多前讨论我们的长期发展计划时，我们的公司客户提出以下要求： </p><br><ul><li> 事实收集需要更好地标准化，并与任何设备的自动化工作流程保持一致。 </li><li> 设备上的更新配置也需要进行标准化和协调，以便Ansible模块在收集事实后处理周期的后半部分。 </li><li> 我们需要严格且受支持的方法来将设备配置转换为结构化数据。 在此基础上，可以从网络设备中转移真相的来源。 </li></ul><br><h2 id="uluchsheniya-faktov"> 事实增强 </h2><br><p> 使用Ansible从网络设备收集事实通常是随机的。 网络平台在不同程度上具有收集事实的能力，但是它们几乎没有（甚至根本没有）用于解析和标准化键值对中数据表示的功能。 阅读Ken Celenza的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文章</a> ，了解分析和标准化事实数据有多么困难和痛苦。 </p><br><p> 您可能已经注意到我们是如何处理Ansible Network Engine角色的。 自然地，在24,000次下载之后，网络引擎角色迅速成为Ansible在Ansible Galaxy中用于网络自动化方案的最受欢迎角色之一。 在将大部分内容移至Ansible 2.8之前，为了准备Ansible 2.9所需的功能，这个Ansible角色提供了第一套工具来协助网络设备的命令解析，命令管理和数据收集。 </p><br><p> 如果您擅长使用Network Engine，这是一种收集，解析和标准化事实数据以供Ansible使用的非常有效的方法。 该角色的缺点是您需要为每个平台和所有网络活动创建一堆解析器。 要了解创建， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">交付</a>和维护解析器有多困难，请查看Cisco的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1200多个解析器</a> 。 </p><br><p> 简而言之，对于大规模自动化而言，从设备接收事实并将其标准化为键值对非常重要，但这在拥有许多供应商和网络平台的情况下很难实现。 </p><br><p> 现在，Ansible 2.9中的每个网络事实模块都可以分析网络设备的配置并返回结构化数据-无需其他库，Ansible角色或自定义解析器。 </p><br><p> 从Ansible 2.9开始，在更新的网络模块的每个发行版中，事实模块均得到了改进，以提供有关此配置部分的信息。 也就是说，事实和模块的开发正在以相同的速度进行，并且它们将始终具有相同的数据结构。 </p><br><p>可以通过两种方式提取网络设备上的资源配置并将其转换为结构化数据。 两种方式都可以使用新的<code>gather_network_resources</code>编译和转换特定的资源列表。 资源名称与模块名称相对应，这非常方便。 </p><br><h3 id="vo-vremya-sbora-faktov"> 在收集事实时： </h3><br><p> 使用<code>gather_facts</code>可以在剧本的开头提取当前的设备配置，然后在整个剧本中使用它。 指定要从设备检索的单个资源。 </p><br><pre> <code class="plaintext hljs">- hosts: arista module_defaults: eos_facts: gather_subset: min gather_network_resources: - interfaces gather_facts: True</code> </pre> <br><p> 您可能会注意到这些示例中的新内容，即<code>gather_facts: true</code>现在可用于网络设备的本机事实调查。 </p><br><h3 id="ispolzovanie-modulya-setevyh-faktov-napryamuyu"> 直接使用网络事实模块： </h3><br><pre> <code class="plaintext hljs">- name: collect interface configuration facts eos_facts: gather_subset: min gather_network_resources: - interfaces</code> </pre> <br><h3 id="pleybuk-vozvraschaet-sleduyuschie-fakty-ob-interfeyse"> 该剧本返回有关界面的以下事实： </h3><br><pre> <code class="plaintext hljs">ansible_facts: ansible_network_resources: interfaces: - enabled: true name: Ethernet1 mtu: '1476' - enabled: true name: Loopback0 - enabled: true name: Loopback1 - enabled: true mtu: '1476' name: Tunnel0 - enabled: true name: Ethernet1 - enabled: true name: Tunnel1 - enabled: true name: Ethernet1</code> </pre> <br><p> 请注意，Ansible如何从Arista设备中检索本机配置并将其转换为结构化数据，以用作后续任务和操作的标准键值对。 </p><br><p> 可以将接口事实添加到Ansible存储的变量中，并立即或稍后将其<code>eos_interfaces</code>资源<code>eos_interfaces</code>输入，而无需进行其他处理或转换。 </p><br><h3 id="moduli-resursov"> 资源模块 </h3><br><p> 因此，我们提取了事实，对数据进行了归一化，将其输入到数据结构的标准化内部架构中，从而获得了现成的事实来源。 万岁！ 当然，这很棒，但是我们仍然需要以某种方式将键值对转换回特定设备平台期望的特定配置。 现在，我们需要用于特定平台的模块，以满足这些新的事实收集和规范化要求。 </p><br><p> 什么是资源模块？ 设备配置部分可以被认为是此设备提供的资源。 网络资源模块被有意地限制为一种资源，并且可以像积木一样堆叠以配置复杂的网络服务。 结果，由于资源模块可以读取<em>和</em>配置网络设备上的特定网络服务，因此自然简化了对资源模块的要求和规格。 </p><br><p> 为了解释资源模块的功能，让我们看一个剧本示例，该示例使用来自网络资源和<code>eos_l3_interface</code>模块的新事实显示幂等操作。 </p><br><pre> <code class="plaintext hljs">- name: example of facts being pushed right back to device. hosts: arista gather_facts: false tasks: - name: grab arista eos facts eos_facts: gather_subset: min gather_network_resources: l3_interfaces - name: ensure that the IP address information is accurate eos_l3_interfaces: config: "{{ ansible_network_resources['l3_interfaces'] }}" register: result - name: ensure config did not change assert: that: not result.changed</code> </pre> <br><p> 如您所见，从设备收集的数据无需转换即可直接传输到相应的资源模块。 在启动时，剧本会从设备中检索值并将其与预期值进行比较。 在此示例中，获得的值对应于预期值（即，检查配置偏差），并且如果配置已更改，则会显示一条消息。 </p><br><p> 检测配置偏差的理想方法是将事实存储在Ansible存储的变量中，并在检查模式下定期将其与资源模块一起使用。 这是查看是否有人手动更改值的简单方法。 在大多数情况下，尽管许多操作是通过Ansible Automation执行的，但组织允许进行手动更改和配置。 </p><br><h2 id="chem-novye-moduli-resursa-otlichayutsya-ot-predyduschih"> 新资源模块与以前的资源模块有何不同？ </h2><br><p> 对于网络自动化工程师而言，Ansible 2.9中的资源模块与以前的版本之间存在3个主要区别。 </p><br><p>  1）对于特定的网络资源（也可以将其视为配置部分），模块和事实将在所有受支持的网络操作系统中同时开发。 我们认为，如果Ansible在单个网络平台上支持资源配置，那么我们应该在任何地方都支持它。 这简化了资源模块的使用，因为网络自动化工程师现在可以使用本机模块和受支持的模块在所有网络操作系统中配置资源（例如LLDP）。 </p><br><p>  2）资源模块现在包括状态值。 </p><br><ul><li>  <code>merged</code> ：配置与提供的配置合并（默认）； </li><li>  <code>replaced</code> ：将资源配置替换为提供的配置； </li><li>  <code>overridden</code> ：资源配置将被提供的配置替换； 多余的资源实例将被删除； </li><li>  <code>deleted</code> ：默认情况下，资源配置将被删除/恢复。 </li></ul><br><p><img src="https://habrastorage.org/webt/yg/0m/_c/yg0m_c1thcp9wm30_de2tqjs810.jpeg"></p><br><p>  3）资源模块现在包含稳定的返回值。 当网络资源模块对网络设备进行了（或建议）必要的更改后，它会将相同的键值对返回给剧本。 </p><br><ul><li>  <code>before</code> ：以任务之前的结构化数据的形式在设备上进行配置； </li><li>  <code>after</code> ：如果设备已更改（或如果使用验证模式，则可能会更改），则将以结构化数据的形式返回结果配置； </li><li>  <code>commands</code> ：在设备上运行以使其达到所需状态的任何配置命令。 </li></ul><br><p><img src="https://habrastorage.org/webt/si/jq/r2/sijqr2ujxrhob-6mvsg2wjcmhrw.jpeg"></p><br><p><img src="https://habrastorage.org/webt/tn/1s/cq/tn1scqim6qomensla3ksk3bn8s4.jpeg"></p><br><h2 id="chto-vse-eto-znachit-pochemu-eto-vazhno"> 这一切是什么意思？ 为什么这很重要？ </h2><br><p> 这篇文章描述了很多复杂的概念，但是我们希望最终您能更好地理解企业客户正在要求事实，数据标准化和自动化平台的循环配置。 但是为什么他们需要这些改进？ 现在，许多组织都在进行数字转换，以使其IT环境更加灵活和更具竞争力。 不管是好是坏，许多网络工程师都是出于自身利益或应管理者的要求而成为网络开发人员。 </p><br><p> 组织了解到，自动化单个网络模板并不能解决碎片问题，只能将效率提高到一定程度。 红帽Ansible自动化平台提供了严格而规范的资源数据模型，以编程方式管理网络设备上的基础数据。 也就是说，用户逐渐放弃单个配置方法，而转而采用更现代的方法，重点是技术（例如IP地址，VLAN，LLDP等），而不是特定的供应商实现。 </p><br><p> 这是否意味着可靠和行之有效的命令模块和配置的日子已经过去了？ 没办法 预期的网络资源模块并非在所有情况下都适用，并且不适用于每个供应商，因此对于某些实现，网络工程师仍将需要命令和配置模块。 资源模块的目的是简化大型Jinja模板，并将非结构化设备配置标准化为结构化JSON格式。 使用资源模块，现有网络可以更轻松地将其配置转换为结构化的键值对，这将是易于理解的事实来源。 如果使用结构化键值对，则可以从每个设备上的运行配置切换为使用独立的结构化数据，并通过“基础架构即代码”方法将网络带到最前沿。 </p><br><h2 id="kakie-moduli-resursov-poyavyatsya-v-ansible-engine-29"> 哪些资源模块将出现在Ansible Engine 2.9中？ </h2><br><p> 在详细说明Ansible 2.9中会发生什么之前，让我们回顾一下我们是如何划分全部工作量的。 </p><br><p> 我们确定了7个类别，每个类别都分配了特定的网络资源： </p><br><p><img src="https://habrastorage.org/webt/qs/io/au/qsioaupl7rqnsvfnmiyzygd9zqs.png"></p><br><p> 注意：Ansible 2.9中计划并实施了大胆的资源。 <br> 根据公司客户和社区的反馈，首先处理与网络拓扑协议，虚拟化和接口相关的模块是合乎逻辑的。 <br> 以下资源模块由Ansible Network团队开发，并与Red Hat支持的平台相对应： </p><br><p><img src="https://habrastorage.org/webt/um/n8/lr/umn8lrzquzbuxlxbb10vaebxavw.png"></p><br><p> 以下模块由Ansible社区开发： </p><br><ul><li>  <code>exos_lldp_global</code>来自Extreme Networks。 </li><li>  <code>nxos_bfd_interfaces</code>来自思科 </li><li>  <code>nxos_telemetry</code>来自思科 </li></ul><br><p> 如您所见，资源模块的概念适合我们的平台导向策略。 也就是说，我们在Ansible本身中包含了必要的特性和功能，以支持网络模块开发中的标准化，并在Ansible角色和剧本级别简化用户的工作。 为了扩展资源模块的开发，Ansible团队发布了Module Builder工具。 </p><br><h2 id="plany-na-ansible-210-i-dalshe"> 从Ansible 2.10起的计划 </h2><br><p> 在Ansible 2.9发布之后，我们将处理以下用于Ansible 2.10的资源模块集，这些资源模块可用于进一步配置拓扑和网络策略，例如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ACL，OSPF和BGP</a> 。 开发计划仍然可以调整，因此，如果您有意见，请向<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ansible Network社区</a>报告。 </p><br><h2 id="resursy-i-nachalo-raboty"> 资源和入门 </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ansible自动化平台新闻稿</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ansible自动化平台博客</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ansible内容交付的未来</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">关于改变Ansible项目结构的思考</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN471896/">https://habr.com/ru/post/zh-CN471896/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471882/index.html">GitHub上的PHP事件，发言人和组织者的开放列表</a></li>
<li><a href="../zh-CN471884/index.html">10个免费的ApexSQL实用程序，用于管理Microsoft SQL Server数据库</a></li>
<li><a href="../zh-CN471886/index.html">VMmanager 6：引入盒子并与上一代产品进行比较</a></li>
<li><a href="../zh-CN471890/index.html">变异推理-它是什么，它吃什么？</a></li>
<li><a href="../zh-CN471892/index.html">我们SRE工作日的6个实用故事</a></li>
<li><a href="../zh-CN471904/index.html">HPE InfoSight的资源规划师</a></li>
<li><a href="../zh-CN471906/index.html">优化不当的危险</a></li>
<li><a href="../zh-CN471908/index.html">素数的意外之美</a></li>
<li><a href="../zh-CN471912/index.html">学习英语：扩大词汇量的7种实用方法</a></li>
<li><a href="../zh-CN471914/index.html">Sega Mega Drive图形系统如何工作：视频显示处理器</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>